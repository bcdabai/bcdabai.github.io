<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>13.108.Spark 优化、Spark优化与hive的区别、SparkSQL启动参数调优、四川任务优化实践：执行效率提升50%以上 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="13.108.Spark 优化、Spark优化与hive的区别、SparkSQL启动参数调优、四川任务优化实践：执行效率提升50%以上" />
<meta property="og:description" content="13.108.Spark 优化
1.1.25.Spark优化与hive的区别
1.1.26.SparkSQL启动参数调优
1.1.27.四川任务优化实践：执行效率提升50%以上
13.108.Spark 优化： 1.1.25.Spark优化与hive的区别 先理解spark与mapreduce的本质区别，算子之间（map和reduce之间多了依赖关系判断，即宽依赖和窄依赖。）
优化的思路和hive基本一致，比较大的区别就是mapreduce算子之间都需要落磁盘，而spark只有宽依赖才需要落磁盘，窄依赖不落磁盘。
1.1.26.SparkSQL启动参数调优 1)先对比结果：executors优化
Hive执行了30分钟（1800秒）的sql，没有优化过的SparkSQL执行需要，
最少化的Executor执行需要640秒（提高了Executor的并行度，牺牲了HDFS的吞吐量：5个core最合适），
最大化的Executor 281.634秒（最大限度的利用HDFS的吞吐量，牺牲Executor的并行度），
优化取中间值，253.189秒。
方案1：最少化 Fat executors
---------------------------------	Fat executors	-------------------------------------------------------------------------------- ./spark-sql --master yarn \	# Fat executors (每个节点一个Executor)【优势：最佳吞吐量】 --num-executors 3 \	# 集群中的节点的数目 = 3 --executor-memory 30G \	# 每个节点的内存/每个节点的executor数目 = 30GB/1 = 30GB --executor-cores 16 \	# 每个executor独占节点中所有的cores = 节点中的core的数目 = 16 --driver-memory 1G	# AM大约需要1024MB的内存和一个Executor 耗时：Time taken: 640 seconds 方案2：最大化Tiny executors
---------------------------------	Tiny executors	-------------------------------------------------------------------------------- ." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/da971cc92159fd02c0cfcaa255f027b9/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-08-31T15:45:13+08:00" />
<meta property="article:modified_time" content="2023-08-31T15:45:13+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">13.108.Spark 优化、Spark优化与hive的区别、SparkSQL启动参数调优、四川任务优化实践：执行效率提升50%以上</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>13.108.Spark 优化<br> 1.1.25.Spark优化与hive的区别<br> 1.1.26.SparkSQL启动参数调优<br> 1.1.27.四川任务优化实践：执行效率提升50%以上</p> 
<h3><a id="13108Spark__5"></a>13.108.Spark 优化：</h3> 
<h4><a id="1125Sparkhive_6"></a>1.1.25.Spark优化与hive的区别</h4> 
<p>先理解spark与mapreduce的本质区别，算子之间（map和reduce之间多了依赖关系判断，即宽依赖和窄依赖。）<br> 优化的思路和hive基本一致，比较大的区别就是mapreduce算子之间都需要落磁盘，而spark只有宽依赖才需要落磁盘，窄依赖不落磁盘。<br> <img src="https://images2.imgbox.com/3c/fa/zgFbjFJo_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/9f/16/xWrJ8PGL_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="1126SparkSQL_11"></a>1.1.26.SparkSQL启动参数调优</h4> 
<p><img src="https://images2.imgbox.com/e6/0e/kpdzg58K_o.png" alt="在这里插入图片描述"></p> 
<p><strong>1)先对比结果：executors优化</strong><br> Hive执行了30分钟（1800秒）的sql，没有优化过的SparkSQL执行需要，<br> 最少化的Executor执行需要640秒（提高了Executor的并行度，牺牲了HDFS的吞吐量：5个core最合适），<br> 最大化的Executor 281.634秒（最大限度的利用HDFS的吞吐量，牺牲Executor的并行度），<br> 优化取中间值，253.189秒。</p> 
<p><strong>方案1：最少化 Fat executors</strong></p> 
<pre><code class="prism language-bash">---------------------------------	Fat executors	--------------------------------------------------------------------------------
./spark-sql <span class="token parameter variable">--master</span> <span class="token function">yarn</span> <span class="token punctuation">\</span>	<span class="token comment"># Fat executors (每个节点一个Executor)【优势：最佳吞吐量】</span>
--num-executors <span class="token number">3</span> <span class="token punctuation">\</span>			<span class="token comment"># 集群中的节点的数目 = 3</span>
--executor-memory 30G <span class="token punctuation">\</span>	<span class="token comment"># 每个节点的内存/每个节点的executor数目 = 30GB/1 = 30GB</span>
--executor-cores <span class="token number">16</span> <span class="token punctuation">\</span>		<span class="token comment"># 每个executor独占节点中所有的cores = 节点中的core的数目 = 16</span>
--driver-memory 1G			<span class="token comment"># AM大约需要1024MB的内存和一个Executor</span>
耗时：Time taken: <span class="token number">640</span> seconds
</code></pre> 
<p><strong>方案2：最大化Tiny executors</strong></p> 
<pre><code class="prism language-bash">---------------------------------	Tiny executors	--------------------------------------------------------------------------------
./spark-sql <span class="token parameter variable">--master</span> <span class="token function">yarn</span> <span class="token punctuation">\</span>	<span class="token comment"># Tiny executors [每个Executor一个Core]【优势：并行性】</span>
--num-executors <span class="token number">48</span> <span class="token punctuation">\</span>		<span class="token comment"># 集群中的core的总数 = 每个节点的core数目 * 集群中的节点数 = 16*3</span>
--executor-memory <span class="token number">1</span>.6G <span class="token punctuation">\</span>	<span class="token comment"># 每个节点的内存/每个节点的executor数目 = 30GB/16 = 1.875GB</span>
--executor-cores <span class="token number">1</span> <span class="token punctuation">\</span>			<span class="token comment"># 每个executor一个core</span>
--driver-memory 1G			<span class="token comment"># AM大约需要1024MB的内存和一个Executor</span>
耗时：Time taken: <span class="token number">281.634</span> seconds
executor并发度只有45，task的并发度，1个executor <span class="token number">50</span>左右，总数 <span class="token number">18382</span>
</code></pre> 
<p><strong>方案3：折中方案</strong></p> 
<pre><code class="prism language-bash">---------------------------------	Balance between Fat <span class="token punctuation">(</span>vs<span class="token punctuation">)</span> Tiny	--------------------------------------------------------------------------------
./spark-sql <span class="token parameter variable">--master</span> <span class="token function">yarn</span> <span class="token punctuation">\</span>	<span class="token comment"># Balance between Fat (vs) Tiny</span>
--num-executors <span class="token number">8</span> <span class="token punctuation">\</span>			<span class="token comment"># (16-1)*3/5 = 9 留一个executor给ApplicationManager =&gt; --num-executors = 9-1 = 8</span>
						<span class="token comment"># 每个节点的executor的数目 = 9 / 3 = 3</span>
--executor-memory 10G <span class="token punctuation">\</span>	<span class="token comment"># 每个executor的内存 = 30GB / 3 = 10GB【默认分配的是8G，需要修改配置文件支持到10G。】</span>
						<span class="token comment"># 计算堆开销 = 7% * 10GB = 0.7GB。因此，实际的 --executor-memory = 10 - 0.7 = 9.3GB</span>
--executor-cores <span class="token number">5</span> <span class="token punctuation">\</span>			<span class="token comment"># 给每个executor分配5个core，保证良好的HDFS吞吐。</span>
						<span class="token comment"># 每个节点留一个core给Hadoop/Yarn守护进程 =&gt; 每个节点可用的core的数目= 16 - 1</span>
--driver-memory 1G			
耗时：Time taken: <span class="token number">253</span> seconds
</code></pre> 
<p><strong>Task并行度优化</strong><br> 1.调整 Executors 下 每个stage的默认task数量，即设置Task 的并发度：</p> 
<p>【当集群数量比较大时】<br> 很多人常犯的一个错误就是不去设置这个参数，那么此时就会导致Spark自己根据底层HDFS的block数量来设置task的数量，<br> ！【默认是一个HDFS block对应一个task（如果不设置那么可以通过第三种方案来优化！）】。<br> 通常来说，Spark默认设置的数量是偏少的（比如就几十个task），<br> 如果task数量偏少的话，就会导致你前面设置好的Executor的参数都前功尽弃。<br> 试想一下，无论你的Executor进程有多少个，内存和CPU有多大，但是task只有1个或者10个，<br> 那么90%的Executor进程可能根本就没有task执行，也就是白白浪费了资源！<br> 因此Spark官网建议的设置原则是，设置该参数为num-executors * executor-cores的2~3倍较为合适，<br> 比如Executor的总CPU core数量为300个，那么设置1000个task是可以的，此时可以充分地利用Spark集群的资源。</p> 
<p>30 G 16 core</p> 
<pre><code class="prism language-bash">/home/admin/bigdata/spark-2.2.0-bin-hadoop2.6/bin/spark-sql <span class="token punctuation">\</span>
<span class="token parameter variable">--master</span> <span class="token function">yarn</span> <span class="token punctuation">\</span>
--num-executors <span class="token number">16</span> <span class="token punctuation">\</span>
--executor-memory 1G <span class="token punctuation">\</span>
--executor-cores <span class="token number">10</span> <span class="token punctuation">\</span>
--driver-memory 1G <span class="token punctuation">\</span>
<span class="token parameter variable">--conf</span> <span class="token assign-left variable">spark.default.parallelism</span><span class="token operator">=</span><span class="token number">450</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--conf</span> <span class="token assign-left variable">spark.storage.memoryFraction</span><span class="token operator">=</span><span class="token number">0.5</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--conf</span> <span class="token assign-left variable">spark.shuffle.memoryFraction</span><span class="token operator">=</span><span class="token number">0.3</span>	
</code></pre> 
<h4><a id="112750_84"></a>1.1.27.四川任务优化实践：执行效率提升50%以上</h4> 
<p><strong>一、四川的信息</strong><br> 账号：xxxxxx 密码： xxxxxxxx</p> 
<p><strong>一、事实表优化</strong><br> 1、**优化结果： 20 分钟左右，优化完成后 5 分钟左右。**数据量：5.8亿</p> 
<p>2、原SQL：<strong>（spark不一定快）</strong></p> 
<pre><code class="prism language-sql"><span class="token keyword">drop</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> dc_f_organization<span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token operator">not</span> <span class="token keyword">exists</span> dc_f_organization <span class="token punctuation">(</span>
	orgid <span class="token keyword">int</span><span class="token punctuation">,</span>
	orgcode string<span class="token punctuation">,</span>
	yearmonth string <span class="token punctuation">,</span>
	zzdate string<span class="token punctuation">,</span>
	orgname string<span class="token punctuation">,</span>
	orglevel <span class="token keyword">int</span><span class="token punctuation">,</span>
	id <span class="token keyword">int</span><span class="token punctuation">,</span>
	orgtagging <span class="token keyword">int</span><span class="token punctuation">,</span> 
	createdate <span class="token keyword">timestamp</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">insert</span> <span class="token keyword">into</span> dc_f_organization
<span class="token keyword">select</span> 
	a<span class="token punctuation">.</span>orgid<span class="token punctuation">,</span> <span class="token punctuation">.</span>orgcode<span class="token punctuation">,</span> a<span class="token punctuation">.</span>yearmonth<span class="token punctuation">,</span> a<span class="token punctuation">.</span>zzdate<span class="token punctuation">,</span> n<span class="token punctuation">.</span>orgname<span class="token punctuation">,</span> n<span class="token punctuation">.</span>orglevel<span class="token punctuation">,</span> n<span class="token punctuation">.</span>id<span class="token punctuation">,</span> n<span class="token punctuation">.</span>orgtagging<span class="token punctuation">,</span> n<span class="token punctuation">.</span>createdate
<span class="token keyword">from</span> 
	<span class="token punctuation">(</span> <span class="token keyword">select</span> o<span class="token punctuation">.</span>id orgid<span class="token punctuation">,</span> o<span class="token punctuation">.</span>orgcode<span class="token punctuation">,</span> d<span class="token punctuation">.</span>yearmonth<span class="token punctuation">,</span> d<span class="token punctuation">.</span>zzdate <span class="token keyword">from</span> dc_d_organization o<span class="token punctuation">,</span> dc_d_wddate <span class="token punctuation">)</span> a
	<span class="token keyword">left</span> <span class="token keyword">join</span> dc_d_organization n <span class="token keyword">on</span> to_date<span class="token punctuation">(</span>n<span class="token punctuation">.</span>createdate<span class="token punctuation">)</span><span class="token operator">=</span>a<span class="token punctuation">.</span>zzdate <span class="token operator">and</span> n<span class="token punctuation">.</span>orgcode <span class="token operator">=</span> a<span class="token punctuation">.</span>orgcode<span class="token punctuation">;</span>
	
</code></pre> 
<p><strong>3、优化方案：</strong><br> – ############################## HIVE 执行：增加 block 的数量，提高Spark的并发度（当前任务文件比较小，设置了26；一般参考数量：300左右；） #################################<br> – (1) 单独执行笛卡尔积，<br> – 先拆分文件：（改用hive，拆分文件，增加并行度）<br> – 【耗时：101.586 seconds；结果文件数量 26】<br> – 检查文件块数量：hadoop fs -ls /user/hive/warehouse/test.db/dc_d_org_date 26 个block</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">set</span> <span class="token assign-left variable">mapreduce.map.memory.mb</span><span class="token operator">=</span><span class="token number">1024</span><span class="token punctuation">;</span>
<span class="token builtin class-name">set</span> <span class="token assign-left variable">mapred.max.split.size</span><span class="token operator">=</span><span class="token number">524288</span><span class="token punctuation">;</span>
<span class="token builtin class-name">set</span> <span class="token assign-left variable">mapred.min.split.size.per.node</span><span class="token operator">=</span><span class="token number">524288</span><span class="token punctuation">;</span>
<span class="token builtin class-name">set</span> <span class="token assign-left variable">mapred.min.split.size.per.rack</span><span class="token operator">=</span><span class="token number">524288</span><span class="token punctuation">;</span>
drop table <span class="token keyword">if</span> exists dc_d_org_date<span class="token punctuation">;</span>
create table dc_d_org_date as <span class="token keyword">select</span> o.id orgid,o.orgcode,d.yearmonth,d.zzdate from dc_d_organization o CROSS JOIN dc_d_wddate d<span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-bash">-- <span class="token comment">##############################	SPARK 执行；参数：spark-sql --master yarn --num-executors 100 --executor-memory 5G --executor-cores 3 --driver-memory 3G	#################################</span>
-- <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>【Spark：Time taken: <span class="token number">115.78</span> seconds；】
<span class="token builtin class-name">set</span> <span class="token assign-left variable">spark.shuffle.consolidateFiles</span><span class="token operator">=</span>true<span class="token punctuation">;</span>
drop table <span class="token keyword">if</span> exists dc_f_organization<span class="token punctuation">;</span>
create table <span class="token keyword">if</span> not exists dc_f_organization
<span class="token punctuation">(</span>orgid int,orgcode string,YEARMONTH string ,ZZDATE string,ORGNAME string,orglevel int,id int,ORGTAGGING int, createdate timestamp<span class="token punctuation">)</span><span class="token punctuation">;</span>

insert into dc_f_organization
<span class="token keyword">select</span> a.orgid,a.orgcode,a.YEARMONTH,a.ZZDATE,n.ORGNAME,n.orglevel,n.id,n.ORGTAGGING,n.createdate
from dc_d_org_date a
left <span class="token function">join</span> DC_D_ORGANIZATION n on to_date<span class="token punctuation">(</span>n.CREATEDATE<span class="token punctuation">)</span><span class="token operator">=</span>a.ZZDATE and n.orgcode <span class="token operator">=</span> a.orgcode<span class="token punctuation">;</span>
</code></pre> 
<p>– ############################## 持续优化方向：将上述两者合并到一起在 spark 中执行 ##############################<br> 问题：可能是因为文件太小，spark 分区命令没有生效。set spark.sql.shuffle.partitions=300;<br> 注意：SPARK中笛卡尔积需要改成 CROSS JOIN，否则语法报错。</p> 
<p><strong>二、优化CUBE表</strong></p> 
<pre><code class="prism language-sql">  <span class="token number">1</span>、优化结果：原来<span class="token number">1</span>小时左右，优化后<span class="token number">26</span>分钟。
		总结：shuffle时间：<span class="token number">16</span>分钟，数据量	<span class="token number">35.2</span>亿
		任务含有宽依赖（<span class="token keyword">group</span>）被分成<span class="token number">2</span>个stage
			
		✔采用方案 <span class="token number">1</span>：改用spark执行。提高并行度。
			执行参数：spark<span class="token operator">-</span><span class="token keyword">sql</span> <span class="token comment">--master yarn --num-executors 100 --executor-memory 5G --executor-cores 3 --driver-memory 3G</span>
			stage <span class="token number">1</span> 执行时间：<span class="token number">11</span>（partitions<span class="token operator">=</span><span class="token number">300</span>）
			stage <span class="token number">2</span> 执行时间：<span class="token number">15</span>（partitions<span class="token operator">=</span><span class="token number">200</span>）
			设置分区数量，默认是<span class="token number">200</span>：<span class="token keyword">set</span> spark<span class="token punctuation">.</span><span class="token keyword">sql</span><span class="token punctuation">.</span>shuffle<span class="token punctuation">.</span>partitions<span class="token operator">=</span><span class="token number">300</span><span class="token punctuation">;</span>（理论上可以提高 stage <span class="token number">2</span> <span class="token number">30</span><span class="token operator">%</span>的速度，实际运行的时候可能会丢失executor，运行不稳定，不建议设置。）
			（原因可能是设置了虚拟核心数量。）
			
		方案 <span class="token number">2</span>：将<span class="token keyword">case</span> <span class="token keyword">when</span>的操作独立出一张表，去除部分重复扫描计算，减少cube阶段的计算量。
			抽取的时间增加了<span class="token number">2</span>分钟，节省的 shuffle 时间也是<span class="token number">2</span>分钟。没有意义。
			预处理时间：<span class="token number">2</span><span class="token operator">-</span><span class="token number">3</span>分钟
			stage <span class="token number">1</span> 执行时间：<span class="token number">11</span>
			stage <span class="token number">2</span> 执行时间：<span class="token number">13</span>（节省的时间也是<span class="token number">2</span><span class="token operator">-</span><span class="token number">3</span>分钟）
			
		方案 <span class="token number">3</span>：提高 shuffle 使用内存的占比 设置为<span class="token number">60</span><span class="token operator">%</span>
			执行参数：spark<span class="token operator">-</span><span class="token keyword">sql</span> <span class="token comment">--master yarn --num-executors 100 --executor-memory 5G --executor-cores 3 --driver-memory 3G --conf spark.storage.memoryFraction=0.3 --conf spark.shuffle.memoryFraction=0.5</span>
			执行结果：效果不明显，多次执行时间也不太一致。
			
		方案 <span class="token number">4</span>：减少CUBE的维度数量， orgid 和 orgcode是一对一关系，可以去掉<span class="token number">1</span>个维度，计算完成之后再<span class="token keyword">join</span>
			执行结果：<span class="token keyword">join</span> 消耗的时间更久。
				
	<span class="token number">2</span>、采用的方案<span class="token number">1</span>：SPARK执行
		<span class="token comment">-- 执行参数 spark-sql --master yarn --num-executors 100 --executor-memory 5G --executor-cores 3 --driver-memory 3G</span>
		<span class="token comment">-- set spark.sql.shuffle.partitions=300;</span>
		<span class="token keyword">drop</span> <span class="token keyword">table</span>  <span class="token keyword">if</span>  <span class="token keyword">exists</span> dc_c_organization<span class="token punctuation">;</span>
		<span class="token keyword">create</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token operator">not</span> <span class="token keyword">exists</span> dc_c_organization<span class="token punctuation">(</span>
			YEARMONTH string<span class="token punctuation">,</span>ZZDATE string<span class="token punctuation">,</span>orgid <span class="token keyword">int</span> <span class="token punctuation">,</span>orgcode string<span class="token punctuation">,</span>total <span class="token keyword">int</span><span class="token punctuation">,</span>
			provinceNum <span class="token keyword">int</span><span class="token punctuation">,</span>cityNum <span class="token keyword">int</span><span class="token punctuation">,</span>districtNum <span class="token keyword">int</span><span class="token punctuation">,</span> newDistrictNum <span class="token keyword">int</span><span class="token punctuation">,</span>townNum <span class="token keyword">int</span><span class="token punctuation">,</span>streetNum <span class="token keyword">int</span><span class="token punctuation">,</span>otherNum <span class="token keyword">int</span><span class="token punctuation">,</span>communityNum <span class="token keyword">int</span><span class="token punctuation">,</span>villageNum <span class="token keyword">int</span><span class="token punctuation">,</span>gridNum <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			
		<span class="token comment">-- 如果用 hive 执行可以开启 combiner，map端先预聚合，减少reduce端的数据量和计算量，减少磁盘的IO和网络传输时间。</span>
		<span class="token comment">-- set hive.map.aggr = true;</span>
		<span class="token comment">-- set hive.groupby.mapaggr.checkinterval = 10000;</span>
		
		<span class="token comment">-- ##############################	SPARK	#################################</span>
		<span class="token comment">-- set spark.sql.shuffle.partitions=300;</span>
		<span class="token keyword">insert</span> <span class="token keyword">into</span> dc_c_organization
		<span class="token keyword">select</span>  
		n<span class="token punctuation">.</span>YEARMONTH<span class="token punctuation">,</span>
		n<span class="token punctuation">.</span>ZZDATE<span class="token punctuation">,</span>
		n<span class="token punctuation">.</span>orgid<span class="token punctuation">,</span>
		n<span class="token punctuation">.</span>orgcode<span class="token punctuation">,</span>
		<span class="token function">count</span><span class="token punctuation">(</span>n<span class="token punctuation">.</span>id<span class="token punctuation">)</span> total<span class="token punctuation">,</span>
		nvl<span class="token punctuation">(</span><span class="token function">SUM</span><span class="token punctuation">(</span><span class="token keyword">case</span> <span class="token keyword">when</span> pt<span class="token punctuation">.</span>displayname<span class="token operator">=</span><span class="token string">'省'</span> <span class="token keyword">then</span> <span class="token number">1</span>  <span class="token keyword">else</span> <span class="token number">0</span> <span class="token keyword">end</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> provinceNum<span class="token punctuation">,</span>
		nvl<span class="token punctuation">(</span><span class="token function">SUM</span><span class="token punctuation">(</span><span class="token keyword">case</span> <span class="token keyword">when</span> pt<span class="token punctuation">.</span>displayname<span class="token operator">=</span><span class="token string">'市'</span> <span class="token keyword">then</span> <span class="token number">1</span>  <span class="token keyword">else</span> <span class="token number">0</span> <span class="token keyword">end</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">as</span> cityNum<span class="token punctuation">,</span>
		nvl<span class="token punctuation">(</span><span class="token function">SUM</span><span class="token punctuation">(</span><span class="token keyword">case</span> <span class="token keyword">when</span> pt<span class="token punctuation">.</span>displayname<span class="token operator">=</span><span class="token string">'县（区）'</span> <span class="token keyword">then</span> <span class="token number">1</span>  <span class="token keyword">else</span> <span class="token number">0</span> <span class="token keyword">end</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> districtNum<span class="token punctuation">,</span>
		<span class="token punctuation">(</span>nvl<span class="token punctuation">(</span><span class="token function">SUM</span><span class="token punctuation">(</span><span class="token keyword">case</span> <span class="token keyword">when</span> pt<span class="token punctuation">.</span>displayname<span class="token operator">=</span><span class="token string">'县（区）'</span>  <span class="token keyword">then</span> <span class="token number">1</span>  <span class="token keyword">else</span> <span class="token number">0</span> <span class="token keyword">end</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">-</span>nvl<span class="token punctuation">(</span><span class="token function">SUM</span><span class="token punctuation">(</span><span class="token keyword">case</span> <span class="token keyword">when</span> pt<span class="token punctuation">.</span>displayname<span class="token operator">=</span><span class="token string">'县（区）'</span> <span class="token operator">AND</span> n<span class="token punctuation">.</span>ORGTAGGING<span class="token operator">=</span> <span class="token number">31</span> <span class="token keyword">then</span> <span class="token number">1</span>  <span class="token keyword">else</span> <span class="token number">0</span> <span class="token keyword">end</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> newDistrictNum<span class="token punctuation">,</span>
		nvl<span class="token punctuation">(</span><span class="token function">SUM</span><span class="token punctuation">(</span><span class="token keyword">case</span> <span class="token keyword">when</span>  <span class="token punctuation">(</span><span class="token punctuation">(</span>n<span class="token punctuation">.</span>ORGNAME <span class="token operator">LIKE</span> <span class="token string">'%乡%'</span> <span class="token operator">OR</span> n<span class="token punctuation">.</span>ORGNAME <span class="token operator">LIKE</span> <span class="token string">'%镇%'</span> <span class="token operator">OR</span> n<span class="token punctuation">.</span>ORGNAME <span class="token operator">LIKE</span> <span class="token string">'%乡镇%'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">AND</span> pt<span class="token punctuation">.</span>displayname<span class="token operator">=</span><span class="token string">'乡镇（街道）'</span> <span class="token keyword">then</span> <span class="token number">1</span>  <span class="token keyword">else</span> <span class="token number">0</span> <span class="token keyword">end</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> townNum<span class="token punctuation">,</span>
		nvl<span class="token punctuation">(</span><span class="token function">SUM</span><span class="token punctuation">(</span><span class="token keyword">case</span> <span class="token keyword">when</span> <span class="token punctuation">(</span>n<span class="token punctuation">.</span>ORGNAME <span class="token operator">LIKE</span> <span class="token string">'%街道%'</span><span class="token punctuation">)</span> <span class="token operator">AND</span> pt<span class="token punctuation">.</span>displayname<span class="token operator">=</span><span class="token string">'乡镇（街道）'</span> <span class="token keyword">then</span> <span class="token number">1</span>  <span class="token keyword">else</span> <span class="token number">0</span> <span class="token keyword">end</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> streetNum<span class="token punctuation">,</span>
		<span class="token punctuation">(</span>nvl<span class="token punctuation">(</span><span class="token function">SUM</span><span class="token punctuation">(</span><span class="token keyword">case</span> <span class="token keyword">when</span> pt<span class="token punctuation">.</span>displayname<span class="token operator">=</span><span class="token string">'乡镇（街道）'</span><span class="token keyword">then</span> <span class="token number">1</span>  <span class="token keyword">else</span> <span class="token number">0</span> <span class="token keyword">end</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">-</span>nvl<span class="token punctuation">(</span><span class="token function">SUM</span><span class="token punctuation">(</span><span class="token keyword">case</span> <span class="token keyword">when</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>n<span class="token punctuation">.</span>ORGNAME <span class="token operator">LIKE</span> <span class="token string">'%乡%'</span> <span class="token operator">OR</span> n<span class="token punctuation">.</span>ORGNAME <span class="token operator">LIKE</span> <span class="token string">'%镇%'</span> <span class="token operator">OR</span> n<span class="token punctuation">.</span>ORGNAME <span class="token operator">LIKE</span> <span class="token string">'%乡镇%'</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token operator">AND</span> pt<span class="token punctuation">.</span>displayname<span class="token operator">=</span><span class="token string">'乡镇（街道）'</span> <span class="token keyword">then</span> <span class="token number">1</span>  <span class="token keyword">else</span> <span class="token number">0</span> <span class="token keyword">end</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">-</span>nvl<span class="token punctuation">(</span><span class="token function">SUM</span><span class="token punctuation">(</span><span class="token keyword">case</span> <span class="token keyword">when</span> <span class="token punctuation">(</span>n<span class="token punctuation">.</span>ORGNAME <span class="token operator">LIKE</span> <span class="token string">'%街道%'</span> <span class="token punctuation">)</span>  <span class="token operator">AND</span> pt<span class="token punctuation">.</span>displayname<span class="token operator">=</span><span class="token string">'乡镇（街道）'</span> <span class="token keyword">then</span> <span class="token number">1</span>  <span class="token keyword">else</span> <span class="token number">0</span> <span class="token keyword">end</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> otherNum<span class="token punctuation">,</span>
		<span class="token punctuation">(</span>nvl<span class="token punctuation">(</span><span class="token function">SUM</span><span class="token punctuation">(</span><span class="token keyword">case</span> <span class="token keyword">when</span> pt<span class="token punctuation">.</span>displayname<span class="token operator">=</span><span class="token string">'村（社区）'</span> <span class="token keyword">then</span> <span class="token number">1</span>  <span class="token keyword">else</span> <span class="token number">0</span> <span class="token keyword">end</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">-</span>nvl<span class="token punctuation">(</span><span class="token function">SUM</span><span class="token punctuation">(</span><span class="token keyword">case</span> <span class="token keyword">when</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>n<span class="token punctuation">.</span>ORGNAME <span class="token operator">LIKE</span> <span class="token string">'%村'</span> <span class="token operator">OR</span> n<span class="token punctuation">.</span>ORGNAME <span class="token operator">LIKE</span> <span class="token string">'%村民委员会'</span> <span class="token operator">OR</span> n<span class="token punctuation">.</span>ORGNAME <span class="token operator">LIKE</span> <span class="token string">'%农村工作中心站'</span> <span class="token operator">OR</span> n<span class="token punctuation">.</span>ORGNAME <span class="token operator">LIKE</span> <span class="token string">'%村委会'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">AND</span> pt<span class="token punctuation">.</span>displayname<span class="token operator">=</span><span class="token string">'村（社区）'</span> <span class="token keyword">then</span> <span class="token number">1</span>  <span class="token keyword">else</span> <span class="token number">0</span> <span class="token keyword">end</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> communityNum<span class="token punctuation">,</span>
		nvl<span class="token punctuation">(</span><span class="token function">SUM</span><span class="token punctuation">(</span><span class="token keyword">case</span> <span class="token keyword">when</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>n<span class="token punctuation">.</span>ORGNAME <span class="token operator">LIKE</span> <span class="token string">'%村'</span> <span class="token operator">OR</span> n<span class="token punctuation">.</span>ORGNAME <span class="token operator">LIKE</span> <span class="token string">'%村民委员会'</span> <span class="token operator">OR</span> n<span class="token punctuation">.</span>ORGNAME <span class="token operator">LIKE</span> <span class="token string">'%农村工作中心站'</span> <span class="token operator">OR</span> n<span class="token punctuation">.</span>ORGNAME <span class="token operator">LIKE</span> <span class="token string">'%村委会'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">AND</span> pt<span class="token punctuation">.</span>displayname<span class="token operator">=</span><span class="token string">'村（社区）'</span> <span class="token keyword">then</span> <span class="token number">1</span>  <span class="token keyword">else</span> <span class="token number">0</span> <span class="token keyword">end</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> villageNum<span class="token punctuation">,</span>
		nvl<span class="token punctuation">(</span><span class="token function">SUM</span><span class="token punctuation">(</span><span class="token keyword">case</span> <span class="token keyword">when</span> pt<span class="token punctuation">.</span>displayname<span class="token operator">=</span><span class="token string">'片组片格'</span><span class="token keyword">then</span> <span class="token number">1</span>  <span class="token keyword">else</span> <span class="token number">0</span> <span class="token keyword">end</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> gridNum
		<span class="token keyword">from</span> dc_f_organization n
		<span class="token keyword">left</span> <span class="token keyword">join</span> dc_d_property pt <span class="token keyword">on</span> n<span class="token punctuation">.</span>orglevel <span class="token operator">=</span> pt<span class="token punctuation">.</span>id
		<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> n<span class="token punctuation">.</span>YEARMONTH<span class="token punctuation">,</span>n<span class="token punctuation">.</span>ZZDATE<span class="token punctuation">,</span>n<span class="token punctuation">.</span>orgid<span class="token punctuation">,</span>n<span class="token punctuation">.</span>orgcode
		<span class="token keyword">WITH</span> CUBE<span class="token punctuation">;</span>
			
	<span class="token number">3</span>、优化方案<span class="token number">2</span>：从业务逻辑上进行优化。（发现<span class="token keyword">SQL</span>逻辑中存在重复的计算）
		<span class="token comment">-- ############################	预处理：去除重复计算和减少CUBE的计算量	############################</span>
			<span class="token keyword">drop</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> temp_dc_c_organization<span class="token punctuation">;</span>
			<span class="token keyword">create</span> <span class="token keyword">table</span> temp_dc_c_organization
			<span class="token keyword">as</span> <span class="token keyword">select</span>
			n<span class="token punctuation">.</span>yearmonth<span class="token punctuation">,</span>
			n<span class="token punctuation">.</span>zzdate<span class="token punctuation">,</span>
			n<span class="token punctuation">.</span>orgid<span class="token punctuation">,</span>
			n<span class="token punctuation">.</span>orgcode<span class="token punctuation">,</span>
			n<span class="token punctuation">.</span>id <span class="token keyword">as</span> id<span class="token punctuation">,</span>
			<span class="token keyword">case</span> <span class="token keyword">when</span> pt<span class="token punctuation">.</span>displayname<span class="token operator">=</span><span class="token string">'省'</span> <span class="token keyword">then</span> <span class="token number">1</span>  <span class="token keyword">else</span> <span class="token number">0</span> <span class="token keyword">end</span> <span class="token keyword">as</span> provincenum<span class="token punctuation">,</span>
			<span class="token keyword">case</span> <span class="token keyword">when</span> pt<span class="token punctuation">.</span>displayname<span class="token operator">=</span><span class="token string">'市'</span> <span class="token keyword">then</span> <span class="token number">1</span>  <span class="token keyword">else</span> <span class="token number">0</span> <span class="token keyword">end</span> <span class="token keyword">as</span> citynum<span class="token punctuation">,</span>
			<span class="token keyword">case</span> <span class="token keyword">when</span> pt<span class="token punctuation">.</span>displayname<span class="token operator">=</span><span class="token string">'县（区）'</span> <span class="token keyword">then</span> <span class="token number">1</span>  <span class="token keyword">else</span> <span class="token number">0</span> <span class="token keyword">end</span> <span class="token keyword">as</span> districtnum<span class="token punctuation">,</span>
			<span class="token keyword">case</span> <span class="token keyword">when</span> pt<span class="token punctuation">.</span>displayname<span class="token operator">=</span><span class="token string">'县（区）'</span> <span class="token operator">and</span> n<span class="token punctuation">.</span>orgtagging<span class="token operator">=</span> <span class="token number">31</span> <span class="token keyword">then</span> <span class="token number">1</span>  <span class="token keyword">else</span> <span class="token number">0</span> <span class="token keyword">end</span> <span class="token keyword">as</span> old_districtnum<span class="token punctuation">,</span>
【重复<span class="token number">1</span>】	<span class="token keyword">case</span> <span class="token keyword">when</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>n<span class="token punctuation">.</span>orgname <span class="token operator">like</span> <span class="token string">'%乡%'</span> <span class="token operator">or</span> n<span class="token punctuation">.</span>orgname <span class="token operator">like</span> <span class="token string">'%镇%'</span> <span class="token operator">or</span> n<span class="token punctuation">.</span>orgname <span class="token operator">like</span> <span class="token string">'%乡镇%'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">and</span> pt<span class="token punctuation">.</span>displayname<span class="token operator">=</span><span class="token string">'乡镇（街道）'</span> <span class="token keyword">then</span> <span class="token number">1</span>  <span class="token keyword">else</span> <span class="token number">0</span> <span class="token keyword">end</span> townnum<span class="token punctuation">,</span>
【重复<span class="token number">2</span>】	<span class="token keyword">case</span> <span class="token keyword">when</span> <span class="token punctuation">(</span>n<span class="token punctuation">.</span>orgname <span class="token operator">like</span> <span class="token string">'%街道%'</span><span class="token punctuation">)</span> <span class="token operator">and</span> pt<span class="token punctuation">.</span>displayname<span class="token operator">=</span><span class="token string">'乡镇（街道）'</span> <span class="token keyword">then</span> <span class="token number">1</span>  <span class="token keyword">else</span> <span class="token number">0</span> <span class="token keyword">end</span> streetnum<span class="token punctuation">,</span>
			<span class="token keyword">case</span> <span class="token keyword">when</span> pt<span class="token punctuation">.</span>displayname<span class="token operator">=</span><span class="token string">'乡镇（街道）'</span><span class="token keyword">then</span> <span class="token number">1</span>  <span class="token keyword">else</span> <span class="token number">0</span> <span class="token keyword">end</span> <span class="token keyword">as</span> total_streetnum_01<span class="token punctuation">,</span>
【重复<span class="token number">1</span>】	<span class="token keyword">case</span> <span class="token keyword">when</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>n<span class="token punctuation">.</span>orgname <span class="token operator">like</span> <span class="token string">'%乡%'</span> <span class="token operator">or</span> n<span class="token punctuation">.</span>orgname <span class="token operator">like</span> <span class="token string">'%镇%'</span> <span class="token operator">or</span> n<span class="token punctuation">.</span>orgname <span class="token operator">like</span> <span class="token string">'%乡镇%'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">and</span> pt<span class="token punctuation">.</span>displayname<span class="token operator">=</span><span class="token string">'乡镇（街道）'</span> <span class="token keyword">then</span> <span class="token number">1</span>  <span class="token keyword">else</span> <span class="token number">0</span> <span class="token keyword">end</span> <span class="token keyword">as</span> total_streetnum_02<span class="token punctuation">,</span>
【重复<span class="token number">2</span>】	<span class="token keyword">case</span> <span class="token keyword">when</span> <span class="token punctuation">(</span>n<span class="token punctuation">.</span>orgname <span class="token operator">like</span> <span class="token string">'%街道%'</span><span class="token punctuation">)</span> <span class="token operator">and</span> pt<span class="token punctuation">.</span>displayname<span class="token operator">=</span><span class="token string">'乡镇（街道）'</span> <span class="token keyword">then</span> <span class="token number">1</span>  <span class="token keyword">else</span> <span class="token number">0</span> <span class="token keyword">end</span> <span class="token keyword">as</span> total_streetnum_03<span class="token punctuation">,</span>
			<span class="token keyword">case</span> <span class="token keyword">when</span> pt<span class="token punctuation">.</span>displayname<span class="token operator">=</span><span class="token string">'村（社区）'</span> <span class="token keyword">then</span> <span class="token number">1</span>  <span class="token keyword">else</span> <span class="token number">0</span> <span class="token keyword">end</span> <span class="token keyword">as</span> communitynum_01<span class="token punctuation">,</span>
【重复<span class="token number">3</span>】	<span class="token keyword">case</span> <span class="token keyword">when</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>n<span class="token punctuation">.</span>orgname <span class="token operator">like</span> <span class="token string">'%村'</span> <span class="token operator">or</span> n<span class="token punctuation">.</span>orgname <span class="token operator">like</span> <span class="token string">'%村民委员会'</span> <span class="token operator">or</span> n<span class="token punctuation">.</span>orgname <span class="token operator">like</span> <span class="token string">'%农村工作中心站'</span> <span class="token operator">or</span> n<span class="token punctuation">.</span>orgname <span class="token operator">like</span> <span class="token string">'%村委会'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">and</span> pt<span class="token punctuation">.</span>displayname<span class="token operator">=</span><span class="token string">'村（社区）'</span> <span class="token keyword">then</span> <span class="token number">1</span>  <span class="token keyword">else</span> <span class="token number">0</span> <span class="token keyword">end</span> <span class="token keyword">as</span> communitynum_02<span class="token punctuation">,</span>
【重复<span class="token number">3</span>】	<span class="token keyword">case</span> <span class="token keyword">when</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>n<span class="token punctuation">.</span>orgname <span class="token operator">like</span> <span class="token string">'%村'</span> <span class="token operator">or</span> n<span class="token punctuation">.</span>orgname <span class="token operator">like</span> <span class="token string">'%村民委员会'</span> <span class="token operator">or</span> n<span class="token punctuation">.</span>orgname <span class="token operator">like</span> <span class="token string">'%农村工作中心站'</span> <span class="token operator">or</span> n<span class="token punctuation">.</span>orgname <span class="token operator">like</span> <span class="token string">'%村委会'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">and</span> pt<span class="token punctuation">.</span>displayname<span class="token operator">=</span><span class="token string">'村（社区）'</span> <span class="token keyword">then</span> <span class="token number">1</span>  <span class="token keyword">else</span> <span class="token number">0</span> <span class="token keyword">end</span> villagenum<span class="token punctuation">,</span>
			<span class="token keyword">case</span> <span class="token keyword">when</span> pt<span class="token punctuation">.</span>displayname<span class="token operator">=</span><span class="token string">'片组片格'</span><span class="token keyword">then</span> <span class="token number">1</span>  <span class="token keyword">else</span> <span class="token number">0</span> <span class="token keyword">end</span> gridnum
			<span class="token keyword">from</span>
			dc_f_organization n
			<span class="token keyword">left</span> <span class="token keyword">join</span> dc_d_property pt <span class="token keyword">on</span> n<span class="token punctuation">.</span>orglevel <span class="token operator">=</span> pt<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
			
			
		<span class="token comment">-- ############################	CUBE：节省的时间相当于预处理的时间。############################</span>
			<span class="token keyword">create</span> <span class="token keyword">table</span> dc_c_organization_02
			<span class="token keyword">as</span> <span class="token keyword">select</span>  
			yearmonth<span class="token punctuation">,</span>
			zzdate<span class="token punctuation">,</span>
			orgid<span class="token punctuation">,</span>
			<span class="token function">count</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> total<span class="token punctuation">,</span>
			<span class="token function">sum</span><span class="token punctuation">(</span>provincenum<span class="token punctuation">)</span> <span class="token keyword">as</span> provincenum<span class="token punctuation">,</span>
			<span class="token function">sum</span><span class="token punctuation">(</span>citynum<span class="token punctuation">)</span> <span class="token keyword">as</span> citynum<span class="token punctuation">,</span>
			<span class="token function">sum</span><span class="token punctuation">(</span>districtnum<span class="token punctuation">)</span> <span class="token keyword">as</span> districtnum<span class="token punctuation">,</span>
			<span class="token function">sum</span><span class="token punctuation">(</span>districtnum<span class="token punctuation">)</span><span class="token operator">-</span><span class="token function">sum</span><span class="token punctuation">(</span>old_districtnum<span class="token punctuation">)</span> <span class="token keyword">as</span> newdistrictnum<span class="token punctuation">,</span>
			<span class="token function">sum</span><span class="token punctuation">(</span>townnum<span class="token punctuation">)</span> townnum<span class="token punctuation">,</span>
			<span class="token function">sum</span><span class="token punctuation">(</span>streetnum<span class="token punctuation">)</span> streetnum<span class="token punctuation">,</span>
			<span class="token function">sum</span><span class="token punctuation">(</span>total_streetnum_01<span class="token punctuation">)</span><span class="token operator">-</span><span class="token function">sum</span><span class="token punctuation">(</span>townnum<span class="token punctuation">)</span><span class="token operator">-</span><span class="token function">sum</span><span class="token punctuation">(</span>streetnum<span class="token punctuation">)</span> othernum<span class="token punctuation">,</span>
			<span class="token function">sum</span><span class="token punctuation">(</span>communitynum_01<span class="token punctuation">)</span><span class="token operator">-</span><span class="token function">sum</span><span class="token punctuation">(</span>villagenum<span class="token punctuation">)</span> communitynum<span class="token punctuation">,</span>
			<span class="token function">sum</span><span class="token punctuation">(</span>villagenum<span class="token punctuation">)</span> villagenum<span class="token punctuation">,</span>
			<span class="token function">sum</span><span class="token punctuation">(</span>gridnum<span class="token punctuation">)</span> gridnum
			<span class="token keyword">from</span> temp_dc_c_organization <span class="token keyword">as</span> n
			<span class="token keyword">group</span> <span class="token keyword">by</span> yearmonth<span class="token punctuation">,</span> zzdate<span class="token punctuation">,</span> orgid <span class="token keyword">with</span> cube<span class="token punctuation">;</span>
			
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ff745f2d4a0a3088540c546a4acb2965/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">ZYNQ CAN总线之CAN ID过滤器分析</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a99369409ce66b09ccac333ae70516ba/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">VPN网关</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>