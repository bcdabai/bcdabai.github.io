<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>CAN位时序及相关参数解读 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="CAN位时序及相关参数解读" />
<meta property="og:description" content="相关概念
位速率（也叫做比特率）
表示的是单位时间内，总线上传输的信息量，即每秒能够传输的二进制位的数量，R=1/T ，单位是bit per second,bps。比如，比特率为8bit/s，意思为一秒传输了8bit，包含了8个二进制事件的信息量。
波特率(码元传输速率)
表示单位时间(1s)内传输的码元个数(脉冲个数或者信息变化次数)，码元可以是多进制的；kBaud(1baud=1bit/second, 1KBaud=1KB=1000bits/second)（码元：就是一个脉冲信号，一个脉冲信号有可能携带1bit数据，也有可能携带2、4bit）
Time Quantum 时间份额Tq CAN控制器工作的最小时间单位，通常对系统时钟分频得到。
位时间Tbit
CAN上传输一个数据位的时间周期Tbit=1/Baudrate. 如下图中的帧起始位。
位时序
根据CAN规范，每个位的时间内又可细分成4段：
同步段（SS，Synchronization Segment，SYSNC_SEG）一个位的输出从同步段开始。若总线的跳变沿被包含在SS段的范围之内，则表示节点与总线的时序同步。节点与总线同步时，采样点采集到的总线电平即可被确定为该电平的电位。SS段的大小为1Tq.
传播段（PTS，Propagation Time Segment, PROP_SEG）用于补偿信号在网络和节点传播的物理延时时间，是总线上输入比较器延时和输出驱动器延时总和的两倍。通常1-8Tq
相位缓冲段1（PBS1，Phase Buffer Segment 1, PHASE_SEG1）主要用于补偿边沿阶段的误差，其时间长度在重新同步时可以加长或缩短。初始大小1-8Tq.
相位缓冲段2（PBS2，Phase Buffer Segment 2,PHASE_SEG2）也是用于补偿边沿阶段的误差，其时间长度在重新同步时可以缩短。初始大小2-8Tq.
采样点:是读取总线电平，并将它解析为数值的时间点。位于相位缓冲段1（PHASE_SEG1）的终点。
tsp =（SYNC_SEG &#43; PROP_SEG &#43; PHASE_SEG1) / (SYNC_SEG &#43; PROP_SEG &#43; PHASE_SEG1 &#43; PHASE_SEG2)
如果位定时设置将采样点设置在位时间的末端，则传播段就会越长，能实现更远的网络。反之，则可提高重同步能力，对时钟误差的容忍能力越大。采样点的设置应使所有节点能够达到传播延迟和时钟误差的最佳折衷点。建议采样点设置应当靠近但是不超过0.875，这使传播延迟和时钟误差容忍达到最优
在CAN实现中，传播段（PROP_SEG）和相位缓冲段1（PHASE_SEG1）被统称为Time segment 1, 相位缓冲段2（PHASE_SEG2）被统称为Time segment 2.
重同步调整宽度(SJW, Resynchronization jump width)由于重同步的结果，相位缓冲段1（PHASE_SEG1）可被延长或者相位缓冲段2（PHASE_SEG2）可被缩短。这两个相位缓冲段的延长和缩短的总和上限由重同步跳转宽度给定.
一个位时间内包含多少个时间份额Tq,称为BTL Cycles。
CAN 总线定时寄存器
如果直接设置STM32的寄存器, 上面BRP、TS1、TS2和SJW的数值，全都需要减1后写入寄存器.
SAM的确定：低频时，选SAM＝1，即采样3次。高频100K以上时，取SAM＝0，即采样1次.
SJA1000 内部频率基准源F_BASE = Fclk／2，即外部晶振频率Fclk的2分频。注意任何应用中，当利用外部晶振作为基准源的时候，都是先经过2分频整形的." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/4f7039c9345e4e23b950a909b7f676ec/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-09-24T11:46:45+08:00" />
<meta property="article:modified_time" content="2022-09-24T11:46:45+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">CAN位时序及相关参数解读</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><strong>相关概念</strong></p> 
<p>位速率（也叫做比特率）</p> 
<p>表示的是单位时间内，总线上传输的信息量，即每秒能够传输的二进制位的数量，R=1/T ，单位是bit per second,bps。比如，比特率为8bit/s，意思为一秒传输了8bit，包含了8个二进制事件的信息量。</p> 
<p></p> 
<p>波特率(码元传输速率)</p> 
<p>表示单位时间(1s)内传输的码元个数(脉冲个数或者信息变化次数)，码元可以是多进制的；kBaud(1baud=1bit/second, 1KBaud=1KB=1000bits/second)（<strong>码元</strong>：就是一个脉冲信号，一个脉冲信号有可能携带1bit数据，也有可能携带2、4bit）</p> 
<p></p> 
<p>Time Quantum 时间份额Tq </p> 
<p>CAN控制器工作的最小时间单位，通常对系统时钟分频得到。</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/a4/b4/eIIP7o5t_o.png"></p> 
<p>位时间Tbit</p> 
<p>CAN上传输一个数据位的时间周期Tbit=1/Baudrate. 如下图中的帧起始位。</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/ac/b1/7IOXdlon_o.png"></p> 
<p></p> 
<p><strong>位时序</strong></p> 
<p>根据CAN规范，每个位的时间内又可细分成4段：</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/ef/33/nYS6vN3g_o.png"></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/f6/63/dERIHKAz_o.png"></p> 
<p>同步段（SS，Synchronization Segment，SYSNC_SEG）一个位的输出从同步段开始。若总线的跳变沿被包含在SS段的范围之内，则表示节点与总线的时序同步。节点与总线同步时，采样点采集到的总线电平即可被确定为该电平的电位。SS段的大小为1Tq.</p> 
<p>传播段（PTS，Propagation Time Segment, PROP_SEG）用于补偿信号在网络和节点传播的物理延时时间，是总线上输入比较器延时和输出驱动器延时总和的两倍。通常1-8Tq</p> 
<p>相位缓冲段1（PBS1，Phase Buffer Segment 1, PHASE_SEG1）主要用于补偿边沿阶段的误差，其时间长度在重新同步时可以加长或缩短。初始大小1-8Tq.</p> 
<p>相位缓冲段2（PBS2，Phase Buffer Segment 2,PHASE_SEG2）也是用于补偿边沿阶段的误差，其时间长度在重新同步时可以缩短。初始大小2-8Tq.</p> 
<p>采样点:是读取总线电平，并将它解析为数值的时间点。位于相位缓冲段1（PHASE_SEG1）的终点。</p> 
<p>tsp =（SYNC_SEG + PROP_SEG + PHASE_SEG1) / (SYNC_SEG + PROP_SEG + PHASE_SEG1 + PHASE_SEG2)</p> 
<p>如果位定时设置将采样点设置在位时间的末端，则传播段就会越长，能实现更远的网络。反之，则可提高重同步能力，对时钟误差的容忍能力越大。采样点的设置应使所有节点能够达到传播延迟和时钟误差的最佳折衷点。建议采样点设置应当靠近但是不超过0.875，这使传播延迟和时钟误差容忍达到最优</p> 
<p>在CAN实现中，传播段（PROP_SEG）和相位缓冲段1（PHASE_SEG1）被统称为Time segment 1, 相位缓冲段2（PHASE_SEG2）被统称为Time segment 2.</p> 
<p>重同步调整宽度(SJW, Resynchronization jump width)由于重同步的结果，相位缓冲段1（PHASE_SEG1）可被延长或者相位缓冲段2（PHASE_SEG2）可被缩短。这两个相位缓冲段的延长和缩短的总和上限由重同步跳转宽度给定.</p> 
<p>一个位时间内包含多少个时间份额Tq,称为BTL Cycles。</p> 
<p></p> 
<p><strong>CAN 总线定时寄存器</strong></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/f4/ac/BEQdCMih_o.png"></p> 
<p>如果直接设置STM32的寄存器, 上面BRP、TS1、TS2和SJW的数值，全都需要减1后写入寄存器.</p> 
<p>SAM的确定：低频时，选SAM＝1，即采样3次。高频100K以上时，取SAM＝0，即采样1次.</p> 
<p>SJA1000 内部频率基准源F_BASE = Fclk／2，即外部晶振频率Fclk的2分频。注意任何应用中，当利用外部晶振作为基准源的时候，都是先经过2分频整形的.</p> 
<p></p> 
<p>如下图，通过BTR0, BTR1两个寄存器的值，就确定了同步段、传播段，相位缓冲段1/2的大小，同时也定义出了Sampling Point.</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/29/ee/6V2yITjn_o.png"></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9c775bba6cb393514c24ea15b659899f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">pythonocc-core报错：SetPixelFormat failed. Error code: 2000 raised from method Init of class Display3d</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4967304edf7d260fd577ae1c4223890c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Matlab-learn(9):sort,函数句柄</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>