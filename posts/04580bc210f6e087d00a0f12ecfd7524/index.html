<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>cygwin nginx php,Cygwin 下编译 Nginx - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="cygwin nginx php,Cygwin 下编译 Nginx" />
<meta property="og:description" content="首先安装以下库：
// 貌似一起安装 apt-cyg 不能识别，得一个一个得安装，有些库貌似没找到
// apt-cyg install
openssl
pcre
zlib
automake
bison
curl-devel
flex
libiconv
libmcrypt-devel
libtool
libxml2
libxml2-devel
patchutils
pcre-devel
jpeg
libmcrypt
配置
./configure --with-http_ssl_module --without-mail_pop3_module --without-mail_imap_module --without-mail_smtp_module
报错：
./configure: error: can not detect int size
cat: objs/autotest.c: No such file or directory
搜索解决方法：
去掉CPU优化编译选项：–with-cpu-opt=pentium
无效，本来就没有加。。。
再次搜索，得到
原因分析：
configure通过运行测试程序来获得“int、long、longlong”等数据类型的大小，由于交叉编译器所编译出的程序无法在编译主机上运行而产生错误。
解决办法：
可以通过修改configure文件来手动指定各数据类型的大小，但会非常麻烦。
这里，由于编译主机与目标平台均为32位系统，故可以用 gcc 替代 mips-openwrt-linux-gcc 来进行数据类型大小的测试
(注意：不同的编译环境可能编译器有点不同)
编辑auto/types/sizeof文件，大概36行的位置( $CC 改为 gcc )
ngx_test=&#34;$CC $CC_TEST_FLAGS $CC_AUX_FLAGS
改为
ngx_test=&#34;gcc $CC_TEST_FLAGS $CC_AUX_FLAGS" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/04580bc210f6e087d00a0f12ecfd7524/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-03-16T21:47:16+08:00" />
<meta property="article:modified_time" content="2021-03-16T21:47:16+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">cygwin nginx php,Cygwin 下编译 Nginx</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div style="font-size:16px;"> 
 <p>首先安装以下库：</p> 
 <p>// 貌似一起安装 apt-cyg 不能识别，得一个一个得安装，有些库貌似没找到</p> 
 <p>// apt-cyg install</p> 
 <p>openssl</p> 
 <p>pcre</p> 
 <p>zlib</p> 
 <p>automake</p> 
 <p>bison</p> 
 <p>curl-devel</p> 
 <p>flex</p> 
 <p>libiconv</p> 
 <p>libmcrypt-devel</p> 
 <p>libtool</p> 
 <p>libxml2</p> 
 <p>libxml2-devel</p> 
 <p>patchutils</p> 
 <p>pcre-devel</p> 
 <p>jpeg</p> 
 <p>libmcrypt</p> 
 <p>配置</p> 
 <p>./configure --with-http_ssl_module --without-mail_pop3_module --without-mail_imap_module --without-mail_smtp_module</p> 
 <p>报错：</p> 
 <p>./configure: error: can not detect int size</p> 
 <p>cat: objs/autotest.c: No such file or directory</p> 
 <p>搜索解决方法：</p> 
 <p>去掉CPU优化编译选项：–with-cpu-opt=pentium</p> 
 <p>无效，本来就没有加。。。</p> 
 <p>再次搜索，得到</p> 
 <p>原因分析：</p> 
 <p>configure通过运行测试程序来获得“int、long、longlong”等数据类型的大小，由于交叉编译器所编译出的程序无法在编译主机上运行而产生错误。</p> 
 <p>解决办法：</p> 
 <p>可以通过修改configure文件来手动指定各数据类型的大小，但会非常麻烦。</p> 
 <p>这里，由于编译主机与目标平台均为32位系统，故可以用 gcc 替代 mips-openwrt-linux-gcc 来进行数据类型大小的测试</p> 
 <p>(注意：不同的编译环境可能编译器有点不同)</p> 
 <p>编辑auto/types/sizeof文件，大概36行的位置( $CC 改为 gcc )</p> 
 <p>ngx_test="$CC $CC_TEST_FLAGS $CC_AUX_FLAGS</p> 
 <p>改为</p> 
 <p>ngx_test="gcc $CC_TEST_FLAGS $CC_AUX_FLAGS</p> 
 <p>修改后测试错误仍然存在，上述修改无效。</p> 
 <p>又找了一些方案：</p> 
 <p>增加参数跳过错误：</p> 
 <p>--with-ld-opt="-lstdc++" --with-cpp_test_module</p> 
 <p>仍然无效，估计是 nginx 版本太高(用的是 GitHub 上最新的)，降低版本试试。</p> 
 <p>尝试1.2.4版本。</p> 
 <p>这时发现有些重要的库没有安装(因为不是 C 出身，对编译几乎一窍不通)，偷偷地安装了下：</p> 
 <p>apt-cyg install gcc-g++</p> 
 <p>1.2.4 版本有一些友好的提示，在提示下安装了以下库：</p> 
 <p>apt-cyg install libpcre-devel</p> 
 <p>apt-cyg install openssl-devel</p> 
 <p>再次 configure，显示</p> 
 <p>Configuration summary</p> 
 <p>+ using system PCRE library</p> 
 <p>+ using system OpenSSL library</p> 
 <p>+ md5: using OpenSSL library</p> 
 <p>+ sha1: using OpenSSL library</p> 
 <p>+ using system zlib library</p> 
 <p>nginx path prefix: "/usr/local/nginx"</p> 
 <p>nginx binary file: "/usr/local/nginx/sbin/nginx"</p> 
 <p>nginx configuration prefix: "/usr/local/nginx/conf"</p> 
 <p>nginx configuration file: "/usr/local/nginx/conf/nginx.conf"</p> 
 <p>nginx pid file: "/usr/local/nginx/logs/nginx.pid"</p> 
 <p>nginx error log file: "/usr/local/nginx/logs/error.log"</p> 
 <p>nginx http access log file: "/usr/local/nginx/logs/access.log"</p> 
 <p>nginx http client request body temporary files: "client_body_temp"</p> 
 <p>nginx http proxy temporary files: "proxy_temp"</p> 
 <p>nginx http fastcgi temporary files: "fastcgi_temp"</p> 
 <p>nginx http uwsgi temporary files: "uwsgi_temp"</p> 
 <p>nginx http scgi temporary files: "scgi_temp"</p> 
 <p>通过。</p> 
 <p>下面 make，最终提示：</p> 
 <p>objs/ngx_modules.o \</p> 
 <p>-lcrypt -lpcre -lssl -lcrypto -lz</p> 
 <p>make[1]: Leaving directory '/home/Tony/source/nginx-1.2.4'</p> 
 <p>make -f objs/Makefile manpage</p> 
 <p>make[1]: Entering directory '/home/Tony/source/nginx-1.2.4'</p> 
 <p>sed -e "s|%%PREFIX%%|/usr/local/nginx|" \</p> 
 <p>-e "s|%%PID_PATH%%|/usr/local/nginx/logs/nginx.pid|" \</p> 
 <p>-e "s|%%CONF_PATH%%|/usr/local/nginx/conf/nginx.conf|" \</p> 
 <p>-e "s|%%ERROR_LOG_PATH%%|/usr/local/nginx/logs/error.log|" \</p> 
 <p>&lt; man/nginx.8 &gt; objs/nginx.8</p> 
 <p>make[1]: Leaving directory '/home/Tony/source/nginx-1.2.4'</p> 
 <p>貌似应该是成功了。</p> 
 <p>最后 make install，提示：</p> 
 <p>Tony@TPX240 ~/source/nginx-1.2.4</p> 
 <p>$ make install</p> 
 <p>make -f objs/Makefile install</p> 
 <p>make[1]: Entering directory '/home/Tony/source/nginx-1.2.4'</p> 
 <p>test -d '/usr/local/nginx' || mkdir -p '/usr/local/nginx'</p> 
 <p>test -d '/usr/local/nginx/sbin' || mkdir -p '/usr/local/nginx/sbin'</p> 
 <p>test ! -f '/usr/local/nginx/sbin/nginx' || mv '/usr/local/nginx/sbin/nginx' '/usr/local/nginx/sbin/nginx.old'</p> 
 <p>cp objs/nginx '/usr/local/nginx/sbin/nginx'</p> 
 <p>test -d '/usr/local/nginx/conf' || mkdir -p '/usr/local/nginx/conf'</p> 
 <p>cp conf/koi-win '/usr/local/nginx/conf'</p> 
 <p>cp conf/koi-utf '/usr/local/nginx/conf'</p> 
 <p>cp conf/win-utf '/usr/local/nginx/conf'</p> 
 <p>test -f '/usr/local/nginx/conf/mime.types' || cp conf/mime.types '/usr/local/nginx/conf'</p> 
 <p>cp conf/mime.types '/usr/local/nginx/conf/mime.types.default'</p> 
 <p>test -f '/usr/local/nginx/conf/fastcgi_params' || cp conf/fastcgi_params '/usr/local/nginx/conf'</p> 
 <p>cp conf/fastcgi_params '/usr/local/nginx/conf/fastcgi_params.default'</p> 
 <p>test -f '/usr/local/nginx/conf/fastcgi.conf' || cp conf/fastcgi.conf '/usr/local/nginx/conf'</p> 
 <p>cp conf/fastcgi.conf '/usr/local/nginx/conf/fastcgi.conf.default'</p> 
 <p>test -f '/usr/local/nginx/conf/uwsgi_params' || cp conf/uwsgi_params '/usr/local/nginx/conf'</p> 
 <p>cp conf/uwsgi_params '/usr/local/nginx/conf/uwsgi_params.default'</p> 
 <p>test -f '/usr/local/nginx/conf/scgi_params' || cp conf/scgi_params '/usr/local/nginx/conf'</p> 
 <p>cp conf/scgi_params '/usr/local/nginx/conf/scgi_params.default'</p> 
 <p>test -f '/usr/local/nginx/conf/nginx.conf' || cp conf/nginx.conf '/usr/local/nginx/conf/nginx.conf'</p> 
 <p>cp conf/nginx.conf '/usr/local/nginx/conf/nginx.conf.default'</p> 
 <p>test -d '/usr/local/nginx/logs' || mkdir -p '/usr/local/nginx/logs'</p> 
 <p>test -d '/usr/local/nginx/logs' || mkdir -p '/usr/local/nginx/logs'</p> 
 <p>test -d '/usr/local/nginx/html' || cp -R html '/usr/local/nginx'</p> 
 <p>test -d '/usr/local/nginx/logs' || mkdir -p '/usr/local/nginx/logs'</p> 
 <p>make[1]: Leaving directory '/home/Tony/source/nginx-1.2.4'</p> 
 <p>因为我 Win 本地也配置了 Nginx，所以用 whereis 命令查看 Nginx 的时候出现以下情况：</p> 
 <p>Tony@TPX240 ~/source/nginx-1.2.4</p> 
 <p>$ whereis nginx</p> 
 <p>nginx: /usr/local/nginx /cygdrive/c/dev/nginx.bat /cygdrive/c/dev/nginx-1.2.3/nginx.exe</p> 
 <p>nginx -v 出来的版本号也是 1.2.3 (Win 本地的版本号)</p> 
 <p>但写全路径就可以看到 1.2.4，说明安装成功，下面看下能不能跑。</p> 
 <p>$ /usr/local/nginx/sbin/nginx.exe -v</p> 
 <p>nginx version: nginx/1.2.4</p> 
 <p>看到一个参数比较全的配置：</p> 
 <p>./configure --prefix=/cygdrive/d/nginx --sbin-path=/cygdrive/d/nginx --with-cc-opt="-D FD_SETSIZE=4096" --with-rtsig_module --with-select_module --with-poll_module --with-http_ssl_module --with-http_realip_module --with-http_addition_module --with-http_xslt_module --with-http_sub_module --with-http_dav_module --with-http_flv_module --with-http_gzip_static_module --with-http_random_index_module --with-http_secure_link_module --with-http_stub_status_module --with-mail --with-cpp_test_module--with-mail_ssl_module</p> 
 <p>make &amp;&amp; make install</p> 
 <p>运行 nginx，出现错误：</p> 
 <p>$ /usr/local/nginx/sbin/nginx.exe</p> 
 <p>nginx: [emerg] the maximum number of files supported by select() is 64</p> 
 <p>表示FD_SETSIZE的值比nginx配置文件中worker_connections指令所指定的值，你可以把 nginx.conf 里的 worker_connections 选项改小一些，比如44,加了 --with-cc-opt="-D FD_SETSIZE=4096" 后就不会碰到这问题</p> 
 <p>我的 nginx.conf 文件在 /usr/local/nginx/conf/nginx.conf</p> 
 <p>改为 64后，nginx 正常启动。</p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/fdfc01d7e20e7573d0f882dac88a3cc6/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">redis高可用之RedisCluster</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f3b4ab6b11bdaa4adf445ccd95ac2f8b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Games101 计算机图形学课程笔记：Lecture 20 Color and Perception</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>