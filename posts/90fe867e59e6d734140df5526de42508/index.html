<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Hadoop大数据——用户行为分析Hive数据分析 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Hadoop大数据——用户行为分析Hive数据分析" />
<meta property="og:description" content="1.本地数据集上传到数据仓库Hive 1.1命令 sudo mkdir -R /usr/local/bigdatacase/dataset //这里会提示你输入当前用户（本教程是hadoop用户名）的密码 //下面给hadoop用户赋予针对bigdatacase目录的各种操作权限 cd /usr/local/ sudo chown -R hadoop:hadoop ./bigdatacase cd bigdatacase //下面就可以解压缩user.zip文件 cd ~ //表示进入hadoop用户的目录 cd 下载 ls unzip user.zip -d /usr/local/bigdatacase/dataset cd /usr/local/bigdatacase/dataset ls head -5 raw_user.csv 1.2数据集进行预处理 1.2.1删除首行 cd /usr/local/bigdatacase/dataset //下面删除raw_user中的第1行 //1d表示删除第1行，同理，3d表示删除第3行，nd表示删除第n行 sed -i &#39;1d&#39; raw_user.csv //下面删除small_user中的第1行 sed -i &#39;1d&#39; small_user.csv //下面再用head命令去查看文件的前5行记录，就看不到字段名称这一行了 head -5 raw_user.csv head -5 small_user.csv 1.2.2 添加字段 添加随机省份字段
1.3 导入HDFS中 略
1.4 Hive创建数据库 //这个为小数据集，下面的为大数据集 hive&gt; create database dblab; hive&gt; create database dblab_big; //创建表并映射入HDFS中的文件 hive&gt; CREATE EXTERNAL TABLE dblab." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/90fe867e59e6d734140df5526de42508/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-12-31T08:01:22+08:00" />
<meta property="article:modified_time" content="2020-12-31T08:01:22+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Hadoop大数据——用户行为分析Hive数据分析</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="1Hive_0"></a>1.本地数据集上传到数据仓库Hive</h2> 
<h3><a id="11_2"></a>1.1命令</h3> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">mkdir</span> -R /usr/local/bigdatacase/dataset 
//这里会提示你输入当前用户（本教程是hadoop用户名）的密码  
//下面给hadoop用户赋予针对bigdatacase目录的各种操作权限  
<span class="token function">cd</span> /usr/local/
<span class="token function">sudo</span> <span class="token function">chown</span> -R hadoop:hadoop ./bigdatacase  
<span class="token function">cd</span> bigdatacase  

//下面就可以解压缩user.zip文件  
<span class="token function">cd</span> ~  //表示进入hadoop用户的目录  
<span class="token function">cd</span> 下载  
<span class="token function">ls</span>  
unzip user.zip -d /usr/local/bigdatacase/dataset  
<span class="token function">cd</span> /usr/local/bigdatacase/dataset  
<span class="token function">ls</span>  
<span class="token function">head</span> -5 raw_user.csv
</code></pre> 
<h3><a id="12_22"></a>1.2数据集进行预处理</h3> 
<h4><a id="121_23"></a>1.2.1删除首行</h4> 
<pre><code class="prism language-bash"><span class="token function">cd</span> /usr/local/bigdatacase/dataset  
//下面删除raw_user中的第1行  
//1d表示删除第1行，同理，3d表示删除第3行，nd表示删除第n行
<span class="token function">sed</span> -i <span class="token string">'1d'</span> raw_user.csv   
//下面删除small_user中的第1行  
<span class="token function">sed</span> -i <span class="token string">'1d'</span> small_user.csv  
//下面再用head命令去查看文件的前5行记录，就看不到字段名称这一行了  
<span class="token function">head</span> -5 raw_user.csv  
<span class="token function">head</span> -5 small_user.csv  
</code></pre> 
<h4><a id="122__36"></a>1.2.2 添加字段</h4> 
<p>添加随机省份字段</p> 
<h3><a id="13_HDFS_39"></a>1.3 导入HDFS中</h3> 
<p>略</p> 
<h3><a id="14_Hive_42"></a>1.4 Hive创建数据库</h3> 
<pre><code class="prism language-bash">//这个为小数据集，下面的为大数据集
hive<span class="token operator">&gt;</span>  create database dblab<span class="token punctuation">;</span>
hive<span class="token operator">&gt;</span>  create database dblab_big<span class="token punctuation">;</span>
//创建表并映射入HDFS中的文件
hive<span class="token operator">&gt;</span>  CREATE EXTERNAL TABLE dblab.bigdata_user<span class="token punctuation">(</span>id INT,uid STRING,item_id STRING,behavior_type INT,item_category STRING,visit_date DATE,province STRING<span class="token punctuation">)</span> COMMENT <span class="token string">'Welcome to xmu dblab!'</span> ROW FORMAT DELIMITED FIELDS TERMINATED BY <span class="token string">'\t'</span> STORED AS TEXTFILE LOCATION <span class="token string">'/bigdatacase/dataset'</span><span class="token punctuation">;</span> 

</code></pre> 
<p>到目前为止就完成了数据的预处理，添加省份，创建Hive数据库，上传到HDFS，并且映射到Hive里面</p> 
<h2><a id="2Hive_55"></a>2.Hive数据分析语句</h2> 
<p>Hive数据分析就是写SQL语句对刚刚映射的表进行查询、筛选、统计等等一系列操作。</p> 
<h3><a id="21__58"></a>2.1 查看表的属性</h3> 
<table><thead><tr><th></th><th>uid</th><th>item_id</th><th>behavior_type</th><th>item_category</th><th>visit_date</th><th>province</th></tr></thead><tbody><tr><td>1</td><td>用户ID</td><td>商品ID</td><td>用户行为</td><td>商品分类</td><td>产生时间</td><td>用户地理位置</td></tr></tbody></table> 
<table><thead><tr><th></th><th>uid</th><th>item_id</th><th>behavior_type</th><th>item_category</th><th>visit_date</th><th>province</th></tr></thead><tbody><tr><td>1</td><td>10001082</td><td>285259775</td><td>1</td><td>4076</td><td>2014-12-08</td><td>广东</td></tr><tr><td>2</td><td>10001082</td><td>4368907</td><td>1</td><td>5503</td><td>2014-12-08</td><td>湖南</td></tr><tr><td>3</td><td>10001082</td><td>285259788</td><td>4</td><td>4076</td><td>2014-12-08</td><td>北京</td></tr></tbody></table> 
<p>behaviour_type属性1234代表的意思</p> 
<table><thead><tr><th></th><th>1</th><th>2</th><th>3</th><th>4</th></tr></thead><tbody><tr><td>1</td><td>浏览</td><td>收藏</td><td>加购物车</td><td>购买</td></tr></tbody></table> 
<h3><a id="22_SQL_74"></a>2.2 SQL语句</h3> 
<h4><a id="221_2014121112_75"></a>2.2.1 2014-12-11~12号有多少条购买商品的记录</h4> 
<pre><code class="prism language-bash">//首先查询表中的数据
<span class="token keyword">select</span> * from bigdata_user limit 10<span class="token punctuation">;</span>

//然后查询10号之后
<span class="token keyword">select</span> * from bigdata_user where visit_date <span class="token operator">&gt;</span><span class="token string">'2014-12-10'</span> limit 10<span class="token punctuation">;</span>

//再添加限制 13号之前
<span class="token keyword">select</span> * from bigdata_user where visit_date <span class="token operator">&gt;</span><span class="token string">'2014-12-10'</span> and visit_date <span class="token operator">&lt;</span><span class="token string">'2014-12-13'</span> limit 10<span class="token punctuation">;</span>

//购买行为
<span class="token keyword">select</span> * from bigdata_user where visit_date <span class="token operator">&gt;</span><span class="token string">'2014-12-10'</span> and visit_date <span class="token operator">&lt;</span><span class="token string">'2014-12-13'</span> and behavior_type<span class="token operator">=</span><span class="token string">'4'</span>  limit 10<span class="token punctuation">;</span>

</code></pre> 
<h4><a id="222_131_92"></a>2.2.2 分析每月1-31号购买情况</h4> 
<p><mark>按购买日期统计用户的购买商品记录数、用户数</mark></p> 
<pre><code class="prism language-bash">//首先搜索出所有信息
<span class="token keyword">select</span> * from bigdata_user limit 10<span class="token punctuation">;</span>  
  
//行为日期,搜索出日期  
<span class="token keyword">select</span> * from bigdata_user limit 10<span class="token punctuation">;</span>  
<span class="token keyword">select</span> day<span class="token punctuation">(</span>visit_date<span class="token punctuation">)</span> from bigdata_user limit 10<span class="token punctuation">;</span>  
  
//购买行为的记录数、不同用户数  
<span class="token keyword">select</span> count<span class="token punctuation">(</span>*<span class="token punctuation">)</span> from bigdata_user where behavior_type<span class="token operator">=</span><span class="token string">'4'</span><span class="token punctuation">;</span>  
<span class="token keyword">select</span> count<span class="token punctuation">(</span>distinct uid<span class="token punctuation">)</span> from bigdata_user where behavior_type<span class="token operator">=</span><span class="token string">'4'</span><span class="token punctuation">;</span>  
  
//按日期统计记录数、用户数  
<span class="token keyword">select</span> count<span class="token punctuation">(</span>*<span class="token punctuation">)</span>,day<span class="token punctuation">(</span>visit_date<span class="token punctuation">)</span> from bigdata_user where behavior_type<span class="token operator">=</span><span class="token string">'4'</span> group by day<span class="token punctuation">(</span>visit_date<span class="token punctuation">)</span> limit 10<span class="token punctuation">;</span>  
<span class="token keyword">select</span> count<span class="token punctuation">(</span>distinct uid<span class="token punctuation">)</span>,day<span class="token punctuation">(</span>visit_date<span class="token punctuation">)</span> from bigdata_user where behavior_type<span class="token operator">=</span><span class="token string">'4'</span> group by day<span class="token punctuation">(</span>visit_date<span class="token punctuation">)</span> limit 10<span class="token punctuation">;</span>  
  
//保存为表格  
create table day_count as <span class="token keyword">select</span> count<span class="token punctuation">(</span>*<span class="token punctuation">)</span>,day<span class="token punctuation">(</span>visit_date<span class="token punctuation">)</span> from bigdata_user where behavior_type<span class="token operator">=</span><span class="token string">'4'</span> group by day<span class="token punctuation">(</span>visit_date<span class="token punctuation">)</span><span class="token punctuation">;</span>   
create table day_uid as <span class="token keyword">select</span> count<span class="token punctuation">(</span>distinct uid<span class="token punctuation">)</span>,day<span class="token punctuation">(</span>visit_date<span class="token punctuation">)</span> from bigdata_user where behavior_type<span class="token operator">=</span><span class="token string">'4'</span> group by day<span class="token punctuation">(</span>visit_date<span class="token punctuation">)</span><span class="token punctuation">;</span>


</code></pre> 
<h4><a id="223__119"></a>2.2.3 找到一天购买很多商品的用户</h4> 
<p><mark>查询某一天在该网站的购买 4项以上商品的用户id</mark></p> 
<pre><code class="prism language-bash">//12号+购买行为  
<span class="token keyword">select</span> * from bigdata_user where behavior_type<span class="token operator">=</span><span class="token string">'4'</span>and visit_date<span class="token operator">=</span><span class="token string">'2014-12-12'</span> limit 10<span class="token punctuation">;</span>  
  
//按用户编号分组  
<span class="token keyword">select</span> uid from bigdata_user where behavior_type<span class="token operator">=</span><span class="token string">'4'</span>and visit_date<span class="token operator">=</span><span class="token string">'2014-12-12'</span> group by uid limit 10<span class="token punctuation">;</span>  
  
//按用户分组统计  
<span class="token keyword">select</span> uid,count<span class="token punctuation">(</span>*<span class="token punctuation">)</span> from bigdata_user where behavior_type<span class="token operator">=</span><span class="token string">'4'</span>and visit_date<span class="token operator">=</span><span class="token string">'2014-12-12'</span> group by uid limit 10<span class="token punctuation">;</span>  
  
//12号，购买，4项以上  
<span class="token keyword">select</span> uid,count<span class="token punctuation">(</span>*<span class="token punctuation">)</span> from bigdata_user where behavior_type<span class="token operator">=</span><span class="token string">'4'</span>and visit_date<span class="token operator">=</span><span class="token string">'2014-12-12'</span> group by uid having count<span class="token punctuation">(</span>*<span class="token punctuation">)</span><span class="token operator">&gt;</span>4 limit 10<span class="token punctuation">;</span>  
<span class="token keyword">select</span> uid,count<span class="token punctuation">(</span>*<span class="token punctuation">)</span> from bigdata_user where behavior_type<span class="token operator">=</span><span class="token string">'4'</span>and visit_date<span class="token operator">=</span><span class="token string">'2014-12-12'</span> group by uid having count<span class="token punctuation">(</span>behavior_type<span class="token operator">=</span><span class="token string">'4'</span><span class="token punctuation">)</span><span class="token operator">&gt;</span>4 limit 10<span class="token punctuation">;</span>  


</code></pre> 
<h4><a id="224__139"></a>2.2.4 查询商品的购买数量和购买用户的数量，排序购买数量</h4> 
<p><mark>查询出每个商品的购买次数 和购买人数</mark></p> 
<pre><code class="prism language-bash">//查询所有购买商品集合
<span class="token keyword">select</span> * from bigdata_user where behavior_type<span class="token operator">=</span><span class="token string">'4'</span> limit 10<span class="token punctuation">;</span>

//查询每个商品的购买次数
<span class="token keyword">select</span> item_id,count<span class="token punctuation">(</span>1<span class="token punctuation">)</span> buy_number  from bigdata_user where behavior_type<span class="token operator">=</span><span class="token string">'4'</span> group by item_id  order by buy_number desc  limit 10<span class="token punctuation">;</span>


//查询每个商品购买的用户数量
<span class="token keyword">select</span> item_id,count<span class="token punctuation">(</span>distinct uid<span class="token punctuation">)</span> user_number from bigdata_user where behavior_type<span class="token operator">=</span><span class="token string">'4'</span> group by item_id  order by user_number desc  limit 10<span class="token punctuation">;</span>


//查询每个商品购买的总数量和购买的用户数量
<span class="token keyword">select</span> item_id,count<span class="token punctuation">(</span>1<span class="token punctuation">)</span> buy_number,count<span class="token punctuation">(</span>distinct uid<span class="token punctuation">)</span> user_number  from bigdata_user where behavior_type<span class="token operator">=</span><span class="token string">'4'</span> group by item_id  order by buy_number desc  limit 10<span class="token punctuation">;</span>


</code></pre> 
<h4><a id="225__161"></a>2.2.5 查询广东每日的商品购买率（购买量/浏览量）</h4> 
<pre><code class="prism language-bash">//广东每日浏览商品数
<span class="token keyword">select</span> visit_date, count<span class="token punctuation">(</span>*<span class="token punctuation">)</span> browse_number from bigdata_user where province<span class="token operator">=</span><span class="token string">'广东'</span> and behavior_type<span class="token operator">=</span><span class="token string">'1'</span>  group by visit_date order by browse_number desc <span class="token punctuation">;</span>

//广东每日购买览商品数
<span class="token keyword">select</span>  visit_date, count<span class="token punctuation">(</span>*<span class="token punctuation">)</span> buy_number from bigdata_user where province<span class="token operator">=</span><span class="token string">'广东'</span> and behavior_type<span class="token operator">=</span><span class="token string">'4'</span>  group by visit_date order by buy_number desc <span class="token punctuation">;</span>

//为以上两个创建单独的表出来
//创建表，每日用户浏览数量
create table browse_user as <span class="token keyword">select</span>  visit_date, count<span class="token punctuation">(</span>*<span class="token punctuation">)</span> browse_number from bigdata_user where province<span class="token operator">=</span><span class="token string">'广东'</span> and behavior_type<span class="token operator">=</span><span class="token string">'1'</span>  group by visit_date order by browse_number desc <span class="token punctuation">;</span>

//创建表，每日用户购买数量
create table buy_user as <span class="token keyword">select</span>  visit_date, count<span class="token punctuation">(</span>*<span class="token punctuation">)</span> buy_number from bigdata_user where province<span class="token operator">=</span><span class="token string">'广东'</span> and behavior_type<span class="token operator">=</span><span class="token string">'4'</span>  group by visit_date order by buy_number desc <span class="token punctuation">;</span>

//每日浏览购买成功率
//通过左联查询出每日的浏览量和购买量，并且算出每日购买率
<span class="token keyword">select</span> browse_user.visit_date, browse_number,buy_number,buy_number/browse_number buy_rate from browse_user  left <span class="token function">join</span> buy_user  on browse_user.visit_date<span class="token operator">=</span>buy_user.visit_date<span class="token punctuation">;</span>


</code></pre> 
<h4><a id="22620191111_184"></a>2.2.6查询2019-11-11每个省的浏览数量，购买数量和比例</h4> 
<pre><code class="prism language-bash">//查询2019-12-12每个省的浏览数量，购买数量和比例

//a查询2014-12-12每个省的浏览数量
<span class="token keyword">select</span> province,count<span class="token punctuation">(</span>1<span class="token punctuation">)</span> browse_number from bigdata_user where visit_date<span class="token operator">=</span><span class="token string">'2014-12-12'</span> and behavior_type<span class="token operator">=</span><span class="token string">'1'</span> group by province order by browse_number desc<span class="token punctuation">;</span>

//b查询2014-12-12每个省的购买数量
<span class="token keyword">select</span> province,count<span class="token punctuation">(</span>1<span class="token punctuation">)</span> buy_number from bigdata_user where visit_date<span class="token operator">=</span><span class="token string">'2014-12-12'</span> and behavior_type<span class="token operator">=</span><span class="token string">'4'</span> group by province order by buy_number desc<span class="token punctuation">;</span>

//以下语句太长格式为
<span class="token keyword">select</span> a.province,a.browse_number,b.buy_number,两个相除 from <span class="token punctuation">(</span>表格a<span class="token punctuation">)</span> a 
left <span class="token function">join</span> <span class="token punctuation">(</span>表格b<span class="token punctuation">)</span> b on a.province<span class="token operator">=</span>b.province<span class="token punctuation">;</span>


//一条语句
//直接显示每个省浏览数量、购买数量、购买率
<span class="token keyword">select</span> a.province,a.browse_number,b.buy_number,b.buy_number/a.browse_number rate from  <span class="token punctuation">(</span> <span class="token keyword">select</span> province,count<span class="token punctuation">(</span>1<span class="token punctuation">)</span> browse_number from bigdata_user where visit_date<span class="token operator">=</span><span class="token string">'2014-12-12'</span> and behavior_type<span class="token operator">=</span><span class="token string">'1'</span> group by province order by browse_number desc<span class="token punctuation">)</span> a left <span class="token function">join</span> <span class="token punctuation">(</span> <span class="token keyword">select</span> province,count<span class="token punctuation">(</span>1<span class="token punctuation">)</span> buy_number from bigdata_user where visit_date<span class="token operator">=</span><span class="token string">'2014-12-12'</span> and behavior_type<span class="token operator">=</span><span class="token string">'4'</span> group by province order by buy_number desc <span class="token punctuation">)</span> b on a.province<span class="token operator">=</span>b.province<span class="token punctuation">;</span>


</code></pre> 
<h4><a id="2271000108220141212_208"></a>2.2.7用户10001082在2014-12-12号当天活跃度：该用户点击行为占该天所有点击行为的比例</h4> 
<pre><code class="prism language-bash">//该天所有点击行为数量
<span class="token keyword">select</span> count<span class="token punctuation">(</span>*<span class="token punctuation">)</span> <span class="token function">users</span> from bigdata_user where visit_date<span class="token operator">=</span><span class="token string">'2014-12-12'</span> and behavior_type<span class="token operator">=</span><span class="token string">'1'</span><span class="token punctuation">;</span>

//该用户的点击量
<span class="token keyword">select</span> count<span class="token punctuation">(</span>*<span class="token punctuation">)</span> user_number from bigdata_user where visit_date<span class="token operator">=</span><span class="token string">'2014-12-12'</span> and behavior_type<span class="token operator">=</span><span class="token string">'1'</span> and uid<span class="token operator">=</span>10001082<span class="token punctuation">;</span>

//结合上面两个语句，显示用户点击量、当天点击量和比例
<span class="token keyword">select</span> <span class="token string">'10001082'</span> uid,a.users,b.user_number,b.user_number/a.users rate from <span class="token punctuation">(</span> <span class="token keyword">select</span> count<span class="token punctuation">(</span>*<span class="token punctuation">)</span> <span class="token function">users</span> from bigdata_user where visit_date<span class="token operator">=</span><span class="token string">'2014-12-12'</span> and behavior_type<span class="token operator">=</span><span class="token string">'1'</span> <span class="token punctuation">)</span> a ,<span class="token punctuation">(</span> <span class="token keyword">select</span> count<span class="token punctuation">(</span>*<span class="token punctuation">)</span> user_number  from bigdata_user where visit_date<span class="token operator">=</span><span class="token string">'2014-12-12'</span> and behavior_type<span class="token operator">=</span><span class="token string">'1'</span> and uid<span class="token operator">=</span>10001082  <span class="token punctuation">)</span> b<span class="token punctuation">;</span>



</code></pre> 
<h4><a id="228_224"></a>2.2.8查询出用户最喜欢的商品集（收藏）</h4> 
<pre><code class="prism language-bash">//查询出用户最喜欢的商品集
<span class="token keyword">select</span> item_id,count<span class="token punctuation">(</span>1<span class="token punctuation">)</span> collect from bigdata_user where behavior_type<span class="token operator">=</span><span class="token string">'2'</span>  group by item_id order by collect desc limit 20 <span class="token punctuation">;</span>

</code></pre> 
<h4><a id="229_232"></a>2.2.9某个地区的用户当天浏览网站的次数</h4> 
<pre><code class="prism language-bash">
//查询出每个省浏览网站的次数
<span class="token keyword">select</span> province,count<span class="token punctuation">(</span>behavior_type<span class="token punctuation">)</span> count from bigdata_user where behavior_type<span class="token operator">=</span><span class="token string">'1'</span> group by province<span class="token punctuation">;</span>

//把结果存入表格
create table browse_count as <span class="token keyword">select</span> province,count<span class="token punctuation">(</span>behavior_type<span class="token punctuation">)</span> count from bigdata_user where behavior_type<span class="token operator">=</span><span class="token string">'1'</span> group by province<span class="token punctuation">;</span>

//查看结果
<span class="token keyword">select</span> * from browse_count<span class="token punctuation">;</span>
</code></pre> 
<h4><a id="2210_246"></a>2.2.10查询潜力最大的商品（购物车）</h4> 
<pre><code class="prism language-bash">//查询加入购物车最多的商品
<span class="token keyword">select</span> item_id,count<span class="token punctuation">(</span>behavior_type<span class="token punctuation">)</span> cart_number from bigdata_user where behavior_type<span class="token operator">=</span><span class="token string">'3'</span>  group by item_id order by cart_number desc limit 20<span class="token punctuation">;</span>
</code></pre> 
<h4><a id="2211_253"></a>2.2.11查询用户浏览和购买的比例</h4> 
<pre><code class="prism language-bash">//查询用户浏览的数量  
<span class="token keyword">select</span> uid,count<span class="token punctuation">(</span>1<span class="token punctuation">)</span> br from bigdata_user where behavior_type<span class="token operator">=</span><span class="token string">'1'</span> group by uid<span class="token punctuation">;</span>  
  
//查询用户购买的数量  
<span class="token keyword">select</span> uid,count<span class="token punctuation">(</span>1<span class="token punctuation">)</span> bn from bigdata_user where behavior_type<span class="token operator">=</span><span class="token string">'4'</span> group by uid <span class="token punctuation">;</span>  
  
//查询用户浏览和购买的比例，集成在一个语句上  
<span class="token keyword">select</span> a.uid,a.br,b.bn,b.bn/a.br rate from <span class="token punctuation">(</span> <span class="token keyword">select</span> uid,count<span class="token punctuation">(</span>1<span class="token punctuation">)</span> br from bigdata_user where behavior_type<span class="token operator">=</span><span class="token string">'1'</span> group by uid <span class="token punctuation">)</span> a left <span class="token function">join</span> <span class="token punctuation">(</span>select uid,count<span class="token punctuation">(</span>1<span class="token punctuation">)</span> bn from bigdata_user where behavior_type<span class="token operator">=</span><span class="token string">'4'</span> group by uid  <span class="token punctuation">)</span> b on a.uid<span class="token operator">=</span>b.uid order by rate desc limit 20<span class="token punctuation">;</span>  
  
//如果要保存表，前面加上create table user_buy_rate as  <span class="token punctuation">..</span>  
create table user_buy_rate as 加上最后一个语句  
  
  
 
</code></pre> 
<h2><a id="3HiveMySQLHBase_272"></a>3.Hive、MySQL、HBase数据互导</h2> 
<h3><a id="31_HiveHiveMySQL_274"></a>3.1 Hive数据分析结果（如用户购买与浏览比例），从Hive传输到MySQL中</h3> 
<h5><a id="1_Hive_276"></a>1 在Hive中准备好数据表</h5> 
<pre><code class="prism language-bash">hive准备待传输的数据

use dblab<span class="token punctuation">;</span>

//创建数据
create table <span class="token keyword">if</span> not exists user_buy_rate  row <span class="token function">format</span> delimited fields terminated by <span class="token string">'\t'</span> as  <span class="token keyword">select</span> a.uid,a.br,b.bn,b.bn/a.br rate from <span class="token punctuation">(</span> <span class="token keyword">select</span> uid,count<span class="token punctuation">(</span>1<span class="token punctuation">)</span> br from bigdata_user where behavior_type<span class="token operator">=</span><span class="token string">'1'</span> group by uid <span class="token punctuation">)</span> a left <span class="token function">join</span> <span class="token punctuation">(</span>select uid,count<span class="token punctuation">(</span>1<span class="token punctuation">)</span> bn from bigdata_user where behavior_type<span class="token operator">=</span><span class="token string">'4'</span> group by uid  <span class="token punctuation">)</span> b on a.uid<span class="token operator">=</span>b.uid order by rate desc  <span class="token punctuation">;</span>

</code></pre> 
<h5><a id="2_mysql_288"></a>2 mysql准备</h5> 
<pre><code class="prism language-bash">mysql中
//a显示数据库
show databases<span class="token punctuation">;</span>

//b创建数据库dblab
create database <span class="token keyword">if</span> not exists dblab<span class="token punctuation">;</span>


//c创建mysql表
create table <span class="token keyword">if</span> not exists <span class="token variable"><span class="token variable">`</span>user_buy_rate<span class="token variable">`</span></span> <span class="token punctuation">(</span><span class="token variable"><span class="token variable">`</span>uid<span class="token variable">`</span></span> varchar<span class="token punctuation">(</span>100<span class="token punctuation">)</span>, <span class="token variable"><span class="token variable">`</span>br<span class="token variable">`</span></span> bigint,<span class="token variable"><span class="token variable">`</span>bn<span class="token variable">`</span></span> bigint,<span class="token variable"><span class="token variable">`</span>rate<span class="token variable">`</span></span> double<span class="token punctuation">)</span> engine<span class="token operator">=</span>InnoDB DEFAULT CHARSET <span class="token operator">=</span>utf8<span class="token punctuation">;</span>

//查看表结构
desc user_buy_rate<span class="token punctuation">;</span>



</code></pre> 
<h5><a id="3_sqoop_309"></a>3 sqoop进行传输</h5> 
<pre><code class="prism language-bash">
//sqoop进行数据传输
sqoop <span class="token function">export</span> --connect jdbc:mysql://127.0.0.1:3306/dblab?useSSL<span class="token operator">=</span>false --username root --password 123456 --table user_buy_rate --export-dir /user/hive/warehouse/dblab.db/user_buy_rate --input-fields-terminated-by <span class="token string">'\t'</span>

</code></pre> 
<h3><a id="32_HiveMySQLHbase_318"></a>3.2 Hive数据分析结果（如用户购买与浏览比例），从MySQL传输到Hbase中</h3> 
<h5><a id="1_Hbase_321"></a>1 Hbase准备</h5> 
<pre><code class="prism language-bash">hbase中

//在Hbase中创建一个user_buy_rate表,历史版本保留数量为5
hbase<span class="token operator">&gt;</span> create <span class="token string">'user_buy_rate'</span>, <span class="token punctuation">{<!-- --></span> NAME <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'f1'</span>, VERSIONS <span class="token operator">=</span><span class="token operator">&gt;</span> 5<span class="token punctuation">}</span>


</code></pre> 
<h5><a id="2_Sqoop_332"></a>2 Sqoop传输</h5> 
<pre><code class="prism language-bash">//sqoop传输
sqoop  <span class="token function">import</span>  --connect jdbc:mysql://localhost:3306/dblab --username root --password 123456 --table user_buy_rate --hbase-table table user_buy_rate --column-family f1 --hbase-row-key uid --hbase-create-table -m 1


</code></pre> 
<h5><a id="3_Hbase_341"></a>3 Hbase查看</h5> 
<pre><code class="prism language-bash">//查看HBase中user_action表数据
habse<span class="token operator">&gt;</span> scan <span class="token string">'user_buy_rate'</span>,<span class="token punctuation">{<!-- --></span>LIMIT<span class="token operator">=</span><span class="token operator">&gt;</span>10<span class="token punctuation">}</span>  <span class="token comment">#只查询前面10行</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/dc4cc308640f438b6a6681aad9d32777/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">hp mfp scan点配置没有反应_HP LaserJet Pro MFP M125-M126，扫描文件HPScan不能用？</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/635675f344d46928fa545816e8b17705/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">北大青鸟汉字注释机内码_众海常用汉字机内码表</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>