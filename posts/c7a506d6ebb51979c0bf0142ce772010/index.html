<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>(1) 如何写一个gym环境——学习笔记 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="(1) 如何写一个gym环境——学习笔记" />
<meta property="og:description" content="以CartPole-v0为一个简单的例子 step 1: 导入gym模块import gymstep 2: 创建一个小车倒立摆模型env = gym.make(&#39;CartPole-v0&#39;)step 3: 初始化环境env.reset()step 4: 刷新当前环境，并显示env.render() 此时，可以出现模型的图示：
env = gym.make(‘CartPole-v0’)是创建环境的函数 env.reset()是重新初始化函数 def _reset() self.state = self.np_random.uniform(low=-0.05, high=0.05, size=(4,)) # 利用均匀随机分布初试化环境的状态 self.steps_beyond_done = None # 设置当前步数为None return np.array(self.state) # 返回环境的初始化状态 env.reset()是图像引擎函数 def _render(self, mode=’human’, close=False): if close: …. #省略，直接看关键代码部分 if self.viewer is None: from gym.envs.classic_control import rendering #这一句导入rendering模块，利用rendering模块中的画图函数进行图形的绘制 #如绘制600*400的窗口函数为： self.viewer = rendering.Viewer(screen_width, screen_height) #其中screen_width=600，screen_height=400 #创建小车的代码为： l,r,t,b = -cartwidth/2, cartwidth/2, cartheight/2, -cartheight/2 axleoffset =cartheight/4.0 cart = rendering." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/c7a506d6ebb51979c0bf0142ce772010/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-10-22T21:14:08+08:00" />
<meta property="article:modified_time" content="2020-10-22T21:14:08+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">(1) 如何写一个gym环境——学习笔记</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h4><a id="CartPolev0_0"></a>以CartPole-v0为一个简单的例子</h4> 
<ul><li>step 1: 导入gym模块<code>import gym</code></li><li>step 2: 创建一个小车倒立摆模型<code>env = gym.make('CartPole-v0')</code></li><li>step 3: 初始化环境<code>env.reset()</code></li><li>step 4: 刷新当前环境，并显示<code>env.render()</code></li></ul> 
<p>此时，可以出现模型的图示：<br> <img src="https://images2.imgbox.com/2c/b1/DFQL49Hf_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="env__gymmakeCartPolev0_9"></a>env = gym.make(‘CartPole-v0’)是创建环境的函数</h4> 
<h4><a id="envreset_10"></a>env.reset()是重新初始化函数</h4> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">_reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	self<span class="token punctuation">.</span>state <span class="token operator">=</span> self<span class="token punctuation">.</span>np_random<span class="token punctuation">.</span>uniform<span class="token punctuation">(</span>low<span class="token operator">=</span><span class="token operator">-</span><span class="token number">0.05</span><span class="token punctuation">,</span> high<span class="token operator">=</span><span class="token number">0.05</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token comment"># 利用均匀随机分布初试化环境的状态</span>
	self<span class="token punctuation">.</span>steps_beyond_done <span class="token operator">=</span> <span class="token boolean">None</span>
	<span class="token comment"># 设置当前步数为None</span>
	<span class="token keyword">return</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>self<span class="token punctuation">.</span>state<span class="token punctuation">)</span>
	<span class="token comment"># 返回环境的初始化状态</span>
</code></pre> 
<h4><a id="envreset_23"></a>env.reset()是图像引擎函数</h4> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">_render</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> mode<span class="token operator">=</span>’human’<span class="token punctuation">,</span> close<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

	<span class="token keyword">if</span> close<span class="token punctuation">:</span>

	…<span class="token punctuation">.</span> <span class="token comment">#省略，直接看关键代码部分</span>

	<span class="token keyword">if</span> self<span class="token punctuation">.</span>viewer <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>

	<span class="token keyword">from</span> gym<span class="token punctuation">.</span>envs<span class="token punctuation">.</span>classic_control
	<span class="token keyword">import</span> rendering     
	<span class="token comment">#这一句导入rendering模块，利用rendering模块中的画图函数进行图形的绘制</span>
	<span class="token comment">#如绘制600*400的窗口函数为：</span>
	self<span class="token punctuation">.</span>viewer <span class="token operator">=</span> rendering<span class="token punctuation">.</span>Viewer<span class="token punctuation">(</span>screen_width<span class="token punctuation">,</span> screen_height<span class="token punctuation">)</span>
	<span class="token comment">#其中screen_width=600，screen_height=400</span>
	<span class="token comment">#创建小车的代码为：</span>
	l<span class="token punctuation">,</span>r<span class="token punctuation">,</span>t<span class="token punctuation">,</span>b <span class="token operator">=</span> <span class="token operator">-</span>cartwidth<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span>
	cartwidth<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span> cartheight<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span>cartheight<span class="token operator">/</span><span class="token number">2</span>
	axleoffset <span class="token operator">=</span>cartheight<span class="token operator">/</span><span class="token number">4.0</span>
	cart <span class="token operator">=</span> rendering<span class="token punctuation">.</span>FilledPolygon<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>l<span class="token punctuation">,</span>t<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>r<span class="token punctuation">,</span>t<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>r<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">#其中rendering.FilledPolygon为填充一个矩形。</span>
<span class="token comment">#创建完cart的形状，接下来给cart添加平移属性和旋转属性。将车的位移设置到cart的平移属性中，cart就会根据系统的状态变化左右运动。</span>
</code></pre> 
<h4><a id="envstep_49"></a>env.step()是物理引擎函数</h4> 
<p>其输入是动作a，输出是：<strong>下一步状态，立即回报，是否终止，调试项</strong>。该函数描述了智能体与环境交互的所有信息，是环境文件中最重要的函数。在该函数中，一般利用智能体的运动学模型和动力学模型计算下一步的状态和立即回报，并判断是否达到终止状态。</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">_step</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">assert</span> self<span class="token punctuation">.</span>action_space<span class="token punctuation">.</span>contains<span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"%r (%s) invalid"</span><span class="token operator">%</span><span class="token punctuation">(</span>action<span class="token punctuation">,</span>
<span class="token builtin">type</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">)</span>
    state <span class="token operator">=</span> self<span class="token punctuation">.</span>state
    x<span class="token punctuation">,</span> x_dot<span class="token punctuation">,</span> theta<span class="token punctuation">,</span> theta_dot <span class="token operator">=</span> state              <span class="token comment">#系统的当前状态</span>
    force <span class="token operator">=</span> self<span class="token punctuation">.</span>force_mag <span class="token keyword">if</span> action<span class="token operator">==</span><span class="token number">1</span> <span class="token keyword">else</span> <span class="token operator">-</span>self<span class="token punctuation">.</span>force_mag    <span class="token comment">#输入动作，即作用到车上的力</span>
    costheta <span class="token operator">=</span> math<span class="token punctuation">.</span>cos<span class="token punctuation">(</span>theta<span class="token punctuation">)</span>  <span class="token comment">#余弦函数                                            </span>
    sintheta <span class="token operator">=</span> math<span class="token punctuation">.</span>sin<span class="token punctuation">(</span>theta<span class="token punctuation">)</span>  <span class="token comment">#正弦函数                                           </span>
     
	<span class="token comment">#以下是车摆的动力学方程式，即加速度与动作之间的关系。</span>
    temp <span class="token operator">=</span> <span class="token punctuation">(</span>force <span class="token operator">+</span> self<span class="token punctuation">.</span>polemass_length <span class="token operator">*</span> theta_dot <span class="token operator">*</span> theta_dot <span class="token operator">*</span> sintheta<span class="token punctuation">)</span> <span class="token operator">/</span> self<span class="token punctuation">.</span>total_mass
    thetaacc <span class="token operator">=</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>gravity <span class="token operator">*</span> sintheta <span class="token operator">-</span> costheta<span class="token operator">*</span> temp<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>length <span class="token operator">*</span>
<span class="token punctuation">(</span><span class="token number">4.0</span><span class="token operator">/</span><span class="token number">3.0</span> <span class="token operator">-</span> self<span class="token punctuation">.</span>masspole <span class="token operator">*</span> costheta <span class="token operator">*</span> costheta <span class="token operator">/</span> self<span class="token punctuation">.</span>total_mass<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#摆的角加速度</span>
    xacc <span class="token operator">=</span> temp <span class="token operator">-</span> self<span class="token punctuation">.</span>polemass_length <span class="token operator">*</span> thetaacc <span class="token operator">*</span> costheta <span class="token operator">/</span> self<span class="token punctuation">.</span>total_mass    <span class="token comment">#小车的平移加速</span>
    x <span class="token operator">=</span> x <span class="token operator">+</span> self<span class="token punctuation">.</span>tau <span class="token operator">*</span> x_dot                                              
  	x_dot <span class="token operator">=</span> x_dot <span class="token operator">+</span> self<span class="token punctuation">.</span>tau <span class="token operator">*</span> xacc
    theta <span class="token operator">=</span> theta <span class="token operator">+</span> self<span class="token punctuation">.</span>tau <span class="token operator">*</span> theta_dot
    theta_dot <span class="token operator">=</span> theta_dot <span class="token operator">+</span> self<span class="token punctuation">.</span>tau <span class="token operator">*</span> thetaacc <span class="token comment">#积分求下一步的状态                             </span>
    self<span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span>x_dot<span class="token punctuation">,</span>theta<span class="token punctuation">,</span>theta_dot<span class="token punctuation">)</span>
</code></pre> 
<h4><a id="demo_72"></a>一个简单的demo</h4> 
<pre><code class="prism language-python"><span class="token keyword">import</span> gym
<span class="token keyword">import</span> time
env <span class="token operator">=</span> gym<span class="token punctuation">.</span>make<span class="token punctuation">(</span><span class="token string">'CartPole-v0'</span><span class="token punctuation">)</span>   <span class="token comment">#创造环境</span>
observation <span class="token operator">=</span> env<span class="token punctuation">.</span>reset<span class="token punctuation">(</span><span class="token punctuation">)</span>       <span class="token comment">#初始化环境，observation为环境状态</span>
count <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">for</span> t <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    action <span class="token operator">=</span> env<span class="token punctuation">.</span>action_space<span class="token punctuation">.</span>sample<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">#随机采样动作</span>
    observation<span class="token punctuation">,</span> reward<span class="token punctuation">,</span> done<span class="token punctuation">,</span> info <span class="token operator">=</span> env<span class="token punctuation">.</span>step<span class="token punctuation">(</span>action<span class="token punctuation">)</span>  <span class="token comment">#与环境交互，获得下一步的时刻</span>
    <span class="token keyword">if</span> done<span class="token punctuation">:</span>             
        <span class="token keyword">break</span>
    env<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token punctuation">)</span>         <span class="token comment">#绘制场景</span>
    count<span class="token operator">+=</span><span class="token number">1</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.2</span><span class="token punctuation">)</span>      <span class="token comment">#每次等待0.2s</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span>             <span class="token comment">#打印该次尝试的步数</span>

</code></pre> 
<h4><a id="_93"></a>编写自定义环境“类”</h4> 
<p>参考gym中经典的CartPole环境代码CartPole.py，我们逐步构建自定义环境。</p> 
<p>将要创建的是一个在二维水平面上移动的小车。该二维区域长宽各20单位。区域中心为坐标原点，也是小车要到达的目的地。</p> 
<p><strong>动作</strong>：小车每次只能选择不动或向四周移动一个单位。<br> <strong>状态</strong>：小车的横纵坐标。<br> <strong>奖励</strong>：小车到达目的地周围有+10的奖励；每移动一个单位有-0.1的奖励，这表示我们希望小车尽量以较少的时间（移动次数）到达终点；小车移动到区域外的奖励为-50。</p> 
<p>首先新建一个Car2D.py的文件，需要import的包如下：</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> gym
<span class="token keyword">from</span> gym <span class="token keyword">import</span> spaces
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
</code></pre> 
<p>声明一个Car2DEnv的类，它是gym.Env的子类。它一般包括的内容如下：<br> <em>The minimal required interface for an environment is composed of the <code>__init__</code>, <code>reset</code>, <code>step</code>, <code>render</code> and <code>close</code> routines.</em></p> 
<pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">Car2DEnv</span><span class="token punctuation">(</span>gym<span class="token punctuation">.</span>Env<span class="token punctuation">)</span><span class="token punctuation">:</span>
    metadata <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">'render.modes'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'human'</span><span class="token punctuation">,</span> <span class="token string">'rgb_array'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'video.frames_per_second'</span><span class="token punctuation">:</span> <span class="token number">2</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>action_space <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>observation_space <span class="token operator">=</span> <span class="token boolean">None</span>
        <span class="token keyword">pass</span>

    <span class="token keyword">def</span> <span class="token function">step</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>state<span class="token punctuation">,</span> reward<span class="token punctuation">,</span> done<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

    <span class="token keyword">def</span> <span class="token function">reset</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>state

    <span class="token keyword">def</span> <span class="token function">render</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'human'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token boolean">None</span>

    <span class="token keyword">def</span> <span class="token function">close</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token boolean">None</span>


</code></pre> 
<p><strong>必须实现的内容</strong>：<br> <code>__init__()</code>：将会初始化动作空间与状态空间，便于强化学习算法在给定的状态空间中搜索合适的动作。gym提供了spaces方法，详细内容可以help查看；</p> 
<p><code>step()</code>：用于编写智能体与环境交互的逻辑，它接受action的输入，给出下一时刻的状态、当前动作的回报、是否结束当前episode及调试信息。输入action由__init__()函数中的动作空间给定。我们规定当action为0表示小车不动，当action为1，2，3，4时分别是向上、下、左、右各移动一个单位。据此可以写出小车坐标的更新逻辑；</p> 
<p><code>reset()</code>：用于在每轮开始之前重置智能体的状态。</p> 
<p><strong>不是必须实现的但有助于调试算法的内容</strong>：<br> metadata、render()、close()是与图像显示有关的，我们不涉及这一部分。</p> 
<p>完整的Car2D.py代码如下</p> 
<pre><code class="prism language-python">
<span class="token comment"># -*- coding: utf-8 -*-</span>

<span class="token keyword">import</span> gym
<span class="token keyword">from</span> gym <span class="token keyword">import</span> spaces
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

<span class="token keyword">class</span> <span class="token class-name">Car2DEnv</span><span class="token punctuation">(</span>gym<span class="token punctuation">.</span>Env<span class="token punctuation">)</span><span class="token punctuation">:</span>
    metadata <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">'render.modes'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'human'</span><span class="token punctuation">,</span> <span class="token string">'rgb_array'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'video.frames_per_second'</span><span class="token punctuation">:</span> <span class="token number">2</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>xth <span class="token operator">=</span> <span class="token number">0</span>
        self<span class="token punctuation">.</span>target_x <span class="token operator">=</span> <span class="token number">0</span>
        self<span class="token punctuation">.</span>target_y <span class="token operator">=</span> <span class="token number">0</span>
        self<span class="token punctuation">.</span>L <span class="token operator">=</span> <span class="token number">10</span>
        self<span class="token punctuation">.</span>action_space <span class="token operator">=</span> spaces<span class="token punctuation">.</span>Discrete<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token comment"># 0, 1, 2，3，4: 不动，上下左右</span>
        self<span class="token punctuation">.</span>observation_space <span class="token operator">=</span> spaces<span class="token punctuation">.</span>Box<span class="token punctuation">(</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span>self<span class="token punctuation">.</span>L<span class="token punctuation">,</span> self<span class="token punctuation">.</span>L<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span>self<span class="token punctuation">.</span>L<span class="token punctuation">,</span> self<span class="token punctuation">.</span>L<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token boolean">None</span>

    <span class="token keyword">def</span> <span class="token function">step</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">assert</span> self<span class="token punctuation">.</span>action_space<span class="token punctuation">.</span>contains<span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"%r (%s) invalid"</span><span class="token operator">%</span><span class="token punctuation">(</span>action<span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">)</span>
        x<span class="token punctuation">,</span> y <span class="token operator">=</span> self<span class="token punctuation">.</span>state
        <span class="token keyword">if</span> action <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            x <span class="token operator">=</span> x
            y <span class="token operator">=</span> y
        <span class="token keyword">if</span> action <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
            x <span class="token operator">=</span> x
            y <span class="token operator">=</span> y <span class="token operator">+</span> <span class="token number">1</span>
        <span class="token keyword">if</span> action <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">:</span>
            x <span class="token operator">=</span> x
            y <span class="token operator">=</span> y <span class="token operator">-</span> <span class="token number">1</span>
        <span class="token keyword">if</span> action <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">:</span>
            x <span class="token operator">=</span> x <span class="token operator">-</span> <span class="token number">1</span>
            y <span class="token operator">=</span> y
        <span class="token keyword">if</span> action <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">:</span>
            x <span class="token operator">=</span> x <span class="token operator">+</span> <span class="token number">1</span>
            y <span class="token operator">=</span> y
        self<span class="token punctuation">.</span>state <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>counts <span class="token operator">+=</span> <span class="token number">1</span>

        done <span class="token operator">=</span> <span class="token punctuation">(</span>np<span class="token punctuation">.</span><span class="token builtin">abs</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token operator">+</span>np<span class="token punctuation">.</span><span class="token builtin">abs</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">or</span> <span class="token punctuation">(</span>np<span class="token punctuation">.</span><span class="token builtin">abs</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token operator">+</span>np<span class="token punctuation">.</span><span class="token builtin">abs</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">2</span><span class="token operator">*</span>self<span class="token punctuation">.</span>L<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>
        done <span class="token operator">=</span> <span class="token builtin">bool</span><span class="token punctuation">(</span>done<span class="token punctuation">)</span>

        <span class="token keyword">if</span> <span class="token operator">not</span> done<span class="token punctuation">:</span>
            reward <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">0.1</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> np<span class="token punctuation">.</span><span class="token builtin">abs</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token operator">+</span>np<span class="token punctuation">.</span><span class="token builtin">abs</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">:</span>
                reward <span class="token operator">=</span> <span class="token number">10</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                reward <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">50</span>

        <span class="token keyword">return</span> self<span class="token punctuation">.</span>state<span class="token punctuation">,</span> reward<span class="token punctuation">,</span> done<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

    <span class="token keyword">def</span> <span class="token function">reset</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>state <span class="token operator">=</span> np<span class="token punctuation">.</span>ceil<span class="token punctuation">(</span>np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>rand<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">2</span><span class="token operator">*</span>self<span class="token punctuation">.</span>L<span class="token punctuation">)</span><span class="token operator">-</span>self<span class="token punctuation">.</span>L
        self<span class="token punctuation">.</span>counts <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>state

    <span class="token keyword">def</span> <span class="token function">render</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'human'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token boolean">None</span>

    <span class="token keyword">def</span> <span class="token function">close</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token boolean">None</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    env <span class="token operator">=</span> Car2DEnv<span class="token punctuation">(</span><span class="token punctuation">)</span>
    env<span class="token punctuation">.</span>reset<span class="token punctuation">(</span><span class="token punctuation">)</span>
    env<span class="token punctuation">.</span>step<span class="token punctuation">(</span>env<span class="token punctuation">.</span>action_space<span class="token punctuation">.</span>sample<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>env<span class="token punctuation">.</span>state<span class="token punctuation">)</span>
    env<span class="token punctuation">.</span>step<span class="token punctuation">(</span>env<span class="token punctuation">.</span>action_space<span class="token punctuation">.</span>sample<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>env<span class="token punctuation">.</span>state<span class="token punctuation">)</span>
</code></pre> 
<ul><li>参考：</li></ul> 
<p><a href="https://www.zhihu.com/collection/581976137" rel="nofollow">https://www.zhihu.com/collection/581976137</a><br> <a href="https://www.zhihu.com/question/58126239" rel="nofollow">https://www.zhihu.com/question/58126239</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/37fbb3dc29ee264cf573f7011ff8fc9c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">13.QT信号槽的连接方式</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e35aeef480582e79e8a613bbf1a4b0e5/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">sql：mysql：MySql 不存在则插入，存在则更新或忽略</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>