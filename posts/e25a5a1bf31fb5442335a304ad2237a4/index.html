<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>新冠病毒爆发如何预防？用Python模拟病毒应对策略（附代码） - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="新冠病毒爆发如何预防？用Python模拟病毒应对策略（附代码）" />
<meta property="og:description" content="2019年末，在中国武汉爆发的冠状病毒疫情冲击了整个金融市场和实体经济。这座总人口超过千万，春运期间流动人口超过500万的巨型城市的灾难在世界各地引发了一连串蝴蝶效应，也在全球普通民众中引发恐慌。
武汉的这场灾难引发了全球对于城市规划和防疫政策的思考。如果疾病不是在武汉，而是在另一座人口规模更小、人口流动也更弱的城市，它的传染性和感染人数，又会是怎样的故事？
在这篇文章中，我们将讨论当流行病袭击一个城市时产生的影响和应对措施。我们以亚美尼亚首都，人口刚过百万的城市埃里温市为例进行研究，建立数学模型并用Python模拟冠状病毒在该市的传播，研究城市流动模式如何影响疾病的传播。
01
城市流动性
有效、高效和可持续的城市流动性对现代城市的运作至关重要。它已经被证明会直接影响城市的宜居性和经济产出(GDP)。然而，一旦发生疫情，它就会火上浇油，扩大疾病的传播。
那么，让我们先来看看埃里温市在一个平面坐标系上的聚合OD流动网络(Origin-Destination)，以了解城市流动模式的空间结构：
接着，如果我们观察网格的总流入量，我们会看到或多或少的单中心空间组织，其中一些网格的日流入量较高但位于中心之外:
现在，假设一种流行病在城市的任意地点爆发。它将如何传播？我们能做些什么来控制它？
02
流行病学建模
为了回答这些问题，我们将用Python建立一个简单的房室模型来模拟传染病在城市中的传播。
当一种流行病爆发时，其传播动力会有显著变化，这取决于最初感染的地理位置及其与城市其他地区的连接性。这是最近关于城市人口流行病的数据驱动研究得出的最重要见解之一。然而，正如我们将在下文进一步看到的，各种结果都要求采取类似的措施来控制疫情，并在规划和管理城市时考虑到这种可能性。
注：compartmental model，房室模型，也称SIR模型，是一种简化的传染病数学模型。
由于我们的目标是展示城市流行病传播的一般原理，而不是建立一个实时的精确模型，我将参考《自然》杂志的一篇文章，通过简单地修改经典SIR模型即可满足我们的需求。
相关链接：
https://www.nature.com/articles/s41467-017-02064-4
这个模型把人口分成三部分。在时间t的每个位置i，其三个房室如下：
Si,t：尚未感染或易感的人数
Ii,t：感染疾病并有能力将疾病传播给易感人群的人数
Ri,t：由于康复或者死亡，在被感染后从受感染组中移除的人数。这个群体中的个体没有能力再次感染该疾病或将感染病传染给他人。
在我们的模拟中，时间将是一个离散变量，因为系统的状态是以日为单位进行建模的。在t时刻j点的完全易感人群中，感染病出现的概率为：
βt是t时刻的传输率
mj,k是从k地到j地的流动性
xk,t 和yk,t 代表t时刻k地和j地的感染和易感人群数
其中xk,t = Ik,t / Nk，yj,t = Sj,t / Nj，Nk和Nj代表k地和j地的人口总数。然后，我们继续模拟一个随机过程，将这种疾病引入完全易感人群所在的地区,其中Ij，t&#43;1是概率为h(t,j)的伯努利随机变量。
一旦感染在随机地点出现，疾病不仅会在该地点传播，还会通过携带者传播到他处。这就是以OD流矩阵为特征的城市流动模式发挥关键作用的地方。
此外，为了确定疾病是如何通过感染者传播的，我们需要考虑其R0值。此处，其中y表示的是治愈率，也可以认为是二次感染率。在撰写本文时，新型冠状病毒的基本再生数估计值在1.4到4之间。凡事做最坏的准备，因此我们假设R0值为4。需要注意的是，R0值是一个有期望值的随机变量。为了让事情更有趣一点，我们在每个地区采用不同的R0值进行模拟，其中R0值服从均值为4的伽玛分布:
现在我们来讨论所建立的模型：
βk,t是t时刻k地的转移率
α是刻画出行方式倾向的参数
上述的模型十分简洁：为了求得t &#43; 1时刻的j地的尚未感染或易感的人数，我们需要从t时刻的j地的尚未感染或易感的人数中减去j地本地感染的人数（第一个方程的第二部分），还要减去从其他地方来到j地的感染者数，这些外来的感染者通过其传输率进行加权计算（第一个方程的第三部分）。
由于总人口数Nj = Sj &#43; Ij &#43; Rj，我们需要将减去的部分移至感染组，同时将治愈的部分移至Rj,t&#43;1(第二个和第三个方程)。
03
仿真建立
在此分析中，我们将使用由当地共乘公司gg提供的GPS数据获得的一个典型日的总OD流量矩阵作为埃里温市交通模式的代表。
接下来，我们需要每个250×250m网格单元的人口计数，通过按比例缩放提取的流量计数来近似计算，从而使不同位置的总流入量之和接近埃里温市110万人口的一半。这是一个大胆的假设，但对结果影响不大。
04
减少公共交通？
第一次模拟，我们将模拟背景设定为一个高度依赖公共交通的未来城市，设定流动率α=0.9：
可以看到，经过大约8-10天左右的时间感染人数比例迅速增加至70%，达到峰值，但此时仅有小部分（约10%）的人康复。至100天时，疫情逐渐缓解，康复人数比例达到了惊人的90%！
现在，我们再来看一下如果将公共交通强度α降低至0.2时，是否有利于缓解传染病的传播。这可以解释为采取严厉措施来降低城市流动性（例如实施宵禁），或者增加私家车出行比例，以减少人们出行期间感染的机率。
可以发现在这种假设下，疫情在16至20天左右到达顶峰，峰值感染人数比例明显降低（约45%），并且此时康复人数为之前的两倍（约20%）。在疫情结行将结束时，易感染人群比例也是之前的两倍（约24% vs. 约12%），这意味着更多的人躲过了这场疫情。正如人们所期望的，通过实施严厉的管控措施来临时降低城市的流动性对于减少传染病传播有明显作用。
05
隔离热门区域？
接着，再来看另一个直观想法——隔离一些关键区域能否得到预期的效果。为了测试这一想法，先挑选人流量位于前1%的区域：
接着完全限制这些区域的进出，建立有效的隔离制度。从这张图我们可以看出，在埃里温市这些位置主要位于市中心，另两个位置是两家最大的购物商场。将α取中间值，即0.5，我们得到如下结果：
感染人数比例的峰值更小了（约35%），并且更重要的是，在疫情行将结束时，大约一半的人未被感染，说明该种方法能够帮助人们有效的降低感染风险！" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/e25a5a1bf31fb5442335a304ad2237a4/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-03-04T08:00:00+08:00" />
<meta property="article:modified_time" content="2020-03-04T08:00:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">新冠病毒爆发如何预防？用Python模拟病毒应对策略（附代码）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div id="js_content"> 
 <p style="text-align: center"> </p> 
 <p style="text-align: center"><img src="https://images2.imgbox.com/5a/c8/Pwvjld0M_o.png"></p> 
 <p style="text-align: justify">2019年末，在中国武汉爆发的冠状病毒疫情冲击了整个金融市场和实体经济。这座总人口超过千万，春运期间流动人口超过500万的巨型城市的灾难在世界各地引发了一连串蝴蝶效应，也在全球普通民众中引发恐慌。</p> 
 <p style="text-align: justify">武汉的这场灾难引发了全球对于城市规划和防疫政策的思考。如果疾病不是在武汉，而是在另一座人口规模更小、人口流动也更弱的城市，它的传染性和感染人数，又会是怎样的故事？</p> 
 <p style="text-align: justify">在这篇文章中，我们将讨论当流行病袭击一个城市时产生的影响和应对措施。我们以亚美尼亚首都，人口刚过百万的城市埃里温市为例进行研究，<strong>建立数学模型</strong><strong>并用Python模拟</strong>冠状病毒在该市的传播，研究城市流动模式如何影响疾病的传播。</p> 
 <p>0<span title="">1</span></p> 
 <p>城市流动性</p> 
 <p style="text-align: justify">有效、高效和可持续的城市流动性对现代城市的运作至关重要。它已经被证明会直接影响城市的宜居性和经济产出(GDP)。然而，一旦发生疫情，它就会火上浇油，扩大疾病的传播。</p> 
 <p style="text-align: justify">那么，让我们先来看看埃里温市在一个平面坐标系上的聚合OD流动网络(Origin-Destination)，以<strong>了解城市流动模式的空间结构：</strong></p> 
 <p style="text-align: center"><img src="https://images2.imgbox.com/34/a3/6eZ0BpsX_o.png"></p> 
 <p style="text-align: justify">接着，如果我们<strong>观察网格的总流入量</strong>，我们会看到或多或少的单中心空间组织，其中一些网格的日流入量较高但位于中心之外:</p> 
 <p style="text-align: center"><img src="https://images2.imgbox.com/d1/2a/clpLxDla_o.png"></p> 
 <p style="text-align: justify">现在，假设一种流行病在城市的任意地点爆发。它将如何传播？我们能做些什么来控制它？<br></p> 
 <p>0<span title="">2</span></p> 
 <p><strong>流行病学建模</strong></p> 
 <p style="text-align: justify">为了回答这些问题，我们将<strong>用Python建立一个简单的房室模型</strong>来模拟传染病在城市中的传播。</p> 
 <p style="text-align: justify">当一种流行病爆发时，<strong>其传播动力会有显著变化，这取决于最初感染的地理位置及其与城市其他地区的连接性。</strong>这是最近关于城市人口流行病的数据驱动研究得出的最重要见解之一。然而，正如我们将在下文进一步看到的，各种结果都要求采取类似的措施来控制疫情，并在规划和管理城市时考虑到这种可能性。</p> 
 <blockquote> 
  <p style="text-align: justify">注：compartmental model，房室模型，也称SIR模型，是一种简化的传染病数学模型。</p> 
 </blockquote> 
 <p style="text-align: justify">由于我们的目标是展示城市流行病传播的一般原理，而不是建立一个实时的精确模型，我将参考《自然》杂志的一篇文章，通过简单地修改经典SIR模型即可满足我们的需求。</p> 
 <blockquote> 
  <p style="text-align: justify">相关链接：</p> 
  <p style="text-align: justify">https://www.nature.com/articles/s41467-017-02064-4</p> 
 </blockquote> 
 <p style="text-align: justify">这个模型把人口分成三部分。在时间t的每个位置i，其三个房室如下：</p> 
 <ul><li><p style="text-align: justify"><strong>Si,t：尚未感染或易感的人数</strong></p></li><li><p style="text-align: justify"><strong>Ii,t：感染疾病并有能力将疾病传播给易感人群的人数</strong></p></li><li><p style="text-align: justify"><strong>Ri,t：由于康复或者死亡，在被感染后从受感染组中移除的人数。这个群体中的个体没有能力再次感染该疾病或将感染病传染给他人。</strong></p></li></ul> 
 <p style="text-align: justify">在我们的模拟中，<strong>时间将是一个离散变量</strong>，因为系统的状态是以日为单位进行建模的。在t时刻j点的完全易感人群中，感染病出现的概率为：</p> 
 <p style="text-align: center"><img src="https://images2.imgbox.com/86/f3/slUrkUl5_o.png" height="148" width="1080"></p> 
 <ul><li><p style="text-align: justify"><strong>βt是t时刻的传输率</strong></p></li><li><p style="text-align: justify"><strong>mj,k是从k地到j地的流动性</strong></p></li><li><p style="text-align: justify"><strong>xk,t 和yk,t 代表t时刻k地和j地的感染和易感人群数</strong></p></li></ul> 
 <p style="text-align: justify">其中xk,t = Ik,t / Nk，yj,t = Sj,t / Nj，Nk和Nj代表k地和j地的人口总数。然后，我们继续模拟一个随机过程，将这种疾病引入完全易感人群所在的地区,其中Ij，t+1是概率为h(t,j)的伯努利随机变量。</p> 
 <p style="text-align: justify"><strong>一旦感染在随机地点出现，疾病不仅会在该地点传播，还会通过携带者传播到他处。</strong>这就是以OD流矩阵为特征的城市流动模式发挥关键作用的地方。</p> 
 <p style="text-align: justify">此外，为了确定疾病是如何通过感染者传播的，我们需要考虑其<strong>R0值</strong>。此处，其中y表示的是治愈率，也可以认为是二次感染率。在撰写本文时，新型冠状病毒的基本再生数估计值在1.4到4之间。凡事做最坏的准备，因此我们假设R0值为4。需要注意的是，R0值是一个有期望值的随机变量。为了让事情更有趣一点，我们在每个地区采用不同的R0值进行模拟，其中R0值服从均值为4的伽玛分布:</p> 
 <p style="text-align: justify"><img src="https://images2.imgbox.com/b6/43/buiDqlhW_o.png" height="513" width="1080"></p> 
 <p style="text-align: justify">现在我们来讨论所建立的模型：</p> 
 <p style="text-align: justify"><img src="https://images2.imgbox.com/61/d6/zYkyedD6_o.png" height="316" width="1080"></p> 
 <ul><li><p style="text-align: justify"><strong>βk,t是t时刻k地的转移率</strong></p></li><li><p style="text-align: justify"><strong>α是刻画出行方式倾向的参数</strong></p></li></ul> 
 <p style="text-align: justify">上述的模型十分简洁：为了求得t + 1时刻的j地的尚未感染或易感的人数，我们需要从t时刻的j地的尚未感染或易感的人数中减去j地本地感染的人数（第一个方程的第二部分），还要减去从其他地方来到j地的感染者数，这些外来的感染者通过其传输率进行加权计算（第一个方程的第三部分）。</p> 
 <p style="text-align: justify">由于总人口数Nj = Sj + Ij + Rj，我们需要将减去的部分移至感染组，同时将治愈的部分移至Rj,t+1(第二个和第三个方程)。</p> 
 <p>0<span title="">3</span></p> 
 <p><strong>仿真建立</strong></p> 
 <p style="text-align: justify">在此分析中，我们将使用由当地共乘公司gg提供的GPS数据获得的一个典型日的总OD流量矩阵作为埃里温市交通模式的代表。</p> 
 <p style="text-align: justify">接下来，我们需要每个250×250m网格单元的人口计数，通过按比例缩放提取的流量计数来近似计算，从而使不同位置的总流入量之和接近埃里温市110万人口的一半。这是一个大胆的假设，但对结果影响不大。</p> 
 <p>0<span title="">4</span></p> 
 <p><strong>减少公共交通？</strong></p> 
 <p style="text-align: justify">第一次模拟，我们将模拟背景设定为一个高度依赖公共交通的未来城市，设定<strong>流动率α=0.9</strong>：</p> 
 <p style="text-align: center"><img src="https://images2.imgbox.com/31/93/6oICX6yJ_o.png" height="600" width="1080"></p> 
 <p style="text-align: justify">可以看到，<strong>经过大约8-10天左右的时间感染人数比例迅速增加至70%，达到峰值，</strong>但此时仅有小部分（约10%）的人康复。<strong>至100天时，疫情逐渐缓解，</strong>康复人数比例达到了惊人的90%！</p> 
 <p style="text-align: justify">现在，我们再来看一下如果将公共交通强度α降低至0.2时，是否有利于缓解传染病的传播。这可以解释为采取严厉措施来降低城市流动性（例如实施宵禁），或者增加私家车出行比例，以减少人们出行期间感染的机率。</p> 
 <p style="text-align: center"><img src="https://images2.imgbox.com/d2/e6/3w0cZBh7_o.png" height="609" width="1080"></p> 
 <p style="text-align: justify">可以发现在这种假设下，疫情在16至20天左右到达顶峰，峰值感染人数比例明显降低（约45%），并且此时康复人数为之前的两倍（约20%）。在疫情结行将结束时，易感染人群比例也是之前的两倍（约24% vs. 约12%），这意味着更多的人躲过了这场疫情。正如人们所期望的，<strong>通过实施严厉的管控措施来临时降低城市的流动性对于减少传染病传播有明显作用。</strong></p> 
 <p>0<span title="">5</span></p> 
 <p><strong>隔离热门区域？</strong></p> 
 <p style="text-align: justify">接着，再来看另一个直观想法——<strong>隔离一些关键区域能否得到预期的效果。</strong>为了测试这一想法，先挑选人流量位于前1%的区域：</p> 
 <p style="text-align: center"><img src="https://images2.imgbox.com/7d/fc/p6bksviD_o.png"></p> 
 <p style="text-align: justify">接着完全限制这些区域的进出，建立有效的隔离制度。从这张图我们可以看出，在埃里温市这些位置主要位于市中心，另两个位置是两家最大的购物商场。将α取中间值，即0.5，我们得到如下结果：</p> 
 <p style="text-align: center"><img src="https://images2.imgbox.com/20/34/C9nGuCAe_o.png" height="609" width="1080"></p> 
 <p style="text-align: justify">感染人数比例的峰值更小了（约35%），并且更重要的是，在疫情行将结束时，大约一半的人未被感染，<strong>说明该种方法能够帮助人们有效的降低感染风险！</strong></p> 
 <p style="text-align: justify">如下动图显示了高度依赖公共交通场景下的结果：</p> 
 <p style="text-align: justify"><img src="https://images2.imgbox.com/c2/62/NwweffS3_o.png"></p> 
 <p>0<span title="">6</span></p> 
 <p><strong>结 论</strong></p> 
 <p style="text-align: justify">该实验绝不是说我们已经构建了准确的传染病模型（甚至模型中不涉及任何传染病学的基础知识），我们的目标是<strong>在传染病爆发时能够即时了解城市交通网络对传染病传播的影响。</strong></p> 
 <p style="text-align: justify">随着人口密度、流动性和互动性的增强，我们的城市更容易发生“黑天鹅”事件，并且变得更加脆弱。例如，我们从这个模型可以发现在关键地区实施隔离制度或者采取严苛的措施来控制人员流动能够在疫情期间发挥巨大作用。</p> 
 <p style="text-align: justify">此外，传染病传播机制也是一个活跃的研究领域，该领域的成果必须要渗透并整合到城市规划、政策制定和城市管理当中，以使我们的城市更安全更抗打击。</p> 
 <p style="text-align: justify">End.</p> 
 <p style="text-align: justify">来源：大数据文摘</p> 
 <p style="text-align: center"><img src="https://images2.imgbox.com/f4/14/OXRyJJOo_o.png"></p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/333a6484fd4143a636c546fe134d7f67/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Linux 查看内存使用情况</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/265a80292469e04ec64a9645c0c8fdb1/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">报错：yum install 安装时报yum doesn&#39;t have enough cached data to continue</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>