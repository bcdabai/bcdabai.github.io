<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>STM32——TIM1的TIM1_CH1N通道PWM初始化 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="STM32——TIM1的TIM1_CH1N通道PWM初始化" />
<meta property="og:description" content="TIM1 是 STM32 的高级定时器，功能很强大，它的每个通道都有对应的互补通道用来互补输出PWM。之前没使用过，今天要用来做 PWM 控制，花了好一番功夫才搞定。
记录下初始化代码： void Led_PWM_Init(u16 arr, u32 ckCnt, u16 CCR1_Val) { uint16_t pscValue = 0; TIM_TimeBaseInitTypeDef TIM_TimeBaseStructure; TIM_OCInitTypeDef TIM_OCInitStructure; NVIC_InitTypeDef NVIC_InitStructure; RCC_APB2PeriphClockCmd(RCC_APB2Periph_TIM1, ENABLE); GPIO_Config(); //PWM控制引脚初始化 TIM_DeInit(TIM1); /* Time Base configuration */ pscValue = (uint16_t)(SystemCoreClock / ckCnt) - 1; TIM_TimeBaseStructure.TIM_Prescaler = pscValue ; TIM_TimeBaseStructure.TIM_CounterMode = TIM_CounterMode_Up; TIM_TimeBaseStructure.TIM_Period = arr; TIM_TimeBaseStructure.TIM_ClockDivision = 0; TIM_TimeBaseStructure.TIM_RepetitionCounter = 0; //高级定时器特有 TIM_TimeBaseInit(TIM1, &amp;TIM_TimeBaseStructure); /* Channel 1, 2,3 and 4 Configuration in PWM mode */ TIM_OCInitStructure." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/cfdb3f542b44a5a30310f74e3b89450d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-02-21T11:56:42+08:00" />
<meta property="article:modified_time" content="2020-02-21T11:56:42+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">STM32——TIM1的TIM1_CH1N通道PWM初始化</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><strong><code>TIM1</code></strong> 是 <strong><code>STM32</code></strong> 的高级定时器，功能很强大，它的每个通道都有对应的互补通道用来互补输出PWM。之前没使用过，今天要用来做 <strong><code>PWM</code></strong> 控制，花了好一番功夫才搞定。</p> 
<ul><li><strong>记录下初始化代码：</strong></li></ul> 
<pre><code>void  Led_PWM_Init(u16 arr, u32 ckCnt, u16 CCR1_Val)
{
    uint16_t pscValue = 0;
  
    TIM_TimeBaseInitTypeDef TIM_TimeBaseStructure;
    TIM_OCInitTypeDef       TIM_OCInitStructure;
    NVIC_InitTypeDef        NVIC_InitStructure;

    RCC_APB2PeriphClockCmd(RCC_APB2Periph_TIM1, ENABLE);   

    GPIO_Config();                              //PWM控制引脚初始化

    TIM_DeInit(TIM1);

    /* Time Base configuration */
    pscValue = (uint16_t)(SystemCoreClock / ckCnt) - 1;
    TIM_TimeBaseStructure.TIM_Prescaler         = pscValue ;
    TIM_TimeBaseStructure.TIM_CounterMode       = TIM_CounterMode_Up;
    TIM_TimeBaseStructure.TIM_Period            = arr;
    TIM_TimeBaseStructure.TIM_ClockDivision     = 0;
    TIM_TimeBaseStructure.TIM_RepetitionCounter = 0;    //高级定时器特有

    TIM_TimeBaseInit(TIM1, &amp;TIM_TimeBaseStructure);

    /* Channel 1, 2,3 and 4 Configuration in PWM mode */
    TIM_OCInitStructure.TIM_OCMode             = TIM_OCMode_PWM1;
    TIM_OCInitStructure.TIM_OutputState        = TIM_OutputState_Disable;
//    TIM_OCInitStructure.TIM_OCPolarity         = TIM_OCPolarity_High;
	TIM_OCInitStructure.TIM_OCIdleState        = TIM_OCIdleState_Reset;
	
    TIM_OCInitStructure.TIM_OutputNState       = TIM_OutputNState_Enable;    
    TIM_OCInitStructure.TIM_OCNPolarity        = TIM_OCNPolarity_High;
  
    TIM_OCInitStructure.TIM_OCNIdleState       = TIM_OCNIdleState_Set;

    TIM_OCInitStructure.TIM_Pulse                   = CCR1_Val;                      //占空比
    TIM_OC1Init(TIM1, &amp;TIM_OCInitStructure);

    TIM_OC1PreloadConfig(TIM1, TIM_OCPreload_Enable);

    TIM_ARRPreloadConfig(TIM1, ENABLE);

    TIM_CtrlPWMOutputs(TIM1, ENABLE);
    
    TIM_Cmd(TIM1, ENABLE);
}
</code></pre> 
<p>高级定时器做PWM的话和其他定时器一样的使用。只是配置不一样。<br> 对于高级定时器来说，要有这句<code>TIM_CtrlPWMOutputs(TIM1, ENABLE);</code>使能PWM输出。<br> 由于只是使用TIM1的通道1的互补通道，所以关闭通道1的 <code>PWM</code> 输出</p> 
<pre><code>    TIM_OCInitStructure.TIM_OutputState        = TIM_OutputState_Disable;
</code></pre> 
<p>打开<code>通道1的互补通道</code>的<code>PWM</code>的输出</p> 
<pre><code>  TIM_OCInitStructure.TIM_OutputNState       = TIM_OutputNState_Enable;  
</code></pre> 
<p>百度和对照别人的代码，搞了好久也没搞定不能控制亮度。后来发现是没有这句</p> 
<pre><code>TIM_OCInitStructure.TIM_OCIdleState        = TIM_OCIdleState_Reset;
</code></pre> 
<p>上面这句要和下面这句设置相反：<br> 一个是<code>TIM_OCIdleState_Reset</code>、另一个是<code>TIM_OCNIdleState_Set</code></p> 
<pre><code>  TIM_OCInitStructure.TIM_OCNIdleState       = TIM_OCNIdleState_Set;
</code></pre> 
<p><img src="https://images2.imgbox.com/77/42/r0UA4WxT_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/8d13248dbf0b74b37ed2b84f7a520e9c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">ROS Navigation导航包介绍</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/bad2cba9c3c05a3ae0e7face2ce06b8f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">sci论文小修经验</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>