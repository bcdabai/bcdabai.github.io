<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>mask-rcnn训练完自己的数据集之后的测试demo - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="mask-rcnn训练完自己的数据集之后的测试demo" />
<meta property="og:description" content="import os import sys import random import math import numpy as np import skimage.io import matplotlib import matplotlib.pyplot as plt import coco import utils import model as modellib import visualize class_names = [&#39;BG&#39;, &#39;your class1&#39;, &#39;your class2&#39;, &#39;your class3&#39;] class InferenceConfig(coco.CocoConfig): # Set batch size to 1 since we&#39;ll be running inference on # one image at a time. Batch size = GPU_COUNT * IMAGES_PER_GPU GPU_COUNT = 1 IMAGES_PER_GPU = 1 NUM_CLASSES = 1 &#43; 3 # background &#43; 3 class config = InferenceConfig() config." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/0e0bb3be1074a0f3d09639ce5dfd922d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-04-11T21:21:06+08:00" />
<meta property="article:modified_time" content="2018-04-11T21:21:06+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">mask-rcnn训练完自己的数据集之后的测试demo</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <pre class="prettyprint"><code class=" hljs python"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> sys
<span class="hljs-keyword">import</span> random
<span class="hljs-keyword">import</span> math
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">import</span> skimage.io
<span class="hljs-keyword">import</span> matplotlib
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt

<span class="hljs-keyword">import</span> coco
<span class="hljs-keyword">import</span> utils
<span class="hljs-keyword">import</span> model <span class="hljs-keyword">as</span> modellib
<span class="hljs-keyword">import</span> visualize

class_names = [<span class="hljs-string">'BG'</span>, <span class="hljs-string">'your class1'</span>, <span class="hljs-string">'your class2'</span>, <span class="hljs-string">'your class3'</span>]

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">InferenceConfig</span><span class="hljs-params">(coco.CocoConfig)</span>:</span>
    <span class="hljs-comment"># Set batch size to 1 since we'll be running inference on</span>
    <span class="hljs-comment"># one image at a time. Batch size = GPU_COUNT * IMAGES_PER_GPU</span>
    GPU_COUNT = <span class="hljs-number">1</span>
    IMAGES_PER_GPU = <span class="hljs-number">1</span>

    NUM_CLASSES = <span class="hljs-number">1</span> + <span class="hljs-number">3</span>  <span class="hljs-comment"># background + 3 class</span>

config = InferenceConfig()
config.display()

<span class="hljs-comment"># Root directory of the project</span>
ROOT_DIR = os.getcwd()

<span class="hljs-comment"># Directory to save logs and trained model</span>
MODEL_DIR = os.path.join(ROOT_DIR, <span class="hljs-string">"logs"</span>)

<span class="hljs-comment"># Directory of images to run detection on</span>
IMAGE_DIR = os.path.join(ROOT_DIR, <span class="hljs-string">"images"</span>)

<span class="hljs-comment"># Load a random image from the images folder</span>
file_names = next(os.walk(IMAGE_DIR))[<span class="hljs-number">2</span>]
image = skimage.io.imread(os.path.join(IMAGE_DIR, random.choice(file_names)))

<span class="hljs-comment"># Create model object in inference mode.</span>
model = modellib.MaskRCNN(mode=<span class="hljs-string">"inference"</span>, config=config , model_dir=MODEL_DIR)

<span class="hljs-comment"># Local path to trained weights file</span>
COCO_MODEL_PATH = os.path.join(ROOT_DIR, <span class="hljs-string">"mask_rcnn_shapes_0002.h5"</span>)
<span class="hljs-comment"># Load weights trained on MS-COCO</span>
model.load_weights(COCO_MODEL_PATH, by_name=<span class="hljs-keyword">True</span>)


<span class="hljs-comment"># Run detection</span>
results = model.detect([image], verbose=<span class="hljs-number">1</span>)

<span class="hljs-comment"># Visualize results</span>
r = results[<span class="hljs-number">0</span>]
visualize.display_instances(image, r[<span class="hljs-string">'rois'</span>], r[<span class="hljs-string">'masks'</span>], r[<span class="hljs-string">'class_ids'</span>], class_names, r[<span class="hljs-string">'scores'</span>])



</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3d6835790c8ffaa01e4ba98511c40481/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">mask-rcnn训练自己的数据集</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/cc0b05268987e665d0ada03158afa118/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">cJson的学习与总结</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>