<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>sql server sql 取各自前几条数据_最强官配：世界上人们最喜欢的数据库&#43;最喜欢的语言... - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="sql server sql 取各自前几条数据_最强官配：世界上人们最喜欢的数据库&#43;最喜欢的语言..." />
<meta property="og:description" content="全文共2157字，预计学习时长13分钟 图源：unsplash 几乎每个人都在使用SQL和Python，Python是用于数据分析、机器学习和网页开发的全明星顶级语言，而SQL是数据库的实际标准。如果将两者结合会发生什么呢？
实际上，两者要结合在一起并不难。我们可以快速利用Python的动态特性，控制和构建SQL查询。设置完成后，我们无需执行任何操作。
这两种工具结合之后可谓是最强搭档，自动化和效率都达到了新高度。
pyodbc
连接两种技术的桥梁是pyodbc，该库可以轻松访问ODBC数据库。
ODBC（开放数据库连接的简称）是一种用于访问数据库的标准化应用程序编程接口（API），由90年代初的SQLAccess组开发。兼容的数据库管理系统（DBMS）包括：
· IBM Db2
· MySQL
· Oracle
· MS Access
· MS SQL服务器
本文将使用MS SQL服务器。在多数情况下，该服务器可以直接转移，与任何符合ODBC的数据库都可一起使用。唯一需要更改的是连接设置。
连接
首先，要创建与SQL 服务器的连接，可以通过pyodbc.connect实现。在此函数中，还须传递连接字符串。此连接字符串必须指定DBMS驱动程序、服务器、要连接的特定数据库以及连接设置。
因此，假设要连接到服务器UKXXX00123,45600和数据库DB01，需要使用SQL Server Native Client 11.0。从内部连接使得连接被信任，无需输入用户名和密码。
cnxn_str = (&#34;Driver={SQLServer Native Client 11.0};&#34; &#34;Server=UKXXX00123,45600;&#34; &#34;Database=DB01;&#34; &#34;Trusted_Connection=yes;&#34;) 现在，连接已初始化为： cnxn = pyodbc.connect（cnxn_str） 如果不通过受信任的连接访问数据库，则需要输入通常用于通过SQLServer Management Studio（SSMS）访问服务器的用户名和密码。例如，如果用户名是JoeBloggs，而密码是Password123，则应立即更改密码。更改密码之前，可以按照如下进行连接：
cnxn_str = (&#34;Driver={SQLServer Native Client 11.0};&#34; &#34;Server=UKXXX00123,45600;&#34; &#34;Database=DB01;&#34; &#34;UID=JoeBloggs;&#34; &#34;PWD=Password123;&#34;)cnxn = pyodbc.connect(cnxn_str) 现在我们已连接到数据库，可以开始通过Python执行SQL查询。
图源：pexels 执行查询
SQL 服务器上运行的每个查询都包含游标初始化和查询执行。如果要在服务器内部进行任何更改，还需要将这些更改提交到服务器。
先来初始化游标：
cursor = cnxn.cursor() 现在，每当要执行查询时，都要使用此游标对象。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/c6154737f5f7376a1650bada9e04f7c4/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-11-27T08:43:41+08:00" />
<meta property="article:modified_time" content="2020-11-27T08:43:41+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">sql server sql 取各自前几条数据_最强官配：世界上人们最喜欢的数据库&#43;最喜欢的语言...</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div> 
 <p></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/7b/7c/rUB5OoAi_o.png" alt="766ce67aac89a640e44ea58e94019c1e.png"> 
 </div> 
 <blockquote>
   全文共2157字，预计学习时长13分钟 
 </blockquote> 
 <p></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/c9/29/4JFPHKQq_o.png" alt="8c012cc10c45228f0e41a7c9985cda12.png"> 
 </div> 
 <figcaption>
   图源：unsplash 
 </figcaption> 
 <p>几乎每个人都在使用SQL和Python，Python是用于数据分析、机器学习和网页开发的全明星顶级语言，而SQL是数据库的实际标准。如果将两者结合会发生什么呢？</p> 
 <p>实际上，两者要结合在一起并不难。我们可以快速利用Python的动态特性，控制和构建SQL查询。设置完成后，我们无需执行任何操作。</p> 
 <p>这两种工具结合之后可谓是最强搭档，自动化和效率都达到了新高度。</p> 
 <p><b>pyodbc</b></p> 
 <p>连接两种技术的桥梁是pyodbc，该库可以轻松访问ODBC数据库。</p> 
 <p>ODBC（开放数据库连接的简称）是一种用于访问数据库的标准化应用程序编程接口（API），由90年代初的SQLAccess组开发。兼容的数据库管理系统（DBMS）包括：</p> 
 <p>· IBM Db2</p> 
 <p>· MySQL</p> 
 <p>· Oracle</p> 
 <p>· MS Access</p> 
 <p>· MS SQL服务器</p> 
 <p>本文将使用MS SQL服务器。在多数情况下，该服务器可以直接转移，与任何符合ODBC的数据库都可一起使用。唯一需要更改的是连接设置。</p> 
 <p><b>连接</b></p> 
 <p>首先，要创建与SQL 服务器的连接，可以通过pyodbc.connect实现。在此函数中，还须传递连接字符串。此连接字符串必须指定DBMS驱动程序、服务器、要连接的特定数据库以及连接设置。</p> 
 <p>因此，假设要连接到服务器UKXXX00123,45600和数据库DB01，需要使用SQL Server Native Client 11.0。从内部连接使得连接被信任，无需输入用户名和密码。</p> 
 <div class="has"> 
  <pre class="has"><code>cnxn_str = ("Driver={SQLServer Native Client 11.0};"
"Server=UKXXX00123,45600;"
"Database=DB01;"
"Trusted_Connection=yes;")
现在，连接已初始化为：
cnxn = pyodbc.connect（cnxn_str）</code></pre> 
 </div> 
 <p>如果不通过受信任的连接访问数据库，则需要输入通常用于通过SQLServer Management Studio（SSMS）访问服务器的用户名和密码。例如，如果用户名是JoeBloggs，而密码是Password123，则应立即更改密码。更改密码之前，可以按照如下进行连接：</p> 
 <div class="has"> 
  <pre class="has"><code>cnxn_str = ("Driver={SQLServer Native Client 11.0};"
"Server=UKXXX00123,45600;"
"Database=DB01;"
"UID=JoeBloggs;"
"PWD=Password123;")cnxn = pyodbc.connect(cnxn_str)</code></pre> 
 </div> 
 <p>现在我们已连接到数据库，可以开始通过Python执行SQL查询。</p> 
 <p></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/3c/50/tup9zqmv_o.png" alt="01b7326e280369d2a0b1635d9bc29c62.png"> 
 </div> 
 <figcaption>
   图源：pexels 
 </figcaption> 
 <p><b>执行查询</b></p> 
 <p>SQL 服务器上运行的每个查询都包含游标初始化和查询执行。如果要在服务器内部进行任何更改，还需要将这些更改提交到服务器。</p> 
 <p>先来初始化游标：</p> 
 <div class="has"> 
  <pre class="has"><code>cursor = cnxn.cursor()</code></pre> 
 </div> 
 <p>现在，每当要执行查询时，都要使用此游标对象。</p> 
 <p>从名为“customers”表中选择前1000行：</p> 
 <div class="has"> 
  <pre class="has"><code>cursor.execute("SELECTTOP(1000) * FROM customers")</code></pre> 
 </div> 
 <p>执行该操作，但这发生在服务器内部，实际上什么也没有返回到Python。让我们一起看看从SQL中提取的这些数据。</p> 
 <p><b>提取数据</b></p> 
 <p>要从SQL中提取数据到Python中，需要使用pandas。Pandas提供了一个非常方便的函数read_sql，该函数可以从SQL读取数据。read_sql需要查询和连接实例cnxn，如下所示：</p> 
 <div class="has"> 
  <pre class="has"><code>data =pd.read_sql("SELECT TOP(1000) * FROM customers", cnxn)</code></pre> 
 </div> 
 <p>这会返回到包含“customers”表中前1000行的数据框。</p> 
 <p><b>在SQL中变更数据</b></p> 
 <p>现在，如果要变更SQL中的数据，需要在原始的初始化连接后添加另一步，执行查询过程。在SQL中执行查询时，这些变更将保存在临时存在的空格中，而不是直接对数据进行更改。</p> 
 <p>为了让变更永久生效，必须提交变更。连接firstName和lastName列，创建fullName列。</p> 
 <div class="has"> 
  <pre class="has"><code>cursor = cnxn.cursor()# firstalter the table, adding a column
cursor.execute("ALTER TABLE customer " + 
          "ADD fullNameVARCHAR(20)")# now update that column to contain firstName
 + lastNamecursor.execute("UPDATEcustomer " +        
"SET fullName = firstName + " " + lastName")</code></pre> 
 </div> 
 <p>此时，fullName并不存在于数据库中。必须提交这些变更，让变更永久生效：</p> 
 <div class="has"> 
  <pre class="has"><code>cnxn.commit()</code></pre> 
 </div> 
 <p><b>下一步</b></p> 
 <p>一旦执行了需要执行的任何操作任务，就可以把数据提取到Python中，也可以将数据提取到Python中，在Python中进行操作。</p> 
 <p>无论采用哪种方法，一旦Python中有了数据，就可以做很多以前无法做到的事情。</p> 
 <p>也许需要执行一些日常报告，通常使用这些报告查询SQL 服务器中的最新数据，计算基本统计信息，然后通过电子邮件发送结果。如何自动化这一过程呢？</p> 
 <div class="has"> 
  <pre class="has"><code># imports for SQL data part
       import pyodbc
       from datetime import datetime,timedelta
       import pandas as pd
             # imports forsending email
       from email.mime.text importMIMEText
       fromemail.mime.multipart importMIMEMultipart
       import smtplib
             date = datetime.today() -timedelta(days=7)  # get the date 7 days ago
             date = date.strftime("%Y-%m-%d")  # convert to format yyyy-mm-dd
             cnxn = pyodbc.connect(cnxn_str)  # initialise connection (assume we havealready defined cnxn_str)
             # build up ourquery string
       query = ("SELECT *FROM customers "
               f"WHERE joinDate &gt; '{date}'")
             # execute thequery and read to a dataframe in Python
       data = pd.read_sql(query, cnxn)
             del cnxn  # close the connection
             # make a fewcalculations
       mean_payment = data['payment'].mean()
       std_payment = data['payment'].std()
             # get maxpayment and product details
       max_vals = data[['product', 'payment']].sort_values(by=['payment'], ascending=False).iloc[0]
             # write an emailmessage
       txt = (f"Customerreporting for period {date} - {datetime.today().strftime('%Y-%m-%d')}.nn"
             f"Mean payment amounts received: {mean_payment}n"
             f"Standard deviation of payment amounts: {std_payments}n"
             f"Highest payment amount of {max_vals['payment']} "
             f"received from {max_vals['product']} product.")
             # we will built themessage using the email library and send using smtplib
       msg =MIMEMultipart()
       msg['Subject'] ="Automatedcustomer report"  # set emailsubject
       msg.attach(MIMEText(txt))  # add text contents
             # we will sendvia outlook, first we initialise connection to mail server
       smtp = smtplib.SMTP('smtp-mail.outlook.com', '587')
       smtp.ehlo()  # say hello to the server
       smtp.starttls()  # we will communicate using TLSencryption
                # login to outlookserver, using generic email and password
       smtp.login('joebloggs@outlook.com', 'Password123')
                # send email to ourboss
       smtp.sendmail('joebloggs@outlook.com', 'joebloggsboss@outlook.com', msg.as_string())
                # finally,disconnect from the mail server
       smtp.quit()</code></pre> 
 </div> 
 <p>至此，任务结束！运行此代码快速提取前一周的数据，计算关键指标，并把摘要发送给老板。</p> 
 <p></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/33/ce/ZsECAZ7H_o.png" alt="cf89fad010b8cb89292ab5b610e025b6.png"> 
 </div> 
 <figcaption>
   图源：pexels 
 </figcaption> 
 <p>通过简单的步骤，我们了解了如何通过使用SQL和Python的集成来快速建立更高效、自动化的工作流程。不仅仅可以用来做本例中的事，它还有很多用途等你开发。</p> 
 <p>Python开辟了新路线，完成了以前仅使用SQL无法完成的操作。这对最强官配，实现了1+1大于2的效果。</p> 
 <p></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/9e/f4/LwxjtpEv_o.png" alt="9c426838486844b285007ad4f489c838.png"> 
 </div> 
 <p><b>留言点赞关注</b></p> 
 <p><b>我们一起分享AI学习与发展的干货</b></p> 
 <p>编译组：李林虹、齐欣</p> 
 <p>相关链接：https://towardsdatascience.com/sql-server-with-python-679b8dba69fa</p> 
 <p>如转载，请私信小芯，遵守转载规范</p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a68a93399a6678d4e22a53ca34f637fb/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">cicd持续集成全程_GitLabCI/CD自动集成和部署到远程服务器</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f0bc002a387444746b0928ef57c759a4/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">pom文件下载</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>