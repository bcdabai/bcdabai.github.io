<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>win2008 64位支持32位Asp.net程序 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="win2008 64位支持32位Asp.net程序" />
<meta property="og:description" content="最近在windows2008 x64位系统下的IIS7下部署asp.net程序。
vs2005或vs2008默认的情况下是Any cpu 的也就是支持x86和x64两种系统的。可我的程序在引用了一个三方dll组件时引起了这样的错误：
错误“/test”应用程序中的服务器错误。 -------------------------------------------------------------------------------- 未能加载文件或程序集“XXX”或它的某一个依赖项。试图加载格式不正确的程序。 说明: 执行当前 Web 请求期间，出现未处理的异常。请检查堆栈跟踪信息，以了解有关该错误以及代码中导致错误的出处的详细信息。 异常详细信息: System.BadImageFormatException: 未能加载文件或程序集“XXX”或它的某一个依赖项。试图加载格式不正确的程序。 源错误: 执行当前 Web 请求期间生成了未处理的异常。可以使用下面的异常堆栈跟踪信息确定有关异常原因和发生位置的信息。 程序集加载跟踪: 下列信息有助于确定程序集“XXX”无法加载的原因。 警告: 程序集绑定日志记录被关闭。 要启用程序集绑定失败日志记录，请将注册表值 [HKLM\Software\Microsoft\Fusion!EnableLog] (DWORD)设置为 1。 注意: 会有一些与程序集绑定失败日志记录关联的性能损失。 要关闭此功能，请移除注册表值 [HKLM\Software\Microsoft\Fusion!EnableLog]。 在网上搜索了N久。查询到如下信息。
ASP.NET 程序在编译的时候默认是Any CPU ，即编译的程序可以在X86 、X64 系统平台上运行。若希望我们的ASP.NET 程序运行在X64 系统上，我们所要做的仅仅是部署IIS ，修改配置。 若想程序运行于IIS32 位模式下，即运行在.net framwork32 位下进行如下配置： 1.cscript %systemdrive%\inetpub\adminscripts\adsutil.vbs set w3svc/appPools/enable32bitapponwin64 1 修改IIS 配置，允许32 位程序运行 2.C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\aspnet_regiis -i 为IIS 注册asp.net32 。注册后在IIS 的web 扩展里显示的是Asp.net2.0.*32bit 。 3.Web 扩展里允许 Asp.net2.0.*32bit 运行。运行的是w3wp32.exe 进程。 二.64 位模式 1.cscript %systemdrive%\inetpub\adminscripts\adsutil." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/e89b14d4638e4c79edbcde580c249874/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2014-05-21T13:23:42+08:00" />
<meta property="article:modified_time" content="2014-05-21T13:23:42+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">win2008 64位支持32位Asp.net程序</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div id="cnblogs_post_body"> 
 <p>最近在windows2008 x64位系统下的IIS7下部署asp.net程序。</p> 
 <p>vs2005或vs2008默认的情况下是Any cpu 的也就是支持x86和x64两种系统的。可我的程序在引用了一个三方dll组件时引起了这样的错误：</p> 
 <p> </p> 
 <fieldset> 
  <legend>错误</legend>“/test”应用程序中的服务器错误。 
  <br> -------------------------------------------------------------------------------- 
  <br> 
  <br> 未能加载文件或程序集“XXX”或它的某一个依赖项。试图加载格式不正确的程序。 
  <br> 说明: 执行当前 Web 请求期间，出现未处理的异常。请检查堆栈跟踪信息，以了解有关该错误以及代码中导致错误的出处的详细信息。 
  <br> 
  <br> 异常详细信息: System.BadImageFormatException: 未能加载文件或程序集“XXX”或它的某一个依赖项。试图加载格式不正确的程序。 
  <br> 
  <br> 源错误: 
  <br> 
  <br> 执行当前 Web 请求期间生成了未处理的异常。可以使用下面的异常堆栈跟踪信息确定有关异常原因和发生位置的信息。 
  <br> 
  <br> 程序集加载跟踪: 下列信息有助于确定程序集“XXX”无法加载的原因。 
  <br> 
  <br> 警告: 程序集绑定日志记录被关闭。 
  <br> 要启用程序集绑定失败日志记录，请将注册表值 [HKLM\Software\Microsoft\Fusion!EnableLog] (DWORD)设置为 1。 
  <br> 注意: 会有一些与程序集绑定失败日志记录关联的性能损失。 
  <br> 要关闭此功能，请移除注册表值 [HKLM\Software\Microsoft\Fusion!EnableLog]。 
 </fieldset> 
 <p>在网上搜索了N久。查询到如下信息。</p> 
 <fieldset> 
  <legend></legend>ASP.NET 
  <span style="font-family:宋体">程序在编译的时候默认是</span>Any CPU 
  <span style="font-family:宋体">，即编译的程序可以在</span>X86 
  <span style="font-family:宋体">、</span>X64 
  <span style="font-family:宋体">系统平台上运行。若希望我们的</span>ASP.NET 
  <span style="font-family:宋体">程序运行在</span>X64 
  <span style="font-family:宋体">系统上，我们所要做的仅仅是部署</span>IIS 
  <span style="font-family:宋体">，修改配置。</span> 
  <br> 
  <span style="font-family:宋体">若想程序运行于</span>IIS32 
  <span style="font-family:宋体">位模式下，即运行在</span>.net framwork32 
  <span style="font-family:宋体">位下进行如下配置：</span> 
  <br> 1.cscript %systemdrive%\inetpub\adminscripts\adsutil.vbs set w3svc/appPools/enable32bitapponwin64 1 
  <span style="font-family:宋体">修改</span>IIS 
  <span style="font-family:宋体">配置，允许</span>32 
  <span style="font-family:宋体">位程序运行</span> 
  <br> 2.C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\aspnet_regiis -i 
  <span style="font-family:宋体"> 为</span>IIS 
  <span style="font-family:宋体">注册</span>asp.net32 
  <span style="font-family:宋体">。注册后在</span>IIS 
  <span style="font-family:宋体">的</span>web 
  <span style="font-family:宋体">扩展里显示的是</span>Asp.net2.0.*32bit 
  <span style="font-family:宋体">。</span> 
  <br> 3.Web 
  <span style="font-family:宋体">扩展里允许</span> Asp.net2.0.*32bit 
  <span style="font-family:宋体">运行。运行的是</span>w3wp32.exe 
  <span style="font-family:宋体">进程。</span> 
  <br> 
  <span style="font-family:宋体">二</span>.64 
  <span style="font-family:宋体">位模式</span> 
  <br> 1.cscript %systemdrive%\inetpub\adminscripts\adsutil.vbs set w3svc/appPools/enable32bitapponwin64 0 
  <span style="font-family:宋体">默认就是</span>0 
  <span style="font-family:宋体">，若原来运行了</span>32 
  <span style="font-family:宋体">位程序，则需要重新设置为</span>0 
  <span style="font-family:宋体">。</span> 
  <br> 2.C:\WINDOWS\Microsoft.NET\Framework64\v2.0.50727\aspnet_regiis - i 
  <span style="font-family:宋体"> 为</span>IIS 
  <span style="font-family:宋体">注册</span>64 
  <span style="font-family:宋体">为</span>Asp.NET 
  <span style="font-family:宋体">。注册了</span>64 
  <span style="font-family:宋体">位</span>ASP.NET 
  <span style="font-family:宋体">的</span>IIS 
  <span style="font-family:宋体">在</span>Web 
  <span style="font-family:宋体">扩展里显示的是</span>Asp.net2.0.* 
  <span style="font-family:宋体">。</span> 
  <br> 3.Web 
  <span style="font-family:宋体">扩展里允许</span> Asp.net2.0.* 
  <span style="font-family:宋体">运行。运行的是</span>w3wp.exe 
  <span style="font-family:宋体">进程。</span> 
 </fieldset> 
 <p>处理后还是没有出现“w3wp32.exe<span style="font-family:宋体">进程</span>”。</p> 
 <p>但我的 Web<span style="font-family:宋体">扩展</span>里面是有， Asp.net2.0的32位设置为允许的。</p> 
 <p>后新建了应用程序池，<strong><span style="color:red">在新建的应用程序池的“高级设置”</span><span style="color:red">里面，把“启用32位应用程序”设置为true。</span></strong></p> 
 <p>程序可以运行了。</p> 
 <p>因为我的机器已经设置过，cscript %systemdrive%\inetpub\adminscripts\adsutil.vbs set w3svc/appPools/enable32bitapponwin64 1 为32位。</p> 
 <p>为了测试，我又把它设置为64位：cscript %systemdrive%\inetpub\adminscripts\adsutil.vbs set w3svc/appPools/enable32bitapponwin64 0</p> 
 <p>此时，程序还是可以运行。</p> 
 <p>所以我认为：不用按照上面的1，2，3步设置开启32位。仅仅设置应用程序池中“启动32位应用程序”为true。此时应该就可以运行32位的程序了。</p> 
 <p> </p> 
 <p>如果有人在X64位系统上，运行32位的asp.net程序，可以直接试试用<strong><span style="color:red">把“启用32位应用程序”设置为true。</span></strong>的方法。</p> 
 <p><br> </p> 
 <p><br> </p> 
 <p>此文系转载，原地址：http://www.cnblogs.com/angelasp/archive/2013/06/08/3126941.html<br> </p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1b4e1eddc6fad585db0078a24d326831/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">linux上安装oracle后，客户端连接报出ORA-12505的解决方法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/bfa86ad810e4bcd3982bdcbdbcff78e5/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">javascript for语句最佳实践</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>