<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>vue 使用高德JSapi 实现轨迹回放和海量点效果（点击显示详情提示窗口） 采用AMapLoader 和 AMapUI - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="vue 使用高德JSapi 实现轨迹回放和海量点效果（点击显示详情提示窗口） 采用AMapLoader 和 AMapUI" />
<meta property="og:description" content="第一步 注册高德开发者平台账号 （个人选择个人账户） 地址见 https://lbs.amap.com/api
第二步 在控制台中申请Key（输入key，选择web端，提交即可）
第三步 通过JSApi Loader 获取高德Api 来结合Vue
按 NPM 方式安装使用 Loader ：
npm i @amap/amap-jsapi-loader --save ​
第四步 Vue项目中示例
轨迹回放（巡航器）实例：
巡航效果图：
&lt;div id=&#34;container&#34;&gt;&lt;/div&gt; data() { return { map: null, }; }, mounted() { this.initMap(); }, ！！！注意：使用的是Loader 使用时需要引入
import AMapLoader from &#34;@amap/amap-jsapi-loader&#34;;
initMap() { AMapLoader.load({ key: &#34;xxxxxxx&#34;, // 申请好的Web端开发者Key，首次调用 load 时必填 version: &#34;2.0&#34;, // 指定要加载的 JSAPI 的版本，缺省时默认为 1.4.15 plugins: [ &#34;AMap.ToolBar&#34;, &#34;AMap.Scale&#34;, &#34;AMap.HawkEye&#34;, &#34;AMap.MapType&#34;, &#34;AMap.Geolocation&#34;, &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/4083e4b652f030a512f7d6ff765e3444/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-09-07T09:52:13+08:00" />
<meta property="article:modified_time" content="2022-09-07T09:52:13+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">vue 使用高德JSapi 实现轨迹回放和海量点效果（点击显示详情提示窗口） 采用AMapLoader 和 AMapUI</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p></p> 
<p>第一步 注册高德开发者平台账号 （个人选择个人账户） 地址见 <a href="https://lbs.amap.com/api" rel="nofollow" title="https://lbs.amap.com/api">https://lbs.amap.com/api</a></p> 
<p>第二步 在控制台中申请Key（输入key，选择web端，提交即可）</p> 
<p><img alt="" height="738" src="https://images2.imgbox.com/72/47/acQicWfP_o.png" width="1200"></p> 
<p> 第三步 通过JSApi Loader 获取高德Api 来结合Vue</p> 
<p>按 NPM 方式安装使用 Loader ：</p> 
<div> 
 <pre><code>npm i @amap/amap-jsapi-loader --save</code></pre> 
</div> 
<p><img alt="" height="768" src="https://images2.imgbox.com/2a/3a/sh1Pf42A_o.png" width="1200">​</p> 
<p></p> 
<p>第四步 Vue项目中示例</p> 
<p>轨迹回放（巡航器）实例：</p> 
<p> 巡航效果图：</p> 
<p><img alt="" height="788" src="https://images2.imgbox.com/cb/dc/o41HVEbe_o.png" width="1200"></p> 
<pre><code class="language-html">&lt;div id="container"&gt;&lt;/div&gt;</code></pre> 
<pre><code class="language-javascript"> data() {
    return {
      map: null,
    };
  },
  mounted() {
    this.initMap();
  },</code></pre> 
<p> ！！！注意：使用的是Loader 使用时需要引入</p> 
<p> import AMapLoader from "@amap/amap-jsapi-loader";</p> 
<pre><code class="language-javascript"> initMap() {
      AMapLoader.load({
        key: "xxxxxxx", // 申请好的Web端开发者Key，首次调用 load 时必填
        version: "2.0", // 指定要加载的 JSAPI 的版本，缺省时默认为 1.4.15
        plugins: [
          "AMap.ToolBar",
          "AMap.Scale",
          "AMap.HawkEye",
          "AMap.MapType",
          "AMap.Geolocation",
          "AMap.ControlBar",
          "AMap.Driving",
        ], // 需要使用的的插件列表，如比例尺'AMap.Scale'等
        AMapUI: {
          // 是否加载 AMapUI，缺省不加载
          version: "1.1", // AMapUI 缺省 1.1
          plugins: [], // 需要加载的 AMapUI ui插件
        },
      })
        .then((AMap) =&gt; {
          this.map = new AMap.Map("container", {
            //设置地图容器id
            viewMode: "3D", //是否为3D地图模式
            //  pitch:45, // 地图俯仰角度，有效范围 0 度- 83 度
            terrain: true, // 开启地形图
            zoom: 10, //初始化地图级别
            // "AMapUI": {             // 是否加载 AMapUI，缺省不加载
            //     version: '1.0',
            //     plugins: ['overlay/SimpleMarker']//SimpleMarker设置自定义图标，PathSimplifier轨迹展示组件
            // },
          });
          // 在图面添加工具条控件，工具条控件集成了缩放、平移、定位等功能按钮在内的组合控件
          //   this.map.addControl(new AMap.ToolBar());

          // 在图面添加比例尺控件，展示地图在当前层级和纬度下的比例尺
          this.map.addControl(new AMap.Scale());

          // // 在图面添加鹰眼控件，在地图右下角显示地图的缩略图
          //   this.map.addControl(new AMap.HawkEye({ isOpen: true }));

          // // 在图面添加类别切换控件，实现默认图层与卫星图、实施交通图层之间切换的控制
          this.map.addControl(new AMap.MapType());

          // // 在图面添加定位控件，用来获取和展示用户主机所在的经纬度位置
          //   this.map.addControl(new AMap.Geolocation());
            this.routeLine();
        })
        .catch((e) =&gt; {
          console.log(e);
        });
    },</code></pre> 
<pre><code class="language-javascript"> routeLine() {
      AMapUI.load(["ui/misc/PathSimplifier", "lib/$"], (PathSimplifier, $) =&gt; {
        if (!PathSimplifier.supportCanvas) {
          alert("当前环境不支持 Canvas！");
          return;
        }
        var pathSimplifierIns = new PathSimplifier({
          zIndex: 100,
          //autoSetFitView:false,
          map: this.map, //所属的地图实例

          getPath: function (pathData, pathIndex) {
            return pathData.path;
          },
          getHoverTitle: function (pathData, pathIndex, pointIndex) {
            if (pointIndex &gt;= 0) {
              //point
              return (
                pathData.name +
                "，点：" +
                pointIndex +
                "/" +
                pathData.path.length
              );
            }

            return pathData.name + "，点数量" + pathData.path.length;
          },
          renderOptions: {
            renderAllPointsIfNumberBelow: 100, //绘制路线节点，如不需要可设置为-1
          },
        });

        window.pathSimplifierIns = pathSimplifierIns;
        pathSimplifierIns.setData([
          {
            name: "路线0",
            path: data.data.list[0], // data为后端接口数据
          },
        ]);

        //对第一条线路（即索引 0）创建一个巡航器
        // this.map.on('complete', function() {
        var navg1 = pathSimplifierIns.createPathNavigator(0, {
          // loop: true, //循环播放
          speed: 50, //巡航速度，单位千米/小时
        });
        navg1.start();
        // })
      });
    },</code></pre> 
<p>如果需要回放功能，执行下面的函数即可</p> 
<pre><code class="language-javascript">// 回放功能
    Repeat() {
        if (window.pathSimplifierIns) {
          //通过该方法清空上次传入的轨迹
          pathSimplifierIns.setData([
            {
              name: "路线0",
              path: data.data.list[0],
            },
          ]);
        }
        pathSimplifierIns
          .createPathNavigator(0, {
            // loop: true, //循环播放
            speed: 50 , //巡航速度，单位千米/小时
          })
          .start();
    },</code></pre> 
<p></p> 
<p>巡航效果切换为海量点，点击海量点显示信息弹窗：</p> 
<p>海量点效果图：</p> 
<p><img alt="" height="800" src="https://images2.imgbox.com/c9/a3/OuXYIjcx_o.png" width="1200"></p> 
<p> 前面的代码都一样，切换为海量点时（随便设置一个flag），只需要initMap函数调用的routeLine函数替换为pointScreen函数即可。</p> 
<p>pointScreen函数代码如下：</p> 
<pre><code class="language-javascript">  pointScreen() {
      AMapUI.load(
        ["ui/misc/PointSimplifier", "lib/$"],
        (PointSimplifier, $) =&gt; {
          if (!PointSimplifier.supportCanvas) {
            alert("当前环境不支持 Canvas！");
            return;
          }
          var pointSimplifierIns = new PointSimplifier({
            map: this.map,
            getPosition: function (item) {
              //   console.log(item);
              if (!item) return null;

              var parts = item.geometry.coordinates;
              return [parseFloat(parts[0]), parseFloat(parts[1])];
            },
            getHoverTitle: function (dataItem, idx) {
                //dataItem 是下面传入数据pointdata的元素，结构也取决于pointdata
              let html = `
              &lt;div class="hoverbox"&gt;
                &lt;div class="hoverbox_content"&gt;
                    &lt;p&gt;时间：${dataItem.properties.time}&lt;/p&gt;
                    &lt;p&gt;流速：${dataItem.properties.flow} L/min&lt;/p&gt;
                    &lt;p&gt;定位精度：${dataItem.properties.accu} m&lt;/p&gt;
                    &lt;p&gt;航向：${dataItem.properties.course} °&lt;/p&gt;
                    &lt;p&gt;消息：${dataItem.properties.mtime}&lt;/p&gt;
                    &lt;p&gt;类型：${
                      dataItem.properties.type === "Feature" ? "实时" : ""
                    }&lt;/p&gt;
                    &lt;p&gt;频率：${dataItem.properties.interval} s&lt;/p&gt;
                &lt;/div&gt;
               &lt;/div&gt;`;
              return html;
            },

            renderOptions: {
              //点的样式
              //点的样式
              pointStyle: {
                //绘制点占据的矩形区域
                content: PointSimplifier.Render.Canvas.getImageContent(
                  "https://webapi.amap.com/theme/v1.3/markers/n/mark_b1.png",
                  function onload() {
                    pointSimplifierIns.renderLater();
                  },
                  function onerror(e) {
                    alert("图片加载失败！");
                  }
                ),
                //宽度
                width: 19,
                //高度
                height: 31,
                //定位点为底部中心
                offset: ["-50%", "-100%"],
                fillStyle: null,
                strokeStyle: null,
              },
              //鼠标hover时的title信息
              hoverTitleStyle: {
                position: "top",
                classNames: "hoverbox",
              },
            },
          });
          pointSimplifierIns.on("pointClick", (e, dataItem) =&gt; {
            this.infoBox(dataItem);
          });

          window.pointSimplifierIns = pointSimplifierIns;
          pointSimplifierIns.setData(pointdata); //pointdata应该为后端接口数据，这里自己模拟的数据
        }
      );
    },</code></pre> 
<pre><code class="language-javascript"> infoBox(dataItem) {
      let html = `
              &lt;div  class='hoverbox'&gt;
                &lt;div class="hoverbox_content"&gt;
                    &lt;p&gt;时间：${dataItem.data.properties.time}&lt;/p&gt;
                    &lt;p&gt;流速：${dataItem.data.properties.flow} L/min&lt;/p&gt;
                    &lt;p&gt;定位精度：${dataItem.data.properties.accu} m&lt;/p&gt;
                    &lt;p&gt;航向：${dataItem.data.properties.course} °&lt;/p&gt;
                    &lt;p&gt;消息：${dataItem.data.properties.mtime}&lt;/p&gt;
                    &lt;p&gt;类型：${
                      dataItem.data.properties.type === "Feature" ? "实时" : ""
                    }&lt;/p&gt;
                    &lt;p&gt;频率：${dataItem.data.properties.interval} s&lt;/p&gt;
                &lt;/div&gt;
               &lt;/div&gt;`;
      var infoWindow = new AMap.InfoWindow({
        content: html, //使用默认信息窗体框样式，显示信息内容
        offset: new AMap.Pixel(0, -31),
        isCustom:true,//是否自定义窗体。设为true时，信息窗体外框及内容完全按照content所设的值添加（默认为false，即在系统默认的信息窗体外框中显示content内容）
        autoMove:true,//是否自动调整窗体到视野内（当信息窗体超出视野范围时，通过该属性设置是否自动平移地图，使信息窗体完全显示）
        retainWhenClose:true, //信息窗体关闭时，是否将其Dom元素从页面中移除，默认为false
        zIndex:100000 //官网没有写明这个属性。导致海量点和信息弹窗蒙层出现问题。在content的样式hoverbox中添加z-index没有效果。我也是尝试了很久，在这里添加了zIndex 就可以了

      });
      infoWindow.open(this.map, dataItem.data.geometry.coordinates);
    },</code></pre> 
<p>关闭的回调我没有去写，很简单，官网写的很详细了</p> 
<p><img alt="" height="498" src="https://images2.imgbox.com/a6/cc/rhjeQBER_o.png" width="1104"></p> 
<p> 上面使用到的数据比较大（动辄上万），不好粘贴（我的数据也是捞网站上面的接口数据到本地的）。</p> 
<p>官网有mock 数据 大家可以看一下</p> 
<p>比如这个城市数据 ：<a href="https://a.amap.com/jsapi_demos/static/citys.js" rel="nofollow" title="https://a.amap.com/jsapi_demos/static/citys.js">https://a.amap.com/jsapi_demos/static/citys.js</a></p> 
<p>巡航的部分数据：</p> 
<p><img alt="" height="763" src="https://images2.imgbox.com/f2/7a/0P5vb07A_o.png" width="844"></p> 
<p> 海量点的数据部分：</p> 
<p><img alt="" height="870" src="https://images2.imgbox.com/e0/ed/AdO6rlue_o.png" width="1200"></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/41571f58eddbb0e8afdcfb7d41d3029d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">AUTO_TUNE 配置参数</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8643eff5017fdf1eef15128ce3298d99/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">安装mysql时的修改初始密码</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>