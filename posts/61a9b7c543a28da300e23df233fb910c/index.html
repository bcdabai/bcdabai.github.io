<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>linux服务器openSSH升级 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="linux服务器openSSH升级" />
<meta property="og:description" content="修复流程
下载安装包 &gt; 备份旧版 ssh 配置 &gt; 安装依赖包 &gt; 其他准备工作 &gt; 编译安装 &gt; 创建软连接等文件 &gt; 修改配置允许 root 登录 &gt; 配置开机启动 &gt; 检查是否安装成功 &gt; 完成
风险概述
此方案升级过程不会关闭旧版 ssh 服务，无需担心安装失败无法导致远程连接。如果服务器在外地机房且无人值守，请谨慎操作。
修复依据 根据漏洞原理修复
操作前提 无
查看版本：openssh -V
具体操作步骤如下：
步骤 1 1）下载最新版源码包
下载地址： https://www.openssh.com/releasenotes.html
2）上传包至服务器
cd home ,rz本地传送（若未找到命令yum install -y lrzsz）
步骤 2 备份旧版 SSH
mv /usr/sbin/sshd /usr/sbin/sshd.old
mv /usr/bin/ssh /usr/bin/ssh.old
如果旧版本是源码安装的 OpenSSH，建议备份整个 openssh 目录：
mv /usr/local/openssh /usr/local/openssh.old
步骤 3 安装依赖
yum -y install zlib-devel openssl-devel gcc" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/61a9b7c543a28da300e23df233fb910c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-03-14T09:21:39+08:00" />
<meta property="article:modified_time" content="2022-03-14T09:21:39+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">linux服务器openSSH升级</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>修复流程<br>   下载安装包 &gt; 备份旧版 ssh 配置 &gt; 安装依赖包 &gt; 其他准备工作 &gt; 编译安装 &gt; 创建软连接等文件 &gt; 修改配置允许 root 登录 &gt; 配置开机启动 &gt; 检查是否安装成功 &gt; 完成</p> 
<p>风险概述<br>   此方案升级过程不会关闭旧版 ssh 服务，无需担心安装失败无法导致远程连接。如果服务器在外地机房且无人值守，请谨慎操作。</p> 
<p>修复依据 根据漏洞原理修复</p> 
<p>操作前提 无</p> 
<p>查看版本：openssh -V</p> 
<p>具体操作步骤如下：</p> 
<p>步骤 1 <br> 1）下载最新版源码包<br>   下载地址： https://www.openssh.com/releasenotes.html<br> 2）上传包至服务器<br>   cd home ,rz本地传送（若未找到命令yum install -y lrzsz）</p> 
<p>步骤 2 备份旧版 SSH<br>   mv /usr/sbin/sshd /usr/sbin/sshd.old<br>   mv /usr/bin/ssh /usr/bin/ssh.old<br> 如果旧版本是源码安装的 OpenSSH，建议备份整个 openssh 目录：<br>   mv /usr/local/openssh /usr/local/openssh.old</p> 
<p>步骤 3 安装依赖<br>   yum -y install zlib-devel openssl-devel gcc</p> 
<p>步骤 4 解压安装<br>   tar -zxvf openssh-8.8p1.tar.gz<br>   cd openssh-8.8p1<br>   ll /usr/local/<br>   ./configure --prefix=/usr/local/openssh<br>   make<br>   make install<br>   ll /usr/local/openss</p> 
<p>步骤 5 替换密钥文件<br> 1）备份密钥：<br>   cp -r /usr/local/openssh/etc /usr/local/openssh/etc.bak<br> 2）替换为旧版 SSH 密钥：<br>   cp /etc/ssh/ssh_host_* /usr/local/openssh/etc</p> 
<p>步骤 6 验证是否安装成功<br> 1）修改配置文件：vi /usr/local/openssh/etc/sshd_config<br>   将 Port 改为 222<br>   #PermitRootLogin prohibit-password 改为 PermitRootLogin yes<br> 2）启动新版 ssh：<br>   /usr/local/openssh/sbin/sshd<br> 3）从其他服务器上测试远程连接：<br>   ssh IP -p 222如果正常连接则表示安装成功<br> 如果连接失败：请检查是否被防火墙拦截：<br>   systemctl status firewalld<br> 如果开启了防火墙，将其关闭即可：<br>   systemctl stop firewalld</p> 
<p>步骤 7 重启 ssh 服务<br> 1）恢复配置文件：<br>   vi /usr/local/openssh/etc/sshd_config<br>   将 Port 改回 22。<br> 2）创建新版 ssh 软连接<br>   ln -s /usr/local/openssh/sbin/sshd /usr/sbin/<br>   ln -s /usr/local/openssh/bin/ssh /usr/bin/<br> 3）重启服务<br>   systemctl restart sshd</p> 
<p>重启失败解决办法：<br> 如果出现启动超时的现象，安照以下步骤解决：<br> 1）移除 sshd.service 文件<br>   mv /lib/systemd/system/sshd.service /lib/systemd/system/ssh.service.bak<br> 2） 从 openssh 源码包中复制一个 sshd 启动脚本<br>   cp openssh-8.8p1/contrib/redhat/sshd.init /etc/init.d/sshd<br> 3） 修改权限<br>   chmod 755 /etc/init.d/sshd<br> 4） 添加自启动<br>   chkconfig --add sshd<br>   chkconfig sshd on<br> 5） 重启 sshd<br>   systemctl daemon-reexec<br>   systemctl restart sshd</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d295c5d0c608d123ee2a26421155a41f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Python笔记-SQLAlchemy Model转dict（主流方法，一行解决）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e2c2c0835a6fcde3c463d3f3e5c95a7c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">linux中zookeeper升级</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>