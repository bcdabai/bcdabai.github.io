<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Java 导出Excel表格生成下拉框-EasyExcel - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Java 导出Excel表格生成下拉框-EasyExcel" />
<meta property="og:description" content="1.导入EasyExcel，maven依赖 &lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;easyexcel&lt;/artifactId&gt; &lt;version&gt;2.2.10&lt;/version&gt; &lt;/dependency&gt; 2.添加EasyExcelUtil工具类 package org.springblade.modules.system.EuipmentExcelImplement; import com.alibaba.excel.EasyExcel; import com.alibaba.excel.annotation.ExcelProperty; import com.alibaba.excel.write.metadata.WriteSheet; import lombok.extern.slf4j.Slf4j; import java.lang.reflect.Field; import java.util.HashMap; import java.util.Map; @Slf4j public class EasyExcelUtil { /** * 创建即将导出的sheet页（sheet页中含有带下拉框的列） * @param head 导出的表头信息和配置 * @param sheetNo sheet索引 * @param sheetName sheet名称 * @param &lt;T&gt; 泛型 * @return sheet页 */ public static &lt;T&gt; WriteSheet writeSelectedSheet(Class&lt;T&gt; head, Integer sheetNo, String sheetName) { Map&lt;Integer, ExcelSelectedResolve&gt; selectedMap = resolveSelectedAnnotation(head); return EasyExcel.writerSheet(sheetNo, sheetName) ." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/bfa2860cff0e944bea3484b51a97026e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-07-04T16:49:01+08:00" />
<meta property="article:modified_time" content="2023-07-04T16:49:01+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Java 导出Excel表格生成下拉框-EasyExcel</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>1.导入EasyExcel，maven依赖</h2> 
<pre><code class="language-java">        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba&lt;/groupId&gt;
            &lt;artifactId&gt;easyexcel&lt;/artifactId&gt;
            &lt;version&gt;2.2.10&lt;/version&gt;
        &lt;/dependency&gt;</code></pre> 
<h2>2.添加EasyExcelUtil工具类</h2> 
<pre><code class="language-java">package org.springblade.modules.system.EuipmentExcelImplement;

import com.alibaba.excel.EasyExcel;
import com.alibaba.excel.annotation.ExcelProperty;
import com.alibaba.excel.write.metadata.WriteSheet;
import lombok.extern.slf4j.Slf4j;

import java.lang.reflect.Field;
import java.util.HashMap;
import java.util.Map;

@Slf4j
public class EasyExcelUtil {

	/**
	 * 创建即将导出的sheet页（sheet页中含有带下拉框的列）
	 * @param head 导出的表头信息和配置
	 * @param sheetNo sheet索引
	 * @param sheetName sheet名称
	 * @param &lt;T&gt; 泛型
	 * @return sheet页
	 */
	public static &lt;T&gt; WriteSheet writeSelectedSheet(Class&lt;T&gt; head, Integer sheetNo, String sheetName) {
		Map&lt;Integer, ExcelSelectedResolve&gt; selectedMap = resolveSelectedAnnotation(head);

		return EasyExcel.writerSheet(sheetNo, sheetName)
			.head(head)
			.registerWriteHandler(new SelectedSheetWriteHandler(selectedMap))
			.build();
	}

	/**
	 * 解析表头类中的下拉注解
	 * @param head 表头类
	 * @param &lt;T&gt; 泛型
	 * @return Map&lt;下拉框列索引, 下拉框内容&gt; map
	 */
	private static &lt;T&gt; Map&lt;Integer, ExcelSelectedResolve&gt; resolveSelectedAnnotation(Class&lt;T&gt; head) {
		Map&lt;Integer, ExcelSelectedResolve&gt; selectedMap = new HashMap&lt;&gt;();

		// getDeclaredFields(): 返回全部声明的属性；getFields(): 返回public类型的属性
		Field[] fields = head.getDeclaredFields();
		for (int i = 0; i &lt; fields.length; i++){
			Field field = fields[i];
			// 解析注解信息
			ExcelSelected selected = field.getAnnotation(ExcelSelected.class);
			ExcelProperty property = field.getAnnotation(ExcelProperty.class);
			if (selected != null) {
				ExcelSelectedResolve excelSelectedResolve = new ExcelSelectedResolve();
				String[] source = excelSelectedResolve.resolveSelectedSource(selected);
				if (source != null &amp;&amp; source.length &gt; 0){
					excelSelectedResolve.setSource(source);
					excelSelectedResolve.setFirstRow(selected.firstRow());
					excelSelectedResolve.setLastRow(selected.lastRow());
					if (property != null &amp;&amp; property.index() &gt;= 0){
						selectedMap.put(property.index(), excelSelectedResolve);
					} else {
						selectedMap.put(i, excelSelectedResolve);
					}
				}
			}
		}

		return selectedMap;
	}
}
</code></pre> 
<pre><code class="hljs">package org.springblade.modules.system.EuipmentExcelImplement;

import com.alibaba.excel.write.handler.SheetWriteHandler;
import com.alibaba.excel.write.metadata.holder.WriteSheetHolder;
import com.alibaba.excel.write.metadata.holder.WriteWorkbookHolder;
import lombok.AllArgsConstructor;
import lombok.Data;
import org.apache.poi.ss.usermodel.DataValidation;
import org.apache.poi.ss.usermodel.DataValidationConstraint;
import org.apache.poi.ss.usermodel.DataValidationHelper;
import org.apache.poi.ss.usermodel.Sheet;
import org.apache.poi.ss.util.CellRangeAddressList;

import java.util.Map;

@Data
@AllArgsConstructor
public class SelectedSheetWriteHandler implements SheetWriteHandler {

	private final Map&lt;Integer, ExcelSelectedResolve&gt; selectedMap;

	/**
	 * Called before create the sheet
	 */
	@Override
	public void beforeSheetCreate(WriteWorkbookHolder writeWorkbookHolder, WriteSheetHolder writeSheetHolder) {

	}

	/**
	 * Called after the sheet is created
	 */
	@Override
	public void afterSheetCreate(WriteWorkbookHolder writeWorkbookHolder, WriteSheetHolder writeSheetHolder) {
		// 这里可以对cell进行任何操作
		Sheet sheet = writeSheetHolder.getSheet();
		DataValidationHelper helper = sheet.getDataValidationHelper();
		selectedMap.forEach((k, v) -&gt; {
			// 设置下拉列表的行： 首行，末行，首列，末列
			CellRangeAddressList rangeList = new CellRangeAddressList(v.getFirstRow(), v.getLastRow(), k, k);
			// 设置下拉列表的值
			DataValidationConstraint constraint = helper.createExplicitListConstraint(v.getSource());
			// 设置约束
			DataValidation validation = helper.createValidation(constraint, rangeList);
			// 阻止输入非下拉选项的值
			validation.setErrorStyle(DataValidation.ErrorStyle.STOP);
			validation.setShowErrorBox(true);
			validation.setSuppressDropDownArrow(true);
			validation.createErrorBox("提示", "请输入下拉选项中的内容");
			sheet.addValidationData(validation);
		});
	}
}
</code></pre> 
<h2>3 .创建实体类</h2> 
<pre><code class="language-java">package org.springblade.modules.question.entity;

import com.alibaba.excel.annotation.ExcelIgnore;
import com.alibaba.excel.annotation.ExcelProperty;
import com.alibaba.excel.annotation.write.style.ColumnWidth;
import com.alibaba.excel.annotation.write.style.ContentRowHeight;
import com.alibaba.excel.annotation.write.style.HeadRowHeight;
import io.swagger.annotations.ApiModelProperty;
import lombok.Data;
import org.springblade.modules.question.excelImplement.*;
import org.springblade.modules.system.EuipmentExcelImplement.DeptSelectedImpl;
import org.springblade.modules.system.EuipmentExcelImplement.ExcelSelected;

import java.io.Serializable;


@Data
@ColumnWidth(16)
@HeadRowHeight(20)
@ContentRowHeight(18)
public class QuestionExcel implements Serializable {

	private static final long serialVersionUID = 1L;

	/**
	 * 课程名称
	 */
	@ExcelIgnore //忽略生成表头
	//@ExcelSelected(sourceClass = CourseSelected.class)
	private String courseName;

	/**
	 * 章节名称
	 */
	@ExcelProperty(index = 0,value ="课程章节名称")//表头名称
	@ExcelSelected(sourceClass = ChapterSelected.class)
	private String chapterName;

	/**
	 * 实验名称
	 */
	@ExcelProperty(index = 1,value ="实验名称")
	@ColumnWidth(25)
	@ExcelSelected(sourceClass = ExperimentSelected.class)
	private String experimentName;

	/**
	 * 题型(1:单选2:多选3:判断4:问答)
	 */
	@ExcelProperty(index = 2,value ="题型(1:单选2:多选3:判断4:问答)")
	@ExcelSelected(sourceClass = TypeSelected.class)
	private String questionType;
}</code></pre> 
<h2>4.导入自定义注解ExcelSelected</h2> 
<pre><code class="language-java">package org.springblade.modules.system.EuipmentExcelImplement;

import java.lang.annotation.*;

/**
 * 标注导出的列为下拉框类型，并为下拉框设置内容
 */
@Documented
@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.FIELD)
public @interface ExcelSelected {
	/**
	 * 固定下拉内容
	 */
	String[] source() default {};

	/**
	 * 动态下拉内容
	 */
	Class&lt;? extends ExcelDynamicSelect&gt;[] sourceClass() default {};

	/**
	 * 设置下拉框的起始行，默认为第二行
	 */
	int firstRow() default 1;

	/**
	 * 设置下拉框的结束行，默认为最后一行
	 */
	int lastRow() default 0x10000;
}
</code></pre> 
<h2>5.导入Excel选择解析-ExcelSelectedResolve </h2> 
<pre><code class="language-java">package org.springblade.modules.system.EuipmentExcelImplement;

import lombok.Data;
import lombok.extern.slf4j.Slf4j;

@Data
@Slf4j
public class ExcelSelectedResolve {
	/**
	 * 下拉内容
	 */
	private String[] source;

	/**
	 * 设置下拉框的起始行，默认为第二行
	 */
	private int firstRow;

	/**
	 * 设置下拉框的结束行，默认为最后一行
	 */
	private int lastRow;

	public String[] resolveSelectedSource(ExcelSelected excelSelected) {
		if (excelSelected == null) {
			return null;
		}

		// 获取固定下拉框的内容
		String[] source = excelSelected.source();
		if (source.length &gt; 0) {
			return source;
		}

		// 获取动态下拉框的内容
		Class&lt;? extends ExcelDynamicSelect&gt;[] classes = excelSelected.sourceClass();
		if (classes.length &gt; 0) {
			try {
				ExcelDynamicSelect excelDynamicSelect = classes[0].newInstance();
				String[] dynamicSelectSource = excelDynamicSelect.getSource();
				if (dynamicSelectSource != null &amp;&amp; dynamicSelectSource.length &gt; 0) {
					return dynamicSelectSource;
				}
			} catch (InstantiationException | IllegalAccessException e) {
				log.error("解析动态下拉框数据异常", e);
			}
		}
		return null;
	}
}
</code></pre> 
<h2>6.添加动态选择接口-ExcelDynamicSelect</h2> 
<pre><code class="language-java">package org.springblade.modules.system.EuipmentExcelImplement;

public interface ExcelDynamicSelect {
	/**
	 * 获取动态生成的下拉框可选数据
	 * @return 动态生成的下拉框可选数据
	 */
	String[] getSource();
}
</code></pre> 
<h2>7.编写自己需要展示下拉框实现-ExcelDynamicSelect接口</h2> 
<pre><code class="language-java">package org.springblade.modules.question.excelImplement;

import org.apache.commons.collections.CollectionUtils;
import org.springblade.core.log.exception.ServiceException;
import org.springblade.modules.question.mapper.QuestionMapper;
import org.springblade.modules.system.EuipmentExcelImplement.ExcelDynamicSelect;
import org.springblade.modules.system.EuipmentExcelImplement.SpringContextUtil;

import java.util.List;

public class ChapterSelected implements ExcelDynamicSelect {

	@Override
	public String[] getSource() {

		QuestionMapper questionMapper = SpringContextUtil.getBean(QuestionMapper.class);
		return questionMapper.selectAllChapter().toArray(new String[]{});
	}
}
</code></pre> 
<h2>8.添加SpringContextUtil工具类</h2> 
<pre><code class="language-java">package org.springblade.modules.system.EuipmentExcelImplement;

import org.springframework.beans.BeansException;
import org.springframework.context.ApplicationContext;
import org.springframework.context.ApplicationContextAware;
import org.springframework.stereotype.Component;

@Component
public class SpringContextUtil implements ApplicationContextAware {

	private static ApplicationContext applicationContext;

	@Override
	public void setApplicationContext(ApplicationContext applicationContext) throws BeansException {
		SpringContextUtil.applicationContext = applicationContext;
	}

	// 获取ApplicationContext
	public static ApplicationContext getApplicationContext() {
		return applicationContext;
	}

	// 通过class获取Bean
	public static &lt;T&gt; T getBean(Class&lt;T&gt; clazz) {
		return applicationContext.getBean(clazz);
	}

	// 通过name以及class获取Bean
	public static &lt;T&gt; T getBean(String name, Class&lt;T&gt; clazz) {
		return applicationContext.getBean(name, clazz);
	}
}
</code></pre> 
<h2>9.编写查询下拉框显示内容mapping</h2> 
<pre><code class="language-java">public interface QuestionMapper extends BaseMapper&lt;Question&gt; {
public List&lt;String&gt; selectAllChapter();
}</code></pre> 
<pre><code class="language-java">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;
&lt;mapper namespace="org.springblade.modules.question.mapper.QuestionMapper"&gt;


  &lt;select id="selectAllChapter" resultType="java.lang.String"&gt;
        SELECT
            CONCAT(sc.NAME,'/',sc1.NAME) AS chapterName
        FROM
            sxdx_course sc
                INNER JOIN sxdx_chapter sc1 ON sc.id = sc1.course_id
        WHERE
            sc.is_deleted = 0
          AND sc1.is_deleted = 0
    &lt;/select&gt;

&lt;/mapper&gt;</code></pre> 
<h2>10.也可以不查询数据库，直接再接口返回需要的数据。</h2> 
<pre><code class="language-java">package org.springblade.modules.question.excelImplement;

import org.springblade.modules.question.mapper.QuestionMapper;
import org.springblade.modules.system.EuipmentExcelImplement.ExcelDynamicSelect;
import org.springblade.modules.system.EuipmentExcelImplement.SpringContextUtil;

import java.util.ArrayList;

public class TypeSelected implements ExcelDynamicSelect {

	@Override
	public String[] getSource() {
//直接返回需要的数据
		return new ArrayList&lt;String&gt;(){<!-- -->{add("单选");add("多选");add("判断");add("问答");}}.toArray(new String[]{});
	}
}
</code></pre> 
<h2>11.最终效果</h2> 
<p><img alt="" height="581" src="https://images2.imgbox.com/5b/6c/IRnYNBgw_o.png" width="1048"></p> 
<p> <img alt="" height="581" src="https://images2.imgbox.com/ec/0f/59u57xOc_o.png" width="1048"></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3e9c57ba6ba8e57c14749c9c38a8fce9/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">cpolar在windows系统下的关闭方法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f3725d532e2f8261971eff732bdf383a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【ipmitool】</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>