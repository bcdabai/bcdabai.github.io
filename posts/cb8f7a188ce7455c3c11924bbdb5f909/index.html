<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>php7和php5对比 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="php7和php5对比" />
<meta property="og:description" content="PHP7刚出道就号称比旧版本快了几倍，各种开源框架或系统运行在PHP7上速度效率提高了几倍，反正不管是媒体还是开发者都在煽风点火，不，应该是赞不绝口。
我就静静看你们装逼，不说话。
一般手机系统升级我是跑最后的，因为不愿意踩坑，毕竟iOS和Android这种系统都会出现bug，何况世界上被人黑的最多的语言。
今日时机已到，看看PHP7有没有传说的那么王炸。
安装两个PHP版本 http://php.net/ 已经有最新PHP7的最新版本，大家可自行下载。
为了测试PHP5和PHP7（PHP6已被放弃，心疼1s）的性能，我在不同的目录安装了两个php版本。
安装过程就略过了，无论源码安装还是包管理工具安装，记得自己的路径即可。
PHP7:
# /usr/local/php7/bin/php -vPHP 7.1.5 (cli) (built: May 13 2017 23:36:41) ( NTS )Copyright (c) 1997-2017 The PHP GroupZend Engine v3.1.0, Copyright (c) 1998-2017 Zend Technologies PHP5：
# /usr/bin/php -vPHP 5.6.30 (cli) (built: Jan 19 2017 22:31:39)Copyright (c) 1997-2016 The PHP GroupZend Engine v2.6.0, Copyright (c) 1998-2016 Zend Technologies 环境说明：为了保证最佳的测试效果，本次测试在直接在生产环境进行，更逼近真实情况。
操作系统：CentOS 7.2 64位
基础配置：1核 1GB 1Mbps
主机品牌：腾讯云
PHP7和PHP5的对决 1. 纯php脚本测试 vim test." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/cb8f7a188ce7455c3c11924bbdb5f909/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-03-09T09:25:39+08:00" />
<meta property="article:modified_time" content="2021-03-09T09:25:39+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">php7和php5对比</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>PHP7刚出道就号称比旧版本快了几倍，各种开源框架或系统运行在PHP7上速度效率提高了几倍，反正不管是媒体还是开发者都在煽风点火，不，应该是赞不绝口。<br> 我就静静看你们装逼，不说话。</p> 
<p>一般手机系统升级我是跑最后的，因为不愿意踩坑，毕竟iOS和Android这种系统都会出现bug，何况世界上被人黑的最多的语言。</p> 
<p>今日时机已到，看看PHP7有没有传说的那么王炸。</p> 
<h2>安装两个PHP版本</h2> 
<p><a href="https://link.jianshu.com/?t=http://php.net/" rel="nofollow">http://php.net/</a> 已经有最新PHP7的最新版本，大家可自行下载。<br> 为了测试PHP5和PHP7（PHP6已被放弃，心疼1s）的性能，我在不同的目录安装了两个php版本。</p> 
<p>安装过程就略过了，无论源码安装还是包管理工具安装，记得自己的路径即可。</p> 
<p>PHP7:</p> 
<pre># /usr/local/php7/bin/php -vPHP 7.1.5 (cli) (built: May 13 2017 23:36:41) ( NTS )Copyright (c) 1997-2017 The PHP GroupZend Engine v3.1.0, Copyright (c) 1998-2017 Zend Technologies</pre> 
<p>PHP5：</p> 
<pre># /usr/bin/php -vPHP 5.6.30 (cli) (built: Jan 19 2017 22:31:39)Copyright (c) 1997-2016 The PHP GroupZend Engine v2.6.0, Copyright (c) 1998-2016 Zend Technologies</pre> 
<p>环境说明：为了保证最佳的测试效果，本次测试在直接在生产环境进行，更逼近真实情况。<br> 操作系统：CentOS 7.2 64位<br> 基础配置：1核 1GB 1Mbps<br> 主机品牌：腾讯云</p> 
<h2>PHP7和PHP5的对决</h2> 
<h3>1. 纯php脚本测试</h3> 
<p><code>vim test.php</code></p> 
<pre>$arr = array();for ($i = 0; $i &lt; 500000; $i++) {$arr[$i] = $i;}$tmp = array();foreach ($arr as $i) {if ($i % 2 == 0) {$is_exists = array_key_exists($i, $arr);if ($is_exists) {array_push($tmp, $i);}}}</pre> 
<p>PHP5版本测试：</p> 
<pre>time /usr/bin/php test.php real    0m0.301suser    0m0.239ssys     0m0.050s--------------------------time /usr/bin/php test.phpreal    0m0.310suser    0m0.241ssys     0m0.054s--------------------------time /usr/bin/php test.phpreal    0m0.289suser    0m0.238ssys     0m0.050s</pre> 
<p>PHP7版本测试：</p> 
<pre>time /usr/local/php7/bin/php test.phpreal    0m0.087suser    0m0.063ssys     0m0.024s-------------------------------------time /usr/local/php7/bin/php test.phpreal    0m0.106suser    0m0.073ssys     0m0.033s--------------------------------------time /usr/local/php7/bin/php test.phpreal    0m0.083suser    0m0.061ssys     0m0.022s</pre> 
<p>通过数据可以看出来，单纯的php脚本测试，可以看出php7性能提升了3到4倍。</p> 
<h3>2.php数据库操作测试</h3> 
<p>首先我们创建一个用户表：</p> 
<pre>Table: test_userCreate Table: CREATE TABLE `test_user` (`uid` int(11) NOT NULL AUTO_INCREMENT,`name` char(100) NOT NULL DEFAULT '',PRIMARY KEY (`uid`)) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8</pre> 
<p>给test_user表插入一条数据：</p> 
<pre>insert into test_user (uid,name) values (1,"dada");MariaDB [test]&gt; select * from test_user;+-----+------+| uid | name |+-----+------+|   1 | dada |+-----+------+</pre> 
<p>创建数据库测试脚本test_db.php，确保你的两个PHP版本都安装了PDO扩展。</p> 
<pre>/usr/bin/php -m|grep pdopdo_mysqlpdo_sqlite/usr/local/php7/bin/php -m|grep pdopdo_mysqlpdo_sqlite</pre> 
<p>我的两个PHP版本已经安装了PDO（不要再使用php_mysql扩展，已经过时了，PHP7已经完全抛弃，mysqli也不建议使用）。</p> 
<p>接下来我们通过PDO编写脚本，测试select执行50万次的性能对比：</p> 
<pre>$host = "yourHost";$user = "yourUser";$pass = "yourPass";$db   = "test";$port = 3306;try{$dbh = new PDO("mysql:host=$host;dbname=$db", $user, $pass);echo "Connected&lt;p&gt;";}catch (Exception $e){echo "Unable to connect: " . $e-&gt;getMessage() ."&lt;p&gt;";}$sql = "select  SQL_NO_CACHE * from test_user;";$tmp = array();for ($i=1; $i&lt;=500000; $i++) {$ret = $dbh-&gt;query($sql);foreach ($ret as $row) {$tmp['id']   = $row['id'];$tmp['name'] = $row['name'];}}</pre> 
<p>PHP5测试test_db.php:</p> 
<pre>time /usr/bin/php test_db.phpreal    0m48.396suser    0m11.149ssys     0m3.998sreal    0m51.447suser    0m11.800ssys     0m4.395sreal    0m51.517suser    0m11.733ssys     0m4.439s</pre> 
<p>PHP7测试test_db.php:</p> 
<pre>real    0m47.900suser    0m9.875ssys     0m4.130sreal    0m46.977suser    0m9.760ssys     0m3.983sreal    0m50.010suser    0m10.268ssys     0m4.307s</pre> 
<p>这次脚本执行了50w次查询，user执行时间PHP7执行的脚本几乎都比PHP5要少一秒！是少一秒不是一毫秒。</p> 
<h3>3.PHP框架测试</h3> 
<ul><li> <h4>thinkphp</h4> </li></ul> 
<p>国内肯定是首选thinkphp框架，选择最新的thinkphp5。我这里直接在官网下载的thinkphp5.0.9版本。</p> 
<ul><li> <p>（一）框架入口测试</p> </li></ul> 
<p>PHP5下的测试：</p> 
<pre>time /usr/bin/php ./public/index.phpreal    0m0.036suser    0m0.026ssys     0m0.010sreal    0m0.038suser    0m0.026ssys     0m0.012sreal    0m0.041suser    0m0.032ssys     0m0.009s</pre> 
<p>PHP7下的测试：</p> 
<pre>time /usr/local/php7/bin/php ./public/index.phpreal    0m0.027suser    0m0.021ssys     0m0.005sreal    0m0.027suser    0m0.018ssys     0m0.009sreal    0m0.025suser    0m0.023ssys     0m0.002s</pre> 
<p>在入口测试下，可以看到PHP和PHP7没有太大的区别，但PHP7还是稍微快一点。</p> 
<ul><li> <p>（二）框架逻辑测试<br> 在框架入口复用第一步的逻辑：</p> </li></ul> 
<pre>&lt;?phpnamespace app\index\controller;class Index{public function index(){$arr = array();for ($i = 0; $i &lt; 500000; $i++) {$arr[$i] = $i;}$tmp = array();foreach ($arr as $i) {if ($i % 2 == 0) {$is_exists = array_key_exists($i, $arr);if ($is_exists) {array_push($tmp, $i);}}}}}</pre> 
<p>PHP5版本：</p> 
<pre>time /usr/bin/php ./public/index.phpreal    0m0.538suser    0m0.463ssys     0m0.072sreal    0m0.454suser    0m0.386ssys     0m0.065sreal    0m0.387suser    0m0.331ssys     0m0.055s</pre> 
<p>PHP7版本：</p> 
<pre>time /usr/local/php7/bin/php ./public/index.phpreal    0m0.150suser    0m0.123ssys     0m0.024sreal    0m0.137suser    0m0.105ssys     0m0.031sreal    0m0.123suser    0m0.096ssys     0m0.026s</pre> 
<p>在thinkphp框架中使用PHP7版本，性能提升大约是PHP5版本的4倍！</p> 
<ul><li> <h4>laravel</h4> </li></ul> 
<p>然后我们测试下现在最火热的PHP艺术家的框架。</p> 
<ul><li> <p>(一) 框架入口测试<br> PHP5版本：</p> </li></ul> 
<pre>time /usr/bin/php ./public/index.phpreal    0m0.104suser    0m0.081ssys     0m0.022sreal    0m0.148suser    0m0.122ssys     0m0.025sreal    0m0.122suser    0m0.100ssys     0m0.021s</pre> 
<p>PHP版本</p> 
<pre>time /usr/local/php7/bin/php ./public/index.phpreal    0m0.079suser    0m0.064ssys     0m0.015sreal    0m0.081suser    0m0.067ssys     0m0.014sreal    0m0.067suser    0m0.054ssys     0m0.013s</pre> 
<p>我们可以看到laravel的框架入口测试中，PHP5和PHP7的表现差异不大，但即使PHP5最高快的0.081s也比PHP7版本最慢的0.067s要慢。所以PHP7还是更胜一筹。</p> 
<ul><li> <p>（二）框架逻辑测试<br> 尝试增加一点逻辑，和thinkphp一样，复用测试逻辑。<br> 首先修改laravel路由，直接调用UserController的index方法：</p> </li></ul> 
<pre>Route::get('/', 'UserController@index');</pre> 
<p>在index方法中写入测试逻辑：</p> 
<pre>public function index(){$arr = array();for ($i = 0; $i &lt; 500000; $i++) {$arr[$i] = $i;}$tmp = array();foreach ($arr as $i) {if ($i % 2 == 0) {$is_exists = array_key_exists($i, $arr);if ($is_exists) {array_push($tmp, $i);}}}}</pre> 
<p>PHP5版本</p> 
<pre>time /usr/bin/php ./public/index.phpreal    0m0.510suser    0m0.377ssys     0m0.079sreal    0m0.627suser    0m0.447ssys     0m0.091sreal    0m0.519suser    0m0.436ssys     0m0.079s</pre> 
<p>PHP7版本</p> 
<pre>time /usr/local/php7/bin/php ./public/index.phpreal    0m0.201suser    0m0.167ssys     0m0.032sreal    0m0.216suser    0m0.174ssys     0m0.040sreal    0m0.169suser    0m0.134ssys     0m0.034s</pre> 
<p>PHP7性能提升了3到4倍</p> 
<h3>压力测试</h3> 
<h3>1000个请求，50个并发</h3> 
<ul><li> <p>PHP5版本：</p> </li></ul> 
<p> </p> 
<p><img alt="" src="https://images2.imgbox.com/cc/71/8lPwiEYO_o.png"></p> 
<p>image.png</p> 
<p> </p> 
<p>三次样本如下：</p> 
<p> </p> 
<p><img alt="" src="https://images2.imgbox.com/5c/d2/cdCt0WAx_o.png"></p> 
<p>image.png</p> 
<p> </p> 
<p><img alt="" src="https://images2.imgbox.com/ab/34/YBT6aXZu_o.png"></p> 
<p>image.png</p> 
<p> </p> 
<p><img alt="" src="https://images2.imgbox.com/2e/02/8H0h8RgV_o.png"></p> 
<p>image.png</p> 
<ul><li> <p>PHP7版本：</p> <p> </p> <p> </p> <p><img alt="" src="https://images2.imgbox.com/54/32/kn0zxIei_o.png"></p> <p>1</p> </li></ul> 
<p> </p> 
<p><img alt="" src="https://images2.imgbox.com/86/f8/oBTK46Ap_o.png"></p> 
<p>2</p> 
<p> </p> 
<p><img alt="" src="https://images2.imgbox.com/b8/2e/M6BwWU9q_o.png"></p> 
<p>3</p> 
<p> </p> 
<p><img alt="" src="https://images2.imgbox.com/74/b3/Uh9oTqQd_o.png"></p> 
<p>4</p> 
<p>通过压力测试，在PHP7版本下，可以看到单个请求时间和请求完成时间以及每个连接请求实际运行时间的平均值都耗时更少，最重要的性能指标QPS也是高于PHP5的版本。</p> 
<h3>PHP7的opcache性能测试</h3> 
<p>开启opcache：</p> 
<p> </p> 
<p><img alt="" src="https://images2.imgbox.com/dc/46/LQBv2RKy_o.png"></p> 
<p>image.png</p> 
<p> </p> 
<p><img alt="" src="https://images2.imgbox.com/63/37/58GIiZ7j_o.png"></p> 
<p>image.png</p> 
<p> </p> 
<p><img alt="" src="https://images2.imgbox.com/b9/4b/vtHrr6S6_o.png"></p> 
<p>image.png</p> 
<p> </p> 
<p><img alt="" src="https://images2.imgbox.com/6c/f7/DJ7Vw858_o.png"></p> 
<p>image.png</p> 
<p>卧槽！开启了opcache的PHP7果然是要起飞的节奏，相比未开启的PHP7性能提升了十几倍，相比PHP5提升了将进20倍！问你怕不怕！</p> 
<p>PHP脚本测试数据如下：</p> 
<p> </p> 
<p><img alt="" src="https://images2.imgbox.com/31/03/9gYybOlT_o.png"></p> 
<p>PHP7 vs PHP5.png</p> 
<p> </p> 
<p>纯php脚本测试过程，PHP7性能大约是PHP5的3到4倍。</p> 
<p>压力测试数据如下：</p> 
<p> </p> 
<p> </p> 
<p><img alt="" src="https://images2.imgbox.com/c3/b1/t4UGZ549_o.png"></p> 
<p>PHP5 vs PHP7 vs PHP7+OPCACHE.png</p> 
<p>结论：</p> 
<p>本文对PHP7和PHP5进行简单对比，性能确实有3到4倍提升，无论是在php纯脚本中，还是在框架中，PHP7高性能的表现都是一致的。</p> 
<p>PHP7很快，PHP7+OpCache飞快，PHP7确实牛逼，PHP的新时代已来临，赶紧用起来！</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/072269d61f14e7a87d5e38ad2e88f1b1/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">php7和php5语法一样_php5与php7的区别点总结</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/bf44cabcd77fa71b32be5a06b1bfa70f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">c&#43;&#43;类对象的例子（非标准语法；请使用 “&amp;“ 来创建指向成员的指针，如何解决？）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>