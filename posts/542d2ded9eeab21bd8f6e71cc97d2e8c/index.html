<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>h3c交换机的vlan控制策略路由设置 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="h3c交换机的vlan控制策略路由设置" />
<meta property="og:description" content="昨天去一家客户那边调试h3c的设备,客户要做vlan间互访和策略路由.本以为挺简单的事情,可到了才发现不是自己想象的那样.vlan间互访没想到h3c搞的那么麻烦,cisco的数据流控制就是做一条访问列表,列表里定义了动作是拒绝还是允许,然后直接把这个列表应用到接口上就可以了,但h3c却没有这么简单,h3c我总结了一下总的思路是这样的 1.首先定义访问控制列表,注意:假如要使把此列表应用到qos策略中的话此列表中的deny和permit是没有意义的,不管是permit还是deny都代表&#34;匹配&#34;该数据流. 2.定义类,类里面很简单,就是简单的匹配某条列表.应该也可以像cisco一样匹配or或者and,我没验证. 3.定义行为动作,行为动作可以分好多,常用的有filter deny,filter permit 拒绝/允许,还有改变下一条 redirect next-hop.或者可以做标记,qos等. 4.定义qos策略,把2,3里的类和行为建立关联,如什么类执行什么行为,可以做好多条,同一个行为如果找到第一项匹配则不再接着往下执行,所有有可能同一个数据流能满足多条不同行为操作的情况. 5.把此qos策略应用到接口上. 下面我把配置粘上来供大家参考 # version 5.20, Release 5303 # sysname master switch # domain default enable system # telnet server enable # vlan 1 # vlan 20 # vlan 23 description 0023 # vlan 24 # vlan 30 # vlan 40 # vlan 50 vlan 60 # vlan 70 # vlan 80 # vlan 90 # vlan 100 # domain system access-limit disable state active idle-cut disable self-service-url disable # traffic classifier h3c operator and if-match acl 3060 ********* 定义类，30，50，90三个网段之间不能互访******** traffic classifier wangtong operator and if-match acl 2010 ********* 定义类，20，60，90网段的用户分到wangtong这个类中******* traffic classifier dianxin operator and if-match acl 2020 ********* 定义类，30，50，70网段的用户分到电信这个类中******* traffic behavior h3c filter deny ********* 定义行为名字叫h3c的动作为丢弃!" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/542d2ded9eeab21bd8f6e71cc97d2e8c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2008-10-14T10:00:24+08:00" />
<meta property="article:modified_time" content="2008-10-14T10:00:24+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">h3c交换机的vlan控制策略路由设置</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div class="artical-content-bak main-content editor-side-new"> 
 <div class="con editor-preview-side" id="result"> 
  <div>
    昨天去一家客户那边调试h3c的设备,客户要做vlan间互访和策略路由.本以为挺简单的事情,可到了才发现不是自己想象的那样.vlan间互访没想到h3c搞的那么麻烦,cisco的数据流控制就是做一条访问列表,列表里定义了动作是拒绝还是允许,然后直接把这个列表应用到接口上就可以了,但h3c却没有这么简单,h3c我总结了一下总的思路是这样的 
   <br>1.首先定义访问控制列表,注意:假如要使把此列表应用到qos策略中的话此列表中的deny和permit是没有意义的,不管是permit还是deny都代表"匹配"该数据流. 
   <br>2.定义类,类里面很简单,就是简单的匹配某条列表.应该也可以像cisco一样匹配or或者and,我没验证. 
   <br>3.定义行为动作,行为动作可以分好多,常用的有filter deny,filter permit 拒绝/允许,还有改变下一条 redirect next-hop.或者可以做标记,qos等. 
   <br>4.定义qos策略,把2,3里的类和行为建立关联,如什么类执行什么行为,可以做好多条,同一个行为如果找到第一项匹配则不再接着往下执行,所有有可能同一个数据流能满足多条不同行为操作的情况. 
   <br>5.把此qos策略应用到接口上. 
  </div> 
  <div>
      
  </div> 
  <div>
    下面我把配置粘上来供大家参考 
   <br># 
   <br> version 5.20, Release 5303 
   <br># 
   <br> sysname master switch 
   <br># 
   <br> domain default enable system 
   <br># 
   <br> telnet server enable 
   <br># 
   <br>vlan 1 
   <br># 
   <br>vlan 20 
   <br># 
   <br>vlan 23 
   <br> description 0023 
   <br># 
   <br>vlan 24 
   <br># 
   <br>vlan 30 
   <br># 
   <br>vlan 40 
   <br># 
   <br>vlan 50 
  </div> 
  <div>
    vlan 60 
   <br># 
   <br>vlan 70 
   <br># 
   <br>vlan 80 
   <br># 
   <br>vlan 90 
   <br># 
   <br>vlan 100 
   <br># 
   <br>domain system 
   <br> access-limit disable 
   <br> state active 
   <br> idle-cut disable 
   <br> self-service-url disable 
   <br># 
  </div> 
  <div>
    traffic classifier h3c operator and 
   <br> if-match acl 3060                                    
   <br> ********* 定义类，30，50，90三个网段之间不能互访******** 
  </div> 
  <div>
    traffic classifier wangtong operator and 
   <br> if-match acl 2010 
   <br>********* 定义类，20，60，90网段的用户分到wangtong这个类中******* 
  </div> 
  <div>
    traffic classifier dianxin operator and 
   <br> if-match acl 2020 
   <br>********* 定义类，30，50，70网段的用户分到电信这个类中******* 
  </div> 
  <div>
    traffic behavior h3c 
   <br> filter deny 
   <br>********* 定义行为名字叫h3c的动作为丢弃!********* 
   <br>traffic behavior wangtong 
   <br> redirect next-hop 10.1.1.2 
   <br>*********定义行为名字叫wangtong 动作为改变下一跳位10.1.1.2********* 
  </div> 
  <div>
    traffic behavior dianxin 
   <br> redirect next-hop 10.1.2.2 
   <br>*********定义行为名字叫wangtong 动作为改变下一跳位10.1.2.2********* 
  </div> 
  <div> 
   <br>qos policy h3c 
   <br> classifier h3c behavior h3c 
   <br> classifier wangtong behavior wangtong 
   <br> classifier dianxin behavior dianxin 
   <br>***********定义一个qos策略(注意,这里是总的qos策略,其中包括vlan间访问控制和策略路由控制都汇聚到此策略中了) 
   <br>1.满足h3c类别的数据流执行h3c这个行为,这里行为为丢弃 
   <br>2.满足wangtong类别的数据流执行网通这个行为,这里的行为为改变下一跳为10.1.1.2 
   <br>3.满足dianxin类别的数据流执行dianxin这个行为,这里的行为为改变下一跳为10.1.2.2 
   <br>******************************************************************** 
  </div> 
  <div>
    # 
   <br>acl number 2010 
   <br> rule 0 permit source 192.168.20.0 0.0.0.255 
   <br> rule 1 permit source 192.168.60.0 0.0.0.255 
   <br> rule 2 permit source 192.168.90.0 0.0.0.255 
   <br>acl number 2020 
   <br> rule 0 permit source 192.168.30.0 0.0.0.255 
   <br> rule 1 permit source 192.168.50.0 0.0.0.255 
   <br> rule 2 permit source 192.168.70.0 0.0.0.255 
  </div> 
  <div>
    acl number 3060 
   <br> rule 10 permit ip source 192.168.30.0 0.0.0.255 destination 192.168.50.0 0.0.0.255 
   <br> rule 20 permit ip source 192.168.30.0 0.0.0.255 destination 192.168.90.0 0.0.0.255 
   <br> rule 50 permit ip source 192.168.50.0 0.0.0.255 destination 192.168.30.0 0.0.0.255 
   <br> rule 60 permit ip source 192.168.50.0 0.0.0.255 destination 192.168.90.0 0.0.0.255 
   <br> rule 70 permit ip source 192.168.90.0 0.0.0.255 destination 192.168.30.0 0.0.0.255 
   <br> rule 80 permit ip source 192.168.90.0 0.0.0.255 destination 
   <br>192.168.50.0 0.0.0.255 
   <br>*************在30,50,90三个网段之间做隔离,使他们不能互相访问,但都能访问其他的地址,由于h3c的三层交换机(这里的型号是s5510)可以实现单向访问,以此每一条都得建立2条规则来匹配如30--90网段,90---30网段.因为是作用在trunk口上的,因此源地址无法确定**************************************** 
   <br>interface NULL0 
   <br># 
   <br>interface Vlan-interface1 
   <br> ip address 192.168.10.1 255.255.255.0 
   <br># 
   <br>interface Vlan-interface20 
   <br> ip address 192.168.20.254 255.255.255.0 
   <br># 
   <br>interface Vlan-interface23 
   <br> ip address 10.1.1.1 255.255.255.0 
  </div> 
  <div>
    interface Vlan-interface24 
   <br> ip address 10.1.2.1 255.255.255.0 
   <br># 
   <br>interface Vlan-interface30 
   <br> ip address 192.168.30.254 255.255.255.0 
   <br># 
   <br>interface Vlan-interface40 
   <br> ip address 192.168.40.254 255.255.255.0 
   <br># 
   <br>interface Vlan-interface50 
   <br> ip address 192.168.50.254 255.255.255.0 
   <br># 
   <br>interface Vlan-interface60 
   <br> ip address 192.168.60.254 255.255.255.0 
   <br># 
   <br>interface Vlan-interface70 
   <br> ip address 192.168.70.254 255.255.255.0 
   <br># 
   <br>interface Vlan-interface80 
   <br> ip address 192.168.80.254 255.255.255.0 
   <br># 
   <br>interface Vlan-interface90 
   <br> ip address 192.168.90.254 255.255.255.0 
  </div> 
  <div>
    interface GigabitEthernet1/0/1 
   <br> port link-type trunk 
   <br> port trunk permit vlan all 
   <br> qos apply policy h3c inbound 
   <br># 
   <br>interface GigabitEthernet1/0/2 
   <br> port link-type trunk 
   <br> port trunk permit vlan all 
   <br> qos apply policy h3c inbound 
   <br># 
   <br>interface GigabitEthernet1/0/3 
   <br> port link-type trunk 
   <br> port trunk permit vlan all 
   <br> qos apply policy h3c inbound 
   <br># 
   <br>interface GigabitEthernet1/0/4 
   <br> port link-type trunk 
   <br> port trunk permit vlan all 
   <br> qos apply policy h3c inbound 
   <br># 
   <br>interface GigabitEthernet1/0/5 
   <br> port link-type trunk 
   <br> port trunk permit vlan all 
   <br> qos apply policy h3c inbound 
   <br># 
   <br>interface GigabitEthernet1/0/6 
   <br> port link-type trunk 
   <br> port trunk permit vlan all 
   <br> qos apply policy h3c inbound 
   <br># 
   <br>interface GigabitEthernet1/0/7 
   <br> port link-type trunk 
   <br> port trunk permit vlan all 
   <br> qos apply policy h3c inbound 
   <br># 
   <br>interface GigabitEthernet1/0/8 
   <br> port link-type trunk 
   <br> port trunk permit vlan all 
   <br> qos apply policy h3c inbound 
  </div> 
  <div>
    ************在8个trunk口上绑定qos策略**************************888 
   <br># 
   <br>interface GigabitEthernet1/0/9 
   <br> port access vlan 20 
   <br># 
   <br>interface GigabitEthernet1/0/10 
   <br> port access vlan 20 
   <br>  
   <br>interface GigabitEthernet1/0/11 
   <br> port access vlan 20 
   <br># 
   <br>interface GigabitEthernet1/0/12 
   <br> port access vlan 20 
   <br># 
   <br>interface GigabitEthernet1/0/13 
   <br> port access vlan 20 
   <br># 
   <br>interface GigabitEthernet1/0/14 
   <br> port access vlan 20 
   <br># 
   <br>interface GigabitEthernet1/0/15 
   <br> port access vlan 20 
   <br># 
   <br>interface GigabitEthernet1/0/16 
   <br> port access vlan 20 
   <br># 
   <br>interface GigabitEthernet1/0/17 
   <br> port access vlan 20 
   <br># 
   <br>interface GigabitEthernet1/0/18 
   <br>port access vlan 20 
   <br># 
   <br>interface GigabitEthernet1/0/19 
   <br> port access vlan 100 
   <br> speed 100 
   <br># 
   <br>interface GigabitEthernet1/0/20 
   <br> port access vlan 100 
   <br> speed 100 
   <br># 
   <br>interface GigabitEthernet1/0/21 
   <br> port access vlan 100 
   <br> speed 100 
   <br># 
   <br>interface GigabitEthernet1/0/22 
   <br> port access vlan 100 
   <br># 
   <br>interface GigabitEthernet1/0/23 
   <br> port access vlan 23 
   <br> speed 100 
   <br> duplex full 
   <br># 
   <br>interface GigabitEthernet1/0/24 
   <br>port access vlan 24 
   <br># 
   <br>interface GigabitEthernet1/0/25 
   <br> shutdown 
   <br># 
   <br>interface GigabitEthernet1/0/26 
   <br> shutdown 
   <br># 
   <br>interface GigabitEthernet1/0/27 
   <br> shutdown 
   <br># 
   <br>interface GigabitEthernet1/0/28 
   <br> shutdown 
   <br># 
   <br> ip route-static 0.0.0.0 0.0.0.0 10.1.1.2 
   <br> ip route-static 0.0.0.0 0.0.0.0 10.1.2.2 
  </div> 
  <div>
    **********定义2条缺省路由,一条指向电信网络,一条指向网通网络*************** 
   <br># 
   <br>user-interface aux 0 
   <br>user-interface vty 0 4 
   <br># 
   <br>return 
   <br>[master switch]                                                         
  </div> 
 </div> 
</div> 
<p>转载于:https://blog.51cto.com/yangqing/105532</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/49babdc543bd42ef26f470fced073d48/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">什么是LAN(局域网)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a436b5feb805c00df15f7ee67302b031/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">红黑树排序(javascript)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>