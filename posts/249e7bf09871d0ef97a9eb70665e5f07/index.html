<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>xpath选择器应用 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="xpath选择器应用" />
<meta property="og:description" content="文章目录 xpath选择器应用xpath介绍xpath语法表达式逻辑语句 and or xpath函数xpath提取元素在scrapy项目中使用xpathlxml直接使用 xpath xpath选择器应用 xpath介绍 XPath（XML Path Language - XML路径语言），它是一种用来确定XML文档中某部分位置的语言。
Xpath以XML为基础，提供用户在数据结构树中寻找节点的能力，Xpath被很多开发者亲切的称为小型查询语言
xpath使用路径表达式在xml和html中进行导航，适用于xml和html所以在爬虫中作为解析库使用
xpath包含标准函数库
xpath是w3c的标准，脱离语言
xpath节点关系
父节点子节点兄弟节点祖先节点子孙节点 xpath语法 表达式 表达式描述nodename选取此节点的所有子节点/从当前节点选取直接子节点//从当前节点选取子孙节点.选取当前节点…选取当前节点的父节点@选取属性 示例：
表达式描述//article[@lang=‘cn’]选取所有名称为article，同时属性lang值为cn的节点，[]谓语article选取所有article元素的所有子节点/article选取根元素articlearticle/a选取所有属于article的子元素的a元素//div选取所有div子孙元素(不论出现在文档任何地方)article//div选取所有属于article元素的后代的div元素，不管它出现在article之下的任何位置//@class选取所有名为class的属性/article/div[1]选取属于article子元素的第一个div元素/article/div[last()]选取属于article子元素的最后一个div元素/article/div[last()-1]选取属于article子元素的倒数第二个div元素//div[@lang]选取所有拥有lang属性的div元素//div[@lang=‘eng’]选取所有lang属性为eng的div元素/div/*选取属于div元素的所有子节点//*选取所有元素//div[@*]选取所有带属性的div元素//div/a | //div/p选取所有div元素的a和p元素//span | //ul选取文档中的span和ul元素article/div/p| //span选取所有属于article元素的div元素的p元素 以及文档中所有的span元素 html基本结构
&lt;html&gt; &lt;head&gt; &lt;title&gt;&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;div id=&#34;1&#34;&gt;&lt;/div&gt; &lt;div id=&#34;2&#34;&gt; &lt;div id=&#34;3&#34;&gt;&lt;/div&gt; &lt;div id=&#34;4&#34;&gt;&lt;/div&gt; &lt;/div&gt; &lt;/body&gt; &lt;/html&gt; 对于节点关系
兄弟节点： div1和div2互为兄弟节点 父节点和子节点 div3和div4的父节点是div2，他们是div2的子节点，每个节点都有唯一的父节点 祖先节点和子孙节点 div都是body的子孙节点，body是div的祖先节点 一般静态页面的解析都是定位a标签获取href
逻辑语句 and or 选取多个属性可以用 and or |
div[@class=&#34;info_list password&#34; and @node-type=&#34;password_box&#34;] div[@class=&#34;info_list password&#34; or @node-type=&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/249e7bf09871d0ef97a9eb70665e5f07/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-04-07T17:50:01+08:00" />
<meta property="article:modified_time" content="2023-04-07T17:50:01+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">xpath选择器应用</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#xpath_1" rel="nofollow">xpath选择器应用</a></li><li><ul><li><a href="#xpath_3" rel="nofollow">xpath介绍</a></li><li><a href="#xpath_22" rel="nofollow">xpath语法</a></li><li><ul><li><a href="#_24" rel="nofollow">表达式</a></li><li><a href="#_and_or_88" rel="nofollow">逻辑语句 and or</a></li></ul> 
   </li><li><a href="#xpath_97" rel="nofollow">xpath函数</a></li><li><a href="#xpath_124" rel="nofollow">xpath提取元素</a></li><li><ul><li><a href="#scrapyxpath_128" rel="nofollow">在scrapy项目中使用xpath</a></li><li><a href="#lxml_xpath_163" rel="nofollow">lxml直接使用 xpath</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="xpath_1"></a>xpath选择器应用</h2> 
<h3><a id="xpath_3"></a>xpath介绍</h3> 
<p>XPath（XML Path Language - XML路径语言），它是一种用来确定XML文档中某部分位置的语言。<br> Xpath以XML为基础，提供用户在数据结构树中寻找节点的能力，Xpath被很多开发者亲切的称为小型查询语言</p> 
<p>xpath使用路径表达式在xml和html中进行导航，适用于xml和html所以在爬虫中作为解析库使用</p> 
<p>xpath包含标准函数库</p> 
<p>xpath是w3c的标准，脱离语言</p> 
<p>xpath节点关系</p> 
<ol><li>父节点</li><li>子节点</li><li>兄弟节点</li><li>祖先节点</li><li>子孙节点</li></ol> 
<h3><a id="xpath_22"></a>xpath语法</h3> 
<h4><a id="_24"></a>表达式</h4> 
<table><thead><tr><th>表达式</th><th>描述</th></tr></thead><tbody><tr><td>nodename</td><td>选取此节点的所有子节点</td></tr><tr><td>/</td><td>从当前节点选取直接子节点</td></tr><tr><td>//</td><td>从当前节点选取子孙节点</td></tr><tr><td>.</td><td>选取当前节点</td></tr><tr><td>…</td><td>选取当前节点的父节点</td></tr><tr><td>@</td><td>选取属性</td></tr></tbody></table> 
<p>示例：</p> 
<table><thead><tr><th>表达式</th><th>描述</th></tr></thead><tbody><tr><td>//article[@lang=‘cn’]</td><td>选取所有名称为article，同时属性lang值为cn的节点，[]谓语</td></tr><tr><td>article</td><td>选取所有article元素的所有子节点</td></tr><tr><td>/article</td><td>选取根元素article</td></tr><tr><td>article/a</td><td>选取所有属于article的子元素的a元素</td></tr><tr><td>//div</td><td>选取所有div子孙元素(不论出现在文档任何地方)</td></tr><tr><td>article//div</td><td>选取所有属于article元素的后代的div元素，不管它出现在article之下的任何位置</td></tr><tr><td>//@class</td><td>选取所有名为class的属性</td></tr><tr><td>/article/div[1]</td><td>选取属于article子元素的第一个div元素</td></tr><tr><td>/article/div[last()]</td><td>选取属于article子元素的最后一个div元素</td></tr><tr><td>/article/div[last()-1]</td><td>选取属于article子元素的倒数第二个div元素</td></tr><tr><td>//div[@lang]</td><td>选取所有拥有lang属性的div元素</td></tr><tr><td>//div[@lang=‘eng’]</td><td>选取所有lang属性为eng的div元素</td></tr><tr><td>/div/*</td><td>选取属于div元素的所有子节点</td></tr><tr><td>//*</td><td>选取所有元素</td></tr><tr><td>//div[@*]</td><td>选取所有带属性的div元素</td></tr><tr><td>//div/a | //div/p</td><td>选取所有div元素的a和p元素</td></tr><tr><td>//span | //ul</td><td>选取文档中的span和ul元素</td></tr><tr><td>article/div/p| //span</td><td>选取所有属于article元素的div元素的p元素 以及文档中所有的span元素</td></tr></tbody></table> 
<p>html基本结构</p> 
<pre><code class="prism language-javascript"><span class="token operator">&lt;</span>html<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>title<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"1"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"2"</span><span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"3"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"4"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span>
</code></pre> 
<p>对于节点关系</p> 
<pre><code>兄弟节点：
	div1和div2互为兄弟节点
父节点和子节点
	div3和div4的父节点是div2，他们是div2的子节点，每个节点都有唯一的父节点
祖先节点和子孙节点
	div都是body的子孙节点，body是div的祖先节点
</code></pre> 
<p>一般静态页面的解析都是定位a标签获取href</p> 
<h4><a id="_and_or_88"></a>逻辑语句 and or</h4> 
<p>选取多个属性可以用 and or |</p> 
<pre><code>div[@class="info_list password" and @node-type="password_box"]
div[@class="info_list password" or @node-type="password_box"]
div[@class="info_list password" | @node-type="password_box"]
</code></pre> 
<h3><a id="xpath_97"></a>xpath函数</h3> 
<p>函数</p> 
<ol><li>text()</li></ol> 
<pre><code>获取元素的文本
//*[@id="entry_737487"]/div[2]/h2/a/text()
</code></pre> 
<ol start="2"><li>last()</li></ol> 
<pre><code>获取最后一个元素
a[last()]
</code></pre> 
<ol start="3"><li>获取节点属性</li></ol> 
<pre><code>直接使用 @
获取所有li节点下a节点的href属性
//li/a/@href
</code></pre> 
<ol start="4"><li>contains() 判断是否包含</li></ol> 
<pre><code># 获取所有a标签(text包含 Next &gt;的)的href属性
//a[contains(text(), 'Next &gt;')]/@href
# 获取所有a标签(class属性包含 Next &gt;的)
//a[contains(@class, 'Next &gt;')]
</code></pre> 
<h3><a id="xpath_124"></a>xpath提取元素</h3> 
<p>在F12浏览器调试中可以Ctrl+Shift+C，或直接选择器选中元素右键copy，选择xpath复制</p> 
<h4><a id="scrapyxpath_128"></a>在scrapy项目中使用xpath</h4> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 不建议的写法</span>
    <span class="token comment"># /html/body/div[2]/div[2]/div[4]/div[1]/div[2]/h2/a/@href</span>
    <span class="token comment"># 路径短</span>
    <span class="token comment"># //*[@id="entry_732084"]/div[2]/h2/a/@href 该方法写死了id</span>
    href <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//*[@id="entry_732084"]/div[2]/h2/a/@href'</span><span class="token punctuation">)</span>
    <span class="token comment"># 提出字符串值,返回list,["",""]</span>
    val_list <span class="token operator">=</span> href<span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 提出字符串值,返回第一个结果</span>
    val_first <span class="token operator">=</span> href<span class="token punctuation">.</span>extract_first<span class="token punctuation">(</span>default<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>val_first<span class="token punctuation">)</span>
    <span class="token comment"># 推荐写法</span>
    href <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//div[@id="news_list"]/div[1]/div[2]/h2/a/@href'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>href<span class="token punctuation">.</span>extract_first<span class="token punctuation">(</span>default<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># 推荐写法,缩短路径</span>
    href <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//div[@id="news_list"]//h2/a/@href'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>href<span class="token punctuation">.</span>extract_first<span class="token punctuation">(</span>default<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># 推荐写法,缩短路径,指定父节点</span>
    href <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//div[@id="news_list"]//h2[@class="news_entry"]/a/@href'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>href<span class="token punctuation">.</span>extract_first<span class="token punctuation">(</span>default<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">pass</span>
<span class="token comment"># //* 忽略前面的节点 [@id="xx"] 通过id定位到节点减少路径</span>
</code></pre> 
<p>Selector使用xpath</p> 
<pre><code>from scrapy.selector import Selector

Selector(text=browser.page_source).xpath(
        '//*[@id="boardfeed:287808301125883930"]/div/div[1]/div[1]/div/div/div/div/div[1]/a/div/div/div/div/div[1]/img').extract()
</code></pre> 
<h4><a id="lxml_xpath_163"></a>lxml直接使用 xpath</h4> 
<p>lxml</p> 
<pre><code>from lxml import etree


index_url = "https://www.baidu.com"
index_resp = requests.get(index_url, headers=headers)
index_tree = etree.HTML(index_resp.text)
suf_list = index_tree.xpath(
    '//div[@class="title"]/a/@href')
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/35ae2100da293e132a6706d421e10e94/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">charles代理工具使用</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a7d2e1bec2a621438829f6329bdea35e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">wireguard windows\linux版本client\server的配置</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>