<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Android编译系统-概念篇 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Android编译系统-概念篇" />
<meta property="og:description" content="Android系统启动篇 1，《android系统启动流程简介》
2，《android init进程启动流程》
3，《android zygote进程启动流程》
4，《Android SystemServer进程启动流程》
5，《android launcher启动流程》
6，《Android Activity启动过程详解》
Android系统开发准备篇 1，《Android 源码下载和编译》
2，《android 11源码编译和pixel3 刷机》
3，《Android Framework代码IDE加载和调试》
Android系统开发实践篇 1，《android设置默认输入法》
2，《android framework预制APK应用》
3，《Android系统层面限制应用开机自启动详解》
4，《android单独编译framework模块并push》
5，《Android Framework开发系统问题分析》
Android系统开发核心知识储备篇 1，《Android编译系统-envsetup和lunch代码篇》
2，《Android编译系统-概念篇》
3，《android日志系统详解》
4，《Android系统Handler详解》
5，《Android系统Binder详解》
6，《Android中Activity、View和Window关系详解》
7，《android view绘制流程详解》
8，《Android读取系统属性详解》
9，《android 窗口管理机制详解》
10，《初识Android系统》
11，《android中AMS进程通知Zygote进程fork新进程的通信方式》
Android核心功能详解篇 1，《android应用市场点击下载APK安装详解》
2，《Android 手势导航（从下往上滑动进入多任务页面）》
3，《android手势分析（应用界面左往右边滑动退出应用）》
4，《android应用安装流程详解》
5，《android11安装应用触发桌面图标刷新流程》
6，《Android系统多任务Recents详解》
7，《android系统导航栏视图分析》
———————————————————————————————————————————
一，基础介绍 在 Android 7.0 之前，Android 编译系统使用 GNU Make 描述和shell来构建编译规则，模块定义都使用Android.mk进行定义，Android.mk的本质就是Makefile，但是随着Android的工程越来越大，模块越来越多，Makefile组织的项目编译时间越来越长。
从Android7.0开始，Google采用ninja来代取代之前使用的make，由于之前的Android.mk数据实在巨大，因此Google加入了一个kati工具，用于将Android.mk转换成ninja的构建规则文件buildxxx.ninja,再使用ninja来进行构建工作。Android8.0开始，Google为了进一步淘汰Makefile，因此引入了Android.bp文件来替换之前的Android.mk。
Android.bp只是一个纯粹的配置文件，不包括分支、循环语句等控制流程，本质上就是一个json配置文件。Android.bp 通过Blueprint&#43;soong转换成ninja的构建规则文件build.ninja，再使用ninja来进行构建工作。
Google在 Android 7.0之后，引入了Soong构建系统，旨在取代make，它利用 Kati GNU Make 克隆工具和 Ninja 构建系统组件来加速 Android 的构建。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/bfda0a7a7adb5e4deebb00328b568913/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-06-14T10:52:20+08:00" />
<meta property="article:modified_time" content="2023-06-14T10:52:20+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Android编译系统-概念篇</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>  Android系统启动篇</h2> 
<p><a href="https://blog.csdn.net/allen_xu_2012_new/article/details/130699710?spm=1001.2014.3001.5502" title="1，《android系统启动流程简介》">1，《android系统启动流程简介》</a></p> 
<p><a href="https://blog.csdn.net/allen_xu_2012_new/article/details/130701425?spm=1001.2014.3001.5502" title="2，《android init进程启动流程》">2，《android init进程启动流程》</a></p> 
<p><a href="https://blog.csdn.net/allen_xu_2012_new/article/details/131052014?spm=1001.2014.3001.5502" title="3，《android zygote进程启动流程》">3，《android zygote进程启动流程》</a></p> 
<p><a href="https://blog.csdn.net/allen_xu_2012_new/article/details/130747522?spm=1001.2014.3001.5502" title="4，《Android SystemServer进程启动流程》">4，《Android SystemServer进程启动流程》</a></p> 
<p><a href="https://blog.csdn.net/allen_xu_2012_new/article/details/130759962?spm=1001.2014.3001.5502" title="5，《android launcher启动流程》">5，《android launcher启动流程》</a></p> 
<p><a href="https://blog.csdn.net/allen_xu_2012_new/article/details/131167564?spm=1001.2014.3001.5502" title="6，《Android Activity启动过程详解》">6，《Android Activity启动过程详解》</a></p> 
<h2>Android系统开发准备篇</h2> 
<p><a href="https://blog.csdn.net/allen_xu_2012_new/article/details/130446397?spm=1001.2014.3001.5502" title="1，《Android 源码下载和编译》">1，《Android 源码下载和编译》</a></p> 
<p><a href="https://blog.csdn.net/allen_xu_2012_new/article/details/130447055?spm=1001.2014.3001.5502" title="2，《android 11源码编译和pixel3 刷机》">2，《android 11源码编译和pixel3 刷机》</a></p> 
<p><a href="https://blog.csdn.net/allen_xu_2012_new/article/details/130492532?spm=1001.2014.3001.5502" title="3，《Android Framework代码IDE加载和调试》">3，《Android Framework代码IDE加载和调试》</a></p> 
<h2>Android系统开发实践篇</h2> 
<p><a href="https://blog.csdn.net/allen_xu_2012_new/article/details/130481555?spm=1001.2014.3001.5502" title="1，《android设置默认输入法》">1，《android设置默认输入法》</a></p> 
<p><a href="https://blog.csdn.net/allen_xu_2012_new/article/details/130447956?spm=1001.2014.3001.5502" title="2，《android framework预制APK应用》">2，《android framework预制APK应用》</a></p> 
<p><a href="https://blog.csdn.net/allen_xu_2012_new/article/details/130447956?spm=1001.2014.3001.5502" title="3，《Android系统层面限制应用开机自启动详解》">3，《Android系统层面限制应用开机自启动详解》</a></p> 
<p><a href="https://blog.csdn.net/allen_xu_2012_new/article/details/130683203?spm=1001.2014.3001.5502" title="4，《android单独编译framework模块并push》">4，《android单独编译framework模块并push》</a></p> 
<p><a href="https://blog.csdn.net/allen_xu_2012_new/article/details/130592784?spm=1001.2014.3001.5502" title="5，《Android Framework开发系统问题分析》">5，《Android Framework开发系统问题分析》</a></p> 
<h2>Android系统开发核心知识储备篇</h2> 
<p><a href="https://blog.csdn.net/allen_xu_2012_new/article/details/130601545?spm=1001.2014.3001.5502" title="1，《Android编译系统-envsetup和lunch代码篇》">1，《Android编译系统-envsetup和lunch代码篇》</a></p> 
<p><a href="https://blog.csdn.net/allen_xu_2012_new/article/details/130601069?spm=1001.2014.3001.5502" title="2，《Android编译系统-概念篇》">2，《Android编译系统-概念篇》</a></p> 
<p><a href="https://blog.csdn.net/allen_xu_2012_new/article/details/130554120?spm=1001.2014.3001.5502" title="3，《android日志系统详解》">3，《android日志系统详解》</a></p> 
<p><a href="https://blog.csdn.net/allen_xu_2012_new/article/details/131150340?spm=1001.2014.3001.5502" title="4，《Android系统Handler详解》">4，《Android系统Handler详解》</a></p> 
<p><a href="https://blog.csdn.net/allen_xu_2012_new/article/details/131123375?spm=1001.2014.3001.5502" title="5，《Android系统Binder详解》">5，《Android系统Binder详解》</a></p> 
<p><a href="https://blog.csdn.net/allen_xu_2012_new/article/details/131109579?spm=1001.2014.3001.5502" title="6，《Android中Activity、View和Window关系详解》">6，《Android中Activity、View和Window关系详解》</a></p> 
<p><a href="https://blog.csdn.net/allen_xu_2012_new/article/details/131090905?spm=1001.2014.3001.5502" title="7，《android view绘制流程详解》">7，《android view绘制流程详解》</a></p> 
<p><a href="https://blog.csdn.net/allen_xu_2012_new/article/details/130964613?spm=1001.2014.3001.5502" title="8，《Android读取系统属性详解》">8，《Android读取系统属性详解》</a></p> 
<p><a href="https://blog.csdn.net/allen_xu_2012_new/article/details/130777822?spm=1001.2014.3001.5502" title="9，《android 窗口管理机制详解》">9，《android 窗口管理机制详解》</a></p> 
<p><a href="https://blog.csdn.net/allen_xu_2012_new/article/details/130686397?spm=1001.2014.3001.5502" title="10，《初识Android系统》">10，《初识Android系统》</a></p> 
<p><a href="https://blog.csdn.net/allen_xu_2012_new/article/details/131067430?spm=1001.2014.3001.5502" title="11，《android中AMS进程通知Zygote进程fork新进程的通信方式》">11，《android中AMS进程通知Zygote进程fork新进程的通信方式》</a></p> 
<h2>Android核心功能详解篇</h2> 
<p><a href="https://blog.csdn.net/allen_xu_2012_new/article/details/130770012?spm=1001.2014.3001.5502" title="1，《android应用市场点击下载APK安装详解》">1，《android应用市场点击下载APK安装详解》</a></p> 
<p><a href="https://blog.csdn.net/allen_xu_2012_new/article/details/130678948?spm=1001.2014.3001.5502" title="2，《Android 手势导航（从下往上滑动进入多任务页面）》">2，《Android 手势导航（从下往上滑动进入多任务页面）》</a></p> 
<p><a href="https://blog.csdn.net/allen_xu_2012_new/article/details/130678786?spm=1001.2014.3001.5502" title="3，《android手势分析（应用界面左往右边滑动退出应用）》">3，《android手势分析（应用界面左往右边滑动退出应用）》</a></p> 
<p><a href="https://blog.csdn.net/allen_xu_2012_new/article/details/130677276?spm=1001.2014.3001.5502" title="4，《android应用安装流程详解》">4，《android应用安装流程详解》</a></p> 
<p><a href="https://blog.csdn.net/allen_xu_2012_new/article/details/130654543?spm=1001.2014.3001.5502" title="5，《android11安装应用触发桌面图标刷新流程》">5，《android11安装应用触发桌面图标刷新流程》</a></p> 
<p><a href="https://blog.csdn.net/allen_xu_2012_new/article/details/130654543?spm=1001.2014.3001.5502" title="6，《Android系统多任务Recents详解》">6，《Android系统多任务Recents详解》</a></p> 
<p><a href="https://blog.csdn.net/allen_xu_2012_new/article/details/130644539?spm=1001.2014.3001.5502" title="7，《android系统导航栏视图分析》">7，《android系统导航栏视图分析》</a></p> 
<p>———————————————————————————————————————————</p> 
<h2>一，基础介绍</h2> 
<p>        在 Android 7.0 之前，Android 编译系统使用 GNU Make 描述和shell来构建编译规则，模块定义都使用Android.mk进行定义，Android.mk的本质就是Makefile，但是随着Android的工程越来越大，模块越来越多，Makefile组织的项目编译时间越来越长。</p> 
<p>        从Android7.0开始，Google采用ninja来代取代之前使用的make，由于之前的Android.mk数据实在巨大，因此Google加入了一个kati工具，用于将Android.mk转换成ninja的构建规则文件buildxxx.ninja,再使用ninja来进行构建工作。Android8.0开始，Google为了进一步淘汰Makefile，因此引入了Android.bp文件来替换之前的Android.mk。</p> 
<p>        Android.bp只是一个纯粹的配置文件，不包括分支、循环语句等控制流程，本质上就是一个json配置文件。Android.bp  通过Blueprint+soong转换成ninja的构建规则文件build.ninja，再使用ninja来进行构建工作。</p> 
<p>        Google在 Android 7.0之后，引入了Soong构建系统，旨在取代make，它利用 Kati GNU Make 克隆工具和 Ninja 构建系统组件来加速 Android 的构建。</p> 
<p>  Android系统的编译历程：<br><img alt="" height="439" src="https://images2.imgbox.com/c3/18/aE5T41WQ_o.png" width="765"></p> 
<p></p> 
<h2>2 编译流程</h2> 
<h3><a name="t3"></a>2.1 编译构成</h3> 
<p>        Android的编译目录在/build 中，看一下Android 10源码中的build目录，现在是这个样子：</p> 
<p> 这个目录中可以看到core文件夹被link到了make/core，envsetup.sh被link到make/envsetup.sh，这主要是为了对使用者屏蔽切换编译系统的差异。</p> 
<p>          这里重点看四个文件夹：blueprint、kati、make、soong</p> 
<p>  blueprint：用于处理Android.bp，编译生成*.ninja文件，用于做ninja的处理</p> 
<p>  kati：用于处理Android.mk，编译生成*.ninja文件，用于做ninja的处理</p> 
<p>  make：文件夹还是原始的make那一套流程，比如envsetup.sh</p> 
<p>  soong：构建系统，核心编译为soong_ui.bash<br>  </p> 
<p><strong>Soong编译系统家族成员及各自关系如下图所示：</strong></p> 
<p><img alt="" height="551" src="https://images2.imgbox.com/d6/de/SgOa3nHR_o.png" width="511"></p> 
<p>在编译过程中，Android.bp会被收集到out/soong/build.ninja.d,blueprint以此为基础，生成out/soong/build.ninja</p> 
<p>Android.mk会由kati/ckati生成为out/build-aosp_arm.ninja</p> 
<p>两个ninja文件会被整合进入out/combined-aosp_arm.ninja<br>  </p> 
<h3>2.2 编译步骤</h3> 
<p>  source build/envsetup.sh</p> 
<p>  lunch aosp_arm-eng // 或者 m PRODUCT-aosp_x86_64-eng ，Android10.0不一定需要lunch命令</p> 
<p>  make -j8      //编译模块也可以直接用 m libart</p> 
<p>    编译步骤如下图所示：</p> 
<p><img alt="" height="182" src="https://images2.imgbox.com/30/c0/crMkizuF_o.png" width="620"></p> 
<h2>3 编译环境初始化</h2> 
<h3><a name="t6"></a>3.1 envsetup说明</h3> 
<p>  编译的第一步需要初始化一下环境变量，通过以下命令完成：</p> 
<pre><code> source build/envsetup.sh</code></pre> 
<p></p> 
<p>这里的envsetup.sh被link到了 build/make/envsetup.sh</p> 
<p><strong>  envsetup.sh 主要做了下面几个事情：</strong></p> 
<p><img alt="" height="328" src="https://images2.imgbox.com/58/0b/Qp7iICFK_o.png" width="784"></p> 
<p></p> 
<p></p> 
<h3>3.2 Lunch 说明</h3> 
<p>        环境变量初始化完成后，我们需要选择一个编译目标。lunch 主要作用是根据用户输入或者选择的产品名来设置与具体产品相关的环境变量。</p> 
<p>        如果你不知道想要编译的目标是什么，直接执行一个lunch命令，会列出所有的目标，直接回车，会默认使用aosp_arm-eng这个目标。</p> 
<h3><strong>3.3 soong的编译过程</strong></h3> 
<p><img alt="" height="641" src="https://images2.imgbox.com/25/5c/3xEdpEoV_o.png" width="1165"></p> 
<p>        执行runKatiBuild时，有个重要的步骤，就是加载build/make/core/main.mk，main.mk文件是Android Build系统的主控文件。从main.mk开始，将通过include命令将其所有需要的.mk文件包含进来，最终在内存中形成一个包括所有编译脚本的集合，这个相当于一个巨大Makefile文件。Makefile文件看上去很庞大，其实主要由三种内容构成: 变量定义、函数定义和目标依赖规则，此外mk文件之间的包含也很重要。</p> 
<h3>3.4.工具链的关系</h3> 
<p>  Android.mk文件、Android.bp、kati、Soong、Blueprint、Ninja之间的关系如下：</p> 
<p>    Android.bp --&gt; Blueprint --&gt; Soong --&gt; Ninja<br>       Makefile or Android.mk --&gt; kati --&gt; Ninja<br>       (Android.mk --&gt; Soong --&gt; Blueprint --&gt; Android.bp)</p> 
<p>          Blueprint是生成、解析Android.bp的工具，是Soong的一部分。Soong则是专为Android编译而设计的工具，Blueprint只是解析文件的形式，而Soong则解释内容的含义。</p> 
<p>          Android.mk可以通过Soong提供的androidmk转换成Android.bp，但仅限简单配置。目前Oreo的编译流程中，仍然是使用kati来做的转换。</p> 
<p>          现存的Android.mk文件、既有的Android.bp，都会分别被转换成Ninja。从Android.mk与其它Makefile，会生成out/build-&lt;product_name&gt;.ninja文件。而从Android.bp，则会生成out/soong/build.ninja。此外，还会生成一个较小的out/combined-&lt;product_name&gt;.ninja文件，负责把二者组合起来，作为执行入口。</p> 
<p>          最终，Ninja文件才是真正直接控制源码编译的工具。<br> ————————————————<br> 参考文章：https://blog.csdn.net/yiranfeng/article/details/109082489</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/bd007c2f138688c6de68e39ef5828215/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">C/C&#43;&#43;《程序设计课程设计》[2023-06-14]</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e6f023e5a71bf873d7b5a60c4fcc5e66/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">android11安装应用触发桌面图标刷新流程</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>