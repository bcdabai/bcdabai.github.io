<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>（一）「消息队列」之 RabbitMQ 入门 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="（一）「消息队列」之 RabbitMQ 入门" />
<meta property="og:description" content="0、引言 想要实现两个应用程序之间的通信，我们可以借助“消息队列”技术。本文将介绍使用 C# 语言在 .NET 下实现 RabbitMQ 消息队列；当然无论是哪种编程语言，要使用消息队列，都需要完成以下两个基本步骤：
下载并安装相应的消息队列服务器软件，并根据需要进行配置；在您的应用程序代码中引入相应的消息队列客户端库，并使用客户端库提供的API来建立与消息队列服务器的连接并进行通信。 这些步骤对于大多数消息队列中间件都是适用的。不同的消息队列中间件可能有不同的安装和配置方法，以及不同的客户端库和API，您可以根据自身需要阅读相应的官方文档即可。
本文主要参考：
RabbitMQ TutorialsRabbitMQ使用教程(超详细)C# 消息队列之 RabbitMQ 基础入门消息队列常见的几种使用场景介绍！- 知乎分布式之消息队列的特点、选型、及应用场景详解消息队列漫谈：什么是消息模型？- 知乎 1、基础概念 消息队列 消息队列（ Message Queue）是一种通信模式，用于在应用程序之间传递消息。它提供了一种异步的、可靠的通信方式，允许发送者（发送消息的应用程序）和接收者（接收消息的应用程序）能够独立地进行工作，而不需要彼此直接交互。 在消息队列中，消息是以队列的形式存储和传递的。发送者将消息放入队列的末尾，而接收者从队列的开头获取消息。这种队列的特性确保了消息的有序处理，并且允许多个发送者和接收者之间进行解耦，从而提高了系统的可伸缩性和可靠性。 消息队列的使用可以带来许多好处。首先，它允许异步处理，即发送者可以在发送消息后继续执行其他任务，而不需要等待接收者的响应。这种方式可以提高应用程序的性能和吞吐量，特别是在处理大量消息或处理延迟较高的操作时。 其次，消息队列可以解耦发送者和接收者之间的依赖关系。发送者只需将消息发送到队列中，而不需要知道具体的接收者是谁或接收者何时处理消息。这种松耦合的设计允许系统中的不同模块独立开发、部署和扩展，提高了系统的灵活性和可维护性。 此外，消息队列还提供了消息持久化的能力，确保即使在发送者和接收者之间发生故障或中断时，消息不会丢失。消息可以持久化到磁盘上，并在系统恢复后重新发送。这种可靠性保证了消息的传递不会因为故障而中断，使系统更加健壮和可靠。 常见的消息队列软件 RabbitMQApache KafkaApache ActiveMQAmazon SQSMicrosoft Azure Service Bus 中间件 中间件是指位于操作系统和应用程序之间的软件层。它充当了不同软件组件之间的桥梁，提供了通信和协调的功能，以便它们能够相互交互和协作。 中间件的主要目标是简化分布式系统的开发和管理。它提供了一组通用的功能和服务，使得不同的应用程序和系统可以进行互操作，并能够以可靠、安全和高效的方式进行通信。 中间件可以实现各种功能，包括但不限于以下几个方面： 消息传递：中间件提供消息传递机制，用于在分布式系统中传递和交换数据。消息队列就是一种常见的消息传递中间件。远程过程调用（RPC）：中间件可以实现远程过程调用，使得应用程序能够在不同的计算机或进程之间调用和执行函数或方法。数据库连接和访问：中间件可以提供数据库连接和访问的功能，使得应用程序能够方便地操作和管理数据库。分布式事务处理：中间件可以支持分布式系统中的事务处理，确保多个操作在不同的计算机或进程之间具有原子性、一致性、隔离性和持久性。缓存管理：中间件可以提供缓存管理的功能，加速数据访问和提高系统性能。安全认证和授权：中间件可以实现安全认证和授权机制，保护系统免受未经授权的访问和攻击。 Erlang Erlang 是一种通用的编程语言，最初由爱立信（Ericsson）的开发团队在1980年代末创建。它是一种函数式编程语言，专门设计用于构建可扩展、并发和分布式的软实时系统。 RabbitMQ 服务是使用 Erlang 语言编写的。 AMQP ( Advanced Message Queuing Protocol) AMQP 即 高级消息队列协议：一种面向消息的网络协议（应用层协议），用于在应用程序之间传递消息。 RabbitMQ 是对 AMQP 0.9.1 协议的 实现。并在后续拓展了对 更多协议的支持。 RabbitMQ 介绍 RabbitMQ 是一个消息代理：它接受并转发消息。 你可以把它想象成一个邮局：当你把你想要邮寄的邮件放在邮箱里时， 您可以确定，邮递员最终会将邮件递送给您的收件人。 在这个类比中，RabbitMQ是一个邮政信箱，一个邮局和一个信件载体。 RabbitMQ 和邮局的主要区别在于它不处理纸张。相反，它接受、存储和转发二进制 blob 数据 —— 消息（ Message）。 RabbitMQ，以及一般的消息传递，会使用一些术语： 生产 Producing 仅仅只是意味着发送。发送消息的程序被称为 生产者 Producer：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/37f35c83a394ab34f9f34aa0cfecdbf1/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-07-27T10:53:10+08:00" />
<meta property="article:modified_time" content="2023-07-27T10:53:10+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">（一）「消息队列」之 RabbitMQ 入门</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="0_0"></a>0、引言</h2> 
<p>想要实现两个应用程序之间的通信，我们可以借助“消息队列”技术。本文将介绍使用 C# 语言在 .NET 下实现 RabbitMQ 消息队列；当然无论是哪种编程语言，要使用消息队列，都需要完成以下两个基本步骤：</p> 
<ol><li>下载并安装相应的消息队列服务器软件，并根据需要进行配置；</li><li>在您的应用程序代码中引入相应的消息队列客户端库，并使用客户端库提供的API来建立与消息队列服务器的连接并进行通信。</li></ol> 
<p>这些步骤对于大多数消息队列中间件都是适用的。不同的消息队列中间件可能有不同的安装和配置方法，以及不同的客户端库和API，您可以根据自身需要阅读相应的官方文档即可。</p> 
<blockquote> 
 <p>本文主要参考：</p> 
 <ol><li><a href="https://www.rabbitmq.com/getstarted.html" rel="nofollow">RabbitMQ Tutorials</a></li><li><a href="https://blog.csdn.net/lzx1991610/article/details/102970854">RabbitMQ使用教程(超详细)</a></li><li><a href="https://www.cnblogs.com/abeam/p/11872956.html" rel="nofollow">C# 消息队列之 RabbitMQ 基础入门</a></li><li><a href="https://zhuanlan.zhihu.com/p/272700109#" rel="nofollow">消息队列常见的几种使用场景介绍！- 知乎</a></li><li><a href="https://zhuanlan.zhihu.com/p/97179688" rel="nofollow">分布式之消息队列的特点、选型、及应用场景详解</a></li><li><a href="https://zhuanlan.zhihu.com/p/99791229" rel="nofollow">消息队列漫谈：什么是消息模型？- 知乎</a></li></ol> 
</blockquote> 
<h2><a id="1_18"></a>1、基础概念</h2> 
<dl> 
  
  <a href="https://zhuanlan.zhihu.com/p/157112243" rel="nofollow">消息队列</a> 
  
 <dd> 
  <font color="#dd0000"><strong>消息队列</strong></font>（ 
  <font color="#dd0000"><strong>M</strong></font>essage 
  <font color="#dd0000"><strong>Q</strong></font>ueue）是一种通信模式，用于在应用程序之间传递消息。它提供了一种异步的、可靠的通信方式，允许发送者（发送消息的应用程序）和接收者（接收消息的应用程序）能够独立地进行工作，而不需要彼此直接交互。 
  <br> 
  <br>在消息队列中，消息是以队列的形式存储和传递的。发送者将消息放入队列的末尾，而接收者从队列的开头获取消息。这种队列的特性确保了消息的有序处理，并且允许多个发送者和接收者之间进行解耦，从而提高了系统的可伸缩性和可靠性。 
  <br> 
  <img src="https://images2.imgbox.com/68/14/rBqwflGs_o.jpg" alt="在这里插入图片描述"> 
  <br>消息队列的使用可以带来许多好处。首先，它允许异步处理，即发送者可以在发送消息后继续执行其他任务，而不需要等待接收者的响应。这种方式可以提高应用程序的性能和吞吐量，特别是在处理大量消息或处理延迟较高的操作时。 
  <br> 
  <br>其次，消息队列可以解耦发送者和接收者之间的依赖关系。发送者只需将消息发送到队列中，而不需要知道具体的接收者是谁或接收者何时处理消息。这种松耦合的设计允许系统中的不同模块独立开发、部署和扩展，提高了系统的灵活性和可维护性。 
  <br> 
  <br>此外，消息队列还提供了消息持久化的能力，确保即使在发送者和接收者之间发生故障或中断时，消息不会丢失。消息可以持久化到磁盘上，并在系统恢复后重新发送。这种可靠性保证了消息的传递不会因为故障而中断，使系统更加健壮和可靠。 
 </dd> 
  
  <a href="https://blog.csdn.net/u013521220/article/details/104352365"><strong>常见的消息队列软件</strong></a> 
  
 <dd> 
  <ul><li><a href="https://www.rabbitmq.com/" rel="nofollow">RabbitMQ</a></li><li><a href="https://kafka.apache.org/" rel="nofollow">Apache Kafka</a></li><li><a href="https://activemq.apache.org/" rel="nofollow">Apache ActiveMQ</a></li><li><a href="https://aws.amazon.com/sqs/" rel="nofollow">Amazon SQS</a></li><li><a href="https://azure.microsoft.com/en-us/services/service-bus/" rel="nofollow">Microsoft Azure Service Bus</a></li></ul> 
 </dd> 
 
   中间件 
  
 <dd> 
  <font color="#dd0000"><strong>中间件</strong></font>是指位于操作系统和应用程序之间的软件层。它充当了不同软件组件之间的桥梁，提供了通信和协调的功能，以便它们能够相互交互和协作。 
  <br> 
  <br>中间件的主要目标是简化分布式系统的开发和管理。它提供了一组通用的功能和服务，使得不同的应用程序和系统可以进行互操作，并能够以可靠、安全和高效的方式进行通信。 
  <br> 
  <br>中间件可以实现各种功能，包括但不限于以下几个方面： 
  <br> 
  <br> 
  <ol><li>消息传递：中间件提供消息传递机制，用于在分布式系统中传递和交换数据。消息队列就是一种常见的消息传递中间件。</li><li>远程过程调用（RPC）：中间件可以实现远程过程调用，使得应用程序能够在不同的计算机或进程之间调用和执行函数或方法。</li><li>数据库连接和访问：中间件可以提供数据库连接和访问的功能，使得应用程序能够方便地操作和管理数据库。</li><li>分布式事务处理：中间件可以支持分布式系统中的事务处理，确保多个操作在不同的计算机或进程之间具有原子性、一致性、隔离性和持久性。</li><li>缓存管理：中间件可以提供缓存管理的功能，加速数据访问和提高系统性能。</li><li>安全认证和授权：中间件可以实现安全认证和授权机制，保护系统免受未经授权的访问和攻击。</li></ol> 
 </dd> 
  
  <a href="https://www.erlang.org/" rel="nofollow">Erlang</a> 
  
 <dd> 
  <font color="#dd0000"><strong>Erlang</strong></font> 是一种通用的编程语言，最初由爱立信（Ericsson）的开发团队在1980年代末创建。它是一种函数式编程语言，专门设计用于构建可扩展、并发和分布式的软实时系统。 
  <font color="#008000">RabbitMQ 服务是使用 Erlang 语言编写的</font>。 
 </dd> 
  
  <a href="https://zh.wikipedia.org/wiki/%E9%AB%98%E7%BA%A7%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E5%8D%8F%E8%AE%AE" rel="nofollow">AMQP</a> ( 
  <font color="#dd0000"><strong>A</strong></font>dvanced 
  <font color="#dd0000"><strong>M</strong></font>essage 
  <font color="#dd0000"><strong>Q</strong></font>ueuing 
  <font color="#dd0000"><strong>P</strong></font>rotocol) 
  
 <dd> 
  <font color="#dd0000"><strong>AMQP</strong></font> 即 
  <em>高级消息队列协议</em>：一种面向消息的网络协议（应用层协议），用于在应用程序之间传递消息。 
  <font color="#008000">RabbitMQ 是对 AMQP 0.9.1 协议的</font> 
  <a href="https://www.rabbitmq.com/amqp-0-9-1-quickref.html" rel="nofollow">实现</a>。并在后续拓展了对 
  <a href="https://www.rabbitmq.com/protocols.html" rel="nofollow">更多协议的支持</a>。 
 </dd> 
  
  <a href="https://www.rabbitmq.com/tutorials/tutorial-one-dotnet.html" rel="nofollow">RabbitMQ 介绍</a> 
  
 <dd> 
  <font color="#dd0000"><strong>RabbitMQ</strong></font> 是一个消息代理：它接受并转发消息。 你可以把它想象成一个邮局：当你把你想要邮寄的邮件放在邮箱里时， 您可以确定，邮递员最终会将邮件递送给您的收件人。 在这个类比中，RabbitMQ是一个邮政信箱，一个邮局和一个信件载体。 
  <br>RabbitMQ 和邮局的主要区别在于它不处理纸张。相反，它接受、存储和转发二进制 
  <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Blob" rel="nofollow">blob</a> 数据 —— 
  <em>消息</em>（ 
  <em>Message</em>）。 
  <br>RabbitMQ，以及一般的消息传递，会使用一些术语： 
  <br> 
  <ul><li><font color="#00ffff"><em><strong>生产 Producing</strong></em></font> 仅仅只是意味着发送。发送消息的程序被称为 <font color="#00ffff"><em><strong>生产者 Producer</strong></em></font>：<br> 
    <center> 
     <img src="https://images2.imgbox.com/a6/ab/cGy1GwWe_o.png" alt=""> 
    </center></li><li>在 RabbitMQ 中，邮箱的名字就称为 <font color="#ff0000"><em><strong>队列 queue</strong></em></font>。尽管消息流经 RabbitMQ 和您的应用程序，但它们只能存储在 <font color="#ff0000"><em><strong>队列 queue</strong></em></font> 中。<font color="#ff0000"><em><strong>队列 queue</strong></em></font> 仅受主机内存和磁盘限制的约束，它本质上是一个大型消息缓冲区。许多 <font color="#00ffff"><em><strong>生产者 Producer</strong></em></font> 可以往一个队列发送消息，许多 <font color="#33ccff"><em><strong>消费者 Consumer</strong></em></font> 也可以尝试从一个 <font color="#ff0000"><em><strong>队列 queue</strong></em></font> 接收数据。这就是我们表示队列的方式：<br> 
    <center> 
     <img src="https://images2.imgbox.com/80/67/RVb7NoaO_o.png" alt=""> 
    </center></li><li><font color="#33ccff"><em><strong>消费 Consuming</strong></em></font> 与接收意思相近。主要等待接收消息的程序被称为 <font color="#33ccff"><em><strong>消费者 Consumer</strong></em></font>：<br> 
    <center> 
     <img src="https://images2.imgbox.com/5e/79/bYqAlioB_o.png" alt=""> 
    </center></li></ul> 
  <blockquote>
    🔔 请注意：生产者、消费者和代理不必驻留在同一主机上；事实上，在大多数应用程序中，它们不会。此外，一个应用程序可以同时是生产者和消费者。 
  </blockquote> 
 </dd> 
</dl> 
<h2><a id="2_42"></a>2、本文使用的相关软件或产品</h2> 
<ol><li>Windows 10 专业版 22H2</li><li>Visual Studio Community 2022 - 17.6.2</li><li>Microsoft .NET Framework 版本 4.8.04084</li><li>「.NET 桌面开发」工作负荷</li><li>Erlang 25.3</li><li>RabbitMQ Server 3.12.0</li></ol> 
<h2><a id="3__51"></a>3、🔔 须知</h2> 
<p><font color="#C71585">大多数消息队列中间件都需要在计算机上安装服务器软件。安装服务器软件后，您需要启动消息队列服务器并根据需要进行配置。然后，您就可以在您的应用程序中使用相应的客户端库来连接到消息队列服务器并使用消息队列了。</font></p> 
<h2><a id="4___55"></a>4、安装前准备工作 —— 阅读安装向导页面</h2> 
<blockquote> 
 <p>💬 如果您不想阅读安装向导，那么直接跳过第四章就好啦~ <a href="#AnchorPoint-InstallRabbitMQServer" rel="nofollow">点击</a>前往第五章</p> 
</blockquote> 
<ol><li> <p>首先前往 RabbitMQ 的<a href="https://www.rabbitmq.com/#getstarted" rel="nofollow">入门指南页面</a>，点击“<strong>Download + Installation</strong>”：<br><img src="https://images2.imgbox.com/28/52/9XITbgnI_o.png" alt="在这里插入图片描述"></p> </li><li> <p>进入到<a href="https://www.rabbitmq.com/download.html" rel="nofollow">下载和安装 RabbitMQ 页面</a>，可以看到最新的 RabbitMQ <a href="https://github.com/rabbitmq/rabbitmq-server/releases">发行版本</a>为 <strong>3.12.0</strong>。由于笔者使用的 Windows 操作系统，故点击“<strong>Windows Installer</strong>”进入 Windows 平台的安装程序的安装向导页面：<br><img src="https://images2.imgbox.com/9b/f8/sU4R3qvE_o.png" alt="在这里插入图片描述"></p> 
  <blockquote> 
   <p>您也可以通过 <a href="https://community.chocolatey.org/packages/rabbitmq" rel="nofollow">Chocolatey 包安装</a>（本文不演示）或者通过<a href="https://www.rabbitmq.com/install-windows-manual.html" rel="nofollow">构建二进制包手动安装</a>（通常不推荐）。</p> 
  </blockquote> </li><li> <p>进入到 <a href="https://www.rabbitmq.com/install-windows.html" rel="nofollow">Windows 平台安装程序的向导页面</a>，推荐了两个安装选项：①使用 Chocolatey 安装；②以管理员身份使用官方安装程序安装。这里选择第二项 —— “<a href="#AnchorPoint-UsingtheInstaller" rel="nofollow">Using the official installer</a> as an administrative user”：<br><img src="https://images2.imgbox.com/20/c8/znWzmqL3_o.png" alt="在这里插入图片描述"></p> </li></ol> 
<a id="AnchorPoint-UsingtheInstaller"> </a> 
<h3><a id="41httpswwwrabbitmqcominstallwindowshtmlinstaller_68"></a>4.1、<a href="https://www.rabbitmq.com/install-windows.html#installer" rel="nofollow">使用安装程序</a></h3> 
<p>官方的 RabbitMQ 安装程序是为<a href="https://www.rabbitmq.com/changelog.html" rel="nofollow">每个 RabbitMQ 版本</a>生成的。</p> 
<p>与<a href="https://www.rabbitmq.com/install-windows.html#chocolatey" rel="nofollow">通过 Chocolatey 安装</a>相比，此选项为 Windows 用户提供了最大的灵活性，但也要求他们了解安装程序中的某些假设和要求：</p> 
<ul><li>一次只能安装一个 Erlang 版本；</li><li>必须<strong>以管理员身份</strong>安装 Erlang；</li><li><strong>强烈建议</strong> RabbitMQ 也是通过管理员身份安装；</li><li>安装路径只能包含 ASCII 字符，<strong>强烈建议</strong>安装路径的任何目录名称中都不要包含空格；</li><li>可能需要手动复制 CLI 工具使用的<a href="https://www.rabbitmq.com/cli.html#erlang-cookie" rel="nofollow">共享密钥</a>文件；</li><li>CLI 工具要求在 UTF-8 模式下运行 Windows 控制台。</li></ul> 
<p>如果不满足这些条件，Windows 服务和 CLI 工具可能需要重新安装或其他手动步骤，以使它们按预期运行。</p> 
<p><a href="https://www.rabbitmq.com/windows-quirks.html" rel="nofollow">Windows 特定问题</a>指南中对此进行了更详细的介绍。</p> 
<h4><a id="411_85"></a>4.1.1、依赖</h4> 
<p>RabbitMQ 需要安装 64 位其<a href="https://www.rabbitmq.com/which-erlang.html" rel="nofollow">支持的 Erlang for Windows</a> 版本。</p> 
<p><a href="https://www.erlang.org/patches/otp-25.3.2" rel="nofollow">Erlang 25.3</a> 是最新的支持版本。您可以在 <a href="https://erlang.org/download/otp_versions_tree.html" rel="nofollow">Erlang/OTP 版本树</a>页面获取其他版本（比如：早期版本）的 Erlang for Windows 二进制构建包。</p> 
<p>Erlang <strong>必须以管理员身份安装</strong>，否则 RabbitMQ Windows 服务将无法发现它。安装完成支持的 Erlang 版本后，下载 RabbitMQ 安装程序 <code>rabbitmq-server-{version}.exe</code> 并运行它。安装程序会将 RabbitMQ 作为 Windows 服务进行安装并使用默认配置启动它。</p> 
<a id="AnchorPoint-DirectDownload"> </a> 
<h4><a id="412httpswwwrabbitmqcominstallwindowshtmldownloads_95"></a>4.1.2、<a href="https://www.rabbitmq.com/install-windows.html#downloads" rel="nofollow">直接下载</a></h4> 
<table><thead><tr><th>描述</th><th>下载</th><th>签名</th></tr></thead><tbody><tr><td>Windows 系统的安装程序（来自 <a href="https://github.com/rabbitmq/rabbitmq-server/releases">Github</a>）</td><td><a href="https://github.com/rabbitmq/rabbitmq-server/releases/download/v3.12.0/rabbitmq-server-3.12.0.exe">rabbitmq-server-3.12.0.exe</a></td><td><a href="https://github.com/rabbitmq/rabbitmq-server/releases/download/v3.12.0/rabbitmq-server-3.12.0.exe.asc">签名</a></td></tr></tbody></table> 
<h3><a id="42_RabbitMQ_Windows_httpswwwrabbitmqcominstallwindowshtmlservice_101"></a>4.2、<a href="https://www.rabbitmq.com/install-windows.html#service" rel="nofollow">运行 RabbitMQ Windows 服务</a></h3> 
<p>一旦 Erlang 和 RabbitMQ 都被安装了，RabbitMQ 节点就能作为 Windows 服务启动。RabbitMQ 服务会自动启动。RabbitMQ Windows 服务可以从“开始”菜单进行管理。</p> 
<h3><a id="43CLI_httpswwwrabbitmqcominstallwindowshtmlcli_105"></a>4.3、<a href="https://www.rabbitmq.com/install-windows.html#cli" rel="nofollow">CLI 工具</a></h3> 
<p>RabbitMQ 节点通常使用 <a href="https://learn.microsoft.com/zh-cn/windows-server/administration/windows-commands/powershell" rel="nofollow">PowerShell</a> 中的 <a href="https://www.rabbitmq.com/cli.html" rel="nofollow">CLI 工具</a>进行管理、检查和操作。</p> 
<p>在 Windows 上，与其他平台相比，CLI 工具具有 <code>.bat</code> 后缀。例如：Windows 上的 <code>rabbitmqctl</code> 被调用为 <code>rabbitmqctl.bat</code>。</p> 
<p>为了使这些工具正常工作，它们必须能够使用名为 <strong>Erlang cookie</strong> 的共享密钥文件<a href="https://www.rabbitmq.com/cli.html#erlang-cookie" rel="nofollow">向 RabbitMQ 节点进行身份验证</a>。</p> 
<p><a href="https://www.rabbitmq.com/cli.html" rel="nofollow">CLI 工具向导</a>主页面涵盖了与命令行工具使用相关的绝大部分话题。</p> 
<p>要了解各种 RabbitMQ CLI 工具提供的命令，请使用 <code>help</code> 命令：</p> 
<pre><code class="prism language-shell"><span class="token comment"># 罗列 rabbitmqctl.bat 提供的命令</span>
rabbitmqctl.bat <span class="token builtin class-name">help</span>

<span class="token comment"># 罗列 rabbitmq-diagnostics.bat 提供的命令</span>
rabbitmq-diagnostics.bat <span class="token builtin class-name">help</span>

<span class="token comment"># 罗列 rabbitmq-plugins.bat 提供的命令</span>
rabbitmq-plugins.bat <span class="token builtin class-name">help</span>
</code></pre> 
<p>想要学习特定命令，将命令名称作为 <code>help</code> 的参数传递即可：</p> 
<pre><code class="prism language-shell">rabbitmqctl.bat <span class="token builtin class-name">help</span> add_user
</code></pre> 
<h3><a id="44Cookie_httpswwwrabbitmqcominstallwindowshtmlclicookiefilelocation_134"></a>4.4、<a href="https://www.rabbitmq.com/install-windows.html#cli-cookie-file-location" rel="nofollow">Cookie 文件位置</a></h3> 
<p>在 Windows 平台下，<a href="https://www.rabbitmq.com/cli.html#cookie-file-locations" rel="nofollow">cookie 文件位置</a>取决于是否设置了 <code>HOMEDRIVE</code> 和 <code>HOMEPATH</code> 环境变量。</p> 
<p>如果 RabbitMQ 使用非管理员账户安装，则节点和 CLI 工具使用的<a href="https://www.rabbitmq.com/cli.html#erlang-cookie" rel="nofollow">共享密钥</a>文件将不会被放到正确的位置，这会导致使用 <code>rabbitmqctl.bat</code> 以及其他 CLI 工具时出现<a href="https://www.rabbitmq.com/cli.html#cli-authentication-failures" rel="nofollow">身份验证失败错误</a>。</p> 
<p>可以使用下列选项之一化解：</p> 
<ul><li>使用管理员账户重新安装 RabbitMQ</li><li>从 <code>%SystemRoot%</code> 或 <code>%SystemRoot%\system32\config\systemprofile</code> 手动复制 <code>.erlang.cookie</code> 文件到 <code>%HOMEDRIVE%%HOMEPATH%</code></li></ul> 
<hr> 
<p>…（更多内容请自行前往 <a href="https://www.rabbitmq.com/install-windows.html" rel="nofollow">Windows 平台的安装程序向导页面</a>了解）</p> 
<a id="AnchorPoint-InstallRabbitMQServer"> </a> 
<h2><a id="5_RabbitMQ__151"></a>5、正式开始安装 RabbitMQ 服务器</h2> 
<h3><a id="51_Erlang_153"></a>5.1、下载安装 Erlang</h3> 
<ol><li> <p>在安装 RabbitMQ 之前，首先安装 RabbitMQ 依赖 —— Erlang。前往 <a href="https://www.erlang.org/patches/otp-25.3.2" rel="nofollow">Erlang 25.3</a>，点击“<font color="#a2003e"><strong>Download Windows installer</strong></font>”：<br><img src="https://images2.imgbox.com/cd/47/rlaB5d3G_o.png" alt="在这里插入图片描述"></p> </li><li> <p>下载完成后，<font color="#ff4500"><strong>以管理员身份运行</strong></font>：<br><img src="https://images2.imgbox.com/c8/61/QPjzmJES_o.png" alt="在这里插入图片描述"></p> </li><li> <p>运行后进入组件选择页面，一般按默认选择即可，点击下一步：<br><img src="https://images2.imgbox.com/e7/4c/17Gppiu0_o.png" alt="在这里插入图片描述"></p> </li><li> <p>选择安装位置页面，可以按默认也可以根据自身喜好修改；确认后点击下一步：<br><img src="https://images2.imgbox.com/1b/01/FATGOZxV_o.png" alt="在这里插入图片描述"></p> </li><li> <p>选择开始菜单文件夹页面，该页面要求您通过点击选中或者手动输入的方式以选择一个开始菜单文件夹用于创建程序的快捷方式，按默认即可。点击“安装”：<br><img src="https://images2.imgbox.com/14/b8/QBmMrvDg_o.png" alt="在这里插入图片描述"></p> 
  <blockquote> 
   <p>如果按照默认，安装完成后可以在<a href="https://support.microsoft.com/zh-cn/windows/%E6%89%93%E5%BC%80-%E5%BC%80%E5%A7%8B-%E8%8F%9C%E5%8D%95-4ed57ad7-ed1f-3cc9-c9e4-f329822f5aeb" rel="nofollow">开始菜单</a>找到一个名为“<strong>Erlang OTP 25 (x64)</strong>”的文件夹，该文件夹存放了 Erlang 的快捷方式：<br><img src="https://images2.imgbox.com/8f/62/OCmzHoki_o.png" alt="在这里插入图片描述"></p> 
  </blockquote> </li><li> <p>安装完成，点击“关闭”：<br><img src="https://images2.imgbox.com/c0/28/v0j0trJa_o.png" alt="在这里插入图片描述"></p> </li><li> <p>完成后，就可以删除 Erlang 的安装程序了：<br><img src="https://images2.imgbox.com/80/fd/9UIo1RpX_o.png" alt="在这里插入图片描述"></p> </li></ol> 
<h3><a id="52_RabbitMQ_Server_166"></a>5.2、下载安装 RabbitMQ Server</h3> 
<ol><li> <p>安装完 Erlang 后，就可以下载安装 RabbitMQ Server 了，笔者安装的 Erlang 版本为 <strong>25.3.2</strong>，由<a href="https://www.rabbitmq.com/which-erlang.html" rel="nofollow">该页面</a>可知可以安装 RabbitMQ 的最新版本 —— <strong>3.12.0</strong>：<br><img src="https://images2.imgbox.com/34/e2/jgyglGdS_o.png" alt="在这里插入图片描述"></p> </li><li> <p>前往<a href="#AnchorPoint-DirectDownload" rel="nofollow">直接下载</a>，下载 <code>rabbitmq-server-3.12.0.exe</code>：<img src="https://images2.imgbox.com/1e/85/VoHbsXnf_o.png" alt="在这里插入图片描述"></p> </li><li> <p>下载完成后，<font color="#ff4500"><strong>以管理员身份运行</strong></font>：<br><img src="https://images2.imgbox.com/e8/b4/ndzYKlKp_o.png" alt="在这里插入图片描述"></p> </li><li> <p>运行后进入组件选择页面，一般按默认选择即可，点击下一步：<br><img src="https://images2.imgbox.com/d2/00/lDqNrAoX_o.png" alt="在这里插入图片描述"></p> </li><li> <p>选择安装位置页面，可以按默认也可以根据自身喜好修改；确认后点击“安装”：<br><img src="https://images2.imgbox.com/48/ce/uZ2anCPk_o.png" alt="在这里插入图片描述"></p> 
  <blockquote> 
   <p>💬 在<a href="https://www.rabbitmq.com/install-windows.html#installer" rel="nofollow">这个</a>官方页面提到过“强烈建议安装路径的任何目录名称中都不要包含空格”，但是安装程序默认的安装路径都是有空格的，所以我也不太懂他们了，，，还是按照默认的来吧。</p> 
  </blockquote> </li><li> <p>安装完成后，点击下一步：<br><img src="https://images2.imgbox.com/3d/6f/ZAFeELXD_o.png" alt="在这里插入图片描述"></p> <a id="AnchorPoint-CompletedPage"> </a></li><li> <p>完成页面，点击“结束”：<br><img src="https://images2.imgbox.com/e7/2d/LQahRzFK_o.png" alt="在这里插入图片描述"></p> 
  <blockquote> 
   <p>结束后可以在<a href="https://support.microsoft.com/zh-cn/windows/%E6%89%93%E5%BC%80-%E5%BC%80%E5%A7%8B-%E8%8F%9C%E5%8D%95-4ed57ad7-ed1f-3cc9-c9e4-f329822f5aeb" rel="nofollow">开始菜单</a>中找到一个名为“<strong>RabbitMQ Server</strong>”的文件夹，可以从这里管理 RabbitMQ 服务器以及使用 CLI 工具：<br><img src="https://images2.imgbox.com/5f/a4/3j5YupL6_o.png" alt="在这里插入图片描述"></p> 
  </blockquote> </li><li> <p>完成后，就可以删除 RabbitMQ Server 的安装程序了：<br><img src="https://images2.imgbox.com/ce/93/qvd9qo5K_o.png" alt="在这里插入图片描述"></p> </li><li> <p>由于在<a href="#AnchorPoint-CompletedPage" rel="nofollow">完成页面</a>默认勾选了“Start RabbitMQ service”，所以此时我们已经可以在<a href="https://jingyan.baidu.com/article/e2284b2bab6e35e2e7118d7d.html" rel="nofollow">计算机管理页</a>找到该 Windows 服务了：<br><img src="https://images2.imgbox.com/72/a7/Mv9qDaLc_o.png" alt="在这里插入图片描述"></p> </li></ol> 
<h3><a id="53_187"></a>5.3、启用服务管理</h3> 
<p>我们可以通过一些方法来管理 RabbitMQ 服务器，在官网的<a href="https://www.rabbitmq.com/install-windows.html#ports" rel="nofollow">端口访问</a>页面介绍了 RabbitMQ 节点绑定到的端口：<br><img src="https://images2.imgbox.com/88/bd/INabcsmG_o.png" alt="在这里插入图片描述"><br>其中我们主要关注 <strong>15672</strong> 号端口：<a href="https://www.rabbitmq.com/management.html" rel="nofollow">HTTP API</a> 客户端，<a href="https://www.rabbitmq.com/management.html" rel="nofollow">管理 UI</a> 和 <a href="https://www.rabbitmq.com/management-cli.html" rel="nofollow">rabbitmqadmin</a>（仅当启用了<a href="https://www.rabbitmq.com/management.html" rel="nofollow">管理插件</a>时）。</p> 
<p>💬 <font color="#C71585">我们可以通过 HTTP API 使用该管理插件用来管理和<a href="https://www.rabbitmq.com/monitoring.html" rel="nofollow">监控</a> RabbitMQ 节点和集群</font>，以及使用基于浏览器的 UI 和命令行工具，<a href="https://www.rabbitmq.com/management-cli.html" rel="nofollow">rabbitmqadmin</a>。</p> 
<ol><li> <p>在<a href="https://support.microsoft.com/zh-cn/windows/%E6%89%93%E5%BC%80-%E5%BC%80%E5%A7%8B-%E8%8F%9C%E5%8D%95-4ed57ad7-ed1f-3cc9-c9e4-f329822f5aeb" rel="nofollow">开始菜单</a>中打开 <strong>RabbitMQ 命令提示符 (sbin dir)</strong>：<br><img src="https://images2.imgbox.com/14/14/hgxEXQRn_o.png" alt="在这里插入图片描述"></p> </li><li> <p>使用如下命令以启用 RabbitMQ 管理插件：</p> <pre><code class="prism language-shell">rabbitmq-plugins <span class="token builtin class-name">enable</span> rabbitmq_management
</code></pre> <p><img src="https://images2.imgbox.com/1e/90/X3WebpUY_o.png" alt="在这里插入图片描述"></p> </li><li> <p>这里提示改动会在重启代理后生效，前往<a href="https://jingyan.baidu.com/article/e2284b2bab6e35e2e7118d7d.html" rel="nofollow">计算机管理页</a>找到 RabbitMQ Windows 服务，通过重启该服务以重启代理：<br><img src="https://images2.imgbox.com/44/d3/Udn0FRRO_o.png" alt="在这里插入图片描述"></p> </li><li> <p>打开浏览器，输入如下地址以访问：<code>http://127.0.0.1:15672/</code><br><img src="https://images2.imgbox.com/de/2c/csUJ87mz_o.png" alt="在这里插入图片描述"></p> 
  <blockquote> 
   <p><a href="https://www.rabbitmq.com/install-windows.html#default-user-access" rel="nofollow">默认用户访问权限</a>：代理会使用密码 <code>guest</code> 创建一个用户 <code>guest</code>。未配置的客户端通常会使用这些凭据。<strong>默认情况下，这些凭据只能是在作为本地主机连接到代理时使用</strong>，所以你需要在任何其他设备连接到代理之前采取一些行动。</p> 
   <p>有关如何创建更多用户以及删除 <code>guest</code> 用户的信息，请参阅有关<a href="https://www.rabbitmq.com/access-control.html" rel="nofollow">访问控制</a>的文档。</p> 
   <p>综上，这一步我们使用默认账号 <code>guest</code> 和密码 <code>guest</code> 登录即可。</p> 
  </blockquote> </li><li> <p>登录成功后如下图所示：<br><img src="https://images2.imgbox.com/11/ef/DwFum53h_o.png" alt="在这里插入图片描述"></p> </li></ol> 
<h2><a id="6_RabbitMQ__212"></a>6、在两个应用程序之间使用 RabbitMQ 消息队列中间件</h2> 
<blockquote> 
 <p>⚠️ 在开始本章的内容之前，您需要确保您已经完成了 RabbitMQ 服务器的安装并正常启动！您可以参考<a href="#AnchorPoint-InstallRabbitMQServer" rel="nofollow">第五章</a>了解相关内容。本章将以 <strong>C#</strong> 代码为例介绍如何使用消息队列：</p> 
 <p>💬 您可以前往 <a href="https://github.com/YMGogre/rabbitmq_tutorials_CN.git">Github</a> 或者 <a href="https://gitee.com/YMGogre/rabbitmq_tutorials.git" rel="nofollow">Gitee</a> 下载笔者在本章使用的 demo。</p> 
</blockquote> 
<ol><li> <p>打开 Visual Studio，创建两个控制台应用程序项目 <code>RabbitMQProducer</code> 和 <code>RabbitMQConsumer</code>：<br><img src="https://images2.imgbox.com/f6/88/rv75oRVq_o.png" alt="在这里插入图片描述"></p> 
  <blockquote> 
   <p><code>RabbitMQProducer</code>：生产者，用于向消息队列中<font color="#008000"><strong>发送消息</strong></font>；<br><br> <code>RabbitMQConsumer</code>：消费者，<font color="#008000"><strong>接收</strong></font>来自消息队列中的<font color="#008000"><strong>消息</strong></font>；</p> 
  </blockquote> </li><li> <p>完成后，右击项目名称，点击“管理 NuGet 程序包”：<br><img src="https://images2.imgbox.com/60/dc/m0Es9OSN_o.png" alt="在这里插入图片描述"></p> </li><li> <p>分别为 <code>RabbitMQProducer</code> 和 <code>RabbitMQConsumer</code> 两个项目引入 RabbitMQ.Client 库：<br><img src="https://images2.imgbox.com/f5/2e/sNfVNJDA_o.png" alt="在这里插入图片描述"></p> </li></ol> 
<hr> 
<p>以下是 <a href="https://github.com/YMGogre/RabbitMQDemo/blob/master/RabbitMQProducer/RabbitMQProducer.cs"><code>RabbitMQProducer.cs</code></a> 的代码：</p> 
<pre><code class="prism language-c">using RabbitMQ<span class="token punctuation">.</span>Client<span class="token punctuation">;</span>
using System<span class="token punctuation">.</span>Text<span class="token punctuation">;</span>

<span class="token comment">//连接 RabbitMQ 工厂实例</span>
var factory <span class="token operator">=</span> new <span class="token function">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> HostName <span class="token operator">=</span> <span class="token string">"localhost"</span><span class="token punctuation">,</span>         <span class="token comment">//主机名，默认为 "localhost"</span>
                                        Port <span class="token operator">=</span> <span class="token number">5672</span><span class="token punctuation">,</span>                    <span class="token comment">//要连接的端口，默认为 -1(5672)</span>
                                        UserName <span class="token operator">=</span> <span class="token string">"guest"</span><span class="token punctuation">,</span>             <span class="token comment">//用户名，默认为 "guest"</span>
                                        Password <span class="token operator">=</span> <span class="token string">"guest"</span><span class="token punctuation">}</span><span class="token punctuation">;</span>            <span class="token comment">//密码，默认为 "guest"</span>
<span class="token comment">//创建连接对象</span>
<span class="token function">using</span> <span class="token punctuation">(</span>var connection <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">CreateConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">//创建一个新的通道、会话和模型</span>
<span class="token function">using</span><span class="token punctuation">(</span>var channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">CreateModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">//声明一个消息队列</span>
    channel<span class="token punctuation">.</span><span class="token function">QueueDeclare</span><span class="token punctuation">(</span>queue<span class="token operator">:</span> <span class="token string">"hello"</span><span class="token punctuation">,</span>      		<span class="token comment">//消息队列名称</span>
                         durable<span class="token operator">:</span> false<span class="token punctuation">,</span>            <span class="token comment">//队列是否能在代理重启后仍然存在</span>
                         exclusive<span class="token operator">:</span> false<span class="token punctuation">,</span>          <span class="token comment">//是否应该将此队列限制在其声明的连接中?这样的队列将在其声明连接关闭时被删除。（在一个客户端同时发送和读取消息的应用场景中适用）</span>
                         autoDelete<span class="token operator">:</span> false<span class="token punctuation">,</span>         <span class="token comment">//当最后一个消费者(如果有的话)退订时，是否应该自动删除这个队列?</span>
                         arguments<span class="token operator">:</span> null<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">//可选的;额外的队列参数，例如:“x-queue-type”</span>
    <span class="token comment">//定义消息内容</span>
    var message <span class="token operator">=</span> <span class="token string">"Hello RabbitMQ!"</span><span class="token punctuation">;</span>
    <span class="token comment">//转换为字节数组（编码格式UTF-8）</span>
    var body <span class="token operator">=</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">.</span><span class="token function">GetBytes</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"按任意键开始发送消息！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">ReadKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//循环发送一百次消息</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">/*
         * 向 RabbitMQ 服务器发送一条消息
         * 调用 BasicPublish 方法后，指定的消息内容就会被发送到 RabbitMQ 服务器，并根据您指定的路由键被路由到相应的消息队列中
         */</span>
        channel<span class="token punctuation">.</span><span class="token function">BasicPublish</span><span class="token punctuation">(</span>exchange<span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>                  <span class="token comment">//指定要将消息发布到哪个交换机（exchange），设置为空字符串以使用默认交换机</span>
                             routingKey<span class="token operator">:</span> <span class="token string">"hello"</span><span class="token punctuation">,</span>     		<span class="token comment">//指定消息的路由键（routing key），路由键用于确定消息应该被发送到哪些消息队列</span>
                             basicProperties<span class="token operator">:</span> null<span class="token punctuation">,</span>         <span class="token comment">//指定消息属性，可以用来设置消息的优先级、过期时间等属性</span>
                             body<span class="token operator">:</span> body<span class="token punctuation">)</span><span class="token punctuation">;</span>                   <span class="token comment">//消息内容，将要发送的数据转换为字节数组，并传递给这个参数</span>
        <span class="token comment">//控制台打印发送的消息</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>$<span class="token string">"[{DateTime.Now.ToString("</span>HH<span class="token operator">:</span>mm<span class="token operator">:</span>ss fff<span class="token string">")}] Send: {message}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//当前线程暂停一秒钟</span>
        Thread<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<hr> 
<p>以下是 <a href="https://github.com/YMGogre/RabbitMQDemo/blob/master/RabbitMQConsumer/RabbitMQConsumer.cs"><code>RabbitMQConsumer.cs</code></a> 的代码：</p> 
<pre><code class="prism language-c">using RabbitMQ<span class="token punctuation">.</span>Client<span class="token punctuation">;</span>
using RabbitMQ<span class="token punctuation">.</span>Client<span class="token punctuation">.</span>Events<span class="token punctuation">;</span>
using System<span class="token punctuation">.</span>Text<span class="token punctuation">;</span>

<span class="token comment">//连接 RabbitMQ 工厂实例</span>
var factory <span class="token operator">=</span> new <span class="token function">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> HostName <span class="token operator">=</span> <span class="token string">"localhost"</span><span class="token punctuation">,</span>     <span class="token comment">//主机名，默认为 "localhost"</span>
                                        Port <span class="token operator">=</span> <span class="token number">5672</span><span class="token punctuation">,</span>                <span class="token comment">//要连接的端口，默认为 -1(5672)</span>
                                        UserName <span class="token operator">=</span> <span class="token string">"guest"</span><span class="token punctuation">,</span>         <span class="token comment">//用户名，默认为 "guest"</span>
                                        Password <span class="token operator">=</span> <span class="token string">"guest"</span><span class="token punctuation">}</span><span class="token punctuation">;</span>        <span class="token comment">//密码，默认为 "guest"</span>
<span class="token comment">//创建连接对象</span>
var connection <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">CreateConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//创建一个新的通道、会话和模型</span>
var channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">CreateModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//声明一个消息队列</span>
channel<span class="token punctuation">.</span><span class="token function">QueueDeclare</span><span class="token punctuation">(</span>queue<span class="token operator">:</span> <span class="token string">"hello"</span><span class="token punctuation">,</span>      		<span class="token comment">//消息队列名称</span>
                     durable<span class="token operator">:</span> false<span class="token punctuation">,</span>            <span class="token comment">//队列是否能在代理重启后仍然存在</span>
                     exclusive<span class="token operator">:</span> false<span class="token punctuation">,</span>          <span class="token comment">//是否应该将此队列限制在其声明的连接中?这样的队列将在其声明连接关闭时被删除。（在一个客户端同时发送和读取消息的应用场景中适用）</span>
                     autoDelete<span class="token operator">:</span> false<span class="token punctuation">,</span>         <span class="token comment">//当最后一个消费者(如果有的话)退订时，是否应该自动删除这个队列?</span>
                     arguments<span class="token operator">:</span> null<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">//可选的;额外的队列参数，例如:“x-queue-type”</span>

<span class="token comment">//创建（将 IBasicConsumer 接口实现为事件的）EventingBasicConsumer 类对象并关联指定的 channel</span>
var consumer <span class="token operator">=</span> new <span class="token function">EventingBasicConsumer</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* 
 * 启动一个基本的内容类消费者（在当前通道中监听 hello 消息队列，并进行消费）
 * 调用 BasicConsume 方法后，您的应用程序就可以开始从指定的消息队列中接收消息了。
 * 当从消息队列中接收到一条消息时，消费者对象的 Received 事件会被触发，并执行相应的事件处理程序。
 */</span>
channel<span class="token punctuation">.</span><span class="token function">BasicConsume</span><span class="token punctuation">(</span>queue<span class="token operator">:</span> <span class="token string">"hello"</span><span class="token punctuation">,</span>      		<span class="token comment">//消息队列名称</span>
                     autoAck<span class="token operator">:</span> true<span class="token punctuation">,</span>             <span class="token comment">//是否自动发送确认消息（acknowledgement）给 RabbitMQ 服务器</span>
                     consumer<span class="token operator">:</span> consumer<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">//指定用于接收消息的消费者对象</span>

<span class="token comment">//使用 Lambda 表达式注册事件处理程序并订阅 Received 事件</span>
consumer<span class="token punctuation">.</span>Received <span class="token operator">+=</span> <span class="token punctuation">(</span>sender<span class="token punctuation">,</span> e<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span>
<span class="token punctuation">{<!-- --></span>
    var body <span class="token operator">=</span> e<span class="token punctuation">.</span>Body<span class="token punctuation">.</span><span class="token function">ToArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                                                        <span class="token comment">//获取消息字节数组</span>
    var message <span class="token operator">=</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>                                                        <span class="token comment">//UTF-8格式编码消息内容字符串</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>$<span class="token string">"[{DateTime.Now.ToString("</span>HH<span class="token operator">:</span>mm<span class="token operator">:</span>ss fff<span class="token string">")}] Consumer Received: {message},"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">//控制台打印消息内容（您也可以在这里添加其他的消息处理代码）</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//控制台等待读取输入以避免进程退出</span>
Console<span class="token punctuation">.</span><span class="token function">ReadLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//关闭连接以及它的所有通道</span>
connection<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<hr> 
<p>运行效果：<br><img src="https://images2.imgbox.com/f3/77/7nISjs1x_o.gif" alt="在这里插入图片描述"></p> 
<h2><a id="7_326"></a>7、生产[非]适用性免责声明</h2> 
<p>请记住，本教程和其他教程都是教程。他们一次展示一个新概念，可能会有意地过度简化一些东西，而忽略其他东西。例如，为了简洁起见，连接管理、错误处理、连接恢复、并发性和指标收集等主题在很大程度上被省略了。这种简化的代码不应该被认为可以用于生产。</p> 
<p>在发布您的应用之前，请先查看其他<a href="https://www.rabbitmq.com/documentation.html" rel="nofollow">文档</a>。我们特别推荐以下指南：<a href="https://www.rabbitmq.com/confirms.html" rel="nofollow">发布者确认和消费者确认</a>，<a href="https://www.rabbitmq.com/production-checklist.html" rel="nofollow">生产清单</a>和<a href="https://www.rabbitmq.com/monitoring.html" rel="nofollow">监控</a>。</p> 
<h2><a id="8QA_332"></a>8、Q&amp;A</h2> 
<h3><a id="QVisual_Studio__334"></a>Q：Visual Studio 如何同时运行两个项目</h3> 
<p><strong>A1：</strong></p> 
<ol><li>在解决方案资源管理器中，右击解决方案节点，然后选择“属性”；<br><img src="https://images2.imgbox.com/56/80/h4uLTlGP_o.png" alt="在这里插入图片描述"></li><li>展开“通用属性”节点，然后选择“启动项目”，选择“多个启动项目”选项并设置适当的操作。然后点击“应用”；<br><img src="https://images2.imgbox.com/8e/9e/oy8C58IX_o.png" alt="在这里插入图片描述"></li></ol> 
<p><strong>A2：</strong> 或者更简单的，打开两个 Visual Studio 就好啦~</p> 
<h3><a id="Q_342"></a>Q：我可以在第一台计算机上运行消息队列服务器，第二台计算机上运行发送消息的程序，第三台计算机上运行接收消息的程序吗？</h3> 
<p><strong>A：</strong> 可以，只要这些平台之间能够相互通信（处于同一局域网内），它们就可以使用消息队列进行通信。同时这也意味着，在发送和接收消息的程序代码中，您需要指定 RabbitMQ 服务器所在的计算机的 IP 地址或主机名，以便连接到 RabbitMQ 服务器。<br>例如，如果您的消息队列服务器运行在 IP 地址为 <strong>192.168.1.100</strong> 的计算机上，您需要使用如下代码来创建 <code>ConnectionFactory</code> 对象：</p> 
<pre><code class="prism language-java"><span class="token keyword">var</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token class-name">HostName</span> <span class="token operator">=</span> <span class="token string">"192.168.1.100"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<blockquote> 
 <p>💬 有关远程部署 RabbitMQ 服务的相关内容您可以点击<a href="https://www.cnblogs.com/abeam/p/11872956.html" rel="nofollow">这里</a>了解更多。</p> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f6a834e62f199802ce629c845bba19b7/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">C#如何使用SQLite数据库？</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2889151352c345d9b12f21355118c8ae/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">性能测试：压测中TPS上不去的几种原因分析&amp;案例分析</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>