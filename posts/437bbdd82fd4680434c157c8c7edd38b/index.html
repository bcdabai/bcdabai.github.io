<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Docker系列之docker镜像 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Docker系列之docker镜像" />
<meta property="og:description" content="目录
一、Docker镜像的分层
二、Docker镜像的创建
1. Docker镜像
2.Docker镜像的创建方法（挺重要）
①基于已有镜像的创建
​②基于本地模板创建 3.基于Dockerfile创建 三、Dockerfile实战
1.构建apache容器服务
2.构建sshd容器服务 ​3.构建systemctl镜像 ​4.搭建nginx容器服务 ​四、搭建Tomcat容器服务 五、构建MySQL镜像 一、Docker镜像的分层 Docker镜像分为四层
Dockerfile 中的每个指令都会创建一个新的镜像层
镜像层将被缓存和复用
当Dockerfile的指令修改了，复制的文件变化了，或者构建镜像指定的变量不同了，对应的镜像层缓存就会失效
某一层的镜像缓存失效之后，它之后的镜像层缓存都会失效
镜像层是不可变的，如果在某一层中添加一个文件，然后再下一层中删除它，则镜像中依然会包含该文件
二、Docker镜像的创建 1. Docker镜像 应用发布的标准格式
支撑一个Docker容器的运行
2.Docker镜像的创建方法（挺重要） 基于已有镜像创建
基于本地模板创建
基于Dockerfile创建 （实际环境中用的最多）
①基于已有镜像的创建 将容器里面运行的程序及运行环境打包生成新的镜像
docker commit [选项] 容器ID/名称 仓库名称：[标签]
-m 说明信息
-a 作者信息
-p 生成过程当中停止容器的运行
## 创建容器
docker create -it centos:7 /bin/bash
docker commit -m &#34;new&#34; -a dakao ee9dbcd1dc2b daoke:test
## commit 是提交
docker images | grep dakao ②基于本地模板创建 a." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/437bbdd82fd4680434c157c8c7edd38b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-04-23T21:51:15+08:00" />
<meta property="article:modified_time" content="2023-04-23T21:51:15+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Docker系列之docker镜像</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p><a href="#%E4%B8%80%E3%80%81Docker%E9%95%9C%E5%83%8F%E7%9A%84%E5%88%86%E5%B1%82" rel="nofollow">一、Docker镜像的分层</a></p> 
<p id="%E4%BA%8C%E3%80%81Docker%E9%95%9C%E5%83%8F%E7%9A%84%E5%88%9B%E5%BB%BA-toc" style="margin-left:0px;"><a href="#%E4%BA%8C%E3%80%81Docker%E9%95%9C%E5%83%8F%E7%9A%84%E5%88%9B%E5%BB%BA" rel="nofollow">二、Docker镜像的创建</a></p> 
<p id="1.%20Docker%E9%95%9C%E5%83%8F-toc" style="margin-left:40px;"><a href="#1.%20Docker%E9%95%9C%E5%83%8F" rel="nofollow">1. Docker镜像</a></p> 
<p id="2.Docker%E9%95%9C%E5%83%8F%E7%9A%84%E5%88%9B%E5%BB%BA%E6%96%B9%E6%B3%95%EF%BC%88%E6%8C%BA%E9%87%8D%E8%A6%81%EF%BC%89-toc" style="margin-left:40px;"><a href="#2.Docker%E9%95%9C%E5%83%8F%E7%9A%84%E5%88%9B%E5%BB%BA%E6%96%B9%E6%B3%95%EF%BC%88%E6%8C%BA%E9%87%8D%E8%A6%81%EF%BC%89" rel="nofollow">2.Docker镜像的创建方法（挺重要）</a></p> 
<p id="%E2%91%A0%E5%9F%BA%E4%BA%8E%E5%B7%B2%E6%9C%89%E9%95%9C%E5%83%8F%E7%9A%84%E5%88%9B%E5%BB%BA-toc" style="margin-left:80px;"><a href="#%E2%91%A0%E5%9F%BA%E4%BA%8E%E5%B7%B2%E6%9C%89%E9%95%9C%E5%83%8F%E7%9A%84%E5%88%9B%E5%BB%BA" rel="nofollow">①基于已有镜像的创建</a></p> 
<p id="%E2%80%8B%E7%BC%96%E8%BE%91%C2%A0%E2%91%A1%E5%9F%BA%E4%BA%8E%E6%9C%AC%E5%9C%B0%E6%A8%A1%E6%9D%BF%E5%88%9B%E5%BB%BA%C2%A0-toc" style="margin-left:80px;"><a href="#%E2%80%8B%E7%BC%96%E8%BE%91%C2%A0%E2%91%A1%E5%9F%BA%E4%BA%8E%E6%9C%AC%E5%9C%B0%E6%A8%A1%E6%9D%BF%E5%88%9B%E5%BB%BA%C2%A0" rel="nofollow">​②基于本地模板创建 </a></p> 
<p id="3.%E5%9F%BA%E4%BA%8EDockerfile%E5%88%9B%E5%BB%BA%C2%A0-toc" style="margin-left:40px;"><a href="#3.%E5%9F%BA%E4%BA%8EDockerfile%E5%88%9B%E5%BB%BA%C2%A0" rel="nofollow">3.基于Dockerfile创建 </a></p> 
<p id="%E4%B8%89%E3%80%81Dockerfile%E5%AE%9E%E6%88%98-toc" style="margin-left:0px;"><a href="#%E4%B8%89%E3%80%81Dockerfile%E5%AE%9E%E6%88%98" rel="nofollow">三、Dockerfile实战</a></p> 
<p id="1.%E6%9E%84%E5%BB%BAapache%E5%AE%B9%E5%99%A8%E6%9C%8D%E5%8A%A1-toc" style="margin-left:40px;"><a href="#1.%E6%9E%84%E5%BB%BAapache%E5%AE%B9%E5%99%A8%E6%9C%8D%E5%8A%A1" rel="nofollow">1.构建apache容器服务</a></p> 
<p id="2.%E6%9E%84%E5%BB%BAsshd%E5%AE%B9%E5%99%A8%E6%9C%8D%E5%8A%A1%C2%A0-toc" style="margin-left:40px;"><a href="#2.%E6%9E%84%E5%BB%BAsshd%E5%AE%B9%E5%99%A8%E6%9C%8D%E5%8A%A1%C2%A0" rel="nofollow">2.构建sshd容器服务 </a></p> 
<p id="%E2%80%8B%E7%BC%96%E8%BE%91%C2%A03.%E6%9E%84%E5%BB%BAsystemctl%E9%95%9C%E5%83%8F%C2%A0%C2%A0-toc" style="margin-left:40px;"><a href="#%E2%80%8B%E7%BC%96%E8%BE%91%C2%A03.%E6%9E%84%E5%BB%BAsystemctl%E9%95%9C%E5%83%8F%C2%A0%C2%A0" rel="nofollow">​3.构建systemctl镜像  </a></p> 
<p id="%E2%80%8B%E7%BC%96%E8%BE%91%C2%A04.%E6%90%AD%E5%BB%BAnginx%E5%AE%B9%E5%99%A8%E6%9C%8D%E5%8A%A1%C2%A0-toc" style="margin-left:40px;"><a href="#%E2%80%8B%E7%BC%96%E8%BE%91%C2%A04.%E6%90%AD%E5%BB%BAnginx%E5%AE%B9%E5%99%A8%E6%9C%8D%E5%8A%A1%C2%A0" rel="nofollow">​4.搭建nginx容器服务 </a></p> 
<p id="%E2%80%8B%E7%BC%96%E8%BE%91%C2%A0%E5%9B%9B%E3%80%81%E6%90%AD%E5%BB%BATomcat%E5%AE%B9%E5%99%A8%E6%9C%8D%E5%8A%A1%C2%A0-toc" style="margin-left:0px;"><a href="#%E2%80%8B%E7%BC%96%E8%BE%91%C2%A0%E5%9B%9B%E3%80%81%E6%90%AD%E5%BB%BATomcat%E5%AE%B9%E5%99%A8%E6%9C%8D%E5%8A%A1%C2%A0" rel="nofollow">​四、搭建Tomcat容器服务 </a></p> 
<p id="%E4%BA%94%E3%80%81%E6%9E%84%E5%BB%BAMySQL%E9%95%9C%E5%83%8F%C2%A0-toc" style="margin-left:0px;"><a href="#%E4%BA%94%E3%80%81%E6%9E%84%E5%BB%BAMySQL%E9%95%9C%E5%83%8F%C2%A0" rel="nofollow">五、构建MySQL镜像 </a></p> 
<hr id="hr-toc"> 
<p></p> 
<h3 id="%E4%B8%80%E3%80%81Docker%E9%95%9C%E5%83%8F%E7%9A%84%E5%88%86%E5%B1%82">一、<a href="https://so.csdn.net/so/search?q=Docker&amp;spm=1001.2101.3001.7020" title="Docker">Docker</a>镜像的分层</h3> 
<p>Docker镜像分为四层</p> 
<p><img alt="" height="486" src="https://images2.imgbox.com/f1/b2/rSYN8gwM_o.png" width="836"> Dockerfile 中的每个指令都会创建一个新的镜像层<br> 镜像层将被缓存和复用<br> 当Dockerfile的指令修改了，复制的文件变化了，或者构建镜像指定的变量不同了，对应的镜像层缓存就会失效<br> 某一层的镜像缓存失效之后，它之后的镜像层缓存都会失效<br> 镜像层是不可变的，如果在某一层中添加一个文件，然后再下一层中删除它，则镜像中依然会包含该文件</p> 
<h2 id="%E4%BA%8C%E3%80%81Docker%E9%95%9C%E5%83%8F%E7%9A%84%E5%88%9B%E5%BB%BA"><br> 二、Docker镜像的创建</h2> 
<h3 id="1.%20Docker%E9%95%9C%E5%83%8F">1. Docker镜像</h3> 
<p>应用发布的标准格式<br> 支撑一个Docker容器的运行</p> 
<h3 id="2.Docker%E9%95%9C%E5%83%8F%E7%9A%84%E5%88%9B%E5%BB%BA%E6%96%B9%E6%B3%95%EF%BC%88%E6%8C%BA%E9%87%8D%E8%A6%81%EF%BC%89">2.Docker镜像的创建方法（挺重要）</h3> 
<p>基于已有镜像创建<br> 基于本地模板创建<br> 基于Dockerfile创建 （实际环境中用的最多）</p> 
<h4 id="%E2%91%A0%E5%9F%BA%E4%BA%8E%E5%B7%B2%E6%9C%89%E9%95%9C%E5%83%8F%E7%9A%84%E5%88%9B%E5%BB%BA">①基于已有镜像的创建</h4> 
<p>将容器里面运行的程序及运行环境打包生成新的镜像</p> 
<blockquote> 
 <p>docker commit [选项] 容器ID/名称  仓库名称：[标签]</p> 
 <p>-m  说明信息<br> -a  作者信息<br> -p  生成过程当中停止容器的运行</p> 
</blockquote> 
<blockquote> 
 <p>## 创建容器<br> docker create -it centos:7 /bin/bash<br> docker commit -m "new" -a dakao ee9dbcd1dc2b daoke:test<br> ## commit 是提交<br> docker images | grep dakao </p> 
</blockquote> 
<h4 id="%E2%80%8B%E7%BC%96%E8%BE%91%C2%A0%E2%91%A1%E5%9F%BA%E4%BA%8E%E6%9C%AC%E5%9C%B0%E6%A8%A1%E6%9D%BF%E5%88%9B%E5%BB%BA%C2%A0"><img alt="" height="518" src="https://images2.imgbox.com/cf/7e/9G9SOgHP_o.png" width="1032"> ②基于本地模板创建 </h4> 
<p>a.通过导入操作系统模板文件生成新的镜像</p> 
<p>b.使用wget命令导入为本地镜像</p> 
<blockquote> 
 <p>wget http://download.openvz.org/template/precreated/debian-7.0-x86- minimal.tar.gz</p> 
</blockquote> 
<p>c.导入成功后可查看本地镜像信息</p> 
<blockquote> 
 <p>docker images | grep new </p> 
</blockquote> 
<h3 id="3.%E5%9F%BA%E4%BA%8EDockerfile%E5%88%9B%E5%BB%BA%C2%A0"><span style="color:#4f4f4f;"><span style="background-color:#ffffff;"><span style="color:#FF0000;">3.基于Dockerfile创建</span></span></span> </h3> 
<p style="margin-left:0;"><span style="color:#4d4d4d;"><span style="background-color:#ffffff;">a.Dockerfile是由一组指令组成的文件<br><span style="color:#FF0000;">b.Dockerfile结构四部分</span></span></span></p> 
<ul style="margin-left:0;"><li>基础镜像信息</li><li>维护者信息</li><li>镜像操作指令</li><li>容器启动时执行指令</li></ul> 
<p style="margin-left:0;"><span style="color:#4d4d4d;"><span style="background-color:#ffffff;">c.Dockfile每行支持一条指令，每条指令可携带多个参数，支持使用以<code>“#”</code>号开头的注释</span></span></p> 
<p><span style="color:#4f4f4f;"><span style="background-color:#ffffff;"><span style="color:#FF0000;">★Dockerfire操作指令</span></span></span></p> 
<p><img alt="" height="672" src="https://images2.imgbox.com/46/73/juf9yvmQ_o.png" width="785"></p> 
<h2 id="%E4%B8%89%E3%80%81Dockerfile%E5%AE%9E%E6%88%98">三、Dockerfile实战</h2> 
<h3 id="1.%E6%9E%84%E5%BB%BAapache%E5%AE%B9%E5%99%A8%E6%9C%8D%E5%8A%A1"><a name="t5"></a><a id="1apache_86"></a>1.构建apache容器服务</h3> 
<blockquote> 
 <p>mkdir apache<br> cd apache<br> vim Dockerfile</p> 
 <p>#基于的基础镜像<br> FROM centos:7<br> #维护镜像的用户信息<br> MAINTAINER The porject &lt;cloud-ops@centos.org&gt;<br> #镜像操作指令安装apache软件<br> RUN yum -y update    #更新yum<br> RUN yum -y install httpd<br> #开启80端口<br> EXPOSE 80<br> #复制网站首页文件<br> ADD index.html /var/www/html/index.html<br> #将执行脚本复制到镜像中<br> ADD run.sh /run.sh<br> RUN chmod 755 /run.sh<br> #启动容器时执行脚本<br> CMD ["/run.sh"]</p> 
 <p>vim run.sh<br> #!/bin/bash<br> rm -rf /run/httpd/*<br> exec /usr/sbin/apachectl -D FOREGROUND</p> 
 <p>echo "web test" &gt; index.html</p> 
 <p>//生成镜像<br> docker build -t httpd:centos . (注意别忘 了末尾有"."，且.前面有空格)</p> 
 <p>//新镜像运行容器<br> docker run -d -p 1216:80 httpd:centos</p> 
 <p>//测试<br> curl http://192.168.40.30:1216</p> 
</blockquote> 
<p><img alt="" height="475" src="https://images2.imgbox.com/be/39/K6hVfWXw_o.png" width="659"> </p> 
<h3 id="2.%E6%9E%84%E5%BB%BAsshd%E5%AE%B9%E5%99%A8%E6%9C%8D%E5%8A%A1%C2%A0">2.构建sshd容器服务 </h3> 
<p>我们下载一个centos：7的镜像，进去发现无法使用sshd服务，我们需要手工添加</p> 
<p>sshd为secure shell 的简称，可以通过网络在主机中开机shell的服务</p> 
<p>操作步骤</p> 
<ul><li>下载基础镜像</li><li>建立工作目录</li><li>创建并编写Dockfile文件</li><li>生成镜像</li><li>启动容器</li></ul> 
<blockquote> 
 <p>mkdir sshd<br> cd sshd</p> 
 <p>vim Dockerfile</p> 
 <p>FROM centos:7<br> MAINTAINER The CentOS Project &lt;cloud-centos&gt;<br> RUN yum -y update<br> RUN yum -y install openssh* net-tools lsof telnet passwd<br> RUN echo '123456' | passwd --stdin root<br> RUN sed -i 's/UsePAM yes/UsePAM no/g' /etc/ssh/sshd_config<br> RUN ssh-keygen -t rsa -f /etc/ssh/ssh_host_rsa_key<br> RUN sed -i '/^session\s\+required\s\+pam_loginuid.so/s/^/#/' /etc/pam.d/sshd<br> RUN mkdir -p /root/.ssh &amp;&amp; chown root.root /root &amp;&amp; chmod 700 /root/.ssh<br> EXPOSE 22<br> CMD ["/usr/sbin/sshd","-D"]                                 </p> 
 <p>//生成镜像<br> docker build -t sshd:new .</p> 
 <p>//启动容器并修改root密码<br> docker run -d -P sshd:new    #随机映射端口号<br> ssh localhost -p ***** #此处的*****端口号需要自己用docker ps 查看一下随机映射的是多少端口号 </p> 
</blockquote> 
<h3 id="%E2%80%8B%E7%BC%96%E8%BE%91%C2%A03.%E6%9E%84%E5%BB%BAsystemctl%E9%95%9C%E5%83%8F%C2%A0%C2%A0"><img alt="" height="750" src="https://images2.imgbox.com/c2/89/oFihRxHN_o.png" width="840"> 3.构建systemctl镜像  </h3> 
<blockquote> 
 <p>mkdir systemctl<br> cd systemctl</p> 
 <p>vim Dockerfile</p> 
 <p>#基础环境，上一题的sshd容器环境<br> FROM sshd:new</p> 
 <p>#设置变量 container 值为docker<br> ENV container docker</p> 
 <p>#基础镜像上执行切换到/lib/systemd/system/sysinit.target.wants目录下，for循环遍历该目录下所有文件，如果文件名称不是systemd-tmpfiles-setup.service，则删除该，换行符<br> RUN (cd /lib/systemd/system/sysinit.target.wants/;for i in *;do [$i ==\<br> systemd-tmpfiles-setup.service] || rm -f $i;done);\<br> rm -f /lib/systemd/system/multi-user.target.wants/*;\<br> rm -f /etc/systemd/system/*.wants/*;\<br> rm -f /lib/systemd/system/local-fs.target.wants/*;\<br> rm -f /lib/systemd/system/sockets.target.wants/*udev*;\<br> rm -f /lib/systemd/system/sockets.target.wants/*initctl*;\<br> rm -f /lib/systemd/system/basic.target.wants/*;\<br> rm -f /lib/systemd/system/anaconda.target.wants/*;<br> VOLUME ["/sys/fs/cgroup"]<br> CMD ["/usr/sbin/init"]</p> 
 <p><br> docker build -t systemd:new .</p> 
 <p>//privateged container内的root拥有真正的root权限。否则，container内的root只是外部的一个普通用户权限。<br> docker run --privileged -ti -v /sys/fs/cgroup:/sys/fs/cgroup:ro systemd:new /sbin/init &amp;</p> 
 <p>docker exec -it 333eeb762baf bash</p> 
 <p>//进入容器<br> systemctl status sshd</p> 
</blockquote> 
<h3 id="%E2%80%8B%E7%BC%96%E8%BE%91%C2%A04.%E6%90%AD%E5%BB%BAnginx%E5%AE%B9%E5%99%A8%E6%9C%8D%E5%8A%A1%C2%A0"><img alt="" height="754" src="https://images2.imgbox.com/59/95/xd86sPEM_o.png" width="782"> 4.搭建nginx容器服务 </h3> 
<blockquote> 
 <p>mkdir nginx<br> cd nginx/<br> //拷贝nginx-1.12.0源码包到nginx/目录中</p> 
 <p>vim Dockerfile</p> 
 <p>#基于基础镜像<br> FROM centos:7<br> #用户信息<br> MAINTAINER this is nginx image &lt;panrj&gt;<br> #添加环境包<br> RUN yum -y update<br> RUN yum -y install pcre-devel zlib-devel gcc gcc-c++ make<br> RUN useradd -M -s /sbin/nologin nginx<br> #下载nginx软件包<br> ADD nginx-1.12.0.tar.gz /usr/local/src<br> WORKDIR /usr/local/src<br> #指定工作目录<br> WORKDIR nginx-1.12.0<br> RUN ./configure \<br> --prefix=/usr/local/nginx \<br> --user=nginx \<br> --group=nginx \<br> --with-http_stub_status_module &amp;&amp; make &amp;&amp; make install<br> ENV PATH /usr/local/nginx/sbin:$PATH<br> #指定http和https端口<br> EXPOSE 80<br> EXPOSE 443<br> RUN echo "daemon off;"&gt;&gt;/usr/local/nginx/conf/nginx.conf<br> #添加宿主机中run.sh到容器中<br> ADD run.sh /run.sh<br> RUN chmod 755 /run.sh<br> CMD ["/run.sh"]</p> 
 <p>vim run.sh<br> #!/bin/bash<br> /usr/local/nginx/sbin/nginx</p> 
 <p>//创建新镜像<br> docker build -t nginx:new .</p> 
 <p>docker run -d -P nginx:new</p> 
 <p>docker ps -a</p> 
 <p>curl http://192.168.40.30:49156/</p> 
</blockquote> 
<h2 id="%E2%80%8B%E7%BC%96%E8%BE%91%C2%A0%E5%9B%9B%E3%80%81%E6%90%AD%E5%BB%BATomcat%E5%AE%B9%E5%99%A8%E6%9C%8D%E5%8A%A1%C2%A0"><img alt="" height="356" src="https://images2.imgbox.com/65/2f/XXc5XKge_o.png" width="855"> 四、搭建Tomcat容器服务 </h2> 
<blockquote> 
 <p>mkdir /opt/tomcat<br> 拷贝jdk-8u91-linux-x64.tar.gz<br> apache-tomcat-8.5.16.tar.gz到/opt/tomcat下</p> 
</blockquote> 
<p><img alt="" height="322" src="https://images2.imgbox.com/e4/1c/hpagw1ve_o.png" width="811"></p> 
<blockquote> 
 <p>vim Dockerfile</p> 
 <p>FROM centos:7<br> MAINTAINER this is tomcat image &lt;chen&gt;<br> ADD jdk-8u91-linux-x64.tar.gz /usr/local<br> WORKDIR /usr/local/<br> RUN mv jdk1.8.0_ 91 /usr/local/java<br> ENV JAVA HOME /usr/local/java<br> ENV JAVA_ BIN /usr/local/java/bin<br> ENV JRE HOME /usr/local/java/jre<br> ENV PATH $PATH:/usr/local/java/bin:/usr/local/java/jre/bin<br> ENV CLASSPATH /usr/local/java/jre/bin:/usr/local/java/lib:/usr/local/java/jre/ib/charsets.jar<br> ADD apache-tomcat-8.5.16.tar.gz /usr/local<br> WORKDIR /usr/local/<br> RUN mv apache tomcat-8.5.16 /usr/local/tomcat8<br> EXPOSE 8080<br> #CMD ["/usr/local/tomcat8/bin/catalina.sh","run"]<br> ENTRYPOINT ["/usr/local/tomcat8/bin/catalina.sh","run"]</p> 
</blockquote> 
<blockquote> 
 <p>docker build -t tomcat:centos7 .<br> docker run -d --name tomcat1 -p 1212:8080 tomcat:centos7</p> 
 <p>http://192.168.40.10:1212</p> 
</blockquote> 
<p><img alt="" height="280" src="https://images2.imgbox.com/33/41/Pti9qGQ5_o.png" width="842"></p> 
<h2 id="%E4%BA%94%E3%80%81%E6%9E%84%E5%BB%BAMySQL%E9%95%9C%E5%83%8F%C2%A0">五、构建MySQL镜像 </h2> 
<blockquote> 
 <p>mkdir mysql<br> cd mysql/<br> 将mysql-boost-5.7.20.tar.gz放入</p> 
</blockquote> 
<blockquote> 
 <p>#编写my.cnf文件用于替换容器内部的<br> vim my.cnf<br> [client]<br> port = 3306<br> socket=/usr/local/mysql/mysql.sock</p> 
 <p>[mysqld]<br> user = mysql<br> basedir=/usr/local/mysql<br> datadir=/usr/local/mysql/data<br> port = 3306<br> character-set-server=utf8<br> pid-file = /usr/local/mysql/mysqld.pid<br> socket=/usr/local/mysql/mysql.sock<br> bind-address = 0.0.0.0<br> skip-name-resolve<br> max_connections=2048<br> default-storage-engine=INNODB<br> max_allowed_packet=16M<br> server-id = 1</p> 
 <p>sql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_AUTO_VALUE_ON_ZERO,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,PIPES_AS_CONCAT,ANSI_QUOTES</p> 
</blockquote> 
<p><img alt="" height="499" src="https://images2.imgbox.com/46/df/tsTfkK8J_o.png" width="1012"></p> 
<blockquote> 
 <p>vim Dockerfile</p> 
 <p>#基础镜像<br> FROM centos:7<br> #作者信息<br> MAINTAINER li<br> #安装环境依赖包<br> RUN yum -y install gcc gcc-c++ ncurses ncurses-devel bison cmake make</p> 
 <p>#创建运行用户<br> RUN useradd -M -s /sbin/nologin  mysql</p> 
 <p>#编译安装<br> ADD mysql-boost-5.7.20.tar.gz /opt<br> WORKDIR /opt/mysql-5.7.20/<br> RUN cmake \<br> -DCMAKE_INSTALL_PREFIX=/usr/local/mysql \<br> -DMYSQL_UNIX_ADDR=/usr/local/mysql/mysql.sock \<br> -DSYSCONFDIR=/etc \<br> -DSYSTEMD_PID_DIR=/usr/local/mysql \<br> -DDEFAULT_CHARSET=utf8  \<br> -DDEFAULT_COLLATION=utf8_general_ci \<br> -DWITH_EXTRA_CHARSETS=all \<br> -DWITH_INNOBASE_STORAGE_ENGINE=1 \<br> -DWITH_ARCHIVE_STORAGE_ENGINE=1 \<br> -DWITH_BLACKHOLE_STORAGE_ENGINE=1 \<br> -DWITH_PERFSCHEMA_STORAGE_ENGINE=1 \<br> -DMYSQL_DATADIR=/usr/local/mysql/data \<br> -DWITH_BOOST=boost \<br> -DWITH_SYSTEMD=1 &amp;&amp; make -j4 &amp;&amp; make install</p> 
 <p>#修改mysql 配置文件<br> RUN rm -f /etc/my.cnf<br> COPY my.cnf /etc</p> 
 <p><br> #更改mysql安装目录和配置文件的属主属组<br> RUN chown -R mysql:mysql /usr/local/mysql/<br> RUN chown mysql:mysql /etc/my.cnf</p> 
 <p>#设置路径环境变量<br> ENV PATH=$PATH:/usr/local/mysql/bin:/usr/local/mysql/lib</p> 
 <p>#初始化数据库<br> WORKDIR /usr/local/mysql/<br> RUN bin/mysqld \<br> --initialize-insecure \<br> --user=mysql \<br> --basedir=/usr/local/mysql \<br> --datadir=/usr/local/mysql/data</p> 
 <p>#添加mysqld系统服务<br> RUN cp /usr/local/mysql/usr/lib/systemd/system/mysqld.service /usr/lib/systemd/system/</p> 
 <p>#开放端口<br> EXPOSE 3306</p> 
 <p>#制作启动脚本，开始mysql服务<br> RUN echo -e "#!/bin/sh \nsystemctl enable mysqld" &gt;/run.sh<br> RUN chmod 755 /run.sh<br> RUN sh /run.sh<br> CMD ["init"]</p> 
</blockquote> 
<blockquote> 
 <p>docker build -t mysql:centos7 .<br> docker images<br> docker run --name=mysql_server -d -P --privileged mysql:centos7<br> docker ps -a </p> 
</blockquote> 
<p> </p> 
<p> </p> 
<p> </p> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f8f65b7faedd7654a2da827dfea29dab/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">关于稠密的一些思考</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d5be5012ab4d40591cf455874046d410/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Linux初体验</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>