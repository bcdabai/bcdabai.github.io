<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>python opencv 图片缺陷检测（讲解直方图以及相关系数对比法） - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="python opencv 图片缺陷检测（讲解直方图以及相关系数对比法）" />
<meta property="og:description" content="一、利用直方图的方式进行批量的图片缺陷检测（方法简单） 二、步骤（完整代码见最后） 2.1灰度转换（将原图和要检测对比的图分开灰度化） 灰度化的作用是因为后面的直方图比较需要以像素256为基准进行相关性比较
img = cv2.imread(&#34;0.bmp&#34;) #原图灰度转换 gray = cv2.cvtColor(img, cv2.COLOR_RGB2GRAY) #循环要检测的图，均灰度化 for i in range(1, 6): t1=cv2.cvtColor(cv2.imread(str(i)&#43;&#34;.bmp&#34;),cv2.COLOR_RGB2GRAY) 2.2 直方图计算（结果其实是二维的图表–用画图的方式展示） calcHist参数讲解 第一个参数：必须为列表[],哪怕只有一个图片，image输入图像channels:：传入图像的通道，如果是灰度图像，那就不用说了，只有一个通道，值为0，如果是彩色图像（有3个通道），那么值为0,1,2,中选择一个，对应着BGR各个通道。这个值也得用[]传入。mask：掩膜图像。如果统计整幅图，那么为none。主要是如果要统计部分图的直方图，就得构造相应的炎掩膜来计算。histSize：灰度级的个数，需要中括号，比如[256]ranges:像素值的范围，通常[0,256] ，有的图像如果不是0-256，比如说你来回各种变换导致像素值负值、很大，则需要调整后才可以。 #直方图计算的函数，反应灰度值的分布情况 hist = cv2.calcHist([gray], [0], None, [256], [0.0,255.0]) h1 = cv2.calcHist([t1], [0], None, [256], [0.0,255.0]) 2.3 相关性比较 cv2.compareHist(H1, H2, method)
其中：
H1，H2 分别为要比较图像的直方图method - 比较方式比较方式（method）相关性比较 (method=cv.HISTCMP_CORREL) 值越大，相关度越高，最大值为1，最小值为0-----------------------只用一种固然不是很严谨，但这里做示范，把阈值调高也差不多（取大于等于0.9）卡方比较(method=cv.HISTCMP_CHISQR 值越小，相关度越高，最大值无上界，最小值0巴氏距离比较(method=cv.HISTCMP_BHATTACHARYYA) 值越小，相关度越高，最大值为1，最小值为0 #相关性计算，采用相关系数的方式 result = cv2.compareHist(hist,h1,method=cv2.HISTCMP_CORREL) 2.4 展示结果（判断阈值） 相关系数含义参考表
im = Image.open(str(i) &#43; &#34;.bmp&#34;) draw = ImageDraw.Draw(im) fnt = ImageFont." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/e6dffe6a14216d1f6dc59077a6aaad28/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-22T15:38:53+08:00" />
<meta property="article:modified_time" content="2024-01-22T15:38:53+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">python opencv 图片缺陷检测（讲解直方图以及相关系数对比法）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_0"></a>一、利用直方图的方式进行批量的图片缺陷检测（方法简单）</h3> 
<p><img src="https://images2.imgbox.com/d2/5d/8li3XVlW_o.png" alt=""></p> 
<h2><a id="_6"></a>二、步骤（完整代码见最后）</h2> 
<h4><a id="21_8"></a>2.1灰度转换（将原图和要检测对比的图分开灰度化）</h4> 
<p>灰度化的作用是因为后面的直方图比较需要以像素256为基准进行相关性比较</p> 
<pre><code>img = cv2.imread("0.bmp")
#原图灰度转换
gray = cv2.cvtColor(img, cv2.COLOR_RGB2GRAY)

#循环要检测的图，均灰度化
for i in range(1, 6):
    t1=cv2.cvtColor(cv2.imread(str(i)+".bmp"),cv2.COLOR_RGB2GRAY)
</code></pre> 
<h4><a id="22__27"></a>2.2 直方图计算（结果其实是二维的图表–用画图的方式展示）</h4> 
<p><img src="https://images2.imgbox.com/10/4f/lkqrytjB_o.png" alt=""></p> 
<pre><code>calcHist参数讲解
</code></pre> 
<ul><li>第一个参数：<strong>必须为列表[],哪怕只有一个图片</strong>，image输入图像</li><li>channels:：传入图像的通道，<strong>如果是灰度图像，那就不用说了，只有一个通道，值为0</strong>，如果是彩色图像（有3个通道），那么值为0,1,2,中选择一个，对应着BGR各个通道。这个值也得用[]传入。</li><li>mask：掩膜图像。<strong>如果统计整幅图，那么为none</strong>。主要是如果要统计部分图的直方图，就得构造相应的炎掩膜来计算。</li><li>histSize：灰度级的个数，<strong>需要中括号，比如[256]</strong></li><li>ranges:像素值的范围，<strong>通常[0,256]</strong> ，有的图像如果不是0-256，比如说你来回各种变换导致像素值负值、很大，则需要调整后才可以。</li></ul> 
<pre><code> #直方图计算的函数，反应灰度值的分布情况
    hist = cv2.calcHist([gray], [0], None, [256], [0.0,255.0])

    h1 = cv2.calcHist([t1], [0], None, [256], [0.0,255.0])
</code></pre> 
<h4><a id="23__50"></a>2.3 相关性比较</h4> 
<p><strong>cv2.compareHist(H1, H2, method)</strong><br> <strong>其中：</strong></p> 
<ul><li>H1，H2 分别为要比较图像的直方图</li><li>method - 比较方式</li><li>比较方式（method）</li><li><li>相关性比较 (method=cv.HISTCMP_CORREL) 值越大，相关度越高，最大值为1，最小值为0-----------------------只用一种固然不是很严谨，但这里做示范，把阈值调高也差不多（<strong>取大于等于0.9</strong>）</li><li>卡方比较(method=cv.HISTCMP_CHISQR 值越小，相关度越高，最大值无上界，最小值0</li><li>巴氏距离比较(method=cv.HISTCMP_BHATTACHARYYA) 值越小，相关度越高，最大值为1，最小值为0</li></ul> 
<pre><code>#相关性计算，采用相关系数的方式
    result = cv2.compareHist(hist,h1,method=cv2.HISTCMP_CORREL)
</code></pre> 
<h4><a id="24__72"></a>2.4 展示结果（判断阈值）</h4> 
<p><strong>相关系数含义参考表</strong></p> 
<p><img src="https://images2.imgbox.com/c0/48/5LiJ5g6f_o.png" alt=""></p> 
<pre><code> im = Image.open(str(i) + ".bmp")

    draw = ImageDraw.Draw(im)
    fnt = ImageFont.truetype(r'C:\Windows\Fonts\simsun.ttc', 30)
    #这里视作》=0.9认为相似，即合格
    if result &gt;=0.9:
        draw.text((5, 10), u'合格', fill='red', font=fnt)
    else:
        draw.text((5, 10), u'不合格', fill='red', font=fnt)
    im.show("result" +str(i) + ".png")
</code></pre> 
<h3><a id="_101"></a>三、完整代码</h3> 
<pre><code># -*- coding: UTF-8 -*-
import cv2
from PIL import Image, ImageDraw, ImageFont

img = cv2.imread("0.bmp")
#原图灰度转换
gray = cv2.cvtColor(img, cv2.COLOR_RGB2GRAY)

for i in range(1, 6):
    t1=cv2.cvtColor(cv2.imread(str(i)+".bmp"),cv2.COLOR_RGB2GRAY)

    #直方图计算的函数，反应灰度值的分布情况
    hist = cv2.calcHist([gray], [0], None, [256], [0.0,255.0])

    h1 = cv2.calcHist([t1], [0], None, [256], [0.0,255.0])
    #相关性计算，采用相关系数的方式
    result = cv2.compareHist(hist,h1,method=cv2.HISTCMP_CORREL)
    im = Image.open(str(i) + ".bmp")

    draw = ImageDraw.Draw(im)
    fnt = ImageFont.truetype(r'C:\Windows\Fonts\simsun.ttc', 30)
    #这里视作》=0.9认为相似，即合格
    if result &gt;=0.9:
        draw.text((5, 10), u'合格', fill='red', font=fnt)
    else:
        draw.text((5, 10), u'不合格', fill='red', font=fnt)
    im.show("result" +str(i) + ".png")
</code></pre> 
<h4><a id="_134"></a>在线教程</h4> 
<ul><li><a href="" rel="nofollow">麻省理工学院人工智能视频教程</a> – 麻省理工人工智能课程</li><li><a href="" rel="nofollow">人工智能入门</a> – 人工智能基础学习。Peter Norvig举办的课程</li><li><a href="" rel="nofollow">EdX 人工智能</a> – 此课程讲授人工智能计算机系统设计的基本概念和技术。</li><li><a href="" rel="nofollow">人工智能中的计划</a> – 计划是人工智能系统的基础部分之一。在这个课程中，你将会学习到让机器人执行一系列动作所需要的基本算法。</li><li><a href="" rel="nofollow">机器人人工智能</a> – 这个课程将会教授你实现人工智能的基本方法，包括：概率推算，计划和搜索，本地化，跟踪和控制，全部都是围绕有关机器人设计。</li><li><a href="" rel="nofollow">机器学习</a> – 有指导和无指导情况下的基本机器学习算法</li><li><a href="" rel="nofollow">机器学习中的神经网络</a> – 智能神经网络上的算法和实践经验</li><li><a href="" rel="nofollow">斯坦福统计学习</a></li></ul> 
<p><img src="https://images2.imgbox.com/52/87/JkAeBXV1_o.jpg" alt="请添加图片描述"></p> 
<h4><a id="_146"></a>人工智能书籍</h4> 
<ul><li><a href="" rel="nofollow">OpenCV（中文版）.(布拉德斯基等)</a></li><li><a href="" rel="nofollow">OpenCV+3计算机视觉++Python语言实现+第二版</a></li><li><a href="" rel="nofollow">OpenCV3编程入门 毛星云编著</a></li><li><a href="" rel="nofollow">数字图像处理_第三版</a></li><li><a href="" rel="nofollow">人工智能:一种现代的方法</a></li><li><a href="" rel="nofollow">深度学习面试宝典</a></li><li><a href="" rel="nofollow">深度学习之PyTorch物体检测实战</a></li><li><a href="" rel="nofollow">吴恩达DeepLearning.ai中文版笔记</a></li><li><a href="" rel="nofollow">计算机视觉中的多视图几何</a></li><li><a href="" rel="nofollow">PyTorch-官方推荐教程-英文版</a></li><li><a href="" rel="nofollow">《神经网络与深度学习》(邱锡鹏-20191121)</a></li><li>…<br> <img src="https://images2.imgbox.com/65/67/7xy6DZ1R_o.jpg" alt="在这里插入图片描述"></li></ul> 
<p><strong>第一阶段：零基础入门（3-6个月）</strong></p> 
<p>新手应首先通过少而精的学习，<strong>看到全景图，建立大局观。</strong> 通过完成小实验，建立信心，才能避免“从入门到放弃”的尴尬。因此，第一阶段只推荐4本最必要的书（而且这些书到了第二、三阶段也能继续用），入门以后，在后续学习中再“哪里不会补哪里”即可。</p> 
<p><img src="https://images2.imgbox.com/73/d6/LFegEwhj_o.png" alt=""></p> 
<p><strong>第二阶段：基础进阶（3-6个月）</strong></p> 
<p>熟读《机器学习算法的数学解析与Python实现》并动手实践后，你已经对机器学习有了基本的了解，不再是小白了。这时可以开始触类旁通，学习热门技术，加强实践水平。在深入学习的同时，也可以探索自己感兴趣的方向，为求职面试打好基础。</p> 
<p><img src="https://images2.imgbox.com/e8/e4/U8GP0bKC_o.png" alt=""></p> 
<p><strong>第三阶段：工作应用</strong></p> 
<p><img src="https://images2.imgbox.com/87/7a/ZBTQBJPI_o.png" alt=""></p> 
<p>这一阶段你已经不再需要引导，只需要一些推荐书目。如果你从入门时就确认了未来的工作方向，可以在第二阶段就提前阅读相关入门书籍（对应“商业落地五大方向”中的前两本），然后再“哪里不会补哪里”。</p> 
<p><img src="https://images2.imgbox.com/99/4a/3Znk1YV2_o.png" alt=""></p> 
<p><img src="https://images2.imgbox.com/52/90/4xnJByci_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2d69ab693c3308428015ce7796d15038/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Redis 高并发场景下热点缓存的重建策略</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d9abf1463388153b2a5406f3e445d58f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Web 开发 1: Flask 框架介绍和使用</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>