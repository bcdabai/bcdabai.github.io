<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>(十)性能分析工具的使用(上) - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="(十)性能分析工具的使用(上)" />
<meta property="og:description" content="性能分析工具的使用 1. 数据库服务器的优化步骤2. 查看系统性能参数3. 统计SQL的查询成本：last_query_cost4. 定位执行慢的 SQL：慢查询日志4.1 开启慢查询日志参数1. 开启slow_query_log2. 修改long_query_time阈值 4.2 查看慢查询数目4.3 案例演示4.4 测试及分析4.5 慢查询日志分析工具：mysqldumpslow4.6 关闭慢查询日志4.7 删除慢查询日志 5. 查看 SQL 执行成本：SHOW PROFILE 在数据库调优中，我们的目标就是 响应时间更快，吞吐量更大。利用宏观的监控工具和微观的日志分析可以帮我们快速找到调优的思路和方式。 1. 数据库服务器的优化步骤 当我们遇到数据库调优问题的时候，该如何思考呢？这里把思考的流程整理成下面这张图。
整个流程划分成了 观察（Show status） 和 行动（Action） 两个部分。字母 S 的部分代表观察（会使用相应的分析工具），字母 A 代表的部分是行动（对应分析可以采取的行动）。
我们可以通过观察了解数据库整体的运行状态，通过性能分析工具可以让我们了解执行慢的SQL都有哪些，查看具体的SQL执行计划，甚至是SQL执行中的每一步的成本代价，这样才能定位问题所在，找到了问题，再采取相应的行动。
详细解释一下这张图:
首先在S1部分，我们需要观察服务器的状态是否存在周期性的波动。如果存在周期性波动，有可能是周期性节点的原因，比如双十一、促销活动等。这样的话，我们可以通过A1这一步骤解决，也就是加缓存或者更改缓存失效策略。
如果缓存策略没有解决，或者不是周期性波动的原因，我们就需要进一步分析查询延迟和卡顿的原因。接下来进入S2这一步，我们需要开启慢查询。慢查询可以帮我们定位执行慢的sQL语句。我们可以通过设置long_query_time参数定义“慢”的阈值，如果SQL执行时间超过了long_query_time，则会认为是慢查询。当收集上来这些慢查询之后，我们就可以通过分析工具对慢查询日志进行分析。
在S3这一步骤中，我们就知道了执行慢的SQL，这样就可以针对性地用EXPLAIN查看对应SQL语句的执行计划，或者使用show profile查看sQL中每一个步骤的时间成本。这样我们就可以了解SQL查询慢是因为执行时间长，还是等待时间长。
如果是SQL等待时间长，我们进入A2步骤。在这一步骤中，我们可以调优服务器的参数，比如适当增加数据库缓冲池等。如果是SQL执行时间长，就进入A3步骤，这一步中我们需要考虑是索引设计的问题?还是查询关联的数据表过多?还是因为数据表的字段设计问题导致了这一现象。然后在这些维度上进行对应的调整。
如果A2和A3都不能解决问题，我们需要考虑数据库自身的SQL查询性能是否已经达到了瓶颈，如果确认没有达到性能瓶颈，就需要重新检查，重复以上的步骤。如果已经达到了性能瓶颈，进入A4阶段，需要考虑增加服务器，采用读写分离的架构，或者考虑对数据库进行分库分表，比如垂直分库、垂直分表和水平分表等。
以上就是数据库调优的流程思路。如果我们发现执行SQL时存在不规则延迟或卡顿的时候，就可以采用分析工具帮我们定位有问题的SQL，这三种分析工具你可以理解是SQL调优的三个步骤:慢查询、EXPLAIN和SHOWPROFILING。
小结：
2. 查看系统性能参数 在MySQL中，可以使用 SHOW STATUS 语句查询一些MySQL数据库服务器的 性能参数 、 执行频率 。 SHOW STATUS语句语法如下：
SHOW [GLOBAL|SESSION] STATUS LIKE &#39;参数&#39;; 一些常用的性能参数如下：
• Connections：连接MySQL服务器的次数。
• Uptime：MySQL服务器的上线时间。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/70d77a3e3e9386587b9f4058e7a46736/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-02-20T15:53:45+08:00" />
<meta property="article:modified_time" content="2022-02-20T15:53:45+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">(十)性能分析工具的使用(上)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>性能分析工具的使用</h4> 
 <ul><li><a href="#1__3" rel="nofollow">1. 数据库服务器的优化步骤</a></li><li><a href="#2__32" rel="nofollow">2. 查看系统性能参数</a></li><li><a href="#3_SQLlast_query_cost_51" rel="nofollow">3. 统计SQL的查询成本：last_query_cost</a></li><li><a href="#4__SQL_114" rel="nofollow">4. 定位执行慢的 SQL：慢查询日志</a></li><li><ul><li><a href="#41__124" rel="nofollow">4.1 开启慢查询日志参数</a></li><li><ul><li><a href="#1_slow_query_log_125" rel="nofollow">1. 开启slow_query_log</a></li><li><a href="#2_long_query_time_143" rel="nofollow">2. 修改long_query_time阈值</a></li></ul> 
   </li><li><a href="#42__176" rel="nofollow">4.2 查看慢查询数目</a></li><li><a href="#43__184" rel="nofollow">4.3 案例演示</a></li><li><a href="#44__266" rel="nofollow">4.4 测试及分析</a></li><li><a href="#45_mysqldumpslow_284" rel="nofollow">4.5 慢查询日志分析工具：mysqldumpslow</a></li><li><a href="#46__334" rel="nofollow">4.6 关闭慢查询日志</a></li><li><a href="#47__371" rel="nofollow">4.7 删除慢查询日志</a></li></ul> 
  </li><li><a href="#5__SQL_SHOW_PROFILE_388" rel="nofollow">5. 查看 SQL 执行成本：SHOW PROFILE</a></li></ul> 
</div> 
<br> 在数据库调优中，我们的目标就是 
<code>响应时间更快，吞吐量更大</code>。利用宏观的监控工具和微观的日志分析可以帮我们快速找到调优的思路和方式。 
<p></p> 
<hr> 
<h2><a id="1__3"></a>1. 数据库服务器的优化步骤</h2> 
<p>当我们遇到数据库调优问题的时候，该如何思考呢？这里把思考的流程整理成下面这张图。</p> 
<p>整个流程划分成了 <mark>观察（Show status）</mark> 和 <mark>行动（Action）</mark> 两个部分。字母 S 的部分代表观察（会使用相应的分析工具），字母 A 代表的部分是行动（对应分析可以采取的行动）。</p> 
<p><img src="https://images2.imgbox.com/02/42/CqocZl2v_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/68/17/ZOOpioGh_o.png" alt="在这里插入图片描述"></p> 
<p>我们可以通过观察了解数据库整体的运行状态，通过性能分析工具可以让我们了解执行慢的SQL都有哪些，查看具体的SQL执行计划，甚至是SQL执行中的每一步的成本代价，这样才能定位问题所在，找到了问题，再采取相应的行动。</p> 
<blockquote> 
 <p>详细解释一下这张图:</p> 
</blockquote> 
<p>首先在S1部分，我们需要观察服务器的状态是否存在周期性的波动。如果存在周期性波动，有可能是周期性节点的原因，比如双十一、促销活动等。这样的话，我们可以通过A1这一步骤解决，也就是加缓存或者更改缓存失效策略。</p> 
<p>如果缓存策略没有解决，或者不是周期性波动的原因，我们就需要进一步<code>分析查询延迟和卡顿的原因</code>。接下来进入S2这一步，我们需要开启慢查询。慢查询可以帮我们定位执行慢的sQL语句。我们可以通过设置<code>long_query_time</code>参数定义“慢”的阈值，如果SQL执行时间超过了long_query_time，则会认为是慢查询。当收集上来这些慢查询之后，我们就可以通过分析工具对慢查询日志进行分析。</p> 
<p>在S3这一步骤中，我们就知道了执行慢的SQL，这样就可以针对性地用<code>EXPLAIN</code>查看对应SQL语句的执行计划，或者使用<code>show profile</code>查看sQL中每一个步骤的时间成本。这样我们就可以了解SQL查询慢是因为执行时间长，还是等待时间长。</p> 
<p>如果是SQL等待时间长，我们进入A2步骤。在这一步骤中，我们可以<code>调优服务器的参数</code>，比如适当增加数据库缓冲池等。如果是SQL执行时间长，就进入A3步骤，这一步中我们需要考虑是索引设计的问题?还是查询关联的数据表过多?还是因为数据表的字段设计问题导致了这一现象。然后在这些维度上进行对应的调整。</p> 
<p>如果A2和A3都不能解决问题，我们需要考虑数据库自身的SQL查询性能是否已经达到了瓶颈，如果确认没有达到<code>性能瓶颈</code>，就需要重新检查，重复以上的步骤。如果已经达到了性能瓶颈，进入A4阶段，需要考虑增加服务器，采用<code>读写分离</code>的架构，或者考虑对数据库进行分库分表，比如<code>垂直分库</code>、<code>垂直分表</code>和<code>水平分表</code>等。</p> 
<p>以上就是数据库调优的流程思路。如果我们发现执行SQL时存在不规则延迟或卡顿的时候，就可以采用分析工具帮我们定位有问题的SQL，这三种分析工具你可以理解是SQL调优的三个步骤:<code>慢查询</code>、<code>EXPLAIN</code>和<code>SHOWPROFILING</code>。</p> 
<blockquote> 
 <p>小结：</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/2c/9d/j57fC1tJ_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="2__32"></a>2. 查看系统性能参数</h2> 
<p>在MySQL中，可以使用 <code>SHOW STATUS</code> 语句查询一些MySQL数据库服务器的 性能参数 、 执行频率 。 SHOW STATUS语句语法如下：</p> 
<pre><code class="prism language-sql"><span class="token keyword">SHOW</span> <span class="token punctuation">[</span><span class="token keyword">GLOBAL</span><span class="token operator">|</span><span class="token keyword">SESSION</span><span class="token punctuation">]</span> <span class="token keyword">STATUS</span> <span class="token operator">LIKE</span> <span class="token string">'参数'</span><span class="token punctuation">;</span>
</code></pre> 
<p>一些常用的性能参数如下：<br> • Connections：连接MySQL服务器的次数。<br> • Uptime：MySQL服务器的上线时间。<br> • Slow_queries：慢查询的次数。<br> • Innodb_rows_read：Select查询返回的行数<br> • Innodb_rows_inserted：执行INSERT操作插入的行数<br> • Innodb_rows_updated：执行UPDATE操作更新的行数<br> • Innodb_rows_deleted：执行DELETE操作删除的行数<br> • Com_select：查询操作的次数。<br> • Com_insert：插入操作的次数。对于批量插入的 INSERT 操作，只累加一次。<br> • Com_update：更新操作的次数。<br> • Com_delete：删除操作的次数。</p> 
<h2><a id="3_SQLlast_query_cost_51"></a>3. 统计SQL的查询成本：last_query_cost</h2> 
<p>一条SQL查询语句在执行前需要确定查询执行计划，如果存在多种执行计划的话，MySQL会计算每个执行计划所需要的成本，<strong>从中选择成本最小的一个作为最终执行的执行计划。</strong></p> 
<p>如果我们想要查看某条SQL语句的查询成本，可以在执行完这条SQL语句之后，通过查看当前会话中的<code>last_query_cost</code>变量值来得到当前查询的成本。它通常也是我们评价一个查询的执行效率的一个常用指标。<mark>这个查询成本对应的是 SQL语句所需要读取的页的数量。</mark></p> 
<p>我们依然使用 student_info 表为例：</p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>student_info<span class="token punctuation">`</span> <span class="token punctuation">(</span> 
<span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span> 
<span class="token punctuation">`</span>student_id<span class="token punctuation">`</span> <span class="token keyword">INT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token punctuation">,</span> 
<span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> 
<span class="token punctuation">`</span>course_id<span class="token punctuation">`</span> <span class="token keyword">INT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token punctuation">,</span> 
<span class="token punctuation">`</span>class_id<span class="token punctuation">`</span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> 
<span class="token punctuation">`</span>create_time<span class="token punctuation">`</span> <span class="token keyword">DATETIME</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">ON</span> <span class="token keyword">UPDATE</span> <span class="token keyword">CURRENT_TIMESTAMP</span><span class="token punctuation">,</span> 
<span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span> 
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">INNODB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span>
</code></pre> 
<p>如果我们想要查询 id=900001 的记录，然后看下查询成本，我们可以直接在聚簇索引上进行查找：</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> student_id<span class="token punctuation">,</span> class_id<span class="token punctuation">,</span> NAME<span class="token punctuation">,</span> create_time <span class="token keyword">FROM</span> student_info
<span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token number">900001</span><span class="token punctuation">;</span>
</code></pre> 
<p>运行结果（1 条记录，运行时间为<code>0.042s</code> ）</p> 
<p>然后再看下查询优化器的成本，实际上我们只需要检索一个页即可：</p> 
<pre><code class="prism language-sql">mysql<span class="token operator">&gt;</span> <span class="token keyword">SHOW</span> <span class="token keyword">STATUS</span> <span class="token operator">LIKE</span> <span class="token string">'last_query_cost'</span><span class="token punctuation">;</span> 
<span class="token operator">+</span><span class="token comment">-----------------+----------+</span>
<span class="token operator">|</span> Variable_name <span class="token operator">|</span> <span class="token keyword">Value</span> <span class="token operator">|</span> 
<span class="token operator">+</span><span class="token comment">-----------------+----------+</span>
<span class="token operator">|</span> Last_query_cost <span class="token operator">|</span> <span class="token number">1.000000</span> <span class="token operator">|</span> 
<span class="token operator">+</span><span class="token comment">-----------------+----------+</span>
</code></pre> 
<p>如果我们想要查询 id 在 900001 到 9000100 之间的学生记录呢？</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> student_id<span class="token punctuation">,</span> class_id<span class="token punctuation">,</span> NAME<span class="token punctuation">,</span> create_time <span class="token keyword">FROM</span> student_info
<span class="token keyword">WHERE</span> id <span class="token operator">BETWEEN</span> <span class="token number">900001</span> <span class="token operator">AND</span> <span class="token number">900100</span><span class="token punctuation">;</span>
</code></pre> 
<p>运行结果（100 条记录，运行时间为 <code>0.046s</code> ）：</p> 
<p>然后再看下查询优化器的成本，这时我们大概需要进行 20 个页的查询</p> 
<pre><code class="prism language-sql">mysql<span class="token operator">&gt;</span> <span class="token keyword">SHOW</span> <span class="token keyword">STATUS</span> <span class="token operator">LIKE</span> <span class="token string">'last_query_cost'</span><span class="token punctuation">;</span> 
<span class="token operator">+</span><span class="token comment">-----------------+-----------+</span>
<span class="token operator">|</span> Variable_name <span class="token operator">|</span> <span class="token keyword">Value</span> <span class="token operator">|</span> 
<span class="token operator">+</span><span class="token comment">-----------------+-----------+</span>
<span class="token operator">|</span> Last_query_cost <span class="token operator">|</span> <span class="token number">21.134453</span> <span class="token operator">|</span> 
<span class="token operator">+</span><span class="token comment">-----------------+-----------+</span>
</code></pre> 
<p>你能看到页的数量是刚才的 20 倍，但是查询的效率并没有明显的变化，实际上这两个 SQL 查询的时间基本上一样，就是因为采用了顺序读取的方式将页面一次性加载到缓冲池中，然后再进行查找。<code>虽然 页数量（last_query_cost）</code>增加了不少 ，但是<strong>通过缓冲池的机制</strong>，并 <code>没有增加多少查询时间</code>。</p> 
<p><mark>使用场景</mark>：它对于比较开销是非常有用的，特别是我们有好几种查询方式可选的时候</p> 
<blockquote> 
 <p>SQL查询是一个动态的过程，从页加载的角度来看，我们可以得到以下两点结论:<br> 1.<code>位置决定效率</code>。如果页就在数据库缓冲池中，那么效率是最高的，否则还需要从内存或者磁盘读取，当然针对单个页的读取来说,如果页存在于内存中，会比在磁盘中读取效率高很多。<br> 2．<code>批量决定效率</code>。如果我们从磁盘中对单一页进行随机读，那么效率是很低的(差不多10ms)，而采用顺序读取的方式，批量对页进行读取，平均一页的读取效率就会提升很多，甚至要快于单个页面在内存中的随机读取。<br> 所以说，遇到I/O并不用担心，方法找对了，效率还是很高的。我们首先要考虑数据存放的位置，如果是经常使用的数据就要尽量放到缓冲池中，其次我们可以充分利用磁盘的吞吐能力，一次性批量读取数据，这样单个页的读取效率也就得到了提升。</p> 
</blockquote> 
<h2><a id="4__SQL_114"></a>4. 定位执行慢的 SQL：慢查询日志</h2> 
<p>MySQL的慢查询日志，用来记录在MySQL中<code>响应时间超过阀值</code>的语句，具体指运行时间超过<code>long_query_time</code>值的SQL，则会被记录到慢查询日志中。long_query_time的<code>默认值为10</code>，意思是运行10秒以上(不含10秒)的语句，认为是超出了我们的最大忍耐时间值。</p> 
<p>它的主要作用是，帮助我们发现那些执行时间特别长的SQL查询，并且有针对性地进行优化，从而提高系统的整体效率。当我们的数据库服务器发生阻塞、运行变慢的时候，检查一下慢查询日志，找到那些慢查询，对解决问题很有帮助。比如一条sql执行超过5秒钟，我们就算慢SQL，希望能收集超过5秒的sql，结合explain进行全面分析。</p> 
<p><code>默认情况下，MySQL数据库没有开启慢查询日志</code>，需要我们手动来设置这个参数。<mark>如果不是调优需要的话，一般不建议启动该参数，因为开启慢查询日志会或多或少带来一定的性能影响</mark>。</p> 
<p><strong>慢查询日志支持将日志记录写入文件。</strong></p> 
<h3><a id="41__124"></a>4.1 开启慢查询日志参数</h3> 
<h4><a id="1_slow_query_log_125"></a>1. 开启slow_query_log</h4> 
<p>在使用前，我们需要先看下慢查询是否已经开启，使用下面这条命令即可:</p> 
<pre><code class="prism language-sql">mysql <span class="token operator">&gt;</span> <span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">'%slow_query_log'</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/e6/5c/wYHxockU_o.png" alt="在这里插入图片描述"><br> 我们能看到<code>slow_query_log=OFF</code>，我们可以把慢查询日志打开，注意设置变量值的时候需要使用<code>global</code>，否则会报错:</p> 
<pre><code class="prism language-sql">mysql <span class="token operator">&gt;</span> <span class="token keyword">set</span> <span class="token keyword">global</span> slow_query_log<span class="token operator">=</span><span class="token string">'ON'</span><span class="token punctuation">;</span>
</code></pre> 
<p>然后我们再来查看下慢查询日志是否开启，以及慢查询日志文件的位置：<br> <img src="https://images2.imgbox.com/0a/3b/yPfPmkao_o.png" alt="在这里插入图片描述"><br> 你能看到这时慢查询分析已经开启，同时文件保存在 <code>/var/lib/mysql/Feng-slow.log</code> 文件中。<br> <img src="https://images2.imgbox.com/89/e3/6NMwU5i7_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="2_long_query_time_143"></a>2. 修改long_query_time阈值</h4> 
<p>接下来我们来看下慢查询的时间阈值设置，使用如下命令:</p> 
<pre><code class="prism language-sql">mysql <span class="token operator">&gt;</span> <span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">'%long_query_time%'</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/5e/f2/qsHHeU1e_o.png" alt="在这里插入图片描述"><br> 这里如果我们想把时间缩短，比如设置为 1 秒，可以这样设置：</p> 
<pre><code class="prism language-sql"><span class="token comment">#测试发现：设置global的方式对当前session的long_query_time失效。对新连接的客户端有效。所以可以一并 执行下述语句 </span>
mysql <span class="token operator">&gt;</span> <span class="token keyword">set</span> <span class="token keyword">global</span> long_query_time <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> 
mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> <span class="token keyword">global</span> variables <span class="token operator">like</span> <span class="token string">'%long_query_time%'</span><span class="token punctuation">;</span> 

mysql<span class="token operator">&gt;</span> <span class="token keyword">set</span> long_query_time<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> 
mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">'%long_query_time%'</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/3d/c3/oZr7fOrj_o.png" alt="在这里插入图片描述"></p> 
<p><mark>补充 ：配置文件中一并设置参数</mark></p> 
<p>如下的方式相较于前面的命令行方式，可以看作是<code>永久设置</code>的方式。</p> 
<p>修改<code>my .cnf</code>文件，<code>[mysqld]</code>下增加或修改参数<code>long_query_time</code>、<code>slow_query_log</code> 和<code>slow_query_log_file</code>后，然后重启MySQL服务器。</p> 
<pre><code class="prism language-powershell"><span class="token namespace">[mysqld]</span>
slow_query_log=ON<span class="token comment">#开启慢查询日志的开关</span>
slow_query_log_file=<span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>lib<span class="token operator">/</span>mysql<span class="token operator">/</span>feng<span class="token operator">-</span>slow<span class="token punctuation">.</span>log <span class="token comment">#慢查询日志的目录和文件名信息</span>
long_query_time=3<span class="token comment">#设置慢查询的阈值为3秒，超出此设定值的SQL即被记录到慢查询日志</span>
log_output=FILE
</code></pre> 
<p>如果不指定存储路径，慢查询日志将默认存储到MySQL数据库的数据文件夹下。如果不指定文件名默认文件名为<code>hostname-slow.log</code>。</p> 
<h3><a id="42__176"></a>4.2 查看慢查询数目</h3> 
<p>查询当前系统中有多少条慢查询记录</p> 
<pre><code class="prism language-sql"><span class="token keyword">SHOW</span> <span class="token keyword">GLOBAL</span> <span class="token keyword">STATUS</span> <span class="token operator">LIKE</span> <span class="token string">'%Slow_queries%'</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/a1/d1/gdh7T2cg_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="43__184"></a>4.3 案例演示</h3> 
<blockquote> 
 <p>步骤1. 建表</p> 
</blockquote> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>student<span class="token punctuation">`</span> <span class="token punctuation">(</span> 
<span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span> 
<span class="token punctuation">`</span>stuno<span class="token punctuation">`</span> <span class="token keyword">INT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token punctuation">,</span> 
<span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> 
<span class="token punctuation">`</span>age<span class="token punctuation">`</span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> 
<span class="token punctuation">`</span>classId<span class="token punctuation">`</span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> 
<span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span> 
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">INNODB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span>
</code></pre> 
<blockquote> 
 <p>步骤2：设置参数 log_bin_trust_function_creators</p> 
</blockquote> 
<p>创建函数，假如报错：</p> 
<pre><code class="prism language-sql">This <span class="token keyword">function</span> has none <span class="token keyword">of</span> <span class="token keyword">DETERMINISTIC</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre> 
<p>命令开启：允许创建函数设置：</p> 
<pre><code class="prism language-sql"><span class="token keyword">set</span> <span class="token keyword">global</span> log_bin_trust_function_creators<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment"># 不加global只是当前窗口有效。</span>
</code></pre> 
<blockquote> 
 <p>步骤3：创建函数</p> 
</blockquote> 
<p>随机产生字符串：（同上一章）</p> 
<pre><code class="prism language-sql"><span class="token keyword">DELIMITER</span> <span class="token comment">// </span>
<span class="token keyword">CREATE</span> <span class="token keyword">FUNCTION</span> rand_string<span class="token punctuation">(</span>n <span class="token keyword">INT</span><span class="token punctuation">)</span> <span class="token keyword">RETURNS</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token comment">#该函数会返回一个字符串 </span>
<span class="token keyword">BEGIN</span>
	<span class="token keyword">DECLARE</span> chars_str <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token string">'abcdefghijklmnopqrstuvwxyzABCDEFJHIJKLMNOPQRSTUVWXYZ'</span><span class="token punctuation">;</span> 
	<span class="token keyword">DECLARE</span> return_str <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token string">''</span><span class="token punctuation">;</span> 
	<span class="token keyword">DECLARE</span> i <span class="token keyword">INT</span> <span class="token keyword">DEFAULT</span> <span class="token number">0</span><span class="token punctuation">;</span> 
	<span class="token keyword">WHILE</span> i <span class="token operator">&lt;</span> n 
	<span class="token keyword">DO</span> 
		<span class="token keyword">SET</span> return_str <span class="token operator">=</span>CONCAT<span class="token punctuation">(</span>return_str<span class="token punctuation">,</span>SUBSTRING<span class="token punctuation">(</span>chars_str<span class="token punctuation">,</span>FLOOR<span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">+</span>RAND<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">52</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
		<span class="token keyword">SET</span> i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> 
	<span class="token keyword">END</span> <span class="token keyword">WHILE</span><span class="token punctuation">;</span> <span class="token keyword">RETURN</span> return_str<span class="token punctuation">;</span> 
<span class="token keyword">END</span> <span class="token comment">// </span>
<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span> 
<span class="token comment">#测试 </span>
<span class="token keyword">SELECT</span> rand_string<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>产生随机数值：（同上一章）</p> 
<pre><code class="prism language-sql"><span class="token keyword">DELIMITER</span> <span class="token comment">// </span>
<span class="token keyword">CREATE</span> <span class="token keyword">FUNCTION</span> rand_num <span class="token punctuation">(</span>from_num <span class="token keyword">INT</span> <span class="token punctuation">,</span>to_num <span class="token keyword">INT</span><span class="token punctuation">)</span> <span class="token keyword">RETURNS</span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> 
<span class="token keyword">BEGIN</span> 
	<span class="token keyword">DECLARE</span> i <span class="token keyword">INT</span> <span class="token keyword">DEFAULT</span> <span class="token number">0</span><span class="token punctuation">;</span> 
	<span class="token keyword">SET</span> i <span class="token operator">=</span> FLOOR<span class="token punctuation">(</span>from_num <span class="token operator">+</span>RAND<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>to_num <span class="token operator">-</span> from_num<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> 
	<span class="token keyword">RETURN</span> i<span class="token punctuation">;</span> 
<span class="token keyword">END</span> <span class="token comment">// </span>
<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span> 
<span class="token comment">#测试： </span>
<span class="token keyword">SELECT</span> rand_num<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<blockquote> 
 <p>步骤4：创建存储过程</p> 
</blockquote> 
<pre><code class="prism language-sql"><span class="token keyword">DELIMITER</span> <span class="token comment">// </span>
<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> insert_stu1<span class="token punctuation">(</span> <span class="token keyword">START</span> <span class="token keyword">INT</span> <span class="token punctuation">,</span> max_num <span class="token keyword">INT</span> <span class="token punctuation">)</span> 
<span class="token keyword">BEGIN</span> 
	<span class="token keyword">DECLARE</span> i <span class="token keyword">INT</span> <span class="token keyword">DEFAULT</span> <span class="token number">0</span><span class="token punctuation">;</span> 
	<span class="token keyword">SET</span> autocommit <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">#设置手动提交事务 </span>
	<span class="token keyword">REPEAT</span> <span class="token comment">#循环 </span>
	<span class="token keyword">SET</span> i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">#赋值 </span>
	<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> student <span class="token punctuation">(</span>stuno<span class="token punctuation">,</span> NAME <span class="token punctuation">,</span>age <span class="token punctuation">,</span>classId <span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">START</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span>rand_string<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span>rand_num<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>rand_num<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> UNTIL i <span class="token operator">=</span> max_num 
	<span class="token keyword">END</span> <span class="token keyword">REPEAT</span><span class="token punctuation">;</span> 
	<span class="token keyword">COMMIT</span><span class="token punctuation">;</span> <span class="token comment">#提交事务 </span>
	<span class="token keyword">END</span> <span class="token comment">// </span>
<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>
</code></pre> 
<blockquote> 
 <p>步骤5：调用存储过程</p> 
</blockquote> 
<pre><code class="prism language-sql"><span class="token comment">#调用刚刚写好的函数, 4000000条记录,从100001号开始 </span>
<span class="token keyword">CALL</span> insert_stu1<span class="token punctuation">(</span><span class="token number">100001</span><span class="token punctuation">,</span><span class="token number">4000000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="44__266"></a>4.4 测试及分析</h3> 
<blockquote> 
 <ol><li>测试</li></ol> 
</blockquote> 
<p><img src="https://images2.imgbox.com/e6/8a/khIbf4jh_o.png" alt="在这里插入图片描述"><br> 从上面的结果可以看出来，查询学生编号为“3455655”的学生信息花费时间为2.09秒。查询学生姓名为“oQmLUr”的学生信息花费时间为2.39秒。已经达到了秒的数量级，说明目前查询效率是比较低的，下面的小节我们分析一下原因</p> 
<blockquote> 
 <ol start="2"><li>分析</li></ol> 
</blockquote> 
<pre><code class="prism language-sql"><span class="token keyword">show</span> <span class="token keyword">status</span> <span class="token operator">like</span> <span class="token string">'slow_queries'</span><span class="token punctuation">;</span>
</code></pre> 
<blockquote> 
 <p><mark>补充说明</mark>:<br> 除了上述变量，控制慢查询日志的还有一个系统变量: <code>min_examined_row_limit</code>。这个变量的意思是，<code>查询扫描过的最少记录数</code>。这个变量和查询执行时间，共同组成了判别一个查询是否是慢查询的条件。如果查询扫描过的记录数大于等于这个变量的值，并且查询执行时间超过long_query_time的值，那么，这个查询就被记录到慢查询日志中;反之，则不被记录到慢查询日志中。<br> <img src="https://images2.imgbox.com/a6/bb/BtoJvaXq_o.png" alt="在这里插入图片描述"><br> 这个值默认是0。与long_query_time=10合在一起，表示只要查询的执行时间超过10秒钟，哪怕一个记录也没有扫描过，都要被记录到慢查询日志中。你也可以根据需要，通过修改“my.ini"”文件，来修改查询时长，或者通过SET 指令，用SQL语句修改“min_examined_row_limit”的值。</p> 
</blockquote> 
<h3><a id="45_mysqldumpslow_284"></a>4.5 慢查询日志分析工具：mysqldumpslow</h3> 
<p>在生产环境中，如果要手工分析日志，查找、分析SQL，显然是个体力活，MySQL提供了日志分析工具<code>mysqldumpslow</code> 。</p> 
<p>查看mysqldumpslow的帮助信息</p> 
<pre><code class="prism language-sql">mysqldumpslow <span class="token comment">--help</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/c3/79/TbAyrNbU_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>mysqldumpslow 命令的具体参数如下：</p> 
</blockquote> 
<ul><li> <p>-a: 不将数字抽象成N，字符串抽象成S</p> </li><li> <p><code>-s: 是表示按照何种方式排序</code>：</p> 
  <ul><li>c: 访问次数</li><li>l: 锁定时间</li><li>r: 返回记录</li><li>t: 查询时间</li><li>al:平均锁定时间</li><li>ar:平均返回记录数</li><li>at:平均查询时间 （默认方式）</li><li>ac:平均查询次数</li></ul> </li><li> <p><code>-t: 即为返回前面多少条的数据</code>；</p> </li><li> <p><code>-g: 后边搭配一个正则匹配模式，大小写不敏感的</code>；</p> </li></ul> 
<p>举例：我们想要按照查询时间排序，查看前五条 SQL 语句，这样写即可：</p> 
<pre><code class="prism language-sql">mysqldumpslow <span class="token operator">-</span>s t <span class="token operator">-</span>t <span class="token number">5</span> <span class="token operator">/</span>var<span class="token operator">/</span>lib<span class="token operator">/</span>mysql<span class="token operator">/</span>feng<span class="token operator">-</span>slow<span class="token punctuation">.</span>log
</code></pre> 
<p><img src="https://images2.imgbox.com/b1/14/TXrpFQhH_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>工作常用参考：</p> 
</blockquote> 
<pre><code class="prism language-bash"><span class="token comment">#得到返回记录集最多的10个SQL </span>
mysqldumpslow -s r -t <span class="token number">10</span> /var/lib/mysql/atguigu-slow.log 

<span class="token comment">#得到访问次数最多的10个SQL </span>
mysqldumpslow -s c -t <span class="token number">10</span> /var/lib/mysql/atguigu-slow.log 

<span class="token comment">#得到按照时间排序的前10条里面含有左连接的查询语句 </span>
mysqldumpslow -s t -t <span class="token number">10</span> -g <span class="token string">"left join"</span> /var/lib/mysql/atguigu-slow.log 

<span class="token comment">#另外建议在使用这些命令时结合 | 和more 使用 ，否则有可能出现爆屏情况 </span>
mysqldumpslow -s r -t <span class="token number">10</span> /var/lib/mysql/atguigu-slow.log <span class="token operator">|</span> <span class="token function">more</span>
</code></pre> 
<h3><a id="46__334"></a>4.6 关闭慢查询日志</h3> 
<p>MySQL服务器停止慢查询日志功能有两种方法：</p> 
<blockquote> 
 <p>方式1：永久性方式</p> 
</blockquote> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>mysqld<span class="token punctuation">]</span> 
<span class="token assign-left variable">slow_query_log</span><span class="token operator">=</span>OFF
</code></pre> 
<p>或者，把slow_query_log一项注释掉 或 删除</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>mysqld<span class="token punctuation">]</span> 
<span class="token comment">#slow_query_log =OFF</span>
</code></pre> 
<p>重启MySQL服务，执行如下语句查询慢日志功能。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SHOW</span> VARIABLES <span class="token operator">LIKE</span> <span class="token string">'%slow%'</span><span class="token punctuation">;</span> <span class="token comment">#查询慢查询日志所在目录 </span>
	<span class="token keyword">SHOW</span> VARIABLES <span class="token operator">LIKE</span> <span class="token string">'%long_query_time%'</span><span class="token punctuation">;</span> <span class="token comment">#查询超时时长</span>
</code></pre> 
<blockquote> 
 <p>方式2：临时性方式</p> 
</blockquote> 
<p>使用SET语句来设置。</p> 
<p>（1）停止MySQL慢查询日志功能，具体SQL语句如下</p> 
<pre><code class="prism language-sql"><span class="token keyword">SET</span> <span class="token keyword">GLOBAL</span> slow_query_log<span class="token operator">=</span><span class="token keyword">off</span><span class="token punctuation">;</span>
</code></pre> 
<p>（2）<code>重启MySQL服务</code>，使用SHOW语句查询慢查询日志功能信息，具体SQL语句如下</p> 
<pre><code class="prism language-sql"><span class="token keyword">SHOW</span> VARIABLES <span class="token operator">LIKE</span> <span class="token string">'%slow%'</span><span class="token punctuation">;</span> 
<span class="token comment">#以及 </span>
<span class="token keyword">SHOW</span> VARIABLES <span class="token operator">LIKE</span> <span class="token string">'%long_query_time%'</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="47__371"></a>4.7 删除慢查询日志</h3> 
<p>使用SHOW语句显示慢查询日志信息，具体SQL语句如下。</p> 
<pre><code class="prism language-powershell">SHOW VARIABLES LIKE <span class="token string">'slow_query_log% '</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/d8/6d/JkSOLdQx_o.png" alt="在这里插入图片描述"></p> 
<p>从执行结果可以看出，慢查询日志的目录默认为MySQL的数据目录，在该目录下<mark>手动删除慢查询日志文件即可</mark>。<br> 使用命令<code>mysqladmin flush-logs</code>来重新生成查询日志文件，具体命令如下，执行完毕会在数据目录下重新生成慢查询日志文件。</p> 
<pre><code class="prism language-shell">mysqladmin -uroot -p flush-logs slow
</code></pre> 
<blockquote> 
 <p>提示<br> 慢查询日志都是使用mysqladmin flush-logs命令来删除重建的。使用时一定要注意，一旦执行了这个命令，慢查询日志都只存在新的日志文件中，如果需要旧的查询日志，就必须事先备份。</p> 
</blockquote> 
<h2><a id="5__SQL_SHOW_PROFILE_388"></a>5. 查看 SQL 执行成本：SHOW PROFILE</h2> 
<p>Show Profile是MySQL提供的可以用来分析当前会话中sQL都做了什么、执行的资源消耗情况的工具，可用于sql调优的测量。<code>默认情况下处于关闭状态，并保存最近15次的运行结果</code>。</p> 
<p>我们可以在会话级别开启这个功能</p> 
<pre><code class="prism language-sql">mysql <span class="token operator">&gt;</span> <span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">'profiling'</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/b0/ed/oZEAaFGy_o.png" alt="在这里插入图片描述"><br> 通过设置 profiling='ON’ 来开启 show profile：</p> 
<pre><code class="prism language-sql">mysql <span class="token operator">&gt;</span> <span class="token keyword">set</span> profiling <span class="token operator">=</span> <span class="token string">'ON'</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/77/f6/HbXKoS8h_o.png" alt="在这里插入图片描述"><br> 然后执行相关的查询语句。接着看下当前会话都有哪些 profiles，使用下面这条命令</p> 
<pre><code class="prism language-sql">mysql <span class="token operator">&gt;</span> <span class="token keyword">show</span> profiles<span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/62/23/lpvJyz6Y_o.png" alt="在这里插入图片描述"></p> 
<p>你能看到当前会话一共有 2 个查询。如果我们想要查看最近一次查询的开销，可以使用：</p> 
<pre><code class="prism language-sql">mysql <span class="token operator">&gt;</span> <span class="token keyword">show</span> profile<span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/dd/da/p4MCvtTM_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-sql">mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> profile cpu<span class="token punctuation">,</span>block io <span class="token keyword">for</span> query <span class="token number">2</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/d1/db/n3rcduVm_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>show profile的常用查询参数：</p> 
</blockquote> 
<p>① ALL：显示所有的开销信息。<br> ② BLOCK IO：显示块IO开销。<br> ③ CONTEXT SWITCHES：上下文切换开<br> 销。<br> ④ CPU：显示CPU开销信息。<br> ⑤ IPC：显示发送和接收开销信息。<br> ⑥ MEMORY：显示内存开销信<br> 息。<br> ⑦ PAGE FAULTS：显示页面错误开销信息。<br> ⑧ SOURCE：显示和Source_function，Source_file， Source_line相关的开销信息。<br> ⑨ SWAPS：显示交换次数开销信息。</p> 
<blockquote> 
 <p>日常开发需注意的结论:</p> 
</blockquote> 
<ul><li><code>converting HEAP to MyISAM</code>:查询结果太大，内存不够，数据往磁盘上搬了。-</li><li><code>Creating tmp table</code>:创建临时表。先拷贝数据到临时表，用完后再删除临时表。</li><li><code>Copying to tmp table on disk</code>:把内存中临时表复制到磁盘上，警惕!</li><li><code>locked</code> 。</li></ul> 
<p>如果在show profile诊断结果中出现了以上4条结果中的任何一条，则sql语句需要优化。</p> 
<blockquote> 
 <p>注意:不过SHOW PROFILE 命令将被弃用，我们可以从 information_schema中的profiling数据表进行查看。</p> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2a055719a370342da57ac1edaa714222/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">git 报错： error: src refspec main does not match any；Unable to access ‘https://github.com/xxx/xxxxxx.g</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/588bba4386eb32805af404d2a89d22b4/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">JAVA三大集合（map、list、set）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>