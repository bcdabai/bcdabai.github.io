<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Linux下通过定时任务检测进程并重启 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Linux下通过定时任务检测进程并重启" />
<meta property="og:description" content="一、重启特定进程的脚本 #! /bin/bash ps -ef | grep &#34;进程名字&#34; | grep -v grep #如果进程搜索不出来，则$?的值为1，否则值为0 #当$?值不等于0的时候，重新启动进程 if [ $? -ne 0 ] then cd &#34;进程所在目录&#34; &amp;&amp; &#34;执行进程的语句&#34; else echo &#34;running&#34; fi 二、将上述脚本设置为定时任务 设置定时任务需要用到crontab
crontab [-u username]　//省略用户表表示操作当前用户的crontab -e (编辑工作表) -l (列出工作表里的命令) -r (删除工作作) 用crontab -e进入当前用户的工作表编辑，是常见的vim界面。每行是一条命令。
crontab的命令构成为 时间&#43;动作，其时间有分、时、日、月、周五种，操作符有
取值范围内的所有数字/ 每过多少个数字-从X到Z，散列数字 每五分钟执行 */5 * * * * 每五小时执行 0 */5 * * * 每天执行 0 0 * * * 每周执行 0 0 * * 0 每月执行 0 0 1 * * 每年执行 0 0 1 1 * 三、一些坑 crontab定时任务需要至少有能够执行crontab命令的权限。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/fe9f8762a7557f63a85e7bebfdb96bcf/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-01-04T13:16:22+08:00" />
<meta property="article:modified_time" content="2022-01-04T13:16:22+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Linux下通过定时任务检测进程并重启</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_0"></a>一、重启特定进程的脚本</h3> 
<pre><code class="prism language-bash"><span class="token shebang important">#! /bin/bash</span>
<span class="token function">ps</span> -ef <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">"进程名字"</span> <span class="token operator">|</span> <span class="token function">grep</span> -v <span class="token function">grep</span>
<span class="token comment">#如果进程搜索不出来，则$?的值为1，否则值为0</span>
<span class="token comment">#当$?值不等于0的时候，重新启动进程</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$?</span> -ne <span class="token number">0</span> <span class="token punctuation">]</span>
<span class="token keyword">then</span>
<span class="token builtin class-name">cd</span> <span class="token string">"进程所在目录"</span> <span class="token operator">&amp;&amp;</span> <span class="token string">"执行进程的语句"</span>
<span class="token keyword">else</span>
<span class="token builtin class-name">echo</span> <span class="token string">"running"</span>
<span class="token keyword">fi</span>
</code></pre> 
<h3><a id="_15"></a>二、将上述脚本设置为定时任务</h3> 
<p>设置定时任务需要用到crontab</p> 
<pre><code class="prism language-bash"><span class="token function">crontab</span> <span class="token punctuation">[</span>-u username<span class="token punctuation">]</span>　　　　//省略用户表表示操作当前用户的crontab
    -e      <span class="token punctuation">(</span>编辑工作表<span class="token punctuation">)</span>
    -l      <span class="token punctuation">(</span>列出工作表里的命令<span class="token punctuation">)</span>
    -r      <span class="token punctuation">(</span>删除工作作<span class="token punctuation">)</span>
</code></pre> 
<p>用crontab -e进入当前用户的工作表编辑，是常见的vim界面。每行是一条命令。</p> 
<p>crontab的命令构成为 时间+动作，其时间有分、时、日、月、周五种，操作符有</p> 
<ul><li>取值范围内的所有数字</li><li>/ 每过多少个数字</li><li>-从X到Z</li><li>，散列数字</li></ul> 
<pre><code class="prism language-bash">每五分钟执行     */5 * * * *
每五小时执行     <span class="token number">0</span> */5 * * *
每天执行         <span class="token number">0</span> <span class="token number">0</span> * * *
每周执行         <span class="token number">0</span> <span class="token number">0</span> * * <span class="token number">0</span>
每月执行         <span class="token number">0</span> <span class="token number">0</span> <span class="token number">1</span> * *
每年执行         <span class="token number">0</span> <span class="token number">0</span> <span class="token number">1</span> <span class="token number">1</span> *
</code></pre> 
<h3><a id="_42"></a>三、一些坑</h3> 
<ol><li> <p>crontab定时任务需要至少有能够执行crontab命令的权限。<br> 可以是wheel用户组用户或者root用户组用户。普通用户好像没有执行定时任务的权限。</p> </li><li> <p>crontab定时执行脚本时，没有环境变量的支持<br> 如果脚本中用到一些环境变量，需要将此环境变量在脚本中导入</p> </li><li> <p>crontab执行.sh后缀脚本<br> crontab -e而后编辑定时任务。<br> 格式为 ：<br> 时间 命令<br> 如果命令为执行.sh脚本，则应该这样写：</p> <pre><code class="prism language-bash">/bin/sh 你的脚本位置的全路径（一定要全路径）
</code></pre> </li><li> <p>对脚本内容的要求<br> 定向输入文件要写全路径名，<br> 基本上所有的东西都要写全路径名。<br> 除非导入了PATH环境变量。</p> </li></ol> 
<h3><a id="_61"></a>四、一个例子</h3> 
<p>start.sh</p> 
<pre><code class="prism language-bash"><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token number">1</span> -ne <span class="token number">2</span> <span class="token punctuation">]</span>
<span class="token keyword">then</span>
<span class="token builtin class-name">echo</span> <span class="token string">"不相等"</span> <span class="token operator">&gt;&gt;</span> /home/wat/test/log.txt
<span class="token keyword">else</span>
<span class="token builtin class-name">echo</span> <span class="token string">"相等"</span> <span class="token operator">&gt;&gt;</span> /home/wat/test/log.txt
<span class="token keyword">fi</span>
</code></pre> 
<p>crontab -e</p> 
<pre><code class="prism language-bash"><span class="token comment">#开机自启动任务</span>
@reboot /bin/sh /home/wat/test/start.sh

<span class="token comment">#每分钟执行一次start.sh脚本</span>
* * * * * /bin/sh /home/wat/test/start.sh
</code></pre> 
<p>在输出文件log.txt中，每过一分钟增加一条记录”不相等“</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/593c6120d9787c4d1dbd3caa06c72cbd/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">软件测试之测试理论(一)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/89b6830b0b920032b01a14ca1496b091/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Oracle11g 数据库详细完整卸载步骤图解</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>