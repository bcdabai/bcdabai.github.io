<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Django3&#43;Vue Million商城项目的总结 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Django3&#43;Vue Million商城项目的总结" />
<meta property="og:description" content="文章目录 项目说明主要环境搭建主要技术实现django 的配置文件celery的使用（异步发送短信验证码和邮箱验证链接）容联云通讯短信平台QQ登录jwt实现加密解密验证实现数据的安全性FastDFS&#43;Docker实现图片数据的展示FastDFSDockerDocker安装运行FastDFS git推送项目到gitee上uwsgi部署 项目成品遇到的问题总结 项目说明 概述： Million商城是一个基于django3&#43;vue前后端的网页电子商城项目
主要技术：Django3&#43;Vue&#43;MySQL&#43;Redis&#43;Celery&#43;FastDFS&#43;Docker&#43;Elasticsearch&#43;Crontab&#43;jwt&#43;git
主要负责：后端逻辑业务的实现
功能模块：
验证： 图形验证、短信验证
用户： 注册、登录、用户中心（基本信息、邮箱激活、收货地址、我的订单、修改密码）
第三方登录： QQ登录
首页广告： 首页广告
商品： 商品列表、商品搜索、商品详情、商品浏览记录
购物车： 购物车管理、购物车合并
订单 ：确认订单、提交订单、订单商品评价
支付 ：支付宝支付
MIS系统： 数据统计、用户管理、权限管理、商品管理、订单管理
主要环境搭建 1、安装Ubuntu20.04
2、python3.8
3、mysql8.0
4、django3.2
5、创建一个虚拟环境
主要技术实现 django 的配置文件 settings.py
&#34;&#34;&#34; Django settings for MeiDuoMall project. Generated by &#39;django-admin startproject&#39; using Django 3.2.9. For more information on this file, see https://docs.djangoproject.com/en/3.2/topics/settings/ For the full list of settings and their values, see https://docs." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/93ef100c51514ff70d266010860d5a9c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-22T22:57:16+08:00" />
<meta property="article:modified_time" content="2023-02-22T22:57:16+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Django3&#43;Vue Million商城项目的总结</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_1" rel="nofollow">项目说明</a></li><li><a href="#_16" rel="nofollow">主要环境搭建</a></li><li><a href="#_23" rel="nofollow">主要技术实现</a></li><li><ul><li><a href="#django__24" rel="nofollow">django 的配置文件</a></li><li><a href="#celery_329" rel="nofollow">celery的使用（异步发送短信验证码和邮箱验证链接）</a></li><li><a href="#_374" rel="nofollow">容联云通讯短信平台</a></li><li><a href="#QQ_380" rel="nofollow">QQ登录</a></li><li><a href="#jwt_384" rel="nofollow">jwt实现加密解密验证实现数据的安全性</a></li><li><a href="#FastDFSDocker_473" rel="nofollow">FastDFS+Docker实现图片数据的展示</a></li><li><ul><li><a href="#FastDFS_474" rel="nofollow">FastDFS</a></li><li><a href="#Docker_504" rel="nofollow">Docker</a></li><li><a href="#DockerFastDFS_647" rel="nofollow">Docker安装运行FastDFS</a></li></ul> 
   </li><li><a href="#gitgitee_841" rel="nofollow">git推送项目到gitee上</a></li><li><a href="#uwsgi_846" rel="nofollow">uwsgi部署</a></li></ul> 
  </li><li><a href="#_887" rel="nofollow">项目成品</a></li><li><a href="#_957" rel="nofollow">遇到的问题</a></li><li><a href="#_997" rel="nofollow">总结</a></li></ul> 
</div> 
<p></p> 
<h2><a id="_1"></a>项目说明</h2> 
<blockquote> 
 <p>概述： Million商城是一个基于django3+vue前后端的网页电子商城项目<br> 主要技术：Django3+Vue+MySQL+Redis+Celery+FastDFS+Docker+Elasticsearch+Crontab+jwt+git<br> 主要负责：后端逻辑业务的实现<br> 功能模块：<br> 验证： 图形验证、短信验证<br> 用户： 注册、登录、用户中心（基本信息、邮箱激活、收货地址、我的订单、修改密码）<br> 第三方登录： QQ登录<br> 首页广告： 首页广告<br> 商品： 商品列表、商品搜索、商品详情、商品浏览记录<br> 购物车： 购物车管理、购物车合并<br> 订单 ：确认订单、提交订单、订单商品评价<br> 支付 ：支付宝支付<br> MIS系统： 数据统计、用户管理、权限管理、商品管理、订单管理</p> 
</blockquote> 
<h2><a id="_16"></a>主要环境搭建</h2> 
<p>1、安装Ubuntu20.04<br> 2、python3.8<br> 3、mysql8.0<br> 4、django3.2<br> 5、创建一个虚拟环境</p> 
<h2><a id="_23"></a>主要技术实现</h2> 
<h3><a id="django__24"></a>django 的配置文件</h3> 
<p>settings.py</p> 
<pre><code class="prism language-python"><span class="token triple-quoted-string string">"""
Django settings for MeiDuoMall project.

Generated by 'django-admin startproject' using Django 3.2.9.

For more information on this file, see
https://docs.djangoproject.com/en/3.2/topics/settings/

For the full list of settings and their values, see
https://docs.djangoproject.com/en/3.2/ref/settings/
"""</span>
<span class="token keyword">import</span> os
<span class="token keyword">from</span> pathlib <span class="token keyword">import</span> Path

<span class="token comment"># Build paths inside the project like this: BASE_DIR / 'subdir'.</span>
BASE_DIR <span class="token operator">=</span> Path<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">.</span>resolve<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>parent<span class="token punctuation">.</span>parent

<span class="token comment"># Quick-start development settings - unsuitable for production</span>
<span class="token comment"># See https://docs.djangoproject.com/en/3.2/howto/deployment/checklist/</span>

<span class="token comment"># SECURITY WARNING: keep the secret key used in production secret!</span>
SECRET_KEY <span class="token operator">=</span> <span class="token string">'django-insecure-@^-w9%jg)^mmc=a!8d^67gukvdshk#lkrt-q$!9^ah#0x0fzoa'</span>

<span class="token comment"># SECURITY WARNING: don't run with debug turned on in production!</span>
DEBUG <span class="token operator">=</span> <span class="token boolean">True</span>

<span class="token comment"># 配置浏览的网址及ip地址</span>
ALLOWED_HOSTS <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'www.meiduo.site'</span><span class="token punctuation">,</span> <span class="token string">'127.0.0.1'</span><span class="token punctuation">]</span>

<span class="token comment"># 指定本项目用户模型类</span>
AUTH_USER_MODEL <span class="token operator">=</span> <span class="token string">'users.User'</span>

<span class="token comment"># Application definition</span>

INSTALLED_APPS <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">'django.contrib.admin'</span><span class="token punctuation">,</span>
    <span class="token string">'django.contrib.auth'</span><span class="token punctuation">,</span>
    <span class="token string">'django.contrib.contenttypes'</span><span class="token punctuation">,</span>
    <span class="token string">'django.contrib.sessions'</span><span class="token punctuation">,</span>
    <span class="token string">'django.contrib.messages'</span><span class="token punctuation">,</span>
    <span class="token string">'django.contrib.staticfiles'</span><span class="token punctuation">,</span>
    <span class="token string">'corsheaders'</span><span class="token punctuation">,</span>  <span class="token comment"># 允许CORS跨域资源访问</span>
    <span class="token string">'apps.users'</span><span class="token punctuation">,</span>
    <span class="token string">'apps.verifications'</span><span class="token punctuation">,</span>
    <span class="token string">'apps.oauth'</span><span class="token punctuation">,</span>
    <span class="token string">'apps.areas'</span><span class="token punctuation">,</span>
    <span class="token string">'apps.contents'</span><span class="token punctuation">,</span>
    <span class="token string">'apps.goods'</span><span class="token punctuation">,</span>
    <span class="token string">'apps.carts'</span><span class="token punctuation">,</span>
    <span class="token string">'apps.orders'</span><span class="token punctuation">,</span>
    <span class="token string">'apps.payment'</span><span class="token punctuation">,</span>
    <span class="token string">'haystack'</span><span class="token punctuation">,</span>  <span class="token comment"># 全文检索</span>
    <span class="token string">'django_crontab'</span><span class="token punctuation">,</span>  <span class="token comment"># 定时任务</span>
<span class="token punctuation">]</span>

MIDDLEWARE <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">'django.middleware.security.SecurityMiddleware'</span><span class="token punctuation">,</span>
    <span class="token string">'django.contrib.sessions.middleware.SessionMiddleware'</span><span class="token punctuation">,</span>
    <span class="token string">'django.middleware.common.CommonMiddleware'</span><span class="token punctuation">,</span>
    <span class="token comment"># 'django.middleware.csrf.CsrfViewMiddleware',  # 注释掉防止csrf</span>
    <span class="token string">'django.contrib.auth.middleware.AuthenticationMiddleware'</span><span class="token punctuation">,</span>
    <span class="token string">'django.contrib.messages.middleware.MessageMiddleware'</span><span class="token punctuation">,</span>
    <span class="token string">'django.middleware.clickjacking.XFrameOptionsMiddleware'</span><span class="token punctuation">,</span>
    <span class="token string">'corsheaders.middleware.CorsMiddleware'</span><span class="token punctuation">,</span>  <span class="token comment"># 允许CORS跨域访问中间件</span>
<span class="token punctuation">]</span>

ROOT_URLCONF <span class="token operator">=</span> <span class="token string">'MeiDuoMall.urls'</span>

TEMPLATES <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token string">'BACKEND'</span><span class="token punctuation">:</span> <span class="token string">'django.template.backends.django.DjangoTemplates'</span><span class="token punctuation">,</span>
        <span class="token string">'DIRS'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>BASE_DIR<span class="token punctuation">,</span> <span class="token string">'templates'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'APP_DIRS'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span>
        <span class="token string">'OPTIONS'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">'context_processors'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
                <span class="token string">'django.template.context_processors.debug'</span><span class="token punctuation">,</span>
                <span class="token string">'django.template.context_processors.request'</span><span class="token punctuation">,</span>
                <span class="token string">'django.contrib.auth.context_processors.auth'</span><span class="token punctuation">,</span>
                <span class="token string">'django.contrib.messages.context_processors.messages'</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>

WSGI_APPLICATION <span class="token operator">=</span> <span class="token string">'MeiDuoMall.wsgi.application'</span>

<span class="token comment"># Database</span>
<span class="token comment"># https://docs.djangoproject.com/en/3.2/ref/settings/#databases</span>

DATABASES <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'default'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">'ENGINE'</span><span class="token punctuation">:</span> <span class="token string">'django.db.backends.mysql'</span><span class="token punctuation">,</span>
        <span class="token string">'NAME'</span><span class="token punctuation">:</span> <span class="token string">'meiduo_mall'</span><span class="token punctuation">,</span>
        <span class="token string">'USER'</span><span class="token punctuation">:</span> <span class="token string">'root'</span><span class="token punctuation">,</span>
        <span class="token string">'PASSWORD'</span><span class="token punctuation">:</span> <span class="token string">'20000716'</span><span class="token punctuation">,</span>
        <span class="token string">'HOST'</span><span class="token punctuation">:</span> <span class="token string">'localhost'</span><span class="token punctuation">,</span>
        <span class="token string">'PORT'</span><span class="token punctuation">:</span> <span class="token number">3306</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment"># Password validation</span>
<span class="token comment"># https://docs.djangoproject.com/en/3.2/ref/settings/#auth-password-validators</span>

AUTH_PASSWORD_VALIDATORS <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token string">'NAME'</span><span class="token punctuation">:</span> <span class="token string">'django.contrib.auth.password_validation.UserAttributeSimilarityValidator'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token string">'NAME'</span><span class="token punctuation">:</span> <span class="token string">'django.contrib.auth.password_validation.MinimumLengthValidator'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token string">'NAME'</span><span class="token punctuation">:</span> <span class="token string">'django.contrib.auth.password_validation.CommonPasswordValidator'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token string">'NAME'</span><span class="token punctuation">:</span> <span class="token string">'django.contrib.auth.password_validation.NumericPasswordValidator'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>

<span class="token comment"># Internationalization</span>
<span class="token comment"># https://docs.djangoproject.com/en/3.2/topics/i18n/</span>

LANGUAGE_CODE <span class="token operator">=</span> <span class="token string">'zh-hans'</span>

TIME_ZONE <span class="token operator">=</span> <span class="token string">'Asia/Shanghai'</span>

USE_I18N <span class="token operator">=</span> <span class="token boolean">True</span>

USE_L10N <span class="token operator">=</span> <span class="token boolean">True</span>

USE_TZ <span class="token operator">=</span> <span class="token boolean">True</span>

<span class="token comment"># Static files (CSS, JavaScript, Images)</span>
<span class="token comment"># https://docs.djangoproject.com/en/3.2/howto/static-files/</span>

STATIC_URL <span class="token operator">=</span> <span class="token string">'/static/'</span>

<span class="token comment"># Default primary key field type</span>
<span class="token comment"># https://docs.djangoproject.com/en/3.2/ref/settings/#default-auto-field</span>

DEFAULT_AUTO_FIELD <span class="token operator">=</span> <span class="token string">'django.db.models.BigAutoField'</span>

<span class="token comment"># django-redis配置</span>
CACHES <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"default"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment"># 默认， 预留</span>
        <span class="token string">"BACKEND"</span><span class="token punctuation">:</span> <span class="token string">"django_redis.cache.RedisCache"</span><span class="token punctuation">,</span>
        <span class="token string">"LOCATION"</span><span class="token punctuation">:</span> <span class="token string">"redis://127.0.0.1:6379/0"</span><span class="token punctuation">,</span>
        <span class="token string">"OPTIONS"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"CLIENT_CLASS"</span><span class="token punctuation">:</span> <span class="token string">"django_redis.client.DefaultClient"</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">"session"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment"># 调用于session存储</span>
        <span class="token string">"BACKEND"</span><span class="token punctuation">:</span> <span class="token string">"django_redis.cache.RedisCache"</span><span class="token punctuation">,</span>
        <span class="token string">"LOCATION"</span><span class="token punctuation">:</span> <span class="token string">"redis://127.0.0.1:6379/1"</span><span class="token punctuation">,</span>
        <span class="token string">"OPTIONS"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"CLIENT_CLASS"</span><span class="token punctuation">:</span> <span class="token string">"django_redis.client.DefaultClient"</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">"code"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment"># 验证码</span>
            <span class="token string">"BACKEND"</span><span class="token punctuation">:</span> <span class="token string">"django_redis.cache.RedisCache"</span><span class="token punctuation">,</span>
            <span class="token string">"LOCATION"</span><span class="token punctuation">:</span> <span class="token string">"redis://127.0.0.1:6379/2"</span><span class="token punctuation">,</span>
            <span class="token string">"OPTIONS"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"CLIENT_CLASS"</span><span class="token punctuation">:</span> <span class="token string">"django_redis.client.DefaultClient"</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">"history"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment"># 用户浏览记录</span>
        <span class="token string">"BACKEND"</span><span class="token punctuation">:</span> <span class="token string">"django_redis.cache.RedisCache"</span><span class="token punctuation">,</span>
        <span class="token string">"LOCATION"</span><span class="token punctuation">:</span> <span class="token string">"redis://127.0.0.1:6379/3"</span><span class="token punctuation">,</span>
        <span class="token string">"OPTIONS"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"CLIENT_CLASS"</span><span class="token punctuation">:</span> <span class="token string">"django_redis.client.DefaultClient"</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">"carts"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"BACKEND"</span><span class="token punctuation">:</span> <span class="token string">"django_redis.cache.RedisCache"</span><span class="token punctuation">,</span>
        <span class="token string">"LOCATION"</span><span class="token punctuation">:</span> <span class="token string">"redis://127.0.0.1:6379/4"</span><span class="token punctuation">,</span>
        <span class="token string">"OPTIONS"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"CLIENT_CLASS"</span><span class="token punctuation">:</span> <span class="token string">"django_redis.client.DefaultClient"</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment"># 配置session存储</span>
SESSION_ENGINE <span class="token operator">=</span> <span class="token string">"django.contrib.sessions.backends.cache"</span>
SESSION_CACHE_ALTAS <span class="token operator">=</span> <span class="token string">"session"</span>

<span class="token comment"># 配置日志文件</span>
LOGGING <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'version'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token string">'disable_existing_loggers'</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">,</span>  <span class="token comment"># 是否禁用已经存在的日志器</span>
    <span class="token string">'formatters'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment"># 日志信息显示的格式</span>
        <span class="token string">'verbose'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">'format'</span><span class="token punctuation">:</span> <span class="token string">'%(levelname)s %(asctime)s %(module)s %(lineno)d %(message)s'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">'simple'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">'format'</span><span class="token punctuation">:</span> <span class="token string">'%(levelname)s %(module)s %(lineno)d %(message)s'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">'filters'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment"># 对日志进行过滤</span>
        <span class="token string">'require_debug_true'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment"># django在debug模式下才输出日志</span>
            <span class="token string">'()'</span><span class="token punctuation">:</span> <span class="token string">'django.utils.log.RequireDebugTrue'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">'handlers'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment"># 日志处理方法</span>
        <span class="token string">'console'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment"># 向终端中输出日志</span>
            <span class="token string">'level'</span><span class="token punctuation">:</span> <span class="token string">'INFO'</span><span class="token punctuation">,</span>
            <span class="token string">'filters'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'require_debug_true'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">'class'</span><span class="token punctuation">:</span> <span class="token string">'logging.StreamHandler'</span><span class="token punctuation">,</span>
            <span class="token string">'formatter'</span><span class="token punctuation">:</span> <span class="token string">'simple'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">'file'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment"># 向文件中输出日志</span>
            <span class="token string">'level'</span><span class="token punctuation">:</span> <span class="token string">'INFO'</span><span class="token punctuation">,</span>
            <span class="token string">'class'</span><span class="token punctuation">:</span> <span class="token string">'logging.handlers.RotatingFileHandler'</span><span class="token punctuation">,</span>
            <span class="token string">'filename'</span><span class="token punctuation">:</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>BASE_DIR<span class="token punctuation">,</span> <span class="token string">'logs/meiduo.log'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># 日志文件的位置</span>
            <span class="token string">'maxBytes'</span><span class="token punctuation">:</span> <span class="token number">300</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">,</span>
            <span class="token string">'backupCount'</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token string">'formatter'</span><span class="token punctuation">:</span> <span class="token string">'verbose'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">'loggers'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment"># 日志器</span>
        <span class="token string">'django'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment"># 定义了一个名为django的日志器</span>
            <span class="token string">'handlers'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'console'</span><span class="token punctuation">,</span> <span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># 可以同时向终端与文件中输出日志</span>
            <span class="token string">'propagate'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span>  <span class="token comment"># 是否继续传递日志信息</span>
            <span class="token string">'level'</span><span class="token punctuation">:</span> <span class="token string">'INFO'</span><span class="token punctuation">,</span>  <span class="token comment"># 日志器接收的最低日志级别</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment"># CORS</span>
CORS_ORIGIN_WHITELIST <span class="token operator">=</span> <span class="token punctuation">(</span>
    <span class="token string">'http://127.0.0.1:8080'</span><span class="token punctuation">,</span>
    <span class="token string">'http://localhost:8080'</span><span class="token punctuation">,</span>
    <span class="token string">'http://www.meiduo.site:8080'</span><span class="token punctuation">,</span>
    <span class="token string">'http://www.meiduo.site:8000'</span>
<span class="token punctuation">)</span>
CORS_ALLOW_CREDENTIALS <span class="token operator">=</span> <span class="token boolean">True</span>  <span class="token comment"># 允许携带cookie</span>

<span class="token comment"># QQ登录参数</span>
<span class="token comment"># 我们申请的 客户端id</span>
QQ_CLIENT_ID <span class="token operator">=</span> <span class="token string">'101474184'</span>
<span class="token comment"># 我们申请的 客户端秘钥</span>
QQ_CLIENT_SECRET <span class="token operator">=</span> <span class="token string">'c6ce949e04e12ecc909ae6a8b09b637c'</span>
<span class="token comment"># 我们申请时添加的: 登录成功后回调的路径</span>
QQ_REDIRECT_URI <span class="token operator">=</span> <span class="token string">'http://www.meiduo.site:8080/oauth_callback.html'</span>

<span class="token comment"># 配置邮箱服务器</span>
EMAIL_BACKEND <span class="token operator">=</span> <span class="token string">'django.core.mail.backends.smtp.EmailBackend'</span>
EMAIL_HOST <span class="token operator">=</span> <span class="token string">'smtp.163.com'</span>
EMAIL_PORT <span class="token operator">=</span> <span class="token number">25</span>
<span class="token comment"># 发送邮件的邮箱</span>
EMAIL_HOST_USER <span class="token operator">=</span> <span class="token string">'xcl20001109@163.com'</span>
<span class="token comment"># 在邮箱中设置的客户端授权密码</span>
<span class="token comment"># 授权码：JAKIIADAWRQPRODG</span>
EMAIL_HOST_PASSWORD <span class="token operator">=</span> <span class="token string">'JAKIIADAWRQPRODG'</span>
<span class="token comment"># 收件人看到的发件人</span>
EMAIL_FROM <span class="token operator">=</span> <span class="token string">'美多商城&lt;xcl20001109@163.com&gt;'</span>
<span class="token comment"># 邮箱验证链接</span>
EMAIL_VERIFY_URL <span class="token operator">=</span> <span class="token string">'http://www.meiduo.site:8080/success_verify_email.html'</span>

<span class="token comment"># 指定自定义的Django文件存储类</span>
DEFAULT_FILE_STORAGE <span class="token operator">=</span> <span class="token string">'utils.fastdfs.storage.FastDFSStorage'</span>

<span class="token comment"># FastDFS相关参数</span>
<span class="token comment"># FDFS_BASE_URL = 'http://192.168.103.158:8888/'</span>
FDFS_BASE_URL <span class="token operator">=</span> <span class="token string">'http://192.168.42.130:8888/'</span>

<span class="token comment"># Haystack</span>
<span class="token comment"># Haystack</span>
HAYSTACK_CONNECTIONS <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'default'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">'ENGINE'</span><span class="token punctuation">:</span> <span class="token string">'haystack.backends.elasticsearch_backend.ElasticsearchSearchEngine'</span><span class="token punctuation">,</span>
        <span class="token string">'URL'</span><span class="token punctuation">:</span> <span class="token string">'http://192.168.42.130:9200/'</span><span class="token punctuation">,</span>  <span class="token comment"># Elasticsearch服务器ip地址，端口号固定为9200</span>
        <span class="token string">'INDEX_NAME'</span><span class="token punctuation">:</span> <span class="token string">'meiduo_mall'</span><span class="token punctuation">,</span>  <span class="token comment"># Elasticsearch建立的索引库的名称</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment"># 当添加、修改、删除数据时，自动生成索引</span>
<span class="token comment"># HAYSTACK_SIGNAL_PROCESSOR = 'haystack.signals.RealtimeSignalProcessor'</span>

<span class="token comment"># 设置搜索后每页展示的数据量</span>
HAYSTACK_SEARCH_RESULTS_PER_PAGE <span class="token operator">=</span> <span class="token number">5</span>

<span class="token comment"># 定时任务</span>
CRONJOBS <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token comment"># 每1分钟生成一次首页静态文件</span>
    <span class="token punctuation">(</span><span class="token string">'*/1 * * * *'</span><span class="token punctuation">,</span> <span class="token string">'apps.contents.crons.generate_static_index_html'</span><span class="token punctuation">,</span> <span class="token string">'&gt;&gt; '</span> <span class="token operator">+</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>BASE_DIR<span class="token punctuation">,</span> <span class="token string">'logs/crontab.log'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>

<span class="token comment"># 用于解决在定时任务中，如果出现非英文字符，会出现字符异常错误</span>
CRONTAB_COMMAND_PREFIX <span class="token operator">=</span> <span class="token string">'LANG_ALL=zh_cn.UTF-8'</span>


<span class="token comment"># 支付宝SDK参数配置</span>
ALIPAY_APPID <span class="token operator">=</span> <span class="token string">'2021000121646967'</span>
ALIPAY_DEBUG <span class="token operator">=</span> <span class="token boolean">True</span>
ALIPAY_URL <span class="token operator">=</span> <span class="token string">'https://openapi.alipaydev.com/gateway.do'</span>
ALIPAY_RETURN_URL <span class="token operator">=</span> <span class="token string">'http://www.meiduo.site:8080/pay_success.html'</span>
APP_PRIVATE_KEY_PATH <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>BASE_DIR<span class="token punctuation">,</span> <span class="token string">'apps/payment/keys/app_private_key.pem'</span><span class="token punctuation">)</span>
ALIPAY_PUBLIC_KEY_PATH <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>BASE_DIR<span class="token punctuation">,</span> <span class="token string">'apps/payment/keys/alipay_public_key.pem'</span><span class="token punctuation">)</span>


</code></pre> 
<h3><a id="celery_329"></a>celery的使用（异步发送短信验证码和邮箱验证链接）</h3> 
<p>Celery介绍：</p> 
<blockquote> 
 <p>一个简单、灵活且可靠、处理大量消息的分布式系统，可以在一台或者多台机器上运行。<br> Celery是一个功能完备即插即用的任务队列<br> 单个 Celery 进程每分钟可处理数以百万计的任务。<br> 通过消息进行通信，使用消息队列（broker）在客户端和消费者之间进行协调。</p> 
</blockquote> 
<p>安装Celery：<code>pip install -U Celery</code></p> 
<p><a href="https://docs.celeryq.dev/en/latest/index.html" rel="nofollow">Celery官方文档</a></p> 
<p><em><strong>主要文件main.py</strong></em></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> os
<span class="token keyword">import</span> sys
<span class="token comment"># 用于解决终端报错：from libs.yuntongxun.yuntongxun.sms import CCP</span>
<span class="token comment"># 并且这句话不能加在sms中的tasks.py文件里，否则发送短信时会直接调用yuntongxun里的sms里的send_template_sms方法</span>
sys<span class="token punctuation">.</span>path<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">'/home/mm0716/Desktop/python/meiduomall/meiduo_mall/MeiDuoMall'</span><span class="token punctuation">)</span>
<span class="token keyword">import</span> logging
<span class="token keyword">from</span> celery <span class="token keyword">import</span> Celery

<span class="token comment"># 配置celery在django中的运行环境</span>
os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span><span class="token string">'DJANGO_SETTING_MODULE'</span><span class="token punctuation">,</span> <span class="token string">'MeiDuoMall.settings'</span><span class="token punctuation">)</span>
<span class="token comment"># 创建celery实例对象</span>
celery_app <span class="token operator">=</span> Celery<span class="token punctuation">(</span><span class="token string">'celery_tasks'</span><span class="token punctuation">)</span>
<span class="token comment"># 添加celery配置</span>
celery_app<span class="token punctuation">.</span>config_from_object<span class="token punctuation">(</span><span class="token string">'celery_tasks.config'</span><span class="token punctuation">)</span>
<span class="token comment"># 自动注册任务</span>
celery_app<span class="token punctuation">.</span>autodiscover_tasks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'celery_tasks.sms'</span><span class="token punctuation">,</span> <span class="token string">'celery_tasks.email'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

</code></pre> 
<p><em><strong>配置文件config.py</strong></em></p> 
<pre><code class="prism language-python"><span class="token comment"># 将任务存储在Redis3号库</span>
broker_url <span class="token operator">=</span> <span class="token string">'redis://127.0.0.1:6379/3'</span>
</code></pre> 
<p><strong>使用方法：</strong><br> 1、在项目根目录下创建一个celery_tasks文件夹，用于存放main.py, config.py文件，以及每个要执行异步任务的文件夹<br> 2、在celery_tasks下创建任务文件夹，每个任务文件夹下创建一个tasks.py文件用于书写要执行的任务<br> 3、在main.py里注册任务<br> 4、在celery_tasks文件夹所在的文件夹开启celery服务：命令行输入命令：<code>celery -A celery_tasks.main worker -l info</code></p> 
<h3><a id="_374"></a>容联云通讯短信平台</h3> 
<blockquote> 
 <p>用于发送短信验证码</p> 
</blockquote> 
<p>查看官方文档实现接入<br> 容联云通讯网址： <a href="https://www.yuntongxun.com/" rel="nofollow">https://www.yuntongxun.com/</a></p> 
<h3><a id="QQ_380"></a>QQ登录</h3> 
<p>官方文档实现接入<br> <a href="http://wiki.connect.qq.com/%E6%88%90%E4%B8%BA%E5%BC%80%E5%8F%91%E8%80%85" rel="nofollow">http://wiki.connect.qq.com/%E6%88%90%E4%B8%BA%E5%BC%80%E5%8F%91%E8%80%85</a></p> 
<h3><a id="jwt_384"></a>jwt实现加密解密验证实现数据的安全性</h3> 
<blockquote> 
 <p>用于qq登录的回调验证和邮箱激活链接的验证<br> 导入authlib包：<code>pip install authlib</code><br> 项目中实现jwt的文件<br> token.py</p> 
</blockquote> 
<pre><code class="prism language-python"><span class="token keyword">from</span> authlib<span class="token punctuation">.</span>jose <span class="token keyword">import</span> jwt<span class="token punctuation">,</span> JoseError

<span class="token keyword">from</span> apps<span class="token punctuation">.</span>users<span class="token punctuation">.</span>models <span class="token keyword">import</span> User
<span class="token keyword">from</span> MeiDuoMall <span class="token keyword">import</span> settings


<span class="token comment"># 用于生成加密后的token</span>
<span class="token keyword">def</span> <span class="token function">generate_access_token</span><span class="token punctuation">(</span>openid<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    openid： 用户的签名
    return： access_token
    """</span>
    <span class="token comment"># 使用authlib加密的算法</span>
    header <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'alg'</span><span class="token punctuation">:</span> <span class="token string">'HS256'</span><span class="token punctuation">}</span>
    <span class="token comment"># 用于加密的salt</span>
    key <span class="token operator">=</span> settings<span class="token punctuation">.</span>SECRET_KEY
    <span class="token comment"># 需要加密的对象</span>
    data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'openid'</span><span class="token punctuation">:</span> openid<span class="token punctuation">}</span>
    access_token <span class="token operator">=</span> jwt<span class="token punctuation">.</span>encode<span class="token punctuation">(</span>header<span class="token operator">=</span>header<span class="token punctuation">,</span> key<span class="token operator">=</span>key<span class="token punctuation">,</span> payload<span class="token operator">=</span>data<span class="token punctuation">)</span>
    <span class="token keyword">return</span> access_token<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token comment"># 用于检查token是否正确</span>
<span class="token keyword">def</span> <span class="token function">check_access_token</span><span class="token punctuation">(</span>access_token<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""用于验证token是否正确"""</span>
    <span class="token comment"># salt与加密时用的一致</span>
    key <span class="token operator">=</span> settings<span class="token punctuation">.</span>SECRET_KEY
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token comment"># 解密验证</span>
        data <span class="token operator">=</span> jwt<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>access_token<span class="token punctuation">,</span> key<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token keyword">except</span> JoseError<span class="token punctuation">:</span>
        <span class="token comment"># 解密失败即token不正确</span>
        <span class="token keyword">return</span> <span class="token boolean">None</span>
    <span class="token comment"># 验证正确返回openid</span>
    <span class="token keyword">return</span> data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'openid'</span><span class="token punctuation">)</span>


<span class="token comment"># 生成邮箱验证链接</span>
<span class="token keyword">def</span> <span class="token function">generate_verify_email_url</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    user: 当前登录用户
    return verify_url
    """</span>
    <span class="token comment"># 用于生成token的算法</span>
    header <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'alg'</span><span class="token punctuation">:</span> <span class="token string">'HS256'</span><span class="token punctuation">}</span>
    <span class="token comment"># salt</span>
    key <span class="token operator">=</span> settings<span class="token punctuation">.</span>SECRET_KEY
    <span class="token comment"># 用于加密的数据</span>
    data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'user_id'</span><span class="token punctuation">:</span> user<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">,</span> <span class="token string">'email'</span><span class="token punctuation">:</span> user<span class="token punctuation">.</span>email<span class="token punctuation">}</span>
    token <span class="token operator">=</span> jwt<span class="token punctuation">.</span>encode<span class="token punctuation">(</span>header<span class="token operator">=</span>header<span class="token punctuation">,</span> key<span class="token operator">=</span>key<span class="token punctuation">,</span> payload<span class="token operator">=</span>data<span class="token punctuation">)</span>
    verify_url <span class="token operator">=</span> settings<span class="token punctuation">.</span>EMAIL_VERIFY_URL <span class="token operator">+</span> <span class="token string">'?token='</span> <span class="token operator">+</span> token<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> verify_url


<span class="token comment"># 校验邮箱验证链接里的token</span>
<span class="token keyword">def</span> <span class="token function">check_verify_email_url</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    token: 加密后的数据
    return user
    """</span>
    <span class="token comment"># salt</span>
    key <span class="token operator">=</span> settings<span class="token punctuation">.</span>SECRET_KEY
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token comment"># 解密token</span>
        data <span class="token operator">=</span> jwt<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>token<span class="token punctuation">,</span> key<span class="token punctuation">)</span>
    <span class="token keyword">except</span> JoseError<span class="token punctuation">:</span>
        <span class="token comment"># token不正确</span>
        <span class="token keyword">return</span> <span class="token boolean">None</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        user_id <span class="token operator">=</span> data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'user_id'</span><span class="token punctuation">)</span>
        email <span class="token operator">=</span> data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'email'</span><span class="token punctuation">)</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token comment"># 获取用户对象</span>
            user <span class="token operator">=</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span>user_id<span class="token punctuation">,</span> email<span class="token operator">=</span>email<span class="token punctuation">)</span>
        <span class="token keyword">except</span> User<span class="token punctuation">.</span>DoesNotExist<span class="token punctuation">:</span>
            <span class="token comment"># 用户不存在</span>
            <span class="token keyword">return</span> <span class="token boolean">None</span>
        <span class="token keyword">return</span> user

</code></pre> 
<h3><a id="FastDFSDocker_473"></a>FastDFS+Docker实现图片数据的展示</h3> 
<h4><a id="FastDFS_474"></a>FastDFS</h4> 
<ol><li>介绍：</li></ol> 
<blockquote> 
 <p>用c语言编写的一款开源的轻量级分布式文件系统。<br> 功能包括：文件存储、文件访问（文件上传、文件下载）、文件同步等，解决了大容量存储和负载均衡的问题。特别适合以文件为载体的在线服务，如相册网站、视频网站等等。<br> 为互联网量身定制，充分考虑了冗余备份、负载均衡、线性扩容等机制，并注重高可用、高性能等指标。<br> 可以帮助我们搭建一套高性能的文件服务器集群，并提供文件上传、下载等服务。<br> <img src="https://images2.imgbox.com/ca/35/w95W8S4e_o.png" alt="在这里插入图片描述"><br> FastDFS架构 包括Client、Tracker server和Storage server。<br> Client请求Tracker进行文件上传、下载，Tracker再调度Storage完成文件上传和下载。<br> Client： 客户端，业务请求的发起方，通过专有接口，使用TCP/IP协议与Tracker或Storage进行数据交互。FastDFS提供了upload、download、delete等接口供客户端使用。<br> Tracker server：跟踪服务器，主要做调度工作，起负载均衡的作用。在内存中记录集群中所有存储组和存储服务器的状态信息，是客户端和数据服务器交互的枢纽。<br> Storage server：存储服务器（存储节点或数据服务器），文件和文件属性都保存到存储服务器上。Storage server直接利用OS的文件系统调用管理文件。<br> Storage群中的横向可以扩容，纵向可以备份。</p> 
</blockquote> 
<ol start="2"><li> <p>FastDFS上传和下载流程<br> <img src="https://images2.imgbox.com/b1/f7/pUW3GtlR_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/a3/52/ZjA1tu91_o.png" alt="在这里插入图片描述"></p> </li><li> <p>FastDFS文件索引</p> 
  <blockquote> 
   <p>FastDFS上传和下载流程可以看出都涉及到一个数据叫文件索引（file_id）。<br> 文件索引（file_id）是客户端上传文件后Storage返回给客户端的一个字符串，是以后访问该文件的索引信息。<br> 文件索引（file_id）信息包括：组名、虚拟磁盘路径、数据两级目录、文件名等信息。<br> 组名：文件上传后所在的 Storage 组名称。<br> 虚拟磁盘路径：Storage 配置的虚拟路径，与磁盘选项store_path*对应。如果配置了store_path0则是M00，如果配置了store_path1则是M01，以此类推。<br> 数据两级目录：Storage 服务器在每个虚拟磁盘路径下创建的两级目录，用于存储数据文件。<br> 文件名：由存储服务器根据特定信息生成，文件名包含:源存储服务器IP地址、文件创建时间戳、文件大小、随机数和文件拓展名等信息。</p> 
  </blockquote> </li></ol> 
<h4><a id="Docker_504"></a>Docker</h4> 
<blockquote> 
 <p>概述：Docker就是一个容器，能够提供一个运行环境，不用自己去搭建许多技术的应用环境，可以直接从docker中拉取想要的环境，来帮助自己完成项目开发。</p> 
</blockquote> 
<ol><li>Docker介绍</li></ol> 
<blockquote> 
 <p>Docker中文社区文档<br> Docker 是一个开源的软件部署解决方案。<br> Docker 也是轻量级的应用容器框架。<br> Docker 可以打包、发布、运行任何的应用。<br> Docker 就像一个盒子，里面可以装很多物件，如果需要某些物件，可以直接将该盒子拿走，而不需要从该盒子中一件一件的取。<br> Docker 是一个客户端-服务端(C/S)架构程序。<br> 客户端只需要向服务端发出请求，服务端处理完请求后会返回结果。<br> Docker 包括三个基本概念:</p> 
</blockquote> 
<ol start="2"><li>镜像（Image）</li></ol> 
<blockquote> 
 <p>Docker的镜像概念类似于虚拟机里的镜像，是一个只读的模板，一个独立的文件系统，包括运行容器所需的数据，可以用来创建新的容器。<br> 例如：一个镜像可以包含一个完整的 ubuntu 操作系统环境，里面仅安装了MySQL或用户需要的其它应用程序。</p> 
</blockquote> 
<ol start="3"><li>容器（Container）</li></ol> 
<blockquote> 
 <p>Docker容器是由Docker镜像创建的运行实例，类似VM虚拟机，支持启动，停止，删除等。<br> 每个容器间是相互隔离的，容器中会运行特定的应用，包含特定应用的代码及所需的依赖文件。<br> 仓库（Repository）<br> Docker的仓库功能类似于Github，是用于托管镜像的</p> 
</blockquote> 
<ol start="4"><li> <p>Docker的操作指令</p> 
  <blockquote> 
   <p>安装完成Docker后，默认已经启动了docker服务。</p> 
  </blockquote> 
  <ul><li>启动docker<code>sudo service docker start</code></li><li>重启docker<code>sudo service docker restart</code></li><li>停止docker<code>sudo service docker stop</code></li></ul> <p><strong>Docker镜像操作</strong><br> 1. 镜像列表</p> <pre><code> $ sudo docker image ls
 
 
 * REPOSITORY：镜像所在的仓库名称 
 * TAG：镜像标签 
 * IMAGEID：镜像ID 
 * CREATED：镜像的创建日期(不是获取该镜像的日期) 
 * SIZE：镜像大小
 2.从仓库拉取镜像
 
 # 官方镜像
 
 $ sudo docker image pull 镜像名称 或者 sudo docker image pull library/镜像名称
 $ sudo docker image pull ubuntu 或者 sudo docker image pull library/ubuntu
 $ sudo docker image pull ubuntu:16.04
 或者 sudo docker image pull library/ubuntu:16.04
 # 个人镜像
 
 $ sudo docker image pull 仓库名称/镜像名称
 $ sudo docker image pull itcast/fastdfs
 
 
 3.删除镜像
 
 $ sudo docker image rm 镜像名或镜像ID
 $ sudo docker image rm hello-world
 $ sudo docker image rm fce289e99eb9
</code></pre> <p><strong>Docker容器操作</strong></p> 
  <ol><li> <p>容器列表</p> <pre><code> # 查看正在运行的容器
 $ sudo docker container ls
 # 查看所有的容器
 $ sudo docker container ls --all		
</code></pre> </li><li> <p>创建容器</p> <pre><code> $ sudo docker run [option] 镜像名 [向启动容器中传入的命令]
 常用可选参数说明：
 * -i 表示以《交互模式》运行容器。
 * -t 表示容器启动后会进入其命令行。加入这两个参数后，容器创建就能登录进去。即分配一个伪终端。
 * --name 为创建的容器命名。
 * -v 表示目录映射关系，即宿主机目录:容器中目录。注意:最好做目录映射，在宿主机上做修改，然后共享到容器上。 
 * -d 会创建一个守护式容器在后台运行(这样创建容器后不会自动登录容器)。 
 * -p 表示端口映射，即宿主机端口:容器中端口。
 * --network=host 表示将主机的网络环境映射到容器中，使容器的网络与主机相同。
</code></pre> </li><li> <p>交互式容器</p> <pre><code> $ sudo docker run -it --name=ubuntu1 ubuntu /bin/bash
 
 
 在容器中可以随意执行linux命令，就是一个ubuntu的环境。
 当执行 exit 命令退出时，该容器随之停止。
</code></pre> </li><li> <p>守护式容器</p> <pre><code> # 开启守护式容器
 
 $ sudo docker run -dit --name=ubuntu2 ubuntu
 
 
 # 进入到容器内部交互环境
 
 $ sudo docker exec -it 容器名或容器id 进入后执行的第一个命令
 $ sudo docker exec -it ubuntu2 /bin/bash
 
 
 如果对于一个需要长期运行的容器来说，我们可以创建一个守护式容器。
 在容器内部执行 exit 命令退出时，该容器也随之停止。
</code></pre> </li><li> <p>停止和启动容器</p> <pre><code> # 停止容器
 
 $ sudo docker container stop 容器名或容器id
 
 # kill掉容器
 
 $ sudo docker container 
 kill 容器名或容器id
 
 # 启动容器
 
 $ sudo docker container start 容器名或容器id
</code></pre> </li><li> <p>删除容器</p> <pre><code> 正在运行的容器无法直接删除。要先停止再删除
 $ sudo docker container rm 容器名或容器id
</code></pre> </li><li> <p>容器制作成镜像</p> <pre><code> 为保证已经配置完成的环境可以重复利用，我们可以将容器制作成镜像。
 # 将容器制作成镜像
 
 $ sudo docker commit 容器名 镜像名
 
 
 # 镜像打包备份
 
 $ sudo docker save -o 保存的文件名 镜像名
 
 
 # 镜像解压
 
 $ sudo docker load -i 文件路径/备份文件
</code></pre> </li></ol> </li></ol> 
<h4><a id="DockerFastDFS_647"></a>Docker安装运行FastDFS</h4> 
<ol><li> <p>获取FastDFS镜像</p> <pre><code> # 从仓库拉取镜像
 $ sudo docker image pull delron/fastdfs
</code></pre> </li><li> <p>开启tracker容器</p> <pre><code> 我们将 tracker 运行目录映射到宿主机的/var/fdfs/tracker目录中。
 $ sudo docker run -dit --name tracker --network=host -v /var/fdfs/tracker:/var/fdfs delron/fastdfs tracker
</code></pre> </li><li> <p>开启storage容器</p> <pre><code> TRACKER_SERVER=Tracker的ip地址:22122（Tracker的ip地址不要使用127.0.0.1）
 我们将 storage 运行目录映射到宿主机的/var/fdfs/storage目录中。
 $ sudo docker run -dti --name storage --network=host -e TRACKER_SERVER=192.168.42.130:22122 -v /var/fdfs/storage:/var/fdfs delron/fastdfs storage
</code></pre> </li><li> <p>查看宿主机映射路径<br> <img src="https://images2.imgbox.com/99/60/TwzuJxsz_o.png" alt="在这里插入图片描述"></p> <pre><code> 注意：如果无法重启storage容器，可以删除/var/fdfs/storage/data目录下的fdfs_storaged.pid文件，然后重新运行storage。
</code></pre> </li><li> <p>安装FastDFS客户端扩展</p> <pre><code> 安装准备好的fdfs_client-py-master.zip到虚拟环境中
 $ pip install fdfs_client-py-master.zip
 $ pip install mutagen
 $ pip install requests	
</code></pre> </li><li> <p>准备FastDFS客户端扩展的配置文件</p> <p>utils.fastdfs.client.conf</p> <pre><code class="prism language-python">	<span class="token comment"># connect timeout in seconds</span>
<span class="token comment"># default value is 30s</span>
connect_timeout<span class="token operator">=</span><span class="token number">30</span>

<span class="token comment"># network timeout in seconds</span>
<span class="token comment"># default value is 30s</span>
network_timeout<span class="token operator">=</span><span class="token number">120</span>

<span class="token comment"># the base path to store log files</span>
base_path<span class="token operator">=</span><span class="token operator">/</span>home<span class="token operator">/</span>mm0716<span class="token operator">/</span>Desktop<span class="token operator">/</span>fastdfs_log<span class="token operator">/</span>

<span class="token comment"># tracker_server can ocur more than once, and tracker_server format is</span>
<span class="token comment">#  "host:port", host can be hostname or ip address</span>
<span class="token comment"># 本机ip</span>
tracker_server<span class="token operator">=</span><span class="token number">192.168</span><span class="token number">.42</span><span class="token number">.130</span><span class="token punctuation">:</span><span class="token number">22122</span>

<span class="token comment">#standard log level as syslog, case insensitive, value list:</span>
<span class="token comment">### emerg for emergency</span>
<span class="token comment">### alert</span>
<span class="token comment">### crit for critical</span>
<span class="token comment">### error</span>
<span class="token comment">### warn for warning</span>
<span class="token comment">### notice</span>
<span class="token comment">### info</span>
<span class="token comment">### debug</span>
log_level<span class="token operator">=</span>info

<span class="token comment"># if use connection pool</span>
<span class="token comment"># default value is false</span>
<span class="token comment"># since V4.05</span>
use_connection_pool <span class="token operator">=</span> false

<span class="token comment"># connections whose the idle time exceeds this time will be closed</span>
<span class="token comment"># unit: second</span>
<span class="token comment"># default value is 3600</span>
<span class="token comment"># since V4.05</span>
connection_pool_max_idle_time <span class="token operator">=</span> <span class="token number">3600</span>

<span class="token comment"># if load FastDFS parameters from tracker server</span>
<span class="token comment"># since V4.05</span>
<span class="token comment"># default value is false</span>
load_fdfs_parameters_from_tracker<span class="token operator">=</span>false

<span class="token comment"># if use storage ID instead of IP address</span>
<span class="token comment"># same as tracker.conf</span>
<span class="token comment"># valid only when load_fdfs_parameters_from_tracker is false</span>
<span class="token comment"># default value is false</span>
<span class="token comment"># since V4.05</span>
use_storage_id <span class="token operator">=</span> false

<span class="token comment"># specify storage ids filename, can use relative or absolute path</span>
<span class="token comment"># same as tracker.conf</span>
<span class="token comment"># valid only when load_fdfs_parameters_from_tracker is false</span>
<span class="token comment"># since V4.05</span>
storage_ids_filename <span class="token operator">=</span> storage_ids<span class="token punctuation">.</span>conf


<span class="token comment">#HTTP settings</span>
http<span class="token punctuation">.</span>tracker_server_port<span class="token operator">=</span><span class="token number">80</span>

<span class="token comment">#use "#include" directive to include HTTP other settiongs</span>
<span class="token comment">##include http.conf</span>

</code></pre> <pre><code> base_path=FastDFS客户端存放日志文件的目录
 tracker_server=运行Tracker服务的机器ip:22122
</code></pre> <p>utils.fastdfs.storage.py</p> <pre><code class="prism language-python"><span class="token triple-quoted-string string">"""
重写Django文件存储类url()方法
自定义的存储类，用于修改查看storage里的文件地址
不进行重写的话前端会进行拼接以至于访问图片的地址出现问题
"""</span>

<span class="token keyword">from</span> django<span class="token punctuation">.</span>core<span class="token punctuation">.</span>files<span class="token punctuation">.</span>storage <span class="token keyword">import</span> Storage
<span class="token keyword">from</span> MeiDuoMall <span class="token keyword">import</span> settings


<span class="token keyword">class</span> <span class="token class-name">FastDFSStorage</span><span class="token punctuation">(</span>Storage<span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token comment"># 自定义必须写这两个</span>
    <span class="token keyword">def</span> <span class="token function">_open</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'rb'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>

    <span class="token keyword">def</span> <span class="token function">_save</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> content<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>

    <span class="token keyword">def</span> <span class="token function">url</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        返回name所指文件的绝对URL
        :param name: 要读取文件的引用:group1/M00/00/00/wKhnnlxw_gmAcoWmAAEXU5wmjPs35.jpeg
        :return: http://192.168.42.130:8888/group1/M00/00/00/wKhnnlxw_gmAcoWmAAEXU5wmjPs35.jpeg
        """</span>
        <span class="token keyword">return</span> settings<span class="token punctuation">.</span>FDFS_BASE_URL <span class="token operator">+</span> name

</code></pre> <p><strong>重写完之后在settings里设置</strong></p> <pre><code class="prism language-python"><span class="token comment"># 指定自定义的Django文件存储类</span>
DEFAULT_FILE_STORAGE <span class="token operator">=</span> <span class="token string">'utils.fastdfs.storage.FastDFSStorage'</span>
</code></pre> </li><li> <p>FastDFS客户端实现文件存储</p> <pre><code> # 使用 shell 进入 Python交互环境
 $ python manage.py shell
 上传文件需要先创建fdfs_client.client.Fdfs_client的对象，并指明配置文件，如
 
 from fdfs_client.client import Fdfs_client
 client = Fdfs_client('utils/fastdfs/client.conf')
 通过创建的客户端对象执行上传文件的方法
 
 client.upload_by_filename(文件名)
 或
 client.upload_by_buffer(文件bytes数据)
 如：
 
 &gt;&gt;&gt; from fdfs_client.client import Fdfs_client
 &gt;&gt;&gt; client=Fdfs_client('utils/fastdfs/client.conf')
 &gt;&gt;&gt; client.upload_by_filename('/home/python/Desktop/images/0.jpg')
 getting connection
 &lt;fdfs_client.connection.Connection object at 0x7f25174eb940&gt;
 &lt;fdfs_client.fdfs_protol.Tracker_header object at 0x7f25174eb908&gt;
 {'Remote file_id': 'group1/M00/00/00/wKjlhFsTgJ2AJvG_AAAyZgOTZN0850.jpg', 'Uploaded size': '12.00KB',
  'Local file name': '/home/python/Desktop/images/0.jpg', 'Storage IP': '192.168.229.132',
   'Group name': 'group1', 'Status': 'Upload successed.'}
</code></pre> 
  <blockquote> 
   <p>‘Group name’: ‘Storage组名’,<br> ‘Remote file_id’: ‘文件索引，可用于下载’,<br> ‘Status’: ‘文件上传结果反馈’,<br> ‘Local file name’: ‘上传文件全路径’,<br> ‘Uploaded size’: ‘文件大小’,<br> ‘Storage IP’: ‘Storage地址’</p> 
  </blockquote> </li><li> <p>浏览器下载并渲染图片<br> 思考：如何才能找到在Storage中存储的图片？</p> <pre><code> 协议：
 http
 IP地址：192.168.42.130
 Nginx服务器的IP地址。
 因为 FastDFS 擅长存储静态文件，但是不擅长提供静态文件的下载服务，所以我们一般会将 Nginx 服务器绑定到 Storage ，提升下载性能。
 端口：8888
 Nginx服务器的端口。
 路径：group1/M00/00/00/wKhnnlxw_gmAcoWmAAEXU5wmjPs35.jpeg
 文件在Storage上的文件索引。
 完整图片下载地址
 http://192.168.42.130:8888/group1/M00/00/00/wKhnnlxw_gmAcoWmAAEXU5wmjPs35.jpeg
</code></pre> </li></ol> 
<h3><a id="gitgitee_841"></a>git推送项目到gitee上</h3> 
<blockquote> 
 <p>完成一个模块退出项目的时候要及时提交并推送，以防虚拟机出现问题，项目整体丢失</p> 
</blockquote> 
<p><a href="https://blog.csdn.net/COOL66BOY/article/details/124214156?spm=1001.2014.3001.5502">git的操作</a></p> 
<h3><a id="uwsgi_846"></a>uwsgi部署</h3> 
<ol><li> <p>安装uwsgi包</p> <pre><code> Django的程序通常使用uwsgi服务器来运行。
 $ pip install uwsgi
</code></pre> </li><li> <p>准备uwsgi服务器配置文件</p> <p>新建MeiDuoMall.uwsgi.ini配置文件</p> <pre><code class="prism language-python"><span class="token punctuation">[</span>uwsgi<span class="token punctuation">]</span>
<span class="token comment"># 使用Nginx连接时使用，Django程序所在服务器地址</span>
<span class="token comment">#socket=172.16.21.25:8001</span>
<span class="token comment"># 直接做web服务器使用，Django程序所在服务器地址</span>
http<span class="token operator">=</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">:</span><span class="token number">8000</span>
<span class="token comment"># 项目目录</span>
chdir<span class="token operator">=</span><span class="token operator">/</span>home<span class="token operator">/</span>mm0716<span class="token operator">/</span>Desktop<span class="token operator">/</span>python<span class="token operator">/</span>meiduomall<span class="token operator">/</span>meiduo_mall<span class="token operator">/</span>MeiDuoMall
<span class="token comment"># 项目中wsgi.py文件的目录，相对于项目目录</span>
wsgi<span class="token operator">-</span><span class="token builtin">file</span><span class="token operator">=</span>MeiDuoMall<span class="token operator">/</span>wsgi<span class="token punctuation">.</span>py
<span class="token comment"># 进程数</span>
processes<span class="token operator">=</span><span class="token number">4</span>
<span class="token comment"># 线程数</span>
threads<span class="token operator">=</span><span class="token number">2</span>
<span class="token comment"># uwsgi服务器的角色</span>
master<span class="token operator">=</span><span class="token boolean">True</span>
<span class="token comment"># 存放进程编号的文件</span>
pidfile<span class="token operator">=</span>uwsgi<span class="token punctuation">.</span>pid
<span class="token comment"># 日志文件</span>
daemonize<span class="token operator">=</span>uwsgi<span class="token punctuation">.</span>log
<span class="token comment"># 指定依赖的虚拟环境(进入到虚拟环境终端输入which python可查看，复制到虚拟环境名之前即可)</span>
virtualenv<span class="token operator">=</span><span class="token operator">/</span>home<span class="token operator">/</span>mm0716<span class="token operator">/</span><span class="token punctuation">.</span>virtualenvs<span class="token operator">/</span>django_worken
</code></pre> </li><li> <p>管理uwsgi服务器</p> <pre><code> # 启动
 $ uwsgi --ini uwsgi.ini
 # 关闭
 $ uwsgi --stop uwsgi.pid
</code></pre> </li></ol> 
<h2><a id="_887"></a>项目成品</h2> 
<blockquote> 
 <p>运行项目：<br> 1、命令：<code>sudo workon django_workon</code>进入到虚拟环境<br> 2、终端命令：<code>sudo redis-server /etc/redis/redis.conf</code>, 开启redis数据<br> 3、去到静态文件目录下：<code>python3 -m http.server 8080</code>, 开启前端服务<br> 4、命令：<br> 实现图片文件的获取：<br> <code>sudo docker container start tracker </code><br> <code>sudo docker container start storage</code><br> 实现搜索功能<br> <code>sudo docker container start Elasticsearch</code><br> 5、在项目目录下：<code>uwsgi --ini uwsgi.ini</code> 启动后端服务</p> 
</blockquote> 
<p>1、首页展示<br> <img src="https://images2.imgbox.com/34/87/HmKkTGvU_o.png" alt=""></p> 
<p>2、注册<br> <img src="https://images2.imgbox.com/c1/30/ApIoYi1e_o.png" alt="在这里插入图片描述"></p> 
<p>在这里插入图片描述</p> 
<p>3、登录<br> <img src="https://images2.imgbox.com/c5/ad/c7ZtYBT4_o.png" alt="在这里插入图片描述"></p> 
<p>4、QQ登录<br> <img src="https://images2.imgbox.com/17/d6/ltt5QUXI_o.png" alt="在这里插入图片描述"></p> 
<p>5、商品列表页<br> <img src="https://images2.imgbox.com/8a/ba/HT7NEAMy_o.png" alt="在这里插入图片描述"></p> 
<p>6、商品详情页<br> <img src="https://images2.imgbox.com/85/4b/UbZCUw8q_o.png" alt="在这里插入图片描述"></p> 
<p>7、用户中心<br> <img src="https://images2.imgbox.com/08/ab/4RS1N5v9_o.png" alt="在这里插入图片描述"></p> 
<p>8、修改地址<br> <img src="https://images2.imgbox.com/8c/9e/ZShg43il_o.png" alt="在这里插入图片描述"></p> 
<p>9、修改密码<br> <img src="https://images2.imgbox.com/0b/b1/VFV28V7o_o.png" alt="在这里插入图片描述"></p> 
<p>10、订单展示<br> <img src="https://images2.imgbox.com/80/a2/MXNj7UuX_o.png" alt="在这里插入图片描述"></p> 
<p>11、购物车<br> <img src="https://images2.imgbox.com/95/ab/eAQstT64_o.png" alt="在这里插入图片描述"></p> 
<p>12、结算页面<br> <img src="https://images2.imgbox.com/94/69/GLh09qtN_o.png" alt="在这里插入图片描述"></p> 
<p>13、支付页面</p> 
<p><img src="https://images2.imgbox.com/35/fe/wdlpQf0M_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_957"></a>遇到的问题</h2> 
<p>1、有时候打开虚拟机，在pycharm完成项目中的一小部分后，按ctrl+k进行提交时会出现Error files的问题</p> 
<blockquote> 
 <p>error: object file .git/objects/31/65329bb680e30595f242b7c4d8406ca63eeab0 is empty</p> 
</blockquote> 
<p>原因：可能是退出pycharm的时候，没有停止项目的运行直接退出，导致git文件出错<br> 解决方法：<a href="https://blog.csdn.net/weixin_34055910/article/details/89065892">https://blog.csdn.net/weixin_34055910/article/details/89065892</a></p> 
<p>这个解决后可能会随之出现的问题：<br> error: invalid object 100644 fdc91c997bd43dddd3eb84094e79b5a681453475 for ‘xxxx’<br> 解决方法：<a href="https://blog.csdn.net/qq_36898054/article/details/121563683">https://blog.csdn.net/qq_36898054/article/details/121563683</a></p> 
<p>2、在创建统计商品访问次数的时候创建模型添加外键报错：<br> Referencing column ‘xx’ and referenced column ‘xx’ in foreign key constraint ‘xxx’ are incompatible.</p> 
<p>原因：自动添加的外键的类型是bigint而对应的外键类型是int，原因是因为当前Django升级到了3.2以上，所以每次使用migrate生成数据库的时候，主键id自动会变成BigInt类型<br> 解决方法: 修改每个表的主键的类型为int(11)</p> 
<pre><code>在每个app的app.py文件里

class GoodsConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'apps.goods'
</code></pre> 
<p>解决方法：修改BigAutoField 为AutoField</p> 
<p>3、俩个问题：<br> 一个是终端运行celery报错没有libs包的问题，另一个是使用pycharm运行django项目进行debug调试<br> 问题及解决方法：<a href="https://blog.csdn.net/COOL66BOY/article/details/126216616?spm=1001.2014.3001.5502">https://blog.csdn.net/COOL66BOY/article/details/126216616?spm=1001.2014.3001.5502</a></p> 
<p>4、在实现MySQL的主从读写分离的优化的时候，以Ubuntu自身的mysql8.0.30做主服务器，docker里的mysql8.0.27做从服务器<br> 在用命令：<code>sudo docker run --name mysql-slave -e MYSQL_ROOT_PASSWORD=mysql -d --network=host -v /home/mm0716/mysql_slave/data:/var/lib/mysql -v /home/mm0716/mysql_slave/mysql.conf.d:/etc/mysql/mysql.conf.d mysql</code>创建容器执行mysql从服务器时，报错3306端口已被使用，而映射的配置文件里已经端口改为8306了，因此导致运行起来后，没一会儿容器就自动停了</p> 
<p>用命令：<code>sudo docker run --name mysql-slave -e MYSQL_ROOT_PASSWORD=mysql -d -p 8306:8306 -v /home/mm0716/mysql_slave/data:/var/lib/mysql -v /home/mm0716/mysql_slave/mysql.conf.d:/etc/mysql/mysql.conf.d mysql</code>创建后<br> 必须修改交互模式下mysql的my.cnf文件，添加端口才能在Ubuntu终端用命令：<code>mysql -uroot -p20000716 -h 127.0.0.1 --port=8306</code>打开mysql，否则报错。再打开后进行主从配置，每个步骤都没错的情况下，密码输入也正确，创建的slave运行起来后报错：<br> <img src="https://images2.imgbox.com/5a/2b/Ew0BaRlf_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/f7/e2/RpdDGOo8_o.png" alt="在这里插入图片描述"><br> 目前在寻找一个解决方法，因此MySQL的读写分离未实现</p> 
<p>5、Ubuntu内存不够的问题，内存不够的时候如果项目还需要内存，要及时扩容分区内存，不然可能导致虚拟机黑屏，程序无法正常运行的问题<br> 解决方法：先关闭虚拟机，然后编辑设置扩展硬盘容量之后按照<a href="https://blog.csdn.net/thy0000/article/details/122882955">https://blog.csdn.net/thy0000/article/details/122882955</a>对应的步骤完成即可</p> 
<h2><a id="_997"></a>总结</h2> 
<p>在完成这个项目的过程中，出现了大大小小的许多问题，在项目完成70%的时候虚拟机也坏过一次重装过，然后项目重新又开始做了一遍，虽然在项目快完成的时候，虚拟机坏了让人很烦躁，但重新再做一遍前面的项目内容后，我对项目中的技术又加强了记忆，也算是一种收获。从这次项目中我得到了一下几点收获：<br> 1、掌握了Django框架、git操作项目，Redis数据库，Celery任务异步发送的使用<br> 2、熟悉了FastDFS文件分布式存储，Docker，Elasticsearch全文检索， Crontab定时任务的基本使用<br> 3、了解了vue的使用，以及前后端axios数据的传输和RESTful设计风格；了解了uwsgi部署Django项目<br> 4、对数据库的增删改查SQL语句更加熟练<br> 5、了解到了电子商城的后端逻辑业务，以及数据库，数据表的设计<br> 6、分析问题和解决问题的能力，能够用debug调试工具寻找问题的根源所在<br> 7、学会去查阅各种开发文档</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/8d4e096c567568ac28b2fe1e07e2219a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">rush update运行报错：Running postinstall script, failed in ；Packages are hard linked from the content-add</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e478ce8c15b54debd06819f373ba7163/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">学习 Kafka 入门知识看这一篇就够了！（万字长文）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>