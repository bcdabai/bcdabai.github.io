<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>PCIE协议解析 synopsys IP Core 读书笔记（2） - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="PCIE协议解析 synopsys IP Core 读书笔记（2）" />
<meta property="og:description" content="1 Overview 图1
如上图为整个PCIE的框架，在C1中PIPE-CompliantPHY部分的SERDES模块，DWC PCIe Core为synopsys提供的IP，而黄色部分为用户需要完成的部分，主要包括参数的配置和数据的发送和接收。
2 Architecture 图2
该IP包含4个重要的模块，CXPL、RADM、XADM、CDM。
Ø Common ExpressPort Logic (CXPL) Module:
整个协议的核心部分，包含了物理层、数据链路层的全部功能、同时包含了传输层大部分的功能。其中包含了一个重要的缩写，LTSSM（link training and statues state machine），在后面的文档中将重复出现，link training的目的在于完成链路的链接。
Ø TransmitApplication-Dependent Module (XADM):
面向数据包发送的应用模块，主要包括以下3个功能：
l TLP（Transaction Layer Packet）arbitration
l TLP formation
l Flow control creditchecking
该模块内部为直接转发的结构，除了重发的缓存区外，内部没有发送的缓存区。
Ø ReceiveApplication-Dependent Module (RADM):
面向数据包接收的应用模块，主要包括以下3个功能：
l Sorting/filtering of received TLPs. The filtering rules and routing areconfigurable.
l Buffering and queuing ofthe received TLPs.
l Routing of received TLPto the core’s receive interfaces." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/9c122e24fed044d8ce51aa490286c1d8/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2015-08-27T15:48:12+08:00" />
<meta property="article:modified_time" content="2015-08-27T15:48:12+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">PCIE协议解析 synopsys IP Core 读书笔记（2）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>1      Overview</h2> 
<div style="text-align:center"> 
 <img src="https://images2.imgbox.com/84/9e/n5003Xuc_o.png" alt=""> 
 <br> 
</div> 
<p align="center"></p> 
<p align="center">图1</p> 
<p>如上图为整个PCIE的框架，在C1中PIPE-CompliantPHY部分的SERDES模块，DWC PCIe Core为synopsys提供的IP，而黄色部分为用户需要完成的部分，主要包括参数的配置和数据的发送和接收。</p> 
<h2>2      Architecture</h2> 
<div style="text-align:center"> 
 <img src="https://images2.imgbox.com/cd/4c/AsOGPioI_o.png" alt=""> 
 <br> 
</div> 
<p align="center"></p> 
<p align="center">图2</p> 
<p>该IP包含4个重要的模块，CXPL、RADM、XADM、CDM。</p> 
<p>Ø  <strong>Common ExpressPort Logic (CXPL) Module:</strong></p> 
<p>整个协议的核心部分，包含了物理层、数据链路层的全部功能、同时包含了传输层大部分的功能。其中包含了一个重要的缩写，<span style="color:red">LTSSM</span><a target="_blank" name="OLE_LINK14"></a><a target="_blank" name="OLE_LINK13"><span style="color:red">（</span><span style="color:red">link training and statues state machine</span></a><span style="color:red">）</span>，在后面的文档中将重复出现，link training的目的在于完成链路的链接。</p> 
<p>Ø  <strong>TransmitApplication-Dependent Module (XADM):</strong></p> 
<p><a target="_blank" name="OLE_LINK2"></a><a target="_blank" name="OLE_LINK1"><strong>面向数据包发送的应用模块，主要包括以下</strong></a><strong>3个功能：</strong></p> 
<p>l  TLP（Transaction Layer Packet）arbitration</p> 
<p>l  TLP formation</p> 
<p>l  Flow control creditchecking</p> 
<p><strong>   该模块内部为直接转发的结构，除了重发的缓存区外，内部没有发送的缓存区。</strong></p> 
<p>Ø  <strong>ReceiveApplication-Dependent Module (RADM):</strong></p> 
<p><strong>面向数据包接收的应用模块，主要包括以下3个功能：</strong></p> 
<p>l Sorting/filtering of received TLPs. The filtering rules and routing areconfigurable.<strong></strong></p> 
<p>l  Buffering and queuing ofthe received TLPs.</p> 
<p>l  Routing of received TLPto the core’s receive interfaces.</p> 
<p>Ø  <strong>Configuration-DependentModule (CDM):</strong></p> 
<p><strong>功能：</strong></p> 
<p>l  Standard PCI Express configuration space</p> 
<p>l  Core-specific register space (Port Logic Registers)</p> 
<p>其他相关的模块：</p> 
<p>Ø  <strong>Power ManagementController (PMC)</strong></p> 
<p>Ø  <strong>Local BusController (LBC) and Data Bus Interface (DBI)</strong></p> 
<p align="left">The LBC module providesa mechanism for a link partner (in EP mode only) or a local CPU (through</p> 
<p>the DBI) to access:</p> 
<p>l  Internal registers (in the CDM)</p> 
<p>l  External applicationregisters connected externally to the ELBI</p> 
<p>Ø  <strong>MessageGeneration Module (MSG_GEN)</strong></p> 
<p>Ø  <strong>Hot Plug ControlModule (HOT PLUG)</strong></p> 
<p>如图3所示，可以非常清晰的看到内部各个模块间的关系，而作为用户，不需要与CXPL直接做数据交互，而需要关心的内容主要是与RADM、LBC、CDM、XADM、MSG_GEN、PMC的数据交换，以及与之交互的一大堆的接口。下面从图中的上往下介绍各个接口的作用和意义。</p> 
<p>■<span style="color:blue">“Receive Bypass Interface (RBYP)” </span>on page <span style="color:blue"> 233</span></p> 
<p align="left">■<span style="color:blue">“Receive Request Interface (TRGT1)” </span> on page <span style="color:blue">234</span></p> 
<p align="left"><a target="_blank" name="OLE_LINK4"></a><a target="_blank" name="OLE_LINK3">■</a><span style="color:blue">“Data Bus Interface (DBI)” </span>on page <span style="color:blue">240</span></p> 
<p align="left">■ <span style="color:blue">“External Local Bus Interface (ELBI)” </span> on page <span style="color:blue">238</span></p> 
<p align="left">■ <span style="color:blue">“Message Signaled Interrupt (MSI) Interface”</span>on page <span style="color:blue">242</span></p> 
<p align="left">■ <span style="color:blue">“MSI-X Interface” </span>on page <span style="color:blue"> 243</span></p> 
<p align="left">■ <span style="color:blue">“Transmit Interfaces (XALI0/1/2)” </span> on page <span style="color:blue">22</span></p> 
<p align="left">■ <span style="color:blue">“Vendor Message Interface (VMI)” </span> on page <span style="color:blue">247</span></p> 
<p align="left">■ <span style="color:blue">“System Information Interface (SII)” </span> on page <span style="color:blue">248</span></p> 
<p>作为用户，我认为需要知道以上各个接口的作用和用法，并且知道每个接口需要在整个传输中扮演的角色，而在IP生成后，也许部分接口用户不需要知道，但是在C1 bring up阶段，每个接口的具体作用应该都是必须要明白的。</p> 
<p style="text-align:center"><img src="https://images2.imgbox.com/f5/9d/SwECDO0x_o.png" alt=""><br> </p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p align="center"></p> 
<p align="center">图3</p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p> </p> 
<h2>3      Core operation</h2> 
<h3>3.1   Initialization</h3> 
<p>1、  先disable link training</p> 
<p>2、  通过DBI（data bus interface）配置core的stickyregisters，<span style="color:red">需要配置什么目前不知道？？？？？？</span></p> 
<p>3、  Enable link training</p> 
<p>4、  等待link完成。</p> 
<p>5、  root Complex枚举Downstream Device（<span style="color:red">什么是</span><span style="color:red">Downstreamdevice</span><span style="color:red">？？？</span><span style="color:red">?</span>）</p> 
<p>Ø  读取 Downstream device的配置空间</p> 
<p>Ø  配置device的capabilites（<span style="color:red">具体配置什么？？？</span>）</p> 
<p>Ø  配置<span style="color:red">switch ports</span><span style="color:red">（？？？）</span> 的base和limit寄存器，以反映devices enumerated downstream的BAR（Base Address Register）的范围。</p> 
<p>Ø  配置endpoint的BAR。</p> 
<p><span style="color:red">（该部分是用户完成，还是</span><span style="color:red">IP</span><span style="color:red">自动完成？？？？？？？？）</span></p> 
<p>6、  使能BME、MSE、ISE。</p> 
<p>7、  开始传输数据。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/709bfa117e21f0bcf8ca8def6dd41c51/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">实模式切换到保护模式，为什么要开启A20地址线（系统升级产生的兼容性问题）...</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ae1e133ea6be852cd10f5b905ba2be9e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">IOS开发点击空白处隐藏虚拟键盘的几种方法：</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>