<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Angular 和 Vue 等前端框架中的数据绑定模拟 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Angular 和 Vue 等前端框架中的数据绑定模拟" />
<meta property="og:description" content="对 Angular 和 Vue 等前端框架中的数据单向绑定和双向绑定很感兴趣，于是自己试着模拟了一个。采用 AngularJS 的语法，在标签中添加 yjb-bind表示单向绑定，yjb-model表示双向绑定。
数据监听 数据绑定首要要实现的就是数据监听，而数据监听的方法有很多，这里我采用了 setter 方法。
废话少说，上代码！
HTML部分： &lt;input type=&#34;text&#34; yjb-model=&#34;message&#34; placeholder=&#34;双向绑定message&#34; id=&#34;inp&#34;&gt; &lt;input type=&#34;text&#34; yjb-bind=&#34;message&#34; placeholder=&#34;单向绑定message&#34;&gt; &lt;div yjb-bind=&#34;message&#34;&gt;&lt;/div&gt; &lt;hr&gt; &lt;input type=&#34;text&#34; yjb-model=&#34;text&#34; placeholder=&#34;双向绑定text&#34;&gt; &lt;input type=&#34;text&#34; yjb-bind=&#34;text&#34; placeholder=&#34;单向绑定text&#34;&gt; &lt;div yjb-bind=&#34;text&#34;&gt;&lt;/div&gt; JS部分 var scope = { message: &#34;哈哈哈&#34;, text: &#34;嘟嘟嘟&#34; }; var keys = Object.keys(scope); // [&#34;message&#34;, &#34;text&#34;] // 监听数据变化 keys.forEach(function (key) { // 定义一组不可枚举的属性 Object.defineProperty(scope, &#34;__&#34; &#43; key, { value: scope[key], enumerable: false, writable: true }); // 监听数据修改 Object." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/4f7e0fec7a6eb9d555f063b6838d73f4/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-07-15T19:22:52+08:00" />
<meta property="article:modified_time" content="2017-07-15T19:22:52+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Angular 和 Vue 等前端框架中的数据绑定模拟</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>对 Angular 和 Vue 等前端框架中的数据单向绑定和双向绑定很感兴趣，于是自己试着模拟了一个。采用 AngularJS 的语法，在标签中添加 yjb-bind表示单向绑定，yjb-model表示双向绑定。</p> 
<h3 id="数据监听">数据监听</h3> 
<p>数据绑定首要要实现的就是数据监听，而数据监听的方法有很多，这里我采用了 setter 方法。</p> 
<p>废话少说，上代码！</p> 
<h3 id="html部分">HTML部分：</h3> 
<pre class="prettyprint"><code class=" hljs lasso">
<span class="hljs-subst">&lt;</span>input <span class="hljs-keyword">type</span><span class="hljs-subst">=</span><span class="hljs-string">"text"</span> yjb<span class="hljs-attribute">-model</span><span class="hljs-subst">=</span><span class="hljs-string">"message"</span> placeholder<span class="hljs-subst">=</span><span class="hljs-string">"双向绑定message"</span> id<span class="hljs-subst">=</span><span class="hljs-string">"inp"</span><span class="hljs-subst">&gt;</span>
<span class="hljs-subst">&lt;</span>input <span class="hljs-keyword">type</span><span class="hljs-subst">=</span><span class="hljs-string">"text"</span> yjb<span class="hljs-attribute">-bind</span><span class="hljs-subst">=</span><span class="hljs-string">"message"</span> placeholder<span class="hljs-subst">=</span><span class="hljs-string">"单向绑定message"</span><span class="hljs-subst">&gt;</span>
<span class="hljs-subst">&lt;</span>div yjb<span class="hljs-attribute">-bind</span><span class="hljs-subst">=</span><span class="hljs-string">"message"</span><span class="hljs-subst">&gt;&lt;</span>/div<span class="hljs-subst">&gt;</span>

<span class="hljs-subst">&lt;</span>hr<span class="hljs-subst">&gt;</span>

<span class="hljs-subst">&lt;</span>input <span class="hljs-keyword">type</span><span class="hljs-subst">=</span><span class="hljs-string">"text"</span> yjb<span class="hljs-attribute">-model</span><span class="hljs-subst">=</span><span class="hljs-string">"text"</span> placeholder<span class="hljs-subst">=</span><span class="hljs-string">"双向绑定text"</span><span class="hljs-subst">&gt;</span>
<span class="hljs-subst">&lt;</span>input <span class="hljs-keyword">type</span><span class="hljs-subst">=</span><span class="hljs-string">"text"</span> yjb<span class="hljs-attribute">-bind</span><span class="hljs-subst">=</span><span class="hljs-string">"text"</span> placeholder<span class="hljs-subst">=</span><span class="hljs-string">"单向绑定text"</span><span class="hljs-subst">&gt;</span>
<span class="hljs-subst">&lt;</span>div yjb<span class="hljs-attribute">-bind</span><span class="hljs-subst">=</span><span class="hljs-string">"text"</span><span class="hljs-subst">&gt;&lt;</span>/div<span class="hljs-subst">&gt;</span>
</code></pre> 
<h3 id="js部分">JS部分</h3> 
<pre class="prettyprint"><code class=" hljs javascript"><span class="hljs-keyword">var</span> scope = {
    message: <span class="hljs-string">"哈哈哈"</span>,
    text: <span class="hljs-string">"嘟嘟嘟"</span>
};

<span class="hljs-keyword">var</span> keys = <span class="hljs-built_in">Object</span>.keys(scope);  <span class="hljs-comment">//   ["message", "text"]</span>

<span class="hljs-comment">//  监听数据变化</span>
keys.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(key)</span> {<!-- --></span>
    <span class="hljs-comment">//  定义一组不可枚举的属性</span>
    <span class="hljs-built_in">Object</span>.defineProperty(scope, <span class="hljs-string">"__"</span> + key, {
        value: scope[key],
        enumerable: <span class="hljs-literal">false</span>,
        writable: <span class="hljs-literal">true</span>
    });
    <span class="hljs-comment">//  监听数据修改</span>
    <span class="hljs-built_in">Object</span>.defineProperty(scope, key, {
        set: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(val)</span> {<!-- --></span>
            <span class="hljs-comment">//  将值赋给刚才创建的属性（若赋给当前属性，会递归触发 set 事件，导致堆栈溢出）</span>
            <span class="hljs-keyword">this</span>[<span class="hljs-string">"__"</span> + key] = val;
            <span class="hljs-comment">//  修改时触发更新函数</span>
            updateData(key);
        },
        get: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {<!-- --></span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>[<span class="hljs-string">"__"</span> + key]
        }
    });
    updateData(key);
});

<span class="hljs-comment">//  事件委托，通过全局监听键盘事件来监听视图中的数据修改</span>
document.addEventListener(<span class="hljs-string">"input"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e)</span> {<!-- --></span>
    <span class="hljs-keyword">var</span> index = keys.indexOf(e.target.getAttribute(<span class="hljs-string">"yjb-model"</span>));
    <span class="hljs-keyword">if</span> (index != -<span class="hljs-number">1</span>) {
        <span class="hljs-keyword">var</span> key = keys[index];
        scope[key] = e.target.value;
    }
});

<span class="hljs-comment">//  更新数据</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">updateData</span><span class="hljs-params">(key)</span> {<!-- --></span>
    document.querySelectorAll(<span class="hljs-string">"[yjb-model="</span> + key + <span class="hljs-string">"]"</span>).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(ele)</span> {<!-- --></span>
        ele.value = scope[key];
    });
    document.querySelectorAll(<span class="hljs-string">"[yjb-bind="</span> + key + <span class="hljs-string">"]"</span>).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(ele)</span> {<!-- --></span>
        <span class="hljs-keyword">if</span> (ele.tagName == <span class="hljs-string">"INPUT"</span> || ele.tagName == <span class="hljs-string">"TEXTAREA"</span>) {
            ele.value = scope[key];
        } <span class="hljs-keyword">else</span> {
            ele.innerHTML = scope[key];
        }

    })
}</code></pre> 
<p>上述代码可以简单的模拟数据的单向绑定和双向绑定，但是，仅限于 <code>scope</code> 对象下的数据类型为基本类型的属性，如果是对象之类的，就不行了，那样会复杂一些，有空再研究~</p> 
<p>更新数据那部分性能很差，可以无视，只是为了把数据扔到 HTML 里而已~现在正在研究虚拟 DOM 树~研究 Vue 源码~刚看到尤雨溪说 Vue 就是使用的 getter 和 setter 实现的数据绑定~</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/884edbf0cdf9be1d4c9b55b343c75829/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">CCleaner注册码</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/612e15bbf50b81af7673295fbb9cd6d8/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">vue-cli 构建的项目中如何使用 Less</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>