<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>flutter学习-day21-使用permission_handler进行系统权限的申请和操作 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="flutter学习-day21-使用permission_handler进行系统权限的申请和操作" />
<meta property="og:description" content="文章目录 1. 介绍2. 环境准备2-1. Android2-2. iOS 3. 使用 1. 介绍 在大多数操作系统上，权限不是在安装时才授予应用程序的。相反，开发人员必须在应用程序运行时请求用户的许可。在 flutter 开发中，则需要一个跨平台(iOS, Android)的 API 来请求权限和检查他们的状态，这时候就需要使用 flutter 插件permission_handler来帮忙了。它允许您请求和检查权限。你还可以打开设备的应用程序设置，以便用户授予权限。
2. 环境准备 项目更目录打开运行窗口，安装插件：
flutter pub add permission_handler 当在运行时请求权限时，你仍然需要告诉操作系统你的应用程序可能会使用哪些权限。这需要在 Android 和 ios 特定文件中添加权限配置。
2-1. Android 检查你的 android 目录下的 gradle.properties 文件，是否有下列代码： android.useAndroidX=true android.enableJetifier=true 检查你的 android/app 目录下的 build.gradle 文件，是否有下列代码： android { compileSdkVersion 33 # 省略代码…… } 添加需要的权限到 android/app/src/main 目录下 AndroidManifest.xml 文件 &lt;manifest xmlns:android=&#34;http://schemas.android.com/apk/res/android&#34;&gt; &lt;!-- 网络权限 --&gt; &lt;uses-permission android:name=&#34;android.permission.INTERNET&#34; /&gt; &lt;!-- 写权限 --&gt; &lt;uses-permission android:name=&#34;android.permission.WRITE_EXTERNAL_STORAGE&#34; /&gt; &lt;!" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/87e1a0cb56e6b5be36c6dca08aa5fd0e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-28T10:29:53+08:00" />
<meta property="article:modified_time" content="2023-12-28T10:29:53+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">flutter学习-day21-使用permission_handler进行系统权限的申请和操作</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#1__1" rel="nofollow">1. 介绍</a></li><li><a href="#2__5" rel="nofollow">2. 环境准备</a></li><li><ul><li><a href="#21_Android_15" rel="nofollow">2-1. Android</a></li><li><a href="#22_iOS_47" rel="nofollow">2-2. iOS</a></li></ul> 
  </li><li><a href="#3__132" rel="nofollow">3. 使用</a></li></ul> 
</div> 
<p></p> 
<h2><a id="1__1"></a>1. 介绍</h2> 
<p>在大多数操作系统上，权限不是在安装时才授予应用程序的。相反，开发人员必须在应用程序运行时请求用户的许可。在 flutter 开发中，则需要一个跨平台(iOS, Android)的 API 来请求权限和检查他们的状态，这时候就需要使用 flutter 插件<a href="https://pub.dev/packages/permission_handler" rel="nofollow">permission_handler</a>来帮忙了。它允许您请求和检查权限。你还可以打开设备的应用程序设置，以便用户授予权限。</p> 
<h2><a id="2__5"></a>2. 环境准备</h2> 
<p>项目更目录打开运行窗口，安装插件：</p> 
<pre><code class="prism language-shell">flutter pub <span class="token function">add</span> permission_handler
</code></pre> 
<p>当在运行时请求权限时，你仍然需要告诉操作系统你的应用程序可能会使用哪些权限。这需要在 Android 和 ios 特定文件中添加权限配置。</p> 
<h3><a id="21_Android_15"></a>2-1. Android</h3> 
<ol><li>检查你的 android 目录下的 gradle.properties 文件，是否有下列代码：</li></ol> 
<pre><code class="prism language-yaml">android.useAndroidX=true
android.enableJetifier=true
</code></pre> 
<ol start="2"><li>检查你的 android/app 目录下的 build.gradle 文件，是否有下列代码：</li></ol> 
<pre><code class="prism language-yaml">android <span class="token punctuation">{<!-- --></span>
  compileSdkVersion 33
  <span class="token comment"># 省略代码……</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="3"><li>添加需要的权限到 android/app/src/main 目录下 AndroidManifest.xml 文件</li></ol> 
<pre><code class="prism language-yaml">&lt;manifest xmlns<span class="token punctuation">:</span>android="http<span class="token punctuation">:</span>//schemas.android.com/apk/res/android"<span class="token punctuation">&gt;</span>
    &lt;<span class="token tag">!--</span> 网络权限 <span class="token punctuation">-</span><span class="token punctuation">-</span><span class="token punctuation">&gt;</span><span class="token scalar string">
    &lt;uses-permission android:name="android.permission.INTERNET" /&gt;
    &lt;!-- 写权限 --&gt;
    &lt;uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" /&gt;
    &lt;!-- 读权限 --&gt;
    &lt;uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE" /&gt;
    # 省略代码……</span>
&lt;/manifest<span class="token punctuation">&gt;</span>
</code></pre> 
<h3><a id="22_iOS_47"></a>2-2. iOS</h3> 
<ol><li>检查你的 ios 目录下的 podfile 文件，添加下列代码：</li></ol> 
<pre><code class="prism language-yaml"><span class="token comment"># 权限配置开始</span>
  config.build_settings<span class="token punctuation">[</span><span class="token string">'GCC_PREPROCESSOR_DEFINITIONS'</span><span class="token punctuation">]</span> <span class="token punctuation">|</span><span class="token punctuation">|</span>= <span class="token punctuation">[</span>
      <span class="token string">'$(inherited)'</span><span class="token punctuation">,</span>

      <span class="token comment">## 仅允许写入日历的权限（iOS 16 及以下）</span>
      <span class="token comment"># 'PERMISSION_EVENTS=1',</span>

      <span class="token comment">## 允许完全访问日历的权限（iOS 17及以上）</span>
      <span class="token comment"># 'PERMISSION_EVENTS_FULL_ACCESS=1',</span>

      <span class="token comment">## 提醒事项权限</span>
      <span class="token comment"># 'PERMISSION_REMINDERS=1',</span>

      <span class="token comment">## 联系人权限</span>
      <span class="token comment"># 'PERMISSION_CONTACTS=1',</span>

      <span class="token comment">## 相机权限</span>
      <span class="token comment"># 'PERMISSION_CAMERA=1',</span>

      <span class="token comment">## 麦克风权限</span>
      <span class="token comment"># 'PERMISSION_MICROPHONE=1',</span>

      <span class="token comment">## 语音识别权限</span>
      <span class="token comment"># 'PERMISSION_SPEECH_RECOGNIZER=1',</span>

      <span class="token comment">## 照片权限</span>
      <span class="token comment"># 'PERMISSION_PHOTOS=1',</span>

      <span class="token comment">## 位置权限组（包括始终、使用中）</span>
      <span class="token comment"># 'PERMISSION_LOCATION=1',</span>

      <span class="token comment">## 通知权限</span>
      <span class="token comment"># 'PERMISSION_NOTIFICATIONS=1',</span>

      <span class="token comment">## 媒体库权限</span>
      <span class="token comment"># 'PERMISSION_MEDIA_LIBRARY=1',</span>

      <span class="token comment">## 传感器权限</span>
      <span class="token comment"># 'PERMISSION_SENSORS=1',</span>

      <span class="token comment">## 蓝牙权限</span>
      <span class="token comment"># 'PERMISSION_BLUETOOTH=1',</span>

      <span class="token comment">## 应用跟踪透明度权限</span>
      <span class="token comment"># 'PERMISSION_APP_TRACKING_TRANSPARENCY=1',</span>

      <span class="token comment">## 关键警报权限</span>
      <span class="token comment"># 'PERMISSION_CRITICAL_ALERTS=1'</span>
    <span class="token punctuation">]</span>
    <span class="token comment"># 权限配置结束</span>
  end
</code></pre> 
<ol start="2"><li>打开 ios/Runner 目录中的 Info.plist 文件，添加需要的权限</li></ol> 
<table><thead><tr><th>权限名</th><th>Info.plist 的键</th><th>指令 Macro</th></tr></thead><tbody><tr><td>日历权限（&lt; iOS 17）</td><td>NSCalendarsUsageDescription</td><td>PERMISSION_EVENTS</td></tr><tr><td>日历写权限（iOS 17+）</td><td>NSCalendarsWriteOnlyAccessUsageDescription</td><td>PERMISSION_EVENTS</td></tr><tr><td>日历完全访问权限（iOS 17+）</td><td>NSCalendarsFullAccessUsageDescription</td><td>PERMISSION_EVENTS_FULL_ACCESS</td></tr><tr><td>提醒事项权限</td><td>NSRemindersUsageDescription</td><td>PERMISSION_REMINDERS</td></tr><tr><td>联系人权限</td><td>NSContactsUsageDescription</td><td>PERMISSION_CONTACTS</td></tr><tr><td>相机权限</td><td>NSCameraUsageDescription</td><td>PERMISSION_CAMERA</td></tr><tr><td>相册权限</td><td>NSPhotoLibraryAddUsageDescription</td><td>-</td></tr><tr><td>麦克风权限</td><td>NSMicrophoneUsageDescription</td><td>PERMISSION_MICROPHONE</td></tr><tr><td>语音识别权限</td><td>NSSpeechRecognitionUsageDescription</td><td>PERMISSION_SPEECH_RECOGNIZER</td></tr><tr><td>照片权限</td><td>NSPhotoLibraryUsageDescription</td><td>PERMISSION_PHOTOS</td></tr><tr><td>位置权限</td><td>NSLocationUsageDescription,</td><td>PERMISSION_LOCATION</td></tr><tr><td>始终使用位置权限</td><td>NSLocationAlwaysAndWhenInUseUsageDescription</td><td>PERMISSION_NOTIFICATIONS</td></tr><tr><td>仅在使用时使用位置权限</td><td>NSLocationWhenInUseUsageDescription</td><td>PERMISSION_NOTIFICATIONS</td></tr><tr><td>通知权限</td><td>PermissionGroupNotification</td><td>PERMISSION_NOTIFICATIONS</td></tr><tr><td>媒体库权限</td><td>NSAppleMusicUsageDescription（需要与一个字符串（string）配对使用）</td><td>-</td></tr><tr><td>媒体库权限</td><td>kTCCServiceMedia</td><td>-</td></tr></tbody></table> 
<pre><code class="prism language-yaml">&lt;<span class="token tag">!--</span> 保存图片到相册 <span class="token punctuation">-</span><span class="token punctuation">-</span><span class="token punctuation">&gt;</span>
&lt;key<span class="token punctuation">&gt;</span>NSPhotoLibraryAddUsageDescription&lt;/key<span class="token punctuation">&gt;</span>
&lt;string<span class="token punctuation">&gt;</span>Please allow the APP to save photos to the album&lt;/string<span class="token punctuation">&gt;</span>
</code></pre> 
<h2><a id="3__132"></a>3. 使用</h2> 
<p>注意，获取存储权限的系统弹框只会出现一次，假如第一次不同意，下次再申请就需要自己写确认框引导用户打开 app 权限的页面：openAppSettings()。</p> 
<pre><code class="prism language-dart"><span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter/foundation.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:permission_handler/permission_handler.dart'</span></span><span class="token punctuation">;</span>

<span class="token comment">/// 获取存储权限</span>
<span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span>bool<span class="token punctuation">&gt;</span></span> <span class="token function">getStoragePermission</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{<!-- --></span>
  late <span class="token class-name">PermissionStatus</span> myPermission<span class="token punctuation">;</span>

  <span class="token comment">/// 读取系统权限</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>defaultTargetPlatform <span class="token operator">==</span> <span class="token class-name">TargetPlatform</span><span class="token punctuation">.</span>iOS<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    myPermission <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token class-name">Permission</span><span class="token punctuation">.</span>photosAddOnly<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
    myPermission <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token class-name">Permission</span><span class="token punctuation">.</span>storage<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>myPermission <span class="token operator">!=</span> <span class="token class-name">PermissionStatus</span><span class="token punctuation">.</span>granted<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">checkPermission</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 请求存储权限</span>
  <span class="token keyword">final</span> permissionState <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getStoragePermission</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>permissionState<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 权限被授予</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 权限被拒绝 打开手机上该App的权限设置页面</span>
    <span class="token function">openAppSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>结果如下图所示：<br> <img src="https://images2.imgbox.com/42/46/THYi5J5r_o.jpg" alt="申请权限弹窗"></p> 
<p><img src="https://images2.imgbox.com/da/be/h1uK91Lt_o.jpg" alt="权限申请成功"></p> 
<hr> 
<p><strong>本次分享就到这儿啦，我是鹏多多，如果您看了觉得有帮助，欢迎评论，关注，点赞，转发，我们下次见~</strong></p> 
<p><mark>往期文章</mark></p> 
<ul><li><a href="https://blog.csdn.net/pdd11997110103/article/details/134660449">flutter学习-day1-环境搭建和启动第一个项目</a></li><li><a href="https://blog.csdn.net/pdd11997110103/article/details/134660749">flutter学习-day12-可滚动组件和监听</a></li><li><a href="https://blog.csdn.net/pdd11997110103/article/details/121667524">Vue2全家桶+Element搭建的PC端在线音乐网站</a></li><li><a href="https://blog.csdn.net/pdd11997110103/article/details/122440666">vue3+element-plus配置cdn</a></li><li><a href="https://blog.csdn.net/pdd11997110103/article/details/121035412">助你上手Vue3全家桶之Vue3教程</a></li><li><a href="https://blog.csdn.net/pdd11997110103/article/details/121036145">助你上手Vue3全家桶之VueX4教程</a></li><li><a href="https://blog.csdn.net/pdd11997110103/article/details/121036684">助你上手Vue3全家桶之Vue-Router4教程</a></li><li><a href="https://blog.csdn.net/pdd11997110103/article/details/113563786">超详细！Vue的九种通信方式</a></li><li><a href="https://blog.csdn.net/pdd11997110103/article/details/118677514">超详细！Vuex手把手教程</a></li><li><a href="https://blog.csdn.net/pdd11997110103/article/details/115981856">使用nvm管理node.js版本以及更换npm淘宝镜像源</a></li><li><a href="https://blog.csdn.net/pdd11997110103/article/details/116002824">vue中利用.env文件存储全局环境变量，以及配置vue启动和打包命令</a></li><li><a href="https://blog.csdn.net/pdd11997110103/article/details/119386246">超详细！Vue-Router手把手教程</a></li></ul> 
<p><mark>个人主页</mark></p> 
<ul><li><a href="https://blog.csdn.net/pdd11997110103?spm=1010.2135.3001.5421">CSDN</a></li><li><a href="https://github.com/wp993080086">GitHub</a></li><li><a href="https://www.jianshu.com/u/b7a8536bff06" rel="nofollow">简书</a></li><li><a href="https://www.cnblogs.com/-pdd/" rel="nofollow">博客园</a></li><li><a href="https://juejin.cn/user/747323639737191" rel="nofollow">掘金</a></li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/7e4d50a4b2ce1c34a9bede464239298a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Excel formulas 使用总结（更新中）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b2f209b64875f1a7bad061edd4220471/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">flutter学习-day20-使用SafeArea组件处理各机型的安全距离</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>