<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ES-API约定 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="ES-API约定" />
<meta property="og:description" content="多索引 expand_wildcards 设置是否扩展通配符到closed的index中，open表示只在匹配并为open的index中查询，closed表示在匹配的所有的index中查询, 默认为closed。
值为open，close，none，all。
open:表示只支持open类型的索引close:表示只支持关闭状态的索引none:表示不可用all:表示同时支持open和close索引 allow_no_indices 当使用通配符查询时，当有索引不存在的时候是否返回查询失败。值为true和false,默认为true。
allow_no_indices 跟 ignore_unavailable 都是用来防止没有索引的错误的，它们的区别是：
ignore_unavailable控制的是任何索引包括带通配符和不带通配符的allow_no_indices 控制的是带通配符的索引 ignore_unavailable 如果URL中一个或多个索引不存在的时候，是否忽略这些索引，值为true和false，默认为true。
索引名称对 Date 和 Math 的支持 Date math 索引名称解析可以让您搜索一系列 time-series indices（时间序列索引），而不是搜索所有时间序列索引并过滤结果或维护 aliases（别名）。限制搜索的索引数量减少了集群上的集群上的负载，并提高了执行性能。例如，如果您在日常日志中 searching for errors（搜索错误 )，则可以使用 date math name 模板将搜索限制为过去两天。
几乎所有的具有索引参数的 API 都支持在 index parameter value（索引参数值）中包含 date math 。
date math 索引名称采用以下形式 :
&lt;static_name{date_math_expr{date_format|time_zone}}&gt; 上述的说明 :
static_name：是索引名称的 static text（ 静态文本）部分date_math_expr：是动态计算日期的动态 date math 表达式date_format：是计算日期应呈现的可选格式。默认是 YYYY.MM.ddtime_zone：是可选的时区。默认为 utc 。 你必须将 date math 索引名称表达式包含在尖括号中，并且所有的特殊字符都应进行 URI 编码。例如 :
# GET /&lt;logstash-{now/d}&gt;/_search curl -XGET &#39;localhost:9200/%3Clogstash-%7Bnow%2Fd%7D%3E/_search?" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/4e922ba0541b42bf4a06634bcb302d3e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-26T10:49:29+08:00" />
<meta property="article:modified_time" content="2024-01-26T10:49:29+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ES-API约定</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>多索引</h2> 
<h3><a id="expand_wildcards_1"></a>expand_wildcards</h3> 
<p>  设置是否扩展通配符到closed的index中，open表示只在匹配并为open的index中查询，closed表示在匹配的所有的index中查询, 默认为closed。</p> 
<p>  值为open，close，none，all。</p> 
<ul><li>open:表示只支持open类型的索引</li><li>close:表示只支持关闭状态的索引</li><li>none:表示不可用</li><li>all:表示同时支持open和close索引</li></ul> 
<h3><a id="allow_no_indices_11"></a>allow_no_indices</h3> 
<p>  当使用通配符查询时，当有索引不存在的时候是否返回查询失败。值为true和false,默认为true。</p> 
<p>  allow_no_indices 跟 ignore_unavailable 都是用来防止没有索引的错误的，它们的区别是：</p> 
<ul><li>ignore_unavailable控制的是任何索引包括带通配符和不带通配符的</li><li>allow_no_indices 控制的是带通配符的索引</li></ul> 
<h3><a id="ignore_unavailable_20"></a>ignore_unavailable</h3> 
<p>  如果URL中一个或多个索引不存在的时候，是否忽略这些索引，值为true和false，默认为true。</p> 
<h2><a id="_Date__Math__23"></a>索引名称对 Date 和 Math 的支持</h2> 
<p>  Date math 索引名称解析可以让您搜索一系列 time-series indices（时间序列索引），而不是搜索所有时间序列索引并过滤结果或维护 aliases（别名）。限制搜索的索引数量减少了集群上的集群上的负载，并提高了执行性能。例如，如果您在日常日志中 searching for errors（搜索错误 )，则可以使用 date math name 模板将搜索限制为过去两天。</p> 
<p>  几乎所有的具有索引参数的 API 都支持在 index parameter value（索引参数值）中包含 date math 。</p> 
<p>  date math 索引名称采用以下形式 :</p> 
<pre><code class="prism language-bash"><span class="token operator">&lt;</span>static_name<span class="token punctuation">{<!-- --></span>date_math_expr<span class="token punctuation">{<!-- --></span>date_format<span class="token operator">|</span>time_zone<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
</code></pre> 
<p>  上述的说明 :</p> 
<ul><li>static_name：是索引名称的 static text（ 静态文本）部分</li><li>date_math_expr：是动态计算日期的动态 date math 表达式</li><li>date_format：是计算日期应呈现的可选格式。默认是 YYYY.MM.dd</li><li>time_zone：是可选的时区。默认为 utc 。</li></ul> 
<p>  你必须将 date math 索引名称表达式包含在尖括号中，并且所有的特殊字符都应进行 URI 编码。例如 :</p> 
<pre><code class="prism language-bash"><span class="token comment"># GET /&lt;logstash-{now/d}&gt;/_search</span>
<span class="token function">curl</span> -XGET <span class="token string">'localhost:9200/%3Clogstash-%7Bnow%2Fd%7D%3E/_search?pretty'</span> -H <span class="token string">'Content-Type: application/json'</span> -d'
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"match"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"test"</span><span class="token builtin class-name">:</span> <span class="token string">"data"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>  以下示例显示了不同形式的 date math index names（日期数学索引名称）和它们解析的 final index names（最终索引名称），它们给定的当前时间是 2024 年 3 月 22 日中午 utc。</p> 
<table><thead><tr><th>表达式</th><th>解析结果</th></tr></thead><tbody><tr><td>&lt;logstash-{now/d}&gt;</td><td>logstash-2024.03.22</td></tr><tr><td>&lt;logstash-{now/M}&gt;</td><td>logstash-2024.03.01</td></tr><tr><td>&lt;logstash-{now/M{YYYY.MM}}&gt;</td><td>logstash-2024.03</td></tr><tr><td>&lt;logstash-{now/M-1M{YYYY.MM}}&gt;</td><td>logstash-2024.02</td></tr><tr><td>&lt;logstash-{now/d{YYYY.MM.dd|+12:00}}&gt;</td><td>logstash-2024.03.23</td></tr></tbody></table> 
<p>  为了在索引名称模板的 static part（静态部分）中使用字符 { 和 } ，使用* * 对其进行转义，例如 :</p> 
<pre><code class="prism language-bash"><span class="token operator">&lt;</span>elastic<span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token punctuation">{<!-- --></span>ON<span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token punctuation">}</span>-<span class="token punctuation">{<!-- --></span>now/M<span class="token punctuation">}</span><span class="token operator">&gt;</span> resolves to elastic<span class="token punctuation">{<!-- --></span>ON<span class="token punctuation">}</span>-2024.03.01
</code></pre> 
<p>  下面的示例显示了一个搜索请求，搜索 LogStash 索引在过去的三天里，假设索引使用默认的 LogStash 索引名称格式， logstash-YYYY.MM.dd 。</p> 
<pre><code class="prism language-bash"><span class="token comment"># GET /&lt;logstash-{now/d-2d}&gt;,&lt;logstash-{now/d-1d}&gt;,&lt;logstash-{now/d}&gt;/_search</span>
GET /%3Clogstash-%7Bnow%2Fd-2d%7D%3E%2C%3Clogstash-%7Bnow%2Fd-1d%7D%3E%2C%3Clogstash-%7Bnow%2Fd%7D%3E/_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"match"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"test"</span><span class="token builtin class-name">:</span> <span class="token string">"data"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="_84"></a>通用参数</h2> 
<h3><a id="_85"></a>格式化结果</h3> 
<p>  <code>?pretty=true</code><br>   返回JSON格式化的结果。</p> 
<h3><a id="_88"></a>人类可读懂</h3> 
<p>  <code>?human=true</code> 打开人类可读懂配置，默认false<br>   同样的数据：</p> 
<ul><li>计算机格式：“exists_time_in_millis”: 3600000 or “size_in_bytes”: 1024</li><li>人类可读懂格式；“exists_time”: “1h” or “size”: “1kb”</li></ul> 
<h3><a id="_95"></a>返回字段过滤</h3> 
<p>  <code>filter_path</code> ，指定返回的文档字段，多个字段通过英文逗号分隔</p> 
<pre><code class="prism language-bash">GET /_search?q<span class="token operator">=</span>elasticsearch<span class="token operator">&amp;</span><span class="token assign-left variable">filter_path</span><span class="token operator">=</span>took,hits.hits._id,hits.hits._score
</code></pre> 
<pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
  <span class="token string">"took"</span> <span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token string">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{<!-- --></span>
        <span class="token string">"_id"</span> <span class="token operator">:</span> <span class="token string">"0"</span><span class="token punctuation">,</span>
        <span class="token string">"_score"</span> <span class="token operator">:</span> <span class="token number">1.6375021</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>  支持 * 通配符</p> 
<pre><code class="prism language-bash">GET /_cluster/state?filter_path<span class="token operator">=</span>metadata.indices.*.stat*
</code></pre> 
<pre><code class="prism language-bash"><span class="token punctuation">{<!-- --></span>
  <span class="token string">"metadata"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"indices"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"twitter"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">"state"</span><span class="token builtin class-name">:</span> <span class="token string">"open"</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>  支持 ** 多层级</p> 
<pre><code class="prism language-bash">GET /_cluster/state?filter_path<span class="token operator">=</span>routing_table.indices.**.state
</code></pre> 
<pre><code class="prism language-bash"><span class="token punctuation">{<!-- --></span>
  <span class="token string">"routing_table"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"indices"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"twitter"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"shards"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string">"0"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">"state"</span><span class="token builtin class-name">:</span> <span class="token string">"STARTED"</span><span class="token punctuation">}</span>, <span class="token punctuation">{<!-- --></span><span class="token string">"state"</span><span class="token builtin class-name">:</span> <span class="token string">"UNASSIGNED"</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="_151"></a>平面设置</h3> 
<p>  </p> 
<h4><a id="flat_settingstrue_153"></a>flat_settings=true</h4> 
<pre><code class="prism language-bash">get movies/_settings?flat_settings<span class="token operator">=</span>true
</code></pre> 
<pre><code class="prism language-bash"><span class="token punctuation">{<!-- --></span>
  <span class="token string">"movies"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"settings"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"index.creation_date"</span> <span class="token builtin class-name">:</span> <span class="token string">"1647959071168"</span>,
      <span class="token string">"index.number_of_replicas"</span> <span class="token builtin class-name">:</span> <span class="token string">"1"</span>,
      <span class="token string">"index.number_of_shards"</span> <span class="token builtin class-name">:</span> <span class="token string">"1"</span>,
      <span class="token string">"index.provided_name"</span> <span class="token builtin class-name">:</span> <span class="token string">"movies"</span>,
      <span class="token string">"index.uuid"</span> <span class="token builtin class-name">:</span> <span class="token string">"9KChX8CsTYCaMG4RpSZTNg"</span>,
      <span class="token string">"index.version.created"</span> <span class="token builtin class-name">:</span> <span class="token string">"7010199"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<h4><a id="flat_settingsfalse__173"></a>flat_settings=false （默认）</h4> 
<pre><code class="prism language-bash">get movies/_settings?flat_settings<span class="token operator">=</span>false
</code></pre> 
<pre><code class="prism language-bash"><span class="token punctuation">{<!-- --></span>
  <span class="token string">"movies"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"settings"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"index"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"creation_date"</span> <span class="token builtin class-name">:</span> <span class="token string">"1647959071168"</span>,
        <span class="token string">"number_of_shards"</span> <span class="token builtin class-name">:</span> <span class="token string">"1"</span>,
        <span class="token string">"number_of_replicas"</span> <span class="token builtin class-name">:</span> <span class="token string">"1"</span>,
        <span class="token string">"uuid"</span> <span class="token builtin class-name">:</span> <span class="token string">"9KChX8CsTYCaMG4RpSZTNg"</span>,
        <span class="token string">"version"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string">"created"</span> <span class="token builtin class-name">:</span> <span class="token string">"7010199"</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"provided_name"</span> <span class="token builtin class-name">:</span> <span class="token string">"movies"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<h4><a id="contenttype_198"></a>content-type</h4> 
<ul><li>大部分api：支持JSON, YAML, CBOR, and SMILE</li><li>bulk和multi-search API：支持NDJSON, JSON, and SMILE</li></ul> 
<h2><a id="_URL__203"></a>基于 URL 的访问控制</h2> 
<p>  许多用户使用具有基于 URL 的访问控制的代理来保护对 Elasticsearch 索引的访问。</p> 
<p>  要防止用户覆盖 URL 中指定的索引，请将此设置添加到 elasticsearch.yml 文件：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">rest.action.multi.allow_explicit_index</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
</code></pre> 
<p>  默认值为 true，但当设置为 false 时，Elasticsearch 将拒绝在请求正文中指定了显式索引的请求。<br>   <br> 参考：<br> <a href="https://doc.codingdict.com/elasticsearch/77/" rel="nofollow">https://doc.codingdict.com/elasticsearch/77/</a><br> <a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.1/common-options.html#common-options" rel="nofollow">https://www.elastic.co/guide/en/elasticsearch/reference/7.1/common-options.html#common-options</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a9b8d71dd4c3ad00da90fc136a259039/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">ES文档索引、查询、分片、文档评分和分析器技术原理</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c668468373667ee29ba3601664579f9b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">17.正在运行的数据库是否能开启执行计划自动捕获Doc ID 1520337.1</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>