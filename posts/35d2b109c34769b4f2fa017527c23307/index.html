<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Kafka 如何给集群配置SSL认证 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Kafka 如何给集群配置SSL认证" />
<meta property="og:description" content="前言 上一篇【Kafka 如何给集群配置Scram账户认证】我们说了如何给连接Kafka的客户端设置账户名和密码，但是对于一个企业使用的安全验证显然还是不够的，因此本篇就接着上篇继续，在使用SASL的方式下再加一个SSL的连接认证方式，做一个双保险。更多内容请点击【Apache Kafka API AdminClient 目录】。
Kafka-SSL官方支持 Kafka如何进行SSL认证的官方参考见链接【security_ssl】，包括如何配置，如何申请CA Key，如何对证书签名等等都有详细的介绍，这里就不多说了，有兴趣的可以自己研究，这里我们直说怎么用。因此我们已经有了一对CA认证签名做好的.jks文件service.keystore.jks和client.truststore.jks以及它们的密码abcdefg。
Zookeeper 配置 由于这篇博客算是接着上一篇来的，因此我们就直接使用上一篇的Zookeeper配置，最终会搭建一个既有SASL认证，也有SSL认证的Kafka集群。当然SSL和SASL两种安全机制是独立的，单独使用SASL或者SSL都是可以的。
tickTime=2000 initLimit=10 syncLimit=5 dataDir=/home/data/zookeeper_data dataLogDir=/home/data/zookeeper_log #这里可以不配置 clientPort=2181 # 下面两行仅仅是SASL支持，不需要可以删了 authProvider.1=org.apache.zookeeper.server.auth.SASLAuthenticationProvider requireClientAuthScheme=sasl server.1=192.168.33.101:2887:3887 server.2=192.168.33.102:2887:3887 server.3=192.168.33.103:2887:3887 server.4=192.168.33.104:2887:3887 server.5=192.168.33.105:2887:3887 Kafka配置 在正常启动Zookeeper以后，我们在上一篇Kafka的service.properties文件中添加新的SSL认证参数。此步骤的前提同样也是建立在上篇SASL认证基础上的，如果不需要，可以把这部分删除。
############################ 基础配置如下 ############################## broker.id=1 #默认监控端口，设置9092使用SASL_SSL协议，设置9093使用SASL_PLAINTEXT协议，此时使用9092端口就需要jks&#43;SASL认证才能够连接了 #如果只要SSL认证，则配置“listeners=SSL://192.168.33.101:9092” listeners=SASL_SSL://192.168.33.101:9092,SASL_PLAINTEXT://192.168.33.101:9093 #advertised.listeners控制生产者与消费者接入的端口，如果不设置默认都用listeners，设置9092使用SASL_SSL协议，设置9093使用SASL_PLAINTEXT协议 #如果只要SSL认证，则配置“advertised.listeners=SSL://192.168.33.101:9092” advertised.listeners=SASL_SSL://192.168.33.101:9092,SASL_PLAINTEXT://192.168.33.101:9093 log.dirs=/home/data/kafka-logs zookeeper.connect=192.168.33.101:2181,192.168.33.102:2181,192.168.33.103:2181,192.168.33.104:2181,192.168.33.105:2181/kafka ############################ SSL相关配置如下 ############################## #设置客户端的SSL认证文件，需要提前将client.truststore.jks文件提前Copy到该目录 ssl.truststore.location=/usr/local/client.truststore.jks #配置客户端truststore认证密码 ssl.truststore.password=abcdefg #设置服务器的SSL认证文件，需要提前将service.keystore.jks文件提前Copy到该目录 ssl.keystore.location=/usr/local/service.keystore.jks #配置服务端KeyStore认证密码 ssl.keystore.password=abcdefg #配置key认证密码 ssl.key.password=abcdefg #配置启动的权限，这里把所有的认证协议都加上了 ssl.enabled.protocols=TLSv1.2,TLSv1.1,TLSv1 #强制连接需要 ssl.client.auth=required #配置文件认证类型 ssl.keystore.type=JKS ssl.truststore.type=JKS ############################ SASL/SCRAM相关配置如下，不需要可以删除 ############################## #Broker内部联络使用的security协议 #security.inter.broker.protocol=SSL 只用SSL认证这样配置 security." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/35d2b109c34769b4f2fa017527c23307/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-02-23T17:27:52+08:00" />
<meta property="article:modified_time" content="2021-02-23T17:27:52+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Kafka 如何给集群配置SSL认证</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>前言</h2> 
<p>上一篇<a href="https://blog.csdn.net/Smallc0de/article/details/113866633">【Kafka 如何给集群配置Scram账户认证】</a>我们说了如何给连接Kafka的客户端设置账户名和密码，但是对于一个企业使用的安全验证显然还是不够的，因此本篇就接着上篇继续，在使用SASL的方式下再加一个SSL的连接认证方式，做一个双保险。更多内容请点击<a href="https://blog.csdn.net/Smallc0de/article/details/109031150">【Apache Kafka API AdminClient 目录】</a>。</p> 
<h3><a id="KafkaSSL_2"></a>Kafka-SSL官方支持</h3> 
<p>Kafka如何进行SSL认证的官方参考见链接<a href="http://kafka.apache.org/documentation/#security_ssl" rel="nofollow">【security_ssl】</a>，包括如何配置，如何申请CA Key，如何对证书签名等等都有详细的介绍，这里就不多说了，有兴趣的可以自己研究，这里我们直说怎么用。因此我们已经有了一对CA认证签名做好的<code>.jks</code>文件<code>service.keystore.jks</code>和<code>client.truststore.jks</code>以及它们的密码<code>abcdefg</code>。</p> 
<h3><a id="Zookeeper__4"></a>Zookeeper 配置</h3> 
<p>由于这篇博客算是接着上一篇来的，因此我们就直接使用上一篇的Zookeeper配置，最终会搭建一个既有SASL认证，也有SSL认证的Kafka集群。当然SSL和SASL两种安全机制是独立的，单独使用SASL或者SSL都是可以的。</p> 
<pre><code class="prism language-bash">tickTime<span class="token operator">=</span>2000
initLimit<span class="token operator">=</span>10
syncLimit<span class="token operator">=</span>5
dataDir<span class="token operator">=</span>/home/data/zookeeper_data
dataLogDir<span class="token operator">=</span>/home/data/zookeeper_log   <span class="token comment">#这里可以不配置</span>
clientPort<span class="token operator">=</span>2181
<span class="token comment"># 下面两行仅仅是SASL支持，不需要可以删了</span>
authProvider.1<span class="token operator">=</span>org.apache.zookeeper.server.auth.SASLAuthenticationProvider
requireClientAuthScheme<span class="token operator">=</span>sasl
server.1<span class="token operator">=</span>192.168.33.101:2887:3887
server.2<span class="token operator">=</span>192.168.33.102:2887:3887
server.3<span class="token operator">=</span>192.168.33.103:2887:3887
server.4<span class="token operator">=</span>192.168.33.104:2887:3887
server.5<span class="token operator">=</span>192.168.33.105:2887:3887
</code></pre> 
<h3><a id="Kafka_24"></a>Kafka配置</h3> 
<p>在正常启动Zookeeper以后，我们在上一篇Kafka的<code>service.properties</code>文件中添加新的<code>SSL</code>认证参数。此步骤的前提同样也是建立在上篇<code>SASL</code>认证基础上的，如果不需要，可以把这部分删除。</p> 
<pre><code class="prism language-bash"><span class="token comment">############################     基础配置如下    ##############################</span>
broker.id<span class="token operator">=</span>1
<span class="token comment">#默认监控端口，设置9092使用SASL_SSL协议，设置9093使用SASL_PLAINTEXT协议，此时使用9092端口就需要jks+SASL认证才能够连接了</span>
<span class="token comment">#如果只要SSL认证，则配置“listeners=SSL://192.168.33.101:9092”</span>
listeners<span class="token operator">=</span>SASL_SSL://192.168.33.101:9092,SASL_PLAINTEXT://192.168.33.101:9093
<span class="token comment">#advertised.listeners控制生产者与消费者接入的端口，如果不设置默认都用listeners，设置9092使用SASL_SSL协议，设置9093使用SASL_PLAINTEXT协议</span>
<span class="token comment">#如果只要SSL认证，则配置“advertised.listeners=SSL://192.168.33.101:9092”</span>
advertised.listeners<span class="token operator">=</span>SASL_SSL://192.168.33.101:9092,SASL_PLAINTEXT://192.168.33.101:9093
log.dirs<span class="token operator">=</span>/home/data/kafka-logs
zookeeper.connect<span class="token operator">=</span>192.168.33.101:2181,192.168.33.102:2181,192.168.33.103:2181,192.168.33.104:2181,192.168.33.105:2181/kafka

<span class="token comment">############################     SSL相关配置如下    ##############################</span>
<span class="token comment">#设置客户端的SSL认证文件，需要提前将client.truststore.jks文件提前Copy到该目录</span>
ssl.truststore.location<span class="token operator">=</span>/usr/local/client.truststore.jks
<span class="token comment">#配置客户端truststore认证密码</span>
ssl.truststore.password<span class="token operator">=</span>abcdefg
<span class="token comment">#设置服务器的SSL认证文件，需要提前将service.keystore.jks文件提前Copy到该目录</span>
ssl.keystore.location<span class="token operator">=</span>/usr/local/service.keystore.jks
<span class="token comment">#配置服务端KeyStore认证密码</span>
ssl.keystore.password<span class="token operator">=</span>abcdefg
<span class="token comment">#配置key认证密码</span>
ssl.key.password<span class="token operator">=</span>abcdefg
<span class="token comment">#配置启动的权限，这里把所有的认证协议都加上了</span>
ssl.enabled.protocols<span class="token operator">=</span>TLSv1.2,TLSv1.1,TLSv1
<span class="token comment">#强制连接需要</span>
ssl.client.auth<span class="token operator">=</span>required
<span class="token comment">#配置文件认证类型</span>
ssl.keystore.type<span class="token operator">=</span>JKS
ssl.truststore.type<span class="token operator">=</span>JKS

<span class="token comment">############################     SASL/SCRAM相关配置如下，不需要可以删除    ##############################</span>
<span class="token comment">#Broker内部联络使用的security协议</span>
<span class="token comment">#security.inter.broker.protocol=SSL 只用SSL认证这样配置</span>
security.inter.broker.protocol<span class="token operator">=</span>SASL_PLAINTEXT
<span class="token comment">#Broker内部联络使用的sasl协议，这里也可以配置多个，比如SCRAM-SHA-512,SCRAM-SHA-256并列使用</span>
sasl.mechanism.inter.broker.protocol<span class="token operator">=</span>SCRAM-SHA-512
<span class="token comment">#Broker允许使用的sasl协议，这里也可以配多个PLAIN,SCRAM-SHA-512,SCRAM-SHA-256</span>
sasl.enabled.mechanisms<span class="token operator">=</span>PLAIN,SCRAM-SHA-512

<span class="token comment">#设置zookeeper是否使用ACL</span>
zookeeper.set.acl<span class="token operator">=</span>true
<span class="token comment">#设置ACL类(低于 2.4.0 版本推荐使用 SimpleAclAuthorizer)</span>
<span class="token comment">#authorizer.class.name=kafka.security.auth.SimpleAclAuthorizer</span>
<span class="token comment">#设置ACL类(高于 2.4.0 版本推荐使用 AclAuthorizer)</span>
authorizer.class.name<span class="token operator">=</span>kafka.security.authorizer.AclAuthorizer
<span class="token comment">#设置Kafka超级用户账号，这两个分别对应zookeeper_jaas.conf中的user_super="super1234"和user_kafka="kafka1234";</span>
super.users<span class="token operator">=</span>User:admin<span class="token punctuation">;</span>User:kafka

<span class="token comment">########################    其他辅助配置，笔者推荐的重要配置   #######################</span>
<span class="token comment">#每条最大消息设置为3MB，超过此size会报错，可以自由调整</span>
replica.fetch.max.bytes<span class="token operator">=</span>3145728
message.max.bytes<span class="token operator">=</span>3145728
<span class="token comment">#默认的备份数量，可以自由调整</span>
default.replication.factor<span class="token operator">=</span>2
<span class="token comment">#默认的partion数量，可以自由调整</span>
num.partitions<span class="token operator">=</span>3
<span class="token comment">#是否允许彻底删除topic，低版本这里设置为false则是隐藏topic</span>
delete.topic.enable<span class="token operator">=</span>true
<span class="token comment">#如果topic不存在，是否允许创建一个新的。这里特别推荐设置为false，否则可能会因为手滑多出很多奇奇怪怪的topic出来</span>
auto.create.topics.enable<span class="token operator">=</span>false
</code></pre> 
<hr> 
<h4><a id="listenersadvertisedlisteners_92"></a>listeners和advertised.listeners</h4> 
<p>还是要说下<code>listeners</code>和<code>advertised.listeners</code>这两个参数配置的内容，可以看到这次<code>9092</code>端口使用的是<code>SASL_SSL</code>认证，因此外部客户端连接<code>9092</code>端口必须使用<code>.jks</code>文件和相应的密码去连接Kafka集群。但是<code>9093</code>端口使用的依然是<code>SASL_PLAINTEXT</code>认证也就是说，当程序连接<code>9093</code>端口的时候只需要有<code>SASL</code>认证而不需要<code>SSL</code>认证。可以通过这点做一个内外网的区分，让内部更快的通过认证连接Kafka，但是这样就必须做好文档的安全管理了。如果仅仅想用<code>SSL</code>，可以使用<code>listeners=SSL://192.168.33.101:9092</code>这样的配置，而不配置<code>SASL_SSL</code>认证。由于证书会和<code>hostname</code>，<code>ip</code>等信息绑定，随便拿一个证书是无法使用的，因此笔者这里也不得不配置内部认证是<code>SASL_PLAINTEXT</code>，否则集群的内部联通都会报<code>SSL handshake failed</code>异常。如果公司里给Kafka 集群服务器机器域名申请了相应的证书，就不会出现这种问题。</p> 
<hr> 
<h4><a id="securityinterbrokerprotocol_96"></a>security.inter.broker.protocol</h4> 
<p>这个参数也有必要再说下，其实Kafka官网推荐使用的是<code>SASL_SSL</code>，但是笔者这里改为了<code>SASL_PLAINTEXT</code>是由于笔者认为Broker内部通信不需要使用十分复杂的认证。如果只是用<code>SSL</code>认证则需要配置为<code>security.inter.broker.protocol=SSL</code>，因为不这样配置已经没有选择了，除了<code>SSL</code>协议就剩<code>PLAINTEXT</code>协议可以选择。之前已经解释过<code>PLAINTEXT</code>协议属于不设防状态，极度不安全，因此要配置为<code>SSL</code>协议。<br> 还有一点要再次提醒一下，这个参数的值必须在<code>listeners</code>或者<code>advertised.listeners</code>中配置过。笔者这里同时配置了<code>SASL_SSL</code>和<code>SASL_PLAINTEXT</code>，因此这个参数配置<code>SASL_PLAINTEXT</code>或者<code>SASL_SSL</code>任意一个都没有问题。如果<code>listeners</code>或者<code>advertised.listeners</code>只配置了<code>SASL_SSL</code>一个监听端口，则必须使用<code>SASL_SSL</code>协议。如果只配置了<code>SSL</code>一个监听端口，则必须使用<code>SSL</code>协议。如果配置了没有使用的协议，如<code>listeners=SASL_SSL://192.168.33.101:9092</code>而<code>security.inter.broker.protocol=SASL_PLAINTEXT</code>就会报下面的错误。</p> 
<pre><code class="prism language-java"><span class="token punctuation">[</span><span class="token number">2021</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">23</span> <span class="token number">15</span><span class="token operator">:</span><span class="token number">40</span><span class="token operator">:</span><span class="token number">26</span><span class="token punctuation">,</span><span class="token number">792</span><span class="token punctuation">]</span> ERROR Exiting Kafka due to fatal exception <span class="token punctuation">(</span>kafka<span class="token punctuation">.</span>Kafka$<span class="token punctuation">)</span>
        java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>IllegalArgumentException<span class="token operator">:</span> requirement failed<span class="token operator">:</span> inter<span class="token punctuation">.</span>broker<span class="token punctuation">.</span>listener<span class="token punctuation">.</span>name must be a listener name defined in advertised<span class="token punctuation">.</span>listeners<span class="token punctuation">.</span> The valid options based on currently configured listeners are SASL_SSL
        at kafka<span class="token punctuation">.</span>server<span class="token punctuation">.</span>KafkaConfig<span class="token punctuation">.</span><span class="token function">validateValues</span><span class="token punctuation">(</span>KafkaConfig<span class="token punctuation">.</span>scala<span class="token operator">:</span><span class="token number">1781</span><span class="token punctuation">)</span>
        at kafka<span class="token punctuation">.</span>server<span class="token punctuation">.</span>KafkaConfig<span class="token punctuation">.</span><span class="token generics function"><span class="token punctuation">&lt;</span>init<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>KafkaConfig<span class="token punctuation">.</span>scala<span class="token operator">:</span><span class="token number">1756</span><span class="token punctuation">)</span>
        at kafka<span class="token punctuation">.</span>server<span class="token punctuation">.</span>KafkaConfig<span class="token punctuation">.</span><span class="token generics function"><span class="token punctuation">&lt;</span>init<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>KafkaConfig<span class="token punctuation">.</span>scala<span class="token operator">:</span><span class="token number">1312</span><span class="token punctuation">)</span>
        at kafka<span class="token punctuation">.</span>server<span class="token punctuation">.</span>KafkaServerStartable$<span class="token punctuation">.</span><span class="token function">fromProps</span><span class="token punctuation">(</span>KafkaServerStartable<span class="token punctuation">.</span>scala<span class="token operator">:</span><span class="token number">34</span><span class="token punctuation">)</span>
        at kafka<span class="token punctuation">.</span>Kafka$<span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span>Kafka<span class="token punctuation">.</span>scala<span class="token operator">:</span><span class="token number">68</span><span class="token punctuation">)</span>
        at kafka<span class="token punctuation">.</span>Kafka<span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span>Kafka<span class="token punctuation">.</span>scala<span class="token punctuation">)</span>
</code></pre> 
<hr> 
<h3><a id="Kafka_111"></a>Kafka集群启动</h3> 
<p>把上述配置在所有的Kafka集群机器里做做一遍，然后就可以启动了。如果只用了<code>SSL</code>认证，直接使用自带<code>kafka-server-start.sh</code>脚本启动就好了。如果带了<code>SASL</code>协议认证就需要把把创建的<code>JAAS</code>认证文件带上启动，可以参考上篇内容，不再赘述。</p> 
<h3><a id="Kafka_113"></a>Kafka集群自带验证</h3> 
<p>启动完以后就可以进入验证使用的环节了，如果使用自带的<code>console</code>验证必须还要去<code>/config</code>里面配置生产者与消费者的配置文件。当然也不建议用这样的方法验证，谁也不会用这种方法实际操作Kafka，因此后面笔者还有Java程序作为验证，这里就是提一笔。</p> 
<h5><a id="producerproperties_115"></a>producer.properties</h5> 
<p>配是上<code>SSL</code>以后，我们进行验证的方法也必须带上<code>.jks</code>文件才可以，因此如果想要用<code>console</code>必须加上下面的配置。</p> 
<pre><code class="prism language-java"># 单独使用SSL配置producer<span class="token punctuation">.</span>security<span class="token punctuation">.</span>protocol<span class="token operator">=</span>SSL
producer<span class="token punctuation">.</span>security<span class="token punctuation">.</span>protocol<span class="token operator">=</span>SASL_SSL
producer<span class="token punctuation">.</span>ssl<span class="token punctuation">.</span>truststore<span class="token punctuation">.</span>location<span class="token operator">=</span><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>client<span class="token punctuation">.</span>truststore<span class="token punctuation">.</span>jks
producer<span class="token punctuation">.</span>ssl<span class="token punctuation">.</span>truststore<span class="token punctuation">.</span>password<span class="token operator">=</span>abcdefg
#这里为啥什么都不配下面有解释
producer<span class="token punctuation">.</span>endpoint<span class="token punctuation">.</span>identification<span class="token punctuation">.</span>algorithm<span class="token operator">=</span>  

# 单独使用SSL可以忽略以下配置
producer<span class="token punctuation">.</span>sasl<span class="token punctuation">.</span>mechanism<span class="token operator">=</span>SCRAM<span class="token operator">-</span>SHA<span class="token operator">-</span><span class="token number">512</span>
producer<span class="token punctuation">.</span>sasl<span class="token punctuation">.</span>jaas<span class="token punctuation">.</span>config<span class="token operator">=</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>common<span class="token punctuation">.</span>security<span class="token punctuation">.</span>scram<span class="token punctuation">.</span>ScramLoginModule required username<span class="token operator">=</span><span class="token string">"account"</span> password<span class="token operator">=</span><span class="token string">"password"</span><span class="token punctuation">;</span>
</code></pre> 
<hr> 
<h5><a id="consumerproperties_132"></a>consumer.properties</h5> 
<p>Consumer也是一样。</p> 
<pre><code class="prism language-java"># 单独使用SSL配置consumer<span class="token punctuation">.</span>security<span class="token punctuation">.</span>protocol<span class="token operator">=</span>SSL
consumer<span class="token punctuation">.</span>security<span class="token punctuation">.</span>protocol<span class="token operator">=</span>SASL_SSL
consumer<span class="token punctuation">.</span>ssl<span class="token punctuation">.</span>truststore<span class="token punctuation">.</span>location<span class="token operator">=</span><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>client<span class="token punctuation">.</span>truststore<span class="token punctuation">.</span>jks
consumer<span class="token punctuation">.</span>ssl<span class="token punctuation">.</span>truststore<span class="token punctuation">.</span>password<span class="token operator">=</span>abcdefg
#这里为啥什么都不配下面有解释
consumer<span class="token punctuation">.</span>endpoint<span class="token punctuation">.</span>identification<span class="token punctuation">.</span>algorithm<span class="token operator">=</span>   

# 单独使用SSL可以忽略以下配置
consumer<span class="token punctuation">.</span>sasl<span class="token punctuation">.</span>mechanism<span class="token operator">=</span>SCRAM<span class="token operator">-</span>SHA<span class="token operator">-</span><span class="token number">512</span>
consumer<span class="token punctuation">.</span>sasl<span class="token punctuation">.</span>jaas<span class="token punctuation">.</span>config<span class="token operator">=</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>common<span class="token punctuation">.</span>security<span class="token punctuation">.</span>scram<span class="token punctuation">.</span>ScramLoginModule required username<span class="token operator">=</span><span class="token string">" account"</span> password<span class="token operator">=</span><span class="token string">" password"</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="KafkaJava_148"></a>Kafka集群Java程序验证</h3> 
<p>下面的程序中有一个参数<code>ssl.endpoint.identification.algorithm</code>值得详细说下。这个参数的作用是设置一个终端域名认证算法的，也就是用来检测是否客户端连接的是允许连接的域名。为什么设置为空呢？是为了规避认证文件中已经做过认证的域名。相当于只要有<code>.jks</code>文件和账号密码都可以连接，而不需要进行域名验证。由于笔者不打算为了这个帖子再申请一个新的证书，所以直接拿一个已经废弃了证书做了一个例子，但是这个废弃证书是有域名签名的，因此这里只能将其规避，否则会报<code>SSL handshake failed</code>。</p> 
<p><strong>Producer 连接：</strong></p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SSLProducer</span> <span class="token punctuation">{<!-- --></span>
   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      Properties props <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"bootstrap.servers"</span><span class="token punctuation">,</span> <span class="token string">"192.168.33.101:9092"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"acks"</span><span class="token punctuation">,</span> <span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"retries"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"batch.size"</span><span class="token punctuation">,</span> <span class="token number">16384</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"linger.ms"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"buffer.memory"</span><span class="token punctuation">,</span> <span class="token number">33554432</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"key.serializer"</span><span class="token punctuation">,</span> <span class="token string">"org.apache.kafka.common.serialization.StringSerializer"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"value.serializer"</span><span class="token punctuation">,</span> <span class="token string">"org.apache.kafka.common.serialization.StringSerializer"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//取消域名绑定检查</span>
      props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"ssl.endpoint.identification.algorithm"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//设置连接安全协议</span>
      props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"security.protocol"</span><span class="token punctuation">,</span> <span class="token string">"SASL_SSL"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//设置.jks认证文件路径</span>
      props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"ssl.truststore.location"</span><span class="token punctuation">,</span> <span class="token string">" D:/client.truststore.jks"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//设置认证文件密码</span>
      props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"ssl.truststore.password"</span><span class="token punctuation">,</span> <span class="token string">"abcdefg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//单独使用SSL下面两个参数不需要配置，这两个是SASL用的</span>
      props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"sasl.mechanism"</span><span class="token punctuation">,</span> <span class="token string">"SCRAM-SHA-512"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"sasl.jaas.config"</span><span class="token punctuation">,</span>
            <span class="token string">"org.apache.kafka.common.security.scram.ScramLoginModule required username='easy' password='easy1234';"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">/*props.put("sasl.jaas.config",
            "org.apache.kafka.common.security.scram.ScramLoginModule required username='admin' password='admin1234';");*/</span>
      KafkaProducer<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">,</span> String<span class="token punctuation">&gt;</span></span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KafkaProducer</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
         ProducerRecord<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">,</span> String<span class="token punctuation">&gt;</span></span> record <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProducerRecord</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string">"my-topic"</span><span class="token punctuation">,</span> <span class="token string">"topic_"</span> <span class="token operator">+</span> i<span class="token punctuation">,</span> <span class="token string">"topic_:"</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
         Future<span class="token generics function"><span class="token punctuation">&lt;</span>RecordMetadata<span class="token punctuation">&gt;</span></span> metadataFuture <span class="token operator">=</span> producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span>
         RecordMetadata recordMetadata <span class="token operator">=</span> null<span class="token punctuation">;</span>
         <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            recordMetadata <span class="token operator">=</span> metadataFuture<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"发送成功！topic:"</span> <span class="token operator">+</span> recordMetadata<span class="token punctuation">.</span><span class="token function">topic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">" partition:"</span> <span class="token operator">+</span> recordMetadata<span class="token punctuation">.</span><span class="token function">partition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">" offset:"</span> <span class="token operator">+</span> recordMetadata<span class="token punctuation">.</span><span class="token function">offset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"发送失败！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      producer<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      producer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<hr> 
<p><strong>Consumer 连接：</strong></p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SSLConsumer</span> <span class="token punctuation">{<!-- --></span>
   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      Properties props <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"bootstrap.servers"</span><span class="token punctuation">,</span> <span class="token string">"192.168.33.101:9092"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"group.id"</span><span class="token punctuation">,</span> <span class="token string">"aaa"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"enable.auto.commit"</span><span class="token punctuation">,</span> <span class="token string">"false"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"auto.offset.reset"</span><span class="token punctuation">,</span> <span class="token string">"earliest"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"auto.commit.interval.ms"</span><span class="token punctuation">,</span> <span class="token string">"1000"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"session.timeout.ms"</span><span class="token punctuation">,</span> <span class="token string">"30000"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"key.deserializer"</span><span class="token punctuation">,</span> <span class="token string">"org.apache.kafka.common.serialization.StringDeserializer"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"value.deserializer"</span><span class="token punctuation">,</span> <span class="token string">"org.apache.kafka.common.serialization.StringDeserializer"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"ssl.endpoint.identification.algorithm"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"security.protocol"</span><span class="token punctuation">,</span> <span class="token string">"SASL_SSL"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"ssl.truststore.location"</span><span class="token punctuation">,</span> <span class="token string">"D:/client.truststore.jks"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"ssl.truststore.password"</span><span class="token punctuation">,</span> <span class="token string">"abcdefg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//单独使用SSL下面两个参数不需要配置，这两个是SASL用的</span>
      props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"sasl.mechanism"</span><span class="token punctuation">,</span> <span class="token string">"SCRAM-SHA-512"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">/*props.put("sasl.jaas.config",
            "org.apache.kafka.common.security.scram.ScramLoginModule required username='easy' password='easy1234';");*/</span>
      props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"sasl.jaas.config"</span><span class="token punctuation">,</span>
            <span class="token string">"org.apache.kafka.common.security.scram.ScramLoginModule required username='admin' password='admin1234';"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      KafkaConsumer<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">,</span> String<span class="token punctuation">&gt;</span></span> consumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KafkaConsumer</span><span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">,</span> String<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
      consumer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>Arrays<span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">"my-topic"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
         ConsumerRecords<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">,</span> String<span class="token punctuation">&gt;</span></span> records <span class="token operator">=</span> consumer<span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">for</span> <span class="token punctuation">(</span>ConsumerRecord<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">,</span> String<span class="token punctuation">&gt;</span></span> record <span class="token operator">:</span> records<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"partition= %d, offset = %d, key = %s, value = %s\n"</span><span class="token punctuation">,</span> record<span class="token punctuation">.</span><span class="token function">partition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  record<span class="token punctuation">.</span><span class="token function">offset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> record<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> record<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>如果一切正常，上面两个程序应该可以正常读写Kafka集群，到此Kafka 给集群配置SSL认证结束。</p> 
<h3><a id="_240"></a>附：认证报错</h3> 
<h4><a id="Error_1_SSL_handshake_failed_241"></a>Error 1: SSL handshake failed</h4> 
<p>如果认证没有通过（比如没有配置.jks文件）就会报<code>SSL handshake failed</code>的错误。</p> 
<pre><code class="prism language-java">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>ExecutionException<span class="token operator">:</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>common<span class="token punctuation">.</span>errors<span class="token punctuation">.</span>SslAuthenticationException<span class="token operator">:</span> SSL handshake failed
	at org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>producer<span class="token punctuation">.</span>KafkaProducer$FutureFailure<span class="token punctuation">.</span><span class="token generics function"><span class="token punctuation">&lt;</span>init<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>KafkaProducer<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">1317</span><span class="token punctuation">)</span>
	at org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>producer<span class="token punctuation">.</span>KafkaProducer<span class="token punctuation">.</span><span class="token function">doSend</span><span class="token punctuation">(</span>KafkaProducer<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">986</span><span class="token punctuation">)</span>
	at org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>producer<span class="token punctuation">.</span>KafkaProducer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>KafkaProducer<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">886</span><span class="token punctuation">)</span>
	at org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>producer<span class="token punctuation">.</span>KafkaProducer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>KafkaProducer<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">774</span><span class="token punctuation">)</span>
	at com<span class="token punctuation">.</span>api<span class="token punctuation">.</span>EasySSLProducer<span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span>EasySSLProducer<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">32</span><span class="token punctuation">)</span>
Caused by<span class="token operator">:</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>common<span class="token punctuation">.</span>errors<span class="token punctuation">.</span>SslAuthenticationException<span class="token operator">:</span> SSL handshake failed
Caused by<span class="token operator">:</span> javax<span class="token punctuation">.</span>net<span class="token punctuation">.</span>ssl<span class="token punctuation">.</span>SSLHandshakeException<span class="token operator">:</span> General SSLEngine problem
	at sun<span class="token punctuation">.</span>security<span class="token punctuation">.</span>ssl<span class="token punctuation">.</span>Handshaker<span class="token punctuation">.</span><span class="token function">checkThrown</span><span class="token punctuation">(</span>Handshaker<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">1529</span><span class="token punctuation">)</span>
	at sun<span class="token punctuation">.</span>security<span class="token punctuation">.</span>ssl<span class="token punctuation">.</span>SSLEngineImpl<span class="token punctuation">.</span><span class="token function">checkTaskThrown</span><span class="token punctuation">(</span>SSLEngineImpl<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">535</span><span class="token punctuation">)</span>
	at sun<span class="token punctuation">.</span>security<span class="token punctuation">.</span>ssl<span class="token punctuation">.</span>SSLEngineImpl<span class="token punctuation">.</span><span class="token function">writeAppRecord</span><span class="token punctuation">(</span>SSLEngineImpl<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">1214</span><span class="token punctuation">)</span>
	at sun<span class="token punctuation">.</span>security<span class="token punctuation">.</span>ssl<span class="token punctuation">.</span>SSLEngineImpl<span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span>SSLEngineImpl<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">1186</span><span class="token punctuation">)</span>
	at javax<span class="token punctuation">.</span>net<span class="token punctuation">.</span>ssl<span class="token punctuation">.</span>SSLEngine<span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span>SSLEngine<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">469</span><span class="token punctuation">)</span>
	at org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>common<span class="token punctuation">.</span>network<span class="token punctuation">.</span>SslTransportLayer<span class="token punctuation">.</span><span class="token function">handshakeWrap</span><span class="token punctuation">(</span>SslTransportLayer<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">478</span><span class="token punctuation">)</span>
	at org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>common<span class="token punctuation">.</span>network<span class="token punctuation">.</span>SslTransportLayer<span class="token punctuation">.</span><span class="token function">doHandshake</span><span class="token punctuation">(</span>SslTransportLayer<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">341</span><span class="token punctuation">)</span>
	at org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>common<span class="token punctuation">.</span>network<span class="token punctuation">.</span>SslTransportLayer<span class="token punctuation">.</span><span class="token function">handshake</span><span class="token punctuation">(</span>SslTransportLayer<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">291</span><span class="token punctuation">)</span>
	at org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>common<span class="token punctuation">.</span>network<span class="token punctuation">.</span>KafkaChannel<span class="token punctuation">.</span><span class="token function">prepare</span><span class="token punctuation">(</span>KafkaChannel<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">173</span><span class="token punctuation">)</span>
	at org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>common<span class="token punctuation">.</span>network<span class="token punctuation">.</span>Selector<span class="token punctuation">.</span><span class="token function">pollSelectionKeys</span><span class="token punctuation">(</span>Selector<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">543</span><span class="token punctuation">)</span>
	at org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>common<span class="token punctuation">.</span>network<span class="token punctuation">.</span>Selector<span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span>Selector<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">481</span><span class="token punctuation">)</span>
	at org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>NetworkClient<span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span>NetworkClient<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">561</span><span class="token punctuation">)</span>
	at org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>producer<span class="token punctuation">.</span>internals<span class="token punctuation">.</span>Sender<span class="token punctuation">.</span><span class="token function">runOnce</span><span class="token punctuation">(</span>Sender<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">325</span><span class="token punctuation">)</span>
	at org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>producer<span class="token punctuation">.</span>internals<span class="token punctuation">.</span>Sender<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>Sender<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">240</span><span class="token punctuation">)</span>
	at java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>Thread<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>Thread<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">748</span><span class="token punctuation">)</span>
Caused by<span class="token operator">:</span> javax<span class="token punctuation">.</span>net<span class="token punctuation">.</span>ssl<span class="token punctuation">.</span>SSLHandshakeException<span class="token operator">:</span> General SSLEngine problem
	at sun<span class="token punctuation">.</span>security<span class="token punctuation">.</span>ssl<span class="token punctuation">.</span>Alerts<span class="token punctuation">.</span><span class="token function">getSSLException</span><span class="token punctuation">(</span>Alerts<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">192</span><span class="token punctuation">)</span>
	at sun<span class="token punctuation">.</span>security<span class="token punctuation">.</span>ssl<span class="token punctuation">.</span>SSLEngineImpl<span class="token punctuation">.</span><span class="token function">fatal</span><span class="token punctuation">(</span>SSLEngineImpl<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">1728</span><span class="token punctuation">)</span>
	at sun<span class="token punctuation">.</span>security<span class="token punctuation">.</span>ssl<span class="token punctuation">.</span>Handshaker<span class="token punctuation">.</span><span class="token function">fatalSE</span><span class="token punctuation">(</span>Handshaker<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">330</span><span class="token punctuation">)</span>
	at sun<span class="token punctuation">.</span>security<span class="token punctuation">.</span>ssl<span class="token punctuation">.</span>Handshaker<span class="token punctuation">.</span><span class="token function">fatalSE</span><span class="token punctuation">(</span>Handshaker<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">322</span><span class="token punctuation">)</span>
	at sun<span class="token punctuation">.</span>security<span class="token punctuation">.</span>ssl<span class="token punctuation">.</span>ClientHandshaker<span class="token punctuation">.</span><span class="token function">serverCertificate</span><span class="token punctuation">(</span>ClientHandshaker<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">1614</span><span class="token punctuation">)</span>
	at sun<span class="token punctuation">.</span>security<span class="token punctuation">.</span>ssl<span class="token punctuation">.</span>ClientHandshaker<span class="token punctuation">.</span><span class="token function">processMessage</span><span class="token punctuation">(</span>ClientHandshaker<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">216</span><span class="token punctuation">)</span>
	at sun<span class="token punctuation">.</span>security<span class="token punctuation">.</span>ssl<span class="token punctuation">.</span>Handshaker<span class="token punctuation">.</span><span class="token function">processLoop</span><span class="token punctuation">(</span>Handshaker<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">1052</span><span class="token punctuation">)</span>
	at sun<span class="token punctuation">.</span>security<span class="token punctuation">.</span>ssl<span class="token punctuation">.</span>Handshaker$<span class="token number">1.</span><span class="token function">run</span><span class="token punctuation">(</span>Handshaker<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">992</span><span class="token punctuation">)</span>
	at sun<span class="token punctuation">.</span>security<span class="token punctuation">.</span>ssl<span class="token punctuation">.</span>Handshaker$<span class="token number">1.</span><span class="token function">run</span><span class="token punctuation">(</span>Handshaker<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">989</span><span class="token punctuation">)</span>
	at java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>AccessController<span class="token punctuation">.</span><span class="token function">doPrivileged</span><span class="token punctuation">(</span>Native Method<span class="token punctuation">)</span>
	at sun<span class="token punctuation">.</span>security<span class="token punctuation">.</span>ssl<span class="token punctuation">.</span>Handshaker$DelegatedTask<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>Handshaker<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">1467</span><span class="token punctuation">)</span>
	at org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>common<span class="token punctuation">.</span>network<span class="token punctuation">.</span>SslTransportLayer<span class="token punctuation">.</span><span class="token function">runDelegatedTasks</span><span class="token punctuation">(</span>SslTransportLayer<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">430</span><span class="token punctuation">)</span>
	at org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>common<span class="token punctuation">.</span>network<span class="token punctuation">.</span>SslTransportLayer<span class="token punctuation">.</span><span class="token function">handshakeUnwrap</span><span class="token punctuation">(</span>SslTransportLayer<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">514</span><span class="token punctuation">)</span>
	at org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>common<span class="token punctuation">.</span>network<span class="token punctuation">.</span>SslTransportLayer<span class="token punctuation">.</span><span class="token function">doHandshake</span><span class="token punctuation">(</span>SslTransportLayer<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">368</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token number">8</span> more
Caused by<span class="token operator">:</span> java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>cert<span class="token punctuation">.</span>CertificateException<span class="token operator">:</span> No subject alternative names present
	at sun<span class="token punctuation">.</span>security<span class="token punctuation">.</span>util<span class="token punctuation">.</span>HostnameChecker<span class="token punctuation">.</span><span class="token function">matchIP</span><span class="token punctuation">(</span>HostnameChecker<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">145</span><span class="token punctuation">)</span>
	at sun<span class="token punctuation">.</span>security<span class="token punctuation">.</span>util<span class="token punctuation">.</span>HostnameChecker<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>HostnameChecker<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">94</span><span class="token punctuation">)</span>
	at sun<span class="token punctuation">.</span>security<span class="token punctuation">.</span>ssl<span class="token punctuation">.</span>X509TrustManagerImpl<span class="token punctuation">.</span><span class="token function">checkIdentity</span><span class="token punctuation">(</span>X509TrustManagerImpl<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">455</span><span class="token punctuation">)</span>
	at sun<span class="token punctuation">.</span>security<span class="token punctuation">.</span>ssl<span class="token punctuation">.</span>X509TrustManagerImpl<span class="token punctuation">.</span><span class="token function">checkIdentity</span><span class="token punctuation">(</span>X509TrustManagerImpl<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">436</span><span class="token punctuation">)</span>
	at sun<span class="token punctuation">.</span>security<span class="token punctuation">.</span>ssl<span class="token punctuation">.</span>X509TrustManagerImpl<span class="token punctuation">.</span><span class="token function">checkTrusted</span><span class="token punctuation">(</span>X509TrustManagerImpl<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">252</span><span class="token punctuation">)</span>
	at sun<span class="token punctuation">.</span>security<span class="token punctuation">.</span>ssl<span class="token punctuation">.</span>X509TrustManagerImpl<span class="token punctuation">.</span><span class="token function">checkServerTrusted</span><span class="token punctuation">(</span>X509TrustManagerImpl<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">136</span><span class="token punctuation">)</span>
	at sun<span class="token punctuation">.</span>security<span class="token punctuation">.</span>ssl<span class="token punctuation">.</span>ClientHandshaker<span class="token punctuation">.</span><span class="token function">serverCertificate</span><span class="token punctuation">(</span>ClientHandshaker<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">1601</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token number">17</span> more
</code></pre> 
<hr> 
<h4><a id="Error_2_Keystore_was_tampered_with_or_password_was_incorrect_295"></a>Error 2: Keystore was tampered with, or password was incorrect</h4> 
<p>如果证书的认证密码错误，则会报密码不正确的错误。</p> 
<pre><code class="prism language-java">Caused by<span class="token operator">:</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>IOException<span class="token operator">:</span> Keystore was tampered with<span class="token punctuation">,</span> or password was incorrect
	at sun<span class="token punctuation">.</span>security<span class="token punctuation">.</span>provider<span class="token punctuation">.</span>JavaKeyStore<span class="token punctuation">.</span><span class="token function">engineLoad</span><span class="token punctuation">(</span>JavaKeyStore<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">780</span><span class="token punctuation">)</span>
	at sun<span class="token punctuation">.</span>security<span class="token punctuation">.</span>provider<span class="token punctuation">.</span>JavaKeyStore$JKS<span class="token punctuation">.</span><span class="token function">engineLoad</span><span class="token punctuation">(</span>JavaKeyStore<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">56</span><span class="token punctuation">)</span>
	at sun<span class="token punctuation">.</span>security<span class="token punctuation">.</span>provider<span class="token punctuation">.</span>KeyStoreDelegator<span class="token punctuation">.</span><span class="token function">engineLoad</span><span class="token punctuation">(</span>KeyStoreDelegator<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">224</span><span class="token punctuation">)</span>
	at sun<span class="token punctuation">.</span>security<span class="token punctuation">.</span>provider<span class="token punctuation">.</span>JavaKeyStore$DualFormatJKS<span class="token punctuation">.</span><span class="token function">engineLoad</span><span class="token punctuation">(</span>JavaKeyStore<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">70</span><span class="token punctuation">)</span>
	at java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>KeyStore<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>KeyStore<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">1445</span><span class="token punctuation">)</span>
	at org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>common<span class="token punctuation">.</span>security<span class="token punctuation">.</span>ssl<span class="token punctuation">.</span>DefaultSslEngineFactory$FileBasedStore<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>DefaultSslEngineFactory<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">374</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token number">13</span> more
Caused by<span class="token operator">:</span> java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>UnrecoverableKeyException<span class="token operator">:</span> Password verification failed
	at sun<span class="token punctuation">.</span>security<span class="token punctuation">.</span>provider<span class="token punctuation">.</span>JavaKeyStore<span class="token punctuation">.</span><span class="token function">engineLoad</span><span class="token punctuation">(</span>JavaKeyStore<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">778</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token number">18</span> more
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9f652303a5950359376bbcc7c5679d73/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">数据结构之树（4）——红黑树</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/956b503945f34e59921a35858c1594ac/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">vue3.0&#43;vite 使用 postcss-pxtorem 实现移动自适应（px转rem）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>