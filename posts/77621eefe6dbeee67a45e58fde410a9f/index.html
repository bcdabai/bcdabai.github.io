<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>5G空口协议栈详解 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="5G空口协议栈详解" />
<meta property="og:description" content="1、整体协议栈结构
2、各层功能
layer3层：
（1）NAS（非接入层）
主要用于UE与AMF之间的连接和移动控制。虽然AMF从基站接收消息， 但不是由基站始发的， 基站只是透传UE发给AMF的消息并不能识别或者更改这部分消息， 所以被称为NAS消息。NAS消息是UE和AMF的交互， 比如附着、 承载建立、 服务请求等移动性和连接流程消息。
（2）RRC（无线资源控制层）
RRC层主要用来处理UE与NR之间的所有信令(用户和基站之间的消息)， 包括系统消息、 准入控制、 安全管理、 小区重选、 测量上报、 切换和移动性、 NAS消息传输、 无线资源管理等。
layer2层：
（1）SDAP（ 数据适配协议）
负责Qos流与DRB（数据无线承载）之间的映射；为数据包添加QFI（Qos flow ID）标记。
（2）PDCP（分组数据汇聚协议）
主要负责实现分组数据传输的安全、可靠和高效；PDCP协议的主要工作包括压缩、加密和完整性保护等功能。其中，压缩功能可以将IP数据包进行压缩，从而减小传输延迟和降低网络拥塞。加密功能可以对传输的数据进行加密，保障用户数据不被窃取或篡改。完整性保护则是指在传输过程中，对数据进行校验和验证，确保数据包没有出现错误或丢失。
PDCP协议的主要功能包括：
压缩：将IP数据包进行压缩，减小传输延迟和降低网络拥塞。加密：对传输的数据进行加密，保障用户数据不被窃取或篡改。完整性保护：校验和验证传输过程中的数据，确保数据包没有出现错误或丢失。重排序：按照正确的顺序重新排列数据，以便于后续处理。分段：将较长的IP数据包分成若干个较小的数据包进行传输。头部压缩：将IP数据包的头部信息进行压缩，减小传输延迟。 （3）RLC（无线链路控制层协议）
检错、纠错ARQ（AM实体）；
分段重组（UM实体和AM实体）；
重分段（AM实体）；
重复包检测（AM实体）。
（4）MAC（介质访问控制层）
逻辑信道和传输信道之间的映射；
复用/解复用；
调度；
HARQ；
逻辑信道优先级设置。
Layer1 -PHY（物理层）功能：
NR物理信道与信号
物理信道和物理信号都是一系列资源粒子(RE)的集合， 其区别在于：
物理信道用于承载源于高层的信息；
物理信号不承载源于高层的信息， 并且一般来说物理信号占用的时域和频域资源
相对固定， 发送的内容和使用的功率也相对固定
NR物理信道与信号-下行物理信道
NR物理信道与信号-上行物理信道 ：
SSB结构
同步信号和PBCH块(Synchronization Signal and PBCH block， 简称SSB)由PSS、 SSS、 PBCH和PBCH DMRS等4部分组成。
SSB在时域上占4个符号， 频域上占据连续的20个RB， 时域上位置可以配置PSS/SSS映射到12个PRB中间的连续127个子载波， 占用144个子载波， 两侧分别为8个和9个子载波作为保护带宽， 以零功率发送， PBCH RE = 432。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/77621eefe6dbeee67a45e58fde410a9f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-10-13T16:22:18+08:00" />
<meta property="article:modified_time" content="2023-10-13T16:22:18+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">5G空口协议栈详解</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><strong>1、整体协议栈结构</strong></p> 
<p><img alt="" height="372" src="https://images2.imgbox.com/9f/1d/A8vvgXrL_o.png" width="720"></p> 
<p><strong>2、各层功能</strong></p> 
<p><strong>layer3层：</strong><br> （1）NAS（非接入层）</p> 
<p>       主要用于UE与AMF之间的连接和移动控制。虽然AMF从基站接收消息， 但不是由基站始发的， 基站只是透传UE发给AMF的消息并不能识别或者更改这部分消息， 所以被称为NAS消息。NAS消息是UE和AMF的交互， 比如附着、 承载建立、 服务请求等移动性和连接流程消息。</p> 
<p>（2）RRC（无线资源控制层）</p> 
<p>         RRC层主要用来处理UE与NR之间的所有信令(用户和基站之间的消息)， 包括系统消息、 准入控制、 安全管理、 小区重选、 测量上报、 切换和移动性、 NAS消息传输、 无线资源管理等。</p> 
<p> <strong> layer2层：</strong></p> 
<p>（1）SDAP（ 数据适配协议）</p> 
<p><img alt="" height="362" src="https://images2.imgbox.com/47/7b/XAfGjoRM_o.png" width="720"></p> 
<p>        <span style="color:#fe2c24;">负责Qos流与DRB（数据无线承载）之间的映射</span>；<span style="color:#fe2c24;">为数据包添加QFI（Qos flow ID）标记</span>。</p> 
<p>（2）PDCP（分组数据汇聚协议）</p> 
<p>主要负责实现分组数据传输的安全、可靠和高效；PDCP协议的主要工作包括压缩、加密和完整性保护等功能。其中，压缩功能可以将IP数据包进行压缩，从而减小传输延迟和降低网络拥塞。加密功能可以对传输的数据进行加密，保障用户数据不被窃取或篡改。完整性保护则是指在传输过程中，对数据进行校验和验证，确保数据包没有出现错误或丢失。</p> 
<p>PDCP协议的主要功能包括：</p> 
<ul><li><strong>压缩：</strong>将IP数据包进行压缩，减小传输延迟和降低网络拥塞。</li><li><strong>加密：</strong>对传输的数据进行加密，保障用户数据不被窃取或篡改。</li><li><strong>完整性保护：</strong>校验和验证传输过程中的数据，确保数据包没有出现错误或丢失。</li><li><strong>重排序：</strong>按照正确的顺序重新排列数据，以便于后续处理。</li><li><strong>分段：</strong>将较长的IP数据包分成若干个较小的数据包进行传输。</li><li><strong>头部压缩：</strong>将IP数据包的头部信息进行压缩，减小传输延迟。</li></ul> 
<p>（3）RLC（无线链路控制层协议）</p> 
<p><img alt="" height="199" src="https://images2.imgbox.com/c8/58/USACeohi_o.png" width="720"></p> 
<p>        检错、纠错ARQ（AM实体）；</p> 
<p>        分段重组（UM实体和AM实体）；</p> 
<p>        重分段（AM实体）；</p> 
<p>        重复包检测（AM实体）。</p> 
<p>（4）MAC（介质访问控制层）</p> 
<p><img alt="" height="354" src="https://images2.imgbox.com/71/6f/ljXW8wCN_o.png" width="720"></p> 
<p>        逻辑信道和传输信道之间的映射；</p> 
<p>        复用/解复用；</p> 
<p>        调度；</p> 
<p>        HARQ；</p> 
<p>        逻辑信道优先级设置。</p> 
<p><strong>Layer1 -</strong>PHY（物理层）<strong>功能：</strong></p> 
<p><img alt="" height="221" src="https://images2.imgbox.com/37/da/ciSKolCU_o.png" width="720"></p> 
<p><strong>NR物理信道与信号</strong></p> 
<p>物理信道和物理信号都是一系列资源粒子(RE)的集合， 其区别在于：</p> 
<p>物理信道用于承载源于高层的信息；</p> 
<p>物理信号不承载源于高层的信息， 并且一般来说物理信号占用的时域和频域资源</p> 
<p>相对固定， 发送的内容和使用的功率也相对固定</p> 
<p>NR物理信道与信号-下行物理信道</p> 
<p><img alt="" height="305" src="https://images2.imgbox.com/c7/99/CeFSNJ8U_o.png" width="720"></p> 
<p><img alt="" height="290" src="https://images2.imgbox.com/e7/6b/AJC52ESR_o.png" width="720"></p> 
<p>NR物理信道与信号-上行物理信道 ：</p> 
<p><img alt="" height="258" src="https://images2.imgbox.com/65/64/VSXgvWWg_o.png" width="720"></p> 
<p><img alt="" height="309" src="https://images2.imgbox.com/b9/84/GGjc9Krk_o.png" width="720"></p> 
<p><strong>SSB结构</strong></p> 
<p>同步信号和PBCH块(Synchronization Signal and PBCH block， 简称SSB)由PSS、 SSS、 PBCH和PBCH DMRS等4部分组成。</p> 
<p>SSB在时域上占4个符号， 频域上占据连续的20个RB， 时域上位置可以配置PSS/SSS映射到12个PRB中间的连续127个子载波， 占用144个子载波， 两侧分别为8个和9个子载波作为保护带宽， 以零功率发送， PBCH RE = 432。</p> 
<p>NR在解调PBCH信道前， 需要获取PBCH DMRS位置。</p> 
<p>PBCH DMRS在时域上， 和PBCH相同符号位置，在频域上间隔4个子载波， 初始偏移v由PCI确定。</p> 
<p>PBCH DMRS在时域上， 和PBCH相同符号位置，在频域上间隔4个子载波， 初始偏移v由PCI确定。</p> 
<p></p> 
<p class="img-center"><img alt="" height="265" src="https://images2.imgbox.com/99/de/EUedUilg_o.png" width="1080"></p> 
<p></p> 
<p class="img-center"><img alt="" height="723" src="https://images2.imgbox.com/a6/36/65n0wc4t_o.png" width="720"></p> 
<p></p> 
<p class="img-center"><img alt="" height="263" src="https://images2.imgbox.com/5a/ac/BAbYAtyd_o.png" width="720"></p> 
<p><strong>SSB时域起始位置</strong></p> 
<p></p> 
<p class="img-center"><img alt="" height="366" src="https://images2.imgbox.com/c7/42/AxEOLQKR_o.png" width="720"></p> 
<p>SSB频域起始位置- ARFCN</p> 
<p>将0~100GHz的频段划出总共3279165个栅格， 这些栅格从0开始编号， 一直编号到3279165。每个编号都代表着一个绝对的频域位置， 这些编号就叫做NR-ARFCN。</p> 
<p>编号和频域位置会通过下式来对应（3GPP TS 38-101）</p> 
<p></p> 
<p class="img-center"><img alt="" height="104" src="https://images2.imgbox.com/de/f9/wtkbVGSd_o.png" width="1080"></p> 
<p></p> 
<p class="img-center"><img alt="" height="78" src="https://images2.imgbox.com/d5/09/joqMYrK1_o.png" width="720"></p> 
<p>以operating band n1为例， 其上行的频段范围是ARFCN从384000到396000的部分， 然后第二列指示的是该operating band的channel raster的粒度， 比如粒度为100kHz， 那么两个channel raster之间就会包含20个ARFCN， 因为该频段小于3GHz， ARFCN的粒度为5kHz， 5*20=100kHz。</p> 
<p></p> 
<p class="img-center"><img alt="" height="156" src="https://images2.imgbox.com/ad/82/QRh2Ln35_o.png" width="720"></p> 
<p>SSB频域起始位置-GSCN</p> 
<p>NR中定义了SSREF (SS block Reference Frequency Position， 同步块参考频率位置)， 用GSCN(Global Synchronization Channel Number， 全局同步信道号)来表示一个确定的、 绝对的频率位置， 系统会把SSB放在这些GSCN上， 对齐方式为SSB的10号RB的0号子载波与GSCN对齐， UE就会在这些GSCN上顺序盲检SSB。</p> 
<p></p> 
<p class="img-center"><img alt="" height="114" src="https://images2.imgbox.com/45/c3/sulC2VOH_o.png" width="720"></p> 
<p>注：当配置了子载波信道栅格时M = 3。</p> 
<p></p> 
<p class="img-center"><img alt="" height="139" src="https://images2.imgbox.com/f3/ca/6AzVoqgX_o.png" width="720"></p> 
<p><strong>SSB与波束扫描</strong></p> 
<p></p> 
<p class="img-center"><img alt="" height="265" src="https://images2.imgbox.com/89/ae/QqxtP3ME_o.png" width="720"></p> 
<p>对于不同的子载波间隔，一个SSB set里的SSB数量Lmax也不一样，可能有4个、8个或64个，该数量也决定了小区中最大波束数量。</p> 
<p>eMBB场景编码：控制信道Polar码，业务信道LDPC码；</p> 
<p>        调制：QPSK、16QAM、64QAM、256QAM；</p> 
<p>        MIMO......(其余过程与4G LTE基本一致）。</p> 
<p>1.3物理层协议功能</p> 
<p>物理层位于无线接口协议栈的最底层，作用：提供了物理介质中比特流传输所需要的所有功能。</p> 
<p>1.3.1 传输信道的类型</p> 
<p>物理层为MAC层和更高层提供信息传输的服务，其中，物理层提供的服务通过传输信道来描述。</p> 
<p>传输信道描述了物理层为MAC层和高层所传输的数据特征。</p> 
<p></p> 
<p class="img-center"><img alt="" height="380" src="https://images2.imgbox.com/84/0d/bWWmoAj8_o.png" width="691"></p> 
<p>注：5G系统中，最新的R15与LTE系统相比，少了多播信道。</p> 
<p></p> 
<p class="img-center"><img alt="" height="201" src="https://images2.imgbox.com/d5/2b/ku1wblHb_o.png" width="691"></p> 
<p></p> 
<p class="img-center"><img alt="" height="211" src="https://images2.imgbox.com/e6/44/8q8oP8nG_o.png" width="349"></p> 
<p></p> 
<p class="img-center"><img alt="" height="197" src="https://images2.imgbox.com/bc/5a/1iE7FVKI_o.png" width="341"></p> 
<p>1.3.2 数据链路层协议功能</p> 
<p>复习：数据链路层四个子层为媒体访问控制层（MAC）、无线链路控制层（RLC）、分组数据汇聚协议层（PDCP）和服务数据自适应协议层（SDAP）。</p> 
<p></p> 
<p class="img-center"><img alt="" height="131" src="https://images2.imgbox.com/1c/5e/INmH6F8o_o.png" width="691"></p> 
<p>注：</p> 
<p>（1）层与层之间的连接点称为服务接入点（SAP）</p> 
<p>（2）无线承接分为两类：</p> 
<p>1)用户平面的数据无线承接（DRB）</p> 
<p>2)控制平面的信令无线承载（SRB）</p> 
<p></p> 
<p class="img-center"><img alt="" height="410" src="https://images2.imgbox.com/5b/aa/bvOJQrDN_o.png" width="454"></p> 
<p></p> 
<p class="img-center"><img alt="" height="393" src="https://images2.imgbox.com/f9/aa/rNpezUjY_o.png" width="238"></p> 
<p>1.MAC子层</p> 
<p>（1）MAC子层的功能</p> 
<p>MAC子层只支持一个MAC实体。</p> 
<p>MAC实体支持多个参数集、发送定时和小区。</p> 
<p>使用逻辑信道优先级（LCP）的映射限制来控制参数集、小区和发送定时。</p> 
<p></p> 
<p class="img-center"><img alt="" height="292" src="https://images2.imgbox.com/02/f3/8z6Y2OPa_o.png" width="537"></p> 
<p>（2）逻辑信道</p> 
<p></p> 
<p class="img-center"><img alt="" height="278" src="https://images2.imgbox.com/12/71/qnyxGqhw_o.png" width="748"></p> 
<p>（3）逻辑信道到传输信道的映射关系</p> 
<p>5G系统的上行逻辑信道传输全部映射在下行共享传输信道上；下行逻辑信道的传输中，除PCCH和BCCH逻辑信道有专用的PCH/BCH传输信道外，其他逻辑信道全部映射到下行共享信道上（BCCH一部分在BCH上传输）。</p> 
<p></p> 
<p class="img-center"><img alt="" height="151" src="https://images2.imgbox.com/0f/49/AD77WhEK_o.png" width="352"></p> 
<p></p> 
<p class="img-center"><img alt="" height="150" src="https://images2.imgbox.com/4a/7d/URnqiiFw_o.png" width="282"></p> 
<p>2.RLC子层</p> 
<p>RLC子层支持3中传输模式：透明模式（TM）、非确认模式（UM）、确认模式（AM）</p> 
<p>RLC的配置基于逻辑信道的颗粒度，并不依赖底层的参数集和传输时间间隔（TTI）的长度。</p> 
<p>RLC可以处理在逻辑信道配置的任意参数集忽然TTI长度等条件的数据分组。</p> 
<p>透明模式主要用于寻呼消息、系统信息广播以及SRB0信令的传输；其他SRB信令用于确认模式传输；用于传输用户数据的DRB可以根据业务类型，采用确认模式或非确认模式传输。</p> 
<p></p> 
<p class="img-center"><img alt="" height="324" src="https://images2.imgbox.com/77/5d/9wOtt886_o.png" width="692"></p> 
<p>（2）PDCP子层用于控制平面的功能包括：</p> 
<p></p> 
<p class="img-center"><img alt="" height="290" src="https://images2.imgbox.com/f8/5f/uvRgpYax_o.png" width="692"></p> 
<p>（3）PDCP DPU的结构：</p> 
<p></p> 
<p class="img-center"><img alt="" height="171" src="https://images2.imgbox.com/5d/74/AVkfj83e_o.png" width="441"></p> 
<p>注：PDCP PDU和PDCP报头都是字节对齐的</p> 
<p>4.SDAP子层</p> 
<p>5G系统中，SDAP子层是一个全新的协议子层，功能如下：</p> 
<p></p> 
<p class="img-center"><img alt="" height="153" src="https://images2.imgbox.com/fb/c9/PXGvbXh6_o.png" width="691"></p> 
<p>5.数据链路层传输流程</p> 
<p></p> 
<p class="img-center"><img alt="" height="337" src="https://images2.imgbox.com/6e/23/k5z6Nxxt_o.png" width="499"></p> 
<p>1.3.3 RRC层协议功能</p> 
<p>RRC层协议模块在5G系统的空口协议栈中的作用是接入层的控制中心。</p> 
<p></p> 
<p class="img-center"><img alt="" height="522" src="https://images2.imgbox.com/10/f2/o3oVBGrj_o.png" width="692"></p> 
<p>注：5G系统中，RRC的协议状态由LTE的2个增加为3个，即RRC_IDLE/RRC_INACTIVE/RRC_CONNECTED</p> 
<p></p> 
<p class="img-center"><img alt="" height="346" src="https://images2.imgbox.com/c6/82/NCXUC8lB_o.png" width="532"></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/029a0375c59b7939a3cd6e07dbbbced0/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">通过API接口获取大量的数据后，需要对这些数据进行处理和分析，以实现业务目标</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9d2360a9e300df2c606a455152c942c3/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【Java】DirectByteBuffer 堆外内存源码解读</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>