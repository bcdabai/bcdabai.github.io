<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>C&#43;&#43;工程项目中常见的写法与解释——多种状态值的混合（按位处理）篇 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="C&#43;&#43;工程项目中常见的写法与解释——多种状态值的混合（按位处理）篇" />
<meta property="og:description" content="一般来说，对于一个类而言，其状态的表达形式有很多，比如使用enum枚举
enum CLASS_STATUS{status1=0，status2，status3} 但假如这个类有多种状态，使用多个enum枚举状态值，效率往往没有按位计算来的更高。
假如有一个类，animal动物，有行动状态（飞，走，游），有身形状态（大，中，小），有颜色状态（红，白，蓝），我们可以这样设定：
#define animal_action_status_fly	0x00000001 #define animal_action_status_walk	0x00000002 #define animal_action_status_swim	0x00000004 #define animal_action_status_big	0x00000010 #define animal_action_status_medium	0x00000020 #define animal_action_status_small	0x00000040 #define animal_action_status_red	0x00000100 #define animal_action_status_white	0x00000200 #define animal_action_status_blue	0x00000400 当我们想表示一个中等身形的，会飞的蓝色动物，我们可以这样表示：
animal_action_status_medium | animal_action_status_fly	| animal_action_status_blue 按位取或是对二进制而言的，所以这里的按位取或，是要将十六进制数值转换成二进制，从而计算。
十六进制的一位0~F转化成二进制为：0000~1111
而00、10、20、30~F0转化成二进制为：0000 0000~1111 0000
由此我们可以发现，如果进行如下计算
获取结合状态值
m_status = animal_action_status_medium | animal_action_status_fly 会得到
0x00000020 | 0x00000001
转化成二进制为
0010 0000 | 0000 0001
按位取或，结果为0010 0001，是两种状态结合的唯一二进制结果，
如若转化成十六进制，则为0x00000021，
既方便查看唯一状态值，又方便查验到底是哪几种状态的结合值。
设定的状态值，如果单一状态的数量在1~F（1~15个）时，每个状态占一位是可行的，但如果单一状态超过这个数值，就用两位表示一个状态即可。
比如，上面动物的例子，颜色状态不止有3个，有24个，如果第0个值该状态值表示为0x00000100，那么第24个的十六进制值表示为0x00001800
所以实际使用时，可根据实际情况，设计状态占的位数。
取消某个状态值
如" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/f57f653517b8639a9394144f86ca6e42/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-06-29T16:34:30+08:00" />
<meta property="article:modified_time" content="2021-06-29T16:34:30+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">C&#43;&#43;工程项目中常见的写法与解释——多种状态值的混合（按位处理）篇</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>一般来说，对于一个类而言，其状态的表达形式有很多，比如使用enum枚举</p> 
<pre><code>enum CLASS_STATUS{status1=0，status2，status3}
</code></pre> 
<p>但假如这个类有多种状态，使用多个enum枚举状态值，效率往往没有按位计算来的更高。</p> 
<p>假如有一个类，animal动物，有行动状态（飞，走，游），有身形状态（大，中，小），有颜色状态（红，白，蓝），我们可以这样设定：</p> 
<pre><code>#define animal_action_status_fly					0x00000001
#define animal_action_status_walk					0x00000002
#define animal_action_status_swim					0x00000004

#define animal_action_status_big					0x00000010
#define animal_action_status_medium					0x00000020
#define animal_action_status_small					0x00000040

#define animal_action_status_red					0x00000100
#define animal_action_status_white					0x00000200
#define animal_action_status_blue					0x00000400
</code></pre> 
<p>当我们想表示一个中等身形的，会飞的蓝色动物，我们可以这样表示：</p> 
<pre><code>animal_action_status_medium | animal_action_status_fly	| animal_action_status_blue
</code></pre> 
<p>按位取或是对二进制而言的，所以这里的按位取或，是要将十六进制数值转换成二进制，从而计算。<br> 十六进制的一位0~F转化成二进制为：0000~1111<br> 而00、10、20、30~F0转化成二进制为：0000 0000~1111 0000<br> 由此我们可以发现，如果进行如下计算<br> <strong>获取结合状态值</strong></p> 
<pre><code>m_status = animal_action_status_medium | animal_action_status_fly
</code></pre> 
<p>会得到<br> 0x00000020 | 0x00000001<br> 转化成二进制为<br> 0010 0000 | 0000 0001<br> 按位取或，结果为0010 0001，是两种状态结合的唯一二进制结果，<br> 如若转化成十六进制，则为0x00000021，<br> 既方便查看唯一状态值，又方便查验到底是哪几种状态的结合值。</p> 
<p>设定的状态值，如果单一状态的数量在1~F（1~15个）时，每个状态占一位是可行的，但如果单一状态超过这个数值，就用两位表示一个状态即可。<br> 比如，上面动物的例子，颜色状态不止有3个，有24个，如果第0个值该状态值表示为0x00000100，那么第24个的十六进制值表示为0x00001800</p> 
<p>所以实际使用时，可根据实际情况，设计状态占的位数。</p> 
<p><strong>取消某个状态值</strong><br> 如</p> 
<pre><code>m_status &amp;= ~ animal_action_status_fly
</code></pre> 
<p><strong>验证结合状态值</strong><br> 现在得到了一个结合后的状态值，如何知道这个animal都包含了哪些属性（状态）呢？</p> 
<pre><code>m_status=0x00000021
bool check(unsigned combinedStatus)
{
	return (m_status &amp; combinedStatus) !=0;
}
</code></pre> 
<p>假如我想验证这个animal会不会走路walk，那么传入animal_action_status_walk进去，<br> 计算 0x00000021 &amp; 0x00000002 转为二进制计算为：<br> 0010 0001 &amp; 0000 0010 = 0000 0000 则函数返回false，即不包含walk状态。</p> 
<p>假如我想验证这个animal身形是不是medium，那么传入animal_action_status_medium进去，<br> 计算 0x00000021 &amp; 0x00000020 转为二进制计算为：<br> 0010 0001 &amp; 0010 0000 = 0010 0000 则函数返回true，即包含medium状态。</p> 
<p><strong>需要注意的是</strong><br> 为了验证结合状态值，单个状态值的赋值，十六进制下只能是1、2、4、8、10、20、40、80……这样的数。<br> 原因是，当用十六进制的一位表示一个状态值时，转换成二进制进行计算时，值为:<br> 0x0001-&gt;0001<br> 0x0002-&gt;0010<br> 0x0004-&gt;0100<br> 0x0008-&gt;1000<br> 所以只能表达4个值，如果使用了这4个值以外的值，如0x0003-&gt;0011，<br> 在验证结合状态值时，将会出现错误，比如这样定义</p> 
<pre><code>#define animal_action_status_climb					0x00000003
</code></pre> 
<p>然后验证</p> 
<pre><code>m_status = animal_action_status_fly	//0x00000001
</code></pre> 
<p>0x00000003 &amp; 0x00000001 转为二进制计算<br> 0011 &amp; 0001 = 0001 为非0数，则check函数返回true，代表m_status包含climb状态，而实际上他只有fly的状态。<br> 所以为了验证时不出错，如果十六进制中每一位代表一个状态时，状态值只能写1、2、4、8，才能保证转化成二进制计算按位与时，不会出错。<br> 这也就意味着，每种状态只允许4个值，当然可以扩展成两位十六进制来表示一个状态，比如1、2、4、8、10、20、40、80，这样就允许8个值了。</p> 
<p>实际上这种方式的可玩性有各种各样，可以根据实际情况来声明和使用，以上只是给一个思路。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ae242f8527128cf815fc72e95e519632/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">laravel 添加sql日志</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c97da8d1012b29437134ea5a976714db/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">md5 中文加密 前后端不一致问题解决</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>