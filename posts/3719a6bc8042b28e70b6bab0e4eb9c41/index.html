<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>支付宝沙箱支付 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="支付宝沙箱支付" />
<meta property="og:description" content="1.沙箱支付 1.1.什么是沙箱支付 支付宝沙箱支付（Alipay Sandbox Payment）是支付宝提供的一个模拟支付环境，用于开发和测试支付宝支付功能的开发者工具。在真实的支付宝环境中进行支付开发和测试可能涉及真实资金和真实用户账户，而沙箱环境则提供了一个安全、隔离的环境，使开发者能够模拟支付过程，测试支付功能，而不会使用真实资金。
使用支付宝沙箱支付环境，开发者可以模拟各种支付场景，包括交易创建、支付请求、支付回调等，以验证支付功能的正确性和稳定性。沙箱环境中的所有交易和数据都是虚拟的，不会产生真实的交易或资金流动。
支付宝沙箱支付提供了开发者工具和接口，使开发者能够在模拟环境下进行支付流程的调试和测试。开发者可以在沙箱环境中创建测试账户、配置模拟的交易金额和状态，使用沙箱环境中的接口进行支付操作，并模拟支付回调接口接收支付结果。
通过使用支付宝沙箱支付，开发者可以更安全、更有效地进行支付功能的开发和测试，避免了对真实环境的影响和风险。一旦支付功能在沙箱环境中验证通过，开发者可以将其部署到真实的支付宝生产环境中，与真实用户进行交互和支付。
1.2.配置沙箱支付 1.2.1.接入支付宝开放平台 登陆支付宝：支付宝开放平台
点击登录按钮之后，使用手机的支付宝进行二维码扫码登录，如下：
登录成功之后，点击控制台跳转到控制台主页面，将浏览器进度条滚动到最下面，选择沙箱，最后点击沙箱选项即可，如下：
1.2.2.下载 下载安装支付宝开放平台开发助手：小程序文档 - 支付宝文档中心
注意：请不要安装在含有空格的目录路径下，否则会导致公私钥乱码的问题
安装完成之后，点击“支付宝开放平台开发助手”开始生成密钥。
1.2.3.配置秘钥 打开支付宝开放平台开发助手，如下：
选择密钥方式，选择RSA2方式，最后点击生成密钥即可生成得到私钥和公钥。
1.2.4.生成支付宝公钥 根据支付宝开放平台开发助手生成的应用公钥，生成支付宝公钥：
找到支付宝开放平台的沙箱应用一栏，选择“开发信息”接口加签方式中的自定义密钥方式，点击设置并查看按钮：
生成支付宝公钥，如下：
1.2.5.配置沙箱账号（买家） 配置沙箱账号（买家）并完成手动充值：登录 - 支付宝
1.2.6.下载沙箱支付宝 下载沙箱支付宝（只支持安卓）：登录 - 支付宝
2.开发接入 2.1.配置依赖 &lt;dependency&gt; &lt;groupId&gt;com.alipay.sdk&lt;/groupId&gt; &lt;artifactId&gt;alipay-easysdk&lt;/artifactId&gt; &lt;version&gt;2.0.1&lt;/version&gt; &lt;/dependency&gt; 2.2.配置AlipayConfig 开发文档：小程序文档 - 支付宝文档中心
将课件资料中的AlipayConfig.java导入到项目中，并修改主要配置：
第一步：修改沙箱支付配置参数：
private Config aliconfig(){ Config config=new Config(); //沙箱支付宝地址 config.gatewayHost=&#34;openapi-sandbox.dl.alipaydev.com&#34;; //协议https config.protocol=&#34;https&#34;; //应用ID,您的APPID，收款账号既是您的APPID对应支付宝账号 config.appId=&#34;请填写您的AppId，例如：2019091767145019&#34;; //支付宝公钥 config.alipayPublicKey=&#34;请填写支付宝公钥&#34;; //签名方式 config.signType=&#34;RSA2&#34;; //商户私钥（应用私钥），您的PKCS8格式RSA2私钥 config.merchantPrivateKey=&#34;请填写商户私钥（应用私钥），您的PKCS8格式RSA2私钥&#34;; return config; } 注意：这里沙箱支付宝地址有巨坑，由于支付宝沙箱已经全面升级了，导致接口文档与实际的案例接口不匹配，从而影响了以前的老接口的使用，只需要调整接口地址接口，如下：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/3719a6bc8042b28e70b6bab0e4eb9c41/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-04T15:47:56+08:00" />
<meta property="article:modified_time" content="2024-01-04T15:47:56+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">支付宝沙箱支付</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>1.沙箱支付</h2> 
<h3>1.1.什么是沙箱支付</h3> 
<p>支付宝沙箱支付（<code>Alipay Sandbox Payment</code>）是支付宝提供的一个模拟支付环境，用于开发和测试支付宝支付功能的开发者工具。在真实的支付宝环境中进行支付开发和测试可能涉及真实资金和真实用户账户，而沙箱环境则提供了一个安全、隔离的环境，使开发者能够模拟支付过程，测试支付功能，而不会使用真实资金。</p> 
<p>使用支付宝沙箱支付环境，开发者可以模拟各种支付场景，包括交易创建、支付请求、支付回调等，以验证支付功能的正确性和稳定性。沙箱环境中的所有交易和数据都是虚拟的，不会产生真实的交易或资金流动。</p> 
<p>支付宝沙箱支付提供了开发者工具和接口，使开发者能够在模拟环境下进行支付流程的调试和测试。开发者可以在沙箱环境中创建测试账户、配置模拟的交易金额和状态，使用沙箱环境中的接口进行支付操作，并模拟支付回调接口接收支付结果。</p> 
<p>通过使用支付宝沙箱支付，开发者可以更安全、更有效地进行支付功能的开发和测试，避免了对真实环境的影响和风险。一旦支付功能在沙箱环境中验证通过，开发者可以将其部署到真实的支付宝生产环境中，与真实用户进行交互和支付。</p> 
<p></p> 
<h3>1.2.配置沙箱支付</h3> 
<h4>1.2.1.接入支付宝开放平台</h4> 
<p>登陆支付宝：<a href="https://openhome.alipay.com/" rel="nofollow" title="支付宝开放平台">支付宝开放平台</a></p> 
<p style="text-align:center;">点击登录按钮之后，使用手机的支付宝进行二维码扫码登录，如下：<img alt="" src="https://images2.imgbox.com/c7/46/Cf8FjWgz_o.png"></p> 
<p>登录成功之后，点击控制台跳转到控制台主页面，将浏览器进度条滚动到最下面，选择沙箱，最后点击沙箱选项即可，如下：</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/42/7e/aQ9qEo4X_o.png"></p> 
<p></p> 
<h4>1.2.2.下载</h4> 
<p>下载安装支付宝开放平台开发助手：<a href="https://opendocs.alipay.com/common/02kipk" rel="nofollow" title="小程序文档 - 支付宝文档中心">小程序文档 - 支付宝文档中心</a></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/d0/05/7HGgVQWU_o.png"></p> 
<blockquote> 
 <p>注意：请不要安装在含有空格的目录路径下，否则会导致公私钥乱码的问题</p> 
</blockquote> 
<p>安装完成之后，点击“支付宝开放平台开发助手”开始生成密钥。</p> 
<p></p> 
<h4>1.2.3.配置秘钥</h4> 
<p>打开支付宝开放平台开发助手，如下：</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/f1/72/IiiAWn6N_o.png"></p> 
<p>选择密钥方式，选择<code>RSA2</code>方式，最后点击生成密钥即可生成得到私钥和公钥。</p> 
<p></p> 
<h4>1.2.4.生成支付宝公钥</h4> 
<p>根据支付宝开放平台开发助手生成的应用公钥，生成支付宝公钥：</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/fe/51/jxe8Tufd_o.png"></p> 
<p>找到支付宝开放平台的沙箱应用一栏，选择“开发信息”接口加签方式中的自定义密钥方式，点击设置并查看按钮：</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/c8/aa/8WKFvF7l_o.png"></p> 
<p>生成支付宝公钥，如下：</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/2d/a8/hO4Z0tRQ_o.png"></p> 
<p></p> 
<h4>1.2.5.配置沙箱账号（买家）</h4> 
<p>配置沙箱账号（买家）并完成手动充值：<a href="https://open.alipay.com/develop/sandbox/account" rel="nofollow" title="登录 - 支付宝">登录 - 支付宝</a></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/b6/80/PaFlBrlF_o.png"></p> 
<h4>1.2.6.下载沙箱支付宝</h4> 
<p>下载沙箱支付宝（只支持安卓）：<a href="https://open.alipay.com/develop/sandbox/tool/alipayclint" rel="nofollow" title="登录 - 支付宝">登录 - 支付宝</a></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/79/a8/I7tC9Bfn_o.png"></p> 
<p></p> 
<h2>2.开发接入</h2> 
<h3>2.1.配置依赖</h3> 
<pre><code class="hljs">&lt;dependency&gt;
    &lt;groupId&gt;com.alipay.sdk&lt;/groupId&gt;
    &lt;artifactId&gt;alipay-easysdk&lt;/artifactId&gt;
    &lt;version&gt;2.0.1&lt;/version&gt;
&lt;/dependency&gt;</code></pre> 
<p></p> 
<h3>2.2.配置AlipayConfig</h3> 
<p>开发文档：<a href="https://opendocs.alipay.com/common/02kg69?pathHash=17912ef4" rel="nofollow" title="小程序文档 - 支付宝文档中心">小程序文档 - 支付宝文档中心</a></p> 
<p>将课件资料中的<code>AlipayConfig.java</code>导入到项目中，并修改主要配置：</p> 
<p><strong>第一步：</strong>修改沙箱支付配置参数：</p> 
<pre><code class="hljs">private Config aliconfig(){
    Config config=new Config();
    //沙箱支付宝地址
    config.gatewayHost="openapi-sandbox.dl.alipaydev.com";
    //协议https
    config.protocol="https";
    //应用ID,您的APPID，收款账号既是您的APPID对应支付宝账号
    config.appId="请填写您的AppId，例如：2019091767145019";
    //支付宝公钥
    config.alipayPublicKey="请填写支付宝公钥";
    //签名方式
    config.signType="RSA2";
    //商户私钥（应用私钥），您的PKCS8格式RSA2私钥
    config.merchantPrivateKey="请填写商户私钥（应用私钥），您的PKCS8格式RSA2私钥";
    return config;
}</code></pre> 
<p>注意：这里沙箱支付宝地址有巨坑，由于支付宝沙箱已经全面升级了，导致接口文档与实际的案例接口不匹配，从而影响了以前的老接口的使用，只需要调整接口地址接口，如下：</p> 
<pre><code class="hljs">//沙箱支付宝老地址
config.gatewayHost="openapi.alipaydev.com";
//沙箱支付宝新地址
config.gatewayHost="openapi-sandbox.dl.alipaydev.com";</code></pre> 
<p></p> 
<p><strong>第二步：</strong>修改沙箱支付的支付方式，改成网页支付：</p> 
<pre><code class="hljs">// 2. 发起API调用
// （subject商品标题、outTradeNo订单编号、totalAmount总金额、returnUrl异步通知地址）
AlipayTradePagePayResponse response = Factory.Payment.Page()
    .pay(orderVo.getOid()+"",
        orderVo.getOid()+"",
        orderVo.getTotal().toString(),
        "http://localhost:8081/page/ok.html");</code></pre> 
<p></p> 
<h3>2.3.修改订单生成代码</h3> 
<p>找到订单生成接口：</p> 
<pre><code class="hljs">@RequestMapping("/addOrder")
@ResponseBody
public String addOrder(OrderVo orderVo,HttpSession session,User user){
    ...
    //沙箱支付
    AlipayConfig alipayConfig=new AlipayConfig();
    return alipayConfig.goAlipay(orderVo);
}</code></pre> 
<pre>    </pre> 
<p>对应的前端接口也需要进行调整，找到<code>order.js</code>修改代码：</p> 
<pre><code class="hljs">let params={
    address:address,
    person:person,
    telephone:phone,
    pay:pay,
    mail:dis,
    gids:gids      //选中结算的商品ID字符串，例如：1,2,3,4
};
location.href='/order/addOrder?'+parseParams(params);
JSON转URL参数的方法：

function parseParams(data) {
    try {
        var tempArr = [];
        for (var i in data) {
            var key = encodeURIComponent(i);
            var value = encodeURIComponent(data[i]);
            tempArr.push(key + '=' + value);
        }
        var urlParamsStr = tempArr.join('&amp;');
        return urlParamsStr;
    } catch (err) {
        return '';
    }
}</code></pre> 
<p>最后，重启测试即可。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e6ed75ba85e1929235acb5062d7e0254/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Docker·1（简介、安装、基本使用）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e2178756678b4c2590a52087d7d60d99/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">redis重启后数据丢失问题解决（亲测好用）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>