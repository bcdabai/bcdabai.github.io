<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Hive整合HBase完整笔记（亲测） - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Hive整合HBase完整笔记（亲测）" />
<meta property="og:description" content="Hive与HBase整合文档 1、 Hive整合HBase配置
1.1 拷贝hbase 相关jar包
将hbase 相关jar包拷贝到hive lib目录下
hbase-client-0.98.13-hadoop2.jar
hbase-common-0.98.13-hadoop2.jar
hbase-server-0.98.13-hadoop2.jar
hbase-common-0.98.13-hadoop2-tests.jar
hbase-protocol-0.98.13-hadoop2.jar
htrace-core-2.04.jar
hive-hbase-handler-1.0.0.jar
zookeeper-3.4.5.jar
1.2 修改hive-site.xml配置文件
将上述jar包添加到hive-site.xml配置的hive.aux.jars.path属性中。
修改hive.zookeeper.quorum属性
添加hbase.zookeeper.quorum属性，此属性hive-site.xml之前不存在。
1.3 修改hive-env.sh配置文件
同默认配置文件中copy一份hive-env.sh文件
修改hive-env.sh配置文件
1.4 启动Hive
上述配置完成之后，通过bin/hive命令启动hive
如果出现以上输出信息，说明hive整合hbase成功。
2、 Hive整合HBase后使用
2.1 准备测试数据
（1）测试数据文件
创建测试文件course.csv
第一列为课程名称，第二列为课程分数
（2）数据加载到HDFS
在hdfs文件系统中创建hive-hbase目录，并加载测试数据。
查看hdfs文件目录
创建/hive-hbase/course目录
将course.csv文件上传至/hive-hbase/course目录下
（3）创建Hive数据库
进入Hive Shell 客户端创建库course
（4）创建Hive表
进入Hive Shell 客户端创建外部表。
create external table if notexists course.testcourse(cname string,score int) row format delimited fieldsterminated by &#39;\t&#39; stored as textfile location &#39;/hive-hbase/course&#39;;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/64c49ec63859a92a5727809aec45cd86/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-03-26T13:30:58+08:00" />
<meta property="article:modified_time" content="2018-03-26T13:30:58+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Hive整合HBase完整笔记（亲测）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h4 align="center">Hive与HBase整合文档</h4> 
<p>1、  Hive整合HBase配置</p> 
<p>1.1   拷贝hbase 相关jar包</p> 
<p>将hbase 相关jar包拷贝到hive lib目录下</p> 
<p><span style="color:#FF0000;">hbase-client-0.98.13-hadoop2.jar</span></p> 
<p><span style="color:#FF0000;">hbase-common-0.98.13-hadoop2.jar</span></p> 
<p><span style="color:#FF0000;">hbase-server-0.98.13-hadoop2.jar</span></p> 
<p><span style="color:#FF0000;">hbase-common-0.98.13-hadoop2-tests.jar</span></p> 
<p><span style="color:#FF0000;">hbase-protocol-0.98.13-hadoop2.jar</span></p> 
<p><span style="color:#FF0000;">htrace-core-2.04.jar</span></p> 
<p><span style="color:#000000;">hive-hbase-handler-1.0.0.jar</span></p> 
<p><span style="color:#000000;">zookeeper-3.4.5.jar</span></p> 
<p>1.2   修改hive-site.xml配置文件</p> 
<p>将上述jar包添加到hive-site.xml配置的hive.aux.jars.path属性中。</p> 
<p><img src="https://images2.imgbox.com/aa/0e/xDY7F4oZ_o.png" alt=""></p> 
<p>    修改hive.zookeeper.quorum属性</p> 
<p><img src="https://images2.imgbox.com/9e/59/9fH5rQBe_o.png" alt=""></p> 
<p>    添加hbase.zookeeper.quorum属性，此属性hive-site.xml之前不存在。</p> 
<p><img src="https://images2.imgbox.com/d3/c1/sVHlp7xB_o.png" alt=""></p> 
<p>1.3   修改hive-env.sh配置文件</p> 
<p>同默认配置文件中copy一份hive-env.sh文件<strong></strong></p> 
<p><img src="https://images2.imgbox.com/df/61/OckIBTlR_o.png" alt=""><strong></strong></p> 
<p>修改hive-env.sh配置文件</p> 
<p><img src="https://images2.imgbox.com/7e/c0/MXA2iLNV_o.png" alt=""></p> 
<p>1.4   启动Hive</p> 
<p>上述配置完成之后，通过bin/hive命令启动hive</p> 
<p><img src="https://images2.imgbox.com/c8/ae/IOAy3E9t_o.png" alt=""></p> 
<p>如果出现以上输出信息，说明hive整合hbase成功。</p> 
<p>2、  Hive整合HBase后使用</p> 
<p>2.1 准备测试数据</p> 
<p>（1）测试数据文件</p> 
<p>创建测试文件course.csv</p> 
<p><img src="https://images2.imgbox.com/b4/af/eZ5fBcdp_o.png" alt=""></p> 
<p>第一列为课程名称，第二列为课程分数</p> 
<p>（2）数据加载到HDFS</p> 
<p>在hdfs文件系统中创建hive-hbase目录，并加载测试数据。</p> 
<p>查看hdfs文件目录</p> 
<p><img src="https://images2.imgbox.com/28/61/BLhPs9lp_o.png" alt=""></p> 
<p>创建/hive-hbase/course目录</p> 
<p><img src="https://images2.imgbox.com/9c/a8/fAFNLGiV_o.png" alt=""></p> 
<p>将course.csv文件上传至/hive-hbase/course目录下</p> 
<p><img src="https://images2.imgbox.com/c7/f7/drZpHCy4_o.png" alt=""></p> 
<p>（3）创建Hive数据库</p> 
<p>进入Hive Shell 客户端创建库course</p> 
<p><img src="https://images2.imgbox.com/15/79/1vavk6YR_o.png" alt=""></p> 
<p>（4）创建Hive表</p> 
<p>进入Hive Shell 客户端创建外部表。</p> 
<p>create external table if notexists course.testcourse(cname string,score int) row format delimited fieldsterminated by '\t' stored as textfile location '/hive-hbase/course';</p> 
<p><img src="https://images2.imgbox.com/8e/f7/leyH7lSD_o.png" alt=""></p> 
<p>（5）查看hive表数据</p> 
<p>select * from course.testcourse;</p> 
<p><img src="https://images2.imgbox.com/e6/e9/qw2DK2Yk_o.png" alt=""></p> 
<p>从查询语句的执行结果可以看出，Hive表中的数据和hdfs上的数据一致。</p> 
<p>2.2 创建Hive内部表</p> 
<p>create table 建表语句声明</p> 
<p>course.hbase_testcourse  所创建的Hive表名称</p> 
<p>(cname string,score int) 所创建Hive表字段</p> 
<p>STORED BY 'org.apache.hadoop.hive.hbase.HBaseStorageHandler' 指定使用Hive Storage Handlers </p> 
<p>WITHSERDEPROPERTIES("hbase.columns.mapping" = ":key,cf:score")  指定HBase表与Hive表字段映射关系。</p> 
<p>TBLPROPERTIES("hbase.table.name"= "hbase_testcourse"); 指定HBase表名</p> 
<p>内部表创建语句如下：</p> 
<p>create tablecourse.hbase_testcourse(cname string,score int) STORED BY 'org.apache.hadoop.hive.hbase.HBaseStorageHandler' WITHSERDEPROPERTIES("hbase.columns.mapping" = ":key,cf:score")TBLPROPERTIES("hbase.table.name" = "hbase_testcourse","hbase.mapred.output.outputtable" = "hbase_testcourse"); </p> 
<p><img src="https://images2.imgbox.com/22/99/0qkslp7l_o.png" alt=""><br></p> 
<p>（1）查看Hive中所创建的表</p> 
<p>进入Hive Shell 客户端执行</p> 
<p>hive&gt; use course;</p> 
<p>hive&gt; show tables;</p> 
<p><img src="https://images2.imgbox.com/40/d9/LSdlCWJA_o.png" alt=""></p> 
<p>（2）查看HBase 中所创建的表</p> 
<p>进入HBase Shell 客户端执行</p> 
<p>bin/hbase shell</p> 
<p><img src="https://images2.imgbox.com/ef/50/JNxlBb8S_o.png" alt=""></p> 
<p><img src="https://images2.imgbox.com/41/85/G0rNZtb1_o.png" alt=""></p> 
<p>2.3 加载数据</p> 
<p> 创建完内部表，可以通过Hive支持的insert overwrite 方式将一个表的数据导入HBase。</p> 
<p>下面是对应的执行语句：</p> 
<p>insert overwrite table course.hbase_testcourseselect cname,score from course.testcourse;</p> 
<p> </p> 
<p> <img src="https://images2.imgbox.com/af/c2/LBz0Xqff_o.png" alt=""></p> 
<p>2.4 执行查询</p> 
<p>加载完数据后，需要验证一下加载结果是否存在问题，验证一下总记录数。</p> 
<p>select count(*) fromcourse.hbase_testcourse;</p> 
<p><img src="https://images2.imgbox.com/25/75/Xir3Tvda_o.png" alt=""></p> 
<p><img src="https://images2.imgbox.com/48/a3/MxIkCV6W_o.png" alt=""><br></p> 
<p> </p> 
<p>2.5 创建外部表</p> 
<p>创建外部表适用于该表在HBase中已经存在，但在Hive中并没有相关信息。此时可以通过创建外部表的方式，为HBase现有表提供SQL查询条件。而内部表适用于Hive和HBase都没有相关表的情况。</p> 
<p>（1）创建HBase表</p> 
<p>进入HBase Shell客户端执行建表命令</p> 
<p>create 'hbase_test',{ NAME =&gt;'cf'}</p> 
<p><img src="https://images2.imgbox.com/18/ec/dMtlEvN3_o.png" alt=""></p> 
<p>（2）插入数据</p> 
<p>执行以下命令插入数据</p> 
<p>put 'hbase_test','hadoop','cf:score', '95'</p> 
<p>put 'hbase_test','storm','cf:score', '96'</p> 
<p>put 'hbase_test','spark','cf:score', '97'</p> 
<p><img src="https://images2.imgbox.com/05/0f/pHI30gUS_o.png" alt=""></p> 
<p>（3）查看数据</p> 
<p>执行扫描表操作</p> 
<p>scan 'hbase_test'</p> 
<p><img src="https://images2.imgbox.com/a4/e0/Ptajzedw_o.png" alt=""></p> 
<p>（4）创建Hive外部表</p> 
<p>进入Hive Shell 客户端，创建外部表course.hbase_test，建表命令如下所示：</p> 
<p>create external tablecourse.hbase_test(cname string,score int) STORED BY  'org.apache.hadoop.hive.hbase.HBaseStorageHandler'WITH SERDEPROPERTIES("hbase.columns.mapping" =":key,cf:score") TBLPROPERTIES("hbase.table.name" ="hbase_test", "hbase.mapred.output.outputtable" = "hbase_test");</p> 
<p>备注：创建外部表和创建内部表的命令基本一致，唯一的区别就是：创建内部表使用create table，创建外部表使用create external table。</p> 
<p><img src="https://images2.imgbox.com/0c/80/gf3fP6uP_o.png" alt=""></p> 
<p>（5）Hive 查看数据</p> 
<p>执行Hive命令查询HBase 表中的数据。</p> 
<p>select * from hbase_test;</p> 
<p><img src="https://images2.imgbox.com/a6/f2/j6cUFkoT_o.png" alt=""></p> 
<p>通过创建外部表可以成功从Hive 查询HBase表中的数据。</p> 
<p> 技术交流群：695520445</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/74f02c771c10b5f26707534f2dea295a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Spring源码分析之BeanPostProcessor接口和BeanFactoryPostProcessor接口方法不执行原因分析</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e526f20fc979f90098e45a5d1934feef/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">简述 TensorFlow 计算模型——计算图</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>