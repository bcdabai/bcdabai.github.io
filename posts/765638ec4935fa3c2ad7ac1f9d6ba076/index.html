<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>RocketMQ安装启动-Docker方式(一) - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="RocketMQ安装启动-Docker方式(一)" />
<meta property="og:description" content="目录 1. Docker安装RocketMQ镜像1.1 搜索RocketMQ镜像1.2 下载rocketmq镜像1.3 下载Rocketmq控制台1.4 启动服务1.4.1 启动namesrv服务1.4.2 启动broker服务1.4.3 启动RocketMQ控制台 broker.conf配置文件信息 1. Docker安装RocketMQ镜像 1.1 搜索RocketMQ镜像 命令:
docker search rocketmq 我们这里使用rocketmqinc/rocketmq镜像
1.2 下载rocketmq镜像 命令:
docker pull rocketmqinc/rocketmq 下载版本为rocketmqinc/rocketmq:latest版本此镜像有server和broker,可直接使用 1.3 下载Rocketmq控制台 命令:
docker pull styletang/rocketmq-console-ng 1.4 启动服务 RocketMQ有两个服务需要启动: namesrv和broker
1.4.1 启动namesrv服务 docker run -d -p 9876:9876 -v /opt/rocketmq/data/namesrv/logs:/root/logs \ -v /opt/rocketmq/data/namesrv/store:/root/store \ --name rmqnamesrv -e &#34;MAX_POSSIBLE_HEAP=100000000&#34; \ rocketmqinc/rocketmq:latest sh mqnamesrv -p 指定端口,前面为外部访问端口,后面为宿主机访问端口-v 挂载目录,将docker内目录和linux目录进行挂载–name 指定当前容器名称-e 指定配置sh mqnamesrv 启动容器内部指令 1.4.2 启动broker服务 获取配置文件
- 可先直接启动broker,然后将其中的配置文件复制出来" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/765638ec4935fa3c2ad7ac1f9d6ba076/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-07-06T17:53:23+08:00" />
<meta property="article:modified_time" content="2021-07-06T17:53:23+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">RocketMQ安装启动-Docker方式(一)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#1_DockerRocketMQ_1" rel="nofollow">1. Docker安装RocketMQ镜像</a></li><li><ul><li><a href="#11_RocketMQ_2" rel="nofollow">1.1 搜索RocketMQ镜像</a></li><li><a href="#12_rocketmq_9" rel="nofollow">1.2 下载rocketmq镜像</a></li><li><a href="#13_Rocketmq_17" rel="nofollow">1.3 下载Rocketmq控制台</a></li><li><a href="#14__22" rel="nofollow">1.4 启动服务</a></li><li><ul><li><a href="#141_namesrv_24" rel="nofollow">1.4.1 启动namesrv服务</a></li><li><a href="#142_broker_37" rel="nofollow">1.4.2 启动broker服务</a></li><li><a href="#143_RocketMQ_68" rel="nofollow">1.4.3 启动RocketMQ控制台</a></li></ul> 
  </li></ul> 
  </li><li><a href="#brokerconf_83" rel="nofollow">broker.conf配置文件信息</a></li></ul> 
</div> 
<p></p> 
<h2><a id="1_DockerRocketMQ_1"></a>1. Docker安装RocketMQ镜像</h2> 
<h3><a id="11_RocketMQ_2"></a>1.1 搜索RocketMQ镜像</h3> 
<p>命令:</p> 
<pre><code class="prism language-java">docker search rocketmq
</code></pre> 
<p><img src="https://images2.imgbox.com/f1/44/8KQSjk0P_o.png" alt="在这里插入图片描述"><br> 我们这里使用rocketmqinc/rocketmq镜像</p> 
<h3><a id="12_rocketmq_9"></a>1.2 下载rocketmq镜像</h3> 
<p>命令:</p> 
<pre><code class="prism language-shell">docker pull rocketmqinc/rocketmq
</code></pre> 
<ol><li>下载版本为rocketmqinc/rocketmq:latest版本</li><li>此镜像有server和broker,可直接使用</li></ol> 
<h3><a id="13_Rocketmq_17"></a>1.3 下载Rocketmq控制台</h3> 
<p>命令:</p> 
<pre><code class="prism language-shell">docker pull styletang/rocketmq-console-ng
</code></pre> 
<h3><a id="14__22"></a>1.4 启动服务</h3> 
<p><strong>RocketMQ有两个服务需要启动: namesrv和broker</strong></p> 
<h4><a id="141_namesrv_24"></a>1.4.1 启动namesrv服务</h4> 
<pre><code class="prism language-shell">		docker run -d -p <span class="token number">9876</span>:9876 
		-v /opt/rocketmq/data/namesrv/logs:/root/logs <span class="token punctuation">\</span>
		-v /opt/rocketmq/data/namesrv/store:/root/store <span class="token punctuation">\</span>
		--name rmqnamesrv -e <span class="token string">"MAX_POSSIBLE_HEAP=100000000"</span> <span class="token punctuation">\</span>
		rocketmqinc/rocketmq:latest <span class="token function">sh</span> mqnamesrv
</code></pre> 
<ol><li>-p 指定端口,前面为外部访问端口,后面为宿主机访问端口</li><li>-v 挂载目录,将docker内目录和linux目录进行挂载</li><li>–name 指定当前容器名称</li><li>-e 指定配置</li><li>sh mqnamesrv 启动容器内部指令</li></ol> 
<h4><a id="142_broker_37"></a>1.4.2 启动broker服务</h4> 
<ol><li>获取配置文件<br> - 可先直接启动broker,然后将其中的配置文件复制出来<br> - <code>docker cp 容器名：要拷贝的文件在容器里面的路径 要拷贝到宿主机的相应路径</code><br> - 复制到/usr/broker.conf位置</li><li>修改配置文件broker.conf<br> - 添加一下配置(更多配置内容见文章末尾)</li></ol> 
<pre><code class="prism language-java">	brokerIP1<span class="token operator">=</span>宿主机<span class="token class-name">IP</span>
	namesrvAddr<span class="token operator">=</span>宿主机IP<span class="token operator">:</span><span class="token number">9876</span>
</code></pre> 
<ol start="3"><li>启动broker服务</li></ol> 
<pre><code class="prism language-java">docker run <span class="token operator">-</span>d <span class="token operator">-</span>p <span class="token number">10911</span><span class="token operator">:</span><span class="token number">10911</span> <span class="token operator">-</span>p <span class="token number">10909</span><span class="token operator">:</span><span class="token number">10909</span> \
<span class="token operator">-</span>v <span class="token operator">/</span>opt<span class="token operator">/</span>rocketmq<span class="token operator">/</span>data<span class="token operator">/</span>broker<span class="token operator">/</span>logs<span class="token operator">:</span><span class="token operator">/</span>root<span class="token operator">/</span>logs \
<span class="token operator">-</span>v <span class="token operator">/</span>opt<span class="token operator">/</span>rocketmq<span class="token operator">/</span>data<span class="token operator">/</span>broker<span class="token operator">/</span>store<span class="token operator">:</span><span class="token operator">/</span>root<span class="token operator">/</span>store \
<span class="token operator">-</span>v <span class="token operator">/</span>usr<span class="token operator">/</span>broker<span class="token punctuation">.</span>conf<span class="token operator">:</span><span class="token operator">/</span>opt<span class="token operator">/</span>rocketmq<span class="token operator">-</span><span class="token number">4.4</span><span class="token number">.0</span><span class="token operator">/</span>conf<span class="token operator">/</span>broker<span class="token punctuation">.</span>conf \
<span class="token operator">--</span>name rmqbroker <span class="token operator">--</span>link rmqnamesrv<span class="token operator">:</span>namesrv \
<span class="token operator">-</span>e <span class="token string">"NAMESRV_ADDR=namesrv:9876"</span> \
<span class="token operator">-</span>e <span class="token string">"MAX_POSSIBLE_HEAP=200000000"</span> \
rocketmqinc<span class="token operator">/</span>rocketmq<span class="token operator">:</span>latest \
sh mqbroker <span class="token operator">-</span>n <span class="token number">192.168</span><span class="token number">.126</span><span class="token number">.130</span><span class="token operator">:</span><span class="token number">9876</span> \
<span class="token operator">-</span>c <span class="token operator">/</span>opt<span class="token operator">/</span>rocketmq<span class="token operator">-</span><span class="token number">4.4</span><span class="token number">.0</span><span class="token operator">/</span>conf<span class="token operator">/</span>broker<span class="token punctuation">.</span>conf autoCreateTopicEnable<span class="token operator">=</span><span class="token boolean">true</span>
</code></pre> 
<p>挂载配置文件:<br> -v /usr/broker.conf:/opt/rocketmq-4.4.0/conf/broker.conf<br> 指定宿主机ip<br> -n 192.168.126.130:9876<br> 启用配置文件<br> -c /opt/rocketmq-4.4.0/conf/broker.conf</p> 
<h4><a id="143_RocketMQ_68"></a>1.4.3 启动RocketMQ控制台</h4> 
<pre><code class="prism language-java">docker run <span class="token operator">--</span>name rocketmq<span class="token operator">-</span>console \
<span class="token operator">-</span>e <span class="token string">"JAVA_OPTS=-Drocketmq.namesrv.addr=192.168.21.152:9876 \
-Dcom.rocketmq.sendMessageWithVIPChannel=false"</span> \
<span class="token operator">-</span>p <span class="token number">8081</span><span class="token operator">:</span><span class="token number">8080</span> <span class="token operator">-</span>t styletang<span class="token operator">/</span>rocketmq<span class="token operator">-</span>console<span class="token operator">-</span>ng
</code></pre> 
<p><strong>访问控制台</strong>: http://虚拟机IP:8081<br> 如果有一个集群说明启动成功, 地址需要显示宿主机IP地址<br> <img src="https://images2.imgbox.com/43/8e/qxhKfCCL_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<hr> 
<h2><a id="brokerconf_83"></a>broker.conf配置文件信息</h2> 
<pre><code class="prism language-java">#所属集群名字
brokerClusterName<span class="token operator">=</span>rocketmq<span class="token operator">-</span>cluster
#broker名字，名字可重复<span class="token punctuation">,</span>为了管理<span class="token punctuation">,</span>每个master起一个名字<span class="token punctuation">,</span>他的slave同他<span class="token punctuation">,</span>eg<span class="token operator">:</span><span class="token class-name">Amaster</span>叫broker<span class="token operator">-</span>a<span class="token punctuation">,</span>他的slave也叫broker<span class="token operator">-</span>a
brokerName<span class="token operator">=</span>broker<span class="token operator">-</span>a
#<span class="token number">0</span> 表示 <span class="token class-name">Master</span>，<span class="token operator">&gt;</span><span class="token number">0</span> 表示 <span class="token class-name">Slave</span>
brokerId<span class="token operator">=</span><span class="token number">0</span>
brokerIp<span class="token operator">=</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>
#nameServer地址，分号分割
namesrvAddr<span class="token operator">=</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">9876</span>
 #在发送消息时，自动创建服务器不存在的topic，默认创建的队列数
defaultTopicQueueNums<span class="token operator">=</span><span class="token number">8</span>
 #是否允许 <span class="token class-name">Broker</span> 自动创建<span class="token class-name">Topic</span>，建议线下开启，线上关闭
autoCreateTopicEnable<span class="token operator">=</span><span class="token boolean">true</span>
#是否允许 <span class="token class-name">Broker</span> 自动创建订阅组，建议线下开启，线上关闭
autoCreateSubscriptionGroup<span class="token operator">=</span><span class="token boolean">true</span>
#<span class="token class-name">Broker</span> 对外服务的监听端口<span class="token punctuation">,</span>
listenPort<span class="token operator">=</span><span class="token number">10911</span>
#删除文件时间点，默认凌晨 <span class="token number">4</span>点
deleteWhen<span class="token operator">=</span><span class="token number">04</span>
#文件保留时间，默认 <span class="token number">48</span> 小时
fileReservedTime<span class="token operator">=</span><span class="token number">48</span>
#commitLog每个文件的大小默认<span class="token number">1</span>G
mapedFileSizeCommitLog<span class="token operator">=</span><span class="token number">1073741824</span>
#<span class="token class-name">ConsumeQueue</span>每个文件默认存<span class="token number">30</span>W条，根据业务情况调整
mapedFileSizeConsumeQueue<span class="token operator">=</span><span class="token number">300000</span>
destroyMapedFileIntervalForcibly<span class="token operator">=</span><span class="token number">120000</span>
redeleteHangedFileInterval<span class="token operator">=</span><span class="token number">120000</span>
#检测物理文件磁盘空间
diskMaxUsedSpaceRatio<span class="token operator">=</span><span class="token number">88</span>
#存储路径
storePathRootDir<span class="token operator">=</span><span class="token class-name">D</span><span class="token operator">:</span>\\rocketMqTestData\\store
#commitLog 存储路径
storePathCommitLog<span class="token operator">=</span><span class="token class-name">D</span><span class="token operator">:</span>\\rocketMqTestData\\store\\commitlog
#消费队列存储路径存储路径
storePathConsumeQueue<span class="token operator">=</span><span class="token class-name">D</span><span class="token operator">:</span>\\rocketMqTestData\\store\\consumequeue
#消息索引存储路径
storePathIndex<span class="token operator">=</span><span class="token class-name">D</span><span class="token operator">:</span>\\rocketMqTestData\\store\\index
#checkpoint 文件存储路径
storeCheckpoint<span class="token operator">=</span><span class="token class-name">D</span><span class="token operator">:</span>\\rocketMqTestData\\store\\checkpoint
#abort 文件存储路径
abortFile<span class="token operator">=</span><span class="token class-name">D</span><span class="token operator">:</span>\\rocketMqTestData\\store\\abort
#限制的消息大小
maxMessageSize<span class="token operator">=</span><span class="token number">65536</span>
flushCommitLogLeastPages<span class="token operator">=</span><span class="token number">4</span>
flushConsumeQueueLeastPages<span class="token operator">=</span><span class="token number">2</span>
flushCommitLogThoroughInterval<span class="token operator">=</span><span class="token number">10000</span>
flushConsumeQueueThoroughInterval<span class="token operator">=</span><span class="token number">60000</span>
#<span class="token class-name">Broker</span> 的角色
brokerRole<span class="token operator">=</span>ASYNC_MASTER
#刷盘方式
flushDiskType<span class="token operator">=</span><span class="token class-name">ASYNC_FLUSH</span>
checkTransactionMessageEnable<span class="token operator">=</span><span class="token boolean">false</span>
#发消息线程池数量
sendMessageTreadPoolNums<span class="token operator">=</span><span class="token number">128</span>
#拉消息线程池数量
pullMessageTreadPoolNums<span class="token operator">=</span><span class="token number">128</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e3b443c1d0def427c7624c7582e93f3a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">oracle-11g镜像部署</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/78a810ea786c898ad53b097490026fd8/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">GD32的flash读、擦除、写操作</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>