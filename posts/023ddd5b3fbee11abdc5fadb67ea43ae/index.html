<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>如何使用Ajax更新echarts工作省份信息 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="如何使用Ajax更新echarts工作省份信息" />
<meta property="og:description" content="第一步 设置点击事件，使用Ajax请求服务器 //入口 $(function(){ //点击事件 $(&#34;#province&#34;).click(function(){ var provinceData=[]; $.ajax({ url:&#34;&lt;%=request.getContextPath()%&gt;/WorkProvinceServlet&#34;, type:&#34;get&#34;, dataType:&#34;json&#34;, success:function(data){ //遍历List，将数据转换为一个对象数组 $(data).each(function(i,v){ var temp={name:v.name,value:v.size};//省份，统计数量 provinceData.push(temp); }); //将处理过后的JSON传入getEchartsMap（）方法中，设置地图数据 getEchartsMap(provinceData); } }); }); }); 第二步 Servlet获取数据库中的数据 Servlet方法 @WebServlet(&#34;/WorkProvinceServlet&#34;) public class WorkProvinceServlet extends HttpServlet { private static final long serialVersionUID = 1L; @Override protected void service(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException { request.setCharacterEncoding(&#34;utf-8&#34;); response.setCharacterEncoding(&#34;utf-8&#34;); System.out.println(&#34;WorkProvinceServlet&#34;); response.setContentType(&#34;text/plain&#34;); WorkProvinceService service=WorkProvinceService.getInstance(); //统计学生在全国各省工作的信息 List&lt;ProvinceTest&gt; l=service.getProvinces(); //将List转为JSON response.getWriter().print(JSON.toJSON(l)); } } Service方法 public class WorkProvinceService { private static WorkProvinceService service=null; private WorkProvinceService() { } public static WorkProvinceService getInstance() { if(service==null) { service=new WorkProvinceService(); } return service; } public List&lt;ProvinceTest&gt; getProvinces() { return CommonDao." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/023ddd5b3fbee11abdc5fadb67ea43ae/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-10-13T00:38:04+08:00" />
<meta property="article:modified_time" content="2019-10-13T00:38:04+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">如何使用Ajax更新echarts工作省份信息</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2><img alt="" class="has" src="https://images2.imgbox.com/3d/4f/nIuAkfjZ_o.png"></h2> 
<h2>第一步</h2> 
<h3>设置点击事件，使用Ajax请求服务器</h3> 
<pre class="has"><code class="language-javascript">//入口          
$(function(){
//点击事件
				$("#province").click(function(){
					var provinceData=[];
					$.ajax({
						url:"&lt;%=request.getContextPath()%&gt;/WorkProvinceServlet",
						type:"get",
						dataType:"json",
						success:function(data){
//遍历List，将数据转换为一个对象数组
							$(data).each(function(i,v){
								var temp={name:v.name,value:v.size};//省份，统计数量
								provinceData.push(temp);
							});
                            //将处理过后的JSON传入getEchartsMap（）方法中，设置地图数据
							getEchartsMap(provinceData);
						}
					});
					
				});
			});</code></pre> 
<h2>第二步</h2> 
<h3>Servlet获取数据库中的数据</h3> 
<h4>Servlet方法</h4> 
<pre class="has"><code class="language-java">@WebServlet("/WorkProvinceServlet")
public class WorkProvinceServlet extends HttpServlet {
	private static final long serialVersionUID = 1L;

	@Override
	protected void service(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		request.setCharacterEncoding("utf-8");
		response.setCharacterEncoding("utf-8");
		System.out.println("WorkProvinceServlet");
		response.setContentType("text/plain");
		WorkProvinceService service=WorkProvinceService.getInstance();
		//统计学生在全国各省工作的信息
		List&lt;ProvinceTest&gt; l=service.getProvinces();
        //将List转为JSON
		response.getWriter().print(JSON.toJSON(l));
	}
       
   
}</code></pre> 
<h4>Service方法</h4> 
<pre class="has"><code class="language-java">public class WorkProvinceService {
	private static WorkProvinceService service=null;
	private WorkProvinceService() {
		
	}
	public static WorkProvinceService getInstance() {
		if(service==null) {
			service=new WorkProvinceService();
		}
		return service;
	}
	public List&lt;ProvinceTest&gt; getProvinces() {
		return CommonDao.getInstance().selectProvincesByGrounp();
	}
}</code></pre> 
<h4>Dao方法</h4> 
<pre class="has"><code class="language-java">public List&lt;ProvinceTest&gt; selectProvincesByGrounp() {
		List&lt;ProvinceTest&gt; L=new ArrayList&lt;ProvinceTest&gt;();
		Connection con = null;
		PreparedStatement stmt = null;
		ResultSet rs = null;
		try {
			// 获取连接
			con = DBUtils2.getConnection();
			// 定义SQL语句
			String sql = "select p.provinceid,p.province,count(*) count from RegistrationCardInfo r,province p\r\n" + 
					"       where r.province=p.provinceid\r\n" + 
					"       group by p.provinceid,p.province";
			// 获取PreparedStatement对象
			stmt = con.prepareStatement(sql);

			rs = stmt.executeQuery();
			while (rs.next()) {
				ProvinceTest p = new ProvinceTest();
				p.setName(rs.getString("province"));
				p.setSize(rs.getInt("count"));
				L.add(p);
			}
		} catch (Exception e) {
			e.printStackTrace();
		}
		return L;
	}</code></pre> 
<h4>ProvineTest类</h4> 
<pre class="has"><code class="language-java">public class ProvinceTest {
	private String name;//省份名
	private Integer size;//数量
	public ProvinceTest() {
		super();
		// TODO Auto-generated constructor stub
	}
	public ProvinceTest(String name, Integer size) {
		super();
		this.name = name;
		this.size = size;
	}
}	</code></pre> 
<h2>第三步</h2> 
<h4>处理返回的数据</h4> 
<pre class="has"><code class="language-javascript">function getEchartsMap(provinceData) {			//工作省份地图
	var myChart = echarts.init(document.getElementById('map'));
	var app = {};
	option = null;
	var data = [
		{ name: '北京', value: 1000 },
		{ name: '郑州', value: 38 },
		{ name: '石家庄', value: 43 },
		{ name: '重庆', value: 54 },
		{ name: '西安', value: 54 },
		{ name: '上海', value: 54 }
	];
	
	var geoCoordMap = {
		'北京': [116.46, 39.92],
		'郑州': [113.65, 34.76],
		'石家庄': [114.48, 38.03],
		'重庆': [106.54, 29.59],
		'西安': [108.95, 34.27],
		'上海': [121.48, 31.22]
	};

	function convertData(data) {
		var res = [];
		for(var i = 0; i &lt; data.length; i++) {
			var geoCoord = geoCoordMap[data[i].name];
			if(geoCoord) {
				res.push({
					name: data[i].name,
					value: geoCoord.concat(data[i].value)
				});
			}
		}
		return res;
	};
	//测试数据
	//alert(provinceData);
	
	option = {
		tooltip: {},
		visualMap: {
			show: false,
			inRange: {
				color: '#fff'
			}
		},
		geo: {
			map: 'china',
			roam: true,
			label: {
				normal: {
					show: true,
					textStyle: {
						color: '#929292',
						fontSize: 8
					}
				}
			},
			itemStyle: {
				normal: {
					borderColor: 'rgba(0, 0, 0, 0.2)'
				},
				emphasis: {
					areaColor: null,
					shadowOffsetX: 0,
					shadowOffsetY: 0,
					shadowBlur: 20,
					borderWidth: 0,
					shadowColor: 'rgba(0, 0, 0, 0.5)'
				}
			}
		},
		series: [
			{
				type: 'scatter',
				coordinateSystem: 'geo',
				data: convertData(data),
				symbolSize: 15,
				symbol: 'image://images/pin_2.svg',
				symbolRotate: 0,
				itemStyle: {
					normal: {
						color: 'red'
					}
				}
			},
			{
				name: '就业地区',
				type: 'map',
				geoIndex: 0,
				data: provinceData//处理传入的数据！！！
			}
		]
		
		/*
		 * 之前的静态数据
		 { name: '北京', value: 1000 },
					{ name: '天津', value: 58 },
					{ name: '上海', value: 78 },
					{ name: '重庆', value: 53 },
					{ name: '河北', value: 27 },
					{ name: '河南', value: 58 },
					{ name: '云南', value: 58 },
					{ name: '辽宁', value: 58 },
					{ name: '黑龙江', value: 58 },
					{ name: '湖南', value: 58 },
					{ name: '安徽', value: 58 },
					{ name: '山东', value: 58 },
					{ name: '新疆', value: 58 },
					{ name: '江苏', value: 58 },
					{ name: '浙江', value: 58 },
					{ name: '江西', value: 58 },
					{ name: '湖北', value: 58 },
					{ name: '广西', value: 58 },
					{ name: '甘肃', value: 58 },
					{ name: '山西', value: 58 },
					{ name: '内蒙古', value: 58 },
					{ name: '陕西', value: 58 },
					{ name: '吉林', value: 58 },
					{ name: '福建', value: 58 },
					{ name: '贵州', value: 58 },
					{ name: '广东', value: 58 },
					{ name: '青海', value: 58 },
					{ name: '西藏', value: 58 },
					{ name: '四川', value: 58 },
					{ name: '宁夏', value: 58 },
					{ name: '海南', value: 58 },
					{ name: '台湾', value: 58 },
					{ name: '香港', value: 58 },
					{ name: '澳门', value: 1231231 }
		 */
	};
	if(option &amp;&amp; typeof option === "object") {
		myChart.setOption(option, true);
	}
}</code></pre> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/fa6fc7bd4d443461a6c80e93917a1417/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">golang 读取redis时间 及time.Parse() 格式</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3a96c10daf383748b43d895e0aca5025/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">FTP 主动模式与被动模式</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>