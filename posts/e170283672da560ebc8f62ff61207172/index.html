<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Spring Security快速入门 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Spring Security快速入门" />
<meta property="og:description" content="1.什么是Spring Security Spring Security： Spring Security是目前Java Web领域中最流行的框架之一，它提供了一系列安全级别，包括基于认证和授权的安全保护，以及各种各样的安全校验，使得开发人员可以非常容易地为应用程序添加安全保护。Spring Security也提供了一种简单易用的方式来定制其过滤器链，以适应具体的安全需求。
（1）在用户认证方面，Spring Security 框架支持主流的认证方式，包括 HTTP 基本认证、HTTP 表单验证、HTTP 摘要认证、OpenID 和 LDAP 等。
（2）在用户授权方面，Spring Security 提供了基于角色的访问控制和访问控制列表（Access Control List，ACL），可以对应用中的领域对象进行细粒度的控制。
2.工作原理和特点 原理: 认证：认证模块负责验证用户身份的合法性，生成认证令牌，并保存到服务端会话中（如TLS）。
鉴权：鉴权模块负责从服务端会话内获取用户身份信息，与访问的资源进行权限比对。
特点： 兼容性强：Spring Security是一个流行的开源框架，它可以与Spring应用程序完美集成。由于它的兼容性很好，因此可以非常方便地使用它保护Web应用程序。
功能强大：Spring Security具备众多功能，包括注销、登录、角色、权限、令牌、XSS防御、CSRF防御等等。它还支持各种身份验证、角色和权限管理方式，如基于表单的认证、基于记住我功能的认证以及OAuth认证等等。
安全可靠：Spring Security具有极高的安全性，它使用最新的安全标准和协议来保护Web应用程序。Spring Security采用安全性分层的策略来保护应用程序中的各个层，例如Web层、Service层、DAO层等等。除此之外，Spring Security还支持自定义安全策略和事件响应，从而使得开发者可以根据应用程序需求定制安全保护。
易于使用：Spring Security提供了一种高度简化的方式来保护Web应用程序。它使用简单的标签和安全注解来添加安全保护，从而使得开发者可以基本不需要手动编写代码就可以完成安全保护。
社区广泛：Spring Security是一个著名的开源框架，因此它有一个庞大的用户社区。这个社区不仅提供了大量的文档、示例和教程，而且还会解答开发者的问题、修复框架中的BUG等等。这为开发者提供了无限的支持和帮助，从而可以使用Spring Security更加自信。
3.代码实战入门 1.基于springboot创建项目 （1）导入依赖
&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/e170283672da560ebc8f62ff61207172/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-21T22:42:46+08:00" />
<meta property="article:modified_time" content="2023-12-21T22:42:46+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Spring Security快速入门</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>1.什么是Spring Security</h2> 
<p><strong>        Spring Security</strong>： <code>Spring Security</code>是目前Java Web领域中最流行的框架之一，它提供了一系列安全级别，包括基于认证和授权的安全保护，以及各种各样的安全校验，使得开发人员可以非常容易地为应用程序添加安全保护。<code>Spring Security</code>也提供了一种简单易用的方式来定制其过滤器链，以适应具体的安全需求。</p> 
<p>      （1）在用户认证方面，<code>Spring Security</code> 框架支持主流的认证方式，包括 HTTP 基本认证、HTTP 表单验证、HTTP 摘要认证、<code>OpenID</code> 和 <code>LDAP</code> 等。</p> 
<p>      （2）在用户授权方面，<code>Spring Security</code> 提供了基于角色的访问控制和访问控制列表（<code>Access Control List，ACL</code>），可以对应用中的领域对象进行细粒度的控制。</p> 
<h2>2.工作原理和特点</h2> 
<h3>原理:</h3> 
<p><strong>        认证</strong>：认证模块负责验证用户身份的合法性，生成认证令牌，并保存到服务端会话中（如TLS）。</p> 
<p><strong>        鉴权</strong>：鉴权模块负责从服务端会话内获取用户身份信息，与访问的资源进行权限比对。</p> 
<h3>特点：</h3> 
<ol><li> <p><strong>兼容性强</strong>：<code>Spring Security</code>是一个流行的开源框架，它可以与Spring应用程序完美集成。由于它的兼容性很好，因此可以非常方便地使用它保护Web应用程序。</p> </li><li> <p><strong>功能强大</strong>：<code>Spring Security</code>具备众多功能，包括注销、登录、角色、权限、令牌、<code>XSS</code>防御、<code>CSRF</code>防御等等。它还支持各种身份验证、角色和权限管理方式，如基于表单的认证、基于记住我功能的认证以及<code>OAuth</code>认证等等。</p> </li><li> <p><strong>安全可靠</strong>：<code>Spring Security</code>具有极高的安全性，它使用最新的安全标准和协议来保护Web应用程序。<code>Spring Security</code>采用安全性分层的策略来保护应用程序中的各个层，例如<code>Web</code>层、<code>Service</code>层、<code>DAO</code>层等等。除此之外，<code>Spring Security</code>还支持自定义安全策略和事件响应，从而使得开发者可以根据应用程序需求定制安全保护。</p> </li><li> <p><strong>易于使用</strong>：<code>Spring Security</code>提供了一种高度简化的方式来保护Web应用程序。它使用简单的标签和安全注解来添加安全保护，从而使得开发者可以基本不需要手动编写代码就可以完成安全保护。</p> </li><li> <p><strong>社区广泛</strong>：<code>Spring Security</code>是一个著名的开源框架，因此它有一个庞大的用户社区。这个社区不仅提供了大量的文档、示例和教程，而且还会解答开发者的问题、修复框架中的BUG等等。这为开发者提供了无限的支持和帮助，从而可以使用<code>Spring Security</code>更加自信。</p> </li></ol> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/57/3e/UmnTo6aA_o.png"></p> 
<p style="text-align:center;"></p> 
<h2>3.代码实战入门 </h2> 
<h3>    1.基于springboot创建项目 </h3> 
<p>        （1）导入依赖</p> 
<pre><code class="hljs">&lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;
            &lt;scope&gt;runtime&lt;/scope&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
            &lt;artifactId&gt;lombok&lt;/artifactId&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.security&lt;/groupId&gt;
            &lt;artifactId&gt;spring-security-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-freemarker&lt;/artifactId&gt;
        &lt;/dependency&gt;</code></pre> 
<p>（2）配置yml文件</p> 
<pre><code class="hljs">spring:
    freemarker:
        suffix: .ftl
        template-loader-path: classpath:/templates/
        enabled: true
</code></pre> 
<p>（3）创建控制类，定义请求处理方法</p> 
<pre><code class="hljs">@Controller
public class HelloController {

    @RequestMapping("/hello")
    public String hello(){
       return "hello,spring security";
    }
}</code></pre> 
<p>（4）启动项目，系统会自动生成一个默认的随机登录密码（因为当前没有配置用户信息，配置之后就不会在生成默认登录密码）</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/8b/ec/JLRPolzC_o.png"></p> 
<p> 注：这是 <code>Spring Security</code> 为默认用户 <strong>user</strong> 生成的临时密码，是一个 <strong>UUID 字符串</strong>。</p> 
<p>（5）访问登录页并进行测试</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/f9/67/X7V42ysd_o.png"> </p> 
<p>（6）在<code>yml</code>文件中配置自定义用户名和密码。  </p> 
<pre><code class="hljs">spring:
  security:
    user:
      name: admin
      password: 123456</code></pre> 
<p>配置成功后，重启服务并进行测试</p> 
<p></p> 
<h2>4.<strong style="color:#4f4f4f;font-size:22px;font-weight:bold;">实现自定义的登录</strong></h2> 
<h6>     1.自定义一个登录页面</h6> 
<pre><code class="hljs">&lt;h1&gt;用户登录&lt;/h1&gt;
&lt;form action="/userLogin" method="post"&gt;
    &lt;label&gt;用户：&lt;/label&gt;&lt;input type="text" name="username"/&gt;&lt;br/&gt;
    &lt;label&gt;密码：&lt;/label&gt;&lt;input type="password" name="password"/&gt;&lt;br/&gt;
    &lt;input type="submit" value="登录"/&gt;
&lt;/form&gt;</code></pre> 
<p>     主页：</p> 
<pre><code class="hljs">&lt;body&gt;
&lt;h1&gt;Welcome&lt;/h1&gt;
&lt;h2&gt;Spring Security&lt;/h2&gt;
&lt;div style="position: absolute;top:15px;right:15px;"&gt;
    &lt;a href="/toLogin"&gt;用户登录&lt;/a&gt;
    &lt;a href="/logout" onclick="return confirm('确认退出吗？');"&gt;安全退出&lt;/a&gt;
&lt;/div&gt;
&lt;h4&gt;管理员&lt;/h4&gt;
&lt;ul&gt;
    &lt;li&gt;&lt;a href="/admin/toAddUser"&gt;新增用户&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href="/admin/toListUser"&gt;用户列表&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href="/admin/toResetPwd"&gt;重置密码&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href="/admin/toUpdateUser"&gt;修改用户&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
    &lt;h4&gt;普通用户&lt;/h4&gt;
    &lt;li&gt;&lt;a href="/user/toUpdatePwd"&gt;修改密码&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/body&gt;</code></pre> 
<p> </p> 
<p>      2.创建控制层</p> 
<pre><code class="hljs">@Controller
public class UserController {

    @RequestMapping("/toLogin")
    public String toLogin(){
        return "login";
    }

    @RequestMapping("/userLogin")
    public String userLogin(String username,String password){
        System.out.println("username="+username+",password="+password);
        return "index";
    }

    @RequestMapping("/admin/toAddUser")
    public String toAddUser(){
        return "admin/addUser";
    }

    @RequestMapping("/admin/toListUser")
    public String toListUser(){
        return "admin/listUser";
    }

    @RequestMapping("/admin/toResetPwd")
    public String toResetPwd(){
        return "admin/resetPwd";
    }

    @RequestMapping("/admin/toUpdateUser")
    public String toUpdateUser(){
        return "admin/updateUser";
    }

    @RequestMapping("/user/toUpdatePwd")
    public String toUpdatePwd(){
        return "user/updatePwd";
    }
}</code></pre> 
<p>3.创建配置类</p> 
<p>进行一个自定义登录的配置之后加入一个Spring Security的安全退出设置，然后可以配置多用户角色的访问，通过修改SecurityConfig配置类，可以实现多用户的角色配置，再配置一个自定义异常处理器，设置不同角色的访问权限 </p> 
<p>注：在配置多用户角色访问的时候需要删除或注释yml文件中配置的自定义用户名和密码 </p> 
<p></p> 
<pre><code class="hljs">@Configuration
@EnableWebSecurity
public class WebSecurityConfig {

    @Bean
    public PasswordEncoder bcryptPasswordEncoder() {
	    return new BCryptPasswordEncoder();
    }
    //多用户角色配置  注意：此处采用的是基于内存方式储存身份和授权信息。
    @Bean
    public UserDetailsService userDetailsService(){
        UserDetails admin = User.withUsername("admin")
        	.password(bcryptPasswordEncoder().encode("123456"))
           	.roles("ADMIN", "USER").build();
        UserDetails user = User.withUsername("user")
        	.password(bcryptPasswordEncoder().encode("123456"))
        	.roles("USER").build();
        return new InMemoryUserDetailsManager(admin,user);
    }
   
    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
        http.authorizeRequests()
                // 开放接口访问权限，不需要登录授权就可以访问
                .antMatchers("/hello","/","/toLogin").permitAll()
                // 设置角色权限
                .antMatchers("/admin/**").hasRole("ADMIN")
                .antMatchers("/user/**").hasAnyRole("ADMIN","USER")
                // 其余所有请求全部需要鉴权认证
                .anyRequest().authenticated()
                .and()
                .formLogin()
                // 设置登录页面的 URL
                .loginPage("/toLogin")
                // 设置登录请求的 URL，即表单提交的 URL
                .loginProcessingUrl("/userLogin")
                // 设置登录表单中用户名字段的参数名，默认为username
                .usernameParameter("username")
                // 设置登录表单中密码字段的参数名，默认为password
                .passwordParameter("password")
                .and()
                .logout()
                 // 设置安全退出的URL路径
                .logoutUrl("/logout")
                // 设置退出成功后跳转的路径
                .logoutSuccessUrl("/");
        //添加关闭`csrf`配置
        http.csrf().disable();
        return http.build();
    }

</code></pre> 
<p>没有访问权限的页面</p> 
<pre><code class="hljs">&lt;body&gt;
&lt;h1&gt;未授权的操作&lt;/h1&gt;
&lt;div&gt;
    未授权的操作，请与管理员联系，或切换账号重新
    &lt;a href="/logout" onclick="return confirm('确认退出吗？');"&gt;登录&lt;/a&gt;
    后再试！
&lt;/div&gt;
&lt;/body&gt;</code></pre> 
<p><strong>异常说明：</strong></p> 
<p><code>java.lang.IllegalArgumentException: There is no PasswordEncoder mapped for the id "null"</code></p> 
<p><strong>解决方案：</strong>这个错误通常是因为在使用 <code>Spring Security</code> 进行密码验证时没有正确地配置密码编码器。在 <code>Spring Security</code> 中，密码编码器用于将用户提供的密码编码为安全的散列值，并将其与存储在数据库中的散列值进行比较。如果没有正确地配置密码编码器，则 <code>Spring Security</code> 将无法识别密码编码器的类型，并在比较密码时引发“没有映射到 id“null”的密码编码器”异常。要解决这个问题，需要在 <code>Spring Security</code> 配置中配置一个密码编码器，并将其用于验证用户提供的密码。常用的密码编码器有 <code>BCryptPasswordEncoder</code> 和 <code>StandardPasswordEncoder</code>。</p> 
<p></p> 
<p>最后通过切换不同的用户（<code>user</code>和<code>admin</code>）来测试角色权限是否授权成功，<code>admin</code>账号访问所有接口权限正常；切换到<code>user</code>账号访问时，发现以<code>/admin/**</code>开头的接口不能访问（<strong>证明鉴权成功</strong>），但是却提示403错误。</p> 
<p><strong>解决方案：配置自定义异常处理器</strong></p> 
<p>修改<code>SecurityConfig</code>配置类，添加自定义异常处理，并设置异常处理页面</p> 
<pre><code class="hljs">http.exceptionHandling().accessDeniedPage("/noauth")</code></pre> 
<p>重启项目后发现无权限将跳转到自定义异常页面。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/81a191dcdcb8464b3afc18dd914751ab/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">MySQL锁</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ec452e8b50ed14469151b5347631e818/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">spark-thrift-server 报错 Wrong FS</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>