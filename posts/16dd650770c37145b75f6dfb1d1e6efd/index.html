<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>android lcm驱动解读及调试 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="android lcm驱动解读及调试" />
<meta property="og:description" content="lcm驱动的源代码解读 在我们调屏之前，我们一定要弄懂源代码框架以及每一行代码代表的意思，那么就让我们首先来看看代码（以ili9806e为例） 1 #if defined(BUILD_LK) 2 #include &lt;string.h&gt; 3 #else 4 #include &lt;linux/string.h&gt; 5 #endif 6 7 #ifdef BUILD_LK 8 #include &lt;platform/disp_drv_platform.h&gt; 9 10 #elif defined(BUILD_UBOOT) 11 #include &lt;asm/arch/mt_gpio.h&gt; 12 #else 13 //#include &lt;linux/delay.h&gt; 14 #include &lt;mach/mt_gpio.h&gt; 15 #endif 16 #include &lt;cust_gpio_usage.h&gt; 17 18 #include &#34;lcm_drv.h&#34; 19 20 22 // -------------------------------------------------------------------- 23 // Local Constants 24 // --------------------------------------------------------------------- 25 26 #define FRAME_WIDTH (480) 27 #define FRAME_HEIGHT (800) 28 29 #define REGFLAG_DELAY 0xFD 30 #define REGFLAG_END_OF_TABLE 0xFE // END OF REGISTERS MARKER 31 32 #define LCM_DSI_CMD_MODE 0 33 34 35 #ifndef TRUE 36 #define TRUE 1 37 #endif 38 39 #ifndef FALSE 40 #define FALSE 0 41 #endif 42 43 #define GPIO_LCM_ID GPIO18 44 #define LCM_TDT 0 45 46 bool lcm_ili9806e_vendor=LCM_TDT; //default to choose byd panel 47 48 49 //set LCM IC ID 50 #define LCM_ID_ILI9806E (0x980604) 51 52 #define LCM_DEBUG 53 54 55 56 // ---------------------------------------------------------------------- 57 // Local Variables 58 // ---------------------------------------------------------------------- 59 60 static LCM_UTIL_FUNCS lcm_util = {0}; 61 62 //复位引脚 63 #define SET_RESET_PIN(v) (lcm_util." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/16dd650770c37145b75f6dfb1d1e6efd/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2016-11-30T10:29:18+08:00" />
<meta property="article:modified_time" content="2016-11-30T10:29:18+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">android lcm驱动解读及调试</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3 id="lcm驱动的源代码解读">lcm驱动的源代码解读</h3> 
<pre><code>在我们调屏之前，我们一定要弄懂源代码框架以及每一行代码代表的意思，那么就让我们首先来看看代码（以ili9806e为例）
</code></pre> 
<pre class="prettyprint"><code class=" hljs cs">  <span class="hljs-number">1</span> <span class="hljs-preprocessor">#<span class="hljs-keyword">if</span> defined(BUILD_LK)</span>
  <span class="hljs-number">2</span> <span class="hljs-preprocessor">#include &lt;string.h&gt;</span>
  <span class="hljs-number">3</span> <span class="hljs-preprocessor">#<span class="hljs-keyword">else</span></span>
  <span class="hljs-number">4</span> <span class="hljs-preprocessor">#include &lt;linux/string.h&gt;</span>
  <span class="hljs-number">5</span> <span class="hljs-preprocessor">#<span class="hljs-keyword">endif</span></span>
  <span class="hljs-number">6</span> 
  <span class="hljs-number">7</span> <span class="hljs-preprocessor">#ifdef BUILD_LK</span>
  <span class="hljs-number">8</span>     <span class="hljs-preprocessor">#include &lt;platform/disp_drv_platform.h&gt;</span>
  <span class="hljs-number">9</span> 
 <span class="hljs-number">10</span> <span class="hljs-preprocessor">#<span class="hljs-keyword">elif</span> defined(BUILD_UBOOT)</span>
 <span class="hljs-number">11</span>     <span class="hljs-preprocessor">#include &lt;asm/arch/mt_gpio.h&gt;</span>
 <span class="hljs-number">12</span> <span class="hljs-preprocessor">#<span class="hljs-keyword">else</span></span>
 <span class="hljs-number">13</span>     <span class="hljs-comment">//#include &lt;linux/delay.h&gt;</span>
 <span class="hljs-number">14</span>     <span class="hljs-preprocessor">#include &lt;mach/mt_gpio.h&gt;</span>
 <span class="hljs-number">15</span> <span class="hljs-preprocessor">#<span class="hljs-keyword">endif</span></span>
 <span class="hljs-number">16</span> <span class="hljs-preprocessor">#include &lt;cust_gpio_usage.h&gt;</span>
 <span class="hljs-number">17</span> 
 <span class="hljs-number">18</span> <span class="hljs-preprocessor">#include "lcm_drv.h"</span>
 <span class="hljs-number">19</span> 
 <span class="hljs-number">20</span> 


 <span class="hljs-number">22</span> <span class="hljs-comment">// --------------------------------------------------------------------</span>
 <span class="hljs-number">23</span> <span class="hljs-comment">//  Local Constants</span>
 <span class="hljs-number">24</span> <span class="hljs-comment">// ---------------------------------------------------------------------</span>
 <span class="hljs-number">25</span> 
 <span class="hljs-number">26</span> <span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> FRAME_WIDTH                    (480)</span>
 <span class="hljs-number">27</span> <span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> FRAME_HEIGHT                   (800)</span>
 <span class="hljs-number">28</span> 
 <span class="hljs-number">29</span> <span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> REGFLAG_DELAY                  0xFD</span>
 <span class="hljs-number">30</span> <span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> REGFLAG_END_OF_TABLE           0xFE   // END OF REGISTERS MARKER</span>
 <span class="hljs-number">31</span> 
 <span class="hljs-number">32</span> <span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> LCM_DSI_CMD_MODE               0</span>
 <span class="hljs-number">33</span> 
 <span class="hljs-number">34</span>
 <span class="hljs-number">35</span> <span class="hljs-preprocessor">#ifndef TRUE</span>
 <span class="hljs-number">36</span>     <span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> TRUE 1</span>
 <span class="hljs-number">37</span> <span class="hljs-preprocessor">#<span class="hljs-keyword">endif</span></span>
 <span class="hljs-number">38</span> 
 <span class="hljs-number">39</span> <span class="hljs-preprocessor">#ifndef FALSE</span>
 <span class="hljs-number">40</span>     <span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> FALSE 0</span>
 <span class="hljs-number">41</span> <span class="hljs-preprocessor">#<span class="hljs-keyword">endif</span></span>
 <span class="hljs-number">42</span> 
 <span class="hljs-number">43</span> <span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> GPIO_LCM_ID GPIO18</span>
 <span class="hljs-number">44</span> <span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> LCM_TDT         0</span>
 <span class="hljs-number">45</span> 
 <span class="hljs-number">46</span> <span class="hljs-keyword">bool</span> lcm_ili9806e_vendor=LCM_TDT;   <span class="hljs-comment">//default to choose byd panel</span>
 <span class="hljs-number">47</span> 
 <span class="hljs-number">48</span> 
 <span class="hljs-number">49</span> <span class="hljs-comment">//set LCM IC ID</span>
 <span class="hljs-number">50</span> <span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> LCM_ID_ILI9806E                (0x980604)</span>
 <span class="hljs-number">51</span> 
 <span class="hljs-number">52</span> <span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> LCM_DEBUG</span>
 <span class="hljs-number">53</span> 
 <span class="hljs-number">54</span> 
 <span class="hljs-number">55</span> 


 <span class="hljs-number">56</span> <span class="hljs-comment">// ----------------------------------------------------------------------</span>
 <span class="hljs-number">57</span> <span class="hljs-comment">//  Local Variables</span>
 <span class="hljs-number">58</span> <span class="hljs-comment">// ----------------------------------------------------------------------</span>
 <span class="hljs-number">59</span> 
 <span class="hljs-number">60</span> <span class="hljs-keyword">static</span> LCM_UTIL_FUNCS lcm_util = {<!-- --><span class="hljs-number">0</span>};
 <span class="hljs-number">61</span> 
 <span class="hljs-number">62</span> <span class="hljs-comment">//复位引脚</span>
 <span class="hljs-number">63</span> <span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> SET_RESET_PIN(v)    (lcm_util.set_reset_pin((v)))   //这里就会直接使用GPIO_LCD_RST硬引脚</span>
 <span class="hljs-number">64</span> <span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> UDELAY(n)           (lcm_util.udelay(n))</span>
 <span class="hljs-number">65</span> <span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> MDELAY(n)           (lcm_util.mdelay(n))</span>
 <span class="hljs-number">66</span> 


 <span class="hljs-number">68</span> <span class="hljs-comment">// ----------------------------------------------------------------------</span>
 <span class="hljs-number">69</span> <span class="hljs-comment">//  Local Functions</span>
 <span class="hljs-number">70</span> <span class="hljs-comment">// ----------------------------------------------------------------------</span>
 <span class="hljs-number">71</span> 
 <span class="hljs-number">72</span> <span class="hljs-comment">/**********数据传输接口***************/</span>
 <span class="hljs-number">73</span> <span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> dsi_set_cmdq_V2(cmd, count, ppara, force_update) lcm_util.dsi_set_cmdq_V2(cmd, count, ppara, force_update)</span>
 <span class="hljs-number">74</span> <span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> dsi_set_cmdq(pdata, queue_size, force_update)       lcm_util.dsi_set_cmdq(pdata, queue_size, force_update)</span>
 <span class="hljs-number">75</span> 
 <span class="hljs-number">76</span> <span class="hljs-comment">/*********读写寄存器接口函数*********/</span>
 <span class="hljs-number">77</span> <span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> wrtie_cmd(cmd)                             lcm_util.dsi_write_cmd(cmd)</span>
 <span class="hljs-number">78</span> <span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> write_regs(addr, pdata, byte_nums)                  lcm_util.dsi_write_regs(addr, pdata, byte_nums)</span>
 <span class="hljs-number">79</span> <span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> read_reg(cmd)                                       lcm_util.dsi_dcs_read_lcm_reg(cmd)</span>
 <span class="hljs-number">80</span> <span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> read_reg_v2(cmd, buffer, buffer_size)               lcm_util.dsi_dcs_read_lcm_reg_v2(cmd, buffer, buffer_size)</span>
 <span class="hljs-number">81</span> 
 <span class="hljs-number">82</span> 
 <span class="hljs-number">83</span> <span class="hljs-keyword">struct</span> LCM_setting_table {
 <span class="hljs-number">84</span>     unsigned <span class="hljs-keyword">char</span> cmd;
 <span class="hljs-number">85</span>     unsigned <span class="hljs-keyword">char</span> count;
 <span class="hljs-number">86</span>     unsigned <span class="hljs-keyword">char</span> para_list[<span class="hljs-number">64</span>];
 <span class="hljs-number">87</span> };
 <span class="hljs-number">88</span> 
 <span class="hljs-number">90</span> <span class="hljs-comment">/*************** 初始化参数及函数接口 *******************/</span>
 <span class="hljs-number">91</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">struct</span> LCM_setting_table lcm_initialization_setting[] = {
 <span class="hljs-number">92</span> 
 <span class="hljs-number">93</span>             <span class="hljs-comment">/* 数据格式：命令，数据个数，数据 */</span>  <span class="hljs-comment">//命令一般是对应寄存器地址</span>
 <span class="hljs-number">94</span> 
 <span class="hljs-number">95</span>     {<!-- --><span class="hljs-number">0xFF</span>,<span class="hljs-number">5</span>,{<!-- --><span class="hljs-number">0xFF</span>,<span class="hljs-number">0x98</span>,<span class="hljs-number">0x06</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x01</span>}},<span class="hljs-comment">//ChangetoPage1</span>
 <span class="hljs-number">96</span>     {<!-- --><span class="hljs-number">0x08</span>,<span class="hljs-number">1</span>,{<!-- --><span class="hljs-number">0x10</span>}},<span class="hljs-comment">//outputSDA</span>
 <span class="hljs-number">97</span>     {<!-- --><span class="hljs-number">0x21</span>,<span class="hljs-number">1</span>,{<!-- --><span class="hljs-number">0x01</span>}},<span class="hljs-comment">//DE=1Active</span>
 <span class="hljs-number">98</span>     {<!-- --><span class="hljs-number">0x30</span>,<span class="hljs-number">1</span>,{<!-- --><span class="hljs-number">0x02</span>}},<span class="hljs-comment">//480X800</span>
 <span class="hljs-number">99</span>     {<!-- --><span class="hljs-number">0x31</span>,<span class="hljs-number">1</span>,{<!-- --><span class="hljs-number">0x00</span>}},<span class="hljs-comment">//ColumnInversion</span>
<span class="hljs-number">100</span>     {<!-- --><span class="hljs-number">0x60</span>,<span class="hljs-number">1</span>,{<!-- --><span class="hljs-number">0x07</span>}},<span class="hljs-comment">//SDTI</span>
<span class="hljs-number">101</span>     {<!-- --><span class="hljs-number">0x61</span>,<span class="hljs-number">1</span>,{<!-- --><span class="hljs-number">0x04</span>}},<span class="hljs-comment">//CRTI</span>
<span class="hljs-number">102</span>     {<!-- --><span class="hljs-number">0x62</span>,<span class="hljs-number">1</span>,{<!-- --><span class="hljs-number">0x08</span>}},<span class="hljs-comment">//EQTI</span>
<span class="hljs-number">103</span>     {<!-- --><span class="hljs-number">0x63</span>,<span class="hljs-number">1</span>,{<!-- --><span class="hljs-number">0x04</span>}},<span class="hljs-comment">//PCTI</span>
<span class="hljs-number">104</span>     {<!-- --><span class="hljs-number">0x40</span>,<span class="hljs-number">1</span>,{<!-- --><span class="hljs-number">0x10</span>}},<span class="hljs-comment">//10</span>
<span class="hljs-number">105</span>     {<!-- --><span class="hljs-number">0x41</span>,<span class="hljs-number">1</span>,{<!-- --><span class="hljs-number">0x44</span>}},<span class="hljs-comment">//77//DVDDHDVDDLclamp</span>
<span class="hljs-number">106</span>     {<!-- --><span class="hljs-number">0x42</span>,<span class="hljs-number">1</span>,{<!-- --><span class="hljs-number">0x03</span>}},<span class="hljs-comment">//11//VGH/VGL00</span>
<span class="hljs-number">107</span>     {<!-- --><span class="hljs-number">0x43</span>,<span class="hljs-number">1</span>,{<!-- --><span class="hljs-number">0x89</span>}},<span class="hljs-comment">//VGH/VGL</span>
<span class="hljs-number">108</span>     {<!-- --><span class="hljs-number">0x44</span>,<span class="hljs-number">1</span>,{<!-- --><span class="hljs-number">0x86</span>}},<span class="hljs-comment">//VGH/VGL</span>
<span class="hljs-number">109</span>     <span class="hljs-comment">//{0x45,1,{0x1B}},//VGL_REG-10V</span>
            .....(此处省略代码n条初始化代码）
<span class="hljs-number">234</span>     {<!-- --><span class="hljs-number">0x11</span>,<span class="hljs-number">1</span>,{<!-- --><span class="hljs-number">0x00</span>}},                 <span class="hljs-comment">// Sleep-Out  </span>
<span class="hljs-number">235</span>     {REGFLAG_DELAY,<span class="hljs-number">120</span>,{}},
<span class="hljs-number">236</span>     {<!-- --><span class="hljs-number">0x29</span>,<span class="hljs-number">1</span>,{<!-- --><span class="hljs-number">0x00</span>}},
<span class="hljs-number">237</span>     {REGFLAG_DELAY, <span class="hljs-number">20</span>, {}},
<span class="hljs-number">238</span>   <span class="hljs-comment">//{0xFF,5,{0xFF,0x98,0x06,0x04,0x08}},   // Change to Page 8</span>
<span class="hljs-number">239</span>     {REGFLAG_END_OF_TABLE, <span class="hljs-number">0x00</span>, {}}
<span class="hljs-number">240</span> };
<span class="hljs-number">241</span> 

<span class="hljs-number">420</span> <span class="hljs-comment">/*******************初始化数据的函数************************/</span>
<span class="hljs-number">421</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> push_table(<span class="hljs-keyword">struct</span> LCM_setting_table *table, unsigned <span class="hljs-keyword">int</span> count, unsigned <span class="hljs-keyword">char</span> force_update)
<span class="hljs-number">422</span> {
<span class="hljs-number">423</span>     unsigned <span class="hljs-keyword">int</span> i;
<span class="hljs-number">424</span> 
<span class="hljs-number">425</span>     <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; count; i++) {
<span class="hljs-number">426</span> 
<span class="hljs-number">427</span>         unsigned cmd;
<span class="hljs-number">428</span>         cmd = table[i].cmd;
<span class="hljs-number">429</span> 
<span class="hljs-number">430</span>         <span class="hljs-keyword">switch</span> (cmd) {
<span class="hljs-number">431</span> 
<span class="hljs-number">432</span>             <span class="hljs-keyword">case</span> REGFLAG_DELAY :
<span class="hljs-number">433</span>                 MDELAY(table[i].count);
<span class="hljs-number">434</span>                 <span class="hljs-keyword">break</span>;
<span class="hljs-number">435</span> 
<span class="hljs-number">436</span>             <span class="hljs-keyword">case</span> REGFLAG_END_OF_TABLE :
<span class="hljs-number">437</span>                 <span class="hljs-keyword">break</span>;
<span class="hljs-number">438</span> 
<span class="hljs-number">439</span>             <span class="hljs-keyword">default</span>:
<span class="hljs-number">440</span>         dsi_set_cmdq_V2(cmd, table[i].count, table[i].para_list, force_update);
<span class="hljs-number">441</span>         }
<span class="hljs-number">442</span>     }
<span class="hljs-number">443</span> 
<span class="hljs-number">444</span> }
<span class="hljs-number">445</span> 

<span class="hljs-number">448</span> <span class="hljs-comment">// ----------------------------------------------------------------------</span>
<span class="hljs-number">449</span> <span class="hljs-comment">//  LCM Driver Implementations</span>
<span class="hljs-number">450</span> <span class="hljs-comment">// ----------------------------------------------------------------------</span>
<span class="hljs-number">451</span> 
<span class="hljs-number">452</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> lcm_set_util_funcs(<span class="hljs-keyword">const</span> LCM_UTIL_FUNCS *util)
<span class="hljs-number">453</span> {
<span class="hljs-number">454</span>     memcpy(&amp;lcm_util, util, <span class="hljs-keyword">sizeof</span>(LCM_UTIL_FUNCS));
<span class="hljs-number">455</span> }
<span class="hljs-number">456</span> 
<span class="hljs-number">457</span> 
<span class="hljs-number">458</span> <span class="hljs-comment">/* 获取lcm各个参数 */</span>
<span class="hljs-number">459</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> lcm_get_params(LCM_PARAMS *<span class="hljs-keyword">params</span>)
<span class="hljs-number">460</span> {
<span class="hljs-number">461</span>     memset(<span class="hljs-keyword">params</span>, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(LCM_PARAMS));        <span class="hljs-comment">//先将LCM_PARAMS结构清空</span>
<span class="hljs-number">462</span> 
<span class="hljs-number">463</span>     <span class="hljs-keyword">params</span>-&gt;type   = LCM_TYPE_DSI;                <span class="hljs-comment">//lcm接口类型</span>
<span class="hljs-number">464</span> 
<span class="hljs-number">465</span>     <span class="hljs-keyword">params</span>-&gt;width  = FRAME_WIDTH;                 <span class="hljs-comment">//lcm显示宽度</span>
<span class="hljs-number">466</span>     <span class="hljs-keyword">params</span>-&gt;height = FRAME_HEIGHT;                <span class="hljs-comment">//lcm显示高度</span>
<span class="hljs-number">467</span> 
<span class="hljs-number">468</span>     <span class="hljs-comment">/*********设置通信模式*************/</span>
<span class="hljs-number">469</span> 
<span class="hljs-number">470</span>     <span class="hljs-comment">// enable tearing-free</span>
<span class="hljs-number">471</span> <span class="hljs-preprocessor">#ifndef BUILD_UBOOT</span>
<span class="hljs-number">472</span>     <span class="hljs-comment">//params-&gt;dbi.te_mode               = LCM_DBI_TE_MODE_VSYNC_ONLY;</span>
<span class="hljs-number">473</span>     <span class="hljs-comment">//params-&gt;dbi.te_edge_polarity      = LCM_POLARITY_RISING;</span>
<span class="hljs-number">474</span>     <span class="hljs-keyword">params</span>-&gt;dbi.te_mode                 = LCM_DBI_TE_MODE_DISABLED;
<span class="hljs-number">475</span> <span class="hljs-preprocessor">#<span class="hljs-keyword">endif</span></span>
<span class="hljs-number">476</span> 
<span class="hljs-number">477</span>         <span class="hljs-comment">/* dsi分两种模式，一种是cmd模式，一种是video模式 */</span>
<span class="hljs-number">478</span> <span class="hljs-preprocessor">#<span class="hljs-keyword">if</span> (LCM_DSI_CMD_MODE)  </span>
<span class="hljs-number">479</span>     <span class="hljs-keyword">params</span>-&gt;dsi.mode = CMD_MODE;            <span class="hljs-comment">//cmd模式</span>
<span class="hljs-number">480</span> <span class="hljs-preprocessor">#<span class="hljs-keyword">else</span></span>
<span class="hljs-number">481</span>     <span class="hljs-keyword">params</span>-&gt;dsi.mode   = SYNC_PULSE_VDO_MODE;
<span class="hljs-number">482</span> <span class="hljs-preprocessor">#<span class="hljs-keyword">endif</span></span>
<span class="hljs-number">483</span> 
<span class="hljs-number">484</span>     <span class="hljs-comment">/*××××××××××××设置数据格式××××××××××××*/</span>
<span class="hljs-number">485</span> 
<span class="hljs-number">486</span>     <span class="hljs-comment">// DSI</span>
<span class="hljs-number">487</span>     <span class="hljs-comment">/* Command mode setting */</span>
<span class="hljs-number">488</span>     <span class="hljs-keyword">params</span>-&gt;dsi.LANE_NUM                = LCM_TWO_LANE;             <span class="hljs-comment">//两通道MIPI</span>
<span class="hljs-number">489</span>     <span class="hljs-comment">//The following defined the fomat for data coming from LCD engine.</span>
<span class="hljs-number">490</span>     <span class="hljs-keyword">params</span>-&gt;dsi.data_format.color_order = LCM_COLOR_ORDER_RGB;
<span class="hljs-number">491</span>     <span class="hljs-keyword">params</span>-&gt;dsi.data_format.trans_seq   = LCM_DSI_TRANS_SEQ_MSB_FIRST;
<span class="hljs-number">492</span>     <span class="hljs-keyword">params</span>-&gt;dsi.data_format.padding     = LCM_DSI_PADDING_ON_LSB;

<span class="hljs-number">493</span>     <span class="hljs-keyword">params</span>-&gt;dsi.data_format.format      = LCM_DSI_FORMAT_RGB888;
<span class="hljs-number">494</span> 
<span class="hljs-number">495</span>     <span class="hljs-comment">// Highly depends on LCD driver capability.</span>
<span class="hljs-number">496</span>     <span class="hljs-comment">// Not support in MT6573</span>
<span class="hljs-number">497</span>     <span class="hljs-keyword">params</span>-&gt;dsi.packet_size=<span class="hljs-number">256</span>;
<span class="hljs-number">498</span> 
<span class="hljs-number">499</span>     <span class="hljs-comment">// Video mode setting       </span>
<span class="hljs-number">500</span>     <span class="hljs-keyword">params</span>-&gt;dsi.intermediat_buffer_num = <span class="hljs-number">2</span>;
<span class="hljs-number">501</span> 
<span class="hljs-number">502</span>     <span class="hljs-keyword">params</span>-&gt;dsi.PS=LCM_PACKED_PS_24BIT_RGB888;
<span class="hljs-number">503</span> 
<span class="hljs-number">504</span>     <span class="hljs-comment">/*************垂直参数设置×××××××××××××××××*/</span>
<span class="hljs-number">505</span> 
<span class="hljs-number">506</span>     <span class="hljs-keyword">params</span>-&gt;dsi.vertical_sync_active = <span class="hljs-number">6</span>;
<span class="hljs-number">507</span>     <span class="hljs-keyword">params</span>-&gt;dsi.vertical_backporch   = <span class="hljs-number">14</span>;
<span class="hljs-number">508</span>     <span class="hljs-keyword">params</span>-&gt;dsi.vertical_frontporch  = <span class="hljs-number">20</span>;
<span class="hljs-number">509</span>     <span class="hljs-keyword">params</span>-&gt;dsi.vertical_active_line = FRAME_HEIGHT;
<span class="hljs-number">510</span> 
<span class="hljs-number">511</span>     <span class="hljs-comment">/*************水平参数设置×××××××××××××××××*/</span>
<span class="hljs-number">512</span> 
<span class="hljs-number">513</span>     <span class="hljs-keyword">params</span>-&gt;dsi.horizontal_sync_active = <span class="hljs-number">10</span>;
<span class="hljs-number">514</span>     <span class="hljs-keyword">params</span>-&gt;dsi.horizontal_backporch   = <span class="hljs-number">80</span>;
<span class="hljs-number">515</span>     <span class="hljs-keyword">params</span>-&gt;dsi.horizontal_frontporch  = <span class="hljs-number">80</span>;
<span class="hljs-number">516</span>     <span class="hljs-keyword">params</span>-&gt;dsi.horizontal_active_pixel = FRAME_WIDTH;
<span class="hljs-number">517</span> 
<span class="hljs-number">518</span>     <span class="hljs-comment">//params-&gt;dsi.pll_div1=1;   // div1=0,1,2,3;div1_real=1,2,4,4</span>
<span class="hljs-number">519</span>     <span class="hljs-comment">//params-&gt;dsi.pll_div2=1;   // div2=0,1,2,3;div2_real=1,2,4,4</span>
<span class="hljs-number">520</span>     <span class="hljs-comment">//params-&gt;dsi.fbk_div =28;      // fref=26MHz, fvco=fref*(fbk_div+1)*2/(div1_real*div2_real)</span>
<span class="hljs-number">521</span> 
<span class="hljs-number">522</span>     <span class="hljs-comment">/*××××××××××××××××时钟频率××××××××××××××××*/</span>
<span class="hljs-number">523</span> 
<span class="hljs-number">524</span>     <span class="hljs-keyword">params</span>-&gt;dsi.PLL_CLOCK = <span class="hljs-number">130</span>;
<span class="hljs-number">525</span>     <span class="hljs-comment">//params-&gt;dsi.ssc_disable = 0;</span>
<span class="hljs-number">526</span>     <span class="hljs-comment">//params-&gt;dsi.ssc_range = 4;</span>
<span class="hljs-number">527</span> }
<span class="hljs-number">528</span> 
<span class="hljs-number">529</span> 
<span class="hljs-number">530</span> <span class="hljs-comment">//legen add for detect lcm vendor</span>
<span class="hljs-number">531</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> lcm_select_panel(<span class="hljs-keyword">void</span>)
<span class="hljs-number">532</span> {
<span class="hljs-number">533</span>     <span class="hljs-keyword">int</span> <span class="hljs-keyword">value</span>=<span class="hljs-number">0</span>;
<span class="hljs-number">534</span> 
<span class="hljs-number">535</span>     mt_set_gpio_mode(GPIO_LCM_ID,GPIO_MODE_00);
<span class="hljs-number">536</span> 
<span class="hljs-number">537</span>     mt_set_gpio_pull_enable(GPIO_LCM_ID, GPIO_PULL_DISABLE);
<span class="hljs-number">538</span> 
<span class="hljs-number">539</span>     mt_set_gpio_dir(GPIO_LCM_ID, GPIO_DIR_IN);
<span class="hljs-number">540</span> 
<span class="hljs-number">541</span>     <span class="hljs-keyword">value</span>+=mt_get_gpio_in(GPIO_LCM_ID);
<span class="hljs-number">542</span>     <span class="hljs-keyword">if</span>(<span class="hljs-keyword">value</span>)
<span class="hljs-number">543</span>         <span class="hljs-keyword">return</span> LCM_TDT;
<span class="hljs-number">544</span> 
<span class="hljs-number">545</span>     <span class="hljs-keyword">return</span> LCM_TDT;
<span class="hljs-number">546</span> }
<span class="hljs-number">547</span> <span class="hljs-comment">//legen add end </span>
<span class="hljs-number">548</span> 
<span class="hljs-number">549</span> 
<span class="hljs-number">550</span> 
<span class="hljs-number">551</span> <span class="hljs-comment">/***************lcm初始化函数************************/</span>
<span class="hljs-number">552</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> lcm_init(<span class="hljs-keyword">void</span>)
<span class="hljs-number">553</span> {
<span class="hljs-number">554</span> <span class="hljs-comment">/*  lcm_util.set_gpio_out(GPIO_DISP_LRSTB_PIN, GPIO_OUT_ONE);  //SET_RESET_PIN(1);
555     MDELAY(10);
556     lcm_util.set_gpio_out(GPIO_DISP_LRSTB_PIN, GPIO_OUT_ZERO);  //SET_RESET_PIN(0);
557     MDELAY(10);
558     lcm_util.set_gpio_out(GPIO_DISP_LRSTB_PIN, GPIO_OUT_ONE);  //SET_RESET_PIN(1);
559     MDELAY(120);*/</span>
<span class="hljs-number">560</span> 
<span class="hljs-number">561</span>     <span class="hljs-comment">//复位</span>
<span class="hljs-number">562</span>     SET_RESET_PIN(<span class="hljs-number">1</span>);
<span class="hljs-number">563</span>     SET_RESET_PIN(<span class="hljs-number">0</span>);
<span class="hljs-number">564</span>     MDELAY(<span class="hljs-number">100</span>);
<span class="hljs-number">565</span>     SET_RESET_PIN(<span class="hljs-number">1</span>);
<span class="hljs-number">566</span>     MDELAY(<span class="hljs-number">50</span>);
<span class="hljs-number">567</span> 
<span class="hljs-number">568</span>     <span class="hljs-comment">//初始化数据</span>
<span class="hljs-number">569</span>     push_table(lcm_initialization_setting, <span class="hljs-keyword">sizeof</span>(lcm_initialization_setting) / <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">struct</span> LCM_setting_table), <span class="hljs-number">1</span>);
<span class="hljs-number">570</span> }
<span class="hljs-number">571</span> 
<span class="hljs-number">572</span> 
<span class="hljs-number">573</span> <span class="hljs-comment">/********************休眠******************************/</span>
<span class="hljs-number">574</span> <span class="hljs-comment">/*    挂起的机制一般有两种： 简单睡眠或深度睡眠  
575  简单睡眠：设备还处于工作状态，可以被唤醒，但是此时也会存在待机功耗等问题；
576  深度睡眠：设备处于休眠状态，基本处于不工作状态，因此无法被唤醒；
577 
578  一般程序设计都是使用深度睡眠，在唤醒时进行重新初始化；
579  */</span>
<span class="hljs-number">580</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> lcm_suspend(<span class="hljs-keyword">void</span>)
<span class="hljs-number">581</span> {
<span class="hljs-number">582</span> <span class="hljs-preprocessor">#ifdef BUILD_LK     </span>
<span class="hljs-number">583</span>     printf(<span class="hljs-string">"%s, ALS/PS bbbbbbbbbbbbbbb \n"</span>, __func__); <span class="hljs-comment">//lk层只能用printf</span>
<span class="hljs-number">584</span> <span class="hljs-preprocessor">#<span class="hljs-keyword">else</span></span>
<span class="hljs-number">585</span>     printk(<span class="hljs-string">"%s, ALS/PS bbbbbbbbbbbbbb  \n"</span>, __func__); <span class="hljs-comment">//内核层只能用printk</span>
<span class="hljs-number">586</span> <span class="hljs-preprocessor">#<span class="hljs-keyword">endif</span></span>
<span class="hljs-number">587</span> 
<span class="hljs-number">588</span>     push_table(lcm_deep_sleep_mode_in_setting, <span class="hljs-keyword">sizeof</span>(lcm_deep_sleep_mode_in_setting) / <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">struct</span> LCM_setting_table), <span class="hljs-number">1</span>);
<span class="hljs-number">589</span> }
<span class="hljs-number">590</span> 
<span class="hljs-number">591</span> 
<span class="hljs-number">592</span> 
<span class="hljs-number">593</span> <span class="hljs-comment">/*******************唤醒**********************************/</span>
<span class="hljs-number">594</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> lcm_resume(<span class="hljs-keyword">void</span>)
<span class="hljs-number">595</span> {
<span class="hljs-number">596</span> 
<span class="hljs-number">597</span>     lcm_init();
<span class="hljs-number">598</span>     <span class="hljs-comment">//MDELAY(200);</span>
<span class="hljs-number">599</span> 
<span class="hljs-number">600</span>     <span class="hljs-comment">//push_table(lcm_sleep_out_setting, sizeof(lcm_sleep_out_setting) / sizeof(struct LCM_setting_table), 1);</span>
<span class="hljs-number">601</span> }
<span class="hljs-number">602</span> 
<span class="hljs-number">603</span> 
<span class="hljs-number">604</span> 
<span class="hljs-number">605</span> <span class="hljs-comment">/********************lcm升级****************************************/</span>
<span class="hljs-number">606</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> lcm_update(unsigned <span class="hljs-keyword">int</span> x, unsigned <span class="hljs-keyword">int</span> y,
<span class="hljs-number">607</span>                        unsigned <span class="hljs-keyword">int</span> width, unsigned <span class="hljs-keyword">int</span> height)
<span class="hljs-number">608</span> {
<span class="hljs-number">609</span>     unsigned <span class="hljs-keyword">int</span> x0 = x;
<span class="hljs-number">610</span>     unsigned <span class="hljs-keyword">int</span> y0 = y;
<span class="hljs-number">611</span>     unsigned <span class="hljs-keyword">int</span> x1 = x0 + width - <span class="hljs-number">1</span>;
<span class="hljs-number">612</span>     unsigned <span class="hljs-keyword">int</span> y1 = y0 + height - <span class="hljs-number">1</span>;
<span class="hljs-number">613</span> 
<span class="hljs-number">614</span>     unsigned <span class="hljs-keyword">char</span> x0_MSB = ((x0&gt;&gt;<span class="hljs-number">8</span>)&amp;<span class="hljs-number">0xFF</span>);
<span class="hljs-number">615</span>     unsigned <span class="hljs-keyword">char</span> x0_LSB = (x0&amp;<span class="hljs-number">0xFF</span>);
<span class="hljs-number">616</span>     unsigned <span class="hljs-keyword">char</span> x1_MSB = ((x1&gt;&gt;<span class="hljs-number">8</span>)&amp;<span class="hljs-number">0xFF</span>);
<span class="hljs-number">617</span>     unsigned <span class="hljs-keyword">char</span> x1_LSB = (x1&amp;<span class="hljs-number">0xFF</span>);
<span class="hljs-number">618</span>     unsigned <span class="hljs-keyword">char</span> y0_MSB = ((y0&gt;&gt;<span class="hljs-number">8</span>)&amp;<span class="hljs-number">0xFF</span>);
<span class="hljs-number">619</span>     unsigned <span class="hljs-keyword">char</span> y0_LSB = (y0&amp;<span class="hljs-number">0xFF</span>);
<span class="hljs-number">620</span>     unsigned <span class="hljs-keyword">char</span> y1_MSB = ((y1&gt;&gt;<span class="hljs-number">8</span>)&amp;<span class="hljs-number">0xFF</span>);
<span class="hljs-number">621</span>     unsigned <span class="hljs-keyword">char</span> y1_LSB = (y1&amp;<span class="hljs-number">0xFF</span>);
<span class="hljs-number">622</span> 
<span class="hljs-number">623</span>     unsigned <span class="hljs-keyword">int</span> data_array[<span class="hljs-number">16</span>];
<span class="hljs-number">633</span>     dsi_set_cmdq(data_array, <span class="hljs-number">7</span>, <span class="hljs-number">0</span>);
<span class="hljs-number">634</span> 
<span class="hljs-number">635</span> }
<span class="hljs-number">636</span> 
<span class="hljs-number">637</span> 
<span class="hljs-number">638</span> <span class="hljs-keyword">static</span> unsigned <span class="hljs-keyword">int</span> lcm_esd_test = FALSE;      <span class="hljs-comment"><span class="hljs-xmlDocTag">///</span>only for ESD test</span>
<span class="hljs-number">639</span> 
<span class="hljs-number">640</span> <span class="hljs-keyword">static</span> unsigned <span class="hljs-keyword">int</span> lcm_esd_check(<span class="hljs-keyword">void</span>)
<span class="hljs-number">641</span> {
<span class="hljs-number">642</span>   <span class="hljs-preprocessor">#ifndef BUILD_LK</span>
<span class="hljs-number">643</span>     <span class="hljs-keyword">char</span>  buffer[<span class="hljs-number">3</span>];
<span class="hljs-number">644</span>     <span class="hljs-keyword">char</span>  buffer2[<span class="hljs-number">4</span>];
<span class="hljs-number">645</span>     <span class="hljs-keyword">int</span>   array[<span class="hljs-number">4</span>];
<span class="hljs-number">646</span> 
<span class="hljs-number">647</span>     <span class="hljs-keyword">if</span>(lcm_esd_test)
<span class="hljs-number">648</span>     {
<span class="hljs-number">649</span>         lcm_esd_test = FALSE;
<span class="hljs-number">650</span>         <span class="hljs-keyword">return</span> TRUE;
<span class="hljs-number">651</span>     }
<span class="hljs-number">652</span>     <span class="hljs-keyword">return</span> TRUE;
<span class="hljs-number">653</span>  <span class="hljs-preprocessor">#<span class="hljs-keyword">endif</span></span>
<span class="hljs-number">654</span> 
<span class="hljs-number">655</span> }
<span class="hljs-number">656</span> 
<span class="hljs-number">657</span> <span class="hljs-keyword">static</span> unsigned <span class="hljs-keyword">int</span> lcm_esd_recover(<span class="hljs-keyword">void</span>)
<span class="hljs-number">658</span> {
<span class="hljs-number">659</span>   <span class="hljs-preprocessor">#ifndef BUILD_LK</span>
<span class="hljs-number">660</span>     lcm_init();
<span class="hljs-number">661</span>     <span class="hljs-comment">//lcm_resume();</span>
<span class="hljs-number">662</span> 
<span class="hljs-number">663</span>     printk(<span class="hljs-string">"lcm_esd_recover\n"</span>);
<span class="hljs-number">664</span> 
<span class="hljs-number">665</span>     <span class="hljs-keyword">return</span> TRUE;
<span class="hljs-number">666</span>   <span class="hljs-preprocessor">#<span class="hljs-keyword">endif</span></span>
<span class="hljs-number">667</span> }
<span class="hljs-number">668</span> 
<span class="hljs-number">669</span> 
<span class="hljs-number">670</span> <span class="hljs-comment">/********************设备id匹配********************************/</span>
<span class="hljs-number">671</span> <span class="hljs-keyword">static</span> unsigned <span class="hljs-keyword">int</span> lcm_compare_id(<span class="hljs-keyword">void</span>)
<span class="hljs-number">672</span> {
<span class="hljs-number">673</span> 
<span class="hljs-number">674</span>     <span class="hljs-keyword">int</span> array[<span class="hljs-number">4</span>];
<span class="hljs-number">675</span>     <span class="hljs-keyword">char</span> buffer[<span class="hljs-number">5</span>];
<span class="hljs-number">676</span>     <span class="hljs-keyword">char</span> id_high=<span class="hljs-number">0</span>;
<span class="hljs-number">677</span>     <span class="hljs-keyword">char</span> id_midd=<span class="hljs-number">0</span>;
<span class="hljs-number">678</span>     <span class="hljs-keyword">char</span> id_low=<span class="hljs-number">0</span>;
<span class="hljs-number">679</span>     <span class="hljs-keyword">int</span> id=<span class="hljs-number">0</span>;
<span class="hljs-number">680</span> 
<span class="hljs-number">681</span>     <span class="hljs-comment">//Do reset here</span>
<span class="hljs-number">682</span>     <span class="hljs-comment">/*lcm_util.set_gpio_out(GPIO_DISP_LRSTB_PIN, GPIO_OUT_ONE);  //SET_RESET_PIN(1);
683     lcm_util.set_gpio_out(GPIO_DISP_LRSTB_PIN, GPIO_OUT_ZERO);  //SET_RESET_PIN(0);
684     MDELAY(25);       
685     lcm_util.set_gpio_out(GPIO_DISP_LRSTB_PIN, GPIO_OUT_ONE);  //SET_RESET_PIN(1);
686     MDELAY(50);      */</span>
<span class="hljs-number">687</span> 
<span class="hljs-number">688</span>     <span class="hljs-comment">//首先进行复位操作</span>
<span class="hljs-number">689</span>     SET_RESET_PIN(<span class="hljs-number">1</span>);
<span class="hljs-number">690</span>     SET_RESET_PIN(<span class="hljs-number">0</span>);
<span class="hljs-number">691</span>     MDELAY(<span class="hljs-number">100</span>);
<span class="hljs-number">692</span>     SET_RESET_PIN(<span class="hljs-number">1</span>);
<span class="hljs-number">693</span>     MDELAY(<span class="hljs-number">50</span>);
<span class="hljs-number">694</span> 
<span class="hljs-number">695</span>     <span class="hljs-comment">//enable CMD2 Page1</span>
<span class="hljs-number">696</span>     array[<span class="hljs-number">0</span>]=<span class="hljs-number">0x00063902</span>;
<span class="hljs-number">697</span>     array[<span class="hljs-number">1</span>]=<span class="hljs-number">0x0698ffff</span>;
<span class="hljs-number">698</span>     array[<span class="hljs-number">2</span>]=<span class="hljs-number">0x00000104</span>;
<span class="hljs-number">699</span>     dsi_set_cmdq(array, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>);
<span class="hljs-number">700</span>     MDELAY(<span class="hljs-number">10</span>);
<span class="hljs-number">701</span> 
<span class="hljs-number">702</span> 
<span class="hljs-number">703</span>     array[<span class="hljs-number">0</span>]=<span class="hljs-number">0x00033700</span>;
<span class="hljs-number">704</span>     dsi_set_cmdq(array, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>);
<span class="hljs-number">705</span>     <span class="hljs-comment">//read_reg_v2(0x04, buffer, 3);//if read 0x04,should get 0x008000,that is both OK.</span>
<span class="hljs-number">706</span> 
<span class="hljs-number">707</span>     read_reg_v2(<span class="hljs-number">0x00</span>, buffer,<span class="hljs-number">1</span>);
<span class="hljs-number">708</span>     id_high = buffer[<span class="hljs-number">0</span>]; <span class="hljs-comment"><span class="hljs-xmlDocTag">///</span><span class="hljs-xmlDocTag">///</span><span class="hljs-xmlDocTag">///</span><span class="hljs-xmlDocTag">///</span><span class="hljs-xmlDocTag">///</span><span class="hljs-xmlDocTag">///</span><span class="hljs-xmlDocTag">///</span>//0x98</span>
<span class="hljs-number">709</span> 
<span class="hljs-number">710</span>     read_reg_v2(<span class="hljs-number">0x01</span>, buffer,<span class="hljs-number">1</span>);
<span class="hljs-number">711</span>     id_midd = buffer[<span class="hljs-number">0</span>]; <span class="hljs-comment"><span class="hljs-xmlDocTag">///</span><span class="hljs-xmlDocTag">///</span><span class="hljs-xmlDocTag">///</span><span class="hljs-xmlDocTag">///</span><span class="hljs-xmlDocTag">///</span><span class="hljs-xmlDocTag">///</span><span class="hljs-xmlDocTag">///</span>//0x06</span>
<span class="hljs-number">712</span> 
<span class="hljs-number">713</span>     read_reg_v2(<span class="hljs-number">0x02</span>, buffer,<span class="hljs-number">1</span>);
<span class="hljs-number">714</span>     id_low = buffer[<span class="hljs-number">0</span>]; <span class="hljs-comment"><span class="hljs-xmlDocTag">///</span><span class="hljs-xmlDocTag">///</span><span class="hljs-xmlDocTag">///</span><span class="hljs-xmlDocTag">///</span><span class="hljs-xmlDocTag">///</span><span class="hljs-xmlDocTag">///</span><span class="hljs-xmlDocTag">///</span><span class="hljs-xmlDocTag">///</span>0x04</span>
<span class="hljs-number">715</span> 
<span class="hljs-number">716</span>     id =(id_high &lt;&lt; <span class="hljs-number">16</span>) | (id_midd &lt;&lt; <span class="hljs-number">8</span>) | id_low;
<span class="hljs-number">717</span> 
<span class="hljs-number">718</span>     <span class="hljs-preprocessor">#<span class="hljs-keyword">if</span> defined(BUILD_LK)</span>
<span class="hljs-number">719</span>     printf(<span class="hljs-string">"ILI9806E compare-LK:0x%02x,0x%02x,0x%02x,0x%02x\n"</span>, id_high, id_midd, id_low, id);
<span class="hljs-number">720</span>     <span class="hljs-preprocessor">#<span class="hljs-keyword">else</span></span>
<span class="hljs-number">721</span>     printk(<span class="hljs-string">"ILI9806E compare:0x%02x,0x%02x,0x%02x,0x%02x\n"</span>, id_high, id_midd, id_low, id);
<span class="hljs-number">722</span>     <span class="hljs-preprocessor">#<span class="hljs-keyword">endif</span></span>
<span class="hljs-number">723</span> 
<span class="hljs-number">724</span>     <span class="hljs-keyword">return</span> (id == LCM_ID_ILI9806E)?<span class="hljs-number">1</span>:<span class="hljs-number">0</span>;
<span class="hljs-number">725</span> }
<span class="hljs-number">726</span> 
<span class="hljs-number">727</span> 
<span class="hljs-number">728</span> 
<span class="hljs-number">729</span> LCM_DRIVER ili9806e_wvga_dsi_vdo_lcm_drv=
<span class="hljs-number">730</span> {
<span class="hljs-number">731</span>     .name           = <span class="hljs-string">"ili9806e_wvga_dsi_vdo"</span>,       <span class="hljs-comment">//设备名</span>
<span class="hljs-number">732</span>     .set_util_funcs = lcm_set_util_funcs,            <span class="hljs-comment">//获得LCM_DRIVER结构</span>
<span class="hljs-number">733</span>     .get_params     = lcm_get_params,                <span class="hljs-comment">//获得lcm参数</span>
<span class="hljs-number">734</span>     .init           = lcm_init,                      <span class="hljs-comment">//初始化lcm</span>
<span class="hljs-number">735</span>     .suspend        = lcm_suspend,                   <span class="hljs-comment">//lcm挂起</span>
<span class="hljs-number">736</span>     .resume         = lcm_resume,                    <span class="hljs-comment">//lcm恢复</span>
<span class="hljs-number">737</span>     .compare_id     = lcm_compare_id,                <span class="hljs-comment">//lcm设备id匹</span>
<span class="hljs-number">738</span>     .esd_check      = lcm_esd_check,                    <span class="hljs-comment">//</span>
<span class="hljs-number">739</span>     .esd_recover    = lcm_esd_recover,                  <span class="hljs-comment">//</span>
<span class="hljs-number">740</span> <span class="hljs-preprocessor">#<span class="hljs-keyword">if</span> (LCM_DSI_CMD_MODE)</span>
<span class="hljs-number">741</span>     .update         = lcm_update,                    <span class="hljs-comment">//lcm升级</span>
<span class="hljs-number">742</span> <span class="hljs-preprocessor">#<span class="hljs-keyword">endif</span></span>
<span class="hljs-number">743</span>     };
<span class="hljs-number">744</span> </code></pre> 
<pre><code>一般情况下lcm驱动无非就是这些函数组成，当然lcm屏厂商当然会给我们提供一些初始化代码，以及lcm屏数据手册，这些是我们要认真看的。
</code></pre> 
<h3 id="lcm移植过程"><strong>lcm移植过程：</strong></h3> 
<pre><code>lk: 

    在内核目录下bootable/bootloader/lk/dev/lcm/下存放的是各种lcm厂商的lcm驱动，其中也有一个mt67xx_lcm_list.c文件，里面定义了所有的lcm驱动）

1.移植是首先要在lcm/目录下建立一个所移植的那个lcm屏的目录文件夹，目录文件夹名字选取是根据你所定义的设备名统一。
2.在建的这个目录下添加lcm驱动和makefile文件，如果你有lcm驱动就放在这个目录下，如果没有，就找lcm目录下其他的lcm驱动文件夹中的.c文件进行修改后放在此目录下

3.准备工作做好后，修改文件主要有几个，一个是mt67xx_list.c：
    在这个文件中加入你所添加的驱动定义：格式和方法参照文件中其他lcm的定义。
另一个是bootable/blltloader/lk/project/这个目录下有你编译的工程文件（就是你lunch的时候选取的那个文件，Project.mk）.mk文件，
    在这个文件下主要修改的是CUSTOM_LK_LCM、和BOOT_LOGO，把这两个修改成你移植的对应的参数，CUSTOM_LK_LCM要和你的文件名，目录名，还有你的.c文件中的.name变量的值统一。logo，以及lcm屏的宽、高，看lcm数据手册。

kernel：

  kernel/drives/misc/mediatek/lcm/....在这个目录下加入和lk当时候加入的是一样的。直接拷贝过来就可以。同样修改mt67xx_lcm_list.c文件

kernel-3.10/arch/arm64/configs/..目录下是：工程名_debug_defconfig,和对应：工程名_defconfig这两种文件，其中后缀是debug_defconfig的文件是eng对应的，而defconfig是user对应的。

（在我们的lunch所打印出来的工程中有三种后缀，eng(调试工程)、user(用户工程)、userdebug，

进入这个文件后，反斜杠搜索/lcm  然后修改对应的名称和分辨率。


编译： make -j12 2&gt;&amp;1 | tee log.txt
</code></pre> 
<p>上面讲述的仅仅是加入文件的修改过程，至于调试的话，这个是要积累的经验，把所移植好的代码烧进我们对应的板子，然后编译看效果，然后在针对对应的效果进行调试。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/04ac6a878064f7978980e531947d7e45/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">破解 jar 包之直接修改 .class 文件方式</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4031d2202fa8f18a52e212667c9fb3c3/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">心理调整</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>