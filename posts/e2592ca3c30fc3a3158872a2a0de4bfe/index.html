<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>C#winform中IP输入框控件 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="C#winform中IP输入框控件" />
<meta property="og:description" content="可以通过自定义控件的方式做一个IP输入框，目前这个是一个IP输入控件的类，还不能在工具箱中拖放，希望以后做一个可以放在工具箱中的，这个类如下：
public class IpInputBox : Label { private bool _isNetmask = false; public bool IsNetmask { get { return _isNetmask; } set { _isNetmask = value; } } public IpInputBox(bool isNetmask) { _isNetmask = isNetmask; this.Size = new System.Drawing.Size(150, 25); _dotLabel1.Text = &#34;.&#34;; _dotLabel2.Text = &#34;.&#34;; _dotLabel3.Text = &#34;.&#34;; _dotLabel1.Size = new System.Drawing.Size(10, 25); _dotLabel2.Size = new System.Drawing.Size(10, 25); _dotLabel3.Size = new System.Drawing.Size(10, 25); _box1.IsNetmask = _isNetmask; _box2.IsNetmask = _isNetmask; _box3." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/e2592ca3c30fc3a3158872a2a0de4bfe/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-10-31T21:22:09+08:00" />
<meta property="article:modified_time" content="2018-10-31T21:22:09+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">C#winform中IP输入框控件</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><img src="https://images2.imgbox.com/d9/13/whmOgF2y_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/06/c6/QcjZyfHe_o.png" alt="在这里插入图片描述"></p> 
<p>可以通过自定义控件的方式做一个IP输入框，目前这个是一个IP输入控件的类，还不能在工具箱中拖放，希望以后做一个可以放在工具箱中的，这个类如下：</p> 
<pre><code>public class IpInputBox : Label
    {
        private bool _isNetmask = false;
        public bool IsNetmask
        {
            get { return _isNetmask; }
            set { _isNetmask = value; }
        }
        public IpInputBox(bool isNetmask)
        {
            _isNetmask = isNetmask;

            this.Size = new System.Drawing.Size(150, 25);

            _dotLabel1.Text = ".";
            _dotLabel2.Text = ".";
            _dotLabel3.Text = ".";

            _dotLabel1.Size = new System.Drawing.Size(10, 25);
            _dotLabel2.Size = new System.Drawing.Size(10, 25);
            _dotLabel3.Size = new System.Drawing.Size(10, 25);

            _box1.IsNetmask = _isNetmask;
            _box2.IsNetmask = _isNetmask;
            _box3.IsNetmask = _isNetmask;
            _box4.IsNetmask = _isNetmask;

            _box1.Flag = 1;
            _box2.Flag = 2;
            _box3.Flag = 3;
            _box4.Flag = 4;

            this.BorderStyle = BorderStyle.FixedSingle;

            this.Controls.Add(_box1);
            this.Controls.Add(_dotLabel1);


            this.Controls.Add(_box2);
            this.Controls.Add(_dotLabel2);


            this.Controls.Add(_box3);
            this.Controls.Add(_dotLabel3);

            this.Controls.Add(_box4);

            this.Font = new System.Drawing.Font(this.Font.Name, 11);
            _box1.Location = new System.Drawing.Point(-1, 3);
            _dotLabel1.Location = new System.Drawing.Point(29, 3);
            _box2.Location = new System.Drawing.Point(39, 3);
            _dotLabel2.Location = new System.Drawing.Point(69,3);
            _box3.Location = new System.Drawing.Point(79,3);
            _dotLabel3.Location = new System.Drawing.Point(109,3);
            _box4.Location = new System.Drawing.Point(119,3);

            _box1.Box = this;
            _box2.Box = this;
            _box3.Box = this;
            _box4.Box = this;
        }
        public void FallBackEventFun(IpInputBox box, int flag)
        {
            switch (flag)
            {
                case 1:
                    _box1.Focus();
                    break;
                case 2:
                    _box1.Focus();
                    break;
                case 3:
                    _box2.Focus(); ;
                    break;
                case 4:
                    _box3.Focus(); ;
                    break;
            }
        }

        private string _ipAddress = string.Empty;
        public void UpDateIpaddress()
        {
            try
            {
                string[] sArray = ipAddress.Split(new char[] { '.' });
                _box1.Text = sArray[0];
                _box2.Text = sArray[1];
                _box3.Text = sArray[2];
                _box4.Text = sArray[3];
            }
            catch (Exception exp)
            {
                MessageBox.Show("更新字符串失败:" + exp.Message);
            }
        }

        /// &lt;summary&gt;
        /// 获取ip地址
        /// &lt;/summary&gt;
        public string IpAddressString
        {
            get
            {
                string _ipStr1 = _box1.Text;
                string _ipStr2 = _box2.Text;
                string _ipStr3 = _box3.Text;
                string _ipStr4 = _box4.Text;
                string _ipDotStr = ".";
                _ipAddress = _ipStr1 + _ipDotStr + _ipStr2 + _ipDotStr + _ipStr3 + _ipDotStr + _ipStr4;
                return _ipAddress;
            }
            set
            {
                _ipAddress = value;
            }
        }
        private string ipAddress = string.Empty;

        public string IpAddress
        {
            get { return ipAddress; }
            set { ipAddress = value; }
        }

        private SubIpInputBox _box1 = new SubIpInputBox("");
        private SubIpInputBox _box2 = new SubIpInputBox("");
        private SubIpInputBox _box3 = new SubIpInputBox("");
        private SubIpInputBox _box4 = new SubIpInputBox("");

        private Label _dotLabel1 = new Label();
        private Label _dotLabel2 = new Label();
        private Label _dotLabel3 = new Label();

    }
</code></pre> 
<pre><code>public class SubIpInputBox : TextBox
    {
        /// &lt;summary&gt;
        /// 判断是否是子网掩码,false表示ip地址,true表示子网掩码
        /// &lt;/summary&gt;
        private bool _isNetmask = false;
        private bool _isSendKey = false;
        private System.ComponentModel.IContainer components;
        private int _flag = 0;

        public int Flag
        {
            get { return _flag; }
            set { _flag = value; }
        }

        /// &lt;summary&gt;
        /// 
        /// &lt;/summary&gt;
        public event FallBackEvent TextFallBackEvent;


        //定义事件函数
        public void FallBackEventFun(int flag)
        {
            if (TextFallBackEvent != null)
            {
                TextFallBackEvent(box, this.Flag);
            }
        }

        public bool IsNetmask
        {
            get { return _isNetmask; }
            set { _isNetmask = value; }
        }

        /// &lt;summary&gt;
        /// 构造函数
        /// &lt;/summary&gt;
        public SubIpInputBox(bool isNetmask)
        {
            _isNetmask = isNetmask;
            box = new IpInputBox(_isNetmask);
            this.Font = new System.Drawing.Font(this.Font.Name, 11);
            this.BorderStyle = System.Windows.Forms.BorderStyle.None;//去掉边框
            this.TextAlign = HorizontalAlignment.Center;//字体居中
            this.Size = new System.Drawing.Size(30, 28);
            this.MaxLength = 3;
        }

        public SubIpInputBox(string str)
        {
            this.Text = str;
            this.Size = new System.Drawing.Size(30, 28);
            this.MaxLength = 3;
            this.BorderStyle = System.Windows.Forms.BorderStyle.None;//去掉边框
            this.TextAlign = HorizontalAlignment.Center;//字体居中
        }

        private IpInputBox box;
        public IpInputBox Box
        {
            get { return box; }
            set { box = value; }
        }

        protected override void OnKeyUp(KeyEventArgs e)
        {
            base.OnKeyUp(e);


            if (this.Text == "")
            {
                if (e.KeyCode.ToString() == "Back")
                {
                    this.TextFallBackEvent += new FallBackEvent(box.FallBackEventFun);
                    this.FallBackEventFun(this.Flag);
                }
            }
        }
        protected override void OnKeyPress(KeyPressEventArgs e)
        {
            base.OnKeyPress(e);

            //阻止从键盘输入键
            e.Handled = true;


            if ((e.KeyChar &gt;= '0' &amp;&amp; e.KeyChar &lt;= '9') || (e.KeyChar == (char)8))
            {

                if ((e.KeyChar == (char)8))
                {
                    e.Handled = false; return;
                }
                else
                {
                    int len = this.Text.Length;
                    if (len &lt; 4)
                    {
                        if (len == 0 &amp;&amp; e.KeyChar != '0')
                        {
                            e.Handled = false; return;
                        }
                        else if (len == 0)
                        {
                            if (this.Flag == 1 &amp;&amp; this.IsNetmask == false)
                            {
                                return;
                            }
                        }
                        e.Handled = false; return;
                    }
                    else
                    {
                        // MessageBox.Show("编号最多只能输入3位数字！");
                    }
                }
            }
            else if (e.KeyChar == '.')
            {
                //MessageBox.Show("编号只能输入数字！");
                if (this.Text.Length != 0)
                {
                    // 如果输入 . 就执行 TAB 键 
                    SendKeys.SendWait("{TAB}");
                    //MessageBox.Show(this.Name);
                }
            }
            else if (this._isSendKey)
            {
                this.SelectAll();
            }

        }


        protected override void OnTextChanged(EventArgs e)
        {

            try
            {
                string currentStr = this.Text;
                int currentNumber = Convert.ToInt32(currentStr);
                this.Text = currentNumber.ToString();
                this.SelectionStart = currentStr.Length;//设置光标在末尾
                if (_isNetmask == false)//表示ip地址
                {

                    if (currentNumber &gt; 255 || (currentNumber == 0 &amp;&amp; this.Flag == 1))
                    {
                        MessageBox.Show("你输入的" + currentStr + "不是有效数值，请指定一个介于1到223之间的数值!", "错误", MessageBoxButtons.OK, MessageBoxIcon.Warning);

                        if (this.Flag == 1 &amp;&amp; currentNumber == 0)
                        {
                            this.Text = "1";
                        }
                        else
                        {
                            this.Text = "223";
                        }
                        _isSendKey = true;
                        this.Focus();
                        this.SelectionStart = currentStr.Length;//设置光标在末尾
                        this.SelectAll();
                    }
                    else
                    {
                        if (currentStr.Length == 3 &amp;&amp; _isSendKey == false)
                        {// 当输入的字符个数为3时，跳入另外一个输入框
                         //MessageBox.Show("输入完毕");
                            if (currentNumber == 0)
                            {
                                this.Text = "";
                                MessageBox.Show("000");
                            }
                            SendKeys.SendWait("{TAB}");
                        }
                    }

                }
                else//子网掩码
                {
                    if (currentNumber &gt; 255)
                    {
                        MessageBox.Show("你输入的" + currentStr + "不是有效数值，请指定一个介于0到255之间的数值!", "错误", MessageBoxButtons.OK, MessageBoxIcon.Warning);
                        this.Text = "255";
                        this.Focus();
                        this.SelectionStart = currentStr.Length;//设置光标在末尾
                        this.SelectAll();
                    }
                    else
                    {
                        if (currentStr.Length == 3 &amp;&amp; _isSendKey == false)
                        {// 当输入的字符个数为3时，跳入另外一个输入框
                         //MessageBox.Show("输入完毕");
                            SendKeys.SendWait("{TAB}");

                        }
                    }
                }
            }
            catch
            {
                // 异常处理
            }
        }

        private void InitializeComponent()
        {
            this.SuspendLayout();
            // 
            // SubIpInputBox
            // 
            this.TabIndexChanged += new System.EventHandler(this.SubTextBox_TabIndexChanged);
            this.ResumeLayout(false);
        }
        private void SubTextBox_TabIndexChanged(object sender, EventArgs e)
        {

        }
    }
</code></pre> 
<p>这个控件中继承自Label控件的，在Label中加入4个输入框和，ip分隔的点，就可以了，</p> 
<p>目前只是在使用中还不是那么的方便，<br> 在使用的地方<br> <img src="https://images2.imgbox.com/c7/cf/kGkD2liz_o.png" alt="在这里插入图片描述"></p> 
<pre><code>private IpInputBox ipBox1 = new IpInputBox(false);
private IpInputBox ipBox2 = new IpInputBox(false);
</code></pre> 
<p>然后把这个控件加入到窗体控件中<br> <img src="https://images2.imgbox.com/6b/ea/o3IxwvdS_o.png" alt="在这里插入图片描述"><br> 并设置Location就可以</p> 
<p>为了方便控件的定位，可以在窗体上放一个panel，然后在panel中添加这个自定义的ip输入框<br> this.panel1.Controls.Add(ipBox)</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1b255f4380a07907bb309f3bb2546ede/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">.net core webapi  读取php 接口 方法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3efaeb8c13bfb7f454ecde89ac596f8d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">腾讯 IEG Unity 面经</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>