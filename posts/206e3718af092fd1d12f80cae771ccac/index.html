<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>MongoDB - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="MongoDB" />
<meta property="og:description" content="1、SQL到MongoDB的映射图 SQLMongoDB数据库(database)数据库(database)表(table)集合(collection)行row文档(document)列(column)字段(field)索引(index)索引(index)主键(primary key)_id(字段)视图 (view)视图 (view)表连接(table joins)聚合操作 ($lookup) 2、适合使用MongoDB的场景 应用不需要复杂/长事务及 join 支持新应用，需求会变，数据模型无法确定，想快速迭代开发应用需要2000-3000以上的读写QPS (更高也可以)应用需要TB甚至 PB 级别数据存储应用发展迅速，需要能快速水平扩展应用要求存储的数据不丢失应用需要99.999%高可用应用需要大量的地理位置查询、文本查询 3、Linux安装 https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-rhel70-4.4.26.tgz
命令1
进入bin目录，输入./mongo --help查看帮助信息
命令2
指定data和log路径
启动mongoDB
bin/mongod --port=27017 --dbpath=/app/mongodb-linux-x86_64-rhel70-4.4.26/data --logpath=/app/mongodb-linux-x86_64-rhel70-4.4.26/log/mongodb.log --bind_ip=0.0.0.0 --fork 进入bin目录打开mongoDB命令控制台
4、基础命令 查看所有数据库 show dbs 2. 创建(切换)db
在控制台关闭mongoDB服务 db.shutdownServer() 菜鸟教程更多
https://www.runoob.com/mongodb/mongodb-tutorial.html
5、配置文件启动mongoDB 5.1、编辑编制文件 systemLog: destination: file path: /app/mongodb-linux-x86_64-rhel70-4.4.26/log/mongodb.log #指定日志输入文件夹(绝对路径) logAppend: true storage: dbPath: /app/mongodb-linux-x86_64-rhel70-4.4.26/data #指定数据输入文件夹(绝对路径) engine: wiredTiger #存储引擎 journal: enabled: true #是否启动journal日志 net: bindIp: 0.0.0.0 port: 27017 processManagement: fork: true 5.2、启动MongoDB mongod -f /app/mongodb-linux-x86_64-rhel70-4." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/206e3718af092fd1d12f80cae771ccac/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-16T01:02:10+08:00" />
<meta property="article:modified_time" content="2024-01-16T01:02:10+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">MongoDB</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="1SQLMongoDB_0"></a>1、SQL到MongoDB的映射图</h2> 
<table><thead><tr><th>SQL</th><th>MongoDB</th></tr></thead><tbody><tr><td>数据库(database)</td><td>数据库(database)</td></tr><tr><td>表(table)</td><td>集合(collection)</td></tr><tr><td>行row</td><td>文档(document)</td></tr><tr><td>列(column)</td><td>字段(field)</td></tr><tr><td>索引(index)</td><td>索引(index)</td></tr><tr><td>主键(primary key)</td><td>_id(字段)</td></tr><tr><td>视图 (view)</td><td>视图 (view)</td></tr><tr><td>表连接(table joins)</td><td>聚合操作 ($lookup)</td></tr></tbody></table> 
<p><img src="https://images2.imgbox.com/4b/a1/fXp1iJMB_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="2MongoDB_13"></a>2、适合使用MongoDB的场景</h2> 
<ol><li>应用不需要复杂/长事务及 join 支持</li><li>新应用，需求会变，数据模型无法确定，想快速迭代开发</li><li>应用需要2000-3000以上的读写QPS (更高也可以)</li><li>应用需要TB甚至 PB 级别数据存储</li><li>应用发展迅速，需要能快速水平扩展</li><li>应用要求存储的数据不丢失</li><li>应用需要99.999%高可用</li><li>应用需要大量的地理位置查询、文本查询</li></ol> 
<h2><a id="3Linux_23"></a>3、Linux安装</h2> 
<p>https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-rhel70-4.4.26.tgz</p> 
<p><strong>命令1</strong><br> 进入bin目录，输入<code>./mongo --help</code>查看帮助信息<br> <img src="https://images2.imgbox.com/7f/5d/ttaqQkM0_o.png" alt="在这里插入图片描述"><br> <strong>命令2</strong></p> 
<ol><li> <p>指定data和log路径<br> <img src="https://images2.imgbox.com/42/5e/UviCtL8o_o.png" alt="在这里插入图片描述"></p> </li><li> <p>启动mongoDB</p> </li></ol> 
<pre><code class="prism language-bash">bin/mongod <span class="token parameter variable">--port</span><span class="token operator">=</span><span class="token number">27017</span> <span class="token parameter variable">--dbpath</span><span class="token operator">=</span>/app/mongodb-linux-x86_64-rhel70-4.4.26/data <span class="token parameter variable">--logpath</span><span class="token operator">=</span>/app/mongodb-linux-x86_64-rhel70-4.4.26/log/mongodb.log <span class="token parameter variable">--bind_ip</span><span class="token operator">=</span><span class="token number">0.0</span>.0.0 <span class="token parameter variable">--fork</span>

</code></pre> 
<ol start="3"><li>进入bin目录打开mongoDB命令控制台<br> <img src="https://images2.imgbox.com/04/23/w0sefPZb_o.png" alt="在这里插入图片描述"></li></ol> 
<h2><a id="4_41"></a>4、基础命令</h2> 
<ol><li>查看所有数据库</li></ol> 
<pre><code class="prism language-bash">show dbs
</code></pre> 
<p><img src="https://images2.imgbox.com/d0/ea/7tVVEkKj_o.png" alt="在这里插入图片描述"><br> 2. 创建(切换)db<br> <img src="https://images2.imgbox.com/ba/c8/stshfYYp_o.png" alt="在这里插入图片描述"></p> 
<ol start="3"><li>在控制台关闭mongoDB服务</li></ol> 
<pre><code class="prism language-bash">db.shutdownServer<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/88/05/5lBRAs6W_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/76/44/nC5Mfgk7_o.png" alt="在这里插入图片描述"><br> 菜鸟教程更多<br> https://www.runoob.com/mongodb/mongodb-tutorial.html</p> 
<h2><a id="5mongoDB_61"></a>5、配置文件启动mongoDB</h2> 
<h3><a id="51_62"></a>5.1、编辑编制文件</h3> 
<pre><code class="prism language-bash">
systemLog:
  destination: <span class="token function">file</span>
  path: /app/mongodb-linux-x86_64-rhel70-4.4.26/log/mongodb.log <span class="token comment">#指定日志输入文件夹(绝对路径)</span>
  logAppend: <span class="token boolean">true</span>
storage:
  dbPath: /app/mongodb-linux-x86_64-rhel70-4.4.26/data <span class="token comment">#指定数据输入文件夹(绝对路径)</span>
  engine: wiredTiger <span class="token comment">#存储引擎</span>
  journal:
    enabled: <span class="token boolean">true</span>  <span class="token comment">#是否启动journal日志</span>
net:
  bindIp: <span class="token number">0.0</span>.0.0
  port: <span class="token number">27017</span>
processManagement:
  fork: <span class="token boolean">true</span>

</code></pre> 
<h3><a id="52MongoDB_81"></a>5.2、启动MongoDB</h3> 
<pre><code class="prism language-bash">mongod <span class="token parameter variable">-f</span> /app/mongodb-linux-x86_64-rhel70-4.4.26/mongo.conf <span class="token comment">#启动配置文件绝对路径</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/1f/ff/gnxo1q1W_o.png" alt="在这里插入图片描述"><br> 进入bin目录输入<code>./mongo</code>打开命令控制台<br> <img src="https://images2.imgbox.com/e8/56/vYoI9tBg_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="53MongoDB_88"></a>5.3、关闭MongoDB</h3> 
<pre><code class="prism language-bash">mongod <span class="token parameter variable">-f</span> /app/mongodb-linux-x86_64-rhel70-4.4.26/mongo.conf <span class="token parameter variable">--shutdown</span> <span class="token comment">##配置文件绝对路径</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/8d/ee/uvgitJr2_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="6Mongo_shell_93"></a>6、Mongo shell</h2> 
<p><img src="https://images2.imgbox.com/68/f3/Ldx73z94_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/cb/44/LwDq6zW4_o.png" alt="在这里插入图片描述"><br> <strong>数据库操作</strong></p> 
<pre><code class="prism language-bash"><span class="token comment">#查看所有数据库</span>
show dbs
<span class="token comment">#use 切换数据库(创建)</span>
use demodb
<span class="token comment">#删除当前数据库</span>
db.dropDatabase<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre> 
<p><strong>集合操作</strong></p> 
<pre><code class="prism language-bash"><span class="token comment">#查看所有集合</span>
show collections
<span class="token comment">#创建集合</span>
db.createCollection<span class="token punctuation">(</span><span class="token string">"studenttable"</span><span class="token punctuation">)</span>
<span class="token comment">#删除集合</span>
db.studenttable.drop<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/08/8d/Jk78sDIU_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="7_118"></a>7、安全认证</h2> 
<h3><a id="71_119"></a>7.1、创建管理员账号</h3> 
<pre><code class="prism language-bash"><span class="token comment">#设置管理员用户密码需要在admin库</span>
use admin
<span class="token comment">#创建管理员</span>
db.createUser<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>user:<span class="token string">"zmc"</span>,pwd:<span class="token string">"123456"</span>,roles:<span class="token punctuation">[</span><span class="token string">"root"</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">#查看所有用户信息</span>
show <span class="token function">users</span>
<span class="token comment">#删除用户</span>
db.dropUser<span class="token punctuation">(</span><span class="token string">"zmc"</span><span class="token punctuation">)</span>
<span class="token comment">#验证用户</span>
db.auth<span class="token punctuation">(</span><span class="token string">"zmc"</span>,<span class="token string">"123456"</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/b4/b9/GbGP2kzd_o.png" alt="在这里插入图片描述"></p> 
<table><thead><tr><th>权限名</th><th>描述</th></tr></thead><tbody><tr><td>read</td><td>允许用户读取指定数据库</td></tr><tr><td>readWrite</td><td>允许用户读写指定数据库</td></tr><tr><td>dbAdmin</td><td>允许用户在指定数据库中执行管理函数，如索引创建、删除，查看统计或访问system.profile</td></tr><tr><td>dbowner</td><td>允许用户在指定数据库中执行任意操作，增、删、改、查等</td></tr><tr><td>userAdmin</td><td>允许用户向system.users集合写入，可以在指定数据库里创建、删除和管理用户</td></tr><tr><td>clusterAdmin</td><td>只在admin数据库中可用，赋予用户所有分片和复制集相关函数的管理权限</td></tr><tr><td>readAnyDatabase</td><td>只在admin数据库中可用，赋予用户所有数据库的读权限</td></tr><tr><td>readWriteAnvDatabase</td><td>只在admin数据库中可用，赋予用户所有数据库的读写权限</td></tr><tr><td>userAdminAnyDatabase</td><td>只在admin数据库中可用，赋予用户所有数据库的userAdmin权限</td></tr><tr><td>dbAdminAnyDatabase</td><td>只在admin数据库中可用，赋予用户所有数据库的dbAdmin权限</td></tr><tr><td>root</td><td>只在admin数据库中可用。超级账号，超级权限</td></tr></tbody></table> 
<h3><a id="72_147"></a>7.2、授权方式启动</h3> 
<ol><li>加上<code>--auth</code>启动mongodb</li></ol> 
<pre><code class="prism language-bash">mongod <span class="token parameter variable">-f</span> /app/mongodb-linux-x86_64-rhel70-4.4.26/mongo.conf <span class="token parameter variable">--auth</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/2c/8a/Ss88TyY0_o.png" alt="在这里插入图片描述"></p> 
<ol start="2"><li>使用有权限的账号密码认证</li></ol> 
<pre><code class="prism language-bash">mongo <span class="token parameter variable">-uzmc</span> <span class="token parameter variable">-p123456</span> <span class="token parameter variable">--authenticationDatabase</span><span class="token operator">=</span>admin
</code></pre> 
<p><img src="https://images2.imgbox.com/04/b8/piPoxJ7F_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="8MongoDB_164"></a>8、MongoDB文档操作</h2> 
<h3><a id="81_165"></a>8.1、新增文档</h3> 
<h4><a id="_166"></a>新增单个文档</h4> 
<ul><li>db.collection.insertOne()支持writeConcern</li></ul> 
<pre><code class="prism language-bash">db.collection.insertOne<span class="token punctuation">(</span>
   <span class="token operator">&lt;</span>document<span class="token operator">&gt;</span>,
   <span class="token punctuation">{<!-- --></span>
      writeConcern: <span class="token operator">&lt;</span>document<span class="token operator">&gt;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre> 
<blockquote> 
 <p>writeConcern 决定一个写操作落到多少个节点上才算成功。writeConcern 的取值包括<br> 0:发起写操作，不关心是否成功;<br> 1:集群最大数据节点数: 写操作需要被复制到指定节点数才算成功<br> majority: 写操作需要被复制到大多数节点上才算成功。</p> 
</blockquote> 
<pre><code class="prism language-bash">db.student_info.insertOne<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>name:<span class="token string">"小明"</span>,age:41,sex:<span class="token string">"男"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/04/a5/YHvlGKOr_o.png" alt="在这里插入图片描述"></p> 
<ul><li>insert: 若插入的数据主键已经存在，则会抛 DuplicateKeyException 异常，提示主键重复，不保存当前数据.</li></ul> 
<pre><code class="prism language-bash">db.student_info.insert<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>name:<span class="token string">"李四"</span>,age:20,sex:<span class="token string">"男"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/97/3a/rT5CHuMT_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_192"></a>新增多个文档</h4> 
<ul><li>insertMany()新增多个</li></ul> 
<pre><code class="prism language-bash">db.collection.insertMany<span class="token punctuation">(</span>
   <span class="token punctuation">[</span> <span class="token operator">&lt;</span>document <span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> , <span class="token operator">&lt;</span>document <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>, <span class="token punctuation">..</span>. <span class="token punctuation">]</span>,
   <span class="token punctuation">{<!-- --></span>
      writeConcern: <span class="token operator">&lt;</span>document<span class="token operator">&gt;</span>,
      ordered: <span class="token operator">&lt;</span>boolean<span class="token operator">&gt;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre> 
<blockquote> 
 <p>writeConcern: 写入策略，默认为 1，即要求确认写操作，0 是不要求<br> ordered:指定是否按顺序写入，默认 true，按顺序写入</p> 
</blockquote> 
<p>insert和save也可以实现批量插入</p> 
<pre><code class="prism language-bash">db.student_info.insertMany<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span>name:<span class="token string">"王五"</span>,age:21,sex:<span class="token string">"女"</span><span class="token punctuation">}</span>,<span class="token punctuation">{<!-- --></span>name:<span class="token string">"赵六"</span>,age:23,sex:<span class="token string">"女"</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

</code></pre> 
<p><img src="https://images2.imgbox.com/25/57/a38O3I6L_o.png" alt="在这里插入图片描述"></p> 
<ul><li>save:如果 id 主键存在则更新数据，如果不存在就插入数据。</li></ul> 
<h3><a id="82_215"></a>8.2、练习测试</h3> 
<ul><li>创建js文件</li></ul> 
<pre><code class="prism language-javascript"><span class="token keyword">let</span> tags<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"nosql"</span><span class="token punctuation">,</span><span class="token string">"MongoDB"</span><span class="token punctuation">,</span><span class="token string">"document"</span><span class="token punctuation">,</span><span class="token string">"developer"</span><span class="token punctuation">,</span><span class="token string">"popular"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> types <span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"technology"</span><span class="token punctuation">,</span><span class="token string">"sociality"</span><span class="token punctuation">,</span><span class="token string">"travel"</span><span class="token punctuation">,</span><span class="token string">"novel"</span><span class="token punctuation">,</span><span class="token string">"literature"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> books<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">60</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	<span class="token keyword">let</span> tagIndx<span class="token operator">=</span>Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span>tags<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">let</span> tyIndx<span class="token operator">=</span>Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span>types<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">let</span> favCount<span class="token operator">=</span>Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">120</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">let</span> book<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>
		<span class="token literal-property property">title</span><span class="token operator">:</span><span class="token string">"book_"</span><span class="token operator">+</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token literal-property property">type</span><span class="token operator">:</span>types<span class="token punctuation">[</span>tyIndx<span class="token punctuation">]</span><span class="token punctuation">,</span>
		<span class="token literal-property property">tag</span><span class="token operator">:</span>tags<span class="token punctuation">[</span>tagIndx<span class="token punctuation">]</span><span class="token punctuation">,</span>
		<span class="token literal-property property">favCount</span><span class="token operator">:</span>favCount<span class="token punctuation">,</span>
		<span class="token literal-property property">author</span><span class="token operator">:</span><span class="token string">"zmc_"</span><span class="token operator">+</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
	books<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>book<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
db<span class="token punctuation">.</span>books<span class="token punctuation">.</span><span class="token function">insertMany</span><span class="token punctuation">(</span>books<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li>载入数据库</li></ul> 
<pre><code class="prism language-bash">load<span class="token punctuation">(</span><span class="token string">"/app/mongodb-linux-x86_64-rhel70-4.4.26/js/book.js"</span><span class="token punctuation">)</span> <span class="token comment">#js文件的绝对路径</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/2c/36/3Iql3Xpq_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/75/98/aWHO3d2l_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="83_244"></a>8.3、查询文档</h3> 
<h4><a id="find_245"></a>find</h4> 
<pre><code class="prism language-bash">db.collection.find<span class="token punctuation">(</span>query,projection<span class="token punctuation">)</span>
</code></pre> 
<blockquote> 
 <p>query :可选，使用查询操作符指定查询条件相当于sql中的where</p> 
</blockquote> 
<blockquote> 
 <p>projection:可选，使用投影操作符指定返回的键(相当于返回sql表中指定的字段)。查询时返回文档中所有键值，只需省略该参数即可(默认省略)。投影时，id为1的时候，其他字段必须是1 ; id是0的时候，其他字段可以是0;如果没有_id字段约束，多个其他字段必须同为0或同为1。</p> 
</blockquote> 
<p><strong>例题</strong></p> 
<ul><li>查询title是book_2的数据</li></ul> 
<pre><code class="prism language-bash">db.books.find<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>title:<span class="token string">"book_2"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/f6/c5/3139kLt1_o.png" alt="在这里插入图片描述"></p> 
<ul><li>查询title是book_1并且author是author的数据</li></ul> 
<pre><code class="prism language-bash">db.books.find<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>title:<span class="token string">"book_1"</span>,author:<span class="token string">"zmc_1"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/94/4f/9qBHaoe5_o.png" alt="在这里插入图片描述"></p> 
<ul><li>查询type是"travel",tag是"document"，但是只想返回title，type，tag三个字段</li></ul> 
<pre><code class="prism language-bash">db.books.find<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>type:<span class="token string">"travel"</span>,tag:<span class="token string">"document"</span><span class="token punctuation">}</span>,<span class="token punctuation">{<!-- --></span>title:1,type:1,tag:1<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/d7/36/76mE6Xko_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="findOne_276"></a>findOne</h4> 
<p>同find一样，但是findOne只返回第一条数据</p> 
<pre><code class="prism language-bash">db.collection.findOne<span class="token punctuation">(</span>query,projection<span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-bash">db.books.findOne<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>type:<span class="token string">"travel"</span>,tag:<span class="token string">"document"</span><span class="token punctuation">}</span>,<span class="token punctuation">{<!-- --></span>title:1,type:1,tag:1<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre> 
<p><img src="https://images2.imgbox.com/07/a0/9nFabdEw_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="sqlmongodb_288"></a>sql与mongodb查询条件对照表</h4> 
<table><thead><tr><th>SQL</th><th>MongoDB</th></tr></thead><tbody><tr><td>filed=1</td><td>{field:1}</td></tr><tr><td>filed&lt;&gt;1</td><td>{field:{$ne:1}}</td></tr><tr><td>filed&gt;1</td><td>{field:{$gt:1}}</td></tr><tr><td>filed&gt;=1</td><td>{field:{$gte:1}}</td></tr><tr><td>filed&lt;1</td><td>{field:{$lt:1}}</td></tr><tr><td>filed&lt;=1</td><td>{field:{$lte:1}}</td></tr><tr><td>filed1=1 AND filed2=3</td><td>{field1:1, filed2:3}或{$and:[{field1:1},{field2:3}]}</td></tr><tr><td>filed1=1 OR filed2=3</td><td>{$or:[{field1:1},{field2:3}]}</td></tr><tr><td>filed IS NULL</td><td>{field:{$exists:false}}</td></tr><tr><td>filed IN (1,2,3)</td><td>{field:{$in:[1,2,3]}}</td></tr><tr><td>filed NOT IN (1,2,3)</td><td>{field:{$nin:[1,2,3]}}</td></tr></tbody></table> 
<p><strong>例：</strong></p> 
<ul><li>1</li></ul> 
<pre><code class="prism language-bash"><span class="token comment">#tag!=nosql 并且 type!=technology</span>
db.books.find<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>tag:<span class="token punctuation">{<!-- --></span><span class="token variable">$ne</span><span class="token builtin class-name">:</span><span class="token string">"nosql"</span><span class="token punctuation">}</span>,type:<span class="token punctuation">{<!-- --></span><span class="token variable">$ne</span><span class="token builtin class-name">:</span><span class="token string">"technology"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/2d/81/5jp9GAYo_o.png" alt="在这里插入图片描述"></p> 
<ul><li>2</li></ul> 
<pre><code class="prism language-bash"><span class="token comment">#favCount&gt;99</span>
db.books.find<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>favCount:<span class="token punctuation">{<!-- --></span><span class="token variable">$gt</span>:99<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/33/32/E81BQA9o_o.png" alt="在这里插入图片描述"></p> 
<ul><li>3</li></ul> 
<pre><code class="prism language-bash"><span class="token comment">#type=sociality 或者 tag=MongoDB</span>
db.books.find<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token variable">$or</span>:<span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span>type:<span class="token string">"sociality"</span><span class="token punctuation">}</span>,<span class="token punctuation">{<!-- --></span>tag:<span class="token string">"MongoDB"</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/a6/d9/tm1ZEGdj_o.png" alt="在这里插入图片描述"></p> 
<ul><li>4</li></ul> 
<pre><code class="prism language-bash"><span class="token comment">#查询不存在author字段的数据，如果author=null或author=""则查不到</span>
db.books.find<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>author:<span class="token punctuation">{<!-- --></span><span class="token variable">$exists</span>:false<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/8a/82/DuMhdPTJ_o.png" alt="{}"></p> 
<ul><li>5</li></ul> 
<pre><code class="prism language-bash"><span class="token comment">#tag IN ('nosql','popular','MongoDB',)</span>
db.books.find<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>tag:<span class="token punctuation">{<!-- --></span><span class="token variable">$in</span>:<span class="token punctuation">[</span><span class="token string">"nosql"</span>,<span class="token string">"popular"</span>,<span class="token string">"MongoDB"</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/a8/9f/57HOSBmz_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_338"></a>排序</h4> 
<pre><code class="prism language-bash"><span class="token comment">#查询type=sociality或者tagMongoDB，再根据type正序排序favCount倒序排序</span>
db.books.find<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token variable">$or</span>:<span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span>type:<span class="token string">"sociality"</span><span class="token punctuation">}</span>,<span class="token punctuation">{<!-- --></span>tag:<span class="token string">"MongoDB"</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>.sort<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>type:1,favCount:-1<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/7a/b0/hRA1JmZT_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_345"></a>分页</h4> 
<pre><code class="prism language-bash"><span class="token comment">#查询favCount&gt;=60，再跳过前三条数据，限制为5条数据</span>
db.books.find<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>favCount:<span class="token punctuation">{<!-- --></span><span class="token variable">$gte</span>:60<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>.skip<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>.limit<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/73/38/kzpNZdZL_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_353"></a>正则匹配(模糊)查询</h4> 
<pre><code class="prism language-bash"><span class="token comment">#type包含ve，相当于sql的type like '%ve%' </span>
db.books.find<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>type:<span class="token punctuation">{<!-- --></span><span class="token variable">$regex</span><span class="token builtin class-name">:</span><span class="token string">"ve"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/52/8a/lINwsd38_o.png" alt="在这里插入图片描述"><br> 也可以这样写</p> 
<pre><code class="prism language-bash">db.books.find<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>type:/ve/<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/68/81/ea5jCHd3_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="84_366"></a>8.4、更新文档</h3> 
<pre><code class="prism language-bash">db.collection.update<span class="token punctuation">(</span>query,update,options<span class="token punctuation">)</span>
</code></pre> 
<ul><li>query:描述更新的查询条件;相当于sql的where条件</li><li>update:描述更新的动作及新的内容;相当于sql的set</li><li>options:描述更新的选项 
  <ul><li>upsert:可选， 如果不存在update的记录，是否插入新的记录。默认false，不插入</li><li>multi:可选，是否更新多条记录。默认false,只更新找到的第一条记录</li><li>writeConcern :可选，决定一个写操作落到多少个节点上才算成功。</li></ul> </li></ul> 
<p><strong>更新操作符</strong></p> 
<table><thead><tr><th>操作符</th><th>格式</th><th>描述</th></tr></thead><tbody><tr><td>$set</td><td>{$set:{field:value}}</td><td>指定一个键并更新值，若键不存在则创建</td></tr><tr><td>$unset</td><td>{$unset:{field:1}}</td><td>删除一个键</td></tr><tr><td>$inc</td><td>{$inc : {field : value } }</td><td>对数值类型进行增减</td></tr><tr><td>$rename</td><td>{$rename :{old_field_name :new_field_name } }</td><td>修改字段名称</td></tr><tr><td>$push</td><td>{ $push : {field : value } }</td><td>将数值追加到数组中，若数组不存在则会进行初始化</td></tr><tr><td>$pushAll</td><td>{$pushAll : {field : value_array}}</td><td>追加多个值到一个数组字段内</td></tr><tr><td>$pull</td><td>{$pull : {field : _value } }</td><td>从数组中删除指定的元素</td></tr><tr><td>$addToSet</td><td>{$addToSet : {field : value } }</td><td>添加元素到数组中，具有排重功能</td></tr><tr><td>$pop</td><td>{$pop : {field : 1 }}</td><td>删除数组的第一个或最后一个元素</td></tr></tbody></table> 
<h4><a id="update_390"></a>更新单个文档update</h4> 
<pre><code class="prism language-bash"><span class="token comment">#把type=travel的数据，favCount减去100</span>
db.books.update<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>type:<span class="token string">"travel"</span><span class="token punctuation">}</span>,<span class="token punctuation">{<!-- --></span><span class="token variable">$inc</span>:<span class="token punctuation">{<!-- --></span>favCount:-100<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/c1/c6/fuvHzSVs_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/18/c2/frbgNXpp_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="updateOne_398"></a>更新单个文档updateOne</h4> 
<pre><code class="prism language-bash">db.books.updateOne<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>type:<span class="token string">"travel"</span><span class="token punctuation">}</span>,<span class="token punctuation">{<!-- --></span><span class="token variable">$set</span>:<span class="token punctuation">{<!-- --></span>createDate:<span class="token string">"2133-12-23T11:48:22.913Z"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/67/4f/BfBR9MM3_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="replaceOne_404"></a>替换单个文档replaceOne</h4> 
<pre><code class="prism language-bash">db.books.replaceOne<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>type:<span class="token string">"travel"</span><span class="token punctuation">}</span>,<span class="token punctuation">{<!-- --></span><span class="token string">"title"</span> <span class="token builtin class-name">:</span> <span class="token string">"book_116"</span>, <span class="token string">"type"</span> <span class="token builtin class-name">:</span> <span class="token string">"travel"</span>, <span class="token string">"tag"</span> <span class="token builtin class-name">:</span> <span class="token string">"developer"</span>, <span class="token string">"favCount"</span> <span class="token builtin class-name">:</span> <span class="token number">81</span>, <span class="token string">"author"</span> <span class="token builtin class-name">:</span> <span class="token string">"zmc_6"</span>, <span class="token string">"createDate"</span> <span class="token builtin class-name">:</span> ISODate<span class="token punctuation">(</span><span class="token string">"2023-12-23T11:48:22.913Z"</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/5a/28/7iSnaWWe_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_412"></a>不使用操作符实现替换文档</h4> 
<p>不可实现替换多个文档</p> 
<pre><code class="prism language-bash"><span class="token comment">#彻底替换整个文档</span>
db.books.update<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>type:<span class="token string">"zmc"</span><span class="token punctuation">}</span>,<span class="token punctuation">{<!-- --></span>oneField:12222<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/98/17/L8O3Ll0Z_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="update_421"></a>更新多个文档update</h4> 
<p>需要配合使用multi，设置为true</p> 
<pre><code class="prism language-bash"><span class="token comment">#更新多行数据，并添加createDate字段（如果没有该字段，则新增该字段）</span>
db.books.update<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>type:<span class="token string">"travel"</span><span class="token punctuation">}</span>,<span class="token punctuation">{<!-- --></span><span class="token variable">$set</span>:<span class="token punctuation">{<!-- --></span>createDate:new Date<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span>,<span class="token punctuation">{<!-- --></span>multi:true<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/a3/02/uUIRykT5_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="updateMany_430"></a>更新多个文档updateMany</h4> 
<pre><code class="prism language-bash">db.books.updateMany<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>type:<span class="token string">"travel"</span><span class="token punctuation">}</span>,<span class="token punctuation">{<!-- --></span><span class="token variable">$set</span>:<span class="token punctuation">{<!-- --></span>createDate:new Date<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/83/1d/w1q5Pno2_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="upsert_436"></a>不存在则插入upsert</h4> 
<pre><code class="prism language-bash">db.books.update<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>type:<span class="token string">"zmc"</span><span class="token punctuation">}</span>,<span class="token punctuation">{<!-- --></span><span class="token variable">$set</span>:<span class="token punctuation">{<!-- --></span>createDate:<span class="token string">"2133-12-23T11:48:22.913Z"</span>,tag:<span class="token punctuation">[</span><span class="token number">1,2</span>,3<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span>,<span class="token punctuation">{<!-- --></span>upsert:true<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/2c/eb/rdML1Gwl_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="findAndModify_442"></a>查询和修改单个文档findAndModify</h4> 
<p>findAndModify只能更新单个文档</p> 
<ul><li>先查询旧值再更新文档</li></ul> 
<pre><code class="prism language-bash"><span class="token comment">#先查询title=book_1的数据，再把该条数据的athor修改为zhangmengchao</span>
db.books.findAndModify<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>query:<span class="token punctuation">{<!-- --></span>title:<span class="token string">"book_1"</span><span class="token punctuation">}</span>,update:<span class="token punctuation">{<!-- --></span><span class="token variable">$set</span>:<span class="token punctuation">{<!-- --></span>author:<span class="token string">"zhangmengchao"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/1e/75/05rI2fqz_o.png" alt="在这里插入图片描述"></p> 
<ul><li>先更新文档再查询修改后的内容<br> 加上参数new，设置为true</li></ul> 
<pre><code class="prism language-bash">db.books.findAndModify<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>query:<span class="token punctuation">{<!-- --></span>title:<span class="token string">"book_2"</span><span class="token punctuation">}</span>,update:<span class="token punctuation">{<!-- --></span><span class="token variable">$set</span>:<span class="token punctuation">{<!-- --></span>author:<span class="token string">"zhangmengchao2"</span><span class="token punctuation">}</span><span class="token punctuation">}</span>,new:true<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/fe/34/RrQImufp_o.png" alt="在这里插入图片描述"><br> 与findAndModify语义相近的命令如下:<br> findOneAndUpdate:更新单个文档并返回史新前(或更新后)的文档。. findOneAndReplace:替换单个文档并返回替换前(或替换后的文档。</p> 
<h3><a id="85_460"></a>8.5、删除文档</h3> 
<h4><a id="remove_461"></a>删除多个文档remove</h4> 
<pre><code class="prism language-bash"><span class="token comment">#删除type是sociality和novel并且favCount&gt;=18的数据</span>
db.books.remove<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>type:<span class="token punctuation">{<!-- --></span><span class="token variable">$in</span>:<span class="token punctuation">[</span><span class="token string">"sociality"</span>,<span class="token string">"novel"</span><span class="token punctuation">]</span><span class="token punctuation">}</span>,favCount:<span class="token punctuation">{<!-- --></span><span class="token variable">$gte</span>:18<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p>满足条件的有17个全删了<br> <img src="https://images2.imgbox.com/b3/02/7EeON2JR_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="remove_468"></a>删除单个文档remove</h4> 
<pre><code class="prism language-bash"><span class="token comment">#justOne为true，代表只删除一个文档</span>
db.books.remove<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>type:<span class="token string">"travel"</span><span class="token punctuation">}</span>,<span class="token punctuation">{<!-- --></span>justOne:true<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/a4/b4/uhm8Y92m_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="remove_475"></a>删除所有文档remove</h4> 
<pre><code class="prism language-bash">db.books.remove<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="deleteOne_480"></a>删除单个文档deleteOne</h4> 
<pre><code class="prism language-bash"><span class="token comment">#删除type=novel或者tag为MongoDB，并且favCount&gt;100的一条数据</span>
db.books.deleteOne<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token variable">$or</span>:<span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span>type:<span class="token string">"novel"</span><span class="token punctuation">}</span>,<span class="token punctuation">{<!-- --></span>tag:<span class="token punctuation">{<!-- --></span><span class="token variable">$in</span>:<span class="token punctuation">[</span><span class="token string">"MongoDB"</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">]</span>,favCount:<span class="token punctuation">{<!-- --></span><span class="token variable">$gt</span>:100<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/7a/17/SZoynSX3_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="deleteMany_486"></a>删除多个文档deleteMany</h4> 
<pre><code class="prism language-bash"><span class="token comment">#删除type=novel或者tag为MongoDB，并且favCount&gt;100的多条数据</span>
db.books.deleteMany<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token variable">$or</span>:<span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span>type:<span class="token string">"novel"</span><span class="token punctuation">}</span>,<span class="token punctuation">{<!-- --></span>tag:<span class="token punctuation">{<!-- --></span><span class="token variable">$in</span>:<span class="token punctuation">[</span><span class="token string">"MongoDB"</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">]</span>,favCount:<span class="token punctuation">{<!-- --></span><span class="token variable">$gt</span>:100<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/57/8b/lIYNVVVb_o.png" alt="在这里插入图片描述"><br> 删除所有文档</p> 
<pre><code class="prism language-bash">db.books.deleteMany<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="findOneAndDelete_497"></a>查询和删除单个文档findOneAndDelete</h4> 
<ul><li>删除文档后并返回删的文档</li></ul> 
<pre><code class="prism language-bash"><span class="token comment">#删除author=zhangmengchao的文档</span>
db.books.findOneAndDelete<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">"author"</span> <span class="token builtin class-name">:</span> <span class="token string">"zhangmengchao"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/7c/2d/ZgjqbPCk_o.png" alt="在这里插入图片描述"></p> 
<ul><li>先排序再删除文档</li></ul> 
<pre><code class="prism language-bash"><span class="token comment">#查询出满足tag=popular的所有文档，再倒序排序。删除第一个文档</span>
db.books.findOneAndDelete<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">"tag"</span> <span class="token builtin class-name">:</span> <span class="token string">"popular"</span><span class="token punctuation">}</span>,<span class="token punctuation">{<!-- --></span>sort:<span class="token punctuation">{<!-- --></span>favCount:-1<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/53/79/OaJe3oBh_o.png" alt="在这里插入图片描述"><br> remove、deleteOne等命令只能按默认顺序删除，利用这个特性, findOneAndDelete可以实现队列的先进先出。</p> 
<h2><a id="9MongoDB_Compass_GUI_512"></a>9、MongoDB Compass (GUI)</h2> 
<p>https://downloads.mongodb.com/compass/mongodb-compass-1.41.0-win32-x64.exe<br> 在Linux环境部署MongoDB需要开放MongoDB的端口<br> <img src="https://images2.imgbox.com/7c/74/jP8dbVT1_o.png" alt="在这里插入图片描述"><br> 进入后的画面<br> <img src="https://images2.imgbox.com/c7/c9/3mhafy44_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="10SpringBoot_518"></a>10、整合SpringBoot</h2> 
<h3><a id="101_519"></a>10.1、环境配置</h3> 
<pre><code class="prism language-xml"><span class="token comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-data-mongodb --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-mongodb<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">data</span><span class="token punctuation">:</span>
    <span class="token key atrule">mongodb</span><span class="token punctuation">:</span>
      <span class="token key atrule">database</span><span class="token punctuation">:</span> zmcdb
      <span class="token key atrule">host</span><span class="token punctuation">:</span> 192.168.0.104
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">27017</span>
      <span class="token key atrule">username</span><span class="token punctuation">:</span> zmc
      <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token string">'123456'</span>   <span class="token comment">#注意密码加单引号</span>
      <span class="token key atrule">authentication-database</span><span class="token punctuation">:</span> admin
      <span class="token comment">#或者</span>
<span class="token comment">#     uri: mongodb://zmc:123456@192.168.0.104:27017/zmcdb?authSource=admin</span>
</code></pre> 
<h3><a id="102MongoTemplate_542"></a>10.2、注入MongoTemplate</h3> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">private</span> <span class="token class-name">MongoTemplate</span> mongoTemplate<span class="token punctuation">;</span>
</code></pre> 
<h3><a id="103__548"></a>10.3、 集合操作</h3> 
<pre><code class="prism language-java">    <span class="token comment">/**
     * 判断集合（表）是否存在，删除集合（表），创建集合（表）
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">createCollections</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">COLLECTION_NAME</span> <span class="token operator">=</span> <span class="token string">"student_info"</span><span class="token punctuation">;</span>
        <span class="token keyword">boolean</span> exists <span class="token operator">=</span> mongoTemplate<span class="token punctuation">.</span><span class="token function">collectionExists</span><span class="token punctuation">(</span><span class="token constant">COLLECTION_NAME</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>exists<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            mongoTemplate<span class="token punctuation">.</span><span class="token function">dropCollection</span><span class="token punctuation">(</span><span class="token constant">COLLECTION_NAME</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        mongoTemplate<span class="token punctuation">.</span><span class="token function">createCollection</span><span class="token punctuation">(</span><span class="token constant">COLLECTION_NAME</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<h3><a id="104_564"></a>10.4、相关注解</h3> 
<p><strong>@Document</strong></p> 
<ul><li>修饰范围:用在类上</li><li>作用:用来映射这个类的一个对象为mongo中一条文栏数据。</li><li>属性:( value 、collection )用来指定操作的集合名称</li></ul> 
<p><strong>@MongoId</strong></p> 
<ul><li>修饰范围:用在成员变量、方法上</li><li>作用:用来将成员变量的值映射为文档的id的值</li></ul> 
<p><strong>@Field</strong></p> 
<ul><li>修饰范围:用在成员变量、方法上</li><li>作用:用来将成员变量及其值映射为文档中一个key:value对。</li><li>属性:( name , value )用来指定在文档中key的名称,默认为成员变量名</li></ul> 
<p><strong>@Transient</strong></p> 
<ul><li>修饰范围:用在成员变量、方法上</li><li>作用:用来指定此成员变量不参与文档的序列化</li></ul> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Document</span><span class="token punctuation">(</span><span class="token string">"student_info"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Accessors</span><span class="token punctuation">(</span>chain <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StudentInfoDTO</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@MongoId</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Field</span><span class="token punctuation">(</span><span class="token string">"stuName"</span><span class="token punctuation">)</span><span class="token comment">//自定义文档的字段名</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Field</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> age<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Field</span>
    <span class="token keyword">private</span> <span class="token class-name">Character</span> sex<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Field</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> birthday<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="105_603"></a>10.5、新增文档</h3> 
<h4><a id="insert_604"></a>新增单个文档insert</h4> 
<p>id不能重复，如果重复就会抛出异常</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">insertSingle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">StudentInfoDTO</span> dto<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">StudentInfoDTO</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"张三"</span><span class="token punctuation">,</span><span class="token number">23</span><span class="token punctuation">,</span><span class="token char">'男'</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">StudentInfoDTO</span> insert <span class="token operator">=</span> mongoTemplate<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>dto<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/34/15/WHu1heb9_o.png" alt="在这里插入图片描述"><br> 相同id再次新增就会报错<br> <img src="https://images2.imgbox.com/b6/63/GrobyKfK_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="insert_616"></a>新增多个文档insert</h4> 
<pre><code class="prism language-java">    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">insertMore</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">StudentInfoDTO</span><span class="token punctuation">&gt;</span></span> listDto<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">StudentInfoDTO</span> dto1<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">StudentInfoDTO</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">"小明"</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token char">'男'</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">StudentInfoDTO</span> dto2<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">StudentInfoDTO</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"小黑"</span><span class="token punctuation">,</span><span class="token number">21</span><span class="token punctuation">,</span><span class="token char">'女'</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">StudentInfoDTO</span> dto3<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">StudentInfoDTO</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token string">"小白"</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token char">'男'</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        listDto<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>dto1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        listDto<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>dto2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        listDto<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>dto3<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">StudentInfoDTO</span><span class="token punctuation">&gt;</span></span> insert <span class="token operator">=</span> mongoTemplate<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>listDto<span class="token punctuation">,</span> <span class="token class-name">StudentInfoDTO</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/f8/b7/W4sby8F4_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="save_632"></a>新增单个文档save</h4> 
<p>若id存在，则修改该文档</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">saveSingle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">StudentInfoDTO</span> dto<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">StudentInfoDTO</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"老六"</span><span class="token punctuation">,</span><span class="token number">213</span><span class="token punctuation">,</span><span class="token char">'男'</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">StudentInfoDTO</span> save <span class="token operator">=</span> mongoTemplate<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>dto<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/d8/d3/0A1DzTak_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="106_642"></a>10.6、查询文档</h3> 
<p>Criteria是标准查询的接口，可以引用静态的Criteria.where的把多个条件组合在起，就可以轻松地将多个方法标准和查询连接起来，方便我们操作查询语句。</p> 
<h4><a id="CriteriaMongoDBSQL_644"></a>Criteria、MongoDB、SQL对比</h4> 
<table><thead><tr><th>Criteria</th><th>MongoDB</th><th>SQL</th></tr></thead><tbody><tr><td>Criteria and (String key)</td><td>$and</td><td>where field1=1 and field2=2</td></tr><tr><td>Criteria andOperator(Criteria… criteria)</td><td>$and</td><td>where field1=1 and field2=2</td></tr><tr><td>Criteria orOperator (Criteria. … criteria)</td><td>$or</td><td>where field1=1 or field2=2</td></tr><tr><td>Criteria gt (Object o)</td><td>$gt</td><td>where field&gt;1</td></tr><tr><td>Criteria gte (Object o)</td><td>$gte</td><td>where field&gt;=1</td></tr><tr><td>Criteria in (Object… o)</td><td>$in</td><td>where field in (1,2,3)</td></tr><tr><td>Criteria is (Object o)</td><td>$is</td><td>where field =1</td></tr><tr><td>Criteria It(Object o)</td><td>$lt</td><td>where field&lt;1</td></tr><tr><td>Criteria Ite (Object o)</td><td>$lte</td><td>where field&lt;=1</td></tr><tr><td>Criteria nin (Object… o)</td><td>$nin</td><td>where field not in (1,2,3)</td></tr></tbody></table> 
<h4><a id="findAll_657"></a>查询所有文档findAll</h4> 
<pre><code class="prism language-java">    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">criteriaFind</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//查询age&gt;20 and stuName in ('老六','小黑')</span>
        <span class="token class-name">Query</span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token class-name">Criteria</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">gt</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token string">"stuName"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">in</span><span class="token punctuation">(</span><span class="token string">"老六"</span><span class="token punctuation">,</span> <span class="token string">"小黑"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">StudentInfoDTO</span><span class="token punctuation">&gt;</span></span> dtoList <span class="token operator">=</span> mongoTemplate<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token class-name">StudentInfoDTO</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dtoList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/f4/26/FP4stxmO_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="idfindById_668"></a>根据id查询文档findById</h4> 
<pre><code class="prism language-java">    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">findById</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">StudentInfoDTO</span> byId <span class="token operator">=</span> mongoTemplate<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">StudentInfoDTO</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>byId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/3a/a4/im4swYC6_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="findOne_678"></a>查询单个文档findOne</h4> 
<pre><code class="prism language-java">    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">StudentInfoDTO</span> one <span class="token operator">=</span> mongoTemplate<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">StudentInfoDTO</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>one<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/ca/00/PtEMcCBe_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_688"></a>查询所有满足条件的文档</h4> 
<h5><a id="_and_in_689"></a><code>&gt; and in</code></h5> 
<pre><code class="prism language-java">    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">criteriaFind</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//查询age&gt;20</span>
        <span class="token class-name">Query</span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token class-name">Criteria</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">gt</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">StudentInfoDTO</span><span class="token punctuation">&gt;</span></span> dtoList <span class="token operator">=</span> mongoTemplate<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token class-name">StudentInfoDTO</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dtoList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/92/1a/gdTsGtB9_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="_or_and__701"></a><code>&gt; or and =</code></h5> 
<pre><code class="prism language-java">    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">criteriaFind2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//查询age&gt;30 or stuName = '小白' and sex='男'</span>
        <span class="token class-name">Criteria</span> criteria <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Criteria</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orOperator</span><span class="token punctuation">(</span>
                <span class="token class-name">Criteria</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">gt</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token class-name">Criteria</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">"stuName"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span><span class="token string">"小白"</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">andOperator</span><span class="token punctuation">(</span>
                <span class="token class-name">Criteria</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">"sex"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span><span class="token string">"男"</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Query</span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span>criteria<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">StudentInfoDTO</span><span class="token punctuation">&gt;</span></span> studentInfoDTOS <span class="token operator">=</span> mongoTemplate<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token class-name">StudentInfoDTO</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        studentInfoDTOS<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/69/fc/t0pTSNzU_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="like__719"></a><code>like </code></h5> 
<pre><code class="prism language-java">    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">criteriaFind3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//查询stuName like '%小%'</span>
        <span class="token class-name">Criteria</span> criteria <span class="token operator">=</span> <span class="token class-name">Criteria</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">"stuName"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">regex</span><span class="token punctuation">(</span><span class="token string">"小"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Query</span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span>criteria<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">StudentInfoDTO</span><span class="token punctuation">&gt;</span></span> studentInfoDTOS <span class="token operator">=</span> mongoTemplate<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token class-name">StudentInfoDTO</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        studentInfoDTOS<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/53/ce/2L3BcieI_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="order_by__732"></a><code>order by 排序</code></h5> 
<pre><code class="prism language-java">    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">criteriaFind4</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//查询sex='男' order by age desc</span>
        <span class="token class-name">Criteria</span> criteria <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Criteria</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        criteria<span class="token punctuation">.</span><span class="token function">andOperator</span><span class="token punctuation">(</span><span class="token class-name">Criteria</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">"sex"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span><span class="token string">"男"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Query</span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span>criteria<span class="token punctuation">)</span><span class="token punctuation">;</span>
        query<span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span><span class="token class-name">Sort</span><span class="token punctuation">.</span><span class="token function">by</span><span class="token punctuation">(</span><span class="token class-name">Sort<span class="token punctuation">.</span>Order</span><span class="token punctuation">.</span><span class="token function">desc</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">StudentInfoDTO</span><span class="token punctuation">&gt;</span></span> studentInfoDTOS <span class="token operator">=</span> mongoTemplate<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token class-name">StudentInfoDTO</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        studentInfoDTOS<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/b3/a6/PoEYsgOq_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="skip_limit_747"></a><code>skip limit分页</code></h5> 
<pre><code class="prism language-java">    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">criteriaFind5</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//where birthday&lt;=当前时间 limit 1,3</span>
        <span class="token class-name">Criteria</span> criteria <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Criteria</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        criteria<span class="token punctuation">.</span><span class="token function">andOperator</span><span class="token punctuation">(</span><span class="token class-name">Criteria</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">"birthday"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lte</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Query</span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span>criteria<span class="token punctuation">)</span><span class="token punctuation">;</span>
        query<span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">StudentInfoDTO</span><span class="token punctuation">&gt;</span></span> studentInfoDTOS <span class="token operator">=</span> mongoTemplate<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token class-name">StudentInfoDTO</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        studentInfoDTOS<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/bc/b7/bCoWfYaY_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_762"></a>查询单个满足条件的文档</h4> 
<pre><code class="prism language-java">    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">criteriaFindOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//查询age&gt;20 and stuName not in ('老六')</span>
        <span class="token class-name">Query</span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token class-name">Criteria</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">gte</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token string">"stuName"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nin</span><span class="token punctuation">(</span><span class="token string">"老六"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">StudentInfoDTO</span> one <span class="token operator">=</span> mongoTemplate<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token class-name">StudentInfoDTO</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>one<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/b7/32/aQNeJb8I_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="JSON_774"></a>JSON串查询</h4> 
<p><img src="https://images2.imgbox.com/6f/a4/U33j5Q2O_o.png" alt="在这里插入图片描述"></p> 
<p>json查询不能分页和排序</p> 
<pre><code class="prism language-java">    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">criteriaFind6</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//where age&gt;=20 and stuName like '%小%'</span>
        <span class="token class-name">String</span> json <span class="token operator">=</span> <span class="token string">"{age:{$gte:20},stuName:{$regex:\"小\"}})"</span><span class="token punctuation">;</span>
        <span class="token class-name">Query</span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BasicQuery</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
        query<span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span><span class="token class-name">Sort</span><span class="token punctuation">.</span><span class="token function">by</span><span class="token punctuation">(</span><span class="token class-name">Sort<span class="token punctuation">.</span>Order</span><span class="token punctuation">.</span><span class="token function">asc</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">StudentInfoDTO</span><span class="token punctuation">&gt;</span></span> studentInfoDTOS <span class="token operator">=</span> mongoTemplate<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token class-name">StudentInfoDTO</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        studentInfoDTOS<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/d1/59/yPFtQLJG_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="107_790"></a>10.7、更新文档</h3> 
<h4><a id="updateFirst_791"></a>更新第一条记录updateFirst</h4> 
<p>更新前的数据<br> <img src="https://images2.imgbox.com/aa/b9/SiCiWUYh_o.png" alt="在这里插入图片描述"><br> 更新后的数据<br> <img src="https://images2.imgbox.com/e8/bb/LbbgMcgR_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-java">    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//update table set age+10 where age &gt; 100 or stuName in ('小明','大明')</span>
        <span class="token class-name">Criteria</span> criteria <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Criteria</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        criteria<span class="token punctuation">.</span><span class="token function">orOperator</span><span class="token punctuation">(</span><span class="token class-name">Criteria</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">gt</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">Criteria</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">"stuName"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">in</span><span class="token punctuation">(</span><span class="token string">"小明"</span><span class="token punctuation">,</span> <span class="token string">"大明"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Query</span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span>criteria<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Update</span> update <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        update<span class="token punctuation">.</span><span class="token function">inc</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">UpdateResult</span> updateResult <span class="token operator">=</span> mongoTemplate<span class="token punctuation">.</span><span class="token function">updateFirst</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> update<span class="token punctuation">,</span> <span class="token class-name">StudentInfoDTO</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>updateResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/f8/99/7ys68L82_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="updateMulti_812"></a>更新所有满足条件的记录updateMulti</h4> 
<p>更新前的数据<br> <img src="https://images2.imgbox.com/1d/73/3qHmNk7o_o.png" alt="在这里插入图片描述"><br> 更新后的数据<br> <img src="https://images2.imgbox.com/0c/f7/OcaI0Oa0_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-java">    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateMulti</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//update table set age=18 where sex='女'</span>
        <span class="token class-name">Query</span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token class-name">Criteria</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">"sex"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span><span class="token string">"女"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Update</span> update <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        update<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">UpdateResult</span> updateResult <span class="token operator">=</span> mongoTemplate<span class="token punctuation">.</span><span class="token function">updateMulti</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> update<span class="token punctuation">,</span> <span class="token class-name">StudentInfoDTO</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>updateResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/8b/4d/1sRxnn8V_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="upsert_831"></a>没有符合更新条件的则新增upsert</h4> 
<p>更新前的数据<br> <img src="https://images2.imgbox.com/20/66/KSLpPjYo_o.png" alt="在这里插入图片描述"><br> 更新后的数据<br> <img src="https://images2.imgbox.com/3b/99/unEb2Al0_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-java">    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">upsert</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">//update table set stuName="zmc",age=500,sex='男',salary=999999 where id=666</span>
        <span class="token class-name">Query</span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token class-name">Criteria</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span><span class="token number">666</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Update</span> update <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        update<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"stuName"</span><span class="token punctuation">,</span><span class="token string">"zmc"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">,</span><span class="token number">500</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"salary"</span><span class="token punctuation">,</span><span class="token number">999999</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">UpdateResult</span> upsert <span class="token operator">=</span> mongoTemplate<span class="token punctuation">.</span><span class="token function">upsert</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> update<span class="token punctuation">,</span> <span class="token class-name">StudentInfoDTO</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>upsert<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/c1/cf/XAWQ9Bpq_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="108remove_850"></a>10.8、删除文档remove</h3> 
<p>删除前的数据<br> <img src="https://images2.imgbox.com/2c/92/GKq2FwCT_o.png" alt="在这里插入图片描述"><br> 删除后的数据<br> <img src="https://images2.imgbox.com/93/a5/hKnic2rR_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-java">    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//delete from table where salary&gt;100 or stuName='中白'</span>
        <span class="token class-name">Criteria</span> criteria <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Criteria</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        criteria<span class="token punctuation">.</span><span class="token function">orOperator</span><span class="token punctuation">(</span><span class="token class-name">Criteria</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">"salary"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">gt</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">Criteria</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">"stuName"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span><span class="token string">"中白"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Query</span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span>criteria<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">DeleteResult</span> remove <span class="token operator">=</span> mongoTemplate<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token class-name">StudentInfoDTO</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>remove<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/68/9e/EQb5MTkQ_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="11_868"></a>11、聚合操作</h2> 
<p>如统计，求平均值，求和等。<br> 聚合操作分为：单—作用聚合、聚合管道、MapReduce</p> 
<ul><li>单一作用聚合:提供了对常见聚合过程的简单访问，操作都从单个集合聚合文档。</li><li>聚合管道：类似Stream流</li><li>MapReduce操作具有两个阶段:处理每个文档并向每个输入文档发射一个或多个对象的map阶段，以及reduce组合map操作的输出阶段。</li></ul> 
<h3><a id="111_875"></a>11.1、单一聚合操作</h3> 
<h4><a id="count_876"></a>count</h4> 
<pre><code class="prism language-java">#统计type<span class="token operator">=</span>novel或者tag<span class="token operator">=</span><span class="token class-name">MongoDB</span>的数量
db<span class="token punctuation">.</span>books<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>$or<span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">"type"</span> <span class="token operator">:</span> <span class="token string">"novel"</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{<!-- --></span><span class="token string">"tag"</span> <span class="token operator">:</span> <span class="token string">"MongoDB"</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/f3/92/eJYSJB8a_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="estimatedDocumentCount_883"></a>estimatedDocumentCount</h4> 
<p>该命令会忽略查询条件</p> 
<pre><code class="prism language-java">db<span class="token punctuation">.</span>books<span class="token punctuation">.</span><span class="token function">estimatedDocumentCount</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>$or<span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">"type"</span> <span class="token operator">:</span> <span class="token string">"novel"</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{<!-- --></span><span class="token string">"tag"</span> <span class="token operator">:</span> <span class="token string">"MongoDB"</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/0a/cf/6s9T0goS_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="distinct_890"></a>distinct</h4> 
<pre><code class="prism language-java">db<span class="token punctuation">.</span>books<span class="token punctuation">.</span><span class="token function">distinct</span><span class="token punctuation">(</span><span class="token string">"type"</span><span class="token punctuation">,</span><span class="token punctuation">{<!-- --></span>$or<span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">"type"</span> <span class="token operator">:</span> <span class="token string">"novel"</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{<!-- --></span><span class="token string">"tag"</span> <span class="token operator">:</span> <span class="token string">"MongoDB"</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/f4/f5/FFBoyJik_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="112Stream_895"></a>11.2、聚合管道类似Stream流</h3> 
<p><strong>语法</strong></p> 
<pre><code class="prism language-bash">pipeline <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token variable">$stage1</span>,<span class="token variable">$stage2</span>,<span class="token variable">$stage3</span><span class="token punctuation">..</span>.<span class="token punctuation">]</span>
db.collection.aggregate<span class="token punctuation">(</span>pipeline ,<span class="token punctuation">{<!-- --></span>options<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<ul><li>pipelines一组数据聚合阶段。除<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          o 
         
        
          u 
         
        
          t 
         
        
          、 
         
        
       
         out、 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class="mord mathnormal">t</span><span class="mord cjk_fallback">、</span></span></span></span></span>Merge和$geonear阶段之外，每个阶段都可以在管道中出现多次</li><li>options可选，聚合操作的其他参数。包含:查询计划、是否使用临时文件、游标、最大操作时间、读写策略、强制索引等等<br> <img src="https://images2.imgbox.com/30/43/M04IdH2p_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/85/02/I17zUcMA_o.png" alt="在这里插入图片描述"></li></ul> 
<h4><a id="_906"></a>常用操作</h4> 
<p><img src="https://images2.imgbox.com/1b/23/l9Rmd1aK_o.png" alt="在这里插入图片描述"><br> 官方文档<br> https://www.mongodb.com/docs/manual/reference/operator/aggregation-pipeline/</p> 
<h4><a id="_910"></a>数据准备</h4> 
<pre><code class="prism language-javascript"><span class="token keyword">let</span> tags<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"nosql"</span><span class="token punctuation">,</span><span class="token string">"MongoDB"</span><span class="token punctuation">,</span><span class="token string">"document"</span><span class="token punctuation">,</span><span class="token string">"developer"</span><span class="token punctuation">,</span><span class="token string">"popular"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> types <span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"technology"</span><span class="token punctuation">,</span><span class="token string">"sociality"</span><span class="token punctuation">,</span><span class="token string">"travel"</span><span class="token punctuation">,</span><span class="token string">"novel"</span><span class="token punctuation">,</span><span class="token string">"literature"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> books<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">60</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	<span class="token keyword">let</span> tagIndx<span class="token operator">=</span>Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span>tags<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">let</span> tagIndx2<span class="token operator">=</span>Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span>tags<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">let</span> tyIndx<span class="token operator">=</span>Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span>types<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">let</span> favCount<span class="token operator">=</span>Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">120</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">let</span> username<span class="token operator">=</span><span class="token string">"zmc"</span><span class="token operator">+</span>Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">let</span> age<span class="token operator">=</span><span class="token number">20</span><span class="token operator">+</span>Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">let</span> book<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>
		<span class="token literal-property property">title</span><span class="token operator">:</span><span class="token string">"book_"</span><span class="token operator">+</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token literal-property property">type</span><span class="token operator">:</span>types<span class="token punctuation">[</span>tyIndx<span class="token punctuation">]</span><span class="token punctuation">,</span>
		<span class="token literal-property property">tag</span><span class="token operator">:</span><span class="token punctuation">[</span>tags<span class="token punctuation">[</span>tagIndx<span class="token punctuation">]</span><span class="token punctuation">,</span>tags<span class="token punctuation">[</span>tagIndx2<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
		<span class="token literal-property property">favCount</span><span class="token operator">:</span>favCount<span class="token punctuation">,</span>
		<span class="token literal-property property">author</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span><span class="token literal-property property">name</span><span class="token operator">:</span>username<span class="token punctuation">,</span><span class="token literal-property property">age</span><span class="token operator">:</span>age<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
	books<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>book<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// console.log(books)</span>
db<span class="token punctuation">.</span>books2<span class="token punctuation">.</span><span class="token function">insertMany</span><span class="token punctuation">(</span>books<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-bash"><span class="token comment">#载入数据</span>
load<span class="token punctuation">(</span><span class="token string">"/app/mongodb-linux-x86_64-rhel70-4.4.26/js/books2.js"</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/27/1a/YOJ1I8KG_o.png" alt="在这里插入图片描述"><br> 查看载入的数据</p> 
<pre><code class="prism language-bash"><span class="token comment">#pretty是格式化json数据</span>
db.books2.find<span class="token punctuation">(</span><span class="token punctuation">)</span>.pretty<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/0b/6f/96fY3gBf_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="project__948"></a>$project 设置别名，控制需要展示的字段</h4> 
<ul><li>设置别名</li></ul> 
<pre><code class="prism language-bash"><span class="token comment">#把title改为bookName</span>
db.books2.aggregate<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token variable">$project</span>:<span class="token punctuation">{<!-- --></span>bookName:<span class="token string">"<span class="token variable">$title</span>"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/ac/78/oC5kn0t3_o.png" alt="在这里插入图片描述"></p> 
<ul><li>控制需要展示的字段</li></ul> 
<pre><code class="prism language-bash"><span class="token comment">#把title改为bookName，不展示id，展示type，technology，tag</span>
db.books2.aggregate<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token variable">$project</span>:<span class="token punctuation">{<!-- --></span>bookName:<span class="token string">"<span class="token variable">$title</span>"</span>,_id:0,type:1,technology:1,tag:1<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/e8/9c/pyNLzPZ4_o.png" alt="在这里插入图片描述"></p> 
<ul><li>从嵌套文档中控制需要展示的字段</li></ul> 
<pre><code class="prism language-bash">db.books2.aggregate<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token variable">$project</span>:<span class="token punctuation">{<!-- --></span><span class="token string">"author.name"</span>:1<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
或
db.books2.aggregate<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token variable">$project</span>:<span class="token punctuation">{<!-- --></span>author:<span class="token punctuation">{<!-- --></span>name:1<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/fd/bc/Ekov1NmV_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="match_970"></a>$match筛选文档</h4> 
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         m 
        
       
         a 
        
       
         t 
        
       
         c 
        
       
         h 
        
       
         可以使用除了地理空间之外的所有常规查询操作符。实际应用中尽可能将 
        
       
      
        match可以使用除了地理空间之外的所有常规查询操作符。实际应用中尽可能将 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6944em;"></span><span class="mord mathnormal">ma</span><span class="mord mathnormal">t</span><span class="mord mathnormal">c</span><span class="mord mathnormal">h</span><span class="mord cjk_fallback">可以使用除了地理空间之外的所有常规查询操作符。实际应用中尽可能将</span></span></span></span></span>match放在管道的前面位置。这样有两个好处:一是可以快速将不需要的文档过滤掉，以减少管道的工作量;二是如再投射和分组之前执行$match，查询可以使用索引.<br> <code>筛选管道操作和其他管道操作配合时候时，尽量放到开始阶段，这样可以减少后续管道操作符要操作的文档数，提升效率</code></p> 
<pre><code class="prism language-bash"><span class="token comment">#author.name=zmc  只展示name</span>
db.books2.aggregate<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token variable">$match</span>:<span class="token punctuation">{<!-- --></span><span class="token string">"author.name"</span><span class="token builtin class-name">:</span><span class="token string">"zmc3"</span><span class="token punctuation">}</span><span class="token punctuation">}</span>,<span class="token punctuation">{<!-- --></span><span class="token variable">$project</span>:<span class="token punctuation">{<!-- --></span>author:<span class="token punctuation">{<!-- --></span>name:1<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">#author.name=zmc  只展示name</span>
db.books2.aggregate<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token variable">$project</span>:<span class="token punctuation">{<!-- --></span>author:<span class="token punctuation">{<!-- --></span>name:1<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span>,<span class="token punctuation">{<!-- --></span><span class="token variable">$match</span>:<span class="token punctuation">{<!-- --></span><span class="token string">"author.name"</span><span class="token builtin class-name">:</span><span class="token string">"zmc3"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">#type=novel</span>
db.books2.aggregate<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token variable">$match</span>:<span class="token punctuation">{<!-- --></span>type:<span class="token string">"novel"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">#type like '%no%' and favCount&gt;=60</span>
db.books2.aggregate<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token variable">$match</span>:<span class="token punctuation">{<!-- --></span>type:/no/,favCount:<span class="token punctuation">{<!-- --></span><span class="token variable">$gte</span>:60<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>


</code></pre> 
<p><img src="https://images2.imgbox.com/64/a3/Io56YUFp_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/4c/77/pYLLZvVZ_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/da/27/2bR8Icwe_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="count_990"></a>$count</h4> 
<pre><code class="prism language-bash"><span class="token comment"># select count(id) from table where type like '%no%' and favCount&gt;=60</span>
db.books2.aggregate<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token variable">$match</span>:<span class="token punctuation">{<!-- --></span>type:/no/,favCount:<span class="token punctuation">{<!-- --></span><span class="token variable">$gte</span>:60<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span>,<span class="token punctuation">{<!-- --></span><span class="token variable">$count</span><span class="token builtin class-name">:</span><span class="token string">"id"</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/48/aa/PAx2Vheo_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="group_997"></a>$group</h4> 
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         g 
        
       
         r 
        
       
         o 
        
       
         u 
        
       
         p 
        
       
         阶段的内存限制为 
        
       
         100 
        
       
         M 
        
       
         。默认情况下，如果 
        
       
         s 
        
       
         t 
        
       
         a 
        
       
         g 
        
       
         e 
        
       
         迢过此限制， 
        
       
      
        group阶段的内存限制为100M。默认情况下，如果stage迢过此限制， 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8778em; vertical-align: -0.1944em;"></span><span class="mord mathnormal" style="margin-right: 0.0359em;">g</span><span class="mord mathnormal">ro</span><span class="mord mathnormal">u</span><span class="mord mathnormal">p</span><span class="mord cjk_fallback">阶段的内存限制为</span><span class="mord">100</span><span class="mord mathnormal" style="margin-right: 0.109em;">M</span><span class="mord cjk_fallback">。默认情况下，如果</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.0359em;">g</span><span class="mord mathnormal">e</span><span class="mord cjk_fallback">迢过此限制，</span></span></span></span></span>group将产生错误。但是，要允许处理大型数据集，请将allowDiskUse选项设置为true以启用$group操作以写入临时文件。</p> 
<table><thead><tr><th>名称</th><th>描述</th><th>sql</th></tr></thead><tbody><tr><td>$avg</td><td>计算平均值</td><td></td></tr><tr><td>$first</td><td>返回每组第一个文档，如果有排序，按照排序，如果没有按照默认的存储的顺序的第一个文档。</td><td>limit 0,1</td></tr><tr><td>$last</td><td>返回每组最后一个文档，如果有排序，按照排序，如果没有按照默认的存储的顺序的最后个文档。</td><td></td></tr><tr><td>$max</td><td>根据分组，获取集合中所有文档对应值得最大值</td><td></td></tr><tr><td>$push</td><td>将指定的表达式的值添加到一个数组中。</td><td></td></tr><tr><td>$addToset</td><td>将表达式的值添加到一个集合中（无重复值，无序)。</td><td></td></tr><tr><td>$sum</td><td>计算总和</td><td></td></tr><tr><td>$stdDevPop</td><td>返回输入值的总体标准偏差</td><td></td></tr><tr><td>$stdDevSamp</td><td>返回输入值的样本标准偏差</td><td></td></tr></tbody></table> 
<ul><li>book的数量，收藏总数和平均值</li></ul> 
<pre><code class="prism language-bash"><span class="token comment">#select sum(1) 数据总数, sum(favCount) favCount结果累加, avg(favCount) favCount平均 from table</span>
 db.books2.aggregate<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token variable">$group</span>:<span class="token punctuation">{<!-- --></span>_id:null,数据总数:<span class="token punctuation">{<!-- --></span><span class="token variable">$sum</span>:1<span class="token punctuation">}</span>,favCount结果累加:<span class="token punctuation">{<!-- --></span><span class="token variable">$sum</span><span class="token builtin class-name">:</span><span class="token string">"<span class="token variable">$favCount</span>"</span><span class="token punctuation">}</span>,favCount平均:<span class="token punctuation">{<!-- --></span><span class="token variable">$avg</span><span class="token builtin class-name">:</span><span class="token string">"<span class="token variable">$favCount</span>"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/cb/37/mssRXWef_o.png" alt="在这里插入图片描述"></p> 
<ul><li>统计每个作者的book收藏总数</li></ul> 
<pre><code class="prism language-bash"><span class="token comment">#select author.name, sum(favCount) favCount总数 from table group by  author.name</span>
db.books2.aggregate<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token variable">$group</span>:<span class="token punctuation">{<!-- --></span>_id:<span class="token string">"<span class="token variable">$author</span>.name"</span>,favCount总数:<span class="token punctuation">{<!-- --></span><span class="token variable">$sum</span><span class="token builtin class-name">:</span><span class="token string">"<span class="token variable">$favCount</span>"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/bd/7d/7k8omn1U_o.png" alt="在这里插入图片描述"></p> 
<ul><li>计算每种类型受欢迎的平均值，以及每种类型书的总数</li></ul> 
<pre><code class="prism language-bash"><span class="token comment">#select type, avg(favCount) favCountAvg,sum(1) total from table group by type</span>
db.books.aggregate<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token variable">$group</span>:<span class="token punctuation">{<!-- --></span>_id:<span class="token string">"<span class="token variable">$type</span>"</span>,favCountAvg:<span class="token punctuation">{<!-- --></span><span class="token variable">$avg</span><span class="token builtin class-name">:</span><span class="token string">"<span class="token variable">$favCount</span>"</span><span class="token punctuation">}</span>,total:<span class="token punctuation">{<!-- --></span><span class="token variable">$sum</span>:1<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/41/9b/9MLufCna_o.png" alt="在这里插入图片描述"></p> 
<ul><li>计算每个作者对每种类型书的平均喜爱度</li></ul> 
<pre><code class="prism language-bash"><span class="token comment">#select author.name authName,type typeBook , avg(favCount) favCountAvg from table group by author.name,type</span>
db.books2.aggregate<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token variable">$group</span>:<span class="token punctuation">{<!-- --></span>_id:<span class="token punctuation">{<!-- --></span>authName:<span class="token string">"<span class="token variable">$author</span>.name"</span>,typeBook:<span class="token string">"<span class="token variable">$type</span>"</span><span class="token punctuation">}</span>,favCountAvg:<span class="token punctuation">{<!-- --></span><span class="token variable">$avg</span><span class="token builtin class-name">:</span><span class="token string">"<span class="token variable">$favCount</span>"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/7c/9f/XtfXWOKM_o.png" alt="在这里插入图片描述"></p> 
<ul><li>每个作者的书记集合</li></ul> 
<pre><code class="prism language-bash">db.books2.aggregate<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token variable">$group</span>:<span class="token punctuation">{<!-- --></span>_id:<span class="token punctuation">{<!-- --></span>authorName:<span class="token string">"<span class="token variable">$author</span>.name"</span><span class="token punctuation">}</span>,types:<span class="token punctuation">{<!-- --></span><span class="token variable">$addToSet</span><span class="token builtin class-name">:</span><span class="token string">"<span class="token variable">$type</span>"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/c4/ec/gAAEfJ8R_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="TODO_1054"></a>TODO</h2>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b6bfe2264c650dfec4d2b964c1430678/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">微信小程序-----wxss模版样式</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/727cfe1791a22de960f4bb780cd1e2a6/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">应用层网络协议</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>