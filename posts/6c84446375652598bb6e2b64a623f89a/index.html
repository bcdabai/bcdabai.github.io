<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>SomeIP 协议 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="SomeIP 协议" />
<meta property="og:description" content="目录
目录
SomeIP协议
1.什么是SomeIP
1.1 someip是一种协议
1.2 someip是一个中间件
1.3 协议层
2.Some/IP的功能
2.1 序列化
2.2 远程调用
2.3 服务发现
2.4 订阅/发布
3.服务接口
Method -方法
3.1 Method
3.2 Event
3.3 filed -属性/状态
4.SomeIP报文格式
5.序列化
5.1 序列化和/反序列化
6.Some/IP SD(Service Discovery)
6.1概述
一种特殊的服务，实现服务寻找事件订阅功能
6.2 SomeIP SD报文格式
6.3 SD 启动时序 -服务器和事件的处理阶段
SomeIP协议 1.什么是SomeIP 1.1 someip是一种协议 someip是什么协议？
宝马公司制定的，是车载以太网和SOA的驱动主要提供车内娱乐信息交互的中间信息传递(例如智能座舱)可以适配各种操作系统QNX Linux等 1.2 someip是一个中间件 是操作系统/硬件/和APP之间的服务软件与APP之间使用标准的接口 1.3 协议层 基于TCP/IP的传输，以太网的方式
​
​
2.Some/IP的功能 2.1 序列化 将数据结果或者对象按照定义的规则转换成二进制的过程，便于在网络上传输 2.2 远程调用 基于网络传输方式实现节点间的方法调用 2.3 服务发现 特殊的服务：该服务，client 可以查找所需要的服务。server端可以告诉client 自己那些服务可以被使用client 端可以和server端动态建立连接 2." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/6c84446375652598bb6e2b64a623f89a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-04-12T13:19:23+08:00" />
<meta property="article:modified_time" content="2023-04-12T13:19:23+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">SomeIP 协议</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p></p> 
<p>目录</p> 
<ul><li> <p id="main-toc"><strong>目录</strong></p> <p id="h490b8bf-Y4i0FkF7-toc" style="margin-left:40px;"><a href="#h490b8bf-Y4i0FkF7" rel="nofollow">SomeIP协议</a></p> <p id="h490b8bf-f9XaIIgb-toc" style="margin-left:40px;"><a href="#h490b8bf-f9XaIIgb" rel="nofollow">1.什么是SomeIP</a></p> <p id="h6f20189-bCRAQBKi-toc" style="margin-left:80px;"><a href="#h6f20189-bCRAQBKi" rel="nofollow">1.1 someip是一种协议</a></p> <p id="h6f20189-0OcjTTeM-toc" style="margin-left:80px;"><a href="#h6f20189-0OcjTTeM" rel="nofollow">1.2 someip是一个中间件</a></p> <p id="h6f20189-G17Ol3BJ-toc" style="margin-left:80px;"><a href="#h6f20189-G17Ol3BJ" rel="nofollow">1.3 协议层</a></p> <p id="h490b8bf-hL4HCk2Q-toc" style="margin-left:40px;"><a href="#h490b8bf-hL4HCk2Q" rel="nofollow">2.Some/IP的功能</a></p> <p id="h6f20189-F7S80Wkl-toc" style="margin-left:80px;"><a href="#h6f20189-F7S80Wkl" rel="nofollow">2.1 序列化</a></p> <p id="h6f20189-Z9o9Oo5R-toc" style="margin-left:80px;"><a href="#h6f20189-Z9o9Oo5R" rel="nofollow">2.2 远程调用</a></p> <p id="h6f20189-kjroOqbP-toc" style="margin-left:80px;"><a href="#h6f20189-kjroOqbP" rel="nofollow">2.3 服务发现</a></p> <p id="h6f20189-ckn67qDn-toc" style="margin-left:80px;"><a href="#h6f20189-ckn67qDn" rel="nofollow">2.4 订阅/发布</a></p> <p id="h490b8bf-E68Ja24F-toc" style="margin-left:40px;"><a href="#h490b8bf-E68Ja24F" rel="nofollow">3.服务接口</a></p> <p id="h6f20189-aVs0a79g-toc" style="margin-left:80px;"><a href="#h6f20189-aVs0a79g" rel="nofollow">Method -方法</a></p> <p id="h6f20189-YI33imbt-toc" style="margin-left:80px;"><a href="#h6f20189-YI33imbt" rel="nofollow">3.1 Method</a></p> <p id="h6f20189-C2KXcfX4-toc" style="margin-left:80px;"><a href="#h6f20189-C2KXcfX4" rel="nofollow">3.2 Event</a></p> <p id="h6f20189-7hChPZdF-toc" style="margin-left:80px;"><a href="#h6f20189-7hChPZdF" rel="nofollow">3.3 filed -属性/状态</a></p> <p id="h490b8bf-FfihgFbO-toc" style="margin-left:40px;"><a href="#h490b8bf-FfihgFbO" rel="nofollow">4.SomeIP报文格式</a></p> <p id="h490b8bf-DPXGWSeA-toc" style="margin-left:40px;"><a href="#h490b8bf-DPXGWSeA" rel="nofollow">5.序列化</a></p> <p id="h6f20189-J6rCpGg2-toc" style="margin-left:80px;"><a href="#h6f20189-J6rCpGg2" rel="nofollow">5.1 序列化和/反序列化</a></p> <p id="h490b8bf-fWIEo6mS-toc" style="margin-left:40px;"><a href="#h490b8bf-fWIEo6mS" rel="nofollow">6.Some/IP SD(Service Discovery)</a></p> <p id="h6f20189-hacrlWrT-toc" style="margin-left:80px;"><a href="#h6f20189-hacrlWrT" rel="nofollow">6.1概述</a></p> <p id="h6f20189-zuQ3Jka8-toc" style="margin-left:80px;"><a href="#h6f20189-zuQ3Jka8" rel="nofollow">一种特殊的服务，实现服务寻找事件订阅功能</a></p> <p id="h6f20189-v48iWLo9-toc" style="margin-left:80px;"><a href="#h6f20189-v48iWLo9" rel="nofollow">6.2 SomeIP SD报文格式</a></p> <p id="h6f20189-1oF3KmYo-toc" style="margin-left:80px;"><a href="#h6f20189-1oF3KmYo" rel="nofollow">6.3 SD 启动时序 -服务器和事件的处理阶段</a></p> 
  <hr id="hr-toc"><p></p> </li></ul> 
<h3 id="h490b8bf-Y4i0FkF7">SomeIP协议</h3> 
<h3 id="h490b8bf-f9XaIIgb">1.什么是SomeIP</h3> 
<h4 id="h6f20189-bCRAQBKi">1.1 someip是一种协议</h4> 
<p>someip是什么协议？</p> 
<ul><li>宝马公司制定的，是车载以太网和SOA的驱动</li><li>主要提供车内娱乐信息交互的中间信息传递(例如智能座舱)</li><li>可以适配各种操作系统QNX Linux等</li></ul> 
<h4 id="h6f20189-0OcjTTeM">1.2 someip是一个中间件</h4> 
<ul><li>是操作系统/硬件/和APP之间的服务软件</li><li>与APP之间使用标准的接口</li></ul> 
<h4 id="h6f20189-G17Ol3BJ">1.3 协议层</h4> 
<p>基于TCP/IP的传输，以太网的方式</p> 
<p>​</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/7f/98/EU0KD64U_o.png"></p> 
<p>​</p> 
<h3 id="h490b8bf-hL4HCk2Q">2.Some/IP的功能</h3> 
<h4 id="h6f20189-F7S80Wkl">2.1 序列化</h4> 
<ul><li>将数据结果或者对象按照定义的规则转换成二进制的过程，便于在网络上传输</li></ul> 
<h4 id="h6f20189-Z9o9Oo5R">2.2 远程调用</h4> 
<ul><li>基于网络传输方式实现节点间的方法调用</li></ul> 
<h4 id="h6f20189-kjroOqbP">2.3 服务发现</h4> 
<ul><li>特殊的服务：该服务，client 可以查找所需要的服务。server端可以告诉client 自己那些服务可以被使用</li><li>client 端可以和server端动态建立连接</li></ul> 
<h4 id="h6f20189-ckn67qDn">2.4 订阅/发布</h4> 
<ul><li>client 端可以想server 订阅相关topic 的数据。server也可以以cycle/event 的方式发布这些数据</li></ul> 
<h3 id="h490b8bf-E68Ja24F">3.服务接口</h3> 
<h4 id="h6f20189-aVs0a79g">Method -方法</h4> 
<ul><li>Property/field - 字段属性</li><li>Event-事件</li></ul> 
<p>​</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/a4/68/FIwGrkFY_o.png"></p> 
<p>​</p> 
<h4 id="h6f20189-YI33imbt">3.1 Method</h4> 
<ul><li>client 向sever 请求报文</li></ul> 
<ul><li>server 响应报文【RR】==&gt;Request/Response</li><li>server 不需要回复响应报文【FF-Method】==&gt; Fire/Forget(当请求为F&amp;F通信的时候，请求的报文类型我REQUEST_NO_RETURN)</li></ul> 
<p>​</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/48/4c/gXv9Yh2h_o.png"></p> 
<p>​</p> 
<h4 id="h6f20189-C2KXcfX4">3.2 Event</h4> 
<ul><li>client 订阅一个服务，server发布服务</li></ul> 
<ul><li>status: on change/cycle</li><li>status value: on change/cycle/事件值变化超过设置范围</li></ul> 
<p>​</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/4f/04/jA05Gtjd_o.png"></p> 
<p>​</p> 
<h4 id="h6f20189-7hChPZdF">3.3 filed -属性/状态</h4> 
<ul><li>set/get</li></ul> 
<ul><li>cilent request 获取/设置 某个属性或状态</li></ul> 
<p>​</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/72/37/tujoI6dG_o.png"></p> 
<p>​</p> 
<ul><li>notify</li></ul> 
<ul><li>cilent subscribe 某个属性/状态后，server就发布该服务</li><li>发布条件同Event,有一点不同得是订阅后server会立即发送此field的内容</li></ul> 
<p>​</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/36/06/DFCpAa29_o.png"></p> 
<p>​</p> 
<h3 id="h490b8bf-FfihgFbO">4.SomeIP报文格式</h3> 
<p>SomeIP报文一般是由Header 和Payload组成</p> 
<p>​</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/07/20/nh0hYrQm_o.png"></p> 
<p>​</p> 
<ul><li>Header 部分</li></ul> 
<ul><li>Message ID: 报文的标识符：4个字节的长度,SomeIP有唯一的ID(类似于CAN ID)，当定义为Method的时候，Method Id的最高位为0，当定义为Event的时候，Method ID的最高位为0，不同的Method 和Event也有唯一的Method ID和Event ID，对于远程调用RPC的时候(例如从一个ECU到另一个ECU之间的消息传递)，指定的sevice 和对应的调用方法.</li></ul> 
<ul><li>例如，某个ecu需要和Tbox之间的数据交互，获取Tbox上的WAN信息，就需要指定service id 为Tbox对应的service id，method ID 为其中定义获取WAN相关信息的ID</li></ul> 
<ul><li>Length: 4个字节，这里的length 是指的Length字段之后的长度</li></ul> 
<p>​</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/9b/a4/aomS0ELh_o.png"></p> 
<p>​</p> 
<ul><li>Request ID:请求ID</li></ul> 
<ul><li>区分每一条请求</li><li>Server 端会将这部分copy到response报文中</li><li>client ID: 2个字节，区分请求同一个sevice的不同客户端</li><li>session ID: 2个字节，同一个客户端请求同一个service的次数</li></ul> 
<p>​</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/39/cf/Jgx1tpV1_o.png"></p> 
<p>​</p> 
<ul><li>protocol Version:Some/ip的协议版本，1个字节</li><li>Interface Version: service Interface 的主版本</li></ul> 
<ul><li>用作检测服务的一致性，是否匹配(比如VSP 服务增加功能接口，对应更新了矩阵版本，之前client指定的版本可能就找不到对应的功能)</li></ul> 
<ul><li>Message Type :报文的类型(区分不同的消息类型)，一个字节</li></ul> 
<p>​</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/e3/78/rtUUizdq_o.png"></p> 
<p>​</p> 
<ul><li>Return Code :请求是否被成功处理,1个字节</li></ul> 
<p>​</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/d9/60/ubABHEc1_o.png"></p> 
<p>​</p> 
<h3 id="h490b8bf-DPXGWSeA">5.序列化</h3> 
<h4 id="h6f20189-J6rCpGg2">5.1 序列化和/反序列化</h4> 
<ul><li>序列化：将对象的状态信息转换为可以存储或以二进制的信息在网络中传输</li></ul> 
<ul><li>序列化根据传输的不同数据有不同的规则</li></ul> 
<ol><li>基本数据类型的序列化</li><li>结构体的序列化</li><li>字符串的序列化(定长/变长)</li><li>数组的序列化(定长/变长)</li></ol> 
<ul><li>基本数据的序列化</li></ul> 
<ul><li>定义传输数据的字节序：例如 uint32 (0x A05C6D4F)</li></ul> 
<p>​</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/e0/d0/vjCQksPN_o.png"></p> 
<p>​​</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/d8/07/vfYBMCvx_o.png"></p> 
<p>​</p> 
<ul><li>字符串类型的序列化</li></ul> 
<ul><li>字符串由一系列的Unicode字符构成，并且以"\0" (0x00)结束</li></ul> 
<ul><li>数组类型的序列化</li></ul> 
<ul><li>数组是相同类型的集合</li><li>根据数组的元素的序列排列，并进行序列化</li></ul> 
<h3 id="h490b8bf-fWIEo6mS">6.Some/IP SD(Service Discovery)</h3> 
<h4 id="h6f20189-hacrlWrT">6.1概述</h4> 
<h4 id="h6f20189-zuQ3Jka8">一种特殊的服务，实现服务寻找事件订阅功能</h4> 
<ul><li>服务寻址</li></ul> 
<ul><li>FindService</li><li>OfferService</li><li>StopOffService</li></ul> 
<ul><li>事件订阅</li></ul> 
<ul><li>subscrbe Eventgroup</li><li>stopSubscribe Eventgroup</li><li>Subscribe EventgroupAck</li><li>Subscribe EventgroupNAck</li></ul> 
<p>​</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/2a/e4/xf8ViUsh_o.png"></p> 
<p>​</p> 
<h4 id="h6f20189-v48iWLo9">6.2 SomeIP SD报文格式</h4> 
<p>​</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/09/57/27O8KMZl_o.png"></p> 
<p>​</p> 
<ul><li>Flags:第一个字节是标志字段，最高三位从高到低依次为重启标志位，单播标志位，初始数据控制标志位，低五位保留</li></ul> 
<ul><li>Reboot Flag</li></ul> 
<ul><li>重启时置1(或者上电的时候)</li><li>当sesson ID 完成从0~0xFFFF的一个循环之后,Reboot置0(sesson ID 或从0逐渐增加直到0xFFFF 后又循环)</li><li>重启检测</li></ul> 
<ul><li>Unicast Flag</li></ul> 
<ul><li>是否支持单播接收(=1)</li></ul> 
<ul><li>Entry 阵列</li></ul> 
<ul><li>服务发现是通过SD报文中的Entry阵列字段携带的不同类型Entry来实现的， Entry用来同步服务实例状态和处理事件组的发布和订阅。依据SD 报文中Entry的作用不同将SD的报文类型分为七种，其中Find报文、Offer报文和Stop Offer报文基于不同的机制周期发送，用于同步服务实例的状态；订阅事件组报文、停止订阅事件组报文、订阅ACK报文和订阅NACK报文用于处理事件组的发布和订阅。</li></ul> 
<ul><li>Option 阵列<br> SD 报文中的Entry通过引用option阵列中携带的其他附件信息，能够更灵活的配置</li></ul> 
<ul><li>entry 的附加信息</li></ul> 
<ul><li>IP 地址</li><li>传输层协议</li><li>端口号</li></ul> 
<ul><li>类型</li></ul> 
<ul><li>EndPoint Option</li><li>Multicast Option</li><li>Configuration Option</li><li>Load Balancing Option</li></ul> 
<h4 id="h6f20189-1oF3KmYo">6.3 SD 启动时序 -服务器和事件的处理阶段</h4> 
<ul><li>关闭阶段(Down)</li><li>可用阶段(Available)</li></ul> 
<ul><li>初始等待阶段(init wait phase)</li><li>重复阶段(Repetition phase)</li><li>主阶段</li></ul> 
<p>​</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/c4/88/4lq4G2U2_o.png"></p> 
<p>​​</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/22/df/2p8sZ9uK_o.png"></p> 
<p>​</p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/62ecf11d6b276b18e1c87d4e426eae6a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">记录一次Windows安装MySQL5.7.24后启动报错“服务无法启动，服务没有报告任何错误”</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a966188f4cb1ecc9934d79c7f74b9f71/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Linux中安装新版minio(centos7版本)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>