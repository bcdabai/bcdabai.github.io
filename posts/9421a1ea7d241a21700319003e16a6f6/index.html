<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Linux搭建MySQL主从复制 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Linux搭建MySQL主从复制" />
<meta property="og:description" content="1.先检查系统是否装有mysql rpm -qa | grep mysql 如有，需要卸载
rpm -e mysqlXXX.rpm
2.下载mysql的repo源 cd /software
wget -c http://repo.mysql.com/mysql57-community-release-el7-9.noarch.rpm 如果提示没有wget 执行 yum -y install wget安装
3.安装mysql rpm包 rpm -ivh mysql57-community-release-el7-9.noarch.rpm
安装了这个，yum就可以在线安装mysql了，这里版本是mysql5.7.36
4.安装MySQL yum install mysql-server
5.重置MySQL密码 5.1首先，修改配置文件 vi /etc/my.cnf
在文件末尾增加一行跳过权限验证
skip-grant-tables
然后重启mysql
service mysqld restart
接着可以用root免密登录
mysql -uroot -p
直接回车不用输入密码
5.2修改密码 切换mysql库
use mysql;
执行修改密码命令
update user set authentication_string=password(&#39;123456&#39;) where user=&#39;root&#39; and Host=&#39;localhost&#39;;
执行允许任意ip
UPDATE mysql.user SET Host=&#39;%&#39; where user=&#39;root&#39; AND Host=&#39;localhost&#39; LIMIT 1;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/9421a1ea7d241a21700319003e16a6f6/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-11-30T17:47:26+08:00" />
<meta property="article:modified_time" content="2021-11-30T17:47:26+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Linux搭建MySQL主从复制</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h3>1.先检查系统是否装有mysql</h3> 
<pre><code>rpm -qa | grep mysql</code></pre> 
<p>如有，需要卸载</p> 
<p>rpm -e mysqlXXX.rpm</p> 
<h3>2.下载mysql的repo源</h3> 
<p>cd /software</p> 
<pre><code>wget -c http://repo.mysql.com/mysql57-community-release-el7-9.noarch.rpm</code></pre> 
<p>如果提示没有wget 执行 yum -y install wget安装</p> 
<h3>3.安装mysql rpm包</h3> 
<p>rpm -ivh mysql57-community-release-el7-9.noarch.rpm</p> 
<p>安装了这个，yum就可以在线安装mysql了，这里版本是mysql5.7.36</p> 
<h3>4.安装MySQL</h3> 
<p>yum install mysql-server</p> 
<p><img alt="" height="258" src="https://images2.imgbox.com/12/35/uFCM1NBU_o.png" width="1200"></p> 
<h3><strong> 5.重置MySQL密码</strong></h3> 
<h4>5.1首先，修改配置文件</h4> 
<p>vi /etc/my.cnf</p> 
<p>在文件末尾增加一行跳过权限验证</p> 
<p>skip-grant-tables</p> 
<p>然后重启mysql</p> 
<p>service mysqld restart</p> 
<p>接着可以用root免密登录</p> 
<p>mysql -uroot -p</p> 
<p>直接回车不用输入密码</p> 
<h4>5.2修改密码</h4> 
<p>切换mysql库</p> 
<p>    use mysql;</p> 
<p>执行修改密码命令</p> 
<p>    update user set authentication_string=password('123456') where user='root' and Host='localhost';</p> 
<p>执行允许任意ip</p> 
<p>    UPDATE mysql.user SET Host='%' where user='root' AND Host='localhost' LIMIT 1;</p> 
<p>刷新权限</p> 
<p>    flush privileges;</p> 
<p>退出mysql</p> 
<p>    quit</p> 
<p>然后把my.cnf跳过权限那一行注释或删除，重启mysql</p> 
<p>这样密码就改好了</p> 
<p><img alt="" height="509" src="https://images2.imgbox.com/75/8c/I2bNfor5_o.png" width="702"></p> 
<p> MySQL主从复制配置</p> 
<p>按以上步骤配置2台服务器（虚拟机也可以复制，注意server_id不要相同），都配置好mysql密码，并可以使用后，我们开始配置主从</p> 
<h3><strong>6.主服务器节点：ss1</strong></h3> 
<h4><strong>6.1修改my.cnf,增加以下内容</strong></h4> 
<pre><code>#skip-grant-tables
###服务器id标识
server_id=1
###开启日志文件
log-bin=mysql-bin
</code></pre> 
<p><img alt="" height="463" src="https://images2.imgbox.com/e3/15/va54i8Ny_o.png" width="739"></p> 
<p> 重启 service mysqld restart</p> 
<h4>6.2进入mysql验证，看到id正常就ok了</h4> 
<pre><code>[root@ss1 software]# mysql -uroot -p
Enter password: 
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 2
Server version: 5.7.36-log MySQL Community Server (GPL)

Copyright (c) 2000, 2021, Oracle and/or its affiliates.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql&gt; show variables like '%server_id%';
+----------------+-------+
| Variable_name  | Value |
+----------------+-------+
| server_id      | 1     |
| server_id_bits | 32    |
+----------------+-------+
2 rows in set (0.00 sec)

mysql&gt; show master status;
+------------------+----------+--------------+------------------+-------------------+
| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |
+------------------+----------+--------------+------------------+-------------------+
| mysql-bin.000001 |      154 |              |                  |                   |
+------------------+----------+--------------+------------------+-------------------+
1 row in set (0.00 sec)
</code></pre> 
<h3>7.从服务器节点</h3> 
<h4>7.1同样需要修改配置文件my.cnf</h4> 
<p>vi /etc/my.cnf ,增加以下内容，这里注意我们需要配置需要同步的数据库名称</p> 
<pre><code>###从服务器server_id
server_id=2
###日志文件同步方式
log-bin=mysql-bin
###需要同步数据库，如果有多个逗号分隔
binlog_do_db=test,hivetest
</code></pre> 
<p>改完配置后，记得重启mysql</p> 
<h4>7.2重启后再次进入mysql命令行</h4> 
<p>show variables like '%server_id%';//验证配置</p> 
<pre><code>mysql&gt; show variables like '%server_id%';
+----------------+-------+
| Variable_name  | Value |
+----------------+-------+
| server_id      | 2     |
| server_id_bits | 32    |
+----------------+-------+
2 rows in set (0.01 sec)
</code></pre> 
<p>如果验证配置没问题，接下来我们就要设置master同步了，注意master的地址，密码以及log文件名和起始位置信息，在上面已经查询过了，我们执行下面的命令</p> 
<pre><code>change master to master_host='ss1',master_user='root',master_password='123456', master_log_file='mysql-bin.000001',master_log_pos=154;</code></pre> 
<p> 然后执行start slave开始同步，同步后可以查看下数据库列表</p> 
<p><img alt="" height="242" src="https://images2.imgbox.com/90/41/OOHeRqdU_o.png" width="593"></p> 
<p> 可以看到数据库test已经从master同步过来了，这里的test是我在同步前建好的，里面没有表</p> 
<h3>8.演示数据同步</h3> 
<p>我们在ss1主库新建一张表students</p> 
<pre><code>CREATE TABLE `students` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(15) NOT NULL,
  `age` tinyint(3) unsigned DEFAULT '0',
  `high` decimal(5,2) DEFAULT '0.00',
  `gender` enum('男','女','中性','保密') DEFAULT '保密',
  `cls_id` int(10) unsigned NOT NULL,
  `is_delete` bit(1) DEFAULT b'0',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=10 DEFAULT CHARSET=utf8;</code></pre> 
<p>然后切换到从库的shell界面</p> 
<p><img alt="" height="207" src="https://images2.imgbox.com/76/4a/cVeReRH2_o.png" width="453"></p> 
<p>可以查到表已经有了，里面没有数据</p> 
<p>接下来我们回到主库shell界面，插入一条数据到students表</p> 
<pre><code>INSERT INTO students (name, age, high, gender, cls_id, is_delete) VALUES('1130', 30, 180.00, '保密', 0, b'0');
</code></pre> 
<p><img alt="" height="65" src="https://images2.imgbox.com/38/dc/eSQI7K6R_o.png" width="433"></p> 
<p>然后再回到从库界面，执行查询，可以看到刚才主库的数据了</p> 
<p><img alt="" height="97" src="https://images2.imgbox.com/0c/f3/uvYofqxw_o.png" width="670"></p> 
<p> 我们再执行SHOW SLAVE STATUS，可以查看从库的同步信息</p> 
<pre><code>+----------------------------------+-------------+-------------+-------------+---------------+------------------+---------------------+----------------------+---------------+-----------------------+------------------+-------------------+-----------------+---------------------+--------------------+------------------------+-------------------------+-----------------------------+------------+------------+--------------+---------------------+-----------------+-----------------+----------------+---------------+--------------------+--------------------+--------------------+-----------------+-------------------+----------------+-----------------------+-------------------------------+---------------+---------------+----------------+----------------+-----------------------------+------------------+--------------------------------------+----------------------------+-----------+---------------------+--------------------------------------------------------+--------------------+-------------+-------------------------+--------------------------+----------------+--------------------+--------------------+-------------------+---------------+----------------------+--------------+--------------------+
| Slave_IO_State                   | Master_Host | Master_User | Master_Port | Connect_Retry | Master_Log_File  | Read_Master_Log_Pos | Relay_Log_File       | Relay_Log_Pos | Relay_Master_Log_File | Slave_IO_Running | Slave_SQL_Running | Replicate_Do_DB | Replicate_Ignore_DB | Replicate_Do_Table | Replicate_Ignore_Table | Replicate_Wild_Do_Table | Replicate_Wild_Ignore_Table | Last_Errno | Last_Error | Skip_Counter | Exec_Master_Log_Pos | Relay_Log_Space | Until_Condition | Until_Log_File | Until_Log_Pos | Master_SSL_Allowed | Master_SSL_CA_File | Master_SSL_CA_Path | Master_SSL_Cert | Master_SSL_Cipher | Master_SSL_Key | Seconds_Behind_Master | Master_SSL_Verify_Server_Cert | Last_IO_Errno | Last_IO_Error | Last_SQL_Errno | Last_SQL_Error | Replicate_Ignore_Server_Ids | Master_Server_Id | Master_UUID                          | Master_Info_File           | SQL_Delay | SQL_Remaining_Delay | Slave_SQL_Running_State                                | Master_Retry_Count | Master_Bind | Last_IO_Error_Timestamp | Last_SQL_Error_Timestamp | Master_SSL_Crl | Master_SSL_Crlpath | Retrieved_Gtid_Set | Executed_Gtid_Set | Auto_Position | Replicate_Rewrite_DB | Channel_Name | Master_TLS_Version |
+----------------------------------+-------------+-------------+-------------+---------------+------------------+---------------------+----------------------+---------------+-----------------------+------------------+-------------------+-----------------+---------------------+--------------------+------------------------+-------------------------+-----------------------------+------------+------------+--------------+---------------------+-----------------+-----------------+----------------+---------------+--------------------+--------------------+--------------------+-----------------+-------------------+----------------+-----------------------+-------------------------------+---------------+---------------+----------------+----------------+-----------------------------+------------------+--------------------------------------+----------------------------+-----------+---------------------+--------------------------------------------------------+--------------------+-------------+-------------------------+--------------------------+----------------+--------------------+--------------------+-------------------+---------------+----------------------+--------------+--------------------+
| Waiting for master to send event | ss1         | root        |        3306 |            60 | mysql-bin.000001 |                1138 | ss2-relay-bin.000002 |          1304 | mysql-bin.000001      | Yes              | Yes               |                 |                     |                    |                        |                         |                             |          0 |            |            0 |                1138 |            1509 | None            |                |             0 | No                 |                    |                    |                 |                   |                |                     0 | No                            |             0 |               |              0 |                |                             |                1 | f352dda6-51a9-11ec-abd6-525496503cbd | /var/lib/mysql/master.info |         0 |                NULL | Slave has read all relay log; waiting for more updates |              86400 |             |                         |                          |                |                    |                    |                   |             0 |                      |              |                    |
+----------------------------------+-------------+-------------+-------------+---------------+------------------+---------------------+----------------------+---------------+-----------------------+------------------+-------------------+-----------------+---------------------+--------------------+------------------------+-------------------------+-----------------------------+------------+------------+--------------+---------------------+-----------------+-----------------+----------------+---------------+--------------------+--------------------+--------------------+-----------------+-------------------+----------------+-----------------------+-------------------------------+---------------+---------------+----------------+----------------+-----------------------------+------------------+--------------------------------------+----------------------------+-----------+---------------------+--------------------------------------------------------+--------------------+-------------+-------------------------+--------------------------+----------------+--------------------+--------------------+-------------------+---------------+----------------------+--------------+--------------------+
1 row in set (0.00 sec)
</code></pre> 
<p><span style="color:#9c8ec1;">总结<br>         感谢能看到这里的朋友😉</span></p> 
<p><span style="color:#9c8ec1;">        本次的分享就到这里，猫头鹰数据致力于为大家分享技术干货😎</span></p> 
<p><span style="color:#9c8ec1;">        如果以上过程中出现了任何的纰漏错误，烦请大佬们指正😅</span></p> 
<p><span style="color:#9c8ec1;">        受益的朋友或对技术感兴趣的伙伴记得点赞关注支持一波🙏</span></p> 
<p><span style="color:#9c8ec1;">        也可以扫描二维码或搜索关注我的微信公众号【猫头鹰数据分析】，留言交流🙏</span></p> 
<p> </p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/34/54/rvY94hFa_o.jpg"></p> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/194c7bae87003250366ff4b894df3250/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">页面跳转后 localStorage存储的值没有了？</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/952664bdf55fd5e0137fcd97e87cdd92/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">数据结构：弗洛伊德算法（最短路径）图文详解</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>