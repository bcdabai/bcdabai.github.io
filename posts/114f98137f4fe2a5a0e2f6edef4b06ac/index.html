<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Redis 主从配置（带密码） - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Redis 主从配置（带密码）" />
<meta property="og:description" content="查看master主从信息：info replication 发现connected_slave数量为0
127.0.0.1:6379&gt; info replication # Replication role:master connected_slaves:0 2、修改你的从节点reidis.config文件，添加主节点密码:
masterauth your_password 3、在从节点上执行下面命令 REPLICAOF master_ip master_port 4、重新查看master主从信息：info replication 发现connected_slave数量变为1
127.0.0.1:6379&gt; info replication # Replication role:master connected_slaves:1 master 与 slave 没有部署在同一机器时
redis.config配置文件需要关闭网络保护&amp;注释掉访问的bind配置
protected-mode no #bind 127.0.0.1 -::1 添加sentinel 编辑sentinel.conf 文件添加如下信息
sentinel monitor mymaster yourIP yourPort 2 sentinel down-after-milliseconds mymaster 30000 sentinel parallel-syncs mymaster 1 sentinel failover-timeout mymaster 180000 sentinel monitor mymaster yourIP yourPort 2
监控的master的名字叫做mymaster,地址为yourIP yourPort，行尾最后的一个2代表什么意思呢？我们知道，网络是不可靠的，有时候一个sentinel会因为网络堵塞而误以为一个master redis已经死掉了，当sentinel集群式，解决这个问题的方法就变得很简单，只需要多个sentinel互相沟通来确认某个master是否真的死了，这个2代表，当集群中有2个sentinel认为master死了时，才能真正认为该master已经不可用了。
down-after-milliseconds
sentinel会向master发送心跳PING来确认master是否存活，如果master在“一定时间范围”内不回应PONG 或者是回复了一个错误消息，那么这个sentinel会主观地(单方面地)认为这个master已经不可用了(subjectively down, 也简称为SDOWN)。而这个down-after-milliseconds就是用来指定这个“一定时间范围”的，单位是毫秒。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/114f98137f4fe2a5a0e2f6edef4b06ac/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-12-21T11:47:31+08:00" />
<meta property="article:modified_time" content="2022-12-21T11:47:31+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Redis 主从配置（带密码）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>查看master主从信息：info replication     </p> 
<p>发现connected_slave数量为0</p> 
<pre><code class="language-html">127.0.0.1:6379&gt; info replication

# Replication

role:master

connected_slaves:0



</code></pre> 
<p>2、修改你的从节点reidis.config文件，添加主节点密码:</p> 
<pre><code>masterauth your_password</code></pre> 
<p>3、在从节点上执行下面命令 </p> 
<pre><code>REPLICAOF master_ip master_port</code></pre> 
<p>4、重新查看master主从信息：info replication 发现connected_slave数量变为1</p> 
<pre><code class="language-html">127.0.0.1:6379&gt; info replication

# Replication

role:master

connected_slaves:1




</code></pre> 
<p><span style="color:#fe2c24;"><strong>master 与 slave 没有部署在同一机器时</strong></span></p> 
<p><span style="color:#fe2c24;"><strong>redis.config配置文件需要关闭网络保护&amp;注释掉访问的bind配置</strong></span></p> 
<pre><code class="language-html">protected-mode no</code></pre> 
<pre><code class="language-java">#bind 127.0.0.1 -::1  </code></pre> 
<h2>添加sentinel</h2> 
<p></p> 
<p>编辑sentinel.conf 文件添加如下信息</p> 
<pre><code>sentinel monitor mymaster yourIP yourPort 2
sentinel down-after-milliseconds mymaster 30000
sentinel parallel-syncs mymaster 1
sentinel failover-timeout mymaster 180000</code></pre> 
<p><strong>sentinel monitor mymaster yourIP yourPort 2</strong></p> 
<p>监控的master的名字叫做mymaster,地址为yourIP yourPort，行尾最后的一个2代表什么意思呢？我们知道，网络是不可靠的，有时候一个sentinel会因为网络堵塞而误以为一个master redis已经死掉了，当sentinel集群式，解决这个问题的方法就变得很简单，只需要多个sentinel互相沟通来确认某个master是否真的死了，这个2代表，当集群中有2个sentinel认为master死了时，才能真正认为该master已经不可用了。</p> 
<p><strong>down-after-milliseconds</strong></p> 
<p>sentinel会向master发送心跳PING来确认master是否存活，如果master在“一定时间范围”内不回应PONG 或者是回复了一个错误消息，那么这个sentinel会主观地(单方面地)认为这个master已经不可用了(subjectively down, 也简称为SDOWN)。而这个down-after-milliseconds就是用来指定这个“一定时间范围”的，单位是毫秒。<br> 不过需要注意的是，这个时候sentinel并不会马上进行failover主备切换，这个sentinel还需要参考sentinel集群中其他sentinel的意见，如果超过某个数量的sentinel也主观地认为该master死了，那么这个master就会被客观地认为已经死了。</p> 
<p><strong>parallel-syncs</strong></p> 
<p>在发生failover主备切换时，这个选项指定了最多可以有多少个slave同时对新的master进行同步，这个数字越小，完成failover所需的时间就越长，但是如果这个数字越大，就意味着越多的slave因为replication而不可用。可以通过将这个值设为 1 来保证每次只有一个slave处于不能处理命令请求的状态。</p> 
<p><strong>failover-timeout</strong></p> 
<p>      1. 同一个sentinel对同一个master两次failover之间的间隔时间。</p> 
<p>      2. 当一个slave从一个错误的master那里同步数据开始计算时间。直到slave被纠正为向正确的master那里同步数据时。</p> 
<p>      3.当想要取消一个正在进行的failover所需要的时间。  </p> 
<p>      4.当进行failover时，配置所有slaves指向新的master所需的最大时间。不过，即使过了这个超时，slaves依然会被正确配置为指向master，但是就不按parallel-syncs所配置的规则来了。<br>  </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a54ef655f6fad331e98a77289d10b2c1/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">企业微信应用开发实践</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d842d1fe0b5829e724bd171c08434603/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">2023最新STM32毕业设计项目集合</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>