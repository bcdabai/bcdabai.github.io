<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>CI/CD——构建企业级Docker&#43;Jenkins&#43;Git&#43;Harbor流水线自动化持续集成持续发布平台 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="CI/CD——构建企业级Docker&#43;Jenkins&#43;Git&#43;Harbor流水线自动化持续集成持续发布平台" />
<meta property="og:description" content="构建企业级Docker&#43;Jenkins&#43;Git&#43;Harbor流水线自动化持续集成持续发布平台 CI/CD是什么？持续集成(CI)/持续交付(CD)的优势自动化部署流程图Git Github Gitlab的区别 前言：一些自己想说的话部署Docker&#43;Jenkins&#43;Git&#43;Harbor流水线自动化CI/CD安装部署Git安装Harbor安装Jenkins 关于实验的一些总结 CI/CD是什么？ CI/CD 是一种通过在应用开发阶段引入自动化来频繁向客户交付应用的方法CI/CD 的核心概念是持续集成、持续交付和持续部署作为一个面向开发和运营团队的解决方案，CI/CD 主要针对在集成新代码时所引发的问题（亦称：“集成地狱”） 持续集成(CI)/持续交付(CD)的优势 持续集成/持续交付是现代软件开发周期的基础在传统的软件开发方法中，每个功能更新或修复错误都会每隔一段时间进行发布，这显著增加了在部署时耦合更改的机会持续集成/持续交付可以解决所有这些问题，并使整个过程更易于管理和高效。在现代软件开发实践中，持续集成(CI)/持续交付(CD)是构建、测试应用程序并将其部署到生产中的基础。持续交付(CD)有助于降低风险，并通过自动化来自不同项目开发人员的多个代码更改来实现生产一致性。另一方面，持续交付使开发人员能够无缝地将集成代码交付到生产中，从而提供快速有效的自动化流程，以向客户轻松发布新功能和更新持续集成/持续交付管道的优势： 管理较小的代码更改故障隔离可在短期内防止错误缩短平均解决时间（MTTR）提高测试可靠性加快释放速度减少积压推动客户实现加强团队的透明沟通和责任感降低成本易于维护和更新 结论 部署CI / CD流程后，您可能会在开发人员工作流程中实现更平滑的过渡关键是，测试质量首先需要在工作流程中引起很多注意，这使您成为其他人可以效仿的灯塔无论您的产品交付有多快和连续，没有质量意识都没有关系当CI / CD管道的更多步骤可以自动化时，质量也意味着更快的质量发布 自动化部署流程图 首先，开发人员每天进行代码提交，提交到Git仓库然后，Jenkins作为持续集成工具，使用Git工具到Git仓库拉取代码到集成服务器，再配合JDK， Maven等软件完成代码编译，代码测试与审查，测试，打包等工作，在这个过程中每一步出错，都重新再执行一次整个流程最后，Jenkins把生成的jar或war包分发到测试服务器或者生产服务器，测试人员或用户就可以访问 应用 Git Github Gitlab的区别 Git是一个开源的分布式版本控制系统，用于敏捷高效地处理任何或小或大的项目。是Linus Torvalds为了帮助管理Linux内核开发而开发的一个开放源码的版本控制软件。Github是在线的基于Git的代码托管服务。GitHub是2008年由Ruby on Rails编写而成。GitHub同时提供付费账户和免费账户。这两种账户都可以创建公开的代码仓库，只有付费账户可以创建私有的代码仓库。Gitlab解决这个问题,可以在上面创建免费的私人repo。 前言：一些自己想说的话 关于实验的开头，本意想使用Docker部署Jenkins，但是在调试Maven和JDK的时候一直报错从7月8号到7月9号的凌晨4点，一直报错，各种解决方案已经被我翻烂了…各种问题接踵而至…于是带着懵逼询问了专业人士，朋友让我使用传统的方式，好家伙，话不多说上操作
用Docker部署的流程就放这把，可以直接跳过，只是作为一个笔记！
#下载Jenkins镜像 [root@jenkins ~]# docker pull jenkins/jenkins:lts-jdk11 #创建Jenkins挂载路径 [root@jenkins ~]# mkdir -p /docker/jenkins #对此目录开放权限,否则容器启动时会报错 [root@jenkins ~]# chmod 777 /docker/jenkins/ #启动容器 [root@jenkins ~]# docker run -itd -p 8080:8080 -p 50000:50000 --restart always -v /docker/jenkins:/var/jenkins_home --name jenkins jenkins/jenkins:lts-jdk11 #通过文件形式查看解锁密码 [root@jenkins ~]# cat /docker/jenkins/secrets/initialAdminPassword 8bf67325c495443a869b249d1f4bb853 #通过日志形式查看解锁密码 [root@jenkins ~]# docker logs -f jenkins 8bf67325c495443a869b249d1f4bb853 部署Docker&#43;Jenkins&#43;Git&#43;Harbor流水线自动化CI/CD CentOS Linux release 7." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/ad8e81d1c1c18c2102c1122fdcfec0d8/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-07-10T00:24:18+08:00" />
<meta property="article:modified_time" content="2021-07-10T00:24:18+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">CI/CD——构建企业级Docker&#43;Jenkins&#43;Git&#43;Harbor流水线自动化持续集成持续发布平台</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>构建企业级Docker+Jenkins+Git+Harbor流水线自动化持续集成持续发布平台</h4> 
 <ul><li><a href="#CICD_1" rel="nofollow">CI/CD是什么？</a></li><li><a href="#CICD_6" rel="nofollow">持续集成(CI)/持续交付(CD)的优势</a></li><li><ul><li><a href="#_29" rel="nofollow">自动化部署流程图</a></li><li><a href="#Git_Github_Gitlab_39" rel="nofollow">Git Github Gitlab的区别</a></li></ul> 
  </li><li><a href="#_44" rel="nofollow">前言：一些自己想说的话</a></li><li><a href="#DockerJenkinsGitHarborCICD_78" rel="nofollow">部署Docker+Jenkins+Git+Harbor流水线自动化CI/CD</a></li><li><ul><li><a href="#Git_91" rel="nofollow">安装部署Git</a></li><li><a href="#Harbor_118" rel="nofollow">安装Harbor</a></li><li><a href="#Jenkins_196" rel="nofollow">安装Jenkins</a></li></ul> 
  </li><li><a href="#_468" rel="nofollow">关于实验的一些总结</a></li></ul> 
</div> 
<p></p> 
<h2><a id="CICD_1"></a>CI/CD是什么？</h2> 
<ul><li>CI/CD 是一种通过在应用开发阶段引入自动化来频繁向客户交付应用的方法</li><li>CI/CD 的核心概念是<mark>持续集成</mark>、<mark>持续交付</mark>和<mark>持续部署</mark></li><li>作为一个面向开发和运营团队的解决方案，CI/CD 主要针对在集成新代码时所引发的问题（亦称：“<font color="red">集成地狱</font>”）</li></ul> 
<h2><a id="CICD_6"></a>持续集成(CI)/持续交付(CD)的优势</h2> 
<ul><li><code>持续集成</code>/<code>持续交付</code>是现代软件<mark>开发周期的基础</mark></li><li>在传统的软件开发方法中，每个功能更新或修复错误都会每隔一段时间进行发布，这显著增加了在部署时耦合更改的机会</li><li><code>持续集成</code>/<code>持续交付</code>可以解决所有这些问题，并使整个过程更<mark>易于管理</mark>和<mark>高效</mark>。</li><li>在现代软件开发实践中，持续集成(CI)/持续交付(CD)是<mark>构建</mark>、<mark>测试应用程序并将其部署到生产中的基础</mark>。</li><li>持续交付(CD)有助于<mark>降低风险</mark>，并通过<code>自动化</code>来自不同项目开发人员的多个代码更改来实现生产<mark>一致性</mark>。</li><li>另一方面，<code>持续交付</code>使开发人员能够无缝地将集成代码交付到生产中，从而提供快速有效的自动化流程，以向客户轻松发布新功能和更新</li><li><code>持续集成</code>/<code>持续交付</code>管道的<mark>优势</mark>： 
  <ul><li>管理较小的代码更改</li><li>故障隔离可在短期内防止错误</li><li>缩短平均解决时间（MTTR）</li><li>提高测试可靠性</li><li>加快释放速度</li><li>减少积压</li><li>推动客户实现</li><li>加强团队的透明沟通和责任感</li><li>降低成本</li><li>易于维护和更新</li></ul> </li><li><mark>结论</mark> 
  <ul><li>部署CI / CD流程后，您可能会在开发人员工作流程中实现更平滑的过渡</li><li>关键是，测试质量首先需要在工作流程中引起很多注意，这使您成为其他人可以效仿的灯塔</li><li>无论您的产品交付有多快和连续，没有质量意识都没有关系</li><li>当CI / CD管道的更多步骤可以自动化时，质量也意味着更快的质量发布</li></ul> </li></ul> 
<h3><a id="_29"></a>自动化部署流程图</h3> 
<p><img src="https://images2.imgbox.com/40/1f/9vcBpchp_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<ul><li>首先，开发人员每天进行代码提交，提交到Git仓库</li><li>然后，Jenkins作为持续集成工具，使用Git工具到Git仓库拉取代码到集成服务器，再配合JDK， Maven等软件完成代码编译，代码测试与审查，测试，打包等工作，在这个过程中每一步出错，都重新再执行一次整个流程</li><li>最后，Jenkins把生成的jar或war包分发到测试服务器或者生产服务器，测试人员或用户就可以访问 应用</li></ul> 
<h3><a id="Git_Github_Gitlab_39"></a>Git Github Gitlab的区别</h3> 
<ul><li><code>Git</code>是一个开源的分布式版本控制系统，用于<mark>敏捷高效</mark>地处理<mark>任何</mark>或小或大的项目。</li><li>是Linus Torvalds为了帮助管理Linux内核开发而开发的一个开放源码的版本控制软件。</li><li><code>Github</code>是在线的基于Git的代码托管服务。GitHub是2008年由Ruby on Rails编写而成。GitHub同时提供付费账户和免费账户。这两种账户都可以创建公开的代码仓库，只有付费账户可以创建私有的代码仓库。<code>Gitlab</code>解决这个问题,可以在上面创建免费的私人repo。</li></ul> 
<h2><a id="_44"></a>前言：一些自己想说的话</h2> 
<ul><li>关于实验的开头，本意想使用<code>Docker</code>部署<code>Jenkins</code>，但是在调试<code>Maven</code>和<code>JDK</code>的时候一直报错</li><li>从7月8号到7月9号的凌晨4点，一直报错，各种解决方案已经被我翻烂了…各种问题接踵而至…</li><li>于是带着懵逼询问了专业人士，朋友让我使用传统的方式，好家伙，话不多说上操作<br> <img src="https://images2.imgbox.com/91/c9/LZkZn8Il_o.png" alt="在这里插入图片描述"></li><li>用<code>Docker</code>部署的流程就放这把，可以直接跳过，只是作为一个笔记！<br> <img src="https://images2.imgbox.com/b7/5b/ZXv3XBeK_o.png" alt="在这里插入图片描述"></li></ul> 
<pre><code class="prism language-bash"><span class="token comment">#下载Jenkins镜像</span>
<span class="token punctuation">[</span>root@jenkins ~<span class="token punctuation">]</span><span class="token comment"># docker pull jenkins/jenkins:lts-jdk11</span>

<span class="token comment">#创建Jenkins挂载路径</span>
<span class="token punctuation">[</span>root@jenkins ~<span class="token punctuation">]</span><span class="token comment"># mkdir -p /docker/jenkins</span>

<span class="token comment">#对此目录开放权限,否则容器启动时会报错</span>
<span class="token punctuation">[</span>root@jenkins ~<span class="token punctuation">]</span><span class="token comment"># chmod 777 /docker/jenkins/</span>

<span class="token comment">#启动容器</span>
<span class="token punctuation">[</span>root@jenkins ~<span class="token punctuation">]</span><span class="token comment"># docker run -itd -p 8080:8080 -p 50000:50000 --restart always -v /docker/jenkins:/var/jenkins_home --name jenkins jenkins/jenkins:lts-jdk11</span>
</code></pre> 
<hr> 
<p><img src="https://images2.imgbox.com/8f/dc/6O16nLSD_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<pre><code class="prism language-bash"><span class="token comment">#通过文件形式查看解锁密码</span>
<span class="token punctuation">[</span>root@jenkins ~<span class="token punctuation">]</span><span class="token comment"># cat /docker/jenkins/secrets/initialAdminPassword </span>
8bf67325c495443a869b249d1f4bb853

<span class="token comment">#通过日志形式查看解锁密码</span>
<span class="token punctuation">[</span>root@jenkins ~<span class="token punctuation">]</span><span class="token comment"># docker logs -f jenkins</span>
8bf67325c495443a869b249d1f4bb853
</code></pre> 
<h2><a id="DockerJenkinsGitHarborCICD_78"></a>部署Docker+Jenkins+Git+Harbor流水线自动化CI/CD</h2> 
<pre><code class="prism language-bash">CentOS Linux release <span class="token number">7.5</span>.1804 <span class="token punctuation">(</span>Core<span class="token punctuation">)</span>
</code></pre> 
<ul><li>主机规划</li></ul> 
<table><thead><tr><th>主机</th><th>IP地址</th></tr></thead><tbody><tr><td><code>Git-server</code></td><td>192.168.100.20</td></tr><tr><td><code>Harbor</code></td><td>192.168.100.30</td></tr><tr><td><code>Jenkins</code></td><td>192.168.100.40</td></tr></tbody></table> 
<h3><a id="Git_91"></a>安装部署Git</h3> 
<pre><code class="prism language-bash"><span class="token comment">#安装Git</span>
<span class="token punctuation">[</span>root@git-server ~<span class="token punctuation">]</span><span class="token comment"># yum -y install git</span>
<span class="token punctuation">[</span>root@git-server ~<span class="token punctuation">]</span><span class="token comment"># git --version</span>
<span class="token function">git</span> version <span class="token number">1.8</span>.3.1

<span class="token comment">#创建用户并配置密码</span>
<span class="token punctuation">[</span>root@git-server ~<span class="token punctuation">]</span><span class="token comment"># useradd git</span>
<span class="token punctuation">[</span>root@git-server ~<span class="token punctuation">]</span><span class="token comment"># passwd git</span>

<span class="token comment">#进入Git用户</span>
<span class="token punctuation">[</span>root@git-server ~<span class="token punctuation">]</span><span class="token comment"># su - git</span>

<span class="token comment">#创建git仓库目录</span>
<span class="token punctuation">[</span>git@git-server ~<span class="token punctuation">]</span>$ <span class="token function">mkdir</span> /home/git/demo.git
<span class="token punctuation">[</span>git@git-server ~<span class="token punctuation">]</span>$ <span class="token builtin class-name">cd</span> /home/git/demo.git/

<span class="token comment">#初始化git仓库</span>
<span class="token punctuation">[</span>git@git-server demo.git<span class="token punctuation">]</span>$ <span class="token function">git</span> --bare init

<span class="token comment">#查看初始化后的仓库</span>
<span class="token punctuation">[</span>git@git-server demo.git<span class="token punctuation">]</span>$ <span class="token function">ls</span>
branches  config  description  HEAD  hooks  info  objects  refs
</code></pre> 
<h3><a id="Harbor_118"></a>安装Harbor</h3> 
<ul><li>Docker具体安装步骤参考我的另一篇博客：<a href="https://blog.csdn.net/sixeleven611/article/details/118081065">Docker基础+Docker安装</a></li></ul> 
<pre><code class="prism language-bash"><span class="token comment">#下载harbor安装包</span>
<span class="token punctuation">[</span>root@harbor ~<span class="token punctuation">]</span><span class="token comment"># wget https://storage.googleapis.com/harbor-releases/release-1.9.0/harbor-offline-installer-v1.9.1.tgz</span>
<span class="token punctuation">[</span>root@harbor ~<span class="token punctuation">]</span><span class="token comment"># tar xf harbor-offline-installer-v1.9.1.tgz -C /usr/src/</span>

<span class="token comment">#启动Docker并开机自启</span>
<span class="token punctuation">[</span>root@harbor ~<span class="token punctuation">]</span><span class="token comment"># systemctl start docker &amp;&amp; systemctl enable docker</span>
<span class="token comment">#当前已经安装Docker</span>
<span class="token punctuation">[</span>root@harbor ~<span class="token punctuation">]</span><span class="token comment"># docker --version</span>
Docker version <span class="token number">20.10</span>.7, build f0df350

<span class="token comment">#安装Docker-compose</span>
<span class="token comment">#由于官方镜像是国外的太慢,使用国内镜像下载</span>
<span class="token punctuation">[</span>root@git ~<span class="token punctuation">]</span><span class="token comment"># curl -L https://get.daocloud.io/docker/compose/releases/download/1.25.5/docker-compose-`uname -s`-`uname -m` &gt; /usr/local/bin/docker-compose</span>

<span class="token comment">#为compose授权</span>
<span class="token punctuation">[</span>root@harbor ~<span class="token punctuation">]</span><span class="token comment"># chmod +x /usr/local/bin/docker-compose</span>
<span class="token punctuation">[</span>root@harbor ~<span class="token punctuation">]</span><span class="token comment"># docker-compose version</span>
docker-compose version <span class="token number">1.25</span>.5, build 8a1c60f6
docker-py version: <span class="token number">4.1</span>.0
CPython version: <span class="token number">3.7</span>.5
OpenSSL version: OpenSSL <span class="token number">1.1</span>.0l  <span class="token number">10</span> Sep <span class="token number">2019</span>

<span class="token comment">#安装并运行harbor</span>
<span class="token punctuation">[</span>root@harbor ~<span class="token punctuation">]</span><span class="token comment"># cd /usr/src/harbor/</span>

<span class="token comment">#编辑配置文件</span>
<span class="token punctuation">[</span>root@harbor harbor<span class="token punctuation">]</span><span class="token comment"># vim harbor.yml</span>

<span class="token comment">#主机修改为本机IP地址</span>
hostname: <span class="token number">192.168</span>.100.30

<span class="token comment">#检测并创建harbor需要文件</span>
<span class="token punctuation">[</span>root@harbor harbor<span class="token punctuation">]</span><span class="token comment"># ./prepare</span>

<span class="token comment">#安装harbor</span>
<span class="token punctuation">[</span>root@harbor harbor<span class="token punctuation">]</span><span class="token comment"># ./install.sh</span>
Now you should be able to visit the admin portal at http://192.168.100.30

<span class="token comment">#添加http仓库信任,默认不信任镜像仓库</span>
<span class="token punctuation">[</span>root@harbor ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/docker/daemon.json</span>
<span class="token punctuation">{<!-- --></span><span class="token string">"insecure-registries"</span>:<span class="token punctuation">[</span><span class="token string">"192.168.100.30"</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
<span class="token punctuation">[</span>root@harbor ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart docker</span>
</code></pre> 
<hr> 
<p><img src="https://images2.imgbox.com/f5/01/N6iZEqwe_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<ul><li>新建项目<br> <img src="https://images2.imgbox.com/9a/d2/8uPbXx6U_o.png" alt="在这里插入图片描述"></li></ul> 
<hr> 
<ul><li>查看推送镜像要求<br> <img src="https://images2.imgbox.com/ae/80/XSPKKE5F_o.png" alt="在这里插入图片描述"></li></ul> 
<hr> 
<pre><code class="prism language-bash"><span class="token comment">#下载官方Tomcat镜像</span>
<span class="token punctuation">[</span>root@harbor ~<span class="token punctuation">]</span><span class="token comment"># docker pull tomcat</span>

<span class="token comment">#根据网站提示为Tomcat镜像打标签</span>
<span class="token punctuation">[</span>root@harbor ~<span class="token punctuation">]</span><span class="token comment"># docker tag tomcat:latest 192.168.100.30/pakho/tomcat:v1</span>

<span class="token comment">#登陆Harbor镜像仓库</span>
<span class="token punctuation">[</span>root@harbor ~<span class="token punctuation">]</span><span class="token comment"># docker login 192.168.100.30 -uadmin -pHarbor12345</span>

<span class="token comment">#上传镜像</span>
<span class="token punctuation">[</span>root@harbor ~<span class="token punctuation">]</span><span class="token comment"># docker push 192.168.100.30/pakho/tomcat:v1</span>
</code></pre> 
<hr> 
<p><img src="https://images2.imgbox.com/2b/d3/KFzGRDXY_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<ul><li>刷新网页查看 
  <ul><li><font color="#800080">镜像存在，说明上传镜像成功！</font><br> <img src="https://images2.imgbox.com/32/c0/5kiS0N0X_o.png" alt="在这里插入图片描述"></li></ul> </li></ul> 
<hr> 
<h3><a id="Jenkins_196"></a>安装Jenkins</h3> 
<ul><li>测试能否正常拉取代码</li></ul> 
<pre><code class="prism language-bash"><span class="token comment">#安装Git测试是否能够拉取代码</span>
<span class="token punctuation">[</span>root@jenkins ~<span class="token punctuation">]</span><span class="token comment"># yum -y install git</span>

<span class="token comment">#拉取Java项目</span>
<span class="token punctuation">[</span>root@jenkins ~<span class="token punctuation">]</span><span class="token comment"># git clone https://github.com/407777853/java-demo</span>

<span class="token comment">#修改项目默认仓库路径</span>
<span class="token punctuation">[</span>root@jenkins ~<span class="token punctuation">]</span><span class="token comment"># cd java-demo/</span>
<span class="token punctuation">[</span>root@jenkins java-demo<span class="token punctuation">]</span><span class="token comment"># vim .git/config</span>
<span class="token punctuation">[</span>core<span class="token punctuation">]</span>
        repositoryformatversion <span class="token operator">=</span> <span class="token number">0</span>
        filemode <span class="token operator">=</span> <span class="token boolean">true</span>
        bare <span class="token operator">=</span> <span class="token boolean">false</span>
        logallrefupdates <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token punctuation">[</span>remote <span class="token string">"origin"</span><span class="token punctuation">]</span>
        url <span class="token operator">=</span> git@192.168.100.20:/home/git/demo.git      <span class="token comment">#指明本地镜像仓库</span>
        fetch <span class="token operator">=</span> +refs/heads/*:refs/remotes/origin/*
<span class="token punctuation">[</span>branch <span class="token string">"master"</span><span class="token punctuation">]</span>
        remote <span class="token operator">=</span> origin
        merge <span class="token operator">=</span> refs/heads/master

<span class="token comment">#添加本地版本仓库</span>
<span class="token punctuation">[</span>root@jenkins java-demo<span class="token punctuation">]</span><span class="token comment"># git add .</span>

<span class="token comment">#声明上传作者及邮箱</span>
<span class="token punctuation">[</span>root@jenkins java-demo<span class="token punctuation">]</span><span class="token comment"># git config --global user.email "1064981253@qq.com"</span>
<span class="token punctuation">[</span>root@jenkins java-demo<span class="token punctuation">]</span><span class="token comment"># git config --global user.name "pakho"</span>

<span class="token comment">#提交代码到本地仓库,-m 一般为开发人员本次修改的BUG注释</span>
<span class="token punctuation">[</span>root@jenkins java-demo<span class="token punctuation">]</span><span class="token comment"># git commit -m "java"</span>

<span class="token comment">#上传代码至远程Git仓库,并为本项目主分支</span>
<span class="token punctuation">[</span>root@jenkins java-demo<span class="token punctuation">]</span><span class="token comment"># git push origin master</span>

<span class="token comment">#创建秘钥对</span>
<span class="token punctuation">[</span>root@jenkins ~<span class="token punctuation">]</span><span class="token comment"># ssh-keygen</span>
<span class="token punctuation">[</span>root@jenkins ~<span class="token punctuation">]</span><span class="token comment"># ssh-copy-id git@192.168.100.20</span>

<span class="token comment">#执行拉取免密测试</span>
<span class="token punctuation">[</span>root@jenkins ~<span class="token punctuation">]</span><span class="token comment"># mkdir test</span>
<span class="token punctuation">[</span>root@jenkins ~<span class="token punctuation">]</span><span class="token comment"># cd test/</span>
<span class="token punctuation">[</span>root@jenkins test<span class="token punctuation">]</span><span class="token comment"># git clone git@192.168.100.20:/home/git/demo.git</span>
Cloning into <span class="token string">'demo'</span><span class="token punctuation">..</span>.
remote: Counting objects: <span class="token number">183</span>, done.
remote: Compressing objects: <span class="token number">100</span>% <span class="token punctuation">(</span><span class="token number">165</span>/165<span class="token punctuation">)</span>, done.
remote: Total <span class="token number">183</span> <span class="token punctuation">(</span>delta <span class="token number">7</span><span class="token punctuation">)</span>, reused <span class="token number">173</span> <span class="token punctuation">(</span>delta <span class="token number">4</span><span class="token punctuation">)</span>
Receiving objects: <span class="token number">100</span>% <span class="token punctuation">(</span><span class="token number">183</span>/183<span class="token punctuation">)</span>, <span class="token number">1.12</span> MiB <span class="token operator">|</span> <span class="token number">0</span> bytes/s, done.
Resolving deltas: <span class="token number">100</span>% <span class="token punctuation">(</span><span class="token number">7</span>/7<span class="token punctuation">)</span>, done.
</code></pre> 
<ul><li>安装<code>Jenkins</code> 
  <ul><li>提前安装<code>Docker</code>，参照：<a href="https://blog.csdn.net/sixeleven611/article/details/118081065">Docker基础+Docker安装</a></li></ul> </li></ul> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@jenkins ~<span class="token punctuation">]</span><span class="token comment"># docker --version</span>
Docker version <span class="token number">20.10</span>.7, build f0df350

<span class="token comment">#安装Java</span>
<span class="token punctuation">[</span>root@jenkins ~<span class="token punctuation">]</span><span class="token comment"># tar xf jdk-8u291-linux-x64.tar.gz -C /usr/local/</span>
<span class="token punctuation">[</span>root@jenkins ~<span class="token punctuation">]</span><span class="token comment"># cd /usr/local/</span>

<span class="token comment">#将JDK改名为Java</span>
<span class="token punctuation">[</span>root@jenkins local<span class="token punctuation">]</span><span class="token comment"># mv jdk1.8.0_291/ jdk</span>

<span class="token comment">#添加环境变量</span>
<span class="token punctuation">[</span>root@jenkins ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/bashrc</span>
<span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span>/usr/local/jdk
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$JAVA_HOME</span>/bin

<span class="token comment">#刷新配置文件</span>
<span class="token punctuation">[</span>root@jenkins ~<span class="token punctuation">]</span><span class="token comment"># source /etc/bashrc</span>

<span class="token comment">#验证是否安装成功</span>
<span class="token punctuation">[</span>root@jenkins ~<span class="token punctuation">]</span><span class="token comment"># java -version</span>
java version <span class="token string">"1.8.0_291"</span>
Java<span class="token punctuation">(</span>TM<span class="token punctuation">)</span> SE Runtime Environment <span class="token punctuation">(</span>build <span class="token number">1.8</span>.0_291-b10<span class="token punctuation">)</span>
Java HotSpot<span class="token punctuation">(</span>TM<span class="token punctuation">)</span> <span class="token number">64</span>-Bit Server VM <span class="token punctuation">(</span>build <span class="token number">25.291</span>-b10, mixed mode<span class="token punctuation">)</span>

<span class="token comment">#安装Maven</span>
<span class="token punctuation">[</span>root@jenkins ~<span class="token punctuation">]</span><span class="token comment"># yum install -y maven</span>

<span class="token comment">#官网下载Jenkins最新安装包</span>
<span class="token punctuation">[</span>root@jenkins ~<span class="token punctuation">]</span><span class="token comment"># wget https://get.jenkins.io/war-stable/2.289.2/jenkins.war</span>

<span class="token comment">#前台运行Jenkins,如果希望后台运行可以安装Tomcat或其他操作</span>
<span class="token punctuation">[</span>root@jenkins ~<span class="token punctuation">]</span><span class="token comment"># java -jar jenkins.war</span>
<span class="token comment">#运行中会产生默认Jenkins密码</span>
31cce3f846b54efa8d9f150a468cbc92

<span class="token comment">#通过文件夹查看密码</span>
<span class="token punctuation">[</span>root@jenkins ~<span class="token punctuation">]</span><span class="token comment"># cat /root/.jenkins/secrets/initialAdminPassword</span>
31cce3f846b54efa8d9f150a468cbc92

<span class="token comment">#Jenkins添加信任Harbor仓库</span>
<span class="token punctuation">[</span>root@jenkins ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/docker/daemon.json</span>
<span class="token punctuation">{<!-- --></span><span class="token string">"insecure-registries"</span>:<span class="token punctuation">[</span><span class="token string">"192.168.100.30"</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span>root@jenkins ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart docker</span>

<span class="token comment">#浏览器访问</span>
http://192.168.100.40:8080
</code></pre> 
<hr> 
<p><img src="https://images2.imgbox.com/a2/dd/4fcAeYWJ_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<p><img src="https://images2.imgbox.com/f8/7e/caEwirj0_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<p><img src="https://images2.imgbox.com/23/a8/fbLLokTI_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<p><img src="https://images2.imgbox.com/fd/d1/GdpbDhVJ_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<p><img src="https://images2.imgbox.com/7e/01/A2o1tc3Y_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<p><img src="https://images2.imgbox.com/bd/d2/5ds0okCx_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<ul><li>登录进入以后，将默认<code>Jenkins</code>下载源替换为国内源</li></ul> 
<pre><code class="prism language-bash"><span class="token comment">#Jenkins.war路径下有个隐藏文件</span>
<span class="token punctuation">[</span>root@jenkins ~<span class="token punctuation">]</span><span class="token comment"># ls -a</span>
.jenkins
<span class="token punctuation">[</span>root@jenkins ~<span class="token punctuation">]</span><span class="token comment"># cd .jenkins/updates/</span>
<span class="token punctuation">[</span>root@jenkins updates<span class="token punctuation">]</span><span class="token comment"># sed -i 's/http:\/\/updates.jenkinsci.org\/download/https:\/\/mirrors.tuna.tsinghua.edu.cn\/jenkins/g' default.json &amp;&amp; sed -i 's/http:\/\/www.google.com/https:\/\/www.baidu.com/g' default.json</span>
</code></pre> 
<hr> 
<p><img src="https://images2.imgbox.com/0a/22/1il1qhHJ_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<p><img src="https://images2.imgbox.com/46/d4/7rbSS15L_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<p><img src="https://images2.imgbox.com/7f/93/5NrGLZ0r_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-bash">https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json

<span class="token comment">#提交后浏览器输入重启Jenkins</span>
http://192.168.100.40:8080/restart
</code></pre> 
<hr> 
<ul><li>安装插件 
  <ul><li><code>PS</code>：由于实验做了无数遍，可能清除环境不是很彻底，有些默认的插件没有清理干净</li><li>需要下载安装<code>Git</code>和<code>Pipeline</code>插件，我这里以为安装了<code>Docker</code>在<code>Jenkins</code>上需要安装<code>Docker</code>版本的，可以忽略！<br> <img src="https://images2.imgbox.com/29/89/EHYCYRob_o.png" alt="在这里插入图片描述"></li></ul> </li></ul> 
<hr> 
<ul><li>创建凭据</li></ul> 
<p><img src="https://images2.imgbox.com/38/e7/uczL4ND7_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<p><img src="https://images2.imgbox.com/8f/0a/elokjX0T_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<p><img src="https://images2.imgbox.com/32/ce/XkmBOAXl_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<pre><code class="prism language-bash"><span class="token comment">#查看Jenkins主机私钥</span>
<span class="token punctuation">[</span>root@jenkins ~<span class="token punctuation">]</span><span class="token comment"># cat .ssh/id_rsa</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/b7/e4/OihKP3hf_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<ul><li>生成凭据<br> <img src="https://images2.imgbox.com/7b/f8/j48oOjxy_o.png" alt="在这里插入图片描述"></li></ul> 
<hr> 
<ul><li>新建项目<br> <img src="https://images2.imgbox.com/3b/4f/78sELw0n_o.png" alt="在这里插入图片描述"></li></ul> 
<hr> 
<p><img src="https://images2.imgbox.com/bb/9b/sYka2HD8_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<p><img src="https://images2.imgbox.com/48/4e/97aG3SJB_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<ul><li>添加流水线脚本</li></ul> 
<p><img src="https://images2.imgbox.com/a2/33/nU611VX5_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<pre><code class="prism language-java">node <span class="token punctuation">{<!-- --></span> 
   <span class="token comment">// 拉取代码</span>
   <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">'Git Checkout'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> 
       <span class="token function">checkout</span><span class="token punctuation">(</span><span class="token punctuation">[</span>$<span class="token keyword">class</span><span class="token operator">:</span> <span class="token string">'GitSCM'</span><span class="token punctuation">,</span> branches<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>name<span class="token operator">:</span> <span class="token string">'*/master'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> doGenerateSubmoduleConfigurations<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> extensions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> submoduleCfg<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> userRemoteConfigs<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>credentialsId<span class="token operator">:</span> <span class="token string">'70ddbc0b-8fb4-4a17-8d70-5bb3a720da7d'</span><span class="token punctuation">,</span> url<span class="token operator">:</span> <span class="token string">'git@192.168.100.20:/home/git/demo.git'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
   <span class="token comment">// 代码编译</span>
   <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">'Maven Build'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        sh <span class="token string">''</span>'
        <span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>mvn clean <span class="token keyword">package</span> <span class="token operator">-</span><span class="token class-name">Dmaven</span><span class="token punctuation">.</span>test<span class="token punctuation">.</span>skip<span class="token operator">=</span><span class="token boolean">true</span>
        <span class="token string">''</span>'
   <span class="token punctuation">}</span>
   <span class="token comment">// 项目打包到镜像并推送到镜像仓库</span>
   <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">'Build and Push Image'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        sh <span class="token string">''</span>'
        REPOSITORY<span class="token operator">=</span><span class="token number">192.168</span><span class="token number">.100</span><span class="token number">.30</span><span class="token operator">/</span>pakho<span class="token operator">/</span>tomcat<span class="token operator">-</span>java<span class="token operator">-</span>demo<span class="token operator">:</span>$<span class="token punctuation">{<!-- --></span><span class="token class-name">Branch</span><span class="token punctuation">}</span>
        echo ' 
        FROM <span class="token number">192.168</span><span class="token number">.100</span><span class="token number">.30</span><span class="token operator">/</span>pakho<span class="token operator">/</span>tomcat<span class="token operator">:</span>v1
        MAINTAINER pakho<span class="token operator">&lt;</span><span class="token number">1064981253</span><span class="token annotation punctuation">@qq.com</span><span class="token operator">&gt;</span>
        RUN rm <span class="token operator">-</span>rf <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>tomcat<span class="token operator">/</span>webapps<span class="token comment">/*
        ADD target/*.war /usr/local/tomcat/webapps/ROOT.war 
        ' &gt; Dockerfile
        docker build -t  $REPOSITORY .
        docker login 192.168.100.30 -u admin -p Harbor12345
        docker push $REPOSITORY
        '''
   }
   // 部署到Docker主机
   stage('Deploy to Docker') {
        sh '''
        REPOSITORY=192.168.100.30/pakho/tomcat-java-demo:${Branch}
        docker rm -f java-demo |true
        docker image rm $REPOSITORY |true
        docker login 192.168.100.30 -u admin -p Harbor12345
        docker run -d --name java-demo -p 88:8080 $REPOSITORY
        '''
   }
}
</span></code></pre> 
<p><img src="https://images2.imgbox.com/79/4a/1w95MRQv_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<ul><li>部署测试<br> <img src="https://images2.imgbox.com/b4/1f/iNTQsWfP_o.png" alt="在这里插入图片描述"></li></ul> 
<pre><code class="prism language-bash"><span class="token comment">#同时Jenkins日志抓取到部署成功的日志信息</span>
<span class="token number">2021</span>-07-09 <span class="token number">15</span>:06:37.699+0000 <span class="token punctuation">[</span>id<span class="token operator">=</span><span class="token number">199</span><span class="token punctuation">]</span>	INFO	o.j.p.workflow.job.WorkflowRun<span class="token comment">#finish: JAVA #1 completed: SUCCESS</span>
</code></pre> 
<hr> 
<p><img src="https://images2.imgbox.com/2b/5a/mSwfgKgv_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<ul><li>模拟程序员修改代码后的再次构建</li></ul> 
<pre><code class="prism language-bash"><span class="token comment">#基于刚才的测试路径</span>
<span class="token punctuation">[</span>root@jenkins demo<span class="token punctuation">]</span><span class="token comment"># pwd</span>
/root/test/demo

<span class="token comment">#修改代码</span>
<span class="token punctuation">[</span>root@jenkins demo<span class="token punctuation">]</span><span class="token comment"># vim src/main/resources/templates/index.ftl</span>
                  whatToType: <span class="token string">"学生管理系统v2"</span>,

<span class="token punctuation">[</span>root@jenkins demo<span class="token punctuation">]</span><span class="token comment"># git add .</span>
<span class="token punctuation">[</span>root@jenkins demo<span class="token punctuation">]</span><span class="token comment"># git config --global user.email "1064981253@qq.com"</span>
<span class="token punctuation">[</span>root@jenkins demo<span class="token punctuation">]</span><span class="token comment"># git config --global user.name "pakho"</span>
<span class="token punctuation">[</span>root@jenkins demo<span class="token punctuation">]</span><span class="token comment"># git commit -m "v2"</span>
<span class="token punctuation">[</span>master f0150ea<span class="token punctuation">]</span> v2
 <span class="token number">1</span> <span class="token function">file</span> changed, <span class="token number">1</span> insertion<span class="token punctuation">(</span>+<span class="token punctuation">)</span>, <span class="token number">1</span> deletion<span class="token punctuation">(</span>-<span class="token punctuation">)</span>
<span class="token punctuation">[</span>root@jenkins demo<span class="token punctuation">]</span><span class="token comment"># git push origin master</span>
Counting objects: <span class="token number">13</span>, done.
Compressing objects: <span class="token number">100</span>% <span class="token punctuation">(</span><span class="token number">6</span>/6<span class="token punctuation">)</span>, done.
Writing objects: <span class="token number">100</span>% <span class="token punctuation">(</span><span class="token number">7</span>/7<span class="token punctuation">)</span>, <span class="token number">553</span> bytes <span class="token operator">|</span> <span class="token number">0</span> bytes/s, done.
Total <span class="token number">7</span> <span class="token punctuation">(</span>delta <span class="token number">3</span><span class="token punctuation">)</span>, reused <span class="token number">0</span> <span class="token punctuation">(</span>delta <span class="token number">0</span><span class="token punctuation">)</span>
To git@192.168.100.20:/home/git/demo.git
   f0150ea<span class="token punctuation">..</span>6663acd  master -<span class="token operator">&gt;</span> master
</code></pre> 
<hr> 
<ul><li>执行二次构建</li></ul> 
<p><img src="https://images2.imgbox.com/c3/7e/BiK30TtQ_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<ul><li><font color="red">至此，实验完成！</font><br> <img src="https://images2.imgbox.com/94/8f/3JMUXjyr_o.png" alt="在这里插入图片描述"></li></ul> 
<hr> 
<ul><li>镜像仓库<code>Harbor</code>上也会有对应构建的镜像</li></ul> 
<p><img src="https://images2.imgbox.com/aa/bd/TyLsdY86_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<h2><a id="_468"></a>关于实验的一些总结</h2> 
<ul><li>实验做了很久，失败了无数次，环境搭了无数次，关键在于脚本的编写</li><li>网上有很多相似的实验，但是脚本拷贝过来修改了无数次，大都报错，对于脚本修改的地方，主要为<code>Dockerfile</code>文件</li><li>之前采用<code>cat</code> &lt;&lt;<code>EOF</code>的形式，一直在部署<code>Docker</code>时报错，改为<code>echo</code>方式，成功执行！</li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/066a2c55ebda35d233ddb868db567fe7/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">如计算机网络如何建立内部网,如何建立局域网【图文教程】</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/86fad5424c92e7a15f6de1147c4e4cca/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">w10计算机管理员权限在哪里设置密码,windows10管理员权限怎么设置_win10电脑设置管理员权限的步骤...</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>