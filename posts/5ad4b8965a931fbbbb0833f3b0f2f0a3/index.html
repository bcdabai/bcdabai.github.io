<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【QT】编译QtWebEngine（Build QtWebEngine from source）Win10&#43;QT5.7.1_x64&#43;VS2015 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【QT】编译QtWebEngine（Build QtWebEngine from source）Win10&#43;QT5.7.1_x64&#43;VS2015" />
<meta property="og:description" content="1、前言 关于QtWebEngine是干什么的，怎么用的，不在此赘述。
1.1、为什么要编译QtWebEngine QT默认的QtWebEngine是不支持mp3、mp4解码的，也就是说，如果想要在QT浏览网页的时候支持在线播放音视频，就需要让QtWebEngine支持对音视频格式的解码。QtWebEngine底层使用了chromium库，可能是为了避免知识产权方面的问题，QT并没有直接提供对应的音视频解码的第三方库，只提供了第三方库的源码，所以就需要自己手动编译了。
2、编译环境 在编译的时候遇到了各种奇奇怪怪的问题，基本上都是编译环境引起。通过不断的尝试，摸索出来按照以下的环境进行配置成功率会比较高。
环境的配置比较全面并且麻烦，建议有条件的尽量按照文档中所描述的进行配置。
2.1、操作系统 首先就是操作系统，建议尽量通过虚拟机进行操作。
在虚拟机中安装一个纯净的操作系统, 本文档中使用的是Win10_x64。并且最好把操作系统的语言设置成英文，设置成英文会避免在编译时出现一些字符格式上的错误。
1）修改操作系统语言
这个需要下载英语的语言包。
2）修改操作系统区域
将操作系统的区域设置为美国：
2.2、软件安装 我会把用到的软件放到网盘中，有需要的可以直接下载，网盘地址：
链接：https://pan.baidu.com/s/18WSYn6Jf02z9e-74A_-2EQ。
提取码：js87
2.2.1、VS2015 下载地址：下载 Visual Studio Tools - 免费安装 Windows、Mac、Linux。
安装VC&#43;&#43;模块，SDK Windows 10 (10.0.xxxxx.x)
可以将VS2015的显示语言改成英文，否则在编译时，部分字符会显示成乱码，不确定是否会影响正常编译。
2.2.2、QT5.7.1 下载地址：Index of /new_archive/qt/5.7/5.7.1。
本文档中安装的是 qt-opensource-windows-x86-msvc2015_64-5.7.1
安装：
一定要勾选Source和QtWebEngine! 一定要勾选Source和QtWebEngine! 一定要勾选Source和QtWebEngine!
安装完成之后，将qt安装目录下的bin路径添加至系统环境变量。
2.2.3、Python2.7 下载地址：Python Releases for Windows | Python.org。
一定要安装2.7.x的版本，不支持python3！
本文档中安装的是 python-2.7.18.amd64
安装完成之后，将安装目录添加至系统环境变量中。
2.2.4、Perl 下载地址：Strawberry Perl for Windows。
本文档中使用的是 strawberry-perl-5.32.1.1-64bit
安装完成之后，会自动将bin目录添加至系统环境变量。
2.2.5、Bison and Flex 下载地址：https://sourceforge.net/projects/winflexbison/。
将win-bison.exe重命名为bison.exe，将win-flex.exe重命名为flex.exe。
然后将bison.exe和flex.exe的路径添加至系统环境变量。
2.2.6、Gperf 下载地址：Gperf for Windows。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/5ad4b8965a931fbbbb0833f3b0f2f0a3/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-11-22T15:48:31+08:00" />
<meta property="article:modified_time" content="2022-11-22T15:48:31+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【QT】编译QtWebEngine（Build QtWebEngine from source）Win10&#43;QT5.7.1_x64&#43;VS2015</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2 style="text-align:justify;">1、前言</h2> 
<p style="margin-left:0;text-align:justify;">关于QtWebEngine是干什么的，怎么用的，不在此赘述。</p> 
<h3>1.1、为什么要编译QtWebEngine</h3> 
<p style="margin-left:0;text-align:justify;">QT默认的QtWebEngine是不支持mp3、mp4解码的，也就是说，如果想要在QT浏览网页的时候支持在线播放音视频，就需要让QtWebEngine支持对音视频格式的解码。QtWebEngine底层使用了chromium库，可能是为了避免知识产权方面的问题，QT并没有直接提供对应的音视频解码的第三方库，只提供了第三方库的源码，所以就需要自己手动编译了。</p> 
<h2 style="text-align:justify;">2、编译环境</h2> 
<p style="margin-left:0;text-align:justify;">在编译的时候遇到了各种奇奇怪怪的问题，基本上都是编译环境引起。通过不断的尝试，摸索出来按照以下的环境进行配置成功率会比较高。</p> 
<p style="margin-left:0;text-align:justify;">环境的配置比较全面并且麻烦，建议有条件的尽量按照文档中所描述的进行配置。</p> 
<h3>2.1、操作系统</h3> 
<p style="margin-left:0;text-align:justify;">首先就是操作系统，建议尽量通过虚拟机进行操作。</p> 
<p style="margin-left:0;text-align:justify;">在虚拟机中安装一个纯净的操作系统, 本文档中使用的是Win10_x64。并且最好把操作系统的语言设置成英文，设置成英文会避免在编译时出现一些字符格式上的错误。</p> 
<p style="margin-left:0;text-align:justify;"><strong>1）修改操作系统语言</strong></p> 
<p style="margin-left:0;text-align:justify;"><img alt="" height="348" src="https://images2.imgbox.com/87/0d/mj11f88g_o.png" width="513"></p> 
<p> 这个需要下载英语的语言包。</p> 
<p style="margin-left:0;text-align:justify;"><strong>2）修改操作系统区域</strong></p> 
<p style="margin-left:0;text-align:justify;">将操作系统的区域设置为美国：</p> 
<p><img alt="" class="left" height="483" src="https://images2.imgbox.com/f3/be/T6ejeuOn_o.png" width="424"></p> 
<p><img alt="" class="left" height="373" src="https://images2.imgbox.com/3b/d5/FozPkTNF_o.png" width="540"></p> 
<h3 style="margin-left:0px;">2.2、软件安装</h3> 
<p style="margin-left:0;text-align:justify;">我会把用到的软件放到网盘中，有需要的可以直接下载，网盘地址：</p> 
<p style="margin-left:0;text-align:justify;">链接：<a href="https://pan.baidu.com/s/18WSYn6Jf02z9e-74A_-2EQ" rel="nofollow" title="https://pan.baidu.com/s/18WSYn6Jf02z9e-74A_-2EQ">https://pan.baidu.com/s/18WSYn6Jf02z9e-74A_-2EQ</a>。</p> 
<p style="margin-left:0;text-align:justify;">提取码：js87</p> 
<h4>2.2.1、VS2015</h4> 
<p style="margin-left:0;text-align:justify;">下载地址：<a href="https://visualstudio.microsoft.com/zh-hans/downloads/" rel="nofollow" title="下载 Visual Studio Tools - 免费安装 Windows、Mac、Linux">下载 Visual Studio Tools - 免费安装 Windows、Mac、Linux</a>。</p> 
<p style="margin-left:0;text-align:justify;">安装VC++模块，SDK Windows 10 (10.0.xxxxx.x)</p> 
<p style="margin-left:0;text-align:justify;">可以将VS2015的显示语言改成英文，否则在编译时，部分字符会显示成乱码，不确定是否会影响正常编译。</p> 
<h4>2.2.2、QT5.7.1</h4> 
<p style="margin-left:0;text-align:justify;">下载地址：<a href="https://download.qt.io/new_archive/qt/5.7/5.7.1/" rel="nofollow" title="Index of /new_archive/qt/5.7/5.7.1">Index of /new_archive/qt/5.7/5.7.1</a>。</p> 
<p style="margin-left:0;text-align:justify;">本文档中安装的是 qt-opensource-windows-x86-msvc2015_64-5.7.1</p> 
<p style="margin-left:0;text-align:justify;">安装：</p> 
<p style="margin-left:0;text-align:center;"><img alt="" class="left" height="417" src="https://images2.imgbox.com/83/24/D96Ix65E_o.png" width="356"></p> 
<p> <strong><span style="color:#ff0000;">一定要勾选Source和QtWebEngine! </span></strong></p> 
<p style="margin-left:0;text-align:justify;"><strong><span style="color:#ff0000;">一定要勾选Source和QtWebEngine! </span></strong></p> 
<p style="margin-left:0;text-align:justify;"><strong><span style="color:#ff0000;">一定要勾选Source和QtWebEngine!</span></strong></p> 
<p style="margin-left:0;text-align:justify;">安装完成之后，将qt安装目录下的bin路径添加至系统环境变量。</p> 
<h4>2.2.3、Python2.7</h4> 
<p style="margin-left:0;text-align:justify;">下载地址：<a href="https://www.python.org/downloads/windows/" rel="nofollow" title="Python Releases for Windows | Python.org">Python Releases for Windows | Python.org</a>。</p> 
<p style="margin-left:0;text-align:justify;"><span style="color:#fe2c24;"><strong>一定要安装2.7.x的版本，不支持python3！</strong></span></p> 
<p style="margin-left:0;text-align:justify;">本文档中安装的是 python-2.7.18.amd64</p> 
<p style="margin-left:0;text-align:justify;">安装完成之后，将安装目录添加至系统环境变量中。</p> 
<h4>2.2.4、Perl</h4> 
<p style="margin-left:0;text-align:justify;">下载地址：<a href="https://strawberryperl.com/" rel="nofollow" title="Strawberry Perl for Windows">Strawberry Perl for Windows</a>。</p> 
<p style="margin-left:0;text-align:justify;">本文档中使用的是 strawberry-perl-5.32.1.1-64bit</p> 
<p style="margin-left:0;text-align:justify;">安装完成之后，会自动将bin目录添加至系统环境变量。</p> 
<h4>2.2.5、Bison and Flex</h4> 
<p style="margin-left:0;text-align:justify;">下载地址：<a href="https://sourceforge.net/projects/winflexbison/" rel="nofollow" title="https://sourceforge.net/projects/winflexbison/">https://sourceforge.net/projects/winflexbison/</a>。</p> 
<p style="margin-left:0;text-align:justify;">将win-bison.exe重命名为bison.exe，将win-flex.exe重命名为flex.exe。</p> 
<p style="margin-left:0;text-align:justify;">然后将bison.exe和flex.exe的路径添加至系统环境变量。</p> 
<h4>2.2.6、Gperf</h4> 
<p style="margin-left:0;text-align:justify;">下载地址：<a href="http://gnuwin32.sourceforge.net/packages/gperf.htm" rel="nofollow" title="Gperf for Windows">Gperf for Windows</a>。</p> 
<p style="margin-left:0;text-align:justify;">安装gperf-3.0.1.exe（这个需要双击进行安装），将bin目录添加至系统环境变量</p> 
<p style="margin-left:0;text-align:justify;">（可以将bison.exe和flex.exe都放在这个文件夹下）。</p> 
<h4>2.2.7、Git</h4> 
<p style="margin-left:0;text-align:justify;">下载地址：<a href="https://git-scm.com/downloads" rel="nofollow" title="Git - Downloads">Git - Downloads</a>。</p> 
<p style="margin-left:0;text-align:justify;">下载windows x64所用版本 Git-2.38.1-64-bit，安装完成将bin目录添加至系统环境变量。</p> 
<p style="margin-left:0;text-align:justify;">所有软件安装完成之后的系统环境变量：</p> 
<p style="margin-left:0;text-align:justify;"><img alt="" height="303" src="https://images2.imgbox.com/c8/fc/2wisFBNd_o.png" width="412"></p> 
<p> ！所有的软件安装完成，配置环境变量之后，重启一下电脑！</p> 
<h2 style="text-align:justify;">3、编译流程</h2> 
<p style="margin-left:0;text-align:justify;">以管理员权限打开cmd，打开命令行工具。</p> 
<p style="margin-left:0;text-align:justify;"><strong>1）找一下 vcvars64.bat 文件所在目录，先进入到该目录下</strong>：</p> 
<pre><code class="language-bash">cd C:\Program Files (x86)\Microsoft Visual Studio 14.0\VC\bin\amd64\</code></pre> 
<p style="margin-left:0;text-align:justify;">然后执行 vcvars64.bat：</p> 
<p style="margin-left:0;text-align:justify;"><img alt="" height="210" src="https://images2.imgbox.com/b0/a6/RlAR9K46_o.png" width="1200"></p> 
<p> <strong>2）进入到qtwebengine原文件所在目录</strong>：</p> 
<pre><code class="language-bash">cd C:\Qt\Qt5.7.1\5.7\Src\qtwebengine</code></pre> 
<p style="margin-left:0;text-align:justify;"><img alt="" height="31" src="https://images2.imgbox.com/03/b2/VlOKv8Xe_o.png" width="1200"></p> 
<p> <strong>3）qmake编译</strong></p> 
<pre><code class="language-bash">qmake WEBENGINE_CONFIG+=use_proprietary_codecs qtwebengine.pro</code></pre> 
<p style="margin-left:0;text-align:justify;">（环境变量已配置）</p> 
<p style="margin-left:0;text-align:justify;">或者</p> 
<pre><code class="language-bash">C:\Qt\Qt5.7.1\5.7\msvc2015_64\bin\qmake.exe WEBENGINE_CONFIG+=use_proprietary_codecs qtwebengine.pro</code></pre> 
<p style="margin-left:0;text-align:justify;"><img alt="" height="84" src="https://images2.imgbox.com/49/a3/f0NUmhnW_o.png" width="1157"></p> 
<p> <strong>4）nmake</strong></p> 
<pre><code class="language-bash">nmake</code></pre> 
<p style="margin-left:0;text-align:justify;">（环境变量已配置）</p> 
<p style="margin-left:0;text-align:justify;">或者</p> 
<pre><code class="language-bash">"C:\Program Files (x86)\Microsoft Visual Studio 14.0\VC\bin\amd64\nmake.exe"</code></pre> 
<p style="margin-left:0;text-align:justify;">如果所有的环境都配置正确的话，此时就正常编译了，会花费比较长的时间（本机大概花费了将近3个小时）</p> 
<p style="margin-left:0;text-align:justify;"><strong>5）nmake install</strong></p> 
<p style="margin-left:0;text-align:justify;">这一步骤其实是将编译好库拷贝到QT的指定目录下。如果没必要的话，可以不用执行这一步，编译好的库都在C:\Qt\Qt5.7.1\5.7\Src\qtwebengine文件夹下了：</p> 
<p style="margin-left:0;text-align:justify;"><img alt="" height="263" src="https://images2.imgbox.com/06/85/arKVPBas_o.png" width="459"></p> 
<p> install其实就是将编译好的库自动拷贝到QT的bin目录下。</p> 
<h2>4、编译时遇到的问题</h2> 
<p style="margin-left:0;text-align:justify;">编译总是遇到很多奇怪的问题。总是会不断的尝试各种方法以解决问题，最终虽然会解决，但是有时候也不明确问题的根本原因是什么，或者说不知道哪一种方法才是解决问题的直接方式。所以在此记录一下遇到的问题，以及可能的解决方法。</p> 
<h3>4.1、问题一：module machine type ‘x64’ conflicts with target machine type ‘x86’</h3> 
<p style="margin-left:0;text-align:justify;"><img alt="" height="457" src="https://images2.imgbox.com/41/98/EVeofRH5_o.png" width="1200"></p> 
<p> 这个问题应该是在编译的时候没选对编译工具的版本，试了很多次，只要严格按照上面的编译流程执行的话就不会出现这个问题。</p> 
<h3>4.2、问题二：target architecture x64 is only support on x64 host</h3> 
<p style="margin-left:0;text-align:justify;"><img alt="" height="427" src="https://images2.imgbox.com/43/d0/L3W4zZ5O_o.png" width="1200"></p> 
<p> 这个问题困扰我很久，看问题描述应该也是编译版本没选对的原因，但是不管怎么尝试都还是会出现这个问题，后来重新装个纯净的win10操作系统并把相关软件安装之后，再执行编译，发现这个问题就没有了，后来猜测可能和我以前的系统中还装有vs2019+qt5.12.12有关，虽然期间我把vs2019和qt5.12.12都卸载了，但是应该还有有些残留的东西影响了编译。</p> 
<p style="margin-left:0;text-align:justify;">这就是为啥建议一定要搞一个纯净的操作系统的原因。</p> 
<h3>4.3、问题三：ninja.exe is not recognized as an internal or external command operable program or batch file</h3> 
<p style="margin-left:0;text-align:justify;"><img alt="" height="487" src="https://images2.imgbox.com/40/21/aVCj8eFS_o.png" width="1200"></p> 
<p> 这个ninja.exe是在编译过程中生成的执行程序，但因为某个未知原因造成此次编译没有正常生成（怀疑是因为没有把vs2015设置成英文有关，虽然把vs2015设置成英文之后还是会报这个错误doge，也有可能是因为没有把nmake所在目录添加至环境变量）</p> 
<p style="margin-left:0;text-align:justify;">我解决这个问题的方式是把前面编译时（虽然最终没有编译成功，但是ninja.exe生成成功了）生成的ninja.exe给拷贝到指定目录中：</p> 
<p style="margin-left:0;text-align:justify;"><img alt="" height="335" src="https://images2.imgbox.com/d1/30/k5Wd375u_o.png" width="505"></p> 
<p> 我会把这个ninja.exe同样放到网盘中，以防有遇到同样的问题的。</p> 
<h2 style="text-align:justify;">5、引用</h2> 
<h3 style="text-align:justify;">5.1、官方教程</h3> 
<p style="margin-left:0;text-align:justify;">QT中关于编译QtWebEngine的教程并不多，偶然间找到了一个官方介绍编译QtWebEngine的说明，非常简单：</p> 
<p style="margin-left:0;text-align:justify;">链接：<a href="https://sodocumentation.net/qt/topic/8718/build-qtwebengine-from-source" rel="nofollow" title="Qt Tutorial - Build QtWebEngine from source">Qt Tutorial - Build QtWebEngine from source</a>。</p> 
<h3>5.2、其它引用</h3> 
<p style="margin-left:0;text-align:justify;">官方的文档总是很简单，但是实际操作中总是会出现很多问题，下面是参考的一下其它的文档：</p> 
<p style="margin-left:0;text-align:justify;">1）<a href="https://stackoverflow.com/questions/50510457/how-to-compile-qt-webengine-5-11-on-windows-with-proprietary-codecs/50510458#50510458" rel="nofollow" title="visual studio - How to compile Qt webengine (5.11) on Windows with proprietary codecs - Stack Overflow">visual studio - How to compile Qt webengine (5.11) on Windows with proprietary codecs - Stack Overflow</a>。</p> 
<p style="margin-left:0;text-align:justify;">2）<a href="https://blog.csdn.net/hello_zhengyue/article/details/119181965" title="解决QWebEngineView无法播放H5 Mp4问题_粗心的郑先生的博客-CSDN博客">解决QWebEngineView无法播放H5 Mp4问题_粗心的郑先生的博客-CSDN博客</a>。</p> 
<p style="margin-left:0;text-align:justify;">3）<a href="https://blog.csdn.net/u013495598/article/details/88945533" title="解决QtWebEngine无法播放H5中的mp4_二丶九的博客-CSDN博客">解决QtWebEngine无法播放H5中的mp4_二丶九的博客-CSDN博客</a>。</p> 
<p style="margin-left:0;text-align:justify;">4）<a href="https://blog.csdn.net/qq_40501206/article/details/115632607" title="Qt5 编译 Qt WebEngine_帅气转身而过的博客-CSDN博客">Qt5 编译 Qt WebEngine_帅气转身而过的博客-CSDN博客</a>。</p> 
<p style="margin-left:0;text-align:justify;">5）<a href="https://www.jianshu.com/p/8bbd85cb3edb" rel="nofollow" title="VS2017+Qt5.12.7-重新编译webengine-MP4播放的问题 - 简书">VS2017+Qt5.12.7-重新编译webengine-MP4播放的问题 - 简书</a>。</p> 
<p style="margin-left:0;text-align:justify;"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/84e90225620999af814b6937783bae49/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">实现Excel文件xls与xlsx格式批量互相转换</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/98f101505b578604a7b700dd9cd4f4b5/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">使用pkg打包node.js为可执行文件（exe）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>