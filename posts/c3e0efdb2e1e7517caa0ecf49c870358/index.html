<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>浏览器使用Notification桌面通知消息推送 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="浏览器使用Notification桌面通知消息推送" />
<meta property="og:description" content="什么是 Notification？ Notification 是浏览器最小化后在桌面显示消息的一种方法类似于 360 等流氓软件在桌面右下角的弹窗广告它与浏览器是脱离的，消息是置顶的 一、弹窗授权 授权当前页面允许通知可以通过检查只读属性 Notification.permission 的值来查看你是否已经有权限default： 用户还未被询问是否授权，可以通过 Notification.requestPermission() 可以询问用户是否允许通知granted： 用户点击允许后的状态denied： 用户点击拒绝后的状态，通知框不可用 Notification.requestPermission() 二、弹窗使用 可以通过 new Notification($title, $options) 使用通知推送功能title： 一定会被显示的通知标题options： 可选，一个被允许用来设置通知的对象。它包含以下属性：dir： 文字的方向；它的值可以是 auto（自动）, ltr（从左到右）, or rtl（从右到左）lang： 指定通知中所使用的语言。body： 通知中额外显示的字符串tag： 赋予通知一个ID，以便在必要的时候对通知进行刷新、替换或移除。icon： 一个图片的URL，将被用于显示通知的图标。 new Notification(&#34;温馨提醒&#34;, { body: &#34;木芒果&#34;, icon: &#34;https://profile-avatar.csdnimg.cn/238b721d51d44069986d5004489dcbd3_m0_63823719.jpg!1&#34;, data: &#34;https://blog.csdn.net/m0_63823719/&#34; }); 三、浏览器支持检测 使用通知推送功能前，需要先检查浏览器是否支持可以通过 &#34;Notification&#34; in window 方法去检测在浏览器支持的前提下，判断用户是否授权允许通知，如果还未授权，可以弹出授权框如果用户已经拒绝过，我们就不去打扰用户了 function notify() { // 先检查浏览器是否支持 if (!(&#34;Notification&#34; in window)) { alert(&#34;This browser does not support desktop notification&#34;); } // 检查用户是否同意接受通知 else if (Notification." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/c3e0efdb2e1e7517caa0ecf49c870358/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-07-03T14:37:03+08:00" />
<meta property="article:modified_time" content="2023-07-03T14:37:03+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">浏览器使用Notification桌面通知消息推送</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h3>什么是 Notification？</h3> 
<ul><li><code>Notification</code> 是浏览器最小化后在桌面显示消息的一种方法</li><li>类似于 <code>360</code> 等流氓软件在桌面右下角的弹窗广告</li><li>它与浏览器是脱离的，消息是置顶的</li></ul> 
<p><img alt="" height="190" src="https://images2.imgbox.com/f8/1b/eP9ujQFE_o.png" width="489"> </p> 
<h3>一、弹窗授权</h3> 
<ul><li>授权当前页面允许通知</li><li>可以通过检查只读属性 <code>Notification.permission</code> 的值来查看你是否已经有权限</li><li><strong>default：</strong> 用户还未被询问是否授权，可以通过 <code>Notification.requestPermission()</code> 可以询问用户是否允许通知</li><li><strong>granted：</strong> 用户点击允许后的状态</li><li><strong>denied：</strong> 用户点击拒绝后的状态，通知框不可用</li></ul> 
<pre><code class="language-javascript">Notification.requestPermission()</code></pre> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/c6/d2/ZazipBCe_o.png"></p> 
<h3>二、弹窗使用</h3> 
<ul><li>可以通过 <code>new Notification($title, $options)</code> 使用通知推送功能</li><li><strong>title：</strong> 一定会被显示的通知标题</li><li><strong>options：</strong> 可选，一个被允许用来设置通知的对象。它包含以下属性：</li><li><strong>dir：</strong> 文字的方向；它的值可以是 auto（自动）, ltr（从左到右）, or rtl（从右到左）</li><li><strong>lang：</strong> 指定通知中所使用的语言。</li><li><strong>body：</strong> 通知中额外显示的字符串</li><li><strong>tag：</strong> 赋予通知一个ID，以便在必要的时候对通知进行刷新、替换或移除。</li><li><strong>icon：</strong> 一个图片的URL，将被用于显示通知的图标。</li></ul> 
<pre><code class="language-javascript">new Notification("温馨提醒", { 
    body: "木芒果", 
    icon: "https://profile-avatar.csdnimg.cn/238b721d51d44069986d5004489dcbd3_m0_63823719.jpg!1", 
    data: "https://blog.csdn.net/m0_63823719/" 
});</code></pre> 
<h3>三、浏览器支持检测</h3> 
<ul><li>使用通知推送功能前，需要先检查浏览器是否支持</li><li>可以通过 <code>"Notification" in window</code> 方法去检测</li><li>在浏览器支持的前提下，判断用户是否授权允许通知，如果还未授权，可以弹出授权框</li><li>如果用户已经拒绝过，我们就不去打扰用户了</li></ul> 
<pre><code class="language-javascript">function notify() {
    // 先检查浏览器是否支持
    if (!("Notification" in window)) {
        alert("This browser does not support desktop notification");
    }

    // 检查用户是否同意接受通知
    else if (Notification.permission === "granted") {
        // If it's okay let's create a notification
        var notification = new Notification("Hi there!");
    }

    // 否则我们需要向用户获取权限
    else if (Notification.permission !== "denied") {
        Notification.requestPermission().then(function (permission) {
            // 如果用户接受权限，我们就可以发起一条消息
            if (permission === "granted") {
                var notification = new Notification("Hi there!");
            }
        });
    }

    // 最后，如果执行到这里，说明用户已经拒绝对相关通知进行授权
    // 出于尊重，我们不应该再打扰他们了
}</code></pre> 
<h3>四、授权回调</h3> 
<ul><li>该通知有四个回调方法</li><li><strong>onshow：</strong> 在通知展示的时候调用</li><li><strong>onclose：</strong> 在通知关闭的时候调用</li><li><strong>onclick：</strong> 在通知点击的时候调用</li><li><strong>onerror：</strong> 在通知出错的时候调用</li></ul> 
<pre><code class="language-javascript">var notification = new Notification("温馨提醒", { 
    body: "木芒果", 
    icon: "https://profile-avatar.csdnimg.cn/238b721d51d44069986d5004489dcbd3_m0_63823719.jpg!1", 
    data: "https://blog.csdn.net/m0_63823719/" 
});

notification.onshow = function (event) {
    console.log("show : ", event);
};

notification.onclose = function (event) {
    console.log("close : ", event);
};

notification.onclick = function (event) {
    console.log("click : ", event);
    // 当点击事件触发，打开指定的url
    window.open(event.target.data)
    notification.close();
};

notification.onerror = function (event) {
    console.log("close : ", event);
};</code></pre> 
<h3>五、3秒后关闭弹窗</h3> 
<ul><li>实现3秒后关闭弹窗的功能</li></ul> 
<pre><code class="language-java">var notification = new Notification('标题');
notification.onshow = function () {
    setTimeout(function () {
        notification.close();
    }, 3000);
}</code></pre> 
<h2>六、最佳实践</h2> 
<p>notification.js</p> 
<pre><code class="language-javascript">/**
 * 浏览器发送通知方法
 * Author：木芒果
 * @param {Object} title 通知标题
 * @param {Object} options 可选参数body(消息体)、icon(通知显示的图标路径)、data(点击通知后跳转的URL)
 * 示例：
 * createNotify("新的消息", {
 *		body: "你有一个奖品待领取",
 *		icon: "https://www.baidu.com/favicon.ico",
 *		data: "https://www.baidu.com/"
 *	});
 */
function createNotify(title, options) {
	var PERMISSON_GRANTED = "granted";
	var PERMISSON_DENIED = "denied";
	var PERMISSON_DEFAULT = "default";

	// 如果用户已经允许，直接显示消息，如果不允许则提示用户授权
	if (Notification.permission === PERMISSON_GRANTED) {
		notify(title, options);
	} else {
		Notification.requestPermission(function(res) {
			if (res === PERMISSON_GRANTED) {
				notify(title, options);
			}
		});
	}

	// 显示提示消息
	function notify($title, $options) {
		var notification = new Notification($title, $options);
		// console.log(notification);
		notification.onshow = function(event) {
			// console.log("show : ", event);
		};
		notification.onclose = function(event) {
			// console.log("close : ", event);
		};
		notification.onclick = function(event) {
			// console.log("click : ", event);
			// 当点击事件触发，打开指定的url
			window.open(event.target.data)
			notification.close();
		};
	}
}
/* 依次打印
 * show:   Event Object(事件对象)，事件的type为"show"
 * click:  Event Object(事件对象)，事件的type为"click"。点击消息后消息被关闭，跳到close事件。
 * close:  Event Object(事件对象)，事件的type为"close"
 */</code></pre> 
<p> index.html</p> 
<pre><code class="language-html">&lt;html lang="en"&gt;
	&lt;head&gt;
		&lt;meta charset="UTF-8" /&gt;
		&lt;meta name="viewport" content="width=device-width, initial-scale=1.0" /&gt;
		&lt;title&gt;Document&lt;/title&gt;
	&lt;/head&gt;

	&lt;body&gt;
		&lt;script src="notification.js"&gt;&lt;/script&gt;
		&lt;script&gt;
			createNotify("新的消息", {
				body: "你有一个奖品待领取",
				icon: "https://www.baidu.com/favicon.ico",
				data: "https://www.baidu.com/"
			});
		&lt;/script&gt;
	&lt;/body&gt;
&lt;/html&gt;</code></pre> 
<h2>七、兼容性</h2> 
<p>常用的Edge、Google Chrome都支持！</p> 
<p><img alt="" height="366" src="https://images2.imgbox.com/6c/3a/DQctbX4s_o.png" width="1200"></p> 
<p>该图出自：<a href="https://caniuse.com/?search=Notification" rel="nofollow" title='"Notification" | Can I use... Support tables for HTML5, CSS3, etc'>"Notification" | Can I use... Support tables for HTML5, CSS3, etc</a></p> 
<p>值得注意的是：你必须使用网络服务器进行挂载才能正确显示该通知，<span style="color:#fe2c24;">直接打开HTML是无效的</span>，例如<span style="color:#fe2c24;">使用Nginx、Nodejs、HBuilder X开发工具、WebStorm开发工具去运行此程序</span>，如需将此通知功能应用到线上的业务，需<span style="color:#fe2c24;">使用HTTPS协议</span>方可使用！</p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3bf618c80a3a41c166bb883e5ff0ed36/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【OpenVI—论文解读系列】ICLR 2023 | 达摩院开源轻量人脸检测DamoFD</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/af9692cd2f0b41456b9dae650c1299bd/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">VUE3笔记</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>