<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Docker|基础篇 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Docker|基础篇" />
<meta property="og:description" content="简介 Docker 在容器的基础上，进行了进一步的封装，从文件系统、网络互联到进程隔离等等，极大的简化了容器的创建和维护。使得 Docker 技术比虚拟机技术更为轻便、快捷。
下面的图片比较了 Docker 和传统虚拟化方式的不同之处。传统虚拟机技术是虚拟出一套硬件后，在其上运行一个完整操作系统，在该系统上再运行所需应用进程；而容器内的应用进程直接运行于宿主的内核，容器内没有自己的内核，而且也没有进行硬件虚拟。因此容器要比传统虚拟机更为轻便。
概念 Docker 包括三个基本概念 镜像（Image）容器（Container）仓库（Repository） 如果按面向对象思想：镜像类比如类，容器类比如实例 公有仓库：hub.docker.com/ Docker 引擎 Docker 引擎是一个包含以下主要组件的客户端服务器应用程序。
一种服务器，它是一种称为守护进程并且长时间运行的程序。REST API用于指定程序可以用来与守护进程通信的接口，并指示它做什么。一个有命令行界面 (CLI) 工具的客户端。 Docker 引擎组件的流程如下图所示：
安装 以下基于Centos7以上版本。
centos7安装：www.osyunwei.com/archives/78…
docker安装：
下载安装
$ curl -fsSL get.docker.com -o get-docker.sh $ sudo sh get-docker.sh --mirror Aliyun 复制代码 启动
$ sudo systemctl enable docker $ sudo systemctl start docker 复制代码 配置Docker 国内加速器
$ curl -sSL https://get.daocloud.io/daotools/set_mirror.sh | sh -s http://f1361db2.m.daocloud.io 复制代码 Docker基本操作指令 下载镜像：
$ docker pull tomcat 复制代码 解析：docker pull [选项] [Docker Registry 地址[:端口号]/]仓库名[:标签]" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/8ead16f639b21b3ec2f48d2a1058d488/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-04-13T14:06:04+08:00" />
<meta property="article:modified_time" content="2019-04-13T14:06:04+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Docker|基础篇</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div class="article-content"> 
 <h5 class="heading">简介</h5> 
 <p>Docker 在容器的基础上，进行了进一步的封装，从文件系统、网络互联到进程隔离等等，极大的简化了容器的创建和维护。使得 Docker 技术比虚拟机技术更为轻便、快捷。</p> 
 <p>下面的图片比较了 Docker 和传统虚拟化方式的不同之处。传统虚拟机技术是虚拟出一套硬件后，在其上运行一个完整操作系统，在该系统上再运行所需应用进程；而容器内的应用进程直接运行于宿主的内核，容器内没有自己的内核，而且也没有进行硬件虚拟。因此容器要比传统虚拟机更为轻便。</p> 
 <p></p> 
 <figure> 
  <figcaption></figcaption> 
 </figure> 
 <p></p> 
 <p></p> 
 <figure> 
  <figcaption></figcaption> 
 </figure> 
 <p></p> 
 <h5 class="heading">概念</h5> 
 <h6 class="heading">Docker 包括三个基本概念</h6> 
 <ul><li>镜像（Image）</li><li>容器（Container）</li><li>仓库（Repository） 如果按面向对象思想：<strong>镜像</strong>类比如<strong>类</strong>，<strong>容器</strong>类比如<strong>实例</strong> 公有仓库：<a href="https://link.juejin.im?target=https%3A%2F%2Fhub.docker.com%2F" rel="nofollow">hub.docker.com/</a></li></ul> 
 <h6 class="heading">Docker 引擎</h6> 
 <p>Docker 引擎是一个包含以下主要组件的客户端服务器应用程序。</p> 
 <ul><li>一种服务器，它是一种称为守护进程并且长时间运行的程序。</li><li>REST API用于指定程序可以用来与守护进程通信的接口，并指示它做什么。</li><li>一个有命令行界面 (CLI) 工具的客户端。</li></ul> 
 <p>Docker 引擎组件的流程如下图所示：</p> 
 <p></p> 
 <figure> 
  <figcaption></figcaption> 
 </figure> 
 <p></p> 
 <h5 class="heading">安装</h5> 
 <p>以下基于Centos7以上版本。</p> 
 <p>centos7安装：<a href="https://link.juejin.im?target=https%3A%2F%2Fwww.osyunwei.com%2Farchives%2F7829.html" rel="nofollow">www.osyunwei.com/archives/78…</a></p> 
 <p>docker安装：</p> 
 <p><strong>下载安装</strong></p> 
 <pre><code class="hljs shell copyable"><span class="hljs-meta">$</span><span class="bash"> curl -fsSL get.docker.com -o get-docker.sh</span>
<span class="hljs-meta">$</span><span class="bash"> sudo sh get-docker.sh --mirror Aliyun</span>
<span class="copy-code-btn">复制代码</span></code></pre> 
 <p><strong>启动</strong></p> 
 <pre><code class="hljs shell copyable"><span class="hljs-meta">$</span><span class="bash"> sudo systemctl <span class="hljs-built_in">enable</span> docker</span>
<span class="hljs-meta">$</span><span class="bash"> sudo systemctl start docker</span>
<span class="copy-code-btn">复制代码</span></code></pre> 
 <p><strong>配置Docker<a href="https://link.juejin.im?target=https%3A%2F%2Fwww.daocloud.io%2Fmirror%23accelerator-doc" rel="nofollow"> 国内加速器</a></strong></p> 
 <pre><code class="hljs shell copyable"><span class="hljs-meta">$</span><span class="bash"> curl <span class="hljs-_">-s</span>SL https://get.daocloud.io/daotools/set_mirror.sh | sh <span class="hljs-_">-s</span> http://f1361db2.m.daocloud.io</span>
<span class="copy-code-btn">复制代码</span></code></pre> 
 <h5 class="heading">Docker基本操作指令</h5> 
 <p><strong>下载镜像：</strong></p> 
 <pre><code class="hljs bash copyable">$ docker pull tomcat
<span class="copy-code-btn">复制代码</span></code></pre> 
 <p>解析：docker pull [选项] [Docker Registry 地址[:端口号]/]仓库名[:标签]</p> 
 <p><strong>启动容器：</strong></p> 
 <ul><li>1.交互式运行</li></ul> 
 <pre><code class="hljs bash copyable">$ docker run -it --rm tomcat bash
<span class="copy-code-btn">复制代码</span></code></pre> 
 <ul><li> 
   <ol start="2"><li>后台运行</li></ol></li></ul> 
 <pre><code class="hljs bash copyable"><span class="hljs-variable">$docker</span> run --name webserver <span class="hljs-_">-d</span> -p 8080:8080 tomcat
<span class="copy-code-btn">复制代码</span></code></pre> 
 <p>解析：</p> 
 <p>-it 指：i为交互式操作，t为终端；</p> 
 <p>--rm指容器退出后随之将其删除；</p> 
 <p>tomcat指你要启动的镜像；</p> 
 <p>bash指tomcat中的shell控制台;</p> 
 <p>--name 指定名称；</p> 
 <p>-d 后台运行；</p> 
 <p>-p 8080:8080 指定端口号(第一个为宿主机端口，第二个为docker的端口。</p> 
 <p><strong>交互式进入容器：</strong></p> 
 <pre><code class="hljs bash copyable">docker <span class="hljs-built_in">exec</span> -it &lt;容器id&gt;  bash
<span class="copy-code-btn">复制代码</span></code></pre> 
 <p><strong>查看运行中的容器：</strong></p> 
 <pre><code class="hljs bash copyable">docker ps <span class="hljs-_">-a</span>
<span class="copy-code-btn">复制代码</span></code></pre> 
 <p><strong>删除容器：</strong></p> 
 <pre><code class="hljs bash copyable">docker rm &lt;容器id&gt;
<span class="copy-code-btn">复制代码</span></code></pre> 
 <p><strong>查看容器运行日志：</strong></p> 
 <pre><code class="hljs bash copyable">docker logs <span class="hljs-_">-f</span> -t &lt;容器id或容器名称&gt;
<span class="copy-code-btn">复制代码</span></code></pre> 
 <p>解析：</p> 
 <p><strong>-f</strong>:跟踪容器日志的最近更新； <strong>-t</strong>:显示容器日志的时间戳；</p> 
 <p><strong>清除虚悬镜像：</strong></p> 
 <pre><code class="hljs bash copyable">docker image prune <span class="hljs-_">-a</span> <span class="hljs-_">-f</span>
<span class="copy-code-btn">复制代码</span></code></pre> 
 <p><strong>标记本地镜像，将其归入某一仓库</strong></p> 
 <pre><code class="hljs bash copyable">docker tag [options <span class="hljs-string">"o"</span>&gt;] &lt;image&gt;[:tag <span class="hljs-string">"o"</span>&gt;] [repository/ <span class="hljs-string">"o"</span>&gt;][username/]name <span class="hljs-string">"o"</span>&gt;[:tag]
<span class="copy-code-btn">复制代码</span></code></pre> 
 <p>解析：<strong>-f</strong> 覆盖已有标记。</p> 
 <p><strong>将镜像推送至远程仓库，默认为 Docker Hub</strong></p> 
 <pre><code class="hljs bash copyable">docker push name[:tag <span class="hljs-string">"o"</span>&gt;]
<span class="copy-code-btn">复制代码</span></code></pre> 
 <p>更多命令可以参考【<a href="https://link.juejin.im?target=https%3A%2F%2Fdocs.docker.com%2Fengine%2Freference%2Fbuilder%2F" rel="nofollow">这里</a>】</p> 
 <h5 class="heading">Docker操作（基于Dockerfile）</h5> 
 <p>在一个/usr/local/docker文件中写一个名为<strong>Dockerfile</strong>的文件</p> 
 <pre><code class="hljs bash copyable"><span class="hljs-comment">#pull down centos image</span>
FROM centos
MAINTAINER <span class="hljs-built_in">test</span>@test.com
<span class="hljs-comment">#copy jdk and tomcat into image</span>
ADD ./apache-tomcat-7.0.70.tar.gz /root
ADD ./jdk-7u80-linux-x64.tar.gz /root
<span class="hljs-comment">#set environment variable</span>
ENV JAVA_HOME /root/jdk1.7.0_80
ENV PATH <span class="hljs-variable">$JAVA_HOME</span>/bin:<span class="hljs-variable">$PATH</span>
<span class="hljs-comment">#define entry point which will be run first when the container starts up</span>
ENTRYPOINT /root/apache-tomcat-7.0.70/bin/startup.sh &amp;&amp; tail -F /root/apache-tomcat-7.0.70/logs/catalina.out
<span class="copy-code-btn">复制代码</span></code></pre> 
 <p>解析：总体看来就是按照Dockerfile的命令规则进行运行shell指令</p> 
 <p><strong>关键命令：</strong></p> 
 <p><strong>FROM</strong>： 指定基础镜像</p> 
 <p><strong>RUN</strong>： 执行命令</p> 
 <p><strong>COPY</strong>： &lt;源路径&gt;... &lt;目标路径&gt;</p> 
 <p><strong>ADD</strong>：跟COPY相似，如果源文件是tar包时，会自动解压。（一般用copy指令）</p> 
 <p><strong>CMD</strong>： 容器启动命令</p> 
 <p><strong>ENTRYPOINT</strong>： 入口点</p> 
 <p><strong>VOLUME</strong>： 定义匿名卷</p> 
 <p><strong>EXPOSE</strong>： 暴露端口</p> 
 <p><strong>WORKDIR</strong>： 指定工作目录</p> 
 <p><strong>USER</strong> ： 指定当前用户</p> 
 <p><strong>ENV</strong>： 设置环境变量</p> 
 <p><strong>编译构建：</strong></p> 
 <p>docker build [选项] &lt;上下文路径/URL/-&gt;</p> 
 <pre><code class="hljs bash copyable"><span class="hljs-comment">### 最后有一个点的，它表示上下文。</span>
docker build -t  app  .
<span class="copy-code-btn">复制代码</span></code></pre> 
 <p>看到 docker build 命令最后有一个 .。. 表示当前目录，而 Dockerfile 就在当前目录。</p> 
 <p><strong>-t app</strong> ：指定了最终镜像的名称为app</p> 
 <p><strong>参考文档</strong></p> 
 <ul><li><a href="https://link.juejin.im?target=https%3A%2F%2Fdocs.docker.com%2Fengine%2Freference%2Fbuilder%2F" rel="nofollow">Dockerfie 官方文档</a></li><li><a href="https://link.juejin.im?target=https%3A%2F%2Fdocs.docker.com%2Fengine%2Fuserguide%2Feng-image%2Fdockerfile_best-practices%2F" rel="nofollow">Dockerfile 最佳实践文档</a></li><li><a href="https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fdocker-library%2Fdocs" rel="nofollow">Docker 官方镜像 Dockerfile</a></li></ul> 
 <h5 class="heading">Docker操作（基于Compose）</h5> 
 <p>Docker Compose 将所管理的容器分为三层，</p> 
 <p><strong>工程（project）</strong> 由一组关联应用容器组成的一个完整的业务单元。</p> 
 <p><strong>服务（service）</strong> 一个应用的容器，实际上若干个运行着相同镜像的容器实例。</p> 
 <p><strong>容器（container）</strong> Compose就是通过命令对项目中的一组容器的生命周期进行便捷的管理。</p> 
 <p><strong>安装</strong>:</p> 
 <p>官网地址：<a href="https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fdocker%2Fcompose%2Freleases" rel="nofollow">github.com/docker/comp…</a></p> 
 <pre><code class="hljs bash copyable">$ sudo curl -L <span class="hljs-string">"https://github.com/docker/compose/releases/download/1.24.0/docker-compose-<span class="hljs-variable">$(uname -s)</span>-<span class="hljs-variable">$(uname -m)</span>"</span> -o /usr/<span class="hljs-built_in">local</span>/bin/docker-compose
$ sudo chmod +x /usr/<span class="hljs-built_in">local</span>/bin/docker-compose
$ sudo ln <span class="hljs-_">-s</span> /usr/<span class="hljs-built_in">local</span>/bin/docker-compose /usr/bin/docker-compose
$ docker-compose --version
<span class="copy-code-btn">复制代码</span></code></pre> 
 <p><strong>部署项目</strong></p> 
 <p>在/usr/local/docker目录下新建一个docker-compose.yml文件</p> 
 <pre><code class="hljs bash copyable">version: <span class="hljs-string">"3"</span>
services: 
    web:
      restart: always
      image: tomcat
      container_name: web
      ports:
        - 8080:8080
      volumes:
        - /usr/<span class="hljs-built_in">local</span>/docker/nblog/webapps:/usr/<span class="hljs-built_in">local</span>/tomcat/webapps

    mysql:
      restart: always
      image: mysql:5.7.25
      container_name: mysql
      ports:
        - 3306:3306
      environment:
        TZ: Asia/Shanghai
        MYSQL_ROOT_PASSWORD: root
      <span class="hljs-built_in">command</span>:
        --character-set-server=utf8mb4
        --collation-server=utf8mb4_general_ci
        --explicit_defaults_for_timestamp=<span class="hljs-literal">true</span>
        --lower_case_table_names=1
        --max_allowed_packet=128M
      volumes:
        - db_data:/var/lib/mysql
volumes:
    db_data:  
<span class="copy-code-btn">复制代码</span></code></pre> 
 <p><strong>docker-compose.yml常用参数解析：</strong></p> 
 <p><strong>restart</strong>：启动容器自自启动。</p> 
 <p><strong>image</strong>：镜像</p> 
 <p><strong>container_name</strong>：自定义容器名</p> 
 <p><strong>ports</strong>：端口，第一个是宿主机，第二个是docker中的端口</p> 
 <p><strong>volumes</strong>： 数据卷，就是<strong>宿主机的目录被docker共享</strong>。这里就是你将你的应用放到指定目录，它就会自动引用进docker容器中。</p> 
 <p><strong>environment</strong>：环境变量设置。</p> 
 <p><strong>更多配置</strong>：<a href="https://link.juejin.im?target=https%3A%2F%2Fdocs.docker.com%2Fcompose%2Fcompose-file%2F" rel="nofollow">docs.docker.com/compose/com…</a></p> 
 <p><strong>启动</strong></p> 
 <pre><code class="hljs bash copyable">$ docker-compose up <span class="hljs-_">-d</span>
<span class="copy-code-btn">复制代码</span></code></pre> 
 <p>-d:指后台运行 <strong>跟踪日志</strong></p> 
 <pre><code class="hljs bash copyable">$ docker-compose logs <span class="hljs-_">-f</span> tomcat 
<span class="copy-code-btn">复制代码</span></code></pre> 
 <p>**-f：**类似于tail -f</p> 
 <p><strong>卸载</strong></p> 
 <pre><code class="hljs bash copyable">$ docker-compose down
<span class="copy-code-btn">复制代码</span></code></pre> 
 <h5 class="heading">后续</h5> 
 <p><strong>Docker持续集成</strong></p> 
 <h5 class="heading">总结</h5> 
 <p>Docker与微服务更配哦。</p> 
 <p><strong>资源：</strong></p> 
 <p><a href="https://link.juejin.im?target=https%3A%2F%2Fdocs.docker.com%2Fget-started%2F" rel="nofollow">Docker官方文档</a></p> 
 <p><a href="https://link.juejin.im?target=https%3A%2F%2Fwww.docker.com%2Fproducts%2Fdocker-hub" rel="nofollow">DockerHub仓库</a></p> 
 <p><a href="https://link.juejin.im?target=https%3A%2F%2Fdocs.docker.com%2Fcompose%2F" rel="nofollow">DockerCompose</a></p> 
 <p><a href="https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fmritd%2Fdockerfile" rel="nofollow">一些常用的镜像</a></p> 
 <h5 class="heading">最后</h5> 
 <p>如果对 Java、大数据感兴趣请长按二维码关注一波，我会努力带给你们价值。觉得对你哪怕有一丁点帮助的请帮忙点个赞或者转发哦。</p> 
 <p></p> 
 <figure> 
  <figcaption></figcaption> 
 </figure> 
 <p></p> 
</div> 
<p>转载于:https://juejin.im/post/5cb1eaee5188257abb3521e7</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f99a3e12060b9e9268a9da1903ba7782/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">24点问题判断</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d6e637944905be61d4590c94cb7f6c5f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Tensorlow 中的常量值函数：tf.zeros()、tf.ones()、tf.fill()和tf.constant(）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>