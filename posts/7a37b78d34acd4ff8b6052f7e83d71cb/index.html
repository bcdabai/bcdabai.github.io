<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>系统总结整理（一） - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="系统总结整理（一）" />
<meta property="og:description" content="文章目录 @[TOC]一.网络1.七层模型2.数据封装过程3.每层对应的协议3.1 应用层3.2 常见的udp协议端口号3.3 传输层tcp udp3.4 网络层: arp icmp3.4.1 arp3.4.2 icmp 3.5 tcp与udp的不同 4.端口号的作用5.VRRP的工作原理 SNAT DNAT5.1 SNAT5.2 DNAT 6.网络架构7.服务架构7.1 接入层7.2 网关层7.3 业务服务层7.4 支撑服务层7.5 平台服务层7.6 基础设置层 8. 云服务的架构 二.系统命令总结1. 基本命令1.1 线上查询及帮助命令1.2 文件和目录操作命令1.3 查看文件及内容处理命令1.4 文件压缩及解压缩命令1.5 信息显示命令1.6 用户管理命令1.7 基础网络操作命令1.8 深入网络操作命令1.9 磁盘与文件系统的命令1.10 系统权限及用户授权相关命令1.11 系统用户登录信息的命令1.12 内置命令及其它1.13 系统管理与性能监视命令1.14 关机/重启/注销和查看系统信息的命令1.15 进程管理相关命令 2. 优化命令2.1 优化命令——mpstat2.1.1 mpstat的语法格式2.1.2 mpstat命令参数2.1.3 示例 2.2 优化命令——top2.3 优化命令——free2.4 优化命令——nload2.5 优化命令——iostat2.6 优化命令——cpuinfo2.7 优化命令——iotop2.8 优化命令——taskset2.9 优化命令——vmstat2.10 优化命令——uptime2.11 优化命令——nice2.12 优化命令——ulimit2.13 优化命令——time 三.网络服务总结1. ftp2. DHCP工作原理2.1 典型的C/S模式2.2 DHCP的分配方式2.3 DHCP工作原理 3." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/7a37b78d34acd4ff8b6052f7e83d71cb/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-06-17T22:04:24+08:00" />
<meta property="article:modified_time" content="2023-06-17T22:04:24+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">系统总结整理（一）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="TOC_0"></a> 
 <div class="toc"> 
  <h3>文章目录</h3> 
  <ul><li><a href="#TOC_0" rel="nofollow">@[TOC]</a></li><li><a href="#_1" rel="nofollow">一.网络</a></li><li><ul><li><a href="#1_3" rel="nofollow">1.七层模型</a></li><li><a href="#2_19" rel="nofollow">2.数据封装过程</a></li><li><a href="#3_28" rel="nofollow">3.每层对应的协议</a></li><li><ul><li><a href="#31__30" rel="nofollow">3.1 应用层</a></li><li><a href="#32_udp_44" rel="nofollow">3.2 常见的udp协议端口号</a></li><li><a href="#33_tcp_udp_54" rel="nofollow">3.3 传输层tcp udp</a></li><li><a href="#34__arp_icmp_65" rel="nofollow">3.4 网络层: arp icmp</a></li><li><ul><li><a href="#341_arp_67" rel="nofollow">3.4.1 arp</a></li><li><a href="#342_icmp_76" rel="nofollow">3.4.2 icmp</a></li></ul> 
     </li><li><a href="#35_tcpudp_89" rel="nofollow">3.5 tcp与udp的不同</a></li></ul> 
    </li><li><a href="#4_100" rel="nofollow">4.端口号的作用</a></li><li><a href="#5VRRP__SNAT_DNAT_108" rel="nofollow">5.VRRP的工作原理 SNAT DNAT</a></li><li><ul><li><a href="#51_SNAT_110" rel="nofollow">5.1 SNAT</a></li><li><a href="#52_DNAT_116" rel="nofollow">5.2 DNAT</a></li></ul> 
    </li><li><a href="#6_122" rel="nofollow">6.网络架构</a></li><li><a href="#7_140" rel="nofollow">7.服务架构</a></li><li><ul><li><a href="#71__142" rel="nofollow">7.1 接入层</a></li><li><a href="#72__146" rel="nofollow">7.2 网关层</a></li><li><a href="#73__156" rel="nofollow">7.3 业务服务层</a></li><li><a href="#74__162" rel="nofollow">7.4 支撑服务层</a></li><li><a href="#75__168" rel="nofollow">7.5 平台服务层</a></li><li><a href="#76__174" rel="nofollow">7.6 基础设置层</a></li></ul> 
    </li><li><a href="#8__181" rel="nofollow">8. 云服务的架构</a></li></ul> 
   </li><li><a href="#_189" rel="nofollow">二.系统命令总结</a></li><li><ul><li><a href="#1__191" rel="nofollow">1. 基本命令</a></li><li><ul><li><a href="#11__199" rel="nofollow">1.1 线上查询及帮助命令</a></li><li><a href="#12__205" rel="nofollow">1.2 文件和目录操作命令</a></li><li><a href="#13__243" rel="nofollow">1.3 查看文件及内容处理命令</a></li><li><a href="#14__287" rel="nofollow">1.4 文件压缩及解压缩命令</a></li><li><a href="#15__297" rel="nofollow">1.5 信息显示命令</a></li><li><a href="#16__331" rel="nofollow">1.6 用户管理命令</a></li><li><a href="#17__353" rel="nofollow">1.7 基础网络操作命令</a></li><li><a href="#18__377" rel="nofollow">1.8 深入网络操作命令</a></li><li><a href="#19__397" rel="nofollow">1.9 磁盘与文件系统的命令</a></li><li><a href="#110__431" rel="nofollow">1.10 系统权限及用户授权相关命令</a></li><li><a href="#111__441" rel="nofollow">1.11 系统用户登录信息的命令</a></li><li><a href="#112__457" rel="nofollow">1.12 内置命令及其它</a></li><li><a href="#113__497" rel="nofollow">1.13 系统管理与性能监视命令</a></li><li><a href="#114__517" rel="nofollow">1.14 关机/重启/注销和查看系统信息的命令</a></li><li><a href="#115__531" rel="nofollow">1.15 进程管理相关命令</a></li></ul> 
    </li><li><a href="#2__563" rel="nofollow">2. 优化命令</a></li><li><ul><li><a href="#21_mpstat_570" rel="nofollow">2.1 优化命令——mpstat</a></li><li><ul><li><a href="#211_mpstat_572" rel="nofollow">2.1.1 mpstat的语法格式</a></li><li><a href="#212_mpstat_578" rel="nofollow">2.1.2 mpstat命令参数</a></li><li><a href="#213__588" rel="nofollow">2.1.3 示例</a></li></ul> 
     </li><li><a href="#22_top_620" rel="nofollow">2.2 优化命令——top</a></li><li><a href="#23_free_630" rel="nofollow">2.3 优化命令——free</a></li><li><a href="#24_nload_645" rel="nofollow">2.4 优化命令——nload</a></li><li><a href="#25_iostat_656" rel="nofollow">2.5 优化命令——iostat</a></li><li><a href="#26_cpuinfo_670" rel="nofollow">2.6 优化命令——cpuinfo</a></li><li><a href="#27_iotop_686" rel="nofollow">2.7 优化命令——iotop</a></li><li><a href="#28_taskset_699" rel="nofollow">2.8 优化命令——taskset</a></li><li><a href="#29_vmstat_716" rel="nofollow">2.9 优化命令——vmstat</a></li><li><a href="#210_uptime_728" rel="nofollow">2.10 优化命令——uptime</a></li><li><a href="#211_nice_737" rel="nofollow">2.11 优化命令——nice</a></li><li><a href="#212_ulimit_759" rel="nofollow">2.12 优化命令——ulimit</a></li><li><a href="#213_time_773" rel="nofollow">2.13 优化命令——time</a></li></ul> 
   </li></ul> 
   </li><li><a href="#_779" rel="nofollow">三.网络服务总结</a></li><li><ul><li><a href="#1_ftp_781" rel="nofollow">1. ftp</a></li><li><a href="#2_DHCP_789" rel="nofollow">2. DHCP工作原理</a></li><li><ul><li><a href="#21_CS_791" rel="nofollow">2.1 典型的C/S模式</a></li><li><a href="#22_DHCP_801" rel="nofollow">2.2 DHCP的分配方式</a></li><li><a href="#23_DHCP_807" rel="nofollow">2.3 DHCP工作原理</a></li></ul> 
    </li><li><a href="#3_DNS_820" rel="nofollow">3. DNS域名解析</a></li><li><ul><li><a href="#31_DNS_822" rel="nofollow">3.1 DNS是什么？</a></li><li><a href="#32_TCPUDP_829" rel="nofollow">3.2 TCP与UDP作用</a></li><li><a href="#33__848" rel="nofollow">3.3 两种查询方式</a></li><li><a href="#34___858" rel="nofollow">3.4 域名代理/注册/购买服务商</a></li><li><a href="#35_ssh_892" rel="nofollow">3.5 ssh</a></li><li><ul><li><a href="#351___894" rel="nofollow">3.5.1 根据安全策略进行调优</a></li><li><a href="#352__911" rel="nofollow">3.5.2 根据安全中的漏洞进行升级</a></li><li><a href="#353__fail2ban_915" rel="nofollow">3.5.3 fail2ban</a></li></ul> 
    </li></ul> 
    </li><li><a href="#4__NFS_924" rel="nofollow">4. NFS共享存储</a></li><li><a href="#5_PXE_940" rel="nofollow">5. PXE高效批量网络装机</a></li><li><ul><li><a href="#51__PXE_942" rel="nofollow">5.1 PXE含义</a></li><li><a href="#52__PXE_951" rel="nofollow">5.2 PXE优点</a></li><li><a href="#53_PXE_957" rel="nofollow">5.3 PXE特点</a></li><li><a href="#PXE_968" rel="nofollow">５.４PXE服务的构建过程</a></li><li><ul><li><a href="#PXE_970" rel="nofollow">５.４.１PXE服务器和客户机的工作过程：</a></li><li><a href="#_PXE__980" rel="nofollow">５.４.２搭建 PXE 远程安装服务器</a></li></ul> 
    </li></ul> 
   </li></ul> 
   </li><li><a href="#shell_1004" rel="nofollow">四．shell脚本总结</a></li><li><ul><li><a href="#_1006" rel="nofollow">１．编写脚本的思路</a></li><li><a href="#_1013" rel="nofollow">２．生产案列</a></li><li><ul><li><a href="#_awk__httpd__IP__1015" rel="nofollow">２．１使用 awk 统计 httpd 访问日志中每个客户端 IP 的出现次数?</a></li><li><a href="#_3__1024" rel="nofollow">２．２连续输入错误密码 3 次,则报警</a></li><li><a href="#_1042" rel="nofollow">２．３监控磁盘情况，异常发邮件</a></li><li><a href="#_ip_3_1057" rel="nofollow">２．４ ip 登录失败超过3进行告警</a></li><li><a href="#shellssh_1072" rel="nofollow">２．５通过shell脚本来防止暴力破解ssh</a></li><li><a href="#shell_1095" rel="nofollow">２．６shell一般用在哪里</a></li></ul> 
    </li><li><a href="#Linuxgrepsedawk_1111" rel="nofollow">３.Linux文本三剑客（grep、sed、awk）</a></li><li><ul><li><a href="#grep_1113" rel="nofollow">３．１grep</a></li><li><a href="#sed_1129" rel="nofollow">３.２sed</a></li><li><a href="#awk_1139" rel="nofollow">３.３awk</a></li></ul> 
   </li></ul> 
   </li><li><a href="#_1151" rel="nofollow">五．安全总结</a></li><li><ul><li><a href="#_iptables_1153" rel="nofollow">１． iptables</a></li><li><ul><li><a href="#_1155" rel="nofollow">１．１**四表五链**</a></li><li><a href="#_1162" rel="nofollow">１．２**四表**</a></li><li><a href="#__1169" rel="nofollow">１．３ 规则链之间的匹配顺序</a></li><li><a href="#_1179" rel="nofollow">１.４规则链内的匹配顺序</a></li><li><a href="#_1190" rel="nofollow">１.５数据包在规则表、链间的匹配流程</a></li><li><a href="#iptables__1199" rel="nofollow">１.６iptables 基本语法、数据包控制类型</a></li><li><a href="#_iptables__1215" rel="nofollow">１.７ iptables 命令的常用管理选项</a></li><li><a href="#SNATDNAT_1237" rel="nofollow">１.８SNAT、DNAT策略及应用</a></li><li><ul><li><a href="#SNAT_1239" rel="nofollow">１.８.１SNAT策略</a></li><li><a href="#DNAT_1245" rel="nofollow">１.８.２DNAT策略</a></li></ul> 
    </li></ul> 
    </li><li><a href="#firewalld_1253" rel="nofollow">２.firewalld</a></li><li><ul><li><a href="#firewalld_1255" rel="nofollow">２.１firewalld概述</a></li><li><a href="#firewalld9_1280" rel="nofollow">２.２firewalld防火墙预定义了9个区域:</a></li><li><a href="#_firewalld_1293" rel="nofollow">２.３ firewalld数据处理流程</a></li><li><a href="#firewalld9_1313" rel="nofollow">２.２firewalld防火墙预定义了9个区域:</a></li><li><a href="#_firewalld_1326" rel="nofollow">２.３ firewalld数据处理流程</a></li></ul> 
   </li></ul> 
  </li></ul> 
 </div></h2> 
<h2><a id="_1"></a>一.网络</h2> 
<h3><a id="1_3"></a>1.七层模型</h3> 
<p>应用层：网络服务与最终用户的一个接口</p> 
<p>表示层：数据的表示、压缩、安全——高级转换二进制</p> 
<p>会话层：建立、管理、终止会话——管理不同应用程序的通过</p> 
<p>传输层：选择传输协议（tcp稳定，速度慢，udp不太稳定，速度快）—— 防火墙</p> 
<p>网络层：进行逻辑地址寻找，实现不同网络之间的路径选择（IP地址）——路由表（通过网关找）</p> 
<p>数据链路层：mac网卡地址再次确认数据传输的地址是否正确，数据校验确认数据是否有丢失 ——交换机</p> 
<p>物理层：bit流 ——到达网卡、网口</p> 
<h3><a id="2_19"></a>2.数据封装过程</h3> 
<table><thead><tr><th>模型层</th><th>上层数据</th><th>增加项</th><th>数据特征</th><th>设备</th></tr></thead><tbody><tr><td>传输层</td><td>接收上层数据</td><td>加入tcp或udp头部</td><td>数据段</td><td>防火墙</td></tr><tr><td>网络层</td><td>接收上层数据</td><td>加入源目ip地址</td><td>数据包</td><td>路由器</td></tr><tr><td>数据链路层</td><td>接收上层数据</td><td>加入源目mac地址</td><td>数据帧</td><td>交换机</td></tr><tr><td>物理层</td><td>接收上层数据转为</td><td>bit流</td><td>bit</td><td>网卡</td></tr></tbody></table> 
<h3><a id="3_28"></a>3.每层对应的协议</h3> 
<h4><a id="31__30"></a>3.1 应用层</h4> 
<table><thead><tr><th align="center">协议</th><th align="center">端口</th><th align="center">对应协议</th><th align="center">注释</th></tr></thead><tbody><tr><td align="center">ftp</td><td align="center">20、21</td><td align="center">tcp</td><td align="center">文本传输协议（FTP）端口</td></tr><tr><td align="center">ssh</td><td align="center">22</td><td align="center">shell（SSH）协议加密</td><td align="center">安全 Shell（SSH）服务</td></tr><tr><td align="center">telnet</td><td align="center">23</td><td align="center">Telnet 协议不加密</td><td align="center">Telnet 服务</td></tr><tr><td align="center">smtp</td><td align="center">25</td><td align="center">简单邮件传输协议</td><td align="center">smtp–简单邮件传输协议（SMTP）</td></tr><tr><td align="center">dns</td><td align="center">53</td><td align="center">tcp udp</td><td align="center">dns–域名服务</td></tr><tr><td align="center">http</td><td align="center">80</td><td align="center">tcp</td><td align="center">超文本传输协议</td></tr><tr><td align="center">pop3</td><td align="center">110</td><td align="center">邮局协议</td><td align="center">邮件协议版本</td></tr><tr><td align="center">https</td><td align="center">443</td><td align="center">文本传输安全协议</td><td align="center">安全超文本传输协议</td></tr><tr><td align="center">mysql</td><td align="center">3306</td><td align="center">MySQL 协议</td><td align="center">mysql数据库</td></tr></tbody></table> 
<h4><a id="32_udp_44"></a>3.2 常见的udp协议端口号</h4> 
<table><thead><tr><th align="center">协议</th><th align="center">端口号</th><th align="center">注释</th></tr></thead><tbody><tr><td align="center">NTP</td><td align="center">123</td><td align="center">网络时间协议</td></tr><tr><td align="center">DHCP</td><td align="center">67</td><td align="center">动态主机配置协议</td></tr><tr><td align="center">SNMP</td><td align="center">161</td><td align="center">简单网络管理协议</td></tr><tr><td align="center">TFTP</td><td align="center">69</td><td align="center">简单文件传输协议</td></tr><tr><td align="center">RPC</td><td align="center">111</td><td align="center">远程调用协议</td></tr></tbody></table> 
<h4><a id="33_tcp_udp_54"></a>3.3 传输层tcp udp</h4> 
<p>控制位：</p> 
<p>URG:紧急位。紧急指针有效位。<br> ACK: 确认位。只有当ACK=1时，确认序列号字段才有效:当ACK=0时，确认号字段无效。<br> PSH:急迫位。标志位为1时，要求接收方尽快将数据段送达应用层。<br> RST:重置位。当RST值为1时，通知重新建立TCP连接。<br> SYN: 同步(连接)位。同步序号位，TCP需要建立连接时将这个值设为1。<br> FIN: 断开位。当TCP完成数据传输需要断开连接时，提出断开连接的一方将这个值设为1.</p> 
<h4><a id="34__arp_icmp_65"></a>3.4 网络层: arp icmp</h4> 
<h5><a id="341_arp_67"></a>3.4.1 arp</h5> 
<p>地址解析协议</p> 
<p>功能</p> 
<ul><li>将IP地址转换为ｍａｃ地址</li><li>检测ｉｐ地址冲突</li></ul> 
<h5><a id="342_icmp_76"></a>3.4.2 icmp</h5> 
<p>作用：检测网络的双向连通性</p> 
<p>ping命令</p> 
<ul><li>ping IP地址 -w 2 ——等待超时时间</li><li>ping ip地址 -n 数字——指定ping几个包</li></ul> 
<p>tracert作用：经过多少台设备，选路、排错</p> 
<ul><li>用法：tracert＋网址</li></ul> 
<h4><a id="35_tcpudp_89"></a>3.5 tcp与udp的不同</h4> 
<p>UDP和TCP协议的主要区别是两者在如何实现信息的可靠传递方面不同：</p> 
<p>（1）TCP 是面向连接的传输控制协议；而UDP 提供了无连接的数据报服务。<br> （2）TCP 具有高可靠性，确保传输数据的正确性，不出现丢失或乱序；UDP 在传输数据前不建立连接，不对数据报进行检查与修改，无须等待对方的应答，所以会出现分组丢失、重复、乱序，应用程序需要负责传输可靠性方面的所有工作。<br> （3）UDP 具有较好的实时性，工作效率较 TCP 协议高。UDP 段结构比 TCP 的段结构简单，因此网络开销也小。<br> （4）TCP 协议可以保证接收端毫无差错地接收到发送端发出的字节流，为应用程序提供可靠的通信服务。对可靠性要求高的通信系统往往使用 TCP 传输数据。</p> 
<p>（5）TCP 协议传输更加稳定可靠，UDP 协议传输效率更高。这两个协议各有特点，在实际应用 中，根据实际应用的需要，选择不同的传输层协议</p> 
<h3><a id="4_100"></a>4.端口号的作用</h3> 
<p>① 区别系统内的进程<br> ② 服务端 端口号 固定<br> ③ 客户端随机<br> ④ 前1000左右不能使用<br> ⑤ 65536个端口号 0-655535</p> 
<h3><a id="5VRRP__SNAT_DNAT_108"></a>5.VRRP的工作原理 SNAT DNAT</h3> 
<h4><a id="51_SNAT_110"></a>5.1 SNAT</h4> 
<p>源地址转换（将内网地址转换为指定的IP地址，这个地址可以访问公网</p> 
<p>源地址变化：内网——外网</p> 
<h4><a id="52_DNAT_116"></a>5.2 DNAT</h4> 
<p>目的地址转换（使公网地址可以和私网地址通信，将外网地址转换为内网可以访问的内网地址，相互通信</p> 
<p>目标地址变化：外网——内网</p> 
<h3><a id="6_122"></a>6.网络架构</h3> 
<p>① 核心层：核心层是网络主干部分，是整个网络性能的保障，其设备包括路由器、防火墙、核心层交换机等等，相当于公司架构里的管理高层。<br> 核心层一直被认为是所有流量的最终承受者和汇聚者，所以对核心层的设计以及网络设备的要求十分严格，它的功能主要是实现骨干网络之间的优化传输，骨干层设计任务的重点通常是冗余能力、可靠性和高速的传输。因此，核心层设备采用双机冗余热备份是非常必要的，也可以使用负载均衡功能，来改善网络性能。网络的控制功能最好尽量少在骨干层上实施。</p> 
<p>② 汇聚层：汇聚层也被称为分布层，它是网络接入层和核心层的“中介”，相当于公司的中层管理，用来连接核心层和接入层，处于中间位置，它在工作站接入核心层前先做汇聚，以减轻核心层设备的负荷。<br> 不难理解，汇聚层也就汇聚层具有实施策略、安全、工作组接入、虚拟局域网（VLAN）之间的路由、源地址或目的地址过滤等多种功能。在汇聚层中，应该采用支持三层交换技术和VLAN的交换机，以达到网络隔离和分段的目的。</p> 
<p>③ 接入层：通常将网络中直接面向用户连接或访问网络的部分称为接入层，也就相当于公司架构里的基层员工，因此接入层交换机具有低成本和高端口密度特性。</p> 
<p>接入层为用户提供了在本地网段访问应用系统的能力，主要解决相邻用户之间的互访需求，并且为这些访问提供足够的带宽，接入层还应当适当负责一些用户管理功能（如地址认证、用户认证等），以及用户信息收集工作（如IP地址、MAC地址、访问日志等）</p> 
<table><thead><tr><th>项目</th><th>网络设计分层</th><th>连接对象</th><th>性能要求</th><th>目的</th><th>路由功能</th></tr></thead><tbody><tr><td>核心层交换机</td><td>三级</td><td>三层以上交换设备</td><td>最高</td><td>路由和高速转发</td><td>支持</td></tr><tr><td>汇聚层交换机</td><td>二层/三层</td><td>交换机和路由器</td><td>中等</td><td>提供策略连接</td><td>支持</td></tr><tr><td>接入层交换机</td><td>二层</td><td>电脑</td><td>最低</td><td>终端接入</td><td>支持</td></tr></tbody></table> 
<h3><a id="7_140"></a>7.服务架构</h3> 
<h4><a id="71__142"></a>7.1 接入层</h4> 
<p>最外层是接入层，通过负载均衡接入请求到内部平台，这些请求既有外部互联网请求，也有公司内部其它系统的请求。</p> 
<h4><a id="72__146"></a>7.2 网关层</h4> 
<p>网关层是微服务架构的核心层，是业务层接收外部流量的屏障。</p> 
<p>网关层的主要作用：</p> 
<p>对接入的流量进行反向路由。<br> 拦截所有的请求，通过横切的方式完成熔断、限流、安全认证等功能。<br> 对请求进行分类，例如内部网关、H5网关、图片网关。</p> 
<h4><a id="73__156"></a>7.3 业务服务层</h4> 
<p>我们常说的微服务就集中在这一层，这里包含了系统核心的业务逻辑。业务服务层可以简单的划分为聚合层与基础层。</p> 
<p>基础层提供单一简单的基础服务，例如人员、订单、支付。聚合层则是将不同的基础层聚合在一起，完成复杂的业务处理。</p> 
<h4><a id="74__162"></a>7.4 支撑服务层</h4> 
<p>支撑服务层提供非业务功能，以支撑业务服务层和网关层软件的正常运行。</p> 
<p>核心模块有服务注册发现、集中配置、容错限流、认证授权、日志聚合、监控告警、后台中间件（异步队列、缓存、数据库、任务调度）</p> 
<h4><a id="75__168"></a>7.5 平台服务层</h4> 
<p>平台服务层站在系统平台的角度上，处理系统发布、资源调度整合等功能。</p> 
<p>核心模块有发布系统、资源调度、容器镜像治理、资源治理、IAM。</p> 
<h4><a id="76__174"></a>7.6 基础设置层</h4> 
<p>这一层与软件关系不大，主要是支撑系统需要的硬件资源，包括计算、网络、存储、监控、安全、IDC等。</p> 
<p>总：<br> 微服务架构涉及功能模块众多，并不是每一个公司都有能力搭建一套完整的微服务架构。当我们从零开始搭建微服务架构时，可以优先考虑网关层、业务服务层以及支撑服务层中的注册发现、集中配置、认证授权这些核心功能，其它的功能模块再逐步完善。另外我们也可以选用已经比较成熟的架构来快速搭建微服务，例如SpringCloud。最后大家可以结合文章的架构图思考一下，自己公司目前的微服务架构，已经具备了图中的哪些功能，还有哪些功能是可以进一步完善或者新增的。</p> 
<h3><a id="8__181"></a>8. 云服务的架构</h3> 
<p>VPC<br> 云资源接入区：天翼云路由器（含二层网关）、防火墙（业务、IT ） 天翼云的ELB（业务、IT））<br> DMZ区域 ：nginx1 nginx2（业务） nginx1 nginx2 （IT）<br> APP区域 ：业务平台、注册中心、网关（traefik） 还有其他平台门户 能力放开平台(IT) 能力中心(IT)<br> PAAS区域： TELDB CTGMQ CTGCACAHE CTDFS 等</p> 
<h2><a id="_189"></a>二.系统命令总结</h2> 
<h3><a id="1__191"></a>1. 基本命令</h3> 
<p>根据命令手册或命令的详解</p> 
<p>https://editor.csdn.net/md/?articleId=130405002</p> 
<p>https://editor.csdn.net/md/?articleId=130432529</p> 
<h4><a id="11__199"></a>1.1 线上查询及帮助命令</h4> 
<p>man：查看命令帮助，更复杂的还有info，但不常用。</p> 
<p>help：查看Linux内置命令的帮助，比如cd命令</p> 
<h4><a id="12__205"></a>1.2 文件和目录操作命令</h4> 
<p>ls：全拼list，功能是列出目录的内容及其内容属性信息。</p> 
<p>cd：全拼change directory，功能是从当前工作目录切换到指定的工作目录。</p> 
<p>cp：全拼copy，其功能为复制文件或目录。</p> 
<p>find：查找的意思，用于查找目录及目录下的文件。</p> 
<p>mkdir：全拼make directories，其功能是创建目录。</p> 
<p>mv：全拼move，其功能是移动或重命名文件。</p> 
<p>pwd：全拼print working directory，其功能是显示当前工作目录的绝对路径。</p> 
<p>rename：用于重命名文件。</p> 
<p>rm：全拼remove，其功能是删除一个或多个文件或目录。</p> 
<p>rmdir：全拼remove empty directories，功能是删除空目录。</p> 
<p>touch：创建新的空文件，改变已有文件的时间戳属性。</p> 
<p>tree：功能是以树形结构显示目录下的内容。</p> 
<p>basename：显示文件名或目录名。</p> 
<p>dirname：显示文件或目录路径。</p> 
<p>chattr：改变文件的扩展属性。</p> 
<p>lsattr：查看文件扩展属性。</p> 
<p>file：显示文件的类型。</p> 
<p>md5sum：计算和校验文件的MD5值。</p> 
<h4><a id="13__243"></a>1.3 查看文件及内容处理命令</h4> 
<p>cat：全拼concatenate，功能是用于连接多个文件并且打印到屏幕输出或重定向到指定文件中。</p> 
<p>tac：是cat的反向拼写，因此命令的功能为反向显示文件内容。</p> 
<p>more：分页显示文件内容。</p> 
<p>less：分页显示文件内容，more命令的相反用法。</p> 
<p>head：显示文件内容的头部。</p> 
<p>tail：显示文件内容的尾部。</p> 
<p>cut：将文件的每一行按指定分隔符分割并输出。</p> 
<p>split：分割文件为不同的小片段。</p> 
<p>paste：按行合并文件内容。</p> 
<p>sort：对文件的文本内容排序。</p> 
<p>uniq：去除重复行。</p> 
<p>wc：统计文件的行数、单词数或字节数。</p> 
<p>iconv：转换文件的编码格式。</p> 
<p>dos2unix：将DOS格式文件转换成UNIX格式。</p> 
<p>diff：全拼difference，比较文件的差异，常用于文本文件。</p> 
<p>vimdiff：命令行可视化文件比较工具，常用于文本文件。</p> 
<p>rev：反向输出文件内容。</p> 
<p>grep/egrep：过滤字符串，三剑客老三。</p> 
<p>join：按两个文件的相同字段合并。</p> 
<p>tr：替换或删除字符。</p> 
<p>vi/vim：命令行文本编辑器。</p> 
<h4><a id="14__287"></a>1.4 文件压缩及解压缩命令</h4> 
<p>tar：打包压缩。</p> 
<p>unzip：解压文件。</p> 
<p>gzip：压缩工具。</p> 
<p>zip：压缩工具。</p> 
<h4><a id="15__297"></a>1.5 信息显示命令</h4> 
<p>uname：显示操作系统相关信息的命令。</p> 
<p>hostname：显示或者设置当前系统的主机名。</p> 
<p>dmesg：显示开机信息，用于诊断系统故障。</p> 
<p>uptime：显示系统运行时间及负载。</p> 
<p>stat：显示文件或文件系统的状态。</p> 
<p>du：计算磁盘空间使用情况。</p> 
<p>df：报告文件系统磁盘空间的使用情况。</p> 
<p>top：实时显示系统资源使用情况。</p> 
<p>free：查看系统内存。</p> 
<p>date：显示与设置系统时间。</p> 
<p>cal：查看日历等时间信息。</p> 
<p>搜索文件命令</p> 
<p>which：查找二进制命令，按环境变量PATH路径查找。</p> 
<p>find：从磁盘遍历查找文件或目录。</p> 
<p>whereis：查找二进制命令，按环境变量PATH路径查找。</p> 
<p>locate：从数据库 (/var/lib/mlocate/mlocate.db) 查找命令，使用updatedb更新库。</p> 
<h4><a id="16__331"></a>1.6 用户管理命令</h4> 
<p>useradd：添加用户。</p> 
<p>usermod：修改系统已经存在的用户属性。</p> 
<p>userdel：删除用户。</p> 
<p>groupadd：添加用户组。</p> 
<p>passwd：修改用户密码。</p> 
<p>chage：修改用户密码有效期限。</p> 
<p>id：查看用户的uid,gid及归属的用户组。</p> 
<p>su：切换用户身份。</p> 
<p>visudo：编辑/etc/sudoers文件的专属命令。</p> 
<p>sudo：以另外一个用户身份(默认root用户)执行事先在sudoers文件允许的命令。</p> 
<h4><a id="17__353"></a>1.7 基础网络操作命令</h4> 
<p>telnet：使用TELNET协议远程登录。</p> 
<p>ssh：使用SSH加密协议远程登录。</p> 
<p>scp：全拼secure copy，用于不同主机之间复制文件。</p> 
<p>wget：命令行下载文件。</p> 
<p>ping：测试主机之间网络的连通性。</p> 
<p>route：显示和设置linux系统的路由表。</p> 
<p>ifconfig：查看、配置、启用或禁用网络接口的命令。</p> 
<p>ifup：启动网卡。</p> 
<p>ifdown：关闭网卡。</p> 
<p>netstat：查看网络状态。</p> 
<p>ss：查看网络状态。</p> 
<h4><a id="18__377"></a>1.8 深入网络操作命令</h4> 
<p>nmap：网络扫描命令。</p> 
<p>lsof：全名list open files，也就是列举系统中已经被打开的文件。</p> 
<p>mail：发送和接收邮件。</p> 
<p>mutt：邮件管理命令。</p> 
<p>nslookup：交互式查询互联网DNS服务器的命令。</p> 
<p>dig：查找DNS解析过程。</p> 
<p>host：查询DNS的命令。</p> 
<p>traceroute：追踪数据传输路由状况。</p> 
<p>tcpdump：命令行的抓包工具。</p> 
<h4><a id="19__397"></a>1.9 磁盘与文件系统的命令</h4> 
<p>mount：挂载文件系统。</p> 
<p>umount：卸载文件系统。</p> 
<p>fsck：检查并修复Linux文件系统。</p> 
<p>dd：转换或复制文件。</p> 
<p>dumpe2fs：导出ext2/ext3/ext4文件系统信息。</p> 
<p>dumpe：xt2/3/4文件系统备份工具。</p> 
<p>fdisk：磁盘分区命令，适用于2TB以下磁盘分区。</p> 
<p>parted：磁盘分区命令，没有磁盘大小限制，常用于2TB以下磁盘分区。</p> 
<p>mkfs：格式化创建Linux文件系统。</p> 
<p>partprobe：更新内核的硬盘分区表信息。</p> 
<p>e2fsck：检查ext2/ext3/ext4类型文件系统。</p> 
<p>mkswap：创建Linux交换分区。</p> 
<p>swapon：启用交换分区。</p> 
<p>swapoff：关闭交换分区。</p> 
<p>sync：将内存缓冲区内的数据写入磁盘。</p> 
<p>resize2fs：调整ext2/ext3/ext4文件系统大小。</p> 
<h4><a id="110__431"></a>1.10 系统权限及用户授权相关命令</h4> 
<p>chmod：改变文件或目录权限。</p> 
<p>chown：改变文件或目录的属主和属组。</p> 
<p>chgrp：更改文件用户组。</p> 
<p>umask：显示或设置权限掩码。</p> 
<h4><a id="111__441"></a>1.11 系统用户登录信息的命令</h4> 
<p>whoami：显示当前有效的用户名称，相当于执行id -un命令。</p> 
<p>who：显示目前登录系统的用户信息。</p> 
<p>w：显示已经登录系统的用户列表，并显示用户正在执行的指令。</p> 
<p>last：显示登入系统的用户。</p> 
<p>lastlog：显示系统中所有用户最近一次登录信息。</p> 
<p>users：显示当前登录系统的所有用户的用户列表。</p> 
<p>finger：查找并显示用户信息。</p> 
<h4><a id="112__457"></a>1.12 内置命令及其它</h4> 
<p>echo：打印变量，或直接输出指定的字符串</p> 
<p>printf：将结果格式化输出到标准输出。</p> 
<p>rpm：管理rpm包的命令。</p> 
<p>yum：自动化简单化地管理rpm包的命令。</p> 
<p>watch：周期性的执行给定的命令，并将命令的输出以全屏方式显示。</p> 
<p>alias：设置系统别名。</p> 
<p>unalias：取消系统别名。</p> 
<p>date：查看或设置系统时间。</p> 
<p>clear：清除屏幕，简称清屏。</p> 
<p>history：查看命令执行的历史记录。</p> 
<p>eject：弹出光驱。</p> 
<p>time：计算命令执行时间。</p> 
<p>nc：功能强大的网络工具。</p> 
<p>xargs：将标准输入转换成命令行参数。</p> 
<p>exec：调用并执行指令的命令。</p> 
<p>export：设置或者显示环境变量。</p> 
<p>unset：删除变量或函数。</p> 
<p>type：用于判断另外一个命令是否是内置命令。</p> 
<p>bc：命令行科学计算器。</p> 
<h4><a id="113__497"></a>1.13 系统管理与性能监视命令</h4> 
<p>chkconfig：管理Linux系统开机启动项。</p> 
<p>vmstat：虚拟内存统计。</p> 
<p>mpstat：显示各个可用CPU的状态统计。</p> 
<p>iostat：统计系统IO。</p> 
<p>sar：全面地获取系统的CPU、运行队列、磁盘 I/O、分页(交换区)、内存、 CPU中断和网络等性能数据。</p> 
<p>ipcs：用于报告Linux中进程间通信设施的状态，显示的信息包括消息列表、共享内存和信号量的信息。</p> 
<p>ipcrm：用来删除一个或更多的消息队列、信号量集或者共享内存标识。</p> 
<p>strace：用于诊断、调试Linux用户空间跟踪器。我们用它来监控用户空间进程和内核的交互，比如系统调用、信号传递、进程状态变更等。</p> 
<p>ltrace：命令会跟踪进程的库函数调用,它会显现出哪个库函数被调用。</p> 
<h4><a id="114__517"></a>1.14 关机/重启/注销和查看系统信息的命令</h4> 
<p>shutdown：关机。</p> 
<p>halt：关机。</p> 
<p>poweroff：关闭电源。</p> 
<p>logout：退出当前登录的Shell。</p> 
<p>exit：退出当前登录的Shell。</p> 
<p>Ctrl+d：退出当前登录的Shell的快捷键。</p> 
<h4><a id="115__531"></a>1.15 进程管理相关命令</h4> 
<p>bg：将一个在后台暂停的命令，变成继续执行 (在后台执行)。</p> 
<p>fg：将后台中的命令调至前台继续运行。</p> 
<p>jobs：查看当前有多少在后台运行的命令。</p> 
<p>kill：终止进程。</p> 
<p>killall：通过进程名终止进程。</p> 
<p>pkill：通过进程名终止进程。</p> 
<p>crontab：定时任务命令。</p> 
<p>ps：显示进程的快照。</p> 
<p>pstree：树形显示进程。</p> 
<p>nice/Denice：调整程序运行的优先级。</p> 
<p>nohup：忽略挂起信号运行指定的命令。</p> 
<p>pgrep：查找匹配条件的进程。</p> 
<p>runlevel：查看系统当前运行级别。</p> 
<p>init：切换运行级别。</p> 
<p>service：启动、停止、重新启动和关闭系统服务，还可以显示所有系统服务的当前状态</p> 
<h3><a id="2__563"></a>2. 优化命令</h3> 
<p>对系统会怎么优化（五大负载）——（查看进程，占比大的进程是否可以优化）：vmstat、 sar 、iostat、 top<br> 负载优化：top 、uptime 、w<br> sar -u 1 3：查看cpu的使用情况，间隔1s，监测3次<br> –u:输出cpu使用情况和统计信息</p> 
<h4><a id="21_mpstat_570"></a>2.1 优化命令——mpstat</h4> 
<h5><a id="211_mpstat_572"></a>2.1.1 mpstat的语法格式</h5> 
<p>mpstat的语法：</p> 
<p>mpstat [-p {ALL}] [internal [count]]</p> 
<h5><a id="212_mpstat_578"></a>2.1.2 mpstat命令参数</h5> 
<p>参数解释</p> 
<p>-p :指定要监控哪个CPU ，范围是 [0~n-1] ，ALL表示监控所有CPU都监控</p> 
<p>nternal : 相邻两次采样的间隔时间</p> 
<p>count :采样的次数</p> 
<h5><a id="213__588"></a>2.1.3 示例</h5> 
<pre><code>mpstat -P ALL 3 2 
</code></pre> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-PUQ1i8PW-1687010246630)(C:\Users\zhao\AppData\Roaming\Typora\typora-user-images\image-20230615191317047.png)]</p> 
<pre><code>mpstat
</code></pre> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-yvUAk1Oa-1687010246631)(C:\Users\zhao\AppData\Roaming\Typora\typora-user-images\image-20230615191503291.png)]</p> 
<p>mpstat命令的各列含义</p> 
<p>显示各列的含义</p> 
<table><thead><tr><th>显示参数</th><th>描述</th></tr></thead><tbody><tr><td>CPU</td><td>显示的是某个CPU 还是全部CPU all=全部</td></tr><tr><td>%usr</td><td>表示用户所有使用的CPU百分比</td></tr><tr><td>%nice</td><td>表示使用 nice 值的 CPU 的百分比。</td></tr><tr><td>%sys</td><td>表示内核进程使用的 CPU 百分比。</td></tr><tr><td>%iowait</td><td>表示等待进行 I/O 所使用的 CPU 时间百分比。</td></tr><tr><td>%irq</td><td>表示用于处理系统中断的CPU百分比</td></tr><tr><td>%soft</td><td>表示用于软件中断的CPU百分比</td></tr><tr><td>%steal</td><td>虚拟机占用CPU时间的百分比</td></tr><tr><td>%guest</td><td>虚拟机占用CPU时间的百分比</td></tr><tr><td>%gnice</td><td>CPU运行niced guest虚拟机所花费的时间百分比</td></tr><tr><td>%idle</td><td>CPU的空闲时间的百分比</td></tr></tbody></table> 
<h4><a id="22_top_620"></a>2.2 优化命令——top</h4> 
<p>top 命令，按下大写的 P，可以按 CPU 使用率来排序显示</p> 
<p>可以查看出所有服务</p> 
<p>特点：实时会动态更新</p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-J51lGQQI-1687010246633)(C:\Users\zhao\AppData\Roaming\Typora\typora-user-images\image-20230615192555354.png)]</p> 
<h4><a id="23_free_630"></a>2.3 优化命令——free</h4> 
<p><code>free</code> 命令的输出中，除了总内存大小以外，都是对系统当前内存使用情况的实时报告。</p> 
<p>用于实时显示系统的内存使用情况。其输出结果包含以下几列信息：</p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-LRgy01hk-1687010246634)(C:\Users\zhao\AppData\Roaming\Typora\typora-user-images\image-20230615193635806.png)]</p> 
<ul><li><code>total</code>：系统可用的总内存大小；</li><li><code>used</code>：已使用内存大小；</li><li><code>free</code>：剩余可用内存大小；</li><li><code>shared</code>：被共享使用的内存大小；</li><li><code>buff/cache</code>：缓存的内存大小（即缓存和缓冲区占用的内存大小）；</li><li><code>available</code>：当前可用的内存大小。</li></ul> 
<h4><a id="24_nload_645"></a>2.4 优化命令——nload</h4> 
<p><code>nload</code> 是一款基于命令行的网络流量监测工具，可用于实时监测系统网络接口的流量和吞吐量，并以图形化方式展示数据。<code>nload</code> 提供了以下信息：</p> 
<ul><li>定义了网络流量的单位；</li><li>显示进出网络流量、总上传和下载速率及其峰值；</li><li>显示包/分的统计信息；</li><li>显示协议（TCP/IP）的统计信息。</li></ul> 
<p><code>nload</code> 可以在多种系统（如 Linux、macOS 和 BSD）中使用，并且可以方便地集成到 shell 脚本中，用于监控系统网络连接并实时获取相关数据。在进行网络优化、性能测试或开发任务时，<code>nload</code> 提供了一个便捷的方式来实时监测网络流量，从而更加方便的了解网络状况并掌握网络流量的情况。需要注意的是，<code>nload</code> 要求管理员以 root 用户或具有相应权限的用户身份运行。</p> 
<h4><a id="25_iostat_656"></a>2.5 优化命令——iostat</h4> 
<p><code>iostat</code> 是一款用于监控 CPU、磁盘、网络设备等的系统负载的 Linux 命令行工具。它可以提供实时的 CPU 使用率、磁盘 I/O 状况、网络使用情况、以及系统运行状态的报告。</p> 
<p><code>iostat</code> 的输出包括以下几项用于评估系统负载和磁盘 I/O 性能的指标：</p> 
<ul><li><code>CPU</code>：CPU 使用率及其分解情况；</li><li><code>Device</code>：存储设备的 I/O 统计信息；</li><li><code>FileSystem</code>：文件系统的 I/O 统计信息；</li><li><code>Network</code>：网络接口的统计信息（收发包数、传输速率等）；</li><li><code>Load Average</code>：系统负载平均值等。</li></ul> 
<p>管理员可以根据 <code>iostat</code> 输出的信息来监测系统性能瓶颈和磁盘 I/O 压力等情况，以便对系统进行进一步的优化和调整。需要注意的是，在使用 <code>iostat</code> 命令时，常用的 options 包括 <code>-c</code>（显示 CPU 统计数据）、<code>-d</code>（显示磁盘 I/O 数据）、<code>-n</code>（显示网络设备统计数据）、<code>-m</code>（显示统计单位为兆字节）、<code>-t</code>（显示时间戳）。</p> 
<h4><a id="26_cpuinfo_670"></a>2.6 优化命令——cpuinfo</h4> 
<p><code>/proc/cpuinfo</code> 文件是 Linux 系统中包含了系统上每个 CPU 核心信息的一个伪文件系统文件。管理员可以通过读取该文件来获取有关 CPU 硬件信息的详细信息，用于分析系统性能和诊断问题。其中包含了的信息包括：</p> 
<ul><li><code>processor</code>：CPU 的处理器编号，从 0 开始计算。</li><li><code>vendor_id</code>：CPU 制造商名称（如 GenuineIntel 代表英特尔、AuthenticAMD 代表 AMD）。</li><li><code>cpu family</code>：CPU 家族编号，同一家族的 CPU 处理器支持相同的功能集。</li><li><code>model name</code>：CPU 的型号名称、速度以及规范。</li><li><code>cache size</code>：CPU 带有的缓存大小。</li><li><code>cpu MHz</code>：CPU 的时钟频率（以 MHz 为单位）。</li><li><code>core id</code>：CPU 内核的编号，从 0 开始计算。</li><li><code>cpu cores</code>：CPU 内核数量。</li><li><code>flags</code>：各种 CPU 功能的标志位，例如 MMX、SSE、AVX 等。</li></ul> 
<p>根据 <code>/proc/cpuinfo</code> 文件中所提供的信息，管理员可以识别 CPU$type，了解系统的硬件环境，以便更好地管理和配置系统。例如，如果需要更好地优化系统性能或者进行硬件故障的排除，<code>/proc/cpuinfo</code> 文件中的硬件信息可以帮助管理员更加精准地定位问题和解决问题。同时，需要注意的是，<code>/proc/cpuinfo</code> 文件中的信息取决于当前系统中的 CPU 硬件环境，因此每台计算机的 CPU 硬件信息可能会各不相同。</p> 
<h4><a id="27_iotop_686"></a>2.7 优化命令——iotop</h4> 
<p><code>iotop</code> 是一款 Linux 系统下的磁盘 I/O 监测工具，用于实时监测正在活动的进程和线程的磁盘 I/O 请求，可以帮助管理员更好地监控和分析 I/O 繁忙进程或线程。<code>iotop</code> 提供的信息应包括：</p> 
<ul><li>进程或线程的 PID；</li><li>进程或线程的名称；</li><li>进程或线程的用户；</li><li>实时的读写 I/O 带宽大小；</li><li>实时的读写 I/O 请求数量；</li><li>实时的读写 I/O 处理时间。</li></ul> 
<p><code>iotop</code> 命令需要以 root 用户或具有相应权限的用户身份运行。使用该命令可以帮助管理员更加清晰地了解磁盘 I/O 繁忙的进程或线程、磁盘 I/O 的整体使用情况以及 I/O 瓶颈的原因。同时，需要注意的是，<code>iotop</code> 监测的是每个进程或线程的独立磁盘 I/O 操作情况，而不是某个磁盘分区或整个系统的 I/O 操作。</p> 
<h4><a id="28_taskset_699"></a>2.8 优化命令——taskset</h4> 
<p><code>taskset</code> 是一款 Linux 系统中的命令行工具，可以用来限制进程的 CPU 亲和性。在多核 CPU 的系统上，<code>taskset</code> 可以指示系统只在指定的 CPU 核心上运行该进程的代码。该命令可以通过以下参数来指定运行进程的 CPU 亲和性：</p> 
<ul><li><code>-c, --cpu-list</code>：指定进程运行在哪些 CPU 上（例如0,2）。</li><li><code>-p, --pid</code>：指定要修改的进程 ID。</li></ul> 
<p>例如，以下命令将 ID 为 <code>12345</code> 的进程绑定到 CPU 核心 0 和 2 上运行：</p> 
<pre><code>taskset -p 0x5 12345
</code></pre> 
<p>此外，<code>taskset</code> 还提供了其他选项，如 <code>-q, --query</code>（查询一个进程的 CPU 亲和性）以及 <code>-h, --help</code>（获取帮助文档）等选项。</p> 
<p>可以通过使用 <code>taskset</code> 命令，让管理员更加精确地控制系统上进程所使用的 CPU 资源，有助于提升系统的性能和稳定性。注意，<code>taskset</code> 命令需要以 root 权限运行。</p> 
<h4><a id="29_vmstat_716"></a>2.9 优化命令——vmstat</h4> 
<p><code>vmstat</code> 是一款 Linux 和 Unix 系统下的命令行工具，用于实时监视 CPU、内存、磁盘 I/O、进程、系统环境等各种系统参数。它可以提供以下几类信息：</p> 
<ul><li>基本的 CPU 使用率和上下文切换数据；</li><li>内存使用情况（内存使用量、空闲内存、缓存使用量等）；</li><li>虚拟内存和系统调用的统计数据；</li><li>磁盘 I/O 使用情况（读写请求量、块大小，分区 I/O 活动，块累计值等）；</li><li>进程的实时数据，包括运行队列、页换出量、坏内存等信息。</li></ul> 
<p><code>vmstat</code> 可以通过给定不同的参数调整输出内容和频率（如 <code>-a</code> 参数显示所有信息、<code>-w</code> 参数指定输出宽度等），以满足不同场景下的需求。使用 <code>vmstat</code> 命令，管理员可以快速获取系统的整体状态和性能指标，为系统调优和问题排查提供支持。需要注意的是，<code>vmstat</code> 只能提供实时的数据报告，不能进行历史记录或长期的趋势分析。</p> 
<h4><a id="210_uptime_728"></a>2.10 优化命令——uptime</h4> 
<p><code>uptime</code> 是一款 Linux 和 Unix 系统下的命令行工具，用于列出运行系统已经运行了多长时间，并且系统的平均负载情况。其输出结果包含三个数据点，分别为：</p> 
<ul><li>当前时间，格式为 “当前时间:系统已经运行了多长时间”；</li><li>当前系统的平均负载情况，包括在过去 1 分钟、5 分钟和 15 分钟内的平均负载情况。</li></ul> 
<p>其中，平均负载是描述系统繁忙程度的一个指标，它表示在一段特定时间内的平均活跃进程数，即当前正在使用 CPU 或等待 CPU 的进程数量。如果系统的平均负载高于 CPU 核心数量，则可能说明系统存在过多的活跃进程，这可能会导致系统性能下降。管理员可以使用 <code>uptime</code> 命令来快速获取系统的负载情况，以便及时响应问题并进行调整和优化。还需要注意的是，<code>uptime</code> 命令只提供实时的运行时间和负载数据，不能提供历史记录或长期趋势分析。</p> 
<h4><a id="211_nice_737"></a>2.11 优化命令——nice</h4> 
<p>调 整 nice 值 改 变 进 程 优 先 级</p> 
<p><code>nice</code> 是 Linux 和 Unix 中的一个命令行工具，用于启动进程时设置进程的优先级。每个进程都有一个优先级值，通常为 0，可以在 -20（最高优先级）到 +19（最低优先级）之间进行调节。进程的优先级值越高，获取 CPU 时间片的机会就越多，运行速度就越快。</p> 
<p>使用 <code>nice</code> 命令可以使用如下指令来启动一个带有指定优先级的进程：</p> 
<pre><code>nice -n &lt;priority&gt; &lt;command&gt;
</code></pre> 
<p>其中 <code>&lt;priority&gt;</code> 表示要指定的进程优先级值，范围从 -20 到 +19，<code>&lt;command&gt;</code> 表示要启动的进程的命令和选项。例如：</p> 
<pre><code>nice -n -5 command
</code></pre> 
<p>此命令将以优先级值 -5 启动进程 <code>command</code>。</p> 
<p>需要注意的是，启动进程时使用 <code>nice</code> 命令来设置进程的优先级需要使用 root 权限或具有 CAP_SYS_NICE 权限的用户才能完成。正常用户在启动进程时只能将进程的优先级值增加（低于 0），而不能降低（高于 0）。</p> 
<h4><a id="212_ulimit_759"></a>2.12 优化命令——ulimit</h4> 
<p><code>ulimit</code> 是 Linux 和 Unix 系统中的一个命令行工具，用于限制用户对一些系统资源的使用，例如为用户分配最大的核心转储文件大小、任务数、最大打开文件描述符等。</p> 
<p><code>ulimit</code> 的使用与语法为：</p> 
<pre><code>ulimit [option] [value]
</code></pre> 
<p>其中，<code>option</code> 表示资源类型，如 <code>-a</code> 表示显示所有资源的限制，<code>-n</code> 表示设置或显示打开文件描述符的最大值等；<code>value</code> 表示要设置的资源限制值。如果只使用 <code>ulimit</code> 命令而不加参数，则默认为设置或显示进程可用的最大内存大小。</p> 
<p>使用 <code>ulimit</code> 命令可以限制一个用户可以使用的系统资源数量，也可以进行系统调优以提高系统性能。需要注意的是，<code>ulimit</code> 的使用会影响系统进程和用户对系统资源的使用，因此需要管理员谨慎设置相应的值。</p> 
<h4><a id="213_time_773"></a>2.13 优化命令——time</h4> 
<p>命 令 测 试 进 程 运 行 时 间 time dd if=/dev/zero of=/test.dbf bs=1M count=200</p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-4yfplqlD-1687010246634)(C:\Users\zhao\AppData\Roaming\Typora\typora-user-images\image-20230615195444804.png)]</p> 
<h2><a id="_779"></a>三.网络服务总结</h2> 
<h3><a id="1_ftp_781"></a>1. ftp</h3> 
<ul><li>文本传输协议，网络上控制文件双向传输，客户端和服务端可以实现传输，</li><li>有不同操作系统的FTP，但都是遵守同一种协议</li><li>使用的协议是TCP，用端口进行通信——20、21</li><li>20端口的作用：建立数据连接，传输连接数据————被动模式的过程（特点：被动模式使用的更多，更容易穿越防火墙，注在实验的环境下关闭防火墙</li><li>21是控制连接，传输FTP的控制命令————主动模式的过程</li></ul> 
<h3><a id="2_DHCP_789"></a>2. DHCP工作原理</h3> 
<h4><a id="21_CS_791"></a>2.1 典型的C/S模式</h4> 
<p>在网络中架设一台专用的 DHCP 服务器，负责集中分配 各种网络地址参数（主要包括 IP 地址、子网掩码、广播地址、默认网关地址、DNS 服务器地址）；其他主机作为 DHCP 客户机，将网卡配置为自动获取地址，即可与 DHCP 服务器进行通信，完成自动配置过程</p> 
<p>DHCP 是 C/S 模式，DHCP 服务端和客户端需要保持通信，DHCP 基于 UDP 协议，双方都有可能会主动向对方发起通信，因此双方都需要监听端口。<br> Server 端：DHCP Server（运行 dhcp 服务）<br> UDP 服务：监听端口 67（bootps）<br> Client 端：DHCP Client（运行 dhcp 程序）<br> UDP 服务：监听端口 68 （bootpc）</p> 
<h4><a id="22_DHCP_801"></a>2.2 DHCP的分配方式</h4> 
<p>（1）自动分配是当 DHCP 客户机第一次成功地从 DHCP 服务器获取到一个 IP 地址后， 就永久地使用这个 IP 地址。<br> （2）手动分配是由 DHCP 服务器管理员专门指定 IP 地址。<br> （3）动态分配是当 DHCP 客户机第一次从 DHCP 服务器获取到 IP 地址后，并非永久地使用该地址，而是在每次使用完后，DHCP 客户机就会释放这个 IP 地址，供其他客户机使用。</p> 
<h4><a id="23_DHCP_807"></a>2.3 DHCP工作原理</h4> 
<p>DHCP工作原理 广播进行，先到先得 一个网络中只能有一个DHCP<br> 四次回话<br> （1）客户机请求 IP 地址 当一个 DHCP 客户机启动时，客户机还没有 IP 地址，所以客户机要通过 DHCP 获取一个合法的地址。此时DHCP客户机以广播方式发送 DHCP Discover 发现信息来寻找 DHCP 服务器，</p> 
<p>（2）服务器响应 当 DHCP 服务器接收到来自客户机请求 IP 地址的信息时，它就在自己的 IP 地址池中 查找是否有合法的 IP 地址提供给客户机。如果有，DHCP 服务器就将此 IP 地址做上标记， 加入到 DHCP Offer 的消息中，然后 DHCP 服务器就广播一则 DHCP Offer 消息</p> 
<p>（3）客户机选择 IP 地址 DHCP客户机从接收到的第一个DHCP Offer消息中提取IP地址，发出IP地址的DHCP 服务器将该地址保留，这样该地址就不能再分配给另一个 DHCP 客户机。之后 DHCP 客户 机会向服务器发送 DHCP Request 消息。</p> 
<p>（4）服务器确定租约 DHCP 服务器接收到 DHCP Request 消息后，以 DHCP ACK 消息的形式向客户机广播成功确认，该消息包含有 IP 地址的有效租约和其他可配置的信息。当客户机收到 DHCP ACK 消息时，它就配置了 IP 地址，完成 TCP/IP 的初始化。</p> 
<h3><a id="3_DNS_820"></a>3. DNS域名解析</h3> 
<h4><a id="31_DNS_822"></a>3.1 DNS是什么？</h4> 
<p>DNS域名系统（Domain Name System缩写DNS，Domain Name被译为域名）是因特网的一项核心服务，它作为可以将域名和IP地址相互映射的一个分布式数据库，能够使人更方便的访问互联网，而不用去记住能够被机器直接读取的IP数串。</p> 
<p>正向解析：根据域名查找对应的IP地址 <br> 反向解析：根据IP地址查找对应的域名（域名的反向解析不是很常用，只在一些特殊场合才会用到，比如可用于反垃圾邮件的验证。）</p> 
<h4><a id="32_TCPUDP_829"></a>3.2 TCP与UDP作用</h4> 
<p>① TCP是用来做区域传送，多用于主从同步<br> 在一个区中主DNS服务器从自己本机的数据文件中读取该区的DNS数据信息，而辅助DNS服务器则从区的主DNS服务器中读取该区的DNS数据信息</p> 
<p>② UDP是用来做DNS解析的<br> 域名：通常由一个完全合格域名（FQDN）标识。FQDN 全称 Fully Qualified Domain Name ，它能准确表示出其相对于 DNS 域树根的位置， 也就是节点到DNS 树根的完整表述方式，从节点到树根采用反向书写，并将每个节点用“.”分隔，对于DNS 域google来说，其完全正式域名（FQDN）为google.com。<br> 例如，google 为 com 域的子域，其表示方法为 google.com，而 www 为 google 域中的子域， 可以使用www.google.com. 表示。</p> 
<p>注意：通常，FQDN 有严格的命名限制，长度不能超过 256 字节，只允许使用字符 a-z,0-9,A-Z 和减号（-）。点号（.）只允许在域名标志之间（例如“google.com”）或者 FQDN 的结尾使用。域名不区分大小，由最顶层到下层，可以分成：根域、顶级域、二级域、子域</p> 
<p>即全域名：同时带有主机名和域名的名称<br> FQDN = Hostname + DomainName<br> 如：www.baidu.com.<br> 注意：最前面的一定是主机，最后一个点表示根域，通常是省略不写的，但实际上www.abc.com=www.abc.com.<br> 域名结构:<br> http://www.sina.com.cn./<br> http://主机名.子域.二级域.顶级域 根域/</p> 
<h4><a id="33__848"></a>3.3 两种查询方式</h4> 
<p>（1）递归查询</p> 
<p>客户机发送请求后自己只用等待结果即可，中间具体过程交给服务器实现。</p> 
<p>（2）迭代查询</p> 
<p>客户机的请求需要自己挨个去查询才能得到结果，服务器没有结果时候只会给你提供其它服务器的地址，而不会帮你去请求查询，这与递归截然相反</p> 
<h4><a id="34___858"></a>3.4 域名代理/注册/购买服务商</h4> 
<p>-新网，http://www.xinnet.com<br> -万网，http://www.net.cn<br> -中国互联，http://hulian.top<br> 中国数据<br> 阿里云<br> 腾讯云<br> 西部数码<br> 亚马逊</p> 
<p>域名体系结构<br> 所有的域名必须以点结尾<br> www.qq.com. www.baidu.com.<br> 根域名（.）<br> 一级域名：.cn（中国） .us() .tw(台湾) .kr（韩国） .jp（日本） .hk（香港）uk(英国) …<br> 二级域名：.com.cn(中国商业组织) edu.cn(教育机构) .org.cn(非盈利) .net.cn(中国运营商)<br> 三级域名：sina.com.cn nb.com.cn haixi.com.cn …</p> 
<p>组织域：.com .org .net .CC<br> 国家域：.cn（中国） .tw（台湾） .hk(香港) .iq .ir .jp（日本）<br> 反向域</p> 
<p>114.114.114.114是国内移动、电信和联通通用的DNS，手机和电脑端都可以使用。<br> 8.8.8.8是GOOGLE公司提供的DNS，该地址全球通用，相对来说，更适合国外以及访问国外网站的用户使用<br> 223.5.5.5 和 223.6.6.6：阿里云DNS<br> IPV6 2400:3200::1 和 2400:3200:baba::1<br> 江苏省南京市(中国电信)<br> 首选DNS为：218.2.135.1 备用DNS为：61.147.37.1</p> 
<p>FQDN：(Fully Qualified Domain Name)全限定域名：同时带有主机名和域名的名称。从全限定域名中包含的信息可以看出主机在域名树中的位置。<br> 正向解析：FQDN--------IP（一对多）------一般使用正向解析<br> 反向解析：IP------------FQDN</p> 
<h4><a id="35_ssh_892"></a>3.5 ssh</h4> 
<h5><a id="351___894"></a>3.5.1 根据安全策略进行调优</h5> 
<p>18位 密码复杂性（大写、小写、字符、数字） 端口（1023以上叫做高位端口1922） 做好安全</p> 
<p>对未经过安全认证的RPM包进行安全检查<br> Linux用户方面的加固<br> 设定密码策略<br> 对用户密码强度的设定<br> 对用户的登录次数进行限制<br> 禁止ROOT用户远程登录<br> 设置历史命令保存条数和账户超时时间<br> 设置只有指定用户组才能使用su命令切<br> 换到root用户<br> 对Linux账户进行管理<br> 对重要的文件进行锁定，即使ROOT用户也无法删除<br> 建立日志服务器</p> 
<h5><a id="352__911"></a>3.5.2 根据安全中的漏洞进行升级</h5> 
<p>升级openssh漏洞</p> 
<h5><a id="353__fail2ban_915"></a>3.5.3 fail2ban</h5> 
<p>程序下载地址：http://www.fail2ban.org/wiki/index.php/Downloads，</p> 
<p>实战背景：<br> 最近公网网站一直被别人暴力破解 SSHD 服务密码。虽然没有成功，但会导致系统负载很高，原因是在暴力破解的时候，系统会不断地认证用户，从而增加了系统资源额外开销，导致访问公司网站速度很慢。<br> 然而fail2ban 程序可以监视你的系统日志，然后匹配日志的错误信息（正则式匹配）执行相应的屏蔽动作（一般情况下是防火墙），而且可以发送 e-mail 通知系统管理员，很实用、很强大！<br> 简单来说其功能就是防止暴力破解。工作的原理是通过分析一定时间内的相关服务日志，将满足动作 的相关 IP 利用 iptables 加入到dorp 列表一定时间。</p> 
<h3><a id="4__NFS_924"></a>4. NFS共享存储</h3> 
<p>（1）NFS（网络文件服务）是一种基于 TCP/IP 传输的网络文件系统协议，最初由 Sun 公司开发。通过使用 NFS 协议，客户机可以像访问本地目录一样访问远程服务器中的共享资源<br> NFS 也是 NAS 存储 设备必然支持的一种协议。<br> （2）NAS存储：NFS 服务的实现依赖于 RPC（Remote Process Call，远端过程调用）机制，以完成远程到本地的映射过程。在 CentOS 7 系统中，需要安装 nfs-utils、rpcbind 软件包来提供 NFS 共享服务，前者用于 NFS 共享发布和访问，后者用于 RPC 支持。<br> 手动加载 NFS 共享服务时，应该先启动 rpcbind，再启动 nfs。<br> nfs端口号2049<br> RPC端口号111</p> 
<p>（3）实验步骤：<br> 1、安装nfs和rpcbind软件<br> 2、修改配置文件设置共享<br> 3、创建共享目录<br> 4、开启服务<br> 5、客户端验证共享目录可访问</p> 
<h3><a id="5_PXE_940"></a>5. PXE高效批量网络装机</h3> 
<h4><a id="51__PXE_942"></a>5.1 PXE含义</h4> 
<p>PXE 严格来说并不是一种安装方式，而是一种引导的方式。进行 PXE 安装的必要条件是要安装的计算机中包含一个 PXE 支持的网卡（NIC），即网卡中必须要有 PXE Client。PXE （Pre-boot Execution Environment）协议使计算机可以通过网络启动。协议分为 client 和 server 端，PXE client 在网卡的 ROM 中，当计算机引导时，BIOS 把 PXE 、client 调入内存执行，由 PXE client 将放置在远端的文件通过网络下载到本地运行。<br> 运行 PXE 协议需要设置 DHCP 服务器 和 TFTP 服务器。DHCP 服务器用来给 PXE client（将<br> 要安装系统的主机）分配一个 IP 地址，由于是给 PXE client 分配 IP 地址，所以在配置 DHCP 服务器时需要增加相应的 PXE 设置。<br> 此外，在 PXE client 的 ROM 中，已经存在了 TFTP Client。PXE Client 通过 TFTP 协议到 TFTP Server 上下载所需的文件。</p> 
<p>tftp协议端口号：69</p> 
<h4><a id="52__PXE_951"></a>5.2 PXE优点</h4> 
<ul><li>规模化：同时装配多台服务器；</li><li>自动化：安装系统、配置各种服务；</li><li>远程实现：不需要光盘、U 盘等安装介质。</li></ul> 
<h4><a id="53_PXE_957"></a>5.3 PXE特点</h4> 
<p>（１）客户机的网卡支持 PXE 协议（集成 BOOTROM 芯片），且主板支持网络引导。 <br> 网络中有一台 DHCP 服务器以便为客户机自动分配地址、指定引导文件位置。 <br> 服务器通过 TFTP（Trivial File Transfer Protocol，简单文件传输协议）提供引导镜像文件的下载。 其中，第一个条件实际上是硬件要求，目前绝大多数服务器和大多数 PC 都能够提供此支持，只需在 BIOS 设置中允许从 Network 或 LAN 启动即可。</p> 
<p>（２）KickStart 概述</p> 
<p>KickStart 是一种无人职守安装方式。KickStart 的工作原理是通过记录典型的安装过程中所需人工干预填写的各种参数，并生成一个名为 ks.cfg 的文件；在其后的安装过程中（不只局限于生成 KickStart 安装文件的机器）当出现要求填写参数的情况时，安装程序会首先去查找 KickStart 生成的文件，当找到合适的参数时，就采用找到的参数，当没有找到合适的参数时，才需要安装者手工干预。<br> 这样，如果 KickStart 文件涵盖了安装过程中出现的所有需要填写的参数时，安装者完全可以只告诉安装程序从何处取 ks.cfg 文件，然后去忙自己的事情。等安装完毕，安装程序会根据 ks.cfg 中设置的重启选项来重启系统，并结束安装。</p> 
<h4><a id="PXE_968"></a>５.４PXE服务的构建过程</h4> 
<h5><a id="PXE_970"></a>５.４.１PXE服务器和客户机的工作过程：</h5> 
<p>1.PXE客户机发出DHCP请求，向DHCP服务器申请IP地址。 2.DHCP服务器响应PXE客户机的请求，自动从IP地址池中分配一个IP地址给PXE客户机，并且告知PXE客户机：TFTP服务器的IP地址和PXE引导程序文件pxelinux.0，默认在TFTP共享目录/var/lib/tftpboot/下<br> 3.PXE客户机向TFTP服务器发起获取pxelinux.0引导程序文件的请求。<br> 4.TFTP服务器响应PXE客户机的请求，将其共享的pxelinux.0文件传输给PXE客户机。<br> 5.PXE客户机通过网络来启动到系统安装主界面。<br> 6.PXE客户机向文件共享服务器（ftp、http、nfs等）发起获取centos或windows系统安装文件的请求。<br> 7.文件共享服务响应PXE客户机的请求，将共享的系统安装文件传输给PXE客户机。<br> 8.PXE客户机进入到安装提示向导界面，用户需要手动来完成系统安装的操作</p> 
<h5><a id="_PXE__980"></a>５.４.２搭建 PXE 远程安装服务器</h5> 
<p>所需安装包<br> vsftpd //用来放置安装镜像，通过ftp访问镜像安装<br> dhcp.x86_64 12:4.2.5-7pd-3.0.2-27.el7.x86_64.r9.el7.centos //用来给客户机分配ip<br> syslinux-4.05-15.el7.x86_64.rpm //用来提供pxe的引导程序<br> tftp-server.x86_64 0:5.2-22.el7.rpm //用来提供引导镜像文件的下载<br> xinetd.x86_64 2:2.3.15-14.el7 //用来托管tftp<br> system-config-kickstart.noarch 0:2.9.7-1.el7.rpm //用来无人值守安装</p> 
<p>环境准备：<br> 一台作为pxe服务器，一台作为裸金属客户机，绑定同一块网卡，裸金属客户机vmnet1网卡取消勾选dhcp配置<br> 关闭selinux和防火墙</p> 
<p>主机服务器地址：192.168.198.11主机名：test１</p> 
<p>一台主机：1）配置双网卡 一个作用是dhcp,一个是使用网络源安装环境包<br> 2）DHCP部署<br> 3）tftp-server 服务器通过 TFTP（Trivial File Transfer Protocol，简单文件传输协议）提供引导镜像文件的下载。<br> 4）syslinux //用来提供pxe的引导程序<br> 5）xinetd //用来托管tftp<br> 6）vsftpd //用来放置安装镜像，通过ftp访问镜像安装<br> 7）kickstart //用来无人值守安装</p> 
<h2><a id="shell_1004"></a>四．shell脚本总结</h2> 
<h3><a id="_1006"></a>１．编写脚本的思路</h3> 
<ul><li>明确脚本的功能</li><li>编写脚本时会使用到那些命令 ？ useradd passwd for</li><li>把变化的数据使用变量表示</li><li>选择适合的流程控制 （选择 、 循环 、分支）</li></ul> 
<h3><a id="_1013"></a>２．生产案列</h3> 
<h4><a id="_awk__httpd__IP__1015"></a>２．１使用 awk 统计 httpd 访问日志中每个客户端 IP 的出现次数?</h4> 
<pre><code> awk '{ip[$1]++}END{for(i in ip){print ip[i],i}}' /var/log/httpd/access_log

备注:定义数组,数组名称为 ip,数字的下标为日志文件的第 1 列(也就是客户端的 IP 地址)
,++的目的在于对客户端进行统计计数,客户端 IP 出现一次计数器就加 1。END中的指令在读取完文件后执行,通过循环将所有统计信息输出。
</code></pre> 
<h4><a id="_3__1024"></a>２．２连续输入错误密码 3 次,则报警</h4> 
<p>编写脚本,用户输入密码,脚本判断密码是否正确,输入正确则提示正确,连续输入错误密码 3 次,则报警?</p> 
<pre><code>#!/bin/bash
init=123456
for I in {1..3}
do
read -p "请输入密码:" pass
if [ $pass == $init ];then
echo "密码正确"
break
fi
done
echo "警告:密码错误" 
</code></pre> 
<h4><a id="_1042"></a>２．３监控磁盘情况，异常发邮件</h4> 
<pre><code>#!/bin/bash
disk_sda1=df -h |sed -n '3p'|awk '{print $4}'|cut -f 1 -d '%'
if
　((disk_sda1 &gt; 80));
then
　echo “this is error”
  echo date “192.168.198.11 this is over 70%” |mail -s “disk over 70%” 12345300@qq.com,5645645@qq.com
else
    echo “this is ok”
fi
</code></pre> 
<h4><a id="_ip_3_1057"></a>２．４ ip 登录失败超过3进行告警</h4> 
<pre><code>#!/bin/ bash
x=`awk '/Failed password/{ip[$11]++}END{for(i in ip){print i","ip[i]}}' /var/log/secure`
for j in $x
do
ip=`echo $j | awk -F "," '{print $1}'`
num=`echo $j | awk -F "," '{print $2}'`
if [ $num -ge 3 ];then
echo "警告! $ip访问本机失败了$num次，请速速处理!"
fi
done
</code></pre> 
<h4><a id="shellssh_1072"></a>２．５通过shell脚本来防止暴力破解ssh</h4> 
<pre><code>通过自定义的shell脚本来防护安全
# /bin/bash
cat /var/log/secure|awk '/Failed/{print $(NF-3)}'|sort|uniq -c|awk '{print $2"="$1;}' &gt; /root/satools/black.txt

DEFINE="10"

for i in `cat /root/satools/black.txt`
do
IP=`echo $i|awk -F= '{print $1}'`
NUM=`echo $i|awk -F= '{print $2}'`

if[ $NUM -gt $DEFINE ]; then
grep $IP /etc/hosts.deny &gt; /dev/null
if [ $? -gt 0 ]; then
echo "sshd:$IP" &gt;&gt; /etc/hosts.deny
fi
fi
done
</code></pre> 
<h4><a id="shell_1095"></a>２．６shell一般用在哪里</h4> 
<p>一键部署<br> 重复工作<br> 日志分割<br> 文件比对<br> 备份<br> 监控（zabbix）<br> ansible shell模块<br> 健康检查</p> 
<p>系统初始化<br> 数据库初始化<br> 巡检<br> 定期清理（超期日志）</p> 
<h3><a id="Linuxgrepsedawk_1111"></a>３.Linux文本三剑客（grep、sed、awk）</h3> 
<h4><a id="grep_1113"></a>３．１grep</h4> 
<p>对文本的内容进行过滤，针对行处理</p> 
<p>格式：grep [选项]…查找条件 目标文件</p> 
<p>例子：</p> 
<pre><code>cat 123.txt | grep -v "^$" &gt; test.txt————过滤掉123.txt里的空行将内容传送给test.txt
</code></pre> 
<p>详细grep选项参数查看</p> 
<p>https://blog.csdn.net/Katie_ff/article/details/131012472?spm=1001.2014.3001.5501</p> 
<h4><a id="sed_1129"></a>３.２sed</h4> 
<p>sed命令是对文本内容进行增删改查，生效才会存入硬盘中，不然会存在缓冲区</p> 
<p>格式：sed -e ’操作‘ 文件1 文件2…</p> 
<p>详细sed选项参数查看</p> 
<p>https://blog.csdn.net/Katie_ff/article/details/131074342?spm=1001.2014.3001.5501</p> 
<h4><a id="awk_1139"></a>３.３awk</h4> 
<p>awk 是一个功能强大的编辑工具，逐行读取输入文本，默认以空格或tab键作为分隔符作为分隔，并按模式或者条件执行编辑命令。</p> 
<p>以空格做为分隔符，多个空格他会自动压缩成一个</p> 
<p>格式：awk ‘{print}’ 文件名</p> 
<p>详细awk选项参数查看</p> 
<p>https://blog.csdn.net/Katie_ff/article/details/131097842?spm=1001.2014.3001.5501</p> 
<h2><a id="_1151"></a>五．安全总结</h2> 
<h3><a id="_iptables_1153"></a>１． iptables</h3> 
<h4><a id="_1155"></a>１．１<strong>四表五链</strong></h4> 
<ul><li> <p>规则表的作用:容纳各种规则链; 表的划分依据：防火墙规则的作用相似</p> </li><li> <p>规则链的作用:容纳各种防火墙规则;规则的作用：对数据包进行过滤或处理 ;链的分类依据：处理数据包的不同时机</p> </li><li> <p>总:表里有链，链里有规则</p> </li></ul> 
<h4><a id="_1162"></a>１．２<strong>四表</strong></h4> 
<ul><li>raw：主要用来决定是否对数据包进行状态跟踪 包含两个规则链，OUTPUT、PREROUTING</li><li>mangle : 修改数据包内容，用来做流量整形的，给数据包设置标记。包含五个规则链，INPUT、 OUTPUT、 FORWARD、 PREROUTING、 POSTROUTING</li><li>-nat：负责网络地址转换，用来修改数据包中的源、目标IP地址或端口。包含三个规则链，OUTPUT、PREROUTING、POSTROUTING。</li><li>-filter：负责过滤数据包，确定是否放行该数据包(过滤)。包含三个链，即INPUT、FORWARD、 OUTPUT</li></ul> 
<h4><a id="__1169"></a>１．３ 规则链之间的匹配顺序</h4> 
<p>（１）主机型防火墙:</p> 
<p>数据包直接进入到防火墙所在的服务器的内部某一个应用程序当中，是不是我只是路过服务器吧，是直接进入到服务<br> 入站数据(来自外界的数据包，且目标地址是防火墙本机) : PREROUTING—— INPUT ——本机的应用程序<br> 出站数据(从防火墙本机向外部地址发送的数据包):本机的应用程序——OUTPUT——POSTROUTING<br> （２）网络型防火墙:<br> 转发数据(需要经过防火墙转发的数据包) : PREROUTING——FORWARD——POSTROUTING</p> 
<h4><a id="_1179"></a>１.４规则链内的匹配顺序</h4> 
<p>自上向下按顺序依次进行检查，找到相匹配的规则即停止(LOG策略例外，表示记录相关日志)要么放行 要么丢弃<br> 若在该链内找不到相匹配的规则，则按该链的默认策略处理(未修改的状况下，默认策略为允许)</p> 
<p>注：按第一条规则……第二条规则的顺序进行匹配处理，遵循“匹配即停止”的原则，<br> 一旦找到一条匹配规则将不再检查后续的其他规则，如果一直找不到匹配的规则，就按默认规则处理。<br> 默认规则用iptables -L查看，规则链后面出现(policy ACCEPT)即是默认放行<br> 默认策略不参与链内规则的顺序编排<br> -F清空链时，默认策略不受影响</p> 
<h4><a id="_1190"></a>１.５数据包在规则表、链间的匹配流程</h4> 
<ul><li> <p>入站数据流向：来自外界的数据包到达防火墙后，首先被 PREROUTING 链处理（是 否修改数据包地址等），然后进行路由选择（判断该数据包应发往何处）；如果数据包的 目标地址是防火墙本机（如 Internet 用户访问网关的 Web 服务端口），那么内核将其传 递给 INPUT 链进行处理（决定是否允许通过等），通过以后再交给系统上层的应用程序 （如 httpd 服务器）进行响应。</p> </li><li> <p>转发数据流向：来自外界的数据包到达防火墙后，首先被 PREROUTING 链处理，然 后再进行路由选择；如果数据包的目标地址是其他外部地址（如局域网用户通过网关访 问 QQ 服务器），则内核将其传递给 FORWARD 链进行处理（允许转发或拦截、丢弃）， 最后交给 POSTROUTING 链（是否修改数据包的地址等）进行处理。</p> </li><li> <p>出站数据流向：防火墙本机向外部地址发送的数据包（如在防火墙主机中测试公网 DNS 服务时），首先进行路由选择，确定了输出路径后，再经由 OUTPUT 链处理，最后再 交 POSTROUTING 链（是否修改数据包的地址等）进行处理。入站 preROUTING input 应用程序 output postrouting</p> </li></ul> 
<h4><a id="iptables__1199"></a>１.６iptables 基本语法、数据包控制类型</h4> 
<p><strong>语法构成</strong></p> 
<p>iptables [-t 表名] 管理选项 [链名] [匹配条件] [-j 控制类型]</p> 
<p>其中，表名、链名用来指定 iptables 命令所操作的表和链，未指定表名时将默认使用 filter 表；</p> 
<ul><li>ACCEPT：允许数据包通过。</li><li>DROP：直接丢弃数据包，不给出任何回应信息。</li><li>REJECT：拒绝数据包通过，必要时会给数据发送端一个响应信息。</li><li>LOG：在/var/log/messages 文件中记录日志信息，然后将数据包传递给下一条规则。</li><li>SNAT:修改数据包的源地址。</li><li>DNAT:修改数据包的目的地址。</li><li>MASQUERADE:伪装成一个非固定公网IP地址。</li></ul> 
<h4><a id="_iptables__1215"></a>１.７ iptables 命令的常用管理选项</h4> 
<table><thead><tr><th>管理选项</th><th>用法示例</th></tr></thead><tbody><tr><td>-A</td><td>在指定链末尾追加一条 iptables -A INPUT （操作）</td></tr><tr><td>-I</td><td>在指定链中插入一条新的，未指定序号默认作为第一条 iptables -I INPUT （操作）</td></tr><tr><td>-P</td><td>指定默认规则 iptables -P OUTPUT ACCEPT （操作）</td></tr><tr><td>-D</td><td>删除 iptables -t nat -D INPUT （操作）</td></tr><tr><td>-R</td><td>修改、替换某一条规则 iptables -t nat -R INPUT （操作）</td></tr><tr><td>-L</td><td>查看 iptables -t nat -L （查看）</td></tr><tr><td>-n</td><td>所有字段以数字形式显示（比如任意ip地址是0.0.0.0而不是anywhere，比如显示协议端口号而不是服务名） iptables -L -n,iptables -nL,iptables -vnL （查看）</td></tr><tr><td>-v</td><td>查看时显示更详细信息，常跟-L一起使用 （查看）</td></tr><tr><td>–line-number</td><td>规则带编号 iptables -t nat -L -n --line-number /iptables -t nat -L --line-number</td></tr><tr><td>-F</td><td>清除链中所有规则 iptables -F （操作）</td></tr><tr><td>-X</td><td>清空自定义链的规则，不影响其他链 iptables -X</td></tr><tr><td>-Z</td><td>清空链的计数器（匹配到的数据包的大小和总和）iptables -Z</td></tr><tr><td>-S</td><td>查看链的所有规则或者某个链的规则/某个具体规则后面跟编号</td></tr></tbody></table> 
<p>详细查看</p> 
<p>https://blog.csdn.net/Katie_ff/article/details/131135959?spm=1001.2014.3001.5501</p> 
<h4><a id="SNATDNAT_1237"></a>１.８SNAT、DNAT策略及应用</h4> 
<h5><a id="SNAT_1239"></a>１.８.１SNAT策略</h5> 
<p>SNAT又称源地址转换。<br> 源地址转换是内网地址向外访问时，发起访问的内网<a href="https://so.csdn.net/so/search?q=ip%E5%9C%B0%E5%9D%80%E8%BD%AC%E6%8D%A2&amp;spm=1001.2101.3001.7020">ip地址转换</a>为指定的ip地址<br> 就是把内网地址转成指定的IP地址，这个iP地址可以访问公网</p> 
<h5><a id="DNAT_1245"></a>１.８.２DNAT策略</h5> 
<p>目的地址转换的作用是将一组本地内部的地址映射到一组全球地址。<br> 通常来说，合法地址的数量比起本地内部的地址数量来要少得多。</p> 
<p>私网地址只能作为源地址来访问公网IP，而无法作为目标地址被其他主机访问<br> 所以DNAT将私网中web服务器映射到公网IP，使其公网IP作为目标地址被公网中主机进行访问。</p> 
<h3><a id="firewalld_1253"></a>２.firewalld</h3> 
<h4><a id="firewalld_1255"></a>２.１firewalld概述</h4> 
<p>firewalld防火墙是Centos7系统默认的防火墙管理工具，取代了之前的iptables防火墙，也是工作在网络层，属于包过滤防火墙。</p> 
<p>firewalld和iptables都是用来管理防火墙的工具（属于用户态）来定义防火墙的各种规则功能，内部结构都指向netfilter网络过滤子系统(属于内核态)来实现包过滤防火墙功能。</p> 
<p>firewalld提供了支持网络区域所定义的网络连接以及接口安全等级的动态防火墙管理工具它支持IPv4、IPv6防火墙设置以及以太网桥（在某些高级服务可能会用到，比如云计算)并且拥有两种配置模式:运行时配置与永久配置。</p> 
<p>firewalld 与iptables 的区别:</p> 
<ol><li> <p>iptables主要是基于接口，来设置规则，从而判断网络的安全性。<br> firewalld是基于区域，根据不同的区域来设置不同的规则，从而保证网络的安全。与硬件防火墙的设置相类似。</p> </li><li> <p>iptables 在/etc/sysconfig/iptables 中储存配置，<br> firewalld将配置储存在/etc/firewalld/（优先加载）和/usr/lib/firewalld/(默认的配置文件)中的各种 XMD文件里。</p> </li></ol> 
<p>3.使用iptables每一个单独更改意味着清除所有旧有的规则和从/etc/sysconfig/iptables里读取所有新的规则。使用firewalld却不会再创建任何新的规则，仅仅运行规则中的不同之处。因此firewalld可以在运行时间内，改变设置而不丢失现行连接。</p> 
<p>4.iptables 防火墙类型为静态防火墙<br> firewalld 防火墙类型为动态防火墙</p> 
<p>firewalld 区域的概念:<br> firewalld防火墙为了简化管理，将所有网络流量分为多个区域(zone〉。然后根据数据包的源Ip地址或传入的网络接口等条件将流量传入相应区域。每个区域都定义了自己打开或者关闭的端口和服务列表。</p> 
<h4><a id="firewalld9_1280"></a>２.２firewalld防火墙预定义了9个区域:</h4> 
<p>1、trusted(信任区域）:允许所有的传入流量。<br> 2、public(公共区域):允许与ssh或dhcpv6-client预定义服务匹配的传入流量，其余均拒绝。是新添加网络接口的默认区域。<br> 3、external（外部区域):允许与 ssh 预定义服务匹配的传入流量，其余均拒绝。<br> 默认将通过此区域转发的IPv4传出流量将进行地址伪装，可用于为路由器启用了伪装功能的外部网络。<br> 4、home(家庭区域)∶允许与ssh、ipp-client、mdns、samba-client或dhcpvi-client预定义服务匹配的传入流量，其余均拒绝。<br> 5、internal （内部区域）:默认值时与home区域相同。<br> 6、work(工作区域)∶允许与 ssh、ipp-client、dhcpv6-client预定义服务匹配的传入流量，其余均拒绝。<br> 7、dmz（隔离区域也称为非军事区域):允许与 ssh预定义服务匹配的传入流量，其余均拒绝。<br> 8、block(限制区域) :拒绝所有传入流量。<br> 9、drop （丢弃区域):丢弃所有传入流量，并且不产生包含ICMP的错误响应。</p> 
<h4><a id="_firewalld_1293"></a>２.３ firewalld数据处理流程</h4> 
<p>firewalld对于进入系统的数据包，会根据数据包的源IP地址或传入的网络接口等条件，将数据流量转入相应区域的防火墙规则。对于进入系统的数据包，首先检查的就是其源地址。<br> firewalld检查数据包的源地址的规则:<br> 1.若源地址关联到特定的区域（即源地址或接口绑定的区域有冲突），则执行该区域所制定的规则。<br> 2.若源地址未关联到特定的区域（即源地址或接口绑定的区域没有冲突），则使用传入网络接口的区域并执行该区域所制定的规则。<br> les主要是基于接口，来设置规则，从而判断网络的安全性。<br> firewalld是基于区域，根据不同的区域来设置不同的规则，从而保证网络的安全。与硬件防火墙的设置相类似。</p> 
<ol start="2"><li>iptables 在/etc/sysconfig/iptables 中储存配置，<br> firewalld将配置储存在/etc/firewalld/（优先加载）和/usr/lib/firewalld/(默认的配置文件)中的各种 XMD文件里。</li></ol> 
<p>3.使用iptables每一个单独更改意味着清除所有旧有的规则和从/etc/sysconfig/iptables里读取所有新的规则。使用firewalld却不会再创建任何新的规则，仅仅运行规则中的不同之处。因此firewalld可以在运行时间内，改变设置而不丢失现行连接。</p> 
<p>4.iptables 防火墙类型为静态防火墙<br> firewalld 防火墙类型为动态防火墙</p> 
<p>firewalld 区域的概念:<br> firewalld防火墙为了简化管理，将所有网络流量分为多个区域(zone〉。然后根据数据包的源Ip地址或传入的网络接口等条件将流量传入相应区域。每个区域都定义了自己打开或者关闭的端口和服务列表。</p> 
<h4><a id="firewalld9_1313"></a>２.２firewalld防火墙预定义了9个区域:</h4> 
<p>1、trusted(信任区域）:允许所有的传入流量。<br> 2、public(公共区域):允许与ssh或dhcpv6-client预定义服务匹配的传入流量，其余均拒绝。是新添加网络接口的默认区域。<br> 3、external（外部区域):允许与 ssh 预定义服务匹配的传入流量，其余均拒绝。<br> 默认将通过此区域转发的IPv4传出流量将进行地址伪装，可用于为路由器启用了伪装功能的外部网络。<br> 4、home(家庭区域)∶允许与ssh、ipp-client、mdns、samba-client或dhcpvi-client预定义服务匹配的传入流量，其余均拒绝。<br> 5、internal （内部区域）:默认值时与home区域相同。<br> 6、work(工作区域)∶允许与 ssh、ipp-client、dhcpv6-client预定义服务匹配的传入流量，其余均拒绝。<br> 7、dmz（隔离区域也称为非军事区域):允许与 ssh预定义服务匹配的传入流量，其余均拒绝。<br> 8、block(限制区域) :拒绝所有传入流量。<br> 9、drop （丢弃区域):丢弃所有传入流量，并且不产生包含ICMP的错误响应。</p> 
<h4><a id="_firewalld_1326"></a>２.３ firewalld数据处理流程</h4> 
<p>firewalld对于进入系统的数据包，会根据数据包的源IP地址或传入的网络接口等条件，将数据流量转入相应区域的防火墙规则。对于进入系统的数据包，首先检查的就是其源地址。<br> firewalld检查数据包的源地址的规则:<br> 1.若源地址关联到特定的区域（即源地址或接口绑定的区域有冲突），则执行该区域所制定的规则。<br> 2.若源地址未关联到特定的区域（即源地址或接口绑定的区域没有冲突），则使用传入网络接口的区域并执行该区域所制定的规则。<br> 3.若网络接口也未关联到特定的区域（即源地址或接口都没有绑定特定的某个区域），则使用默认区域并执行该区域所制定的规则</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/23ec235c21fa4760b3f1f1e16b4564f5/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Intellij IDEA设置“选中变量或方法”的背景颜色、字体颜色（Mark Occurrences）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ed2257a8a9178220ee45c5d739accc6c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">要避免的十大后端开发错误</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>