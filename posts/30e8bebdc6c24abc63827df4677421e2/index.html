<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ISO14229之概述 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="ISO14229之概述" />
<meta property="og:description" content="ISO14229之概述 0、概述1、术语介绍2、诊断服务报文格式3、NRC定义描述 0、概述 ISO-14229也称为UDS（统一诊断服务），是一个用于汽车行业诊断通信的需求规范，应用于OSI七层模型的应用层（第7层）。他只规定了与诊断相关的服务需求，并未涉及通信机制；所以，对于ISO-14229的使用是可以架设在各种网络上的，除了我们比较熟悉的CAN外，还可以基于LAN、FlexRay、串口等。在前面的一些文章里，我们也介绍了UDS中常用到的一些诊断服务（如19服务、34/36/37服务、31服务等）的使用；本文则主要介绍下UDS诊断服务的格式及NRC（错误响应码）的定义描述，作为基础补充。
1、术语介绍 为便于后面对UDS诊断服务格式的介绍，我们先来介绍下涉及到的术语。
（1）、Addressing Type （寻址方式）
寻址方式指的是诊断消息的传递方式，有以下两种寻址方式：
物理寻址（Physical），即1对1通信，用于知道确切的被诊断ECU的地址；
功能寻址（Functional），即1对n通信，或者说广播发送，用于不知道确切的被诊断的ECU的地址，向一组或者全体ECU发送请求。
例如，在我们ECU的升级过程中，预编程阶段的相关诊断报文（如通过85服务关闭DTC的更新、28服务关闭其他ECU的报文发送功能），一般会通过功能寻址的方式进行发送，广播式地通知车上其他ECU。在正式升级阶段则通过物理寻址方式，进行数据传输刷写。
（2）、SID（Service Identifier）
用以指代某个诊断服务的1字节无符号整数。例如会话模式控制的10服务、请求复位的11服务等。
（3）、DID（Data Identifier）
用以标识ECU中贮存的某个诊断数据单元的2字节无符号整数。例如请求数据读取的22服务：22 F1 87中的&#34;F1 87&#34;。对于使用者来说DID屏蔽了具体实现细节，而将重点放在了数据本身。例如当我们要读取某个单元的诊断数据时，只要操作（读）对应的DID就可以，而不必通过数据的具体地址去操作。
（4）、NRC（Negative Response Code）
即1字节的无符号整数表示的错误响应码。它是诊断协议为每一种执行失败的诊断服务分配的失败原因代号，便于我们对服务请求失败原因的定位分析。
（5）、Sub-Function（子服务）
1字节的无符号整数表示的子服务。有些诊断服务可以支持不同的诊断子服务，Sub-Function就是用来定义这种子服务的，通过他将某一个服务细分为更为具体的服务。如10服务中的01、02、03，分别表示请求进入不同的会话模式；19服务中的04、06，分别表示请求的是快照还是扩展信息等。
其格式如下，注意其最高位(bit7)是肯定响应应答禁止位；即当该位为1时，则该请求的肯定响应不需进行回复。剩余的7个位用于表示子功能的值，具体值对应的含义在各自服务中都有进行介绍的。这里只需注意该字节最高位这个&#34;肯定响应应答禁止位&#34;的作用即可。如10 83是请求进入扩展会话；且如果是肯定响应（50 03）则不需进行回复。
2、诊断服务报文格式 前面介绍完了涉及到的术语，接下来我们正式来说说UDS诊断服务报文的格式，将分为请求格式、响应格式（肯定响应/否定响应）来进行介绍。
2.1、请求格式（Request）
诊断服务请求格式可以分为以下2种：
[SID] &#43; [Sub-Function] &#43; [Parameter]
[SID] &#43; [Parameter]
即有无Sub-Function的区别；这里我们是把DID也归为Parameter了。Parameter可以是DID，可以是输入参数，可以是自定义的值，字节数目也是视具体要求而定。
2.2、肯定响应（Positive Response）
在请求服务成功执行后，被请求的ECU会返回一个肯定响应；根据通过请求的服务格式是否带有[Sub-Function]，其格式一样可以分为以下的两种：
[SID &#43; 0x40] &#43; [Sub-Function] &#43; [Parameter]
[SID &#43; 0x40] &#43; [Parameter]
这里一样把DID也归为Parameter里。要注意前面ECU收到的服务请求格式是否有带[Sub-Function]，有的话则需注意[Sub-Function]中的Bit 7肯定响应应答禁止位的值。若为1，注意此时是不需发送肯定响应的。我们来看看如下的例子
A、带&lt;Sub-function&gt;的格式： Request: 10 03 ------------ 请求进入扩展会话（10是SID，03是Sub-function） Response: 50 03 ------------ 请求成功，回复积极响应（50是SID&#43;0x40，03是Sub-function） Request: 10 83 ------------ 请求进入扩展会话（10是SID，83是Sub-function，其中肯定响应应答禁止位有效） Response: 无应答，因为肯定响应应答禁止位（Sub-function的Bit7）有效 B、不带&lt;Sub-function&gt;的格式： Request: 22 F1 84 --------- 请求进入扩展会话（22是SID，F1 84 是DID，即Parameter） Response: 62 F1 84 01 ------ 请求成功，回复积极响应（62是SID&#43;0x40，F1 84 是DID，即Parameter，01是ECU返回的数据，也是归于Parameter） 2." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/30e8bebdc6c24abc63827df4677421e2/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-09-28T19:28:25+08:00" />
<meta property="article:modified_time" content="2019-09-28T19:28:25+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ISO14229之概述</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>ISO14229之概述</h4> 
 <ul><li><a href="#0_2" rel="nofollow">0、概述</a></li><li><a href="#1_5" rel="nofollow">1、术语介绍</a></li><li><a href="#2_29" rel="nofollow">2、诊断服务报文格式</a></li><li><a href="#3NRC_61" rel="nofollow">3、NRC定义描述</a></li></ul> 
</div> 
<p></p> 
<h2><a id="0_2"></a>0、概述</h2> 
<p>        ISO-14229也称为<strong>UDS（统一诊断服务）</strong>，是一个用于汽车行业诊断通信的需求规范，应用于OSI七层模型的应用层（第7层）。他<strong>只规定了与诊断相关的服务需求，并未涉及通信机制</strong>；所以，对于ISO-14229的使用是<strong>可以架设在各种网络上</strong>的，除了我们比较熟悉的CAN外，还可以基于LAN、FlexRay、串口等。在前面的一些文章里，我们也介绍了UDS中常用到的一些诊断服务（如19服务、34/36/37服务、31服务等）的使用；本文则主要介绍下UDS诊断服务的格式及NRC（错误响应码）的定义描述，作为基础补充。<br>         </p> 
<h2><a id="1_5"></a>1、术语介绍</h2> 
<p>        为便于后面对UDS诊断服务格式的介绍，我们先来介绍下涉及到的术语。</p> 
<p>        <strong>（1）、Addressing Type （寻址方式）</strong><br>         寻址方式指的是诊断消息的传递方式，有以下两种寻址方式：<br>         <strong>物理寻址（Physical），即1对1通信</strong>，用于知道确切的被诊断ECU的地址；<br>         <strong>功能寻址（Functional），即1对n通信</strong>，或者说广播发送，用于不知道确切的被诊断的ECU的地址，向一组或者全体ECU发送请求。<br>         例如，在我们ECU的升级过程中，预编程阶段的相关诊断报文（如通过85服务关闭DTC的更新、28服务关闭其他ECU的报文发送功能），一般会通过功能寻址的方式进行发送，广播式地通知车上其他ECU。在正式升级阶段则通过物理寻址方式，进行数据传输刷写。</p> 
<p>        <strong>（2）、SID（Service Identifier）</strong><br>         用以<strong>指代某个诊断服务的1字节无符号整数</strong>。例如会话模式控制的10服务、请求复位的11服务等。</p> 
<p>        <strong>（3）、DID（Data Identifier）</strong><br>         用以标识ECU中贮存的<strong>某个诊断数据单元</strong>的<strong>2字节</strong>无符号整数。例如请求数据读取的22服务：22 F1 87中的"F1 87"。对于使用者来说DID屏蔽了具体实现细节，而将重点放在了数据本身。例如当我们要读取某个单元的诊断数据时，只要操作（读）对应的DID就可以，而不必通过数据的具体地址去操作。</p> 
<p>        <strong>（4）、NRC（Negative Response Code）</strong><br>         即<strong>1字节</strong>的无符号整数表示的<strong>错误响应码</strong>。它是诊断协议为每一种执行失败的诊断服务分配的失败原因代号，便于我们对服务请求失败原因的定位分析。</p> 
<p>        <strong>（5）、Sub-Function（子服务）</strong><br>         <strong>1字节</strong>的无符号整数表示的<strong>子服务</strong>。有些诊断服务可以支持不同的诊断子服务，Sub-Function就是用来定义这种子服务的，通过他将某一个服务细分为更为具体的服务。如10服务中的01、02、03，分别表示请求进入不同的会话模式；19服务中的04、06，分别表示请求的是快照还是扩展信息等。<br>         其格式如下，注意其<strong>最高位(bit7)是肯定响应应答禁止位；即当该位为1时，则该请求的肯定响应不需进行回复</strong>。剩余的7个位用于表示子功能的值，具体值对应的含义在各自服务中都有进行介绍的。这里只需注意该字节最高位这个"肯定响应应答禁止位"的作用即可。<strong>如10 83是请求进入扩展会话；且如果是肯定响应（50 03）则不需进行回复</strong>。</p> 
<p><img src="https://images2.imgbox.com/96/43/KX1fuyjf_o.png" alt="在这里插入图片描述"><br>         </p> 
<h2><a id="2_29"></a>2、诊断服务报文格式</h2> 
<p>        前面介绍完了涉及到的术语，接下来我们正式来说说UDS诊断服务报文的格式，将分为请求格式、响应格式（肯定响应/否定响应）来进行介绍。</p> 
<p>        <strong>2.1、请求格式（Request）</strong><br>         诊断服务请求格式可以分为以下2种：<br>         <strong>[SID] + [Sub-Function] + [Parameter]</strong><br>         <strong>[SID] + [Parameter]</strong><br>         即有无Sub-Function的区别；这里我们是把DID也归为Parameter了。Parameter可以是DID，可以是输入参数，可以是自定义的值，字节数目也是视具体要求而定。</p> 
<p>        <strong>2.2、肯定响应（Positive Response）</strong><br>         在请求服务成功执行后，被请求的ECU会返回一个肯定响应；根据通过请求的服务格式是否带有[Sub-Function]，其格式一样可以分为以下的两种：<br>         <strong>[SID + 0x40] + [Sub-Function] + [Parameter]</strong><br>         <strong>[SID + 0x40] + [Parameter]</strong><br>         这里一样把DID也归为Parameter里。要注意前面ECU收到的服务请求格式是否有带[Sub-Function]，有的话则需注意[Sub-Function]中的Bit 7肯定响应应答禁止位的值。若为1，注意此时是不需发送肯定响应的。我们来看看如下的例子</p> 
<pre><code class="prism language-c">A、带<span class="token operator">&lt;</span>Sub<span class="token operator">-</span>function<span class="token operator">&gt;</span>的格式：
 Request<span class="token punctuation">:</span>   <span class="token number">10</span> <span class="token number">03</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span> 请求进入扩展会话（<span class="token number">10</span>是SID，<span class="token number">03</span>是Sub<span class="token operator">-</span>function）
 Response<span class="token punctuation">:</span>  <span class="token number">50</span> <span class="token number">03</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span> 请求成功，回复积极响应（<span class="token number">50</span>是SID<span class="token operator">+</span><span class="token number">0x40</span>，<span class="token number">03</span>是Sub<span class="token operator">-</span>function） 

 Request<span class="token punctuation">:</span>   <span class="token number">10</span> <span class="token number">83</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span> 请求进入扩展会话（<span class="token number">10</span>是SID，<span class="token number">83</span>是Sub<span class="token operator">-</span>function，其中肯定响应应答禁止位有效）
 Response<span class="token punctuation">:</span>  无应答，因为肯定响应应答禁止位（Sub<span class="token operator">-</span>function的Bit7）有效

B、不带<span class="token operator">&lt;</span>Sub<span class="token operator">-</span>function<span class="token operator">&gt;</span>的格式：
 Request<span class="token punctuation">:</span>   <span class="token number">22</span> F1 <span class="token number">84</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span> 请求进入扩展会话（<span class="token number">22</span>是SID，F1 <span class="token number">84</span> 是DID，即Parameter）
 Response<span class="token punctuation">:</span>  <span class="token number">62</span> F1 <span class="token number">84</span> <span class="token number">01</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span> 请求成功，回复积极响应（<span class="token number">62</span>是SID<span class="token operator">+</span><span class="token number">0x40</span>，F1 <span class="token number">84</span> 是DID，即Parameter，<span class="token number">01</span>是ECU返回的数据，也是归于Parameter）
</code></pre> 
<p>        <strong>2.3、否定响应（Negative Response）</strong><br>         否定响应的格式比较固定，<strong>第一字节固定是0x7F，第二字节是之前请求服务的SID，第三个字节是错误响应码</strong>，指示具体错误响应的原因，这个NRC可以在协议中查到，并且不同的服务所支持的NRC也有规定。格式如下：<br>         <strong>[0x7F] + [SID] + [NRC]</strong><br>         </p> 
<h2><a id="3NRC_61"></a>3、NRC定义描述</h2> 
<table><thead><tr><th>NRC值</th><th>定义</th><th>描述</th></tr></thead><tbody><tr><td>11</td><td>ServiceNotSupported/服务不支持</td><td>诊断仪发送的请求消息中服务标识符无法识别或不支持</td></tr><tr><td>12</td><td><strong>SubFunctionNotSupported/不支持子服务</strong></td><td>诊断仪发送的请求消息中子服务无法识别或不支持</td></tr><tr><td>13</td><td><strong>IncorrectMessageLengthOrInvalidFormat/不正确的消息长度或无效的格式</strong></td><td>请求消息长度与特定服务规定的长度不匹配或者是参数格式与特定服务规定的格式不匹配</td></tr><tr><td>21</td><td>BusyRepeatRequest/重复请求忙</td><td>表明ECU太忙而不能去执行请求。一般来说，在这种情况下，诊断仪应进行重复请求工作</td></tr><tr><td>22</td><td><strong>conditionsNotCorrect/条件不正确</strong></td><td>表明ECU的状态条件不允许支持该请求</td></tr><tr><td>24</td><td>requestSequenceError/请求序列错误</td><td>表明收到的是非预期的请求消息序列</td></tr><tr><td>25</td><td>noResponseFromSubnetComponent/子网节点无应答</td><td>表明ECU收到请求，但所请求的操作无法执行</td></tr><tr><td>26</td><td>failurePreventsExecutionOfRequestedAction/故障阻值请求工作执行</td><td>表明请求的动作因一故障原因而没有执行</td></tr><tr><td>31</td><td><strong>requestOutOfRange/请求超出范围</strong></td><td>请求消息包含一个超出允许范围的参数；或者是不支持的数据标识符/例程标识符的访问</td></tr><tr><td>33</td><td><strong>securityAccessDenied/安全访问拒绝</strong></td><td>诊断仪无法通过ECU的安全策略</td></tr><tr><td>35</td><td><strong>invalidKey/密钥无效</strong></td><td>诊断仪发送的密钥与ECU内存中的密钥不匹配</td></tr><tr><td>36</td><td>exceedNumberOfAttempts/超出尝试次数</td><td>诊断仪尝试获得安全访问失败次数超过了ECU安全策略允许的值</td></tr><tr><td>37</td><td><strong>requiredTimeDelayNotExpired/所需时间延迟未到</strong></td><td>在ECU所需的请求延迟时间过去之前诊断仪又执行了一次请求。</td></tr><tr><td>70</td><td>uploadDownloadNotAccepted/不允许上传下载</td><td>表明试图向ECU内存上传/下载数据失败的原因是条件不允许</td></tr><tr><td>71</td><td>transferDataSuspended/数据传输暂停</td><td>表明由于错误导致数据传输操作的中止</td></tr><tr><td>72</td><td>generalProgrammingFailure/一般编程失败</td><td>表明在不可擦除的内存设备中进行擦除或编程时ECU检测到错误发生</td></tr><tr><td>73</td><td>wrongBlockSequenceCounter/错误的数据块序列计数器</td><td>ECU在数据块序列计数序列中检测到错误发生</td></tr><tr><td>78</td><td><strong>requestCorrectlyReceived-ResponsePending/正确接收请求消息-等待响应</strong></td><td>表明ECU正确接收到请求消息，但是将执行的动作未完成且ECU未准备好接收其它请求</td></tr><tr><td>7E</td><td><strong>subFunctionNotSupportedInActiveSession/激活会话不支持该子服务</strong></td><td>当前会话模式下ECU不支持请求的子服务</td></tr><tr><td>7F</td><td><strong>serviceNotSupportedInActiveSession/激活会话不支持该服务</strong></td><td>当前会话模式下ECU不支持请求的服务</td></tr><tr><td>92</td><td>voltageTooHigh/电压过高</td><td>当前电压值超过了编程允许的最大门限值</td></tr><tr><td>93</td><td>voltageTooLow/电压过低</td><td>当前电压值低于了编程允许的最小门限值</td></tr></tbody></table>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ce69a98787979fb720a3563d61c0c33d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">shell索引数组和字符串转化</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/659ed1f7e028d8010979f4fd4f35ef3c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【记录一个问题】android opencl c&#43;&#43;: 不要Context, CommandQueue类的赋值函数</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>