<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>微信小程序开发——上传图片 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="微信小程序开发——上传图片" />
<meta property="og:description" content="功能描述 1.拍摄或从手机相册中选择图片上传。
2.chooseImage(e) 中的index用于判断是新增图片还是替换图片。
3.delImage(e) 删除当前index索引下的数据。
wx.chooseMedia(Object object) 属性类型默认值必填说明countnumber9否最多可以选择的文件个数mediaTypeArray.&lt;string&gt;[&#39;image&#39;, &#39;video&#39;]否文件类型sourceTypeArray.&lt;string&gt;[&#39;album&#39;, &#39;camera&#39;]否图片和视频选择的来源maxDurationnumber10否拍摄视频最长拍摄时间，单位秒。时间范围为 3s 至 60s 之间。不限制相册。sizeTypeArray.&lt;string&gt;[&#39;original&#39;, &#39;compressed&#39;]否仅对 mediaType 为 image 时有效，是否压缩所选文件camerastring&#39;back&#39;否仅在 sourceType 为 camera 时生效，使用前置或后置摄像头successfunction否接口调用成功的回调函数failfunction否接口调用失败的回调函数completefunction否接口调用结束的回调函数（调用成功、失败都会执行 object.success 回调函数 属性类型说明tempFilesArray.&lt;Object&gt;本地临时文件列表 结构属性类型说明tempFilePathstring本地临时文件路径 (本地路径)sizenumber本地临时文件大小，单位 Bdurationnumber视频的时间长度heightnumber视频的高度widthnumber视频的宽度thumbTempFilePathstring视频缩略图临时文件路径fileTypestring文件类型 合法值说明image图片video视频typestring文件类型，有效值有 image 、video、mix wxml部分
&lt;view class=&#34;imageList&#34;&gt; &lt;view class=&#34;imageItem&#34; wx:for=&#34;{{imageList}}&#34; wx:key=&#34;index&#34;&gt; &lt;image class=&#34;image&#34; mode=&#34;aspectFill&#34; bindtap=&#34;chooseImage&#34; data-type=&#34;pictures&#34; data-index=&#34;{{index}}&#34; src=&#34;{{item.url}}&#34; alt=&#34;&#34; /&gt; &lt;view class=&#34;delImage&#34; catchtap=&#34;delImage&#34; data-idnex=&#34;{{index}}&#34;&gt;-&lt;/view&gt; &lt;/view&gt; &lt;view class=&#34;imageItem addImage&#34; bindtap=&#34;chooseImage&#34; data-type=&#34;pictures&#34;&gt;&lt;/view&gt; &lt;/view&gt; wxss部分
.imageList { padding: 32rpx; width: 100vw; box-sizing: border-box; /* 弹性布局 */ display: flex; flex-direction: row; justify-content: flex-start; /* 换行 */ flex-wrap: wrap; /* 内容区的实际宽度为 width: calc(100vw - 64rpx); width: 686rpx; */ } /* 照片容器的样式 */ ." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/bb51d243e3369f646468c809a61725a9/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-08-01T17:57:24+08:00" />
<meta property="article:modified_time" content="2022-08-01T17:57:24+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">微信小程序开发——上传图片</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p class="img-center"><img alt="" height="380" src="https://images2.imgbox.com/96/12/OqbjPieg_o.png" width="375"></p> 
<h3 id="功能描述">功能描述</h3> 
<p>1.拍摄或从手机相册中选择图片上传。</p> 
<p>2.chooseImage(e) 中的index用于判断是新增图片还是替换图片。</p> 
<p>3.delImage(e) 删除当前index索引下的数据。</p> 
<h2 id="wx-chooseMedia-Object-object">wx.chooseMedia(Object object)</h2> 
<table align="left" border="1" cellpadding="1" cellspacing="1" style="width:680px;"><tbody><tr><td style="text-align:center;vertical-align:middle;"> 
    <table align="center"><thead><tr><th>   属性</th><th>类型</th><th>默认值</th><th>必填</th><th>说明</th></tr></thead><tbody><tr><td>count</td><td>number</td><td>9</td><td>否</td><td>最多可以选择的文件个数</td></tr><tr><td>mediaType</td><td>Array.&lt;string&gt;</td><td>['image', 'video']</td><td>否</td><td>文件类型</td></tr><tr><td>sourceType</td><td>Array.&lt;string&gt;</td><td>['album', 'camera']</td><td>否</td><td>图片和视频选择的来源</td></tr><tr><td>maxDuration</td><td>number</td><td>10</td><td>否</td><td>拍摄视频最长拍摄时间，单位秒。时间范围为 3s 至 60s 之间。不限制相册。</td></tr><tr><td>sizeType</td><td>Array.&lt;string&gt;</td><td>['original', 'compressed']</td><td>否</td><td>仅对 mediaType 为 image 时有效，是否压缩所选文件</td></tr><tr><td>camera</td><td>string</td><td>'back'</td><td>否</td><td>仅在 sourceType 为 camera 时生效，使用前置或后置摄像头</td></tr><tr><td>success</td><td>function</td><td></td><td>否</td><td>接口调用成功的回调函数</td></tr><tr><td>fail</td><td>function</td><td></td><td>否</td><td>接口调用失败的回调函数</td></tr><tr><td>complete</td><td>function</td><td></td><td>否</td><td>接口调用结束的回调函数（调用成功、失败都会执行</td></tr></tbody></table></td></tr></tbody></table> 
<p> </p> 
<p></p> 
<p></p> 
<p> </p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<h4><strong>object.success 回调函数</strong></h4> 
<table><thead><tr><th>属性</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>tempFiles</td><td>Array.&lt;Object&gt;</td><td>本地临时文件列表</td></tr><tr><td colspan="3"> 
    <table><thead><tr><th>结构属性</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>tempFilePath</td><td>string</td><td>本地临时文件路径 (本地路径)</td></tr><tr><td>size</td><td>number</td><td>本地临时文件大小，单位 B</td></tr><tr><td>duration</td><td>number</td><td>视频的时间长度</td></tr><tr><td>height</td><td>number</td><td>视频的高度</td></tr><tr><td>width</td><td>number</td><td>视频的宽度</td></tr><tr><td>thumbTempFilePath</td><td>string</td><td>视频缩略图临时文件路径</td></tr><tr><td>fileType</td><td>string</td><td>文件类型</td></tr><tr><td colspan="3"> 
        <table><thead><tr><th>合法值</th><th>说明</th></tr></thead><tbody><tr><td>image</td><td>图片</td></tr><tr><td>video</td><td>视频</td></tr></tbody></table></td></tr></tbody></table></td></tr><tr><td>type</td><td>string</td><td>文件类型，有效值有 image 、video、mix</td></tr></tbody></table> 
<p>wxml部分</p> 
<pre><code class="language-html">&lt;view class="imageList"&gt;
    &lt;view class="imageItem" wx:for="{<!-- -->{imageList}}" wx:key="index"&gt;
        &lt;image class="image"  mode="aspectFill" bindtap="chooseImage"  data-type="pictures"  data-index="{<!-- -->{index}}" src="{<!-- -->{item.url}}"  alt="" /&gt;
        &lt;view class="delImage" catchtap="delImage" data-idnex="{<!-- -->{index}}"&gt;-&lt;/view&gt;
    &lt;/view&gt;
    &lt;view class="imageItem addImage" bindtap="chooseImage"  data-type="pictures"&gt;&lt;/view&gt;
&lt;/view&gt;</code></pre> 
<p>wxss部分</p> 
<pre><code class="language-css">.imageList {
  padding: 32rpx;
  width: 100vw;
  box-sizing: border-box;

  /* 弹性布局 */
  display: flex;
  flex-direction: row;
  justify-content: flex-start;
  /* 换行 */
  flex-wrap: wrap;

  /* 内容区的实际宽度为
   width: calc(100vw - 64rpx); 
   width: 686rpx; 
    */

}

/* 照片容器的样式 */
.imageList .imageItem {
  margin-bottom: 25rpx;
  width: 212rpx;
  height: 212rpx;
  background: #F7F9FD;
  border-radius: 8rpx;
  border: 5rpx dotted #D0D0D0;
  position: relative;
  /* overflow: hidden; */
  box-sizing: border-box;
}

.imageList .imageItem:nth-child(3n-1) {
  margin: 0 25rpx;
}

/* 图片的样式 */
.imageList .imageItem .image {
  display: block;
  width: 100%;
  height: 100%;
}

/* 删除按钮的样式 */
.imageList .imageItem .delImage {
  width: 32rpx;
  height: 32rpx;
  border-radius: 50%;
  background-color: #e40606;
   color: #ffffff;
  font-size: 32rpx;
  text-align: center;
  line-height: 22rpx;
  position: absolute;
  top: -16rpx;
  right: -16rpx;

  box-sizing: border-box;
}

/* 可以使用背景图 */
.imageList .addImage::before {
  display: block;
  content: "+";
  width: 100rpx;
  height: 100rpx;
  color: #cccccc;
  /* font-weight: 700; */
  font-size: 70rpx;
  text-align: center;
  line-height: 100rpx;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}</code></pre> 
<p>js部分</p> 
<pre><code>Page({
  data: {
    imageList: []
  },
  //选择图片
  chooseImage(e) {
    let index=e.currentTarget.dataset.index
    console.log(index)
    let self = this
    wx.chooseMedia({
      count: 9,
      sizeType: ['original', 'compressed'], //原图 ，压缩图
      sourceType: ['album', 'camera'], //从相处选择 ，使用相机
      success(res) {
        console.log("res___________",res)
        res.tempFiles.forEach((file) =&gt; {
          if(index === undefined){ //添加图片
            self.setData({
              imageList: [...self.data.imageList, {
                url: file.tempFilePath
              }]
            })
          }else{ //替换当前索引下的图片
            self.data.imageList[index].url=file.tempFilePath
            self.setData({
              imageList:self.data.imageList
            })
          }
        })
      }
    })
  },
  //删除图片
  delImage(e) {
    let {
      imageList
    } = this.data
    let index = e.currentTarget.dataset.index
    imageList.splice(index, 1)
    this.setData({
      imageList
    })
  }
})</code></pre> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/40be4c550b7b8a8f26c741223cde90f3/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">MyBatis Plus处理Mysql JSON Data Type类型字段</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6d0a1d11eb615e33e55f16b6bf5782ed/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">java若依框架开发api接口（添加新模块）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>