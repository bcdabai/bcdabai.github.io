<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>KT148A语音芯片智能锁扩展语音地址以及如何支持大量小文件的打包 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="KT148A语音芯片智能锁扩展语音地址以及如何支持大量小文件的打包" />
<meta property="og:description" content="一、语音芯片应用于智能锁的需求 智能锁的语音播放需求中，有很多需要多国语言合并在一起的需求
其中语音文件数多，并且每个语音文件小的特点
如果使用OTP的语音芯片，就很麻烦，因为用户不可烧录，调试也很繁琐
同时大容量的又很贵，所以使用KT148A-sop8的flash型语音芯片就是最优的解决方案
解决KT148A语音芯片应用于智能锁的两个潜在的需求
1、语音文件数量，超过手册给的233的语音地址，假如需要扩展地址，增加到500以上怎么办？
2、客户的语音很多，但是都很小，按照原有的打包方式，非常的占空间，导致空间不够
解决方案 2.1 地址超过233的解决方案 ==》新增F4指令，详见手册“KT148A语音芯片使用手册_V5.pdf”
F4指令存在的意义，是语音超223的数量之后没有地址可用的问题，所以新增此指令。举例说明：
1、如果指定播放291地址的语音，就发送F4 01 23 【01=0x01 高字节】【23=0x23低字节】
==》其中F4为识别码，01 23 组成位0x123 = 291 ，代表第291条语音播放
2、如果指定播放291个语音，就发送F4 04 98 ==》发送F4 04 98，其中04 98 组成位0x498 = 1176 ，代表第1176条语音播放
3、这个F4指令的长度，只能是三个字节【不能多也不能少】，收满F4 01 23之后，立刻开始执行播放
4、收到F4指令之后，会自动等待100ms，如果在这个100ms之内收到0x01这样的语音命令，还会继续再等待100ms ，
==》如果收第2个地址数据0x23，就代表收满了= 0x0123，立刻执行播放291地址语音
==》超过100ms还没有收到地址数据，则认为这一次通讯失败，因为只收到0x11
语音地址，不超过233，则不需要使用这条扩展指令。询问客户，这种操作逻辑，客户可以接受
2.2 更换打包bin文件的方式--工具端 这个步骤的处理，需要联系我们来修改，其实也不复杂，也支持批量烧录
第1步，先把目标文件压缩，将压缩之后的文件发f1a格式，全部拷贝至“audio”文件夹里面
第2步，打开“pRFiles.exe”导入文件，生成“AUDIO.lst”
第3步：双击批处理，生成“dir_story”，注意是没有后缀的
总结 缺点就是不再支持串口下载语音文件。语音的总空间，如上图，看这里就知道了
所以，客户前期的测试，包含语音播放的效果，通讯功能等等
都可以先用默认的版本，去调试
最后确认得差不多了，可以联系我们换一种方式，提供样品给您做最后的确认和测试。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/19fb177975d98f105d5e3b9ba958a8a4/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-16T11:45:18+08:00" />
<meta property="article:modified_time" content="2024-01-16T11:45:18+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">KT148A语音芯片智能锁扩展语音地址以及如何支持大量小文件的打包</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2 style="text-align:justify;"><strong>一、语音芯片应用于智能锁的需求</strong></h2> 
<p style="margin-left:.0001pt;text-align:justify;">智能锁的语音播放需求中，有很多需要多国语言合并在一起的需求</p> 
<p style="margin-left:.0001pt;text-align:justify;">其中语音文件数多，并且每个语音文件小的特点</p> 
<p style="margin-left:.0001pt;text-align:justify;">如果使用OTP的语音芯片，就很麻烦，因为用户不可烧录，调试也很繁琐</p> 
<p style="margin-left:.0001pt;text-align:justify;">同时大容量的又很贵，所以使用KT148A-sop8的flash型语音芯片就是最优的解决方案</p> 
<p style="margin-left:.0001pt;text-align:justify;">解决KT148A语音芯片应用于智能锁的两个潜在的需求</p> 
<p style="margin-left:.0001pt;text-align:justify;">1、语音文件数量，超过手册给的233的语音地址，假如需要扩展地址，增加到500以上怎么办？</p> 
<p style="margin-left:.0001pt;text-align:justify;">2、客户的语音很多，但是都很小，按照原有的打包方式，非常的占空间，导致空间不够</p> 
<p style="margin-left:.0001pt;text-align:center;"><img alt="" src="https://images2.imgbox.com/93/93/7weRv9xh_o.png"></p> 
<ul><li style="text-align:justify;">解决方案</li></ul> 
<h3 style="text-align:justify;">2.1 地址超过233的解决方案</h3> 
<p style="margin-left:.0001pt;text-align:justify;">==》新增F4指令，详见手册“KT148A语音芯片使用手册_V5.pdf”</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong><span style="color:#000000;"><strong>F4指令存在的意义，是语音超223的数量之后没有地址可用的问题，所以新增此指令。举例说明：</strong></span></strong></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">1、如果指定播放291地址的语音，就发送F4 01 23  【01=0x01 高字节】【23=0x23低字节】</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">==》其中F4为识别码，01 23 组成位0x123 = 291 ，代表第291条语音播放</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">2、如果指定播放291个语音，就发送F4 04 98 </span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">==》发送F4 04 98，其中04 98 组成位0x498 = 1176 ，代表第1176条语音播放</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">3、这个F4指令的长度，只能是三个字节【不能多也不能少】，收满F4 01 23之后，立刻开始执行播放</span></p> 
<p style="margin-left:.0001pt;text-align:justify;">4、收到F4指令之后，会自动等待100ms，如果在这个100ms之内收到0x01这样的语音命令，还会继续再等待100ms ，</p> 
<p style="margin-left:.0001pt;text-align:justify;">==》如果收第2个地址数据0x23，就代表收满了= 0x0123，立刻执行播放291地址语音</p> 
<p style="margin-left:.0001pt;text-align:justify;">==》超过100ms还没有收到地址数据，则认为这一次通讯失败，因为只收到0x11</p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong><span style="color:#ff0000;"><strong>语音地址，不超过233，则不需要使用这条扩展指令</strong></span></strong><strong><span style="color:#ff0000;"><strong>。</strong></span></strong><strong><span style="color:#ff0000;"><strong>询问客户，这种操作逻辑，客户可以接受</strong></span></strong></p> 
<h3 style="text-align:justify;">2.2 更换打包bin文件的方式--工具端</h3> 
<p style="margin-left:.0001pt;text-align:justify;">这个步骤的处理，需要联系我们来修改，其实也不复杂，也支持批量烧录</p> 
<p style="margin-left:.0001pt;text-align:center;"><img alt="" src="https://images2.imgbox.com/29/82/Az2l19Cf_o.png"></p> 
<p style="margin-left:.0001pt;text-align:justify;">第1步，先把目标文件压缩，将压缩之后的文件发f1a格式，全部拷贝至“audio”文件夹里面</p> 
<p style="margin-left:.0001pt;text-align:center;"><img alt="" src="https://images2.imgbox.com/b0/3e/tX44SCrv_o.png"></p> 
<p style="margin-left:.0001pt;text-align:justify;">第2步，打开“pRFiles.exe”导入文件，生成“AUDIO.lst”</p> 
<p style="margin-left:.0001pt;text-align:center;"><img alt="" src="https://images2.imgbox.com/93/f6/TDzIyhYn_o.png"></p> 
<p style="margin-left:.0001pt;text-align:justify;">第3步：双击批处理，生成“dir_story”，注意是没有后缀的</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<ul><li style="text-align:justify;">总结</li></ul> 
<p style="margin-left:.0001pt;text-align:justify;">缺点就是不再支持串口下载语音文件。语音的总空间，如上图，看这里就知道了</p> 
<p style="margin-left:.0001pt;text-align:center;"><img alt="" src="https://images2.imgbox.com/4c/84/5tzK519u_o.png"></p> 
<p style="margin-left:.0001pt;text-align:justify;">所以，客户前期的测试，包含语音播放的效果，通讯功能等等</p> 
<p style="margin-left:.0001pt;text-align:justify;">都可以先用默认的版本，去调试</p> 
<p style="margin-left:.0001pt;text-align:justify;">最后确认得差不多了，可以联系我们换一种方式，提供样品给您做最后的确认和测试。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9b437d6ea0ab16f1f900801642239e6e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Mybatis使用IN语句查询</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2fc166b7c5e3f5d1a90a057ed7132941/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Linux上常用网络操作</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>