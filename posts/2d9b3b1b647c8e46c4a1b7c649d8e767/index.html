<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>centos7的日志管理 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="centos7的日志管理" />
<meta property="og:description" content="日志管理 简介 任务一：
rsyslog 系统日志管理
关心问题：哪类程序—》产生的什么日志----》放到什么地方
任务二：
logrotate日志轮转
将大量的日志，分割管理，删除旧日志。
任务一 一 处理日志的进程 rsyslogd： 系统专职日志程序。 处理绝大部分日志记录， 系统操作有关的信息，如登录信息，程序启动关闭信息，错误信息 观察 rsyslogd程序 root@localhost ~]# ps aux |grep rsyslogd
二 常见的日志文件(系统、进程、应用程序) tail -10 /var/log/messages
//系统主日志文件
tail -f /var/log/messages
//动态查看日志文件的尾部
当用户信息变更日志也会相应的变更
# tailf /var/log/secure //认证、安全 # tail /var/log/yum.log //yum # tail /var/log/maillog //跟邮件postfix相关 # tail /var/log/cron //crond、at进程产生的日志 # tail /var/log/dmesg //和系统启动相关 。。。。。。。。。。。 网站日志管理
1.yum install -y httpd安装httpd环境
2.systemctl start httpd开启httpd环境
3.systemctl stop firewalld关闭防火墙
桥接调整网络
systemctl restart network" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/2d9b3b1b647c8e46c4a1b7c649d8e767/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-08-06T20:55:56+08:00" />
<meta property="article:modified_time" content="2020-08-06T20:55:56+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">centos7的日志管理</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>日志管理</h2> 
<h3><a id="_1"></a>简介</h3> 
<p><strong>任务一：<br> rsyslog 系统日志管理<br> 关心问题：哪类程序—》产生的什么日志----》放到什么地方<br> 任务二：<br> logrotate日志轮转<br> 将大量的日志，分割管理，删除旧日志。</strong></p> 
<h3><a id="_8"></a>任务一</h3> 
<h4><a id="__9"></a>一 处理日志的进程</h4> 
<pre><code>rsyslogd： 系统专职日志程序。
处理绝大部分日志记录，
系统操作有关的信息，如登录信息，程序启动关闭信息，错误信息
观察 rsyslogd程序
</code></pre> 
<p><mark>root@localhost ~]# ps aux |grep rsyslogd</mark><br> <img src="https://images2.imgbox.com/77/49/JN66nKWO_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="__17"></a>二 常见的日志文件(系统、进程、应用程序)</h4> 
<p><mark>tail -10 /var/log/messages</mark><br> //系统主日志文件<br> <img src="https://images2.imgbox.com/9f/0d/RtP98LoO_o.png" alt="在这里插入图片描述"></p> 
<p><mark>tail -f /var/log/messages</mark><br> //动态查看日志文件的尾部<br> 当用户信息变更日志也会相应的变更<img src="https://images2.imgbox.com/b5/a5/dpB9Vcsx_o.png" alt="在这里插入图片描述"></p> 
<pre><code># tailf /var/log/secure
	 //认证、安全
# tail /var/log/yum.log
	 //yum
# tail /var/log/maillog
	 //跟邮件postfix相关
# tail /var/log/cron
	//crond、at进程产生的日志
# tail /var/log/dmesg
	 //和系统启动相关
	 。。。。。。。。。。。
</code></pre> 
<p><strong>网站日志管理</strong></p> 
<blockquote> 
 <p><mark>1.yum install -y httpd</mark>安装httpd环境<br> <mark>2.systemctl start httpd</mark>开启httpd环境<br> <mark>3.systemctl stop firewalld</mark>关闭防火墙</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/63/57/FnbGStJZ_o.png" alt="在这里插入图片描述"><br> 桥接调整网络</p> 
<blockquote> 
 <p><mark>systemctl restart network</mark><br> <br> systemctl重启网络</p> 
</blockquote> 
<blockquote> 
 <p>访问本机ip<br> <br> <img src="https://images2.imgbox.com/8a/41/Clon9mi4_o.png" alt="在这里插入图片描述"></p> 
</blockquote> 
<h4><a id="_rsyslogd_54"></a>三 rsyslogd配置</h4> 
<blockquote> 
 <p>1.相关程序<br> <mark>yum install rsyslog logrotate</mark><br> 默认已安装<br> <img src="https://images2.imgbox.com/7d/fa/dRWxzpby_o.png" alt="在这里插入图片描述"></p> 
</blockquote> 
<blockquote> 
 <p>2.启动程序<br> <mark>systemctl start rsyslog.service</mark><br> <br> <mark>rpm -qc rsyslog</mark><br> 查询配置文件<br> <img src="https://images2.imgbox.com/bf/0e/mEdWD0z8_o.png" alt="在这里插入图片描述"><br> <br> <strong>/etc/rsyslog.conf<br> rsyslogd的主配置文件（关键）</strong><br> <em>/etc/sysconfig/rsyslog<br> rsyslogd相关文件，定义级别（了解一下）<br> /etc/logrotate.d/syslog<br> 和日志轮转（切割）相关（任务二）</em></p> 
</blockquote> 
<h4><a id="__74"></a>四 主要配置文件</h4> 
<p><mark># vim /etc/rsyslog.conf</mark></p> 
<h6><a id="RULES_76"></a>RULES</h6> 
<pre><code>RULES：即规则，是一套生成日志，以及存储日志的策略。
RULES即规则，有三部分组成（由设备+级别+存放位置)
	RULES由FACILITY+LEVEL+FILE组成。
authpriv.* 		/var/log/secure（SSH信息）
</code></pre> 
<p>cron.* /var/log/cron（创建任务）</p> 
<pre><code class="prism language-powershell">*<span class="token operator">*</span>mail<span class="token punctuation">.</span><span class="token operator">*</span> 			<span class="token operator">-</span><span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>log<span class="token operator">/</span>maillog（发邮件）
这里有一个<span class="token operator">-</span>符号<span class="token punctuation">,</span> 表示是使用异步的方式记录<span class="token punctuation">,</span> 因为日志一般会比较大<span class="token operator">*</span><span class="token operator">*</span>
</code></pre> 
<p>*.info;mail.none;authpriv.none;cron.none /var/log/messages<br> 系统日志排除了邮件，认证，计划日志。``</p> 
<p><img src="https://images2.imgbox.com/b0/ed/0ZGDqLVA_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="FACILITYLEVEL_91"></a>FACILITY&amp;LEVEL</h6> 
<p>facility<br> 是系统对某种类型APP事件的定义。如AUTHPRIV是安全事件，CRON是计划任务事件。用来收集同类程序日志。</p> 
<blockquote> 
 <p>设备类型<br> <strong>LOG_SYSLOG</strong><br> syslogd自身产生的日志<br> <strong>LOG_AUTHPRIV</strong><br> 安全认证<br> <strong>LOG_CRON</strong><br> 调度程序(cron and at)<br> <strong>LOG_MAIL</strong><br> 邮件系统mail subsystem<br> <strong>LOG_USER (default)</strong><br> 用户相关<br> <strong>LOG_DAEMON</strong><br> 后台进程<br> <strong>LOG_FTP</strong><br> 文件服务器ftp daemon<br> <strong>LOG_KERN</strong><br> 内核设备kernel messages<br> <strong>LOG_LPR</strong><br> 打印机设备<br> printer subsystem<br> <strong>LOG_LOCAL0 through LOG_LOCAL7</strong><br> 用户自定义设备</p> 
</blockquote> 
<blockquote> 
 <p>level级别<br> <strong>LOG_EMERG</strong> 紧急，致命，服务无法继续运行，如配置文件丢失<br> <strong>LOG_ALERT</strong> 报警，需要立即处理，如磁盘空使用95%<br> <strong>LOG_CRIT</strong> 致命行为<br> <strong>LOG_ERR</strong> 错误行为<br> <strong>LOG_WARNING</strong> 警告信息<br> <strong>LOG_NOTICE</strong> 普通，重要的标准信息<br> <strong>LOG_INFO</strong> 标准信息<br> <strong>LOG_DEBUG</strong> 调试信息，排错所需，一般不建议使用<br> 从下到上，级别从低到高，记录的信息越来越少</p> 
</blockquote> 
<h5><a id="_127"></a>程序类型示例</h5> 
<blockquote> 
 <p>关于程序和设备的联系问题，程序自身会决定将日志交给哪类设备。<br> 如SSH程序会选择安全类设备。这一点由开发者定义。<br> 1.修改ssh程序的设备类型<br> vim /etc/ssh/sshd_config<br> #SyslogFacility AUTHPRIV<br> SyslogFacility LOCAL5<br> <img src="https://images2.imgbox.com/de/a3/E3UIo32r_o.png" alt="在这里插入图片描述"></p> 
</blockquote> 
<blockquote> 
 <p>2.修改rsyslog程序的规则<br> vim /etc/rsyslog.conf<br> local5.* /var/log/srevicez<br> <img src="https://images2.imgbox.com/42/57/b5H3oXx0_o.png" alt="在这里插入图片描述"></p> 
</blockquote> 
<p>3.重启rsyslog程序和ssh程序<br> <mark>systemctl restart rsyslog.service sshd</mark><br> 4.使用其他终端，登录服务器，观察新日志文件。</p> 
<h3><a id="_146"></a>任务二</h3> 
<h4><a id="logrotate_148"></a>logrotate日志轮转</h4> 
<h5><a id="_149"></a>简介</h5> 
<pre><code>**日志  记录了程序运行时各种信息。
通过日志可以分析用户行为，记录运行轨迹，查找程序问题。
可惜磁盘的空间是有限的
日志轮转就像飞机里的黑匣子，记录的信息再重要也只能记录最后一段时间发生的事。
为了节省空间和整理方便，日志文件经常需要按！时间或！大小等维度分成多份，删除时间久远的日志文件。**
</code></pre> 
<h5><a id="_156"></a>工作原理</h5> 
<p><strong><mark>按照配置进行轮转</mark></strong></p> 
<pre><code>配置文件种类
	主配置文件：/etc/logrotate.conf
		 (决定每个日志文件如何轮转)
	子配置文件夹：/etc/logrotate.d/*
		自定义配置
		便于管理
观察主文件和子文件
	[root@qianfeng ~]# ls /etc/logrotate.conf /etc/logrotate.d/
/etc/logrotate.conf
/etc/logrotate.d/:
acpid cups iscsiuiolog ppp rpm subscription-manager up2date wpa_supplicant
conman httpd mgetty psacct setroubleshoot syslog vsftpd.log yum
</code></pre> 
<p><img src="https://images2.imgbox.com/3f/4b/K50dF2JO_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="_172"></a>主配置文件介绍</h5> 
<blockquote> 
 <p>[root@localhost ~]# vim /etc/logrotate.conf<br> ====================<br> weekly //轮转的周期，一周轮转<br> rotate 4 //保留4份<br> create //轮转后创建新文件<br> dateext //使用日期作为后缀<br> #compress //是否压缩<br> include /etc/logrotate.d //包含该目录下的子配置文件<br> /var/log/wtmp { //对某日志文件设置轮转的方法<br> monthly //一月轮转一次<br> minsize 1M //最小达到1M才轮转,monthly and minsize(同时达到两个条件)<br> create 0664 root utmp //轮转后创建新文件，并设置权限<br> rotate 1 //保留一份<br> }<br> /var/log/btmp {<!-- --><br> missingok //丢失不提示<br> monthly //每月轮转一次<br> create 0600 root utmp //轮转后创建新文件，并设置权限<br> rotate 1 //保留一份<br> }<br> <img src="https://images2.imgbox.com/2e/d0/J8Ee1uYB_o.png" alt="在这里插入图片描述"></p> 
</blockquote> 
<h4><a id="_195"></a>日志轮转实例</h4> 
<blockquote> 
 <p>配置轮转规则<br> # vim /etc/logrotate.d/yum<br> /var/log/yum.log {<!-- --><br> missingok //丢失不执行<br> # notifempty //空文件不论转<br> # maxsize 30k //达到30k轮转, daily or size<br> # yearly //或者一年一轮转<br> daily //缩小周期到1天<br> rotate 3 //轮转保留3次<br> create 0777 root root<br> }<br> <img src="https://images2.imgbox.com/f9/eb/JTNyY6AN_o.png" alt="在这里插入图片描述"></p> 
</blockquote> 
<blockquote> 
 <p>正确示范<br> 修改时间，手动触发轮转<br> # date 04011000<br> date 月日时分<br> 把时间向未来推移<br> # /usr/sbin/logrotate -s /var/lib/logrotate/logrotate.status /etc/logrotate.conf<br> # ls /var/log/yum*<br> 日志文件已经出现多个<br> <img src="https://images2.imgbox.com/96/a4/YdCC1Eu2_o.png" alt="在这里插入图片描述"></p> 
</blockquote> 
<pre><code>关于时间
# grep 'yum' /var/lib/logrotate/logrotate.status //记录所有日志文件最近轮转的时间
"/var/log/yum.log" 2019-3-31-10:0:23
	//如果没有轮转过，第一次只有记录
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4bdb3ec431705beefc15962e01b7adf9/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">OCI runtime exec failed: exec failed: container_linux.go:349: starting container 解决方法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/dc7a72d1550680516346bf60e5da7322/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">[acwing面向模型编程]最长上升子序列模型</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>