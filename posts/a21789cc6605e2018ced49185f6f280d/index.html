<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Unix 环境高级编程（一）：开发环境 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Unix 环境高级编程（一）：开发环境" />
<meta property="og:description" content="Unix 环境高级编程（一）：开发环境 一、Unix操作系统二、Linux操作系统三、GNU编译工具（GCC）1、简介2、基本用法3、文件后缀4、构建过程5、预处理指令6、预定义宏7、环境变量 四、静态库1、简介2、创建静态库3、ar 指令4、调用静态库 五、共享库1、简介2、创建共享库3、调用共享库3、运行 六、动态加载共享库1、头文件2、加载共享库3、获取函数地址4、卸载共享库5、 获取错误信息 七、辅助工具 一、Unix操作系统 二、Linux操作系统 三、GNU编译工具（GCC） 1、简介 GCC是以GPL许可证所发行的自由软件，也是GNU计划的关键部分。GCC的初衷是为GNU操作系统专门编写一款编译器，现已被大多数类Unix操作系统（如Linux、BSD、MacOS X等）采纳为标准的编译器，甚至在微软的Windows上也可以使用GCC。GCC支持多种计算机体系结构芯片，如x86、ARM、MIPS等，并已被移植到其他多种硬件平台。
GCC原名为GNU C语言编译器（GNU C Compiler），只能处理C语言。但其很快扩展，变得可处理C&#43;&#43;，后来又扩展为能够支持更多编程语言，如Fortran、Pascal、Objective -C、Java、Ada、Go以及各类处理器架构上的汇编语言等，所以改名GNU编译器套件（GNU Compiler Collection）。
2、基本用法 gcc [options] [filenames] /* GCC最基本的用法是∶gcc [options] [filenames] * 其中 options 就是编译器所需要的参数 * filenames 给出相关的文件名称 * */ -c /* 只编译，不链接成为可执行文件， * 编译器只是由输入的.c等源代码文件生成.o为后缀的目标文件， * 通常用于编译不包含主程序的子程序文件 * */ -o /* output_filename，确定输出文件的名称为output_filename， * 同时这个名称不能和源文件同名。 * 如果不给出这个选项，gcc就给出预设的可执行文件a.out * */ -x /* 设定文件所使用的语言, 使后缀名无效, 对以后的多个有效 * 根据约定 C 语言的后缀名称是 .c 的， * 而 C&#43;&#43; 的后缀名是 ." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/a21789cc6605e2018ced49185f6f280d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-08-21T12:24:08+08:00" />
<meta property="article:modified_time" content="2022-08-21T12:24:08+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Unix 环境高级编程（一）：开发环境</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>Unix 环境高级编程（一）：开发环境</h4> 
 <ul><li><a href="#Unix_1" rel="nofollow">一、Unix操作系统</a></li><li><a href="#Linux_2" rel="nofollow">二、Linux操作系统</a></li><li><a href="#GNUGCC_3" rel="nofollow">三、GNU编译工具（GCC）</a></li><li><ul><li><a href="#1_4" rel="nofollow">1、简介</a></li><li><a href="#2_8" rel="nofollow">2、基本用法</a></li><li><a href="#3_63" rel="nofollow">3、文件后缀</a></li><li><a href="#4_81" rel="nofollow">4、构建过程</a></li><li><a href="#5_112" rel="nofollow">5、预处理指令</a></li><li><a href="#6_243" rel="nofollow">6、预定义宏</a></li><li><a href="#7_308" rel="nofollow">7、环境变量</a></li></ul> 
  </li><li><a href="#_363" rel="nofollow">四、静态库</a></li><li><ul><li><a href="#1_364" rel="nofollow">1、简介</a></li><li><a href="#2_368" rel="nofollow">2、创建静态库</a></li><li><a href="#3ar__384" rel="nofollow">3、ar 指令</a></li><li><a href="#4_395" rel="nofollow">4、调用静态库</a></li></ul> 
  </li><li><a href="#_420" rel="nofollow">五、共享库</a></li><li><ul><li><a href="#1_421" rel="nofollow">1、简介</a></li><li><a href="#2_425" rel="nofollow">2、创建共享库</a></li><li><a href="#3_449" rel="nofollow">3、调用共享库</a></li><li><a href="#3_472" rel="nofollow">3、运行</a></li></ul> 
  </li><li><a href="#_477" rel="nofollow">六、动态加载共享库</a></li><li><ul><li><a href="#1_478" rel="nofollow">1、头文件</a></li><li><a href="#2_483" rel="nofollow">2、加载共享库</a></li><li><a href="#3_499" rel="nofollow">3、获取函数地址</a></li><li><a href="#4_512" rel="nofollow">4、卸载共享库</a></li><li><a href="#5__520" rel="nofollow">5、 获取错误信息</a></li></ul> 
  </li><li><a href="#_529" rel="nofollow">七、辅助工具</a></li></ul> 
</div> 
<p></p> 
<h2><a id="Unix_1"></a>一、Unix操作系统</h2> 
<h2><a id="Linux_2"></a>二、Linux操作系统</h2> 
<h2><a id="GNUGCC_3"></a>三、GNU编译工具（GCC）</h2> 
<h3><a id="1_4"></a>1、简介</h3> 
<p>  GCC是以GPL许可证所发行的自由软件，也是GNU计划的关键部分。GCC的初衷是为GNU操作系统专门编写一款编译器，现已被大多数类Unix操作系统（如Linux、BSD、MacOS X等）采纳为标准的编译器，甚至在微软的Windows上也可以使用GCC。GCC支持多种计算机体系结构芯片，如x86、ARM、MIPS等，并已被移植到其他多种硬件平台。</p> 
<p>  GCC原名为GNU C语言编译器（GNU C Compiler），只能处理C语言。但其很快扩展，变得可处理C++，后来又扩展为能够支持更多编程语言，如Fortran、Pascal、Objective -C、Java、Ada、Go以及各类处理器架构上的汇编语言等，所以改名GNU编译器套件（GNU Compiler Collection）。</p> 
<h3><a id="2_8"></a>2、基本用法</h3> 
<pre><code class="prism language-c">gcc <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token punctuation">[</span>filenames<span class="token punctuation">]</span> 
<span class="token comment">/* GCC最基本的用法是∶gcc [options] [filenames] 
 * 其中 options 就是编译器所需要的参数
 * filenames 给出相关的文件名称
 * */</span>

<span class="token operator">-</span>c <span class="token comment">/* 只编译，不链接成为可执行文件，
	* 编译器只是由输入的.c等源代码文件生成.o为后缀的目标文件，
	* 通常用于编译不包含主程序的子程序文件 
	* */</span>
	
<span class="token operator">-</span>o <span class="token comment">/* output_filename，确定输出文件的名称为output_filename，
	* 同时这个名称不能和源文件同名。
	* 如果不给出这个选项，gcc就给出预设的可执行文件a.out 
	* */</span>

<span class="token operator">-</span>x <span class="token comment">/* 设定文件所使用的语言, 使后缀名无效, 对以后的多个有效
	* 根据约定 C 语言的后缀名称是 .c 的，
	* 而 C++ 的后缀名是 .C 或者 .cpp, 
	* 如果你很个性，决定你的 C 代码文件的后缀名是 .pig ，
	* 那你就要用这个参数, 这个参数对他后面的文件名都起作用，
	* 除非到了下一个参数的使用
	*  */</span>

<span class="token operator">-</span>I <span class="token comment">/* Idirname，
	* 将dirname所指出的目录加入到程序头文件目录列表中，
	* 是在预编译过程中使用的参数 
	* */</span>

<span class="token operator">-</span>E <span class="token comment">/* 只激活预处理,这个不生成文件, 
	* 你需要把它重定向到一个输出文件里面 
	* */</span>

<span class="token operator">-</span>S <span class="token comment">/* 只激活预处理和编译，就是指把文件编译成为汇编代码 */</span>
	
<span class="token operator">-</span>g <span class="token comment">/* 产生符号调试工具（GNU的gdb）所必要的符号资讯，
	* 要想对源代码进行调试，我们就必须加入这个选项
	*  */</span>

<span class="token operator">-</span>O <span class="token comment">/* 对程序进行优化编译、链接，
	* 采用这个选项，整个源代码会在编译、链接过程中进行优化处理，
	* 这样产生的可执行文件的执行效率可以提高，
	* 但是，编译、链接的速度就相应地要慢一些 
	* */</span>

<span class="token operator">-</span>v 			<span class="token comment">/*  gcc执行时执行的详细过程，gcc及其相关程序的版本号 */</span>

<span class="token operator">-</span>pedantic 	<span class="token comment">/* 对不符合ANSI/ISO C语言标准的扩展语法产生警告 */</span>

<span class="token operator">-</span>Wall 		<span class="token comment">/* 产生尽可能多的警告 */</span>

<span class="token operator">-</span>Werror 	<span class="token comment">/* 将警告作为错误处理 */</span>
</code></pre> 
<h3><a id="3_63"></a>3、文件后缀</h3> 
<pre><code class="prism language-c"><span class="token punctuation">.</span>c		<span class="token comment">/* C语言源代码文件 */</span>

<span class="token punctuation">.</span>h		<span class="token comment">/* 程序所包含的头文件 */</span>

<span class="token punctuation">.</span>i		<span class="token comment">/* 预处理后的C语言源代码文件 */</span>

<span class="token punctuation">.</span>s		<span class="token comment">/* 汇编语言文件 */</span>

<span class="token punctuation">.</span>S		<span class="token comment">/* 经过预编译的汇编语言源代码文件 */</span>

<span class="token punctuation">.</span>o		<span class="token comment">/* 编译后的目标文件 */</span>

<span class="token punctuation">.</span>a		<span class="token comment">/* 静态库文件 */</span>

<span class="token punctuation">.</span>so		<span class="token comment">/* 共享库(动态库)文件 */</span>
</code></pre> 
<h3><a id="4_81"></a>4、构建过程</h3> 
<p>编辑 -&gt; 预编译（预处理）-&gt; 编译 -&gt; 汇编 -&gt; 链接</p> 
<ol><li>编辑（hello.c）</li></ol> 
<pre><code class="prism language-c"><span class="token comment">/* 使用 vim 编辑器编写代码 */</span>
vim hello<span class="token punctuation">.</span>c
</code></pre> 
<ol start="2"><li>预编译（hello.i）</li></ol> 
<pre><code class="prism language-c"><span class="token comment">/* 使用 -E 选项，生成 .i 预编译文件
 * 这个过程处理宏定义和include，去除注释，不会对语法进行检查
 */</span>
gcc <span class="token operator">-</span>E hello<span class="token punctuation">.</span>c <span class="token operator">-</span>o hello<span class="token punctuation">.</span>i
</code></pre> 
<ol start="3"><li>编译（hello.s）</li></ol> 
<pre><code class="prism language-c"><span class="token comment">/* 使用 -S 选项，生成 .s 汇编文件
 * 这个阶段，检查语法
 */</span>
gcc <span class="token operator">-</span>S hello<span class="token punctuation">.</span>i
</code></pre> 
<ol start="4"><li>汇编（hello.o）</li></ol> 
<pre><code class="prism language-c"><span class="token comment">/* 使用 -c 选项，生成 .o 目标文件 */</span>
gcc <span class="token operator">-</span>c hello<span class="token punctuation">.</span>s
</code></pre> 
<ol start="5"><li>链接（hello）</li></ol> 
<pre><code class="prism language-c"><span class="token comment">/* 使用 -o 选项，生成可执行文件 */</span>
gcc hello<span class="token punctuation">.</span>o <span class="token operator">-</span>o hello
</code></pre> 
<h3><a id="5_112"></a>5、预处理指令</h3> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span>      <span class="token comment">// 将指定文件的内容插至此指令处 </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token expression">_next </span><span class="token comment">// 与#include一样，但从当前目录之后的目录查找，极少用</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span>       <span class="token comment">// 定义宏</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">undef</span>        <span class="token comment">// 删除宏</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span>           <span class="token comment">// 判定</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span>        <span class="token comment">// 判定宏是否已定义</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span>       <span class="token comment">// 判定宏是否未定义</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">else</span>         <span class="token comment">// 与#if、#ifdef、#ifndef结合使用</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">elif</span>         <span class="token comment">// else if多选分支</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span>        <span class="token comment">// 结束判定</span></span>
##            <span class="token comment">// 连接宏内两个连续的字符串</span>
#             <span class="token comment">// 将宏参数扩展成字符串字面值</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">error</span>        <span class="token comment">// 产生错误，结束预处理</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">warning</span>      <span class="token comment">// 产生警告</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span>       <span class="token comment">// 提供额外信息的标准方法，可用于指定平台</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">GCC dependency <span class="token operator">&lt;</span>文件<span class="token operator">&gt;</span>     </span><span class="token comment">// 若&lt;文件&gt;比此文件新则产生警告</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">GCC poison <span class="token operator">&lt;</span>标识<span class="token operator">&gt;</span>         </span><span class="token comment">// 若出现&lt;标识&gt;则产生错 误</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression"><span class="token function">pack</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">/</span><span class="token number">2</span><span class="token operator">/</span><span class="token number">4</span><span class="token operator">/</span><span class="token number">8</span><span class="token punctuation">)</span>             </span><span class="token comment">// 按1/2/4/8字节对齐补齐</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">line</span>                             <span class="token comment">// 指定行号</span></span>
</code></pre> 
<p>For example:</p> 
<ol><li>error.c</li></ol> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span>VERSION <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span></span></span>
	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">error</span> <span class="token string">"Version is too low!"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">elif</span> <span class="token expression"><span class="token punctuation">(</span>VERSION <span class="token operator">&gt;</span> <span class="token number">4</span><span class="token punctuation">)</span></span></span>
	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">warning</span> <span class="token string">"version is too high!"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Version is :%d\n"</span><span class="token punctuation">,</span> VERSION<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/fb/47/ylHXGJt0_o.png" alt="在这里插入图片描述"></p> 
<ol start="2"><li>line.c</li></ol> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"line is %d\n"</span><span class="token punctuation">,</span> <span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">line</span> <span class="token expression"><span class="token number">100</span></span></span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"line is %d\n"</span><span class="token punctuation">,</span> <span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	

	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/c9/8c/GhYjsR3X_o.png" alt="在这里插入图片描述"></p> 
<ol start="3"><li>pragma.c</li></ol> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">GCC dependency </span><span class="token string">"tmp.c"</span> <span class="token comment">// 若tmp.c比此文件新则产生警告</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
		

	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/a5/54/38dTbmdS_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">GCC poison <span class="token keyword">goto</span> <span class="token keyword">float</span>  </span><span class="token comment">// 若出现 goto 或 float 则产生错误</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>

	<span class="token keyword">float</span> a<span class="token punctuation">;</span>
		
loop <span class="token operator">:</span>
	<span class="token keyword">goto</span> loop<span class="token punctuation">;</span>

	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/1e/3c/34OE8aGG_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-c"><span class="token comment">/* 64位操作系统下，默认8字节对齐 */</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression"><span class="token function">pack</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span></span>
    <span class="token keyword">struct</span> <span class="token class-name">S1</span> 
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">double</span> d<span class="token punctuation">;</span>
        <span class="token keyword">char</span>   c<span class="token punctuation">;</span>
        <span class="token keyword">int</span>    i<span class="token punctuation">;</span>
        <span class="token keyword">short</span>  h<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// DDDDDDDDCIIIIHH, 15</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression"><span class="token function">pack</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span></span></span>
    <span class="token keyword">struct</span> <span class="token class-name">S2</span> 
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">double</span> d<span class="token punctuation">;</span>
        <span class="token keyword">char</span>   c<span class="token punctuation">;</span>
        <span class="token keyword">int</span>    i<span class="token punctuation">;</span>
        <span class="token keyword">short</span>  h<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// DDDDDDDDCXXXIIIIHHXX, 20</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression"><span class="token function">pack</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span></span></span>
    <span class="token keyword">struct</span> <span class="token class-name">S3</span> 
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">double</span> d<span class="token punctuation">;</span>
        <span class="token keyword">char</span>   c<span class="token punctuation">;</span>
        <span class="token keyword">int</span>    i<span class="token punctuation">;</span>
        <span class="token keyword">short</span>  h<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// DDDDDDDDCXXXXXXXIIIIHHXX, 24</span>


<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression"><span class="token function">pack</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span></span>
    <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"S1: %lu字节\n"</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">S1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"S2: %lu字节\n"</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">S2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"S3: %lu字节\n"</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">S3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/b5/07/VFNX7PZR_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="6_243"></a>6、预定义宏</h3> 
<pre><code class="prism language-c">__BASE_FILE__     <span class="token comment">// 正在编译的源文件名</span>
<span class="token constant">__FILE__</span>          <span class="token comment">// 所在文件名</span>
<span class="token constant">__LINE__</span>          <span class="token comment">// 行号</span>
__FUNCTION__      <span class="token comment">// 函数名</span>
<span class="token constant">__func__</span>          <span class="token comment">// 同__FUNCTION__</span>
<span class="token constant">__DATE__</span>          <span class="token comment">// 日期</span>
<span class="token constant">__TIME__</span>          <span class="token comment">// 时间</span>
__INCLUDE_LEVEL__ <span class="token comment">// 包含层数，从0开始</span>
__cplusplus       <span class="token comment">// C++编译器将其定义为1，</span>
                  <span class="token comment">// C编译器不定义该宏</span>
</code></pre> 
<p>For example:</p> 
<ol><li>print.h</li></ol> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">_PRINT_H</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_PRINT_H</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>

<span class="token keyword">void</span> <span class="token function">print</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span>
    <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"__BASE_FILE__     : %s\n"</span><span class="token punctuation">,</span> __BASE_FILE__<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"__FILE__          : %s\n"</span><span class="token punctuation">,</span> <span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"__LINE__          : %d\n"</span><span class="token punctuation">,</span> <span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"__FUNCTION__      : %s\n"</span><span class="token punctuation">,</span> __FUNCTION__<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"__func__          : %s\n"</span><span class="token punctuation">,</span> <span class="token constant">__func__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"__DATE__          : %s\n"</span><span class="token punctuation">,</span> <span class="token constant">__DATE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"__TIME__          : %s\n"</span><span class="token punctuation">,</span> <span class="token constant">__TIME__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"__INCLUDE_LEVEL__ : %d\n"</span><span class="token punctuation">,</span> __INCLUDE_LEVEL__<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">__cplusplus</span></span>
    <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"__cplusplus       : %d\n"</span><span class="token punctuation">,</span> __cplusplus<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span> <span class="token comment">// __cplusplus</span></span>
<span class="token punctuation">}</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span><span class="token comment">//_PRINT_H</span></span>
</code></pre> 
<ol start="2"><li>predef.h</li></ol> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">_PREDEF_H</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_PREDEF_H</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"print.h"</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span><span class="token comment">//_PREDEF_H</span></span>

</code></pre> 
<ol start="3"><li>predef.c</li></ol> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"predef.h"</span></span>


<span class="token keyword">int</span> <span class="token function">main</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span>
    <span class="token function">print</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/ff/ec/1vy99YDD_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/89/96/WpHTLg9v_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="7_308"></a>7、环境变量</h3> 
<pre><code class="prism language-c">C_INCLUDE_PATH     <span class="token comment">// C头文件的附加搜索路径，相当于gcc的-I选项</span>
CPATH              <span class="token comment">// 同C_INCLUDE_PATH</span>
CPLUS_INCLUDE_PATH <span class="token comment">// C++头文件的附加搜索路径</span>
LIBRARY_PATH       <span class="token comment">// 链接时查找静态库/共享库的路径</span>
LD_LIBRARY_PATH    <span class="token comment">// 运行时查找共享库的路径</span>
</code></pre> 
<ol><li>通过gcc的-I选项指定C/C++头文件的附加搜索路径</li></ol> 
<pre><code class="prism language-c">gcc calc<span class="token punctuation">.</span>c cpath<span class="token punctuation">.</span>c <span class="token operator">-</span>I<span class="token punctuation">.</span>
</code></pre> 
<ol start="2"><li>将当前目录作为C头文件附加搜索路径，添加到CPATH环境变量中</li></ol> 
<pre><code class="prism language-c">export CPATH<span class="token operator">=</span>$CPATH<span class="token operator">:</span><span class="token punctuation">.</span> <span class="token comment">// export保证当前shell的,子进程继承此环境变量</span>
echo $CPATH
env <span class="token operator">|</span> grep CPATH
</code></pre> 
<ol start="3"><li>也可以在<sub>/.bashrc或</sub>/.bash_profile，配置文件中写环境变量，永久有效</li></ol> 
<pre><code class="prism language-c">export CPATH<span class="token operator">=</span>$CPATH<span class="token operator">:</span><span class="token punctuation">.</span>
执行
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">source</span> <span class="token expression"><span class="token operator">~</span><span class="token operator">/</span><span class="token punctuation">.</span>bashrc 或 # source <span class="token operator">~</span><span class="token operator">/</span><span class="token punctuation">.</span>bash_profile</span></span>
<span class="token comment">//生效，以后每次登录自动生效。</span>
</code></pre> 
<ol start="4"><li>头文件的三种定位方式<br> a）#include “目录/xxx.h”<br>   头文件路径发生变化，需要修改源程序<br> b）C_INCLUDE_PATH/CPATH=目录<br>   同时构建多个工程，可能引发冲突<br> c）gcc -I目录<br>   既不用改程序，也不会有冲突</li><li>头文件的作用<br> a）声明外部变量、函数和类<br> b）定义宏、类型别名和自定义类型<br> c）包含其它头文件<br> d）借助头文件卫士，防止因同一个头文件被多次包含，而引发重定义错</li><li>包含头文件时需要注意的问题<br> a）gcc的-I选项<br>   指定头文件附加搜索路径<br> b）#include &lt;…&gt;<br>   先找-I指定的目录，再找系统目录<br> c）#include “…”<br>   先找-I指定的目录，再找当前目录，最后找系统目录<br> d）头文件的系统目录</li></ol> 
<pre><code class="prism language-c"><span class="token operator">/</span>usr<span class="token operator">/</span>include 
<span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>include 
<span class="token operator">/</span>usr<span class="token operator">/</span>lib<span class="token operator">/</span>gcc<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">/</span><span class="token number">5.4</span><span class="token number">.0</span><span class="token operator">/</span>include
</code></pre> 
<h2><a id="_363"></a>四、静态库</h2> 
<h3><a id="1_364"></a>1、简介</h3> 
<ol><li>链接静态库是将库中的被调用代码复制到调用模块中</li><li>静态库占用空间非常大，不易修改但执行效率高</li><li>静态库的缺省扩展名是.a</li></ol> 
<h3><a id="2_368"></a>2、创建静态库</h3> 
<ol><li>编辑源代码</li></ol> 
<pre><code class="prism language-c">vim xxx<span class="token punctuation">.</span>c<span class="token operator">/</span>xxx<span class="token punctuation">.</span>h
</code></pre> 
<ol start="2"><li>编译成目标文件</li></ol> 
<pre><code class="prism language-c">gcc <span class="token operator">-</span>c xxx<span class="token punctuation">.</span>c <span class="token operator">-</span>o xxx<span class="token punctuation">.</span>o
</code></pre> 
<ol start="3"><li>打包成静态库文件</li></ol> 
<pre><code class="prism language-c">ar <span class="token operator">-</span>r libxxx<span class="token punctuation">.</span>a xxx<span class="token punctuation">.</span>o <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre> 
<h3><a id="3ar__384"></a>3、ar 指令</h3> 
<pre><code class="prism language-c">ar指令：ar <span class="token punctuation">[</span>选项<span class="token punctuation">]</span> 静态库文件名 目标文件列表 
<span class="token operator">-</span>r <span class="token comment">// 将目标文件插入到静态库中，已存在则更新 </span>
<span class="token operator">-</span>q <span class="token comment">// 将目标文件追加到静态库尾 </span>
<span class="token operator">-</span>d <span class="token comment">// 从静态库中删除目标文件 </span>
<span class="token operator">-</span>t <span class="token comment">// 列表显示静态库中的目标文件 </span>
<span class="token operator">-</span>x <span class="token comment">// 将静态库展开为目标文件 </span>
<span class="token comment">/* 注意：提供静态库的同时也需要提供头文件 */</span>
</code></pre> 
<h3><a id="4_395"></a>4、调用静态库</h3> 
<ol><li>直接调用</li></ol> 
<pre><code class="prism language-c">gcc main<span class="token punctuation">.</span>c libxxx<span class="token punctuation">.</span>a
</code></pre> 
<ol start="2"><li>通过LIBRARY_PATH环境变量指定库路径</li></ol> 
<pre><code class="prism language-c">export LIBRARY_PATH<span class="token operator">=</span>$LIBRARY_PATH<span class="token operator">:</span><span class="token punctuation">.</span>
gcc main<span class="token punctuation">.</span>c <span class="token operator">-</span><span class="token function">lmath</span> <span class="token punctuation">(</span>环境法<span class="token punctuation">)</span>
</code></pre> 
<ol start="3"><li>通过gcc的-L选项指定库路径</li></ol> 
<pre><code class="prism language-c">unset LIBRARY_PATH
gcc main<span class="token punctuation">.</span>c <span class="token operator">-</span>lmath <span class="token operator">-</span>L<span class="token punctuation">.</span> <span class="token punctuation">(</span>参数法<span class="token punctuation">)</span>
</code></pre> 
<ol start="4"><li>一般化的方法：</li></ol> 
<pre><code class="prism language-c">gcc <span class="token punctuation">.</span>c<span class="token operator">/</span><span class="token punctuation">.</span>o <span class="token operator">-</span>l<span class="token operator">&lt;</span>库名<span class="token operator">&gt;</span> <span class="token operator">-</span>L<span class="token operator">&lt;</span>库路径<span class="token operator">&gt;</span>
</code></pre> 
<ol start="5"><li>运行<br>   在可执行程序的链接阶段，已将所调用的函数的二进制代码，复制到可执行程序中，因此运行时不需要依赖静态库。</li></ol> 
<h2><a id="_420"></a>五、共享库</h2> 
<h3><a id="1_421"></a>1、简介</h3> 
<ol><li>链接共享库则只是在调用模块中，嵌入被调用代码在库中的(相对)地址</li><li>共享库占用空间小，易于修改但执行效率略低</li><li>共享库的缺省扩展名是.so</li></ol> 
<h3><a id="2_425"></a>2、创建共享库</h3> 
<ol><li>编辑源程序</li></ol> 
<pre><code class="prism language-c">vim xxx<span class="token punctuation">.</span>x<span class="token operator">/</span>xxx<span class="token punctuation">.</span>h
</code></pre> 
<ol start="2"><li>编译成目标文件</li></ol> 
<pre><code class="prism language-c">gcc <span class="token operator">-</span>c <span class="token operator">-</span>fpic xxx<span class="token punctuation">.</span>c
</code></pre> 
<ol start="3"><li>链接成共享库文件</li></ol> 
<pre><code class="prism language-c">gcc <span class="token operator">-</span>shared xxx<span class="token punctuation">.</span>o <span class="token operator">-</span>o libxxx<span class="token punctuation">.</span>so
</code></pre> 
<ol start="4"><li>PIC (Position Independent Code)<br>   位置无关代码。可执行程序加载它们时，可将其映射到其地址空间的任何位置。</li></ol> 
<pre><code class="prism language-c"><span class="token operator">-</span>fPIC <span class="token comment">// 大模式，生成代码比较大，运行速度比较慢，所有平台都支持。 </span>
<span class="token operator">-</span>fpic <span class="token comment">// 小模式，生成代码比较小，运行速度比较快，仅部分平台支持。 </span>
<span class="token comment">/* 注意：提供共享库的同时也需要提供头文件 */</span>
</code></pre> 
<h3><a id="3_449"></a>3、调用共享库</h3> 
<ol><li>直接调用</li></ol> 
<pre><code class="prism language-c">gcc main<span class="token punctuation">.</span>c libxxx<span class="token punctuation">.</span>so
</code></pre> 
<ol start="2"><li>通过LIBRARY_PATH环境变量指定库路径</li></ol> 
<pre><code class="prism language-c">export LIBRARY_PATH<span class="token operator">=</span>$LIBRARY_PATH<span class="token operator">:</span><span class="token punctuation">.</span>
gcc main<span class="token punctuation">.</span>c <span class="token operator">-</span><span class="token function">lmath</span> <span class="token punctuation">(</span>环境法<span class="token punctuation">)</span>
</code></pre> 
<ol start="3"><li>通过gcc的-L选项指定库路径</li></ol> 
<pre><code class="prism language-c">unset LIBRARY_PATH
gcc main<span class="token punctuation">.</span>c <span class="token operator">-</span>lmath <span class="token operator">-</span>L<span class="token punctuation">.</span> <span class="token punctuation">(</span>参数法<span class="token punctuation">)</span>
</code></pre> 
<ol start="4"><li>一般化的方法</li></ol> 
<pre><code class="prism language-c">gcc <span class="token punctuation">.</span>c<span class="token operator">/</span><span class="token punctuation">.</span>o <span class="token operator">-</span>l<span class="token operator">&lt;</span>库名<span class="token operator">&gt;</span> <span class="token operator">-</span>L<span class="token operator">&lt;</span>库路径<span class="token operator">&gt;</span>
</code></pre> 
<h3><a id="3_472"></a>3、运行</h3> 
<p>  运行时需要保证LD_LIBRARY_PATH，环境变量中包含共享库所在的路径。<br>   在可执行程序的链接阶段，并不将所调用函数的二进制代码复制到可执行程序中。<br>   而只是将该函数在共享库中的地址嵌入到可执行程序中，因此运行时需要依赖共享库。<br>   gcc缺省链接共享库，可通过-static选项强制链接静态库。</p> 
<h2><a id="_477"></a>六、动态加载共享库</h2> 
<h3><a id="1_478"></a>1、头文件</h3> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;dlfcn.h&gt;</span></span>
</code></pre> 
<h3><a id="2_483"></a>2、加载共享库</h3> 
<pre><code class="prism language-c"><span class="token comment">/*
* 返回值：
* 		成功返回共享库句柄，失败返回NULL。
* 
* 参数：
*   filename：共享库路径
*      若只给文件名，则根据LD_LIBRARY_PATH环境变量搜索。
*   flag取值：加载方式
*      RTLD_LAZY - 延迟加载，使用共享库中的符号 (如调用函数)时才加载。 
*      RTLD_NOW  - 立即加载。
*/</span>
<span class="token keyword">void</span><span class="token operator">*</span> <span class="token function">dlopen</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> filename<span class="token punctuation">,</span>    <span class="token keyword">int</span> flag<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="3_499"></a>3、获取函数地址</h3> 
<pre><code class="prism language-c"><span class="token comment">/*
 * 返回值：
 * 		成功返回函数地址，失败返回NULL。
 * 
 * 参数：
 * 		hanedle:共享库句柄
 * 		symbol:函数名
 */</span>
<span class="token keyword">void</span><span class="token operator">*</span> <span class="token function">dlsym</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> handle<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> symbol <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="4_512"></a>4、卸载共享库</h3> 
<pre><code class="prism language-c"><span class="token comment">/*
 * 成功返回0，失败返回非零。
 */</span>
<span class="token keyword">int</span> <span class="token function">dlclose</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="5__520"></a>5、 获取错误信息</h3> 
<pre><code class="prism language-c"><span class="token comment">/*
 * 有错误发生则返回错误信息字符串指针，否则返回NULL。
 */</span>
<span class="token keyword">char</span><span class="token operator">*</span> <span class="token function">dlerror</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h2><a id="_529"></a>七、辅助工具</h2>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/fb03e565c8b3042fd5cb9fafb9b7195e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Chrome浏览器无法登录Google账号</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a0be8977cf9a2783162b412763bbbe29/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">数据结构-B树删除示例</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>