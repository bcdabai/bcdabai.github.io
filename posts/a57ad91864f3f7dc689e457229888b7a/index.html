<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Django DRF 视图基类 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Django DRF 视图基类" />
<meta property="og:description" content="文章目录 1. 引子2. 视图基类2.1 APIView2.1.1 APIView 与 View 的不同之处2.1.2 支持定义的类属性2.1.3 CBV 源码分析2.1.4 APIView 执行流程分析2.1.5 Request 对象2.1.5 Request 对象源码分析2.1.6 自定义 data2.1.7 Response 对象2.1.8 使用 APIView 编写 5 个接口 2.2 GenericAPIView2.2.1 serializer_class2.2.2 queryset2.2.3 使用 GenericAPIView 编写 5 个接口 1. 引子 Django REST framwork 提供了众多的通用视图基类与扩展类，以简化视图的编写。
REST framework 提供的视图的主要作用有：
控制序列化器的执行（检验、保存、转换数据）控制数据库查询的执行 在此之前需要注意的是，DRF 是一个 app，也需要在配置文件中注册。
INSTALLED_APPS = [ &#39;django.contrib.admin&#39;,	# 后台管理，系统自带后台管理 admin &#39;django.contrib.auth&#39;,	# 权限管理会生成6张表 &#39;django.contrib.contenttypes&#39;,	# 可以对所有 app 的表进行记录 &#39;django.contrib.sessions&#39;,	# session功能，也就是 django_session表 &#39;django.contrib.messages&#39;,	# django消息框架 flask的闪现 &#39;django." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/a57ad91864f3f7dc689e457229888b7a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-06-17T20:32:14+08:00" />
<meta property="article:modified_time" content="2022-06-17T20:32:14+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Django DRF 视图基类</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><a href="#1__1" rel="nofollow">1. 引子</a></li><li><a href="#2__21" rel="nofollow">2. 视图基类</a></li><li><ul><li><a href="#21_APIView_22" rel="nofollow">2.1 APIView</a></li><li><ul><li><a href="#211__APIView__View__26" rel="nofollow">2.1.1 APIView 与 View 的不同之处</a></li><li><a href="#212__34" rel="nofollow">2.1.2 支持定义的类属性</a></li><li><a href="#213_CBV__40" rel="nofollow">2.1.3 CBV 源码分析</a></li><li><a href="#214_APIView__101" rel="nofollow">2.1.4 APIView 执行流程分析</a></li><li><a href="#215_Request__182" rel="nofollow">2.1.5 Request 对象</a></li><li><a href="#215__Request__198" rel="nofollow">2.1.5 Request 对象源码分析</a></li><li><a href="#216__data_235" rel="nofollow">2.1.6 自定义 data</a></li><li><a href="#217_Response__308" rel="nofollow">2.1.7 Response 对象</a></li><li><a href="#218__APIView__5__323" rel="nofollow">2.1.8 使用 APIView 编写 5 个接口</a></li></ul> 
    </li><li><a href="#22_GenericAPIView_386" rel="nofollow">2.2 GenericAPIView</a></li><li><ul><li><a href="#221_serializer_class_392" rel="nofollow">2.2.1 serializer_class</a></li><li><a href="#222_queryset_428" rel="nofollow">2.2.2 queryset</a></li><li><a href="#223__GenericAPIView__5__477" rel="nofollow">2.2.3 使用 GenericAPIView 编写 5 个接口</a></li></ul> 
   </li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="1__1"></a>1. 引子</h3> 
<p><strong>Django REST framwork</strong> 提供了众多的通用视图基类与扩展类，以简化视图的编写。<br> REST framework 提供的视图的主要作用有：</p> 
<ul><li>控制序列化器的执行（检验、保存、转换数据）</li><li>控制数据库查询的执行</li></ul> 
<p>在此之前需要注意的是，DRF 是一个 app，也需要在配置文件中注册。</p> 
<pre><code class="prism language-python">INSTALLED_APPS <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">'django.contrib.admin'</span><span class="token punctuation">,</span>				<span class="token comment"># 后台管理，系统自带后台管理 admin</span>
    <span class="token string">'django.contrib.auth'</span><span class="token punctuation">,</span>				<span class="token comment"># 权限管理会生成6张表</span>
    <span class="token string">'django.contrib.contenttypes'</span><span class="token punctuation">,</span>		<span class="token comment"># 可以对所有 app 的表进行记录</span>
    <span class="token string">'django.contrib.sessions'</span><span class="token punctuation">,</span>			<span class="token comment"># session功能，也就是 django_session表</span>
    <span class="token string">'django.contrib.messages'</span><span class="token punctuation">,</span>			<span class="token comment"># django消息框架 flask的闪现</span>
    <span class="token string">'django.contrib.staticfiles'</span><span class="token punctuation">,</span>		<span class="token comment"># 静态资源相关</span>
    <span class="token string">'rest_framework'</span><span class="token punctuation">,</span>					<span class="token comment"># DRF 注册</span>
<span class="token punctuation">]</span>
</code></pre> 
<h3><a id="2__21"></a>2. 视图基类</h3> 
<h4><a id="21_APIView_22"></a>2.1 APIView</h4> 
<p>APIView 是 REST framework 提供的所有视图的基类，继承自 Django 的 <strong>View</strong> 父类。<br> 导入语句： <code>rest_framework.views.APIView</code></p> 
<h5><a id="211__APIView__View__26"></a>2.1.1 APIView 与 View 的不同之处</h5> 
<ul><li>传入到视图方法中的是 <strong>REST framework</strong> 的 <strong>Request</strong> 对象，而不是 Django 的 HttpRequeset 对象；</li><li>视图方法可以返回 REST framework 的 Response 对象，视图会为响应数据设置（render）符合前端要求的格式；</li><li>任何 <strong>APIException</strong> 异常都会被捕获到，并且处理成合适的响应信息；</li><li>在进行 dispatch() 分发前，会对请求进行<strong>身份认证、权限检查、流量控制。</strong></li><li>在 APIView 中仍以常规的类视图定义方法来实现 get() 、post() 或者其他请求方式的方法。</li></ul> 
<h5><a id="212__34"></a>2.1.2 支持定义的类属性</h5> 
<ul><li>authentication_classes 列表或元祖，身份认证类</li><li>permissoin_classes 列表或元祖，权限检查类</li><li>throttle_classes 列表或元祖，流量控制类</li></ul> 
<h5><a id="213_CBV__40"></a>2.1.3 CBV 源码分析</h5> 
<p>通过对 cbv 源码和 drf 源码的分析可以了解其大致原理。</p> 
<ul><li><strong>url.py</strong> 文件</li></ul> 
<pre><code class="prism language-python">调用视图函数类需要添加 <span class="token string">'as_view()'</span>函数，例如<span class="token punctuation">:</span> path<span class="token punctuation">(</span><span class="token string">'home/'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>Test<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</code></pre> 
<ul><li><strong>as_view()</strong> 函数主要内容</li></ul> 
<pre><code class="prism language-python"><span class="token decorator annotation punctuation">@classonlymethod</span>
<span class="token keyword">def</span> <span class="token function">as_view</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> <span class="token operator">**</span>initkwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> key <span class="token keyword">in</span> initkwargs<span class="token punctuation">:</span>
        <span class="token keyword">if</span> key <span class="token keyword">in</span> cls<span class="token punctuation">.</span>http_method_names<span class="token punctuation">:</span>
			<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
			<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

    <span class="token keyword">def</span> <span class="token function">view</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self <span class="token operator">=</span> cls<span class="token punctuation">(</span><span class="token operator">**</span>initkwargs<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token string">'get'</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token keyword">not</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token string">'head'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>head <span class="token operator">=</span> self<span class="token punctuation">.</span>get
        self<span class="token punctuation">.</span>setup<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token string">'request'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> AttributeError<span class="token punctuation">(</span>
                <span class="token string">"%s instance has no 'request' attribute. Did you override "</span>
                <span class="token string">"setup() and forget to call super()?"</span> <span class="token operator">%</span> cls<span class="token punctuation">.</span>__name__
            <span class="token punctuation">)</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>dispatch<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">return</span> view

</code></pre> 
<pre><code class="prism language-python">解释<span class="token punctuation">:</span>

函数 as_view 返回的值是 view，也就是实际上路由中执行的是 view 函数，而 as_view 中的 view 函
数返回的是 <span class="token string">'self.dispatch(request, *args, **kwargs)'</span>
</code></pre> 
<ul><li><strong>dispatch</strong> 函数主要内容</li></ul> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">dispatch</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>http_method_names<span class="token punctuation">:</span>
        handler <span class="token operator">=</span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">.</span>method<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>http_method_not_allowed<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        handler <span class="token operator">=</span> self<span class="token punctuation">.</span>http_method_not_allowed
    <span class="token keyword">return</span> handler<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">解释：

<span class="token number">1.</span> 首先判断了请求方式，http_method_names 中包含了诸多请求方式，如下所示<span class="token punctuation">:</span>
	http_method_names <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'get'</span><span class="token punctuation">,</span> <span class="token string">'post'</span><span class="token punctuation">,</span> <span class="token string">'put'</span><span class="token punctuation">,</span> <span class="token string">'patch'</span><span class="token punctuation">,</span> <span class="token string">'delete'</span><span class="token punctuation">,</span> <span class="token string">'head'</span><span class="token punctuation">,</span> <span class="token string">'options'</span><span class="token punctuation">,</span> <span class="token string">'trace'</span><span class="token punctuation">]</span>
<span class="token number">2.</span> 利用反射的方式获得类中和该请求方式同名的方法
<span class="token number">3.</span> 返回 <span class="token string">'handler(request, *args, **kwargs)'</span>，将获得的方法调用并返还。
</code></pre> 
<h5><a id="214_APIView__101"></a>2.1.4 APIView 执行流程分析</h5> 
<ul><li><strong>url.py</strong> 文件</li></ul> 
<pre><code class="prism language-python">路由的使用并没有改变，需要添加 as_view<span class="token punctuation">(</span><span class="token punctuation">)</span> 。但是按照名称空间查找顺序，此时 as_view<span class="token punctuation">(</span><span class="token punctuation">)</span> 方法需要
去继承的 APIView 中查找相当于重写了父类的方法
</code></pre> 
<ul><li>APIView 中的 <strong>as_view()</strong> 方法</li></ul> 
<pre><code class="prism language-python"><span class="token decorator annotation punctuation">@classmethod</span>
<span class="token keyword">def</span> <span class="token function">as_view</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> <span class="token operator">**</span>initkwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span><span class="token builtin">getattr</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> <span class="token string">'queryset'</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">,</span> models<span class="token punctuation">.</span>query<span class="token punctuation">.</span>QuerySet<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">def</span> <span class="token function">force_evaluation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
			<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        cls<span class="token punctuation">.</span>queryset<span class="token punctuation">.</span>_fetch_all <span class="token operator">=</span> force_evaluation

    view <span class="token operator">=</span> <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token operator">**</span>initkwargs<span class="token punctuation">)</span>
    view<span class="token punctuation">.</span>cls <span class="token operator">=</span> cls
    view<span class="token punctuation">.</span>initkwargs <span class="token operator">=</span> initkwargs
    
    <span class="token keyword">return</span> csrf_exempt<span class="token punctuation">(</span>view<span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">解释：

<span class="token number">1.</span> 重写了 View 中的方法，并继承了父类中的 as_view 方法。并且返回的值是 <span class="token string">'csrf_exempt(view)'</span>
<span class="token number">2.</span> csrf_exempt 方法可以忽略 csrf 校验，而 APIView 中没有 view ，也就是使用 APIView 父类 
   View 的 view 方法，只不过忽略了 csrf 校验。
</code></pre> 
<ul><li><strong>view</strong> 方法</li></ul> 
<pre><code class="prism language-python">该方法和 cbv 中一致，返回的值是 dispatch 方法，但是该方法按照查找循序也是优先使用 APIView 中
的方法
</code></pre> 
<ul><li>APIView 中的 <strong>dispatch</strong> 方法</li></ul> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">dispatch</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    self<span class="token punctuation">.</span>args <span class="token operator">=</span> args
    self<span class="token punctuation">.</span>kwargs <span class="token operator">=</span> kwargs
    request <span class="token operator">=</span> self<span class="token punctuation">.</span>initialize_request<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>request <span class="token operator">=</span> request
    self<span class="token punctuation">.</span>headers <span class="token operator">=</span> self<span class="token punctuation">.</span>default_response_headers  <span class="token comment"># deprecate?</span>

    <span class="token keyword">try</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>initial<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
        
        <span class="token keyword">if</span> request<span class="token punctuation">.</span>method<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>http_method_names<span class="token punctuation">:</span>
            handler <span class="token operator">=</span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">.</span>method<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                              self<span class="token punctuation">.</span>http_method_not_allowed<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            handler <span class="token operator">=</span> self<span class="token punctuation">.</span>http_method_not_allowed

        response <span class="token operator">=</span> handler<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>

    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> exc<span class="token punctuation">:</span>
        response <span class="token operator">=</span> self<span class="token punctuation">.</span>handle_exception<span class="token punctuation">(</span>exc<span class="token punctuation">)</span>

    self<span class="token punctuation">.</span>response <span class="token operator">=</span> self<span class="token punctuation">.</span>finalize_response<span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
    <span class="token keyword">return</span> self<span class="token punctuation">.</span>response
    
</code></pre> 
<pre><code class="prism language-python">解释：

<span class="token number">1.</span> <span class="token string">'request = self.initialize_request(request, *args, **kwargs)'</span>包装新的 request对象
   以后视图类中用的 request 对象，就是新的 request
<span class="token number">2.</span> <span class="token string">'try'</span> 异常捕获，将三大认证的异常以及执行视图函数的异常进行捕获。
<span class="token number">3.</span> <span class="token string">'self.initial(request, *args, **kwargs)'</span> 内部封装了三大认证<span class="token punctuation">:</span> 认证<span class="token punctuation">(</span>登陆认证<span class="token punctuation">)</span>，频率<span class="token punctuation">(</span><span class="token number">1</span>分
   钟只能访问接口<span class="token number">3</span>次<span class="token punctuation">)</span>，权限<span class="token punctuation">(</span>普通用户不能访问，超级用户才能访问<span class="token punctuation">)</span>
<span class="token number">4.</span> 在异常捕获代码内重写了原来 dispatch 的代码用于执行视图函数
<span class="token number">5.</span> <span class="token string">'self.response = self.finalize_response(request, response, *args, **kwargs)'</span> 用于
   包装 response 响应对象，在浏览器中能看到美观的样式，在 postman 只看到 json 格式数据。

</code></pre> 
<h5><a id="215_Request__182"></a>2.1.5 Request 对象</h5> 
<p>在上面的流程分析中发现 request 对象已经被包装过了，也就是说视图类中使用的 request 对象，是<code>rest_framework.request.Request</code> 的对象，原来的是<code>django.core.handlers.wsgi.WSGIRequest</code></p> 
<pre><code class="prism language-python"><span class="token number">1.</span> Request对象的数据是自动根据前端发送数据的格式进行解析之后的结果。
<span class="token number">2.</span> 无论前端发送的哪种格式的数据，都可以统一的方式读取数据。
</code></pre> 
<p><strong>常见属性</strong></p> 
<ul><li><strong>data</strong><br> <code>request.data</code> 返回解析之后的请求体数据。类似于Django中标准的 <code>request.POST</code> 和 <code>request.FILES</code> 属性。request.POST 转换成普通字典可以使用 request.POST.dict()</li><li><strong>query_params</strong><br> <code>request.query_params</code> 与Django标准的 <code>request.GET</code> 相同，可以获取请求地址中的数据</li></ul> 
<h5><a id="215__Request__198"></a>2.1.5 Request 对象源码分析</h5> 
<ul><li><strong>Request</strong> 类</li></ul> 
<pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">Request</span><span class="token punctuation">:</span>
	<span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> parsers<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> authenticators<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
	            negotiator<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> parser_context<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    	self<span class="token punctuation">.</span>_request <span class="token operator">=</span> request
    	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre> 
<pre><code class="prism language-python">解释：

在 __init__ 中把旧的 request 放到了新的 request 的 _request 属性中，接下来就是取出旧的
request 中的属性，逐个取比较麻烦，源码中重写了 <span class="token string">'__getattr__'</span> 方法
</code></pre> 
<ul><li><strong>_getattr_</strong> 方法</li></ul> 
<pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">Request</span><span class="token punctuation">:</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">def</span> <span class="token function">__getattr__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> attr<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_request<span class="token punctuation">,</span> attr<span class="token punctuation">)</span>
        <span class="token keyword">except</span> AttributeError<span class="token punctuation">:</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>__getattribute__<span class="token punctuation">(</span>attr<span class="token punctuation">)</span>

</code></pre> 
<pre><code class="prism language-python">解释：

该双下方法是在实例对象查找不存在的属性时执行，例如要取新的 request<span class="token punctuation">.</span>POST，但是很明显没有，此时会
触发双下 __getattr__ 方法，使用反射在旧的 request 中获取属性。
</code></pre> 
<h5><a id="216__data_235"></a>2.1.6 自定义 data</h5> 
<p><code>request.data</code> 只在 APIView 中有，若想在 <strong>View</strong> 中也能使用 <strong>data</strong> 可以使用装饰器或类的形式实现</p> 
<ul><li><strong>装饰器</strong></li></ul> 
<pre><code class="prism language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>views<span class="token punctuation">.</span>decorators<span class="token punctuation">.</span>csrf <span class="token keyword">import</span> csrf_exempt<span class="token punctuation">,</span> csrf_protect
<span class="token keyword">import</span> json

<span class="token keyword">def</span> <span class="token function">outher</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">inner</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            data <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>request<span class="token punctuation">.</span>body<span class="token punctuation">)</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            data <span class="token operator">=</span> request<span class="token punctuation">.</span>POST
        request<span class="token punctuation">.</span>data <span class="token operator">=</span> data
        
        res <span class="token operator">=</span> func<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
        <span class="token keyword">return</span> res

    <span class="token keyword">return</span> csrf_exempt<span class="token punctuation">(</span>inner<span class="token punctuation">)</span>

</code></pre> 
<ul><li><strong>视图函数</strong></li></ul> 
<pre><code class="prism language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>shortcuts <span class="token keyword">import</span> render<span class="token punctuation">,</span> HttpResponse
<span class="token keyword">from</span> django<span class="token punctuation">.</span>views <span class="token keyword">import</span> View
<span class="token keyword">from</span> django<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>decorators <span class="token keyword">import</span> method_decorator

<span class="token keyword">class</span> <span class="token class-name">Test</span><span class="token punctuation">(</span>View<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">post</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        data <span class="token operator">=</span> request<span class="token punctuation">.</span>data
        <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">#  &lt;class 'django.http.request.QueryDict'&gt;</span>
        <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token comment"># 重写dispatch对所有方法添加装饰器</span>
    <span class="token decorator annotation punctuation">@method_decorator</span><span class="token punctuation">(</span>outher<span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">dispatch</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>dispatch<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>

</code></pre> 
<p>也可以通过类的形式。</p> 
<ul><li><strong>类</strong></li></ul> 
<pre><code class="prism language-python"><span class="token keyword">import</span> json
<span class="token keyword">from</span> django<span class="token punctuation">.</span>views <span class="token keyword">import</span> View

<span class="token keyword">class</span> <span class="token class-name">MyView</span><span class="token punctuation">(</span>View<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">dispatch</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>

        <span class="token keyword">try</span><span class="token punctuation">:</span>
            data <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>request<span class="token punctuation">.</span>body<span class="token punctuation">)</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            data <span class="token operator">=</span> request<span class="token punctuation">.</span>POST
        request<span class="token punctuation">.</span>data <span class="token operator">=</span> data

        <span class="token keyword">return</span> <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>dispatch<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>

</code></pre> 
<ul><li><strong>视图函数</strong></li></ul> 
<pre><code class="prism language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>shortcuts <span class="token keyword">import</span> render<span class="token punctuation">,</span> HttpResponse

<span class="token keyword">class</span> <span class="token class-name">Test</span><span class="token punctuation">(</span>MyView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">post</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        data <span class="token operator">=</span> request<span class="token punctuation">.</span>data
        <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre> 
<h5><a id="217_Response__308"></a>2.1.7 Response 对象</h5> 
<p>导入语句：<code>from rest_framework.response import Response</code>。</p> 
<pre><code class="prism language-python">REST framework 提供了一个响应类 Response，使用该类构造响应对象时，响应的具体数据内容会被转
换（render渲染）成符合前端需求的类型。
</code></pre> 
<pre><code class="prism language-python">REST framework 提供了Renderer 渲染器，用来根据请求头中的 Accept（接收数据类型声明）来自动转
换响应数据到对应格式。如果前端请求中未进行 Accept 声明，则会采用默认方式处理响应数据，我们可以通
过配置来修改默认响应格式。
</code></pre> 
<p>对请求和响应还可以进行配置，点击此文章： <a href="https://blog.csdn.net/m0_58987515/article/details/125323737?spm=1001.2014.3001.5502">DRF 请求与响应</a></p> 
<h5><a id="218__APIView__5__323"></a>2.1.8 使用 APIView 编写 5 个接口</h5> 
<p>使用 APIView 编写查询单个、查询所有、删除单个、添加单个、编辑单个接口，代码示例如下（省略序列化类代码）。</p> 
<p><strong>视图函数</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>response <span class="token keyword">import</span> Response
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>views <span class="token keyword">import</span> APIView
<span class="token keyword">from</span> app01 <span class="token keyword">import</span> models
<span class="token keyword">from</span> app01<span class="token punctuation">.</span>serializer <span class="token keyword">import</span> BookSerializer


<span class="token keyword">class</span> <span class="token class-name">BookView</span><span class="token punctuation">(</span>APIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    queryset <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects
    serializer_class <span class="token operator">=</span> BookSerializer

    <span class="token keyword">def</span> <span class="token function">post</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        res <span class="token operator">=</span> self<span class="token punctuation">.</span>serializer_class<span class="token punctuation">(</span>data<span class="token operator">=</span>request<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
        <span class="token keyword">if</span> res<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            res<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> Response<span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
        <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">"code"</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">"msg"</span><span class="token punctuation">:</span> <span class="token string">"验证不通过"</span><span class="token punctuation">,</span> <span class="token string">"info"</span><span class="token punctuation">:</span> res<span class="token punctuation">.</span>errors<span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        res <span class="token operator">=</span> self<span class="token punctuation">.</span>serializer_class<span class="token punctuation">(</span>self<span class="token punctuation">.</span>queryset<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> many<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> Response<span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">BookView1</span><span class="token punctuation">(</span>APIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    queryset <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects
    serializer_class <span class="token operator">=</span> BookSerializer

    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        res <span class="token operator">=</span> self<span class="token punctuation">.</span>serializer_class<span class="token punctuation">(</span>self<span class="token punctuation">.</span>queryset<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> Response<span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">delete</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        obj <span class="token operator">=</span> self<span class="token punctuation">.</span>queryset<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">put</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        obj <span class="token operator">=</span> self<span class="token punctuation">.</span>queryset<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
        res <span class="token operator">=</span> self<span class="token punctuation">.</span>serializer_class<span class="token punctuation">(</span>obj<span class="token punctuation">,</span> data<span class="token operator">=</span>request<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
        <span class="token keyword">if</span> res<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            res<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> Response<span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
        <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">"code"</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">"msg"</span><span class="token punctuation">:</span> <span class="token string">"验证不通过"</span><span class="token punctuation">,</span> <span class="token string">"info"</span><span class="token punctuation">:</span> res<span class="token punctuation">.</span>errors<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre> 
<p><strong>路由</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib <span class="token keyword">import</span> admin
<span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> path
<span class="token keyword">from</span> app01<span class="token punctuation">.</span>view <span class="token keyword">import</span> views3

urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
    path<span class="token punctuation">(</span><span class="token string">'admin/'</span><span class="token punctuation">,</span> admin<span class="token punctuation">.</span>site<span class="token punctuation">.</span>urls<span class="token punctuation">)</span><span class="token punctuation">,</span>
    path<span class="token punctuation">(</span><span class="token string">'books/'</span><span class="token punctuation">,</span> views3<span class="token punctuation">.</span>BookView<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    path<span class="token punctuation">(</span><span class="token string">'books/&lt;int:pk&gt;'</span><span class="token punctuation">,</span> views3<span class="token punctuation">.</span>BookView1<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre> 
<h4><a id="22_GenericAPIView_386"></a>2.2 GenericAPIView</h4> 
<p>导入语句：<code>rest_framework.generics.GenericAPIView</code></p> 
<p>该类继承自 <strong>APIVIew</strong>，<code>主要增加了操作序列化器和数据库查询的方法，作用是为下面 Mixin 扩展类的执行提供方法支持。通常在使用时，可搭配一个或多个Mixin扩展类</code></p> 
<h5><a id="221_serializer_class_392"></a>2.2.1 serializer_class</h5> 
<p>serializer_class 属性用于指明视图使用的序列化器，在视图类中可以指定使用的序列化器</p> 
<p><strong>使用方法：</strong></p> 
<ul><li><strong>get_serializer(self, *args, **kwargs)</strong></li></ul> 
<ol><li>返回序列化器对象，主要用来提供给 Mixin 扩展类使用，如果我们在视图中想要获取序列化器对象，也可以直接调用此方法。</li><li>注意，该方法在提供序列化器对象的时候，会向序列化器对象的 context 属性补充三个数据：request、format、view，这三个数据对象可以在定义序列化器时使用。</li><li>request 当前视图的请求对象<br> view 当前请求的类视图对象<br> format 当前请求期望返回的数据格式</li><li>源码如下</li></ol> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">get_serializer</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
     <span class="token triple-quoted-string string">"""
     Return the serializer instance that should be used for validating and
     deserializing input, and for serializing output.
     """</span>
     serializer_class <span class="token operator">=</span> self<span class="token punctuation">.</span>get_serializer_class<span class="token punctuation">(</span><span class="token punctuation">)</span>
     kwargs<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span><span class="token string">'context'</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>get_serializer_context<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
     <span class="token keyword">return</span> serializer_class<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
</code></pre> 
<ul><li><strong>get_serializer_class(self)</strong></li></ul> 
<ol><li>当出现一个视图类中调用多个序列化器时,那么可以通过条件判断在get_serializer_class方法中通过返回不同的序列化器类名就可以让视图方法执行不同的序列化器对象了。</li><li>源码如下，其返回的是类名，在视图类中使用需要加括号</li></ol> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">get_serializer_class</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">assert</span> self<span class="token punctuation">.</span>serializer_class <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>
        <span class="token string">"'%s' should either include a `serializer_class` attribute, "</span>
        <span class="token string">"or override the `get_serializer_class()` method."</span>
        <span class="token operator">%</span> self<span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__name__
    <span class="token punctuation">)</span>

    <span class="token keyword">return</span> self<span class="token punctuation">.</span>serializer_class
</code></pre> 
<h5><a id="222_queryset_428"></a>2.2.2 queryset</h5> 
<p>queryset 指明使用的数据查询集，也可以在视图类中指定</p> 
<p><strong>使用的方法：</strong></p> 
<ul><li><strong>get_queryset(self)</strong></li></ul> 
<ol><li>返回视图使用的查询集，主要用来提供给 Mixin 扩展类使用，是列表视图与详情视图获取数据的基础，默认返回 queryset 属性</li><li>源码如下，简单来看就是若 queryset 为 none，通过assert 断言来抛出异常，然后将 queryset 属性取出判断是否添加 all() 方法后返回出去。</li></ol> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">get_queryset</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">assert</span> self<span class="token punctuation">.</span>queryset <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>
        <span class="token string">"'%s' should either include a `queryset` attribute, "</span>
        <span class="token string">"or override the `get_queryset()` method."</span>
        <span class="token operator">%</span> self<span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__name__
    <span class="token punctuation">)</span>

    queryset <span class="token operator">=</span> self<span class="token punctuation">.</span>queryset
    <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>queryset<span class="token punctuation">,</span> QuerySet<span class="token punctuation">)</span><span class="token punctuation">:</span>
        queryset <span class="token operator">=</span> queryset<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> queryset

</code></pre> 
<ul><li><strong>get_object(self)</strong></li></ul> 
<ol><li>可以用于获取单个查询结果对象，主要用来提供给Mixin扩展类使用</li><li>若详情访问的模型类对象不存在，会返回404。</li><li>源码如下</li></ol> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">get_object</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    queryset <span class="token operator">=</span> self<span class="token punctuation">.</span>filter_queryset<span class="token punctuation">(</span>self<span class="token punctuation">.</span>get_queryset<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># Perform the lookup filtering.</span>
    lookup_url_kwarg <span class="token operator">=</span> self<span class="token punctuation">.</span>lookup_url_kwarg <span class="token keyword">or</span> self<span class="token punctuation">.</span>lookup_field

    <span class="token keyword">assert</span> lookup_url_kwarg <span class="token keyword">in</span> self<span class="token punctuation">.</span>kwargs<span class="token punctuation">,</span> <span class="token punctuation">(</span>
        <span class="token string">'Expected view %s to be called with a URL keyword argument '</span>
        <span class="token string">'named "%s". Fix your URL conf, or set the `.lookup_field` '</span>
        <span class="token string">'attribute on the view correctly.'</span> <span class="token operator">%</span>
        <span class="token punctuation">(</span>self<span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__name__<span class="token punctuation">,</span> lookup_url_kwarg<span class="token punctuation">)</span>
    <span class="token punctuation">)</span>

    filter_kwargs <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>self<span class="token punctuation">.</span>lookup_field<span class="token punctuation">:</span> self<span class="token punctuation">.</span>kwargs<span class="token punctuation">[</span>lookup_url_kwarg<span class="token punctuation">]</span><span class="token punctuation">}</span>
    obj <span class="token operator">=</span> get_object_or_404<span class="token punctuation">(</span>queryset<span class="token punctuation">,</span> <span class="token operator">**</span>filter_kwargs<span class="token punctuation">)</span>

    <span class="token comment"># May raise a permission denied</span>
    self<span class="token punctuation">.</span>check_object_permissions<span class="token punctuation">(</span>self<span class="token punctuation">.</span>request<span class="token punctuation">,</span> obj<span class="token punctuation">)</span>

    <span class="token keyword">return</span> obj
</code></pre> 
<h5><a id="223__GenericAPIView__5__477"></a>2.2.3 使用 GenericAPIView 编写 5 个接口</h5> 
<p>与使用 APIView 编写的方式只是获取方法不同</p> 
<p><strong>视图函数</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>response <span class="token keyword">import</span> Response
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>generics <span class="token keyword">import</span> GenericAPIView
<span class="token keyword">from</span> app01 <span class="token keyword">import</span> models
<span class="token keyword">from</span> app01<span class="token punctuation">.</span>serializer <span class="token keyword">import</span> BookSerializer


<span class="token keyword">class</span> <span class="token class-name">BookView</span><span class="token punctuation">(</span>GenericAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token comment"># 名字只能是这个</span>
    queryset <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects
    serializer_class <span class="token operator">=</span> BookSerializer

    <span class="token keyword">def</span> <span class="token function">post</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        res <span class="token operator">=</span> self<span class="token punctuation">.</span>get_serializer<span class="token punctuation">(</span>data<span class="token operator">=</span>request<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
        <span class="token keyword">if</span> res<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            res<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> Response<span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
        <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">"code"</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">"msg"</span><span class="token punctuation">:</span> <span class="token string">"验证不通过"</span><span class="token punctuation">,</span> <span class="token string">"info"</span><span class="token punctuation">:</span> res<span class="token punctuation">.</span>errors<span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        res <span class="token operator">=</span> self<span class="token punctuation">.</span>get_serializer_class<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>get_queryset<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> many<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> Response<span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">BookView1</span><span class="token punctuation">(</span>GenericAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token comment"># 名字只能是这个</span>
    queryset <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects
    serializer_class <span class="token operator">=</span> BookSerializer

    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># res = self.get_serializer(self.get_object())  # 或者使用get_object()</span>
        res <span class="token operator">=</span> self<span class="token punctuation">.</span>get_serializer<span class="token punctuation">(</span>self<span class="token punctuation">.</span>get_queryset<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> Response<span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">delete</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        obj <span class="token operator">=</span> self<span class="token punctuation">.</span>get_queryset<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">put</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        obj <span class="token operator">=</span> self<span class="token punctuation">.</span>get_queryset<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
        res <span class="token operator">=</span> self<span class="token punctuation">.</span>get_serializer<span class="token punctuation">(</span>obj<span class="token punctuation">,</span> data<span class="token operator">=</span>request<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
        <span class="token keyword">if</span> res<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            res<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> Response<span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
        <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">"code"</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">"msg"</span><span class="token punctuation">:</span> <span class="token string">"验证不通过"</span><span class="token punctuation">,</span> <span class="token string">"info"</span><span class="token punctuation">:</span> res<span class="token punctuation">.</span>errors<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre> 
<p><strong>路由</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib <span class="token keyword">import</span> admin
<span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> path
<span class="token keyword">from</span> app01<span class="token punctuation">.</span>view <span class="token keyword">import</span> views2

urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
    path<span class="token punctuation">(</span><span class="token string">'admin/'</span><span class="token punctuation">,</span> admin<span class="token punctuation">.</span>site<span class="token punctuation">.</span>urls<span class="token punctuation">)</span><span class="token punctuation">,</span>
    path<span class="token punctuation">(</span><span class="token string">'books/'</span><span class="token punctuation">,</span> views2<span class="token punctuation">.</span>BookView<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    path<span class="token punctuation">(</span><span class="token string">'books/&lt;int:pk&gt;'</span><span class="token punctuation">,</span> views2<span class="token punctuation">.</span>BookView1<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/783fa70659973d244a07319819ed0aa0/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">机器学习：交叉验证，网络搜索</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9d89ac10adc8fd8623931950b2f46124/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Minimum supported Gradle version is 6.1.1. Current version is 5.6.4.</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>