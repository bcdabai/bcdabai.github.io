<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>FastDFS安装笔记 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="FastDFS安装笔记" />
<meta property="og:description" content="FastDFS安装笔记 0.环境准备 CentOS 7.5libfastcommon V1.0.43fastdfs V6.06fastdfs-nginx-module V1.22nginx 1.18.0 1.安装步骤 下载安装包 wget https://codeload.github.com/happyfish100/libfastcommon/tar.gz/V1.0.43 -O libfastcommon-1.0.43.tar.gz wget https://codeload.github.com/happyfish100/fastdfs/tar.gz/V6.06 -O fastdfs-6.06.tar.gz wget https://codeload.github.com/happyfish100/fastdfs-nginx-module/tar.gz/V1.22 -O fastdfs-nginx-module-1.22.tar.gz wget http://nginx.org/download/nginx-1.18.0.tar.gz 安装依赖 yum install -y gcc-c&#43;&#43; libevent pcre pcre-devel zlib zlib-devel openssl openssl-devel 安装 libfastcommon tar -zxvf libfastcommon-1.0.43.tar.gz # 进入安装目录 cd libfastcommon-1.0.43 # 编译、安装 ./make.sh ./make.sh install # 创建软链接 ln -s /usr/lib64/libfastcommon.so /usr/local/lib/libfastcommon.so ln -s /usr/lib64/libfastcommon.so /usr/lib/libfastcommon.so ln -s /usr/lib64/libfdfsclient.so /usr/local/lib/libfdfsclient.so ln -s /usr/lib64/libfdfsclient.so /usr/lib/libfdfsclient.so 安装 fastdfs tar -zxvf fastdfs-6." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/698b6e9ffaeb300aac875f2644ad2aa7/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-11-06T22:57:00+08:00" />
<meta property="article:modified_time" content="2022-11-06T22:57:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">FastDFS安装笔记</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="FastDFS_0"></a>FastDFS安装笔记</h2> 
<h3><a id="0_2"></a>0.环境准备</h3> 
<ul><li>CentOS 7.5</li><li>libfastcommon V1.0.43</li><li>fastdfs V6.06</li><li>fastdfs-nginx-module V1.22</li><li>nginx 1.18.0</li></ul> 
<h3><a id="1_10"></a>1.安装步骤</h3> 
<h4><a id="_12"></a>下载安装包</h4> 
<pre><code class="prism language-bash"><span class="token function">wget</span> https://codeload.github.com/happyfish100/libfastcommon/tar.gz/V1.0.43 -O libfastcommon-1.0.43.tar.gz
<span class="token function">wget</span> https://codeload.github.com/happyfish100/fastdfs/tar.gz/V6.06 -O fastdfs-6.06.tar.gz
<span class="token function">wget</span> https://codeload.github.com/happyfish100/fastdfs-nginx-module/tar.gz/V1.22 -O fastdfs-nginx-module-1.22.tar.gz
<span class="token function">wget</span> http://nginx.org/download/nginx-1.18.0.tar.gz
</code></pre> 
<h4><a id="_21"></a>安装依赖</h4> 
<pre><code class="prism language-bash">yum <span class="token function">install</span> -y gcc-c++ libevent pcre pcre-devel zlib zlib-devel openssl openssl-devel
</code></pre> 
<h4><a id="_libfastcommon_27"></a>安装 libfastcommon</h4> 
<pre><code class="prism language-bash"><span class="token function">tar</span> -zxvf libfastcommon-1.0.43.tar.gz
<span class="token comment"># 进入安装目录</span>
<span class="token builtin class-name">cd</span> libfastcommon-1.0.43
<span class="token comment"># 编译、安装</span>
./make.sh
./make.sh <span class="token function">install</span>
<span class="token comment"># 创建软链接</span>
<span class="token function">ln</span> -s /usr/lib64/libfastcommon.so /usr/local/lib/libfastcommon.so
<span class="token function">ln</span> -s /usr/lib64/libfastcommon.so /usr/lib/libfastcommon.so
<span class="token function">ln</span> -s /usr/lib64/libfdfsclient.so /usr/local/lib/libfdfsclient.so
<span class="token function">ln</span> -s /usr/lib64/libfdfsclient.so /usr/lib/libfdfsclient.so
</code></pre> 
<h4><a id="_fastdfs_43"></a>安装 fastdfs</h4> 
<pre><code class="prism language-bash"><span class="token function">tar</span> -zxvf fastdfs-6.06.tar.gz
<span class="token comment"># 进入安装目录</span>
<span class="token builtin class-name">cd</span> fastdfs-6.06
<span class="token comment"># 编译、安装</span>
./make.sh
./make.sh <span class="token function">install</span>
</code></pre> 
<h4><a id="_tracker__54"></a>配置 tracker 服务</h4> 
<pre><code class="prism language-bash"><span class="token function">cp</span> /etc/fdfs/tracker.conf.sample /etc/fdfs/tracker.conf
<span class="token function">vim</span> /etc/fdfs/tracker.conf
</code></pre> 
<p>编辑 tracker.conf</p> 
<pre><code class="prism language-bash"><span class="token comment"># 配置文件是否不生效，false 为生效</span>
<span class="token assign-left variable">disabled</span><span class="token operator">=</span>false
<span class="token comment"># 提供服务的端口</span>
<span class="token assign-left variable">port</span><span class="token operator">=</span><span class="token number">22122</span>
<span class="token comment"># Tracker 数据和日志目录地址</span>
<span class="token assign-left variable">base_path</span><span class="token operator">=</span>/home/data/fastdfs
<span class="token comment"># HTTP服务端口80（方便后续集成nginx代理--猜测(滑稽)）</span>
http.server_port<span class="token operator">=</span><span class="token number">80</span>
</code></pre> 
<p>创建 tracker 基础数据目录，即 base_path 对应的目录</p> 
<pre><code class="prism language-shell"><span class="token function">mkdir</span> -p /home/data/fastdfs
</code></pre> 
<p>使用 ln -s 建立软链接</p> 
<pre><code class="prism language-shell"><span class="token function">ln</span> -s /usr/bin/fdfs_trackerd /usr/local/bin
<span class="token function">ln</span> -s /usr/bin/stop.sh /usr/local/bin
<span class="token function">ln</span> -s /usr/bin/restart.sh /usr/local/bin
</code></pre> 
<p>tracker 服务管理</p> 
<pre><code class="prism language-shell"><span class="token comment"># 启动、停止、重启</span>
<span class="token function">service</span> fdfs_trackerd start
<span class="token function">service</span> fdfs_trackerd stop
<span class="token function">service</span> fdfs_trackerd restart

<span class="token comment"># 查看启动监听</span>
<span class="token function">netstat</span> -unltp<span class="token operator">|</span><span class="token function">grep</span> fdfs
</code></pre> 
<p>注：如果看到22122端口正常被监听后，这时候说明 tracker 服务启动成功。</p> 
<p><code>tracker server</code> 目录及文件结构 tracker 服务启动成功后，会在 base_path 下创建 data、logs 两个目录。目录结构如下：</p> 
<pre><code class="prism language-bash"><span class="token variable">${base_path}</span>
  <span class="token operator">|</span>__data
  <span class="token operator">|</span>   <span class="token operator">|</span>__storage_groups.dat  <span class="token comment">#存储分组信息</span>
  <span class="token operator">|</span>   <span class="token operator">|</span>__storage_servers.dat <span class="token comment">#存储服务器列表</span>
  <span class="token operator">|</span>__logs
  <span class="token operator">|</span>   <span class="token operator">|</span>__trackerd.log        <span class="token comment">#tracker server日志文件 </span>
</code></pre> 
<h4><a id="_storage__113"></a>配置 storage 服务</h4> 
<p>进入 /etc/fdfs 目录，复制 fastDFS 存储器样例配置文件 storage.conf.sample，并重命名为 storage.conf：</p> 
<pre><code class="prism language-shell"><span class="token function">cp</span> /etc/fdfs/storage.conf.sample /etc/fdfs/storage.conf
<span class="token function">vim</span> /etc/fdfs/storage.conf <span class="token comment">## 注需要安装vim命令，没有使用vi命令</span>
</code></pre> 
<p>编辑 storage.conf：</p> 
<pre><code class="prism language-bash"><span class="token comment"># 配置文件是否不生效，false 为生效</span>
<span class="token assign-left variable">disabled</span><span class="token operator">=</span>false
<span class="token comment"># 指定此 storage server 所在组(卷)</span>
<span class="token assign-left variable">group_name</span><span class="token operator">=</span>group1
<span class="token comment"># storage server 服务端口</span>
<span class="token assign-left variable">port</span><span class="token operator">=</span><span class="token number">23000</span>
<span class="token comment"># 心跳间隔时间，单位为秒 (这里是指主动向 tracker server 发送心跳)</span>
<span class="token assign-left variable">heart_beat_interval</span><span class="token operator">=</span><span class="token number">30</span>
<span class="token comment"># Storage 数据和日志目录地址(根目录必须存在，子目录会自动生成)</span>
<span class="token assign-left variable">base_path</span><span class="token operator">=</span>/home/data/fastdfs/storage
<span class="token comment"># 存放文件时 storage server 支持多个路径。这里配置存放文件的基路径数目，通常只配一个目录。</span>
<span class="token assign-left variable">store_path_count</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token comment"># 逐一配置 store_path_count 个路径，索引号基于 0。</span>
<span class="token comment">## 如果不配置 store_path0，那它就和 base_path 对应的路径一样。</span>
<span class="token assign-left variable">store_path0</span><span class="token operator">=</span>/home/data/fastdfs/storage
<span class="token comment"># FastDFS 存储文件时，采用了两级目录。这里配置存放文件的目录个数。 </span>
<span class="token comment">## 如果本参数只为 N（如：256），那么 storage server 在初次运行时，会在 store_path 下自动创建 N * N 个存放文件的子目录。</span>
<span class="token assign-left variable">subdir_count_per_path</span><span class="token operator">=</span><span class="token number">256</span>
<span class="token comment"># tracker_server 的列表 ，会主动连接 tracker_server</span>
<span class="token comment"># 有多个 tracker server 时，每个 tracker server 写一行 公网访问需要配置公网IP</span>
<span class="token assign-left variable">tracker_server</span><span class="token operator">=</span><span class="token number">118.31</span>.167.168:22122
<span class="token comment"># 允许系统同步的时间段 (默认是全天) 。一般用于避免高峰同步产生一些问题而设定。</span>
<span class="token assign-left variable">sync_start_time</span><span class="token operator">=</span>00:00
<span class="token assign-left variable">sync_end_time</span><span class="token operator">=</span><span class="token number">23</span>:59
</code></pre> 
<p>创建 storage 基础数据目录，即 base_path 对应的目录</p> 
<pre><code class="prism language-shell"><span class="token function">mkdir</span> -p /home/data/fastdfs/storage
</code></pre> 
<p>使用 ln -s 建立软链接</p> 
<pre><code class="prism language-shell"><span class="token function">ln</span> -s /usr/bin/fdfs_storaged /usr/local/bin
</code></pre> 
<p>storage 服务管理</p> 
<pre><code class="prism language-shell"><span class="token comment"># 启动、停止、重启</span>
<span class="token function">service</span> fdfs_storaged start
<span class="token function">service</span> fdfs_storaged stop
<span class="token function">service</span> fdfs_storaged restart

<span class="token comment"># 查看启动监听</span>
<span class="token function">netstat</span> -unltp<span class="token operator">|</span><span class="token function">grep</span> fdfs
</code></pre> 
<p>注意：启动 storage 前确保 tracker 是启动的。初次启动成功，会在 /home/data/fastdfs/storage 目录下创建 data、logs 两个目录。 如果看到 23000 端口正常被监听后，这时候说明 storage 服务启动成功！</p> 
<p>查看 storage 和 tracker 是否在通信</p> 
<pre><code class="prism language-shell">/usr/bin/fdfs_monitor /etc/fdfs/storage.conf
</code></pre> 
<h4><a id="fastDFS_183"></a>fastDFS服务自测</h4> 
<p>1、修改 tracker 服务器中的客户端配置文件：</p> 
<pre><code class="prism language-shell"><span class="token comment"># 复制客户端示例配置文件并重名</span>
<span class="token function">cp</span> /etc/fdfs/client.conf.sample /etc/fdfs/client.conf
<span class="token function">vim</span> /etc/fdfs/client.conf <span class="token comment">## 注需要安装vim命令，没有使用vi命令</span>
</code></pre> 
<p>编辑 client.conf：</p> 
<pre><code class="prism language-bash"><span class="token comment"># Client 的数据和日志目录</span>
<span class="token assign-left variable">base_path</span><span class="token operator">=</span>/home/data/fastdfs/client

<span class="token comment"># tracker服务访问地址</span>
<span class="token assign-left variable">tracker_server</span><span class="token operator">=</span><span class="token number">118.31</span>.167.168:22122

<span class="token comment"># 其他参数默认</span>
</code></pre> 
<p>创建 client 基础数据目录，即 base_path 对应的目录</p> 
<pre><code class="prism language-shell"><span class="token function">mkdir</span> -p /home/data/fastdfs/client
</code></pre> 
<p>2、本地上传文件测试</p> 
<p>在 linux 内部执行如下命令上传 name.jpeg 图片（记住需要在name.jpeg文件所在目录）：</p> 
<pre><code class="prism language-shell"><span class="token builtin class-name">cd</span> /usr/apps/fast_dfs <span class="token comment"># 例如这个图片文件在fast_dfs目录下</span>
/usr/bin/fdfs_upload_file /etc/fdfs/client.conf namei.jpeg
</code></pre> 
<p>上传成功后会返回文件ID号：</p> 
<pre><code class="prism language-bash"><span class="token comment"># /usr/bin/fdfs_upload_file /etc/fdfs/client.conf name.jpeg </span>
group1/M00/00/00/rBrXSGNlu5iASIQhAEW1FdaZj-0961.jpg
</code></pre> 
<p>从返回的文件ID分析结构组成，返回的文件 ID 由 group 、存储目录、两级子目录、fileid、文件后缀名（由客户端指定，主要用于区分文件类型）拼接而成。</p> 
<p>3、防火墙配置</p> 
<pre><code class="prism language-shell"><span class="token comment"># 添加开放端口</span>
firewall-cmd --zone<span class="token operator">=</span>public --add-port<span class="token operator">=</span><span class="token number">22122</span>/tcp --permanent
firewall-cmd --zone<span class="token operator">=</span>public --add-port<span class="token operator">=</span><span class="token number">23000</span>/tcp --permanent

<span class="token comment"># 重启服务加载配置</span>
firewall-cmd --reload
<span class="token comment">## 查看开放端口</span>
firewall-cmd --list-ports
</code></pre> 
<h3><a id="nginxfastdfsnginxmodule_242"></a>在nginx中集成fastdfs-nginx-module</h3> 
<p>nginx 安装见我的博文：<a href="https://blog.csdn.net/rao991207823/article/details/104486536">Nginx安装步骤</a></p> 
<p>解压 fastdfs-nginx-module-1.22.tar.gz</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> /usr/app/fast_dfs
<span class="token function">tar</span> -zxvf fastdfs-nginx-module-1.22.tar.gz
</code></pre> 
<p>配置 nginx 安装，加入 fastdfs-nginx-module 模块 (此时就用到了前面提到的 nginx 安装)</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> /usr/app/nginx/nginx-1.18.0 <span class="token comment"># 注意nginx源码目录位置</span>
./configure --add-module<span class="token operator">=</span>/usr/app/fast_dfs/fastdfs-nginx-module-1.22/src
</code></pre> 
<p>编译、安装</p> 
<pre><code class="prism language-bash"><span class="token function">make</span> <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> <span class="token function">install</span>
</code></pre> 
<p>配置 fastdfs-nginx-module 设置，复制 fastdfs-nginx-module-1.22 源码中的配置文件到 /etc/fdfs 目录并修改：</p> 
<pre><code class="prism language-shell"><span class="token function">cp</span> /usr/app/fast_dfs/fastdfs-nginx-module-test/src/mod_fastdfs.conf /etc/fdfs/
<span class="token function">vim</span> /etc/fdfs/mod_fastdfs.conf
</code></pre> 
<pre><code class="prism language-bash"><span class="token comment"># 连接超时时间</span>
<span class="token assign-left variable">connect_timeout</span><span class="token operator">=</span><span class="token number">10</span>
<span class="token comment"># the base path to store log files</span>
<span class="token assign-left variable">base_path</span><span class="token operator">=</span>/home/data/fastdfs/storage
<span class="token comment"># Tracker Server</span>
<span class="token assign-left variable">tracker_server</span><span class="token operator">=</span><span class="token number">118.31</span>.167.168:22122
<span class="token comment"># StorageServer 默认端口</span>
<span class="token assign-left variable">storage_server_port</span><span class="token operator">=</span><span class="token number">23000</span>
<span class="token comment"># 如果文件ID的uri中包含/group**,则要设置为true  ##这里不改的话,按照完整资源请求时nginx会报400错误</span>
<span class="token assign-left variable">url_have_group_name</span><span class="token operator">=</span>true
<span class="token comment"># Storage 配置的store_path0路径，必须和storage.conf中的一致</span>
<span class="token assign-left variable">store_path0</span><span class="token operator">=</span>/home/data/fastdfs/storage
</code></pre> 
<p>复制 FastDFS 的部分配置文件到 /etc/fdfs 目录</p> 
<pre><code class="prism language-bash"><span class="token function">cp</span> /usr/apps/fast_dfs/fastdfs-5.05/conf/http.conf /etc/fdfs/
<span class="token function">cp</span> /usr/apps/fast_dfs/fastdfs-5.05/conf/mime.types /etc/fdfs/
</code></pre> 
<p>配置 nginx 代理设置，修改 nginx.conf：</p> 
<pre><code class="prism language-bash">location ~/group<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span>-9<span class="token punctuation">]</span><span class="token punctuation">)</span>/M00 <span class="token punctuation">{<!-- --></span>
    ngx_fastdfs_module<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>启动Nginx：</p> 
<pre><code class="prism language-bash">/usr/local/nginx/sbin/nginx
ngx_http_fastdfs_set <span class="token assign-left variable">pid</span><span class="token operator">=</span><span class="token number">93688</span>
<span class="token comment"># 看到 ngx_http_fastdfs_set 表示确实集成 fastdfs-nginx-module 成功。</span>
</code></pre> 
<p>测试验证，浏览器访问前面上传成功的文件，路径例如：http://192.168.235.103//group1/M00/00/00/rBrXSGNlu5iASIQhAEW1FdaZj-0961.jpg</p> 
<p>自此 FastDFS 安装完毕。</p> 
<p>续接上篇<a href="https://blog.csdn.net/rao991207823/article/details/127722802">FastDFS学习笔记</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b09d605693e0229e6096c0ff6bf7901c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">VS客户端程序调用WCF出现由于计算机积极拒绝，无法连接</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f82da10f4533f7401da87d93f1999c91/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">宏观人脑功能网络的通用分类</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>