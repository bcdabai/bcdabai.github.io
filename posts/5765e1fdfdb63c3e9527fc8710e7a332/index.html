<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>分分钟解决OSPF配置问题 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="分分钟解决OSPF配置问题" />
<meta property="og:description" content="OSPF协议 一、自治系统（AS）二、OSPFOSPF的工作过程OSPF区域骨干区域非骨干区域---根据能够学习的路由器种类来区分Router ID 选取规则自动选取手动选取 DR和BDRDR和BDR的选取自动选取手动选取 OSPF的组播地址OSPF的度量值为COST（成本） OSPF多区(非骨干区域)路由器类型 链路状态通告（LSA） 命令与实验配置好IP地址后配置末梢网络配置命令完全末梢区域配置命令 高级配置路由的重分发OSPF地址汇总的作用虚链路虚链路的目的配置虚链路的规则及特点 虚链路配置命令链路汇总配置命令 一、自治系统（AS） AS是由同一个技术管理机构管理、使用统一选路策略的一些路由器的集合
距离矢量路由“传说的路由”
链路状态路由“传信的路由”
内部网关协议（IGP）RIP、OSPF
外部网关协议（EGP）BGP
二、OSPF 链路状态路由协议：OSPF、isis
OSPF的工作过程 邻居列表、链路状态数据库、路由表
建立连接关系，形成邻居列表，相互学习链路状态信息，形成链路状态数据库，通过Dijkstra算法，得到最短路径树，形成路由表
OSPF区域 为了适应大型的网络，OSPF在AS内划分多个区域
每个OSPF路由器只维护所在区域的完整链路状态信息
区域ID可以用十进制的数字表示，也可以用IP表示
骨干区域 Aera 0:负责区域间路由信息传播
非骨干区域—根据能够学习的路由器种类来区分 标准区域
末梢区域（stub）
完全末梢区域（Totally，stubby）
非纯末梢区域（NSSA）
Router ID 选取规则 Router ID：OSPF区域内唯一标识路由器的IP地址
自动选取 选取路由器上的loopback（回环）接口上数值最高的IP地址
如果没有loopback（回环）接口，在物理接口中选取IP地址最高的
手动选取 使用Router-id命令指定Router-ID
手动选取的优先级大于自动选取的优先级
DR和BDR 广播网络中（建立邻接关系）
构成n（n-1）/2个连接关系
其他路由器（Drothers）只和DR和BDR形成邻接关系
DR和BDR的选取 自动选取 网段上Router ID最大的为DR，第二大的为BDR
手动选取 优先级0-255 值越大，优先级越高，默认为1 优先级相同则比较Router ID
优先级被设置为0，则不参加DR和BDR的选举
路由器的优先级可以影响一个选举过程，但是它不能强制跟换已经存在的DR或BDR路由器
OSPF的组播地址 DR和BDR及选举过程用224.0.0.5
其他路由器（Drothers）用224.0.0.6
OSPF的度量值为COST（成本） cost=108/BW BW是是接口带宽
OSPF承载在IP数据包内，使用的协议号89
包明系Hello包用发现和维持邻居关系，选举DR和BDR数据库描述包（DBD）用于向邻居发送摘要信息以同步链路状态数据库链路状态请求包（LSR）在路由器收到新信息的DBD后发送，用于请求更详细的信息链路状态更新包（LSU）收到LSR后发送链路状态通告（LSA），一个LSU数据包可能包含几个LSA链路状态确认包（LSACK）确认已经收到DBD/LSU，每个LSA需要被分别确认 Down状态 初始化" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/5765e1fdfdb63c3e9527fc8710e7a332/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-03-24T16:30:41+08:00" />
<meta property="article:modified_time" content="2021-03-24T16:30:41+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">分分钟解决OSPF配置问题</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>OSPF协议</h4> 
 <ul><li><a href="#AS_6" rel="nofollow">一、自治系统（AS）</a></li><li><a href="#OSPF_21" rel="nofollow">二、OSPF</a></li><li><ul><li><ul><li><a href="#OSPF_24" rel="nofollow">OSPF的工作过程</a></li><li><a href="#OSPF_28" rel="nofollow">OSPF区域</a></li><li><a href="#_35" rel="nofollow">骨干区域</a></li><li><a href="#_39" rel="nofollow">非骨干区域---根据能够学习的路由器种类来区分</a></li><li><a href="#Router_ID__44" rel="nofollow">Router ID 选取规则</a></li><li><ul><li><ul><li><ul><li><a href="#_46" rel="nofollow">自动选取</a></li><li><a href="#_49" rel="nofollow">手动选取</a></li></ul> 
     </li></ul> 
    </li></ul> 
   </li></ul> 
   </li><li><a href="#DRBDR_52" rel="nofollow">DR和BDR</a></li><li><a href="#DRBDR_57" rel="nofollow">DR和BDR的选取</a></li><li><ul><li><ul><li><ul><li><ul><li><a href="#_58" rel="nofollow">自动选取</a></li><li><a href="#_61" rel="nofollow">手动选取</a></li></ul> 
     </li></ul> 
     </li><li><a href="#OSPF_68" rel="nofollow">OSPF的组播地址</a></li><li><ul><li><a href="#OSPFCOST_72" rel="nofollow">OSPF的度量值为COST（成本）</a></li></ul> 
    </li></ul> 
    </li><li><a href="#OSPF_95" rel="nofollow">OSPF多区(非骨干区域)</a></li><li><ul><li><ul><li><a href="#_105" rel="nofollow">路由器类型</a></li></ul> 
    </li></ul> 
   </li></ul> 
   </li><li><a href="#LSA_113" rel="nofollow">链路状态通告（LSA）</a></li></ul> 
  </li><li><a href="#_124" rel="nofollow">命令与实验</a></li><li><ul><li><a href="#IP_125" rel="nofollow">配置好IP地址后</a></li><li><ul><li><ul><li><a href="#_126" rel="nofollow">配置</a></li><li><a href="#_134" rel="nofollow">末梢网络配置命令</a></li><li><a href="#_155" rel="nofollow">完全末梢区域配置命令</a></li></ul> 
   </li></ul> 
  </li></ul> 
  </li><li><a href="#_171" rel="nofollow">高级配置</a></li><li><ul><li><ul><li><ul><li><ul><li><a href="#_172" rel="nofollow">路由的重分发</a></li><li><a href="#OSPF_189" rel="nofollow">OSPF地址汇总的作用</a></li><li><a href="#_194" rel="nofollow">虚链路</a></li><li><a href="#_197" rel="nofollow">虚链路的目的</a></li><li><a href="#_203" rel="nofollow">配置虚链路的规则及特点</a></li></ul> 
     </li><li><a href="#_232" rel="nofollow">虚链路配置命令</a></li><li><a href="#_239" rel="nofollow">链路汇总配置命令</a></li></ul> 
   </li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<hr color="#000000" size='1"'> 
<h2><a id="AS_6"></a>一、自治系统（AS）</h2> 
<p>AS是由同一个技术管理机构管理、使用统一选路策略的一些路由器的集合</p> 
<p>距离矢量路由“传说的路由”<br> 链路状态路由“传信的路由”</p> 
<p>内部网关协议（IGP）RIP、OSPF<br> 外部网关协议（EGP）BGP</p> 
<h2><a id="OSPF_21"></a>二、OSPF</h2> 
<p>链路状态路由协议：OSPF、isis</p> 
<h4><a id="OSPF_24"></a>OSPF的工作过程</h4> 
<p><strong>邻居列表、链路状态数据库、路由表</strong><br> 建立连接关系，形成邻居列表，相互学习链路状态信息，形成链路状态数据库，通过Dijkstra算法，得到最短路径树，形成路由表</p> 
<h4><a id="OSPF_28"></a>OSPF区域</h4> 
<p>为了适应大型的网络，OSPF在AS内划分多个区域</p> 
<p>每个OSPF路由器只维护所在区域的完整链路状态信息</p> 
<p>区域ID可以用十进制的数字表示，也可以用IP表示</p> 
<h4><a id="_35"></a>骨干区域</h4> 
<p>Aera 0:负责区域间路由信息传播</p> 
<h4><a id="_39"></a>非骨干区域—根据能够学习的路由器种类来区分</h4> 
<p>标准区域<br> 末梢区域（stub）<br> 完全末梢区域（Totally，stubby）<br> 非纯末梢区域（NSSA）</p> 
<h4><a id="Router_ID__44"></a>Router ID 选取规则</h4> 
<p>Router ID：OSPF区域内唯一标识路由器的IP地址</p> 
<h6><a id="_46"></a>自动选取</h6> 
<p>选取路由器上的loopback（回环）接口上数值最高的IP地址<br> 如果没有loopback（回环）接口，在物理接口中选取IP地址最高的</p> 
<h6><a id="_49"></a>手动选取</h6> 
<p>使用Router-id命令指定Router-ID<br> <strong>手动选取的优先级大于自动选取的优先级</strong></p> 
<h3><a id="DRBDR_52"></a>DR和BDR</h3> 
<p>广播网络中（建立邻接关系）<br> 构成n（n-1）/2个连接关系<br> 其他路由器（Drothers）只和DR和BDR形成邻接关系</p> 
<h3><a id="DRBDR_57"></a>DR和BDR的选取</h3> 
<h6><a id="_58"></a>自动选取</h6> 
<p>网段上Router ID最大的为DR，第二大的为BDR</p> 
<h6><a id="_61"></a>手动选取</h6> 
<p>优先级0-255 值越大，优先级越高，默认为1 优先级相同则比较Router ID<br> 优先级被设置为0，则不参加DR和BDR的选举</p> 
<p>路由器的优先级可以影响一个选举过程，但是它不能强制跟换已经存在的DR或BDR路由器</p> 
<h5><a id="OSPF_68"></a>OSPF的组播地址</h5> 
<p>DR和BDR及选举过程用224.0.0.5<br> 其他路由器（Drothers）用224.0.0.6</p> 
<h6><a id="OSPFCOST_72"></a>OSPF的度量值为COST（成本）</h6> 
<p>cost=10<sup>8</sup>/BW BW是是接口带宽</p> 
<p>OSPF承载在IP数据包内，使用的协议号89</p> 
<table><thead><tr><th>包</th><th>明系</th></tr></thead><tbody><tr><td>Hello包</td><td>用发现和维持邻居关系，选举DR和BDR</td></tr><tr><td>数据库描述包（DBD）</td><td>用于向邻居发送摘要信息以同步链路状态数据库</td></tr><tr><td>链路状态请求包（LSR）</td><td>在路由器收到新信息的DBD后发送，用于请求更详细的信息</td></tr><tr><td>链路状态更新包（LSU）</td><td>收到LSR后发送链路状态通告（LSA），一个LSU数据包可能包含几个LSA</td></tr><tr><td>链路状态确认包（LSACK）</td><td>确认已经收到DBD/LSU，每个LSA需要被分别确认</td></tr></tbody></table> 
<p>Down状态 初始化<br> Init状态 收到第一个Hello包 发送信息回去<br> 2-Way状态 双向建立连接<br> Exstart状态 建立主从关系 选举DR、BDR<br> Exchange状态 交换摘要信息（DBD）<br> Loading状态 加载详细信息（LSR、LSU）<br> Full状态 收敛后 完全连接</p> 
<h4><a id="OSPF_95"></a>OSPF多区(非骨干区域)</h4> 
<p><strong>作用</strong><br> 改善网络的可扩展性<br> 快速收敛</p> 
<p><strong>三种通信量</strong><br> 区域内通信量<br> 区域间通信量<br> 区域外部通信量</p> 
<h6><a id="_105"></a>路由器类型</h6> 
<p>1.内部路由器<br> 2.区域边界路由器（ABR）：区域间路由器<br> 3.自治系统边界路由器（ASBR）：与外部连接的路由器</p> 
<p>ABR 区域间路由器<br> ASBR 区域连接外部路由器</p> 
<h3><a id="LSA_113"></a>链路状态通告（LSA）</h3> 
<table><thead><tr><th>类型代码</th><th>描述</th><th>类型</th></tr></thead><tbody><tr><td>Type 1</td><td>路由器LSA</td><td>由区域内的路由器发出的，描述了路由器的的链路状态和花费,传递到整个区域内</td></tr><tr><td>Type 2</td><td>网络LSA</td><td>由区域内的DR发出的，描述了区域内变更信息，传递到整个区域内</td></tr><tr><td>Type 3</td><td>网络汇总LSA</td><td>ABR发出的，其他区域的汇总链路通告,描述了其他区域内某一-网段的路由， 区域间传递</td></tr><tr><td>Type4</td><td>ASBR汇总LSA</td><td>ABR发出的，用于通告ASBR信息，确定ASBR的位置,不会出现在ASBR所属区域之内</td></tr><tr><td>Type 5</td><td>AS外部LSA</td><td>ASBR发出的，用于通告外部路由，告诉相同AS的路由器通往外部AS的路径，在整个AS中进行泛洪</td></tr><tr><td>Type 7</td><td>NSSA外部LSA</td><td>NSSA区域内的ASBR发出的，用于通告本区域连接的外部路由，与Type 5类似，仅在非纯末梢区域内进行泛洪，传递时会被ABR转换为LSA5</td></tr></tbody></table> 
<h2><a id="_124"></a>命令与实验</h2> 
<h3><a id="IP_125"></a>配置好IP地址后</h3> 
<h5><a id="_126"></a>配置</h5> 
<p>[R3]ospf 1<br> [R3-ospf-1]area 0<br> [R3-ospf-rea-0.0.0.0] network 23.0.0.0 0.0.0.255<br> [R3-ospf-rea-0.0.0.0] network 34.0.0.0 0.0.0.255<br> [R3-ospf-rea-0.0.0.0] network 3.3.3.3 0.0.0.0<br> <img src="https://images2.imgbox.com/3b/07/GrOtbb5I_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="_134"></a>末梢网络配置命令</h5> 
<p>[R1]ospf 1<br> [R1-ospf-1]area 1<br> [R1-ospf-rea-0.0.0.1] network 192.168.100.0 0.0.0.255<br> [R1-ospf-rea-0.0.0.1] network 12.0.0.0 0.0.0.255<br> 先宣告直连网段,再配末梢网络<br> [R1-ospf-1-area-0.0.0.1] stub<br> [R1-ospf-1-area-0.0.0.1]nssa 非纯末梢路由</p> 
<p><img src="https://images2.imgbox.com/75/0b/FHunAHeZ_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/13/c3/dZ76DDeb_o.png" alt="在这里插入图片描述"></p> 
<p>[R1] display ip routing- table#此时末梢区域中的路由会显示一条默认路由到外部区域</p> 
<p><img src="https://images2.imgbox.com/9d/3a/P2xyZzIy_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="_155"></a>完全末梢区域配置命令</h5> 
<p>[R5]ospf 1<br> [R5-ospf-l]area 2<br> [R5-ospf-l-area-0.0.0.2]network 45.0.0.0 0.0.0.255<br> [R5-ospf-l-area-0.0.0.2]network 5.5.5.5 0.0.0.0<br> 先宣告直连网段,再配<br> [R5-ospf-l-area-0.0.0.2]stub<br> <strong>R4配stub no-summar</strong><br> [R4-ospf-l-area-0.0.0.2]stub no-summar<br> <img src="https://images2.imgbox.com/5b/c4/JlGUV2j6_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/44/63/Rd7ynKHr_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/43/2e/kC9EXBsJ_o.png" alt="在这里插入图片描述"></p> 
<p>[R5] display ip routing- table#此时完全末梢区域中的路由只显示一条默认路由</p> 
<h2><a id="_171"></a>高级配置</h2> 
<h6><a id="_172"></a>路由的重分发</h6> 
<p>一个单----IP路由协议是管理网络中IP路由的首选方案<br> 能执行多个路由协议,每-一个路由协议和该路由协议所服务的网络属于同一个自治系统<br> 使用路由重分发特性以交换由不同协议创建的路由信息</p> 
<p><strong>路由重分发的考虑</strong><br> 度量值<br> 管理距离 （优先级）</p> 
<p><strong>路径类型</strong><br> 类型1 内部开销+外部开销<br> 类型2 外部开销<br> —主要用于当有2个或以上的ASBR通向同- -外部网络时进行选路</p> 
<p><img src="https://images2.imgbox.com/0b/e5/oGt8mUOc_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="OSPF_189"></a>OSPF地址汇总的作用</h6> 
<p><strong>地址汇总也是通过减少泛洪的L SA数量节省资源<br> 可以通过屏蔽一-些网络不稳定的细节来节省资源<br> 减少路由表中的路由条目</strong></p> 
<h6><a id="_194"></a>虚链路</h6> 
<p>指一条通过一个非骨干区域连接到骨干区域的链路</p> 
<h6><a id="_197"></a>虚链路的目的</h6> 
<p>通过一个非骨干区域连接-个区域到骨干区域<br> 通过一个非骨干区域连接一个分段的骨干区域两边的部分区域</p> 
<h6><a id="_203"></a>配置虚链路的规则及特点</h6> 
<p>虚链路必须配置在两台ABR路由器之间<br> 传送区域不能是一个末梢区域<br> 虚链路的稳定性取决于其经过的区域的稳定性<br> 虚链路有助于提供逻辑冗余</p> 
<pre><code class="prism language-j">[R1-rip-1]import-route ospf 1 cost 5                ospf注入rip中  cost最大值不能超过15

[R1-ospf-1]import-route rip 1 type 1 cost 1         rip注入ospf中 
</code></pre> 
<p><img src="https://images2.imgbox.com/7e/9f/h0bMJbCo_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-j">[R1-ospf-1]default-route-advertise always          ospf重分发默认路由
[R2-ospf-1] import-route direct                    ospf重分发直连路由
[R2-ospf-1] import-route static                    ospf重分发静态路由
ospf换成是rip 就是rip的重分发
</code></pre> 
<p><img src="https://images2.imgbox.com/49/87/I9MhXAGO_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/dd/4a/qL542296_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="_232"></a>虚链路配置命令</h5> 
<pre><code class="prism language-j">[R2-ospf-1-area-0.0.0.1]vlink-peer 1.1.1.1       互相指定被穿越区域两端ABR的路由ID
[R1-ospf-1-area-0.0.0.1]vlink-peer 2.2.2.2
[R1]display ospf                                 查看 本地上通过虚链路建立的OSPF邻居关系
</code></pre> 
<h5><a id="_239"></a>链路汇总配置命令</h5> 
<pre><code class="prism language-j">[R4-ospf-1-aera-0.0.0.0] abr - summary  192.168.0.0 255.255.248.0   区间汇总
[R5-ospf-1] asbr-summary 10.0.0.0 255.248.0.0          外部汇总
</code></pre> 
<p><img src="https://images2.imgbox.com/57/a7/PFcsPPMy_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/b3/4c/PwVefsTc_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/a3/63/xLrjOStq_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/43795b0c8470deab1cf68d7a92b1d7a6/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">C语言基础---指针数组----初始化方式&amp;常量指针数组、指针常量数组</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/84b59e7b803f7e74b046ca3d254ca060/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Efuse--电编程熔丝</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>