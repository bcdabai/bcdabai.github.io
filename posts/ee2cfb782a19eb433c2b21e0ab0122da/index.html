<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>springboot整合Elasticsearch7.6实现简单查询及高亮分词查询 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="springboot整合Elasticsearch7.6实现简单查询及高亮分词查询" />
<meta property="og:description" content="文章目录 前言集成环境准备简单查询分词高亮查询 前言 该文章需要提前准备好Elasticsearch7.6以及ik分词器的环境，如果还没准备好的可以看看之前以及发过的文章，liunx下安装elasticsearch7.6、ik分词器以及kibana可视化工具
集成环境准备 1.导入spring-data-elasticsearch依赖
版本需要与Elasticsearch一致，还需要注意自己的springboot版本是否支持
本文springboot为2.3，依赖也为2.3，elasticsearch,为7.6.2
&lt;dependency&gt; &lt;groupId&gt;org.springframework.data&lt;/groupId&gt; &lt;artifactId&gt;spring-data-elasticsearch&lt;/artifactId&gt; &lt;version&gt;${version}.RELEASE&lt;/version&gt; &lt;/dependency&gt; 2.elasticsearch配置文件
因为原来的配置不支持了
配置文件如下：
@Configuration public class EsConf { @Value(&#34;${elasticSearch.url}&#34;) private String edUrl; //localhost:9200 写在配置文件中就可以了 @Bean RestHighLevelClient client() { ClientConfiguration clientConfiguration = ClientConfiguration.builder() .connectedTo(edUrl)//elasticsearch地址 .build(); return RestClients.create(clientConfiguration).rest(); } } 3.实体类准备
关于实体类中的几个注解，不清楚的可以去查看文档，这里不过多介绍了
@Data @Document(indexName = &#34;user&#34;)//索引名称 建议与实体类一致 public class User { @Id private Integer id; @Field(type = FieldType.Auto)//自动检测类型 private Integer age; @Field(type = FieldType.Keyword)//手动设置为keyword 但同时也就不能分词 private String name; @Field(type = FieldType." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/ee2cfb782a19eb433c2b21e0ab0122da/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-08-16T11:17:18+08:00" />
<meta property="article:modified_time" content="2020-08-16T11:17:18+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">springboot整合Elasticsearch7.6实现简单查询及高亮分词查询</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night-eighties">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_1" rel="nofollow">前言</a></li><li><a href="#_5" rel="nofollow">集成环境准备</a></li><li><a href="#_70" rel="nofollow">简单查询</a></li><li><a href="#_142" rel="nofollow">分词高亮查询</a></li></ul> 
</div> 
<p></p> 
<h2><a id="_1"></a>前言</h2> 
<p>该文章需要提前准备好Elasticsearch7.6以及ik分词器的环境，如果还没准备好的可以看看之前以及发过的文章，<a href="https://blog.csdn.net/weixin_44102992/article/details/107954129">liunx下安装elasticsearch7.6、ik分词器以及kibana可视化工具<br> </a></p> 
<h2><a id="_5"></a>集成环境准备</h2> 
<p><strong>1.导入spring-data-elasticsearch依赖</strong><br> 版本需要与Elasticsearch一致，还需要注意自己的springboot版本是否支持<br> 本文springboot为2.3，依赖也为2.3，elasticsearch,为7.6.2<br> <img src="https://images2.imgbox.com/bc/0f/yNosJCav_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-java"><span class="token generics function"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
  <span class="token generics function"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
  <span class="token generics function"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>spring<span class="token operator">-</span>data<span class="token operator">-</span>elasticsearch<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
  <span class="token generics function"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span>$<span class="token punctuation">{<!-- --></span>version<span class="token punctuation">}</span><span class="token punctuation">.</span>RELEASE<span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
</code></pre> 
<p><strong>2.elasticsearch配置文件</strong></p> 
<p>因为原来的配置不支持了<br> <img src="https://images2.imgbox.com/57/9e/J05HgXgK_o.png" alt="在这里插入图片描述"><br> <strong>配置文件如下：</strong></p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EsConf</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${elasticSearch.url}"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> String edUrl<span class="token punctuation">;</span>

    <span class="token comment">//localhost:9200 写在配置文件中就可以了</span>
    <span class="token annotation punctuation">@Bean</span>
    RestHighLevelClient <span class="token function">client</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        ClientConfiguration clientConfiguration <span class="token operator">=</span> ClientConfiguration<span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">connectedTo</span><span class="token punctuation">(</span>edUrl<span class="token punctuation">)</span><span class="token comment">//elasticsearch地址</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> RestClients<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>clientConfiguration<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>3.实体类准备</strong><br> 关于实体类中的几个注解，不清楚的可以去查看文档，这里不过多介绍了</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Document</span><span class="token punctuation">(</span>indexName <span class="token operator">=</span> <span class="token string">"user"</span><span class="token punctuation">)</span><span class="token comment">//索引名称 建议与实体类一致</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Id</span>
    <span class="token keyword">private</span> Integer id<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Field</span><span class="token punctuation">(</span>type <span class="token operator">=</span> FieldType<span class="token punctuation">.</span>Auto<span class="token punctuation">)</span><span class="token comment">//自动检测类型</span>
    <span class="token keyword">private</span> Integer age<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Field</span><span class="token punctuation">(</span>type <span class="token operator">=</span> FieldType<span class="token punctuation">.</span>Keyword<span class="token punctuation">)</span><span class="token comment">//手动设置为keyword  但同时也就不能分词</span>
    <span class="token keyword">private</span> String name<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Field</span><span class="token punctuation">(</span>type <span class="token operator">=</span> FieldType<span class="token punctuation">.</span>Text<span class="token punctuation">,</span>analyzer <span class="token operator">=</span> <span class="token string">"ik_smart"</span><span class="token punctuation">,</span>searchAnalyzer <span class="token operator">=</span> <span class="token string">"ik_max_word"</span><span class="token punctuation">)</span><span class="token comment">//设置为text  可以分词</span>
    <span class="token keyword">private</span> String info<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> 
<p><strong>4.Elasticsearch Service准备</strong><br> <strong>ElasticsearchRepository&lt;,&gt;</strong> 第一个就是所准备的实体类，第二个是id的类型<br> 继承完这个会提供最基本的增删改查方法，也可以自己定义一些，自己定义的方法命名需要符合规则，并不需要自己去实现</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">EsUserService</span> <span class="token keyword">extends</span> <span class="token class-name">ElasticsearchRepository</span><span class="token generics function"><span class="token punctuation">&lt;</span>User<span class="token punctuation">,</span>Integer<span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//根据name查询</span>
    List<span class="token generics function"><span class="token punctuation">&lt;</span>User<span class="token punctuation">&gt;</span></span> <span class="token function">findByName</span><span class="token punctuation">(</span>String name<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//根据name和info查询</span>
    List<span class="token generics function"><span class="token punctuation">&lt;</span>User<span class="token punctuation">&gt;</span></span> <span class="token function">findByNameAndInfo</span><span class="token punctuation">(</span>String name<span class="token punctuation">,</span>String info<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> 
<h2><a id="_70"></a>简单查询</h2> 
<p>这里直接使用假数据并没有连接数据库，还需要注意几个点：<br> 1.elasticsearchTemplate需要采用ElasticsearchRestTemplate 原来的已经过时了<br> 2.elasticsearch的mapping没有自动生成，这导致了我们在实体类中指定的分词器没有生效，所以我在导入数据的同时，手动导入了mapping<br> 3.LogAnnotation是我自定义的注解，大家可以直接去掉</p> 
<p><strong>controller如下：</strong></p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EsController</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> ElasticsearchRestTemplate elasticsearchTemplate<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> EsUserService esUserService<span class="token punctuation">;</span>

    <span class="token keyword">private</span> String<span class="token punctuation">[</span><span class="token punctuation">]</span> names<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">"诸葛亮"</span><span class="token punctuation">,</span><span class="token string">"曹操"</span><span class="token punctuation">,</span><span class="token string">"李白"</span><span class="token punctuation">,</span><span class="token string">"韩信"</span><span class="token punctuation">,</span><span class="token string">"赵云"</span><span class="token punctuation">,</span><span class="token string">"小乔"</span><span class="token punctuation">,</span><span class="token string">"狄仁杰"</span><span class="token punctuation">,</span><span class="token string">"李四"</span><span class="token punctuation">,</span><span class="token string">"诸小明"</span><span class="token punctuation">,</span><span class="token string">"王五"</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> String<span class="token punctuation">[</span><span class="token punctuation">]</span> infos<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">"我来自中国的一个小乡村，地处湖南省"</span><span class="token punctuation">,</span><span class="token string">"我来自中国的一个大城市，名叫上海，人们称作魔都"</span>
            <span class="token punctuation">,</span><span class="token string">"我来自东北，家住大囤里，一口大碴子话"</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token annotation punctuation">@LogAnnotation</span><span class="token punctuation">(</span>requestRemark <span class="token operator">=</span> <span class="token string">"存数据"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"saveUser"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> ResultVO <span class="token function">saveUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    	<span class="token comment">//添加索引mapping    索引会自动创建但mapping自只用默认的这会导致分词器不生效 所以这里我们手动导入mapping</span>
        elasticsearchTemplate<span class="token punctuation">.</span><span class="token function">putMapping</span><span class="token punctuation">(</span>User<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Random random <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        List<span class="token generics function"><span class="token punctuation">&lt;</span>User<span class="token punctuation">&gt;</span></span> users <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">20</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            User user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            user<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            user<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span>names<span class="token punctuation">[</span>random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            user<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span>random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            user<span class="token punctuation">.</span><span class="token function">setInfo</span><span class="token punctuation">(</span>infos<span class="token punctuation">[</span>random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            users<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        Iterable<span class="token generics function"><span class="token punctuation">&lt;</span>User<span class="token punctuation">&gt;</span></span> users1 <span class="token operator">=</span> esUserService<span class="token punctuation">.</span><span class="token function">saveAll</span><span class="token punctuation">(</span>users<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ResultVO</span><span class="token punctuation">(</span>users1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@LogAnnotation</span><span class="token punctuation">(</span>requestRemark <span class="token operator">=</span> <span class="token string">"根据id查询数据"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"getDataById"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> ResultVO <span class="token function">getDataById</span><span class="token punctuation">(</span>Integer id<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ResultVO</span><span class="token punctuation">(</span>esUserService<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@LogAnnotation</span><span class="token punctuation">(</span>requestRemark <span class="token operator">=</span> <span class="token string">"分页查询所有数据"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"getAllDataByPage"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> ResultVO <span class="token function">getAllDataByPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">//本该传入page和size，这里为了方便就直接写死了</span>
        Pageable page <span class="token operator">=</span> PageRequest<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span> Sort<span class="token punctuation">.</span>Direction<span class="token punctuation">.</span>ASC<span class="token punctuation">,</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Page<span class="token generics function"><span class="token punctuation">&lt;</span>User<span class="token punctuation">&gt;</span></span> all <span class="token operator">=</span> esUserService<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ResultVO</span><span class="token punctuation">(</span>all<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@LogAnnotation</span><span class="token punctuation">(</span>requestRemark <span class="token operator">=</span> <span class="token string">"根据名字查询"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"getDataByName"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> ResultVO <span class="token function">getDataByName</span><span class="token punctuation">(</span>String name<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ResultVO</span><span class="token punctuation">(</span>esUserService<span class="token punctuation">.</span><span class="token function">findByName</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@LogAnnotation</span><span class="token punctuation">(</span>requestRemark <span class="token operator">=</span> <span class="token string">"根据名字和介绍查询"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"getDataByNameAndInfo"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> ResultVO <span class="token function">getDataByNameAndInfo</span><span class="token punctuation">(</span>String name<span class="token punctuation">,</span>String info<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">//这里是查询两个字段取交集，即代表两个条件需要同时满足</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ResultVO</span><span class="token punctuation">(</span>esUserService<span class="token punctuation">.</span><span class="token function">findByNameAndInfo</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span>info<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p><strong>测试结果：</strong><br> <img src="https://images2.imgbox.com/23/17/nXIQ5fIV_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/ad/4d/c7XR84XZ_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/f8/69/edKVMckT_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/b0/4c/h4SFNr3H_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_142"></a>分词高亮查询</h2> 
<pre><code class="prism language-java">    <span class="token annotation punctuation">@LogAnnotation</span><span class="token punctuation">(</span>requestRemark <span class="token operator">=</span> <span class="token string">"查询高亮显示"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"getHightByUser"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> ResultVO <span class="token function">getHightByUser</span><span class="token punctuation">(</span>String value<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">//根据一个值查询多个字段  并高亮显示  这里的查询是取并集，即多个字段只需要有一个字段满足即可</span>
        <span class="token comment">//需要查询的字段</span>
        BoolQueryBuilder boolQueryBuilder<span class="token operator">=</span> QueryBuilders<span class="token punctuation">.</span><span class="token function">boolQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span>QueryBuilders<span class="token punctuation">.</span><span class="token function">matchQuery</span><span class="token punctuation">(</span><span class="token string">"info"</span><span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span>QueryBuilders<span class="token punctuation">.</span><span class="token function">matchQuery</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//构建高亮查询</span>
        NativeSearchQuery searchQuery <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NativeSearchQueryBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withQuery</span><span class="token punctuation">(</span>boolQueryBuilder<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withHighlightFields</span><span class="token punctuation">(</span>
                        <span class="token keyword">new</span> <span class="token class-name">HighlightBuilder<span class="token punctuation">.</span>Field</span><span class="token punctuation">(</span><span class="token string">"info"</span><span class="token punctuation">)</span>
                        <span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">HighlightBuilder<span class="token punctuation">.</span>Field</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withHighlightBuilder</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HighlightBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">preTags</span><span class="token punctuation">(</span><span class="token string">"&lt;span style='color:red'&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">postTags</span><span class="token punctuation">(</span><span class="token string">"&lt;/span&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//查询</span>
        SearchHits<span class="token generics function"><span class="token punctuation">&lt;</span>User<span class="token punctuation">&gt;</span></span> search <span class="token operator">=</span> elasticsearchTemplate<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span>searchQuery<span class="token punctuation">,</span> User<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//得到查询返回的内容</span>
        List<span class="token operator">&lt;</span>SearchHit<span class="token generics function"><span class="token punctuation">&lt;</span>User<span class="token punctuation">&gt;</span></span><span class="token operator">&gt;</span> searchHits <span class="token operator">=</span> search<span class="token punctuation">.</span><span class="token function">getSearchHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//设置一个最后需要返回的实体类集合</span>
        List<span class="token generics function"><span class="token punctuation">&lt;</span>User<span class="token punctuation">&gt;</span></span> users <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//遍历返回的内容进行处理</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span>SearchHit<span class="token generics function"><span class="token punctuation">&lt;</span>User<span class="token punctuation">&gt;</span></span> searchHit<span class="token operator">:</span>searchHits<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token comment">//高亮的内容</span>
            Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> List<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span><span class="token operator">&gt;</span> highlightFields <span class="token operator">=</span> searchHit<span class="token punctuation">.</span><span class="token function">getHighlightFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//将高亮的内容填充到content中</span>
            searchHit<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span>highlightFields<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token operator">==</span>null <span class="token operator">?</span> searchHit<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span>highlightFields<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            searchHit<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setInfo</span><span class="token punctuation">(</span>highlightFields<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"info"</span><span class="token punctuation">)</span><span class="token operator">==</span>null <span class="token operator">?</span> searchHit<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span>highlightFields<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"info"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//放到实体类中</span>
            users<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>searchHit<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ResultVO</span><span class="token punctuation">(</span>users<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p><strong>测试结果：</strong><br> <img src="https://images2.imgbox.com/c4/87/YizPqodQ_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/65cc21d7c9d2af0ee94274e39720976c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">PCL之使用过程中遇到的坑、报错、解决方法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/dcb04ff51c005ff9d1a141faf25ef891/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">JdbcDaoSupport的使用以及Dao的两种编写方式</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>