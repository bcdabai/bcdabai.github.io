<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Nmap的介绍、安装 并进行网络扫描 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Nmap的介绍、安装 并进行网络扫描" />
<meta property="og:description" content="Nmap概述 Nmap(Network Mapper(网络映射器))是一个网络连接端扫描软件，用来扫描网上电脑开放的网络连接端。确定哪些服务运行在哪些连接端，并且推断计算机运行哪个操作系统（这是亦称 fingerprinting）。它是网络管理员必用的软件之一，以及用以评估网络系统安全。
正如大多数被用于网络安全的工具，nmap 也是不少黑客及骇客（又称脚本小子）爱用的工具 。系统管理员可以利用nmap来探测工作环境中未经批准使用的服务器，但是黑客会利用nmap来搜集目标电脑的网络设定，从而计划攻击的方法。
Nmap包含四项基本功能：主机发现（Host Discovery）端口扫描（Port Scanning）版本侦测（Version Detection）操作系统侦测（Operating System Detection）而这四项功能之间，又存在大致的依赖关系（通常情况下的顺序关系，但特殊应用另外考虑），首先需要进行主机发现，随后确定端口状况，然后确定端口上运行具体应用程序与版本信息，然后可以进行操作系统的侦测。而在四项基本功能的基础上，Nmap提供防火墙与IDS（IntrusionDetection System,入侵检测系统）的规避技巧，可以综合应用到四个基本功能的各个阶段；另外Nmap提供强大的NSE（Nmap Scripting Language）脚本引擎功能，脚本可以对基本功能进行补充和扩展。
通常，一个简单的使用ICMP协议的ping操作可以满足一般需求；也可以深入探测UDP或者TCP端口，直至主机所 使用的操作系统；还可以将所有探测结果记录到各种格式的日志中， 供进一步分析操作。
Nmap安装 首先访问Nmap官网，获得windows对应版本的安装包。
根据提示,一直安装即可
软件主界面
可以看出其内置了很多扫描类型，支持查看多种扫描结果，UI界面比较直观
此外，还可以在linux终端内安装，更加灵活。
Nmap使用 查看linux下nmap的帮助信息。(执行命令nmpa -h)
Nmap 7.80 ( https://nmap.org )
Usage: nmap [Scan Type(s)] [Options] {target specification}
可见nmap指令的一般格式是：nmap \[扫描类型(可叠加)\] \[选项\] \[目标\]
其中目标可以有如下格式：
TARGET SPECIFICATION: Can pass hostnames, IP addresses, networks, etc. Ex: scanme.nmap.org, microsoft.com/24, 192.168.0.1; 10.0.0-255.1-254 -iL &lt;inputfilename&gt;: Input from list of hosts/networks -iR &lt;num hosts&gt;: Choose random targets --exclude &lt;host1[,host2][,host3],." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/4469ef1352e42c96c0f28daefbca7289/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-04-05T21:34:42+08:00" />
<meta property="article:modified_time" content="2022-04-05T21:34:42+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Nmap的介绍、安装 并进行网络扫描</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="Nmap_0"></a>Nmap概述</h3> 
<p>Nmap(Network Mapper(网络映射器))是一个网络连接端扫描软件，用来扫描网上电脑开放的网络连接端。确定哪些服务运行在哪些连接端，并且推断计算机运行哪个操作系统（这是亦称 fingerprinting）。它是网络管理员必用的软件之一，以及用以评估网络系统安全。</p> 
<p>正如大多数被用于网络安全的工具，nmap 也是不少黑客及骇客（又称脚本小子）爱用的工具 。系统管理员可以利用nmap来探测工作环境中未经批准使用的服务器，但是黑客会利用nmap来搜集目标电脑的网络设定，从而计划攻击的方法。</p> 
<p>Nmap包含四项基本功能：主机发现（Host Discovery）端口扫描（Port Scanning）版本侦测（Version Detection）操作系统侦测（Operating System Detection）而这四项功能之间，又存在大致的依赖关系（通常情况下的顺序关系，但特殊应用另外考虑），首先需要进行主机发现，随后确定端口状况，然后确定端口上运行具体应用程序与版本信息，然后可以进行操作系统的侦测。而在四项基本功能的基础上，Nmap提供防火墙与IDS（IntrusionDetection System,入侵检测系统）的规避技巧，可以综合应用到四个基本功能的各个阶段；另外Nmap提供强大的NSE（Nmap Scripting Language）脚本引擎功能，脚本可以对基本功能进行补充和扩展。</p> 
<img src="https://images2.imgbox.com/38/76/Rnb79EAp_o.png" alt="image-20220305141030035"> 
<p>通常，一个简单的使用ICMP协议的ping操作可以满足一般需求；也可以深入探测UDP或者TCP端口，直至主机所 使用的操作系统；还可以将所有探测结果记录到各种格式的日志中， 供进一步分析操作。</p> 
<h3><a id="Nmap_12"></a>Nmap安装</h3> 
<p>首先访问Nmap官网，获得windows对应版本的安装包。</p> 
<img src="https://images2.imgbox.com/07/14/wjLnbahC_o.png" alt="image-20220305141048987"> 
<p>根据提示,一直安装即可</p> 
<img src="https://images2.imgbox.com/e1/e0/awQs5i1p_o.png" alt="image-20220305141059297"> 
<p>软件主界面</p> 
<img src="https://images2.imgbox.com/f3/31/LhcxtmRR_o.png" alt="image-20220305141126938"> 
<p>可以看出其内置了很多扫描类型，支持查看多种扫描结果，UI界面比较直观</p> 
<p>此外，还可以在linux终端内安装，更加灵活。</p> 
<img src="https://images2.imgbox.com/fa/0d/vosOdu8L_o.png" alt="image-20220305141133430"> 
<h3><a id="Nmap_32"></a>Nmap使用</h3> 
<p>查看linux下nmap的帮助信息。(执行命令<code>nmpa -h</code>)</p> 
<blockquote> 
 <p>Nmap 7.80 ( https://nmap.org )</p> 
</blockquote> 
<blockquote> 
 <p>Usage: nmap [Scan Type(s)] [Options] {target specification}</p> 
</blockquote> 
<p>可见nmap指令的一般格式是：<code>nmap \[扫描类型(可叠加)\] \[选项\] \[目标\]</code></p> 
<p>其中目标可以有如下格式：</p> 
<pre><code>TARGET SPECIFICATION:
Can pass hostnames, IP addresses, networks, etc.
Ex: scanme.nmap.org, microsoft.com/24, 192.168.0.1; 10.0.0-255.1-254
-iL &lt;inputfilename&gt;: Input from list of hosts/networks
-iR &lt;num hosts&gt;: Choose random targets
--exclude &lt;host1[,host2][,host3],...&gt;: Exclude hosts/networks
--excludefile &lt;exclude_file&gt;: Exclude list from file
</code></pre> 
<p>其他可以指定的参数(部分)有:</p> 
<ul><li> <p>HOST DISCOVERY: 目标勘测的手段</p> </li><li> <p>SCAN TECHNIQUES: 指定扫描的技术</p> </li><li> <p>PORT SPECIFICATION AND SCAN ORDER: 指定端口和扫描顺序</p> </li><li> <p>SERVICE/VERSION DETECTION: 服务/版本 勘测</p> </li><li> <p>OS DETECTION: 操作系统勘测</p> </li></ul> 
<p>参考windows上有UI的nmap版本内置的扫描类型：</p> 
<hr> 
<pre><code>  Intense scan                  nmap -T4 -A -v www.baidu.com

  Intense scan plus UDP         nmap -sS -sU -T4 -A -v www.baidu.com

  Intense scan, all TCP ports   nmap -p 1-65535 -T4 -A -v www.baidu.com

  Intense scan, no ping         nmap -T4 -A -v -Pn www.baidu.com

  Ping scan                     nmap -sn www.baidu.com

  Quick scan                    nmap -T4 -F www.baidu.com

  Quick scan plus               nmap -sV -T4 -O -F \--version-light www.baidu.com

  Quick traceroute              nmap -sn \--traceroute www.baidu.com

  Regular scan                  nmap www.baidu.com

  Slow comprehensive scan       nmap -sS -sU -T4 -A -v -PE -PP -PS80,443 -PA3389 -PU40125 -PY -g 53 \--script \"default or (discovery and safe)\" www.baidu.com
</code></pre> 
<hr> 
<h2><a id="Nmap_95"></a>利用Nmap实施网络扫描</h2> 
<h3><a id="_97"></a>主机发现</h3> 
<h4><a id="_99"></a>原理</h4> 
<p>当网络不通时，我们需要ping一下主机，检查网关是否正常，这与主机发现原理一样。当测试目标是一个网络时，在线的主机才是我们的用主机发现的目标，nmap中提供了许多主机发现的方法，大多与TCP/IP协议簇中的协议有关。</p> 
<ul><li>1、跳过ping扫描阶段：</li></ul> 
<p>nmap进行其他扫描之前都会对目标进行一个ping扫描。如果目标对ping 扫描无反应将结束整个扫描过程。这种方法可以跳过那些没有响应的主机，从而节省大量时间，但如果目标在线只是采用某种手段屏蔽了ping 扫描，从而躲过我们的其他扫描操作，我们可以指定无论目标是否响应ping 扫描，毒药将整个扫描过程完整的参数呈现出来；如 nmap -PN 192.168.169.131。</p> 
<ul><li>2、仅使用ping协议进行主机发现：</li></ul> 
<p>有时需要对大量的主机扫描，nmap如果对一个目标主机采取各种手段进行扫描会花费大量时间。这时我们只对目标主机进行扫描。如 nmap -sP 192.168.169.131。</p> 
<ul><li>3、使用ARP协议进行主机发现：</li></ul> 
<p>当目标主机与我们处于同一网段时，使用ARP协议扫描是最佳选择。不仅速度快，扫描结果精准。因为没有任何的安全措施会阻止正常的arp请求。如 nmap -PR 192.168.169.131。</p> 
<ul><li>4、使用TCP协议进行主机发现：</li></ul> 
<p>TCP协议主要是三次握手构成，主动端发送syn报文，被动端回应syn+ack报文，然后主动端回应ack。利用此过程，nmap向目标发送syn报文，如果对方回应了syn+ack则说明在线。半开扫描，如nmap -sS 192.168.169.131。全开扫描，如nmap -sT 192.168.169.131。</p> 
<ul><li>5、使用UDP协议进行主机发现：</li></ul> 
<p>UDP相比较TCP简单，但扫描时并不比TCP协议方便，而且花费时间长，因此这种扫描不常用。如nmap -sU 192.168.169.131。</p> 
<h4><a id="_123"></a>用法</h4> 
<p>通常主机发现并不单独使用，而只是作为端口扫描、版本侦测、OS侦测先行步骤。而在某些特殊应用（例如确定大型局域网内活动主机的数量），可能会单独专门适用主机发现功能来完成。</p> 
<pre><code>HOST DISCOVERY:
  -sL: List Scan - simply list targets to scan
  -sn: Ping Scan - disable port scan
  -Pn: Treat all hosts as online -- skip host discovery
  -PS/PA/PU/PY[portlist]: TCP SYN/ACK, UDP or SCTP discovery to given ports
  -PE/PP/PM: ICMP echo, timestamp, and netmask request discovery probes
  -PO[protocol list]: IP Protocol Ping
  -n/-R: Never do DNS resolution/Always resolve [default: sometimes]
  --dns-servers &lt;serv1[,serv2],...&gt;: Specify custom DNS servers
  --system-dns: Use OS's DNS resolver
  --traceroute: Trace hop path to each host
</code></pre> 
<p>其中，比较常用的使用的是-sn，表示只单独进行主机发现过程；-Pn表示直接跳过主机发现而进行端口扫描等高级操作（如果已经确知目标主机已经开启，可用该选项）；-n，如果不想使用DNS或reverse DNS解析，那么可以使用该选项。</p> 
<h4><a id="_143"></a>操作</h4> 
<p>命令：<code>nmap -sn IP</code></p> 
<img src="https://images2.imgbox.com/dc/a4/jlpVEkTq_o.png" alt="image-20220305141911689"> 
<h3><a id="_149"></a>端口扫描</h3> 
<h4><a id="_151"></a>原理</h4> 
<p>nmap向目标主机发送报文并根据返回报文从而认定端口的6种状态。（注意：这六种状态只是namp认为的端口状态，例如：有些主机或者防火墙会返回一些不可靠的报文从而妨碍nmap对端口开放问题的确认）。</p> 
<ul><li> <p>Open（开放的）：端口处于开放状态，意味着目标机器上的应用程序正在该端口监听连接/报文；</p> </li><li> <p>Closed（关闭的）：端口处于关闭状态。这里我们值得注意的是关闭的端口也是可访问的，只是该端口没有应用程序在它上面监听，但是他们随时可能开放；</p> </li><li> <p>Filtered（过滤的）：由于包过滤阻止探测报文到达端口， Nmap 无法确定该端口是否开放。过滤可能来自专业的防火墙设备，路由器规则或者主机上的软件防火墙；</p> </li><li> <p>Unfiltered（未被过滤的）：意味着端口可访问，但 Nmap 不能确定它是开放还是关闭。这种状态和filtered的区别在于：unfiltered的端口能被nmap访问，但是nmap根据返回的报文无法确定端口的开放状态，而filtered的端口直接就没能够被nmap访问。端口被定义为Unfilterd只会发生在TCP ack扫描类型时当返回RST的报文。而端口被定义为filtered 状态的原因是是报文被防火墙设备，路由器规则，或者防火墙软件拦截，无法送达到端口，这通常表现为发送NMAP的主机收到ICMP报错报文，或者主机通过多次重复发送没有收到任何回应）。</p> </li><li> <p>Open|filtered状态：这种状态主要是nmap无法区别端口处于open状态还是filtered状态。这种状态只会出现在open端口对报文不做回应的扫描类型中，如：udp，ip protocol ，TCP null，fin，和xmas扫描类型。</p> </li><li> <p>Closed|filtered状态：这种状态主要出现在nmap无法区分端口处于closed还是filtered时。</p> </li></ul> 
<h4><a id="_167"></a>用法</h4> 
<p>扫描方式选项</p> 
<pre><code>SCAN TECHNIQUES:
  -sS/sT/sA/sW/sM: TCP SYN/Connect()/ACK/Window/Maimon scans
  -sU: UDP Scan
  -sN/sF/sX: TCP Null, FIN, and Xmas scans
  --scanflags &lt;flags&gt;: Customize TCP scan flags
  -sI &lt;zombie host[:probeport]&gt;: Idle scan
  -sY/sZ: SCTP INIT/COOKIE-ECHO scans
  -sO: IP protocol scan
  -b &lt;FTP relay host&gt;: FTP bounce scan
</code></pre> 
<p>端口参数与扫描顺序：</p> 
<pre><code>PORT SPECIFICATION AND SCAN ORDER:
  -p &lt;port ranges&gt;: Only scan specified ports
    Ex: -p22; -p1-65535; -p U:53,111,137,T:21-25,80,139,8080,S:9
  --exclude-ports &lt;port ranges&gt;: Exclude the specified ports from scanning
  -F: Fast mode - Scan fewer ports than the default scan
  -r: Scan ports consecutively - don't randomize
  --top-ports &lt;number&gt;: Scan &lt;number&gt; most common ports
  --port-ratio &lt;ratio&gt;: Scan ports more common than &lt;ratio&gt;
</code></pre> 
<h4><a id="_198"></a>操作</h4> 
<p>命令：<code>nmap --sS --sU --T4 --top-ports 300 www.baidu.com</code></p> 
<p>参数：</p> 
<p>-sS表示使用TCP SYN方式扫描TCP端口；</p> 
<p>-sU表示扫描UDP端口；</p> 
<p>-T4表示时间级别配置4级；</p> 
<p>–top-ports 300表示扫描最有可能开放的300个端口（TCP和UDP分别有300个端口）。</p> 
<img src="https://images2.imgbox.com/8c/8c/lpnOQ4CJ_o.png" alt="image-20220305142104990"> 
<p>从上图中，我们看到扫描结果，在扫描的300个端口中，有298个是关闭的；开放的 分别是80和443端口。</p> 
<h3><a id="_216"></a>版本侦测</h3> 
<h4><a id="_218"></a>原理</h4> 
<p>版本侦测主要分为以下几个步骤：</p> 
<ul><li> <p>首先检查open与open|filtered状态的端口是否在排除端口列表内。如果在排除列表，将该端口剔除。</p> </li><li> <p>如果是TCP端口，尝试建立TCP连接。尝试等待片刻（通常6秒或更多，具体时间可以查询文件nmap-services-probes中Probe TCP NULL q||对应的totalwaitms）。通常在等待时间内，会接收到目标机发送的"WelcomeBanner"信息。nmap将接收到的Banner与nmap-services-probes中NULL probe中的签名进行对比。查找对应应用程序的名字与版本信息。</p> </li><li> <p>如果通过"Welcome Banner"无法确定应用程序版本，那么nmap再尝试发送其他的探测包（即从nmap-services-probes中挑选合适的probe），将probe得到回复包与数据库中的签名进行对比。如果反复探测都无法得出具体应用，那么打印出应用返回报文，让用户自行进一步判定。</p> </li><li> <p>如果是UDP端口，那么直接使用nmap-services-probes中探测包进行探测匹配。根据结果对比分析出UDP应用服务类型。</p> </li><li> <p>如果探测到应用程序是SSL，那么调用openSSL进一步的侦查运行在SSL之上的具体的应用类型。</p> </li><li> <p>如果探测到应用程序是SunRPC，那么调用brute-force RPC grinder进一步探测具体服务。</p> </li></ul> 
<h4><a id="_234"></a>用法</h4> 
<pre><code>SERVICE/VERSION DETECTION:
  -sV: Probe open ports to determine service/version info
  --version-intensity &lt;level&gt;: Set from 0 (light) to 9 (try all probes)
  --version-light: Limit to most likely probes (intensity 2)
  --version-all: Try every single probe (intensity 9)
  --version-trace: Show detailed version scan activity (for debugging)
</code></pre> 
<h4><a id="_247"></a>操作</h4> 
<p>命令：<code>nmap --sV www.baidu.com</code></p> 
<img src="https://images2.imgbox.com/1b/ba/D0lc5lSM_o.png" alt="image-20220305142133908"> 
<p>从图中可知，本次一个扫描了1000个端口，其中有998个是关闭的。</p> 
<p>对开开放的两个端口上的服务进行版本侦测的结如方框内显示。</p> 
<h3><a id="OS_257"></a>OS侦测</h3> 
<h4><a id="_259"></a>原理</h4> 
<p>Nmap使用TCP/IP协议栈指纹来识别不同的操作系统和设备。在RFC规范中，有些地方对TCP/IP的实现并没有强制规定，由此不同的TCP/IP方案中可能都有自己的特定方式。Nmap主要是根据这些细节上的差异来判断操作系统的类型的。</p> 
<p>具体实现方式如下：</p> 
<ul><li> <p>Nmap内部包含了2600多已知系统的指纹特征（在文件nmap-os-db文件中）。将此指纹数据库作为进行指纹对比的样本库。</p> </li><li> <p>分别挑选一个open和closed的端口，向其发送经过精心设计的TCP/UDP/ICMP数据包，根据返回的数据包生成一份系统指纹。</p> </li><li> <p>将探测生成的指纹与nmap-os-db中指纹进行对比，查找匹配的系统。如果无法匹配，以概率形式列举出可能的系统。</p> </li></ul> 
<h4><a id="_272"></a>用法</h4> 
<pre><code>OS DETECTION:
-O: Enable OS detection
--osscan-limit: Limit OS detection to promising targets
--osscan-guess: Guess OS more aggressively
</code></pre> 
<h4><a id="_283"></a>操作</h4> 
<p>命令：<code>nmap --O 127.0.0.1</code></p> 
<img src="https://images2.imgbox.com/1c/21/f5NAyqYp_o.png" alt="image-20220305142207580"> 
<p>从上图中可看到，指定-O选项后先进行主机发现与端口扫描，根据扫描到端口来进行进一步的OS侦测。获取的结果信息有设备类型，操作系统类型，操作系统的CPE描述，操作系统细节，网络距离等。</p> 
<p>最后综合上述命令，对www.baidu.com执行一次加强的快速扫描：</p> 
<p>命令： <code>nmap -sV -T4 -O -F --version-light www.cug.edu.cn</code></p> 
<img src="https://images2.imgbox.com/e3/cf/nFCNNkgN_o.png" alt="image-20220305142245486"> 
<p>通过上述结果，可以看出：</p> 
<pre><code>本次侦测共用时5.38s。扫描了一个IP的100个端口，该主机在线。

扫描出5个运行中的服务，类型如上图。

暂时无法准确判断操作系统的类型，但是最有可能是FreeBSD和PC-BSD，对应的概率如上图所示。
</code></pre> 
<h2><a id="_307"></a>参考文献</h2> 
<ol><li> <p>张星亮,张洪波.网络安全扫描工具的比较与分析[J].电脑知识与技术,2018,14(11):56-57.DOI:10.14004/j.cnki.ckt.2018.1200.</p> </li><li> <p>俞海.基于Nmap网络扫描的场景仿真实验[J].绍兴文理学院学报(自然科学),2017,37(01):28-31.DOI:10.16169/j.issn.1008-293x.k.2017.07.005.</p> </li></ol>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ceb5d409fc29fb0389779074f5141cfa/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">关于利用fopen函数创建文件的问题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/228f0e28b3f5b52fda1346103fabf7a2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Docker简介以及如何在 IDEA 中使用</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>