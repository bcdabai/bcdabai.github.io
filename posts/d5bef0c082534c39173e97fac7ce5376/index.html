<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Clickhouse - System Tables 集合（一） - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Clickhouse - System Tables 集合（一）" />
<meta property="og:description" content="Clickhouse自带系统库system，启动时创建系统表，无数据文件，主要用于记录Clickhouse的系统信息和状态指标。
1.query_log 作用：ClickHouse开启慢sql查询
开启方法：
打开各个ClickHouse实例的users.xml文件，在默认配置最上层profile（如default）中加入：
&lt;log_queries&gt;1&lt;/log_queries&gt; service clickhouse-server restart 注意：如添加该参数之后表不自动创建，需要重启clickhouse-server服务。 检查每个节点ch中config.xml文件里默认的日志配置是否开启 &lt;!-- Query log. Used only for queries with setting log_queries = 1. --&gt; &lt;query_log&gt; &lt;!-- What table to insert data. If table is not exist, it will be created. When query log structure is changed after system update, then old table will be renamed and new table will be created automatically. --&gt; &lt;database&gt;system&lt;/database&gt; &lt;table&gt;query_log&lt;/table&gt; &lt;!-- PARTITION BY expr https://clickhouse." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/d5bef0c082534c39173e97fac7ce5376/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-04-07T15:07:54+08:00" />
<meta property="article:modified_time" content="2021-04-07T15:07:54+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Clickhouse - System Tables 集合（一）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>Clickhouse自带系统库system，启动时创建系统表，无数据文件，主要用于记录Clickhouse的系统信息和状态指标。</p> 
<h2><a id="1query_log_2"></a>1.query_log</h2> 
<p>作用：ClickHouse开启慢sql查询<br> 开启方法：<br> 打开各个ClickHouse实例的users.xml文件，在默认配置最上层profile（如default）中加入：</p> 
<pre><code class="prism language-sql"><span class="token operator">&lt;</span>log_queries<span class="token operator">&gt;</span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>log_queries<span class="token operator">&gt;</span>

service clickhouse<span class="token operator">-</span>server restart
</code></pre> 
<pre><code>    注意：如添加该参数之后表不自动创建，需要重启clickhouse-server服务。
    检查每个节点ch中config.xml文件里默认的日志配置是否开启
&lt;!-- Query log. Used only for queries with setting log_queries = 1. --&gt;
&lt;query_log&gt;
    &lt;!-- What table to insert data. If table is not exist, it will be created.
         When query log structure is changed after system update,
          then old table will be renamed and new table will be created automatically.
    --&gt;
    &lt;database&gt;system&lt;/database&gt;
    &lt;table&gt;query_log&lt;/table&gt;
    &lt;!--
        PARTITION BY expr https://clickhouse.yandex/docs/en/table_engines/custom_partitioning_key/
        Example:
            event_date
            toMonday(event_date)
            toYYYYMM(event_date)
            toStartOfHour(event_time)
    --&gt;
    &lt;partition_by&gt;toYYYYMM(event_date)&lt;/partition_by&gt;
    &lt;!-- Interval of flushing data. --&gt;
    &lt;flush_interval_milliseconds&gt;7500&lt;/flush_interval_milliseconds&gt;
&lt;/query_log&gt;
</code></pre> 
<p>查询：</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> system<span class="token punctuation">.</span>query_log <span class="token keyword">limit</span> <span class="token number">1</span>\G

<span class="token keyword">Row</span> <span class="token number">1</span>:
──────
<span class="token keyword">type</span>:                 QueryStart
event_date:           <span class="token number">2021</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">07</span>
event_time:           <span class="token number">2021</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">07</span> <span class="token number">09</span>:<span class="token number">19</span>:<span class="token number">17</span>
query_start_time:     <span class="token number">2021</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">07</span> <span class="token number">09</span>:<span class="token number">19</span>:<span class="token number">17</span>
query_duration_ms:    <span class="token number">0</span>
read_rows:            <span class="token number">0</span>
read_bytes:           <span class="token number">0</span>
written_rows:         <span class="token number">0</span>
written_bytes:        <span class="token number">0</span>
result_rows:          <span class="token number">0</span>
result_bytes:         <span class="token number">0</span>
memory_usage:         <span class="token number">0</span>
query:                <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> system<span class="token punctuation">.</span>query_log
exception:            
stack_trace:          
is_initial_query:     <span class="token number">1</span>
<span class="token keyword">user</span>:                 <span class="token keyword">default</span>
query_id:             <span class="token number">61720</span>a95<span class="token operator">-</span>c6d4<span class="token operator">-</span><span class="token number">43</span>d1<span class="token operator">-</span>bbbc<span class="token operator">-</span><span class="token number">4</span>c4f9de1ca54
address:              ::ffff:<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>
port:                 <span class="token number">5404</span>
initial_user:         <span class="token keyword">default</span>
initial_query_id:     <span class="token number">61720</span>a95<span class="token operator">-</span>c6d4<span class="token operator">-</span><span class="token number">43</span>d1<span class="token operator">-</span>bbbc<span class="token operator">-</span><span class="token number">4</span>c4f9de1ca54
initial_address:      ::ffff:<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>
initial_port:         <span class="token number">5404</span>
interface:            <span class="token number">1</span>
os_user:              root
client_hostname:      worker1
client_name:          ClickHouse client
client_revision:      <span class="token number">54432</span>
client_version_major: <span class="token number">20</span>
client_version_minor: <span class="token number">2</span>
client_version_patch: <span class="token number">1</span>
http_method:          <span class="token number">0</span>
http_user_agent:      
quota_key:            
revision:             <span class="token number">54432</span>
thread_numbers:       <span class="token punctuation">[</span><span class="token punctuation">]</span>
os_thread_ids:        <span class="token punctuation">[</span><span class="token punctuation">]</span>
ProfileEvents<span class="token punctuation">.</span>Names:  <span class="token punctuation">[</span><span class="token punctuation">]</span>
ProfileEvents<span class="token punctuation">.</span><span class="token keyword">Values</span>: <span class="token punctuation">[</span><span class="token punctuation">]</span>
Settings<span class="token punctuation">.</span>Names:       <span class="token punctuation">[</span><span class="token string">'use_uncompressed_cache'</span><span class="token punctuation">,</span><span class="token string">'load_balancing'</span><span class="token punctuation">,</span><span class="token string">'log_queries'</span><span class="token punctuation">,</span><span class="token string">'max_memory_usage'</span><span class="token punctuation">]</span>
Settings<span class="token punctuation">.</span><span class="token keyword">Values</span>:      <span class="token punctuation">[</span><span class="token string">'0'</span><span class="token punctuation">,</span><span class="token string">'random'</span><span class="token punctuation">,</span><span class="token string">'1'</span><span class="token punctuation">,</span><span class="token string">'10000000000'</span><span class="token punctuation">]</span>
</code></pre> 
<p>列：</p> 
<pre><code class="prism language-sql"><span class="token keyword">type</span> <span class="token punctuation">(</span>Enum8<span class="token punctuation">)</span>     ：执行查询时发生的事件的类型
	QueryStart’ <span class="token operator">=</span> <span class="token number">1</span>                        查询执行开始
	QueryFinish’ <span class="token operator">=</span> <span class="token number">2</span>                      查询执行成功
event_date <span class="token punctuation">(</span><span class="token keyword">Date</span><span class="token punctuation">)</span>                    查询开始日期
event_time <span class="token punctuation">(</span><span class="token keyword">DateTime</span><span class="token punctuation">)</span>            查询开始日期
query_start_time <span class="token punctuation">(</span><span class="token keyword">DateTime</span><span class="token punctuation">)</span>   查询执行的开始时间。
query_duration_ms <span class="token punctuation">(</span>UInt64<span class="token punctuation">)</span>    查询执行的持续时间（毫秒） 
read_rows <span class="token punctuation">(</span>UInt64<span class="token punctuation">)</span>                 参与查询的所有表和表函数中读取的总数或行数。包括常用的子查，<span class="token operator">IN</span>和<span class="token keyword">JOIN</span>的子查询。对于分布式查询，read_rows包括在所有副本上读取的行总数。每个副本发送它的read_rows值，查询的服务器启动器汇总所有接收到的值和本地值。缓存卷不会影响这个值。
read_bytes <span class="token punctuation">(</span>UInt64<span class="token punctuation">)</span>                 参与查询的所有表和表函数中读取的总数或行数。包括常用的子查，<span class="token operator">IN</span>和<span class="token keyword">JOIN</span>的子查询。对于分布式查询，read_rows包括在所有副本上读取的行总数。每个副本发送它的read_rows值，查询的服务器启动器汇总所有接收到的值和本地值。缓存卷不会影响这个值。
written_rows <span class="token punctuation">(</span>UInt64<span class="token punctuation">)</span>             对于插入查询，表示写入的行数。对于其他查询，列值为<span class="token number">0</span>
written_bytes <span class="token punctuation">(</span>UInt64<span class="token punctuation">)</span>             对于插入查询，表示写入的字节数。对于其他查询，列值为<span class="token number">0</span>。
result_rows <span class="token punctuation">(</span>UInt64<span class="token punctuation">)</span>                选择查询结果中的行数，或插入查询中的行数
result_bytes <span class="token punctuation">(</span>UInt64<span class="token punctuation">)</span>                用于存储查询结果的RAM<span class="token punctuation">(</span>字节<span class="token punctuation">)</span>容量。
memory_usage <span class="token punctuation">(</span>UInt64<span class="token punctuation">)</span>           查询所消耗的内存。
query <span class="token punctuation">(</span>String<span class="token punctuation">)</span>                            查询语句
exception <span class="token punctuation">(</span>String<span class="token punctuation">)</span>                     异常输出
stack_trace <span class="token punctuation">(</span>String<span class="token punctuation">)</span>                   堆栈跟踪。如果查询成功完成，则为空字符串
is_initial_query <span class="token punctuation">(</span>UInt8<span class="token punctuation">)</span>              查询类型
<span class="token number">1</span>         客户端发起的查询
<span class="token number">0</span>         查询是作为分布式查询执行的一部分由另一个查询发起的
<span class="token keyword">user</span> <span class="token punctuation">(</span>String<span class="token punctuation">)</span>                             当前查询的用户名
query_id <span class="token punctuation">(</span>String<span class="token punctuation">)</span>                       查询编号
address <span class="token punctuation">(</span>IPv6<span class="token punctuation">)</span>                          进行查询的IP地址
port <span class="token punctuation">(</span>UInt16<span class="token punctuation">)</span>                            查询的客户端端口
initial_user <span class="token punctuation">(</span>String<span class="token punctuation">)</span>                  运行初始查询的用户名<span class="token punctuation">(</span>用于分布式查询执行
initial_query_id <span class="token punctuation">(</span>String<span class="token punctuation">)</span>            初始查询的ID<span class="token punctuation">(</span>用于分布式查询执行）
initial_address <span class="token punctuation">(</span>IPv6<span class="token punctuation">)</span>                父查询的IP地址
initial_port <span class="token punctuation">(</span>UInt16<span class="token punctuation">)</span>                  父查询的客户端端口
interface <span class="token punctuation">(</span>UInt8<span class="token punctuation">)</span>                       发起查询的接口
<span class="token number">1</span> — TCP<span class="token punctuation">.</span>
<span class="token number">2</span> — HTTP<span class="token punctuation">.</span>
os_user <span class="token punctuation">(</span>String<span class="token punctuation">)</span>                     运行clickhouse<span class="token operator">-</span>client的操作系统用户名
client_hostname <span class="token punctuation">(</span>String<span class="token punctuation">)</span>      运行clickhouse<span class="token operator">-</span>client或另一个TCP客户机的客户机的主机名
client_name <span class="token punctuation">(</span>String<span class="token punctuation">)</span>              Clickhouse<span class="token operator">-</span>client或其他TCP客户端名称
client_revision <span class="token punctuation">(</span>UInt32<span class="token punctuation">)</span>         修改clickhouse<span class="token operator">-</span>client或其他TCP客户端
client_version_major <span class="token punctuation">(</span>UInt32<span class="token punctuation">)</span>         Clickhouse<span class="token operator">-</span>client或其他TCP客户端的主要版本。
client_version_minor <span class="token punctuation">(</span>UInt32<span class="token punctuation">)</span>        Clickhouse<span class="token operator">-</span>client或其他TCP客户端的小版本。
client_version_patch <span class="token punctuation">(</span>UInt32<span class="token punctuation">)</span>        Clickhouse<span class="token operator">-</span>client或其他TCP客户端版本的补丁组件<span class="token punctuation">.</span>
http_method <span class="token punctuation">(</span>UInt8<span class="token punctuation">)</span>                       发起查询的HTTP方法
<span class="token number">0</span> — 从TCP接口启动查询
<span class="token number">1</span> — GET 方法
<span class="token number">2</span> — POST 方法
http_user_agent <span class="token punctuation">(</span>String<span class="token punctuation">)</span>            在HTTP请求中传递的UserAgent头。
quota_key <span class="token punctuation">(</span>String<span class="token punctuation">)</span>                                 配额设置中指定的“配额键
revision <span class="token punctuation">(</span>UInt32<span class="token punctuation">)</span>                                    ClickHouse revision
thread_numbers <span class="token punctuation">(</span>Array<span class="token punctuation">(</span>UInt32<span class="token punctuation">)</span><span class="token punctuation">)</span>           参与查询执行的线程数
ProfileEvents<span class="token punctuation">.</span>Names <span class="token punctuation">(</span>Array<span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">)</span>      衡量不同指标的计数器
ProfileEvents<span class="token punctuation">.</span><span class="token keyword">Values</span> <span class="token punctuation">(</span>Array<span class="token punctuation">(</span>UInt64<span class="token punctuation">)</span><span class="token punctuation">)</span>     ProfileEvents中列出的度量值
Settings<span class="token punctuation">.</span>Names <span class="token punctuation">(</span>Array<span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">)</span>             客户端运行查询时更改的设置名称。要启用对设置的日志更改，将log_query_settings参数设置为<span class="token number">1</span>
Settings<span class="token punctuation">.</span><span class="token keyword">Values</span> <span class="token punctuation">(</span>Array<span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">)</span>              设置中列出的设置值
</code></pre> 
<p>备注：partition_by表示查询日志表的分区列，语法与普通建表时相同，默认按月分区。flush_interval_milliseconds则表示日志刷入表中的周期，默认7.5秒，可以根据取数时效自己调节</p> 
<p>注意事项：<br> 需在每个节点users.xml配置文件添加该参数，并重启server服务<br> 外部查询需要创建分布式表，以便统计所用节点的查询日志<br> CREATE TABLE IF NOT EXISTS system.query_log_all<br> ON CLUSTER sht_ck_cluster_pro<br> AS system.query_log<br> ENGINE = Distributed(sht_ck_cluster_pro,system,query_log,rand());<br> 该日志表没有自动过期功能，为了防止历史日志数据占用大量磁盘空间，可以手动为每张query_log表设定TTL（这边根据需求设置默认为15天）<br> ALTER TABLE system.query_log MODIFY TTL event_date + INTERVAL 15 DAY;</p> 
<h2><a id="2clusters_152"></a>2.clusters</h2> 
<p>metrika.xml 配置文件中配置的集群副本、分片等信息。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> system<span class="token punctuation">.</span>clusters <span class="token keyword">LIMIT</span> <span class="token number">2</span> FORMAT Vertical<span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> system<span class="token punctuation">.</span>clusters
<span class="token keyword">LIMIT</span> <span class="token number">2</span>
FORMAT Vertical

<span class="token keyword">Row</span> <span class="token number">1</span>:
──────
cluster:                 test_cluster_two_shards
shard_num:               <span class="token number">1</span>
shard_weight:            <span class="token number">1</span>
replica_num:             <span class="token number">1</span>
host_name:               <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>
host_address:            <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>
port:                    <span class="token number">9000</span>
is_local:                <span class="token number">1</span>
<span class="token keyword">user</span>:                    <span class="token keyword">default</span>
default_database:        
errors_count:            <span class="token number">0</span>
estimated_recovery_time: <span class="token number">0</span>

<span class="token keyword">Row</span> <span class="token number">2</span>:
──────
cluster:                 test_cluster_two_shards
shard_num:               <span class="token number">2</span>
shard_weight:            <span class="token number">1</span>
replica_num:             <span class="token number">1</span>
host_name:               <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.2</span>
host_address:            <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.2</span>
port:                    <span class="token number">9000</span>
is_local:                <span class="token number">0</span>
<span class="token keyword">user</span>:                    <span class="token keyword">default</span>
default_database:        
errors_count:            <span class="token number">0</span>
estimated_recovery_time: <span class="token number">0</span>

<span class="token number">2</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span><span class="token punctuation">.</span> Elapsed: <span class="token number">0.002</span> sec<span class="token punctuation">.</span> 
</code></pre> 
<p>列：</p> 
<pre><code class="prism language-sql">cluster （字符串）                        群集名称
shard_num （UInt32）                 集群中的分片号，从<span class="token number">1</span>开始
shard_weight （UInt32）              写入数据时分片的权重
replica_num （UInt32）                分片中的副本号，从<span class="token number">1</span>开始
host_name （字符串<span class="token punctuation">)</span>                    主机名，在配置中指定
host_address （字符串）              从DNS获得的主机IP地址
port （UInt16）                            用于连接到服务器的端口
<span class="token keyword">user</span> （字符串）                            用于连接到服务器的用户名
errors_count （UInt32）               该主机无法访问副本的次数
estimated_recovery_time （UInt32）        距副本错误计数为零为止还剩几秒，它被认为恢复了正常
</code></pre> 
<pre><code>    请注意，errors_count对集群的每个查询都会更新一次，但是estimated_recovery_time会按需重新计算。因此，可能存在非零errors_count和零的情况estimated_recovery_time，下一个查询将为零，errors_count并尝试使用副本，就好像它没有错误一样。
</code></pre> 
<h2><a id="3columns_212"></a>3.columns</h2> 
<p>类似查询DESCRIBE TABLE的信息，但是一次可以获取多个表。</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> system<span class="token punctuation">.</span><span class="token keyword">columns</span> <span class="token keyword">LIMIT</span> <span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span> FORMAT Vertical<span class="token punctuation">;</span>

<span class="token keyword">Row</span> <span class="token number">1</span>:
──────
<span class="token keyword">database</span>:                <span class="token keyword">default</span>
<span class="token keyword">table</span>:                   <span class="token punctuation">.</span><span class="token keyword">inner</span><span class="token punctuation">.</span>trans_log_view
name:                    bankid
<span class="token keyword">type</span>:                    Enum8<span class="token punctuation">(</span><span class="token string">'微信支付'</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'支付宝'</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'中国银联'</span> <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'中铁银通卡'</span> <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">'工商银行'</span> <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">'农业银行'</span> <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token string">'中国银行'</span> <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token string">'建设银行'</span> <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">'招商银行'</span> <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token string">'邮储银行'</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">'第三方支付'</span> <span class="token operator">=</span> <span class="token number">11</span><span class="token punctuation">)</span>
default_kind:            
default_expression:      
data_compressed_bytes:   <span class="token number">141683</span>
data_uncompressed_bytes: <span class="token number">560858</span>
marks_bytes:             <span class="token number">1680</span>
<span class="token keyword">comment</span>:                 
is_in_partition_key:     <span class="token number">0</span>
is_in_sorting_key:       <span class="token number">1</span>
is_in_primary_key:       <span class="token number">1</span>
is_in_sampling_key:      <span class="token number">0</span>
compression_codec:       

<span class="token number">1</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span><span class="token punctuation">.</span> Elapsed: <span class="token number">0.003</span> sec<span class="token punctuation">.</span>
</code></pre> 
<p>列：</p> 
<pre><code class="prism language-sql"><span class="token keyword">database</span>（String）                        数据库名称
<span class="token keyword">table</span>（String）                               表名
name（String）                              列名
<span class="token keyword">type</span>（String）                                列类型
position（UInt64）                        以<span class="token number">1</span>开头的表中列的顺序位置
default_kind（字符串）                  表达类型（<span class="token keyword">DEFAULT</span>，MATERIALIZED，ALIAS作为默认值）或者如果没有定义它为空字符串
default_expression（String）          默认值的表达式，如果未定义，则为空字符串
data_compressed_bytes（UInt64）        压缩数据的大小，以字节为单位
data_uncompressed_bytes（UInt64）    解压缩数据的大小，以字节为单位
marks_bytes（UInt64）                           标记的大小，以字节为单位
<span class="token keyword">comment</span>（String）                                  对列进行注释，如果未定义，则为空字符串
is_in_partition_key（UInt8）                     指示列是否在分区表达式中的标志
is_in_sorting_key（UInt8）                       指示列是否在排序键表达式中的标志
is_in_primary_key（UInt8）                      指示列是否在主键表达式中的标志
is_in_sampling_key（UInt8）                   指示列是否在采样关键字表达式中的标志
compression_codec（String）                  压缩编解码器名称
</code></pre> 
<h2><a id="4crash_log_260"></a>4.crash_log</h2> 
<p>堆栈跟踪的致命错误信息。默认情况下，该表在数据库中不存在，仅在发生致命错误时才创建该表。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> system<span class="token punctuation">.</span>crash_log <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> event_time <span class="token keyword">DESC</span> <span class="token keyword">LIMIT</span> <span class="token number">1</span><span class="token punctuation">;</span>

（结果不完整） 
<span class="token keyword">Row</span> <span class="token number">1</span>:
──────
event_date:   <span class="token number">2020</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">14</span>
event_time:   <span class="token number">2020</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">14</span> <span class="token number">15</span>:<span class="token number">47</span>:<span class="token number">40</span>
timestamp_ns: <span class="token number">1602679660271312710</span>
signal:       <span class="token number">11</span>
thread_id:    <span class="token number">23624</span>
query_id:     <span class="token number">428</span>aab7c<span class="token operator">-</span><span class="token number">8</span>f5c<span class="token operator">-</span><span class="token number">44</span>e9<span class="token operator">-</span><span class="token number">9607</span><span class="token operator">-</span>d16b44467e69
trace:        <span class="token punctuation">[</span><span class="token number">188531193</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span>
trace_full:   <span class="token punctuation">[</span><span class="token string">'3. DB::(anonymous namespace)::FunctionFormatReadableTimeDelta::executeImpl(std::__1::vector&lt;DB::ColumnWithTypeAndName, std::__1::allocator&lt;DB::ColumnWithTypeAndName&gt; &gt;&amp;, std::__1::vector&lt;unsigned long, std::__1::allocator&lt;unsigned long&gt; &gt; const&amp;, unsigned long, unsigned long) const @ 0xb3cc1f9 in /home/username/work/ClickHouse/build/programs/clickhouse'</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span>
version:      ClickHouse <span class="token number">20.11</span><span class="token number">.1</span><span class="token number">.1</span>
revision:     <span class="token number">54442</span>
build_id:
</code></pre> 
<p>列：</p> 
<pre><code class="prism language-sql">event_date（<span class="token keyword">Datetime</span>）                   事件的日期
event_time（<span class="token keyword">Datetime</span>）                   事件的时间
timestamp_ns（UInt64）                  事件的时间戳，以纳秒为单位
signal（Int32）                                 信号编号
thread_id（UInt64）                          线程ID
query_id（String）                            查询ID
trace（Array（UInt64））                崩溃时的堆栈跟踪。每个元素都是ClickHouse服务器进程内部的虚拟内存地址
trace_full（Array（String））           崩溃时的堆栈跟踪。每个元素在ClickHouse服务器进程内部都包含一个调用方法
version（String）                              ClickHouse服务器版本
revision（UInt32）                            ClickHouse服务器修订版
build_id（String）                             编译器生成的BuildID
</code></pre> 
<h2><a id="5data_type_families_299"></a>5.data_type_families</h2> 
<p>支持的数据类型的信息。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> system<span class="token punctuation">.</span>data_type_families <span class="token keyword">WHERE</span> alias_to <span class="token operator">=</span> <span class="token string">'String'</span>
            
┌─name───────┬─case_insensitive─┬─alias_to─┐
│ <span class="token keyword">LONGBLOB</span>   │                <span class="token number">1</span> │ String   │
│ <span class="token keyword">LONGTEXT</span>   │                <span class="token number">1</span> │ String   │
│ <span class="token keyword">TINYTEXT</span>   │                <span class="token number">1</span> │ String   │
│ <span class="token keyword">TEXT</span>       │                <span class="token number">1</span> │ String   │
│ <span class="token keyword">VARCHAR</span>    │                <span class="token number">1</span> │ String   │
│ <span class="token keyword">MEDIUMBLOB</span> │                <span class="token number">1</span> │ String   │
│ <span class="token keyword">BLOB</span>       │                <span class="token number">1</span> │ String   │
│ <span class="token keyword">TINYBLOB</span>   │                <span class="token number">1</span> │ String   │
│ <span class="token keyword">CHAR</span>       │                <span class="token number">1</span> │ String   │
│ <span class="token keyword">MEDIUMTEXT</span> │                <span class="token number">1</span> │ String   │
└────────────┴──────────────────┴──────────┘
</code></pre> 
<p>列：</p> 
<pre><code class="prism language-sql">name（String）                    数据类型名称
case_insensitive（UInt8）     此属性显示是否可以在查询中以不区分大小写的方式使用数据类型名称。例如，<span class="token keyword">Date</span>和<span class="token keyword">date</span>都有效
alias_to（String）                 为其name别名的数据类型名称
</code></pre> 
<h2><a id="6databases_327"></a>6.databases</h2> 
<p>当前用户可用的数据库的信息。</p> 
<pre><code class="prism language-sql">创建test库
<span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> test<span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> system<span class="token punctuation">.</span><span class="token keyword">databases</span><span class="token punctuation">;</span>

┌─name────┬─<span class="token keyword">engine</span>───┬─data_path─────────────────────────┬─metadata_path─────────────────────────┐
│ <span class="token keyword">default</span> │ Ordinary │ <span class="token operator">/</span>var<span class="token operator">/</span>lib<span class="token operator">/</span>clickhouse<span class="token operator">/</span><span class="token keyword">data</span><span class="token operator">/</span><span class="token keyword">default</span><span class="token operator">/</span> │ <span class="token operator">/</span>var<span class="token operator">/</span>lib<span class="token operator">/</span>clickhouse<span class="token operator">/</span>metadata<span class="token operator">/</span><span class="token keyword">default</span><span class="token operator">/</span> │
│ system  │ Ordinary │ <span class="token operator">/</span>var<span class="token operator">/</span>lib<span class="token operator">/</span>clickhouse<span class="token operator">/</span><span class="token keyword">data</span><span class="token operator">/</span>system<span class="token operator">/</span>  │ <span class="token operator">/</span>var<span class="token operator">/</span>lib<span class="token operator">/</span>clickhouse<span class="token operator">/</span>metadata<span class="token operator">/</span>system<span class="token operator">/</span>  │
│ test    │ Ordinary │ <span class="token operator">/</span>var<span class="token operator">/</span>lib<span class="token operator">/</span>clickhouse<span class="token operator">/</span><span class="token keyword">data</span><span class="token operator">/</span>test<span class="token operator">/</span>    │ <span class="token operator">/</span>var<span class="token operator">/</span>lib<span class="token operator">/</span>clickhouse<span class="token operator">/</span>metadata<span class="token operator">/</span>test<span class="token operator">/</span>    │
└─────────┴──────────┴───────────────────────────────────┴───────────────────────────────────────┘
</code></pre> 
<p>列：</p> 
<pre><code class="prism language-sql">name（String）                            数据库名称
<span class="token keyword">engine</span>（字符串）                         数据库引擎
data_path（String）                     数据路径
metadata_path（String）             元数据路径
uuid（UUID）                               数据库UUID
</code></pre> 
<p>该name系统表中的列用于实现SHOW DATABASES查询。</p> 
<p>7.dictionaries<br> 查询库中所有字典表</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> system<span class="token punctuation">.</span>dictionaries\G

<span class="token keyword">Row</span> <span class="token number">1</span>:
──────
<span class="token keyword">database</span>:           <span class="token keyword">default</span>
name:               dict
<span class="token keyword">status</span>:             LOADED
origin:             <span class="token keyword">default</span><span class="token punctuation">.</span>dict
<span class="token keyword">type</span>:               Hashed
<span class="token keyword">key</span>:                UInt64
attribute<span class="token punctuation">.</span>names:    <span class="token punctuation">[</span><span class="token string">'city'</span><span class="token punctuation">]</span>
attribute<span class="token punctuation">.</span><span class="token keyword">types</span>:    <span class="token punctuation">[</span><span class="token string">'String'</span><span class="token punctuation">]</span>
bytes_allocated:    <span class="token number">27259080</span>
query_count:        <span class="token number">0</span>
hit_rate:           <span class="token number">1</span>
element_count:      <span class="token number">200000</span>
load_factor:        <span class="token number">0.19073486328125</span>
source:             ClickHouse: <span class="token keyword">default</span><span class="token punctuation">.</span>ip2city
lifetime_min:       <span class="token number">1</span>
lifetime_max:       <span class="token number">10</span>
loading_start_time: <span class="token number">2021</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">07</span> <span class="token number">12</span>:<span class="token number">13</span>:<span class="token number">35</span>
loading_duration:   <span class="token number">0.027</span>
last_exception:     

<span class="token number">1</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span><span class="token punctuation">.</span> Elapsed: <span class="token number">0.003</span> sec<span class="token punctuation">.</span> 
</code></pre> 
<p>列：</p> 
<pre><code class="prism language-sql"><span class="token keyword">database</span>（String）             由DDL查询创建的字典的数据库的名称。其他字典的空字符串
name（字符串）                 字典名称
<span class="token keyword">status</span>（Enum8）                词典状态
NOT_LOADED              由于未使用字典，因此未加载字典
LOADED                       字典已成功加载
FAILED                         由于错误而无法加载字典
LOADING                     词典正在加载中
LOADED_AND_RELOADING        字典已成功加载，并且现在正在重新加载（常见原因：SYSTEM RELOAD DICTIONARY查询，超时，字典配置已更改）
FAILED_AND_RELOADING            由于错误而无法加载字典，现在正在加载
origin（String）                     描述字典的配置文件的路径
<span class="token keyword">type</span>（String）                       字典分配的类型。将词典存储在内存中
<span class="token keyword">key</span>                                         密钥类型：数字密钥（UInt64）或Сomposite密钥（String）—形式为“（（类型<span class="token number">1</span>，类型<span class="token number">2</span>，…，类型n）”）
attribute<span class="token punctuation">.</span>names（Array（String））    字典提供的属性名称的数组
attribute<span class="token punctuation">.</span><span class="token keyword">types</span>（Array（String））      字典提供的属性类型的对应数组
bytes_allocated（UInt64）                   为字典分配的RAM量
query_count（UInt64）                        自从加载字典以来或自上次成功重新引导以来的查询数
hit_rate（Float64）                               对于缓存字典，该值在缓存中的使用百分比
element_count（UInt64）                     词典中存储的项目数
load_factor（Float64）                          字典中填充的百分比（对于哈希字典，百分比填充在哈希表中）
source（String）                                    描述字典数据源的文本
lifetime_min（UInt64）                          字典在内存中的最小生存期，此后ClickHouse尝试重新加载字典（如果invalidate_query已设置，则仅在字典已更改的情况下）。设置以秒为单位
lifetime_max（UInt64）                          字典在内存中的最大生存期，此后ClickHouse尝试重新加载字典（如果invalidate_query已设置，则仅在字典已更改的情况下）。设置以秒为单位
loading_start_time（<span class="token keyword">DateTime</span>）            加载字典的开始时间
last_successful_update_time（<span class="token keyword">DateTime</span>）        加载或更新字典的结束时间。帮助监视外部来源的某些故障并调查原因
loading_duration（Float32）                              词典加载的持续时间
last_exception（String）                                     如果无法创建字典，则在创建或重新加载字典时发生的错误的文本
</code></pre> 
<h2><a id="8disks_417"></a>8.disks</h2> 
<p>查询定义的磁盘相关信息<br> 定义磁盘相关方式请点击：ClickHouse多卷存储策略</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> system<span class="token punctuation">.</span>disks<span class="token punctuation">;</span>

┌─name────┬─path─────────────────┬───free_space─┬──total_space─┬─keep_free_space─┐
│ <span class="token keyword">default</span> │ <span class="token operator">/</span>var<span class="token operator">/</span>lib<span class="token operator">/</span>clickhouse<span class="token operator">/</span> │ <span class="token number">264064196608</span> │ <span class="token number">424203980800</span> │               <span class="token number">0</span> │
└─────────┴──────────────────────┴──────────────┴──────────────┴─────────────────┘
</code></pre> 
<p>列：</p> 
<pre><code class="prism language-sql">name（String）                     服务器配置中的磁盘名称
path（String）                       文件系统中安装点的路径
free_space（UInt64）            磁盘上的可用空间（以字节为单位）
total_space（UInt64）           磁盘卷，以字节为单位
keep_free_space（UInt64）   应该在磁盘上保持可用空间的磁盘空间量（以字节为单位）。在keep_free_space_bytes磁盘配置参数中定义
</code></pre> 
<h2><a id="9distributed_ddl_queue_439"></a>9.distributed_ddl_queue</h2> 
<p>集群上执行的分布式ddl查询（ON CLUSTER子句）的信息。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> system<span class="token punctuation">.</span>distributed_ddl_queue <span class="token keyword">WHERE</span> cluster <span class="token operator">=</span> <span class="token string">'test_cluster'</span> <span class="token keyword">LIMIT</span> <span class="token number">1</span>\G

<span class="token keyword">Row</span> <span class="token number">1</span>:
──────
entry:             query<span class="token operator">-</span><span class="token number">0000000000</span>
host_name:         clickhouse01
host_address:      <span class="token number">172.23</span><span class="token number">.0</span><span class="token number">.11</span>
port:              <span class="token number">9000</span>
<span class="token keyword">status</span>:            Finished
cluster:           test_cluster
query:             <span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> test_db UUID <span class="token string">'4a82697e-c85e-4e5b-a01e-a36f2a758456'</span> <span class="token keyword">ON</span> CLUSTER test_cluster
initiator:         clickhouse01:<span class="token number">9000</span>
query_start_time:  <span class="token number">2020</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">30</span> <span class="token number">13</span>:<span class="token number">07</span>:<span class="token number">51</span>
query_finish_time: <span class="token number">2020</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">30</span> <span class="token number">13</span>:<span class="token number">07</span>:<span class="token number">51</span>
query_duration_ms: <span class="token number">6</span>
exception_code:    ZOK

<span class="token number">1</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span><span class="token punctuation">.</span> Elapsed: <span class="token number">0.025</span> sec<span class="token punctuation">.</span>
</code></pre> 
<p>列：</p> 
<pre><code class="prism language-sql">entry（String）                               查询ID
host_name（String）                        主机名
host_address（String）                   主机名解析为的IP地址
port（UInt16）                                主机端口
<span class="token keyword">status</span>（Enum8）                            查询状态
cluster（String）                            群集名称
query（String）                               执行查询
initiator（String）                         执行查询的节点
query_start_time（<span class="token keyword">DateTime</span>）       查询开始时间
query_finish_time（<span class="token keyword">DateTime</span>）     查询完成时间
query_duration_ms（UInt64）          查询执行的持续时间（以毫秒为单位）
exception_code（Enum8）               ZooKeeper的异常代码
</code></pre> 
<h2><a id="10contributors_480"></a>10.contributors</h2> 
<p>有关贡献者的信息。该顺序在查询执行时是随机的。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> system<span class="token punctuation">.</span>contributors <span class="token keyword">LIMIT</span> <span class="token number">10</span> <span class="token punctuation">;</span>

┌─name──────────────┐
│ Igor              │
│ Metehan Çetinkaya │
│ Veloman Yunkan    │
│ Ivan Blinkov      │
│ philip<span class="token punctuation">.</span>han        │
│ miha<span class="token operator">-</span>g            │
│ Bogdan Voronin    │
│ Vladimir Kozbin   │
│ pyos              │
│ cekc              │
└───────────────────┘

<span class="token number">10</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span><span class="token punctuation">.</span> Elapsed: <span class="token number">0.002</span> sec<span class="token punctuation">.</span> 
</code></pre> 
<pre><code class="prism language-sql">查查自己的贡献，你不试试吗？
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> system<span class="token punctuation">.</span>contributors <span class="token keyword">WHERE</span> name <span class="token operator">=</span> <span class="token string">'Ansel.zhang'</span> <span class="token punctuation">;</span>

┌─────name─────┐
│ Ansel<span class="token punctuation">.</span>zhang  │
└──────────────┘

<span class="token number">1</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span><span class="token punctuation">.</span> Elapsed: <span class="token number">0.004</span> sec<span class="token punctuation">.</span> 
</code></pre> 
<p>列：</p> 
<pre><code class="prism language-sql">name （字符串）                来自git log的贡献者（作者）名称。
</code></pre> 
<p>更多精彩内容欢迎扫码关注<br> <img src="https://images2.imgbox.com/3a/dc/XZpY1YZk_o.jpg" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/288339d7b38c78a4045589e6c0a30ba9/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">消息中间件-RabbitMQ消息可靠性和插件化机制</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8d136bf718b9d3c3c3168ae94ba644cf/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【IDEA】运行报错问题：Error running ‘Tomcat 9.0.13‘: Address localhost:8080 is already in use</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>