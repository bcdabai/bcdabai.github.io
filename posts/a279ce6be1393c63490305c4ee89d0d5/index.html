<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Excel表格的快速动态扩展与删除行 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Excel表格的快速动态扩展与删除行" />
<meta property="og:description" content="实例需求：工作表中的表格（ListObject）名称为Table1，表格列数不确定，需要实现如下功能：
当用户完成最后一行最后一列输入之后（如果该单元格为空，则视为输入未完成），表格自动扩展一行扩展行中，第一列填充自动序号，其他列填充NA如果用户双击表格中最后一行的任意单元格，那么删除该行，并相应调整表格单元格范围 效果如下所示。
示例代码如下。
Private Sub Worksheet_Change(ByVal Target As Range) Dim oTab As ListObject, oListRow As ListRow Const TAB_NAME As String = &#34;Table1&#34; If Target.CountLarge = 1 And Len(Target.Cells(1).Value) &gt; 0 Then Set oTab = Me.ListObjects(TAB_NAME) With oTab If Not Application.Intersect(.Range.Columns(.ListColumns.Count), Target) Is Nothing Then If Target.Offset(1).ListObject Is Nothing Then Set oListRow = .ListRows.Add Application.EnableEvents = False mRow.Range.Value = &#34;NA&#34; oListRow.Range(1) = .ListRows.Count Application.EnableEvents = True End If End If End With End If End Sub Private Sub Worksheet_BeforeDoubleClick(ByVal Target As Range, Cancel As Boolean) Dim oTab As ListObject Const TAB_NAME As String = &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/a279ce6be1393c63490305c4ee89d0d5/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-19T14:45:10+08:00" />
<meta property="article:modified_time" content="2024-01-19T14:45:10+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Excel表格的快速动态扩展与删除行</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>实例需求：工作表中的表格（ListObject）名称为<code>Table1</code>，表格列数不确定，需要实现如下功能：</p> 
<ul><li>当用户完成最后一行最后一列输入之后（如果该单元格为空，则视为输入未完成），表格自动扩展一行</li><li>扩展行中，第一列填充自动序号，其他列填充NA</li><li>如果用户双击表格中最后一行的任意单元格，那么删除该行，并相应调整表格单元格范围</li></ul> 
<p>效果如下所示。</p> 
<p><img src="https://images2.imgbox.com/2b/3c/W7bnMk5u_o.gif" alt="请添加图片描述"><br> 示例代码如下。</p> 
<pre><code class="prism language-vb">Private Sub Worksheet_Change(ByVal Target As Range)
    Dim oTab As ListObject, oListRow As ListRow
    Const TAB_NAME As String = "Table1"
    If Target.CountLarge = 1 And Len(Target.Cells(1).Value) &gt; 0 Then
        Set oTab = Me.ListObjects(TAB_NAME)
        With oTab
            If Not Application.Intersect(.Range.Columns(.ListColumns.Count), Target) Is Nothing Then
                If Target.Offset(1).ListObject Is Nothing Then
                    Set oListRow = .ListRows.Add
                    Application.EnableEvents = False
                    mRow.Range.Value = "NA"
                    oListRow.Range(1) = .ListRows.Count
                    Application.EnableEvents = True
                End If
            End If
        End With
    End If
End Sub
Private Sub Worksheet_BeforeDoubleClick(ByVal Target As Range, Cancel As Boolean)
    Dim oTab As ListObject
    Const TAB_NAME As String = "Table1"
    If Target.ListObject.Name = TAB_NAME Then
        Set oTab = Target.ListObject
        If Target.Offset(1).ListObject Is Nothing Then
            Application.EnableEvents = False
            oTab.ListRows(oTab.ListRows.Count).Delete
            Cancel = True
            Application.EnableEvents = True
        End If
    End If
End Sub
</code></pre> 
<p>【代码解析】<br> 第1~18行代码为工作表的Change事件，实现扩展表格新增行。<br> 第3行代码定义表格名称。<br> 第4行代码判断发生变化Range（参数Target）为单个单元格，并且单元格内容不为空。<br> 第5行代码获取表格对象。此处并未检查是否存在指定名称的ListObject，因此有可能产出运行时错误。<br> 第7行代码代码判断Target是否位于表格的最后一列，由于表格的总列数不确定，因此需要使用<code>.Range.Columns(.ListColumns.Count)</code>获取最后一列的对象，其中<code>.ListColumns.Count</code>为表格的列数。<br> 第8行代码判断Target之下相邻单元格是否在表格中，如果满足条件，说明Target位于表格的最后一行。这个也不是严谨逻辑判断，如果两个表格上下相邻，那么就会出现误判，如果需要严谨判断，那么需要进一步对比表格名称。<br> 第9行代码扩展表格，增加一行。<br> 第10行代码禁止系统事件激活。<br> 第11行代码将新增行中的单元格全部填充为NA。<br> 第12行代码更新第一列单元格内容为自动序号。<br> 第13第行代码恢复允许系统事件激活。</p> 
<p>第19~31行代码为工作表的BeforeDoubleClick事件，实现删除最后行。其中与Change事件相同的代码不再赘述。<br> 第22行代码判断Target位于指定名称的表格中。<br> 第26行代码删除表格的最后一行，同时表格范围将自动缩减。<br> 第27行代码取消双击操作。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/32ec03dc70d7f3c137f927ef7dd3a9cc/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">ARCGIS PRO SDK 图层定义查询</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/112a8d580b89b1a75db9c6f2a7ec563c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【数据结构与算法】排序算法：直接插入排序，希尔排序详解</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>