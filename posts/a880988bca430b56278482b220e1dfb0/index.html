<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>若依系统不分离版框架Mysql更换SqlServer - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="若依系统不分离版框架Mysql更换SqlServer" />
<meta property="og:description" content="前言：最近下载开源项目若依ruoyi，将其更数据库Mysql更换SqlServer的一些注意事项，与君分享。
1、数据库安装
使用SSMA将mysql迁移至mssql,参考这两个文档
MySQL数据库迁移到SQL Server----------SSMA(SQL Server Migration Assistant for MySQL)工具安装及使用_weixin_39921737的博客-CSDN博客_ssma安装
ssma for mysql_SSMA for MySQL_weixin_39926193的博客-CSDN博客
若依的数据库脚本是mysql，先用navcate创建一个名为dbo的数据库。（名称最好是dbo，如果数据库名为 ruoyi，迁移到mssql后表名称为 ruoyi.sys_dept）
运行这两个脚本，创建表
参考上述文档，将在mysql中建好的表，迁移到sql server2016中
2、参考文章，修改后台代码
ruoyi（若依）系统使用SqlServer数据库_op4439的博客-CSDN博客_若依数据库
一、ruoyi-admin 中pom.xml 添加mssql驱动
&lt;!--mssql驱动包--&gt; &lt;dependency&gt; &lt;groupId&gt;com.microsoft.sqlserver&lt;/groupId&gt; &lt;artifactId&gt;mssql-jdbc&lt;/artifactId&gt; &lt;/dependency&gt; 二、数据库配置文件修改
spring: datasource: type: com.alibaba.druid.pool.DruidDataSource driverClassName: com.microsoft.sqlserver.jdbc.SQLServerDriver druid: # 主库数据源 master: url: jdbc:sqlserver://localhost:1433;DatabaseName=ry username: sa password: 你的密码 1、配置检测连接是否有效如下：
2、分页插件配置如下：
三、代码部分修改
1、定时任务配置ScheduleConfig类设置sqlserver 启用配置，这个原文件注释了，暂不修改。
2、SQL语句函数修改，用IDEA功能 Find in files 全局检索修改。
ifnull() 改 isnull()find_in_set 修改，下面两处，在SysDeptMapper &lt;select id=&#34;selectChildrenDeptById&#34; parameterType=&#34;Long&#34; resultMap=&#34;SysDeptResult&#34;&gt; select * from sys_dept where charindex (&#39;,&#39; &#43; CONVERT (VARCHAR, #{deptId}), &#39;,&#39; &#43; ancestors) &gt; 0 &lt;/select&gt; &lt;select id=&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/a880988bca430b56278482b220e1dfb0/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-07-30T08:35:05+08:00" />
<meta property="article:modified_time" content="2022-07-30T08:35:05+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">若依系统不分离版框架Mysql更换SqlServer</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>前言：最近下载开源项目若依ruoyi，将其更数据库Mysql更换SqlServer的一些注意事项，与君分享。</p> 
<p>1、数据库安装</p> 
<p>使用SSMA将mysql迁移至mssql,参考这两个文档</p> 
<p><a class="link-info" href="https://blog.csdn.net/weixin_39921737/article/details/82896376" title="MySQL数据库迁移到SQL Server----------SSMA(SQL Server Migration Assistant for MySQL)工具安装及使用_weixin_39921737的博客-CSDN博客_ssma安装">MySQL数据库迁移到SQL Server----------SSMA(SQL Server Migration Assistant for MySQL)工具安装及使用_weixin_39921737的博客-CSDN博客_ssma安装</a></p> 
<p><a class="link-info" href="https://blog.csdn.net/weixin_39926193/article/details/113206824" title="ssma for mysql_SSMA for MySQL_weixin_39926193的博客-CSDN博客">ssma for mysql_SSMA for MySQL_weixin_39926193的博客-CSDN博客</a></p> 
<p>若依的数据库脚本是mysql，先用navcate创建一个名为dbo的数据库。（名称最好是dbo，如果数据库名为 ruoyi，迁移到mssql后表名称为 ruoyi.sys_dept）<br><img alt="" height="520" src="https://images2.imgbox.com/77/a3/06vHNIqD_o.png" width="1085"></p> 
<p> 运行这两个脚本，创建表</p> 
<p>参考上述文档，将在mysql中建好的表，迁移到sql server2016中</p> 
<p><img alt="" height="767" src="https://images2.imgbox.com/17/0e/n3rEJSDe_o.png" width="394"></p> 
<p>2、参考文章，修改后台代码</p> 
<p><a href="https://blog.csdn.net/op4439/article/details/121469911?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=%E8%8B%A5%E4%BE%9D%20%E8%BD%ACmsql&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-1-121469911.142%5Ev33%5Eexperiment_2_v1,185%5Ev2%5Etag_show&amp;spm=1018.2226.3001.4187" title="ruoyi（若依）系统使用SqlServer数据库_op4439的博客-CSDN博客_若依数据库">ruoyi（若依）系统使用SqlServer数据库_op4439的博客-CSDN博客_若依数据库</a></p> 
<p> 一、ruoyi-admin 中pom.xml 添加mssql驱动</p> 
<pre><code>        &lt;!--mssql驱动包--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.microsoft.sqlserver&lt;/groupId&gt;
            &lt;artifactId&gt;mssql-jdbc&lt;/artifactId&gt;
        &lt;/dependency&gt;</code></pre> 
<p> 二、数据库配置文件修改</p> 
<pre><code>spring:
    datasource:
        type: com.alibaba.druid.pool.DruidDataSource
        driverClassName: com.microsoft.sqlserver.jdbc.SQLServerDriver
        druid:
            # 主库数据源
            master:
               url: jdbc:sqlserver://localhost:1433;DatabaseName=ry
               username: sa
               password: 你的密码</code></pre> 
<p><img alt="" height="371" src="https://images2.imgbox.com/58/79/3fKYXfOF_o.png" width="925"></p> 
<p>  1、配置检测连接是否有效如下：<img alt="" height="157" src="https://images2.imgbox.com/51/22/5dQosZlM_o.png" width="738"></p> 
<p>2、分页插件配置如下：</p> 
<p><img alt="" height="210" src="https://images2.imgbox.com/b3/d3/jDpUwM3P_o.png" width="702"></p> 
<p>三、代码部分修改</p> 
<p>1、定时任务配置ScheduleConfig类设置sqlserver 启用配置，这个原文件注释了，暂不修改。</p> 
<p>2、SQL语句函数修改，用IDEA功能 Find in files 全局检索修改。</p> 
<ul><li>ifnull()  改 isnull()</li><li>find_in_set 修改，下面两处，在SysDeptMapper <pre><code>&lt;select id="selectChildrenDeptById" parameterType="Long" resultMap="SysDeptResult"&gt;
		select * from sys_dept where charindex (',' + CONVERT (VARCHAR, #{deptId}), ',' + ancestors) &gt; 0
	&lt;/select&gt;
	
&lt;select id="selectNormalChildrenDeptById" parameterType="Long" resultType="int"&gt;
		select count(*) from sys_dept where status = 0 and del_flag = '0' and charindex (',' + CONVERT (VARCHAR, #{deptId}), ',' + ancestors) &gt; 0
	&lt;/select&gt;</code></pre> </li><li> <p>concat 替换为 ''+''， server2016 支持这个函数，不需要修改</p> </li><li> <p>sysdate 替换为 getdate,  这个比较多，用替换Replace</p> </li><li> <p>date_format 日期范围检索的，改用datediff，用多处，慢慢改，如下（&lt;= 符号 用 &amp;lt;=  替换）</p> <pre><code>&lt;if test="params.beginTime != null and params.beginTime != ''"&gt;
    &lt;!-- 开始时间检索 --&gt;
	and datediff(day,login_time，#{params.beginTime}) &amp;lt;= 0
&lt;/if&gt;
&lt;if test="params.endTime != null and params.endTime != ''"&gt;
    &lt;!-- 结束时间检索 --&gt;
	and datediff(day,login_time,#{params.endTime}) &gt;= 0
&lt;/if&gt;</code></pre> </li><li> <p>limit 1 替换成 top 1 ，位置需要修改（这种好像只有一处，在sysConfigMapper.xml中）</p> <pre><code>&lt;select id="checkConfigKeyUnique" parameterType="String" resultMap="SysConfigResult"&gt;
        select top 1 config_id, config_name, config_key, config_value, config_type, create_by, create_time, update_by, update_time, remark
        from sys_config
        where config_key = #{configKey}
&lt;/select&gt;</code></pre> <p></p> </li><li> <p>select count(1)...limit 1 ，直接删除limit 1 就可以</p> </li></ul> 
<p>3、生成代码部分的sql修改  </p> 
<p><img alt="" height="455" src="https://images2.imgbox.com/78/4d/J4ZsExGD_o.png" width="1200"></p> 
<ul><li>修改 selectDbTableList,selectDbTableListByNames  </li></ul> 
<pre><code>&lt;select id="selectDbTableList" parameterType="GenTable" resultMap="GenTableResult"&gt;
		SELECT so.name table_name,sep.value table_comment,so.create_date create_time,so.modify_date update_time
		FROM sys.objects AS so
		LEFT JOIN sys.extended_properties AS sep ON so.object_id = sep.major_id
		WHERE so.type = 'U'
			AND sep.minor_id = 0
			AND so.name NOT LIKE 'qrtz_%' AND so.name NOT LIKE 'gen_%'
			AND so.name NOT IN (select table_name from gen_table)
		&lt;if test="tableName != null and tableName != ''"&gt;
			AND lower(so.name) like lower(concat('%', #{tableName}, '%'))
		&lt;/if&gt;
		&lt;if test="tableComment != null and tableComment != ''"&gt;
			AND lower(cast(sep.value as varchar)) like lower(concat('%', #{tableComment}, '%'))
		&lt;/if&gt;
		&lt;if test="params.beginTime != null and params.beginTime != ''"&gt;&lt;!-- 开始时间检索 --&gt;
			AND datediff(day,#{params.beginTime},create_time) &gt;=0
		&lt;/if&gt;
		&lt;if test="params.endTime != null and params.endTime != ''"&gt;&lt;!-- 结束时间检索 --&gt;
			AND datediff(day,create_time,#{params.endTime}) &gt;=0
		&lt;/if&gt;
        order by create_time desc
	&lt;/select&gt;
 
 
	&lt;select id="selectDbTableListByNames" resultMap="GenTableResult"&gt;
		SELECT SO.name table_name,SEP.VALUE table_comment,SO.create_date create_time,SO.modify_date update_time
		FROM sys.objects AS SO
		LEFT JOIN sys.extended_properties AS SEP ON SO.object_id = SEP.major_id
		WHERE SO.type = 'U'
			AND SEP.minor_id = 0
			AND SO.name NOT LIKE 'qrtz_%' and SO.name NOT LIKE 'gen_%'
			AND SO.name in
		&lt;foreach collection="array" item="name" open="(" separator="," close=")"&gt;
			#{name}
		&lt;/foreach&gt;
&lt;/select&gt;</code></pre> 
<ul><li>selectDbTableColumnsByName , 在GenTableColumnMapper.xml文件中 <pre><code>&lt;select id="selectDbTableColumnsByName" parameterType="String" resultMap="GenTableColumnResult"&gt;
        SELECT a.name AS column_name,
               (CASE WHEN a.isnullable = 1 THEN 0 ELSE 1 END)  AS is_required,
               (CASE WHEN ( SELECT COUNT(*) FROM sysobjects WHERE ( name IN ( SELECT name FROM sysindexes WHERE (id = a.id) AND (indid IN (SELECT indid FROM sysindexkeys WHERE (id = a.id)
                                                  AND (colid IN (SELECT colid FROM syscolumns WHERE (id = a.id) AND (name = a.name))))))) AND (xtype = 'PK')) &gt; 0 THEN 1 ELSE 0 END)  AS is_pk,
               a.colorder  AS sort,
               isnull(g.[value], ' ') AS column_comment,
               (CASE WHEN COLUMNPROPERTY(a.id, a.name, 'IsIdentity') = 1 THEN 1 ELSE 0 END ) AS is_increment,
               b.name  AS column_type
        FROM syscolumns a
                 LEFT JOIN systypes b ON a.xtype = b.xusertype
                 INNER JOIN sysobjects d ON a.id = d.id
            AND d.xtype = 'U'
            AND d.name  &lt;![CDATA[ &lt;&gt; ]]&gt; 'dtproperties'
                 LEFT JOIN syscomments e ON a.cdefault = e.id
                 LEFT JOIN sys.extended_properties g ON a.id = g.major_id
            AND a.colid = g.minor_id
                 LEFT JOIN sys.extended_properties f ON d.id = f.class
            AND f.minor_id = 0
                 LEFT JOIN sys.objects h ON a.id = h.object_id
                 LEFT JOIN sys.schemas i ON h.schema_id = i.schema_id
        WHERE d.name = #{tableName}
        ORDER BY a.colorder
&lt;/select&gt;</code></pre> <p>4、代码生成器中修改sql.vm</p> <pre><code>-- 按钮父菜单ID
Declare @parentId int
SELECT @parentId = @@IDENTITY</code></pre> <p></p> </li></ul> 
<p> </p> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ab475d0bfbca50977afdcb0279ec0439/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">一些关于三角函数的公式</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4c864d7bd62706197d8edad7373afaac/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">YOLOv5学习过程中的问题</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>