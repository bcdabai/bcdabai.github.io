<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Spring中自定义权限注解 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Spring中自定义权限注解" />
<meta property="og:description" content="Spring中自定义权限注解 实现功能:
​ 在方法上加上注解@PreAuth(“xxx”), 根据xxx不同内容,可以判断当前请求是否有访问该接口的权限,如果有则放行,反之则返回无权限.
​ 其中@PreAuth(“xxx”)中 “xxx” 可以填写角色或者资源等来校验(xxx是个表达式,解析后,然后调用不同的方法去执行返回布尔值)
1. 自定义注解 import java.lang.annotation.*; /** * 权限注解 用于检查权限 规定访问权限 * * @author Chill * @example @PreAuth(&#34;#userVO.id&lt;10&#34;) * @example @PreAuth(&#34;hasRole(#test, #test1)&#34;) * @example @PreAuth(&#34;hasPermission(#test) and @PreAuth.hasPermission(#test)&#34;) */ @Target({ElementType.METHOD, ElementType.TYPE}) @Retention(RetentionPolicy.RUNTIME) @Inherited @Documented public @interface PreAuth { String value(); } 2. 编写处理@PreAuth(“xxx”)中处理&#34;xxx&#34;的方法 /** * 权限判断 * * @author Chill */ public class AuthFun { /** * 权限校验处理器 */ private static IPermissionHandler permissionHandler; private static IPermissionHandler getPermissionHandler() { if (permissionHandler == null) { permissionHandler = SpringUtil." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/51f5860837e30570c2ed7c9e2dc611a5/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-12-03T20:37:11+08:00" />
<meta property="article:modified_time" content="2020-12-03T20:37:11+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Spring中自定义权限注解</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-dracula">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="Spring_0"></a>Spring中自定义权限注解</h2> 
<blockquote> 
 <p>实现功能:</p> 
 <p>​ 在方法上加上注解@PreAuth(“xxx”), 根据xxx不同内容,可以判断当前请求是否有访问该接口的权限,如果有则放行,反之则返回无权限.</p> 
 <p>​ 其中@PreAuth(“xxx”)中 “xxx” 可以填写角色或者资源等来校验(xxx是个表达式,解析后,然后调用不同的方法去执行返回布尔值)</p> 
</blockquote> 
<h4><a id="1__8"></a>1. 自定义注解</h4> 
<pre><code class="prism language-java"><span class="token keyword">import</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token comment">/**
 * 权限注解 用于检查权限 规定访问权限
 *
 * @author Chill
 * @example @PreAuth("#userVO.id&lt;10")
 * @example @PreAuth("hasRole(#test, #test1)")
 * @example @PreAuth("hasPermission(#test) and @PreAuth.hasPermission(#test)")
 */</span>
<span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>ElementType<span class="token punctuation">.</span>METHOD<span class="token punctuation">,</span> ElementType<span class="token punctuation">.</span>TYPE<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span>RetentionPolicy<span class="token punctuation">.</span>RUNTIME<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Inherited</span>
<span class="token annotation punctuation">@Documented</span>
<span class="token keyword">public</span> @<span class="token keyword">interface</span> <span class="token class-name">PreAuth</span> <span class="token punctuation">{<!-- --></span>
	String <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="2_PreAuthxxxxxx_30"></a>2. 编写处理@PreAuth(“xxx”)中处理"xxx"的方法</h4> 
<pre><code class="prism language-java"><span class="token comment">/**
 * 权限判断
 *
 * @author Chill
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AuthFun</span> <span class="token punctuation">{<!-- --></span>

	<span class="token comment">/**
	 * 权限校验处理器
	 */</span>
	<span class="token keyword">private</span> <span class="token keyword">static</span> IPermissionHandler permissionHandler<span class="token punctuation">;</span>

	<span class="token keyword">private</span> <span class="token keyword">static</span> IPermissionHandler <span class="token function">getPermissionHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>permissionHandler <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			permissionHandler <span class="token operator">=</span> SpringUtil<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span>IPermissionHandler<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> permissionHandler<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 * 判断角色是否具有接口权限
	 * 判断登陆用户是否拥有这个接口的权限
	 * @return {boolean}
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">permissionAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token function">getPermissionHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permissionAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 * 判断角色是否具有接口权限
	 *
	 * @param permission 权限编号
	 * @return {boolean}
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">hasPermission</span><span class="token punctuation">(</span>String permission<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token function">getPermissionHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasPermission</span><span class="token punctuation">(</span>permission<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 * 放行所有请求
	 *
	 * @return {boolean}
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 * 只有超管角色才可访问
	 *
	 * @return {boolean}
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">denyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token function">hasRole</span><span class="token punctuation">(</span>RoleConstant<span class="token punctuation">.</span>ADMIN<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 * 是否已授权
	 *
	 * @return {boolean}
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">hasAuth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> Func<span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>AuthUtil<span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 * 是否有时间授权
	 *
	 * @param start 开始时间
	 * @param end   结束时间
	 * @return {boolean}
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">hasTimeAuth</span><span class="token punctuation">(</span>Integer start<span class="token punctuation">,</span> Integer end<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		Integer hour <span class="token operator">=</span> DateUtil<span class="token punctuation">.</span><span class="token function">hour</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> hour <span class="token operator">&gt;=</span> start <span class="token operator">&amp;&amp;</span> hour <span class="token operator">&lt;=</span> end<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 * 判断是否有该角色权限
	 *
	 * @param role 单角色
	 * @return {boolean}
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">hasRole</span><span class="token punctuation">(</span>String role<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token function">hasAnyRole</span><span class="token punctuation">(</span>role<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 * 判断是否具有所有角色权限
	 *
	 * @param role 角色集合
	 * @return {boolean}
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">hasAllRole</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> role<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span>String r <span class="token operator">:</span> role<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">hasRole</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 * 判断是否有该角色权限
	 *
	 * @param role 角色集合
	 * @return {boolean}
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">hasAnyRole</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> role<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		BladeUser user <span class="token operator">=</span> AuthUtil<span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		String userRole <span class="token operator">=</span> user<span class="token punctuation">.</span><span class="token function">getRoleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>StringUtil<span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>userRole<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		String<span class="token punctuation">[</span><span class="token punctuation">]</span> roles <span class="token operator">=</span> Func<span class="token punctuation">.</span><span class="token function">toStrArray</span><span class="token punctuation">(</span>userRole<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span>String r <span class="token operator">:</span> role<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>CollectionUtil<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>roles<span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="3__168"></a>3. 自定义注解</h4> 
<blockquote> 
 <p>配置切面 继承Spring ApplicationContextAware</p> 
</blockquote> 
<pre><code class="prism language-java"><span class="token comment">/**
 * AOP 鉴权
 *解析自定义的注解@PreAuth
 * @author Chill
 */</span>
<span class="token annotation punctuation">@Aspect</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AuthAspect</span> <span class="token keyword">implements</span> <span class="token class-name">ApplicationContextAware</span> <span class="token punctuation">{<!-- --></span>

	<span class="token comment">/**
	 * 表达式处理
	 */</span>
	<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> ExpressionParser EXPRESSION_PARSER <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpelExpressionParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">/**
	 * 切 方法 和 类上的 @PreAuth 注解
	 *扫描方法上的 	@annotation
	 *扫描类上		@within
	 * @param point 切点
	 * @return Object
	 * @throws Throwable 没有权限的异常
	 */</span>
	<span class="token annotation punctuation">@Around</span><span class="token punctuation">(</span>
		<span class="token string">"@annotation(org.springblade.core.secure.annotation.PreAuth) || "</span> <span class="token operator">+</span>
			<span class="token string">"@within(org.springblade.core.secure.annotation.PreAuth)"</span>
	<span class="token punctuation">)</span>
	<span class="token keyword">public</span> Object <span class="token function">preAuth</span><span class="token punctuation">(</span>ProceedingJoinPoint point<span class="token punctuation">)</span> <span class="token keyword">throws</span> Throwable <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">handleAuth</span><span class="token punctuation">(</span>point<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> point<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">SecureException</span><span class="token punctuation">(</span>ResultCode<span class="token punctuation">.</span>UN_AUTHORIZED<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 * 处理权限
	 *
	 * @param point 切点
	 */</span>
	<span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">handleAuth</span><span class="token punctuation">(</span>ProceedingJoinPoint point<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		MethodSignature ms <span class="token operator">=</span> <span class="token punctuation">(</span>MethodSignature<span class="token punctuation">)</span> point<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		Method method <span class="token operator">=</span> ms<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 读取权限注解，优先方法上，没有则读取类</span>
		PreAuth preAuth <span class="token operator">=</span> ClassUtil<span class="token punctuation">.</span><span class="token function">getAnnotation</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> PreAuth<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 判断表达式</span>
		String condition <span class="token operator">=</span> preAuth<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>StringUtil<span class="token punctuation">.</span><span class="token function">isNotBlank</span><span class="token punctuation">(</span>condition<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			Expression expression <span class="token operator">=</span> EXPRESSION_PARSER<span class="token punctuation">.</span><span class="token function">parseExpression</span><span class="token punctuation">(</span>condition<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 方法参数值</span>
			Object<span class="token punctuation">[</span><span class="token punctuation">]</span> args <span class="token operator">=</span> point<span class="token punctuation">.</span><span class="token function">getArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			StandardEvaluationContext context <span class="token operator">=</span> <span class="token function">getEvaluationContext</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> expression<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> Boolean<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 * 获取方法上的参数
	 *
	 * @param method 方法
	 * @param args   变量
	 * @return {SimpleEvaluationContext}
	 */</span>
	<span class="token keyword">private</span> StandardEvaluationContext <span class="token function">getEvaluationContext</span><span class="token punctuation">(</span>Method method<span class="token punctuation">,</span> Object<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token comment">// 初始化Sp el表达式上下文，并设置 AuthFun</span>
		StandardEvaluationContext context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StandardEvaluationContext</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AuthFun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 设置表达式支持spring bean</span>
		context<span class="token punctuation">.</span><span class="token function">setBeanResolver</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BeanFactoryResolver</span><span class="token punctuation">(</span>applicationContext<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> args<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">// 读取方法参数</span>
			MethodParameter methodParam <span class="token operator">=</span> ClassUtil<span class="token punctuation">.</span><span class="token function">getMethodParameter</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 设置方法 参数名和值 为sp el变量</span>
			context<span class="token punctuation">.</span><span class="token function">setVariable</span><span class="token punctuation">(</span>methodParam<span class="token punctuation">.</span><span class="token function">getParameterName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> args<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> context<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">private</span> ApplicationContext applicationContext<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setApplicationContext</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> ApplicationContext applicationContext<span class="token punctuation">)</span> <span class="token keyword">throws</span> BeansException <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>applicationContext <span class="token operator">=</span> applicationContext<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>	
</code></pre> 
<h4><a id="4__258"></a>4. 使用示例</h4> 
<blockquote> 
 <p>只有拥有administrator角色或者admin角色的人才能访问该接口</p> 
 <p>"hasAnyRole(‘administrator’, ‘admin’)"解析后会调用AuthFun.hasAnyRole(String … role)方法来解析该注解</p> 
 <p>可以自定义AuthFun中的方法来来拓展注解的功能</p> 
</blockquote> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/list"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@PreAuth</span><span class="token punctuation">(</span><span class="token string">"hasAnyRole('administrator', 'admin')"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> R<span class="token operator">&lt;</span>List<span class="token generics function"><span class="token punctuation">&lt;</span>MenuVO<span class="token punctuation">&gt;</span></span><span class="token operator">&gt;</span> <span class="token function">list</span><span class="token punctuation">(</span><span class="token annotation punctuation">@ApiIgnore</span> <span class="token annotation punctuation">@RequestParam</span> Map<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token punctuation">&gt;</span></span> menu<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    List<span class="token generics function"><span class="token punctuation">&lt;</span>Menu<span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> menuService<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span>Condition<span class="token punctuation">.</span><span class="token function">getQueryWrapper</span><span class="token punctuation">(</span>menu<span class="token punctuation">,</span> Menu<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lambda</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orderByAsc</span><span class="token punctuation">(</span>Menu<span class="token operator">:</span><span class="token operator">:</span>getSort<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> R<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>MenuWrapper<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listNodeVO</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p>在类上使用</p> 
 <p>只有拥有administrator角色或者admin角色的人才能访问该Controller的接口</p> 
</blockquote> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@PreAuth</span><span class="token punctuation">(</span>RoleConstant<span class="token punctuation">.</span>HAS_ROLE_ADMIN<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AuthClientController</span> <span class="token keyword">extends</span> <span class="token class-name">BladeController</span> <span class="token punctuation">{<!-- --></span>
<span class="token punctuation">}</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/cef9de5d0b1055cd94e462ba77e88648/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">python最基本的规则是注释_python 3 基础之注释、变量、标识符命名规则、关键字...</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/bc3cb985e842608361d9bfd1ef31500f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">如何检验方差齐性？</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>