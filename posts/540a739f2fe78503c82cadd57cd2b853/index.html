<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>jq ajax 比 直接 地址访问慢的研究 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="jq ajax 比 直接 地址访问慢的研究" />
<meta property="og:description" content="如图：
使用jquery.ajax 与直接浏览器 访问同一个接口，大概有3倍左右的差距
下面直接引用原生代码：
发现时间差不多，那么问题了，这多余的时间干嘛去了？？
数据格式的组成？
接下来点开看下区别
jq请求
浏览器请求
你是日了狗了， DNS Lookup dns调优？？？？？？？
那是不是接着重复在浏览器异步里发送该请求是不是更快
果然如此，害我还以为是jQuery 封装 的xmlhttp 有问题，搞了这么久，分享下代码吧
&lt;script&gt; // 格式化请求参数 function formatParams(data) { let arr = []; for (let name in data) { arr.push(encodeURIComponent(name) &#43; &#39;=&#39; &#43; encodeURIComponent(data[name])); } arr.push((&#39;v=&#39; &#43; Math.random()).replace(&#39;.&#39;, &#39;&#39;)); return arr.join(&#39;&amp;&#39;); } function ajax_xml2(options) { options = options || {} // 调用函数时如果options没有指定，就给它赋值{},一个空的Object options.method = (options.method || &#39;GET&#39;).toUpperCase() // 请求格式GET、POST，默认为GET options.dataType = options.dataType || &#39;json&#39; // 响应数据格式，默认json options." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/540a739f2fe78503c82cadd57cd2b853/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-06-25T14:51:46+08:00" />
<meta property="article:modified_time" content="2022-06-25T14:51:46+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">jq ajax 比 直接 地址访问慢的研究</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>如图：</p> 
<p>使用jquery.ajax 与直接浏览器 访问同一个接口，大概有3倍左右的差距</p> 
<p><img alt="" height="612" src="https://images2.imgbox.com/8e/2a/RO541GxJ_o.png" width="834"></p> 
<p><img alt="" height="101" src="https://images2.imgbox.com/b2/ca/LBrag12M_o.png" width="661"></p> 
<p> 下面直接引用原生代码：</p> 
<p>发现时间差不多，那么问题了，这多余的时间干嘛去了？？</p> 
<p><span style="color:#fe2c24;">数据格式的组成？</span></p> 
<p></p> 
<p> </p> 
<p><img alt="" height="353" src="https://images2.imgbox.com/5e/be/kQursihb_o.png" width="808"></p> 
<p></p> 
<p>接下来点开看下区别</p> 
<p>jq请求</p> 
<p><img alt="" height="490" src="https://images2.imgbox.com/be/dd/J2lYEjj8_o.png" width="790"></p> 
<p> 浏览器请求</p> 
<p><img alt="" height="555" src="https://images2.imgbox.com/64/81/96dItNOS_o.png" width="822"></p> 
<h4> 你是日了狗了， <span style="color:#fe2c24;"><strong>DNS Lookup</strong></span></h4> 
<p>dns调优？？？？？？？</p> 
<p>那是不是接着重复在浏览器异步里发送该请求是不是更快</p> 
<p><img alt="" height="407" src="https://images2.imgbox.com/88/ea/oafQG7No_o.png" width="777"></p> 
<p> </p> 
<p>果然如此，害我还以为是jQuery 封装 的xmlhttp 有问题，搞了这么久，分享下代码吧</p> 
<p></p> 
<pre><code class="language-javascript"> &lt;script&gt;
    // 格式化请求参数
    function formatParams(data) {
      let arr = [];
      for (let name in data) {
        arr.push(encodeURIComponent(name) + '=' + encodeURIComponent(data[name]));
      }
      arr.push(('v=' + Math.random()).replace('.', ''));
      return arr.join('&amp;');
    }
    
    function ajax_xml2(options) {
      options = options || {} // 调用函数时如果options没有指定，就给它赋值{},一个空的Object
      options.method = (options.method || 'GET').toUpperCase() // 请求格式GET、POST，默认为GET
      options.dataType = options.dataType || 'json' // 响应数据格式，默认json
      options.timeout = options.timeout || 30000
      let params = formatParams(options.data) // options.data请求的数据
      let xhr
      // 考虑兼容性
      if (window.XMLHttpRequest) {
        xhr = new XMLHttpRequest()
      } else if (window.ActiveObject) {
        // 兼容IE6以下版本
        xhr = new ActiveXobject('Microsoft.XMLHTTP')
      }

      // 启动并发送一个请求
      if (options.method == 'GET') {
        xhr.open('get', options.url + '?' + params, true)
        xhr.send(null)
      } else if (options.method == 'POST') {
        xhr.open('post', options.url, true)
        // 设置表单提交时的内容类型
        // Content-type数据请求的格式
        xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded')
        xhr.send(params)
      }

      // 设置有效时间
      setTimeout(function () {
        if (xhr.readySate != 4) {
          xhr.abort()
        }
      }, options.timeout)
      /*
        接收
        options.success成功之后的回调函数  options.error失败后的回调函数
        xhr.responseText,xhr.responseXML  获得字符串形式的响应数据或者XML形式的响应数据
      */
      xhr.onreadystatechange = function () {
        if (xhr.readyState == 4) {
          let status = xhr.status
          if ((status &gt;= 200 &amp;&amp; status &lt; 300) || status == 304) {
            options.success &amp;&amp; options.success(xhr.responseText, xhr.responseXML)
          } else {
            options.error &amp;&amp; options.error(status)
          }
        }
      }
    }

       ajax_xml2({
            type: "post",
            async: true,//异步方式
            data: {cate_id: cate_id, card_id : id, cash_id: cash_id},
            dataType: "json",
            url: '/mobile/view/homev1/open_card_init_json.php',
            success: function(rs) {
                rs=eval('('+rs+')');
                if (rs.code == 200) {
                    category = rs.data;
                    loadCards();
                    if (loadIndex) {
                        $.msg.close(loadIndex);
                    }
                }
                $.msg.close(loadIndex);
            }
        });    
&lt;/script&gt;</code></pre> 
<p></p> 
<pre><code class="language-javascript">
 /**
     * 
     */
    function ajax_xml(url,data,header,type,asynch){
        var xmlhttp;
        if(isEmpty(header)){
            header='application/x-www-form-urlencoded';//GET、POST、DELETE、OPTIONS、HEAD、PUT、TRACE、CONNECT
        }
        if(isEmpty(asynch)){
            asynch=true;
        }
        if(isEmpty(type)){
            type='post';//GET、POST、DELETE、OPTIONS、HEAD、PUT、TRACE、CONNECT
        }
        if(isEmpty(url)){
            return '来源地址要输入一下啊';
        }
        if (window.XMLhttpRequest){
	// code for ie7+,firefox,Chrome,Opera,Safari
                xmlhttp=new XMLhttpRequest();
        }else{
                // code for ie6,IE5
                xmlhttp=new ActiveXObject("Microsoft.XMLhttp");
        }
        xmlhttp.onreadystatechange=function(){
            /**
             * readyState
             * 0	AJAX开始初始化
1	开始发送AJAX请求
2	AJAX请求发送完成
3	开始解析响应的资源
4	AJAX请求的步骤全部完成
        status          200与304就代表成功获取资源，例如404这些就是请求失败。详细见HTTP状态码
             */
            if (xmlhttp.readyState==4 &amp;&amp; xmlhttp.status==200){
                return xmlhttp.responseText;
            }else{
                alter('ajax请求错误');
            }
        }
        xmlhttp.open(type,url,true);
        /*
        发送post请求时此句万万不能少
        在Form元素的语法中，EncType表明提交数据的格式
        用 Enctype 属性指定将数据回发到服务器时浏览器使用的编码类型。
        application/x-www-form-urlencoded：窗体数据被编码为名称/值对。这是标准的编码格式。
        multipart/form-data：窗体数据被编码为一条消息，页上的每个控件对应消息中的一个部分。
        text/plain：窗体数据以纯文本形式进行编码，其中不含任何控件或格式字符
        */
        xmlhttp.setRequestheader("Content-type",header);
        xmlhttp.send(data);
    }
    
    function isEmpty(obj) {
        if (typeof obj == "undefined" || obj == null || obj == "") {
            return true;
        } else {
            return false;
        }

    }</code></pre> 
<p>这里可能需要一个结束语。。</p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c853de84b12cf92e47c0fe06d4eb8dd7/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">《软件体系结构》期末复习总结</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b9c4d5d3b1d1dc6cc51f09798ccbf7e6/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">用Python制作温度换算模块</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>