<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>web架构师编辑器内容-图层拖动排序功能的开发 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="web架构师编辑器内容-图层拖动排序功能的开发" />
<meta property="og:description" content="新的学习方法 用手写简单方法实现一个功能然后用比较成熟的第三方解决方案即能学习原理又能学习第三方库的使用 从两个DEMO开始 Vue Draggable Next: Vue Draggable NextReact Sortable HOC: React Sortable HOC 列表排序的三个阶段 拖动开始（dragstart） 被拖动图层的状态变化会出一个浮层 拖动进行中(dragmove) 浮层会随着鼠标移动条目发生换位：当浮层下沿超过被拖条目二分之一的时候，触发换位。这是一个比较独特的需求 松开鼠标阶段（drop） 浮层消失被拖动图层状态复原数据被更新
拖动排序功能开发 第一阶段 Dragstart
被拖动图层的状态变化 常规做法 添加mouseDown事件，检查当前的target是那个元素，然后给他添加特定的状态添加mouseMove事件，创一个和被拖动元素一模一样的的浮层，将它的定位设置
它的定位为绝对定位，并且随着鼠标的坐标更新。 使用HTML的Drag特性 文档地址：拖拽操作浏览器的默认拖拽行为：支持图象，链接和选择的文本其他元素默认情况是不可拖拽的。如果想可以拖拽可以设置为draggable = true使用dragstart事件监控拖动开始，并设置对应的属性 LayerList组件中添加draggable属性
// LayerList.vue &lt;li class=&#34;ant-list-item&#34; v-for=&#34;item in list&#34; :key=&#34;item.id&#34; :class=&#34;{ active: item.id === selectedId }&#34; @click=&#34;handleClick(item.id)&#34; draggable=&#34;true&#34; &gt;&lt;/li&gt; 这样就可以有效果了：当拖动对应条目的时候，它会自动生成半透明的条目，并且跟随鼠标的移动。
接下来就开始使用dragstart事件监控拖动开始，并设置对应的属性
给被拖动元素添加特定的状态：使用一系列的事件来监控拖动的进度，使用dragStart开始拖动操作 // LayerList.vue // html部分 &lt;li class=&#34;ant-list-item&#34; v-for=&#34;item in list&#34; :key=&#34;item.id&#34; :class=&#34;{ active: item.id === selectedId, ghost: dragData." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/34fc25c8c51257ae7bb0d2cc9ff33bc9/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-21T17:55:18+08:00" />
<meta property="article:modified_time" content="2024-01-21T17:55:18+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">web架构师编辑器内容-图层拖动排序功能的开发</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h5><a id="_0"></a>新的学习方法</h5> 
<ul><li>用手写简单方法实现一个功能</li><li>然后用比较成熟的第三方解决方案</li><li>即能学习原理又能学习第三方库的使用</li></ul> 
<h4><a id="DEMO_6"></a>从两个DEMO开始</h4> 
<ul><li>Vue Draggable Next: <a href="https://sortablejs.github.io/vue.draggable.next/#simple" rel="nofollow">Vue Draggable Next</a></li><li>React Sortable HOC: <a href="https://clauderic.github.io/react-sortable-hoc" rel="nofollow">React Sortable HOC</a></li></ul> 
<h5><a id="_10"></a>列表排序的三个阶段</h5> 
<ul><li>拖动开始（dragstart） 
  <ul><li>被拖动图层的状态变化</li><li>会出一个浮层</li></ul> </li><li>拖动进行中(dragmove) 
  <ul><li>浮层会随着鼠标移动</li><li>条目发生换位：当浮层下沿超过被拖条目二分之一的时候，触发换位。<code>这是一个比较独特的需求</code></li></ul> </li><li>松开鼠标阶段（drop） 
  <ul><li>浮层消失</li><li>被拖动图层状态复原</li><li>数据被更新<br> <img src="https://images2.imgbox.com/4c/a2/1222ufIb_o.gif" alt="在这里插入图片描述"></li></ul> </li></ul> 
<h5><a id="_23"></a>拖动排序功能开发</h5> 
<p><strong>第一阶段 Dragstart</strong></p> 
<ul><li>被拖动图层的状态变化 常规做法 
  <ul><li>添加mouseDown事件，检查当前的target是那个元素，然后给他添加特定的状态</li><li>添加mouseMove事件，创一个和被拖动元素一模一样的的浮层，将它的定位设置<br> 它的定位为绝对定位，并且随着鼠标的坐标更新。</li></ul> </li><li>使用HTML的Drag特性 
  <ul><li>文档地址：<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/HTML_Drag_and_Drop_API/Drag_operations" rel="nofollow">拖拽操作</a></li><li>浏览器的默认拖拽行为：支持图象，链接和选择的文本</li><li>其他元素默认情况是不可拖拽的。</li><li><code>如果想可以拖拽可以设置为draggable = true</code></li><li>使用dragstart事件监控拖动开始，并设置对应的属性</li></ul> </li></ul> 
<p>LayerList组件中添加draggable属性</p> 
<pre><code class="prism language-js"><span class="token comment">// LayerList.vue</span>
<span class="token operator">&lt;</span>li
  <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"ant-list-item"</span>
  v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"item in list"</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">"item.id"</span>
  <span class="token operator">:</span><span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"{ active: item.id === selectedId }"</span>
  @click<span class="token operator">=</span><span class="token string">"handleClick(item.id)"</span>
  draggable<span class="token operator">=</span><span class="token string">"true"</span>
<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/a7/48/GxZqMNwm_o.gif" alt="在这里插入图片描述"><br> 这样就可以有效果了：当拖动对应条目的时候，它会自动生成半透明的条目，并且跟随鼠标的移动。<br> 接下来就开始<code>使用dragstart事件监控拖动开始，并设置对应的属性</code></p> 
<ul><li>给被拖动元素添加特定的状态：使用一系列的事件来监控拖动的进度，使用<code>dragStart</code>开始拖动操作</li></ul> 
<pre><code class="prism language-js"><span class="token comment">// LayerList.vue</span>
<span class="token comment">// html部分</span>
<span class="token operator">&lt;</span>li
  <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"ant-list-item"</span>
  v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"item in list"</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">"item.id"</span>
  <span class="token operator">:</span><span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"{ active: item.id === selectedId, ghost: dragData.currentDragging === item.id}"</span>
  @click<span class="token operator">=</span><span class="token string">"handleClick(item.id)"</span>
  @dragstart<span class="token operator">=</span><span class="token string">"onDragStart($event, item.id)"</span>
  draggable<span class="token operator">=</span><span class="token string">"true"</span>
<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
<span class="token comment">// js部分(setup)</span>
<span class="token keyword">const</span> dragData <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  <span class="token literal-property property">currentDragging</span><span class="token operator">:</span> <span class="token string">''</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">onDragStart</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">e</span><span class="token operator">:</span> DragEvent<span class="token punctuation">,</span> <span class="token literal-property property">id</span><span class="token operator">:</span> string</span> <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  dragData<span class="token punctuation">.</span>currentDragging <span class="token operator">=</span> id<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// css部分</span>
<span class="token punctuation">.</span>ant<span class="token operator">-</span>list<span class="token operator">-</span>item<span class="token punctuation">.</span>ghost <span class="token punctuation">{<!-- --></span>
  <span class="token literal-property property">opacity</span><span class="token operator">:</span> <span class="token number">0.5</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>完成出来的效果：<br> <img src="https://images2.imgbox.com/8f/3d/tCaEyYhY_o.gif" alt="在这里插入图片描述"><br> 接下来就是在鼠标松开的时候，特定的状态消失：使用<code>drop</code>事件：</p> 
<pre><code class="prism language-js"><span class="token operator">&lt;</span>ul <span class="token operator">:</span>list<span class="token operator">=</span><span class="token string">"list"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"ant-list-items ant-list-border"</span> @drop<span class="token operator">=</span><span class="token string">"onDrop"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">&gt;</span>
<span class="token keyword">const</span> <span class="token function-variable function">onDrop</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">e</span><span class="token operator">:</span> DragEvent</span> <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  dragData<span class="token punctuation">.</span>currentDragging <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>但是这样做发现不起作用，后来发现是<code>onDrog</code>事件并没有触发，原因：<br> <code>dragenter 或 dragover 事件的监听程序用于表示有效的放置目标，也就是被拖拽项目可能放置的地方。网页或应用程序的大多数区域都不是放置数据的有效位置。因此，这些事件的默认处理是不允许放置。</code><br> <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/HTML_Drag_and_Drop_API/Drag_operations#%E6%8C%87%E5%AE%9A%E6%94%BE%E7%BD%AE%E7%9B%AE%E6%A0%87" rel="nofollow">指定放置对象</a><br> 因为网页大部分区域不是有效的放置位置，这些事件的默认处理都是不允许放置，所以这个行为并不会被触发。<br> <code>如果你想要允许放置，你必须取消 dragenter 和 dragover 事件来阻止默认的处理。你可以在属性定义的事件监听程序返回 false，或者调用事件的 preventDefault() 方法来实现这一点。在一个独立脚本中的定义的函数里，可能后者更可行。</code><br> 最终添加阻止默认行为事件：</p> 
<pre><code class="prism language-js"><span class="token operator">&lt;</span>ul <span class="token operator">:</span>list<span class="token operator">=</span><span class="token string">"list"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"ant-list-items ant-list-border"</span> @drop<span class="token operator">=</span><span class="token string">"onDrop"</span> @dragover<span class="token operator">=</span><span class="token string">"onDragOver"</span><span class="token operator">&gt;</span>

<span class="token keyword">const</span> <span class="token function-variable function">onDragOver</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">e</span><span class="token operator">:</span> DragEvent</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="_98"></a>处理松开鼠标时进行排序</h5> 
<ol><li> <p>修改dragData 添加一个当前索引的属性</p> <pre><code class="prism language-typescript">    <span class="token keyword">const</span> dragData <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      currentDragging<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
      currentIndex<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> </li><li> <p>@dragstart=“onDragStart($event, item.id, index)” 方法中多添加一个index参数</p> <pre><code class="prism language-typescript">    <span class="token keyword">const</span> <span class="token function-variable function">onDragStart</span> <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> DragEvent<span class="token punctuation">,</span> id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> index<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      dragData<span class="token punctuation">.</span>currentDragging <span class="token operator">=</span> id<span class="token punctuation">;</span>
      dragData<span class="token punctuation">.</span>currentIndex <span class="token operator">=</span> index<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> </li></ol> 
<p>有了开始拖动的index之后，我们要知道drop的时候新的index，我们怎么在<code>onDrop</code>方法中拿到新的index呢？因为在<code>onDrop</code>中我们的参数是<code>event</code>，使用<code>event.target</code>可以拿到dom元素，把最新的index放到dom元素上面就可以了，使用：<code>HTMLElement.dataset</code><br> 3. 使用 <code>HTMLElement.dataset</code>拿到最新的索引</p> 
<blockquote> 
 <p>HTMLElement.dataset属性允许无论是在读取模式和写入模式下访问在HTML 或 DOM中元素上设置的<br> 所有自定义数据属性（data-*）集<br> 它是一个DOMString的映射，每个自定义数据属性的一个条目。<br> 请注意，dataset属性本身可以被读取，但不能直接写入，相反，所有的写入必股友是它的属性，这反过来<br> 表示数据属性。<br> 还要注意，一个HTML data-attribute 及其对应的DOM dataset.property 不共享相同的名称，但它<br> 们总是相似的：</p> 
</blockquote> 
<ol><li></ol> 
<pre><code class="prism language-typescript">       <span class="token operator">&lt;</span>li
         <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"ant-list-item"</span>
         <span class="token operator">:</span><span class="token keyword">class</span><span class="token operator">=</span>"<span class="token punctuation">{<!-- --></span>
           active<span class="token operator">:</span> item<span class="token punctuation">.</span>id <span class="token operator">===</span> selectedId<span class="token punctuation">,</span>
           ghost<span class="token operator">:</span> dragData<span class="token punctuation">.</span>currentDragging <span class="token operator">===</span> item<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
         <span class="token punctuation">}</span>"
         v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"(item, index) in list"</span>
         <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">"item.id"</span>
         <span class="token decorator"><span class="token at operator">@</span><span class="token function">click</span></span><span class="token operator">=</span><span class="token string">"handleClick(item.id)"</span>
         <span class="token decorator"><span class="token at operator">@</span><span class="token function">dragstart</span></span><span class="token operator">=</span><span class="token string">"onDragStart($event, item.id, index)"</span>
         <span class="token operator">:</span>data<span class="token operator">-</span>index<span class="token operator">=</span><span class="token string">"index"</span>
         draggable<span class="token operator">=</span><span class="token string">"true"</span>
       <span class="token operator">&gt;</span>
</code></pre> 
<ol start="2"><li>修改onDrop事件</li></ol> 
<pre><code class="prism language-ts"><span class="token keyword">const</span> <span class="token function-variable function">onDrop</span> <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> DragEvent<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> currentEle <span class="token operator">=</span> e<span class="token punctuation">.</span>target <span class="token keyword">as</span> HTMLElement<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>currentEle<span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>index<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> moveIndex <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>currentEle<span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>moveIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  dragData<span class="token punctuation">.</span>currentDragging <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p>但是这样写<code>moveIndex</code>是不一定存在的，因为<code>e.target</code>是鼠标指向的元素，所以当在目标子元素上面进行释放的话，就会把目标当成子元素，比如如果释放到的元素是锁元素，则<code>currentEle</code>就是锁元素。所以这里需要一个方法来向上进行检索，找到符合条件的父元素。</p> 
<pre><code class="prism language-js"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">getParentElement</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">element</span><span class="token operator">:</span> HTMLElement<span class="token punctuation">,</span> <span class="token literal-property property">className</span><span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>element<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>element<span class="token punctuation">.</span>classList <span class="token operator">&amp;&amp;</span> element<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">return</span> element<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
      element <span class="token operator">=</span> element<span class="token punctuation">.</span>parentNode <span class="token keyword">as</span> HTMLElement<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-typescript">    <span class="token keyword">const</span> <span class="token function-variable function">onDrop</span> <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> DragEvent<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">const</span> currentEle <span class="token operator">=</span> <span class="token function">getParentElement</span><span class="token punctuation">(</span>
        e<span class="token punctuation">.</span>target <span class="token keyword">as</span> HTMLElement<span class="token punctuation">,</span>
        <span class="token string">'ant-list-item'</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>currentEle <span class="token operator">&amp;&amp;</span> currentEle<span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>index<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">const</span> moveIndex <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>currentEle<span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 使用第三方库arrayMove改变数组</span>
        arrayMove<span class="token punctuation">.</span><span class="token function">mutate</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>list<span class="token punctuation">,</span> dragData<span class="token punctuation">.</span>currentIndex<span class="token punctuation">,</span> moveIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      dragData<span class="token punctuation">.</span>currentDragging <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p><a href="https://www.npmjs.com/package/array-move" rel="nofollow">array-move</a><br> 最终实现的效果：<br> <img src="https://images2.imgbox.com/7f/cf/7ozRDRtj_o.gif" alt="在这里插入图片描述"></p> 
<h5><a id="_187"></a>在拖动时完成排序：</h5> 
<pre><code class="prism language-ts">    <span class="token keyword">const</span> <span class="token function-variable function">onDragEnter</span> <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> DragEvent<span class="token punctuation">,</span> index<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      <span class="token comment">// 这里的判断是为了避免完成转换后，触发新的一次dragEnter事件</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">!==</span> dragData<span class="token punctuation">.</span>currentIndex<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'enter'</span><span class="token punctuation">,</span> index<span class="token punctuation">,</span> dragData<span class="token punctuation">.</span>currentIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        arrayMove<span class="token punctuation">.</span><span class="token function">mutate</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>list<span class="token punctuation">,</span> dragData<span class="token punctuation">.</span>currentIndex<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>
        dragData<span class="token punctuation">.</span>currentIndex <span class="token operator">=</span> index<span class="token punctuation">;</span>
        end <span class="token operator">=</span> index
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p>这样就可以在拖动时完成排序了，<code>onDrop</code>里面就不需要进行同样的操作了，修改一下<code>onDrop</code>事件</p> 
<pre><code class="prism language-ts"><span class="token keyword">let</span> start <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> end <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">onDragStart</span> <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> DragEvent<span class="token punctuation">,</span> id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> index<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  dragData<span class="token punctuation">.</span>currentDragging <span class="token operator">=</span> id<span class="token punctuation">;</span>
  dragData<span class="token punctuation">.</span>currentIndex <span class="token operator">=</span> index<span class="token punctuation">;</span>
  start <span class="token operator">=</span> index<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">onDrop</span> <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> DragEvent<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  context<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'drop'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> start<span class="token punctuation">,</span> end<span class="token punctuation">}</span><span class="token punctuation">)</span>
  dragData<span class="token punctuation">.</span>currentDragging <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p>现在就完成了可拖动排序的简单编码，主要掌握三个阶段：</p> 
<ol><li>排序开始：监控被拖拽的元素，添加特殊状态和UI</li><li>移动阶段：进入别的列表的时候完成数据的交换</li><li>drop阶段：松开按钮的时候，将状态恢复原状，并且发送对应的事件。</li></ol> 
<h4><a id="_219"></a>使用第三方库进行排序：</h4> 
<h6><a id="Vue_Draggable_220"></a>使用Vue Draggable进行排序：</h6> 
<p><a href="https://github.com/SortableJS/vue.draggable.next/blob/master/example/components/simple.vue">vue.draggable.next<br> </a></p> 
<pre><code class="prism language-bash"><span class="token function">npm</span> i <span class="token parameter variable">-S</span> vuedraggable@next
</code></pre> 
<p>将用draggable替换掉ul</p> 
<pre><code class="prism language-typescript"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>draggable
    <span class="token operator">:</span>list<span class="token operator">=</span><span class="token string">"list"</span>
    <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"ant-list-items ant-list-bordered"</span>
    ghost<span class="token operator">-</span><span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"ghost"</span>
    handle<span class="token operator">=</span><span class="token string">".handle"</span>
    item<span class="token operator">-</span>key<span class="token operator">=</span><span class="token string">"id"</span>
  <span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>template #item<span class="token operator">=</span><span class="token string">"{ element }"</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>li
        <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"ant-list-item"</span>
        <span class="token operator">:</span><span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"{ active: element.id === selectedId }"</span>
        <span class="token decorator"><span class="token at operator">@</span><span class="token function">click</span></span><span class="token operator">=</span><span class="token string">"handleClick(element.id)"</span>
      <span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>a<span class="token operator">-</span>tooltip <span class="token operator">:</span>title<span class="token operator">=</span><span class="token string">"element.isHidden ? '显示' : '隐藏'"</span><span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>a<span class="token operator">-</span>button
            shape<span class="token operator">=</span><span class="token string">"circle"</span>
            <span class="token decorator"><span class="token at operator">@</span><span class="token function">click</span></span><span class="token punctuation">.</span>stop<span class="token operator">=</span>"
              <span class="token function">handleChange</span><span class="token punctuation">(</span>element<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token string">'isHidden'</span><span class="token punctuation">,</span> <span class="token operator">!</span>element<span class="token punctuation">.</span>isHidden<span class="token punctuation">)</span>
            "
          <span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>template v<span class="token operator">-</span>slot<span class="token operator">:</span>icon v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"element.isHidden"</span>
              <span class="token operator">&gt;</span><span class="token operator">&lt;</span>EyeInvisibleOutlined <span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>template v<span class="token operator">-</span>slot<span class="token operator">:</span>icon v<span class="token operator">-</span><span class="token keyword">else</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>EyeOutlined <span class="token operator">/</span><span class="token operator">&gt;</span> <span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>tooltip<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>a<span class="token operator">-</span>tooltip <span class="token operator">:</span>title<span class="token operator">=</span><span class="token string">"element.isLocked ? '解锁' : '锁定'"</span><span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>a<span class="token operator">-</span>button
            shape<span class="token operator">=</span><span class="token string">"circle"</span>
            <span class="token decorator"><span class="token at operator">@</span><span class="token function">click</span></span><span class="token punctuation">.</span>stop<span class="token operator">=</span>"
              <span class="token function">handleChange</span><span class="token punctuation">(</span>element<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token string">'isLocked'</span><span class="token punctuation">,</span> <span class="token operator">!</span>element<span class="token punctuation">.</span>isLocked<span class="token punctuation">)</span>
            "
          <span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>template v<span class="token operator">-</span>slot<span class="token operator">:</span>icon v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"element.isLocked"</span>
              <span class="token operator">&gt;</span><span class="token operator">&lt;</span>LockOutlined<span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>template v<span class="token operator">-</span>slot<span class="token operator">:</span>icon v<span class="token operator">-</span><span class="token keyword">else</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>UnlockOutlined  <span class="token operator">/</span><span class="token operator">&gt;</span> <span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>tooltip<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>inline<span class="token operator">-</span>edit
          <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"edit-area"</span>
          <span class="token operator">:</span>value<span class="token operator">=</span><span class="token string">"element.layerName"</span>
          <span class="token decorator"><span class="token at operator">@</span><span class="token function">change</span></span><span class="token operator">=</span>"
            <span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
              <span class="token function">handleChange</span><span class="token punctuation">(</span>element<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token string">'layerName'</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
          "
        <span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>inline<span class="token operator">-</span>edit<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>a<span class="token operator">-</span>tooltip title<span class="token operator">=</span><span class="token string">"拖动排序"</span><span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>a<span class="token operator">-</span>button shape<span class="token operator">=</span><span class="token string">"circle"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"handle"</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>template v<span class="token operator">-</span>slot<span class="token operator">:</span>icon<span class="token operator">&gt;</span><span class="token operator">&lt;</span>DragOutlined <span class="token operator">/</span><span class="token operator">&gt;</span> <span class="token operator">&lt;</span><span class="token operator">/</span>template
          <span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>tooltip<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>draggable<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script lang<span class="token operator">=</span><span class="token string">"ts"</span><span class="token operator">&gt;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> defineComponent<span class="token punctuation">,</span> PropType <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> draggable <span class="token keyword">from</span> <span class="token string">'vuedraggable'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span>
  EyeOutlined<span class="token punctuation">,</span>
  EyeInvisibleOutlined<span class="token punctuation">,</span>
  LockOutlined<span class="token punctuation">,</span>
  UnlockOutlined<span class="token punctuation">,</span>
  DragOutlined<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@ant-design/icons-vue'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> ComponentData <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../store/editor'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> InlineEdit <span class="token keyword">from</span> <span class="token string">'../components/InlineEdit.vue'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  props<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    list<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      type<span class="token operator">:</span> <span class="token builtin">Array</span> <span class="token keyword">as</span> PropType<span class="token operator">&lt;</span>ComponentData<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
      required<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    selectedId<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      type<span class="token operator">:</span> String<span class="token punctuation">,</span>
      required<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  emits<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'select'</span><span class="token punctuation">,</span> <span class="token string">'change'</span><span class="token punctuation">,</span> <span class="token string">'drop'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  components<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    EyeOutlined<span class="token punctuation">,</span>
    EyeInvisibleOutlined<span class="token punctuation">,</span>
    LockOutlined<span class="token punctuation">,</span>
    UnlockOutlined<span class="token punctuation">,</span>
    InlineEdit<span class="token punctuation">,</span>
    draggable<span class="token punctuation">,</span>
    DragOutlined<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">setup</span><span class="token punctuation">(</span>props<span class="token punctuation">,</span> context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> <span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span>id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      context<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'select'</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token function-variable function">handleChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span>id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        id<span class="token punctuation">,</span>
        key<span class="token punctuation">,</span>
        value<span class="token punctuation">,</span>
        isRoot<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      context<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'change'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span>
      handleChange<span class="token punctuation">,</span>
      handleClick<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>style scoped<span class="token operator">&gt;</span>
<span class="token punctuation">.</span>ant<span class="token operator">-</span>list<span class="token operator">-</span>item <span class="token punctuation">{<!-- --></span>
  padding<span class="token operator">:</span> 10px 15px<span class="token punctuation">;</span>
  transition<span class="token operator">:</span> all <span class="token number">0</span><span class="token punctuation">.</span>5s ease<span class="token operator">-</span>out<span class="token punctuation">;</span>
  cursor<span class="token operator">:</span> pointer<span class="token punctuation">;</span>
  justify<span class="token operator">-</span>content<span class="token operator">:</span> normal<span class="token punctuation">;</span>
  border<span class="token operator">:</span> 1px solid #fff<span class="token punctuation">;</span>
  border<span class="token operator">-</span>bottom<span class="token operator">-</span>color<span class="token operator">:</span> #f0f0f0<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">.</span>ant<span class="token operator">-</span>list<span class="token operator">-</span>item<span class="token punctuation">.</span>active <span class="token punctuation">{<!-- --></span>
  border<span class="token operator">:</span> 1px solid #1890ff<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">.</span>ant<span class="token operator">-</span>list<span class="token operator">-</span>item<span class="token punctuation">.</span>ghost <span class="token punctuation">{<!-- --></span>
  opacity<span class="token operator">:</span> <span class="token number">0.5</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token punctuation">.</span>ant<span class="token operator">-</span>list<span class="token operator">-</span>item<span class="token operator">:</span>hover <span class="token punctuation">{<!-- --></span>
  background<span class="token operator">:</span> #e6f7ff<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">.</span>ant<span class="token operator">-</span>list<span class="token operator">-</span>item <span class="token operator">&gt;</span> <span class="token operator">*</span> <span class="token punctuation">{<!-- --></span>
  margin<span class="token operator">-</span>right<span class="token operator">:</span> 10px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">.</span>ant<span class="token operator">-</span>list<span class="token operator">-</span>item button <span class="token punctuation">{<!-- --></span>
  font<span class="token operator">-</span>size<span class="token operator">:</span> 12px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token punctuation">.</span>ant<span class="token operator">-</span>list<span class="token operator">-</span>item <span class="token punctuation">.</span>handle <span class="token punctuation">{<!-- --></span>
  cursor<span class="token operator">:</span> move<span class="token punctuation">;</span>
  margin<span class="token operator">-</span>left<span class="token operator">:</span> auto<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">.</span>ant<span class="token operator">-</span>list<span class="token operator">-</span>item <span class="token punctuation">.</span>edit<span class="token operator">-</span>area <span class="token punctuation">{<!-- --></span>
  width<span class="token operator">:</span> <span class="token number">100</span><span class="token operator">%</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span>

</code></pre> 
<p><img src="https://images2.imgbox.com/b9/09/a9gL7hWu_o.png" alt="![外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传](https://img-home.csdnimg.cn/images/20230724024159.png?origin_url=image%2F4-5%E4%BD%BF%E7%94%A8VueDraggableNext%E5%AE%8C%E6%88%90%E6%8E%92%E5%BA%8F%2F1670944246854.png&amp;pos_id=img-LOtmD6Gr-1705830416096"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/30666f85e1a45d109c62c32078279609/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Redis高并发分布式锁</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0ffe559cfd84a45b604085743f2ccb26/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Linux权限理解（2）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>