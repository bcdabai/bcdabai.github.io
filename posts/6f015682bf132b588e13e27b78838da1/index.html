<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Djangoå…¨æ–‡æœç´¢ - ç¼–ç¨‹å¤§ç™½çš„åšå®¢</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Djangoå…¨æ–‡æœç´¢" />
<meta property="og:description" content="Django ORMå…è®¸ä½ æ‰§è¡Œç®€å•çš„åŒ¹é…æ“ä½œï¼Œä¾‹å¦‚containsè¿‡æ»¤å™¨ï¼ˆæˆ–è€…ä¸åŒºåˆ†å¤§å°å†™çš„icontainsï¼‰ã€‚
æ¯”å¦‚æŸ¥è¯¢æ­£æ–‡ä¸­åŒ…å«djangoçš„æ–‡ç« 
from blog.models import Post Post.objects.filter(body__contains=&#39;framework&#39;) ä½†æ˜¯å¦‚æœå¸Œæœ›æ‰§è¡Œå¤æ‚çš„æœç´¢æŸ¥è¯¢ï¼Œé€šè¿‡ç›¸ä¼¼åº¦æˆ–åŠ æƒé¡¹æ£€ç´¢ç»“æœï¼Œåˆ™éœ€è¦æ›´å¼ºå¤§çš„æœç´¢åŠŸèƒ½ã€‚
ğŸ“Œè™½ç„¶Djangoæ˜¯ä¸€ä¸ªä¸æ•°æ®åº“æ— å…³çš„webæ¡†æ¶ï¼Œä½†å®ƒæä¾›äº†ä¸€ä¸ªæ¨¡å—ï¼Œè¯¥æ¨¡å—æ”¯æŒPostgreSQLæä¾›çš„éƒ¨åˆ†ä¸°å¯Œç‰¹æ€§ï¼Œä¸æ”¯æŒéPostgreSQLæ•°æ®åº“ã€‚
Django.contrib.postgresæ¨¡å—æä¾›äº†ç”±PostgreSQLä¸“äº«çš„åŠŸèƒ½ã€‚
ç®€å•æŸ¥è¯¢ INSTALLED_APPS = [ #... &#34;django.contrib.postgres&#34;, ] å¯¹å•ä¸ªå­—æ®µè¿›è¡Œæœç´¢
from blog.models import Post Post.objects.filter(body__search=&#39;django&#39;) å¯¹å¤šä¸ªå­—æ®µè¿›è¡ŒæŸ¥è¯¢ æœç´¢Postæ¨¡å‹çš„æ ‡é¢˜å’Œæ­£æ–‡å­—æ®µ
from django.contrib.postgres.search import SearchVector from blog.models import Post Post.objects.annotate( search=SearchVector(&#39;title&#39;, &#39;body&#39;), ).filter(search=&#39;django&#39;) ä½¿ç”¨annotateå¹¶ä½¿ç”¨ä¸¤ä¸ªå­—æ®µå®šä¹‰SearchVector(æ–‡ç« æ ‡é¢˜å’Œæ­£æ–‡)ã€‚
æ„å»ºæŸ¥è¯¢è§†å›¾ åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰è§†å›¾ï¼Œé¦–å…ˆéœ€è¦ä¸€ä¸ªæœç´¢è¡¨å•
ç¼–è¾‘form.pyï¼Œæ–°å»ºSearchFormè¡¨å•ç±»
from django import forms from .models import Comment class EmailPostForm(forms.Form): name = forms.CharField(max_length=25) email = forms.EmailField() to = forms.EmailField() comments = forms.CharField(required=False,widget=forms.Textarea) class CommentForm(forms.ModelForm): class Meta: model = Comment fields = (&#39;name&#39;,&#39;email&#39;,&#39;body&#39;) class SearchForm(forms." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/6f015682bf132b588e13e27b78838da1/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-09T09:56:34+08:00" />
<meta property="article:modified_time" content="2024-01-09T09:56:34+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="ç¼–ç¨‹å¤§ç™½çš„åšå®¢" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">ç¼–ç¨‹å¤§ç™½çš„åšå®¢</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Djangoå…¨æ–‡æœç´¢</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>Django ORMå…è®¸ä½ æ‰§è¡Œç®€å•çš„åŒ¹é…æ“ä½œï¼Œä¾‹å¦‚containsè¿‡æ»¤å™¨ï¼ˆæˆ–è€…ä¸åŒºåˆ†å¤§å°å†™çš„icontainsï¼‰ã€‚<br> æ¯”å¦‚æŸ¥è¯¢æ­£æ–‡ä¸­åŒ…å«djangoçš„æ–‡ç« </p> 
<pre><code class="language-python">from blog.models import Post
Post.objects.filter(body__contains='framework')</code></pre> 
<p>ä½†æ˜¯å¦‚æœå¸Œæœ›æ‰§è¡Œå¤æ‚çš„æœç´¢æŸ¥è¯¢ï¼Œé€šè¿‡ç›¸ä¼¼åº¦æˆ–åŠ æƒé¡¹æ£€ç´¢ç»“æœï¼Œåˆ™éœ€è¦æ›´å¼ºå¤§çš„æœç´¢åŠŸèƒ½ã€‚</p> 
<blockquote> 
 <p>ğŸ“Œè™½ç„¶Djangoæ˜¯ä¸€ä¸ªä¸æ•°æ®åº“æ— å…³çš„webæ¡†æ¶ï¼Œä½†å®ƒæä¾›äº†ä¸€ä¸ªæ¨¡å—ï¼Œè¯¥æ¨¡å—æ”¯æŒPostgreSQLæä¾›çš„éƒ¨åˆ†ä¸°å¯Œç‰¹æ€§ï¼Œä¸æ”¯æŒéPostgreSQLæ•°æ®åº“ã€‚</p> 
</blockquote> 
<p>Django.contrib.postgresæ¨¡å—æä¾›äº†ç”±PostgreSQLä¸“äº«çš„åŠŸèƒ½ã€‚</p> 
<h2>ç®€å•æŸ¥è¯¢</h2> 
<pre><code class="language-python">INSTALLED_APPS = [
	#...
Â  Â  "django.contrib.postgres",

]</code></pre> 
<p>å¯¹å•ä¸ªå­—æ®µè¿›è¡Œæœç´¢</p> 
<pre><code class="language-python">from blog.models import Post
Post.objects.filter(body__search='django')</code></pre> 
<h2>å¯¹å¤šä¸ªå­—æ®µè¿›è¡ŒæŸ¥è¯¢</h2> 
<p>æœç´¢Postæ¨¡å‹çš„æ ‡é¢˜å’Œæ­£æ–‡å­—æ®µ</p> 
<pre><code class="language-python">from django.contrib.postgres.search import SearchVector
from blog.models import Post

Post.objects.annotate(
		search=SearchVector('title', 'body'),
	).filter(search='django')</code></pre> 
<p><br> ä½¿ç”¨annotateå¹¶ä½¿ç”¨ä¸¤ä¸ªå­—æ®µå®šä¹‰SearchVector(æ–‡ç« æ ‡é¢˜å’Œæ­£æ–‡)ã€‚</p> 
<h2>æ„å»ºæŸ¥è¯¢è§†å›¾</h2> 
<p>åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰è§†å›¾ï¼Œé¦–å…ˆéœ€è¦ä¸€ä¸ªæœç´¢è¡¨å•<br> ç¼–è¾‘form.pyï¼Œæ–°å»ºSearchFormè¡¨å•ç±»</p> 
<pre><code class="language-python">from django import forms
from .models import Comment

class EmailPostForm(forms.Form):
	name = forms.CharField(max_length=25)
	email = forms.EmailField()
	to = forms.EmailField()
	comments = forms.CharField(required=False,widget=forms.Textarea)

class CommentForm(forms.ModelForm):
	class Meta:
		model = Comment
		fields = ('name','email','body')

class SearchForm(forms.Form):
	query = forms.CharField()</code></pre> 
<p>ä½¿ç”¨queryå­—æ®µè®©ç”¨æˆ·å¼•å…¥æœç´¢è¯ã€‚</p> 
<p>å…³äºEmailPostFormå’ŒCommentFormè¡¨å•çš„æ›´å¤šå†…å®¹ï¼Œè¯·æŸ¥çœ‹</p> 
<p><a href="https://blog.csdn.net/Q1780020/article/details/135337037?spm=1001.2014.3001.5501" title="Djangoå‘é€QQé‚®ä»¶-CSDNåšå®¢">Djangoå‘é€QQé‚®ä»¶-CSDNåšå®¢</a></p> 
<p><a href="https://blog.csdn.net/Q1780020/article/details/135356568?spm=1001.2014.3001.5501" title="Djangoè¯„è®ºç³»ç»Ÿ-CSDNåšå®¢">Djangoè¯„è®ºç³»ç»Ÿ-CSDNåšå®¢</a></p> 
<blockquote> 
 <p>ğŸ“Œæ³¨æ„forms.CharFieldåé¢çš„æ‹¬å·ï¼Œå¦‚æœæ²¡æœ‰æ‹¬å·ä¸ä¼šæŠ¥é”™</p> 
</blockquote> 
<p>ç¼–è¾‘views.py</p> 
<pre><code class="language-python">from .forms import EmailPostForm,CommentForm,SearchForm
from django.contrib.postgres.search import SearchVector

def post_search(request):
Â  Â  form = SearchForm()
Â  Â  query = None
Â  Â  results = []
Â  Â  if 'query' in request.GET:
Â  Â  Â  Â  form = SearchForm(request.Get)
Â  Â  Â  Â  if form.is_valid():
Â  Â  Â  Â  Â  Â  query = form.cleaned_data['query']
Â  Â  Â  Â  Â  Â  results = Post.objects.annotate(
Â  Â  Â  Â  Â  Â  Â  Â  search = SearchVector('title','body'),
Â  Â  Â  Â  Â  Â  ).filter(search=query)
Â  Â  template = "blog/post/search.html"
Â  Â  context={
Â  Â  Â  Â  'form':form,
Â  Â  Â  Â  'query':query,
Â  Â  Â  Â  'results':results,
Â  Â  }

Â  Â  return render(request,template,context)</code></pre> 
<ul><li>é¦–å…ˆå®ä¾‹åŒ–ä¸€ä¸ªè¡¨å•ã€‚</li><li>ä½¿ç”¨GETæ–¹æ³•æäº¤è¡¨å•ï¼Œä»¥ä¾¿ç”ŸæˆåŒ…å«æŸ¥è¯¢å‚æ•°URL</li><li>åœ¨è¯·æ±‚ä¸­æŸ¥æ‰¾queryå‚æ•°ï¼Œæ£€éªŒæ˜¯å¦æäº¤äº†è¡¨å•</li><li>æäº¤è¡¨å•æ—¶ï¼Œä½¿ç”¨æäº¤çš„GETæ•°æ®å®ä¾‹åŒ–ï¼Œå¹¶éªŒè¯è¡¨å•æ•°æ®æ˜¯å¦æœ‰æ•ˆ</li><li>å¦‚æœè¡¨å•æœ‰æ•ˆï¼Œä½¿ç”¨è‡ªå®šä¹‰SearchVectorå®ä¾‹æœç´¢åŒ…å«æ ‡é¢˜å’Œæ­£æ–‡å­—æ®µ</li></ul> 
<h2>æ„å»ºæŸ¥è¯¢æ¨¡ç‰ˆ</h2> 
<p>æœç´¢è§†å›¾å‡†å¤‡å¥½åï¼Œåˆ›ä¸€ä¸ªæ¨¡ç‰ˆï¼Œåœ¨ç”¨æˆ·æ‰§è¡Œæœç´¢æ—¶æ˜¾ç¤ºè¡¨å•å’Œç»“æœã€‚</p> 
<p>åœ¨blog/post/templateç›®å½•ä¸‹åˆ›å»ºsearch.html</p> 
<pre><code class="language-html">```html
{% extends "blog/base.html" %}
{% block title %}Search{% endblock %}
{% block content %}
Â  Â  {% if query %}
Â  Â  Â  Â  &lt;h1&gt;Posts containing "{<!-- -->{ query }}"&lt;/h1&gt;
Â  Â  Â  Â  &lt;h3&gt;
Â  Â  Â  Â  Â  Â  {% with result.cont as total_results %}
Â  Â  Â  Â  Â  Â      Found {<!-- -->{ total_results }} result {<!-- -->{ total_results|pluralize }}
Â  Â  Â  Â  Â  Â  {% endwith %}

Â  Â  Â  Â  &lt;/h3&gt;

Â  Â  Â  Â  {% for post in results %}

Â  Â  Â  Â  Â  Â  &lt;h4&gt;
Â  Â  Â  Â  Â  Â  Â  Â  &lt;a href="{<!-- -->{ post.get_absolute_url }}"&gt;{<!-- -->{post.title}}&lt;/a&gt;
Â  Â  Â  Â  Â  Â  &lt;/h4&gt;
Â  Â  Â  Â  Â  Â  {<!-- -->{ post.body|truncatewords:5 }}

Â  Â  Â  Â  {% empty %}

Â  Â  Â  Â  Â  Â  &lt;p&gt;There are no results for your query.&lt;/p&gt;

Â  Â  Â  Â  {% endfor%}

Â  Â  Â  Â  &lt;p&gt;
Â  Â  Â  Â  Â  Â  &lt;a href="{% url 'blog:post_search' %}"&gt;Search again&lt;/a&gt;
Â  Â  Â  Â  &lt;/p&gt;

Â  Â  {% else %}

Â  Â  Â  Â  &lt;h1&gt;Search for posts&lt;/h1&gt;
Â  Â  Â  Â  &lt;form action="." method="get"&gt;{<!-- -->{ form.as_p }}
Â  Â  Â  Â  Â  Â  &lt;input type="submit" value="Search"&gt;
Â  Â  Â  Â  &lt;/form&gt;

Â  Â  {% endif %}

{% endblock%}</code></pre> 
<ul><li>ä¸æœç´¢è§†å›¾ä¸€æ ·ï¼Œé€šè¿‡æŸ¥è¯¢queryå‚æ•°åŒºåˆ†è¡¨å•æ˜¯å¦å·²æäº¤</li><li>æäº¤å‰ï¼Œæ˜¾ç¤ºè¡¨å•å’Œæäº¤æŒ‰é’®</li><li>æäº¤åï¼Œæ˜¾ç¤ºæŸ¥è¯¢æŸ¥è¯¢ç»“æœæ€»æ•°å’Œæ–‡ç« åˆ—è¡¨</li></ul> 
<p>post.get_absolute_url æ˜¯ä½¿ç”¨å¹´æœˆæ—¥ä¸ºæ¯ä¸ªæ–‡ç« æ„å»ºçš„URLï¼Œæ›´å¤šä¿¡æ¯è¯·æŸ¥çœ‹</p> 
<p><a href="https://blog.csdn.net/Q1780020/article/details/135318486?spm=1001.2014.3001.5501" title="Djangoç”¨æ—¥æœŸURLå®šä½è¯¦æƒ…-CSDNåšå®¢">Djangoç”¨æ—¥æœŸURLå®šä½è¯¦æƒ…-CSDNåšå®¢</a></p> 
<h2>æ„å»ºæŸ¥è¯¢è·¯å¾„</h2> 
<p>ç¼–è¾‘urls.py</p> 
<pre><code class="language-python">urlpatterns = [

	#...
Â  Â  path('search/',views.post_search, name='post_search')

]</code></pre> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e274422d03f769f9eebdaac5644121b8/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">MySQL é€’å½’ CTE(å…¬å…±è¡¨è¡¨è¾¾å¼) -___MySQL æ•™ç¨‹</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f5e6dc34245d5cd0534925348e9041bc/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">MySQLæ€»ç»“__ç‹‚ç¥è¯´Java</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 ç¼–ç¨‹å¤§ç™½çš„åšå®¢.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>