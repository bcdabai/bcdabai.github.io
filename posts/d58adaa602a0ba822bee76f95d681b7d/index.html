<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>socket服务器文件名和客户端一致,socket传送文件，不能正常运行，自己又找不到问题，急求解... - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="socket服务器文件名和客户端一致,socket传送文件，不能正常运行，自己又找不到问题，急求解..." />
<meta property="og:description" content="import java.io.BufferedReader;
import java.io.File;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.io.ObjectInputStream;
import java.net.ServerSocket;
import java.net.Socket;
public class Server {
/**
* 服务端：实现接收客户端发送的文件
*
* @throws IOException
*/
public static void main(String[] args) throws IOException {
String filename = null;
String filesize = null;
File file=null;
// 1.创建ServerSocket实例，指定绑定的端口号，并监听次端口
ServerSocket serverSocket = new ServerSocket(8235);
// 2.调用accept()方法开始监听，等待客户端的连接
Socket socket = serverSocket.accept();
System.out.println(&#34;***启动服务器，等待连接…………………………&#34;);
// 3.读取客户端发送的请求信息
InputStream is = socket.getInputStream();
InputStreamReader isr = new InputStreamReader(is);" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/d58adaa602a0ba822bee76f95d681b7d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-08-06T10:37:11+08:00" />
<meta property="article:modified_time" content="2021-08-06T10:37:11+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">socket服务器文件名和客户端一致,socket传送文件，不能正常运行，自己又找不到问题，急求解...</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div style="font-size:16px;"> 
 <p>import java.io.BufferedReader;</p> 
 <p>import java.io.File;</p> 
 <p>import java.io.FileOutputStream;</p> 
 <p>import java.io.IOException;</p> 
 <p>import java.io.InputStream;</p> 
 <p>import java.io.InputStreamReader;</p> 
 <p>import java.io.ObjectInputStream;</p> 
 <p>import java.net.ServerSocket;</p> 
 <p>import java.net.Socket;</p> 
 <p>public class Server {<!-- --></p> 
 <p>/**</p> 
 <p>* 服务端：实现接收客户端发送的文件</p> 
 <p>*</p> 
 <p>* @throws IOException</p> 
 <p>*/</p> 
 <p>public static void main(String[] args) throws IOException {<!-- --></p> 
 <p>String filename = null;</p> 
 <p>String filesize = null;</p> 
 <p>File file=null;</p> 
 <p>// 1.创建ServerSocket实例，指定绑定的端口号，并监听次端口</p> 
 <p>ServerSocket serverSocket = new ServerSocket(8235);</p> 
 <p>// 2.调用accept()方法开始监听，等待客户端的连接</p> 
 <p>Socket socket = serverSocket.accept();</p> 
 <p>System.out.println("***启动服务器，等待连接…………………………");</p> 
 <p>// 3.读取客户端发送的请求信息</p> 
 <p>InputStream is = socket.getInputStream();</p> 
 <p>InputStreamReader isr = new InputStreamReader(is);</p> 
 <p>BufferedReader br = new BufferedReader(isr);</p> 
 <p>String info=br.readLine() ;</p> 
 <p>// 4.解析客户端发送的文件信息，正确的,保存文件名以及文件的大小,为下面接收文件内容做准备</p> 
 <p>int index = info.indexOf("/#");// 查找/#在字符串中的索引位置</p> 
 <p>String daima = info.substring(0, index);// 获取字符串从0位置-index(不包括)之间的字符串内容</p> 
 <p>if (!daima.equals("111")) {<!-- --></p> 
 <p>System.out.println("服务器收到的文件的协议代码和客户端的文件协议代码不匹配！！");</p> 
 <p>} else {<!-- --></p> 
 <p>System.out.println("文件的协议代码一致！！！");</p> 
 <p>String infoChild = info.substring(index + 2);</p> 
 <p>// 获得info字符串的子字符串，该子字符串从指定索引处的字符开始，直到此字符串末尾部分的内容</p> 
 <p>int indexC = infoChild.indexOf("/#");</p> 
 <p>filename = infoChild.substring(0, index).trim();// trim忽略前导空白和尾部空白</p> 
 <p>filesize = infoChild.substring(index + 2).trim();</p> 
 <p>}</p> 
 <p>// 将接收到的文件保存在本地</p> 
 <p>file = new File(filename);</p> 
 <p>if (!file.exists()) {<!-- --></p> 
 <p>file.createNewFile();</p> 
 <p>} else {<!-- --></p> 
 <p>System.out.println("本路径已存在相同文件，进行覆盖");</p> 
 <p>}</p> 
 <p>// 5.服务器接收文件内容,并将内容保存到本地文件中</p> 
 <p>InputStream is1 = socket.getInputStream();// 获取传送文件的字节流</p> 
 <p>ObjectInputStream ois = new ObjectInputStream(is1);</p> 
 <p>// long fileSize = Long.parseLong(filesize);//将文件大小转换成有符号的十进制形式</p> 
 <p>/** 将文件包装到文件输出流对象中 */</p> 
 <p>FileOutputStream fos = new FileOutputStream(file);</p> 
 <p>byte[] data = new byte[ois.available()];</p> 
 <p>// ObjectInputStream的available()方法,读取字节数</p> 
 <p>int len;</p> 
 <p>while ((len = ois.read()) != -1) {// ObjectInputStream的read()方法，读取数据字节；如果读取的字节已到达流的末尾，则返回</p> 
 <p>// -1。</p> 
 <p>fos.write(data, 0, len);</p> 
 <p>fos.flush();</p> 
 <p>}</p> 
 <p>serverSocket.close();</p> 
 <p>socket.close();</p> 
 <p>is.close();</p> 
 <p>isr.close();</p> 
 <p>br.close();</p> 
 <p>is1.close();</p> 
 <p>ois.close();</p> 
 <p>fos.close();</p> 
 <p>}</p> 
 <p>}</p> 
 <p>客户端*******************************</p> 
 <p>import java.io.File;</p> 
 <p>import java.io.FileInputStream;</p> 
 <p>import java.io.IOException;</p> 
 <p>import java.io.InputStream;</p> 
 <p>import java.io.ObjectInputStream;</p> 
 <p>import java.io.OutputStream;</p> 
 <p>import java.io.PrintWriter;</p> 
 <p>import java.net.Socket;</p> 
 <p>import java.net.UnknownHostException;</p> 
 <p>public class Client {<!-- --></p> 
 <p>/**</p> 
 <p>* 客户端：向服务端发送文件</p> 
 <p>* 1、建立与服务器端的连接，</p> 
 <p>* 2、将文件的名字和大小通过自定义的文件传输协议，发送到服务器</p> 
 <p>* 3、循环读取本地文件，将文件打包发送到数据输出流中</p> 
 <p>* 4、关闭文件，结束传输</p> 
 <p>*</p> 
 <p>*/</p> 
 <p>public static void main(String[] args) throws UnknownHostException, IOException {<!-- --></p> 
 <p>String filename=null;</p> 
 <p>int filesize;</p> 
 <p>//1.指定要发送的文件，并确保文件存在</p> 
 <p>File sendfile = new File("C:\\Users\\Lbb\\Desktop\\API.CHM");</p> 
 <p>if(!sendfile.exists()){<!-- --></p> 
 <p>System.out.println("客户端：要发送的文件不存在");</p> 
 <p>}</p> 
 <p>//2.创建Socket实例，指定服务器的IP地址和端口号</p> 
 <p>Socket socket=new Socket("localhost",8235);</p> 
 <p>//3.向服务器发送文件的协议编码(/#)，文件名(/#)和文件大小的信息</p> 
 <p>FileInputStream fis=new FileInputStream(sendfile);</p> 
 <p>ObjectInputStream ois=new ObjectInputStream(fis);</p> 
 <p>filename=sendfile.getName();//获取文件名</p> 
 <p>filesize=ois.available();//获取文件的字节数(文件大小)</p> 
 <p>OutputStream os=socket.getOutputStream();</p> 
 <p>PrintWriter pw=new PrintWriter(os);</p> 
 <p>pw.write("111/#"+filename+"/#"+filesize);</p> 
 <p>pw.flush();</p> 
 <p>socket.shutdownOutput();</p> 
 <p>//4.向服务器传送文件的内容</p> 
 <p>byte[]data=new byte[ois.available()];</p> 
 <p>int len;</p> 
 <p>while((len=ois.read())!=-1){<!-- --></p> 
 <p>os.write(data, 0, len);</p> 
 <p>os.flush();</p> 
 <p>}</p> 
 <p>socket.close();</p> 
 <p>fis.close();</p> 
 <p>ois.close();</p> 
 <p>os.close();</p> 
 <p>pw.close();</p> 
 <p>}</p> 
 <p>}</p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b59c98e8687fbf7da1ffa1d81bace2a1/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">自制网站服务器,网站服务器制作</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/13a7a7adee5e1748ed5b3b63fc0d370d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">分布式架构之CAP理论</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>