<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Linux 启动流程 -- BIOS/UEFI &amp; bootloader &amp; kernel &amp; initramfs &amp; systemd - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Linux 启动流程 -- BIOS/UEFI &amp; bootloader &amp; kernel &amp; initramfs &amp; systemd" />
<meta property="og:description" content="Linux 启动流程 -- BIOS/UEFI &amp; bootloader &amp; kernel &amp; initramfs &amp; systemd 0. 概述1. BIOS/UEFI 启动阶段2. 内核引导阶段2.1 分区类型2.1.1 MS-DOS2.1.2 GPT 2.2 引导方式2.2.1 legacy &#43; mbr/ms-dos &#43; grub22.2.2 uefi &#43; grub2 3. 内核启动阶段4. systemd 启动阶段4.1 sysinit.target4.2 basic.target4.3 initrd.target4.4 switch-root4.5 multi-user.target 参考文档 最近重新整理了整个启动流程，可以参考 OpenCloudOS Stream 操作系统启动流程分析
0. 概述 从加电到出现登录界面，整个流程大致如下（基于 CentOS Linux release 8.2.2004 (Core)）：
BIOS/UEFI ==&gt; bootloader ==&gt; kernel ==&gt; initramfs ==&gt; systemd(initramfs) ==&gt; switch-root ==&gt; systemd(real rootfs)
可以将上述过程粗略的划分为四个阶段：
BIOS/UEFI 启动阶段内核引导阶段内核启动阶段服务启动阶段 1." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/77e46d35632d71272e4464b8bd8c0480/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-07T10:51:23+08:00" />
<meta property="article:modified_time" content="2023-12-07T10:51:23+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Linux 启动流程 -- BIOS/UEFI &amp; bootloader &amp; kernel &amp; initramfs &amp; systemd</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-github-gist">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>Linux 启动流程 -- BIOS/UEFI &amp; bootloader &amp; kernel &amp; initramfs &amp; systemd</h4> 
 <ul><li><a href="#0__3" rel="nofollow">0. 概述</a></li><li><a href="#1_BIOSUEFI__12" rel="nofollow">1. BIOS/UEFI 启动阶段</a></li><li><a href="#2__25" rel="nofollow">2. 内核引导阶段</a></li><li><ul><li><a href="#21__29" rel="nofollow">2.1 分区类型</a></li><li><ul><li><a href="#211_MSDOS_30" rel="nofollow">2.1.1 MS-DOS</a></li><li><a href="#212_GPT_92" rel="nofollow">2.1.2 GPT</a></li></ul> 
   </li><li><a href="#22__107" rel="nofollow">2.2 引导方式</a></li><li><ul><li><a href="#221_legacy__mbrmsdos__grub2_108" rel="nofollow">2.2.1 legacy + mbr/ms-dos + grub2</a></li><li><a href="#222_uefi__grub2_142" rel="nofollow">2.2.2 uefi + grub2</a></li></ul> 
  </li></ul> 
  </li><li><a href="#3__149" rel="nofollow">3. 内核启动阶段</a></li><li><a href="#4_systemd__202" rel="nofollow">4. systemd 启动阶段</a></li><li><ul><li><a href="#41_sysinittarget_227" rel="nofollow">4.1 sysinit.target</a></li><li><a href="#42_basictarget_374" rel="nofollow">4.2 basic.target</a></li><li><a href="#43_initrdtarget_378" rel="nofollow">4.3 initrd.target</a></li><li><a href="#44_switchroot_447" rel="nofollow">4.4 switch-root</a></li><li><a href="#45_multiusertarget_539" rel="nofollow">4.5 multi-user.target</a></li></ul> 
  </li><li><a href="#_605" rel="nofollow">参考文档</a></li></ul> 
</div> 
<p></p> 
<p><em><strong>最近重新整理了整个启动流程，可以参考 <a href="https://mp.weixin.qq.com/s/N_lSjtorg0Ho_hSBiM5uKA" rel="nofollow">OpenCloudOS Stream 操作系统启动流程分析</a></strong></em></p> 
<h2><a id="0__3"></a>0. 概述</h2> 
<p>从加电到出现登录界面，整个流程大致如下（基于 CentOS Linux release 8.2.2004 (Core)）：<br> <strong>BIOS/UEFI ==&gt; bootloader ==&gt; kernel ==&gt; initramfs ==&gt; systemd(initramfs) ==&gt; switch-root ==&gt; systemd(real rootfs)</strong></p> 
<p>可以将上述过程粗略的划分为四个阶段：</p> 
<ul><li><strong>BIOS/UEFI 启动阶段</strong></li><li><strong>内核引导阶段</strong></li><li><strong>内核启动阶段</strong></li><li><strong>服务启动阶段</strong></li></ul> 
<h2><a id="1_BIOSUEFI__12"></a>1. BIOS/UEFI 启动阶段</h2> 
<p>该阶段有两种引导方式：传统的 BIOS 模式（功能有限）以及UEFI 模式（功能丰富），核心功能大致是一些硬件启动前的检测，提供交互式界面来配置启动参数，加载 bootloader 到内存，并且将控制权交给 bootloader。</p> 
<ul><li><strong>启动方式</strong> 
  <ul><li><strong>BIOS</strong><br> 什么是 BIOS？BIOS 是机器加电后运行的第一个程序，保存在只读存储器（ROM）中。启动信息保存在 CMOS 芯片中，CMOS 是一个随机存储器（RAM）。</li><li><strong>UEFI</strong><br> 什么是 UEFI？UEFI 可以认为是增强版的 BIOS，能够识别文件系统，直接读取 bootloader 文件，而不用像 BIOS 一样，只能从启动盘第一个扇区读取 bootloader。</li></ul> </li><li><strong>主要功能</strong> 
  <ul><li><strong>POST (Power On Self Test)</strong></li><li><strong>加载 bootloader，并把控制权转交给 bootloader</strong></li></ul> </li></ul> 
<p>vmware 虚拟机可以设置启动方式，虚拟机设置 &gt; 选项 &gt; 高级 &gt; 固件类型，virtual box 也有类似设置：<br> <img src="https://images2.imgbox.com/ab/56/4TSOQfTt_o.png" alt="在这里插入图片描述" width="70%" height="%70"></p> 
<h2><a id="2__25"></a>2. 内核引导阶段</h2> 
<p>该阶段核心功能是加载内核镜像 vmlinuz 以及 initramfs 到内存，并将控制权交给内核。</p> 
<p>根据安装系统时启动方式的不同，系统启动盘分区格式会有所不同，默认是 BIOS/MS-DOS 和 UEFI/GPT 组合。如果采用 BIOS 启动方式安装 OS，启动盘将采用 MS-DOS 分区格式，可以通过在安装参数里添加 inst.gpt 来使用 GPT 分区，该种方式下，必须存在 biosboot 分区；如果采用 UEFI 方式安装，启动盘将采用 GPT 分区格式，UEFI 启动方式下，必须存在 efi 分区。</p> 
<h3><a id="21__29"></a>2.1 分区类型</h3> 
<h4><a id="211_MSDOS_30"></a>2.1.1 MS-DOS</h4> 
<ul><li> <p>MS-DOS 分区</p> <p>MBR（Master Boot Record, 主引导记录）。早期的 Linux 系统为了相容于 Windows 的磁盘，以支持 Windows 的 MBR 的方式来处理 bootloader 与 partion table。bootloader 与 partion table 都放在磁盘的第一个扇区，具体分布如下:<br> <img src="https://images2.imgbox.com/41/96/bBCV8Q6y_o.png" alt="MBR 分区表" width="50%" height="50%"></p> 
  <ul><li> <p>第一部分记录部分 bootloader，共446B</p> </li><li> <p>第二部分记录分区表，共 64B，最多记录 4 个分区信息</p> </li><li> <p>第三部分记录 MBR 标记，内容是 55AA，共 2 B</p> </li></ul> </li></ul> 
<pre><code class="prism language-bash"><span class="token comment"># hexdump 可以查看磁盘上指定地址的内容，下面是 BIOS 方式下启动盘前 512 字节的内容</span>
<span class="token punctuation">[</span>root@localhost rootfs<span class="token punctuation">]</span><span class="token comment"># hexdump -C -n 512 /dev/sda</span>
00000000  eb <span class="token number">63</span> <span class="token number">90</span> <span class="token number">10</span> 8e d0 <span class="token function">bc</span> 00  b0 b8 00 00 8e d8 8e c0  <span class="token operator">|</span>.c<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token operator">|</span>
00000010  fb be 00 7c bf 00 06 b9  00 02 f3 a4 ea <span class="token number">21</span> 06 00  <span class="token operator">|</span><span class="token punctuation">..</span>.<span class="token operator">|</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.<span class="token operator">!</span><span class="token punctuation">..</span><span class="token operator">|</span>
00000020  00 be be 07 <span class="token number">38</span> 04 <span class="token number">75</span> 0b  <span class="token number">83</span> c6 <span class="token number">10</span> <span class="token number">81</span> fe fe 07 <span class="token number">75</span>  <span class="token operator">|</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token number">8</span>.u<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>u<span class="token operator">|</span>
00000030  f3 eb <span class="token number">16</span> b4 02 b0 01 bb  00 7c b2 <span class="token number">80</span> 8a <span class="token number">74</span> 01 8b  <span class="token operator">|</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.<span class="token operator">|</span><span class="token punctuation">..</span>.t<span class="token punctuation">..</span><span class="token operator">|</span>
00000040  4c 02 <span class="token builtin class-name">cd</span> <span class="token number">13</span> ea 00 7c 00  00 eb fe 00 00 00 00 00  <span class="token operator">|</span>L<span class="token punctuation">..</span><span class="token punctuation">..</span>.<span class="token operator">|</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.<span class="token operator">|</span>
00000050  00 00 00 00 00 00 00 00  00 00 00 <span class="token number">80</span> 01 00 00 00  <span class="token operator">|</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token operator">|</span>
00000060  00 00 00 00 ff fa <span class="token number">90</span> <span class="token number">90</span>  f6 c2 <span class="token number">80</span> <span class="token number">74</span> 05 f6 c2 <span class="token number">70</span>  <span class="token operator">|</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.t<span class="token punctuation">..</span>.p<span class="token operator">|</span>
00000070  <span class="token number">74</span> 02 b2 <span class="token number">80</span> ea <span class="token number">79</span> 7c 00  00 <span class="token number">31</span> c0 8e d8 8e d0 <span class="token function">bc</span>  <span class="token operator">|</span>t<span class="token punctuation">..</span><span class="token punctuation">..</span>y<span class="token operator">|</span><span class="token punctuation">..</span><span class="token number">1</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token operator">|</span>
00000080  00 <span class="token number">20</span> fb a0 <span class="token number">64</span> 7c 3c ff  <span class="token number">74</span> 02 <span class="token number">88</span> c2 <span class="token number">52</span> be 05 7c  <span class="token operator">|</span><span class="token builtin class-name">.</span> <span class="token punctuation">..</span>d<span class="token operator">|</span><span class="token operator">&lt;</span>.t<span class="token punctuation">..</span>.R<span class="token punctuation">..</span><span class="token operator">||</span>
00000090  b4 <span class="token number">41</span> bb aa <span class="token number">55</span> <span class="token builtin class-name">cd</span> <span class="token number">13</span> 5a  <span class="token number">52</span> <span class="token number">72</span> 3d <span class="token number">81</span> fb <span class="token number">55</span> aa <span class="token number">75</span>  <span class="token operator">|</span>.A<span class="token punctuation">..</span>U<span class="token punctuation">..</span>ZRr<span class="token operator">=</span><span class="token punctuation">..</span>U.u<span class="token operator">|</span>
000000a0  <span class="token number">37</span> <span class="token number">83</span> e1 01 <span class="token number">74</span> <span class="token number">32</span> <span class="token number">31</span> c0  <span class="token number">89</span> <span class="token number">44</span> 04 <span class="token number">40</span> <span class="token number">88</span> <span class="token number">44</span> ff <span class="token number">89</span>  <span class="token operator">|</span><span class="token number">7</span><span class="token punctuation">..</span>.t21<span class="token punctuation">..</span>D.@.D<span class="token punctuation">..</span><span class="token operator">|</span>
000000b0  <span class="token number">44</span> 02 c7 04 <span class="token number">10</span> 00 <span class="token number">66</span> 8b  1e 5c 7c <span class="token number">66</span> <span class="token number">89</span> 5c 08 <span class="token number">66</span>  <span class="token operator">|</span>D<span class="token punctuation">..</span><span class="token punctuation">..</span>.f<span class="token punctuation">..</span><span class="token punctuation">\</span><span class="token operator">|</span>f.<span class="token punctuation">\</span>.f<span class="token operator">|</span>
000000c0  8b 1e <span class="token number">60</span> 7c <span class="token number">66</span> <span class="token number">89</span> 5c 0c  c7 <span class="token number">44</span> 06 00 <span class="token number">70</span> b4 <span class="token number">42</span> <span class="token builtin class-name">cd</span>  <span class="token operator">|</span><span class="token punctuation">..</span><span class="token variable"><span class="token variable">`</span><span class="token operator">|</span>f.<span class="token punctuation">\</span><span class="token punctuation">..</span>D<span class="token punctuation">..</span>p.B.<span class="token operator">|</span>
000000d0  <span class="token number">13</span> <span class="token number">72</span> 05 bb 00 <span class="token number">70</span> eb <span class="token number">76</span>  b4 08 <span class="token builtin class-name">cd</span> <span class="token number">13</span> <span class="token number">73</span> 0d 5a <span class="token number">84</span>  <span class="token operator">|</span>.r<span class="token punctuation">..</span>.p.v<span class="token punctuation">..</span><span class="token punctuation">..</span>s.Z.<span class="token operator">|</span>
000000e0  d2 0f <span class="token number">83</span> de 00 be <span class="token number">85</span> 7d  e9 <span class="token number">82</span> 00 <span class="token number">66</span> 0f b6 c6 <span class="token number">88</span>  <span class="token operator">|</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.<span class="token punctuation">}</span><span class="token punctuation">..</span>.f<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token operator">|</span>
000000f0  <span class="token number">64</span> ff <span class="token number">40</span> <span class="token number">66</span> <span class="token number">89</span> <span class="token number">44</span> 04 0f  b6 d1 c1 e2 02 <span class="token number">88</span> e8 <span class="token number">88</span>  <span class="token operator">|</span>d.@f.D<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token operator">|</span>
00000100  f4 <span class="token number">40</span> <span class="token number">89</span> <span class="token number">44</span> 08 0f b6 c2  c0 e8 02 <span class="token number">66</span> <span class="token number">89</span> 04 <span class="token number">66</span> a1  <span class="token operator">|</span>.@.D<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.f<span class="token punctuation">..</span>f.<span class="token operator">|</span>
00000110  <span class="token number">60</span> 7c <span class="token number">66</span> 09 c0 <span class="token number">75</span> 4e <span class="token number">66</span>  a1 5c 7c <span class="token number">66</span> <span class="token number">31</span> d2 <span class="token number">66</span> f7  <span class="token operator">|</span><span class="token variable">`</span></span><span class="token operator">|</span>f<span class="token punctuation">..</span>uNf.<span class="token punctuation">\</span><span class="token operator">|</span>f1.f.<span class="token operator">|</span>
00000120  <span class="token number">34</span> <span class="token number">88</span> d1 <span class="token number">31</span> d2 <span class="token number">66</span> f7 <span class="token number">74</span>  04 3b <span class="token number">44</span> 08 7d <span class="token number">37</span> fe c1  <span class="token operator">|</span><span class="token number">4</span><span class="token punctuation">..</span><span class="token number">1</span>.f.t.<span class="token punctuation">;</span>D.<span class="token punctuation">}</span><span class="token number">7</span><span class="token punctuation">..</span><span class="token operator">|</span>
00000130  <span class="token number">88</span> c5 <span class="token number">30</span> c0 c1 e8 02 08  c1 <span class="token number">88</span> d0 5a <span class="token number">88</span> c6 bb 00  <span class="token operator">|</span><span class="token punctuation">..</span><span class="token number">0</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>Z<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token operator">|</span>
00000140  <span class="token number">70</span> 8e c3 <span class="token number">31</span> db b8 01 02  <span class="token builtin class-name">cd</span> <span class="token number">13</span> <span class="token number">72</span> 1e 8c c3 <span class="token number">60</span> 1e  <span class="token operator">|</span>p<span class="token punctuation">..</span><span class="token number">1</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>r<span class="token punctuation">..</span>.`.<span class="token operator">|</span>
00000150  b9 00 01 8e db <span class="token number">31</span> f6 bf  00 <span class="token number">80</span> 8e c6 fc f3 a5 1f  <span class="token operator">|</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.1<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token operator">|</span>
00000160  <span class="token number">61</span> ff <span class="token number">26</span> 5a 7c be <span class="token number">80</span> 7d  eb 03 be 8f 7d e8 <span class="token number">34</span> 00  <span class="token operator">|</span>a.<span class="token operator">&amp;</span>Z<span class="token operator">|</span><span class="token punctuation">..</span><span class="token punctuation">}</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">}</span>.4.<span class="token operator">|</span>
00000170  be <span class="token number">94</span> 7d e8 2e 00 <span class="token builtin class-name">cd</span> <span class="token number">18</span>  eb fe <span class="token number">47</span> <span class="token number">52</span> <span class="token number">55</span> <span class="token number">42</span> <span class="token number">20</span> 00  <span class="token operator">|</span><span class="token punctuation">..</span><span class="token punctuation">}</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.GRUB <span class="token builtin class-name">.</span><span class="token operator">|</span>
00000180  <span class="token number">47</span> <span class="token number">65</span> 6f 6d 00 <span class="token number">48</span> <span class="token number">61</span> <span class="token number">72</span>  <span class="token number">64</span> <span class="token number">20</span> <span class="token number">44</span> <span class="token number">69</span> <span class="token number">73</span> 6b 00 <span class="token number">52</span>  <span class="token operator">|</span>Geom.Hard Disk.R<span class="token operator">|</span>
00000190  <span class="token number">65</span> <span class="token number">61</span> <span class="token number">64</span> 00 <span class="token number">20</span> <span class="token number">45</span> <span class="token number">72</span> <span class="token number">72</span>  6f <span class="token number">72</span> 0d 0a 00 bb 01 00  <span class="token operator">|</span>ead. Error<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token operator">|</span>
000001a0  b4 0e <span class="token builtin class-name">cd</span> <span class="token number">10</span> ac 3c 00 <span class="token number">75</span>  f4 c3 00 00 00 00 00 00  <span class="token operator">|</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.<span class="token operator">&lt;</span>.u<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token operator">|</span>
000001b0  00 00 00 00 00 00 00 00  f3 bb <span class="token number">74</span> a1 00 00 <span class="token number">80</span> 04  <span class="token operator">|</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>t<span class="token punctuation">..</span><span class="token punctuation">..</span>.<span class="token operator">|</span>
000001c0  01 04 <span class="token number">83</span> fe c2 ff 00 08  00 00 00 a0 0f 00 00 fe  <span class="token operator">|</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token operator">|</span>
000001d0  c2 ff <span class="token number">83</span> fe c2 ff 00 a8  0f 00 00 <span class="token number">58</span> <span class="token number">30</span> 06 00 00  <span class="token operator">|</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.X0<span class="token punctuation">..</span>.<span class="token operator">|</span>
000001e0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  <span class="token operator">|</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token operator">|</span>
000001f0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 <span class="token number">55</span> aa  <span class="token operator">|</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>U.<span class="token operator">|</span>
</code></pre> 
<ul><li> <p>MS-DOS 分区表有主分区、扩展分区和逻辑分区的概念：</p> 
  <ul><li>主分区和扩展分区最多只能有四个</li><li>扩展分区最多只能有一个，可以没有</li><li>逻辑分区建立在扩展分区之上</li><li>主分区和逻辑分区可以创建文件系统，扩展分区不可以</li></ul> </li><li> <p>MS-DOS 分区的缺陷：</p> 
  <ul><li> <p>由于分区表位数的限制，OS 无法获取 2.2T 以上的磁盘容量</p> </li><li> <p>MBR只有一个扇区，且只有一份，破坏后，很难恢复</p> </li><li> <p>bootloader 只有 446 字节，无法容纳较多的程序代码</p> </li></ul> </li></ul> 
<h4><a id="212_GPT_92"></a>2.1.2 GPT</h4> 
<ul><li> <p>GPT 分区</p> <p>GPT 为了处理大硬盘，使用 LBA 编址，每个 LBA 512B。原来 MBR 占用的第一个 sector 现在是 LBA0。GPT 使用了 34 个 LBA 区块来纪录分区信息！与 MBR 仅有一的区块， GPT 除了前面 34 个 LBA 之外，整个磁盘的最后 33 个 LBA 也拿来作为另一个备份。具体结构如下：<br> <img src="https://images2.imgbox.com/20/59/WF3a1fib_o.png" alt="在这里插入图片描述" width="55%" height="%55"></p> 
  <ul><li>LBA0 (MBR 兼容区块) 与 MBR 模式相近，前 446B 还是 bootloader（UEFI 模式下，bootloader 不放在此部分），后 66B 换成一个特殊标记，用于表明此磁盘是 GPT 分区</li><li>LBA1 (GPT 表头记录) 记录分区表本身的位置与大小，备份分区放置的位置， 以及校验码 (CRC32)</li><li>LBA(2~33) (实际记录分区信息) 从 LBA2 区块开始，每个 LBA 都可以纪录 4 个分区纪录，所以在默认的情况下，总共可以有 4*32 = 128 个分区记录</li><li>LBA(-1) GPT 表头记录的备份</li><li>LBA(-33 ~ -2) 分区信息备份</li></ul> </li></ul> 
<h3><a id="22__107"></a>2.2 引导方式</h3> 
<h4><a id="221_legacy__mbrmsdos__grub2_108"></a>2.2.1 legacy + mbr/ms-dos + grub2</h4> 
<p>引导过程如下：<br> <strong>boot.img(mbr 446B) ==&gt; diskboot.img ==&gt; kernel.img，通过 /boot/grub2/grub.cfg 找到 vmlinuz 和 initramfs</strong></p> 
<p>上述 boot.img、diskboot.img 和 kernel.img 都是 bootloader的一部分，他们被硬编码到启动盘上，不是以文件的形式存在于文件系统中。<br> <img src="https://images2.imgbox.com/31/df/OTNCxFou_o.png" alt="在这里插入图片描述"></p> 
<ul><li> <p>boot.img</p> <p>在 BIOS 平台下，boot.img 是 grub 启动的第一个 img 文件，它被写入到MBR中或分区的boot sector中，因为 boot sector 的大小是512字节，所以该 img 文件的大小也是 512 字节。</p> <p>boot.img 唯一的作用是读取属于 core.img 的第一个扇区并跳转到它身上，将控制权交给该扇区的 img。由于体积大小的限制，boot.img 无法理解文件系统的结构，因此 grub2-install 将会把 core.img 的位置硬编码到 boot.img 中，这样就一定能找到 core.img 的位置。</p> </li><li> <p>core.img</p> <p>core.img 根据 diskboot.img、kernel.img 和一系列的模块被 grub2-mkimage 程序动态创建。core.img 中嵌入了足够多的功能模块以保证 grub 能访问 /boot/grub2，并且可以加载相关的模块实现相关的功能，例如加载启动菜单、加载目标操作系统的信息等，由于 grub2 大量使用了动态功能模块，使得 core.img 体积变得足够小。</p> <p>core.img 中包含了多个 img 文件的内容，包括 diskboot.img/kernel.img 等。</p> 
  <ul><li> <p>diskboot.img</p> <p>如果启动设备是硬盘，即从硬盘启动时，core.img 中的第一个扇区的内容就是 diskboot.img。diskboot.img 的作用是读取 core.img 中剩余的部分到内存中，并将控制权交给 kernel.img，由于此时还不识别文件系统，所以将 core.img 的全部位置以 block 列表的方式编码，使得 diskboot.img 能够找到剩余的内容。</p> <p>该img文件因为占用一个扇区，所以体积为512字节。</p> </li><li> <p>kernel.img</p> <p>kernel.img 文件包含了 grub 的基本运行时环境：设备框架、文件句柄、环境变量、救援模式下的命令行解析器等等。很少直接使用它，因为它们已经整个嵌入到了 core.img 中了。注意，kernel.img 是 grub 的 kernel，和操作系统的内核无关。</p> <p>如果细心的话，会发现 kernel.img 本身就占用 28KB 空间，但嵌入到了 core.img 中后，core.img 文件才只有 26KB 大小。这是因为 core.img 中的 kernel.img 是被压缩过的。</p> </li></ul> </li><li> <p>*.mod</p> <p>各种功能模块，部分模块已经嵌入到 core.img 中，或者会被 grub 自动加载，但有时也需要使用 insmod 命令手动加载。</p> </li></ul> 
<h4><a id="222_uefi__grub2_142"></a>2.2.2 uefi + grub2</h4> 
<p>引导方式如下：<br> <strong>x86_64: uefi ==&gt; shimx64.efi ==&gt; grubx64.efi ==&gt; /boot/efi/EFI/centos/grub.cfg ==&gt; vmlinuz &amp; initramfs</strong><br> <strong>aarch64: uefi ==&gt; shimaa64.efi ==&gt; grubaa64.efi ==&gt; /boot/efi/EFI/centos/grub.cfg ==&gt; vmlinuz &amp; initramfs</strong></p> 
<p>x86 架构系统中，shimx64.efi 和 grubx64.efi 是 UEFI 启动方式下的 bootloader，他们以文件的形式存在于磁盘的 /boot/efi/EFI/centos 目录下，UEFI 可以直接识别文件系统，并获取 shimx64.efi 加载到内存运行，然后 shimx64.efi 获取 grubx64.efi，grubx64.efi 则通过 grub.cfg 寻找 vmlinuz 和 initfamfs，并将其加载到内存中。arm 架构系统过程类似。</p> 
<h2><a id="3__149"></a>3. 内核启动阶段</h2> 
<p>内核启动过程比较复杂，未深入研究，以后有时间研究再整理。为了启动用户态服务，内核需要做的一些工作如下：</p> 
<ul><li><strong>解压 vmlinuz，运行内核镜像</strong></li><li><strong>创建 rootfs，并挂在到 /，解压 initramfs 到 / （内存文件系统）</strong></li><li><strong>执行 init 进程，此时的 init 为 initramfs 中的 init，在内存文件系统根目录下，指向 systemd</strong></li></ul> 
<p>上述过程内核代码流程如下（基于 4.19.112 内核）：</p> 
<pre><code class="prism language-c"><span class="token function">start_kernel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// init/main.c</span>
<span class="token operator">|</span>── <span class="token function">vfs_caches_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">|</span>	└── <span class="token function">mnt_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">|</span>		<span class="token operator">|</span>── <span class="token function">init_rootfs</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">|</span>		<span class="token operator">|</span>	<span class="token operator">|</span>── <span class="token function">register_filesystem</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>rootfs_fs_type<span class="token punctuation">)</span>
<span class="token operator">|</span>		<span class="token operator">|</span>	└── <span class="token function">init_ramfs_fs</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">|</span>		<span class="token operator">|</span>		└── <span class="token function">register_filesystem</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ramfs_fs_type<span class="token punctuation">)</span>
<span class="token operator">|</span>	    └── <span class="token function">init_mount_tree</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">|</span>			<span class="token operator">|</span>── init_task<span class="token punctuation">.</span>nsproxy<span class="token operator">-&gt;</span>mnt_ns <span class="token operator">=</span> ns
<span class="token operator">|</span>			<span class="token operator">|</span>── <span class="token function">set_fs_pwd</span><span class="token punctuation">(</span>current<span class="token operator">-&gt;</span>fs<span class="token punctuation">,</span> <span class="token operator">&amp;</span>root<span class="token punctuation">)</span>
<span class="token operator">|</span>			└── <span class="token function">set_fs_root</span><span class="token punctuation">(</span>current<span class="token operator">-&gt;</span>fs<span class="token punctuation">,</span> <span class="token operator">&amp;</span>root<span class="token punctuation">)</span>
└── <span class="token function">rest_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	└── <span class="token function">kernel_thread</span><span class="token punctuation">(</span>kernel_init<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> CLONE_FS<span class="token punctuation">)</span>
		└── <span class="token function">kernel_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token operator">|</span>── <span class="token function">kernel_init_freeable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token operator">|</span>	<span class="token operator">|</span>── <span class="token function">do_basic_setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token operator">|</span>	<span class="token operator">|</span>	└── <span class="token function">do_initcalls</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
			<span class="token operator">|</span>	<span class="token operator">|</span>		└── <span class="token function">populate_rootfs</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token operator">|</span>	<span class="token operator">|</span>			└── <span class="token function">unpack_to_rootfs</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>initrd_start<span class="token punctuation">,</span> initrd_end <span class="token operator">-</span> initrd_start<span class="token punctuation">)</span> 
			<span class="token operator">|</span>	└── ramdisk_execute_command <span class="token operator">=</span> <span class="token string">"/init"</span>
			└── <span class="token function">run_init_process</span><span class="token punctuation">(</span>ramdisk_execute_command<span class="token punctuation">)</span>
</code></pre> 
<p>initramfs 中的内容如下：</p> 
<pre><code class="prism language-bash"><span class="token comment"># initramfs 可以通过如下命令解压</span>
<span class="token punctuation">[</span>root@localhost rootfs<span class="token punctuation">]</span><span class="token comment"># /usr/lib/dracut/skipcpio /boot/initramfs-4.18.0-193.el8.x86_64.img | zcat | cpio -divm</span>
<span class="token punctuation">[</span>root@localhost rootfs<span class="token punctuation">]</span><span class="token comment"># ll</span>
total <span class="token number">44</span>
lrwxrwxrwx.  <span class="token number">1</span> root root    <span class="token number">7</span> Jul  <span class="token number">3</span> <span class="token number">19</span>:13 bin -<span class="token operator">&gt;</span> usr/bin
drwxr-xr-x.  <span class="token number">2</span> root root <span class="token number">4096</span> Jul  <span class="token number">3</span> <span class="token number">19</span>:13 dev
drwxr-xr-x. <span class="token number">11</span> root root <span class="token number">4096</span> Jul  <span class="token number">3</span> <span class="token number">19</span>:13 etc
lrwxrwxrwx.  <span class="token number">1</span> root root   <span class="token number">23</span> Jul  <span class="token number">3</span> <span class="token number">19</span>:13 init -<span class="token operator">&gt;</span> usr/lib/systemd/systemd
lrwxrwxrwx.  <span class="token number">1</span> root root    <span class="token number">7</span> Jul  <span class="token number">3</span> <span class="token number">19</span>:13 lib -<span class="token operator">&gt;</span> usr/lib
lrwxrwxrwx.  <span class="token number">1</span> root root    <span class="token number">9</span> Jul  <span class="token number">3</span> <span class="token number">19</span>:13 lib64 -<span class="token operator">&gt;</span> usr/lib64
drwxr-xr-x.  <span class="token number">2</span> root root <span class="token number">4096</span> Apr <span class="token number">24</span> <span class="token number">11</span>:24 proc
drwxr-xr-x.  <span class="token number">2</span> root root <span class="token number">4096</span> Apr <span class="token number">24</span> <span class="token number">11</span>:24 root
drwxr-xr-x.  <span class="token number">2</span> root root <span class="token number">4096</span> Apr <span class="token number">24</span> <span class="token number">11</span>:24 run
lrwxrwxrwx.  <span class="token number">1</span> root root    <span class="token number">8</span> Jul  <span class="token number">3</span> <span class="token number">19</span>:13 sbin -<span class="token operator">&gt;</span> usr/sbin
-rwxr-xr-x.  <span class="token number">1</span> root root <span class="token number">3126</span> Oct  <span class="token number">8</span>  <span class="token number">2018</span> <span class="token function">shutdown</span>
drwxr-xr-x.  <span class="token number">2</span> root root <span class="token number">4096</span> Apr <span class="token number">24</span> <span class="token number">11</span>:24 sys
drwxr-xr-x.  <span class="token number">2</span> root root <span class="token number">4096</span> Apr <span class="token number">24</span> <span class="token number">11</span>:24 sysroot
drwxr-xr-x.  <span class="token number">2</span> root root <span class="token number">4096</span> Apr <span class="token number">24</span> <span class="token number">11</span>:24 tmp
drwxr-xr-x.  <span class="token number">7</span> root root <span class="token number">4096</span> Jul  <span class="token number">3</span> <span class="token number">19</span>:13 usr
</code></pre> 
<p>从 initramfs 解压的内容中可以看出，这就是一个小型的根文件系统，其中，init 是指向 usr/lib/systemd/systemd 的软连接。</p> 
<h2><a id="4_systemd__202"></a>4. systemd 启动阶段</h2> 
<p>该阶段主要启动一些用户态服务。</p> 
<p>由于大部分用户态服务涉及的可执行文件以及配置文件都在根文件系统中，需要挂载根文件系统；若要识别根文件系统，又需要加载磁盘驱动，而磁盘驱动也位于根文件系统中，形成死锁。</p> 
<p>对于上述问题，主流 OS 发行版的做法都是通过 initramfs 方式，就是将一些必要的驱动和用户态工具打包到 initramfs 中，然后通过 initramfs 启动，必要的初始化后，再切换到真实的根文件系统，过程如下：</p> 
<ul><li>grub2 程序根据 grub.cfg 文件找到并加载 vmlinuz 和 iniramfs 到内存，并把地址告诉内核；</li><li>内核自解压，并开始执行；</li><li>内核启动到一定阶段，会在内存中创建根文件 rootfs，并将其挂载到 / 下；</li><li>内核将 initramfs 解压到 / 下；</li><li>内核执行 /init 即 systemd ；</li><li>systemd 拉起各种初始化服务，完成真实根文件系统的识别与挂载；</li><li>切换到真实根文件系统，调用真实根文件系统的 systemd，重新启动 systemd 进程 ；</li><li>systemd 继续拉起各种用户服务，包括登录服务和终端服务等。</li></ul> 
<p>systemd 是通过 target 的方式来完成各种服务的启动，具体流程如下：<br> <strong>sysinit.target ==&gt; basic.target ==&gt; initrd.target ==&gt; switch-root ==&gt; multi-user.target</strong></p> 
<p>上述流程中可以看到关键的步骤 switch-root，switch-root 之前运行的服务都来自 initramfs，switch-root 之后运行的服务都来自真实根文件系统。</p> 
<p>sysinit.target、basic.target 和 initrd.target 中涉及的一些 dracut 服务是启动过程中一些关键的启动点，可以通过在启动参数里添加 rd.break 启动参数，在这些点停下来，部分可以进入shell，具体可以查看 <a href="https://man7.org/linux/man-pages/man7/dracut.cmdline.7.html" rel="nofollow">10. dracut.cmdline(7) — Linux manual page</a> 。</p> 
<p>switch-root 之前的初始启动日志会打印 <strong>Welcome to CentOS Linux 8 (Core) dracut-049-70.git20200228.el8 (Initramfs)!</strong>，该内容来自 initramfs 中的 /etc/initrd-release，systemd 也正是通过这个文件判断是否运行在 initramfs 中。<br> <img src="https://images2.imgbox.com/bc/7c/0357eIhr_o.png" alt="在这里插入图片描述"><br> switch-root 之后启动日志中会打印 <strong>Welcome to CentOS Linux 8 (Core)!</strong>（过程太快，这里没有截到图，想从串口查看日志，vmware 设置串口没有成功）。</p> 
<h3><a id="41_sysinittarget_227"></a>4.1 sysinit.target</h3> 
<p><img src="https://images2.imgbox.com/ba/5c/aUIBgt5T_o.png" alt="在这里插入图片描述"><br> sysinit.target 主要完成一些初始化工作。</p> 
<ul><li>dracut-cmdline.service</li></ul> 
<pre><code class="prism language-bash"><span class="token comment"># /usr/lib/systemd/system/../../dracut/modules.d/98dracut-systemd/dracut-cmdline.service</span>
<span class="token comment">#  This file is part of dracut.</span>
<span class="token comment">#</span>
<span class="token comment"># See dracut.bootup(7) for details</span>

<span class="token punctuation">[</span>Unit<span class="token punctuation">]</span>
<span class="token assign-left variable">Description</span><span class="token operator">=</span>dracut cmdline hook
<span class="token assign-left variable">Documentation</span><span class="token operator">=</span>man:dracut-cmdline.service<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>
<span class="token assign-left variable">DefaultDependencies</span><span class="token operator">=</span>no
<span class="token assign-left variable">Before</span><span class="token operator">=</span>dracut-pre-udev.service
<span class="token assign-left variable">After</span><span class="token operator">=</span>systemd-journald.socket
<span class="token assign-left variable">Wants</span><span class="token operator">=</span>systemd-journald.socket
<span class="token assign-left variable">ConditionPathExists</span><span class="token operator">=</span>/usr/lib/initrd-release
<span class="token assign-left variable">ConditionPathExistsGlob</span><span class="token operator">=</span><span class="token operator">|</span>/etc/cmdline.d/*.conf
<span class="token assign-left variable">ConditionDirectoryNotEmpty</span><span class="token operator">=</span><span class="token operator">|</span>/lib/dracut/hooks/cmdline
<span class="token assign-left variable">ConditionKernelCommandLine</span><span class="token operator">=</span><span class="token operator">|</span><span class="token assign-left variable">rd.break</span><span class="token operator">=</span>cmdline
<span class="token assign-left variable">ConditionKernelCommandLine</span><span class="token operator">=</span><span class="token operator">|</span>resume
<span class="token assign-left variable">ConditionKernelCommandLine</span><span class="token operator">=</span><span class="token operator">|</span>noresume
<span class="token assign-left variable">Conflicts</span><span class="token operator">=</span>shutdown.target emergency.target

<span class="token punctuation">[</span>Service<span class="token punctuation">]</span>
<span class="token assign-left variable">Environment</span><span class="token operator">=</span>DRACUT_SYSTEMD<span class="token operator">=</span><span class="token number">1</span>
<span class="token assign-left variable">Environment</span><span class="token operator">=</span>NEWROOT<span class="token operator">=</span>/sysroot
<span class="token assign-left variable">Type</span><span class="token operator">=</span>oneshot
<span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>-/bin/dracut-cmdline
<span class="token assign-left variable">StandardInput</span><span class="token operator">=</span>null
<span class="token assign-left variable">StandardOutput</span><span class="token operator">=</span>syslog
<span class="token assign-left variable">StandardError</span><span class="token operator">=</span>syslog+console
<span class="token assign-left variable">KillMode</span><span class="token operator">=</span>process
<span class="token assign-left variable">RemainAfterExit</span><span class="token operator">=</span>yes

<span class="token comment"># Bash ignores SIGTERM, so we send SIGHUP instead, to ensure that bash</span>
<span class="token comment"># terminates cleanly.</span>
<span class="token assign-left variable">KillSignal</span><span class="token operator">=</span>SIGHUP
</code></pre> 
<ul><li>dracut-pre-udev.service</li></ul> 
<pre><code class="prism language-bash"><span class="token comment"># /usr/lib/systemd/system/../../dracut/modules.d/98dracut-systemd/dracut-pre-udev.service</span>
<span class="token comment">#  This file is part of dracut.</span>
<span class="token comment">#</span>
<span class="token comment"># See dracut.bootup(7) for details</span>

<span class="token punctuation">[</span>Unit<span class="token punctuation">]</span>
<span class="token assign-left variable">Description</span><span class="token operator">=</span>dracut pre-udev hook
<span class="token assign-left variable">Documentation</span><span class="token operator">=</span>man:dracut-pre-udev.service<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>
<span class="token assign-left variable">DefaultDependencies</span><span class="token operator">=</span>no
<span class="token assign-left variable">Before</span><span class="token operator">=</span>systemd-udevd.service dracut-pre-trigger.service
<span class="token assign-left variable">After</span><span class="token operator">=</span>dracut-cmdline.service
<span class="token assign-left variable">Wants</span><span class="token operator">=</span>dracut-cmdline.service
<span class="token assign-left variable">ConditionPathExists</span><span class="token operator">=</span>/usr/lib/initrd-release
<span class="token assign-left variable">ConditionDirectoryNotEmpty</span><span class="token operator">=</span><span class="token operator">|</span>/lib/dracut/hooks/pre-udev
<span class="token assign-left variable">ConditionKernelCommandLine</span><span class="token operator">=</span><span class="token operator">|</span><span class="token assign-left variable">rd.break</span><span class="token operator">=</span>pre-udev
<span class="token assign-left variable">ConditionKernelCommandLine</span><span class="token operator">=</span><span class="token operator">|</span>rd.driver.blacklist
<span class="token assign-left variable">ConditionKernelCommandLine</span><span class="token operator">=</span><span class="token operator">|</span>rd.driver.pre
<span class="token assign-left variable">ConditionKernelCommandLine</span><span class="token operator">=</span><span class="token operator">|</span>rd.driver.post
<span class="token assign-left variable">ConditionPathExistsGlob</span><span class="token operator">=</span><span class="token operator">|</span>/etc/cmdline.d/*.conf
<span class="token assign-left variable">Conflicts</span><span class="token operator">=</span>shutdown.target emergency.target

<span class="token punctuation">[</span>Service<span class="token punctuation">]</span>
<span class="token assign-left variable">Environment</span><span class="token operator">=</span>DRACUT_SYSTEMD<span class="token operator">=</span><span class="token number">1</span>
<span class="token assign-left variable">Environment</span><span class="token operator">=</span>NEWROOT<span class="token operator">=</span>/sysroot
<span class="token assign-left variable">Type</span><span class="token operator">=</span>oneshot
<span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>-/bin/dracut-pre-udev
<span class="token assign-left variable">StandardInput</span><span class="token operator">=</span>null
<span class="token assign-left variable">StandardOutput</span><span class="token operator">=</span>syslog
<span class="token assign-left variable">StandardError</span><span class="token operator">=</span>syslog+console
<span class="token assign-left variable">KillMode</span><span class="token operator">=</span>process
<span class="token assign-left variable">RemainAfterExit</span><span class="token operator">=</span>yes

<span class="token comment"># Bash ignores SIGTERM, so we send SIGHUP instead, to ensure that bash</span>
<span class="token comment"># terminates cleanly.</span>
<span class="token assign-left variable">KillSignal</span><span class="token operator">=</span>SIGHUP
</code></pre> 
<ul><li>dracut-pre-trigger.service</li></ul> 
<pre><code class="prism language-bash"><span class="token comment"># /usr/lib/systemd/system/../../dracut/modules.d/98dracut-systemd/dracut-pre-trigger.service</span>
<span class="token comment">#  This file is part of dracut.</span>
<span class="token comment">#</span>
<span class="token comment"># See dracut.bootup(7) for details</span>

<span class="token punctuation">[</span>Unit<span class="token punctuation">]</span>
<span class="token assign-left variable">Description</span><span class="token operator">=</span>dracut pre-trigger hook
<span class="token assign-left variable">Documentation</span><span class="token operator">=</span>man:dracut-pre-trigger.service<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>
<span class="token assign-left variable">DefaultDependencies</span><span class="token operator">=</span>no
<span class="token assign-left variable">Before</span><span class="token operator">=</span>systemd-udev-trigger.service dracut-initqueue.service
<span class="token assign-left variable">After</span><span class="token operator">=</span>dracut-pre-udev.service systemd-udevd.service systemd-tmpfiles-setup-dev.service
<span class="token assign-left variable">Wants</span><span class="token operator">=</span>dracut-pre-udev.service systemd-udevd.service
<span class="token assign-left variable">ConditionPathExists</span><span class="token operator">=</span>/usr/lib/initrd-release
<span class="token assign-left variable">ConditionDirectoryNotEmpty</span><span class="token operator">=</span><span class="token operator">|</span>/lib/dracut/hooks/pre-trigger
<span class="token assign-left variable">ConditionKernelCommandLine</span><span class="token operator">=</span><span class="token operator">|</span><span class="token assign-left variable">rd.break</span><span class="token operator">=</span>pre-trigger
<span class="token assign-left variable">Conflicts</span><span class="token operator">=</span>shutdown.target emergency.target

<span class="token punctuation">[</span>Service<span class="token punctuation">]</span>
<span class="token assign-left variable">Environment</span><span class="token operator">=</span>DRACUT_SYSTEMD<span class="token operator">=</span><span class="token number">1</span>
<span class="token assign-left variable">Environment</span><span class="token operator">=</span>NEWROOT<span class="token operator">=</span>/sysroot
<span class="token assign-left variable">Type</span><span class="token operator">=</span>oneshot
<span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>-/bin/dracut-pre-trigger
<span class="token assign-left variable">StandardInput</span><span class="token operator">=</span>null
<span class="token assign-left variable">StandardOutput</span><span class="token operator">=</span>syslog
<span class="token assign-left variable">StandardError</span><span class="token operator">=</span>syslog+console
<span class="token assign-left variable">KillMode</span><span class="token operator">=</span>process
<span class="token assign-left variable">RemainAfterExit</span><span class="token operator">=</span>yes

<span class="token comment"># Bash ignores SIGTERM, so we send SIGHUP instead, to ensure that bash</span>
<span class="token comment"># terminates cleanly.</span>
<span class="token assign-left variable">KillSignal</span><span class="token operator">=</span>SIGHUP
</code></pre> 
<ul><li>drauct-initqueue.service</li></ul> 
<pre><code class="prism language-bash"><span class="token comment"># /usr/lib/systemd/system/../../dracut/modules.d/98dracut-systemd/dracut-initqueue.service</span>
<span class="token comment">#  This file is part of dracut.</span>
<span class="token comment">#</span>
<span class="token comment"># See dracut.bootup(7) for details</span>

<span class="token punctuation">[</span>Unit<span class="token punctuation">]</span>
<span class="token assign-left variable">Description</span><span class="token operator">=</span>dracut initqueue hook
<span class="token assign-left variable">Documentation</span><span class="token operator">=</span>man:dracut-initqueue.service<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>
<span class="token assign-left variable">DefaultDependencies</span><span class="token operator">=</span>no
<span class="token assign-left variable">Before</span><span class="token operator">=</span>remote-fs-pre.target
<span class="token assign-left variable">Wants</span><span class="token operator">=</span>remote-fs-pre.target
<span class="token assign-left variable">After</span><span class="token operator">=</span>systemd-udev-trigger.service
<span class="token assign-left variable">Wants</span><span class="token operator">=</span>systemd-udev-trigger.service
<span class="token assign-left variable">ConditionPathExists</span><span class="token operator">=</span>/usr/lib/initrd-release
<span class="token assign-left variable">ConditionPathExists</span><span class="token operator">=</span><span class="token operator">|</span>/lib/dracut/need-initqueue
<span class="token assign-left variable">ConditionKernelCommandLine</span><span class="token operator">=</span><span class="token operator">|</span><span class="token assign-left variable">rd.break</span><span class="token operator">=</span>initqueue
<span class="token assign-left variable">Conflicts</span><span class="token operator">=</span>shutdown.target emergency.target

<span class="token punctuation">[</span>Service<span class="token punctuation">]</span>
<span class="token assign-left variable">Environment</span><span class="token operator">=</span>DRACUT_SYSTEMD<span class="token operator">=</span><span class="token number">1</span>
<span class="token assign-left variable">Environment</span><span class="token operator">=</span>NEWROOT<span class="token operator">=</span>/sysroot
<span class="token assign-left variable">Type</span><span class="token operator">=</span>oneshot
<span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>-/bin/dracut-initqueue
<span class="token assign-left variable">StandardInput</span><span class="token operator">=</span>null
<span class="token assign-left variable">StandardOutput</span><span class="token operator">=</span>syslog
<span class="token assign-left variable">StandardError</span><span class="token operator">=</span>syslog+console
<span class="token assign-left variable">KillMode</span><span class="token operator">=</span>process
<span class="token assign-left variable">RemainAfterExit</span><span class="token operator">=</span>yes

<span class="token comment"># Bash ignores SIGTERM, so we send SIGHUP instead, to ensure that bash</span>
<span class="token comment"># terminates cleanly.</span>
<span class="token assign-left variable">KillSignal</span><span class="token operator">=</span>SIGHUP
</code></pre> 
<h3><a id="42_basictarget_374"></a>4.2 basic.target</h3> 
<p><img src="https://images2.imgbox.com/30/a6/I1QY02wB_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="43_initrdtarget_378"></a>4.3 initrd.target</h3> 
<p><img src="https://images2.imgbox.com/0c/6c/FN1igJjR_o.png" alt="在这里插入图片描述"></p> 
<ul><li>dracut-pre-mount.service</li></ul> 
<pre><code class="prism language-bash"><span class="token comment"># /usr/lib/systemd/system/../../dracut/modules.d/98dracut-systemd/dracut-pre-mount.service</span>
<span class="token comment">#  This file is part of dracut.</span>
<span class="token comment">#</span>
<span class="token comment"># See dracut.bootup(7) for details</span>

<span class="token punctuation">[</span>Unit<span class="token punctuation">]</span>
<span class="token assign-left variable">Description</span><span class="token operator">=</span>dracut pre-mount hook
<span class="token assign-left variable">Documentation</span><span class="token operator">=</span>man:dracut-pre-mount.service<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>
<span class="token assign-left variable">DefaultDependencies</span><span class="token operator">=</span>no
<span class="token assign-left variable">Before</span><span class="token operator">=</span>initrd-root-fs.target sysroot.mount systemd-fsck-root.service
<span class="token assign-left variable">After</span><span class="token operator">=</span>dracut-initqueue.service cryptsetup.target
<span class="token assign-left variable">ConditionPathExists</span><span class="token operator">=</span>/usr/lib/initrd-release
<span class="token assign-left variable">ConditionDirectoryNotEmpty</span><span class="token operator">=</span><span class="token operator">|</span>/lib/dracut/hooks/pre-mount
<span class="token assign-left variable">ConditionKernelCommandLine</span><span class="token operator">=</span><span class="token operator">|</span><span class="token assign-left variable">rd.break</span><span class="token operator">=</span>pre-mount
<span class="token assign-left variable">Conflicts</span><span class="token operator">=</span>shutdown.target emergency.target

<span class="token punctuation">[</span>Service<span class="token punctuation">]</span>
<span class="token assign-left variable">Environment</span><span class="token operator">=</span>DRACUT_SYSTEMD<span class="token operator">=</span><span class="token number">1</span>
<span class="token assign-left variable">Environment</span><span class="token operator">=</span>NEWROOT<span class="token operator">=</span>/sysroot
<span class="token assign-left variable">Type</span><span class="token operator">=</span>oneshot
<span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>-/bin/dracut-pre-mount
<span class="token assign-left variable">StandardInput</span><span class="token operator">=</span>null
<span class="token assign-left variable">StandardOutput</span><span class="token operator">=</span>syslog
<span class="token assign-left variable">StandardError</span><span class="token operator">=</span>syslog+console
<span class="token assign-left variable">KillMode</span><span class="token operator">=</span>process
<span class="token assign-left variable">RemainAfterExit</span><span class="token operator">=</span>yes

<span class="token comment"># Bash ignores SIGTERM, so we send SIGHUP instead, to ensure that bash</span>
<span class="token comment"># terminates cleanly.</span>
<span class="token assign-left variable">KillSignal</span><span class="token operator">=</span>SIGHUP
</code></pre> 
<ul><li>dracut-mount.service</li></ul> 
<pre><code class="prism language-bash"><span class="token comment"># /usr/lib/systemd/system/../../dracut/modules.d/98dracut-systemd/dracut-mount.service</span>
<span class="token comment">#  This file is part of dracut.</span>
<span class="token comment">#</span>
<span class="token comment"># See dracut.bootup(7) for details</span>

<span class="token punctuation">[</span>Unit<span class="token punctuation">]</span>
<span class="token assign-left variable">Description</span><span class="token operator">=</span>dracut <span class="token function">mount</span> hook
<span class="token assign-left variable">Documentation</span><span class="token operator">=</span>man:dracut-mount.service<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>
<span class="token assign-left variable">After</span><span class="token operator">=</span>initrd-root-fs.target initrd-parse-etc.service
<span class="token assign-left variable">After</span><span class="token operator">=</span>dracut-initqueue.service dracut-pre-mount.service
<span class="token assign-left variable">ConditionPathExists</span><span class="token operator">=</span>/usr/lib/initrd-release
<span class="token assign-left variable">ConditionDirectoryNotEmpty</span><span class="token operator">=</span><span class="token operator">|</span>/lib/dracut/hooks/mount
<span class="token assign-left variable">ConditionKernelCommandLine</span><span class="token operator">=</span><span class="token operator">|</span><span class="token assign-left variable">rd.break</span><span class="token operator">=</span>mount
<span class="token assign-left variable">DefaultDependencies</span><span class="token operator">=</span>no
<span class="token assign-left variable">Conflicts</span><span class="token operator">=</span>shutdown.target emergency.target

<span class="token punctuation">[</span>Service<span class="token punctuation">]</span>
<span class="token assign-left variable">Environment</span><span class="token operator">=</span>DRACUT_SYSTEMD<span class="token operator">=</span><span class="token number">1</span>
<span class="token assign-left variable">Environment</span><span class="token operator">=</span>NEWROOT<span class="token operator">=</span>/sysroot
<span class="token assign-left variable">Type</span><span class="token operator">=</span>oneshot
<span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>-/bin/dracut-mount
<span class="token assign-left variable">StandardInput</span><span class="token operator">=</span>null
<span class="token assign-left variable">StandardOutput</span><span class="token operator">=</span>syslog
<span class="token assign-left variable">StandardError</span><span class="token operator">=</span>syslog+console
<span class="token assign-left variable">KillMode</span><span class="token operator">=</span>process
<span class="token assign-left variable">RemainAfterExit</span><span class="token operator">=</span>yes

<span class="token comment"># Bash ignores SIGTERM, so we send SIGHUP instead, to ensure that bash</span>
<span class="token comment"># terminates cleanly.</span>
<span class="token assign-left variable">KillSignal</span><span class="token operator">=</span>SIGHUP
</code></pre> 
<h3><a id="44_switchroot_447"></a>4.4 switch-root</h3> 
<p><img src="https://images2.imgbox.com/9a/72/47n6FQkl_o.png" alt="在这里插入图片描述"><br> 该阶段主要完成 root 的切换，并将控制权交给新的 systemd 进程：</p> 
<ul><li>dracut-pre-pivot.service</li></ul> 
<pre><code class="prism language-bash"><span class="token comment"># /usr/lib/systemd/system/../../dracut/modules.d/98dracut-systemd/dracut-pre-pivot.service</span>
<span class="token comment">#  This file is part of dracut.</span>
<span class="token comment">#</span>
<span class="token comment"># See dracut.bootup(7) for details</span>

<span class="token punctuation">[</span>Unit<span class="token punctuation">]</span>
<span class="token assign-left variable">Description</span><span class="token operator">=</span>dracut pre-pivot and cleanup hook
<span class="token assign-left variable">Documentation</span><span class="token operator">=</span>man:dracut-pre-pivot.service<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>
<span class="token assign-left variable">DefaultDependencies</span><span class="token operator">=</span>no
<span class="token assign-left variable">After</span><span class="token operator">=</span>initrd.target initrd-parse-etc.service sysroot.mount
<span class="token assign-left variable">After</span><span class="token operator">=</span>dracut-initqueue.service dracut-pre-mount.service dracut-mount.service
<span class="token assign-left variable">Before</span><span class="token operator">=</span>initrd-cleanup.service
<span class="token assign-left variable">Wants</span><span class="token operator">=</span>remote-fs.target
<span class="token assign-left variable">After</span><span class="token operator">=</span>remote-fs.target
<span class="token assign-left variable">ConditionPathExists</span><span class="token operator">=</span>/usr/lib/initrd-release
<span class="token assign-left variable">ConditionDirectoryNotEmpty</span><span class="token operator">=</span><span class="token operator">|</span>/lib/dracut/hooks/pre-pivot
<span class="token assign-left variable">ConditionDirectoryNotEmpty</span><span class="token operator">=</span><span class="token operator">|</span>/lib/dracut/hooks/cleanup
<span class="token assign-left variable">ConditionKernelCommandLine</span><span class="token operator">=</span><span class="token operator">|</span><span class="token assign-left variable">rd.break</span><span class="token operator">=</span>pre-pivot
<span class="token assign-left variable">ConditionKernelCommandLine</span><span class="token operator">=</span><span class="token operator">|</span><span class="token assign-left variable">rd.break</span><span class="token operator">=</span>cleanup
<span class="token assign-left variable">ConditionKernelCommandLine</span><span class="token operator">=</span><span class="token operator">|</span>rd.break
<span class="token assign-left variable">ConditionPathExists</span><span class="token operator">=</span><span class="token operator">|</span>/dev/root
<span class="token assign-left variable">ConditionPathExists</span><span class="token operator">=</span><span class="token operator">|</span>/dev/nfs
<span class="token assign-left variable">Conflicts</span><span class="token operator">=</span>shutdown.target emergency.target

<span class="token punctuation">[</span>Service<span class="token punctuation">]</span>
<span class="token assign-left variable">Environment</span><span class="token operator">=</span>DRACUT_SYSTEMD<span class="token operator">=</span><span class="token number">1</span>
<span class="token assign-left variable">Environment</span><span class="token operator">=</span>NEWROOT<span class="token operator">=</span>/sysroot
<span class="token assign-left variable">Type</span><span class="token operator">=</span>oneshot
<span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>-/bin/dracut-pre-pivot
<span class="token assign-left variable">StandardInput</span><span class="token operator">=</span>null
<span class="token assign-left variable">StandardOutput</span><span class="token operator">=</span>syslog
<span class="token assign-left variable">StandardError</span><span class="token operator">=</span>syslog+console
<span class="token assign-left variable">KillMode</span><span class="token operator">=</span>process
<span class="token assign-left variable">RemainAfterExit</span><span class="token operator">=</span>yes

<span class="token comment"># Bash ignores SIGTERM, so we send SIGHUP instead, to ensure that bash</span>
<span class="token comment"># terminates cleanly.</span>
<span class="token assign-left variable">KillSignal</span><span class="token operator">=</span>SIGHUP
</code></pre> 
<ul><li>initrd-cleanup.service</li></ul> 
<pre><code class="prism language-bash"><span class="token comment"># /usr/lib/systemd/system/initrd-cleanup.service</span>
<span class="token comment">#  SPDX-License-Identifier: LGPL-2.1+</span>
<span class="token comment">#</span>
<span class="token comment">#  This file is part of systemd.</span>
<span class="token comment">#</span>
<span class="token comment">#  systemd is free software; you can redistribute it and/or modify it</span>
<span class="token comment">#  under the terms of the GNU Lesser General Public License as published by</span>
<span class="token comment">#  the Free Software Foundation; either version 2.1 of the License, or</span>
<span class="token comment">#  (at your option) any later version.</span>

<span class="token punctuation">[</span>Unit<span class="token punctuation">]</span>
<span class="token assign-left variable">Description</span><span class="token operator">=</span>Cleaning Up and Shutting Down Daemons
<span class="token assign-left variable">DefaultDependencies</span><span class="token operator">=</span>no
<span class="token assign-left variable">ConditionPathExists</span><span class="token operator">=</span>/etc/initrd-release
<span class="token assign-left variable">OnFailure</span><span class="token operator">=</span>emergency.target
<span class="token assign-left variable">OnFailureJobMode</span><span class="token operator">=</span>replace-irreversibly
<span class="token assign-left variable">After</span><span class="token operator">=</span>initrd-root-fs.target initrd-fs.target initrd.target

<span class="token punctuation">[</span>Service<span class="token punctuation">]</span>
<span class="token assign-left variable">Type</span><span class="token operator">=</span>oneshot
<span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>/usr/bin/systemctl --no-block isolate initrd-switch-root.target
</code></pre> 
<ul><li>initrd-switch-root.service</li></ul> 
<pre><code class="prism language-bash"><span class="token comment"># /usr/lib/systemd/system/initrd-switch-root.service</span>
<span class="token comment">#  SPDX-License-Identifier: LGPL-2.1+</span>
<span class="token comment">#</span>
<span class="token comment">#  This file is part of systemd.</span>
<span class="token comment">#</span>
<span class="token comment">#  systemd is free software; you can redistribute it and/or modify it</span>
<span class="token comment">#  under the terms of the GNU Lesser General Public License as published by</span>
<span class="token comment">#  the Free Software Foundation; either version 2.1 of the License, or</span>
<span class="token comment">#  (at your option) any later version.</span>

<span class="token punctuation">[</span>Unit<span class="token punctuation">]</span>
<span class="token assign-left variable">Description</span><span class="token operator">=</span>Switch Root
<span class="token assign-left variable">DefaultDependencies</span><span class="token operator">=</span>no
<span class="token assign-left variable">ConditionPathExists</span><span class="token operator">=</span>/etc/initrd-release
<span class="token assign-left variable">OnFailure</span><span class="token operator">=</span>emergency.target
<span class="token assign-left variable">OnFailureJobMode</span><span class="token operator">=</span>replace-irreversibly
<span class="token assign-left variable">AllowIsolate</span><span class="token operator">=</span>yes

<span class="token punctuation">[</span>Service<span class="token punctuation">]</span>
<span class="token assign-left variable">Type</span><span class="token operator">=</span>oneshot
<span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>/usr/bin/systemctl --no-block switch-root /sysroot
</code></pre> 
<h3><a id="45_multiusertarget_539"></a>4.5 multi-user.target</h3> 
<p><img src="https://images2.imgbox.com/32/dc/jsVF1bfE_o.png" alt="在这里插入图片描述"></p> 
<ul><li>systemd-logind.service</li></ul> 
<pre><code class="prism language-bash"><span class="token comment"># /usr/lib/systemd/system/systemd-logind.service</span>
<span class="token comment">#  SPDX-License-Identifier: LGPL-2.1+</span>
<span class="token comment">#</span>
<span class="token comment">#  This file is part of systemd.</span>
<span class="token comment">#</span>
<span class="token comment">#  systemd is free software; you can redistribute it and/or modify it</span>
<span class="token comment">#  under the terms of the GNU Lesser General Public License as published by</span>
<span class="token comment">#  the Free Software Foundation; either version 2.1 of the License, or</span>
<span class="token comment">#  (at your option) any later version.</span>

<span class="token punctuation">[</span>Unit<span class="token punctuation">]</span>
<span class="token assign-left variable">Description</span><span class="token operator">=</span>Login Service
<span class="token assign-left variable">Documentation</span><span class="token operator">=</span>man:systemd-logind.service<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span> man:logind.conf<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
<span class="token assign-left variable">Documentation</span><span class="token operator">=</span>https://www.freedesktop.org/wiki/Software/systemd/logind
<span class="token assign-left variable">Documentation</span><span class="token operator">=</span>https://www.freedesktop.org/wiki/Software/systemd/multiseat
<span class="token assign-left variable">Wants</span><span class="token operator">=</span>user.slice
<span class="token assign-left variable">After</span><span class="token operator">=</span>nss-user-lookup.target user.slice

<span class="token comment"># Ask for the dbus socket.</span>
<span class="token assign-left variable">Wants</span><span class="token operator">=</span>dbus.socket
<span class="token assign-left variable">After</span><span class="token operator">=</span>dbus.socket

<span class="token punctuation">[</span>Service<span class="token punctuation">]</span>
<span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>/usr/lib/systemd/systemd-logind
<span class="token assign-left variable">Restart</span><span class="token operator">=</span>always
<span class="token assign-left variable">RestartSec</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token assign-left variable">BusName</span><span class="token operator">=</span>org.freedesktop.login1
<span class="token assign-left variable">WatchdogSec</span><span class="token operator">=</span>3min
<span class="token assign-left variable">CapabilityBoundingSet</span><span class="token operator">=</span>CAP_SYS_ADMIN CAP_MAC_ADMIN CAP_AUDIT_CONTROL CAP_CHOWN CAP_KILL CAP_DAC_READ_SEARCH CAP_DAC_OVERRIDE CAP<span class="token operator">&gt;</span>
<span class="token assign-left variable">MemoryDenyWriteExecute</span><span class="token operator">=</span>yes
<span class="token assign-left variable">RestrictRealtime</span><span class="token operator">=</span>yes
<span class="token assign-left variable">RestrictNamespaces</span><span class="token operator">=</span>yes
<span class="token assign-left variable">RestrictAddressFamilies</span><span class="token operator">=</span>AF_UNIX AF_NETLINK
<span class="token assign-left variable">RestrictSUIDSGID</span><span class="token operator">=</span>yes
<span class="token assign-left variable">SystemCallFilter</span><span class="token operator">=</span>@system-service
<span class="token assign-left variable">SystemCallErrorNumber</span><span class="token operator">=</span>EPERM
<span class="token assign-left variable">SystemCallArchitectures</span><span class="token operator">=</span>native
<span class="token assign-left variable">LockPersonality</span><span class="token operator">=</span>yes
<span class="token assign-left variable">FileDescriptorStoreMax</span><span class="token operator">=</span><span class="token number">512</span>

<span class="token comment"># Increase the default a bit in order to allow many simultaneous</span>
<span class="token comment"># logins since we keep one fd open per session.</span>
<span class="token assign-left variable">LimitNOFILE</span><span class="token operator">=</span><span class="token number">16384</span>
</code></pre> 
<ul><li>getty.target</li></ul> 
<pre><code class="prism language-bash"><span class="token comment"># /usr/lib/systemd/system/getty.target</span>
<span class="token comment">#  SPDX-License-Identifier: LGPL-2.1+</span>
<span class="token comment">#</span>
<span class="token comment">#  This file is part of systemd.</span>
<span class="token comment">#</span>
<span class="token comment">#  systemd is free software; you can redistribute it and/or modify it</span>
<span class="token comment">#  under the terms of the GNU Lesser General Public License as published by</span>
<span class="token comment">#  the Free Software Foundation; either version 2.1 of the License, or</span>
<span class="token comment">#  (at your option) any later version.</span>

<span class="token punctuation">[</span>Unit<span class="token punctuation">]</span>
<span class="token assign-left variable">Description</span><span class="token operator">=</span>Login Prompts
<span class="token assign-left variable">Documentation</span><span class="token operator">=</span>man:systemd.special<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span> man:systemd-getty-generator<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>
<span class="token assign-left variable">Documentation</span><span class="token operator">=</span>http://0pointer.de/blog/projects/serial-console.html
</code></pre> 
<p>至此，从加电到登录界面 Linux 的整个启动流程梳理完毕，只是粗略的介绍了大致流程，整个启动过程非常复杂，很多细节还没有搞清楚，所以没有展开。</p> 
<h2><a id="_605"></a>参考文档</h2> 
<ul><li> <p><a href="https://www.cnblogs.com/mahocon/p/5691348.html" rel="nofollow">1. UEFI 启动：实际工作原理</a></p> </li><li> <p><a href="https://www.cnblogs.com/yxqxx/p/8972301.html" rel="nofollow">2. DOS分区表（Boot Sector引导扇区）</a></p> </li><li> <p><a href="https://www.cnblogs.com/kelamoyujuzhen/p/9144175.html" rel="nofollow">3. Linux磁盘管理——MBR 与 GPT</a></p> </li><li> <p><a href="https://www.cnblogs.com/f-ck-need-u/archive/2017/06/29/7094693.html" rel="nofollow">4. grub2 详解(翻译和整理官方手册)</a></p> </li><li> <p><a href="https://blog.csdn.net/perfect1t/article/details/81741531">5. linux内核启动流程(文章最后流程图)</a></p> </li><li> <p><a href="https://blog.csdn.net/xiehaihit/article/details/91959216">6. Linux内核Ramdisk(initrd)机制</a></p> </li><li> <p><a href="https://man7.org/linux/man-pages/man7/dracut.bootup.7.html" rel="nofollow">7. dracut.bootup(7) — Linux manual page</a></p> </li><li> <p><a href="https://man7.org/linux/man-pages/man7/bootup.7.html" rel="nofollow">8. bootup(7) — Linux manual page</a></p> </li><li> <p><a href="https://man7.org/linux/man-pages/man7/boot.7.html" rel="nofollow">9. boot(7) — Linux manual page</a></p> </li><li> <p><a href="https://man7.org/linux/man-pages/man7/dracut.cmdline.7.html" rel="nofollow">10. dracut.cmdline(7) — Linux manual page</a></p> </li><li> <p><a href="http://linux.vbird.org/linux_basic/" rel="nofollow">11. 鳥哥的 Linux 私房菜 - 基礎學習篇</a></p> </li><li> <p><a href="http://www.jinbuguo.com/systemd/systemd.index.html" rel="nofollow">12. 金步国 systemd 中文手册</a></p> </li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d517953451868869b3688a84a7b545de/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">常用命令行-脑子不好使备忘</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ef0963310c737aa7a5c47c06e4644f27/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">安卓发布小技巧</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>