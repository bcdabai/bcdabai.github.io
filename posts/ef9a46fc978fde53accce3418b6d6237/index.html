<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>pytorch实操笔记之基本数据操作 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="pytorch实操笔记之基本数据操作" />
<meta property="og:description" content="n维数组示例 3维数组（图片）4维数组（n个图片，即一个batchsize）5维数组 (视频，多了个时间维度) 数据操作 首先导入torch包 import torch 改变张量形状 X=x.reshape(3,4) 创建全0，全1 内部填维度,第一个维度为通道数
torch.zeros_like(Y) , 即创建一个与y维度一致的全0张量
torch.zeros((2,3,4)) torch.ones((2,3,4)) z = torch.zeros_like(Y) 多个张量连接在一起 通过cat方法
dim=0,按行合并，两个张量上下堆叠
dim=1,按列合并，两个张量左右堆叠
dim=2,
x = torch.arange(12,dtype=torch.float32).reshape((3,4)) y = torch.tensor([2.0, 1, 4, 3],[1, 2, 3, 4],[4, 3, 2, 1]) torch.cat((x,y),dim=0),torch.cat((x,y),dim=1)	逻辑运算符两元张量 得到只含false和true的张量
x == y 对张量中的所有元素求和会产生只有一个元素的张量 x.sum() 广播机制 形状不同可能通过广播机制来执行相关操作
内存问题 执行原地操作 z = torch.zeros_like(y) z[ : ] = x &#43; y 2.如果后续计算中没有重复使用x,可以使用如下语句减少开销
x[:] = x &#43; y x &#43;= y 转换numpy张量 如下转换后B为torch中的张量" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/ef9a46fc978fde53accce3418b6d6237/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-09-14T21:53:46+08:00" />
<meta property="article:modified_time" content="2022-09-14T21:53:46+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">pytorch实操笔记之基本数据操作</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="n_0"></a>n维数组示例</h2> 
<ul><li>3维数组（图片）</li><li>4维数组（n个图片，即一个batchsize）</li><li>5维数组 (视频，多了个时间维度)</li></ul> 
<h2><a id="_6"></a>数据操作</h2> 
<h4><a id="torch_7"></a>首先导入torch包</h4> 
<pre><code>	import torch
</code></pre> 
<h4><a id="_11"></a>改变张量形状</h4> 
<pre><code>	X=x.reshape(3,4)
</code></pre> 
<h4><a id="01_16"></a>创建全0，全1</h4> 
<p>内部填维度,第一个维度为通道数<br> torch.zeros_like(Y) , 即创建一个与y维度一致的全0张量</p> 
<pre><code>	torch.zeros((2,3,4))
	torch.ones((2,3,4))
    z = torch.zeros_like(Y)
</code></pre> 
<h4><a id="_24"></a>多个张量连接在一起</h4> 
<p>通过cat方法<br> dim=0,按行合并，两个张量上下堆叠<br> dim=1,按列合并，两个张量左右堆叠<br> dim=2,</p> 
<pre><code>	x = torch.arange(12,dtype=torch.float32).reshape((3,4))
	y = torch.tensor([2.0, 1, 4, 3],[1, 2, 3, 4],[4, 3, 2, 1])
	torch.cat((x,y),dim=0),torch.cat((x,y),dim=1)	
</code></pre> 
<h4><a id="_35"></a>逻辑运算符两元张量</h4> 
<p>得到只含false和true的张量</p> 
<pre><code>	x == y
</code></pre> 
<h4><a id="_41"></a>对张量中的所有元素求和会产生只有一个元素的张量</h4> 
<pre><code>    x.sum()
</code></pre> 
<h4><a id="_46"></a>广播机制</h4> 
<p>形状不同可能通过广播机制来执行相关操作</p> 
<h4><a id="_49"></a>内存问题</h4> 
<ol><li>执行原地操作</li></ol> 
<pre><code>    z = torch.zeros_like(y)
    z[ : ] = x + y
</code></pre> 
<p>2.如果后续计算中没有重复使用x,可以使用如下语句减少开销</p> 
<pre><code>	x[:] = x + y
	x += y
</code></pre> 
<h4><a id="numpy_62"></a>转换numpy张量</h4> 
<p>如下转换后B为torch中的张量</p> 
<pre><code>	A = x.numpy()
	B = torch.tensor(A)
</code></pre> 
<h4><a id="1python_69"></a>也可以将大小为1的张量转换为python标量</h4> 
<pre><code>	a = torch.tensor([3,5])
	a.item(),float(a),int(a)
</code></pre> 
<h2><a id="_77"></a>数据预处理</h2> 
<h4><a id="1_csv_78"></a>1. 创建一个人工数据集，存储在csv（逗号分隔值）文件</h4> 
<p>如果已经有数据集，则不需要自己创建</p> 
<pre><code class="prism language-python">	<span class="token keyword">import</span> os
	<span class="token comment">#创建当前相对路径下用于存储数据集的文件夹，名为data</span>
	os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string">'..'</span><span class="token punctuation">,</span><span class="token string">'data'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>exist_ok<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
	<span class="token comment">#获取数据集文件 </span>
	date_file <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string">'..'</span><span class="token punctuation">,</span><span class="token string">'data'</span><span class="token punctuation">,</span><span class="token string">'house_tiny.csv'</span><span class="token punctuation">)</span>

	<span class="token comment">#打开数据集文件并向其中写入数据</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>data_file<span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'Numrooms,Alley,price\n'</span><span class="token punctuation">)</span>  <span class="token comment">#列名，\n用于换行</span>
        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'NA,pave,127500\n'</span><span class="token punctuation">)</span>  <span class="token comment">#每行表示一个数据样本</span>
        <span class="token comment">#NA代表未知</span>
</code></pre> 
<h4><a id="2csv_95"></a>2.读取csv文件，加载原始数据集</h4> 
<p>一般读取csv文件，采用pandas库</p> 
<pre><code>	data = pd.read_csv(data_file)
	print(data)
</code></pre> 
<h4><a id="3NA_103"></a>3.处理缺失的数据NA，</h4> 
<p>典型的方法包括 插值 和 删除<br> 下面考虑插值</p> 
<pre><code class="prism language-python">	<span class="token comment">#分为输入，输出两部分，输入为data中的所有行和前两列，输出为data中的所有行第二列</span>
	inputs<span class="token punctuation">,</span>outputs <span class="token operator">=</span> data<span class="token punctuation">.</span>iloc<span class="token punctuation">(</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> data<span class="token punctuation">.</span>iloc<span class="token punctuation">(</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
	<span class="token comment">#将输入中所有的NA 插入该列的平均值，对于非数值和离散值则还是NAN</span>
	inputs <span class="token operator">=</span> inputs<span class="token punctuation">.</span>fillna<span class="token punctuation">(</span>inputs<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


</code></pre> 
<p>对于非数值，即类别值或者离散值，我们将NAN 视为一个类别</p> 
<pre><code class="prism language-python">	<span class="token comment">#通过这个函数可以将类别变为数值，dummy_na=True 使得NAN也算一类0，</span>
	inputs <span class="token operator">=</span> pd<span class="token punctuation">.</span>get_dummies<span class="token punctuation">(</span>inputs<span class="token punctuation">,</span>dummy_na<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>inputs<span class="token punctuation">)</span>
</code></pre> 
<h4><a id="_121"></a>转换为张量</h4> 
<p>现在inputs 和 outputs 中的缺失值，和字符全都是数值类型，可以转换为<br> pytorch中的张量</p> 
<pre><code class="prism language-python">	x<span class="token punctuation">,</span>y <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span>inputs<span class="token punctuation">.</span>values<span class="token punctuation">)</span><span class="token punctuation">,</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span>outputs<span class="token punctuation">.</span>values<span class="token punctuation">)</span>
	pirnt<span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span>
</code></pre> 
<h2><a id="_130"></a>数据加载</h2> 
<ul><li>Dataset 提供一种方式取获取数据及其label 
  <ul><li>如何获取每一个数据及其label</li><li>获取总共有多少数据</li></ul> </li><li>Dataloader 为网络提供不同的数据形式</li></ul> 
<h3><a id="Dataset__137"></a>Dataset 实战</h3> 
<h4><a id="1Dataset_139"></a>1.引入Dataset</h4> 
<pre><code>	from torch.utils.data import Dataset
	import cv2 #引入opencv库处理图片
	from PIL import Image #也可以用这个处理图片
</code></pre> 
<h5><a id="PIL_146"></a>补充：PIL的使用</h5> 
<pre><code class="prism language-python">	<span class="token comment">#获取图片地址, window中要双反斜杠表示反义</span>
	img_path <span class="token operator">=</span> <span class="token string">"D:\\python   11\\新建文件夹\\practise\\深度学习\\数据加载\\hymenoptera_data\\train\\ants\\0013035.jpg"</span>
	<span class="token comment">#获取相应地址的图片</span>
	img <span class="token operator">=</span> Image<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>img_path<span class="token punctuation">)</span>
	<span class="token comment">#展示图片</span>
	img<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="2Dataset_157"></a>2.新建一个数据集的类，类名自定，要继承Dataset类</h4> 
<p>新建的类要重写 <strong>init</strong> 方法 和 <strong>getitem</strong> 方法<br> 下面以蜜蜂蚂蚁数据集为例</p> 
<h5><a id="os_160"></a>补充：利用os中的方法获取所有的数据（图片）</h5> 
<pre><code class="prism language-python">	dir_path <span class="token operator">=</span> <span class="token string">"需要读取图片所在路径"</span>
	<span class="token comment">#os中的listdir方法将传入路径下的所有文件名，以列表的方式返回</span>
	img_path_list <span class="token operator">=</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>dir_path<span class="token punctuation">)</span>
	<span class="token comment">#还需要通过地址拼接获取文件下所有图片的路径</span>
</code></pre> 
<pre><code class="prism language-python">	<span class="token comment">#获取图片地址需要os库</span>
	<span class="token keyword">import</span> os
	<span class="token keyword">class</span> <span class="token class-name">Mydata</span><span class="token punctuation">(</span>Dataset<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment">#init方法主要是提供后续一些其他方法所需要的初始变量</span>

		<span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>root_dir<span class="token punctuation">,</span>label_dir<span class="token punctuation">)</span><span class="token punctuation">:</span>

			<span class="token comment">#本处采用的是蜜蜂蚂蚁数据集，需要获取全部图片地址</span>
			<span class="token comment">#需要root_dir（路径的前面公共部分） , label_dir(也就是标签名，标签名作为每类数据的文件夹名)，文件名 拼接起来，</span>
			<span class="token comment">#os.path.join() 用于拼接地址</span>

			获取前半地址
			self<span class="token punctuation">.</span>root_dir <span class="token operator">=</span> root_dir
			self<span class="token punctuation">.</span>label_dir <span class="token operator">=</span> label_dir
			self<span class="token punctuation">.</span>path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>self<span class="token punctuation">.</span>root_dir<span class="token punctuation">,</span>self<span class="token punctuation">.</span>label_dir<span class="token punctuation">)</span>

			<span class="token comment">#获取文件夹下所有图片名构成列表，用于后续拼接地址</span>
			self<span class="token punctuation">.</span>img_path <span class="token operator">=</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>self<span class="token punctuation">.</span>path<span class="token punctuation">)</span>

		<span class="token keyword">def</span> <span class="token function">__getitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>idx<span class="token punctuation">)</span>
			<span class="token comment">#idx 为编号</span>
            <span class="token comment">#该方法要返回数据和标签</span>

			img_name <span class="token operator">=</span> self<span class="token punctuation">.</span>img_path<span class="token punctuation">[</span>idx<span class="token punctuation">]</span>
			img_item_path<span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>self<span class="token punctuation">.</span>root_dir<span class="token punctuation">,</span>self<span class="token punctuation">.</span>label_dir<span class="token punctuation">,</span>img_name<span class="token punctuation">)</span>
			img <span class="token operator">=</span> Image<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>img_item_path<span class="token punctuation">)</span>
			label <span class="token operator">=</span> self<span class="token punctuation">.</span>label_dir
			<span class="token keyword">return</span> img<span class="token punctuation">,</span>label

		<span class="token keyword">def</span> <span class="token function">__len__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        	<span class="token comment">#重写__len__方法</span>

			<span class="token keyword">return</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>img_path<span class="token punctuation">)</span>

</code></pre> 
<h5><a id="_206"></a>应用上述新建的数据类</h5> 
<p>创建一个蚂蚁数据集，蜜蜂数据集，并合并为训练集</p> 
<pre><code class="prism language-python">	root_dir <span class="token operator">=</span> <span class="token string">"D:/python   11/新建文件夹/practise/深度学习/数据加载/hymenoptera_data/train"</span>
	ants_label_dir <span class="token operator">=</span> <span class="token string">"ants"</span>
	bees_label_dir <span class="token operator">=</span> <span class="token string">"bees"</span>
	ants_dataset <span class="token operator">=</span> Mydata<span class="token punctuation">(</span>root_dir<span class="token punctuation">,</span>ants_label_dir<span class="token punctuation">)</span>
	bees_dataset <span class="token operator">=</span> Mydata<span class="token punctuation">(</span>root_dir<span class="token punctuation">,</span>bees_label_dir<span class="token punctuation">)</span>

	<span class="token comment">#合并为训练集，直接相加</span>
	train_dataset <span class="token operator">=</span> ants_dataset <span class="token operator">+</span> bees_dataset
</code></pre> 
<p><a href="https://zh-v2.d2l.ai/" rel="nofollow">参考链接：动手学深度学习</a><br> <a href="https://github.com/TingsongYu/PyTorch_Tutorial">参考链接：pytorch教程</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a5c190d236ce43c3623b35478b7f5dcc/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">#ubuntu# #python# python版本切换&amp;pip更新</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c3ca675305fd177552598e98da5ce14e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">讯为4412开发板Linux学习笔记</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>