<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Redis——Redis详解 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Redis——Redis详解" />
<meta property="og:description" content="文章目录 Redis1. 常见数据类型1.1 测试一下 2. Redis持久化2.1 RDB （Redis DataBase）快照2.1 AOF （Append-only file）文件命令 3. Redis的过期键的删除策略3. 1 定时删除3. 2 惰性删除3. 3 定期删除 4. Redis的内存淘汰策略 Redis 1. 常见数据类型 常见的数据类型，一共有5种。
String： 标准的key、value类型。给Key取名字的时候比较关键，这样我们直接判断缓存中有没有值，没有值就查库。
Hash： Redis hash 是一个 string 类型的 field（字段） 和 value（值） 的映射表，hash 特别适合用于存储对象。
List: Redis列表是简单的字符串列表，按照插入顺序排序。你可以添加一个元素到列表的头部（左边）或者尾部（右边）
set: Redis 的 Set 是 String 类型的无序集合。集合成员是唯一的，这就意味着集合中不能出现重复的数据。类似于java的set集合。
zset： 有序集合和集合一样也是string类型的元素的集合，且不允许重复的成员。不同的是每个元素都会关联一个double类型的分数，redis 正是通过分数来集合中的成员进行从小到大的排序，有序集合的成员是唯一的，但分数（score）却可以重复。
1.1 测试一下 首先开启redis的server。找到redis的安装目录，运行redis-server 脚本,启动redis服务。
redis-server 在Springboot工程中配置redis的配置，依赖此处不展示。
server: port: 8080 spring: datasource: password: 123 username: root driver-class-name: com.mysql.cj.jdbc.Driver url: jdbc:mysql://127." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/7e837cbaac7e9490bf0dd21eee5bd7b6/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-07-18T23:23:26+08:00" />
<meta property="article:modified_time" content="2021-07-18T23:23:26+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Redis——Redis详解</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-dracula">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#Redis_1" rel="nofollow">Redis</a></li><li><ul><li><a href="#1__2" rel="nofollow">1. 常见数据类型</a></li><li><ul><li><a href="#11__10" rel="nofollow">1.1 测试一下</a></li></ul> 
   </li><li><a href="#2_Redis_186" rel="nofollow">2. Redis持久化</a></li><li><ul><li><a href="#21_RDB_Redis_DataBase_189" rel="nofollow">2.1 RDB （Redis DataBase）快照</a></li><li><a href="#21_AOF_Appendonly_file_211" rel="nofollow">2.1 AOF （Append-only file）文件命令</a></li></ul> 
   </li><li><a href="#3_Redis_249" rel="nofollow">3. Redis的过期键的删除策略</a></li><li><ul><li><a href="#3_1__254" rel="nofollow">3. 1 定时删除</a></li><li><a href="#3_2__257" rel="nofollow">3. 2 惰性删除</a></li><li><a href="#3_3__260" rel="nofollow">3. 3 定期删除</a></li></ul> 
   </li><li><a href="#4_Redis_263" rel="nofollow">4. Redis的内存淘汰策略</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="Redis_1"></a>Redis</h2> 
<h3><a id="1__2"></a>1. 常见数据类型</h3> 
<p>常见的数据类型，一共有5种。<br> <strong>String：</strong> 标准的key、value类型。给Key取名字的时候比较关键，这样我们直接判断缓存中有没有值，没有值就查库。<br> <strong>Hash：</strong> Redis hash 是一个 string 类型的 field（字段） 和 value（值） 的映射表，hash 特别适合用于存储对象。<br> <strong>List:</strong> Redis列表是简单的字符串列表，按照插入顺序排序。你可以添加一个元素到列表的头部（左边）或者尾部（右边）<br> <strong>set:</strong> Redis 的 Set 是 String 类型的无序集合。集合成员是唯一的，这就意味着集合中不能出现重复的数据。类似于java的set集合。<br> <strong>zset：</strong> 有序集合和集合一样也是string类型的元素的集合，且不允许重复的成员。不同的是每个元素都会关联一个double类型的分数，redis 正是通过分数来集合中的成员进行从小到大的排序，有序集合的成员是唯一的，但分数（score）却可以重复。</p> 
<h4><a id="11__10"></a>1.1 测试一下</h4> 
<p>首先开启redis的server。找到redis的安装目录，运行redis-server 脚本,启动redis服务。</p> 
<pre><code class="prism language-shell">redis-server
</code></pre> 
<p>在Springboot工程中配置redis的配置，依赖此处不展示。</p> 
<pre><code class="prism language-yml"><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//127.0.0.1/city<span class="token punctuation">?</span>useUnicode=true<span class="token important">&amp;characterEncoding=UTF-</span><span class="token number">8</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> zlDemo
<span class="token comment">## redis连接</span>
  <span class="token key atrule">redis</span><span class="token punctuation">:</span>
    <span class="token key atrule">database</span><span class="token punctuation">:</span> <span class="token number">0</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">6379</span>
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123</span>
    <span class="token key atrule">host</span><span class="token punctuation">:</span> localhost
</code></pre> 
<p>随便编写一个工具类</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>zl<span class="token punctuation">.</span>springbootdemo<span class="token punctuation">.</span>redis</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>beanutils<span class="token punctuation">.</span></span><span class="token class-name">BeanUtils</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PostConstruct</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">InvocationTargetException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Method</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @ClassName : RedisCache
 * @Description :
 * @Author : zl
 * @Date: 2021-07-18 14:42
 */</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">RedisCache</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// redisTemplate是redis内置的一个操作redis的对象。</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> redisTemplate<span class="token punctuation">;</span>
    <span class="token comment">// String 数据类型的操作对象</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ValueOperations</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> stringOps<span class="token punctuation">;</span>
    <span class="token comment">// Hash 数据类型的操作对象</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">HashOperations</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> hashOps<span class="token punctuation">;</span>
    <span class="token comment">// List 数据类型的操作对象</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ListOperations</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> listOps<span class="token punctuation">;</span>
    <span class="token comment">// set 数据类型的操作对象</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">SetOperations</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> setOps<span class="token punctuation">;</span>
    <span class="token comment">// zset 数据类型的操作对象</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ZSetOperations</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> zsetOps<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">RedisCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setRedisTemplate</span><span class="token punctuation">(</span><span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> redisTemplate<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">RedisCache</span><span class="token punctuation">.</span>redisTemplate <span class="token operator">=</span> redisTemplate<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@PostConstruct</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">RedisCache</span><span class="token punctuation">.</span>stringOps <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">RedisCache</span><span class="token punctuation">.</span>hashOps <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">RedisCache</span><span class="token punctuation">.</span>listOps <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">RedisCache</span><span class="token punctuation">.</span>setOps <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">RedisCache</span><span class="token punctuation">.</span>zsetOps <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForZSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/**
     * 获取字符串类型的值
     *
     * @param key
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">getValueByString</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> stringOps<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/**
     * 设置字符串类型的值
     *
     * @param key
     * @param value
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">setValueByString</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">String</span> value<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        stringOps<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/**
     * 设置Hash值
     *
     * @param key
     * @param object
     * @param tClass
     * @throws InvocationTargetException
     * @throws IllegalAccessException
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">setHashValueByHash</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">Object</span> object<span class="token punctuation">,</span> <span class="token class-name">Class</span> tClass<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InvocationTargetException</span><span class="token punctuation">,</span> <span class="token class-name">IllegalAccessException</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>object<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>tClass<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 获取类上的所有字段</span>
        <span class="token class-name">HashMap</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Method</span><span class="token punctuation">[</span><span class="token punctuation">]</span> declaredMethods <span class="token operator">=</span> tClass<span class="token punctuation">.</span><span class="token function">getDeclaredMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Method</span> declaredMethod <span class="token operator">:</span> declaredMethods<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">String</span> name <span class="token operator">=</span> declaredMethod<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>name<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"get"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">Object</span> invoke <span class="token operator">=</span> declaredMethod<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 存储的字段一定要与类的字段相同。</span>
                map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>name<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"get"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> name<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"get"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>invoke<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        hashOps<span class="token punctuation">.</span><span class="token function">putAll</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> map<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/**
     * 获取Hash值
     *
     * @param key 根据key 获取对象
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Object</span> <span class="token function">getHashValueByHash</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">Class</span> tclass<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> hashOps<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> newInstance <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            newInstance <span class="token operator">=</span> tclass<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// map 转成bean</span>
            <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> hashMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            map<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
                hashMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">populate</span><span class="token punctuation">(</span>newInstance<span class="token punctuation">,</span> hashMap<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> newInstance<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/**
     * 设置List，尾插法
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setListValueByList</span><span class="token punctuation">(</span><span class="token class-name">String</span> key <span class="token punctuation">,</span><span class="token class-name">String</span> value<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        listOps<span class="token punctuation">.</span><span class="token function">rightPush</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getListValueByList</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">String</span> value <span class="token operator">=</span> listOps<span class="token punctuation">.</span><span class="token function">leftPop</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setSetValueBySet</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span><span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> values<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> objects <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> values<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        setOps<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span>objects<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getSetValueBySet</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> setOps<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>写一点测试代码</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>propagation <span class="token operator">=</span> <span class="token class-name">Propagation</span><span class="token punctuation">.</span>REQUIRED<span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">City</span><span class="token punctuation">&gt;</span></span> <span class="token function">getAllCity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">City</span><span class="token punctuation">&gt;</span></span> allCity <span class="token operator">=</span> cityDao<span class="token punctuation">.</span><span class="token function">getAllCity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        allCity<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>city <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">RedisCache</span><span class="token punctuation">.</span><span class="token function">setValueByString</span><span class="token punctuation">(</span>city<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">":"</span><span class="token operator">+</span>city<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>JSON<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>city<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">RedisCache</span><span class="token punctuation">.</span><span class="token function">setHashValueByHash</span><span class="token punctuation">(</span>city<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>city<span class="token punctuation">,</span><span class="token class-name">City</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InvocationTargetException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IllegalAccessException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">return</span> allCity<span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
</code></pre> 
<p>测试结果: 可以看见redis已经插入数据了。<br> <img src="https://images2.imgbox.com/df/0e/obnruFVH_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="2_Redis_186"></a>2. Redis持久化</h3> 
<p>持久化，就是将redis内存中的数据写入到硬盘中。防止服务宕机了内存数据丢失。<br> Redis 提供了两种持久化机制RDB（默认）和AOF机制；</p> 
<h4><a id="21_RDB_Redis_DataBase_189"></a>2.1 RDB （Redis DataBase）快照</h4> 
<p>RDB是Redis默认的持久化方式。按照一定的时间将内存的数据以快照的形式保存到硬盘中，对应产生的数据文件为dump.rdb。通过配置文件中的save参数来定义修改快照的周期。<br> <img src="https://images2.imgbox.com/bd/2e/MEEAEwPz_o.png" alt="在这里插入图片描述"><br> 持久化默认配置</p> 
<pre><code>save 900 1     			900秒内，如果超过一个1key被修改，则发起快照保存
save 300 10			300秒内，如果超过10个key被修改，则发起快照保存
save 60 10000		60秒内，如果1万个key被修改，则发起快照保存
</code></pre> 
<p>备份文件存储的位置<br> <img src="https://images2.imgbox.com/29/5d/zFNWMdwd_o.png" alt="在这里插入图片描述"><br> 此文件是一个二进制的文件。也就是说rdb是采用二进制的存储方式来持久化redis缓存中的数据。<br> <strong>优点：</strong></p> 
<ol><li>性能高，redis fork子进程来完成写操作。不影响主进程处理命令。</li><li>只有一个文件 dump.rdb，方便持久化</li><li>容灾性好，一个文件可以保存到安全的磁盘</li><li>相对于数据集大时，比 AOF 的启动效率更高。</li></ol> 
<p><strong>缺点：</strong></p> 
<ol><li>数据安全性低，容易丢失数据</li></ol> 
<h4><a id="21_AOF_Appendonly_file_211"></a>2.1 AOF （Append-only file）文件命令</h4> 
<p>修改配置参数开启AOF</p> 
<pre><code class="prism language-xml">appendonly yes
</code></pre> 
<p>持久化配置</p> 
<pre><code class="prism language-xml"># appendfsync always   每次操作都会立即写入AOF文件中
appendfsync everysec   每秒持久化一次（默认配置）
# appendfsync no	不主动进行同步操作，默认30s一次
</code></pre> 
<p>当然 always一定是效率最低的，个人认为everysec就够用了，数据安全性能搞。Redis也允许我们同时使用两种方式，再重启redis后会从AOF中恢复数据，因为AOF比RDB数据损失小嘛</p> 
<p>更多的配置</p> 
<pre><code class="prism language-xml"> appendonly改为yes，开启AOF
appendonly yes
# AOF文件的名字
appendfilename "appendonly.aof"
# AOF文件的写入方式
# everysec 每个一秒将缓存区内容写入文件 默认开启的写入方式
appendfsync everysec
# 运行AOF重写时AOF文件大小的增长率的最小值
auto-aof-rewrite-percentage 100
# 运行AOF重写时文件大小的最小值
auto-aof-rewrite-min-size 64mb
</code></pre> 
<p><strong>优点:</strong></p> 
<ol><li>数据安全，aof 持久化可以配置 appendfsync 属性，有 always，每进行一次 命令操作就记录到 aof 文件中一次。</li><li>通过 append 模式写文件，即使中途服务器宕机，可以通过 redis-check-aof 工具解决数据一致性问题。</li><li>AOF 机制的 rewrite 模式。AOF 文件没被 rewrite 之前（文件过大时会对命令 进行合并重写），可以删除其中的某些命令（比如误操作的 flushall）)</li></ol> 
<p><strong>缺点:</strong></p> 
<ol><li>AOF 文件比 RDB 文件大，且恢复速度慢。</li><li>数据集大的时候，比 rdb 启动效率低。</li></ol> 
<h3><a id="3_Redis_249"></a>3. Redis的过期键的删除策略</h3> 
<p>Redis是key-value 数据库，我们可以设置Redis中缓存的key的过期时间。Redis的过期策略就是指当Redis中缓存的key过期了，Redis如何处理？一共有三种处理策略。定时删除，惰性删除，定期删除。<br> redis使用的是惰性删除+定期删除策略。</p> 
<h4><a id="3_1__254"></a>3. 1 定时删除</h4> 
<p>会为每一个设置了过期时间的key开启一个定时器，定时器一到。就会去删除对应的key（节约内存空间，因为过期了的key是要被删除的，而这个策略会马上删除腾出更多的内存空间，但是每一个key都维护了一个定时器，带来一部分的开销，CPU消耗大，如果同时过期的key太多的话，还会出现卡顿的情况），并发量小，内存小，可以使用。</p> 
<h4><a id="3_2__257"></a>3. 2 惰性删除</h4> 
<p>在使用key的时候，才进行删除，CPU效率最高，但是过期了key可能会长期占用内存。就比如说：你设置1G的内存，存活时间为3分钟，但是，五分钟之后，你发现redis还是占用着那1g的内存，那么就是因为采用了惰性删除的策略，那么在没有操作这些key之前，是不会去删除，如果你想要删除，你可以去查看一下这些key，他们就会被删除了。</p> 
<h4><a id="3_3__260"></a>3. 3 定期删除</h4> 
<p>就是没隔一段时间，就对过期了的key进行删除，节省了cpu，但是有些过期了的key会在下一个定时周期到来之前占用一部分内存。</p> 
<h3><a id="4_Redis_263"></a>4. Redis的内存淘汰策略</h3> 
<p>Redis内存淘汰策略，其实就是redis的垃圾回收。<br> maxmemory 可以用来设置内存的最大使用量，达到限度是就会执行内存淘汰机制。</p> 
<table><thead><tr><th>名称</th><th>描述</th></tr></thead><tbody><tr><td>volatile-lru</td><td>从已经设置过期时间的数据集中挑选出最近最少使用的数据淘汰</td></tr><tr><td>volatile-lfu</td><td>从已经设置过期时间的数据集合中挑选出最不经常用的数据淘汰</td></tr><tr><td>volatile-ttl</td><td>从已经设置过期时间的数据集合中挑选将要过期的数据淘汰</td></tr><tr><td>volatile-random</td><td>从已经设置过期时间的数据集中套选出任意数据淘汰</td></tr><tr><td>allkeys-lru</td><td>当内存不足写入新数据时淘汰最近最少使用的key</td></tr><tr><td>alllkeys-random</td><td>当内存不足写入新数据时随机选择key淘汰</td></tr><tr><td>alllkeys-lfu</td><td>当内存不足写入新数据时移出最不经常使用的key</td></tr><tr><td>no-eviction</td><td>当内存不足写入新数据时，写入操作会报错，同时不删除数据</td></tr></tbody></table> 
<ul><li>volatile 为前缀的策略都是从已经过期的数据集中进行淘汰。</li><li>allkeys 为前缀的策略都是面向所有key进行淘汰。</li><li>LRU （least recently used）最近最少用的。</li><li>LFU（least Frequently used）最不常用的。</li><li>它们的触发条件都是Redis使用的内存达到阈值时。</li></ul> 
<p>参数设置：</p> 
<pre><code class="prism language-xml">maxmemory 设置最大内存
maxmemory-policy 设置内存的淘汰机制
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/76d6494657be83482b94db6701df20ae/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Python程序设计 实验9：GUI编程</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/dc28b8030e4d4a3b70c4a3596e7e3ff4/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">H.264——H.264的profile 和 level</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>