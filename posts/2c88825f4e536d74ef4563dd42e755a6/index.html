<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>MPLS LDP - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="MPLS LDP" />
<meta property="og:description" content="文章目录 目录
一、topo结构
二、配置topo
第一步：配置IP地址和isis协议使全网互通
第二步、测试网络联通性 第三步、配置MPLS LDP多协议标签转发 第四步、抓包分析MPLS LDP 总结
新的一年开始了，在这里先祝大家兔年快乐，哈哈哈哈 前言 MPLS是一种根根据标签报文中携带的短而定长的标签来转发数据的技术MPLS的一个基本概念就是两台LSR必须对在它们之间转发的数据的标签使用上“达成共识”。
LSR之间可以运行标签分发协议( Label Distribution Protocol，LDP)来告知其他LSR本设备上的标签绑定信息，从而实现标签报文的正确转发。
LDP是MPLS的一种控制协议，相当于传统网络中的信令协议，负责FEC的分类、标签的分配以及LSP的建立和维护等操作。LDP规定了标签分发过程中的各种消息以及相关处理过程
LDP的工作过程主要分为两部分
1.LSR之间建立LDP会话
2.LSR之间基于LDP会话动态交换标签与FEC的映射信息，并根据标签信息建立LSP
LDP的会话建立是可靠传输，类似于TCP的三次握手。
发现阶段
设备通过周期性地发送LDP链路Hello报文 (LDPLink Hello)，实现LDP基本发现机制。LDP链路Hello报文使用UDP报文，目的地址是组播地址224.0.0.2。如果LSR在特定接口接收到LDP链路Hello报文，表明该接口存在LDP邻接体
TCP建立阶段
Hello报文中携带传输地址，双方后续将使用传输地址建立LDP会话
传输地址较大的一方作为主动方，主动发起建立TCP连接
经过TCP三次握手之后，两者建立起TCP连接。
TCP连接建立成功后，主动方R2(传输地址大的一方)发送LDP初始化报文，协商建立LDP会话的相关参数。
LDP会话的相关参数包括LDP协议版本、标签分发方式、KeepAlive保持定时器的值、最大PDU长度和标签空间等。
被动方R1收到初始化报文后，若接受R2的相关参数则回应KeepAlive报文作为确认，为了提高发送效率同时发送自己的初始化报文。
R2收到R1的初始化报文后，若接受相关参数，则回复KeepAlive报文给R1。
双方都收到对端的KeepAlive报文后，会话建立成功后续通过周期性发送的KeepAlive报文
下面来看实验吧
一、topo结构 二、配置topo 第一步：配置IP地址和isis协议使全网互通 第二步、测试网络联通性 第三步、配置MPLS LDP多协议标签转发 接口要开启mpls ldp协议 第四步、抓包分析MPLS LDP 可以看到传输地址为1.1.1.1 用来做后续的ldp建立 配置好AR2的MPLS LDP 来查看端口建立
抓包分析MPLS LDP 这里我们可以看到TCP 的三次握手，也就是说明会话建立完成了
可以看到会话接收端是2.2.2.2 保证建立成功
同理配置完AR3 AR4
用ping命令抓包查看MPLS LDP 标签 查看标签分析MPLS ldp
dis mpls lsp 查看标签分配" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/2c88825f4e536d74ef4563dd42e755a6/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-01-02T12:19:30+08:00" />
<meta property="article:modified_time" content="2023-01-02T12:19:30+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">MPLS LDP</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2><a id="_0"></a></h2> 
<p></p> 
<div> 
 <h4 id="%E6%96%87%E7%AB%A0%E7%9B%AE%E5%BD%95">文章目录</h4> 
 <ul><li> <p id="main-toc"><strong>目录</strong></p> </li><li> <p style="margin-left:0px;"><a href="#%E4%B8%80%E3%80%81topo%E7%BB%93%E6%9E%84" rel="nofollow">一、topo结构</a></p> </li><li> <p style="margin-left:0px;"><a href="#%E4%BA%8C%E3%80%81%E9%85%8D%E7%BD%AEtopo" rel="nofollow">二、配置topo</a></p> 
   <ul><li> <p style="margin-left:0px;"><a href="#%E7%AC%AC%E4%B8%80%E6%AD%A5%EF%BC%9A%E9%85%8D%E7%BD%AEIP%E5%9C%B0%E5%9D%80%E5%92%8Cisis%E5%8D%8F%E8%AE%AE%E4%BD%BF%E5%85%A8%E7%BD%91%E4%BA%92%E9%80%9A" rel="nofollow">第一步：配置IP地址和isis协议使全网互通</a></p> </li><li> <p style="margin-left:0px;"><a href="#%E7%AC%AC%E4%BA%8C%E6%AD%A5%E3%80%81%E6%B5%8B%E8%AF%95%E7%BD%91%E7%BB%9C%E8%81%94%E9%80%9A%E6%80%A7%C2%A0" rel="nofollow">第二步、测试网络联通性 </a></p> </li><li> <p style="margin-left:0px;"><a href="#%E7%AC%AC%E4%B8%89%E6%AD%A5%E3%80%81%E9%85%8D%E7%BD%AEMPLS%20LDP%E5%A4%9A%E5%8D%8F%E8%AE%AE%E6%A0%87%E7%AD%BE%E8%BD%AC%E5%8F%91%C2%A0" rel="nofollow">第三步、配置MPLS LDP多协议标签转发 </a></p> </li><li> <p style="margin-left:0px;"><a href="#%E2%80%8B%E7%BC%96%E8%BE%91%C2%A0%E7%AC%AC%E5%9B%9B%E6%AD%A5%E3%80%81%E6%8A%93%E5%8C%85%E5%88%86%E6%9E%90MPLS%20LDP%C2%A0" rel="nofollow">第四步、抓包分析MPLS LDP </a></p> </li><li> <p id="%E6%80%BB%E7%BB%93-toc" style="margin-left:0px;"><a href="#%E6%80%BB%E7%BB%93" rel="nofollow">总结</a></p> </li></ul></li></ul> 
</div> 
<hr> 
<h2 id="%E5%89%8D%E8%A8%80"><a id="_12"></a><strong>新的一年开始了，在这里先祝大家兔年快乐，哈哈哈哈</strong></h2> 
<p style="text-align:center;"><img alt="" height="953" src="https://images2.imgbox.com/52/8e/0MsXgqLU_o.jpg" width="1080"></p> 
<p> </p> 
<h2>前言</h2> 
<p>MPLS是一种根根据标签报文中携带的短而定长的标签来转发数据的技术MPLS的一个基本概念就是两台LSR必须对在它们之间转发的数据的标签使用上“达成共识”。</p> 
<p>LSR之间可以运行标签分发协议( Label Distribution Protocol，LDP)来告知其他LSR本设备上的标签绑定信息，从而实现标签报文的正确转发。</p> 
<p>LDP是MPLS的一种控制协议，相当于传统网络中的信令协议，负责FEC的分类、标签的分配以及LSP的建立和维护等操作。LDP规定了标签分发过程中的各种消息以及相关处理过程<br> LDP的工作过程主要分为两部分<br> 1.LSR之间建立LDP会话<br> 2.LSR之间基于LDP会话动态交换标签与FEC的映射信息，并根据标签信息建立LSP</p> 
<p>LDP的会话建立是可靠传输，类似于TCP的三次握手。</p> 
<p>发现阶段</p> 
<p>设备通过周期性地发送LDP链路Hello报文 (LDPLink Hello)，实现LDP基本发现机制。LDP链路Hello报文使用UDP报文，目的地址是组播地址224.0.0.2。如果LSR在特定接口接收到LDP链路Hello报文，表明该接口存在LDP邻接体</p> 
<p>TCP建立阶段</p> 
<p>Hello报文中携带传输地址，双方后续将使用传输地址建立LDP会话<br> 传输地址较大的一方作为主动方，主动发起建立TCP连接<br> 经过TCP三次握手之后，两者建立起TCP连接。</p> 
<p>TCP连接建立成功后，主动方R2(传输地址大的一方)发送LDP初始化报文，协商建立LDP会话的相关参数。<br> LDP会话的相关参数包括LDP协议版本、标签分发方式、KeepAlive保持定时器的值、最大PDU长度和标签空间等。<br> 被动方R1收到初始化报文后，若接受R2的相关参数则回应KeepAlive报文作为确认，为了提高发送效率同时发送自己的初始化报文。<br> R2收到R1的初始化报文后，若接受相关参数，则回复KeepAlive报文给R1。<br> 双方都收到对端的KeepAlive报文后，会话建立成功后续通过周期性发送的KeepAlive报文</p> 
<hr> 
<p><strong>下面来看实验吧</strong></p> 
<h2 id="%E4%B8%80%E3%80%81topo%E7%BB%93%E6%9E%84"><a id="_26"></a>一、topo结构</h2> 
<p><img alt="" height="381" src="https://images2.imgbox.com/5b/c2/g0LqQZs6_o.png" width="1200"></p> 
<h3 id="%E4%BA%8C%E3%80%81%E9%85%8D%E7%BD%AEtopo"><a id="1_27"></a>二、配置topo</h3> 
<h4 id="%E7%AC%AC%E4%B8%80%E6%AD%A5%EF%BC%9A%E9%85%8D%E7%BD%AEIP%E5%9C%B0%E5%9D%80%E5%92%8Cisis%E5%8D%8F%E8%AE%AE%E4%BD%BF%E5%85%A8%E7%BD%91%E4%BA%92%E9%80%9A">第一步：配置IP地址和isis协议使全网互通</h4> 
<p><img alt="" height="362" src="https://images2.imgbox.com/a0/63/VomgUC1v_o.png" width="799"> </p> 
<p><img alt="" height="142" src="https://images2.imgbox.com/18/83/gldnDypl_o.png" width="801"> </p> 
<p><img alt="" height="359" src="https://images2.imgbox.com/43/da/lWnzNY0v_o.png" width="806"> </p> 
<p><img alt="" height="145" src="https://images2.imgbox.com/25/e0/gKT4ME2F_o.png" width="797"> </p> 
<p><img alt="" height="345" src="https://images2.imgbox.com/64/8b/j2lodQ0l_o.png" width="797"> </p> 
<p><img alt="" height="142" src="https://images2.imgbox.com/b3/c0/51JIjqO5_o.png" width="805"> </p> 
<p><img alt="" height="348" src="https://images2.imgbox.com/70/e3/iRZzdvha_o.png" width="799"> </p> 
<p><img alt="" height="141" src="https://images2.imgbox.com/cf/b2/GKWa3J9p_o.png" width="793"> </p> 
<h4 id="%E7%AC%AC%E4%BA%8C%E6%AD%A5%E3%80%81%E6%B5%8B%E8%AF%95%E7%BD%91%E7%BB%9C%E8%81%94%E9%80%9A%E6%80%A7%C2%A0">第二步、测试网络联通性 </h4> 
<p><img alt="" height="276" src="https://images2.imgbox.com/63/c0/OYYvvGjj_o.png" width="803"></p> 
<p><img alt="" height="268" src="https://images2.imgbox.com/84/de/EGQuGn7m_o.png" width="799"> </p> 
<h4 id="%E7%AC%AC%E4%B8%89%E6%AD%A5%E3%80%81%E9%85%8D%E7%BD%AEMPLS%20LDP%E5%A4%9A%E5%8D%8F%E8%AE%AE%E6%A0%87%E7%AD%BE%E8%BD%AC%E5%8F%91%C2%A0">第三步、配置MPLS LDP多协议标签转发 </h4> 
<p><img alt="" height="228" src="https://images2.imgbox.com/d5/ac/wzswSg9d_o.png" width="792"></p> 
<p>接口要开启mpls ldp协议 </p> 
<h4 id="%E2%80%8B%E7%BC%96%E8%BE%91%C2%A0%E7%AC%AC%E5%9B%9B%E6%AD%A5%E3%80%81%E6%8A%93%E5%8C%85%E5%88%86%E6%9E%90MPLS%20LDP%C2%A0"><img alt="" height="68" src="https://images2.imgbox.com/89/3f/m43cIR91_o.png" width="802"> 第四步、抓包分析MPLS LDP </h4> 
<p><img alt="" height="619" src="https://images2.imgbox.com/3a/3a/dRi6Yj7a_o.png" width="985"></p> 
<p> </p> 
<p><strong>可以看到传输地址为1.1.1.1 用来做后续的ldp建立</strong> </p> 
<p><strong>配置好AR2的MPLS LDP 来查看端口建立</strong></p> 
<p><img alt="" height="143" src="https://images2.imgbox.com/c1/96/Av47B15m_o.png" width="806"></p> 
<p><img alt="" height="66" src="https://images2.imgbox.com/d2/74/wl6boQTa_o.png" width="802"> </p> 
<p><img alt="" height="65" src="https://images2.imgbox.com/91/cd/M3CtaNyN_o.png" width="805"> </p> 
<p> </p> 
<p><strong>抓包分析MPLS LDP </strong></p> 
<p><img alt="" height="337" src="https://images2.imgbox.com/d2/e2/E85mtnSK_o.png" width="960"></p> 
<p><strong>这里我们可以看到TCP 的三次握手，也就是说明会话建立完成了</strong></p> 
<p><img alt="" height="619" src="https://images2.imgbox.com/34/6e/23YJ5It6_o.png" width="944"> </p> 
<p style="margin-left:0;text-align:justify;"><strong>可以看到会话接收端是2.2.2.2 保证建立成功</strong></p> 
<p style="margin-left:0;text-align:justify;"><strong>同理配置完AR3 AR4</strong></p> 
<p style="margin-left:0;text-align:justify;"><img alt="" height="150" src="https://images2.imgbox.com/6b/e8/88qI6g1m_o.png" width="803"></p> 
<p> <img alt="" height="163" src="https://images2.imgbox.com/36/e6/VEh2UQm4_o.png" width="797"></p> 
<p><img alt="" height="150" src="https://images2.imgbox.com/97/60/xwjGpYk8_o.png" width="804"> </p> 
<p><img alt="" height="90" src="https://images2.imgbox.com/35/33/iZRbvbYC_o.png" width="807"> </p> 
<p><strong>用ping命令抓包查看MPLS LDP 标签</strong> </p> 
<p> <img alt="" height="276" src="https://images2.imgbox.com/97/67/tgLKPw1K_o.png" width="803"></p> 
<p><img alt="" height="422" src="https://images2.imgbox.com/21/97/BZaQ9wLu_o.png" width="821"> </p> 
<p><img alt="" height="273" src="https://images2.imgbox.com/67/14/59g46JL0_o.png" width="773"> </p> 
<p><strong>查看标签分析MPLS ldp</strong></p> 
<p><strong>dis mpls lsp 查看标签分配</strong></p> 
<p><img alt="" height="939" src="https://images2.imgbox.com/63/40/s2Vv29fK_o.png" width="843"> </p> 
<p><img alt="" height="451" src="https://images2.imgbox.com/f6/b1/bBJJclt3_o.png" width="806"> </p> 
<p><img alt="" height="451" src="https://images2.imgbox.com/83/f4/IpEtKxzM_o.png" width="803"> </p> 
<p> <strong>可以看到AR3将入标签置换成3了</strong></p> 
<p><img alt="" height="441" src="https://images2.imgbox.com/f5/73/qqpKCsfM_o.png" width="863"></p> 
<p><img alt="" height="85" src="https://images2.imgbox.com/9b/fa/MY4pvyCH_o.png" width="813"> </p> 
<p style="margin-left:0;"><strong>Dod是下游往上游分配标签的（按需求的）就是我需要访问才分配,收到标签请求才会向上游发</strong></p> 
<p style="margin-left:0;"><strong>Du 自动向上游发送标签</strong></p> 
<p style="margin-left:0;text-align:justify;"><strong>两边的标签分配方式必须一样</strong></p> 
<p style="margin-left:0;text-align:justify;"><img alt="" height="84" src="https://images2.imgbox.com/9b/b1/B2gmKe4O_o.png" width="809"></p> 
<p><img alt="" height="89" src="https://images2.imgbox.com/82/48/CagC0e0Z_o.png" width="812"> </p> 
<p><img alt="" height="498" src="https://images2.imgbox.com/bc/ee/bn42TE32_o.png" width="1200"> </p> 
<p><strong>标签请求包，可以看到是2.2.2.2 向1.1.1.1去请求</strong> 。</p> 
<p style="text-align:center;"><code class="language-c">看到这里都比个♥</code></p> 
<p style="text-align:center;"><img alt="" height="471" src="https://images2.imgbox.com/99/9e/lhUxwXWt_o.gif" width="471"></p> 
<hr> 
<p> </p> 
<h2 id="%E6%80%BB%E7%BB%93"><a id="_55"></a>总结</h2> 
<p>MPLS体系有多种标签分配协议，LDP标签分配协议是这些协议中使用较广的一种LDP是LSR之间协商标签含义的过程。LDP协议使用发现、会话、通告、通知四类报文进行会话的建立和标签的分发。<br> LDP通过标签发布方式、标签分配控制方式和标签保持方式来决定标签的发布和管理。华为数通产品默认的方式为:下游自主标签发布方式+有序标签分配控制方式+自由标签保持方式。利用LDP可以实现将网络层的路由信息直接映射到标签信息，进而建立起标签交换路径(LSP)。LSR之间将依据本地转发表中对应于一个特定FEC的入标签、下一跳节点、出标签等信息连接在一起，从而形成跨越整个MPLS域的标签交换路径</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/11d325dfec27255495965265a805a2a2/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">洛谷P5706 题解</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/893c9c2dbb8398913e2e85d23c05d0cf/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Mysql两表 join 查询方式</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>