<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>openssh9.0/9.2/9.3p1升级后客户端连不上问题处理 —— 筑梦之路 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="openssh9.0/9.2/9.3p1升级后客户端连不上问题处理 —— 筑梦之路" />
<meta property="og:description" content="现象和原因： openssh升级新版本后，旧的算法不再支持，导致CRT工具远程连接的时候连接不上 （旧的客户端不能连接新的服务端） 解决办法： 在ssh服务端配置添加配置如下： #添加支持的加密算法 KexAlgorithms diffie-hellman-group1-sha1,diffie-hellman-group14-sha1,diffie-hellman-group-exchange-sha1,diffie-hellman-group-exchange-sha256,ecdh-sha2-nistp256,ecdh-sha2-nistp384,ecdh-sha2-nistp521,diffie-hellman-group1-sha1,curve25519-sha256@libssh.org #添加ssh-rsa算法 HostKeyAlgorithms &#43;ssh-rsa https://www.openssh.com/txt/release-8.8
http://www.openssh.com/releasenotes.html#9.0
参考：
ssh连接不上解决_aiqing0119的博客-CSDN博客_kexalgorithms
针对使用密钥方式登录服务器的升级步骤总结如下：
支持密钥&#43;密码方式访问 ----------------------------------------------------------- #备份现有的配置文件和权限文件 cp -rp /etc/ssh /etc/ssh_backup cp -rp /etc/pam.d/sshd /etc/pam.d/sshd_backup #上传升级包到服务器进行解压，切换到解压后的目录 cd openssh9.0p1 #关闭selinux，需要修改/etc/selinux/config disabled setenforce 0 #升级安装 yum localinstall -y ./openssh*.rpm #给文件授权 chmod 400 /etc/ssh/ssh_host_* #检查配置文件中是否开启允许root远程登录和密码登录，没有开启执行以下两句 echo &#39;PermitRootLogin yes&#39; &gt;&gt; /etc/ssh/sshd_config echo &#39;PasswordAuthentication yes&#39; &gt;&gt; /etc/ssh/sshd_config #修改配置 vim /etc/ssh/ssh_config Host * PubkeyAcceptedKeyTypes=&#43;ssh-rsa vim /etc/ssh/sshd_config HostKey /etc/ssh/ssh_host_rsa_key HostKey /etc/ssh/ssh_host_ecdsa_key HostKey /etc/ssh/ssh_host_ed25519_key StrictModes no PubkeyAuthentication yes AuthorizedKeysFile ." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/c5adc3ebe479d1181bcfebc588bf4d4f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-03-16T19:00:46+08:00" />
<meta property="article:modified_time" content="2023-03-16T19:00:46+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">openssh9.0/9.2/9.3p1升级后客户端连不上问题处理 —— 筑梦之路</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <pre><code class="language-bash">现象和原因：

openssh升级新版本后，旧的算法不再支持，导致CRT工具远程连接的时候连接不上

（旧的客户端不能连接新的服务端）


解决办法：

在ssh服务端配置添加配置如下：

#添加支持的加密算法
KexAlgorithms diffie-hellman-group1-sha1,diffie-hellman-group14-sha1,diffie-hellman-group-exchange-sha1,diffie-hellman-group-exchange-sha256,ecdh-sha2-nistp256,ecdh-sha2-nistp384,ecdh-sha2-nistp521,diffie-hellman-group1-sha1,curve25519-sha256@libssh.org

#添加ssh-rsa算法
HostKeyAlgorithms +ssh-rsa

</code></pre> 
<p><a href="https://www.openssh.com/txt/release-8.8" rel="nofollow" title="https://www.openssh.com/txt/release-8.8">https://www.openssh.com/txt/release-8.8</a></p> 
<p><a href="http://www.openssh.com/releasenotes.html#9.0" rel="nofollow" title="http://www.openssh.com/releasenotes.html#9.0">http://www.openssh.com/releasenotes.html#9.0</a></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/ff/f9/kjmqUycr_o.png"></p> 
<p>参考：</p> 
<p><a href="https://blog.csdn.net/aiqing0119/article/details/49022581" title="ssh连接不上解决_aiqing0119的博客-CSDN博客_kexalgorithms">ssh连接不上解决_aiqing0119的博客-CSDN博客_kexalgorithms</a></p> 
<p>针对使用密钥方式登录服务器的升级步骤总结如下：</p> 
<pre><code class="language-bash">支持密钥+密码方式访问
-----------------------------------------------------------

#备份现有的配置文件和权限文件
cp -rp /etc/ssh /etc/ssh_backup
cp -rp /etc/pam.d/sshd /etc/pam.d/sshd_backup

#上传升级包到服务器进行解压，切换到解压后的目录
cd openssh9.0p1
#关闭selinux，需要修改/etc/selinux/config disabled
setenforce 0
#升级安装
yum localinstall -y ./openssh*.rpm
#给文件授权
chmod 400 /etc/ssh/ssh_host_*
#检查配置文件中是否开启允许root远程登录和密码登录，没有开启执行以下两句
echo 'PermitRootLogin yes' &gt;&gt; /etc/ssh/sshd_config
echo 'PasswordAuthentication yes' &gt;&gt; /etc/ssh/sshd_config

#修改配置
vim /etc/ssh/ssh_config
Host *
PubkeyAcceptedKeyTypes=+ssh-rsa

vim /etc/ssh/sshd_config

HostKey /etc/ssh/ssh_host_rsa_key
HostKey /etc/ssh/ssh_host_ecdsa_key
HostKey /etc/ssh/ssh_host_ed25519_key
StrictModes no
PubkeyAuthentication yes
AuthorizedKeysFile .ssh/authorized_keys
#是否允许密码登陆，no为不允许
PasswordAuthentication yes
#如果密码和密钥都使用在末尾加上此行代码
#AuthenticationMethods publickey,password
#允许的加密算法
Pubkeyacceptedkeytypes ecdsa-sha2-nistp256-cert-v01@openssh.com,ecdsa-sha2-nistp384-cert-v01@openssh.com,ecdsa-sha2-nistp521-cert-v01@openssh.com,ssh-ed25519-cert-v01@openssh.com,rsa-sha2-512-cert-v01@openssh.com,rsa-sha2-256-cert-v01@openssh.com,ssh-rsa-cert-v01@openssh.com,ecdsa-sha2-nistp256,ecdsa-sha2-nistp384,ecdsa-sha2-nistp521,ssh-ed25519,rsa-sha2-512,rsa-sha2-256,ssh-rsa

#替换sshd授权文件内容
cat sshd &gt; /etc/pam.d/sshd
#重启服务
systemctl restart sshd &amp;&amp; systemctl enable sshd
#升级完成后清理
rm -rf /home/openssh9.0p1

#验证
ssh -V</code></pre> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/30e40cb458348700f1717469a08a80e0/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Android APP隐私合规检测工具Camille使用</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/954c2f536adb70d8c6be958684b1a5fd/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">qt designer stylesheet 设置字体加粗无效</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>