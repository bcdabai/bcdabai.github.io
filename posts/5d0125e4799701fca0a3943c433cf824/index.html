<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Jenkins构建多配置项目（Multi-configuration） - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Jenkins构建多配置项目（Multi-configuration）" />
<meta property="og:description" content="本文参考自Jenkins相关资料，结合本人实际使用情况编写。 相关文档：
《Jenkins：The Definitive Guide》 ——10.4 Multiconfiguration Build Jobs《Building a matrixproject》 可以解决的问题： 有时，我们希望项目能够根据不同参数、或不同环境来编译，若使用多个项目来实现，则有些浪费资源，那么最好是可以实现：在一个项目中，就能根据给出的不同参数来编译不同版本。 我这里以自定义参数为例。
思路 比如当前项目的参数有四种（非完整参数，简单举例而已）
python -Purpose test -version 1.0 python -Purpose release -version 1.0 python -Purpose test -version 1.1 python -Purpose release -version 1.1 可以看到 Purpose 和 version 参数是可变的，那我们可以利用两个变量将以上参数简化为一条：
python -Purpose %purp% -version 1.%ver% 其中的 purp 可取值为 test 或 release，ver 可取值为 0 或 1.
有了目标，接下来就是在Jenkins中的应用实践。
步骤 1、需要新建一个任务，类型为：构建一个多配置项目（Build multi-configuration project） 2、其他设置与一般任务相同，只是多了一个模块 Configuration Matrix a）在Add axis中，选择User-defined Axis，本例需要两个变量，所以需要再增加一个User-defined Axis b）这里定义变量和对应的值，Name中是变量名，Values中是变量可取的值，中间以空格或回车隔开（注意：当可取值比较复杂的时候，建议每个值用英文双引号隔离，值之间仍以空格、回车隔开），如图，填入前面提过的变量和值，此时 purp 和 ver 就是可以在构建参数中直接使用的变量了 c）这个模块的下方有两个可选项需要注意：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/5d0125e4799701fca0a3943c433cf824/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-07-24T20:29:32+08:00" />
<meta property="article:modified_time" content="2018-07-24T20:29:32+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Jenkins构建多配置项目（Multi-configuration）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>本文参考自Jenkins相关资料，结合本人实际使用情况编写。 <br> 相关文档：</p> 
<ul><li>《Jenkins：The Definitive Guide》 ——10.4 Multiconfiguration Build Jobs</li><li><a href="https://wiki.jenkins.io/display/JENKINS/Building+a+matrix+project" rel="nofollow">《Building a matrixproject》</a></li></ul> 
<h4 id="可以解决的问题">可以解决的问题：</h4> 
<p>有时，我们希望项目能够根据不同参数、或不同环境来编译，若使用多个项目来实现，则有些浪费资源，那么最好是可以实现：在一个项目中，就能根据给出的不同参数来编译不同版本。 <br> 我这里以自定义参数为例。</p> 
<h4 id="思路">思路</h4> 
<p>比如当前项目的参数有四种（非完整参数，简单举例而已）</p> 
<pre class="prettyprint"><code class=" hljs lasso">python <span class="hljs-attribute">-Purpose</span> test <span class="hljs-attribute">-version</span> <span class="hljs-number">1.0</span>
python <span class="hljs-attribute">-Purpose</span> release <span class="hljs-attribute">-version</span> <span class="hljs-number">1.0</span>
python <span class="hljs-attribute">-Purpose</span> test <span class="hljs-attribute">-version</span> <span class="hljs-number">1.1</span>
python <span class="hljs-attribute">-Purpose</span> release <span class="hljs-attribute">-version</span> <span class="hljs-number">1.1</span></code></pre> 
<p>可以看到 Purpose 和 version 参数是可变的，那我们可以利用两个变量将以上参数简化为一条：</p> 
<pre class="prettyprint"><code class=" hljs mel"><span class="hljs-keyword">python</span> -Purpose <span class="hljs-variable">%purp</span>% -version <span class="hljs-number">1.</span><span class="hljs-variable">%ver</span>%</code></pre> 
<p>其中的 purp 可取值为 <code>test</code> 或 <code>release</code>，ver 可取值为 <code>0</code> 或 <code>1</code>.</p> 
<p>有了目标，接下来就是在Jenkins中的应用实践。</p> 
<h4 id="步骤">步骤</h4> 
<p><strong>1、需要新建一个任务，类型为：</strong><code>构建一个多配置项目（Build multi-configuration project）</code> <br> <img src="https://images2.imgbox.com/26/d3/nxr7FyEb_o.jpg" alt="这里写图片描述" title=""></p> 
<p><strong>2、其他设置与一般任务相同，只是多了一个模块</strong> <code>Configuration Matrix</code> </p> 
<p>a）在<code>Add axis</code>中，选择<code>User-defined Axis</code>，本例需要两个变量，所以需要再增加一个<code>User-defined Axis</code> <br> <img src="https://images2.imgbox.com/6e/04/yq9PZXLB_o.jpg" alt="这里写图片描述" title=""></p> 
<p>b）这里定义变量和对应的值，<code>Name</code>中是变量名，<code>Values</code>中是变量可取的值，中间以空格或回车隔开（注意：当可取值比较复杂的时候，建议每个值用英文双引号隔离，值之间仍以空格、回车隔开），如图，填入前面提过的变量和值，此时 <code>purp</code> 和 <code>ver</code> 就是可以在构建参数中直接使用的变量了 <br> <img src="https://images2.imgbox.com/0d/87/ws73Gxfu_o.jpg" alt="这里写图片描述" title=""></p> 
<p>c）这个模块的下方有两个可选项需要注意：</p> 
<ul><li><strong>Combination Filter</strong> <br> 这个是过滤器，目前我们定义了两个变量，也就是说最后会得到 2*2=4 个版本，而有时我们并不想拿到所有组合的版本，那么这个过滤器就可以起作用了，比如我们不想编译 <code>python -Purpose test -version 1.1</code>这个版本，过滤方法如图。 <br> BTW，当有多个版本要过滤时，可以使用括号和 || 分隔，如： <br> <code>(purp == "test" &amp;&amp; ver != "1") || (purp == "test" &amp;&amp; ver != "0")</code> <br> <img src="https://images2.imgbox.com/52/2e/lfnlBDbw_o.jpg" alt="这里写图片描述" title=""></li><li><strong>Run each configuration sequentially</strong> <br> 这个是指定所有版本要按顺序编译，建议勾选</li></ul> 
<p><strong>3、构建参数</strong> <br> 以上我们已经得到所需变量，那就可以在构建中写入完整的参数配置，这里选择的是Windows 批处理命令（注意：使用变量的方式因命令而异，比如windows下的变量使用%，所以这里用的是 <code>%purp%</code> 和 <code>%ver%</code>）</p> 
<p><code>python -Purpose %purp% -version 1.%ver%</code> <br> <img src="https://images2.imgbox.com/0f/ef/wlfUqq9m_o.jpg" alt="这里写图片描述" title=""></p> 
<p><strong>4、保存后，查看项目，有一个参数矩阵，通过圆球可以对每个版本的构建结果一目了然</strong>（注意这里的0和1是我们刚刚定义的变量值，不是序号） <br> <img src="https://images2.imgbox.com/eb/0a/ddsnD1h9_o.jpg" alt="这里写图片描述" title=""></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/de1de1d82673d8b879202a8fe20a6f34/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">解决IDEA2018.1.5的输入法不跟随问题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/465eb18a326e1d9fa09a818f9d1e700b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">旋转数组（python）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>