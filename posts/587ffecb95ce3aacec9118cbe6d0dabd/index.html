<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>获取摄像头权限，并且在video元素上呈现出来 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="获取摄像头权限，并且在video元素上呈现出来" />
<meta property="og:description" content="判断摄像头兼容问题 &lt;video id=&#34;video&#34;&gt;&lt;/video&gt;
// 定义方法访问用户媒体设备的兼容方法
function getUserMedia(constraints, success, error) {
if (navigator.mediaDevices.getUserMedia) {
console.log(&#34;最新的标准API&#34;);
navigator.mediaDevices.getUserMedia(constraints).then(success).catch(error);
} else if (navigator.webkitGetUserMedia) {
console.log(&#34;webkit核心浏览器&#34;);
navigator.webkitGetUserMedia(constraints, success, error)
} else if (navigator.mozGetUserMedia) {
console.log(&#34;firfox浏览器&#34;);
navigator.mozGetUserMedia(constraints, success, error);
} else if (navigator.getUserMedia) {
console.log(&#34;旧版API&#34;);
navigator.getUserMedia(constraints, success, error);
}
}
获取videoDOM元素，并且让video承接画面(注意：每次调用都需要重新获取权限) // 获取元素节点
let video = document.getElementById(&#34;video&#34;);
let mode = &#34;user&#34; // 设置使用environment后置摄像头,user为前置摄像头
// 封装开启摄像头方法
function getCamera() {
// 判断用户的兼容，并作出对应的处理
if (navigator.mediaDevices.getUserMedia || navigator.getUserMedia || navigator." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/587ffecb95ce3aacec9118cbe6d0dabd/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-07T15:15:26+08:00" />
<meta property="article:modified_time" content="2023-02-07T15:15:26+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">获取摄像头权限，并且在video元素上呈现出来</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h4>判断摄像头兼容问题</h4> 
<blockquote> 
 <p>&lt;video id="video"&gt;&lt;/video&gt;</p> 
</blockquote> 
<blockquote> 
 <p>// 定义方法访问用户媒体设备的兼容方法</p> 
 <p>    function getUserMedia(constraints, success, error) {<!-- --></p> 
 <p>      if (navigator.mediaDevices.getUserMedia) {<!-- --></p> 
 <p>        console.log("最新的标准API");</p> 
 <p>        navigator.mediaDevices.getUserMedia(constraints).then(success).catch(error);</p> 
 <p>      } else if (navigator.webkitGetUserMedia) {<!-- --></p> 
 <p>        console.log("webkit核心浏览器");</p> 
 <p>        navigator.webkitGetUserMedia(constraints, success, error)</p> 
 <p>      } else if (navigator.mozGetUserMedia) {<!-- --></p> 
 <p>        console.log("firfox浏览器");</p> 
 <p>        navigator.mozGetUserMedia(constraints, success, error);</p> 
 <p>      } else if (navigator.getUserMedia) {<!-- --></p> 
 <p>        console.log("旧版API");</p> 
 <p>        navigator.getUserMedia(constraints, success, error);</p> 
 <p>      }</p> 
 <p>    }</p> 
</blockquote> 
<h4>获取videoDOM元素，并且让video承接画面(注意：每次调用都需要重新获取权限)</h4> 
<blockquote> 
 <p>// 获取元素节点</p> 
 <p>let video = document.getElementById("video");</p> 
 <p>let mode = "user"  // 设置使用environment后置摄像头,user为前置摄像头</p> 
 <p>// 封装开启摄像头方法</p> 
 <p>function getCamera() {<!-- --></p> 
 <p>// 判断用户的兼容，并作出对应的处理</p> 
 <p>      if (navigator.mediaDevices.getUserMedia || navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia) {<!-- --></p> 
 <p>        //调用用户媒体设备, 访问摄像头</p> 
 <p>        getUserMedia({<!-- --></p> 
 <p>        // 获取摄像头</p> 
 <p>          video: {<!-- --></p> 
 <p>            width: 400,  // 默认单位px</p> 
 <p>            height: 300,</p> 
 <p>            facingMode:  mode, </p> 
 <p>          },</p> 
 <p>        // 获取麦克风</p> 
 <p>          audio: true</p> 
 <p>        }, success, error);       </p> 
 <p>      } else {<!-- --></p> 
 <p>        console.log("不支持访问用户媒体");</p> 
 <p>      }</p> 
 <p>    }</p> 
 <p>    // 调用成功的回调</p> 
 <p>    function success(stream) {     </p> 
 <p>      //兼容webkit核心浏览器</p> 
 <p>      let CompatibleURL = window.URL || window.webkitURL;</p> 
 <p>      //将视频流设置为video元素的源</p> 
 <p>      mediaStreamTrack = stream.getTracks()[0];     </p> 
 <p>      video.srcObject = stream;</p> 
 <p>      video.play();</p> 
 <p>    }</p> 
 <p>    // 调用失败的回调</p> 
 <p>    function error(error) {<!-- --></p> 
 <p>      console.log("error", error);</p> 
 <p>      console.log("访问用户媒体设备失败,请尝试更换浏览器");</p> 
 <p>    }</p> 
</blockquote> 
<h4>切换前后摄像头</h4> 
<blockquote> 
 <p>function changeMode() {<!-- --></p> 
 <p>      mode = mode == "user" ? "environment" : "user";</p> 
 <p>      mediaStreamTrack.stop();</p> 
 <p>      getCamera();</p> 
 <p>}</p> 
</blockquote> 
<h4>对当前video元素截图(拍照功能)需要配合canvas标签使用</h4> 
<blockquote> 
 <p>&lt;button id="getPhoto"&gt;拍照&lt;/button&gt;</p> 
 <p>&lt;canvas id="canvas" width="400" height="300"&gt;&lt;/canvas&gt;</p> 
</blockquote> 
<blockquote> 
 <p>let canvas = document.getElementById('canvas');</p> 
 <p>let context = canvas.getContext('2d');</p> 
 <p>// 对按钮添加点击事件(通过DOM0级绑定方便之后事件的解绑-对事件置空即可)</p> 
 <p>document.getElementById('capture').onclick = function () {<!-- --></p> 
 <p>      context.drawImage(video, 0, 0, 400, 300);</p> 
 <p>    }</p> 
</blockquote> 
<h4>点击下载照片</h4> 
<blockquote> 
 <p>&lt;button id="download"&gt;下载&lt;/button&gt;</p> 
</blockquote> 
<blockquote> 
 <p>    document.getElementById('download').onclick = () =&gt; {<!-- --></p> 
 <p>      let photoElement = document.createElement('a');</p> 
 <p>      photoElement.href = canvas.toDataURL('image/png');</p> 
 <p>      photoElement.download = '照片名称';</p> 
 <p>      document.body.append(photoElement);</p> 
 <p>      photoElement.click();</p> 
 <p>      document.body.removeChild(photoElement)</p> 
 <p>    };</p> 
</blockquote> 
<h4></h4> 
<p></p> 
<p></p> 
<p></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/de19e393cec42aa38eb512b690e5e438/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">PHP - php7扩展安装的完全攻略 swoole、yaf、grpc</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f27e4e6ec8a0587935fcd4770d6c331e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">小程序和H5页面的相互跳转</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>