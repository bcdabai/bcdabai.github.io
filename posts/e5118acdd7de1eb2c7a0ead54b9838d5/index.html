<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>STM32串口IAP实验中的地址问题 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="STM32串口IAP实验中的地址问题" />
<meta property="og:description" content="if(((*(vu32*)(0X20001000&#43;4))&amp;0xFF000000)==0x08000000）和if(((*(vu32*)appxaddr)&amp;0x2FFE0000)==0x20000000)分析
首先要清楚：0x8000000是Flash的起始地址，0x20000000是SRAM的起始地址。jump2app()是一个虚拟函数（函数指针）
(*(vu32*)(0X20001000&#43;4))== (*(__IO uint32_t*)(0X20001000&#43;4))
==(*(volatile unsigned int*)(0X20001000&#43;4))
(*(vu32*)(0X20001000&#43;4)) 通过内存寻址访问地址为（0x20001000 &#43; 4)中的值
(0X20001000&#43;4)只是一个常量；
(volatile unsigned int*)(0X20001000&#43;4) 将0x20001000 &#43; 4这个常量强制转化成volatile unsigned int类型的指针；
(*(volatile unsigned int*)(0X20001000&#43;4)) 相对于取0x20001000 &#43; 4地址处的值
程序设置把串口接收来的数据从0x20001000开始存储，第一个4个字节为栈顶地址，第二个4字节为复位中断向量的入口地址，接下来&#43;8，将会是NMI中断服务函数的入口地址， &#43;12，将会是HardFault的服务函数入口地址... STM32程序地址从 0X08000000 开始 执行，PC机也是从硬盘上的 0X08000000 地址开始执行。前四个字节是栈顶地址main()函数式主函数，也有个栈顶地址，其他函数一样，在调用跳转之前，将其对应的函数栈地址保存起来。 BootLoader程序先烧进Flash里，它的栈顶地址从0X08000000开始，4字节栈顶地址数据空间，然后是各种中断服务地址。。。 当收到APP程序时（它自己已经定义好了，收到APP文件后写道0X08000000&#43;N这个地址上），它要把APP程序写到0X08000000&#43;N上，因此，它需要首先判断一下APP程序在MDK中编译生成.bin文件后否是遵循这个0X08000000&#43;N这个地址。如果和Bootloader要求的一样，那么就是正确的文件。
而appxaddr存放的是用户程序Flash的首地址，(*(volatile u32*)appxaddr)的意思是取用户程序首地址里面的数据，这个数据就是用户代码的堆栈地址，堆栈地址指向RAM，而RAM的起始地址是0x20000000，因此上面的判断语句执行：判断用户代码的堆栈地址是否落在:0x20000000~0x2001ffff区间中。
注：这里面的（0X20001000&#43;4）和我们在SRAM里的起始地址 0X20001000 有什么关系呢？
我们选择0X20001000，就是留下SRAM区域的前4K SRAM给IAP程序使用。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/e5118acdd7de1eb2c7a0ead54b9838d5/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-07-06T08:55:30+08:00" />
<meta property="article:modified_time" content="2017-07-06T08:55:30+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">STM32串口IAP实验中的地址问题</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="font-family:Arial; line-height:26px"><span style="font-weight:bold"><span lang="EN-US" style="font-family:Arial,sans-serif"><span style="color:#333333"><span style="font-size:24px">if(((*(vu32*)(0X20001000+4))&amp;0xFF000000)==0x08000000）和<code class="c keyword bold" style="word-wrap:break-word; line-height:13.2px; white-space:pre; outline:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; margin:0px!important; overflow:visible!important; padding:0px!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; font-weight:bold!important; min-height:auto!important; background-color:initial!important">if</code><code class="c plain" style="word-wrap:break-word; line-height:13.2px; white-space:pre; outline:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; margin:0px!important; overflow:visible!important; padding:0px!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; min-height:auto!important; background-color:initial!important">(((*(vu32*)appxaddr)&amp;0x2FFE0000)==0x20000000)分析</code></span></span></span></span></p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> <strong><span lang="EN-US" style="font-family:Arial,sans-serif; font-size:8pt"><code class="c plain" style="word-wrap:break-word; line-height:13.2px; white-space:pre; outline:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; margin:0px!important; overflow:visible!important; padding:0px!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; min-height:auto!important; background:none!important"><br> </code></span></strong></p> 
<p style="color:rgb(51,51,51); font-family:Arial; line-height:26px"><span style="font-weight:bold"><span lang="EN-US" style="font-family:Arial,sans-serif"><code class="c plain" style="word-wrap:break-word; line-height:13.2px; white-space:pre; outline:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; margin:0px!important; overflow:visible!important; padding:0px!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; min-height:auto!important"><span style="font-size:14px"><span style="font-family:Tahoma,'Microsoft Yahei',Simsun; line-height:22.5px; background-color:rgb(255,255,255)">首先要清楚：0x8000000是Flash的起始地址，0x20000000是SRAM的起始地址。jump2app()是一个虚拟函数（<span style="font-family:Tahoma,'Microsoft Yahei',Simsun; line-height:21px">函数指针</span>）</span><br> </span></code></span></span></p> 
<span style="font-size:14px"><span style="color:rgb(51,51,51); line-height:26px; font-family:宋体"></span><span style="color:rgb(51,51,51); font-family:Arial; line-height:26px"></span></span> 
<p style="color:rgb(51,51,51); font-family:Arial; line-height:26px"><span lang="EN-US" style="font-family:Arial,sans-serif"><span style="font-size:14px">(*(vu32*)(0X20001000+4))== (*(__IO uint32_t*)(0X20001000+4))</span></span></p> 
<span style="font-size:14px"><span style="color:rgb(51,51,51); line-height:26px; font-family:宋体"></span><span style="color:rgb(51,51,51); font-family:Arial; line-height:26px"></span></span> 
<p style="color:rgb(51,51,51); font-family:Arial; line-height:26px"><span lang="EN-US" style="font-family:Arial,sans-serif"><span style="font-size:14px">==(*(volatile unsigned int*)(0X20001000+4))</span></span></p> 
<span style="font-size:14px"><span style="color:rgb(51,51,51); line-height:26px; font-family:宋体"></span><span style="color:rgb(51,51,51); font-family:Arial; line-height:26px"></span></span> 
<p style="color:rgb(51,51,51); font-family:Arial; line-height:26px"><span style="font-size:14px"><span lang="EN-US" style="color:red; font-family:Arial,sans-serif">(*(vu32*)(0X20001000+4)) </span><span style="font-family:宋体">通过内存寻址访问地址为（</span><span lang="EN-US" style="font-family:Arial,sans-serif">0x20001000 + 4)</span><span style="font-family:宋体">中的值</span></span></p> 
<span style="font-size:14px"><span style="color:rgb(51,51,51); line-height:26px; font-family:宋体"></span><span style="color:rgb(51,51,51); font-family:Arial; line-height:26px"></span></span> 
<p style="color:rgb(51,51,51); font-family:Arial; line-height:26px"><span style="font-size:14px"><span lang="EN-US" style="color:red; font-family:Arial,sans-serif">(0X20001000+4)</span><span style="font-family:宋体">只是一个常量；</span></span></p> 
<span style="font-size:14px"><span style="color:rgb(51,51,51); line-height:26px; font-family:宋体"></span><span style="color:rgb(51,51,51); font-family:Arial; line-height:26px"></span></span> 
<p style="color:rgb(51,51,51); font-family:Arial; line-height:26px"><span style="font-size:14px"><span lang="EN-US" style="color:red; font-family:Arial,sans-serif">(volatile unsigned int*)(0X20001000+4)</span><span lang="EN-US" style="font-family:Arial,sans-serif"> </span><span style="font-family:宋体">将</span><span lang="EN-US" style="font-family:Arial,sans-serif">0x20001000 + 4</span><span style="font-family:宋体">这个常量强制转化成</span><span lang="EN-US" style="font-family:Arial,sans-serif">volatile unsigned int</span><span style="font-family:宋体">类型的指针；</span></span></p> 
<span style="font-size:14px"><span style="color:rgb(51,51,51); line-height:26px; font-family:宋体"></span><span style="color:rgb(51,51,51); font-family:Arial; line-height:26px"></span></span> 
<p style="color:rgb(51,51,51); font-family:Arial; line-height:26px"><span style="font-size:14px"><span lang="EN-US" style="color:red; font-family:Arial,sans-serif">(*(volatile unsigned int*)(0X20001000+4))</span><span lang="EN-US" style="font-family:Arial,sans-serif"> </span><span style="font-family:宋体">相对于取</span><span lang="EN-US" style="font-family:Arial,sans-serif">0x20001000 + 4</span><span style="font-family:宋体">地址处的值</span></span></p> 
<p style="color:rgb(51,51,51); font-family:Arial; line-height:26px"><span style="font-size:14px"><span style="font-family:宋体"><br> </span></span></p> 
<span style="color:rgb(51,51,51); font-size:14px; line-height:26px; font-family:宋体"></span> 
<span style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"></span> 
<p style="color:rgb(51,51,51); font-family:Arial; line-height:26px"><span style="background-color:rgb(255,255,255)"><span style="font-size:14px"><span style="font-family:宋体">程序设置把串口接收来的数据从</span><span lang="EN-US" style="font-family:Arial,sans-serif">0x20001000</span><span style="font-family:宋体">开始存储，第一个</span><span lang="EN-US" style="font-family:Arial,sans-serif">4</span><span style="font-family:宋体">个字节为栈顶地址，第二个</span><span lang="EN-US" style="font-family:Arial,sans-serif">4</span></span></span><span style="font-family:宋体"><span style="background-color:rgb(255,255,255)"><span style="font-size:14px">字节为复位中断向量的入口地址，<span style="font-family:Tahoma,'Microsoft Yahei',Simsun; line-height:22.5px">接下来+8，将会是NMI中断服务函数的入口地址， +12，将会是HardFault的服务函数入口地址... </span></span></span></span></p> 
<p style="color:rgb(51,51,51); font-family:Arial; line-height:26px"><span style="font-family:宋体"><span style="background-color:rgb(255,255,255)"><span style="font-size:14px"><span style="font-family:Tahoma,'Microsoft Yahei',Simsun; line-height:22.5px"><br> </span></span></span></span></p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> <span style="font-size:8pt"><span style="font-family:宋体"><img src="" alt=""><img src="https://images2.imgbox.com/30/76/y8P6AjJT_o.png" alt=""><br> </span></span></p> 
<p style="font-family:Arial; line-height:26px"><span style="font-family:宋体; background-color:rgb(255,255,255)"><span style="font-size:14px"><span style="word-wrap:break-word; outline:none; font-family:Tahoma,'Microsoft Yahei',Simsun"><span style="color:#333333">      </span><span style="color:#330000">  STM32程序地址从 0X08000000 开始 执行，PC机也是从硬盘上的 0X08000000 地址开始执行。前四个字节是栈顶地址main()函数式主函数，也有个栈顶地址，其他函数一样，在调用跳转之前，将其对应的函数栈地址保存起来。 BootLoader程序先烧进Flash里，它的栈顶地址从0X08000000开始，4字节栈顶地址数据空间，然后是各种中断服务地址。。。</span></span><span style="color:#330000"><br style="word-wrap:break-word; outline:none; font-family:Tahoma,'Microsoft Yahei',Simsun; line-height:22.5px"> <span style="word-wrap:break-word; outline:none; font-family:Tahoma,'Microsoft Yahei',Simsun">       当收到APP程序时（它自己已经定义好了，收到APP文件后写道</span><span style="word-wrap:break-word; outline:none; font-family:Tahoma,'Microsoft Yahei',Simsun; line-height:21px">0X08000000+N这个地址上</span><span style="word-wrap:break-word; outline:none; font-family:Tahoma,'Microsoft Yahei',Simsun; line-height:1.5">），它要把APP程序写到0X08000000+N上，因此，它需要首先判断一下APP程序在MDK中编译生成.bin文件后否是遵循这个0X08000000+N这个地址。如果和Bootloader要求的一样，那么就是正确的文件。</span><br> </span></span></span></p> 
<p style="font-family:Arial; line-height:26px"><span style="font-family:宋体"><span style="word-wrap:break-word; outline:none; font-family:Tahoma,'Microsoft Yahei',Simsun; line-height:1.5; background-color:rgb(255,255,255)"><span style="font-family:Tahoma,'Microsoft Yahei',Simsun; line-height:21px"><span style="font-size:18px; color:#330000">     而appxaddr存放的是用户程序Flash的首地址，(*(volatile u32*)appxaddr)的意思是取用户程序首地址里面的数据，这个数据就是用户代码的堆栈地址，堆栈地址指向RAM，而RAM的起始地址是0x20000000，因此上面的判断语句执行：判断用户代码的堆栈地址是否落在:0x20000000~0x2001ffff区间中。</span></span><br> </span></span></p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> <span style="font-size:8pt"><span style="font-family:宋体"><span style="word-wrap:break-word; outline:none; font-family:Tahoma,'Microsoft Yahei',Simsun; font-size:14px; line-height:1.5; background-color:rgb(255,255,255)"><br> </span></span></span></p> 
<p style="color:rgb(51,51,51); font-family:Arial; line-height:26px"><span style="font-family:宋体"><span style="word-wrap:break-word; outline:none; font-family:Tahoma,'Microsoft Yahei',Simsun; line-height:1.5; background-color:rgb(255,255,255)"><span style="font-size:14px"><span style="font-family:Tahoma,'Microsoft Yahei',Simsun; line-height:22.5px">注：这里面的（0X20001000+4）和我们在SRAM里的起始地址 0X20001000 有什么关系呢？</span><br> </span></span></span></p> 
<p style="color:rgb(51,51,51); font-family:Arial; line-height:26px"><span style="font-family:宋体"><span style="word-wrap:break-word; outline:none; font-family:Tahoma,'Microsoft Yahei',Simsun; line-height:1.5"><span style="font-family:Tahoma,'Microsoft Yahei',Simsun; line-height:22.5px"><span style="font-family:Tahoma,'Microsoft Yahei',Simsun; line-height:22.5px; background-color:rgb(255,255,255)"><span style="font-size:14px">我们选择0X20001000，就是留下SRAM区域的前4K SRAM给IAP程序使用。</span></span><br> </span></span></span></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/75a671a9c9e57adfd41368bb42c4bf2b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">laravel5.4开启sql调试</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b180ac25866bd98d0441e1adc00e0161/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">搭建Elasticsearch 5.4 集群</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>