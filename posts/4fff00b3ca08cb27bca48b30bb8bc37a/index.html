<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Android studio&#43;opencv-4.1.0 开发环境搭建（一） - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Android studio&#43;opencv-4.1.0 开发环境搭建（一）" />
<meta property="og:description" content="最近在做一图像处理APP的时候需要用到opencv，发现从配置个方面都十分蛋疼，好在经过一番折腾，算是大概弄出来了，在这里大概说说，我用的是android studio开发环境，具体安装配置不再多说，直接从opencv开始。
opencv下载
opencv官网
先去官网下载，我在这里选择了目前的最新版4.1版，选择下载android版本的
下载好后，直接解压，不需要安装之类的步骤，进入解压后的文件夹会有四个文件
sdk是一些编译好的文件，包括.so和.a库，samples中是一些后面会用到的项目文件
然后打开android studio，新建项目，项目建好后，点击File，然后选择NEW，再选择Import Moudle…
(这里不知道为什么电脑抽筋了，没办法截图凑合看吧）
然后是如下界面
然后选择目录，选择opencv文件夹下的sdk，然后选择sdk中的java文件夹，确定即可，这里是我的目录，我之前吧opencv解压后的默认文件夹名称改了，所以按照你的电脑上的文件夹名称就可以了
之后他会让你写module名称
起好后next，会看到如下界面，这里默认就好，finish
这一步结束后，模块基本上导入成功了，但是有些文件还是需要该一下
吧你的项目app文件夹下的build.gradle文件直接拷贝到项目根目录下之前导入模板的文件夹中，文件夹名称就是你刚刚起的那个
例如我刚刚Module name起的是opencv，那我就去项目目录下找opencv文件夹，这个文件夹中原本就有一个build.gradle文件，直接覆盖替换掉就好了，当然也可以直接吧app文件夹里build.gradle的内容直接写道module的build.gradle中，吧module中原本build.gradle文件的内容全部清掉，我在这里用了第二种办法，可以直接在android studio里改，如图（绿色是module的build.gradle，红色是app的build.gradle）
其实这里怎么操作无所谓，只要保证两个build.gradle文件中的版本信息一样就行了
然后，把moudle中的build.gradle中的部分内容稍微改一下
先把apply plugin: &#39;com.android.application’改成apply plugin: ‘com.android.library’（app的build.gradle文件原样不动）
然后，把applicationId &#34;com.example.mplog&#34;这一句去掉
如图，上面是app的build.gradle，下面是module的build.gradle
之后直接在app的build.gradle文件中的dependencies 中加上implementation project(&#34;:你的module名称&#34;)
把
dependencies { implementation fileTree(dir: &#39;libs&#39;, include: [&#39;*.jar&#39;]) implementation &#39;com.android.support:appcompat-v7:28.0.0&#39; implementation &#39;com.android.support.constraint:constraint-layout:1.1.3&#39; testImplementation &#39;junit:junit:4.12&#39; androidTestImplementation &#39;com.android.support.test:runner:1.0.2&#39; androidTestImplementation &#39;com.android.support.test.espresso:espresso-core:3.0.2&#39; implementation &#39;com.android.support:design:28.0.0&#39; } 改成
dependencies { implementation fileTree(dir: &#39;libs&#39;, include: [&#39;*.jar&#39;]) implementation &#39;com.android.support:appcompat-v7:28.0.0&#39; implementation &#39;com.android.support.constraint:constraint-layout:1.1.3&#39; testImplementation &#39;junit:junit:4.12&#39; androidTestImplementation &#39;com." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/4fff00b3ca08cb27bca48b30bb8bc37a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-05-24T14:58:02+08:00" />
<meta property="article:modified_time" content="2019-05-24T14:58:02+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Android studio&#43;opencv-4.1.0 开发环境搭建（一）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>最近在做一图像处理APP的时候需要用到opencv，发现从配置个方面都十分蛋疼，好在经过一番折腾，算是大概弄出来了，在这里大概说说，我用的是android studio开发环境，具体安装配置不再多说，直接从opencv开始。<br> <strong>opencv下载</strong><br> <a href="https://opencv.org/" rel="nofollow">opencv官网</a><br> 先去官网下载，我在这里选择了目前的最新版4.1版，选择下载android版本的<br> <img src="https://images2.imgbox.com/0e/ce/ALtiKYGD_o.png" alt="在这里插入图片描述"><br> 下载好后，直接解压，不需要安装之类的步骤，进入解压后的文件夹会有四个文件<br> <img src="https://images2.imgbox.com/9f/29/mRrliUne_o.png" alt="在这里插入图片描述">sdk是一些编译好的文件，包括.so和.a库，samples中是一些后面会用到的项目文件</p> 
<p>然后打开android studio，新建项目，项目建好后，点击File，然后选择NEW，再选择Import Moudle…</p> 
<p>(这里不知道为什么电脑抽筋了，没办法截图凑合看吧）<br> 然后是如下界面<br> <img src="https://images2.imgbox.com/19/2f/SMPqJunG_o.png" alt="在这里插入图片描述"><br> 然后选择目录，选择opencv文件夹下的sdk，然后选择sdk中的java文件夹，确定即可，这里是我的目录，我之前吧opencv解压后的默认文件夹名称改了，所以按照你的电脑上的文件夹名称就可以了<br> <img src="https://images2.imgbox.com/c0/2c/y7dYeqU3_o.png" alt="在这里插入图片描述">之后他会让你写module名称<br> <img src="https://images2.imgbox.com/f5/37/vJ12Rfg4_o.png" alt="在这里插入图片描述">起好后next，会看到如下界面，这里默认就好，finish<br> <img src="https://images2.imgbox.com/f3/5e/CCv9iVg0_o.png" alt="在这里插入图片描述">这一步结束后，模块基本上导入成功了，但是有些文件还是需要该一下<br> 吧你的项目app文件夹下的build.gradle文件直接拷贝到项目根目录下之前导入模板的文件夹中，文件夹名称就是你刚刚起的那个<br> 例如我刚刚Module name起的是opencv，那我就去项目目录下找opencv文件夹，这个文件夹中原本就有一个build.gradle文件，直接覆盖替换掉就好了，当然也可以直接吧app文件夹里build.gradle的内容直接写道module的build.gradle中，吧module中原本build.gradle文件的内容全部清掉，我在这里用了第二种办法，可以直接在android studio里改，如图（绿色是module的build.gradle，红色是app的build.gradle）<br> <img src="https://images2.imgbox.com/a6/65/2uXie8Pz_o.png" alt="在这里插入图片描述"><br> 其实这里怎么操作无所谓，只要保证两个build.gradle文件中的版本信息一样就行了<br> 然后，把moudle中的build.gradle中的部分内容稍微改一下<br> 先把apply plugin: 'com.android.application’改成apply plugin: ‘com.android.library’（app的build.gradle文件原样不动）<br> 然后，把applicationId "com.example.mplog"这一句去掉<br> 如图，上面是app的build.gradle，下面是module的build.gradle</p> 
<p><img src="https://images2.imgbox.com/a8/13/aTdJKxOj_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/ec/98/9hJvGEyf_o.png" alt="在这里插入图片描述"><br> 之后直接在app的build.gradle文件中的dependencies 中加上implementation project(":你的module名称")<br> 把</p> 
<pre><code>dependencies {
    implementation fileTree(dir: 'libs', include: ['*.jar'])
    implementation 'com.android.support:appcompat-v7:28.0.0'
    implementation 'com.android.support.constraint:constraint-layout:1.1.3'
    testImplementation 'junit:junit:4.12'
    androidTestImplementation 'com.android.support.test:runner:1.0.2'
    androidTestImplementation 'com.android.support.test.espresso:espresso-core:3.0.2'
    implementation 'com.android.support:design:28.0.0'
}

</code></pre> 
<p>改成</p> 
<pre><code>dependencies {
    implementation fileTree(dir: 'libs', include: ['*.jar'])
    implementation 'com.android.support:appcompat-v7:28.0.0'
    implementation 'com.android.support.constraint:constraint-layout:1.1.3'
    testImplementation 'junit:junit:4.12'
    androidTestImplementation 'com.android.support.test:runner:1.0.2'
    androidTestImplementation 'com.android.support.test.espresso:espresso-core:3.0.2'
    implementation project(":opencv")
    implementation 'com.android.support:design:28.0.0'
}

</code></pre> 
<p>改后就把opencv的moudle导入进了你的项目<br> 之后就是最麻烦，也是之前让我纠结很长时间的东西，怎么调用Opencv函数，上面几步做完你会发现你还是不能直接调用opencv函数，不然你的APP可能会在手机上出现闪退或者其它问题，按照官方说法，应该是要在手机里安装对应的opencv Manager.apk才能运行，而在做开发的时候不可能指望用户为了用你的APP就让用户去下载一堆莫名其妙的APP，所以下面就来想办法免去Manager也能运行<br> 我之前也看了很多博客但是多少有点问题，最后发现一个最直接的办法，那就是直接用opencv官方的代码，先到之前opencv解压后的目录下，找到samples文件夹，到./samples/image-manipulations/src/org/opencv/samples/imagemanipulations/这个目录下去，寻找一个叫做ImageManipulationsActivity.java的文件，没错这就是我们要用的文件，把要显示摄像头捕捉到的画面的Activity的java文件换成这个内容，当然这个文件中有一些内容也是我们用不到的，我在这里吧我改后的代码粘贴出来，可以直接把我的这个代码复制到你的项目需要调用摄像头画面的activity的java文件中，包名类名之类的，根据自己的具体情况改一下</p> 
<pre><code>package com.example.mplog;
//这里的mplog是我的项目包名，注意
import java.util.Arrays;

import org.opencv.android.BaseLoaderCallback;
import org.opencv.android.CameraBridgeViewBase.CvCameraViewFrame;
import org.opencv.android.LoaderCallbackInterface;
import org.opencv.android.OpenCVLoader;
import org.opencv.core.*;
import org.opencv.android.CameraBridgeViewBase;
import org.opencv.android.CameraBridgeViewBase.CvCameraViewListener2;
import org.opencv.imgproc.Imgproc;

import org.opencv.imgproc.*;
import android.app.Activity;
import android.os.Bundle;
import android.util.Log;
import android.view.*;
import android.view.WindowManager;

public class Main2Activity extends Activity implements CvCameraViewListener2 {
    private static final String  TAG                 = "OCVSample::Activity";

    private CameraBridgeViewBase mOpenCvCameraView;

    private Mat                  mIntermediateMat;


    private BaseLoaderCallback  mLoaderCallback = new BaseLoaderCallback(this) {
        @Override
        public void onManagerConnected(int status) {
            switch (status) {
                case LoaderCallbackInterface.SUCCESS:
                {
                    Log.i(TAG, "OpenCV loaded successfully");
                    mOpenCvCameraView.enableView();
                } break;
                default:
                {
                    super.onManagerConnected(status);
                } break;
            }
        }
    };

    public Main2Activity() {
        Log.i(TAG, "Instantiated new " + this.getClass());
    }

    /** Called when the activity is first created. */
    @Override
    public void onCreate(Bundle savedInstanceState) {
        Log.i(TAG, "called onCreate");
        super.onCreate(savedInstanceState);
        //getWindow().addFlags(WindowManager.LayoutParams.FLAG_KEEP_SCREEN_ON);

        setContentView(R.layout.image_manipulations_surface_view);

        mOpenCvCameraView = (CameraBridgeViewBase) findViewById(R.id.cjv);
        //这里的cjv也是我的项目中JavaCameraView的id，自己改一下
        mOpenCvCameraView.setCvCameraViewListener(this);
    }

    @Overri
    public void onPause()
    {
        super.onPause();
        if (mOpenCvCameraView != null)
            mOpenCvCameraView.disableView();
    }

    @Override
    public void onResume()
    {
        super.onResume();
        if (!OpenCVLoader.initDebug()) {
            Log.d(TAG, "Internal OpenCV library not found. Using OpenCV Manager for initialization");
            OpenCVLoader.initAsync(OpenCVLoader.OPENCV_VERSION_3_0_0, this, mLoaderCallback);
        } else {
            Log.d(TAG, "OpenCV library found inside package. Using it!");
            mLoaderCallback.onManagerConnected(LoaderCallbackInterface.SUCCESS);
        }
    }

    public void onDestroy() {
        super.onDestroy();
        if (mOpenCvCameraView != null)
            mOpenCvCameraView.disableView();
    }

    public void onCameraViewStarted(int width, int height) {

    }

    public void onCameraViewStopped() {
        // Explicitly deallocate Mats
        if (mIntermediateMat != null)
            mIntermediateMat.release();

        mIntermediateMat = null;
    }

    public Mat onCameraFrame(CvCameraViewFrame inputFrame) {
        Mat rgba = inputFrame.rgba();
        Size sizeRgba = rgba.size();
        return rgba;
    }
}
</code></pre> 
<p>按照自己的实际情况改一下，不用到那个目录下去复制，直接用我这个，一般来说也是可以的<br> 到此为止还没有完，你会发现你的layout文件夹下并没有<code>setContentView(R.layout.image_manipulations_surface_view);</code>代码中的image_manipulations_surface_view.xml布局文件，这里我也简单的把我的xml文件分享一下，可以直接粘贴，也可以到opencv的解压目录的samples文件夹下找到，具体路径（opencv解压目录下）：./samples/image-manipulations/res，这个目录下的layout文件夹下就有你需要的image_manipulations_surface_view.xml<br> 不过这个布局文件中也只是只有一个JavaCameraView而已，而且可能会出现黑屏的情况，<br> 如果黑屏，试着吧JavaCameraView的background背景的透明度改为0就没问题了</p> 
<p>下面是我写的的xml布局文件，这里我已经把JavaCameraView的background背景改为透明了，直接调用就好</p> 
<pre><code>&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools"
    android:id="@+id/di"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:background="#FAFFFFFF"
    android:orientation="vertical"&gt;

    &lt;org.opencv.android.JavaCameraView
        android:id="@+id/cjv"
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        android:background="#00090808" /&gt;

&lt;/LinearLayout&gt;

</code></pre> 
<p>就只有一个JavaCameraView很简单，这里我给他的id是cjv<br> 然后在去Manifests.xml文件中吧Main2Activity写进去，我也直接贴我的代码，可以直接复制粘贴</p> 
<pre><code>&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;manifest xmlns:android="http://schemas.android.com/apk/res/android"
    package="com.example.mplog"&gt;


    &lt;uses-permission android:name="android.permission.CAMERA" /&gt;

    &lt;uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE"/&gt;

    &lt;uses-feature
        android:name="android.hardware.camera"
        android:required="true" /&gt;
    &lt;uses-feature
        android:name="android.hardware.camera.autofocus"
        android:required="true" /&gt;
    &lt;uses-feature
        android:name="android.hardware.camera.front"
        android:required="true" /&gt;
    &lt;uses-feature
        android:name="android.hardware.camera.front.autofocus"
        android:required="true" /&gt;

    &lt;application
        android:allowBackup="true"
        android:icon="@mipmap/ic"
        android:label="@string/app_name"
        android:roundIcon="@mipmap/ic"
        android:supportsRtl="true"
        android:theme="@style/AppTheme"&gt;
        &lt;activity android:name=".Main2Activity"&gt;&lt;/activity&gt;
        &lt;activity android:name=".MainActivity"&gt;
            &lt;intent-filter&gt;
                &lt;action android:name="android.intent.action.MAIN" /&gt;

                &lt;category android:name="android.intent.category.LAUNCHER" /&gt;
            &lt;/intent-filter&gt;
        &lt;/activity&gt;
    &lt;/application&gt;

&lt;/manifest&gt;
</code></pre> 
<p>这里记得吧android:icon="@mipmap/ic"这个APP的图标换成自己的就行了，这个IC是我的项目里的图标<br> 另外记得申请摄像头权限，因为要调用摄像头</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/79a2850fba013d4b9b93dbbe103ac554/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">PHP7和PHP5的区别</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/25bc5fa63c9d1472ecb7e23550b1f932/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Windows下使用curl访问url后面参数接收不到的问题</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>