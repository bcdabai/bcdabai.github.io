<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Java集合（三）CopyOnWriteArrayList、Vector、Stack - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Java集合（三）CopyOnWriteArrayList、Vector、Stack" />
<meta property="og:description" content="文章目录 【CopyOnWriteArrayList】一、CopyOnWriteArrayList介绍1.1 CopyOnWriteArrayList的特点*1.2 CopyOnWriteArrayList的使用 二、从源码理解CopyOnWriteArrayList2.1 创建对象2.2 添加元素2.3 删除元素2.4 获取元素2.5 遍历元素 三、相关问题3.1 CopyOnWriteArrayList的迭代器支持fast-fail吗* 【Vector】一、Vector介绍1.1 Vector的特点*1.2 Vector的使用 二、从源码理解Vector2.1 创建Vector对象2.2 自动扩容*2.3 添加元素2.4 删除元素2.5 更新元素2.6 获取元素2.7 检索元素 【Stack】一、Stack介绍1.1 Stack的特点*1.2 Stack的使用 二、从源码理解Stack2.1 创建对象2.2 添加（栈顶）元素2.3 删除（栈顶）元素2.4 获取（栈顶）元素2.5 判断Stack是否为空2.6 获取元素相对于栈顶的位置* 本系列文章：
Java集合（一）集合框架概述
Java集合（二）List、ArrayList、LinkedList
Java集合（三）CopyOnWriteArrayList、Vector、Stack
Java集合（四）Map、HashMap
Java集合（五）LinkedHashMap、TreeMap
Java集合（六）Hashtable、ConcurrentHashMap
Java集合（七）Set、HashSet、LinkedHashSet、TreeSet
Java集合（八）BlockingQueue、ArrayBlockingQueue、LinkedBlockingQueue、PriorityBlockingQueue、DelayQueue
【CopyOnWriteArrayList】 一、CopyOnWriteArrayList介绍 在很多应用场景中，读操作可能会远远大于写操作。由于读操作根本不会修改原有的数据，因此对于每次读取都进行加锁其实是一种资源浪费。我们可以允许多个线程同时访问List 的内部数据，毕竟读取操作是安全的。CopyOnWriteArrayList恰恰符合这种要求。
CopyOnWriteArrayList位于JUC包下，可以说是读写分离、以空间换时间版的ArrayList。其继承关系和ArrayList也是一致的：
public class CopyOnWriteArrayList&lt;E&gt; implements List&lt;E&gt;, RandomAccess, Cloneable, java.io.Serializable CopyOnWriteArrayList是一个线程安全、并且在读操作时无锁的ArrayList，其底层实现也是数组。不止读操作时无锁，写入也不会阻塞读取操作。只有写入和写入之间需要进行同步等待。
CopyOnWriteArrayList 类的所有可变操作（add、set等）都是通过创建底层数组的新副本来实现的。当List需要被修改的时候，并不修改原有内容，而是对原有数据进行一次复制，副本用来写，原来的数据用来读。写完之后，再将修改完的副本替换原来的数据，这样就可以保证写操作不会影响读操作。
1.1 CopyOnWriteArrayList的特点* 1、线程安全
CopyOnWriteArrayList所有写操作，都是通过对底层数组进行一次新的复制来实现，是线程安全的。2、适合读操作大于写操作的场景
CopyOnWriteArrayList适合使用在读操作远远大于写操作的场景里，比如缓存。CopyOnWriteArrayList不存在扩容的概念，每次写操作都要复制一个副本，在副本的基础上修改后改变原来的引用。CopyOnWriteArrayList中写操作需要大面积复制数组，所以性能差。3、内存消耗较大
CopyOnWriteArrayList虽然读多写少的场景，不过要慎用 ，因为当CopyOnWriteArrayList存放的数据比较多时，每次add/set都要重新复制数组，这个代价实在太高。4、数据一致性
CopyOnWrite容器只能保证数据的最终一致性，不能保证数据的实时一致性。写和读分别作用在新老不同容器上，在写操作执行过程中，读不会阻塞但读取到的却是老容器的数据。5、读写分离，效率高
采用读写分离方式，读的效率非常高。CopyOnWriteArrayList的迭代器是基于创建时的数据快照的，故数组的增删改不会影响到迭代器。6、支持随机读
由于CopyOnWriteArrayList底层实现数组，数据存在连续的内存上，因此支持随机读。 1.2 CopyOnWriteArrayList的使用 1、构造方法" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/49684fb705706ec72bed0e68367938aa/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-26T20:00:50+08:00" />
<meta property="article:modified_time" content="2024-01-26T20:00:50+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Java集合（三）CopyOnWriteArrayList、Vector、Stack</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#CopyOnWriteArrayList_12" rel="nofollow">【CopyOnWriteArrayList】</a></li><li><ul><li><a href="#CopyOnWriteArrayList_13" rel="nofollow">一、CopyOnWriteArrayList介绍</a></li><li><ul><li><a href="#11_CopyOnWriteArrayList_22" rel="nofollow">1.1 CopyOnWriteArrayList的特点*</a></li><li><a href="#12_CopyOnWriteArrayList_35" rel="nofollow">1.2 CopyOnWriteArrayList的使用</a></li></ul> 
   </li><li><a href="#CopyOnWriteArrayList_84" rel="nofollow">二、从源码理解CopyOnWriteArrayList</a></li><li><ul><li><a href="#21__102" rel="nofollow">2.1 创建对象</a></li><li><a href="#22__129" rel="nofollow">2.2 添加元素</a></li><li><a href="#23__188" rel="nofollow">2.3 删除元素</a></li><li><a href="#24__224" rel="nofollow">2.4 获取元素</a></li><li><a href="#25__235" rel="nofollow">2.5 遍历元素</a></li></ul> 
   </li><li><a href="#_302" rel="nofollow">三、相关问题</a></li><li><ul><li><a href="#31_CopyOnWriteArrayListfastfail_303" rel="nofollow">3.1 CopyOnWriteArrayList的迭代器支持fast-fail吗*</a></li></ul> 
  </li></ul> 
  </li><li><a href="#Vector_305" rel="nofollow">【Vector】</a></li><li><ul><li><a href="#Vector_306" rel="nofollow">一、Vector介绍</a></li><li><ul><li><a href="#11_Vector_312" rel="nofollow">1.1 Vector的特点*</a></li><li><a href="#12_Vector_322" rel="nofollow">1.2 Vector的使用</a></li></ul> 
   </li><li><a href="#Vector_417" rel="nofollow">二、从源码理解Vector</a></li><li><ul><li><a href="#21_Vector_428" rel="nofollow">2.1 创建Vector对象</a></li><li><a href="#22__455" rel="nofollow">2.2 自动扩容*</a></li><li><a href="#23__497" rel="nofollow">2.3 添加元素</a></li><li><a href="#24__588" rel="nofollow">2.4 删除元素</a></li><li><a href="#25__664" rel="nofollow">2.5 更新元素</a></li><li><a href="#26__688" rel="nofollow">2.6 获取元素</a></li><li><a href="#27__732" rel="nofollow">2.7 检索元素</a></li></ul> 
  </li></ul> 
  </li><li><a href="#Stack_793" rel="nofollow">【Stack】</a></li><li><ul><li><a href="#Stack_794" rel="nofollow">一、Stack介绍</a></li><li><ul><li><a href="#11_Stack_799" rel="nofollow">1.1 Stack的特点*</a></li><li><a href="#12_Stack_807" rel="nofollow">1.2 Stack的使用</a></li></ul> 
   </li><li><a href="#Stack_850" rel="nofollow">二、从源码理解Stack</a></li><li><ul><li><a href="#21__851" rel="nofollow">2.1 创建对象</a></li><li><a href="#22__858" rel="nofollow">2.2 添加（栈顶）元素</a></li><li><a href="#23__875" rel="nofollow">2.3 删除（栈顶）元素</a></li><li><a href="#24__891" rel="nofollow">2.4 获取（栈顶）元素</a></li><li><a href="#25_Stack_905" rel="nofollow">2.5 判断Stack是否为空</a></li><li><a href="#26__914" rel="nofollow">2.6 获取元素相对于栈顶的位置*</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<p>  本系列文章：<br>     <a href="https://blog.csdn.net/m0_37741420/article/details/106884159" title="With a Title">Java集合（一）集合框架概述</a><br>     <a href="https://blog.csdn.net/m0_37741420/article/details/107013695" title="With a Title">Java集合（二）List、ArrayList、LinkedList</a><br>     Java集合（三）CopyOnWriteArrayList、Vector、Stack<br>     <a href="https://blog.csdn.net/m0_37741420/article/details/112424663" title="With a Title">Java集合（四）Map、HashMap</a><br>     <a href="https://blog.csdn.net/m0_37741420/article/details/123614527" title="With a Title">Java集合（五）LinkedHashMap、TreeMap</a><br>     <a href="https://blog.csdn.net/m0_37741420/article/details/135028798" title="With a Title">Java集合（六）Hashtable、ConcurrentHashMap</a><br>     <a href="https://blog.csdn.net/m0_37741420/article/details/112407684" title="With a Title">Java集合（七）Set、HashSet、LinkedHashSet、TreeSet</a><br>     <a href="https://blog.csdn.net/m0_37741420/article/details/120335698" title="With a Title">Java集合（八）BlockingQueue、ArrayBlockingQueue、LinkedBlockingQueue、PriorityBlockingQueue、DelayQueue</a></p> 
<h2><a id="CopyOnWriteArrayList_12"></a>【CopyOnWriteArrayList】</h2> 
<h3><a id="CopyOnWriteArrayList_13"></a>一、CopyOnWriteArrayList介绍</h3> 
<p>  在很多应用场景中，读操作可能会远远大于写操作。由于读操作根本不会修改原有的数据，因此对于每次读取都进行加锁其实是一种资源浪费。我们可以允许多个线程同时访问List 的内部数据，毕竟读取操作是安全的。CopyOnWriteArrayList恰恰符合这种要求。<br>   CopyOnWriteArrayList位于JUC包下，可以说是读写分离、以空间换时间版的ArrayList。其继承关系和ArrayList也是一致的：</p> 
<pre><code class="prism language-java">	<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CopyOnWriteArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span>
    	<span class="token keyword">implements</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">RandomAccess</span><span class="token punctuation">,</span> <span class="token class-name">Cloneable</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>Serializable</span>
</code></pre> 
<p>  CopyOnWriteArrayList是一个线程安全、并且在读操作时无锁的ArrayList，其底层实现也是数组。不止读操作时无锁，写入也不会阻塞读取操作。只有写入和写入之间需要进行同步等待。<br>   CopyOnWriteArrayList 类的所有可变操作（add、set等）都是通过创建底层数组的新副本来实现的。当List需要被修改的时候，并不修改原有内容，而是对原有数据进行一次复制，副本用来写，原来的数据用来读。写完之后，再将修改完的副本替换原来的数据，这样就可以保证写操作不会影响读操作。</p> 
<h4><a id="11_CopyOnWriteArrayList_22"></a>1.1 CopyOnWriteArrayList的特点*</h4> 
<ul><li><strong>1、线程安全</strong><br>   CopyOnWriteArrayList所有写操作，都是通过对底层数组进行一次新的复制来实现，是线程安全的。</li><li><strong>2、适合读操作大于写操作的场景</strong><br>   CopyOnWriteArrayList适合使用在读操作远远大于写操作的场景里，比如缓存。CopyOnWriteArrayList不存在扩容的概念，每次写操作都要复制一个副本，在副本的基础上修改后改变原来的引用。CopyOnWriteArrayList中写操作需要大面积复制数组，所以性能差。</li><li><strong>3、内存消耗较大</strong><br>   CopyOnWriteArrayList虽然读多写少的场景，不过要慎用 ，因为当CopyOnWriteArrayList存放的数据比较多时，每次add/set都要重新复制数组，这个代价实在太高。</li><li><strong>4、数据一致性</strong><br>   <code>CopyOnWrite容器只能保证数据的最终一致性，不能保证数据的实时一致性</code>。写和读分别作用在新老不同容器上，在写操作执行过程中，读不会阻塞但读取到的却是老容器的数据。</li><li><strong>5、读写分离，效率高</strong><br>   采用读写分离方式，读的效率非常高。CopyOnWriteArrayList的迭代器是基于创建时的数据快照的，故数组的增删改不会影响到迭代器。</li><li><strong>6、支持随机读</strong><br>   由于CopyOnWriteArrayList底层实现数组，数据存在连续的内存上，因此支持随机读。</li></ul> 
<h4><a id="12_CopyOnWriteArrayList_35"></a>1.2 CopyOnWriteArrayList的使用</h4> 
<ul><li><strong>1、构造方法</strong><br>   可以构建空对象，也可以根据数组、集合等对象来构建对象。</li></ul> 
<pre><code class="prism language-java">	<span class="token comment">//构造一个空数组</span>
	<span class="token keyword">public</span> <span class="token class-name">CopyOnWriteArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">//将指定集合中的元素copy到数组中</span>
	<span class="token keyword">public</span> <span class="token class-name">CopyOnWriteArrayList</span><span class="token punctuation">(</span><span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> c<span class="token punctuation">)</span>
	<span class="token comment">//将指定数组中的元素copy到数组中</span>
	<span class="token keyword">public</span> <span class="token class-name">CopyOnWriteArrayList</span><span class="token punctuation">(</span><span class="token class-name">E</span><span class="token punctuation">[</span><span class="token punctuation">]</span> toCopyIn<span class="token punctuation">)</span>
</code></pre> 
<ul><li><strong>2、添加元素</strong><br>   添加元素的方式和ArrayList类似，默认添加元素在数组尾部，也可以在指定位置添加。</li></ul> 
<pre><code class="prism language-java">	<span class="token comment">//将指定的元素列表的结束</span>
	<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">E</span> e<span class="token punctuation">)</span>
	<span class="token comment">//在列表中指定的位置上插入指定的元素</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">,</span> <span class="token class-name">E</span> element<span class="token punctuation">)</span>
	<span class="token comment">//追加指定集合的所有元素到这个列表的末尾</span>
	<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">addAll</span><span class="token punctuation">(</span><span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> c<span class="token punctuation">)</span>
	<span class="token comment">//将指定集合中的所有元素插入到该列表中，从指定位置开始</span>
	<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">addAll</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">,</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> c<span class="token punctuation">)</span>
</code></pre> 
<ul><li><strong>3、判断是否包含某个元素</strong></li></ul> 
<pre><code class="prism language-java">	<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">contains</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">)</span>
</code></pre> 
<ul><li><strong>4、获取制定位置的元素</strong></li></ul> 
<pre><code class="prism language-java">	<span class="token keyword">public</span> <span class="token class-name">E</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">)</span>
</code></pre> 
<ul><li><strong>5、返回指定元素的索引</strong></li></ul> 
<pre><code class="prism language-java">	<span class="token comment">//返回此列表中指定元素的第一个出现的索引</span>
	<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">)</span>
	<span class="token comment">//从指定位置搜索，返回此列表中的第一个出现的指定元素的索引</span>
	<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token class-name">E</span> e<span class="token punctuation">,</span> <span class="token keyword">int</span> index<span class="token punctuation">)</span>
</code></pre> 
<ul><li><strong>6、删除元素</strong></li></ul> 
<pre><code class="prism language-java">	<span class="token comment">//根据下标删除元素</span>
	<span class="token keyword">public</span> <span class="token class-name">E</span> <span class="token function">remove</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">)</span>
	<span class="token comment">//删除列表中首次出现的元素</span>
	<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">remove</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">)</span>
</code></pre> 
<ul><li><strong>7、清空</strong></li></ul> 
<pre><code class="prism language-java">	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>	
</code></pre> 
<h3><a id="CopyOnWriteArrayList_84"></a>二、从源码理解CopyOnWriteArrayList</h3> 
<p>  看CopyOnWriteArrayList源码，可以从两点来把握：</p> 
<ul><li><strong>1、动态数组</strong><br>   CopyOnWriteArrayList内部有个<code>volatile数组</code>。在添加、修改、删除数据时，都会新建一个数组，并将原数组中的元素拷贝到新数组中，然后在新数组中更新，最后再将“volatile数组”引用指向新数组。<br>   CopyOnWriteArrayList就是通过这种方式实现的动态数组；不过正由于它在添加、修改、删除数据时，都会新建数组，所以涉及到修改数据的操作，CopyOnWriteArrayList效率很低；但只是进行遍历查找的话，效率比较高（与ArrayList相似）。</li><li><strong>2、线程安全</strong><br>   线程安全是通过volatile和互斥锁来实现的。<br>   CopyOnWriteArrayList的底层实现是volatile数组。volatile可以保证不同线程对共享变量操作的可见性，因此一个线程读取volatile数组时，总能看到其它线程对该volatile数组最后的写入数据，这样就保证了读取到的数据总是最新的。<br>   CopyOnWriteArrayList通过互斥锁来保护数据。在添加、修改、删除数据时，会先获取互斥锁，修改完毕后，先将volatile数组引用指向新数组，然后再释放互斥锁。这样，就达到了保护数据的目的。</li></ul> 
<p>  CopyOnWriteArrayList主要的成员变量：</p> 
<pre><code class="prism language-java">    <span class="token comment">//锁</span>
    <span class="token keyword">final</span> <span class="token keyword">transient</span> <span class="token class-name">ReentrantLock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//数组</span>
    <span class="token keyword">private</span> <span class="token keyword">transient</span> <span class="token keyword">volatile</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array<span class="token punctuation">;</span>
</code></pre> 
<p>  CopyOnWriteArrayList在实现线程安全时，用了一把锁。</p> 
<h4><a id="21__102"></a>2.1 创建对象</h4> 
<pre><code class="prism language-java">	<span class="token comment">//创建空的CopyOnWriteArrayList对象</span>
    <span class="token keyword">public</span> <span class="token class-name">CopyOnWriteArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">setArray</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	<span class="token comment">//创建含有指定Collection的元素的CopyOnWriteArrayList</span>
    <span class="token keyword">public</span> <span class="token class-name">CopyOnWriteArrayList</span><span class="token punctuation">(</span><span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> c<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> elements<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">CopyOnWriteArrayList</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
            elements <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">CopyOnWriteArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span>c<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            elements <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>elements<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
                elements <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">copyOf</span><span class="token punctuation">(</span>elements<span class="token punctuation">,</span> elements<span class="token punctuation">.</span>length<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">setArray</span><span class="token punctuation">(</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	<span class="token comment">//创建含有指定数组的元素的CopyOnWriteArrayList</span>
    <span class="token keyword">public</span> <span class="token class-name">CopyOnWriteArrayList</span><span class="token punctuation">(</span><span class="token class-name">E</span><span class="token punctuation">[</span><span class="token punctuation">]</span> toCopyIn<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">setArray</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">copyOf</span><span class="token punctuation">(</span>toCopyIn<span class="token punctuation">,</span> toCopyIn<span class="token punctuation">.</span>length<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">setArray</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> a<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        array <span class="token operator">=</span> a<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<h4><a id="22__129"></a>2.2 添加元素</h4> 
<p>  add() 方法在添加集合的时候加了锁，保证了同步，避免了多线程写的时候会copy出多个副本出来。也就是说同时最多只有一个线程可以获取到这把锁，来创建新数组。<br>   总体而言，添加元素的逻辑是：加锁；创建一个新的数组；将现有数组的元素拷贝过去；在新的数组中增加元素；将引用指向新的数组；释放锁。</p> 
<ul><li><strong>1、在数组末尾追加元素</strong></li></ul> 
<pre><code class="prism language-java">    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">E</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    	<span class="token comment">//获取该对象的锁</span>
        <span class="token keyword">final</span> <span class="token class-name">ReentrantLock</span> lock <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lock<span class="token punctuation">;</span>
        <span class="token comment">//加锁,每次只有一个线程可进入临界区</span>
        lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
        	<span class="token comment">//获取原始"volatile数组"中的数据和数据长度</span>
            <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> elements <span class="token operator">=</span> <span class="token function">getArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> len <span class="token operator">=</span> elements<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
            <span class="token comment">//新建一个数组newElements，并将原始数据拷贝到newElements中</span>
            <span class="token comment">//newElements数组的长度="原始数组的长度"+1</span>
            <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> newElements <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">copyOf</span><span class="token punctuation">(</span>elements<span class="token punctuation">,</span> len <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//将"新增加的元素"保存到newElements中</span>
            newElements<span class="token punctuation">[</span>len<span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">;</span>
            <span class="token comment">//将"volatile数组"引用指向newElements数组，这样旧数组就被GC回收了</span>
            <span class="token function">setArray</span><span class="token punctuation">(</span>newElements<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
        	<span class="token comment">//释放锁</span>
            lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> 
<ul><li><strong>2、在数组指定位置添加元素</strong></li></ul> 
<pre><code class="prism language-java">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">,</span> <span class="token class-name">E</span> element<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">final</span> <span class="token class-name">ReentrantLock</span> lock <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lock<span class="token punctuation">;</span>
        lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> elements <span class="token operator">=</span> <span class="token function">getArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> len <span class="token operator">=</span> elements<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&gt;</span> len <span class="token operator">||</span> index <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IndexOutOfBoundsException</span><span class="token punctuation">(</span><span class="token string">"Index: "</span><span class="token operator">+</span>index<span class="token operator">+</span>
                                                    <span class="token string">", Size: "</span><span class="token operator">+</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> newElements<span class="token punctuation">;</span>
            <span class="token keyword">int</span> numMoved <span class="token operator">=</span> len <span class="token operator">-</span> index<span class="token punctuation">;</span>
            <span class="token comment">//如果要插入的位置是最后一位，直接将旧数组复制到新数组中，新数组长度为旧数组长度+1</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>numMoved <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
                newElements <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">copyOf</span><span class="token punctuation">(</span>elements<span class="token punctuation">,</span> len <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//如果要插入的位置不是最后一位，新数组长度为旧数组长度+1，然后将要插入位置前后的数据都复制到新数组中</span>
            <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                newElements <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span>len <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">arraycopy</span><span class="token punctuation">(</span>elements<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> newElements<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">arraycopy</span><span class="token punctuation">(</span>elements<span class="token punctuation">,</span> index<span class="token punctuation">,</span> newElements<span class="token punctuation">,</span> index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>
                                 numMoved<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            newElements<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> element<span class="token punctuation">;</span>
            <span class="token function">setArray</span><span class="token punctuation">(</span>newElements<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
            lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>  可以看出，添加1个元素时，新数组的长度是在原有数组长度len的基础上+1。同理，往CopyOnWriteArrayList里添加一个元素数量为n的集合时，新数组的长度是len+n。</p> 
<h4><a id="23__188"></a>2.3 删除元素</h4> 
<p>  删除元素的逻辑和添加元素的相似：加锁；创建一个新的数组；将现有数组的元素拷贝过去；在新的数组中删除元素；将引用指向新的数组；释放锁。</p> 
<pre><code class="prism language-java">	<span class="token comment">//删除索引index处的元素</span>
    <span class="token keyword">public</span> <span class="token class-name">E</span> <span class="token function">remove</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">final</span> <span class="token class-name">ReentrantLock</span> lock <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lock<span class="token punctuation">;</span>
        <span class="token comment">//加锁</span>
        lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
        	<span class="token comment">//获取原始"volatile数组"中的数据和数据长度</span>
            <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> elements <span class="token operator">=</span> <span class="token function">getArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> len <span class="token operator">=</span> elements<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
            <span class="token comment">//获取elements数组中的第index个数据</span>
            <span class="token class-name">E</span> oldValue <span class="token operator">=</span> <span class="token function">get</span><span class="token punctuation">(</span>elements<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> numMoved <span class="token operator">=</span> len <span class="token operator">-</span> index <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token comment">//如果被删除的是最后一个元素，则直接通过Arrays.copyOf()进行处理，而不需要新建数组</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>numMoved <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
                <span class="token function">setArray</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">copyOf</span><span class="token punctuation">(</span>elements<span class="token punctuation">,</span> len <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//否则，新建数组，然后将"volatile数组中被删除元素之外的其它元素"拷贝到新数组中</span>
            <span class="token comment">//最后，将"volatile数组"引用指向newElements数组，这样旧数组就被GC回收了。</span>
            <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> newElements <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span>len <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">arraycopy</span><span class="token punctuation">(</span>elements<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> newElements<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">arraycopy</span><span class="token punctuation">(</span>elements<span class="token punctuation">,</span> index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> newElements<span class="token punctuation">,</span> index<span class="token punctuation">,</span>
                                 numMoved<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">setArray</span><span class="token punctuation">(</span>newElements<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">//将删除的元素返回</span>
            <span class="token keyword">return</span> oldValue<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
        	<span class="token comment">//释放锁</span>
            lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>  和添加元素同理，删除1个元素时，新数组的长度是在原有数组长度len的基础上-1。同理，往CopyOnWriteArrayList里添加一个元素数量为n的集合时，新数组的长度是len-n。</p> 
<h4><a id="24__224"></a>2.4 获取元素</h4> 
<p>  获取元素是读操作，不修改元素。由于读写分离，因此读数据不需要加锁。</p> 
<pre><code class="prism language-java">    <span class="token keyword">public</span> <span class="token class-name">E</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token function">getArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">E</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">E</span><span class="token punctuation">)</span> a<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<h4><a id="25__235"></a>2.5 遍历元素</h4> 
<p>  即迭代器的实现，CopyOnWriteArrayList中有好几种迭代器，以Iterator为例看下即可。</p> 
<pre><code class="prism language-java">	<span class="token comment">//获取迭代器</span>
    <span class="token keyword">public</span> <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">COWIterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token function">getArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

	<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">COWIterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">ListIterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//array的快照版本</span>
        <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> snapshot<span class="token punctuation">;</span>
        <span class="token comment">//数组下标</span>
        <span class="token keyword">private</span> <span class="token keyword">int</span> cursor<span class="token punctuation">;</span>

        <span class="token comment">//省略...</span>

        <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> cursor <span class="token operator">&lt;</span> snapshot<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">hasPrevious</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> cursor <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">"unchecked"</span><span class="token punctuation">)</span>
        <span class="token keyword">public</span> <span class="token class-name">E</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NoSuchElementException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">E</span><span class="token punctuation">)</span> snapshot<span class="token punctuation">[</span>cursor<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">"unchecked"</span><span class="token punctuation">)</span>
        <span class="token keyword">public</span> <span class="token class-name">E</span> <span class="token function">previous</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token function">hasPrevious</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NoSuchElementException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">E</span><span class="token punctuation">)</span> snapshot<span class="token punctuation">[</span><span class="token operator">--</span>cursor<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">nextIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> cursor<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">previousIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> cursor<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UnsupportedOperationException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">E</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UnsupportedOperationException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">E</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UnsupportedOperationException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

		<span class="token comment">//省略...</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>  从上面的迭代器代码，我们能看出CopyOnWriteArrayList遍历的两个特点：</p> 
<ul><li><strong>1、支持向前/向后2个方向遍历</strong><br>   COWIterator中有next()、previous()这样获取后一个元素、前一个元素的方法，所以遍历是可以向前、也可以向后的。CopyOnWriteArrayList的底层实现是数组，可以向前向后遍历也正常。</li><li><strong>2、读时不能修改数组中的元素</strong><br>   COWIterator中的remove、set、add方法都是直接抛出了UnsupportedOperationException，因此在迭代CopyOnWriteArrayList元素时，不能修改元素。<br>   CopyOnWriteArrayList是读写分离的，原数组用来读，新数组用来写。迭代时不能修改，也保证了数据的安全。</li></ul> 
<h3><a id="_302"></a>三、相关问题</h3> 
<h4><a id="31_CopyOnWriteArrayListfastfail_303"></a>3.1 CopyOnWriteArrayList的迭代器支持fast-fail吗*</h4> 
<p>  不支持。因为写时复制的存在，CopyOnWriteArrayList在使用迭代器迭代的时候，实际上迭代的是原数组，而不是更新的数组，所以中间如果发生新增、删除元素是在新数组上发生的，所以不影响旧数组的迭代，但是正因为元素的迭代发生在旧数组上，所以迭代时更新的数据是获取不到最新的。</p> 
<h2><a id="Vector_305"></a>【Vector】</h2> 
<h3><a id="Vector_306"></a>一、Vector介绍</h3> 
<pre><code class="prism language-java">	<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Vector</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">AbstractList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span>
    	<span class="token keyword">implements</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">RandomAccess</span><span class="token punctuation">,</span> <span class="token class-name">Cloneable</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>Serializable</span>
</code></pre> 
<p>  Vector与ArrayList很相似，也是<code>基于数组来实现，与ArrayList相比，Vector是线程安全的（在每个方法上几乎都增加了synchronized关键字来实现线程间的同步，也正因为如此，Vector的效率会比较低）</code>。可以简单地将Vector理解为线程安全版的ArrayList。</p> 
<h4><a id="11_Vector_312"></a>1.1 Vector的特点*</h4> 
<ul><li><strong>1、底层实现与ArrayList相似</strong><br>   Vector底层也是数组，所以也支持随机访问。</li><li><strong>2、线程安全</strong><br>   Vector与ArrayList最大的不同就在于其是线程安全的，元素修改的方法都是用synchronized关键字修饰的。</li><li><strong>3、扩容时容量与ArrayList不同</strong><br>   <code>ArrayList不可以设置扩展的容量，默认1.5倍</code>。<br>   <code>Vector可以设置扩展的容量，如果没有设置，默认2倍</code>。</li><li><strong>4、初始容量与ArrayList不同</strong><br>   ArrayList的无参构造方法中初始容量为0（自动扩容时才扩容为10），而Vector的无参构造方法中初始容量为10。可以简单地理解为这两个容器的初始容量都是10。</li></ul> 
<h4><a id="12_Vector_322"></a>1.2 Vector的使用</h4> 
<ul><li><strong>1、构造方法</strong><br>   在构造Vector对象时，可以指定初始容量initialCapacity和每次的增量capacityIncrement。当capacityIncrement小于等于0时，数组成倍扩容；当capacityIncrement大于0时，数组扩容时就增加相对的数值。</li></ul> 
<pre><code class="prism language-java">	<span class="token comment">//构造一个空Vector，其内部数据数组的大小为10 ，标准容量增量为0</span>
	<span class="token keyword">public</span> <span class="token class-name">Vector</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">//构造具有指定初始容量，并且其容量增量等于0的空Vector</span>
	<span class="token keyword">public</span> <span class="token class-name">Vector</span><span class="token punctuation">(</span><span class="token keyword">int</span> initialCapacity<span class="token punctuation">)</span>
	<span class="token comment">//构造具有指定的初始容量和容量增量的空Vector</span>
	<span class="token keyword">public</span> <span class="token class-name">Vector</span><span class="token punctuation">(</span><span class="token keyword">int</span> initialCapacity<span class="token punctuation">,</span> <span class="token keyword">int</span> capacityIncrement<span class="token punctuation">)</span>
</code></pre> 
<ul><li><strong>2、添加元素</strong><br>   添加的元素的方式和ArrayList类似，不过每个方法上多了synchronized ，保证线程安全。</li></ul> 
<pre><code class="prism language-java">	<span class="token comment">//将指定的元素追加到此Vector的末尾</span>
	<span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">boolean</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">E</span> e<span class="token punctuation">)</span>
	<span class="token comment">//在此Vector中的指定位置插入指定的元素</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">,</span> <span class="token class-name">E</span> element<span class="token punctuation">)</span>
	<span class="token comment">//将指定的元素添加到此向量的末尾</span>
	<span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">addElement</span><span class="token punctuation">(</span><span class="token class-name">E</span> obj<span class="token punctuation">)</span>
	<span class="token comment">//在指定的index位置插入指定元素</span>
	<span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">insertElementAt</span><span class="token punctuation">(</span><span class="token class-name">E</span> obj<span class="token punctuation">,</span> <span class="token keyword">int</span> index<span class="token punctuation">)</span>
</code></pre> 
<ul><li><strong>3、返回此Vector的当前元素个数</strong></li></ul> 
<pre><code class="prism language-java">	<span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">int</span> <span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<ul><li><strong>4、清空Vector</strong></li></ul> 
<pre><code class="prism language-java">	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<ul><li><strong>5、判断是否包含某元素</strong></li></ul> 
<pre><code class="prism language-java">	<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">contains</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">)</span>
</code></pre> 
<ul><li><strong>6、获取元素</strong></li></ul> 
<pre><code class="prism language-java">	<span class="token comment">//返回指定位置的元素</span>
	<span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token class-name">E</span> <span class="token function">elementAt</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">)</span>
	<span class="token comment">//返回此Vector的第一个元素</span>
	<span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token class-name">E</span> <span class="token function">firstElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">//返回此Vector中指定位置的元素</span>
	<span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token class-name">E</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">)</span>
	<span class="token comment">//获取Vector中的最后一个元素</span>
	<span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token class-name">E</span> <span class="token function">lastElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<ul><li><strong>7、比较两个Vector是否相等</strong></li></ul> 
<pre><code class="prism language-java">	<span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">boolean</span> <span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">)</span>
</code></pre> 
<ul><li><strong>8、支持for each循环</strong></li></ul> 
<pre><code class="prism language-java">	<span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> action<span class="token punctuation">)</span>
</code></pre> 
<ul><li><strong>9、检索元素位置</strong></li></ul> 
<pre><code class="prism language-java">	<span class="token comment">//返回此Vector中指定元素的第一次出现的索引，如果此向量不包含元素，则返回-1</span>
	<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">)</span>
	<span class="token comment">//返回此Vector中指定元素的第一次出现的索引，从 index向前检索，如果未找到</span>
	<span class="token comment">//该元素，则返回-1</span>
	<span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">int</span> <span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">,</span> <span class="token keyword">int</span> index<span class="token punctuation">)</span>
	<span class="token comment">//返回此Vector中指定元素的最后一次出现的索引，如果此向量不包含元素，则返回-1</span>
	<span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">int</span> <span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">)</span>
	<span class="token comment">//返回此Vector中指定元素的最后一次出现的索引，从 index开始 ，如果未找到</span>
	<span class="token comment">//元素，则返回-1</span>
	<span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">int</span> <span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">,</span> <span class="token keyword">int</span> index<span class="token punctuation">)</span>
</code></pre> 
<ul><li><strong>10、Vector是否为空</strong></li></ul> 
<pre><code class="prism language-java">	<span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">boolean</span> <span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<ul><li><strong>11、返回一个迭代器</strong></li></ul> 
<pre><code class="prism language-java">	<span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span> <span class="token class-name">E</span> <span class="token punctuation">&gt;</span></span> <span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<ul><li><strong>12、删除元素</strong></li></ul> 
<pre><code class="prism language-java">	<span class="token comment">//删除此Vector中指定位置的元素</span>
	<span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token class-name">E</span> <span class="token function">remove</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">)</span>
	<span class="token comment">//删除此Vector中第一个出现的指定元素，如果Vector不包含该元素，则不会更改</span>
	<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">remove</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">)</span>
	<span class="token comment">//删除指定索引处的元素</span>
	<span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">removeElementAt</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">)</span>
</code></pre> 
<ul><li><strong>13、替换元素</strong></li></ul> 
<pre><code class="prism language-java">	<span class="token comment">//用指定的元素替换此Vector中指定位置的元素</span>
	<span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token class-name">E</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">,</span> <span class="token class-name">E</span> element<span class="token punctuation">)</span>
	<span class="token comment">//用指定的元素替换此Vector中指定位置的元素</span>
	<span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">setElementAt</span><span class="token punctuation">(</span><span class="token class-name">E</span> obj<span class="token punctuation">,</span> <span class="token keyword">int</span> index<span class="token punctuation">)</span>
</code></pre> 
<ul><li><strong>14、返回此Vector中的元素数</strong></li></ul> 
<pre><code class="prism language-java">	<span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">int</span> <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="Vector_417"></a>二、从源码理解Vector</h3> 
<p>  几个变量：</p> 
<pre><code class="prism language-java">    <span class="token comment">//存放元素的数组</span>
    <span class="token keyword">protected</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> elementData<span class="token punctuation">;</span>
    <span class="token comment">//Vector的实际元素数量</span>
	<span class="token keyword">protected</span> <span class="token keyword">int</span> elementCount<span class="token punctuation">;</span>
	<span class="token comment">//需要扩容时的增量， 如果capacityIncrement小于或等于0，vector的容量</span>
	<span class="token comment">//需要增长时将会成倍增长</span>
	<span class="token keyword">protected</span> <span class="token keyword">int</span> capacityIncrement<span class="token punctuation">;</span>
</code></pre> 
<h4><a id="21_Vector_428"></a>2.1 创建Vector对象</h4> 
<p>  在构造方法中，其实要做的就是确定初始容量和增长因子。初始容量默认为10，每次扩容默认增长一倍</p> 
<ul><li><strong>1、指定Vector的初始容量和增长容量的构造方法</strong></li></ul> 
<pre><code class="prism language-java">    <span class="token keyword">public</span> <span class="token class-name">Vector</span><span class="token punctuation">(</span><span class="token keyword">int</span> initialCapacity<span class="token punctuation">,</span> <span class="token keyword">int</span> capacityIncrement<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>initialCapacity <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"Illegal Capacity: "</span><span class="token operator">+</span>
                                               initialCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>elementData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span>initialCapacity<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>capacityIncrement <span class="token operator">=</span> capacityIncrement<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<ul><li><strong>2、只指定Vector的初始容量、默认扩容时容量增长一倍的构造方法</strong></li></ul> 
<pre><code class="prism language-java">    <span class="token keyword">public</span> <span class="token class-name">Vector</span><span class="token punctuation">(</span><span class="token keyword">int</span> initialCapacity<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">(</span>initialCapacity<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<ul><li><strong>3、默认容量为10、扩容时容量增长一倍的构造方法</strong></li></ul> 
<pre><code class="prism language-java">    <span class="token keyword">public</span> <span class="token class-name">Vector</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>  如调用<code>Vector()</code>方法，此时会生成一个容量为10的Vector：<br> <img src="https://images2.imgbox.com/ef/c2/KQFNyoiI_o.png" alt=""></p> 
<h4><a id="22__455"></a>2.2 自动扩容*</h4> 
<p>  此处以调用addElement方法向Vector中添加元素为例：</p> 
<pre><code class="prism language-java">    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">addElement</span><span class="token punctuation">(</span><span class="token class-name">E</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    	<span class="token comment">//modCount用于fail-fast机制</span>
        modCount<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token comment">//判断在增加一个新的元素后，原数组是否需要扩容</span>
        <span class="token function">ensureCapacityHelper</span><span class="token punctuation">(</span>elementCount <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        elementData<span class="token punctuation">[</span>elementCount<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> obj<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">ensureCapacityHelper</span><span class="token punctuation">(</span><span class="token keyword">int</span> minCapacity<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//判断minCapacity是否大于当前容量，如果大于，就调用grow进行扩容</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>minCapacity <span class="token operator">-</span> elementData<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token function">grow</span><span class="token punctuation">(</span>minCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">grow</span><span class="token punctuation">(</span><span class="token keyword">int</span> minCapacity<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// overflow-conscious code</span>
        <span class="token keyword">int</span> oldCapacity <span class="token operator">=</span> elementData<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
        <span class="token comment">//判断capacityIncrement变量是否为0，如果不为0，每次就增加相应的容量；</span>
        <span class="token comment">//为0的话就扩容一倍</span>
        <span class="token keyword">int</span> newCapacity <span class="token operator">=</span> oldCapacity <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>capacityIncrement <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">?</span>
                                         capacityIncrement <span class="token operator">:</span> oldCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>newCapacity <span class="token operator">-</span> minCapacity <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
            newCapacity <span class="token operator">=</span> minCapacity<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>newCapacity <span class="token operator">-</span> MAX_ARRAY_SIZE <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
            newCapacity <span class="token operator">=</span> <span class="token function">hugeCapacity</span><span class="token punctuation">(</span>minCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span>
        elementData <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">copyOf</span><span class="token punctuation">(</span>elementData<span class="token punctuation">,</span> newCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> MAX_ARRAY_SIZE <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span>MAX_VALUE <span class="token operator">-</span> <span class="token number">8</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">hugeCapacity</span><span class="token punctuation">(</span><span class="token keyword">int</span> minCapacity<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>minCapacity <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// overflow</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">OutOfMemoryError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>minCapacity <span class="token operator">&gt;</span> MAX_ARRAY_SIZE<span class="token punctuation">)</span> <span class="token operator">?</span>
            <span class="token class-name">Integer</span><span class="token punctuation">.</span>MAX_VALUE <span class="token operator">:</span>
            MAX_ARRAY_SIZE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>  此处的扩容实现过程与ArrayList大致相似，不同的地方在于判断capacityIncrement变量是否为0，如果不为0，每次就增加相应地的容量；<code>为0的话就扩容一倍</code>。而ArrayList是1.5倍扩容。</p> 
<h4><a id="23__497"></a>2.3 添加元素</h4> 
<p>  添加元素的大致逻辑为：先确定要不要扩容，需要的话就扩容，然后再添加元素。</p> 
<ul><li><strong>1、添加元素到数组尾部</strong></li></ul> 
<pre><code class="prism language-java">    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">boolean</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">E</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        modCount<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token comment">//先检验是否需要扩容</span>
        <span class="token function">ensureCapacityHelper</span><span class="token punctuation">(</span>elementCount <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//将元素追加至数组末尾</span>
        elementData<span class="token punctuation">[</span>elementCount<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>  这个方法的实现，除了加了一个<code>synchronized</code>关键字，别的和ArrayList一模一样，图示：<br> <img src="https://images2.imgbox.com/8a/f2/NSG5K2lo_o.png" alt=""><br>   如果此时再调用add方法先后添加2、3两个元素后，Vector会变成：<br> <img src="https://images2.imgbox.com/6c/95/yIU4ragA_o.png" alt=""></p> 
<ul><li><strong>2、添加元素到数组的指定位置</strong></li></ul> 
<pre><code class="prism language-java">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">,</span> <span class="token class-name">E</span> element<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">insertElementAt</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">insertElementAt</span><span class="token punctuation">(</span><span class="token class-name">E</span> obj<span class="token punctuation">,</span> <span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        modCount<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token comment">//判断位置参数是否合法</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&gt;</span> elementCount<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ArrayIndexOutOfBoundsException</span><span class="token punctuation">(</span>index
                                                     <span class="token operator">+</span> <span class="token string">" &gt; "</span> <span class="token operator">+</span> elementCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//检验是否需要扩容</span>
        <span class="token function">ensureCapacityHelper</span><span class="token punctuation">(</span>elementCount <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//将从指定位置到尾部的元素向后移动一位</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">arraycopy</span><span class="token punctuation">(</span>elementData<span class="token punctuation">,</span> index<span class="token punctuation">,</span> elementData<span class="token punctuation">,</span> index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> elementCount <span class="token operator">-</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//将元素插入到指定位置</span>
        elementData<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> obj<span class="token punctuation">;</span>
        elementCount<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>  假设调用add(1,4)方法，就会在下标索引为1的位置添加元素4。这个过程分为以下几步：<br> <img src="https://images2.imgbox.com/6f/64/YlOKoWQ3_o.png" alt=""></p> 
<ul><li><strong>3、在数组尾部添加元素</strong></li></ul> 
<pre><code class="prism language-java">    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">addElement</span><span class="token punctuation">(</span><span class="token class-name">E</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        modCount<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token comment">//检验是否需要扩容</span>
        <span class="token function">ensureCapacityHelper</span><span class="token punctuation">(</span>elementCount <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//将元素追加至数组末尾</span>
        elementData<span class="token punctuation">[</span>elementCount<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> obj<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<ul><li><strong>4、将指定集合的元素添加到数组尾部</strong></li></ul> 
<pre><code class="prism language-java">    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">boolean</span> <span class="token function">addAll</span><span class="token punctuation">(</span><span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> c<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        modCount<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token comment">//将集合转换为数组</span>
        <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> a <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> numNew <span class="token operator">=</span> a<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
        <span class="token comment">//检验是否需要扩容</span>
        <span class="token function">ensureCapacityHelper</span><span class="token punctuation">(</span>elementCount <span class="token operator">+</span> numNew<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//接着将元素拷贝到Vector中</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">arraycopy</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> elementData<span class="token punctuation">,</span> elementCount<span class="token punctuation">,</span> numNew<span class="token punctuation">)</span><span class="token punctuation">;</span>
        elementCount <span class="token operator">+=</span> numNew<span class="token punctuation">;</span>
        <span class="token keyword">return</span> numNew <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<ul><li><strong>5、将指定集合的元素添加到数组的指定位置</strong></li></ul> 
<pre><code class="prism language-java">    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">boolean</span> <span class="token function">addAll</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">,</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> c<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        modCount<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token comment">//检验位置参数是否合法</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> index <span class="token operator">&gt;</span> elementCount<span class="token punctuation">)</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ArrayIndexOutOfBoundsException</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//将集合元素插入指定数组中</span>
        <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> a <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> numNew <span class="token operator">=</span> a<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
        <span class="token comment">//判断是否需要扩容</span>
        <span class="token function">ensureCapacityHelper</span><span class="token punctuation">(</span>elementCount <span class="token operator">+</span> numNew<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//判断要插入的位置是否小于元素数量，如果小于，则需要将Vector中从插入元素位置后面的元素向后移动</span>
        <span class="token keyword">int</span> numMoved <span class="token operator">=</span> elementCount <span class="token operator">-</span> index<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>numMoved <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">arraycopy</span><span class="token punctuation">(</span>elementData<span class="token punctuation">,</span> index<span class="token punctuation">,</span> elementData<span class="token punctuation">,</span> index <span class="token operator">+</span> numNew<span class="token punctuation">,</span>
                             numMoved<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//将集合转化成的数组中的元素全部插入到Vector对应的数组中</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">arraycopy</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> elementData<span class="token punctuation">,</span> index<span class="token punctuation">,</span> numNew<span class="token punctuation">)</span><span class="token punctuation">;</span>
        elementCount <span class="token operator">+=</span> numNew<span class="token punctuation">;</span>
        <span class="token keyword">return</span> numNew <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>  <code>addAll(Collection&lt;? extends E&gt; c)</code>和<code>addAll(int index, Collection&lt;? extends E&gt; c)</code>方法的作用是相似的，都是将一个集合中的元素添加到数组中，差异之处是前者是在数组末尾插入，后者是在指定位置插入。接下来以<code>addAll(int index, Collection&lt;? extends E&gt; c)</code>为例，演示一下添加一个集合的过程：<br> <img src="https://images2.imgbox.com/88/ec/j05BGaN6_o.png" alt=""></p> 
<h4><a id="24__588"></a>2.4 删除元素</h4> 
<p>  删除元素的逻辑就是删指定的（一个或多个）元素，然后将空出来的位置置为null，便于GC。</p> 
<ul><li><strong>1、删除指定位置的元素</strong></li></ul> 
<pre><code class="prism language-java">    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token class-name">E</span> <span class="token function">remove</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        modCount<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token comment">//检验位置参数合法性</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&gt;=</span> elementCount<span class="token punctuation">)</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ArrayIndexOutOfBoundsException</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//取出该位置元素，用于返回</span>
        <span class="token class-name">E</span> oldValue <span class="token operator">=</span> <span class="token function">elementData</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//判断要删除的元素是不是最后一个位置的元素</span>
        <span class="token keyword">int</span> numMoved <span class="token operator">=</span> elementCount <span class="token operator">-</span> index <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token comment">//如果不是最后一个元素，将删除元素位置后面的元素向前移动一位</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>numMoved <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">arraycopy</span><span class="token punctuation">(</span>elementData<span class="token punctuation">,</span> index<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> elementData<span class="token punctuation">,</span> index<span class="token punctuation">,</span>
                             numMoved<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//数组最后一个元素置为null</span>
        elementData<span class="token punctuation">[</span><span class="token operator">--</span>elementCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// Let gc do its work</span>

        <span class="token keyword">return</span> oldValue<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<ul><li><strong>2、删除数组中第一次出现的某个元素</strong></li></ul> 
<pre><code class="prism language-java">    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">remove</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token function">removeElement</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">boolean</span> <span class="token function">removeElement</span><span class="token punctuation">(</span><span class="token class-name">Object</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        modCount<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token comment">//如果能检索出指定元素的位置，就删除该元素</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token function">indexOf</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">removeElementAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">removeElementAt</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        modCount<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&gt;=</span> elementCount<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ArrayIndexOutOfBoundsException</span><span class="token punctuation">(</span>index <span class="token operator">+</span> <span class="token string">" &gt;= "</span> <span class="token operator">+</span>
                                                     elementCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ArrayIndexOutOfBoundsException</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//如果要删除的元素不是最后一位，就将删除元素对应位置后面的元素向前移动一位</span>
        <span class="token keyword">int</span> j <span class="token operator">=</span> elementCount <span class="token operator">-</span> index <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>j <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">arraycopy</span><span class="token punctuation">(</span>elementData<span class="token punctuation">,</span> index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> elementData<span class="token punctuation">,</span> index<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        elementCount<span class="token operator">--</span><span class="token punctuation">;</span>
        <span class="token comment">//数组最后一个元素置为null</span>
        elementData<span class="token punctuation">[</span>elementCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">/* to let gc do its work */</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>  Vector删除单个元素和ArrayList删除单个元素的过程相似。<code>remove(Object o)</code>和<code>remove(int index)</code>大致思路相似，先找到index，再删除对应位置上的元素，图示：<br> <img src="https://images2.imgbox.com/63/b6/GtI89SGq_o.png" alt=""></p> 
<ul><li><strong>3、清空数组</strong></li></ul> 
<pre><code class="prism language-java">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">removeAllElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">removeAllElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        modCount<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token comment">//所有元素置为null</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> elementCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
            elementData<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

        elementCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<h4><a id="25__664"></a>2.5 更新元素</h4> 
<ul><li><strong>1、替换指定位置的元素，并将被替换的元素返回</strong></li></ul> 
<pre><code class="prism language-java">    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token class-name">E</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">,</span> <span class="token class-name">E</span> element<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    	<span class="token comment">//检验位置参数合法性</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&gt;=</span> elementCount<span class="token punctuation">)</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ArrayIndexOutOfBoundsException</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//获取该位置现有元素，替换新元素，返回旧元素</span>
        <span class="token class-name">E</span> oldValue <span class="token operator">=</span> <span class="token function">elementData</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
        elementData<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> element<span class="token punctuation">;</span>
        <span class="token keyword">return</span> oldValue<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<ul><li><strong>2、替换指定位置的元素</strong></li></ul> 
<pre><code class="prism language-java">	<span class="token comment">//与上个方法相比，差异是不再将旧元素返回</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">setElementAt</span><span class="token punctuation">(</span><span class="token class-name">E</span> obj<span class="token punctuation">,</span> <span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&gt;=</span> elementCount<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ArrayIndexOutOfBoundsException</span><span class="token punctuation">(</span>index <span class="token operator">+</span> <span class="token string">" &gt;= "</span> <span class="token operator">+</span>
                                                     elementCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        elementData<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> obj<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<h4><a id="26__688"></a>2.6 获取元素</h4> 
<p>  Vector中获取元素的方法有三个：获取某个位置、首部和尾部的元素。这也是底层是数组实现的集合类的常见操作。</p> 
<ul><li><strong>1、获取数组任意位置上的元素</strong></li></ul> 
<pre><code class="prism language-java">    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token class-name">E</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&gt;=</span> elementCount<span class="token punctuation">)</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ArrayIndexOutOfBoundsException</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token function">elementData</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token class-name">E</span> <span class="token function">elementAt</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&gt;=</span> elementCount<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ArrayIndexOutOfBoundsException</span><span class="token punctuation">(</span>index <span class="token operator">+</span> <span class="token string">" &gt;= "</span> <span class="token operator">+</span> elementCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token function">elementData</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">E</span> <span class="token function">elementData</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">E</span><span class="token punctuation">)</span> elementData<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>  get(index)和elementAt(int index)都是获取某位置元素的方法。</p> 
<ul><li><strong>2、获取数组第一个元素</strong></li></ul> 
<pre><code class="prism language-java">    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token class-name">E</span> <span class="token function">firstElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>elementCount <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NoSuchElementException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//获取第一个元素</span>
        <span class="token keyword">return</span> <span class="token function">elementData</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<ul><li><strong>3、获取数组最后一个元素</strong></li></ul> 
<pre><code class="prism language-java">    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token class-name">E</span> <span class="token function">lastElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>elementCount <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NoSuchElementException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//获取最后一个元素</span>
        <span class="token keyword">return</span> <span class="token function">elementData</span><span class="token punctuation">(</span>elementCount <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<h4><a id="27__732"></a>2.7 检索元素</h4> 
<p>  Vector中检索元素的方法也是大致分为两大类：从前向后检索和从后向前检索。</p> 
<ul><li><strong>1、从头开始检索元素</strong><br>   从头部开始，从前向后获取元素出现的第一个位置。</li></ul> 
<pre><code class="prism language-java">    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    	<span class="token comment">//从头开始检索某个元素</span>
        <span class="token keyword">return</span> <span class="token function">indexOf</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<ul><li><strong>2、indexOf(Object o, int index)</strong><br>   从指定位置开始，从前向后获取元素出现的第一个位置。</li></ul> 
<pre><code class="prism language-java">    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">int</span> <span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">,</span> <span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    	<span class="token comment">//先判断要检索的元素是否为null</span>
    	<span class="token comment">//检索null</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>o <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> index <span class="token punctuation">;</span> i <span class="token operator">&lt;</span> elementCount <span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>elementData<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span>
                    <span class="token keyword">return</span> i<span class="token punctuation">;</span>
        <span class="token comment">//检索指定元素</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> index <span class="token punctuation">;</span> i <span class="token operator">&lt;</span> elementCount <span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>o<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>elementData<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token keyword">return</span> i<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<ul><li><strong>3、lastIndexOf(Object o)</strong><br>   从尾部开始，从后向前获取元素出现的最后一个位置。</li></ul> 
<pre><code class="prism language-java">    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">int</span> <span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    	<span class="token comment">//从末尾开始，从后向前检索</span>
        <span class="token keyword">return</span> <span class="token function">lastIndexOf</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> elementCount<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<ul><li><strong>4、lastIndexOf(Object o, int index)</strong><br>   从指定位置开始，从后向前获取元素出现的最后一个位置。</li></ul> 
<pre><code class="prism language-java">    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">int</span> <span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">,</span> <span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    	<span class="token comment">//检索index合法性</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&gt;=</span> elementCount<span class="token punctuation">)</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IndexOutOfBoundsException</span><span class="token punctuation">(</span>index <span class="token operator">+</span> <span class="token string">" &gt;= "</span><span class="token operator">+</span> elementCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//判断要检索的元素是否为null</span>
		<span class="token comment">//检索null</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>o <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> index<span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>elementData<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span>
                    <span class="token keyword">return</span> i<span class="token punctuation">;</span>
        <span class="token comment">//检索指定元素</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> index<span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>o<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>elementData<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token keyword">return</span> i<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<h2><a id="Stack_793"></a>【Stack】</h2> 
<h3><a id="Stack_794"></a>一、Stack介绍</h3> 
<p>  Stack是栈，是Vector的“窄化”实现。在栈中，可以操作元素的一段叫栈顶（数组尾部），数组的另一端是栈底（数组首部），图示：<img src="https://images2.imgbox.com/01/37/VTHuEjR9_o.png" alt="" width="300"><br>   在栈中可以进行的操作是入栈和出栈。图示：<br> <img src="https://images2.imgbox.com/37/d4/D2fyo7tf_o.gif" alt=""></p> 
<h4><a id="11_Stack_799"></a>1.1 Stack的特点*</h4> 
<p>  Stack的特点，可以简单归结为两点：</p> 
<ul><li><strong>1、在底层数组的一端（栈顶）进行存储/取出元素</strong><br>   普通的数组，一般都可以从两端进行存储和取出元素的操作，但Stack作为Vector的“窄化”实现，严格规定只能在数组的一端进行操作。</li><li><strong>2、先进后出（LIFO）</strong><br>   Stack中存储的元素，都是后进先出（LIFO，最后入栈的元素最先出栈），因为先存入Stack中的元素存入了Stack底部，在取出该元素时自然是最后一个取出的。</li><li><strong>3、线程安全</strong><br>   Stack继承于Vector，所以也是线程安全的。</li></ul> 
<h4><a id="12_Stack_807"></a>1.2 Stack的使用</h4> 
<p>  Stack继承了Vector，所以Vector的方法Stack都有。同时，由于Stack具有先进后出的特点，所以多了一些方法。</p> 
<ul><li><strong>1、创建一个空栈</strong></li></ul> 
<pre><code class="prism language-java">	<span class="token keyword">public</span> <span class="token class-name">Stack</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<ul><li><strong>2、此栈是否为空</strong></li></ul> 
<pre><code class="prism language-java">	<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<ul><li><strong>3、查看栈顶的对象，而不从栈中删除</strong></li></ul> 
<pre><code class="prism language-java">	<span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token class-name">E</span> <span class="token function">peek</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<ul><li><strong>4、删除并返回此堆栈顶部的对象</strong></li></ul> 
<pre><code class="prism language-java">	<span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token class-name">E</span> <span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<ul><li><strong>5、将元素存入到栈的顶部</strong></li></ul> 
<pre><code class="prism language-java">	<span class="token keyword">public</span> <span class="token class-name">E</span> <span class="token function">push</span><span class="token punctuation">(</span><span class="token class-name">E</span> item<span class="token punctuation">)</span>
</code></pre> 
<ul><li><strong>6、返回一个对象在此栈上的基于栈顶的相对位置</strong></li></ul> 
<pre><code class="prism language-java">	<span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">int</span> <span class="token function">search</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">)</span>
</code></pre> 
<p>  这个方法优点特殊，看个示例：</p> 
<pre><code class="prism language-java">		<span class="token class-name">Stack</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> stack <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Stack</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">"B"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">"C"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">int</span> index <span class="token operator">=</span> stack<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>index <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"元素A在Stack中的位置是："</span> <span class="token operator">+</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"元素A不在Stack中"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre> 
<p>  运行结果：</p> 
<blockquote> 
 <p>元素A在Stack中的位置是：3</p> 
</blockquote> 
<h3><a id="Stack_850"></a>二、从源码理解Stack</h3> 
<h4><a id="21__851"></a>2.1 创建对象</h4> 
<pre><code class="prism language-java">    <span class="token keyword">public</span> <span class="token class-name">Stack</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    	<span class="token comment">//由于在子类的构造方法中默认有一条隐式的语句super()，所以此处是先调用其父类</span>
    	<span class="token comment">//无参构造方法，因此Stack的初始化流程可以理解为和Vector的无参构造过程一致</span>
    <span class="token punctuation">}</span>
</code></pre> 
<h4><a id="22__858"></a>2.2 添加（栈顶）元素</h4> 
<pre><code class="prism language-java">	<span class="token comment">//将元素放置到栈顶</span>
    <span class="token keyword">public</span> <span class="token class-name">E</span> <span class="token function">push</span><span class="token punctuation">(</span><span class="token class-name">E</span> item<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    	<span class="token comment">//调用其父类的addElement方法</span>
        <span class="token function">addElement</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> item<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

	<span class="token comment">//该方法的实现与Vector的方法相同，不过是线程安全的，因为方法用synchronized修饰</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">addElement</span><span class="token punctuation">(</span><span class="token class-name">E</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        modCount<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token function">ensureCapacityHelper</span><span class="token punctuation">(</span>elementCount <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        elementData<span class="token punctuation">[</span>elementCount<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> obj<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>  从addElement方法可以看出，<code>栈底是数组的首部</code>，每次向栈中添加元素时，都是在数组后面追加。</p> 
<h4><a id="23__875"></a>2.3 删除（栈顶）元素</h4> 
<pre><code class="prism language-java">    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token class-name">E</span> <span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">E</span> obj<span class="token punctuation">;</span>
        <span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//peek是获取栈顶元素的方法</span>
        obj <span class="token operator">=</span> <span class="token function">peek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//调用其父类Vector中的方法，作用是根据索引删除数组中的一个元素</span>
        <span class="token function">removeElementAt</span><span class="token punctuation">(</span>len <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> obj<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	<span class="token comment">//Stack父类Vector中的removeElementAt方法，是线程安全的</span>
	<span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">removeElementAt</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">)</span>
</code></pre> 
<p>  <code>删除栈顶元素，其实就是删除数组尾部的元素</code>。</p> 
<h4><a id="24__891"></a>2.4 获取（栈顶）元素</h4> 
<pre><code class="prism language-java">    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token class-name">E</span> <span class="token function">peek</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">int</span>     len <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>len <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">EmptyStackException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//调用了其父类中的elementAt方法</span>
        <span class="token keyword">return</span> <span class="token function">elementAt</span><span class="token punctuation">(</span>len <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	<span class="token comment">//Stack父类Vector中的方法，是线程安全的</span>
	<span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token class-name">E</span> <span class="token function">elementAt</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">)</span>
</code></pre> 
<p>  <code>获取栈顶元素，其实就是获取数组尾部的元素</code>。</p> 
<h4><a id="25_Stack_905"></a>2.5 判断Stack是否为空</h4> 
<pre><code class="prism language-java">    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    	<span class="token comment">//调用了父类的size方法</span>
        <span class="token keyword">return</span> <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	<span class="token comment">//Stack父类Vector中的方法，是线程安全的</span>
	<span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">int</span> <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="26__914"></a>2.6 获取元素相对于栈顶的位置*</h4> 
<pre><code class="prism language-java">	<span class="token comment">//某个元素在栈中相对于栈顶(数组尾部)位置的方法</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">int</span> <span class="token function">search</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    	<span class="token comment">//栈中的栈顶元素是最后添加的，而search方法要返回某个元素相对于栈顶元素</span>
    	<span class="token comment">//的位置，所以最后要返回size()-i</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token function">lastIndexOf</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> i<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>  这个方法比较特殊，图示：<br> <img src="https://images2.imgbox.com/6c/6f/Xn5q8s9T_o.png" alt=""><br>   像上图中的元素“3”，相对于栈顶的位置是1，因此用search检索，返回值就是1。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/45b0fad283a6a94464f0c81706747cc8/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Java集合（一）集合框架概述</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/64b7fea92d087b8232f2e8a929d21ca2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Java集合（四）Map、HashMap</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>