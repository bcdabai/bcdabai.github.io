<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>搭建nacos环境(保姆级教程) - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="搭建nacos环境(保姆级教程)" />
<meta property="og:description" content="2.2.1 服务发现中心 根据上节讲解的网关的架构图，要使用网关首先搭建Nacos。
首先搭建Nacos服务发现中心。
在搭建Nacos服务发现中心之前需要搞清楚两个概念：namespace和group
namespace：用于区分环境、比如：开发环境、测试环境、生产环境。
group：用于区分项目，比如：xuecheng-plus项目、xuecheng2.0项目
首先在nacos配置namespace:
登录Centos，启动Naocs，使用sh /data/soft/restart.sh将自动启动Nacos。
访问：http://192.168.101.65:8848/nacos/
账号密码：nacos/nacos
登录成功，点击左侧菜单“命名空间”进入命名空间管理界面，
点击“新建命名空间”，填写命名空间的相关信息。如下图：
使用相同的方法再创建“测试环境”、&#34;生产环境&#34;的命名空间。
创建成功，如下图：
这里创建具体班级的命名空间，假如创建1010班级的命名空间，如下：
首先完成各服务注册到Naocs，下边将内容管理服务注册到nacos中。
1) 在xuecheng-plus-parent中添加依赖管理 XML com.alibaba.cloud spring-cloud-alibaba-dependencies ${spring-cloud-alibaba.version} pom import 2）在内容管理模块的接口工程、系统管理模块的接口工程中添加如下依赖 XML com.alibaba.cloud spring-cloud-starter-alibaba-nacos-discovery 3）配置nacos的地址 在系统管理的接口工程的配置文件中配置如下信息：
YAML#微服务配置 spring: application: name: system-service cloud: nacos: server-addr: 192.168.101.65:8848 discovery: namespace: dev group: xuecheng-plus-project 在内容管理的接口工程的配置文件中配置如下信息：
YAMLspring: application: name: content-service cloud: nacos: server-addr: 192.168.101.65:8848 discovery: namespace: dev group: xuecheng-plus-project 4）重启内容管理服务、系统管理服务。 待微服务启动成功，进入Nacos服务查看服务列表
在 “开发环境” 命名空间下有两个服务实例。微服务在Nacos注册成功。
点击其它一个微服务的“详情”
通过上图可以查看微服务实例的地址。
2.2.2 配置中心 2." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/99b07e2359e1e8ad98fd98093c0ef7be/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-01-14T22:13:13+08:00" />
<meta property="article:modified_time" content="2023-01-14T22:13:13+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">搭建nacos环境(保姆级教程)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h4><a id="221__0"></a><strong>2.2.1 服务发现中心</strong></h4> 
<p>根据上节讲解的网关的架构图，要使用网关首先搭建Nacos。</p> 
<p>首先搭建Nacos服务发现中心。</p> 
<p>在搭建Nacos服务发现中心之前需要搞清楚两个概念：namespace和group</p> 
<p>namespace：用于区分环境、比如：开发环境、测试环境、生产环境。</p> 
<p>group：用于区分项目，比如：xuecheng-plus项目、xuecheng2.0项目</p> 
<p>首先在nacos配置namespace:</p> 
<p>登录Centos，启动Naocs，使用sh /data/soft/restart.sh将自动启动Nacos。</p> 
<p>访问：<a href="http://192.168.101.65:8848/nacos/" rel="nofollow">http://192.168.101.65:8848/nacos/</a></p> 
<p>账号密码：nacos/nacos</p> 
<p>登录成功，点击左侧菜单“命名空间”进入命名空间管理界面，</p> 
<p><img src="https://images2.imgbox.com/ea/1c/Vk056YSl_o.png" alt=""></p> 
<p>点击“新建命名空间”，填写命名空间的相关信息。如下图：</p> 
<p><img src="https://images2.imgbox.com/e4/6d/eg771wdS_o.png" alt=""></p> 
<p>使用相同的方法再创建“测试环境”、"生产环境"的命名空间。</p> 
<p><img src="https://images2.imgbox.com/a4/41/gMi1NoeB_o.png" alt=""></p> 
<p><img src="https://images2.imgbox.com/d1/ab/wg5yunRi_o.png" alt=""></p> 
<p>创建成功，如下图：</p> 
<p><img src="https://images2.imgbox.com/34/11/J8KRSGGe_o.png" alt=""></p> 
<p>这里创建具体班级的命名空间，假如创建1010班级的命名空间，如下：</p> 
<p><img src="https://images2.imgbox.com/13/a7/Y3hCNoe3_o.png" alt=""></p> 
<p>首先完成各服务注册到Naocs，下边将内容管理服务注册到nacos中。</p> 
<h5><a id="1_xuechengplusparent_44"></a>1) 在xuecheng-plus-parent中添加依赖管理</h5> 
<table><thead><tr><th>XML com.alibaba.cloud spring-cloud-alibaba-dependencies ${spring-cloud-alibaba.version} pom import </th></tr></thead></table> 
<h5><a id="2_49"></a>2）在内容管理模块的接口工程、系统管理模块的接口工程中添加如下依赖</h5> 
<table><thead><tr><th>XML com.alibaba.cloud spring-cloud-starter-alibaba-nacos-discovery </th></tr></thead></table> 
<h5><a id="3nacos_54"></a>3）配置nacos的地址</h5> 
<p>在系统管理的接口工程的配置文件中配置如下信息：</p> 
<table><thead><tr><th>YAML#微服务配置 spring: application: name: system-service cloud: nacos: server-addr: 192.168.101.65:8848 discovery: namespace: dev group: xuecheng-plus-project</th></tr></thead></table> 
<p>在内容管理的接口工程的配置文件中配置如下信息：</p> 
<table><thead><tr><th>YAMLspring: application: name: content-service cloud: nacos: server-addr: 192.168.101.65:8848 discovery: namespace: dev group: xuecheng-plus-project</th></tr></thead></table> 
<h5><a id="4_66"></a>4）重启内容管理服务、系统管理服务。</h5> 
<p>待微服务启动成功，进入Nacos服务查看服务列表</p> 
<p><img src="https://images2.imgbox.com/b3/f0/gTt6KMde_o.png" alt=""></p> 
<p>在 “开发环境” 命名空间下有两个服务实例。微服务在Nacos注册成功。</p> 
<p>点击其它一个微服务的“详情”</p> 
<p><img src="https://images2.imgbox.com/c4/75/ov1oqySk_o.png" alt=""></p> 
<p>通过上图可以查看微服务实例的地址。</p> 
<h4><a id="222__80"></a><strong>2.2.2 配置中心</strong></h4> 
<h5><a id="2221__82"></a><strong>2.2.2.1 配置三要素</strong></h5> 
<p>搭建完成Nacos服务发现中心，下边搭建Nacos为配置中心，其目的就是通过Nacos去管理项目的所有配置。</p> 
<p>先将项目中的配置文件分分类：</p> 
<p>1、每个项目特有的配置</p> 
<p>是指该配置只在有些项目中需要配置，或者该配置在每个项目中配置的值不同。</p> 
<p>比如：spring.application.name每个项目都需要配置但值不一样，以及有些项目需要连接数据而有些项目不需要，有些项目需要配置消息队列而有些项目不需要。</p> 
<p>2、项目所公用的配置</p> 
<p>是指在若干项目中配置内容相同的配置。比如：redis的配置，很多项目用的同一套redis服务所以配置也一样。</p> 
<p>另外还需要知道nacos如何去定位一个具体的配置文件，即配置的三要素：namespace、group、dataid.</p> 
<p>1、通过namespace、group找到具体的环境和具体的项目。</p> 
<p>2、通过dataid找到具体的配置文件，dataid有三部分组成，</p> 
<p>比如：content-service-dev.yaml配置文件 由（content-service）-（dev）. (yaml)三部分组成</p> 
<p>content-service：第一部分，它是在application.yaml中配置的应用名，即spring.application.name的值。</p> 
<p>dev：第二部分，它是环境名，通过spring.profiles.active指定，</p> 
<p>Yaml: 第三部分，它是配置文件 的后缀，目前nacos支持properties、yaml等格式类型，本项目选择yaml格式类型。</p> 
<p>所以，如果我们要配置content-service工程的配置文件:</p> 
<p>在开发环境中配置content-service-dev.yaml</p> 
<p>在测试环境中配置content-service-test.yaml</p> 
<p>在生产环境中配置content-service-prod.yaml</p> 
<h5><a id="2222_contentservice_120"></a><strong>2.2.2.2 配置content-service</strong></h5> 
<p>下边以开发环境为例对content-service工程的配置文件进行配置，进入nacos，进入开发环境。</p> 
<p><img src="https://images2.imgbox.com/2b/0d/UgvxJIuz_o.png" alt=""></p> 
<p>点击 加号，添加一个配置</p> 
<p><img src="https://images2.imgbox.com/de/a4/raAnHPVO_o.png" alt=""></p> 
<p>输入data id、group以及配置文件内容。</p> 
<p>为什么没在nacos中配置下边的内容 ？</p> 
<table><thead><tr><th>YAMLspring: application: name: content-service</th></tr></thead></table> 
<p>因为刚才说了dataid第一部分就是spring.application.name，nacos 客户端要根据此值确定配置文件 名称，所以spring.application.name不在nacos中配置，而是要在工程的本地进行配置。</p> 
<p>本地配置文件现在是application.yaml需要修改为bootstrap.yaml，因为SpringBoot读取配置文件 的顺序如下：</p> 
<p><img src="https://images2.imgbox.com/b1/e5/El059Ol0_o.png" alt=""></p> 
<p>所以在content-service工程 中添加bootstrap.yaml，内容如下：</p> 
<table><thead><tr><th>YAMLspring: application: name: content-service cloud: nacos: server-addr: 192.168.101.65:8848 discovery: namespace: ${spring.profiles.active} group: xuecheng-plus-project config: namespace: ${spring.profiles.active} group: xuecheng-plus-project file-extension: yaml refresh-enabled: true #profiles默认为dev profiles: active: dev</th></tr></thead></table> 
<p>最后删除原来的application.yaml。</p> 
<p>在内容管理模块的接口工程和service工程、系统管理的接口工程和service工程配置依赖：</p> 
<table><thead><tr><th>XML com.alibaba.cloud spring-cloud-starter-alibaba-nacos-config </th></tr></thead></table> 
<p>配置完成，运行content-service工程 的单元测试文件，能否正常测试。</p> 
<p>通过运行观察控制台打印出下边的信息：</p> 
<table><thead><tr><th>Plain Text[NacosRestTemplate.java:476] - HTTP method: POST, url: <a href="http://192.168.101.65:8848/nacos/v1/cs/configs/listener," rel="nofollow">http://192.168.101.65:8848/nacos/v1/cs/configs/listener,</a> body: {Listening-Configs=content-service.yaml?xuecheng-plus-project??dev?content-service-dev.yaml?xuecheng-plus-project?88459b1483b8381eccc2ef462bd59182?dev?content-service?xuecheng-plus-project??dev?, tenant=dev}</th></tr></thead></table> 
<p>NacosRestTemplate.java通过Post方式去nacos读取配置信息。</p> 
<p>跟踪单元测试方法可以正常读取数据库的数据，说明从nacos读取配置信息正常。</p> 
<h5><a id="2223contentapi_166"></a><strong>2.2.2.3配置content-api</strong></h5> 
<p>以相同的方法配置content-api工程的配置文件，在nacos中的开发环境中配置content-api-dev.yaml，内容如下：</p> 
<table><thead><tr><th>YAMLserver: servlet: context-path: /content port: 63040 # 日志文件配置路径 logging: config: classpath:log4j2-dev.xml # swagger 文档配置 swagger: title: “学成在线内容管理系统” description: “内容系统管理系统对课程相关信息进行业务管理数据” base-package: com.xuecheng.content enabled: true version: 1.0.0</th></tr></thead></table> 
<p>在content-api工程 的本地配置bootstrap.yaml，内容如下：</p> 
<table><thead><tr><th>YAML#server: # servlet: # context-path: /content # port: 63040 #微服务配置 spring: application: name: content-api cloud: nacos: server-addr: 192.168.101.65:8848 discovery: namespace: ${spring.profiles.active} group: xuecheng-plus-project config: namespace: <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
           
             s 
            
           
             p 
            
           
             r 
            
           
             i 
            
           
             n 
            
           
             g 
            
           
             . 
            
           
             p 
            
           
             r 
            
           
             o 
            
           
             f 
            
           
             i 
            
           
             l 
            
           
             e 
            
           
             s 
            
           
             . 
            
           
             a 
            
           
             c 
            
           
             t 
            
           
             i 
            
           
             v 
            
           
             e 
            
           
          
            g 
           
          
            r 
           
          
            o 
           
          
            u 
           
          
            p 
           
          
            : 
           
          
            x 
           
          
            u 
           
          
            e 
           
          
            c 
           
          
            h 
           
          
            e 
           
          
            n 
           
          
            g 
           
          
            − 
           
          
            p 
           
          
            l 
           
          
            u 
           
          
            s 
           
          
            − 
           
          
            p 
           
          
            r 
           
          
            o 
           
          
            j 
           
          
            e 
           
          
            c 
           
          
            t 
           
          
            f 
           
          
            i 
           
          
            l 
           
          
            e 
           
          
            − 
           
          
            e 
           
          
            x 
           
          
            t 
           
          
            e 
           
          
            n 
           
          
            s 
           
          
            i 
           
          
            o 
           
          
            n 
           
          
            : 
           
          
            y 
           
          
            a 
           
          
            m 
           
          
            l 
           
          
            r 
           
          
            e 
           
          
            f 
           
          
            r 
           
          
            e 
           
          
            s 
           
          
            h 
           
          
            − 
           
          
            e 
           
          
            n 
           
          
            a 
           
          
            b 
           
          
            l 
           
          
            e 
           
          
            d 
           
          
            : 
           
          
            t 
           
          
            r 
           
          
            u 
           
          
            e 
           
          
            e 
           
          
            x 
           
          
            t 
           
          
            e 
           
          
            n 
           
          
            s 
           
          
            i 
           
          
            o 
           
          
            n 
           
          
            − 
           
          
            c 
           
          
            o 
           
          
            n 
           
          
            f 
           
          
            i 
           
          
            g 
           
          
            s 
           
          
            : 
           
          
            − 
           
          
            d 
           
          
            a 
           
          
            t 
           
          
            a 
           
          
            − 
           
          
            i 
           
          
            d 
           
          
            : 
           
          
            c 
           
          
            o 
           
          
            n 
           
          
            t 
           
          
            e 
           
          
            n 
           
          
            t 
           
          
            − 
           
          
            s 
           
          
            e 
           
          
            r 
           
          
            v 
           
          
            i 
           
          
            c 
           
          
            e 
           
          
            − 
           
          
         
           {spring.profiles.active} group: xuecheng-plus-project file-extension: yaml refresh-enabled: true extension-configs: - data-id: content-service- 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right: 0.0278em;">r</span><span class="mord mathnormal">in</span><span class="mord mathnormal" style="margin-right: 0.0359em;">g</span><span class="mord">.</span><span class="mord mathnormal">p</span><span class="mord mathnormal">ro</span><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right: 0.0197em;">l</span><span class="mord mathnormal">es</span><span class="mord">.</span><span class="mord mathnormal">a</span><span class="mord mathnormal">c</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right: 0.0359em;">v</span><span class="mord mathnormal">e</span></span><span class="mord mathnormal" style="margin-right: 0.0359em;">g</span><span class="mord mathnormal">ro</span><span class="mord mathnormal">u</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord mathnormal">xu</span><span class="mord mathnormal">ec</span><span class="mord mathnormal">h</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right: 0.0359em;">g</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord mathnormal" style="margin-right: 0.0197em;">pl</span><span class="mord mathnormal">u</span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord mathnormal">p</span><span class="mord mathnormal">ro</span><span class="mord mathnormal" style="margin-right: 0.0572em;">j</span><span class="mord mathnormal">ec</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right: 0.0197em;">l</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.6595em;"></span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">s</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord mathnormal" style="margin-right: 0.0359em;">y</span><span class="mord mathnormal">am</span><span class="mord mathnormal" style="margin-right: 0.0197em;">l</span><span class="mord mathnormal">re</span><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span><span class="mord mathnormal">res</span><span class="mord mathnormal">h</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.6944em;"></span><span class="mord mathnormal">e</span><span class="mord mathnormal">nab</span><span class="mord mathnormal" style="margin-right: 0.0197em;">l</span><span class="mord mathnormal">e</span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.7429em; vertical-align: -0.0833em;"></span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right: 0.0278em;">r</span><span class="mord mathnormal">u</span><span class="mord mathnormal">ee</span><span class="mord mathnormal">x</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">s</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord mathnormal">co</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right: 0.0359em;">g</span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.7778em; vertical-align: -0.0833em;"></span><span class="mord">−</span><span class="mord mathnormal">d</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.6944em;"></span><span class="mord mathnormal">i</span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.6984em; vertical-align: -0.0833em;"></span><span class="mord mathnormal">co</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.7429em; vertical-align: -0.0833em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">ser</span><span class="mord mathnormal" style="margin-right: 0.0359em;">v</span><span class="mord mathnormal">i</span><span class="mord mathnormal">ce</span><span class="mord">−</span></span></span></span></span>{spring.profiles.active}.yaml group: xuecheng-plus-project refresh: true profiles: active: dev # 日志文件配置路径 logging: config: classpath:log4j2-dev.xml # swagger 文档配置 swagger: title: “学成在线内容管理系统” description: “内容系统管理系统对课程相关信息进行业务管理数据” base-package: com.xuecheng.content enabled: true version: 1.0.0</th></tr></thead></table> 
<p>注意：因为api接口工程依赖了service工程 的jar，所以这里使用extension-configs扩展配置文件 的方式引用service工程所用到的配置文件。</p> 
<table><thead><tr><th>YAML extension-configs: - data-id: content-service-${spring.profiles.active}.yaml group: xuecheng-plus-project refresh: true</th></tr></thead></table> 
<p>如果添加多个扩展文件，继续在下添加即可，如下：</p> 
<table><thead><tr><th>YAML extension-configs: - data-id: content-service-${spring.profiles.active}.yaml group: xuecheng-plus-project refresh: true - data-id: 填写文件 dataid group: xuecheng-plus-project refresh: true</th></tr></thead></table> 
<p>启动content-api工程，查询控制台是否打印出了请求nacos的日志，如下:</p> 
<table><thead><tr><th>Bash[NacosRestTemplate.java:476] - HTTP method: POST, url: <a href="http://192.168.101.65:8848/nacos/v1/cs/configs/listener" rel="nofollow">http://192.168.101.65:8848/nacos/v1/cs/configs/listener</a></th></tr></thead></table> 
<p>并使用Httpclient测试课程查询接口是否可以正常查询。</p> 
<h4><a id="223__195"></a><strong>2.2.3 公用配置</strong></h4> 
<p>还有一个优化的点是如何在nacos中配置项目的公用配置呢？</p> 
<p>nacos提供了shared-configs可以引入公用配置。</p> 
<p>在content-api中配置了swagger，所有的接口工程 都需要配置swagger，这里就可以将swagger的配置定义为一个公用配置，哪个项目用引入即可。</p> 
<p>单独在xuecheng-plus-common分组下创建xuecheng-plus的公用配置，进入nacos的开发环境，添加swagger-dev.yaml公用配置</p> 
<p><img src="https://images2.imgbox.com/65/a5/ltYt0oJY_o.png" alt=""></p> 
<p>删除接口工程中对swagger的配置。</p> 
<p>项目使用shared-configs可以引入公用配置。在接口工程的本地配置文件 中引入公用配置，如下：</p> 
<table><thead><tr><th>YAMLspring: application: name: content-api cloud: nacos: server-addr: 192.168.101.65:8848 discovery: namespace: dev group: xuecheng-plus-project config: namespace: dev group: xuecheng-plus-project file-extension: yaml refresh-enabled: true extension-configs: - data-id: content-service-<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
           
             s 
            
           
             p 
            
           
             r 
            
           
             i 
            
           
             n 
            
           
             g 
            
           
             . 
            
           
             p 
            
           
             r 
            
           
             o 
            
           
             f 
            
           
             i 
            
           
             l 
            
           
             e 
            
           
             s 
            
           
             . 
            
           
             a 
            
           
             c 
            
           
             t 
            
           
             i 
            
           
             v 
            
           
             e 
            
           
          
            . 
           
          
            y 
           
          
            a 
           
          
            m 
           
          
            l 
           
          
            g 
           
          
            r 
           
          
            o 
           
          
            u 
           
          
            p 
           
          
            : 
           
          
            x 
           
          
            u 
           
          
            e 
           
          
            c 
           
          
            h 
           
          
            e 
           
          
            n 
           
          
            g 
           
          
            − 
           
          
            p 
           
          
            l 
           
          
            u 
           
          
            s 
           
          
            − 
           
          
            p 
           
          
            r 
           
          
            o 
           
          
            j 
           
          
            e 
           
          
            c 
           
          
            t 
           
          
            r 
           
          
            e 
           
          
            f 
           
          
            r 
           
          
            e 
           
          
            s 
           
          
            h 
           
          
            : 
           
          
            t 
           
          
            r 
           
          
            u 
           
          
            e 
           
          
            s 
           
          
            h 
           
          
            a 
           
          
            r 
           
          
            e 
           
          
            d 
           
          
            − 
           
          
            c 
           
          
            o 
           
          
            n 
           
          
            f 
           
          
            i 
           
          
            g 
           
          
            s 
           
          
            : 
           
          
            − 
           
          
            d 
           
          
            a 
           
          
            t 
           
          
            a 
           
          
            − 
           
          
            i 
           
          
            d 
           
          
            : 
           
          
            s 
           
          
            w 
           
          
            a 
           
          
            g 
           
          
            g 
           
          
            e 
           
          
            r 
           
          
            − 
           
          
         
           {spring.profiles.active}.yaml group: xuecheng-plus-project refresh: true shared-configs: - data-id: swagger- 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right: 0.0278em;">r</span><span class="mord mathnormal">in</span><span class="mord mathnormal" style="margin-right: 0.0359em;">g</span><span class="mord">.</span><span class="mord mathnormal">p</span><span class="mord mathnormal">ro</span><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right: 0.0197em;">l</span><span class="mord mathnormal">es</span><span class="mord">.</span><span class="mord mathnormal">a</span><span class="mord mathnormal">c</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right: 0.0359em;">v</span><span class="mord mathnormal">e</span></span><span class="mord">.</span><span class="mord mathnormal" style="margin-right: 0.0359em;">y</span><span class="mord mathnormal">am</span><span class="mord mathnormal" style="margin-right: 0.0197em;">l</span><span class="mord mathnormal" style="margin-right: 0.0359em;">g</span><span class="mord mathnormal">ro</span><span class="mord mathnormal">u</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord mathnormal">xu</span><span class="mord mathnormal">ec</span><span class="mord mathnormal">h</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right: 0.0359em;">g</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord mathnormal" style="margin-right: 0.0197em;">pl</span><span class="mord mathnormal">u</span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord mathnormal">p</span><span class="mord mathnormal">ro</span><span class="mord mathnormal" style="margin-right: 0.0572em;">j</span><span class="mord mathnormal">ec</span><span class="mord mathnormal">t</span><span class="mord mathnormal">re</span><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span><span class="mord mathnormal">res</span><span class="mord mathnormal">h</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.7778em; vertical-align: -0.0833em;"></span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right: 0.0278em;">r</span><span class="mord mathnormal">u</span><span class="mord mathnormal">es</span><span class="mord mathnormal">ha</span><span class="mord mathnormal">re</span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord mathnormal">co</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right: 0.0359em;">g</span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.7778em; vertical-align: -0.0833em;"></span><span class="mord">−</span><span class="mord mathnormal">d</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.6944em;"></span><span class="mord mathnormal">i</span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.7778em; vertical-align: -0.1944em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal" style="margin-right: 0.0269em;">w</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.0359em;">gg</span><span class="mord mathnormal" style="margin-right: 0.0278em;">er</span><span class="mord">−</span></span></span></span></span>{spring.profiles.active}.yaml group: xuecheng-plus-common refresh: true - data-id: logging-${spring.profiles.active}.yaml group: xuecheng-plus-common refresh: true profiles: active: dev</th></tr></thead></table> 
<p>再以相同 的方法配置日志的公用配置。</p> 
<p><img src="https://images2.imgbox.com/50/45/MWm6lq28_o.png" alt=""></p> 
<p>在接口工程和业务工程，引入loggin-dev.yaml公用配置文件</p> 
<p><img src="https://images2.imgbox.com/3b/d6/fwsT58eF_o.png" alt=""></p> 
<p>配置完成，重启content-api接口工程，访问http://localhost:63040/content/swagger-ui.html 查看swagger接口文档是否可以正常访问，查看控制台log4j2日志输出是否正常。</p> 
<h4><a id="224__224"></a><strong>2.2.4 系统管理配置</strong></h4> 
<p>按照上边的方法 自行将系统管理服务的配置信息在nacos上进行配置。</p> 
<h4><a id="225__228"></a><strong>2.2.5 配置优先级</strong></h4> 
<p>到目前为止已将所有微服务的配置统一在nacos进行配置，用到的配置文件有本地的配置文件 bootstrap.yaml和nacos上的配置文件，引入配置文件的形式有：</p> 
<p>1、通过dataid方式引入</p> 
<p>2、以扩展配置文件方式引入</p> 
<p>3、以共享配置文件 方式引入</p> 
<p>下边测试这几种配置文件方式的优先级。</p> 
<p>我们使用内容管理服务中的配置文件，首先在共享配置文件 swagger-dev.yaml中配置四个配置项，如下：</p> 
<p><img src="https://images2.imgbox.com/0e/01/K57p9Dtk_o.png" alt=""></p> 
<p>配置完成发布。</p> 
<p>下边在content-api工程的启动类中添加如下代码读取这四个配置项的值</p> 
<table><thead><tr><th>Javapackage com.xuecheng; import com.spring4all.swagger.EnableSwagger2Doc; import org.springframework.beans.factory.annotation.Value; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.context.annotation.Bean; @EnableSwagger2Doc @SpringBootApplication public class ContentApplication { @Value(“<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
           
             t 
            
           
             e 
            
           
             s 
            
            
            
              t 
             
            
              c 
             
            
           
             o 
            
           
             n 
            
           
             f 
            
           
             i 
            
           
             g 
            
           
             . 
            
           
             a 
            
           
          
            " 
           
          
            ) 
           
          
            S 
           
          
            t 
           
          
            r 
           
          
            i 
           
          
            n 
           
          
            g 
           
          
            a 
           
          
            ; 
           
          
            @ 
           
          
            V 
           
          
            a 
           
          
            l 
           
          
            u 
           
          
            e 
           
          
            ( 
           
          
            " 
           
          
         
           {test_config.a}") String a; @Value(" 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="mord mathnormal">es</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right: 0.0359em;">g</span><span class="mord">.</span><span class="mord mathnormal">a</span></span><span class="mord">"</span><span class="mclose">)</span><span class="mord mathnormal">St</span><span class="mord mathnormal" style="margin-right: 0.0278em;">r</span><span class="mord mathnormal">in</span><span class="mord mathnormal" style="margin-right: 0.0359em;">g</span><span class="mord mathnormal">a</span><span class="mpunct">;</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord">@</span><span class="mord mathnormal">Va</span><span class="mord mathnormal" style="margin-right: 0.0197em;">l</span><span class="mord mathnormal">u</span><span class="mord mathnormal">e</span><span class="mopen">(</span><span class="mord">"</span></span></span></span></span>{test_config.b}”) String b; @Value(“<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
           
             t 
            
           
             e 
            
           
             s 
            
            
            
              t 
             
            
              c 
             
            
           
             o 
            
           
             n 
            
           
             f 
            
           
             i 
            
           
             g 
            
           
             . 
            
           
             c 
            
           
          
            " 
           
          
            ) 
           
          
            S 
           
          
            t 
           
          
            r 
           
          
            i 
           
          
            n 
           
          
            g 
           
          
            c 
           
          
            ; 
           
          
            @ 
           
          
            V 
           
          
            a 
           
          
            l 
           
          
            u 
           
          
            e 
           
          
            ( 
           
          
            " 
           
          
         
           {test_config.c}") String c; @Value(" 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="mord mathnormal">es</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right: 0.0359em;">g</span><span class="mord">.</span><span class="mord mathnormal">c</span></span><span class="mord">"</span><span class="mclose">)</span><span class="mord mathnormal">St</span><span class="mord mathnormal" style="margin-right: 0.0278em;">r</span><span class="mord mathnormal">in</span><span class="mord mathnormal" style="margin-right: 0.0359em;">g</span><span class="mord mathnormal">c</span><span class="mpunct">;</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord">@</span><span class="mord mathnormal">Va</span><span class="mord mathnormal" style="margin-right: 0.0197em;">l</span><span class="mord mathnormal">u</span><span class="mord mathnormal">e</span><span class="mopen">(</span><span class="mord">"</span></span></span></span></span>{test_config.d}”) String d; @Bean public Integer getTest(){ System.<em>out</em>.println(“a=”+a); System.<em>out</em>.println(“b=”+b); System.<em>out</em>.println(“c=”+c); System.<em>out</em>.println(“d=”+d); return new Integer(1); } public static void main(String[] args) { SpringApplication.<em>run</em>(ContentApplication.class, args); } }</th></tr></thead></table> 
<p>启动content-api工程，在return new Integer(1);处打断点，运行到断点处，如下：</p> 
<p><img src="https://images2.imgbox.com/eb/10/LyhpyK97_o.png" alt=""></p> 
<p>这说明已经成功读取到 四个配置项的值。</p> 
<p>下边在content-api工程的扩展配置文件 conent-service-dev.yaml中配置三个配置项，如下：</p> 
<p><img src="https://images2.imgbox.com/c4/03/HWGR4xT0_o.png" alt=""></p> 
<p>再次重启content-api工程，在return new Integer(1);处打断点，运行到断点处，如下：</p> 
<p><img src="https://images2.imgbox.com/a2/08/I44Si0sO_o.png" alt=""></p> 
<p>从结果可以看出，扩展配置文件比共享配置文件优先级高。</p> 
<p>下边继续content-api-dev.yaml中配置两个配置项，如下：</p> 
<p><img src="https://images2.imgbox.com/53/ff/ioqLjdRs_o.png" alt=""></p> 
<p>再次重启内容管理接口工程，在return new Integer(1);处打断点，运行到断点处，如下：</p> 
<p><img src="https://images2.imgbox.com/64/a9/fnqdmtqJ_o.png" alt=""></p> 
<p>从结果可以看出，通过工程的应用名找到配置文件 content-api-dev.yaml优先级比扩展配置文件 高。</p> 
<p>下边我们在content-api工程的本地配置文件bootstrap.yaml中配置如下：</p> 
<table><thead><tr><th>YAMLtest_config: a: 4a b: 4b c: 4c d: 4d</th></tr></thead></table> 
<p>再次重启内容管理接口工程，在return new Integer(1);处打断点，运行到断点处，如下：</p> 
<p><img src="https://images2.imgbox.com/8c/2a/d7AN9XGr_o.png" alt=""></p> 
<p>这说明本地配置文件配置的内容没有起作用，原因是nacos配置文件中的相同的配置项覆盖了本地的配置项。</p> 
<p>到这可以总结各各配置文件 的优先级：项目应用名配置文件 &gt; 扩展配置文件 &gt; 共享配置文件 &gt; 本地配置文件。</p> 
<p>有时候我们在测试程序时直接在本地加一个配置进行测试，这时我们想让本地最优先，可以在nacos配置文件 中配置如下即可实现：</p> 
<table><thead><tr><th>YAML#配置本地优先 spring: cloud: config: override-none: true</th></tr></thead></table> 
<p>再次重启content-api工程，在return new Integer(1);处打断点，运行到断点处，如下：</p> 
<p><img src="https://images2.imgbox.com/a5/ea/TFjNfsme_o.png" alt=""></p> 
<p>可以看出此时本地配置最优先。</p> 
<h4><a id="226__301"></a><strong>2.2.6 导入配置文件</strong></h4> 
<p>课程资料中提供了系统用的所有配置文件nacos_config_export.zip，下边将nacos_config_export.zip导入nacos。</p> 
<p>进入具体的命名空间，点击“导入配置”</p> 
<p><img src="https://images2.imgbox.com/f7/58/FAhw1PYJ_o.png" alt=""></p> 
<p>打开导入窗口</p> 
<p><img src="https://images2.imgbox.com/2f/cc/KbFj4eu5_o.png" alt=""></p> 
<p>相同的配置选择覆盖配置。</p> 
<p>点击“上传文件”选择nacos_config_export.zip开始导入。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5ee67fca0999c88dd26c2a5ff8432d27/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">中缀表达式转后缀表达式看完这一篇文章你就懂了</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/91de13878e560c6df3be0a496c1af805/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">基于Java Web的新闻发布系统</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>