<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Linux【Centos】服务器目录通过Samba映射到Windows磁盘驱动器 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Linux【Centos】服务器目录通过Samba映射到Windows磁盘驱动器" />
<meta property="og:description" content="公司里工作，有一些linux服务器主要存放项目分支的代码和一些文档，我们在windows上通过目录映射，可以用notepad、sublime、vs等编辑打开服务器端的文件，这样直接编辑访问服务器的目录显得比较方面，编写代码也可以使用自己习惯的工具。在家里为了在电脑上能连接虚拟机的centos操作目录，通过搭建Samba来实现。
Samba是linux的一个服务。下面介绍一下实现映射的配置过程，注意linux目录的权限，好几次配置完成后，windows访问映射的目录不能进行读写操作，提示无权限。
搭建步骤： 一、安装Samba
没有安装Samba的先进行安装，centos下命令如下
[root@localhost home]# yum install samba samba-client 二、创建Samba账号
首先为samba服务器创建一个用户组：groupadd admin （这里我的用户组和用户都命名为admin，包括后面的密码）
然后，在samba用户组下创建用户： useradd -g admin admin
[root@localhost /]# groupadd admin [root@localhost /]# useradd -g admin admin 接着，给需要映射的目录授权。假设需要映射的目录为/home
# 755可能导致权限不足 [root@localhost home]# chmod -R 777 /home [root@localhost home]# chown -R admin:admin /home 【注意】关于chown命令的使用：先用户其次才是用户组（用户:用户组）
三、修改Samba配置文件
没有安装vim的，yum install vim进行安装
[root@localhost home]# vim /etc/samba/smb.conf 我的配置如下：
注意security字段值不要改为share，可能导致smb服务起不来
linsirs相当于这个目录映射的别名，自己命名即可。指定之前创建的用户组和用户，path就是你需要映射到windows进行访问的目录，其他字段直接照搬就行。
【备注】看了很多博客有配置其他属性字段的，但至少这里新增的字段是能够实现目录的映射的。
四、为samba用户admin设置密码
[root@localhost samba]# smbpasswd -a admin New SMB password: Retype new SMB password: Added user admin." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/efac06a707f342a2404ac51a5a6a44d7/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-03-29T23:14:51+08:00" />
<meta property="article:modified_time" content="2019-03-29T23:14:51+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Linux【Centos】服务器目录通过Samba映射到Windows磁盘驱动器</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>公司里工作，有一些linux服务器主要存放项目分支的代码和一些文档，我们在windows上通过目录映射，可以用notepad、sublime、vs等编辑打开服务器端的文件，这样直接编辑访问服务器的目录显得比较方面，编写代码也可以使用自己习惯的工具。在家里为了在电脑上能连接虚拟机的centos操作目录，通过搭建Samba来实现。</p> 
<p style="text-indent:0;">Samba是linux的一个服务。下面介绍一下实现映射的配置过程，注意linux目录的权限，好几次配置完成后，windows访问映射的目录不能进行读写操作，提示无权限。</p> 
<hr> 
<h3 id="%E6%90%AD%E5%BB%BA%E6%AD%A5%E9%AA%A4%EF%BC%9A"><strong>搭建步骤：</strong></h3> 
<p><strong>一、安装Samba</strong></p> 
<p>没有安装Samba的先进行安装，centos下命令如下</p> 
<pre class="has"><code class="language-bash">[root@localhost home]# yum install samba samba-client</code></pre> 
<p><strong>二、创建Samba账号</strong></p> 
<p>首先为samba服务器创建一个用户组：groupadd admin （这里我的用户组和用户都命名为admin，包括后面的密码）</p> 
<p>然后，在samba用户组下创建用户：   useradd -g admin  admin</p> 
<pre class="has"><code class="language-bash">[root@localhost /]# groupadd admin
[root@localhost /]# useradd -g admin admin</code></pre> 
<p>接着，给需要映射的目录授权。假设需要映射的目录为/home</p> 
<pre class="has"><code class="language-bash"># 755可能导致权限不足
[root@localhost home]# chmod -R 777 /home
[root@localhost home]# chown -R admin:admin /home</code></pre> 
<p><span style="color:#f33b45;">【注意】</span>关于chown命令的使用：先用户其次才是用户组（用户:用户组）<br>  </p> 
<p><strong>三、修改Samba配置文件</strong></p> 
<p>没有安装vim的，yum install vim进行安装</p> 
<pre class="has"><code class="language-bash">[root@localhost home]# vim /etc/samba/smb.conf</code></pre> 
<p>我的配置如下：</p> 
<p><span style="color:#f33b45;"><strong>注意security字段值不要改为share，可能导致smb服务起不来</strong></span></p> 
<p><img alt="" class="has" height="187" src="https://images2.imgbox.com/70/61/14ZKBMhe_o.png" width="598"></p> 
<p>linsirs相当于这个目录映射的别名，自己命名即可。指定之前创建的用户组和用户，path就是你需要映射到windows进行访问的目录，其他字段直接照搬就行。</p> 
<p>【备注】看了很多博客有配置其他属性字段的，但至少这里新增的字段是能够实现目录的映射的。</p> 
<p><img alt="" class="has" src="https://images2.imgbox.com/a8/34/CyOAqo2S_o.png"></p> 
<p><strong>四、为samba用户admin设置密码</strong></p> 
<pre class="has"><code class="language-bash">[root@localhost samba]# smbpasswd -a admin
New SMB password:
Retype new SMB password:
Added user admin.
[root@localhost samba]# systemctl start smb.service
</code></pre> 
<p><strong>五、开放samba端口号</strong></p> 
<p>如果防火墙开启，则需要开放下面几个samba服务的端口号。首先，需要知道使用samba服务器需要防火墙开放以下端口</p> 
<p>UDP 137<br> UDP 138<br> TCP 139<br> TCP 445</p> 
<p>使用firewall-cmd命令：</p> 
<pre class="has"><code class="language-bash">[root@localhost samba]# firewall-cmd --add-port=137/udp --permanent
success
[root@localhost samba]# firewall-cmd --add-port=138/udp --permanent
success
[root@localhost samba]# firewall-cmd --add-port=139/tcp --permanent
success
[root@localhost samba]# firewall-cmd --add-port=445/tcp --permanent
success
[root@localhost samba]# firewall-cmd --reload
success</code></pre> 
<p>到这里，samba服务器的项目配置工作已经完成了，但我映射访问后，尝试新建文件夹、文件等读写操作时，提示无权限，联系管理员什么的，看了很多文章才找到解决方法。</p> 
<p>试过这几个命令，都没奏效：</p> 
<pre class="has"><code class="language-bash">[root@localhost home]# chmod -R a+rwx /home
[root@localhost home]# systemctl stop firewalld</code></pre> 
<p>正确方法：</p> 
<p>确保setlinux关闭，可以用setenforce 0命令执行。 默认的，SELinux禁止网络上对samba服务器上的共享目录进行写操作，即使你在smb.conf中允许了这项操作。<br> 执行这两条命令解决权限问题：</p> 
<pre class="has"><code class="language-bash">[root@localhost home]# iptables -F

[root@localhost home]# setenforce 0</code></pre> 
<p> 【服务启动】</p> 
<p>配置完成后，别忘记启动服务，服务启动停止相关命令：</p> 
<pre class="has"><code class="language-bash">启动samba服务

[root@localhost samba]# systemctl start smb.service

关闭samba服务

[root@localhost samba]# systemctl stop smb.service

开机启动samba服务

[root@localhost samba]# systemctl enable smb.service

查看samba服务状态

[root@localhost samba]# systemctl status smb
</code></pre> 
<p> </p> 
<p><strong>六、目录成功映射并进行读写：</strong></p> 
<p><img alt="" class="has" height="194" src="https://images2.imgbox.com/3a/33/DApxZM1i_o.png" width="690"></p> 
<p id="main-toc"> </p> 
<p><img alt="" class="has" height="102" src="https://images2.imgbox.com/a9/e5/025kuJ37_o.png" width="483"></p> 
<p> </p> 
<p><strong>【备注】</strong></p> 
<p>如果有问题，以下几点需要确定：</p> 
<p>确定samba服务已正常启动；samba服务端口没有被禁止；有权限进入samba共享目录；</p> 
<p>服务正常的状态：</p> 
<pre class="has"><code class="language-bash">[root@localhost home]# systemctl status smb
● smb.service - Samba SMB Daemon
   Loaded: loaded (/usr/lib/systemd/system/smb.service; disabled; vendor preset: disabled)
   Active: active (running) since 五 2019-03-29 21:27:11 CST; 11min ago
     Docs: man:smbd(8)
           man:samba(7)
           man:smb.conf(5)
 Main PID: 7479 (smbd)
   Status: "smbd: ready to serve connections..."
   CGroup: /system.slice/smb.service
           ├─7479 /usr/sbin/smbd --foreground --no-process-group
           ├─7481 /usr/sbin/smbd --foreground --no-process-group
           ├─7482 /usr/sbin/smbd --foreground --no-process-group
           ├─7483 /usr/sbin/smbd --foreground --no-process-group
           └─7485 /usr/sbin/smbd --foreground --no-process-group</code></pre> 
<p>检查samba 的权限配置，testparm -s 命令可以检查此文件是否有错误，如错误，会显示其行号。</p> 
<pre class="has"><code class="language-bash">[root@localhost home]# testparm -s
Load smb config files from /etc/samba/smb.conf
rlimit_max: increasing rlimit_max (1024) to minimum Windows limit (16384)
Processing section "[homes]"
Processing section "[printers]"
Processing section "[print$]"
Processing section "[linsirs]"
Global parameter workgroup found in service section!
Global parameter netbios name found in service section!
Loaded services file OK.
Server role: ROLE_STANDALONE

# Global parameters
[global]
	printcap name = cups
	security = USER
	smb passwd file = /etc/samba/smbpasswd
	workgroup = SAMBA
	idmap config * : backend = tdb
	cups options = raw


[homes]
	browseable = No
	comment = Home Directories
	inherit acls = Yes
	read only = No
	valid users = %S %D%w%S


[printers]
	browseable = No
	comment = All Printers
	create mask = 0600
	path = /var/tmp
	printable = Yes


[print$]
	comment = Printer Drivers
	create mask = 0664
	directory mask = 0775
	force group = @printadmin
	path = /var/lib/samba/drivers
	write list = @printadmin root


[linsirs]
	create mask = 0777
	directory mask = 0777
	guest ok = Yes
	path = /home
	read only = No</code></pre> 
<p style="text-indent:50px;">至此，所有配置都已完成，按照步骤来可以成功实现目录的映射。</p> 
<p>另外了解到CIFS协议也可以实现此功能，有兴趣的同学可以配置实现以下。</p> 
<p> </p> 
<p>参考链接：<a href="https://blog.csdn.net/u010480282/article/details/80518836">https://blog.csdn.net/u010480282/article/details/80518836</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b4ae0c7f1ef0ba0e4f59e7bf532462ea/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Python基本组合数据类型介绍</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9647f34a19c6d8623ea7e5b2cd14bdbf/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Tensor张量：高维数据处理方法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>