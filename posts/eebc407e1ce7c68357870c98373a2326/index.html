<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Chrome 浏览器插件 cookies API 解析 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Chrome 浏览器插件 cookies API 解析" />
<meta property="og:description" content="Chrome.cookie 前端开发肯定少不了和 cookie 打交道，此文较详细的介绍下 chrome.cookie 的 API 以及在 popup、service worker、content 中如何获取的
一、权限（Permissions） 如果需使用 Cookie API，需要在 manifest.json 文件中添加权限（Permissions）和主机权限（host_permissions）字段
&#34;permissions&#34;: [ &#34;cookies&#34; ], &#34;host_permissions&#34;: [ &#34;https://*.lkcoffee.com/*&#34; ] 比如，我需要获取 domain 为 .lkcoffee.com 的 cookie，就需要在 host_permissions 中进行 host 的配置
二、类型（Types） 1. Cookie 表示关于 HTTP Cookie 的信息。
属性 domain: string cookie 的 domain expirationDate: number 可选 Cookie 的有效期 hostOnly: boolean host-only 时为 true httpOnly: boolean httpOnly 时为 true name: string 名称 partitionKey: CookiePartitionKey 可选 用于通过分区属性读取或修改 Cookie 的分区键。 path: string 路径 sameSite: SameSiteStatus 同网站状态。 secure: boolean Secure 值 session: booean 是否是会话 storeId: string 包含此 Cookie 的 Cookie 存储区的 ID，如 getAllCookieStores() 中所提供。 value: string cookie 值 2." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/eebc407e1ce7c68357870c98373a2326/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-17T17:14:31+08:00" />
<meta property="article:modified_time" content="2024-01-17T17:14:31+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Chrome 浏览器插件 cookies API 解析</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night-eighties">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="Chromecookie_0"></a>Chrome.cookie</h2> 
<p>前端开发肯定少不了和 <code>cookie</code> 打交道，此文较详细的介绍下 <code>chrome.cookie</code> 的 <code>API</code> 以及在 <code>popup、service worker、content</code> 中如何获取的</p> 
<h3><a id="Permissions_4"></a>一、权限（Permissions）</h3> 
<p>如果需使用 <code>Cookie API</code>，需要在 <code>manifest.json</code> 文件中添加权限（<code>Permissions</code>）和主机权限（<code>host_permissions</code>）字段</p> 
<pre><code class="prism language-json"><span class="token string-property property">"permissions"</span><span class="token operator">:</span> <span class="token punctuation">[</span>    
    <span class="token string">"cookies"</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token string-property property">"host_permissions"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">"https://*.lkcoffee.com/*"</span>
<span class="token punctuation">]</span>
</code></pre> 
<p>比如，我需要获取 <code>domain</code> 为 <code>.lkcoffee.com</code> 的 <code>cookie</code>，就需要在 <code>host_permissions</code> 中进行 <code>host</code> 的配置</p> 
<h3><a id="Types_17"></a>二、类型（<code>Types</code>）</h3> 
<h4><a id="1_Cookie_18"></a>1. <code>Cookie</code></h4> 
<blockquote> 
 <p>表示关于 <code>HTTP Cookie</code> 的信息。</p> 
</blockquote> 
<h5><a id="_20"></a>属性</h5> 
<ul><li><code>domain: string</code> 
  <ul><li><code>cookie</code> 的 <code>domain</code></li></ul> </li><li><code>expirationDate: number</code> 可选 
  <ul><li><code>Cookie</code> 的有效期</li></ul> </li><li><code>hostOnly: boolean</code> 
  <ul><li><code>host-only</code> 时为 <code>true</code></li></ul> </li><li><code>httpOnly: boolean</code> 
  <ul><li><code>httpOnly</code> 时为 <code>true</code></li></ul> </li><li><code>name: string</code> 
  <ul><li>名称</li></ul> </li><li><code>partitionKey: CookiePartitionKey</code> 可选 
  <ul><li>用于通过分区属性读取或修改 <code>Cookie</code> 的分区键。</li></ul> </li><li><code>path: string</code> 
  <ul><li>路径</li></ul> </li><li><code>sameSite: SameSiteStatus</code> 
  <ul><li>同网站状态。</li></ul> </li><li><code>secure: boolean</code> 
  <ul><li><code>Secure</code> 值</li></ul> </li><li><code>session: booean</code> 
  <ul><li>是否是会话</li></ul> </li><li><code>storeId: string</code> 
  <ul><li>包含此 <code>Cookie</code> 的 <code>Cookie</code> 存储区的 <code>ID</code>，如 <code>getAllCookieStores()</code> 中所提供。</li></ul> </li><li><code>value: string</code> 
  <ul><li><code>cookie</code> 值</li></ul> </li></ul> 
<h4><a id="2_CookieDetails_46"></a>2. <code>CookieDetails</code></h4> 
<blockquote> 
 <p>用于标识 <code>Cookie</code> 的详细信息。</p> 
</blockquote> 
<h5><a id="_49"></a>属性</h5> 
<ul><li><code>name: string</code> 
  <ul><li>要访问的 <code>Cookie</code> 的名称。</li></ul> </li><li><code>partitionKey: CookiePartitionKey</code> 可选 
  <ul><li>用于通过分区属性读取或修改 <code>Cookie</code> 的分区键。</li></ul> </li><li><code>storeId: string</code> 可选 
  <ul><li>要在其中查找 <code>Cookie</code> 的 <code>Cookie</code> 存储区的 <code>ID</code></li></ul> </li><li><code>url: string</code> 
  <ul><li>与要访问的 <code>Cookie</code> 相关联的网址。</li></ul> </li></ul> 
<h4><a id="3_CookiePartitionKey_59"></a>3. <code>CookiePartitionKey</code></h4> 
<blockquote> 
 <p>表示分区 <code>Cookie</code> 的分区键。</p> 
</blockquote> 
<h5><a id="_62"></a>属性</h5> 
<ul><li><code>topLevelSite: string</code> 可选 
  <ul><li>提供分区 <code>Cookie</code> 的 <code>top-level</code></li></ul> </li></ul> 
<h4><a id="4_CookieStore_66"></a>4. <code>CookieStore</code></h4> 
<blockquote> 
 <p>表示浏览器中的 <code>Cookie</code> 存储</p> 
</blockquote> 
<h5><a id="_68"></a>属性</h5> 
<ul><li><code>id: string</code> 
  <ul><li><code>Cookie</code> 存储区的唯一标识符。</li></ul> </li><li><code>tabIds: number[]</code> 
  <ul><li>共享此 <code>Cookie</code> 存储区的所有浏览器标签页的标识符。</li></ul> </li></ul> 
<h4><a id="5_OnChangedCause_73"></a>5. <code>OnChangedCause</code></h4> 
<blockquote> 
 <p><code>Cookie</code> 发生更改的根本原因。</p> 
</blockquote> 
<blockquote> 
 <p>如果 <code>Cookie</code> 已插入或通过显式调用 <code>chrome.cookies.remove</code> 被移除，为 <code>explicit</code>。如果 <code>Cookie</code> 是因过期而自动移除的，为 <code>expired</code>。如果 <code>Cookie</code> 因被已过期的失效日期覆盖而被移除，为 <code>expired_overwrite</code>。如果 <code>Cookie</code> 因垃圾回收而自动移除，为 <code>evicted</code>。如果 <code>Cookie</code> 因 <code>set</code> 调用覆盖而自动移除，为 <code>overwrite</code>。</p> 
</blockquote> 
<h5><a id="_77"></a>枚举</h5> 
<ul><li><code>evicted</code></li><li><code>expired</code></li><li><code>explicit</code></li><li><code>expired_overwrite</code></li><li><code>overwrite</code></li></ul> 
<h4><a id="6_SameSiteStatus_85"></a>6. SameSiteStatus</h4> 
<blockquote> 
 <p><code>Cookie</code> 的 <code>SameSite</code> 状态。</p> 
</blockquote> 
<blockquote> 
 <p><code>no_restriction</code>为 <code>SameSite=None</code>，<code>lax</code> 为<code>SameSite=Lax</code>，<code>strict</code> 为 <code>SameSite=Strict</code>，<code>unspecified</code> 为没有设置 <code>SameSite</code> 属性的 <code>Cookie</code>。</p> 
</blockquote> 
<h5><a id="_90"></a>枚举</h5> 
<ul><li><code>no_restriction</code>：<code>SameSite=None</code></li><li><code>lax</code>：<code>SameSite=Lax</code></li><li><code>strict</code>：<code>SameSite=Strict</code></li><li><code>unspecified</code>：没有设置 <code>SameSite</code></li></ul> 
<h3><a id="Methods_97"></a>三、方法（<code>Methods</code>）</h3> 
<h4><a id="1_get_99"></a>1. <code>get()</code></h4> 
<blockquote> 
 <p>检索单个 <code>Cookie</code> 的相关信息。如果指定网址存在多个同名的 <code>Cookie</code>，则返回路径最长的 <code>Cookie</code>。对于具有相同路径长度的 <code>Cookie</code>，系统将返回创建时间最早的 <code>Cookie</code>。</p> 
</blockquote> 
<h5><a id="11__101"></a>1.1 示例</h5> 
<pre><code class="prism language-ts">chrome<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>
  details<span class="token operator">:</span>
  CookieDetails<span class="token punctuation">,</span>
  callback<span class="token operator">?</span><span class="token operator">:</span>
  <span class="token keyword">function</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
</code></pre> 
<h5><a id="12__110"></a>1.2 参数</h5> 
<ul><li><code>details: CookieDetails</code></li><li><code>callback: function</code> 可选 
  <ul><li><code>(cookie?: Cookie)=&gt;void</code></li></ul> </li></ul> 
<h5><a id="13__115"></a>1.3 返回</h5> 
<ul><li><code>Promise&lt;Cookie|undefined&gt;</code></li></ul> 
<h4><a id="2_getAll_120"></a>2. <code>getAll()</code></h4> 
<blockquote> 
 <p>从单个 Cookie 存储区中检索符合指定信息的所有 Cookie。返回的 Cookie 将进行排序，路径最长的 Cookie 排在最前面。如果多个 Cookie 具有相同的路径长度，创建时间最早的 Cookie 会排在最前面。此方法仅检索扩展程序拥有主机权限的网域的 Cookie。</p> 
</blockquote> 
<h5><a id="21__122"></a>2.1 示例</h5> 
<pre><code class="prism language-ts">chrome<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span>
  details<span class="token operator">:</span>
  object<span class="token punctuation">,</span>
  callback<span class="token operator">?</span><span class="token operator">:</span>
  <span class="token keyword">function</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
</code></pre> 
<h5><a id="22__131"></a>2.2 参数</h5> 
<ul><li><code>details: object</code> 
  <ul><li><code>domain: string</code> 可选</li><li><code>name: string</code> 可选</li><li><code>partitionKey: CookiePartitionKey</code> 可选 
    <ul><li>用于通过分区属性读取或修改 <code>Cookie</code> 的分区键。</li></ul> </li><li><code>path: string</code> 可选</li><li><code>secure: boolean</code> 可选</li><li><code>session: boolean</code> 可选</li><li><code>storeId: string</code> 可选</li><li><code>url: string</code> 可选</li></ul> </li><li><code>callback: function</code> 可选 
  <ul><li><code>(cookies:Cookie[])=&gt;void</code></li></ul> </li></ul> 
<h5><a id="23__145"></a>2.3 返回</h5> 
<ul><li><code>Promise&lt;Cookie[]&gt;</code></li></ul> 
<h4><a id="3_getAllCookieStores_150"></a>3. <code>getAllCookieStores()</code></h4> 
<blockquote> 
 <p>列出所有现有的 <code>Cookie</code> 存储。</p> 
</blockquote> 
<h5><a id="31__152"></a>3.1 示例</h5> 
<pre><code class="prism language-ts">chrome<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span><span class="token function">getAllCookieStores</span><span class="token punctuation">(</span>
  callback<span class="token operator">?</span><span class="token operator">:</span>
  <span class="token keyword">function</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
</code></pre> 
<h5><a id="32_159"></a>3.2参数</h5> 
<ul><li><code>callback: function</code> 可选 
  <ul><li><code>(cookieStores: CookieStore[])=&gt;void</code></li></ul> </li></ul> 
<h5><a id="33__162"></a>3.3 返回</h5> 
<ul><li><code>Promise&lt;CookieStore[]&gt;</code></li></ul> 
<h4><a id="4_remove_166"></a>4. <code>remove()</code></h4> 
<blockquote> 
 <p>按名称删除 Cookie。</p> 
</blockquote> 
<h5><a id="41__168"></a>4.1 示例</h5> 
<pre><code class="prism language-ts">chrome<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>
  details<span class="token operator">:</span>
  CookieDetails<span class="token punctuation">,</span>
  callback<span class="token operator">?</span><span class="token operator">:</span>
  <span class="token keyword">function</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
</code></pre> 
<h5><a id="42__177"></a>4.2 参数</h5> 
<ul><li><code>details: CookieDetails</code> 
  <ul><li><code>name: string</code></li><li><code>partitionKey: CookiePartitionKey</code> 可选 
    <ul><li>用于通过分区属性读取或修改 <code>Cookie</code> 的分区键。</li></ul> </li><li><code>storeId: string</code></li><li><code>url: string</code></li></ul> </li><li><code>callback: function</code> 可选 
  <ul><li><code>(details?:object)=&gt;void</code></li></ul> </li></ul> 
<h5><a id="43__186"></a>4.3 返回</h5> 
<ul><li><code>Promise&lt;object|undefined&gt;</code></li></ul> 
<h4><a id="5_set_189"></a>5. <code>set()</code></h4> 
<blockquote> 
 <p>使用指定的 <code>Cookie</code> 数据设置 <code>Cookie</code>；可能会覆盖等效的 <code>Cookie</code>（如果存在）。</p> 
</blockquote> 
<h5><a id="51__191"></a>5.1 示例</h5> 
<pre><code class="prism language-ts">chrome<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>
  details<span class="token operator">:</span>
  object<span class="token punctuation">,</span>
  callback<span class="token operator">?</span><span class="token operator">:</span>
  <span class="token keyword">function</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
</code></pre> 
<h5><a id="52__201"></a>5.2 参数</h5> 
<ul><li><code>details: object</code> 
  <ul><li><code>domain: string</code> 可选 
    <ul><li><code>cookie</code> 的 <code>domain</code></li></ul> </li><li><code>expirationDate: number</code> 可选 
    <ul><li><code>Cookie</code> 的有效期</li></ul> </li><li><code>httpOnly: boolean</code> 可选 
    <ul><li><code>httpOnly</code> 时为 <code>true</code></li></ul> </li><li><code>name: string</code> 可选 
    <ul><li>名称</li></ul> </li><li><code>partitionKey: CookiePartitionKey</code> 可选 
    <ul><li>用于通过分区属性读取或修改 <code>Cookie</code> 的分区键。</li></ul> </li><li><code>path: string</code> 可选 
    <ul><li>路径</li></ul> </li><li><code>sameSite: SameSiteStatus</code> 可选 
    <ul><li>同网站状态。</li></ul> </li><li><code>secure: boolean</code> 可选 
    <ul><li><code>Secure</code> 值</li></ul> </li><li><code>storeId: string</code> 可选 
    <ul><li>包含此 <code>Cookie</code> 的 <code>Cookie</code> 存储区的 <code>ID</code>，如 <code>getAllCookieStores()</code> 中所提供。</li></ul> </li><li><code>url: string</code></li><li><code>value: string</code> 可选 
    <ul><li><code>cookie</code> 值</li></ul> </li></ul> </li><li><code>callback: function</code> 可选 
  <ul><li><code>(cookie?:Cookie)=&gt;void</code></li></ul> </li></ul> 
<h5><a id="53_226"></a>5.3返回</h5> 
<ul><li><code>Promise&lt;Cookie|undefined&gt;</code></li></ul> 
<h3><a id="Action_Popup__Cookies_229"></a>四、<code>Action Popup</code> 模块获取 <code>Cookies</code></h3> 
<pre><code class="prism language-typescript"><span class="token comment">// 根据 domain 获取</span>
<span class="token keyword">const</span> cookies <span class="token operator">=</span> <span class="token keyword">await</span> chrome<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> domain<span class="token operator">:</span>  <span class="token string">'.lkcoffee.com'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'popup cookies---&gt;'</span><span class="token punctuation">,</span> cookies<span class="token punctuation">)</span>
<span class="token comment">// 根据 url 获取</span>
<span class="token keyword">const</span> urlCookies <span class="token operator">=</span> <span class="token keyword">await</span> chrome<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> url<span class="token operator">:</span> url <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"popup urlCookies"</span><span class="token punctuation">,</span> urlCookies<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/22/57/4oug8st7_o.png" alt="image.png"></p> 
<h3><a id="Background_Service_Worker__Cookies_241"></a>五、<code>Background Service Worker</code> 模块获取 <code>Cookies</code></h3> 
<pre><code class="prism language-typescript"><span class="token keyword">const</span> cookies <span class="token operator">=</span> <span class="token keyword">await</span> chrome<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> domain<span class="token operator">:</span>  <span class="token string">'.lkcoffee.com'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'service worker cookies---&gt;'</span><span class="token punctuation">,</span> cookies<span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/62/22/83Vm0tWq_o.png" alt="image.png"></p> 
<h3><a id="Content_Scripts__Cookies_250"></a>六、<code>Content Scripts</code> 模块获取 <code>Cookies</code></h3> 
<p>因为 <code>Content Scripts</code> 是注入当前页面的，所以和 <code>web</code> 一样获取即可</p> 
<pre><code class="prism language-ts">document<span class="token punctuation">.</span>cookie
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/fe931f82060ef2a883f4fca24a3bbd69/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">#Android Studio使用01#</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/59accc6d081f6da8df81bce0d513a71b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">FFmpeg之PostProc</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>