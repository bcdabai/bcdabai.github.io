<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>GitHub Action 使用 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="GitHub Action 使用" />
<meta property="og:description" content="GitHub Action 使用 GitHub Actions 是一种持续集成和持续交付 (CI/CD) 平台，可用于自动执行生成、测试和部署管道。 您可以创建工作流程来构建和测试存储库的每个拉取请求，或将合并的拉取请求部署到生产环境。GitHub 提供 Linux、Windows 和 macOS 虚拟机来运行工作流程，或者您可以在自己的数据中心或云基础架构中托管自己的自托管运行器。
计费规则 公共存储库中标准 GitHub 托管的运行器和自托管运行器可免费使用 GitHub Actions。 对于专用存储库，每个 GitHub 帐户可获得一定数量的免费时间和存储以用于 GitHub 托管的运行器，具体取决于帐户所使用的产品。 超出包含数量的任何使用量都由支出限制控制。分钟数每月重置一次，而存储空间使用量不会重置。ci机器使用超过 2 核的 Windows 和 Ubuntu 运行器，将始终收取费用，包括在公共存储库中。其中GitHub Free 给的存储是 500M,2000分钟/月。在 GitHub 主机的 Windows 和 macOS 运行器上运行的作业，其消耗分钟数是在 Linux 运行器上运行的作业的 2 倍和 10 倍。 例如，1000 分钟的 Windows 使用时间将占用帐户中包含的 2000 分钟。 1000 分钟的 macOS 使用时间将占用帐户中包含的 10000 分钟。仓库使用的存储空间是 GitHub Actions 构件和 GitHub Packages 使用的存储空间总计。
查看 GitHub Actions 使用情况 操作路径：在GitHub右上角点击头像 -&gt; Settings -&gt; 左侧变栏目(Billing and Plans) -&gt; Plans and usage -&gt; Usage this month" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/ac18f6f2bb3b73268f33a49105916f57/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-04-05T14:54:31+08:00" />
<meta property="article:modified_time" content="2023-04-05T14:54:31+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">GitHub Action 使用</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="GitHub_Action__0"></a>GitHub Action 使用</h2> 
<blockquote> 
 <p>GitHub Actions 是一种持续集成和持续交付 (CI/CD) 平台，可用于自动执行生成、测试和部署管道。 您可以创建工作流程来构建和测试存储库的每个拉取请求，或将合并的拉取请求部署到生产环境。GitHub 提供 Linux、Windows 和 macOS 虚拟机来运行工作流程，或者您可以在自己的数据中心或云基础架构中托管自己的自托管运行器。</p> 
</blockquote> 
<h3><a id="_3"></a>计费规则</h3> 
<p>公共存储库中标准 GitHub 托管的运行器和自托管运行器可免费使用 GitHub Actions。 对于专用存储库，每个 GitHub 帐户可获得一定数量的免费时间和存储以用于 GitHub 托管的运行器，具体取决于帐户所使用的产品。 超出包含数量的任何使用量都由支出限制控制。分钟数每月重置一次，而存储空间使用量不会重置。ci机器使用超过 2 核的 Windows 和 Ubuntu 运行器，将始终收取费用，包括在公共存储库中。其中GitHub Free 给的存储是 500M,2000分钟/月。在 GitHub 主机的 Windows 和 macOS 运行器上运行的作业，其消耗分钟数是在 Linux 运行器上运行的作业的 2 倍和 10 倍。 例如，1000 分钟的 Windows 使用时间将占用帐户中包含的 2000 分钟。 1000 分钟的 macOS 使用时间将占用帐户中包含的 10000 分钟。仓库使用的存储空间是 GitHub Actions 构件和 GitHub Packages 使用的存储空间总计。</p> 
<h3><a id="_GitHub_Actions__6"></a>查看 GitHub Actions 使用情况</h3> 
<p>操作路径：在GitHub右上角点击头像 -&gt; Settings -&gt; 左侧变栏目(Billing and Plans) -&gt; Plans and usage -&gt; Usage this month<br> 可以分别看到 Action部分与Packages 的使用情况<br> <img src="https://images2.imgbox.com/e2/b5/pEfOxQye_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/bf/cb/XdkBlpXi_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_12"></a>快速入门</h3> 
<ol><li>在仓库的根目录下新建 .github/workflows/ 目录</li><li>在.github/workflows/目录下创建一个文件 learn-github-actions.yml(名字不一定是这个，只要是.yml结尾就行) 代码如下</li></ol> 
<pre><code class="prism language-yml"><span class="token key atrule">name</span><span class="token punctuation">:</span> learn<span class="token punctuation">-</span>github<span class="token punctuation">-</span>actions
<span class="token key atrule">run-name</span><span class="token punctuation">:</span> $<span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span> github.actor <span class="token punctuation">}</span><span class="token punctuation">}</span> is learning GitHub Actions
<span class="token key atrule">on</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>push<span class="token punctuation">]</span>
<span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token key atrule">check-bats-version</span><span class="token punctuation">:</span>
    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest
    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v3
      <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/setup<span class="token punctuation">-</span>node@v3
        <span class="token key atrule">with</span><span class="token punctuation">:</span>
          <span class="token key atrule">node-version</span><span class="token punctuation">:</span> <span class="token string">'14'</span>
      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> npm install <span class="token punctuation">-</span>g bats
      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> bats <span class="token punctuation">-</span>v
</code></pre> 
<ol start="3"><li>提交代码push到远程仓库</li><li>现在你的工作流已经安装成功，在每次代码push的时候就能够触发，现在应该就能看到这个工作流的第一次运行。</li><li>查看地址如下<br> <img src="https://images2.imgbox.com/e3/0a/bd7vHnIu_o.png" alt="在这里插入图片描述"></li></ol> 
<h4><a id="_34"></a>备注</h4> 
<p>一个仓库可以定义多个工作流程，多个工作流的表现形式为 github/workflows/ 下存在多个不同的yml文件</p> 
<h3><a id="yml_36"></a>关键使用流程(yml如何编写)</h3> 
<blockquote> 
 <p>name 以及 run-name 只是一个标识和展示的用途，不是特别关键</p> 
</blockquote> 
<h4><a id="_38"></a>如何触发工作流</h4> 
<ul><li>仓库的代码或者流程发生变更，例如代码push，pull request，issue等，这里可以针对分支，tag等一系列进行筛选控制，<a href="https://docs.github.com/zh/actions/using-workflows/triggering-a-workflow" rel="nofollow">可参考</a></li><li>在 GitHub 之外发生并在 GitHub 上触发 repository_dispatch 事件的事件，<a href="https://docs.github.com/zh/actions/using-workflows/events-that-trigger-workflows" rel="nofollow">具体的事件</a></li><li>定时执行，支持cronjob配置，可以支持配置多个。</li><li>手动执行，如果你配置了workflow_dispatch结点则可以在界面上进行手动触发。<br> <img src="https://images2.imgbox.com/83/0f/atzbzeMC_o.png" alt="在这里插入图片描述"></li></ul> 
<pre><code class="prism language-yml"><span class="token key atrule">on</span><span class="token punctuation">:</span>
  <span class="token comment"># 只有push到master分支上才能触发这个action</span>
  <span class="token key atrule">push</span><span class="token punctuation">:</span>
    <span class="token key atrule">branches</span><span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token string">"master"</span> <span class="token punctuation">]</span>
  <span class="token comment"># 定义了这个结点表示可以手动触发，手动触发时还支持定义一些自定义参数</span>
  <span class="token key atrule">workflow_dispatch</span><span class="token punctuation">:</span>
  <span class="token comment"># 定时执行，注意这里的定时时间都是世界标准时间UTC,和中国有时差</span>
  <span class="token key atrule">schedule</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">cron</span><span class="token punctuation">:</span>  0 2 * * *
</code></pre> 
<h4><a id="job_56"></a>如何编写一个job</h4> 
<blockquote> 
 <p>工作流运行由一个或多个 jobs 组成，默认情况下并行运行。 若要按顺序运行作业，可以使用 jobs.&lt;job_id&gt;.needs 关键字定义对其他作业的依赖关系。每个作业在 runs-on 指定的运行器环境中运行。</p> 
</blockquote> 
<h5><a id="ID_59"></a>设置作业的ID</h5> 
<blockquote> 
 <p>使用 jobs.&lt;job_id&gt; 为作业提供唯一标识符。 键 job_id 是一个字符串，其值是作业配置数据的映射。 必须将 &lt;job_id&gt; 替换为对于 jobs 对象的唯一字符串。 &lt;job_id&gt; 必须以字母或 _ 开头，并且只能包含字母数字字符、- 或 _。</p> 
</blockquote> 
<pre><code class="prism language-yml"><span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token key atrule">my_first_job</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> My first job
  <span class="token key atrule">my_second_job</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> My second job
</code></pre> 
<h5><a id="_68"></a>作业名称</h5> 
<p>jobs.&lt;job_id&gt;.name 设置作业名称，该名称显示在 GitHub UI 中。</p> 
<h5><a id="_71"></a>作业有依赖关系</h5> 
<blockquote> 
 <p>在此示例中，job1 必须在 job2 开始之前成功完成，并且 job3 等待 job1 和 job2 完成。</p> 
</blockquote> 
<pre><code class="prism language-yml"><span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token key atrule">job1</span><span class="token punctuation">:</span>
  <span class="token key atrule">job2</span><span class="token punctuation">:</span>
    <span class="token key atrule">needs</span><span class="token punctuation">:</span> job1
  <span class="token key atrule">job3</span><span class="token punctuation">:</span>
    <span class="token key atrule">needs</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>job1<span class="token punctuation">,</span> job2<span class="token punctuation">]</span>
</code></pre> 
<h5><a id="_82"></a>选择作业的运行器</h5> 
<p>目前只支持 Windows、Ubuntu、macOS 三种运行器。注意 Windows和macOS如果使用时超过2核心则需要收费。<a href="https://docs.github.com/zh/actions/using-jobs/choosing-the-runner-for-a-job" rel="nofollow">支持的yml标签</a><br> Ubuntu 运行器已添加到名为 ubuntu-runners 的组中。 runs-on 键将作业发送到 ubuntu-runners 组中的任何可用运行器：</p> 
<pre><code class="prism language-yml"><span class="token key atrule">name</span><span class="token punctuation">:</span> learn<span class="token punctuation">-</span>github<span class="token punctuation">-</span>actions
<span class="token key atrule">on</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>push<span class="token punctuation">]</span>
<span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token key atrule">check-bats-version</span><span class="token punctuation">:</span>
    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> 
      <span class="token key atrule">group</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>runners
    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v3
      <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/setup<span class="token punctuation">-</span>node@v3
        <span class="token key atrule">with</span><span class="token punctuation">:</span>
          <span class="token key atrule">node-version</span><span class="token punctuation">:</span> <span class="token string">'14'</span>
      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> npm install <span class="token punctuation">-</span>g bats
      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> bats <span class="token punctuation">-</span>v
</code></pre> 
<h5><a id="_100"></a>定义作业的输出</h5> 
<pre><code class="prism language-yml"><span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token key atrule">job1</span><span class="token punctuation">:</span>
    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest
    <span class="token comment"># Map a step output to a job output</span>
    <span class="token key atrule">outputs</span><span class="token punctuation">:</span>
      <span class="token key atrule">output1</span><span class="token punctuation">:</span> $<span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span> steps.step1.outputs.test <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token key atrule">output2</span><span class="token punctuation">:</span> $<span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span> steps.step2.outputs.test <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> step1
        <span class="token key atrule">run</span><span class="token punctuation">:</span> echo "test=hello" <span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span> "$GITHUB_OUTPUT" <span class="token comment"># 要输出的内容统一指向这个环境变量</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> step2
        <span class="token key atrule">run</span><span class="token punctuation">:</span> echo "test=world" <span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span> "$GITHUB_OUTPUT"
  <span class="token key atrule">job2</span><span class="token punctuation">:</span>
    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest
    <span class="token key atrule">needs</span><span class="token punctuation">:</span> job1
    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">env</span><span class="token punctuation">:</span>
          <span class="token key atrule">OUTPUT1</span><span class="token punctuation">:</span> $<span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span>needs.job1.outputs.output1<span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token comment"># 前面输出的内容可以在其它步骤引用，但是注意时序问题</span>
          <span class="token key atrule">OUTPUT2</span><span class="token punctuation">:</span> $<span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span>needs.job1.outputs.output2<span class="token punctuation">}</span><span class="token punctuation">}</span>
        <span class="token key atrule">run</span><span class="token punctuation">:</span> echo "$OUTPUT1 $OUTPUT2"
</code></pre> 
<h5><a id="jobstepsuses__123"></a>job中steps下uses 标签的使用</h5> 
<p>uses 标签标识当前你需要用什么工具去做操作。例如，你要下载代码 需要用这个 actions/checkout@v3 ，如果你接下来是编译go代码，那你得有go sdk actions/setup-go@v3。这其中是一系列封装好的步骤脚本。你也可以字节开发这样一个工具并且发布到 github社区供他人使用。<a href="https://docs.github.com/zh/actions/automating-builds-and-tests/about-continuous-integration" rel="nofollow">更多例子</a><br> 例如 go版本</p> 
<pre><code class="prism language-yml"><span class="token key atrule">name</span><span class="token punctuation">:</span> Go package

<span class="token key atrule">on</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>push<span class="token punctuation">]</span>

<span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token key atrule">build</span><span class="token punctuation">:</span>

    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest
    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v3

      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Set up Go
        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/setup<span class="token punctuation">-</span>go@v3
        <span class="token key atrule">with</span><span class="token punctuation">:</span>
          <span class="token key atrule">go-version</span><span class="token punctuation">:</span> <span class="token number">1.15</span>

      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Build
        <span class="token key atrule">run</span><span class="token punctuation">:</span> go build <span class="token punctuation">-</span>v ./<span class="token punctuation">...</span>

      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Test
        <span class="token key atrule">run</span><span class="token punctuation">:</span> go test <span class="token punctuation">-</span>v ./<span class="token punctuation">...</span>
</code></pre> 
<p>例如 maven-java版本</p> 
<pre><code class="prism language-yml"><span class="token key atrule">name</span><span class="token punctuation">:</span> Java CI

<span class="token key atrule">on</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>push<span class="token punctuation">]</span>

<span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token key atrule">build</span><span class="token punctuation">:</span>
    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest

    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v3
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Set up JDK 17
        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/setup<span class="token punctuation">-</span>java@v3
        <span class="token key atrule">with</span><span class="token punctuation">:</span>
          <span class="token key atrule">java-version</span><span class="token punctuation">:</span> <span class="token string">'17'</span>
          <span class="token key atrule">distribution</span><span class="token punctuation">:</span> <span class="token string">'temurin'</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Build with Maven
        <span class="token key atrule">run</span><span class="token punctuation">:</span> mvn <span class="token punctuation">-</span><span class="token punctuation">-</span>batch<span class="token punctuation">-</span>mode <span class="token punctuation">-</span><span class="token punctuation">-</span>update<span class="token punctuation">-</span>snapshots package
</code></pre> 
<h3><a id="yml_170"></a>在yml使用环境变量</h3> 
<p>有时候在编写action yml时 需要用到 账号，密码，cookie 等比较隐私的内容，不方便直接写在文件中。action有提供环境变量一样的引用方式。<br> 操作路径<br> <img src="https://images2.imgbox.com/88/54/8CbzfKKz_o.png" alt="在这里插入图片描述"><br> 注意这里有 Secrets和Variables 两种变量。Secrets 变量设置完成后无法查看，在action流程执行中也无法将值打印出来，适合账号密码等比较隐私的场景。Variables 则是普通的环境变量，设置后可以直接看到值。</p> 
<pre><code class="prism language-yml"><span class="token key atrule">name</span><span class="token punctuation">:</span> Study<span class="token punctuation">-</span>CI

<span class="token key atrule">on</span><span class="token punctuation">:</span>
  <span class="token comment"># 只有push到master分支上才能触发这个action</span>
  <span class="token key atrule">push</span><span class="token punctuation">:</span>
    <span class="token key atrule">branches</span><span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token string">"master"</span> <span class="token punctuation">]</span>
  <span class="token key atrule">workflow_dispatch</span><span class="token punctuation">:</span>

<span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token key atrule">build</span><span class="token punctuation">:</span>
    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest

    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v3
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Install Go and Run Code Linting
        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/setup<span class="token punctuation">-</span>go@v4.0.0
        <span class="token key atrule">with</span><span class="token punctuation">:</span>
          <span class="token key atrule">go-version</span><span class="token punctuation">:</span> <span class="token number">1.18</span> 
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Use variables <span class="token comment"># 使用vars关键词引用 Variables 中定义的变量</span>
      <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
        echo "repository variable : ${<!-- -->{ vars.REPOSITORY_VAR }}"
        echo "organization variable : ${<!-- -->{ vars.ORGANIZATION_VAR }}"
        echo "overridden variable : ${<!-- -->{ vars.OVERRIDE_VAR }}"
        echo "variable from shell environment : $env_var"</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Go Build
        <span class="token key atrule">run</span><span class="token punctuation">:</span> go build <span class="token punctuation">-</span>o main
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Go Run
        <span class="token key atrule">run</span><span class="token punctuation">:</span> ./main
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Ssh Romote Commands
        <span class="token key atrule">uses</span><span class="token punctuation">:</span> appleboy/ssh<span class="token punctuation">-</span>action@v0.1.2
        <span class="token key atrule">with</span><span class="token punctuation">:</span>
          <span class="token key atrule">host</span><span class="token punctuation">:</span> $<span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span> secrets.HOST <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token comment"># 直接使用secrets中的环境变量</span>
          <span class="token key atrule">username</span><span class="token punctuation">:</span> $<span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span> secrets.USERNAME <span class="token punctuation">}</span><span class="token punctuation">}</span>
          <span class="token key atrule">password</span><span class="token punctuation">:</span> $<span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span> secrets.PASSWORD <span class="token punctuation">}</span><span class="token punctuation">}</span>
          <span class="token key atrule">port</span><span class="token punctuation">:</span> $<span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span> secrets.PORT <span class="token punctuation">}</span><span class="token punctuation">}</span>
          <span class="token key atrule">script</span><span class="token punctuation">:</span> cat readme.md
</code></pre> 
<h3><a id="CD__214"></a>CD 怎么使用</h3> 
<p>前面介绍的都是ci环节，cd及部署。GitHub action 本质上只提供一个ci的机器。部署需要你有自己的一台服务器。关于CD 社区中也有各云厂商自己开发的action 插件可用。<a href="https://github.com/marketplace?category=deployment&amp;type=actions&amp;query=tencent%20">搜索地址</a> 可按照自己实际的情况各取所需。<br> 如果不想用云厂商开发好的功能，也可以使用通用的 ssh action 自定义cd流程。<br> 例如，这里就演示了 使用 appleboy/ssh-action 登录到远程主机上，并且在用户家目录下 查看了 readme.md 文件的内容。</p> 
<pre><code class="prism language-yml"><span class="token comment"># This is a basic workflow to help you get started with Actions</span>

<span class="token comment"># 取个ci流程的名字</span>
<span class="token key atrule">name</span><span class="token punctuation">:</span> Study<span class="token punctuation">-</span>CI

<span class="token key atrule">on</span><span class="token punctuation">:</span>
  <span class="token comment"># 只有push到master分支上才能触发这个action</span>
  <span class="token key atrule">push</span><span class="token punctuation">:</span>
    <span class="token key atrule">branches</span><span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token string">"master"</span> <span class="token punctuation">]</span>

  <span class="token key atrule">workflow_dispatch</span><span class="token punctuation">:</span>

<span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token key atrule">build</span><span class="token punctuation">:</span>
    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest
    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v3
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Install Go and Run Code Linting
        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/setup<span class="token punctuation">-</span>go@v4.0.0
        <span class="token key atrule">with</span><span class="token punctuation">:</span>
          <span class="token key atrule">go-version</span><span class="token punctuation">:</span> <span class="token number">1.18</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Go Build
        <span class="token key atrule">run</span><span class="token punctuation">:</span> go build <span class="token punctuation">-</span>o main
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Go Run
        <span class="token key atrule">run</span><span class="token punctuation">:</span> ./main
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Ssh Romote Commands <span class="token comment"># 使用ssh-action 登录远程主机执行脚本</span>
        <span class="token key atrule">uses</span><span class="token punctuation">:</span> appleboy/ssh<span class="token punctuation">-</span>action@v0.1.2
        <span class="token key atrule">with</span><span class="token punctuation">:</span>
          <span class="token key atrule">host</span><span class="token punctuation">:</span> $<span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span> secrets.HOST <span class="token punctuation">}</span><span class="token punctuation">}</span>
          <span class="token key atrule">username</span><span class="token punctuation">:</span> $<span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span> secrets.USERNAME <span class="token punctuation">}</span><span class="token punctuation">}</span>
          <span class="token key atrule">password</span><span class="token punctuation">:</span> $<span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span> secrets.PASSWORD <span class="token punctuation">}</span><span class="token punctuation">}</span>
          <span class="token key atrule">port</span><span class="token punctuation">:</span> $<span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span> secrets.PORT <span class="token punctuation">}</span><span class="token punctuation">}</span>
          <span class="token key atrule">script</span><span class="token punctuation">:</span> cat readme.md

</code></pre> 
<h2><a id="_254"></a>附加</h2> 
<h3><a id="______255"></a>如果要执行多条命令 则在命令后面加一个 | 或者是使用 &amp; 连接多个命令</h3> 
<pre><code class="prism language-yml"><span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token key atrule">build</span><span class="token punctuation">:</span>
    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest

    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v3  <span class="token comment"># 前面用一个横线标识 steps 有多个值是一个数组</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Use variables <span class="token comment"># 执行多行命令</span>
      <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
        echo "repository variable : ${<!-- -->{ vars.REPOSITORY_VAR }}"
        echo "organization variable : ${<!-- -->{ vars.ORGANIZATION_VAR }}"
        echo "overridden variable : ${<!-- -->{ vars.OVERRIDE_VAR }}"
        echo "variable from shell environment : $env_var"</span>

</code></pre> 
<h3><a id="shell_271"></a>如何执行shell命令</h3> 
<pre><code class="prism language-yml"><span class="token key atrule">steps</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Display the path
    <span class="token key atrule">run</span><span class="token punctuation">:</span> echo $PATH
    <span class="token key atrule">shell</span><span class="token punctuation">:</span> bash
</code></pre> 
<h3><a id="_278"></a>文件的上传下载及读取</h3> 
<p>第一个job计算3+7的结果写到文件math-homework.txt，第二job将第一个job的结果下载下来继续进行乘法计算 *9 并且将结果又写回原来的文件。第三步 下载下来这个文件，进行最终结果的打印。</p> 
<pre><code class="prism language-yml"><span class="token key atrule">name</span><span class="token punctuation">:</span> Share data between jobs

<span class="token key atrule">on</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>push<span class="token punctuation">]</span>

<span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token key atrule">job_1</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> Add 3 and 7
    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest
    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">shell</span><span class="token punctuation">:</span> bash
        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
          expr 3 + 7 &gt; math-homework.txt</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Upload math result for job 1
        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/upload<span class="token punctuation">-</span>artifact@v3
        <span class="token key atrule">with</span><span class="token punctuation">:</span>
          <span class="token key atrule">name</span><span class="token punctuation">:</span> homework
          <span class="token key atrule">path</span><span class="token punctuation">:</span> math<span class="token punctuation">-</span>homework.txt

  <span class="token key atrule">job_2</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> Multiply by 9
    <span class="token key atrule">needs</span><span class="token punctuation">:</span> job_1
    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> windows<span class="token punctuation">-</span>latest
    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Download math result for job 1
        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/download<span class="token punctuation">-</span>artifact@v3
        <span class="token key atrule">with</span><span class="token punctuation">:</span>
          <span class="token key atrule">name</span><span class="token punctuation">:</span> homework
      <span class="token punctuation">-</span> <span class="token key atrule">shell</span><span class="token punctuation">:</span> bash
        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
          value=`cat math-homework.txt`
          expr $value \* 9 &gt; math-homework.txt</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Upload math result for job 2
        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/upload<span class="token punctuation">-</span>artifact@v3
        <span class="token key atrule">with</span><span class="token punctuation">:</span>
          <span class="token key atrule">name</span><span class="token punctuation">:</span> homework
          <span class="token key atrule">path</span><span class="token punctuation">:</span> math<span class="token punctuation">-</span>homework.txt

  <span class="token key atrule">job_3</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> Display results
    <span class="token key atrule">needs</span><span class="token punctuation">:</span> job_2
    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> macOS<span class="token punctuation">-</span>latest
    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Download math result for job 2
        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/download<span class="token punctuation">-</span>artifact@v3
        <span class="token key atrule">with</span><span class="token punctuation">:</span>
          <span class="token key atrule">name</span><span class="token punctuation">:</span> homework
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Print the final result
        <span class="token key atrule">shell</span><span class="token punctuation">:</span> bash
        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
          value=`cat math-homework.txt`
          echo The result is $value</span>
</code></pre> 
<h2><a id="_333"></a>总结</h2> 
<p>本篇文章只是介绍了GitHub action 的一些最基础，最常用的内容。还有一些高级特性，比如条件控制，并发控制，权限管理，云厂商部署，容器化服务，标签管理，自定义运行器(自己提供ci机器)等。更多特性请参考<a href="https://docs.github.com/zh/actions/quickstart" rel="nofollow">官方文档</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f1fc0d0c6e596818fc3d6fa5196f8c00/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">ctfshow愚人杯web复现</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f7648313bda174c5e7a0f925afbd0403/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Win10&#43;TensorRT 8.5安装&#43;VS2022配置</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>