<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Tomcat 基础配置 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Tomcat 基础配置" />
<meta property="og:description" content="一、基础组件 1.1 组件介绍 顶级组件：位于整个配置的顶层；
Server：表示一个Tomcat实例 (单例的)；Server代表整个catalina servlet容器；包含一个或多个service子容器。主要是用来管理容器下各个Serivce组件的生命周期。
Service：代表Tomcat中一组提供服务、处理请求的组件。是一个分组结构，包括多个Connector和一个Container。
容器类：可以包含其它组件的组件；
Container是容器的父接口，用于封装和管理Servlet，以及具体处理Request请求，该容器的设计用的是典型的责任链的设计模式，它由四个自容器组件构成，分别是Engine、Host、Context、Wrapper。这四个组件是负责关系，存在包含关系。只包含一个引擎。
Engine 引擎：表示可运行的Catalina的servlet引擎实例，并且包含了servlet容器的核心功能。在一个服务中只能有一个引擎。同时，作为一个真正的容器，Engine元素之下可以包含一个或多个虚拟主机。它主要功能是将传入请求委托给适当的虚拟主机处理。如果根据名称没有找到可处理的虚拟主机，那么将根据默认的Host来判断该由哪个虚拟主机处理。
Host 虚拟主机：作用就是运行多个应用，它负责安装和展开这些应用，并且标识这个应用以便能够区分它们。它的子容器通常是 Context。一个虚拟主机下都可以部署一个或者多个Web App，每个Web App对应于一个Context，当Host获得一个请求时，将把该请求匹配到某个Context上，然后把该请求交给该Context来处理。主机组件类似于Apache中的虚拟主机，但在Tomcat中只支持基于FQDN(完全合格的主机名)的“虚拟主机”。Host主要用来解析web.xml。
Context上下文：代表 Servlet 的 Context，它具备了 Servlet 运行的基本环境，它表示Web应用程序本身。Context 最重要的功能就是管理它里面的 Servlet 实例，一个Context对应于一个Web Application，一个Web Application由一个或者多个Servlet实例组成。
Wrapper包装器: 代表一个 Servlet，它负责管理一个 Servlet，包括的 Servlet 的装载、初始化、执行以及资源回收。Wrapper 是最底层的容器，它没有子容器了，所以调用它的 addChild 将会报错。
连接器组件：连接用户请求至 tomcat；
Connector是客户端连接到Tomcat容器的服务点，它为引擎提供协议服务来将引擎与客户端各种协议隔离开来，如HTTP、HTTPS、AJP协议。Connector的基本属性都是它所需要监听的IP地址及端口号，以及所支持的协议。还有一个关键属性就是并发处理传入请求的最大线程数。注意，Connector关键的有 连接器（HTTP HTTPS HTTP1.1 AJP SSL proxy） 运行模式（BIO NIO NIO2/AIO APR）多线程/线程池。
被嵌套类的组件：位于一个容器当中，不能包含其它组件；
Valve阀门：类似于Servlet规范中定义的过滤器，用来拦截请求并在将其转至目标之前进行某种处理操作。Valve可以定义在任何容器类的组件中。Valve常被用来记录客户端请求、客户端IP地址和服务器等信息，这种处理技术通常被称作请求转储(request dumping)。请求转储valve记录请求客户端请求数据包中的HTTP首部信息和cookie信息文件中，响应转储valve则记录响应数据包首部信息和cookie信息至文件中。
Logger日志记录器：用于记录组件内部的状态信息，可被用于除Context之外的任何容器中。日志记录的功能可被继承，因此，一个引擎级别的Logger将会记录引擎内部所有组件相关的信息，除非某内部组件定义了自己的Logger组件。
Loader类加载器：负责加载、解释Java类编译后的字节码。
Realm领域：用于用户的认证和授权；在配置一个应用程序时，管理员可以为每个资源或资源组定义角色及权限，而这些访问控制功能的生效需要通过Realm来实现。Realm的认证可以基于文本文件、数据库表、LDAP服务等来实现。Realm的效用会遍及整个引擎或顶级容器，因此，一个容器内的所有应用程序将共享用户资源。同时，Realm可以被其所在组件的子组件继承，也可以被子组件中定义的Realm所覆盖。
Excutor执行器：执行器组件允许您配置一个共享的线程池，以供您的连接器使用。从tomcat 6.0.11版本开始。
Listener监听器：监听已注册组件的生命周期。
Manager会话管理器：用于实现http会话管理的功能，tomcat6种有5种会话管理的manager的实现（standardManager、persisentManager、DeltaManager、BackupManager、SimpleTcpReplicationManager）。会话让使用无状态HTTP协议的应用程序完成通信。会话表示客户端和服务器之间的通信，会话功能是由javax.servlet.http.HttpSession 的实例实现的，该实例存储在服务器上而且与一个唯一的标识符相关联，客户端在与服务器的每次交互中根据请求中的标识符找到它的会话。一个新的会话在客户端请求后被创建，会话一直有效直到一段时间后客户端连接超时，或者会话直接失效例如客户退出访问服务器。
Cluster集群：专用于配置Tomcat集群的元素，可用于Engine和Host容器中。
1.2 tomcat 配置文件及组件 vim /apps/tomcat/conf/server.xml &lt;server&gt; #顶级服务器组件,一个 server 表示 tomcat 运行实例。 &lt;service&gt; #这是一种抽象的服务,它把连接器 connector 和处理引擎 engine 结合在一起提供运行和访问。 &lt;connector&gt; #连接器组件,定义如何接收和响应外部请求,8080/8443/8009 &lt;engine&gt; #引擎是核心组件,也是最高级别的容器组件,所有的请求都是通 过处理引擎处理的,引擎提供 jsp 编译、通过 connetctor 接收用户请求,分析用户请 求首部的具体虚拟主机,并将请求转发至虚拟主机。 &lt;Realm&gt; #用于配置安全管理角色，通常读取 tomcat-uesrs." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/d4f5fa747fe427e6467ec280ad25fe0a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-08-04T21:42:56+08:00" />
<meta property="article:modified_time" content="2021-08-04T21:42:56+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Tomcat 基础配置</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-dracula">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>一、基础组件</h2> 
<h3><a id="11__1"></a>1.1 组件介绍</h3> 
<p><strong>顶级组件：位于整个配置的顶层；</strong><br> <strong>Server</strong>：表示一个Tomcat实例 (单例的)；Server代表整个catalina servlet容器；包含一个或多个service子容器。主要是用来管理容器下各个Serivce组件的生命周期。<br> <strong>Service</strong>：代表Tomcat中一组提供服务、处理请求的组件。是一个分组结构，包括多个Connector和一个Container。</p> 
<p><strong>容器类：可以包含其它组件的组件；</strong><br> Container是容器的父接口，用于封装和管理Servlet，以及具体处理Request请求，该容器的设计用的是典型的责任链的设计模式，它由四个自容器组件构成，分别是Engine、Host、Context、Wrapper。这四个组件是负责关系，存在包含关系。只包含一个引擎。<br> <strong>Engine 引擎</strong>：表示可运行的Catalina的servlet引擎实例，并且包含了servlet容器的核心功能。在一个服务中只能有一个引擎。同时，作为一个真正的容器，Engine元素之下可以包含一个或多个虚拟主机。它主要功能是将传入请求委托给适当的虚拟主机处理。如果根据名称没有找到可处理的虚拟主机，那么将根据默认的Host来判断该由哪个虚拟主机处理。<br> <strong>Host 虚拟主机</strong>：作用就是运行多个应用，它负责安装和展开这些应用，并且标识这个应用以便能够区分它们。它的子容器通常是 Context。一个虚拟主机下都可以部署一个或者多个Web App，每个Web App对应于一个Context，当Host获得一个请求时，将把该请求匹配到某个Context上，然后把该请求交给该Context来处理。主机组件类似于Apache中的虚拟主机，但在Tomcat中只支持基于FQDN(完全合格的主机名)的“虚拟主机”。Host主要用来解析web.xml。<br> <strong>Context上下文</strong>：代表 Servlet 的 Context，它具备了 Servlet 运行的基本环境，它表示Web应用程序本身。Context 最重要的功能就是管理它里面的 Servlet 实例，一个Context对应于一个Web Application，一个Web Application由一个或者多个Servlet实例组成。<br> <strong>Wrapper包装器</strong>: 代表一个 Servlet，它负责管理一个 Servlet，包括的 Servlet 的装载、初始化、执行以及资源回收。Wrapper 是最底层的容器，它没有子容器了，所以调用它的 addChild 将会报错。</p> 
<p><strong>连接器组件：连接用户请求至 tomcat；</strong><br> <strong>Connector</strong>是客户端连接到Tomcat容器的服务点，它为引擎提供协议服务来将引擎与客户端各种协议隔离开来，如HTTP、HTTPS、AJP协议。Connector的基本属性都是它所需要监听的IP地址及端口号，以及所支持的协议。还有一个关键属性就是并发处理传入请求的最大线程数。注意，Connector关键的有 连接器（HTTP HTTPS HTTP1.1 AJP SSL proxy） 运行模式（BIO NIO NIO2/AIO APR）多线程/线程池。</p> 
<p><strong>被嵌套类的组件：位于一个容器当中，不能包含其它组件；</strong><br> <strong>Valve阀门</strong>：类似于Servlet规范中定义的过滤器，用来拦截请求并在将其转至目标之前进行某种处理操作。Valve可以定义在任何容器类的组件中。Valve常被用来记录客户端请求、客户端IP地址和服务器等信息，这种处理技术通常被称作请求转储(request dumping)。请求转储valve记录请求客户端请求数据包中的HTTP首部信息和cookie信息文件中，响应转储valve则记录响应数据包首部信息和cookie信息至文件中。<br> <strong>Logger日志记录器</strong>：用于记录组件内部的状态信息，可被用于除Context之外的任何容器中。日志记录的功能可被继承，因此，一个引擎级别的Logger将会记录引擎内部所有组件相关的信息，除非某内部组件定义了自己的Logger组件。<br> <strong>Loader类加载器</strong>：负责加载、解释Java类编译后的字节码。<br> <strong>Realm领域</strong>：用于用户的认证和授权；在配置一个应用程序时，管理员可以为每个资源或资源组定义角色及权限，而这些访问控制功能的生效需要通过Realm来实现。Realm的认证可以基于文本文件、数据库表、LDAP服务等来实现。Realm的效用会遍及整个引擎或顶级容器，因此，一个容器内的所有应用程序将共享用户资源。同时，Realm可以被其所在组件的子组件继承，也可以被子组件中定义的Realm所覆盖。<br> <strong>Excutor执行器</strong>：执行器组件允许您配置一个共享的线程池，以供您的连接器使用。从tomcat 6.0.11版本开始。<br> <strong>Listener监听器</strong>：监听已注册组件的生命周期。<br> <strong>Manager会话管理器</strong>：用于实现http会话管理的功能，tomcat6种有5种会话管理的manager的实现（standardManager、persisentManager、DeltaManager、BackupManager、SimpleTcpReplicationManager）。会话让使用无状态HTTP协议的应用程序完成通信。会话表示客户端和服务器之间的通信，会话功能是由javax.servlet.http.HttpSession 的实例实现的，该实例存储在服务器上而且与一个唯一的标识符相关联，客户端在与服务器的每次交互中根据请求中的标识符找到它的会话。一个新的会话在客户端请求后被创建，会话一直有效直到一段时间后客户端连接超时，或者会话直接失效例如客户退出访问服务器。<br> <strong>Cluster集群</strong>：专用于配置Tomcat集群的元素，可用于Engine和Host容器中。<br> <img src="https://images2.imgbox.com/ba/3b/p5pIG1ZJ_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="12_tomcat__26"></a>1.2 tomcat 配置文件及组件</h3> 
<pre><code class="prism language-xml">vim /apps/tomcat/conf/server.xml
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>server</span><span class="token punctuation">&gt;</span></span> #顶级服务器组件,一个 server 表示 tomcat 运行实例。 
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>service</span><span class="token punctuation">&gt;</span></span> #这是一种抽象的服务,它把连接器 connector 和处理引擎 engine 结合在一起提供运行和访问。 
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>connector</span><span class="token punctuation">&gt;</span></span> #连接器组件,定义如何接收和响应外部请求,8080/8443/8009 
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>engine</span><span class="token punctuation">&gt;</span></span> #引擎是核心组件,也是最高级别的容器组件,所有的请求都是通 过处理引擎处理的,引擎提供 jsp 编译、通过 connetctor 接收用户请求,分析用户请 求首部的具体虚拟主机,并将请求转发至虚拟主机。 
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Realm</span><span class="token punctuation">&gt;</span></span> #用于配置安全管理角色，通常读取 tomcat-uesrs.xml 进行验证。 
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Realm</span><span class="token punctuation">&gt;</span></span> 
					<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>host</span><span class="token punctuation">&gt;</span></span> #虚拟主机，用于进行请求的映射处理 
						<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>context</span><span class="token punctuation">&gt;</span></span> #定义上下文配置，用于 web 应用配置，通常配置 session 共享配置 
						<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>context</span><span class="token punctuation">&gt;</span></span> 
						<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Valve</span> <span class="token attr-name">pattern</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>%h %l %u %t <span class="token entity named-entity" title='"'>&amp;quot;</span>%r<span class="token entity named-entity" title='"'>&amp;quot;</span> %s %b<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span> #单词 Valve 的意思是”阀门”,在 Tomcat 中代表了请求处理流水线上的一个组件,Valve 可 以与 Tomcat 的容器(Engine、Host 或 Context)关联。 
					<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>host</span><span class="token punctuation">&gt;</span></span> 
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>engine</span><span class="token punctuation">&gt;</span></span> 
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>connector</span><span class="token punctuation">&gt;</span></span> 
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>service</span><span class="token punctuation">&gt;</span></span> 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>server</span><span class="token punctuation">&gt;</span></span>


#Context 非必须配置项，因此默认没有添加，具体生产实例如下： 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Context</span> <span class="token attr-name">docBase</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/apps/tomcat/webapps/SalesManager<span class="token punctuation">"</span></span> <span class="token attr-name">sessionCookieDomain</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>.ceboss.cn<span class="token punctuation">"</span></span> <span class="token attr-name">sessionCookiePath</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/<span class="token punctuation">"</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">reloadable</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre> 
<pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Server</span> <span class="token attr-name">port</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>8005<span class="token punctuation">"</span></span> <span class="token attr-name">shutdown</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>SHUTDOWN<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Listener</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.apache.catalina.startup.VersionLoggerListener<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Listener</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.apache.catalina.core.AprLifecycleListener<span class="token punctuation">"</span></span> <span class="token attr-name">SSLEngine</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>on<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Listener</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.apache.catalina.core.JreMemoryLeakPreventionListener<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Listener</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.apache.catalina.mbeans.GlobalResourcesLifecycleListener<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Listener</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.apache.catalina.core.ThreadLocalLeakPreventionListener<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>GlobalNamingResources</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Resource</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UserDatabase<span class="token punctuation">"</span></span> <span class="token attr-name">auth</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Container<span class="token punctuation">"</span></span>
              <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.apache.catalina.UserDatabase<span class="token punctuation">"</span></span>
              <span class="token attr-name">description</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>User database that can be updated and saved<span class="token punctuation">"</span></span>
              <span class="token attr-name">factory</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.apache.catalina.users.MemoryUserDatabaseFactory<span class="token punctuation">"</span></span>
              <span class="token attr-name">pathname</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>conf/tomcat-users.xml<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>GlobalNamingResources</span><span class="token punctuation">&gt;</span></span>


  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Service</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Catalina<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Connector</span> <span class="token attr-name">port</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>8080<span class="token punctuation">"</span></span> <span class="token attr-name">protocol</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>HTTP/1.1<span class="token punctuation">"</span></span>
               <span class="token attr-name">connectionTimeout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>20000<span class="token punctuation">"</span></span>
               <span class="token attr-name">redirectPort</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>8443<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Engine</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Catalina<span class="token punctuation">"</span></span> <span class="token attr-name">defaultHost</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>localhost<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Realm</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.apache.catalina.realm.LockOutRealm<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Realm</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.apache.catalina.realm.UserDatabaseRealm<span class="token punctuation">"</span></span>
               <span class="token attr-name">resourceName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UserDatabase<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Realm</span><span class="token punctuation">&gt;</span></span>
               resourceName="UserDatabase"/&gt;
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Realm</span><span class="token punctuation">&gt;</span></span>

      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Host</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>localhost<span class="token punctuation">"</span></span>  <span class="token attr-name">appBase</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>webapps<span class="token punctuation">"</span></span>
            <span class="token attr-name">unpackWARs</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> <span class="token attr-name">autoDeploy</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Valve</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.apache.catalina.valves.AccessLogValve<span class="token punctuation">"</span></span> <span class="token attr-name">directory</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>logs<span class="token punctuation">"</span></span>
               <span class="token attr-name">prefix</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>localhost_access_log<span class="token punctuation">"</span></span> <span class="token attr-name">suffix</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>.txt<span class="token punctuation">"</span></span>
               <span class="token attr-name">pattern</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>%h %l %u %t <span class="token entity named-entity" title='"'>&amp;quot;</span>%r<span class="token entity named-entity" title='"'>&amp;quot;</span> %s %b<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Host</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Engine</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Service</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Server</span><span class="token punctuation">&gt;</span></span>


</code></pre> 
<h3><a id="13__98"></a>1.3 访问流程</h3> 
<p>1.用户在浏览器中输入网址 172.31.7.121:8080/mysite/index.jsp，请求被发送到本 机端口 8080，并有 HTTP/1.1 Connector 接收请求。<br> 2.Connector 把该请求交给其所在 tomcat 中 Service 的 Engine(Container)来继续处 理请求，并等待 Engine 的回复。<br> 3.Engine 获得请求 172.31.7.121:8080/mysite/index.jsp，匹配所有的虚拟主机 Host；<br> 4.Engine 匹配名为 172.31.7.121 的 Host，如果匹配不到就把请求交给 localhost 处 理，因为 localhost 被定义为该 Engine 的默认主机，名为 localhost 的 Host 获得请 求/mysite/index.jsp，匹配它所拥有的所有 Context。<br> 5.path=“/mysite”的 Context 获得请求/index.jsp，在它的 mapping table 中寻找 出对应的 Servlet，Context 匹配到 URL Pattern 为*.jsp 的 Servlet，对应于 JspServlet 类。<br> 6.构造 HttpServletRequest 对象和 HttpServletResponse 对象，作为参数调用 JspServlet 的 doGet()或 doPost(),执行业务逻辑、数据存储等；<br> 7.Context 把执行完之后的 HttpServletResponse 对象返回给 Host。<br> 8.Host 把 HttpServletResponse 对象返回给 Engine。<br> 9.Engine 把 HttpServletResponse 对象返回 Connector。<br> 10.Connector 把 HttpServletResponse 对象返回给客户端源端口并最终在客户端浏 览器渲染页面。<br> <img src="https://images2.imgbox.com/3e/50/I1feRMN6_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="14__webapp__110"></a>1.4 配置示 webapp 例</h3> 
<p>将 webapp 通过手动拷贝、编写脚本、部署工具分发到各 tomcat 的指定目录，然后启动 tomcat，启动成功后 tomcat 即可处理来自于客户端的请求。 在 k8s 环境是基于更新镜像。</p> 
<pre><code class="prism language-bash"><span class="token function">mkdir</span> /apps/tomcat/webapps/mysite -p
<span class="token builtin class-name">echo</span> <span class="token string">"&lt;h1&gt; lck mysite web page &lt;/h1&gt;"</span> <span class="token operator">&gt;</span> /apps/tomcat/webapps/mysite/index.jsp
<span class="token function">chown</span> tomcat.tomcat /apps/tomcat/ -R
systemctl restart tomcat
</code></pre> 
<p><img src="https://images2.imgbox.com/10/2b/CJNpeSZd_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="15__webapp__120"></a>1.5 企业 webapp 结构</h3> 
<p>webapp 体系机构：<br> webapp 有特定得到组织结构，是一种层次型目录结构，通常包含了 servlet 代 码文件、jsp 页面文件、类文件、部署描述符文件等，一般会打包成归档格式。</p> 
<p>/web 应用程序的目录：<br> WEB-INF：是 webapp 的私有资源目录，此目录里面的文件是不允许通过浏览器访问的，通常 web.xml 和tontext.xml 均放置于此目录。<br> WEB-INF/classes：此 webapp 自己提供的类，即不是 tomcat 自身提供的类<br> WEB-INF/lib：此 webapp 自有的能够被打包为 jar 格式的类</p> 
<h2><a id="Manager_App__128"></a>二、Manager App 使用</h2> 
<p>tomcat manager 是 Tomcat 自带的、使用 HTML 界面的、管理 Tomcat 自身以及部署在 tomcat 上的应用的一个 web 应用,它支持的功能包括：</p> 
<pre><code class="prism language-bash">通过 war 包部署新应用。 
在服务器上指定的路径部署新应用。 
列出当前部署的 Web 应用程序，以及当前这些 Web 应用程序处于活动状态的会话信息。
重新加载现有 Web 应用程序。
列出操作系统和 JVM 属性。
列出可用的全局 JNDI 资源。 
启动已停止的应用程序。 
停止现有应用程序。 
取消部署已部署的 Web 应用程序并删除其所在目录文件。
</code></pre> 
<p><img src="https://images2.imgbox.com/ce/a4/5kb0AzNy_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="21_manager_app__143"></a>2.1 manager app 角色介绍</h3> 
<p>Manager app 功能默认没有开启，需要单独在配置文件中开启并重启 tomcat 服务,支持的角色如下</p> 
<pre><code class="prism language-bash">manager-gui-访问 HTML 界面。 
manager-status-仅访问“服务器状态”页面。
manager-script —访问本文档中描述的工具友好的纯文本界面以及“服务器状 态”页面。 
manager-jmx-访问 JMX 代理界面和“服务器状态”页面。 
manager（已弃用）—结合了以上四个角色，允许在允许上述角色之一的任何地 方访问。不要使用它。使用以上特定的管理员 角色之一或它们的组合。
</code></pre> 
<p>注意事项：如果不开启角色认证则无法进行配置管理<br> <img src="https://images2.imgbox.com/6c/9d/Q13Ft2u5_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="22_manager_app__155"></a>2.2 manager app 账号授权</h3> 
<p>支持的账户认证方式</p> 
<pre><code class="prism language-bash"><span class="token number">1</span>.JDBCRealm 用户授权信息存储于某个关系型数据库中,通过 JDBC 驱动获取信息 验证。 
<span class="token number">2</span>.DataSourceRealm 用户授权信息存储于关于型数据中,通过 JNDI 配置 JDBC 数据 源的方式获取信息验证。 
<span class="token number">3</span>.JNDIRealm 用户授权信息存储在基于 LDAP 的目录服务的服务器中,通过 JNDI 驱动获取并验证。 
<span class="token number">4</span>.UserDatabaseRealm 默 认 的 配 置 方 式 , 信 息 存 储 于 XML 文 档 中 conf/tomcat-users.xml。 
<span class="token number">5</span>.MemoryRealm 用户信息存储于内存的集合中,对象集合的数据来源于 xml 文档 conf/tomcat-users.xml。 
<span class="token number">6</span>.JAASRealm 通过<span class="token punctuation">(</span>JAAS,Java Authentication and Authorization Service，Java 验证和 授权 API）框架访问授权信息。
</code></pre> 
<p>UserDatabaseRealm 认证实现</p> 
<pre><code class="prism language-bash"><span class="token comment">#指定认证文件及认证类型：</span>
<span class="token function">vim</span> /apps/tomcat/conf/server.xml
<span class="token operator">&lt;</span>GlobalNamingResources<span class="token operator">&gt;</span> 
	<span class="token operator">&lt;</span><span class="token operator">!</span>-- Editable user database that can also be used by 
		UserDatabaseRealm to authenticate <span class="token function">users</span> 
	--<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>Resource <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"UserDatabase"</span> <span class="token assign-left variable">auth</span><span class="token operator">=</span><span class="token string">"Container"</span> 
		<span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">"org.apache.catalina.UserDatabase"</span> 
		<span class="token assign-left variable">description</span><span class="token operator">=</span><span class="token string">"User database that can be updated and saved"</span> 
		<span class="token assign-left variable">factory</span><span class="token operator">=</span><span class="token string">"org.apache.catalina.users.MemoryUserDatabaseFactory"</span> 
		<span class="token assign-left variable">pathname</span><span class="token operator">=</span><span class="token string">"conf/tomcat-users.xml"</span> /<span class="token operator">&gt;</span> 
<span class="token operator">&lt;</span>/GlobalNamingResources<span class="token operator">&gt;</span> 

	<span class="token operator">&lt;</span>Realm <span class="token assign-left variable">className</span><span class="token operator">=</span><span class="token string">"org.apache.catalina.realm.UserDatabaseRealm"</span> <span class="token assign-left variable">resourceName</span><span class="token operator">=</span><span class="token string">"UserDatabase"</span>/<span class="token operator">&gt;</span> 

<span class="token comment">#修改 tomcat-users.xml 文件并指定账号密码及权限</span>
<span class="token function">vim</span> /apps/tomcat/conf/tomcat-users.xml 
--<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>role <span class="token assign-left variable">rolename</span><span class="token operator">=</span><span class="token string">"mamager-gui"</span>/<span class="token operator">&gt;</span> <span class="token comment">#添加自定义账户和角色授权 </span>
<span class="token operator">&lt;</span>user <span class="token assign-left variable">username</span><span class="token operator">=</span><span class="token string">"magedu"</span> <span class="token assign-left variable">password</span><span class="token operator">=</span><span class="token string">"magedu123"</span> <span class="token assign-left variable">roles</span><span class="token operator">=</span><span class="token string">"manager-gui"</span>/<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/tomcat-users<span class="token operator">&gt;</span>
</code></pre> 
<h3><a id="23__IP__191"></a>2.3 定义 IP 访问控制</h3> 
<p>默认情况下,tomcat 读取 context.xml 文件，但是 context.xml 默认仅允许本机 127.0.0.1 访问， 因此需要授权访问地址</p> 
<pre><code class="prism language-bash"><span class="token function">vim</span> /apps/tomcat/webapps/manager/META-INF/context.xml 
<span class="token assign-left variable">allow</span><span class="token operator">=</span><span class="token string">"127\.\d+\.\d+\.\d+|::1|0:0:0:0:0:0:0:1"</span> <span class="token comment">#源 </span>
<span class="token assign-left variable">allow</span><span class="token operator">=</span><span class="token string">"\d+\.\d+\.\d+.\d+|127\.\d+\.\d+\.\d+|::1|0:0:0:0:0:0:0:1"</span> /<span class="token operator">&gt;</span> <span class="token comment">#允许所有</span>
</code></pre> 
<p>注意事项：修改完以上两步重启 tomcat，如果只修改了 context.xml 不需要重启可以直接生效。</p> 
<pre><code class="prism language-bash">systemctl restart tomcat
</code></pre> 
<h3><a id="24__manager_app__203"></a>2.4 登录 manager app 界面</h3> 
<p><img src="https://images2.imgbox.com/85/aa/vZMjdyzk_o.png" alt="在这里插入图片描述"></p> 
<p>登录后的界面<br> <img src="https://images2.imgbox.com/d0/54/PoyFxtsT_o.png" alt="在这里插入图片描述"><br> 应用程序管理功能<br> <img src="https://images2.imgbox.com/2f/5e/QRaIEGJP_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="25__manager_app__webapp_210"></a>2.5 基于 manager app 部署 webapp</h3> 
<p>通过 manager app 管理界面部署 webapp，即不需要修改配置文件，有如下两种实现方式： 第一种是填写服务器上已经存在的目录和 index 文件，第二中是基于构建好的 war 包部署。<br> <img src="https://images2.imgbox.com/a7/2c/Cam4Xefb_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_213"></a>部署方式一：通过目录部署</h4> 
<p>由于webapp通常以目录的形式存在，因此在宿主机创建目录并生成web页面进行部署演示。</p> 
<pre><code class="prism language-bash"><span class="token function">mkdir</span> /data/tomcat/site2 -p    <span class="token comment">#创建jsp文件存放指定目录</span>
<span class="token function">chown</span> tomcat.tomcat /data/tomcat/ /apps/ -R
<span class="token builtin class-name">echo</span> <span class="token string">"&lt;h1&gt;lck site2 web page&lt;/h1&gt;"</span> <span class="token operator">&gt;</span> /data/tomcat/site2/index.jsp
</code></pre> 
<p><img src="https://images2.imgbox.com/e1/69/yqTCoCMJ_o.png" alt="在这里插入图片描述"><br> 部署成功后，会有如下信息，并且会将代码自动 copy 到 tomcat 定义好 appBase 目录并可以 直接访问<br> <img src="https://images2.imgbox.com/06/51/u2K7aqTb_o.png" alt="在这里插入图片描述"><br> 注意事项：<br> 可以通过 manager app 卸载此 webapp，卸载后立即将 appBase 目录中的 site3 目录删除， 但是重启tomcat 不会删除 site2 目录。</p> 
<h4><a id="_war__226"></a>部署方式二：通过自定义 war 包部署</h4> 
<p>war 包通常由开发构建好再交给运维部署</p> 
<pre><code class="prism language-bash"><span class="token function">mkdir</span> site3
<span class="token builtin class-name">echo</span> <span class="token string">"&lt;h1&gt;lck site3 web page&lt;/h1&gt;"</span> <span class="token operator">&gt;</span> /root/site3/index.jsp
<span class="token function">zip</span> site3.war index.jsp
</code></pre> 
<p><img src="https://images2.imgbox.com/39/2a/FeFqujqp_o.png" alt="在这里插入图片描述"><br> 部署成功<br> <img src="https://images2.imgbox.com/79/9a/B8ubi5CA_o.png" alt="在这里插入图片描述"><br> 访问 web<br> <img src="https://images2.imgbox.com/3c/6d/Mh3f8GBx_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@centos7 ~<span class="token punctuation">]</span><span class="token comment"># ll /apps/tomcat/webapps/</span>
total <span class="token number">8</span>
drwxr-x--- <span class="token number">15</span> tomcat tomcat <span class="token number">4096</span> Aug  <span class="token number">2</span> <span class="token number">23</span>:15 docs
drwxr-x---  <span class="token number">7</span> tomcat tomcat   <span class="token number">99</span> Aug  <span class="token number">2</span> <span class="token number">23</span>:15 examples
drwxr-x---  <span class="token number">6</span> tomcat tomcat   <span class="token number">79</span> Aug  <span class="token number">2</span> <span class="token number">23</span>:15 host-manager
drwxr-x---  <span class="token number">6</span> tomcat tomcat  <span class="token number">114</span> Aug  <span class="token number">2</span> <span class="token number">23</span>:15 manager
drwxr-xr-x  <span class="token number">2</span> tomcat tomcat   <span class="token number">23</span> Aug  <span class="token number">3</span> <span class="token number">23</span>:52 mysite
drwxr-x---  <span class="token number">3</span> tomcat tomcat  <span class="token number">223</span> Aug  <span class="token number">2</span> <span class="token number">23</span>:15 ROOT
drwxr-x---  <span class="token number">2</span> tomcat tomcat   <span class="token number">23</span> Aug  <span class="token number">4</span> 02:02 site2
drwxr-x---  <span class="token number">3</span> tomcat tomcat   <span class="token number">39</span> Aug  <span class="token number">4</span> 02:17 site3
-rw-r-----  <span class="token number">1</span> tomcat tomcat  <span class="token number">181</span> Aug  <span class="token number">4</span> 02:17 site3.war
</code></pre> 
<h3><a id="26__jenkins_war__253"></a>2.6 手动部署开源项目 jenkins war 包部署</h3> 
<p>https://www.jenkins.io/zh/download/<br> https://mirrors.tuna.tsinghua.edu.cn/jenkins/</p> 
<pre><code class="prism language-bash">ll /apps/tomcat/webapps/jenkins.war
</code></pre> 
<p><img src="https://images2.imgbox.com/e2/55/PbEBiOyp_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_IP__261"></a>定义 IP 访问控制</h4> 
<pre><code class="prism language-bash"><span class="token function">vim</span> /apps/tomcat/webapps/host-manager/META-INF/context.xml 
<span class="token assign-left variable">allow</span><span class="token operator">=</span><span class="token string">"127\.\d+\.\d+\.\d+|::1|0:0:0:0:0:0:0:1"</span> /<span class="token operator">&gt;</span> <span class="token comment">#源 </span>
<span class="token assign-left variable">allow</span><span class="token operator">=</span><span class="token string">"\d+\.\d+\.\d+.\d+|127\.\d+\.\d+\.\d+|::1|0:0:0:0:0:0:0:1"</span> /<span class="token operator">&gt;</span> <span class="token comment">#修改后</span>
</code></pre> 
<h4><a id="hostmanager__268"></a>host-manager 账户授权</h4> 
<p>使用和 manager app 相同的授权文件，即/apps/tomcat/conf/tomcat-users.xml，但是需要配置 admin-gui 的权限</p> 
<pre><code class="prism language-bash"><span class="token function">vim</span> /apps/tomcat/conf/tomcat-users.xml 
--<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>role <span class="token assign-left variable">rolename</span><span class="token operator">=</span><span class="token string">"mamager-gui"</span>/<span class="token operator">&gt;</span> 
<span class="token operator">&lt;</span>role <span class="token assign-left variable">rolename</span><span class="token operator">=</span><span class="token string">"admin-gui"</span>/<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>user <span class="token assign-left variable">username</span><span class="token operator">=</span><span class="token string">"magedu"</span> <span class="token assign-left variable">password</span><span class="token operator">=</span><span class="token string">"magedu123"</span> <span class="token assign-left variable">roles</span><span class="token operator">=</span><span class="token string">"manager-gui,admin-gui"</span>/<span class="token operator">&gt;</span> 
<span class="token operator">&lt;</span>/tomcat-users<span class="token operator">&gt;</span>
</code></pre> 
<p>修改完以上两步重启 tomcat，如果只修改了 context.xml 不需要重启可以直接生效</p> 
<pre><code class="prism language-bash">systemctl restart tomcat
</code></pre> 
<h4><a id="_hostmanager__283"></a>登录 host-manager 界面</h4> 
<p><img src="https://images2.imgbox.com/da/ac/KW2eqPi1_o.png" alt="在这里插入图片描述"><br> 登录界面<br> <img src="https://images2.imgbox.com/d8/07/klXZxuPj_o.png" alt="在这里插入图片描述"><br> 权限错误的界面<br> <img src="https://images2.imgbox.com/db/96/TQZ1krMX_o.png" alt="在这里插入图片描述"><br> 登录成功的界面<br> <img src="https://images2.imgbox.com/14/90/b32hEWDi_o.png" alt="在这里插入图片描述"><br> 列出虚拟机<br> <img src="https://images2.imgbox.com/9a/05/IVkXrX1u_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="Host_Manager__293"></a>三、Host Manager 使用</h2> 
<h3><a id="31_host_manager__294"></a>3.1 host manager 账户授权</h3> 
<pre><code class="prism language-bash"><span class="token function">vim</span> /apps/tomcat/conf/tomcat-users.xml
--<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>role <span class="token assign-left variable">rolename</span><span class="token operator">=</span><span class="token string">"mamager-gui"</span>/<span class="token operator">&gt;</span> 
<span class="token operator">&lt;</span>role <span class="token assign-left variable">rolename</span><span class="token operator">=</span><span class="token string">"admin-gui"</span>/<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>user <span class="token assign-left variable">username</span><span class="token operator">=</span><span class="token string">"lck"</span> <span class="token assign-left variable">password</span><span class="token operator">=</span><span class="token string">"lck123"</span> <span class="token assign-left variable">roles</span><span class="token operator">=</span><span class="token string">"manager-gui,admin-gui"</span>/<span class="token operator">&gt;</span> 
<span class="token operator">&lt;</span>/tomcat-users<span class="token operator">&gt;</span> 

systemctl restart tomcat
</code></pre> 
<h3><a id="32__IP__307"></a>3.2 定义 IP 访问控制</h3> 
<pre><code class="prism language-bash"><span class="token function">vim</span> /apps/tomcat/webapps/host-manager/META-INF/context.xml
<span class="token comment"># allow="127\.\d+\.\d+\.\d+|::1|0:0:0:0:0:0:0:1" #原来配置，注释掉，换成下面配置</span>
<span class="token assign-left variable">allow</span><span class="token operator">=</span><span class="token string">"\d+\.\d+\.\d+.\d+|127\.\d+\.\d+\.\d+|::1|0:0:0:0:0:0:0:1"</span> /<span class="token operator">&gt;</span> <span class="token comment">#允许所有</span>

systemctl restart tomcat
</code></pre> 
<h3><a id="33__hostmanager__315"></a>3.3 登录 host-manager 界面</h3> 
<p><img src="https://images2.imgbox.com/84/c5/zXcWy6jf_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/d3/30/L5GFmJf9_o.png" alt="在这里插入图片描述"><br> 登陆成功的界面<br> <img src="https://images2.imgbox.com/f6/74/Z3t0ulXI_o.png" alt="在这里插入图片描述"><br> 列出所有的虚拟机<br> <img src="https://images2.imgbox.com/86/de/EwMs7tqP_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="Tomcat_Host__322"></a>四、Tomcat Host 高级应用</h2> 
<h3><a id="41___323"></a>4.1 单站点</h3> 
<p>配置文件</p> 
<pre><code class="prism language-bash"><span class="token function">vim</span> /apps/tomcat/conf/server.xml 
<span class="token operator">&lt;</span>Host <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"localhost"</span> <span class="token assign-left variable">appBase</span><span class="token operator">=</span><span class="token string">"/data/tomcat/webapps"</span> <span class="token comment"># 等于webapp项目代码的home路径</span>
<span class="token assign-left variable">unpackWARs</span><span class="token operator">=</span><span class="token string">"true"</span> <span class="token assign-left variable">autoDeploy</span><span class="token operator">=</span><span class="token string">"true"</span> 
<span class="token assign-left variable">xmlValidation</span><span class="token operator">=</span><span class="token string">"false"</span> <span class="token assign-left variable">xmlNamespaceAware</span><span class="token operator">=</span><span class="token string">"false"</span><span class="token operator">&gt;</span> 
<span class="token operator">&lt;</span>/Host<span class="token operator">&gt;</span> 

一般以下两个功能不选择开启，把true改为fail
<span class="token assign-left variable">unpackWARs</span><span class="token operator">=</span><span class="token string">"true"</span> <span class="token comment">#自动解压 </span>
jar <span class="token assign-left variable">autoDeploy</span><span class="token operator">=</span><span class="token string">"true"</span> <span class="token comment">#tomcat自动部署</span>

<span class="token builtin class-name">echo</span> <span class="token string">"&lt;h1&gt;magedu mysite1 web page"</span> <span class="token operator">&gt;</span> /data/tomcat/webapps/mysite1/index.jsp
</code></pre> 
<p>访问 URL：10.0.0.14:8080/mysite1/index.jsp</p> 
<h3><a id="42__340"></a>4.2 多站点</h3> 
<pre><code class="prism language-bash"><span class="token function">vim</span> /apps/tomcat/conf/server.xml 
<span class="token operator">&lt;</span>Host <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"www.site1.net"</span> <span class="token assign-left variable">appBase</span><span class="token operator">=</span><span class="token string">"/data/tomcat"</span> 
<span class="token assign-left variable">unpackWARs</span><span class="token operator">=</span><span class="token string">"true"</span> <span class="token assign-left variable">autoDeploy</span><span class="token operator">=</span><span class="token string">"true"</span><span class="token operator">&gt;</span> 
<span class="token operator">&lt;</span>Context <span class="token assign-left variable">path</span><span class="token operator">=</span><span class="token string">""</span> <span class="token assign-left variable">docBase</span><span class="token operator">=</span><span class="token string">"site1"</span> <span class="token assign-left variable">reloadable</span><span class="token operator">=</span><span class="token string">"true"</span> /<span class="token operator">&gt;</span> 
<span class="token operator">&lt;</span>Valve <span class="token assign-left variable">className</span><span class="token operator">=</span><span class="token string">"org.apache.catalina.valves.AccessLogValve"</span> <span class="token assign-left variable">directory</span><span class="token operator">=</span><span class="token string">"logs"</span> <span class="token assign-left variable">prefix</span><span class="token operator">=</span><span class="token string">"site1_access"</span> <span class="token assign-left variable">suffix</span><span class="token operator">=</span><span class="token string">".log"</span> <span class="token assign-left variable">pattern</span><span class="token operator">=</span><span class="token string">"%h %l %u %t &amp;quot;%r&amp;quot; %s %b"</span> /<span class="token operator">&gt;</span> 
<span class="token operator">&lt;</span>/Host<span class="token operator">&gt;</span> 

<span class="token operator">&lt;</span>Host <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"www.site2.net"</span> <span class="token assign-left variable">appBase</span><span class="token operator">=</span><span class="token string">"/data/tomcat"</span> 
<span class="token assign-left variable">unpackWAPs</span><span class="token operator">=</span><span class="token string">"true"</span> <span class="token assign-left variable">autoDeploy</span><span class="token operator">=</span><span class="token string">"true"</span><span class="token operator">&gt;</span> 
<span class="token operator">&lt;</span>Context <span class="token assign-left variable">path</span><span class="token operator">=</span><span class="token string">""</span> <span class="token assign-left variable">docBase</span><span class="token operator">=</span><span class="token string">"site2"</span> <span class="token assign-left variable">reloadable</span><span class="token operator">=</span><span class="token string">"true"</span> /<span class="token operator">&gt;</span> 
<span class="token operator">&lt;</span>Valve <span class="token assign-left variable">className</span><span class="token operator">=</span><span class="token string">"org.apache.catalina.valves.AccessLogValve"</span> <span class="token assign-left variable">directory</span><span class="token operator">=</span><span class="token string">"logs"</span> <span class="token assign-left variable">prefix</span><span class="token operator">=</span><span class="token string">"site2_access."</span> <span class="token assign-left variable">suffix</span><span class="token operator">=</span><span class="token string">".log"</span> <span class="token assign-left variable">pattern</span><span class="token operator">=</span><span class="token string">"%h %l %u %t &amp;quot;%r&amp;quot; %s %b"</span> /<span class="token operator">&gt;</span> 
<span class="token operator">&lt;</span>/Host<span class="token operator">&gt;</span>

<span class="token builtin class-name">echo</span> <span class="token string">"site1"</span> <span class="token operator">&gt;</span> /data/tomcat/site1/index.jsp
<span class="token builtin class-name">echo</span> <span class="token string">"site2"</span> <span class="token operator">&gt;</span> /data/tomcat/site2/index.jsp
</code></pre> 
<p>访问 URL：<br> www.site1.net:8080/site1/index.jsp<br> www.site2.net:8080/site2/index.jsp</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c6163030a466cb2a205d228971fa80d3/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">戴尔服务器r710主板电池位置,Dell戴尔R710 Raid卡及电池迁移（硬盘冷迁移=停机迁移）...</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/15ac0824bbdbe6da171eb9510c4faa0e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">火影忍者手游服务器维护多久,火影忍者手游12月26月维护更新公告 全新职业等级剧情上线...</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>