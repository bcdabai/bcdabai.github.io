<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>å¸¦ä½ ç©è½¬PX4æ— äººæœºä»¿çœŸ(2) â€”â€” å®šç‚¹é£è¡Œ - ç¼–ç¨‹å¤§ç™½çš„åšå®¢</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="å¸¦ä½ ç©è½¬PX4æ— äººæœºä»¿çœŸ(2) â€”â€” å®šç‚¹é£è¡Œ" />
<meta property="og:description" content="ç›®å½• ä¸€. ä»¿çœŸä»£ç äºŒ. ç¼–è¯‘è¿è¡Œå‚è€ƒ å‰è¨€ï¼š æœ¬æ•™ç¨‹æ˜¯åœ¨ä»¿çœŸä¸­å®ç°æ— äººæœºå®šç‚¹é£è¡Œï¼ˆå¦‚æœæƒ³è¦åœ¨çœŸæœºä¸Šå®ç°ï¼Œè¿˜è¦ä¿®æ”¹ä»£ç ï¼‰
æ³¨ï¼šæ­å»ºä»¿çœŸç¯å¢ƒå¯ä»¥çœ‹ä¸‹é¢æ•™ç¨‹ ğŸ‘‡
(æœ€æ–°)ubuntuæ­å»ºPX4æ— äººæœºä»¿çœŸç¯å¢ƒ(1) â€”â€” æ¦‚å¿µä»‹ç»åŠç¯å¢ƒå»ºè®®
(æœ€æ–°)ubuntuæ­å»ºPX4æ— äººæœºä»¿çœŸç¯å¢ƒ(2) â€”â€” MAVROSå®‰è£…
(æœ€æ–°)ubuntuæ­å»ºPX4æ— äººæœºä»¿çœŸç¯å¢ƒ(3) â€”â€” ubuntuå®‰è£…QGCåœ°é¢ç«™
(æœ€æ–°)ubuntuæ­å»ºPX4æ— äººæœºä»¿çœŸç¯å¢ƒ(4) â€”â€” ä»¿çœŸç¯å¢ƒæ­å»º
ubuntuå®‰è£…ROS melodic(æœ€æ–°ã€è¶…è¯¦ç»†å›¾æ–‡æ•™ç¨‹)
å‰æœŸå›é¡¾ï¼š
å¸¦ä½ ç©è½¬PX4æ— äººæœºä»¿çœŸ(1) â€”â€” è¿è¡Œå®˜æ–¹æ¡ˆä¾‹ï¼ˆC&#43;&#43;ï¼‰
ä¸€. ä»¿çœŸä»£ç  æˆ‘ä»¬ç»§ç»­ä½¿ç”¨ å¸¦ä½ ç©è½¬PX4æ— äººæœºä»¿çœŸ(1) ä¸­çš„åŠŸèƒ½åŒ…ï¼Œåœ¨ off_node åŠŸèƒ½åŒ…ä¸‹çš„ src ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª rect_no_rc.cpp æ–‡ä»¶
cd ~/catkin_ws/src/off_node/src/ touch rect_no_rc.cpp // åˆ›å»ºæ–‡ä»¶ gedit rect_no_rc.cpp // æ‰“å¼€æ–‡ä»¶ æ‰“å¼€æ–‡ä»¶ï¼Œå°†ä»£ç ç²˜è´´ä¸Šå»
ç›®æ ‡ç‚¹ï¼š(0,0,2) (5,0,2) (5,5,2) (0,5,2)
/** * @file rect_no_rc.cpp * @brief Offboard control example node, written with MAVROS version 0.19.x, PX4 Pro Flight * Stack and tested in Gazebo Classic SITL */ #include &lt;ros/ros." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/1e21cd47a9722870925e1744cb17871f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-01T17:51:39+08:00" />
<meta property="article:modified_time" content="2024-01-01T17:51:39+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="ç¼–ç¨‹å¤§ç™½çš„åšå®¢" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">ç¼–ç¨‹å¤§ç™½çš„åšå®¢</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">å¸¦ä½ ç©è½¬PX4æ— äººæœºä»¿çœŸ(2) â€”â€” å®šç‚¹é£è¡Œ</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>ç›®å½•</h4> 
 <ul><li><ul><li><a href="#__22" rel="nofollow">ä¸€. ä»¿çœŸä»£ç </a></li><li><a href="#__182" rel="nofollow">äºŒ. ç¼–è¯‘è¿è¡Œ</a></li><li><a href="#_211" rel="nofollow">å‚è€ƒ</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<p><strong>å‰è¨€ï¼š</strong> æœ¬æ•™ç¨‹æ˜¯åœ¨ä»¿çœŸä¸­å®ç°æ— äººæœºå®šç‚¹é£è¡Œï¼ˆå¦‚æœæƒ³è¦åœ¨çœŸæœºä¸Šå®ç°ï¼Œè¿˜è¦ä¿®æ”¹ä»£ç ï¼‰</p> 
<p><strong>æ³¨ï¼šæ­å»ºä»¿çœŸç¯å¢ƒå¯ä»¥çœ‹ä¸‹é¢æ•™ç¨‹</strong> ğŸ‘‡</p> 
<p><a href="https://blog.csdn.net/weixin_55944949/article/details/130848009?spm=1001.2014.3001.5502">(æœ€æ–°)ubuntuæ­å»ºPX4æ— äººæœºä»¿çœŸç¯å¢ƒ(1) â€”â€” æ¦‚å¿µä»‹ç»åŠç¯å¢ƒå»ºè®®</a></p> 
<p><a href="https://blog.csdn.net/weixin_55944949/article/details/130877689?spm=1001.2014.3001.5502">(æœ€æ–°)ubuntuæ­å»ºPX4æ— äººæœºä»¿çœŸç¯å¢ƒ(2) â€”â€” MAVROSå®‰è£…</a></p> 
<p><a href="https://blog.csdn.net/weixin_55944949/article/details/130895363?spm=1001.2014.3001.5502">(æœ€æ–°)ubuntuæ­å»ºPX4æ— äººæœºä»¿çœŸç¯å¢ƒ(3) â€”â€” ubuntuå®‰è£…QGCåœ°é¢ç«™</a></p> 
<p><a href="https://blog.csdn.net/weixin_55944949/article/details/130895608?spm=1001.2014.3001.5501">(æœ€æ–°)ubuntuæ­å»ºPX4æ— äººæœºä»¿çœŸç¯å¢ƒ(4) â€”â€” ä»¿çœŸç¯å¢ƒæ­å»º</a></p> 
<p><a href="https://blog.csdn.net/weixin_55944949/article/details/130468032?spm=1001.2014.3001.5502">ubuntuå®‰è£…ROS melodic(æœ€æ–°ã€è¶…è¯¦ç»†å›¾æ–‡æ•™ç¨‹)</a></p> 
<p><strong>å‰æœŸå›é¡¾ï¼š</strong></p> 
<p><a href="https://blog.csdn.net/weixin_55944949/article/details/132570487?spm=1001.2014.3001.5501">å¸¦ä½ ç©è½¬PX4æ— äººæœºä»¿çœŸ(1) â€”â€” è¿è¡Œå®˜æ–¹æ¡ˆä¾‹ï¼ˆC++ï¼‰</a></p> 
<h3><a id="__22"></a>ä¸€. ä»¿çœŸä»£ç </h3> 
<p>æˆ‘ä»¬ç»§ç»­ä½¿ç”¨ <code>å¸¦ä½ ç©è½¬PX4æ— äººæœºä»¿çœŸ(1)</code> ä¸­çš„åŠŸèƒ½åŒ…ï¼Œåœ¨ off_node åŠŸèƒ½åŒ…ä¸‹çš„ src ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª <strong>rect_no_rc.cpp</strong> æ–‡ä»¶</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> ~/catkin_ws/src/off_node/src/
<span class="token function">touch</span> rect_no_rc.cpp   // åˆ›å»ºæ–‡ä»¶
gedit rect_no_rc.cpp   // æ‰“å¼€æ–‡ä»¶
</code></pre> 
<p>æ‰“å¼€æ–‡ä»¶ï¼Œå°†ä»£ç ç²˜è´´ä¸Šå»<br> ç›®æ ‡ç‚¹ï¼š<strong>(0,0,2)</strong> <strong>(5,0,2)</strong> <strong>(5,5,2)</strong> <strong>(0,5,2)</strong></p> 
<pre><code class="prism language-c++">/**
 * @file rect_no_rc.cpp
 * @brief Offboard control example node, written with MAVROS version 0.19.x, PX4 Pro Flight
 * Stack and tested in Gazebo Classic SITL
 */

#include &lt;ros/ros.h&gt;
#include &lt;geometry_msgs/PoseStamped.h&gt;
#include &lt;mavros_msgs/CommandBool.h&gt;
#include &lt;mavros_msgs/SetMode.h&gt;
#include &lt;mavros_msgs/State.h&gt;
#define GREEN "\033[0;1;32m"

using namespace std;

mavros_msgs::State current_state;      // æ— äººæœºå½“å‰çŠ¶æ€
geometry_msgs::PoseStamped curr_pos;   // æ— äººæœºå½“å‰ä½ç½®
geometry_msgs::PoseStamped aim_pos;    // æ— äººæœºç›®æ ‡ä½ç½®

void state_cb(const mavros_msgs::State::ConstPtr&amp; msg){
    current_state = *msg;
    ROS_INFO("current mode: %s",current_state.mode.c_str());
    ROS_INFO("system_status: %d",current_state.system_status);
}

void arrive_pos(const geometry_msgs::PoseStamped::ConstPtr&amp; msg){
    curr_pos = *msg;
    cout &lt;&lt;GREEN &lt;&lt;fabs((*msg).pose.position.z - aim_pos.pose.position.z) &lt;&lt;endl; 
}
int main(int argc, char **argv)
{
    ros::init(argc, argv, "rect_no_rc");
    ros::NodeHandle nh;

    ros::Subscriber state_sub = nh.subscribe&lt;mavros_msgs::State&gt;
            ("mavros/state", 10, state_cb);
    ros::Publisher local_pos_pub = nh.advertise&lt;geometry_msgs::PoseStamped&gt;
            ("mavros/setpoint_position/local", 10);
    ros::ServiceClient arming_client = nh.serviceClient&lt;mavros_msgs::CommandBool&gt;
            ("mavros/cmd/arming");
    ros::ServiceClient set_mode_client = nh.serviceClient&lt;mavros_msgs::SetMode&gt;
            ("mavros/set_mode");

    ros::Subscriber local_pos_sub = nh.subscribe&lt;geometry_msgs::PoseStamped&gt;
        ("mavros/local_position/pose",10,arrive_pos);

    //the setpoint publishing rate MUST be faster than 2Hz
    ros::Rate rate(20.0); // 20Hz

    // wait for FCU connection
    while(ros::ok() &amp;&amp; !current_state.connected){
        ros::spinOnce();
        rate.sleep();
    }

    //geometry_msgs::PoseStamped aim_pos;
    aim_pos.pose.position.x = 0;
    aim_pos.pose.position.y = 0;
    aim_pos.pose.position.z = 2;

    //send a few setpoints before starting
    for(int i = 100; ros::ok() &amp;&amp; i &gt; 0; --i){
        local_pos_pub.publish(aim_pos);
        ros::spinOnce();
        rate.sleep();
    }

    mavros_msgs::SetMode offb_set_mode;
    offb_set_mode.request.custom_mode = "OFFBOARD";

    mavros_msgs::CommandBool arm_cmd;
    arm_cmd.request.value = true;

    ros::Time last_request = ros::Time::now();

    int count = 0;   // è®¡æ—¶

    while(ros::ok()){
        if( current_state.mode != "OFFBOARD" &amp;&amp;
            (ros::Time::now() - last_request &gt; ros::Duration(5.0))){
            if( set_mode_client.call(offb_set_mode) &amp;&amp;
                offb_set_mode.response.mode_sent){
                ROS_INFO("Offboard enabled");
            }  // ä»£ç åˆ‡æ¢ Offboard æ¨¡å¼
            last_request = ros::Time::now();
        } else {
            if( !current_state.armed &amp;&amp;
                (ros::Time::now() - last_request &gt; ros::Duration(5.0))){
                if( arming_client.call(arm_cmd) &amp;&amp;
                    arm_cmd.response.success){
                    ROS_INFO("Vehicle armed");
                } // è§£é”
                last_request = ros::Time::now();
            }
        }
        if(fabs(curr_pos.pose.position.z - aim_pos.pose.position.z) &lt;= 0.3){
            count++;
            // æ—¶é—´åªæ˜¯å‚è€ƒï¼Œè¿è¡Œåä¼šæœ‰è¯¯å·®
            if(count == 300)  // 15s 
            {
                aim_pos.pose.position.x = 5;
            }
            if(count == 600)  // 30s
            {
                aim_pos.pose.position.y = 5;
            }
            if(count == 900)  // 45s
            {
                aim_pos.pose.position.x = 0;
            }
            if(count == 1200)  // 60s
            {
                aim_pos.pose.position.x = 0;
                aim_pos.pose.position.y = 0;
            }
            if(count &gt;= 1500)  // 75s
            {
                mavros_msgs::SetMode land_set_mode;
                land_set_mode.request.custom_mode = "AUTO.LAND";  // åˆ‡æ¢é™è½æ¨¡å¼
                if(set_mode_client.call(land_set_mode) &amp;&amp; land_set_mode.response.mode_sent){
                    ROS_INFO("land enabled");
                }
                //ä»»åŠ¡ç»“æŸ,å…³é—­è¯¥èŠ‚ç‚¹
                ros::shutdown();
            }  
        }

        local_pos_pub.publish(aim_pos); 

        ros::spinOnce();
        rate.sleep();
    }

    return 0;
}
</code></pre> 
<p>å°†ä¸‹é¢å†…å®¹æ·»åŠ åˆ° off_node åŠŸèƒ½åŒ…ä¸‹çš„ CMakeLists.txt æ–‡ä»¶é‡Œ</p> 
<pre><code>add_executable(rect_no_rc src/rect_no_rc.cpp)
target_link_libraries(rect_no_rc ${catkin_LIBRARIES})
</code></pre> 
<h3><a id="__182"></a>äºŒ. ç¼–è¯‘è¿è¡Œ</h3> 
<p>è¿è¡Œä¸‹é¢å‘½ä»¤ï¼Œç¼–è¯‘ä»£ç </p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> ~/catkin_ws
catkin_make <span class="token comment"># ä½¿ç”¨catkin buildè¯ï¼Œåˆ™ä¸º catkin build</span>
</code></pre> 
<p>åˆ›å»ºä¸€ä¸ªå¯åŠ¨è„šæœ¬ <strong>rect.sh</strong></p> 
<pre><code class="prism language-shell"><span class="token shebang important">#!/bin/bash</span>
<span class="token builtin class-name">source</span> ~/.bashrc
gnome-terminal <span class="token parameter variable">--window</span> <span class="token parameter variable">-e</span> <span class="token string">'bash -c "roscore; exec bash"'</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--tab</span> <span class="token parameter variable">-e</span> <span class="token string">'bash -c "sleep 5; roslaunch px4 mavros_posix_sitl.launch; exec bash"'</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--tab</span> <span class="token parameter variable">-e</span> <span class="token string">'bash -c "sleep 10; rosrun off_node rect_no_rc; exec bash"'</span> <span class="token punctuation">\</span>
</code></pre> 
<p>è¿è¡Œ</p> 
<pre><code class="prism language-bash"><span class="token function">chmod</span> +x rect.sh
./rect.sh
</code></pre> 
<p>è¿è¡Œæ•ˆæœå¦‚ä¸‹ï¼šğŸ‘‡<br> </p> 
<div class="csdn-video-box"> 
 <iframe id="M2zDTYKT-1704101469077" frameborder="0" src="https://player.bilibili.com/player.html?aid=878101702" allowfullscreen="true" data-mediaembed="bilibili"></iframe> 
 <p>PX4æ— äººæœºä»¿çœŸâ€”â€”å®šç‚¹é£è¡Œ</p> 
</div> 
<p></p> 
<h3><a id="_211"></a>å‚è€ƒ</h3> 
<p><a href="https://docs.px4.io/main/zh/ros/mavros_offboard_cpp.html" rel="nofollow">MAVROS Offboard æ§åˆ¶ç¤ºä¾‹ (C++) | PX4 è‡ªåŠ¨é©¾é©¶ç”¨æˆ·æŒ‡å—</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6aebd0ffbf8956411382903602a18d9b/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">ã€Cè¯­è¨€ã€‘æ–‡ä»¶æ“ä½œå‡½æ•°</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/92592bdf2e7d786c11e6d89731324be8/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">ç¬¬ä¸‰åä¸ƒå‘¨å‘¨æŠ¥ï¼šæ–‡çŒ®é˜…è¯»&#43;æ©ç ã€å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶&#43;ä½ç½®ç¼–ç </p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 ç¼–ç¨‹å¤§ç™½çš„åšå®¢.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>