<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>MySQL自带的数据库压力测试工具mysqlslap使用详解 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="MySQL自带的数据库压力测试工具mysqlslap使用详解" />
<meta property="og:description" content="1，基本介绍 mysqlslap 是 MySQL 从 5.1.4 版开始官方自带的一个压力测试工具。它通过模拟多个并发客户端访问 MySQL 来执行压力测试，我们通过结果信息可以了解数据库的性能状况。mysqlslap 是系统运维和 DBA 人员应该掌握一些常见的压力测试工具之一，其主要工作场景就是对数据库服务器做基准测试。比如：服务器的硬件资源能够支持多大的访问压力呢？优化了操作系统的内核参数后，是否提升了性能？调整了 MySQL 配置参数后，对性能有多少影响？ 2，简单用法 （1）我们执行如下命令对数据库做一个简单的自动测试，–auto-generate-sql 作用是自动生成测试 SQL。
注意：如果我们没有人为指定测试数据库，则默认是 mysqlslap（该数据库会自动创建，测试完毕自动删除）。
mysqlslap -uroot -pHangge_123 --auto-generate-sql （2）运行结果如下：
Average number of seconds to run all queries：运行所有语句的平均秒数Minimum number of seconds to run all queries：运行所有语句的最小秒数Maximum number of seconds to run all queries：运行所有语句的最大秒数Number of clients running queries：客户端数量Average number of queries per client：每个客户端运行查询的平均数 3，打印实际的测试过程 （1）测试的过程需要生成测试表，插入测试数据，我们可以添加 –only-print 来打印实际的测试过程（不会实际执行）：
mysqlslap -uroot -pHangge_123 --auto-generate-sql --only-print （2）运行结果如下，可以看到整个测试完成后会自动删除测试库，不会在数据库中留下痕迹。
4，添加并发 （1）我们可以添加如下两个参数，模拟并发处理查询请求：
–concurrency=100：指定同时有 100 个客户端连接–number-of-queries=1000：指定总的测试查询次数（并发客户端数 * 每个客户端的查询次数），这样本样例平均每个客户端查询 10 次 mysqlslap -uroot -pHangge_123 --concurrency=100 --number-of-queries=1000 --auto-generate-sql （2）运行结果如下（注意结果是完成 1000 次查询的总时间）：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/e654c981bf29b47c2bad9cb5ba9990ce/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-05-03T17:07:48+08:00" />
<meta property="article:modified_time" content="2023-05-03T17:07:48+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">MySQL自带的数据库压力测试工具mysqlslap使用详解</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-kimbie-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h4><a id="1_0"></a>1，基本介绍</h4> 
<ul><li><strong>mysqlslap</strong> 是 <strong>MySQL</strong> 从 <strong>5.1.4</strong> 版开始官方自带的一个压力测试工具。它通过模拟多个并发客户端访问 <strong>MySQL</strong> 来执行压力测试，我们通过结果信息可以了解数据库的性能状况。</li><li><strong>mysqlslap</strong> 是系统运维和 <strong>DBA</strong> 人员应该掌握一些常见的压力测试工具之一，其主要工作场景就是对数据库服务器做基准测试。比如：服务器的硬件资源能够支持多大的访问压力呢？优化了操作系统的内核参数后，是否提升了性能？调整了 <strong>MySQL</strong> 配置参数后，对性能有多少影响？</li></ul> 
<h4><a id="2_5"></a>2，简单用法</h4> 
<p>（1）我们执行如下命令对数据库做一个简单的自动测试，<strong>–auto-generate-sql</strong> 作用是自动生成测试 <strong>SQL</strong>。</p> 
<p><strong>注意</strong>：如果我们没有人为指定测试数据库，则默认是 <strong>mysqlslap</strong>（该数据库会自动创建，测试完毕自动删除）。</p> 
<pre><code class="prism language-shell">mysqlslap -uroot -pHangge_123 --auto-generate-sql
</code></pre> 
<p>（2）运行结果如下：</p> 
<ul><li><strong>Average number of seconds to run all queries</strong>：运行所有语句的平均秒数</li><li><strong>Minimum number of seconds to run all queries</strong>：运行所有语句的最小秒数</li><li><strong>Maximum number of seconds to run all queries</strong>：运行所有语句的最大秒数</li><li><strong>Number of clients running queries</strong>：客户端数量</li><li><strong>Average number of queries per client</strong>：每个客户端运行查询的平均数</li></ul> 
<p><a href="https://www.hangge.com/blog/cache/detail_3068.html#" rel="nofollow"><img src="https://images2.imgbox.com/91/3f/2Vsy0ByU_o.png" alt="原文:mysqlslap - MySQL自带的数据库压力测试工具使用详解（附样例）"></a></p> 
<h4><a id="3_26"></a>3，打印实际的测试过程</h4> 
<p>（1）测试的过程需要生成测试表，插入测试数据，我们可以添加 <strong>–only-print</strong> 来打印实际的测试过程（不会实际执行）：</p> 
<pre><code class="prism language-shell">mysqlslap -uroot -pHangge_123 --auto-generate-sql --only-print
</code></pre> 
<p>（2）运行结果如下，可以看到整个测试完成后会自动删除测试库，不会在数据库中留下痕迹。</p> 
<p><a href="https://www.hangge.com/blog/cache/detail_3068.html#" rel="nofollow"><img src="https://images2.imgbox.com/40/95/xqh4w9kv_o.png" alt="原文:mysqlslap - MySQL自带的数据库压力测试工具使用详解（附样例）"></a></p> 
<h4><a id="4_39"></a>4，添加并发</h4> 
<p>（1）我们可以添加如下两个参数，模拟并发处理查询请求：</p> 
<ul><li><strong>–concurrency=100</strong>：指定同时有 <strong>100</strong> 个客户端连接</li><li><strong>–number-of-queries=1000</strong>：指定总的测试查询次数（并发客户端数 * 每个客户端的查询次数），这样本样例平均每个客户端查询 <strong>10</strong> 次</li></ul> 
<pre><code class="prism language-shell">mysqlslap -uroot -pHangge_123 --concurrency<span class="token operator">=</span><span class="token number">100</span> --number-of-queries<span class="token operator">=</span><span class="token number">1000</span> --auto-generate-sql
</code></pre> 
<p>（2）运行结果如下（注意结果是完成 <strong>1000</strong> 次查询的总时间）：</p> 
<p><a href="https://www.hangge.com/blog/cache/detail_3068.html#" rel="nofollow"><img src="https://images2.imgbox.com/ec/0d/9YNTTPEE_o.png" alt="原文:mysqlslap - MySQL自带的数据库压力测试工具使用详解（附样例）"></a></p> 
<h4><a id="5_55"></a>5，重复的次数</h4> 
<p>（1）使用 <strong>–iterations</strong> 参数可以设置迭代执行的次数，即重复的次数（相同的测试进行 <strong>N</strong> 次，求一个平均值）。该次数指的是整个步骤的重复次数，包括准备数据、测试 <strong>load</strong>、清理。</p> 
<pre><code class="prism language-shell">mysqlslap -uroot -pHangge_123 --iterations<span class="token operator">=</span><span class="token number">3</span> --concurrency<span class="token operator">=</span><span class="token number">100</span> --number-of-queries<span class="token operator">=</span><span class="token number">1000</span> --auto-generate-sql
</code></pre> 
<p>（2）执行结果如下（注意结果是完成 <strong>1000</strong> 次查询的总时间）：</p> 
<p><a href="https://www.hangge.com/blog/cache/detail_3068.html#" rel="nofollow"><img src="https://images2.imgbox.com/5b/8a/rAvkT4Ak_o.png" alt="原文:mysqlslap - MySQL自带的数据库压力测试工具使用详解（附样例）"></a></p> 
<h4><a id="6_68"></a>6，自动生成复杂表</h4> 
<p>（1）自动测试时，创建的表结构非常简单，只有两列，实际的产品环境肯定会更复杂，我们可以使用参数指定测试表的列的数量和类型：</p> 
<ul><li><strong>–number-int-cols=5</strong>：指定生成 <strong>5</strong> 个 <strong>int</strong> 类型的列</li><li><strong>–number-char-cols=20</strong>：指定生成 <strong>20</strong> 个 <strong>char</strong> 类型的列</li></ul> 
<pre><code class="prism language-shell">mysqlslap -uroot -pHangge_123 --number-int-cols<span class="token operator">=</span><span class="token number">5</span> --number-char-cols<span class="token operator">=</span><span class="token number">20</span> --auto-generate-sql
</code></pre> 
<p>（2）执行结果如下：</p> 
<p><a href="https://www.hangge.com/blog/cache/detail_3068.html#" rel="nofollow"><img src="https://images2.imgbox.com/6e/3a/UBnDrGZF_o.png" alt="原文:mysqlslap - MySQL自带的数据库压力测试工具使用详解（附样例）"></a></p> 
<h4><a id="7_84"></a>7，使用自己的测试库和测试语句</h4> 
<p>（1）自动测试可以帮助我们了解硬件层面的状况，我们也可以对指定的产品库进行测试：</p> 
<ul><li><strong>–create-schema=hangge</strong>：指定的测试库是 <strong>hangge</strong>（测试完毕不会自动删除）</li><li><strong>–query=“SELECT * FROM people;”</strong>：使用自定义的测试语句</li></ul> 
<pre><code class="prism language-shell">mysqlslap -uroot -pHangge_123 --concurrency<span class="token operator">=</span><span class="token number">10</span> --number-of-queries<span class="token operator">=</span><span class="token number">100</span> --create-schema<span class="token operator">=</span>hangge --query<span class="token operator">=</span>``<span class="token string">"SELECT * FROM people"</span>
</code></pre> 
<p>（2）自定义的测试语句可以同时写多条：</p> 
<pre><code class="prism language-shell">mysqlslap -uroot -pHangge_123 --concurrency<span class="token operator">=</span><span class="token number">10</span> --number-of-queries<span class="token operator">=</span><span class="token number">100</span> --create-schema<span class="token operator">=</span>hangge --query<span class="token operator">=</span>``<span class="token string">"SELECT * FROM people;SELECT AVG(age) FROM people"</span>
</code></pre> 
<p>（3）如果测试多个复杂的语句，我们也可以先把多个查询语句写入了一个 <strong>sql</strong> 文件中，然后使用此文件执行测试：</p> 
<ul><li><strong>–query=“select_query.sql”</strong>：指定了测试文件是 <strong>select_query.sql</strong></li><li><strong>–delimiter=“;”</strong>：指定 <strong>sql</strong> 文件中语句间的分隔符是;</li></ul> 
<pre><code class="prism language-shell">mysqlslap -uroot -pHangge_123 --concurrency<span class="token operator">=</span><span class="token number">10</span> --number-of-queries<span class="token operator">=</span><span class="token number">100</span> --create-schema<span class="token operator">=</span>hangge --query<span class="token operator">=</span>`<span class="token variable"><span class="token variable">`</span>"select_query.sql"<span class="token variable">`</span></span> <span class="token variable"><span class="token variable">`</span>--delimiter<span class="token operator">=</span><span class="token variable">`</span></span>`<span class="token string">";"</span>
</code></pre> 
<h5><a id="unknown_variable_defaultcharactersetutf8_112"></a>附一：解决“unknown variable ‘default-character-set=utf8’”错误</h5> 
<p>（1）如果我们执行 <strong>mysqlslap</strong> 命令时报如下错误：</p> 
<p><a href="https://www.hangge.com/blog/cache/detail_3068.html#" rel="nofollow"><img src="https://images2.imgbox.com/d4/ba/lpzhgG8P_o.png" alt="原文:mysqlslap - MySQL自带的数据库压力测试工具使用详解（附样例）"></a></p> 
<p>（2）解决办法有两种。一种是编辑 <strong>MySQL</strong> 配置文件 <strong>/etc/my.cnf</strong>，将里面如下配置注释掉：</p> 
<pre><code class="prism language-shell">default-character-set<span class="token operator">=</span>utf8
</code></pre> 
<p>（3）或者我们可以在命令中添加 <strong>–no-defaults</strong> 参数（该参数必须放在第一位），使得本次命令不读取默认配置参数：</p> 
<p><a href="https://www.hangge.com/blog/cache/detail_3068.html#" rel="nofollow"><img src="https://images2.imgbox.com/9c/87/vhvOLQ4J_o.png" alt="原文:mysqlslap - MySQL自带的数据库压力测试工具使用详解（附样例）"></a></p> 
<h5><a id="_129"></a>附二：快速生成大量测试数据</h5> 
<p>使用 <strong>mysqlslap</strong> 也可以在数据库中构建大量的基础数据（比如千万级别数据）进行查询操作的性能测试或者 <strong>sql</strong> 优化，具体操作可以参考我写的另一篇文章：</p> 
<ul><li><a href="https://www.hangge.com/blog/cache/detail_3071.html" rel="nofollow">MySQL - 快速生成大量测试数据方法（无需编写代码、或存储过程）</a></li></ul> 
<hr> 
<p>原文出自：<a href="https://www.hangge.com/" rel="nofollow">www.hangge.com</a> 转载请保留原文链接：https://www.hangge.com/blog/cache/detail_3068.html</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/97c98f79ef8acef41e25b3f61e41468d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">IO与进程</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9c38a2a0a31f6c8821481b4e9f6d9ecf/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">java毕业设计——基于JSP&#43;sqlserver的网络超市商品销售管理系统设计与实现（毕业论文&#43;程序源码）——商品销售管理系统</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>