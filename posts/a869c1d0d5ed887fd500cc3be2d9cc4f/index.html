<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Spring Boot 整合 Sharding-JDBC - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Spring Boot 整合 Sharding-JDBC" />
<meta property="og:description" content="概述 ShardingSphere，它由Sharding-JDBC、Sharding-Proxy和Sharding-Sidecar（计划中）这3款相互独立的产品组成。定位为轻量级Java框架。其实就是一个增强版的JDBC驱动，完全兼容JDBC和各种ORM框架。内部改写了SQL的添加和查询规则。适用于任何基于Java的ORM框架，如：JPA, Hibernate, Mybatis, Spring JDBC Template或直接使用JDBC。
技术架构： Spring Boot 2.6.3 、 Sharding-JDBC 3.0.0.M3、MySql 1主2从模式、 JDK1.8
导入依赖 &lt;!-- for spring boot --&gt; &lt;dependency&gt; &lt;groupId&gt;io.shardingsphere&lt;/groupId&gt; &lt;artifactId&gt;sharding-jdbc-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;${sharding-sphere.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!-- mybatis --&gt; &lt;dependency&gt; &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt; &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;1.3.2&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;druid&lt;/artifactId&gt; &lt;version&gt;1.1.21&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;version&gt;5.1.41&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;version&gt;1.18.4&lt;/version&gt; &lt;/dependency&gt; application.yml配置
#sharding-jdbc sharding.jdbc: datasource: names: ds-master,ds-slave-0,ds-slave-1 ds-master: type: com.alibaba.druid.pool.DruidDataSource driver-class-name: com.mysql.jdbc.Driver url: jdbc:mysql://192.168.116.105:3306/test-01 username: root password: root ds-slave-0: type: com." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/a869c1d0d5ed887fd500cc3be2d9cc4f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-03-05T20:58:23+08:00" />
<meta property="article:modified_time" content="2022-03-05T20:58:23+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Spring Boot 整合 Sharding-JDBC</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h3>概述</h3> 
<p>        ShardingSphere，它由Sharding-JDBC、Sharding-Proxy和Sharding-Sidecar（计划中）这3款相互独立的产品组成。定位为轻量级Java框架。其实就是一个增强版的JDBC驱动，完全兼容JDBC和各种ORM框架。内部改写了SQL的添加和查询规则。适用于任何基于Java的ORM框架，如：JPA, Hibernate, Mybatis, Spring JDBC Template或直接使用JDBC。</p> 
<h3>技术架构：</h3> 
<p>Spring Boot 2.6.3 、 Sharding-JDBC 3.0.0.M3、MySql 1主2从模式、 JDK1.8</p> 
<h3><strong>导入依赖</strong></h3> 
<pre><code>        &lt;!-- for spring boot --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;io.shardingsphere&lt;/groupId&gt;
            &lt;artifactId&gt;sharding-jdbc-spring-boot-starter&lt;/artifactId&gt;
            &lt;version&gt;${sharding-sphere.version}&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;!-- mybatis --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt;
            &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt;
            &lt;version&gt;1.3.2&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba&lt;/groupId&gt;
            &lt;artifactId&gt;druid&lt;/artifactId&gt;
            &lt;version&gt;1.1.21&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;mysql&lt;/groupId&gt;
            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
            &lt;version&gt;5.1.41&lt;/version&gt;
        &lt;/dependency&gt;

       &lt;dependency&gt;
            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
            &lt;artifactId&gt;lombok&lt;/artifactId&gt;
            &lt;version&gt;1.18.4&lt;/version&gt;
        &lt;/dependency&gt;</code></pre> 
<p><strong>application.yml配置</strong></p> 
<pre><code>#sharding-jdbc
sharding.jdbc:
  datasource:
    names: ds-master,ds-slave-0,ds-slave-1
    ds-master:
      type: com.alibaba.druid.pool.DruidDataSource
      driver-class-name: com.mysql.jdbc.Driver
      url: jdbc:mysql://192.168.116.105:3306/test-01
      username: root
      password: root
    ds-slave-0:
      type: com.alibaba.druid.pool.DruidDataSource
      driver-class-name: com.mysql.jdbc.Driver
      url: jdbc:mysql://192.168.116.106:3306/test-01
      username: root
      password: root
    ds-slave-1:
      type: com.alibaba.druid.pool.DruidDataSource
      driver-class-name: com.mysql.jdbc.Driver
      url: jdbc:mysql://192.168.116.107:3306/test-01
      username: root
      password: root
  config:
    masterslave:
      name: ds_ms
      master-data-source-name: ds-master
      slave-data-source-names: ds-slave-0,ds-slave-1
      load-balance-algorithm-type: round_robin
  props:
    sql.show: true
#mybatis
mybatis:
  config-location: classpath:mybatis/config.xml
  mapper-locations:
    - classpath:mybatis/mappers/*.xml</code></pre> 
<p></p> 
<p><strong>MySql数据表结构</strong></p> 
<pre><code>CREATE TABLE `user` (
  `id` int(255) NOT NULL AUTO_INCREMENT,
  `name` varchar(255) CHARACTER SET utf8 DEFAULT NULL,
  `age` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=10158 DEFAULT CHARSET=latin1;</code></pre> 
<p><strong>实体类</strong></p> 
<pre><code>package com.example.producers.domain;

import lombok.Data;

import java.io.Serializable;

/**
 * @author lanx
 * @date 2022/2/21
 */
@Data
public class User  implements Serializable {
    private  Integer id;
    private  String name;
    private  Integer age;
}
</code></pre> 
<p><strong>Dao层</strong></p> 
<pre><code>package com.example.producers.dao;

import com.example.producers.domain.User;
import org.apache.ibatis.annotations.Mapper;

/**
 * @author lanx
 * @date 2022/2/21
 */
@Mapper
public interface UserMapper {
    User selectByPrimaryKey(int id);
}</code></pre> 
<p><strong>UserMapper.xml</strong></p> 
<pre><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;
&lt;mapper namespace="com.example.producers.dao.UserMapper"&gt;
    &lt;resultMap id="BaseResultMap" type="com.example.producers.domain.User"&gt;
        &lt;id column="id" jdbcType="INTEGER" property="id" /&gt;
        &lt;result column="name" jdbcType="INTEGER" property="name" /&gt;
        &lt;result column="age" jdbcType="INTEGER" property="age" /&gt;
    &lt;/resultMap&gt;
    &lt;sql id="Base_Column_List"&gt;
        id, name, age
    &lt;/sql&gt;
    &lt;select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap"&gt;
        select
        &lt;include refid="Base_Column_List" /&gt;
        from user
        where id = #{id,jdbcType=INTEGER}
    &lt;/select&gt;
&lt;/mapper&gt;

</code></pre> 
<pre><strong>UserController 测试接口</strong>
</pre> 
<pre><code>package com.example.producers.web;

import com.example.producers.dao.UserMapper;
import com.example.producers.domain.User;
import com.example.producers.service.UserService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

/**
 * 用户管理
 * @author lanx
 * @date 2022/3/5
 */
@RestController
public class UserController {

    @Autowired
    private UserMapper userMapper;

    @RequestMapping("/getUser")
    public User getUser(@RequestParam("id")int id){
        User user =  userMapper.selectByPrimaryKey(id);
        return user;
    }
}
</code></pre> 
<p><strong>接口调用</strong></p> 
<p><img alt="" height="556" src="https://images2.imgbox.com/f5/4d/qSS7Woq4_o.png" width="1200"></p> 
<p></p> 
<p><strong>如果在整合过程中出现如下错误：</strong></p> 
<p>Configuration property name 'sharding.jdbc.datasource.ds_master' is not vali</p> 
<p><strong>报错原因</strong><br> ShardingSphere 在5.0以前的版本数据源的命名、自定义分片算法命名是支持下划线命名的，如 write_ds，但是在5.0以后就不支持了。</p> 
<p><strong>解决方法</strong><br> 多个单词之间不要使用"_"分割，使用 ”-“ 分割即可，如 ds-master</p> 
<p> </p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5ff297b7cf1755734171111669d8e923/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">SpringBoot定时任务</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4c7a0746a6b7ba71f85f0579f4a1bf84/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">mybatis plus框架的@TableField注解不生效问题总结</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>