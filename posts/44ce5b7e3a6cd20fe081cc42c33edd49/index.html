<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>QT实现USB摄像头接入显示 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="QT实现USB摄像头接入显示" />
<meta property="og:description" content="一、UVC协议简介
UVC全称是USB Video Class（USB视频类），是一种标准化的USB视频设备通信协议，它定义了摄像头与主机之间的数据传输协议和格式。
UVC协议的出现，解决了摄像头厂商之间互不兼容，以及摄像头应用开发与平台之间的散乱问题。
UVC标准是由USB-IF主导制定的，目前最新的版本是UVC 1.5，UVC的缺省设置类容易实现，不需要额外的驱动程序。
二、UVC协议不同版本对比
UVC协议的出现在2001年，目前已经发布了几个版本的标准协议：
| UVC版本 | 发布时间 | 支持最高分辨率 | 区别
UVC 1.0 | 2005年 | 800 x 600 | 第一个稳定版本
UVC 1.1 | 2008年 | 1920 x 1080 | 增加了更高分辨率的支持
UVC 1.5 | 2015年 | 4096 x 2304 | 增加了更高分辨率和HDR支持
从发布的时间、分辨率支持、HDR支持等角度来看，可以看出UVC协议在不断地演进和改进。
三.UVC协议的由来
UVC协议是早期微软(Microsoft)与另外几家主要设备厂商联合推出的为USB视频捕获设备定义的协议标准，目前是USBorg标准之一;USB摄像头即为标准的视频捕获设备。
四.支持的系统平台
Windows:自Windows XP SP2之后的版本都支持。
苹果Mac:Mac osX的10.4.3版本起加入UVC driver。
Linux:自Linux2.46之后增加了大量驱动到内核中，支持了UVC设备
PS3游戏主机: PlayStation 3在1.54版本开始支持UVC兼容
基于Linux内核的其它开源系统: 如派(Raspbian OS)乌图(Ubuntu)等，均使用Linux内核中的V4L2Videofor linux 2)来驱动USB摄像头。
五.QT实现接入USB摄像头
1.测试环境
摄像头：笔记本自带摄像头" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/44ce5b7e3a6cd20fe081cc42c33edd49/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-27T11:37:17+08:00" />
<meta property="article:modified_time" content="2024-01-27T11:37:17+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">QT实现USB摄像头接入显示</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="margin-left:.0001pt;text-align:justify;"><strong>一、UVC协议简介</strong></p> 
<p style="margin-left:.0001pt;text-align:justify;">UVC全称是USB Video Class（USB视频类），是一种标准化的USB视频设备通信协议，它定义了摄像头与主机之间的数据传输协议和格式。</p> 
<p style="margin-left:.0001pt;text-align:justify;">UVC协议的出现，解决了摄像头厂商之间互不兼容，以及摄像头应用开发与平台之间的散乱问题。</p> 
<p style="margin-left:.0001pt;text-align:justify;">UVC标准是由USB-IF主导制定的，目前最新的版本是UVC 1.5，UVC的缺省设置类容易实现，不需要额外的驱动程序。</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong>二、UVC协议不同版本对比</strong></p> 
<p style="margin-left:.0001pt;text-align:justify;">UVC协议的出现在2001年，目前已经发布了几个版本的标准协议：</p> 
<p style="margin-left:.0001pt;text-align:justify;">| UVC版本 | 发布时间 | 支持最高分辨率 | 区别</p> 
<p style="margin-left:.0001pt;text-align:justify;">UVC 1.0 | 2005年 | 800 x 600 | 第一个稳定版本</p> 
<p style="margin-left:.0001pt;text-align:justify;">UVC 1.1 | 2008年 | 1920 x 1080 | 增加了更高分辨率的支持</p> 
<p style="margin-left:.0001pt;text-align:justify;">UVC 1.5 | 2015年 | 4096 x 2304 | 增加了更高分辨率和HDR支持</p> 
<p style="margin-left:.0001pt;text-align:justify;">从发布的时间、分辨率支持、HDR支持等角度来看，可以看出UVC协议在不断地演进和改进。</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong>三.UVC协议的由来</strong></p> 
<p style="margin-left:.0001pt;text-align:justify;">UVC协议是早期微软(Microsoft)与另外几家主要设备厂商联合推出的为USB视频捕获设备定义的协议标准，目前是USBorg标准之一;USB摄像头即为标准的视频捕获设备。</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong>四.支持的系统平台</strong></p> 
<p style="margin-left:.0001pt;text-align:justify;">Windows:自Windows XP SP2之后的版本都支持。</p> 
<p style="margin-left:.0001pt;text-align:justify;">苹果Mac:Mac osX的10.4.3版本起加入UVC driver。</p> 
<p style="margin-left:.0001pt;text-align:justify;">Linux:自Linux2.46之后增加了大量驱动到内核中，支持了UVC设备</p> 
<p style="margin-left:.0001pt;text-align:justify;">PS3游戏主机: PlayStation 3在1.54版本开始支持UVC兼容</p> 
<p style="margin-left:.0001pt;text-align:justify;">基于Linux内核的其它开源系统: 如派(Raspbian OS)乌图(Ubuntu)等，均使用Linux内核中的V4L2Videofor linux 2)来驱动USB摄像头。</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="text-align:justify;"><strong>五.QT实现接入USB摄像头</strong></p> 
<p style="text-align:justify;">1.测试环境</p> 
<p style="margin-left:.0001pt;text-align:justify;">   摄像头：笔记本自带摄像头</p> 
<p style="margin-left:.0001pt;text-align:justify;">   QT环境：QT6.1</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="text-align:justify;">2.代码示例</p> 
<p style="text-align:justify;">（1）mainwindow.h</p> 
<p style="margin-left:.0001pt;text-align:justify;">#ifndef MAINWINDOW_H</p> 
<p style="margin-left:.0001pt;text-align:justify;">#define MAINWINDOW_H</p> 
<p style="margin-left:.0001pt;text-align:justify;">#include &lt;QMainWindow&gt;</p> 
<p style="margin-left:.0001pt;text-align:justify;">#include &lt;QImageCapture&gt;</p> 
<p style="margin-left:.0001pt;text-align:justify;">QT_BEGIN_NAMESPACE</p> 
<p style="margin-left:.0001pt;text-align:justify;">namespace Ui { class MainWindow; }</p> 
<p style="margin-left:.0001pt;text-align:justify;">QT_END_NAMESPACE</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">class MainWindow : public QMainWindow</p> 
<p style="margin-left:.0001pt;text-align:justify;">{<!-- --></p> 
<p style="margin-left:.0001pt;text-align:justify;">    Q_OBJECT</p> 
<p style="margin-left:.0001pt;text-align:justify;">public:</p> 
<p style="margin-left:.0001pt;text-align:justify;">    MainWindow(QWidget *parent = nullptr);</p> 
<p style="margin-left:.0001pt;text-align:justify;">    ~MainWindow();</p> 
<p style="margin-left:.0001pt;text-align:justify;">private slots:</p> 
<p style="margin-left:.0001pt;text-align:justify;">    void on_pushButton_clicked();</p> 
<p style="margin-left:.0001pt;text-align:justify;">private:</p> 
<p style="margin-left:.0001pt;text-align:justify;">    void do_image_saved(int id, const QString &amp;fileName);</p> 
<p style="margin-left:.0001pt;text-align:justify;">    void do_image_readyForCapture(bool ready);</p> 
<p style="margin-left:.0001pt;text-align:justify;">    void do_image_captured(int id, const QImage &amp;preview);</p> 
<p style="margin-left:.0001pt;text-align:justify;">    Ui::MainWindow *ui;</p> 
<p style="margin-left:.0001pt;text-align:justify;">    QImageCapture *imageCapture;</p> 
<p style="margin-left:.0001pt;text-align:justify;">};</p> 
<p style="margin-left:.0001pt;text-align:justify;">#endif // MAINWINDOW_H</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="text-align:justify;">（2）mainwindow.cpp</p> 
<p style="margin-left:.0001pt;text-align:justify;">#include "mainwindow.h"</p> 
<p style="margin-left:.0001pt;text-align:justify;">#include "ui_mainwindow.h"</p> 
<p style="margin-left:.0001pt;text-align:justify;">#include &lt;QCameraDevice&gt;</p> 
<p style="margin-left:.0001pt;text-align:justify;">#include &lt;QMediaDevices&gt;</p> 
<p style="margin-left:.0001pt;text-align:justify;">#include &lt;QMediaCaptureSession&gt;</p> 
<p style="margin-left:.0001pt;text-align:justify;">#include &lt;QVideoWidget&gt;</p> 
<p style="margin-left:.0001pt;text-align:justify;">#include &lt;QVideoSink&gt;</p> 
<p style="margin-left:.0001pt;text-align:justify;">#include &lt;QtMultimedia&gt;</p> 
<p style="margin-left:.0001pt;text-align:justify;">#include &lt;QImageCapture&gt;</p> 
<p style="margin-left:.0001pt;text-align:justify;">#include &lt;QDebug&gt;</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">MainWindow::MainWindow(QWidget *parent)</p> 
<p style="margin-left:.0001pt;text-align:justify;">    : QMainWindow(parent)</p> 
<p style="margin-left:.0001pt;text-align:justify;">    , ui(new Ui::MainWindow)</p> 
<p style="margin-left:.0001pt;text-align:justify;">{<!-- --></p> 
<p style="margin-left:.0001pt;text-align:justify;">    ui-&gt;setupUi(this);</p> 
<p style="margin-left:.0001pt;text-align:justify;">    QCameraDevice  defaultCameraDevice= QMediaDevices::defaultVideoInput();</p> 
<p style="margin-left:.0001pt;text-align:justify;">    if (defaultCameraDevice.isNull())</p> 
<p style="margin-left:.0001pt;text-align:justify;">    {<!-- --></p> 
<p style="margin-left:.0001pt;text-align:justify;">        return;</p> 
<p style="margin-left:.0001pt;text-align:justify;">    }</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">    QCamera *m_camera = new QCamera(this);        //摄像头</p> 
<p style="margin-left:.0001pt;text-align:justify;">    QMediaCaptureSession *captureSession = new QMediaCaptureSession(this);</p> 
<p style="margin-left:.0001pt;text-align:justify;">    imageCapture = new QImageCapture(this);</p> 
<p style="margin-left:.0001pt;text-align:justify;">    m_camera-&gt;setCameraDevice(defaultCameraDevice);</p> 
<p style="margin-left:.0001pt;text-align:justify;">    captureSession-&gt;setImageCapture(imageCapture);</p> 
<p style="margin-left:.0001pt;text-align:justify;">    captureSession-&gt;setCamera(m_camera);        //为session设置摄像</p> 
<p style="margin-left:.0001pt;text-align:justify;">    captureSession-&gt;setVideoOutput(ui-&gt;widgetV);</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">    connect(imageCapture,&amp;QImageCapture::imageCaptured,</p> 
<p style="margin-left:.0001pt;text-align:justify;">            this,&amp;MainWindow::do_image_captured);</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">    m_camera-&gt;start();</p> 
<p style="margin-left:.0001pt;text-align:justify;">}</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">MainWindow::~MainWindow()</p> 
<p style="margin-left:.0001pt;text-align:justify;">{<!-- --></p> 
<p style="margin-left:.0001pt;text-align:justify;">    delete ui;</p> 
<p style="margin-left:.0001pt;text-align:justify;">}</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">void MainWindow::on_pushButton_clicked()</p> 
<p style="margin-left:.0001pt;text-align:justify;">{<!-- --></p> 
<p style="margin-left:.0001pt;text-align:justify;">    QDir dir;</p> 
<p style="margin-left:.0001pt;text-align:justify;">    //没有photograph文件夹则创建</p> 
<p style="margin-left:.0001pt;text-align:justify;">    if(dir.exists("./photograph") == false)</p> 
<p style="margin-left:.0001pt;text-align:justify;">    {<!-- --></p> 
<p style="margin-left:.0001pt;text-align:justify;">        dir.mkpath("./photograph");</p> 
<p style="margin-left:.0001pt;text-align:justify;">    }</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">    //使用系统时间来命名图片的名称，时间是唯一的，图片名也是唯一的</p> 
<p style="margin-left:.0001pt;text-align:justify;">    QDateTime dateTime(QDateTime::currentDateTime());</p> 
<p style="margin-left:.0001pt;text-align:justify;">    QString time = dateTime.toString("yyyy-MM-dd-hh-mm-ss");</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">    //创建图片保存路径名</p> 
<p style="margin-left:.0001pt;text-align:justify;">    QString filename = QDir::currentPath();     //获得当前路径</p> 
<p style="margin-left:.0001pt;text-align:justify;">    filename += "/photograph/photo_";</p> 
<p style="margin-left:.0001pt;text-align:justify;">    filename += QString("%1.jpg").arg(time);</p> 
<p style="margin-left:.0001pt;text-align:justify;">   // imageCapture-&gt;capture();        //拍照，不存储，会显示到label里面</p> 
<p style="margin-left:.0001pt;text-align:justify;">    imageCapture-&gt;captureToFile(filename);      //截图存储到文件夹内</p> 
<p style="margin-left:.0001pt;text-align:justify;">}</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">void MainWindow::do_image_captured(int id, const QImage &amp;preview)</p> 
<p style="margin-left:.0001pt;text-align:justify;">{//与 imageCaptured()信号关联</p> 
<p style="margin-left:.0001pt;text-align:justify;">    QImage scaledImage = preview.scaledToWidth(ui-&gt;widgetV-&gt;width());</p> 
<p style="margin-left:.0001pt;text-align:justify;">    ui-&gt;label-&gt;setPixmap(QPixmap::fromImage(scaledImage));</p> 
<p style="margin-left:.0001pt;text-align:justify;">}</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="text-align:justify;">3.测试结果</p> 
<p style="margin-left:.0001pt;text-align:justify;">（1）视频显示</p> 
<p><img alt="" height="340" src="https://images2.imgbox.com/c6/05/Mmk5rZA5_o.png" width="626"></p> 
<p style="margin-left:.0001pt;text-align:justify;">（2）视频+抓拍截图显示</p> 
<p><img alt="" height="342" src="https://images2.imgbox.com/89/32/l5rxsPU5_o.png" width="625"></p> 
<p style="text-align:justify;">（3）抓拍截图存储到文件夹内</p> 
<p><img alt="" height="221" src="https://images2.imgbox.com/f2/51/7RRsTYWp_o.png" width="691"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="text-align:justify;">4.完整工程代码下载：</p> 
<p style="margin-left:.0001pt;text-align:justify;">https://download.csdn.net/download/xieliru/88712985?spm=1001.2014.3001.5503</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/8161f20077dc7a3b4475d98ff1108ab5/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">C语言——操作符详解2</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/efd41c962d196e2b5fc1911063059b83/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">SpringBoot注解@GetMapping处理Get请求</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>