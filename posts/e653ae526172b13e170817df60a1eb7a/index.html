<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ffmpeg 学习笔记 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="ffmpeg 学习笔记" />
<meta property="og:description" content="ffmpeg 学习笔记 ffmpeg 的名称来自于 MPEG 视频编码标准，其中 ff 表示 Fast Forward，这是一套用于记录、转换数字音频、视频，并能将其转化为流的开源程序。可以轻松地实现多种视频格式之间的相关转换。
ffmpeg 是一个终端的工具，其功能比较强大，许多网站都使用它，例如Google，Facebook，Youtube，优酷，爱奇艺，土豆等。
把一个 .flac 音频转换成 .mp3 格式 ffmpeg -i in.flac -acodec libmp3lame -ar 44100 -ab 320k -ac 2 out.mp3
-acodec : 音频编码器，libmp3lame 表示 MP3 的编码。
-ar 44100 : 设置音频采样率的，
-ab 320k : 指定音频的比特率，默认是128k。
-ac 2 : 设置输出声道的。
把 .webm 格式压缩成指定大小的 .mp4 格式 ffmpeg -i in.webm -s 1920x1080 -pix_fmt yuv420p -vcodec libx264 -preset medium -profile:v high -level:v 4.1 -crf 23 -acodec aac -ar 44100 -ac 2 -b:a 128k out." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/e653ae526172b13e170817df60a1eb7a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-22T10:37:32+08:00" />
<meta property="article:modified_time" content="2023-02-22T10:37:32+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ffmpeg 学习笔记</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night-eighties">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="ffmpeg__0"></a>ffmpeg 学习笔记</h2> 
<p>ffmpeg 的名称来自于 MPEG 视频编码标准，其中 ff 表示 Fast Forward，这是一套用于记录、转换数字音频、视频，并能将其转化为流的开源程序。可以轻松地实现多种视频格式之间的相关转换。</p> 
<p>ffmpeg 是一个终端的工具，其功能比较强大，许多网站都使用它，例如Google，Facebook，Youtube，优酷，爱奇艺，土豆等。</p> 
<h4><a id="_flac__mp3__6"></a>把一个 .flac 音频转换成 .mp3 格式</h4> 
<p>ffmpeg -i in.flac -acodec libmp3lame -ar 44100 -ab 320k -ac 2 out.mp3<br> -acodec : 音频编码器，libmp3lame 表示 MP3 的编码。<br> -ar 44100 : 设置音频采样率的，<br> -ab 320k : 指定音频的比特率，默认是128k。<br> -ac 2 : 设置输出声道的。</p> 
<h4><a id="_webm__mp4__14"></a>把 .webm 格式压缩成指定大小的 .mp4 格式</h4> 
<p>ffmpeg -i in.webm -s 1920x1080 -pix_fmt yuv420p -vcodec libx264 -preset medium -profile:v high -level:v 4.1 -crf 23 -acodec aac -ar 44100 -ac 2 -b:a 128k out.mp4</p> 
<p>参数说明：<br> 一般视频网站采用的是：</p> 
<ul><li>MP4 封装：H264 视频编码 + AAC 音频编码。</li><li>WebM 封装：VP8 视频编码 + Vorbis 音频编码，这个谷歌的方案不太好，youtube就是视频这个封装的。</li><li>OGG 封装：Theora 视频编码 + Vorbis 音频编码，这个完全开源的编码方案，比较好。</li></ul> 
<p>-i: 表示后面是数据的文件<br> -s: 表示视频的宽和高，1080p、720p等<br> -pix_fmt: pixxel format, 用于设置视频颜色空间的，yuv420p 网络视频基本采用这个值，可以使用 <code>ffmpeg -pix_fmts</code> 获取有哪些格式可以使用。<br> -vcodec: 表示使用那种视频编码，libx264 表示采用 H264 编码<br> -preset: 采用那种预设，有十种可选：ultrafast, superfast, veryfast, faster, fast, medium, slow, slower, veryslow, placebo。一般在录制视频时，采用veryfast，这样速度较快，对cpu占用较小，但是体积比较大。压缩视频时采用 veryslow。<br> -profile:v : 这是指定编码器的设置。可以取值有：Baseline, Extended, Main, High, High 10, High 4:2:2, High 4:4:4 Predictive。越前面的取值，体积越小。<br> -level:v 4.1 : 一般1080p的视频取值 4.1就好。其取值范围为：1-5.1。<br> -crf 23 : Constant Rate Factor, 用于控制 码率控制模式的。其取值：0…18…23…28…51，默认值是23，值越小质量越好，0 表示无损，一般我们在 18~28 之间取值。<br> -acodec : 设置音频编码方式。<br> -ar<br> -ac 2 : 表示声道为2。<br> -b:a 128k : 音频比特率的。</p> 
<p>-r 30 : 这是用于设置视频帧率的。</p> 
<h4><a id="_39"></a>视频清晰度设置</h4> 
<p>一般而言，码率越高，视频清晰度越高，该软件采用以下三种控制方式<br> -qp ：Constant Quantizer 恒定量化器模式，设置视频的质量，其取值：0…20…40…51，0 表示无损级别。<br> 无损压缩的示例（快速编码）<br> ffmpeg -i input -vcodec libx264 -preset ultrafast -qp 0 output.mkv</p> 
<pre><code>无损压缩的示例（高压缩比）
ffmpeg -i input -vcodec libx264 -preset veryslow -qp 0 output.mkv
</code></pre> 
<p>-crf Constant Rate Factor：恒定速率因子模式。这个比较好，会自动在人眼看不出的位置降低一些，而在需要的地方增强一些。<br> -b bitrate：固定目标码率模式。码率和体积都可以是确定的。</p> 
<p>VBR Variable Bit Rate 动态比特率。<br> VBR 的示例<br> ffmpeg -i input -vcodec libx264 -preset veryslow output</p> 
<p>ABR Average Bit Rate 平均比特率。<br> ABR 的示例<br> ffmpeg -i input -vcodec libx264 -preset veryslow -b:v 3000k output</p> 
<p>CBR Constant Bit Rate 恒定比特率。这种方式没有人会使用的。<br> CBR的示例<br> … -b:v 4000k -minrate 4000k -maxrate 4000k -bufsize 1835k …</p> 
<h4><a id="_63"></a>过滤器的使用</h4> 
<p>过滤器可以对视频进行大小缩放，然后裁剪、旋转图像等。可以使用一系列的过滤器，一个接着一个。</p> 
<p>这里我们使用参数 -vf (video filter) 来指定一个过滤器。如果想要修改视频的尺寸，可以使用 scale 后面输入缩放的长度和宽度，中间使用冒号分隔。也可以使用这样的参数 “scale=1024:-1”，让ffmpeg 根据另一个参数帮助自动推算。例如，想要转换成 720p ，可以使用 “scale=-1:720”。</p> 
<p>如果想要旋转方向，可以使用 -vf “transpose=2”，其中数字 2 代表不同的旋转方向，便是将视频 90 度逆时针旋转。</p> 
<p>不同的过滤器可以组合使用，例如，-vf “scale=256:256,transpose=1”。</p> 
<p>想要裁剪可以使用，-vf “crop=400:400💯100”，这里的参数表示为：crop=w:h❌y。表示视频的宽和高，及左上角的坐标位置。也可以使用表达式，例如，crop=iw/3:ih/3，表示使用原始宽高的三分之一。</p> 
<p>ffmpeg -i in.avi -c:v libx264 -vf “scale=1024:576” output.mp4</p> 
<h4><a id="_77"></a>合并多个视频文件</h4> 
<p>可以现在编辑一个文件，例如<br> vim mylist.txt<br> file ‘clip1.mp4’<br> file ‘clip2.mp4’<br> file ‘clip3.mp4’</p> 
<p>然后使用以下命令<br> ffmpeg -f concat -i mylist.txt -c copy output.mp4</p> 
<h4><a id="_88"></a>音频过滤器</h4> 
<p>ffmpeg -i in.mp4 -af “volume=1.5” out.mp4</p> 
<p>其中 af audio filter, volume 表示音量的大小。</p> 
<h4><a id="_94"></a>提取视频中的视频或音频部分</h4> 
<p>示例：<br> 我们有一个 mp4 格式的视频，想要提取出来视频的话，可以这样操作：<br> 第一步：<br> ffprobe in.mp4<br> 用于查看原始的音频和视频的编码等信息</p> 
<p>第二步：<br> ffmpeg -i in.mp4 -vcodec copy -an v.mp4<br> 其中：-an 表示不要音频</p> 
<p>当然，如果只想要音频<br> ffmpeg -i in.mp4 -vn -vcodec copy a.m4a</p> 
<h4><a id="_109"></a>提取音频中部分</h4> 
<p>我们一个音频 mp3 格式的，想要获取其中的部分音频用于手机铃声，可以使用<br> ffmpeg -i in.mp3 -ss 00:01:00 -to 00:01:10 -acodec copy out.mp3<br> ffmpeg -i in.mp3 -ss 00:01:00 -t 10 -acodec copy out.mp3</p> 
<p>-sseof: 流体的末尾，-t 10 表示时间为10秒。</p> 
<p>以下三条命令有何不同：<br> ffmpeg -i in.mp4 -ss 00:01:00 -to 00:01:10 -c copy out.mp4<br> ffmpeg --ss 00:01:00 i in.mp4 -to 00:01:10 -c copy out.mp4<br> ffmpeg --ss 00:01:00 i in.mp4 -to 00:01:10 -c copy -copyts out.mp4</p> 
<p>第二条命令会启用关键帧技术，会加速操作，但是起始时间和结束时间可能不正确。因此需要使用第三条命令。</p> 
<p>其中 -copyts 用于保留时间戳的，这样显示的时间就对了。</p> 
<h4><a id="_126"></a>连接具有同样音视频编码的视频</h4> 
<p>ffmpeg -i “concat:01.mp4|02.mp4|03.mp4” -c copy out.mp4</p> 
<p>如果其中的格式不同，建议使用 Avidemux 软件。这也是开源免费的，基于 ffmpeg ，更有针对性。</p> 
<h4><a id="_132"></a>截取视频的某个视频画面</h4> 
<p>ffmpeg -i in.mp4 -ss 5 -vframes 1 img.jpg</p> 
<h4><a id="_gif__136"></a>制作 gif 动图</h4> 
<p>ffmpeg -i in.mp4 -ss 7.5 -to 8.5 -s 640x320 -r 15 out.gif</p> 
<h4><a id="_140"></a>可以录制视频</h4> 
<p>但是只能录制视频，没有音频。</p> 
<p>不推荐使用 Screen Capture Recorder 软件，原因是很久没有更新了。</p> 
<p>推荐使用 OBS Studio 软件。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e3091ae1b565b178e277c5de51c6fe5f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">mybatis进阶分页(一对多)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3096ff791a16937f4bf4b887cdf821de/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">基于VUE3和Element-plus实现的Cron表达式组件no-vue3-cron（支持回显）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>