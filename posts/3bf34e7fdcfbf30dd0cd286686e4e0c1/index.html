<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>matlab时频分析之连续小波变换cwt - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="matlab时频分析之连续小波变换cwt" />
<meta property="og:description" content="matlab时频分析之连续小波变换cwt 1 小波分析简介2 小波分析基本原理3 cwt的matlab实现4 cwt的边缘效应与影响锥5 cwt的重构——icwt6 增加cwt的分辨率的wsst （2020年7月更新，第3节绘制了一个实部、虚部的关系图） 1 小波分析简介 和傅里叶变换比，小波变换和短时傅里叶变换都有着相同的优点，就是可以同时在时域和频域观察信号。所以小波变换非定常信号的分析中有很大的作用。
有关短时傅里叶变换的文章，可以参见我之前写的：
matlab时频分析之短时傅里叶变换 spectrogram
https://blog.csdn.net/weixin_42943114/article/details/88735799
和短时傅里叶变换相比，小波变换有着窗口自适应的特点，即高频信号分辨率高（但是频率分辨率差），低频信号频率分辨率高（但是时间分辨率差），而在工程中常常比较关心低频的频率，关心高频出现的时间，所以近些年用途比较广泛。
在数学上，小波还有正交化等优点，应用领域广泛。
但是，本文只讨论如何利用matlab实现cwt的时频分析
2 小波分析基本原理 小波的含义，即为时间上衰减快，和傅里叶的正弦波相比要短。
一个典型的morlet小波如下图：
matlab有很多自带的小波函数，利用wavemngr(‘read’,1)可以进行小波的查看，利用waveinfo可以查看小波的相关信息。
在时间域上，可以通过小波在时间上的移动，逐一比较不同位置的窗口信号，得到小波系数，小波系数越大，则证明小波与该段信号的拟合程度越好。计算中用小波函数与该窗口信号的卷积，作为该窗口下的小波系数。窗口的长度和小波的长度是相同的。
在频率域上，通过拉伸或压缩小波的长度，来改变小波的长短和频率，实现不同频率下的小波系数。相应的，窗口长度也会随着小波长度变化。由于高频处小波被压缩，时间窗变窄，使得时间分辨率更高。
将不同频率下的小波系数组合起来，便得到了时频变换的小波系数图。
从图上可以看到，低频处频率分辨率要好于高频处的。小波时频图的特点为整体呈现高频处高而瘦，低频处矮而宽。
小波中，一般用尺度scale来衡量小波的频率f，两者之间的转换关系为：
s c a l e ∗ f = F s ∗ w c f scale * f=Fs * wcf scale∗f=Fs∗wcf
公式中，Fs代表信号的采样频率，wcf为小波的中心频率（wave central freq），在matlab里可以用 centfrq(wavename) 来查询。
3 cwt的matlab实现 matlab自带的有两种实现方式，一种是2006年版本推出的函数cwt，一种是2016年版本推出的函数cwt。两个函数名称相同，用法不同。
（我也不知道为什么会这样。。。-_-||）
由于名称一样，在使用中，要想调用不同的版本，只能用输入输出格式来区分。
旧版本cwt用法为：
coefs = cwt(x,scales,&#39;wname&#39;) 新版本cwt用法为：
[wt,f] = cwt(x,wname,fs) 最明显的区别在于，新版本取消了自定义尺度函数scales的功能。同时新版本还更新替换了一部分小波函数。旧版本支持 ‘haar’，‘db’，‘sym’，‘cmor’，‘mexh’，‘gaus’，‘bior’等小波，新版本支持’morse’， &#39;amor’和 &#39;bump’小波。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/3bf34e7fdcfbf30dd0cd286686e4e0c1/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-08-23T11:11:52+08:00" />
<meta property="article:modified_time" content="2023-08-23T11:11:52+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">matlab时频分析之连续小波变换cwt</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>matlab时频分析之连续小波变换cwt</h4> 
 <ul><li><a href="#1__2" rel="nofollow">1 小波分析简介</a></li><li><a href="#2__14" rel="nofollow">2 小波分析基本原理</a></li><li><a href="#3_cwtmatlab_33" rel="nofollow">3 cwt的matlab实现</a></li><li><a href="#4_cwt_180" rel="nofollow">4 cwt的边缘效应与影响锥</a></li><li><a href="#5_cwticwt_239" rel="nofollow">5 cwt的重构——icwt</a></li><li><a href="#6_cwtwsst_252" rel="nofollow">6 增加cwt的分辨率的wsst</a></li></ul> 
</div> 
<br> （2020年7月更新，第3节绘制了一个实部、虚部的关系图） 
<p></p> 
<h2><a id="1__2"></a>1 小波分析简介</h2> 
<p>和傅里叶变换比，小波变换和短时傅里叶变换都有着相同的优点，就是可以同时在时域和频域观察信号。所以小波变换非定常信号的分析中有很大的作用。</p> 
<p>有关短时傅里叶变换的文章，可以参见我之前写的：<br> matlab时频分析之短时傅里叶变换 spectrogram<br> https://blog.csdn.net/weixin_42943114/article/details/88735799</p> 
<p>和短时傅里叶变换相比，小波变换有着窗口自适应的特点，即高频信号分辨率高（但是频率分辨率差），低频信号频率分辨率高（但是时间分辨率差），而在工程中常常比较关心低频的频率，关心高频出现的时间，所以近些年用途比较广泛。</p> 
<p>在数学上，小波还有正交化等优点，应用领域广泛。<br> 但是，本文只讨论如何利用matlab实现cwt的时频分析</p> 
<h2><a id="2__14"></a>2 小波分析基本原理</h2> 
<p>小波的含义，即为时间上衰减快，和傅里叶的正弦波相比要短。<br> 一个典型的morlet小波如下图：<br> <img src="https://images2.imgbox.com/94/43/cLF9Wj6V_o.png" alt="在这里插入图片描述"><br> matlab有很多自带的小波函数，利用wavemngr(‘read’,1)可以进行小波的查看，利用waveinfo可以查看小波的相关信息。</p> 
<p>在时间域上，可以通过小波在时间上的移动，逐一比较不同位置的窗口信号，得到小波系数，小波系数越大，则证明小波与该段信号的拟合程度越好。计算中用小波函数与该窗口信号的卷积，作为该窗口下的小波系数。窗口的长度和小波的长度是相同的。<br> <img src="https://images2.imgbox.com/67/41/f15I0r1k_o.png" alt="在这里插入图片描述"><br> 在频率域上，通过拉伸或压缩小波的长度，来改变小波的长短和频率，实现不同频率下的小波系数。相应的，窗口长度也会随着小波长度变化。由于高频处小波被压缩，时间窗变窄，使得时间分辨率更高。</p> 
<p>将不同频率下的小波系数组合起来，便得到了时频变换的小波系数图。<br> <img src="https://images2.imgbox.com/93/b1/GHLnwi6k_o.png" alt="在这里插入图片描述"><br> 从图上可以看到，低频处频率分辨率要好于高频处的。小波时频图的特点为整体呈现高频处高而瘦，低频处矮而宽。</p> 
<p>小波中，一般用尺度scale来衡量小波的频率f，两者之间的转换关系为：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          s 
         
        
          c 
         
        
          a 
         
        
          l 
         
        
          e 
         
        
          ∗ 
         
        
          f 
         
        
          = 
         
        
          F 
         
        
          s 
         
        
          ∗ 
         
        
          w 
         
        
          c 
         
        
          f 
         
        
       
         scale * f=Fs * wcf 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6944em;"></span><span class="mord mathnormal">sc</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.0197em;">l</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">F</span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord mathnormal" style="margin-right: 0.0269em;">w</span><span class="mord mathnormal">c</span><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span></span></span></span></span></span><br> 公式中，Fs代表信号的采样频率，wcf为小波的中心频率（wave central freq），在matlab里可以用 centfrq(wavename) 来查询。</p> 
<h2><a id="3_cwtmatlab_33"></a>3 cwt的matlab实现</h2> 
<p>matlab自带的有两种实现方式，一种是2006年版本推出的函数cwt，一种是2016年版本推出的函数cwt。两个函数名称相同，用法不同。<br> （我也不知道为什么会这样。。。-_-||）</p> 
<p>由于名称一样，在使用中，要想调用不同的版本，只能用输入输出格式来区分。</p> 
<p>旧版本cwt用法为：</p> 
<pre><code class="prism language-matlab">coefs <span class="token operator">=</span> <span class="token function">cwt</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>scales<span class="token punctuation">,</span><span class="token string">'wname'</span><span class="token punctuation">)</span>
</code></pre> 
<p>新版本cwt用法为：</p> 
<pre><code class="prism language-matlab"><span class="token punctuation">[</span>wt<span class="token punctuation">,</span>f<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">cwt</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>wname<span class="token punctuation">,</span>fs<span class="token punctuation">)</span>
</code></pre> 
<p>最明显的区别在于，新版本取消了自定义尺度函数scales的功能。同时新版本还更新替换了一部分小波函数。旧版本支持 ‘haar’，‘db’，‘sym’，‘cmor’，‘mexh’，‘gaus’，‘bior’等小波，新版本支持’morse’， 'amor’和 'bump’小波。</p> 
<p>新版小波的介绍可以参见：<br> https://ww2.mathworks.cn/help/wavelet/gs/choose-a-wavelet.html</p> 
<p>新版本的小波函数用法如下：</p> 
<pre><code class="prism language-matlab"><span class="token comment">% 定义信号信息</span>
fs<span class="token operator">=</span><span class="token number">2</span><span class="token operator">^</span><span class="token number">6</span><span class="token punctuation">;</span>    <span class="token comment">%采样频率</span>
dt<span class="token operator">=</span><span class="token number">1</span><span class="token operator">/</span>fs<span class="token punctuation">;</span>    <span class="token comment">%时间精度</span>
timestart<span class="token operator">=</span><span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">;</span>
timeend<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">;</span>
t<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">:</span><span class="token punctuation">(</span>timeend<span class="token operator">-</span>timestart<span class="token punctuation">)</span><span class="token operator">/</span>dt<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>dt<span class="token operator">+</span>timestart<span class="token punctuation">;</span>
L<span class="token operator">=</span><span class="token function">length</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>

z<span class="token operator">=</span><span class="token number">4</span><span class="token operator">*</span><span class="token function">sin</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span><span class="token keyword">pi</span><span class="token operator">*</span><span class="token function">linspace</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span>L<span class="token punctuation">)</span><span class="token operator">.*</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">%matlab自带的小波变换</span>
<span class="token comment">%新版本</span>
<span class="token function">figure</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span>wt<span class="token punctuation">,</span>f<span class="token punctuation">,</span>coi<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">cwt</span><span class="token punctuation">(</span>z<span class="token punctuation">,</span><span class="token string">'amor'</span><span class="token punctuation">,</span>fs<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">pcolor</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span>f<span class="token punctuation">,</span><span class="token function">abs</span><span class="token punctuation">(</span>wt<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>shading interp
</code></pre> 
<p>旧版本的小波函数用法如下：<br> 这里用到了cmor小波，以及频率转尺度的方法。</p> 
<pre><code class="prism language-matlab"><span class="token comment">% 定义信号信息</span>
fs<span class="token operator">=</span><span class="token number">2</span><span class="token operator">^</span><span class="token number">6</span><span class="token punctuation">;</span>    <span class="token comment">%采样频率</span>
dt<span class="token operator">=</span><span class="token number">1</span><span class="token operator">/</span>fs<span class="token punctuation">;</span>    <span class="token comment">%时间精度</span>
timestart<span class="token operator">=</span><span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">;</span>
timeend<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">;</span>
t<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">:</span><span class="token punctuation">(</span>timeend<span class="token operator">-</span>timestart<span class="token punctuation">)</span><span class="token operator">/</span>dt<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>dt<span class="token operator">+</span>timestart<span class="token punctuation">;</span>
L<span class="token operator">=</span><span class="token function">length</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>

z<span class="token operator">=</span><span class="token number">4</span><span class="token operator">*</span><span class="token function">sin</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span><span class="token keyword">pi</span><span class="token operator">*</span><span class="token function">linspace</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span>L<span class="token punctuation">)</span><span class="token operator">.*</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">%旧版本</span>
wavename<span class="token operator">=</span><span class="token string">'cmor1-3'</span><span class="token punctuation">;</span> <span class="token comment">%可变参数，分别为cmor的</span>
<span class="token comment">%举一个频率转尺度的例子</span>
fmin<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>
fmax<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">;</span>
df<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">;</span>

f<span class="token operator">=</span>fmin<span class="token operator">:</span>df<span class="token operator">:</span>fmax<span class="token operator">-</span>df<span class="token punctuation">;</span><span class="token comment">%预期的频率</span>
wcf<span class="token operator">=</span><span class="token function">centfrq</span><span class="token punctuation">(</span>wavename<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">%小波的中心频率</span>
scal<span class="token operator">=</span>fs<span class="token operator">*</span>wcf<span class="token operator">./</span>f<span class="token punctuation">;</span><span class="token comment">%利用频率转换尺度</span>
coefs <span class="token operator">=</span> <span class="token function">cwt</span><span class="token punctuation">(</span>z<span class="token punctuation">,</span>scal<span class="token punctuation">,</span>wavename<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">figure</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token function">pcolor</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span>f<span class="token punctuation">,</span><span class="token function">abs</span><span class="token punctuation">(</span>coefs<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>shading interp
</code></pre> 
<p>对于cmor小波Fc和Fb的选取，可以认为最终结果只与Fc*√Fb的乘积大小有关就行。实际应用中具体值需要根据最终效果选择。</p> 
<p>cmor小波最终得到的coefs小波系数，是一个复数矩阵，绝对值abs()代表信号的幅值，角度angle()代表信号的相位。一般用小波系数的实部real()来同时表示信号正负变化。<br> <img src="https://images2.imgbox.com/bb/0d/KlhLPkh2_o.png" alt="在这里插入图片描述"><br> 实部、虚部、相位、振幅的关系如下图所示：<br> <img src="https://images2.imgbox.com/98/1e/AYU8puBp_o.jpg" alt="在这里插入图片描述"></p> 
<p>其实cwt的原理很简单，就是用不同尺度的小波逐个窗口去卷积，得到小波系数矩阵。所以根据原理，可以自己编程实现小波变换。</p> 
<p>自己编程的cwt函数如下，这里主要算法参考了matlab官方的文档。这里我依然用的是cmor小波作为例子，morlet函数公式可以查询到，也可以用cmorwavf()函数调用：</p> 
<pre><code class="prism language-matlab">fs<span class="token operator">=</span><span class="token number">2</span><span class="token operator">^</span><span class="token number">6</span><span class="token punctuation">;</span>    <span class="token comment">%采样频率</span>
dt<span class="token operator">=</span><span class="token number">1</span><span class="token operator">/</span>fs<span class="token punctuation">;</span>    <span class="token comment">%时间精度</span>
timestart<span class="token operator">=</span><span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">;</span>
timeend<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">;</span>
t<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">:</span><span class="token punctuation">(</span>timeend<span class="token operator">-</span>timestart<span class="token punctuation">)</span><span class="token operator">/</span>dt<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>dt<span class="token operator">+</span>timestart<span class="token punctuation">;</span>
L<span class="token operator">=</span><span class="token function">length</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
z<span class="token operator">=</span><span class="token number">4</span><span class="token operator">*</span><span class="token function">sin</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span><span class="token keyword">pi</span><span class="token operator">*</span><span class="token function">linspace</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span>L<span class="token punctuation">)</span><span class="token operator">.*</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">%定义计算范围和精度</span>
fmin<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>
fmax<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">;</span>
df<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">;</span>
totalscal<span class="token operator">=</span><span class="token punctuation">(</span>fmax<span class="token operator">-</span>fmin<span class="token punctuation">)</span><span class="token operator">/</span>df<span class="token punctuation">;</span>
f<span class="token operator">=</span>fmin<span class="token operator">:</span>df<span class="token operator">:</span>fmax<span class="token operator">-</span>df<span class="token punctuation">;</span><span class="token comment">%预期的频率</span>
wcf<span class="token operator">=</span><span class="token function">centfrq</span><span class="token punctuation">(</span>wavename<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">%小波的中心频率</span>
scal<span class="token operator">=</span>fs<span class="token operator">*</span>wcf<span class="token operator">./</span>f<span class="token punctuation">;</span>

<span class="token comment">%自己实现的小波函数</span>
coefs2<span class="token operator">=</span><span class="token function">cwt_cmor</span><span class="token punctuation">(</span>z<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span>f<span class="token punctuation">,</span>fs<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">figure</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token function">pcolor</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span>f<span class="token punctuation">,</span><span class="token function">abs</span><span class="token punctuation">(</span>coefs2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>shading interp


<span class="token comment">%后面是函数</span>
<span class="token keyword">function</span> coefs<span class="token operator">=</span><span class="token function">cwt_cmor</span><span class="token punctuation">(</span>z<span class="token punctuation">,</span>Fb<span class="token punctuation">,</span>Fc<span class="token punctuation">,</span>f<span class="token punctuation">,</span>fs<span class="token punctuation">)</span>
<span class="token comment">%1 小波的归一信号准备</span>
z<span class="token operator">=</span><span class="token function">z</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token operator">'</span><span class="token punctuation">;</span><span class="token comment">%强行变成y向量，避免前面出错</span>
L<span class="token operator">=</span><span class="token function">length</span><span class="token punctuation">(</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">%2 计算尺度</span>
scal<span class="token operator">=</span>fs<span class="token operator">*</span>Fc<span class="token operator">./</span>f<span class="token punctuation">;</span>

<span class="token comment">%3计算小波</span>
shuaijian<span class="token operator">=</span><span class="token number">0.001</span><span class="token punctuation">;</span><span class="token comment">%取小波衰减长度为0.1%</span>
tlow2low<span class="token operator">=</span><span class="token function">sqrt</span><span class="token punctuation">(</span>Fb<span class="token operator">*</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">/</span>shuaijian<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">%单边cmor衰减至0.1%时的时间长度，参照cmor的表达式</span>

<span class="token comment">%3小波的积分函数</span>
iter<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">;</span><span class="token comment">%小波函数的区间划分精度</span>
xWAV<span class="token operator">=</span><span class="token function">linspace</span><span class="token punctuation">(</span><span class="token operator">-</span>tlow2low<span class="token punctuation">,</span>tlow2low<span class="token punctuation">,</span><span class="token number">2</span><span class="token operator">^</span>iter<span class="token punctuation">)</span><span class="token punctuation">;</span>
stepWAV <span class="token operator">=</span> <span class="token function">xWAV</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token function">xWAV</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
val_WAV<span class="token operator">=</span><span class="token function">cumsum</span><span class="token punctuation">(</span><span class="token function">cmorwavf</span><span class="token punctuation">(</span><span class="token operator">-</span>tlow2low<span class="token punctuation">,</span>tlow2low<span class="token punctuation">,</span><span class="token number">2</span><span class="token operator">^</span>iter<span class="token punctuation">,</span>Fb<span class="token punctuation">,</span>Fc<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">*</span>stepWAV<span class="token punctuation">;</span>
<span class="token comment">%卷积前准备</span>
xWAV <span class="token operator">=</span> xWAV<span class="token operator">-</span><span class="token function">xWAV</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xMaxWAV <span class="token operator">=</span> <span class="token function">xWAV</span><span class="token punctuation">(</span><span class="token keyword">end</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
coefs     <span class="token operator">=</span> <span class="token function">zeros</span><span class="token punctuation">(</span><span class="token function">length</span><span class="token punctuation">(</span>scal<span class="token punctuation">)</span><span class="token punctuation">,</span>L<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">%预初设coefs</span>

<span class="token comment">%4小波与信号的卷积</span>
<span class="token keyword">for</span> k <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token function">length</span><span class="token punctuation">(</span>scal<span class="token punctuation">)</span>    <span class="token comment">%一个scal一行</span>
    a_SIG <span class="token operator">=</span> <span class="token function">scal</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">%a是这一行的尺度函数</span>

    <span class="token number">j</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">+</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">:</span>a_SIG<span class="token operator">*</span>xMaxWAV<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>a_SIG<span class="token operator">*</span>stepWAV<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">%j的最大值为是确定的，尺度越大，划分的越密。相当于把一个小波拉伸的越长。</span>
    <span class="token keyword">if</span> <span class="token function">length</span><span class="token punctuation">(</span><span class="token number">j</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">1</span> <span class="token punctuation">,</span> <span class="token number">j</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">end</span>
    
    waveinscal <span class="token operator">=</span> <span class="token function">fliplr</span><span class="token punctuation">(</span><span class="token function">val_WAV</span><span class="token punctuation">(</span><span class="token number">j</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">%把积分值扩展到j区间，然后左右颠倒。f为当下尺度的积分小波函数</span>
    
    <span class="token comment">%5 最重要的一步 wkeep1取diff(wconv1(ySIG,f))里长度为lenSIG的中间一段</span>
    <span class="token comment">%conv(ySIG,f)卷积。</span>
    <span class="token function">coefs</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token function">sqrt</span><span class="token punctuation">(</span>a_SIG<span class="token punctuation">)</span><span class="token operator">*</span><span class="token function">wkeep1</span><span class="token punctuation">(</span><span class="token function">diff</span><span class="token punctuation">(</span><span class="token function">conv2</span><span class="token punctuation">(</span>z<span class="token punctuation">,</span>waveinscal<span class="token punctuation">,</span> <span class="token string">'full'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>L<span class="token punctuation">)</span><span class="token punctuation">;</span>
    %
<span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre> 
<p>输出的结果如下，可以看到和matlab自带的函数得到的结果基本相同。<br> <img src="https://images2.imgbox.com/54/9e/79jYUs5A_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="4_cwt_180"></a>4 cwt的边缘效应与影响锥</h2> 
<p>利用自带的cwt函数，可以很方便的绘制出影响锥。</p> 
<pre><code class="prism language-matlab"><span class="token function">cwt</span><span class="token punctuation">(</span>z<span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/1b/24/6Txrz8uV_o.png" alt="在这里插入图片描述"><br> 由于小波计算中，小波系数是利用窗口函数和小波卷积而来的，当窗口在信号的边缘时，窗口内会存在一部分没有信号。这时，matlab就把窗口内这部分不完整的信号补零处理，凑够长度。</p> 
<p>此时由于信号在边缘被强制补零，导致信号会失真，具体在时频图中表示为频率变宽，信号强度降低。严重的时候，甚至整个低频部分都会出现失真。这就是cwt的边缘效应。</p> 
<p>为了确定边缘效应的影响，绘制出了一条影响曲线，曲线内部的信号影响小或者不受影响，曲线外部影响较大。曲线像一个锥形，高频处靠近两侧，低频处靠近中间，所以也被叫做影响锥。<br> <img src="https://images2.imgbox.com/09/46/o2oyTdRg_o.png" alt="在这里插入图片描述"><br> 所以根据边缘效应的原理，可以知道，之所以高频处影响范围小，是因为高频处小波被压缩，所以窗口更窄。低频处小波被拉伸，所以对应着窗口更宽。窗口的长度和小波的长度是相同的。</p> 
<p>关于影响范围的评价，有很多种，这里为了方便说明，我直接用小波的半长度作为影响范围，来绘制影响锥。具体的思路如下，我认为超过小波长度一半的范围都是失真的，然后通过频率求出每一点的小波长度，再在图上连线绘制出来。<br> <img src="https://images2.imgbox.com/d9/e8/4mEksQAv_o.png" alt="在这里插入图片描述"></p> 
<p>代码如下，依然以cmor小波为例，为了反应相位的影响，这里用的是real()：</p> 
<pre><code class="prism language-matlab"><span class="token comment">%小波变换展示</span>
clear
fs<span class="token operator">=</span><span class="token number">2</span><span class="token operator">^</span><span class="token number">6</span><span class="token punctuation">;</span>    <span class="token comment">%采样频率</span>
dt<span class="token operator">=</span><span class="token number">1</span><span class="token operator">/</span>fs<span class="token punctuation">;</span>    <span class="token comment">%时间精度</span>
timestart<span class="token operator">=</span><span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">;</span>
timeend<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">;</span>
t<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">:</span><span class="token punctuation">(</span>timeend<span class="token operator">-</span>timestart<span class="token punctuation">)</span><span class="token operator">/</span>dt<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>dt<span class="token operator">+</span>timestart<span class="token punctuation">;</span>
L<span class="token operator">=</span><span class="token function">length</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>

z<span class="token operator">=</span><span class="token function">sin</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span><span class="token keyword">pi</span><span class="token operator">*</span><span class="token number">5.</span><span class="token operator">*</span>t<span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">sin</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span><span class="token keyword">pi</span><span class="token operator">*</span><span class="token number">9.</span><span class="token operator">*</span>t<span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">sin</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span><span class="token keyword">pi</span><span class="token operator">*</span><span class="token number">15.</span><span class="token operator">*</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">%定义范围</span>
wavename<span class="token operator">=</span><span class="token string">'cmor1-3'</span><span class="token punctuation">;</span> <span class="token comment">%可变参数</span>
fmin<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>
fmax<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">;</span>
df<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">;</span>
totalscal<span class="token operator">=</span><span class="token punctuation">(</span>fmax<span class="token operator">-</span>fmin<span class="token punctuation">)</span><span class="token operator">/</span>df<span class="token punctuation">;</span>
f<span class="token operator">=</span>fmin<span class="token operator">:</span>df<span class="token operator">:</span>fmax<span class="token operator">-</span>df<span class="token punctuation">;</span><span class="token comment">%预期的频率</span>
wcf<span class="token operator">=</span><span class="token function">centfrq</span><span class="token punctuation">(</span>wavename<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">%小波的中心频率</span>
scal<span class="token operator">=</span>fs<span class="token operator">*</span>wcf<span class="token operator">./</span>f<span class="token punctuation">;</span>

<span class="token comment">%旧版本</span>
coefs <span class="token operator">=</span> <span class="token function">cwt</span><span class="token punctuation">(</span>z<span class="token punctuation">,</span>scal<span class="token punctuation">,</span>wavename<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">figure</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token function">pcolor</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span>f<span class="token punctuation">,</span><span class="token function">real</span><span class="token punctuation">(</span>coefs<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>shading interp

tlow2low<span class="token operator">=</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">*</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">/</span><span class="token number">0.001</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">%单边cmor衰减至0.1%时的时间长度</span>
tcoi41<span class="token operator">=</span>tlow2low<span class="token operator">*</span>scal<span class="token punctuation">;</span><span class="token comment">%小波一半长度</span>
bur<span class="token operator">=</span><span class="token punctuation">(</span>tcoi41<span class="token operator">&lt;</span>L<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fcoi4<span class="token operator">=</span><span class="token function">f</span><span class="token punctuation">(</span>bur<span class="token punctuation">)</span><span class="token punctuation">;</span>
tcoi41<span class="token operator">=</span><span class="token function">tcoi41</span><span class="token punctuation">(</span>bur<span class="token punctuation">)</span><span class="token punctuation">;</span>
tcoi42<span class="token operator">=</span><span class="token operator">-</span>tcoi41<span class="token operator">+</span>L<span class="token punctuation">;</span>
hold on
<span class="token function">plot</span><span class="token punctuation">(</span>tcoi41<span class="token operator">/</span>fs<span class="token operator">+</span>timestart<span class="token punctuation">,</span>fcoi4<span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">,</span><span class="token string">'LineWidth'</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token function">plot</span><span class="token punctuation">(</span>tcoi42<span class="token operator">/</span>fs<span class="token operator">+</span>timestart<span class="token punctuation">,</span>fcoi4<span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">,</span><span class="token string">'LineWidth'</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
hold off
</code></pre> 
<p><img src="https://images2.imgbox.com/ef/33/sP4L3L6r_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="5_cwticwt_239"></a>5 cwt的重构——icwt</h2> 
<p>如果用的是matlab新版的默认小波，那么可以直接把cwt之后小波系数icwt即可。</p> 
<pre><code class="prism language-matlab">load mtlb<span class="token punctuation">;</span>
wt <span class="token operator">=</span> <span class="token function">cwt</span><span class="token punctuation">(</span>mtlb<span class="token punctuation">)</span><span class="token punctuation">;</span>
xrec <span class="token operator">=</span> <span class="token function">icwt</span><span class="token punctuation">(</span>wt<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>对于morlet小波，可以直接 sum(real(coefs),1) 来实现重构。但是，这里尺度最好用默认尺度，否则会出现重复叠加导致幅值出现问题。</p> 
<p>具体用法可以参见帮助文档。</p> 
<h2><a id="6_cwtwsst_252"></a>6 增加cwt的分辨率的wsst</h2> 
<p>利用wsst可以显著的提高cwt的频率分辨率。具体用法如下：</p> 
<pre><code class="prism language-matlab">clear
fs<span class="token operator">=</span><span class="token number">2</span><span class="token operator">^</span><span class="token number">6</span><span class="token punctuation">;</span>    <span class="token comment">%采样频率</span>
dt<span class="token operator">=</span><span class="token number">1</span><span class="token operator">/</span>fs<span class="token punctuation">;</span>    <span class="token comment">%时间精度</span>
timestart<span class="token operator">=</span><span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">;</span>
timeend<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">;</span>
t<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">:</span><span class="token punctuation">(</span>timeend<span class="token operator">-</span>timestart<span class="token punctuation">)</span><span class="token operator">/</span>dt<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>dt<span class="token operator">+</span>timestart<span class="token punctuation">;</span>
L<span class="token operator">=</span><span class="token function">length</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
z<span class="token operator">=</span><span class="token number">4</span><span class="token operator">*</span><span class="token function">sin</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span><span class="token keyword">pi</span><span class="token operator">*</span><span class="token function">linspace</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span>L<span class="token punctuation">)</span><span class="token operator">.*</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">[</span>sst<span class="token punctuation">,</span>f<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">wsst</span><span class="token punctuation">(</span>z<span class="token punctuation">,</span>fs<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">figure</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
<span class="token function">pcolor</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span>f<span class="token punctuation">,</span><span class="token function">abs</span><span class="token punctuation">(</span>sst<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>shading interp
</code></pre> 
<p>与普通cwt的对比图如下：<br> <img src="https://images2.imgbox.com/96/1b/3HE6mN9K_o.png" alt="在这里插入图片描述"><br> 左图是cwt的时频图，右图是wsst的时频图。<br> wsst同样可以利用iwsst进行重构，具体方法可以参见iwsst的帮助文档。</p> 
<p>如果想要提高wsst的精度，可以在matlab里选中wsst，然后Ctrl+D进入wsst的代码界面，把里面的na参数，强行改的大一点。</p> 
<p>具体方法为在下面代码后，加上一个na=512（这里不一定是512，具体根据na实际值进行适当放大，在我这里的例子中，na=288。如果怕出错，建议备份）。</p> 
<pre><code class="prism language-matlab">na <span class="token operator">=</span> noct<span class="token operator">*</span>params<span class="token punctuation">.</span>nv<span class="token punctuation">;</span>
na<span class="token operator">=</span><span class="token number">512</span>
</code></pre> 
<p>这样做的优点是，在不影响iwsst的运行结果的基础上，显著的提高分解的精度。</p> 
<p><img src="https://images2.imgbox.com/87/bf/SKaVRxoP_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c2bace092cf602b6ac122237ec216a55/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">企业内网搭建</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f3c7da0c42638fc6947a6a391ca3d66a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">SqlServer2019—解决SQL Server 无法连接127.0.0.1的问题</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>