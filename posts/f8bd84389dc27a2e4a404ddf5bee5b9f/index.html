<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>AD域（active directory）排错和检查（三） - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="AD域（active directory）排错和检查（三）" />
<meta property="og:description" content="AD的检查和排错
检查active directory是否正常
通过域控制器检查 首先启动域控制器，登录界面如下图，输入密码登录到gaoyk.com域中。
如果正常登录表示我们的域控制器正在工作，但是并不能表明我们的活动目录已经安装完成。所以我们还要在控制器上检查如下几项：
第一项：查看管理工具中相关的项是否已经存在。如下图：
第二项：检查AD数据库文件与SYSVOL文件夹。AD数据库文件会默认安装到：C:\WINDOWS\NTDS文件夹中，其中ntds.dit便是AD的数据库文件，.log文件是日志文件。
而SYSVOL文件夹会默认安装到：C:\WINDOWS\SYSVOL，其中sysvol是共享文件夹。
这个共享文件夹下面还有域文件夹里面还有一个共享文件夹scripts，可以通过net share命令查看共享，如图
第三项：查看DNS服务器内与AD相关的文件夹和SRV记录是否存在或完整，由于域控制器会把自己的主机名，IP地址以及所扮演的角色数据登录到DNS服务器内，以便让其他的计算机通过DNS服务器来寻找这台域控制器。因此必须要检查这些文件夹和SRV记录，打开DNS，如图：
我们发现有一个叫gaoyk.com的正向查找区域，它是安装AD的时候自动创建的，以便让域gaoyk.com中的成员（域控制器，成员服务器，client客户端）将数据登记到这个区域。从上图中我们可以看到主机已经经自己名称以及IP地址登记到这个区域内。同时还有一个_msdcs.gaoyk.com的正向查找区域，因为我们安装活动目录的时候顺便安装了DNS服务器，所以也创建了这个区域，此时server 2019域控制器会将数据登记到_msdcs.gaoyk.com区域内。我们可以浏览这两个区域的_TCP文件夹以及相对应的SRV记录，如图：
从上面这些图中我们可以清晰的看到，域和站点的GC是谁，LDAP服务器是谁，以及KDC服务器是谁。
排错1：如果DNS中没有出现上面这些文件夹以及SRV记录。我们一般需要这么做。首先为域控制器指定正确的DNS服务器的IP地址，然后重新启动Net Logon服务。如果重启Net Logon服务还不正确，请按下面的步骤：1，首先为域控制器指定正确的DNS服务器的IP地址。2，在DNS服务器中建立和域名相同的正向查收区域，并启用动态更新。3，重新启动Net Logon服务。经过这3步相关的文件夹和SRV记录就应该出现了
通过客户端加入域检查 首先我们登录到客户端client，然后对计算机属性进行更改
如果在加入域的时候弹出 错误对话框提示加入域失败，原因可能就是没有给client客户端进行IP的配置。但是这个时候可以利用NETBIOS名来加入域。比如在上面不输入gaoyk.com,而是输入gaoyk，然后点击确定，就会弹出登录对话框，说明通过NETBIOS名我们找到了域控制器，此时使用的是广播。
为了使用域名而不是让NETBIOS名让客户端加入域，我们必须配置client客户端的IP地址。如图：
配置完IP后，我们重新执行刚才的步骤，这次我们就可以顺利的找到域控制器了。我们知道计算机之间的通信是通过IP地址进行的，我们这里输入域名gaoyk.com后，事实上DNS服务器帮我们把gaoyk.com域名解析成域控制器的IP地址。所以客户端加入域需要DNS服务器的支持。此时弹出的登录对话框我们输入管理员账户和密码，点击确定即可加入域。
确定后我们会被提示许哟啊重启，重启后我们发现界面已经更改
当选择登录到域时，我们还必须在域控制器上位这个客户端创建一个用户账户。
此时我们打开计算机的管理会发现computers中已经多了一台client1，如图
现在我们来创建一个用户账户
密码默认要符合复杂度定义条件，A-Z，a-z，0-9，特殊字符等任选三种，同时长度必须大于等于7位。可以选择密码永不过期，这样可以解除默认42天的限制。
然后我们发现张三这个用户账户已经成功创建
然后我们可以用此账户进行登录
这时我们发现和原先的桌面不一样了" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/f8bd84389dc27a2e4a404ddf5bee5b9f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-12-04T15:24:43+08:00" />
<meta property="article:modified_time" content="2020-12-04T15:24:43+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">AD域（active directory）排错和检查（三）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="margin-left:0cm;">AD的检查和排错</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">检查active directory是否正常</p> 
<p style="margin-left:0cm;"> </p> 
<ul><li>通过域控制器检查</li></ul> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">首先启动域控制器，登录界面如下图，输入密码登录到gaoyk.com域中。</p> 
<p style="margin-left:0cm;"><img alt="" height="750" src="https://images2.imgbox.com/38/76/8ENPeZfh_o.png" width="1067"></p> 
<p style="margin-left:0cm;">如果正常登录表示我们的域控制器正在工作，但是并不能表明我们的活动目录已经安装完成。所以我们还要在控制器上检查如下几项：</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">第一项：查看管理工具中相关的项是否已经存在。如下图：</p> 
<p style="margin-left:0cm;"><img alt="" height="730" src="https://images2.imgbox.com/e4/ed/SjJGeCIb_o.png" width="1189"></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">第二项：检查AD数据库文件与SYSVOL文件夹。AD数据库文件会默认安装到：C:\WINDOWS\NTDS文件夹中，其中ntds.dit便是AD的数据库文件，.log文件是日志文件。</p> 
<p style="margin-left:0cm;"><img alt="" height="482" src="https://images2.imgbox.com/74/ad/VEwcq6Ie_o.png" width="886"></p> 
<p style="margin-left:0cm;">而SYSVOL文件夹会默认安装到：C:\WINDOWS\SYSVOL，其中sysvol是共享文件夹。</p> 
<p style="margin-left:0cm;"><img alt="" height="498" src="https://images2.imgbox.com/a6/ed/h9xs83rQ_o.png" width="798"></p> 
<p style="margin-left:0cm;">这个共享文件夹下面还有域文件夹里面还有一个共享文件夹scripts，可以通过net share命令查看共享，如图</p> 
<p style="margin-left:0cm;"><img alt="" height="417" src="https://images2.imgbox.com/47/7e/Y4x6VRX7_o.png" width="643"></p> 
<p style="margin-left:0cm;"><img alt="" height="317" src="https://images2.imgbox.com/07/d6/XMrHb2WH_o.png" width="722"></p> 
<p style="margin-left:0cm;">第三项：查看DNS服务器内与AD相关的文件夹和SRV记录是否存在或完整，由于域控制器会把自己的主机名，IP地址以及所扮演的角色数据登录到DNS服务器内，以便让其他的计算机通过DNS服务器来寻找这台域控制器。因此必须要检查这些文件夹和SRV记录，打开DNS，如图：</p> 
<p style="margin-left:0cm;"><img alt="" height="405" src="https://images2.imgbox.com/cf/02/4DnatfWw_o.png" width="738"></p> 
<p style="margin-left:0cm;">我们发现有一个叫gaoyk.com的正向查找区域，它是安装AD的时候自动创建的，以便让域gaoyk.com中的成员（域控制器，成员服务器，client客户端）将数据登记到这个区域。从上图中我们可以看到主机已经经自己名称以及IP地址登记到这个区域内。同时还有一个_msdcs.gaoyk.com的正向查找区域，因为我们安装活动目录的时候顺便安装了DNS服务器，所以也创建了这个区域，此时server 2019域控制器会将数据登记到_msdcs.gaoyk.com区域内。我们可以浏览这两个区域的_TCP文件夹以及相对应的SRV记录，如图：<img alt="" height="478" src="https://images2.imgbox.com/15/fa/gacjIfCL_o.png" width="871"><img alt="" height="471" src="https://images2.imgbox.com/47/e3/fr6UfHw3_o.png" width="855"><img alt="" height="485" src="https://images2.imgbox.com/f6/20/Fdmk3Nub_o.png" width="856"><img alt="" height="490" src="https://images2.imgbox.com/8b/96/189H0EiA_o.png" width="864"><img alt="" height="489" src="https://images2.imgbox.com/36/c6/Q3KlaeAZ_o.png" width="868"></p> 
<p style="margin-left:0cm;"><img alt="" height="468" src="https://images2.imgbox.com/36/e0/VCqeBaJC_o.png" width="881"></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">从上面这些图中我们可以清晰的看到，域和站点的GC是谁，LDAP服务器是谁，以及KDC服务器是谁。</p> 
<p style="margin-left:0cm;">排错1：如果DNS中没有出现上面这些文件夹以及SRV记录。我们一般需要这么做。首先为域控制器指定正确的DNS服务器的IP地址，然后重新启动Net Logon服务。如果重启Net Logon服务还不正确，请按下面的步骤：1，首先为域控制器指定正确的DNS服务器的IP地址。2，在DNS服务器中建立和域名相同的正向查收区域，并启用动态更新。3，重新启动Net Logon服务。经过这3步相关的文件夹和SRV记录就应该出现了</p> 
<p style="margin-left:0cm;"> </p> 
<ul><li>通过客户端加入域检查</li></ul> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">首先我们登录到客户端client，然后对计算机属性进行更改</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><img alt="" height="641" src="https://images2.imgbox.com/68/a1/aLyy5Jhl_o.png" width="1200"></p> 
<p style="margin-left:0cm;">如果在加入域的时候弹出 错误对话框提示加入域失败，原因可能就是没有给client客户端进行IP的配置。但是这个时候可以利用NETBIOS名来加入域。比如在上面不输入gaoyk.com,而是输入gaoyk，然后点击确定，就会弹出登录对话框，说明通过NETBIOS名我们找到了域控制器，此时使用的是广播。</p> 
<p style="margin-left:0cm;">为了使用域名而不是让NETBIOS名让客户端加入域，我们必须配置client客户端的IP地址。如图：</p> 
<p style="margin-left:0cm;"><img alt="" height="580" src="https://images2.imgbox.com/70/d5/ecbjyFIG_o.png" width="466"></p> 
<p style="margin-left:0cm;">配置完IP后，我们重新执行刚才的步骤，这次我们就可以顺利的找到域控制器了。我们知道计算机之间的通信是通过IP地址进行的，我们这里输入域名gaoyk.com后，事实上DNS服务器帮我们把gaoyk.com域名解析成域控制器的IP地址。所以客户端加入域需要DNS服务器的支持。此时弹出的登录对话框我们输入管理员账户和密码，点击确定即可加入域。</p> 
<p style="margin-left:0cm;"><img alt="" height="155" src="https://images2.imgbox.com/53/b3/pgtnveUU_o.png" width="207"></p> 
<p style="margin-left:0cm;">确定后我们会被提示许哟啊重启，重启后我们发现界面已经更改</p> 
<p style="margin-left:0cm;"><img alt="" height="546" src="https://images2.imgbox.com/fc/83/0psKjitP_o.png" width="953"></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">当选择登录到域时，我们还必须在域控制器上位这个客户端创建一个用户账户。</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">此时我们打开计算机的管理会发现computers中已经多了一台client1，如图</p> 
<p style="margin-left:0cm;"><img alt="" height="469" src="https://images2.imgbox.com/e2/9c/oPiCuLFu_o.png" width="835"></p> 
<p style="margin-left:0cm;"><img alt="" height="476" src="https://images2.imgbox.com/9b/b7/ZGZYAGcZ_o.png" width="816"></p> 
<p style="margin-left:0cm;">现在我们来创建一个用户账户</p> 
<p style="margin-left:0cm;"><img alt="" height="471" src="https://images2.imgbox.com/01/96/JhgXXHld_o.png" width="787"></p> 
<p style="margin-left:0cm;"><img alt="" height="479" src="https://images2.imgbox.com/6a/2f/xxbsgeox_o.png" width="672"></p> 
<p style="margin-left:0cm;">密码默认要符合复杂度定义条件，A-Z，a-z，0-9，特殊字符等任选三种，同时长度必须大于等于7位。可以选择密码永不过期，这样可以解除默认42天的限制。</p> 
<p style="margin-left:0cm;"><img alt="" height="504" src="https://images2.imgbox.com/fe/c6/3FIVae9d_o.png" width="818"></p> 
<p style="margin-left:0cm;">然后我们发现张三这个用户账户已经成功创建</p> 
<p style="margin-left:0cm;"><img alt="" height="479" src="https://images2.imgbox.com/d3/8a/GhxKYmX4_o.png" width="853"></p> 
<p style="margin-left:0cm;">然后我们可以用此账户进行登录</p> 
<p style="margin-left:0cm;"><img alt="" height="668" src="https://images2.imgbox.com/b7/a2/enbwTkBp_o.png" width="675"></p> 
<p style="margin-left:0cm;">这时我们发现和原先的桌面不一样了</p> 
<p style="margin-left:0cm;"><img alt="" height="753" src="https://images2.imgbox.com/1c/9c/MIVdKY3j_o.png" width="1200"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e528ba0103c9949ffad1e3ef315c5bbb/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">python运行pyc_Python pyc格式解析</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9d7cd2458bf3899f827d7c6158eca255/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Go学习(编译运行Go程序)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>