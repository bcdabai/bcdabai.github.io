<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>数据结构之树（4）——红黑树 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="数据结构之树（4）——红黑树" />
<meta property="og:description" content="目录 红黑树
概念
调整
变色
左旋和右旋
插入
插入情况分析
插入平衡总结
插入实例
删除
概述
删除情况分析
删除平衡总结
删除实例
参考链接
红黑树 概念 红黑树同样是解决二叉排序树不平衡的问题的，例如下面这种失衡的二叉树。
所以红黑树首先是一棵二叉排序树，然后是二叉平衡树的特殊形式。
​
红黑树(Red Black Tree)是一种自平衡的二叉查找树。红黑树有如下特性：
结点是红色或者黑色的。根结点是黑色的。每个叶子结点都是黑色的空结点（NIL结点）。每个红色结点的两个子结点都是黑色的（从每个叶子到根的所有路径上不能有两个连续的红色结点）。从任一结点到其每个叶子的所有路径都包含相同数组的黑色结点。 ​
调整 新插入的结点颜色一定要先设置为红色，下面向红黑树种插入一个值为14的结点。
​
符合红黑树的规则，不需要调整平衡。
再插入一个21结点，如下图：
​
违反了上面的“每个红色结点的两个子结点都是黑色的”，所以必须进行调整，让这棵树重新符合红黑树的定义。
叶子(NIL)节点就是一个空节点，表示节点在此位置上没有元素了。在实际的算法实现中NIL不需要考虑，填上NIL节点只是为了判断到此路径终点的NIL节点上，经过多少黑节点。
调整红黑树有两种方法：变色和旋转（左旋转和右旋转）
变色：将红色结点变为黑色，或者将黑色结点变为红色。左旋转：逆时针旋转红黑树的两个节点，使得父节点被自己的右孩子取代，而自己成为自己的左孩子。右旋转：顺时针旋转红黑树的两个节点，使得父节点被自己的左孩子取代，而自己成为自己的右孩子。 变色 下面说下变色：
结点21和结点22都是红色，需要进行调整
​
将结点22变成黑色
​
但又不符合“从任一结点到其每个叶子的所有路径都包含相同数组的黑色结点”规则，从根结点13到结点21下的NIL结点，共有4个黑色结点，其他路径有3个黑色结点。
所以将结点25变成红色结点，如下：
​
此时发现结点25和结点27都是红色结点，所以将结点27变为黑色结点。
​
总之，变色就是改变结点的颜色，要么是红色，要么是黑色，然后调整成符合红黑树的规则。
左旋和右旋 关于左旋和右旋可以查看AVL树中的旋转：数据结构之树（3）——二叉平衡树（AVL）
左旋转，在上面已经说了
​
右旋转，上面也讲了的
​
但什么时候用变色，什么时候又用旋转呢，这很复杂，红黑树的插入和删除都需要判断调整是否符合红黑树的规则，然后调整。
下面通过其他参考资料来试图说明下红黑树插入和删除的各种情况：
插入 插入情况分析 红黑树的插入同二叉排序树的插入过程相似，但红黑树插入新结点后，需要判断红黑树是否符合定义要求，如果不符合，租需要进行调整，以满足红黑树的性质。
认识下结点的标记
第一种情况：如果插入的结点是根结点，那么该结点颜色调整为黑色
​
但发现不满足“根结点是黑色的”，所以需要调整，将根结点调整为黑色。
​
这时发现红黑树的所有要求被满足。
第二种情况：待插入结点的父结点是黑色，不需要调整
​
第三种情况：待插入结点的父结点是红色，同时叔叔结点也是红色，需要调整 ​" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/9f652303a5950359376bbcc7c5679d73/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-02-23T16:42:03+08:00" />
<meta property="article:modified_time" content="2021-02-23T16:42:03+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">数据结构之树（4）——红黑树</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2 id="main-toc"><strong>目录</strong></h2> 
<p id="%E7%BA%A2%E9%BB%91%E6%A0%91-toc" style="margin-left:0px;"><a href="#%E7%BA%A2%E9%BB%91%E6%A0%91" rel="nofollow">红黑树</a></p> 
<p id="%E6%A6%82%E5%BF%B5-toc" style="margin-left:40px;"><a href="#%E6%A6%82%E5%BF%B5" rel="nofollow">概念</a></p> 
<p id="%E8%B0%83%E6%95%B4-toc" style="margin-left:40px;"><a href="#%E8%B0%83%E6%95%B4" rel="nofollow">调整</a></p> 
<p id="%E5%8F%98%E8%89%B2-toc" style="margin-left:80px;"><a href="#%E5%8F%98%E8%89%B2" rel="nofollow">变色</a></p> 
<p id="%E5%B7%A6%E6%97%8B%E5%92%8C%E5%8F%B3%E6%97%8B-toc" style="margin-left:80px;"><a href="#%E5%B7%A6%E6%97%8B%E5%92%8C%E5%8F%B3%E6%97%8B" rel="nofollow">左旋和右旋</a></p> 
<p id="%E6%8F%92%E5%85%A5-toc" style="margin-left:40px;"><a href="#%E6%8F%92%E5%85%A5" rel="nofollow">插入</a></p> 
<p id="%E6%8F%92%E5%85%A5%E6%83%85%E5%86%B5%E5%88%86%E6%9E%90-toc" style="margin-left:80px;"><a href="#%E6%8F%92%E5%85%A5%E6%83%85%E5%86%B5%E5%88%86%E6%9E%90" rel="nofollow">插入情况分析</a></p> 
<p id="%E6%8F%92%E5%85%A5%E5%B9%B3%E8%A1%A1%E6%80%BB%E7%BB%93-toc" style="margin-left:80px;"><a href="#%E6%8F%92%E5%85%A5%E5%B9%B3%E8%A1%A1%E6%80%BB%E7%BB%93" rel="nofollow">插入平衡总结</a></p> 
<p id="%E6%8F%92%E5%85%A5%E5%AE%9E%E4%BE%8B-toc" style="margin-left:80px;"><a href="#%E6%8F%92%E5%85%A5%E5%AE%9E%E4%BE%8B" rel="nofollow">插入实例</a></p> 
<p id="%E5%88%A0%E9%99%A4-toc" style="margin-left:40px;"><a href="#%E5%88%A0%E9%99%A4" rel="nofollow">删除</a></p> 
<p id="%E6%A6%82%E8%BF%B0-toc" style="margin-left:80px;"><a href="#%E6%A6%82%E8%BF%B0" rel="nofollow">概述</a></p> 
<p id="%E5%88%A0%E9%99%A4%E6%83%85%E5%86%B5%E5%88%86%E6%9E%90-toc" style="margin-left:80px;"><a href="#%E5%88%A0%E9%99%A4%E6%83%85%E5%86%B5%E5%88%86%E6%9E%90" rel="nofollow">删除情况分析</a></p> 
<p id="%E5%88%A0%E9%99%A4%E5%B9%B3%E8%A1%A1%E6%80%BB%E7%BB%93-toc" style="margin-left:80px;"><a href="#%E5%88%A0%E9%99%A4%E5%B9%B3%E8%A1%A1%E6%80%BB%E7%BB%93" rel="nofollow">删除平衡总结</a></p> 
<p id="%E5%88%A0%E9%99%A4%E5%AE%9E%E4%BE%8B-toc" style="margin-left:80px;"><a href="#%E5%88%A0%E9%99%A4%E5%AE%9E%E4%BE%8B" rel="nofollow">删除实例</a></p> 
<p id="%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5-toc" style="margin-left:40px;"><a href="#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5" rel="nofollow">参考链接</a></p> 
<hr id="hr-toc"> 
<h2 id="%E7%BA%A2%E9%BB%91%E6%A0%91">红黑树</h2> 
<h3 id="%E6%A6%82%E5%BF%B5">概念</h3> 
<p>红黑树同样是解决二叉排序树不平衡的问题的，例如下面这种失衡的二叉树。</p> 
<p>所以红黑树首先是一棵二叉排序树，然后是二叉平衡树的特殊形式。</p> 
<p><img alt="" height="753" src="https://images2.imgbox.com/86/2a/C2zv4Jij_o.png" width="736">​</p> 
<p>红黑树(Red Black Tree)是一种自平衡的二叉查找树。红黑树有如下特性：</p> 
<ul><li>结点是红色或者黑色的。</li><li>根结点是黑色的。</li><li>每个叶子结点都是黑色的空结点（NIL结点）。</li><li>每个红色结点的两个子结点都是黑色的（从每个叶子到根的所有路径上不能有两个连续的红色结点）。</li><li>从任一结点到其每个叶子的所有路径都包含相同数组的黑色结点。</li></ul> 
<p><img alt="" height="676" src="https://images2.imgbox.com/11/ec/lTLXrazN_o.png" width="1200">​</p> 
<h3 id="%E8%B0%83%E6%95%B4">调整</h3> 
<p>新插入的结点颜色一定要先设置为红色，下面向红黑树种插入一个值为14的结点。</p> 
<p><img alt="" height="586" src="https://images2.imgbox.com/d4/6b/TaQvLlBF_o.png" width="1063">​</p> 
<p>符合红黑树的规则，不需要调整平衡。</p> 
<p>再插入一个21结点，如下图：</p> 
<p><img alt="" height="684" src="https://images2.imgbox.com/e8/bd/GMvjnsBb_o.png" width="1063">​</p> 
<p>违反了上面的“<strong>每个红色结点的两个子结点都是黑色的</strong>”，所以必须进行调整，让这棵树重新符合红黑树的定义。</p> 
<p><strong>叶子(NIL)节点</strong>就是一个空节点，表示节点在此位置上没有元素了。在实际的算法实现中NIL不需要考虑，填上NIL节点只是为了判断到此路径终点的NIL节点上，经过多少黑节点。</p> 
<p>调整红黑树有两种方法：变色和旋转（左旋转和右旋转）</p> 
<ul><li>变色：将红色结点变为黑色，或者将黑色结点变为红色。</li><li>左旋转：逆时针旋转红黑树的两个节点，使得父节点被自己的右孩子取代，而自己成为自己的左孩子。</li><li>右旋转：顺时针旋转红黑树的两个节点，使得父节点被自己的左孩子取代，而自己成为自己的右孩子。</li></ul> 
<h4 id="%E5%8F%98%E8%89%B2">变色</h4> 
<p>下面说下变色：</p> 
<p>结点21和结点22都是红色，需要进行调整</p> 
<p><img alt="" height="680" src="https://images2.imgbox.com/6f/4f/SCZE5Evd_o.png" width="1164">​</p> 
<p>将结点22变成黑色</p> 
<p><img alt="" height="680" src="https://images2.imgbox.com/f0/31/eSqOdF2U_o.png" width="1164">​</p> 
<p>但又不符合“<strong>从任一结点到其每个叶子的所有路径都包含相同数组的黑色结点</strong>”规则，从根结点13到结点21下的NIL结点，共有4个黑色结点，其他路径有3个黑色结点。</p> 
<p>所以将结点25变成红色结点，如下：</p> 
<p><img alt="" height="680" src="https://images2.imgbox.com/b8/4d/enOJbUgh_o.png" width="1164">​</p> 
<p>此时发现结点25和结点27都是红色结点，所以将结点27变为黑色结点。</p> 
<p><img alt="" height="680" src="https://images2.imgbox.com/e7/42/2NVPmMNF_o.png" width="1164">​</p> 
<p>总之，变色就是改变结点的颜色，要么是红色，要么是黑色，然后调整成符合红黑树的规则。</p> 
<h4 id="%E5%B7%A6%E6%97%8B%E5%92%8C%E5%8F%B3%E6%97%8B">左旋和右旋</h4> 
<p>关于左旋和右旋可以查看AVL树中的旋转：<a href="https://blog.csdn.net/cnds123321/article/details/113994757">数据结构之树（3）——二叉平衡树（AVL）</a></p> 
<p>左旋转，在上面已经说了</p> 
<p><img alt="" height="582" src="https://images2.imgbox.com/22/b8/apS1nPcU_o.png" width="1200">​</p> 
<p>右旋转，上面也讲了的</p> 
<p><img alt="" height="588" src="https://images2.imgbox.com/76/65/9jtEWArO_o.png" width="1200">​</p> 
<p>但什么时候用变色，什么时候又用旋转呢，这很复杂，红黑树的插入和删除都需要判断调整是否符合红黑树的规则，然后调整。</p> 
<p>下面通过其他参考资料来试图说明下红黑树插入和删除的各种情况：</p> 
<h3 id="%E6%8F%92%E5%85%A5">插入</h3> 
<h4 id="%E6%8F%92%E5%85%A5%E6%83%85%E5%86%B5%E5%88%86%E6%9E%90">插入情况分析</h4> 
<p>红黑树的插入同二叉排序树的插入过程相似，但红黑树插入新结点后，需要判断红黑树是否符合定义要求，如果不符合，租需要进行调整，以满足红黑树的性质。</p> 
<p>认识下结点的标记</p> 
<p><img alt="" height="580" src="https://images2.imgbox.com/6b/31/dBmyHaXS_o.png" width="712"></p> 
<p><strong>第一种情况：如果插入的结点是根结点，那么该结点颜色调整为黑色</strong></p> 
<p><img alt="" height="148" src="https://images2.imgbox.com/06/da/EABKV6uI_o.png" width="251">​</p> 
<p>但发现不满足“根结点是黑色的”，所以需要调整，将根结点调整为黑色。</p> 
<p><img alt="" height="144" src="https://images2.imgbox.com/81/bb/1i9nmaXO_o.png" width="209">​</p> 
<p>这时发现红黑树的所有要求被满足。</p> 
<p><strong>第二种情况：待插入结点的父结点是黑色，不需要调整</strong></p> 
<p><img alt="" height="197" src="https://images2.imgbox.com/02/56/1OvipU66_o.png" width="669">​</p> 
<p><strong>第三种情况：待插入结点的父结点是红色，同时叔叔结点也是红色，需要调整 </strong></p> 
<p><img alt="" height="411" src="https://images2.imgbox.com/af/3a/tG3giOmU_o.png" width="767">​</p> 
<p>发现新插入的结点N和父结点P是连续红色，需要调整红黑树。</p> 
<p>调整方法：<em>将父亲结点P和叔叔结点U重新绘制为黑色，祖父结点G绘制为红色</em>。但是，如果此处祖父结点G为根节点，那么需要调用红黑树修正程序，将祖父结点绘制为黑色，如果祖父结点G被染成红色后，可能和它的父结点形成连续的红色结点，此时需要递归向上调整。</p> 
<p><img alt="" height="411" src="https://images2.imgbox.com/8b/5f/kZd05zSh_o.png" width="767">​</p> 
<p><strong>第四种情况：待插入结点的父结点是红色，同时叔叔结点是黑色，需要调整</strong></p> 
<p>在满足父节点是红色，叔叔节点是黑色的条件下，又可以分以下几种情况：</p> 
<ul><li><strong>情况一</strong>：父结点P是祖父结点G的左子结点，待插入结点N是父结点的左子结点</li></ul> 
<p><img alt="" height="714" src="https://images2.imgbox.com/39/a2/H21t2B7T_o.png" width="1200"></p> 
<p>调整方法：以祖父结点G为支点进行右旋，然后将父结点P染黑，祖父结点G染红。</p> 
<p><img alt="" height="955" src="https://images2.imgbox.com/c1/29/A8Lk79ik_o.png" width="1200"></p> 
<p>说明：</p> 
<ul><li>①表示新插入结点N后，红黑树失衡，需要调整连续的红色结点N和P。</li><li>②不重要，将N和U及其子树当作一个整体，促成右旋转的形式，为右旋转做准备。</li><li>③不重要，这其实就是右旋转的过程，一步步拆分来的。</li><li>④不重要，将当成整体的绿色三角形N和U再次组装成完整的，即右旋转完成后的结果。</li><li>⑤对父结点P染成黑色，祖父结点G染成红色，这是最后一步，其实网上的资料只有①和⑤两步，这里只是把每一个步骤都拆分了。</li></ul> 
<p>下面说第二种情况。</p> 
<ul><li><strong>情况二</strong>：父结点P是祖父结点的右子结点，待插入结点N是父结点P的右子结点</li></ul> 
<p><img alt="" height="704" src="https://images2.imgbox.com/6e/9c/dxJv4UYZ_o.png" width="1200"></p> 
<p>调整方法：以祖父结点G为支点进行左旋，然后将父结点P染黑，祖父结点染红。</p> 
<p><img alt="" height="800" src="https://images2.imgbox.com/9a/44/a7ZeGKmD_o.png" width="1200"></p> 
<p>说明：</p> 
<ul><li>①表示新插入结点N后，红黑树失衡，需要调整连续的红色结点N和P。</li><li>②不重要，将N和U及其子树当作一个整体，促成右旋转的形式，为右旋转做准备。</li><li>③不重要，这其实就是左旋转的过程，一步步拆分来的。</li><li>④不重要，将当成整体的绿色三角形N和U再次组装成完整的，即右旋转完成后的结果。</li><li>⑤对父结点P染成黑色，祖父结点G染成红色，这是最后一步，其实网上的资料只有①和⑤两步，这里只是把每一个步骤都拆分了。</li></ul> 
<p>下面说明第三种情况。</p> 
<p><strong>情况三</strong>：父结点P是祖父结点的左子结点，待插入结点N是父结点P的右子结点</p> 
<p><img alt="" height="713" src="https://images2.imgbox.com/21/af/b9KAl76J_o.png" width="1200"></p> 
<p>调整方法：以父结点P为支点进行左旋，然后做<strong>情况一</strong>处理。</p> 
<p><img alt="" height="944" src="https://images2.imgbox.com/d7/83/02mvvdlH_o.png" width="1200"></p> 
<p>说明：</p> 
<ul><li>①表示失衡的情况，需要进行调整。</li><li>②单独把以P为根结点的子树提取出来，当成一个分支来处理。</li><li>③将绿色框内的子树以P结点为支点进行左旋转，紫色框内是左旋转的步骤，每一步分开来的。</li><li>④将旋转完成的分支组合到②中</li><li>⑤此时的情况与“情况一”中一致，使用情况一中的调整方法进行调整即可。</li></ul> 
<p>下面说明第四种情况。</p> 
<p><strong>情况四</strong>：父结点P是祖父结点G的右子结点，待插入结点N是父结点的左子结点</p> 
<p><img alt="" height="702" src="https://images2.imgbox.com/be/2f/NKpkfd0d_o.png" width="1200"></p> 
<p>调整方法：以父结点P为支点进行右旋转，旋转后，然后做<strong>情况二</strong>处理。</p> 
<p><img alt="" height="832" src="https://images2.imgbox.com/53/43/p8wOxrxr_o.png" width="1200"></p> 
<p>说明：</p> 
<ul><li>①表示失衡的情况，需要进行调整。</li><li>②单独把以P为根结点的子树提取出来，当成一个分支来处理。</li><li>③将绿色框内的子树以P结点为支点进行右旋转，紫色框内是右旋转的步骤，每一步分开来的。</li><li>④将旋转完成的分支组合到②中</li><li>⑤此时的情况与“情况二”中一致，使用情况二中的调整方法进行调整即可。</li></ul> 
<h4 id="%E6%8F%92%E5%85%A5%E5%B9%B3%E8%A1%A1%E6%80%BB%E7%BB%93">插入平衡总结</h4> 
<p>红黑树插入元素总结：</p> 
<p><img alt="" height="397" src="https://images2.imgbox.com/81/fe/r1lxY5YV_o.png" width="1200"></p> 
<h4 id="%E6%8F%92%E5%85%A5%E5%AE%9E%E4%BE%8B">插入实例</h4> 
<p>实例：用如下序列{10，20，15，30，5，8}绘制红黑树</p> 
<p>第一步：插入10，由于是第一个插入的结点，所以是根结点</p> 
<p><img alt="" height="167" src="https://images2.imgbox.com/5e/ce/sTYW95dn_o.png" width="204"></p> 
<p>按照上面的总结，需要将N染黑。</p> 
<p><img alt="" height="73" src="https://images2.imgbox.com/e6/b0/EW5gMUyM_o.png" width="127"></p> 
<p>第二步：插入20</p> 
<p><img alt="" height="199" src="https://images2.imgbox.com/7f/04/Nv8VCLzz_o.png" width="141"></p> 
<p>根据上面的总结，父结点为黑色，不需要调整。</p> 
<p>第三步：插入15</p> 
<p><img alt="" height="335" src="https://images2.imgbox.com/1b/e7/BBNYEzEe_o.png" width="203"></p> 
<p>根据上面的总结，N的父结点P是红色，N的叔叔结点没有，所以是第四种情况，但父结点20是祖父结点10的右子结点，N结点15是父结点20的左子，所以是情形四，故先以父结点20为支点进行右旋。</p> 
<p><img alt="" height="621" src="https://images2.imgbox.com/c9/94/VtsYsHOH_o.png" width="1200"></p> 
<p>现在以20为N结点，然后结点20的父结点15是红色，没有叔叔结点，同时父结点20是祖父结点10的右子结点，N结点20是父结点15的右子，满足“情形二”，所以调整是以祖父结点10为支点进行左旋，染黑原父结点15，染红原祖父结点10。</p> 
<p><img alt="" height="621" src="https://images2.imgbox.com/1c/38/OxYiG4sl_o.png" width="1200"></p> 
<p>所以整理并染色如下：</p> 
<p><img alt="" height="334" src="https://images2.imgbox.com/7e/1c/pD01EuuT_o.png" width="1063"></p> 
<p>第四步：插入30</p> 
<p><img alt="" height="364" src="https://images2.imgbox.com/06/b7/dI7KNHs1_o.png" width="676"></p> 
<p>现在N结点是30，N的父结点20是红色，N的叔叔结点10也是红色，所以满足第三种情况，所以调整的方法是染黑父结点20和叔叔结点10，并且染红祖父结点15.。</p> 
<p><img alt="" height="367" src="https://images2.imgbox.com/fc/4c/vIcRzFfB_o.png" width="1012"></p> 
<p>发现根结点15是红色的，不符合红黑树要求，所以将根结点染黑。</p> 
<p><img alt="" height="364" src="https://images2.imgbox.com/63/e0/aFSsxUIo_o.png" width="923"></p> 
<p>第五步：插入5</p> 
<p><img alt="" height="368" src="https://images2.imgbox.com/64/26/8f0mPdye_o.png" width="968"></p> 
<p>现在N结点是5，N结点的父结点是黑色，所以不需要进行调整红黑树。</p> 
<p>第六步：插入8</p> 
<p><img alt="" height="533" src="https://images2.imgbox.com/97/1b/jylxgqyn_o.png" width="955"></p> 
<p>现在N结点是8，N结点的父结点5是红色结点，N结点没有叔叔结点，所以是第四种情况，同时父结点5是祖父结点10的左子结点，N是父结点5的右子结点，所以是情形三。</p> 
<p>以父结点5为支点进行左旋。</p> 
<p><img alt="" height="544" src="https://images2.imgbox.com/45/48/YZ7v39RG_o.png" width="1067"></p> 
<p>现在N结点是5，由于父结点8是祖父结点10的左子结点，N是父结点8的左子结点，所以调整红黑树的方式是以祖父结点10右旋，染黑原父结点8，染红原祖父结点10。</p> 
<p><img alt="" height="521" src="https://images2.imgbox.com/b1/37/gmGiMNaq_o.png" width="1200"></p> 
<h3 id="%E5%88%A0%E9%99%A4">删除</h3> 
<h4 id="%E6%A6%82%E8%BF%B0">概述</h4> 
<p>删除红黑树结点的操作分为查找到要被删除的结点，然后就是删除该结点即可，最麻烦的就是删除结点后重新维持红黑树平衡的问题。</p> 
<p>删除结点有3种情景：</p> 
<ul><li>第一种：若删除结点没有子结点，直接删除。</li><li>第二种：若删除结点只有一个子结点，用子结点替换删除结点。</li><li>第三种：若删除结点有两个子结点，同二叉搜索树一样，用后继结点（要么是它的左子树中的最大元素，要么是它的右子树的最小元素）替换删除结点。</li></ul> 
<p>删除的三种情况其实根二叉排序树的删除是一样的，因为红黑树首先是一棵二叉排序树。</p> 
<p>所以可以参考：<a href="https://blog.csdn.net/cnds123321/article/details/113994581">数据结构之树（2）——二叉查找树和二叉排序树</a></p> 
<p>先要约定下结点名称：</p> 
<p><img alt="" height="726" src="https://images2.imgbox.com/99/44/Co7xKwxQ_o.png" width="1144"></p> 
<p>删除结点后就会面临一个情况：红黑树是否还平衡？如果平衡则不需要进行调整，否则需要进行调整。</p> 
<p>平衡是在删除黑色叶子结点后才发生的操作，比如P-&gt;D-&gt;N，删除黑色结点D后，变成P-&gt;N，导致经过N的路径的黑色结点数量减少1个，所以需要进行平衡处理。</p> 
<h4 id="%E5%88%A0%E9%99%A4%E6%83%85%E5%86%B5%E5%88%86%E6%9E%90">删除情况分析</h4> 
<p>调整删除结点后的红黑树平衡有如下几种情况：</p> 
<p><strong>第一种情况：结点N是根结点，无需调整</strong></p> 
<p>当删除的结点是根结点，那么无需调整平衡，因为所有路径都少一个黑色结点，仍然保持平衡。例如：</p> 
<p><img alt="" height="716" src="https://images2.imgbox.com/47/52/C6Pc3deE_o.png" width="1197"></p> 
<p><strong>第二种情况：兄弟结点S是黑色的</strong></p> 
<p>但在该种情况下又分为好几种不同情形：</p> 
<ul><li><strong>情况一</strong>：兄弟结点S的所有子结点都是黑色，即SR和SL都是黑色的。</li></ul> 
<p><img alt="" height="525" src="https://images2.imgbox.com/49/14/9KNwUfVL_o.png" width="580"></p> 
<p>又分为两种情形：父结点P是红色还是黑色？</p> 
<p>下面来处理父结点P是红还是黑的情况：</p> 
<ul><li> 
  <ul><li>情形一：父结点P为黑色</li></ul></li></ul> 
<p>调整方法：染红兄弟结点S，将父结点P作为新的N结点，递归处理。</p> 
<p><img alt="" height="356" src="https://images2.imgbox.com/a4/ec/Kfo9aUk6_o.png" width="1100"></p> 
<p>为什么需要递归处理？</p> 
<ul><li> 
  <ul><li>情形二：父结点P为红色</li></ul></li></ul> 
<p>调整方法：染红兄弟结点S，染黑父结点P，平衡完成。</p> 
<p><img alt="" height="356" src="https://images2.imgbox.com/ae/55/m3NfEkWu_o.png" width="1100"></p> 
<ul><li><strong>情况二</strong>：兄弟结点S的子结点不全黑。</li></ul> 
<p>不全黑包括3种情况：SL黑SR红、SL红SR黑、SL红SR红。所以得出结论：如果其中一个为黑，另外一个肯定是红。</p> 
<p>之所以以全黑与不全黑进行分类，因为兄弟结点S可能是父结点P的左子结点，也可能是右子结点。如果是全黑，那么兄弟结点S无论是左子结点还是右子结点，处理方式一样；但如果不是全黑，那么就要看兄弟结点S所处的位置，进行特定方向的旋转。</p> 
<ul><li> 
  <ul><li>情形一：兄弟结点S是父结点P的左子结点，SL结点红色，SR结点颜色未知</li></ul></li></ul> 
<p>调整方法：以父结点P为支点进行右旋，交换父结点P和兄弟结点S的颜色，染黑兄弟结点的左子结点SL，平衡完成。</p> 
<p><img alt="" height="584" src="https://images2.imgbox.com/ee/cc/pcnZ6bj3_o.png" width="1200"></p> 
<p>其中完整的过程是：</p> 
<ul><li>①不平衡的红黑树，待调整进行平衡。</li><li>②对不平衡的红黑树进行右旋操作，以父结点P为支点进行右旋，里面是右旋的每一步具体步骤。</li><li>③交换P和S的颜色，染黑SL，这里是不知道SR、P、G结点的颜色的，也不在乎。</li></ul> 
<p><img alt="" height="887" src="https://images2.imgbox.com/b5/d0/RrnqyikL_o.png" width="1200"></p> 
<ul><li> 
  <ul><li>情形二：兄弟结点S是父结点P的右子结点，SR结点红色，SL结点颜色未知</li></ul></li></ul> 
<p>与上面的情形一呈镜像关系，所以调整方法：以父结点P为支点进行左旋，旋转后，交换P和S颜色，结点SR染黑。</p> 
<p><img alt="" height="587" src="https://images2.imgbox.com/bc/31/DVyDZmuO_o.png" width="1089"></p> 
<p>其中完整的过程是：</p> 
<ul><li>①不平衡的红黑树，待调整进行平衡。</li><li>②对不平衡的红黑树进行左旋操作，以父结点P为支点进行左旋，里面是左旋的每一步具体步骤，如果不明白是如何左旋的，可能查看步骤，否则直接看上面那张图即可，里面的绿色三角形都是辅助完成左旋操作的，实际上只是为了方便理解，并无实际应用。</li><li>③交换P和S的颜色，染黑SR，这里是不知道SL、P、G结点的颜色的，也不在乎。</li></ul> 
<p><img alt="" height="905" src="https://images2.imgbox.com/fe/46/KSFUQHr1_o.png" width="1200"></p> 
<ul><li> 
  <ul><li>情形三：兄弟结点S是父结点P的左子结点，SL结点黑色，SR结点一定是红色的。</li></ul></li></ul> 
<p>调整方法：以兄弟结点S进行左旋，旋转后，交换结点S和SR的颜色，最后转至【情况二-情形一】处理。</p> 
<p><img alt="" height="790" src="https://images2.imgbox.com/83/43/DRAwusjq_o.png" width="1200"></p> 
<p>旋转完整流程如下：</p> 
<ul><li>①不平衡的红黑树，待调整进行平衡。</li><li>②对不平衡的红黑树进行左旋操作，以兄弟结点S为支点进行左旋，里面是左旋的每一步具体步骤，如果不明白是如何左旋的，可能查看步骤，否则直接看下面那张图即可，里面的绿色三角形都是辅助完成左旋操作的，实际上只是为了方便理解，并无实际应用。</li><li>③交换S和SR的颜色。</li><li>④转至【情况二-情形一】处理，此时SR结点是新的S结点，S结点是新的SL结点。</li></ul> 
<p><img alt="" height="1044" src="https://images2.imgbox.com/a7/04/iMelx5vv_o.png" width="1200"></p> 
<ul><li> 
  <ul><li>情形四：兄弟结点S是父结点P的右子结点，SL结点红色，SR结点是黑色的。</li></ul></li></ul> 
<p>调整方法：以兄弟结点S为支点进行右旋，旋转完成后，交换S和SL的颜色，然后转至【情况二-情形二】</p> 
<p><img alt="" height="799" src="https://images2.imgbox.com/73/b1/26T589qO_o.png" width="1200"></p> 
<p>旋转完整流程如下：</p> 
<ul><li>①不平衡的红黑树，待调整进行平衡。</li><li>②对不平衡的红黑树进行右旋操作，以兄弟结点S为支点进行右旋，里面是右旋的每一步具体步骤，如果不明白是如何右旋的，可能查看步骤，否则直接看下面那张图即可，里面的绿色三角形都是辅助完成右旋操作的，实际上只是为了方便理解，并无实际应用。</li><li>③交换S和SL的颜色。</li><li>④转至【情况二-情形二】处理，此时原SL结点是新的S结点，原S结点是新的SR结点。</li></ul> 
<p><img alt="" height="956" src="https://images2.imgbox.com/fb/be/D0yOF0Wy_o.png" width="1200"></p> 
<p><strong>第三种情况：兄弟结点S是红色的</strong></p> 
<ul><li><strong>情况一</strong>：兄弟结点S是父结点P的左子结点</li></ul> 
<p>调整方法：以父结点P为支点进行右旋，旋转后，交换父结点P和兄弟结点S的颜色，N的兄弟结点变为黑色，转至【第二种情况】处理。</p> 
<p><img alt="" height="678" src="https://images2.imgbox.com/4c/eb/MUa8TEXR_o.png" width="1200"></p> 
<p>右旋的流程就不画了，上面已经画了很多次了。</p> 
<ul><li><strong>情况二</strong>：兄弟结点S是父结点P的右子结点</li></ul> 
<p>调整方法：以父结点P为支点进行左旋，旋转后，交交换父结点P和兄弟结点S的颜色，N的兄弟结点变为黑色，转至【第二种情况】处理。</p> 
<p><img alt="" height="675" src="https://images2.imgbox.com/77/a8/fyz2JyU5_o.png" width="1200"></p> 
<p>至此，红黑树的删除操作也完成了，很复杂，分支特别多。</p> 
<h4 id="%E5%88%A0%E9%99%A4%E5%B9%B3%E8%A1%A1%E6%80%BB%E7%BB%93">删除平衡总结</h4> 
<p>下面总结下。</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/ea/96/TeMRSX31_o.png"></p> 
<h4 id="%E5%88%A0%E9%99%A4%E5%AE%9E%E4%BE%8B">删除实例</h4> 
<p>红黑树的删除实例（此实例来源于<a href="https://www.jianshu.com/p/84416644c080" rel="nofollow">彻底理解红黑树（三）之 删除</a>）</p> 
<p><img alt="" height="652" src="https://images2.imgbox.com/e6/21/Gr2PzptJ_o.png" width="808"></p> 
<p>推荐一个网站：<a href="https://rbtree.phpisfuture.com/" rel="nofollow">红黑树动画在线演示</a></p> 
<p>可以用来查看红黑树的插入/删除/查找等。</p> 
<p><img alt="" height="421" src="https://images2.imgbox.com/37/ca/gR9gdIeB_o.png" width="1029"></p> 
<p>第一步：删除结点50</p> 
<p>待删除的结点50既有左子结点，又有右子结点，所以同二叉排序树的删除一样，寻找一个结点来替换待删除结点，一般选择是右子树的最小结点或左子树的最大结点。</p> 
<p><img alt="" height="652" src="https://images2.imgbox.com/f1/8a/ONraizLG_o.png" width="808"></p> 
<p>如果选择的是左子树的最大结点，那么就是使用结点40交换结点50，结点50没有子结点，可以直接删除结点50。</p> 
<p><img alt="" height="684" src="https://images2.imgbox.com/be/c9/wBDI1Dj1_o.png" width="1200"></p> 
<p>同网站测试结果一样</p> 
<p><img alt="" height="295" src="https://images2.imgbox.com/95/bd/Pj0yVkTP_o.png" width="490"></p> 
<p>如果选择的是右子树的最小结点，那么就是使用结点60交换结点50，交换后，发现结点50只有一棵右子树，按照二叉排序树的删除规则，直接将右子树的根结点连接在结点50的父结点60上，然后染黑结点70，保证黑色结点的数量，结果如下图：</p> 
<p><img alt="" height="714" src="https://images2.imgbox.com/28/8d/phOqV96Q_o.png" width="1200"></p> 
<p>由于选择不同的结点进行交换，最终导致重新的红黑树不一样。</p> 
<p>第二步：删除结点70</p> 
<p><strong>注意：只有当删除掉黑色的叶子结点后才会触发红黑树的平衡操作。</strong></p> 
<p>该结点没有任何子结点，直接删除。</p> 
<p>（这里最开始删除结点70选用的是右子树最小结点60进行交换，所以图是这样的）</p> 
<p><img alt="" height="658" src="https://images2.imgbox.com/b2/ff/Kyhdte2b_o.png" width="1200"></p> 
<p>但是，注意，刚才删除的结点70是黑色结点，会导致红黑树失衡，必须进行调整，可以看到从根结点到左子树的其他叶子结点的黑色结点个数是3（包含NIL在内），但到右子树的叶子结点的黑色结点个数是2（包含NIL在内），违反了红黑树的第五条性质。</p> 
<p>平衡第一步：以结点60为支点右旋，交换结点60和结点20的颜色，详细流程如下：</p> 
<p><img alt="" height="889" src="https://images2.imgbox.com/e0/5f/MbB2IbB3_o.png" width="1200"></p> 
<p>进行调整后，发现结点N的兄弟结点30是黑色的，所以转至【第二种情况】处理，观察发现兄弟结点30的子结点不全是黑色，同时兄弟结点30是父结点60的左子结点，并且SR结点40是红色，SL结点‘NIL’是黑色，所以符合【第二种情况 - 情况二 - 情形三】。</p> 
<p>平衡第二步：以结点30为支点左旋，交换结点30和结点40的颜色，详细流程如下：</p> 
<p><img alt="" height="928" src="https://images2.imgbox.com/b6/10/sEHTtaUZ_o.png" width="1200"></p> 
<p>进行调整后，需要转至【第二种情况-情况二-情形一】，观察发现也符合，结点N的兄弟结点40是黑色的，结点40的子结点不全是黑色，兄弟结点40是父结点60的左子结点，结点40的SL左子结点30是红色，结点SR是'NIL'黑色的，所以符合，进行调整。</p> 
<p>平衡第三步：以结点60为支点右旋，交换结点60和结点40的颜色，染黑结点30，详细流程如下：</p> 
<p><img alt="" height="920" src="https://images2.imgbox.com/bd/e3/Zx3LOyQW_o.png" width="1200"></p> 
<p>到此删除结点70所造成的平衡问题得以解决，总结如下：</p> 
<p><img alt="" height="801" src="https://images2.imgbox.com/21/c4/aFZLUiEK_o.png" width="1200"></p> 
<p>第三步：删除结点60</p> 
<p>结点60没有子结点，可以直接删除，删除后结点40的右子结点指向NIL</p> 
<p><img alt="" height="544" src="https://images2.imgbox.com/a9/8c/Xbv8ZtTV_o.png" width="1200"></p> 
<p>但注意，被删除的结点60是黑色叶子结点，删除后红黑树失衡，从结点20到其他叶子结点的黑色结点个数是3个（包含NIL在内），而到结点40的右子树叶子结点的黑色结点个数只有2个（包含NIL在内），违反了红黑树的第五条性质，所以需要进行调整。</p> 
<p>观察发现N结点的兄弟结点30是黑色的，并且结点30的子结点都是黑色，同时结点30的父结点是红色的，符合【第二种情况-情况一-情形二】，进行调整。</p> 
<p>平衡第一步：交换结点30和结点40的颜色，平衡完成。</p> 
<p><img alt="" height="694" src="https://images2.imgbox.com/f8/e6/IrOuqQma_o.png" width="1200"></p> 
<p>所以删除结点60的完整过程如下：</p> 
<p><img alt="" height="695" src="https://images2.imgbox.com/29/36/tSO30qAD_o.png" width="1200"></p> 
<p>第四步：删除结点10</p> 
<p>结点10没有子结点，可以直接删除。</p> 
<p><img alt="" height="556" src="https://images2.imgbox.com/84/d6/FqII3scO_o.png" width="1200"></p> 
<p>但注意，被删除的叶子结点10是黑色的叶子结点，删除后，红黑树就会失衡，因为原来经过结点10的路径的黑色结点个数少了一个，从根结点到其他叶子结点的路径中黑色结点个数是3个（包含NIL在内），但到结点20的左子树路径中黑色结点个数只有2个（包含NIL在内）所以必须进行调整。</p> 
<p>观察发现N结点的兄弟结点40是黑色的，但它的子结点不全是黑色的，同时结点40是父结点20的右子结点，结点40的左子结点30是红色的，符合【第二种情况-情况二-情形四】，进行调整。</p> 
<p>平衡第一步：以结点40为支点右旋，交换结点40和结点30的颜色，转至【第二种情况-情况二-情形二】</p> 
<p><img alt="" height="1033" src="https://images2.imgbox.com/4a/cd/qVx5MH2V_o.png" width="1200"></p> 
<p>观察发现结点N的兄弟结点30仍然是黑色的，兄弟结点30的子结点不全是黑色的，同时兄弟结点30是父结点20的右子，兄弟结点30的右子结点是红色的，所以按照【第二种情况-情况二-情形二】处理。</p> 
<p>平衡第二步：以父结点20为支点左旋，交换结点20和结点30的颜色，染黑结点40，平衡完成</p> 
<p><img alt="" height="860" src="https://images2.imgbox.com/db/ec/UZHVjWb6_o.png" width="1200"></p> 
<p>所以删除结点10的完整过程如下：</p> 
<p><img alt="" height="710" src="https://images2.imgbox.com/2f/16/6LZMe8BW_o.png" width="1200"></p> 
<p>第五步：删除结点20</p> 
<p>结点20没有子结点，直接删除即可。</p> 
<p><img alt="" height="386" src="https://images2.imgbox.com/ca/83/fuAa4Nxv_o.png" width="1200"></p> 
<p>但注意，结点20是黑色叶子结点，删除后会导致红黑树失衡，需要调整。</p> 
<p>观察发现结点N的兄弟结点40是黑色的，并且结点40的子结点都是黑色的，同时结点40的父结点30也是黑色的，按照【第二种情况 - 情况一 - 情形一】处理。</p> 
<p>平衡第一步：染红结点40，将父结点30作为新的N结点，递归处理。</p> 
<p><img alt="" height="515" src="https://images2.imgbox.com/54/ef/wQARfGCe_o.png" width="1200"></p> 
<p>删除结点20的完整过程如下：</p> 
<p><img alt="" height="514" src="https://images2.imgbox.com/07/25/Zz1NO4p2_o.png" width="1200"></p> 
<p>至此，就已经完成了红黑树删除结点的学习。</p> 
<p>注意，无论替换采用的是左子树的最大结点，还是右子树的最小结点，最后删除的结果都是一样，如测试网站最终的结果。</p> 
<p><img alt="" height="232" src="https://images2.imgbox.com/5b/34/Dx1RbXDR_o.png" width="335"></p> 
<p>红黑树广泛应用于JDK中，如TreeMap、TreeSet和HashMap，而了解红黑树的目的现阶段就是为了阅读HashMap的源码。</p> 
<p> </p> 
<h3 id="%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5">参考链接</h3> 
<ul><li><a href="https://mp.weixin.qq.com/s?__biz=MzIxMjE5MTE1Nw==&amp;mid=2653191832&amp;idx=1&amp;sn=12017161025495c6914b5ab9397baa59&amp;chksm=8c990c42bbee8554ba02eb83d839123bd3bead6ffc736111456ea77367a3df75750cf88016e0&amp;scene=21#wechat_redirect" rel="nofollow">漫画：什么是红黑树？ </a></li><li><a href="https://zhuanlan.zhihu.com/p/91960960" rel="nofollow">一文带你彻底读懂红黑树（附详细图解）</a></li><li><a href="https://www.jianshu.com/p/96e652ccf720" rel="nofollow">彻底理解红黑树（二）之 插入</a></li><li><a href="https://www.jianshu.com/p/84416644c080" rel="nofollow">彻底理解红黑树（三）之 删除</a></li><li><a href="https://wenku.baidu.com/view/15bf3c71f12d2af90242e6c4.html" rel="nofollow">红黑树 - 维基百科</a></li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/39d8912da995375fb2fb57a36df41774/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">PyQt5开发环境搭建</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/35d2b109c34769b4f2fa017527c23307/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Kafka 如何给集群配置SSL认证</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>