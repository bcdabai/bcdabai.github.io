<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>简单的用Python采集股票数据，保存表格后分析历史数据 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="简单的用Python采集股票数据，保存表格后分析历史数据" />
<meta property="og:description" content="前言 字节跳动如果上市，那么钟老板将成为我国第一个世界首富
趁着现在还没上市，咱们提前学习一下用Python分析股票历史数据，抱住粗大腿坐等起飞~
好了话不多说，我们直接开始正文
准备工作 环境使用
Python 3.10 解释器Pycharm 编辑器 模块使用
requests —&gt; 数据请求模块csv -&gt; 保存csv表格pandas -&gt; 可以实现保存Excel表格文件 requests和pandas是第三方模块，需要手动安装，直接pip install 加上模块名字即可。
案例实现流程 数据来源分析
明确需求: 明确采集的网站以及数据内容
- 网址: 本次目标
- 数据: 股票数据
抓包分析: 分析 股票数据, 可以请求那个网址能够得到
- 打开开发者工具: F12 / 右键点击检查选择 network (网络)
- 点击第二页数据
请求网址: 请求方式: 请求头: 代码实现步骤
发送请求 -&gt; 模拟浏览器对于url发送请求获取数据 -&gt; 获取服务器返回响应数据 &lt;整个数据&gt;解析数据 -&gt; 提取我们需要数据保存数据 -&gt; 保存表格文件 &lt; csv / Excel &gt; 中 代码解析 保存表格文件
csv -&gt; csv模块Excel -&gt; pandas模块 # 创建文件对象 f = open(&#39;股票." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/d641cc153883fd5fc2a678e4797e2507/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-23T21:54:58+08:00" />
<meta property="article:modified_time" content="2023-11-23T21:54:58+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">简单的用Python采集股票数据，保存表格后分析历史数据</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>前言</h2> 
<p>字节跳动如果上市，那么钟老板将成为我国第一个世界首富</p> 
<p><img src="https://images2.imgbox.com/18/13/rxgXInWs_o.png" alt=""><br> 趁着现在还没上市，咱们提前学习一下用Python分析股票历史数据，抱住粗大腿坐等起飞~</p> 
<p>好了话不多说，我们直接开始正文</p> 
<h2><a id="_10"></a>准备工作</h2> 
<p>环境使用</p> 
<ul><li>Python 3.10 解释器</li><li>Pycharm 编辑器</li></ul> 
<p>模块使用</p> 
<ul><li>requests —&gt; 数据请求模块</li><li>csv -&gt; 保存csv表格</li><li>pandas -&gt; 可以实现保存Excel表格文件</li></ul> 
<p><code>requests</code>和<code>pandas</code>是第三方模块，需要手动安装，直接pip install 加上模块名字即可。</p> 
<h2><a id="_24"></a>案例实现流程</h2> 
<p><strong>数据来源分析</strong></p> 
<ol><li> <p>明确需求: 明确采集的网站以及数据内容<br> - 网址: <a href="https://xueqiu.com/" rel="nofollow">本次目标</a><br> - 数据: 股票数据</p> </li><li> <p>抓包分析: 分析 股票数据, 可以请求那个网址能够得到<br> - 打开开发者工具: F12 / 右键点击检查选择 network (网络)<br> - 点击第二页数据</p> <pre><code> 请求网址:
 请求方式:
 请求头:
</code></pre> </li></ol> 
<p><strong>代码实现步骤</strong></p> 
<ol><li>发送请求 -&gt; 模拟浏览器对于url发送请求</li><li>获取数据 -&gt; 获取服务器返回响应数据 &lt;整个数据&gt;</li><li>解析数据 -&gt; 提取我们需要数据</li><li>保存数据 -&gt; 保存表格文件 &lt; csv / Excel &gt; 中</li></ol> 
<h2><a id="_47"></a>代码解析</h2> 
<p><strong>保存表格文件</strong></p> 
<ol><li>csv -&gt; csv模块</li><li>Excel -&gt; pandas模块</li></ol> 
<pre><code class="prism language-python"><span class="token comment"># 创建文件对象</span>
f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'股票.csv'</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'w'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">,</span> newline<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span>
<span class="token comment"># fieldnames 字段名 表头一行数据 &lt;前面保存字典的键&gt;</span>
csv_writer<span class="token operator">=</span> csv<span class="token punctuation">.</span>DictWriter<span class="token punctuation">(</span>f<span class="token punctuation">,</span> fieldnames<span class="token operator">=</span><span class="token punctuation">[</span>
    <span class="token string">'股票代码'</span><span class="token punctuation">,</span>
    <span class="token string">'股票名称'</span><span class="token punctuation">,</span>
    <span class="token string">'当前价'</span><span class="token punctuation">,</span>
    <span class="token string">'涨跌额'</span><span class="token punctuation">,</span>
    <span class="token string">'涨跌幅'</span><span class="token punctuation">,</span>
    <span class="token string">'年初至今'</span><span class="token punctuation">,</span>
    <span class="token string">'成交量'</span><span class="token punctuation">,</span>
    <span class="token string">'成交额'</span><span class="token punctuation">,</span>
    <span class="token string">'换手率'</span><span class="token punctuation">,</span>
    <span class="token string">'市盈率(TTM)'</span><span class="token punctuation">,</span>
    <span class="token string">'股息率'</span><span class="token punctuation">,</span>
    <span class="token string">'市值'</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># 写入表头</span>
csv_writer<span class="token punctuation">.</span>writeheader<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 创建一个空列表</span>
content_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
</code></pre> 
<p><strong>发送请求</strong></p> 
<p>模拟浏览器对于url发送请求</p> 
<ul><li>模拟浏览器: headers 请求头 
  <ul><li>从浏览器开发者工具中直接复制</li><li>字典数据类型, 构建完整键值对形式</li></ul> </li><li>请求网址:<br> 从浏览器开发者工具中直接复制</li><li>发送请求:<br> 需要requests模块 -&gt; pip install requests</li></ul> 
<p>&lt;Response [200]&gt; 响应对象 表示请求成功</p> 
<pre><code class="prism language-python"><span class="token comment"># 模拟浏览器</span>
headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'Cookie'</span><span class="token punctuation">:</span> <span class="token string">'s=av17ye9exq; xq_a_token=cf755d099237875c767cae1769959cee5a1fb37c; xq_r_token=e073320f4256c0234a620b59c446e458455626d9; xq_id_token=eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJ1aWQiOi0xLCJpc3MiOiJ1YyIsImV4cCI6MTcwMTk5NTg4MCwiY3RtIjoxNzAwNTYzOTE3MDU2LCJjaWQiOiJkOWQwbjRBWnVwIn0.EbAa9h0fB9H_sH415f3x8r2CQiKmPbXZMnuKCy401scB1lMQKOffws6WTwPD2UzFWnntYxIQYSJpX509VUYYgCQkZ_bYtLbtYd5PfxLhWx7coauYA4d3x5aZolzB3eP5IthaYAb0Kbj3MPK8LVRBhABpRGr4wajISuABFNezroM_-5dpiOYK7Rk0UXtU2Qhrzxi1BVCgFUhPP-oR_vKenBw5tLzSqa6aO7CukgI7JVb-6LiymuBquE8FE-de8Vs3evai0fvtjiqryrH3EWM3nmDQIayigHRrYo595bD32kUPP4swHF5U2fwbLHTntIRAm9LsXn8sVf-6sUdgHoYZGg; cookiesu=931700563933974; u=931700563933974; device_id=5da9e0ae658f9fcd3d89078312131fb7; Hm_lvt_1db88642e346389874251b5a1eded6e3=1700563934; Hm_lpvt_1db88642e346389874251b5a1eded6e3=1700563934'</span><span class="token punctuation">,</span>
    <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36'</span>
<span class="token punctuation">}</span>
<span class="token keyword">for</span> page <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">58</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'==============正在采集第</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>page<span class="token punctuation">}</span></span><span class="token string">页数据内容=============='</span></span><span class="token punctuation">)</span>
    <span class="token comment"># 请求网址</span>
    url <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'https://stock.雪球.com/v5/stock/screener/quote/list.json?page=</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>page<span class="token punctuation">}</span></span><span class="token string">&amp;size=30&amp;order=desc&amp;order_by=amount&amp;exchange=CN&amp;market=CN&amp;type=sha'</span></span>
    <span class="token comment"># 发送请求</span>
    response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>
</code></pre> 
<p><strong>获取数据</strong></p> 
<p>获取服务器返回响应数据 &lt;整个数据&gt;</p> 
<ul><li>response.text 获取响应文本数据 &lt;字符串&gt;</li><li>response.json() 获取响应json数据 &lt;json数据 大部分情况字典数据&gt;</li><li>response.content 获取响应二进制数据 &lt;保存图片/视频/音频/特定格式文件的时候&gt;</li></ul> 
<p><strong>解析数据</strong></p> 
<p>提取我们需要数据<br> 解决数据方法根据获取数据来选择的:<br> 字典取值方法 -&gt; 键值对取值 (根据冒号左边的内容[键], 提取冒号右边的内容[值])</p> 
<pre><code class="prism language-python">json_data <span class="token operator">=</span> response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 返回json字典数据</span>
<span class="token comment"># for循环遍历</span>
<span class="token keyword">for</span> index <span class="token keyword">in</span> json_data<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'list'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token comment"># 提取数据保存到字典里面, 方便后续保存表格文件</span>
    dit <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">'股票代码'</span><span class="token punctuation">:</span> index<span class="token punctuation">[</span><span class="token string">'symbol'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'股票名称'</span><span class="token punctuation">:</span> index<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'当前价'</span><span class="token punctuation">:</span> index<span class="token punctuation">[</span><span class="token string">'current'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'涨跌额'</span><span class="token punctuation">:</span> index<span class="token punctuation">[</span><span class="token string">'chg'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'涨跌幅'</span><span class="token punctuation">:</span> index<span class="token punctuation">[</span><span class="token string">'percent'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'年初至今'</span><span class="token punctuation">:</span> index<span class="token punctuation">[</span><span class="token string">'current_year_percent'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'成交量'</span><span class="token punctuation">:</span> index<span class="token punctuation">[</span><span class="token string">'volume'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'成交额'</span><span class="token punctuation">:</span> index<span class="token punctuation">[</span><span class="token string">'amount'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'换手率'</span><span class="token punctuation">:</span> index<span class="token punctuation">[</span><span class="token string">'turnover_rate'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'市盈率(TTM)'</span><span class="token punctuation">:</span> index<span class="token punctuation">[</span><span class="token string">'pe_ttm'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'股息率'</span><span class="token punctuation">:</span> index<span class="token punctuation">[</span><span class="token string">'dividend_yield'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'市值'</span><span class="token punctuation">:</span> index<span class="token punctuation">[</span><span class="token string">'market_capital'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token comment"># 保存数据</span>
    csv_writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span>dit<span class="token punctuation">)</span>
    <span class="token comment"># 把字典添加到空列表里面</span>
    content_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>dit<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>dit<span class="token punctuation">)</span>
</code></pre> 
<h2><a id="_145"></a>效果展示</h2> 
<p>获取到数据保存到表格后</p> 
<p><img src="https://images2.imgbox.com/27/4f/DMm5xw74_o.png" alt=""></p> 
<p>采集数据和可视化分析部分的代码我都打包好了，文末名片自取。</p> 
<p><img src="https://images2.imgbox.com/ad/ee/XbXlewXm_o.png" alt=""></p> 
<h2><a id="_155"></a>可视化分析</h2> 
<pre><code class="prism language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd         <span class="token comment"># 做表格数据处理模块 第三方的</span>
<span class="token keyword">from</span> pyecharts<span class="token punctuation">.</span>charts <span class="token keyword">import</span> Bar    <span class="token comment"># 可视化模块 第三方模块</span>
<span class="token keyword">from</span> pyecharts <span class="token keyword">import</span> options <span class="token keyword">as</span> opts   <span class="token comment"># 可视化模块里面的设置模块(图表样式)</span>
 
<span class="token comment"># 1. 读取数据</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'股票.csv'</span><span class="token punctuation">)</span>
x <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'股票名称'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values<span class="token punctuation">)</span>
y <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'成交量'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values<span class="token punctuation">)</span>
 
c <span class="token operator">=</span> <span class="token punctuation">(</span>
    Bar<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>add_xaxis<span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>add_yaxis<span class="token punctuation">(</span><span class="token string">"成交额"</span><span class="token punctuation">,</span> y<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>set_global_opts<span class="token punctuation">(</span>
        xaxis_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>AxisOpts<span class="token punctuation">(</span>axislabel_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>LabelOpts<span class="token punctuation">(</span>rotate<span class="token operator">=</span><span class="token operator">-</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        title_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>TitleOpts<span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">"Bar-旋转X轴标签"</span><span class="token punctuation">,</span> subtitle<span class="token operator">=</span><span class="token string">"解决标签名字过长的问题"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
    <span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string">"成交量图表.html"</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre> 
<p>好了，今天的分享就到这结束了，下次见。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/90de9d7845b62df59664a5529456eac1/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Bypass Paywalls</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d7d5b4f6641b10a00a95248ab2143fb1/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">贷后催收专用分案算法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>