<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Java项目:实验室资源预约管理系统(java&#43;SSM&#43;JSP&#43;easyUI&#43;h-ui&#43;Mysql) - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Java项目:实验室资源预约管理系统(java&#43;SSM&#43;JSP&#43;easyUI&#43;h-ui&#43;Mysql)" />
<meta property="og:description" content="源码获取：俺的博客首页 &#34;资源&#34; 里下载！ 项目介绍 本项目分为管理员与用户两种角色；
管理员角色包含以下功能：
管理员登录,菜单管理,角色管理,修改密码,用户管理,学院班级管理,日志列表管理,
实验室管理,设备管理,设备申请管理,查看我的设备申请,实验室申请管理,查看我的实验室申请等功能。
用户角色包含以下功能：
用户登录,修改密码,查看用户列表,实验室管理,设备管理等功能。
环境需要 1.运行环境：最好是java jdk 1.8，我们在这个平台上运行的。其他版本理论上也可以。
2.IDE环境：IDEA，Eclipse,Myeclipse都可以。推荐IDEA;
3.tomcat环境：Tomcat 7.x,8.x,9.x版本均可
4.硬件环境：windows 7/8/10 1G内存以上；或者 Mac OS； 5.数据库：MySql 5.7版本；
6.是否Maven项目：是；
技术栈 1. 后端：Spring&#43;SpringMVC&#43;Mbytes
2. 前端：JSP&#43;css&#43;javascript&#43;jQuery&#43;easyUI&#43;h-ui
使用说明 1. 使用Navicat或者其它工具，在mysql中创建对应名称的数据库，并导入项目的sql文件；
2. 使用IDEA/Eclipse/MyEclipse导入项目，Eclipse/MyEclipse导入时，若为maven项目请选择maven;
若为maven项目，导入成功后请执行maven clean;maven install命令，然后运行；
3. 将项目中db.properties配置文件中的数据库配置改为自己的配置;
4. 运行项目，在浏览器中输入localhost:8080/ssm_ziyuan_yuyue
用户管理控制器: /** * 用户管理控制器 * */ @RequestMapping(&#34;/admin/user&#34;) @Controller public class UserController { @Autowired private UserService userService; @Autowired private RoleService roleService; @Autowired PartService partService; /** * 用户列表页面 * @param model * @return */ @RequestMapping(value=&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/57b887d391a972234b9469568260dfb1/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-07-06T08:50:18+08:00" />
<meta property="article:modified_time" content="2022-07-06T08:50:18+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Java项目:实验室资源预约管理系统(java&#43;SSM&#43;JSP&#43;easyUI&#43;h-ui&#43;Mysql)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <blockquote> 
 <h2><span style="color:#fe2c24;">源码获取：俺的博客首页 "资源" 里下载！</span></h2> 
</blockquote> 
<h3>项目介绍</h3> 
<p>本项目分为管理员与用户两种角色；</p> 
<p>管理员角色包含以下功能：<br> 管理员登录,菜单管理,角色管理,修改密码,用户管理,学院班级管理,日志列表管理,<br> 实验室管理,设备管理,设备申请管理,查看我的设备申请,实验室申请管理,查看我的实验室申请等功能。</p> 
<p>用户角色包含以下功能：<br> 用户登录,修改密码,查看用户列表,实验室管理,设备管理等功能。</p> 
<h3>环境需要</h3> 
<p>1.运行环境：最好是java jdk 1.8，我们在这个平台上运行的。其他版本理论上也可以。<br> 2.IDE环境：IDEA，Eclipse,Myeclipse都可以。推荐IDEA;<br> 3.tomcat环境：Tomcat 7.x,8.x,9.x版本均可<br> 4.硬件环境：windows 7/8/10 1G内存以上；或者 Mac OS； <br> 5.数据库：MySql 5.7版本；<br> 6.是否Maven项目：是；</p> 
<h3>技术栈</h3> 
<p>1. 后端：Spring+SpringMVC+Mbytes<br> 2. 前端：JSP+css+javascript+jQuery+easyUI+h-ui</p> 
<h3>使用说明</h3> 
<p>1. 使用Navicat或者其它工具，在mysql中创建对应名称的数据库，并导入项目的sql文件；<br> 2. 使用IDEA/Eclipse/MyEclipse导入项目，Eclipse/MyEclipse导入时，若为maven项目请选择maven;<br> 若为maven项目，导入成功后请执行maven clean;maven install命令，然后运行；<br> 3. 将项目中db.properties配置文件中的数据库配置改为自己的配置;<br> 4. 运行项目，在浏览器中输入localhost:8080/ssm_ziyuan_yuyue</p> 
<p><img alt="" height="832" src="https://images2.imgbox.com/ba/08/ucEqWb9D_o.jpg" width="1200"></p> 
<p> <img alt="" height="945" src="https://images2.imgbox.com/8e/c8/mRmN5WwJ_o.jpg" width="1200"></p> 
<p> <img alt="" height="945" src="https://images2.imgbox.com/7b/24/uxwXkidF_o.jpg" width="1200"></p> 
<p> <img alt="" height="830" src="https://images2.imgbox.com/b5/83/C5UKFGY8_o.jpg" width="1200"></p> 
<p> <img alt="" height="833" src="https://images2.imgbox.com/be/47/yQ5HanpT_o.jpg" width="1200"></p> 
<p> <img alt="" height="838" src="https://images2.imgbox.com/3d/b4/lJjQ1TRx_o.jpg" width="1200"></p> 
<h3></h3> 
<h3>用户管理控制器: </h3> 
<pre><code>/**
 * 用户管理控制器
 *
 */
@RequestMapping("/admin/user")
@Controller
public class UserController {
	@Autowired
	private UserService userService;
	@Autowired
	private RoleService roleService;
	@Autowired
	PartService partService;
	
	/**
	 * 用户列表页面
	 * @param model
	 * @return
	 */
	@RequestMapping(value="/list",method=RequestMethod.GET)
	public ModelAndView list(ModelAndView model){
		Map&lt;String, Object&gt; queryMap = new HashMap&lt;String, Object&gt;();
		model.addObject("roleList", roleService.findList(queryMap));
		model.addObject("partList", partService.list());
		model.setViewName("user/list");
		return model;
	}
	
	/**
	 * 获取用户列表
	 * @param page
	 * @param username
	 * @param roleId
	 * @param sex
	 * @return
	 */
	@RequestMapping(value="/list",method=RequestMethod.POST)
	@ResponseBody
	public Map&lt;String, Object&gt; getList(Page page,
			@RequestParam(name="username",required=false,defaultValue="") String username,
			@RequestParam(name="roleId",required=false) Long roleId,
			@RequestParam(name="pid",required=false) Long pid,
			@RequestParam(name="sex",required=false) Integer sex
			){
		Map&lt;String, Object&gt; ret = new HashMap&lt;String, Object&gt;();
		Map&lt;String, Object&gt; queryMap = new HashMap&lt;String, Object&gt;();
		queryMap.put("username", username);
		queryMap.put("roleId", roleId);
		queryMap.put("pid", pid);
		queryMap.put("sex", sex);
		queryMap.put("offset", page.getOffset());
		queryMap.put("pageSize", page.getRows());
		ret.put("rows", userService.findList(queryMap));
		ret.put("total", userService.getTotal(queryMap));
		return ret;
	}
	
	/**
	 * 添加用户
	 * @param user
	 * @return
	 */
	@RequestMapping(value="/add",method=RequestMethod.POST)
	@ResponseBody
	public Map&lt;String, String&gt; add(User user){
		Map&lt;String, String&gt; ret = new HashMap&lt;String, String&gt;();
		if(user == null){
			ret.put("type", "error");
			ret.put("msg", "请填写正确的用户信息！");
			return ret;
		}
		if(StringUtils.isEmpty(user.getUsername())){
			ret.put("type", "error");
			ret.put("msg", "请填写用户名！");
			return ret;
		}
		if(StringUtils.isEmpty(user.getPassword())){
			ret.put("type", "error");
			ret.put("msg", "请填写密码！");
			return ret;
		}
		if(user.getRoleId() == null){
			ret.put("type", "error");
			ret.put("msg", "请选择所属角色！");
			return ret;
		}
		if(isExist(user.getUsername(), 0l)){
			ret.put("type", "error");
			ret.put("msg", "该用户名已经存在，请重新输入！");
			return ret;
		}
		if(userService.add(user) &lt;= 0){
			ret.put("type", "error");
			ret.put("msg", "用户添加失败，请联系管理员！");
			return ret;
		}
		ret.put("type", "success");
		ret.put("msg", "角色添加成功！");
		return ret;
	}
	
	/**
	 * 编辑用户
	 * @param user
	 * @return
	 */
	@RequestMapping(value="/edit",method=RequestMethod.POST)
	@ResponseBody
	public Map&lt;String, String&gt; edit(User user){
		Map&lt;String, String&gt; ret = new HashMap&lt;String, String&gt;();
		if(user == null){
			ret.put("type", "error");
			ret.put("msg", "请填写正确的用户信息！");
			return ret;
		}
		if(StringUtils.isEmpty(user.getUsername())){
			ret.put("type", "error");
			ret.put("msg", "请填写用户名！");
			return ret;
		}
//		if(StringUtils.isEmpty(user.getPassword())){
//			ret.put("type", "error");
//			ret.put("msg", "请填写密码！");
//			return ret;
//		}
		if(user.getRoleId() == null){
			ret.put("type", "error");
			ret.put("msg", "请选择所属角色！");
			return ret;
		}
		if(isExist(user.getUsername(), user.getId())){
			ret.put("type", "error");
			ret.put("msg", "该用户名已经存在，请重新输入！");
			return ret;
		}
		if(userService.edit(user) &lt;= 0){
			ret.put("type", "error");
			ret.put("msg", "用户添加失败，请联系管理员！");
			return ret;
		}
		ret.put("type", "success");
		ret.put("msg", "角色添加成功！");
		return ret;
	}
	
	/**
	 * 批量删除用户
	 * @param ids
	 * @return
	 */
	@RequestMapping(value="/delete",method=RequestMethod.POST)
	@ResponseBody
	public Map&lt;String, String&gt; delete(String ids){
		Map&lt;String, String&gt; ret = new HashMap&lt;String, String&gt;();
		if(StringUtils.isEmpty(ids)){
			ret.put("type", "error");
			ret.put("msg", "选择要删除的数据！");
			return ret;
		}
		if(ids.contains(",")){
			ids = ids.substring(0,ids.length()-1);
		}
		if(userService.delete(ids) &lt;= 0){
			ret.put("type", "error");
			ret.put("msg", "用户删除失败，请联系管理员！");
			return ret;
		}
		ret.put("type", "success");
		ret.put("msg", "用户删除成功！");
		return ret;
	}
	
	/**
	 * 上传图片
	 * @param photo
	 * @param request
	 * @return
	 */
	@RequestMapping(value="/upload_photo",method=RequestMethod.POST)
	@ResponseBody
	public Map&lt;String, String&gt; uploadPhoto(MultipartFile photo,HttpServletRequest request){
		Map&lt;String, String&gt; ret = new HashMap&lt;String, String&gt;();
		if(photo == null){
			ret.put("type", "error");
			ret.put("msg", "选择要上传的文件！");
			return ret;
		}
		if(photo.getSize() &gt; 1024*1024*1024){
			ret.put("type", "error");
			ret.put("msg", "文件大小不能超过10M！");
			return ret;
		}
		//获取文件后缀
		String suffix = photo.getOriginalFilename().substring(photo.getOriginalFilename().lastIndexOf(".")+1,photo.getOriginalFilename().length());
		if(!"jpg,jpeg,gif,png".toUpperCase().contains(suffix.toUpperCase())){
			ret.put("type", "error");
			ret.put("msg", "请选择jpg,jpeg,gif,png格式的图片！");
			return ret;
		}
		String savePath = request.getSession().getServletContext().getRealPath("/") + "/resources/upload/";
		File savePathFile = new File(savePath);
		if(!savePathFile.exists()){
			//若不存在改目录，则创建目录
			savePathFile.mkdir();
		}
		String filename = new Date().getTime()+"."+suffix;
		try {
			//将文件保存至指定目录
			photo.transferTo(new File(savePath+filename));
		}catch (Exception e) {
			// TODO Auto-generated catch block
			ret.put("type", "error");
			ret.put("msg", "保存文件异常！");
			e.printStackTrace();
			return ret;
		}
		ret.put("type", "success");
		ret.put("msg", "上传成功！");
		ret.put("filepath",request.getSession().getServletContext().getContextPath() + "/resources/upload/" + filename );
		return ret;
	}
	/**
	 * 判断该用户名是否存在
	 * @param username
	 * @param id
	 * @return
	 */
	private boolean isExist(String username,Long id){
		User user = userService.findByUsername(username);
		if(user == null)return false;
		if(user.getId().longValue() == id.longValue())return false;
		return true;
	}
}
</code></pre> 
<h3>角色role控制器:</h3> 
<pre><code>/**
 * 角色role控制器
 *
 */
@RequestMapping("/admin/role")
@Controller
public class RoleController {
	
	@Autowired
	private RoleService roleService;
	
	@Autowired
	private AuthorityService authorityService;
	
	@Autowired
	private MenuService menuService;
	
	/**
	 * 角色列表页面
	 * @param model
	 * @return
	 */
	@RequestMapping(value="/list",method=RequestMethod.GET)
	public ModelAndView list(ModelAndView model){
		model.setViewName("/role/list");
		return model;
	}
	
	
	/**
	 * 获取角色列表
	 * @param page
	 * @param name
	 * @return
	 */
	@RequestMapping(value="/list",method=RequestMethod.POST)
	@ResponseBody
	public Map&lt;String, Object&gt; getList(Page page,
			@RequestParam(name="name",required=false,defaultValue="") String name
			){
		Map&lt;String, Object&gt; ret = new HashMap&lt;String, Object&gt;();
		Map&lt;String, Object&gt; queryMap = new HashMap&lt;String, Object&gt;();
		queryMap.put("name", name);
		queryMap.put("offset", page.getOffset());
		queryMap.put("pageSize", page.getRows());
		ret.put("rows", roleService.findList(queryMap));
		ret.put("total", roleService.getTotal(queryMap));
		return ret;
	}
	
	/**
	 * 角色添加
	 * @param role
	 * @return
	 */
	@RequestMapping(value="/add",method=RequestMethod.POST)
	@ResponseBody
	public Map&lt;String, String&gt; add(Role role){
		Map&lt;String, String&gt; ret = new HashMap&lt;String, String&gt;();
		if(role == null){
			ret.put("type", "error");
			ret.put("msg", "请填写正确的角色信息！");
			return ret;
		}
		if(StringUtils.isEmpty(role.getName())){
			ret.put("type", "error");
			ret.put("msg", "请填写角色名称！");
			return ret;
		}
		if(roleService.add(role) &lt;= 0){
			ret.put("type", "error");
			ret.put("msg", "角色添加失败，请联系管理员！");
			return ret;
		}
		ret.put("type", "success");
		ret.put("msg", "角色添加成功！");
		return ret;
	}
	
	/**
	 * 角色修改
	 * @param role
	 * @return
	 */
	@RequestMapping(value="/edit",method=RequestMethod.POST)
	@ResponseBody
	public Map&lt;String, String&gt; edit(Role role){
		Map&lt;String, String&gt; ret = new HashMap&lt;String, String&gt;();
		if(role == null){
			ret.put("type", "error");
			ret.put("msg", "请填写正确的角色信息！");
			return ret;
		}
		if(StringUtils.isEmpty(role.getName())){
			ret.put("type", "error");
			ret.put("msg", "请填写角色名称！");
			return ret;
		}
		if(roleService.edit(role) &lt;= 0){
			ret.put("type", "error");
			ret.put("msg", "角色修改失败，请联系管理员！");
			return ret;
		}
		ret.put("type", "success");
		ret.put("msg", "角色修改成功！");
		return ret;
	}
	
	/**
	 * 删除角色信息
	 * @param id
	 * @return
	 */
	@RequestMapping(value="/delete",method=RequestMethod.POST)
	@ResponseBody
	public Map&lt;String, String&gt; delete(Long id){
		Map&lt;String, String&gt; ret = new HashMap&lt;String, String&gt;();
		if(id == null){
			ret.put("type", "error");
			ret.put("msg", "请选择要删除的角色！");
			return ret;
		}
		try {
			if(roleService.delete(id) &lt;= 0){
				ret.put("type", "error");
				ret.put("msg", "删除失败，请联系管理员！");
				return ret;
			}
		} catch (Exception e) {
			// TODO: handle exception
			ret.put("type", "error");
			ret.put("msg", "该角色下存在权限或者用户信息，不能删除！");
			return ret;
		}
		ret.put("type", "success");
		ret.put("msg", "角色删除成功！");
		return ret;
	}
	
	/**
	 * 获取所有的菜单信息
	 * @return
	 */
	@RequestMapping(value="/get_all_menu",method=RequestMethod.POST)
	@ResponseBody
	public List&lt;Menu&gt; getAllMenu(){
		return menuService.list();
	}
	
	/**
	 * 添加权限
	 * @param ids
	 * @return
	 */
	@RequestMapping(value="/add_authority",method=RequestMethod.POST)
	@ResponseBody
	public Map&lt;String, String&gt; addAuthority(
			@RequestParam(name="ids",required=true) String ids,
			@RequestParam(name="roleId",required=true) Long roleId
			){
		Map&lt;String,String&gt; ret = new HashMap&lt;String, String&gt;();
		if(StringUtils.isEmpty(ids)){
			ret.put("type", "error");
			ret.put("msg", "请选择相应的权限！");
			return ret;
		}
		if(roleId == null){
			ret.put("type", "error");
			ret.put("msg", "请选择相应的角色！");
			return ret;
		}
		if(ids.contains(",")){
			ids = ids.substring(0,ids.length()-1);
		}
		String[] idArr = ids.split(",");
		if(idArr.length &gt; 0){
			authorityService.deleteByRoleId(roleId);
		}
		for(String id:idArr){
			Authority authority = new Authority();
			authority.setMenuId(Long.valueOf(id));
			authority.setRoleId(roleId);
			authorityService.add(authority);
		}
		ret.put("type", "success");
		ret.put("msg", "权限编辑成功！");
		return ret;
	}
	
	/**
	 * 获取某个角色的所有权限
	 * @param roleId
	 * @return
	 */
	@RequestMapping(value="/get_role_authority",method=RequestMethod.POST)
	@ResponseBody
	public List&lt;Authority&gt; getRoleAuthority(
			@RequestParam(name="roleId",required=true) Long roleId
		){
		return authorityService.findListByRoleId(roleId);
	}
}
</code></pre> 
<h3>设备管理控制层：</h3> 
<pre><code>@Controller
@RequestMapping("/admin/devOrder")
public class DevOrderController {
	
	@Autowired
	DevOrderService devOrderService;
	
	@Autowired
	DeviceService deviceService;
	
	@Autowired
	UserService userService;
	
	//设备借用列表页面
	@RequestMapping(value="/list",method=RequestMethod.GET)
	public String list(){
		return "order/devOrder";
	}
	
	//我的设备申请页面
	@RequestMapping(value="/mylist",method=RequestMethod.GET)
	public String mylist(){
		return "order/myDevOrder";
	}
	
	//获取用户个人设备列表
		@RequestMapping(value="/mylist",method=RequestMethod.POST)
		@ResponseBody
		public EasyUIDataGridResult mylist(Integer page, Integer rows,
				@RequestParam(name="uid",required=false,defaultValue="") Integer uid,
				@RequestParam(name="name",required=false,defaultValue="") String name,
				@RequestParam(name="astatus",required=false,defaultValue="") Integer astatus,
				@RequestParam(name="rstatus",required=false,defaultValue="") Integer rstatus,
				@RequestParam(name="btime",required=false,defaultValue="") String btime,
				@RequestParam(name="rtime",required=false,defaultValue="") String rtime){
			Map&lt;String, Object&gt; query = new HashMap&lt;String, Object&gt;();
			query.put("page",page);
			query.put("rows",rows);
			query.put("uid", uid);
			query.put("name", name);
			query.put("astatus",astatus);
			query.put("rstatus",rstatus);
			query.put("btime",btime);
			query.put("rtime",rtime);
			EasyUIDataGridResult result = devOrderService.myList(query);
			return result;
		}
	
	//获取设备列表
	@RequestMapping(value="/list",method=RequestMethod.POST)
	@ResponseBody
	public EasyUIDataGridResult getlist(Integer page, Integer rows,
			@RequestParam(name="name",required=false,defaultValue="") String name,
			@RequestParam(name="username",required=false,defaultValue="") String username,
			@RequestParam(name="astatus",required=false,defaultValue="") Integer astatus,
			@RequestParam(name="rstatus",required=false,defaultValue="") Integer rstatus,
			@RequestParam(name="btime",required=false,defaultValue="") String btime,
			@RequestParam(name="rtime",required=false,defaultValue="") String rtime){
		Map&lt;String, Object&gt; query = new HashMap&lt;String, Object&gt;();
		User user = userService.findByUsername(username);
		if (user != null) {
			query.put("uid", user.getId());
		}
		else {
			query.put("uid", null);
		}
		query.put("page",page);
		query.put("rows",rows);
		query.put("name", name);
		query.put("astatus",astatus);
		query.put("rstatus",rstatus);
		query.put("btime",btime);
		query.put("rtime",rtime);
		EasyUIDataGridResult result = devOrderService.getList(query);
		return result;
	}
	
	//新增设备借用
	@RequestMapping(value="/add", method=RequestMethod.POST)
	@ResponseBody
	public E3Result add(DevOrder deviceBorrow){
		Device device = deviceService.findByname(deviceBorrow.getName());
		if (device.getQuantity() &lt; (device.getUsable()+deviceBorrow.getNumber())) {
			return E3Result.build(400, "库存不足");
		}
		Long id = IDUtils.genId();
		deviceBorrow.setId(id);
		deviceBorrow.setAstatus(1);
		deviceBorrow.setRstatus(0);
		E3Result e3Result = devOrderService.add(deviceBorrow);
		return e3Result;
	}

	//审核更新借用
	@RequestMapping(value="/edit", method=RequestMethod.POST)
	@ResponseBody
	public E3Result edit(String ids){
		Long id;
        String[] idss = ids.split(",");
        if (idss.length &gt; 1){
            for (int i = 0; i &lt; idss.length; i++){
                id = Long.parseLong(idss[i]);
                DevOrder order = devOrderService.findById(id);
                Device device = deviceService.findByname(order.getName());
                if (device.getUsable() &lt; order.getNumber()) {
    				return E3Result.build(400, "库存不足");
    			}
                device.setUsable(device.getUsable() - order.getNumber());
                Integer integer = devOrderService.edit(id);
                try {
    				MailUtils.sendMail(order.getEmail(), userService.findById(order.getUid()).getUsername()+",您好",
    						order.getName()+"申请成功,请尽快到实验室领取");
    			} catch (AddressException e) {
    				// TODO Auto-generated catch block
    				e.printStackTrace();
    			} catch (MessagingException e) {
    				// TODO Auto-generated catch block
    				e.printStackTrace();
    			}
                if (integer &lt; 1){
                    return E3Result.build(400, "审核失败!");
                }
            }
            return E3Result.build(200, "审核成功");
        }
        else {
            id = Long.parseLong(ids);
            
            DevOrder order = devOrderService.findById(id);
            Device device = deviceService.findByname(order.getName());
            if (device.getUsable() &lt; order.getNumber()) {
				return E3Result.build(400, "库存不足");
			}
            device.setUsable(device.getUsable() - order.getNumber());
            deviceService.edit(device);
            
            Integer integer = devOrderService.edit(id);
            try {
				MailUtils.sendMail(order.getEmail(), userService.findById(order.getUid()).getUsername()+",您好",
						order.getName()+"申请成功,请尽快到实验室领取");
			} catch (AddressException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			} catch (MessagingException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}
            return E3Result.build(200, "审核成功");
        }
	}
	
	//删除\拒绝
	@RequestMapping("/delete")
    @ResponseBody
    public E3Result delete(String ids){
        Long id;
        String[] idss = ids.split(",");
        if (idss.length &gt; 1){
            for (int i = 0; i &lt; idss.length; i++){
                id = Long.parseLong(idss[i]);
                DevOrder order = devOrderService.findById(id);
                if (order.getAstatus() == 1) {
                	 try {
         				MailUtils.sendMail(order.getEmail(), userService.findById(order.getUid()).getUsername()+",您好",
         						order.getName()+"申请失败");
         			} catch (AddressException e) {
         				// TODO Auto-generated catch block
         				e.printStackTrace();
         			} catch (MessagingException e) {
         				// TODO Auto-generated catch block
         				e.printStackTrace();
         			}
    			}
                Integer integer = devOrderService.delete(id);
                if (integer &lt; 1){
                    return E3Result.build(400, "失败!");
                }
            }
            return E3Result.build(200, "成功");
        }
        else {
            id = Long.parseLong(ids);
            DevOrder order = devOrderService.findById(id);
            if (order.getAstatus() == 1) {
            	 try {
     				MailUtils.sendMail(order.getEmail(), userService.findById(order.getUid()).getUsername()+",您好",
     						order.getName()+"申请失败");
     			} catch (AddressException e) {
     				// TODO Auto-generated catch block
     				e.printStackTrace();
     			} catch (MessagingException e) {
     				// TODO Auto-generated catch block
     				e.printStackTrace();
     			}
			}
            Integer integer = devOrderService.delete(id);

            
            return E3Result.build(200, "成功");
        }
    }
	
	//归还
	@RequestMapping("/retEdit")
    @ResponseBody
    public E3Result retEdit(String ids){
        Long id;
        String[] idss = ids.split(",");
        if (idss.length &gt; 1){
            for (int i = 0; i &lt; idss.length; i++){
                id = Long.parseLong(idss[i]);
                DevOrder order = devOrderService.findById(id);
                if (order.getAstatus() == 1) {
    				return E3Result.build(400, "该项尚未审核");
    			}
                Integer integer = devOrderService.retEdit(id);
                if (integer &lt; 1){
                    return E3Result.build(400, "失败!");
                }
            }
            return E3Result.build(200, "成功");
        }
        else {
            id = Long.parseLong(ids);
            
            DevOrder order = devOrderService.findById(id);
            if (order.getAstatus() == 1) {
				return E3Result.build(400, "该项尚未审核");
			}
            
            Integer integer = devOrderService.retEdit(id);
            Device device = deviceService.findByname(order.getName());
            device.setUsable(device.getUsable() + order.getNumber());
            deviceService.edit(device);
            return E3Result.build(200, "成功");
        }
    }
}
</code></pre> 
<blockquote> 
 <h2><span style="color:#fe2c24;">源码获取：俺的博客首页 "资源" 里下载！ </span></h2> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f524820d44fa19325b24af3027b31485/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">开源生态|打造活力开源社区，共建开源新生态！</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f9d47c20159d44f480ed139e3911c287/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">基于OpenCV的灰度图像归一化到0~255(即对比度拉伸)的C&#43;&#43;代码,并附原理介绍</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>