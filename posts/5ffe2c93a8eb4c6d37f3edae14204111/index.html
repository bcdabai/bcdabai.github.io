<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【红日靶场系列】ATT&amp;CK红队评估5 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【红日靶场系列】ATT&amp;CK红队评估5" />
<meta property="og:description" content="靶场搭建 靶场下载地址：
http://vulnstack.qiyuanxuetang.net/vuln/detail/7/
虚拟机密码
win7
sun\heart 123.com
sun\Administrator dc123.com
2008
sun\admin 2020.com
Win7双网卡模拟内外网
环境配置：
win7：
外网网卡：192.168.135.150
内网网卡：192.168.138.136
win2008：
192.168.138.138
win7上开启phpstudy
win7关闭防火墙，不然本机访问不到web服务
本机访问192.168.135.150，访问成功，环境搭建成功
外网打点 nmap扫描
nmap -sS 192.168.135.150 有个web站点80、3306mysql数据库，先从web站点入手
ThinkPHP 5.0.22 任意命令执行getshell thinkphp综合利用工具进行攻击
tp5_invoke_func_code_exec_1漏洞攻击成功
上传webshell，哥斯拉进行连接
dirsearch目录扫描发现大佬的大马
哥斯拉下载源码查看找到MD5加密的密码
MD5解密得到明文密码admins
Mysql弱口令 翻文件找到数据库配置文件，但是没有密码
猜测密码为root，连接成功
内网渗透 上线CS 权限提升 信息搜集 发现双网卡，内网网段为192.168.138.0/24，域内主机
ipconfig /all mimikatz 获取用户密码以及NTML、SID值
开启远程桌面进行连接 横向移动 fscan扫描 上传fscan对192.168.138.0/24网段进行扫描
Psexec 横向拿下域控 SMB Beacon使用命名管道通过父级Beacon进行通讯，当两个Beacons链接后，子Beacon从父Beacon获取到任务并发送。因为链接的Beacons使用Windows命名管道进行通信，此流量封装在SMB协议中，所以SMB Beacon相对隐蔽，绕防火墙时可能发挥奇效。
wmiexec横向拿下域控 python3 wmiexec.py -debug admin:Nsfocus@123@192.168.138.138 黄金票据 在域控获得KRBTGT账户NTLM密码哈希和SID
黄金票据是伪造票据授予票据（TGT），也被称为认证票据。TGT仅用于向域控制器上的密钥分配中心（KDC）证明用户已被其他域控制器认证。
黄金票据的条件要求：
1.域名称
2.域的SID值" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/5ffe2c93a8eb4c6d37f3edae14204111/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-09-29T15:20:53+08:00" />
<meta property="article:modified_time" content="2022-09-29T15:20:53+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【红日靶场系列】ATT&amp;CK红队评估5</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h4><a id="_0"></a>靶场搭建</h4> 
<p>靶场下载地址：<br> http://vulnstack.qiyuanxuetang.net/vuln/detail/7/<br> <img src="https://images2.imgbox.com/36/ef/TySRZI8q_o.png" alt="在这里插入图片描述"><br> 虚拟机密码<br> win7<br> sun\heart 123.com<br> sun\Administrator dc123.com</p> 
<p>2008<br> sun\admin 2020.com</p> 
<p>Win7双网卡模拟内外网</p> 
<p>环境配置：<br> <img src="https://images2.imgbox.com/16/21/3weI6NrG_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/f9/f7/j5jdj5R4_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/05/86/FjVa3Q4G_o.png" alt="在这里插入图片描述"><br> win7：<br> 外网网卡：192.168.135.150<br> 内网网卡：192.168.138.136<br> <img src="https://images2.imgbox.com/ad/b4/7i9PIsF6_o.png" alt="在这里插入图片描述"><br> win2008：<br> 192.168.138.138<br> <img src="https://images2.imgbox.com/69/42/k9mEJqOo_o.png" alt="在这里插入图片描述"><br> win7上开启phpstudy<br> <img src="https://images2.imgbox.com/f6/ff/XcJXGl2m_o.png" alt="在这里插入图片描述"><br> win7关闭防火墙，不然本机访问不到web服务<br> <img src="https://images2.imgbox.com/01/db/q6GGoZeR_o.png" alt="在这里插入图片描述"><br> 本机访问192.168.135.150，访问成功，环境搭建成功<br> <img src="https://images2.imgbox.com/3d/d1/Su6RyqQX_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_31"></a>外网打点</h4> 
<p>nmap扫描</p> 
<pre><code>nmap -sS 192.168.135.150
</code></pre> 
<p><img src="https://images2.imgbox.com/e2/5c/fdWy3XP6_o.png" alt="在这里插入图片描述"><br> 有个web站点80、3306mysql数据库，先从web站点入手</p> 
<h5><a id="ThinkPHP_5022_getshell_39"></a>ThinkPHP 5.0.22 任意命令执行getshell</h5> 
<p><img src="https://images2.imgbox.com/81/d9/mHrlMDao_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/0a/45/k6rgDDNP_o.png" alt="在这里插入图片描述"><br> thinkphp综合利用工具进行攻击<br> <img src="https://images2.imgbox.com/23/19/NADsl295_o.png" alt="在这里插入图片描述"><br> tp5_invoke_func_code_exec_1漏洞攻击成功<br> <img src="https://images2.imgbox.com/da/a6/74YVMvZl_o.png" alt="在这里插入图片描述"><br> 上传webshell，哥斯拉进行连接<br> <img src="https://images2.imgbox.com/67/79/YIZ8lNNR_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/56/6e/wzyGu3vH_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/26/82/s2d8IglO_o.png" alt="在这里插入图片描述"><br> dirsearch目录扫描发现大佬的大马<br> <img src="https://images2.imgbox.com/b7/34/mktFsuAn_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/82/92/MuZhJ7wL_o.png" alt="在这里插入图片描述"><br> 哥斯拉下载源码查看找到MD5加密的密码<br> <img src="https://images2.imgbox.com/63/7a/tSysiI9k_o.png" alt="在这里插入图片描述"><br> MD5解密得到明文密码admins<br> <img src="https://images2.imgbox.com/7c/6f/iiKnmW6N_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/e3/57/QFDxxmJN_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="Mysql_58"></a>Mysql弱口令</h5> 
<p>翻文件找到数据库配置文件，但是没有密码<br> <img src="https://images2.imgbox.com/66/0f/69vWCvkf_o.png" alt="在这里插入图片描述"><br> 猜测密码为root，连接成功<br> <img src="https://images2.imgbox.com/42/a1/oI5pkTba_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_63"></a>内网渗透</h4> 
<h5><a id="CS_64"></a>上线CS</h5> 
<p><img src="https://images2.imgbox.com/79/c8/XS86Lo8E_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="_66"></a>权限提升</h5> 
<p><img src="https://images2.imgbox.com/11/1a/orprorMe_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/a2/99/75Xqr7Ji_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="_69"></a>信息搜集</h5> 
<p>发现双网卡，内网网段为192.168.138.0/24，域内主机</p> 
<pre><code>ipconfig /all
</code></pre> 
<p><img src="https://images2.imgbox.com/01/e2/OBHdVI9K_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/3a/f9/1AI8fpOw_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/40/4c/8dxgurYS_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/4b/94/tH1Qe8kH_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="mimikatz_80"></a>mimikatz</h5> 
<p>获取用户密码以及NTML、SID值<br> <img src="https://images2.imgbox.com/9d/8e/z9zu4inX_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/25/1f/diT1wsQM_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="_84"></a>开启远程桌面进行连接</h5> 
<p><img src="https://images2.imgbox.com/65/2d/lrM2Qk56_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/b4/4e/Gc6qvgSz_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/2c/40/ktivczGD_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/73/bd/hjtShdiX_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_89"></a>横向移动</h4> 
<h5><a id="fscan_90"></a>fscan扫描</h5> 
<p>上传fscan对192.168.138.0/24网段进行扫描<br> <img src="https://images2.imgbox.com/00/23/51FkNhu0_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/37/72/nGmSPjGV_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/b6/66/vvzQGb1v_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="Psexec__95"></a>Psexec 横向拿下域控</h5> 
<p>SMB Beacon使用命名管道通过父级Beacon进行通讯，当两个Beacons链接后，子Beacon从父Beacon获取到任务并发送。因为链接的Beacons使用Windows命名管道进行通信，此流量封装在SMB协议中，所以SMB Beacon相对隐蔽，绕防火墙时可能发挥奇效。<br> <img src="https://images2.imgbox.com/1d/cc/KCZNUM2R_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/e5/42/CszLTjyF_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/57/60/ZRsQGUqh_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/30/5d/eLewmXqE_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/3e/34/qU1IwM6p_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="wmiexec_102"></a>wmiexec横向拿下域控</h5> 
<pre><code>python3 wmiexec.py -debug admin:Nsfocus@123@192.168.138.138
</code></pre> 
<p><img src="https://images2.imgbox.com/64/d5/VoQXzDu3_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/ac/6e/2dj4Ne7T_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="_109"></a>黄金票据</h5> 
<p>在域控获得KRBTGT账户NTLM密码哈希和SID<br> <img src="https://images2.imgbox.com/e0/77/EjnrTQZt_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/bf/34/bj1LS9RT_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/5d/82/fZUpco5z_o.png" alt="在这里插入图片描述"><br> 黄金票据是伪造票据授予票据（TGT），也被称为认证票据。TGT仅用于向域控制器上的密钥分配中心（KDC）证明用户已被其他域控制器认证。</p> 
<p>黄金票据的条件要求：</p> 
<p>1.域名称</p> 
<p>2.域的SID值</p> 
<p>3.域的KRBTGT账户NTLM密码哈希</p> 
<p>4.伪造用户名</p> 
<p>伪造域的用户名：admin<br> 域的名称：SUN<br> 域的SID: S-1-5-21-3388020223-1982701712-4030140183-1000<br> 域的KRBTGT账户NTLM密码哈希：65dc23a67f31503698981f2665f9d858</p> 
<p>黄金票据可以在拥有普通域用户权限和KRBTGT账号的哈希的情况下用来获取域管理员权限，上面已经获得域控的 system 权限了，还可以使用黄金票据做权限维持，当域控权限掉后，在通过域内其他任意机器伪造票据重新获取最高权限。<br> <img src="https://images2.imgbox.com/f7/1e/rZmnpB0r_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/d6/2e/wUqyGVoj_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/64/bd/LReEcod4_o.png" alt="在这里插入图片描述"></p> 
<pre><code>dir \\192.168.138.138\C$
</code></pre> 
<p><img src="https://images2.imgbox.com/47/49/wkYXCZ8M_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="_140"></a>痕迹清理</h5> 
<p>参考大佬的文章：<br> https://blog.csdn.net/qq_36241198/article/details/121668010<br> <img src="https://images2.imgbox.com/8c/7a/51V6D1n8_o.png" alt="在这里插入图片描述"><br> 有时间再研究</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5e7fadecedd6d1e1e8ba68f1cdea934c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">iOS 比较全的DeviceSupport文件下载地址（包含15.7）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/572a7ffceb2a1f679db01bb20aa2214c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">poi升级 ExcelUtil部分更新以及新问题产生小记</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>