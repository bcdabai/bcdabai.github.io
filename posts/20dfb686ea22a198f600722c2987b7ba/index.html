<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>EGE示例程序——花火闪烁的夜晚 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="EGE示例程序——花火闪烁的夜晚" />
<meta property="og:description" content="专栏：EGE专栏
专栏：EGE示例程序
示例程序下载 花火闪烁的夜晚
站点链接百度网盘示例一 花火闪烁的夜晚CSDN示例一 花火闪烁的夜晚 (无需积分) 一、烟花 在做烟花特效前，先来看看烟花的样子。
烟花各式各样，并不是只有一种烟花。而接下来要做的是下面这种比较简单的。烟花在发射后，会拖着一条尾巴快速上升，到达一定高度后快速散开，最后逐渐熄灭。
二、烟花效果的设计 1. 烟花发射过程 我们将烟花发射过程分为三个阶段，分别是准备阶段、上升阶段和爆炸阶段。
在每个阶段，我们都会给烟花设定一个在某个范围内的随机时间，这样就能够将烟花的发射时间错开，不至于过于整齐而显得比较刻意。
在准备阶段，烟花尚未点燃，不进行显示。准备阶段结束后进入发射阶段，烟花以一定的初速度上升，并且由于重力和空气阻力等因素速度减小，上升一定时间后爆炸，分成多个粒子向四周散开。粒子散开后会受到重力和空气阻力等因素影响会往下坠，一段时间后熄灭。
2. 烟花的构成 烟花可以看做由很多个有颜色的粒子组成，每一个粒子都带有各自的速度（矢量）。同一个烟花可以是五颜六色，也可以只有一种颜色。
上升过程中，粒子基本都堆在一起，炸开时分散向四面八方，会形成一个球状，受重力和空气阻力影响，粒子向外发射后会逐渐向下方坠落。受粒子本身重量、形状及大小等因素影响，不同种类的烟花在爆炸时，发射出的粒子的运动轨迹并不相同。
烟花在上升阶段是一个整体，上升到最高点后爆炸分散成大量粒子。粒子具有一定的初速度，在重力、空气阻力等影响下位置和速度都在不断地变化。
由于粒子的位置和速度并不相同，所以需要分别记录每个粒子的位置和速度信息。
在本例中，同一个烟花的粒子具有同样大小和颜色，因此并没有单独为每个粒子记录大小和颜色信息。
实际上也可以将所有粒子分成几部分，每一个部分具有相同的颜色，这样在不必记录过多颜色信息的同时也能达到较好的效果。
粒子按如下定义，记录位置和速度信息。
//速度 struct Speed { double x, y; }; //位置 struct Pos { double x, y; }; //粒子 struct Particle { Pos pos; Speed speed; }; 烟花包含多个粒子，还有发射位置、发射速度以及各阶段的持续时间。粒子的初始位置和射出速度则在爆炸时给出。
由此我们定义的烟花类包含以下成员变量：
//烟花 class Fireworks { private: static const int NUM_PARTICLE = 200;	//烟花包含的粒子数 static const float particleSpeed;	//爆炸时粒子射出的速率 private: Particle p[NUM_PARTICLE];	//粒子 color_t color;	//烟花颜色 int waitingTime;	//等待时间 int riseTime;	//上升时间 int bloomTime;	//爆炸时间 Pos pos;	//位置(上升阶段) Speed speed;	//速度(上升阶段) ." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/20dfb686ea22a198f600722c2987b7ba/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-11-18T02:02:19+08:00" />
<meta property="article:modified_time" content="2022-11-18T02:02:19+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">EGE示例程序——花火闪烁的夜晚</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atelier-sulphurpool-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>专栏：<a href="https://blog.csdn.net/qq_39151563/category_9311717.html">EGE专栏</a></p> 
<p>专栏：<a href="https://blog.csdn.net/qq_39151563/category_11533948.html">EGE示例程序</a></p> 
<hr> 
<h3><a id="_12"></a>示例程序下载</h3> 
<p></p> 
<div class="csdn-video-box"> 
 <iframe id="TN1INsGL-1610184809053" frameborder="0" src="https://live.csdn.net/v/embed/142581" allowfullscreen="true" data-mediaembed="csdn"></iframe> 
 <p>花火闪烁的夜晚</p> 
</div> 
<p></p> 
<table><thead><tr><th>站点</th><th>链接</th></tr></thead><tbody><tr><td>百度网盘</td><td><a href="https://pan.baidu.com/s/1BUDGLeenbIxpAfqd1XfNqg" rel="nofollow">示例一 花火闪烁的夜晚</a></td></tr><tr><td>CSDN</td><td><a href="https://download.csdn.net/download/qq_39151563/12043945">示例一 花火闪烁的夜晚</a> (无需积分)</td></tr></tbody></table> 
<h3><a id="_22"></a>一、烟花</h3> 
<p>  在做烟花特效前，先来看看烟花的样子。</p> 
<p><img src="https://images2.imgbox.com/dd/a2/avIcO9cE_o.gif" alt="在这里插入图片描述" width="560"></p> 
<p>  烟花各式各样，并不是只有一种烟花。而接下来要做的是下面这种比较简单的。烟花在发射后，会拖着一条尾巴快速上升，到达一定高度后快速散开，最后逐渐熄灭。</p> 
<p><img src="https://images2.imgbox.com/e1/10/BnifwSND_o.gif" alt="在这里插入图片描述" width="560"></p> 
<h3><a id="_31"></a>二、烟花效果的设计</h3> 
<h4><a id="1__35"></a>1. 烟花发射过程</h4> 
<p>  我们将烟花发射过程分为三个阶段，分别是准备阶段、上升阶段和爆炸阶段。</p> 
<p><img src="https://images2.imgbox.com/55/de/Y9PJwGrK_o.png" alt="在这里插入图片描述"></p> 
<p>  在每个阶段，我们都会给烟花设定一个在某个范围内的随机时间，这样就能够将烟花的发射时间错开，不至于过于整齐而显得比较刻意。<br>   在准备阶段，烟花尚未点燃，不进行显示。准备阶段结束后进入发射阶段，烟花以一定的初速度上升，并且由于重力和空气阻力等因素速度减小，上升一定时间后爆炸，分成多个粒子向四周散开。粒子散开后会受到重力和空气阻力等因素影响会往下坠，一段时间后熄灭。</p> 
<h4><a id="2__45"></a>2. 烟花的构成</h4> 
<p>  烟花可以看做由很多个有颜色的粒子组成，每一个粒子都带有各自的速度（矢量）。同一个烟花可以是五颜六色，也可以只有一种颜色。</p> 
<p><img src="https://images2.imgbox.com/9a/49/qUzxelxK_o.png" alt="在这里插入图片描述"></p> 
<p>  上升过程中，粒子基本都堆在一起，炸开时分散向四面八方，会形成一个球状，受重力和空气阻力影响，粒子向外发射后会逐渐向下方坠落。受粒子本身重量、形状及大小等因素影响，不同种类的烟花在爆炸时，发射出的粒子的运动轨迹并不相同。</p> 
<p>  烟花在上升阶段是一个整体，上升到最高点后爆炸分散成大量粒子。粒子具有一定的初速度，在重力、空气阻力等影响下位置和速度都在不断地变化。<br>   由于粒子的位置和速度并不相同，所以需要分别记录每个粒子的位置和速度信息。</p> 
<blockquote> 
 <p>  在本例中，同一个烟花的粒子具有同样大小和颜色，因此并没有单独为每个粒子记录大小和颜色信息。<br>   实际上也可以将所有粒子分成几部分，每一个部分具有相同的颜色，这样在不必记录过多颜色信息的同时也能达到较好的效果。</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/aa/b8/VcbNQmk5_o.png" alt="在这里插入图片描述"></p> 
<p>  粒子按如下定义，记录位置和速度信息。</p> 
<pre><code class="prism language-cpp"><span class="token comment">//速度</span>
<span class="token keyword">struct</span> <span class="token class-name">Speed</span> 	
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">double</span> x<span class="token punctuation">,</span> y<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//位置</span>
<span class="token keyword">struct</span> <span class="token class-name">Pos</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">double</span> x<span class="token punctuation">,</span> y<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//粒子</span>
<span class="token keyword">struct</span> <span class="token class-name">Particle</span>
<span class="token punctuation">{<!-- --></span>
	Pos pos<span class="token punctuation">;</span>
	Speed speed<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p>  烟花包含多个粒子，还有发射位置、发射速度以及各阶段的持续时间。粒子的初始位置和射出速度则在爆炸时给出。</p> 
<p><img src="https://images2.imgbox.com/6c/94/JBrxj6pM_o.png" alt="在这里插入图片描述"></p> 
<p>  由此我们定义的烟花类包含以下成员变量：</p> 
<pre><code class="prism language-cpp"><span class="token comment">//烟花</span>
<span class="token keyword">class</span> <span class="token class-name">Fireworks</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">private</span><span class="token operator">:</span>
	<span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">int</span> NUM_PARTICLE <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>	<span class="token comment">//烟花包含的粒子数</span>
	<span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">float</span> particleSpeed<span class="token punctuation">;</span>		<span class="token comment">//爆炸时粒子射出的速率</span>
	
<span class="token keyword">private</span><span class="token operator">:</span>
	Particle p<span class="token punctuation">[</span>NUM_PARTICLE<span class="token punctuation">]</span><span class="token punctuation">;</span>	<span class="token comment">//粒子</span>
	
	color_t color<span class="token punctuation">;</span>		<span class="token comment">//烟花颜色</span>
	
	<span class="token keyword">int</span> waitingTime<span class="token punctuation">;</span>	<span class="token comment">//等待时间</span>
	<span class="token keyword">int</span> riseTime<span class="token punctuation">;</span>		<span class="token comment">//上升时间</span>
	<span class="token keyword">int</span> bloomTime<span class="token punctuation">;</span>		<span class="token comment">//爆炸时间</span>
	
	Pos pos<span class="token punctuation">;</span>		<span class="token comment">//位置(上升阶段)</span>
	Speed speed<span class="token punctuation">;</span>	<span class="token comment">//速度(上升阶段)</span>
	
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="3__113"></a>3. 烟花和粒子的位置、速度计算</h4> 
<blockquote> 
 <p>  本例中粒子只在二维平面内运动，不考虑三维透视。</p> 
</blockquote> 
<p>  烟花在初始化时，会给出一个初始位置和初始速度，后面就需要根据这个位置和速度，配合重力等因素来计算出烟花和粒子的位置。</p> 
<h5><a id="31__118"></a>3.1 位置的计算</h5> 
<p>  在每一帧中，烟花或粒子都会朝着当前方向移动一段距离。这里的速度是以帧为时间单位的，因此每一帧中，位移都和速度相等：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          Δ 
         
        
          x 
         
        
          = 
         
        
          v 
         
        
          t 
         
        
          = 
         
        
          v 
         
        
       
         \Delta x=vt = v 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord">Δ</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.61508em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">v</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">v</span></span></span></span></span></span>  下一帧的位置为<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           x 
          
         
           ′ 
          
         
        
          = 
         
        
          x 
         
        
          + 
         
        
          Δ 
         
        
          x 
         
        
       
         x' = x + \Delta x 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.801892em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.801892em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.66666em; vertical-align: -0.08333em;"></span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord">Δ</span><span class="mord mathdefault">x</span></span></span></span></span></span><br>   烟花发射升空时是一个整体，爆炸时会分散成多个粒子。因此粒子的初始位置可以取烟花爆炸时的位置。</p> 
<p><img src="https://images2.imgbox.com/62/0d/V5yjve99_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="31__127"></a>3.1 速度的计算</h5> 
<p>  烟花发射升空受到重力和空气阻力的影响，会有向下的加速度， <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           v 
          
         
           ′ 
          
         
        
          = 
         
        
          v 
         
        
          + 
         
        
          a 
         
        
          t 
         
        
       
         v'=v+at 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.801892em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">v</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.801892em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.66666em; vertical-align: -0.08333em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">v</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.61508em; vertical-align: 0em;"></span><span class="mord mathdefault">a</span><span class="mord mathdefault">t</span></span></span></span></span></span>  每帧的速度变化量 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         a 
        
       
      
        a 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathdefault">a</span></span></span></span></span> 调整至合适的数值即可。</p> 
<p>  烟花爆炸后，随着粒子逐渐燃烧殆尽，空气阻力对粒子速度的影响也越来越大。因此，每一帧会对粒子速度进行衰减<span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           v 
          
         
           ′ 
          
         
        
          = 
         
        
          k 
         
        
          v 
         
        
       
         v' = kv 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.801892em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">v</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.801892em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.03148em;">k</span><span class="mord mathdefault" style="margin-right: 0.03588em;">v</span></span></span></span></span></span>  系数 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         k 
        
       
      
        k 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.03148em;">k</span></span></span></span></span> 调整至合适值即可<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         ( 
        
       
         0 
        
       
         &lt; 
        
       
         k 
        
       
         ⩽ 
        
       
         1 
        
       
         ) 
        
       
      
        (0 &lt; k \leqslant 1) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord">0</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.83111em; vertical-align: -0.13667em;"></span><span class="mord mathdefault" style="margin-right: 0.03148em;">k</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel amsrm">⩽</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span></span>。</p> 
<h4><a id="4__132"></a>4. 烟花及粒子的绘制</h4> 
<p>  爆炸时散射出去的粒子较小，直接在当前位置上绘制一个像素点即可。烟花升空时的轨迹较粗，可以绘制稍大一点的圆或矩形。</p> 
<p><img src="https://images2.imgbox.com/64/a4/omfTlWfL_o.png" alt="在这里插入图片描述"><br>   烟花升空和粒子向四周散射时都会留下一条长长的轨迹，可以通过对图像进行模糊操作来达到这种拖尾效果。粒子移动后，原来位置上绘制的粒子会随着模糊操作的不断进行而逐渐淡化，最后消失。</p> 
<blockquote> 
 <p>  相关函数：圆( <strong>fillellipse</strong> ), 矩形(<strong>bar</strong>)，模糊滤镜函数 (<strong>imagefilter_blurring</strong>)。</p> 
</blockquote> 
<h3><a id="__142"></a>三、 实现</h3> 
<h4><a id="1__143"></a>1. 三个阶段的时间</h4> 
<p>  整个烟花的过程分为三个阶段：<strong>准备阶段</strong>、<strong>发射阶段</strong>和<strong>绽放阶段</strong>。分别由下面的三个参数来控制时间长短。</p> 
<blockquote> 
 <ul><li><strong>delayTime</strong> ：延迟时间， 烟花发射的时刻是不同的，设置 <strong>随机的延迟时间</strong>，延迟时间过后烟花发射。</li><li><strong>riseTime</strong> ：上升时间，上升时间决定烟花发射多久后会爆炸，越大上升得越高， 设置<strong>随机时间</strong>来让烟花错开。</li><li><strong>bloomTime</strong> ：绽放时间， 绽放后多长时间会消失。</li></ul> 
</blockquote> 
<p>参数是通过不断调整得来的，最后得到一个比较合适的设置。程序中初始化时这三个时间如下所示：</p> 
<pre><code class="prism language-cpp">delayTime <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">300</span> <span class="token operator">+</span> <span class="token number">20</span><span class="token punctuation">;</span>
riseTime <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">80</span> <span class="token operator">+</span> <span class="token number">160</span><span class="token punctuation">;</span>
bloomTime <span class="token operator">=</span> <span class="token number">160</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="2__157"></a>2. 发射速度和方向</h4> 
<p>  下面就是背景图，需要让烟花在地面上释放，而且在地面的不同地方发射，并且控制在一定范围内，发射的方向也需要进行控制。地面高度的是相同的，即y坐标相同，不同的是x坐标。</p> 
<blockquote> 
 <p><strong>pos</strong> ：烟花的位置， 要让烟花在不同的地点发射，可以设置不同的初始值。<br> <strong>Speed speed</strong> ：烟花上升时的速度。</p> 
</blockquote> 
<pre><code class="prism language-cpp">pos<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">450</span> <span class="token operator">+</span> <span class="token number">300.0f</span><span class="token punctuation">;</span>
pos<span class="token punctuation">.</span>y <span class="token operator">=</span> GROUND_Y<span class="token punctuation">;</span>		<span class="token comment">//地面位置是580</span>

speed<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token function">myrand</span><span class="token punctuation">(</span><span class="token number">1.0f</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">3.0f</span><span class="token punctuation">;</span>	<span class="token comment">//上升速度，根据坐标系需要是负的</span>
speed<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token function">myrand</span><span class="token punctuation">(</span><span class="token number">0.4f</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">0.2f</span><span class="token punctuation">;</span>	<span class="token comment">//可稍微倾斜</span>

</code></pre> 
<p><img src="https://images2.imgbox.com/b8/33/L49ULPBq_o.jpg" alt="在这里插入图片描述" width="600"></p> 
<h4><a id="3__175"></a>3. 烟花绘制的流程</h4> 
<h5><a id="31__176"></a>3.1 需要考虑的内容</h5> 
<ul><li>烟花包含多个粒子，粒子数，爆炸时粒子速度大小，粒子颜色。</li><li>设置一些时间变量，用来控制烟花上升的时刻，时长和绽放的时间。</li><li>上升速度和位置，需要注意坐标系里y是向下为正。烟花初始随机设定好本次的发射位置，和时间，速度等相关属性，绽放完后重新开始。每次都会先更新烟花位置再绘制。</li><li>考虑一下重力因素（有往下的加速度），空气阻力因素（速度衰减），爆炸时的球状散开（速度大小相等，方向不同），可以求x， y分速度。</li><li>稍微考虑一下水平动量守恒，做一对速度相反的粒子，因为是随机的，怕有时太随机了偏向一边。</li></ul> 
<h5><a id="32__183"></a>3.2 烟花流程</h5> 
<p>① 创建烟花。<br> ② 对烟花进行 <strong>初始化</strong> ，设置烟花从准备到发射，再到绽放的一整个流程的参数，比如三个时间，爆炸时每个粒子的速度。</p> 
<p>  其中粒子爆炸速度比较难计算，因为要设置爆炸成球状，速度大小都是相等的，只是速度的方向不同。随机得到方向后，就 <strong>将速度投影到xOy平面上</strong>，然后再分别投影到x轴和y轴。 可以参考空间向量如何获得其两个x, y方向的分量。</p> 
<pre><code class="prism language-cpp"><span class="token keyword">void</span> <span class="token class-name">Fireworks</span><span class="token double-colon punctuation">::</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	delayTime <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">300</span> <span class="token operator">+</span> <span class="token number">20</span><span class="token punctuation">;</span>
	riseTime <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">80</span> <span class="token operator">+</span> <span class="token number">160</span><span class="token punctuation">;</span>
	bloomTime <span class="token operator">=</span> <span class="token number">160</span><span class="token punctuation">;</span>

	risePos<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">450</span> <span class="token operator">+</span> <span class="token number">300.0f</span><span class="token punctuation">;</span>
	risePos<span class="token punctuation">.</span>y <span class="token operator">=</span> GROUND<span class="token punctuation">;</span>

	riseSpeed<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token function">myrand</span><span class="token punctuation">(</span><span class="token number">1.0f</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">3.0f</span><span class="token punctuation">;</span>	<span class="token comment">//上升速度，根据坐标系需要是负的</span>
	riseSpeed<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token function">myrand</span><span class="token punctuation">(</span><span class="token number">0.4f</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">0.2f</span><span class="token punctuation">;</span>	<span class="token comment">//可稍微倾斜</span>

	<span class="token comment">//随机颜色</span>
	color <span class="token operator">=</span> <span class="token function">HSVtoRGB</span><span class="token punctuation">(</span><span class="token function">myrand</span><span class="token punctuation">(</span><span class="token number">360.0f</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//给每一个粒子设置初始速度</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> NUM_PARTICLE <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token comment">//为了球状散开，设初始速度大小相等</span>
		<span class="token comment">//初始随机速度水平角度和垂直角度，因为看到是平面的，所以求x, y分速度</span>
		<span class="token keyword">float</span> levelAngle <span class="token operator">=</span> <span class="token function">randomf</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">360</span><span class="token punctuation">;</span>
		<span class="token keyword">float</span> verticalAngle <span class="token operator">=</span> <span class="token function">randomf</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">360</span><span class="token punctuation">;</span>

		<span class="token comment">//速度投影到xOy平面</span>
		<span class="token keyword">float</span> xySpeed <span class="token operator">=</span> particleSpeed <span class="token operator">*</span> <span class="token function">cos</span><span class="token punctuation">(</span>verticalAngle<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">//求x, y分速度</span>
		p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>speed<span class="token punctuation">.</span>x <span class="token operator">=</span> xySpeed <span class="token operator">*</span> <span class="token function">cos</span><span class="token punctuation">(</span>levelAngle<span class="token punctuation">)</span><span class="token punctuation">;</span>
		p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>speed<span class="token punctuation">.</span>y <span class="token operator">=</span> xySpeed <span class="token operator">*</span> <span class="token function">sin</span><span class="token punctuation">(</span>levelAngle<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">//动量守恒，每对速度反向</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">&lt;</span> NUM_PARTICLE<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			p<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>speed<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token operator">-</span>p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>speed<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
			p<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>speed<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token operator">-</span>p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>speed<span class="token punctuation">.</span>y<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>③ 每一帧里对烟花的位置以及粒子的位置进行更新。<br>   上升时只更新烟花的位置就行了，因为粒子都在一起，爆炸时就要分别计算粒子的位置了。从上升到爆炸的过渡阶段，要给每一个粒子设置位置，因为之前更新的都是烟花的位置，粒子的位置没有单独给出，此时直接将粒子位置设置为烟花当前位置。每次对位置进行更新，都将对应的时间值减1。</p> 
<blockquote> 
 <p><strong>阶段的判断:</strong><br> <strong>准备阶段</strong> ：<strong>延迟时间</strong> 大于0, 不更新位置<br> <strong>上升阶段</strong> ：<strong>延迟时间</strong> 为 0，并且 <strong>上升时间</strong> 大于0， 更新烟花位置，如果到达爆炸阶段，就给粒子当前位置。<br> <strong>爆炸阶段</strong> ：前面两个时间都不大于0，<strong>爆炸时间</strong> 大于0， 更新粒子位置<br> <strong>结束阶段</strong> ：前面三个时间都为0，这时就<strong>对烟花重新初始化</strong></p> 
</blockquote> 
<pre><code class="prism language-cpp"><span class="token comment">//更新位置等相关属性</span>
<span class="token keyword">void</span> <span class="token class-name">Fireworks</span><span class="token double-colon punctuation">::</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>delayTime <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		delayTime<span class="token operator">--</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//处于上升阶段，只更新烟花位置</span>
	<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>riseTime <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		risePos<span class="token punctuation">.</span>x <span class="token operator">+=</span> riseSpeed<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
		risePos<span class="token punctuation">.</span>y <span class="token operator">+=</span> riseSpeed<span class="token punctuation">.</span>y<span class="token punctuation">;</span>

		<span class="token comment">//重力作用</span>
		riseSpeed<span class="token punctuation">.</span>y <span class="token operator">+=</span> <span class="token number">0.005</span><span class="token punctuation">;</span>

		<span class="token comment">//上升完毕，到达爆炸阶段</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">--</span>riseTime <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">//设粒子初始位置为烟花当前位置</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> NUM_PARTICLE<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>pos<span class="token punctuation">.</span>x <span class="token operator">=</span> risePos<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
				p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>pos<span class="token punctuation">.</span>y <span class="token operator">=</span> risePos<span class="token punctuation">.</span>y<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//烟花绽放阶段</span>
	<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>bloomTime <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		bloomTime<span class="token operator">--</span><span class="token punctuation">;</span>
		<span class="token comment">//粒子散开，更新粒子位置</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> NUM_PARTICLE<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>pos<span class="token punctuation">.</span>x <span class="token operator">+=</span> p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>speed<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
			p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>pos<span class="token punctuation">.</span>y <span class="token operator">+=</span> p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>speed<span class="token punctuation">.</span>y<span class="token punctuation">;</span>

			<span class="token comment">//重力作用</span>
			p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>speed<span class="token punctuation">.</span>y <span class="token operator">+=</span> <span class="token number">0.005</span><span class="token punctuation">;</span>

			<span class="token comment">//速度减慢</span>
			p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>speed<span class="token punctuation">.</span>x <span class="token operator">*=</span> <span class="token number">0.982</span><span class="token punctuation">;</span>
			p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>speed<span class="token punctuation">.</span>y <span class="token operator">*=</span> <span class="token number">0.982</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
		<span class="token comment">//烟花重新开始</span>
		<span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>④ 每一帧里，如果是准备阶段，不绘制，如果是上升阶段，就根据烟花的位置绘制，如果是爆炸阶段，就根据每一个粒子的位置进行绘制。</p> 
<pre><code class="prism language-cpp"><span class="token keyword">void</span> <span class="token class-name">Fireworks</span><span class="token double-colon punctuation">::</span><span class="token function">draw</span><span class="token punctuation">(</span>PIMAGE pimg<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">//未开始</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>delayTime <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token comment">//烟花上升阶段</span>
	<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>riseTime <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">setfillcolor</span><span class="token punctuation">(</span>color<span class="token punctuation">,</span> pimg<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//画四个点，这样大一些</span>
		<span class="token function">bar</span><span class="token punctuation">(</span>risePos<span class="token punctuation">.</span>x<span class="token punctuation">,</span> risePos<span class="token punctuation">.</span>y<span class="token punctuation">,</span> risePos<span class="token punctuation">.</span>x <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">,</span> risePos<span class="token punctuation">.</span>y <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">,</span> pimg<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//烟花绽放阶段</span>
	<span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">setfillcolor</span><span class="token punctuation">(</span>color<span class="token punctuation">,</span> pimg<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> NUM_PARTICLE<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token function">bar</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>pos<span class="token punctuation">.</span>x<span class="token punctuation">,</span> p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>pos<span class="token punctuation">.</span>y<span class="token punctuation">,</span> p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>pos<span class="token punctuation">.</span>x <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">,</span> p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>pos<span class="token punctuation">.</span>y <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">,</span> pimg<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>  最后需要对烟花进行加模糊滤镜，这个是为了加拖尾效果，否则粒子都只是一个小点，不带拖尾。可以通过调整模糊滤镜的参数来改变不同的效果。</p> 
<h4><a id="4__310"></a>4. 程序流程</h4> 
<p>① 创建烟花，播放背景音乐<br> ② 帧循环中，不断绘制背景于窗口，更新烟花位置， 绘制烟花于缓存，对缓存加模糊滤镜，绘制缓存到窗口。<br> ③ 结束时释放资源</p> 
<h5><a id="_315"></a>注意事项</h5> 
<p>  因为涉及模糊滤镜，所以不可能在有背景的窗口加模糊滤镜，这样背景会糊掉，所以只能另外设个图像缓存，在里面做图像模糊操作。</p> 
<blockquote> 
 <p>  将图像缓存绘制到窗口时，要特别注意，我们需要的是光叠加的效果，所以绘制时需要到三元光栅操作码 <strong>SRCPAINT</strong>, 即 <strong>目标图像和源图像颜色位或</strong>，这个请参考官网源文档，这个码还挺难找的，因为列表里操作码很多。</p> 
</blockquote> 
<h4><a id="5__320"></a>5. 程序源码</h4> 
<p>  下面是项目的一些文件：<br> <img src="https://images2.imgbox.com/eb/59/vEEdL5sa_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>其中包括：</p> 
 <ul><li><strong>源文件</strong>：fireworks.cpp, fireworks.h 和 main.cpp</li><li><strong>资源文件</strong>：花火bg.jpg(图片文件), 羽肿 - 花火が瞬く夜に.mp3(音乐文件)</li></ul> 
</blockquote> 
<h5><a id="51__fireworksh_327"></a>5.1 fireworks.h</h5> 
<p>  下面是 fireworks.h 头文件的内容：</p> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">FIREWORKS_H_</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">FIREWORKS_H_</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;graphics.h&gt;</span></span>

<span class="token comment">//随机数, 0.0~1.0</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">myrand</span><span class="token expression"><span class="token punctuation">(</span>m<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> m <span class="token operator">/</span> <span class="token number">36565</span><span class="token punctuation">)</span></span></span>

<span class="token keyword">struct</span> <span class="token class-name">Speed</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">double</span> x<span class="token punctuation">,</span> y<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">struct</span> <span class="token class-name">Pos</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">double</span> x<span class="token punctuation">,</span> y<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">struct</span> <span class="token class-name">Particle</span>
<span class="token punctuation">{<!-- --></span>
	Pos pos<span class="token punctuation">;</span>
	Speed speed<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GROUND</span> <span class="token expression"><span class="token number">580</span>	</span><span class="token comment">//地面位置y坐标</span></span>

<span class="token keyword">class</span> <span class="token class-name">Fireworks</span><span class="token comment">//烟花类			</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">private</span><span class="token operator">:</span>

	<span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">int</span> NUM_PARTICLE <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>
	<span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">double</span> particleSpeed<span class="token punctuation">;</span>
	Particle p<span class="token punctuation">[</span>NUM_PARTICLE<span class="token punctuation">]</span><span class="token punctuation">;</span>

	color_t color<span class="token punctuation">;</span>

	<span class="token keyword">int</span> delayTime<span class="token punctuation">;</span>		<span class="token comment">//延迟时间</span>
	<span class="token keyword">int</span> riseTime<span class="token punctuation">;</span>		<span class="token comment">//上升时间</span>
	<span class="token keyword">int</span> bloomTime<span class="token punctuation">;</span>		<span class="token comment">//爆炸时间</span>

	Pos risePos<span class="token punctuation">;</span>		<span class="token comment">//上升阶段位置</span>
	Speed riseSpeed<span class="token punctuation">;</span>	<span class="token comment">//上升速度</span>

<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token comment">//初始化</span>
	<span class="token function">Fireworks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//更新位置等相关属性</span>
	<span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//根据属性值绘画</span>
	<span class="token keyword">void</span> <span class="token function">draw</span><span class="token punctuation">(</span>PIMAGE pimg <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span> <span class="token comment">// ! FIREWORKS_H_</span></span>

</code></pre> 
<h5><a id="52_fireworkscpp_391"></a>5.2 fireworks.cpp</h5> 
<p>  下面是 fireworks.cpp 文件的内容：</p> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cmath&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">SHOW_CONSOLE</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"fireworks.h"</span></span>

<span class="token keyword">const</span> <span class="token keyword">double</span> Fireworks<span class="token double-colon punctuation">::</span>particleSpeed <span class="token operator">=</span> <span class="token number">3.0f</span><span class="token punctuation">;</span>

<span class="token class-name">Fireworks</span><span class="token double-colon punctuation">::</span><span class="token function">Fireworks</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token class-name">Fireworks</span><span class="token double-colon punctuation">::</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	delayTime <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">300</span> <span class="token operator">+</span> <span class="token number">20</span><span class="token punctuation">;</span>
	riseTime <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">80</span> <span class="token operator">+</span> <span class="token number">160</span><span class="token punctuation">;</span>
	bloomTime <span class="token operator">=</span> <span class="token number">160</span><span class="token punctuation">;</span>

	risePos<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">450</span> <span class="token operator">+</span> <span class="token number">300.0f</span><span class="token punctuation">;</span>
	risePos<span class="token punctuation">.</span>y <span class="token operator">=</span> GROUND<span class="token punctuation">;</span>

	riseSpeed<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token function">myrand</span><span class="token punctuation">(</span><span class="token number">1.0f</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">3.0f</span><span class="token punctuation">;</span>	<span class="token comment">//上升速度，根据坐标系需要是负的</span>
	riseSpeed<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token function">myrand</span><span class="token punctuation">(</span><span class="token number">0.4f</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">0.2f</span><span class="token punctuation">;</span>	<span class="token comment">//可稍微倾斜</span>

	<span class="token comment">//随机颜色</span>
	color <span class="token operator">=</span> <span class="token function">HSVtoRGB</span><span class="token punctuation">(</span><span class="token function">myrand</span><span class="token punctuation">(</span><span class="token number">360.0f</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//给每一个粒子设置初始速度</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> NUM_PARTICLE <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token comment">//为了球状散开，设初始速度大小相等</span>
		<span class="token comment">//初始随机速度水平角度和垂直角度，因为看到是平面的，所以求x, y分速度</span>
		<span class="token keyword">double</span> levelAngle <span class="token operator">=</span> <span class="token function">randomf</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">360</span><span class="token punctuation">;</span>
		<span class="token keyword">double</span> verticalAngle <span class="token operator">=</span> <span class="token function">randomf</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">360</span><span class="token punctuation">;</span>

		<span class="token comment">//速度投影到xOy平面</span>
		<span class="token keyword">double</span> xySpeed <span class="token operator">=</span> particleSpeed <span class="token operator">*</span> <span class="token function">cos</span><span class="token punctuation">(</span>verticalAngle<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">//求x, y分速度</span>
		p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>speed<span class="token punctuation">.</span>x <span class="token operator">=</span> xySpeed <span class="token operator">*</span> <span class="token function">cos</span><span class="token punctuation">(</span>levelAngle<span class="token punctuation">)</span><span class="token punctuation">;</span>
		p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>speed<span class="token punctuation">.</span>y <span class="token operator">=</span> xySpeed <span class="token operator">*</span> <span class="token function">sin</span><span class="token punctuation">(</span>levelAngle<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">//动量守恒，每对速度反向</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">&lt;</span> NUM_PARTICLE<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			p<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>speed<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token operator">-</span>p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>speed<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
			p<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>speed<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token operator">-</span>p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>speed<span class="token punctuation">.</span>y<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token class-name">Fireworks</span><span class="token double-colon punctuation">::</span><span class="token function">draw</span><span class="token punctuation">(</span>PIMAGE pimg<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">//未开始</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>delayTime <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token comment">//烟花上升阶段</span>
	<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>riseTime <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">setfillcolor</span><span class="token punctuation">(</span>color<span class="token punctuation">,</span> pimg<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//画四个点，这样大一些</span>
		<span class="token function">bar</span><span class="token punctuation">(</span>risePos<span class="token punctuation">.</span>x<span class="token punctuation">,</span> risePos<span class="token punctuation">.</span>y<span class="token punctuation">,</span> risePos<span class="token punctuation">.</span>x <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">,</span> risePos<span class="token punctuation">.</span>y <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">,</span> pimg<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//烟花绽放阶段</span>
	<span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">setfillcolor</span><span class="token punctuation">(</span>color<span class="token punctuation">,</span> pimg<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> NUM_PARTICLE<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token function">bar</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>pos<span class="token punctuation">.</span>x<span class="token punctuation">,</span> p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>pos<span class="token punctuation">.</span>y<span class="token punctuation">,</span> p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>pos<span class="token punctuation">.</span>x <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">,</span> p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>pos<span class="token punctuation">.</span>y <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">,</span> pimg<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//更新位置等相关属性</span>
<span class="token keyword">void</span> <span class="token class-name">Fireworks</span><span class="token double-colon punctuation">::</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>delayTime<span class="token operator">--</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token comment">//处于上升阶段，只更新烟花位置</span>
	<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>riseTime <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		risePos<span class="token punctuation">.</span>x <span class="token operator">+=</span> riseSpeed<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
		risePos<span class="token punctuation">.</span>y <span class="token operator">+=</span> riseSpeed<span class="token punctuation">.</span>y<span class="token punctuation">;</span>

		<span class="token comment">//重力作用</span>
		riseSpeed<span class="token punctuation">.</span>y <span class="token operator">+=</span> <span class="token number">0.005</span><span class="token punctuation">;</span>

		<span class="token comment">//上升完毕，到达爆炸阶段</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">--</span>riseTime <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">//设粒子初始位置为烟花当前位置</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> NUM_PARTICLE<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>pos<span class="token punctuation">.</span>x <span class="token operator">=</span> risePos<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
				p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>pos<span class="token punctuation">.</span>y <span class="token operator">=</span> risePos<span class="token punctuation">.</span>y<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//烟花绽放阶段</span>
	<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>bloomTime<span class="token operator">--</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token comment">//粒子散开，更新粒子位置</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> NUM_PARTICLE<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>pos<span class="token punctuation">.</span>x <span class="token operator">+=</span> p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>speed<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
			p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>pos<span class="token punctuation">.</span>y <span class="token operator">+=</span> p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>speed<span class="token punctuation">.</span>y<span class="token punctuation">;</span>

			<span class="token comment">//重力作用</span>
			p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>speed<span class="token punctuation">.</span>y <span class="token operator">+=</span> <span class="token number">0.005</span><span class="token punctuation">;</span>

			<span class="token comment">//速度减慢</span>
			p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>speed<span class="token punctuation">.</span>x <span class="token operator">*=</span> <span class="token number">0.982</span><span class="token punctuation">;</span>
			p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>speed<span class="token punctuation">.</span>y <span class="token operator">*=</span> <span class="token number">0.982</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
		<span class="token comment">//烟花重新开始</span>
		<span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="53_maincpp_508"></a>5.3 main.cpp</h5> 
<p>  下面是 main.cpp 文件的内容：</p> 
<blockquote> 
 <p>  用到了两个文件，一张背景图片和一首背景音乐，要放在main.cpp文件旁边。代码中用的是相对路径，直接默认文件位于当前目录下。</p> 
</blockquote> 
<pre><code class="prism language-cpp">
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;time.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;graphics.h&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"fireworks.h"</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">NUM_FIREWORKS</span> <span class="token expression"><span class="token number">12</span>	</span><span class="token comment">//烟花数量，12左右比较好，多了太密集</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">initgraph</span><span class="token punctuation">(</span><span class="token number">800</span><span class="token punctuation">,</span> <span class="token number">800</span><span class="token punctuation">,</span> INIT_RENDERMANUAL<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">srand</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span><span class="token punctuation">)</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//烟花</span>
	Fireworks<span class="token operator">*</span> fireworks <span class="token operator">=</span> <span class="token keyword">new</span> Fireworks<span class="token punctuation">[</span>NUM_FIREWORKS<span class="token punctuation">]</span><span class="token punctuation">;</span>

	<span class="token comment">//背景图（800 x 800)</span>
	PIMAGE bgPimg <span class="token operator">=</span> <span class="token function">newimage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">getimage</span><span class="token punctuation">(</span>bgPimg<span class="token punctuation">,</span> <span class="token string">"花火bg.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//先绘制一下，不然前面有空白期</span>
	<span class="token function">putimage</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> bgPimg<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">delay_ms</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//背景音乐</span>
	MUSIC bgMusic<span class="token punctuation">;</span>
	bgMusic<span class="token punctuation">.</span><span class="token function">OpenFile</span><span class="token punctuation">(</span><span class="token string">"羽肿 - 花火が瞬く夜に.mp3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	bgMusic<span class="token punctuation">.</span><span class="token function">SetVolume</span><span class="token punctuation">(</span><span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>bgMusic<span class="token punctuation">.</span><span class="token function">IsOpen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		bgMusic<span class="token punctuation">.</span><span class="token function">Play</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	
	<span class="token comment">//图像缓存, 因为要加背景图，直接加模糊滤镜会把背景图模糊掉</span>
	<span class="token comment">//所以另设一个图像缓存来绘制烟花并加模糊滤镜，再绘制到窗口</span>
	PIMAGE cachePimg <span class="token operator">=</span> <span class="token function">newimage</span><span class="token punctuation">(</span><span class="token number">800</span><span class="token punctuation">,</span> <span class="token number">800</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">//计时用，主要用来定时检查音乐播放</span>
	<span class="token keyword">int</span> timeCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> <span class="token function">is_run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">delay_fps</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token comment">//隔1秒检查一下，如果播放完了，重新播放</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">++</span>timeCount <span class="token operator">%</span> <span class="token number">60</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>bgMusic<span class="token punctuation">.</span><span class="token function">GetPlayStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> MUSIC_MODE_STOP<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			bgMusic<span class="token punctuation">.</span><span class="token function">Play</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token comment">//更新位置</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> NUM_FIREWORKS<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			fireworks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		
		<span class="token comment">//清屏</span>
		<span class="token function">cleardevice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
		<span class="token comment">//绘制背景</span>
		<span class="token function">putimage</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> bgPimg<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">//绘制烟花到图像缓存中</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> NUM_FIREWORKS<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			fireworks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span>cachePimg<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token comment">//模糊滤镜，拖尾效果</span>
		<span class="token comment">//第二个参数，模糊度，越大越模糊，粒子也就越粗</span>
		<span class="token comment">//第三个参数，亮度，越大拖尾越长</span>
		<span class="token comment">//可以试试一下其它参数搭配，例如以下几组：</span>
		<span class="token comment">//0x03, 0xff</span>
		<span class="token comment">//0x0b, 0xe0</span>
		<span class="token comment">//0xff, 0xff</span>
		<span class="token function">imagefilter_blurring</span><span class="token punctuation">(</span>cachePimg<span class="token punctuation">,</span> <span class="token number">0x0a</span><span class="token punctuation">,</span> <span class="token number">0xff</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">//缓存绘制到窗口，模式为（最终颜色 = 窗口像素颜色 Or 图像像素颜色), 这样颜色会叠加起来</span>
		<span class="token function">putimage</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> cachePimg<span class="token punctuation">,</span> SRCPAINT<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token punctuation">}</span>

	<span class="token comment">//释放动态分配的内存</span>
	<span class="token keyword">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> fireworks<span class="token punctuation">;</span>

	<span class="token comment">//删除图像，释放资源</span>
	<span class="token function">delimage</span><span class="token punctuation">(</span>bgPimg<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">delimage</span><span class="token punctuation">(</span>cachePimg<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//释放音频资源</span>
	bgMusic<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">closegraph</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="6__604"></a>6. 运行过程截图</h4> 
<p>  <strong>背景图</strong>原来是有烟花的，PS抠掉了，不会抠图，有些没抠掉。本来想把灯笼单独抠出来做张图像，也不会抠。背景图里有水，水里少了倒影，这个是可以计算出倒影的位置的，粒子根据地面位置对称一下就完事了。但是水边有草，这个应该在上面，应该要单独抠出来，最后放上去，不然一弄下来草上是有烟花的。不会抠，懒得弄。<br>   (背景图和背景歌曲都来自羽肿的轻音乐 <strong>《花火が瞬く夜に》</strong>， 挺喜欢的 ٩(๑&gt;◡&lt;๑)۶ )</p> 
<p><img src="https://images2.imgbox.com/fd/db/4xZVKgKG_o.png" alt="在这里插入图片描述" width="600"></p> 
<hr> 
<p>EGE专栏：<a href="https://blog.csdn.net/qq_39151563/category_9311717.html">EGE专栏</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f861223962fcdaa42ba2d0724f391fa7/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">通俗地解释一下什么是泛型？</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2d1cdf77d4c4ef9a35d70d398ab3f675/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Colour correction with WebGL</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>