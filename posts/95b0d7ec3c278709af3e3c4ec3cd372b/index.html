<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Zigbee之ADC片内温度传感器 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Zigbee之ADC片内温度传感器" />
<meta property="og:description" content="实验片内温度传感器 代码网上找的，然后自己琢磨了下。
/***********系统时钟初始化*********************************/ void InitClock(void) { CLKCONCMD &amp;= ~0x40; //设置系统时钟源为 32MHZ晶振 while(CLKCONSTA &amp; 0x40); //等待晶振稳定 CLKCONCMD &amp;= ~0x47; //设置系统主时钟频率为 32MHZ } /***************定时器初始化**********************/ void InitT3(void) { T3CCTL0 = 0x44; //0100 0100 T3CCTL0 (0xCC)，CH0 中断使能，CH0 比较模式 T3CC0 = 0xFA; //T3CC0设置为250 T3CTL |= 0x9A; //启动T3计数器，计数时钟为16分频。使用MODULO模式 IEN1 |= 0x08; IEN0 |= 0x80; //开总中断，开T3中断 } /****************温度传感器初始化函数*******************/ void InitSensor(void) { DISABLE_ALL_INTERRUPTS(); //关闭所有中断 InitClock(); //设置系统主时钟为 32M TR0=0x01; //设置为1来连接温度传感器到SOC_ADC ATEST=0x01; //使能温度传感 } /**************获取传感器温度值并返回***********************/ float GetTemperature(void) { uint value; ADCCON3 = (0x3E); //0011 1110 选择1." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/95b0d7ec3c278709af3e3c4ec3cd372b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-12-26T22:02:52+08:00" />
<meta property="article:modified_time" content="2021-12-26T22:02:52+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Zigbee之ADC片内温度传感器</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_0"></a>实验片内温度传感器</h3> 
<p>代码网上找的，然后自己琢磨了下。</p> 
<pre><code class="prism language-c"><span class="token comment">/***********系统时钟初始化*********************************/</span>
<span class="token keyword">void</span> <span class="token function">InitClock</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>   
    CLKCONCMD <span class="token operator">&amp;=</span> <span class="token operator">~</span><span class="token number">0x40</span><span class="token punctuation">;</span>              <span class="token comment">//设置系统时钟源为 32MHZ晶振</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>CLKCONSTA <span class="token operator">&amp;</span> <span class="token number">0x40</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">//等待晶振稳定 </span>
    CLKCONCMD <span class="token operator">&amp;=</span> <span class="token operator">~</span><span class="token number">0x47</span><span class="token punctuation">;</span>              <span class="token comment">//设置系统主时钟频率为 32MHZ</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/ad/71/040Yc6Np_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/68/58/0n2O5r1C_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-c"><span class="token comment">/***************定时器初始化**********************/</span>
<span class="token keyword">void</span> <span class="token function">InitT3</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    T3CCTL0 <span class="token operator">=</span> <span class="token number">0x44</span><span class="token punctuation">;</span>        <span class="token comment">//0100 0100 T3CCTL0 (0xCC)，CH0 中断使能，CH0 比较模式</span>
    T3CC0 <span class="token operator">=</span> <span class="token number">0xFA</span><span class="token punctuation">;</span>          <span class="token comment">//T3CC0设置为250</span>
    T3CTL <span class="token operator">|=</span> <span class="token number">0x9A</span><span class="token punctuation">;</span>         <span class="token comment">//启动T3计数器，计数时钟为16分频。使用MODULO模式</span>
    IEN1 <span class="token operator">|=</span> <span class="token number">0x08</span><span class="token punctuation">;</span>     
    IEN0 <span class="token operator">|=</span> <span class="token number">0x80</span><span class="token punctuation">;</span>          <span class="token comment">//开总中断，开T3中断</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/93/99/q3rMm2ag_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/d9/4e/T5Uehneb_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/68/45/aqXQzt6U_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-c"><span class="token comment">/****************温度传感器初始化函数*******************/</span>
<span class="token keyword">void</span> <span class="token function">InitSensor</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span> 
   <span class="token function">DISABLE_ALL_INTERRUPTS</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">//关闭所有中断 </span>
   <span class="token function">InitClock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                  <span class="token comment">//设置系统主时钟为 32M </span>
   TR0<span class="token operator">=</span><span class="token number">0x01</span><span class="token punctuation">;</span>                     <span class="token comment">//设置为1来连接温度传感器到SOC_ADC</span>
   ATEST<span class="token operator">=</span><span class="token number">0x01</span><span class="token punctuation">;</span>                   <span class="token comment">//使能温度传感</span>
<span class="token punctuation">}</span>   
</code></pre> 
<p><img src="https://images2.imgbox.com/de/00/1zpP376j_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/30/3e/tYFDHThG_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-c"><span class="token comment">/**************获取传感器温度值并返回***********************/</span>
<span class="token keyword">float</span> <span class="token function">GetTemperature</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span> 
   uint  value<span class="token punctuation">;</span> 
   
   ADCCON3  <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0x3E</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//0011 1110 选择1.25V为参考电压；14位分辨率；对片内温度传感器采样</span>
   ADCCON1 <span class="token operator">|=</span> <span class="token number">0x30</span><span class="token punctuation">;</span>              <span class="token comment">//0011 0000 选择ADC的启动模式为手动</span>
   ADCCON1 <span class="token operator">|=</span> <span class="token number">0x40</span><span class="token punctuation">;</span>              <span class="token comment">//启动AD转化  </span>
   <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>ADCCON1 <span class="token operator">&amp;</span> <span class="token number">0x80</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">//等待 AD 转换完成 </span>
   value <span class="token operator">=</span>  ADCL <span class="token operator">&gt;&gt;</span> <span class="token number">4</span><span class="token punctuation">;</span>           <span class="token comment">//ADCL 寄存器低 2 位无效，由于他只有12位有效，ADCL寄存器低4位无效。</span>
   value <span class="token operator">|=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>uint<span class="token punctuation">)</span>ADCH<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   
   <span class="token keyword">return</span> <span class="token punctuation">(</span>value<span class="token operator">-</span><span class="token number">1367.5</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">4.5</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">;</span>  <span class="token comment">//根据 AD 值，计算出实际的温度,芯片手册有错，温度系数应该是4.5 /℃</span>
                                 <span class="token comment">//进行温度校正，这里减去5℃（不同芯片根据具体情况校正）</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>ADCCON3</strong><br> <img src="https://images2.imgbox.com/70/05/2lZ7a7qw_o.png" alt="在这里插入图片描述"><br> <strong>ADCCON1</strong><br> <img src="https://images2.imgbox.com/e0/03/O34KPp90_o.png" alt="在这里插入图片描述"><br> <strong>完整代码</strong></p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;ioCC2530.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span>

<span class="token keyword">typedef</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> uchar<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span>  uint<span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">DISABLE_ALL_INTERRUPTS</span><span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>IEN0 <span class="token operator">=</span> IEN1 <span class="token operator">=</span> IEN2 <span class="token operator">=</span> <span class="token number">0x00</span><span class="token punctuation">)</span></span><span class="token comment">//关中断</span></span>

<span class="token comment">/*************************延时*************************************/</span>
<span class="token keyword">void</span> <span class="token function">DelayMS</span><span class="token punctuation">(</span>uint msec<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span> 
    uint i<span class="token punctuation">,</span>j<span class="token punctuation">;</span>
    
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>msec<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> j<span class="token operator">&lt;</span><span class="token number">1060</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/***********系统时钟初始化*********************************/</span>
<span class="token keyword">void</span> <span class="token function">InitClock</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>   
    CLKCONCMD <span class="token operator">&amp;=</span> <span class="token operator">~</span><span class="token number">0x40</span><span class="token punctuation">;</span>              <span class="token comment">//设置系统时钟源为 32MHZ晶振</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>CLKCONSTA <span class="token operator">&amp;</span> <span class="token number">0x40</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">//等待晶振稳定 </span>
    CLKCONCMD <span class="token operator">&amp;=</span> <span class="token operator">~</span><span class="token number">0x47</span><span class="token punctuation">;</span>              <span class="token comment">//设置系统主时钟频率为 32MHZ</span>
<span class="token punctuation">}</span>

<span class="token comment">/***************定时器初始化**********************/</span>
<span class="token keyword">void</span> <span class="token function">InitT3</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    T3CCTL0 <span class="token operator">=</span> <span class="token number">0x44</span><span class="token punctuation">;</span>        <span class="token comment">//T3CCTL0 (0xCC)，CH0 中断使能，CH0 比较模式</span>
    T3CC0 <span class="token operator">=</span> <span class="token number">0xFA</span><span class="token punctuation">;</span>          <span class="token comment">//T3CC0设置为250</span>
    T3CTL <span class="token operator">|=</span> <span class="token number">0x9A</span><span class="token punctuation">;</span>         <span class="token comment">//启动T3计数器，计数时钟为16分频。使用MODULO模式</span>
    IEN1 <span class="token operator">|=</span> <span class="token number">0x08</span><span class="token punctuation">;</span>     
    IEN0 <span class="token operator">|=</span> <span class="token number">0x80</span><span class="token punctuation">;</span>          <span class="token comment">//开总中断，开T3中断</span>
<span class="token punctuation">}</span>

<span class="token comment">/***********串口初始化***********************************************/</span>
<span class="token keyword">void</span> <span class="token function">InitUART</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    PERCFG <span class="token operator">=</span> <span class="token number">0x00</span><span class="token punctuation">;</span>                   <span class="token comment">//位置1 P0口</span>
    P0SEL <span class="token operator">=</span> <span class="token number">0x3C</span><span class="token punctuation">;</span>                    <span class="token comment">//P0用作串口</span>
    
    P2DIR <span class="token operator">&amp;=</span> <span class="token operator">~</span><span class="token number">0xC0</span><span class="token punctuation">;</span>                  <span class="token comment">//P0优先作为UART0    </span>
    U0CSR <span class="token operator">|=</span> <span class="token number">0x80</span><span class="token punctuation">;</span>                   <span class="token comment">//串口设置为UART方式</span>
    U0GCR <span class="token operator">|=</span> <span class="token number">11</span><span class="token punctuation">;</span>				
    U0BAUD <span class="token operator">|=</span> <span class="token number">216</span><span class="token punctuation">;</span>                   <span class="token comment">//波特率设为115200</span>
    
    UTX0IF <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>                      <span class="token comment">//UART0 TX中断标志初始置位0</span>
    U0CSR <span class="token operator">|=</span> <span class="token number">0x40</span><span class="token punctuation">;</span>                   <span class="token comment">//允许接收</span>
    IEN0 <span class="token operator">|=</span> <span class="token number">0x84</span><span class="token punctuation">;</span>                    <span class="token comment">//开总中断，接收中断</span>
<span class="token punctuation">}</span>

<span class="token comment">/****************温度传感器初始化函数*******************/</span>
<span class="token keyword">void</span> <span class="token function">InitSensor</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span> 
   <span class="token function">DISABLE_ALL_INTERRUPTS</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">//关闭所有中断 </span>
   <span class="token function">InitClock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                  <span class="token comment">//设置系统主时钟为 32M </span>
   TR0<span class="token operator">=</span><span class="token number">0x01</span><span class="token punctuation">;</span>                     <span class="token comment">//设置为1来连接温度传感器到SOC_ADC</span>
   ATEST<span class="token operator">=</span><span class="token number">0x01</span><span class="token punctuation">;</span>                   <span class="token comment">//使能温度传感</span>
<span class="token punctuation">}</span>   


<span class="token comment">/****************串口发送函数*******************************/</span>
<span class="token keyword">void</span> <span class="token function">UartSendString</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>Data<span class="token punctuation">,</span> <span class="token keyword">int</span> len<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    uint i<span class="token punctuation">;</span>
    
    <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        U0DBUF <span class="token operator">=</span> <span class="token operator">*</span>Data<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span>UTX0IF <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        UTX0IF <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
   
    U0DBUF <span class="token operator">=</span> <span class="token number">0x0A</span><span class="token punctuation">;</span>                   <span class="token comment">//输出换行</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>UTX0IF <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    UTX0IF <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token comment">/**************获取传感器温度值并返回***********************/</span>
<span class="token keyword">float</span> <span class="token function">GetTemperature</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span> 
   uint  value<span class="token punctuation">;</span> 
   
   ADCCON3  <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0x3E</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//选择1.25V为参考电压；14位分辨率；对片内温度传感器采样</span>
   ADCCON1 <span class="token operator">|=</span> <span class="token number">0x30</span><span class="token punctuation">;</span>              <span class="token comment">//选择ADC的启动模式为手动</span>
   ADCCON1 <span class="token operator">|=</span> <span class="token number">0x40</span><span class="token punctuation">;</span>              <span class="token comment">//启动AD转化  </span>
   <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>ADCCON1 <span class="token operator">&amp;</span> <span class="token number">0x80</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">//等待 AD 转换完成 </span>
   value <span class="token operator">=</span>  ADCL <span class="token operator">&gt;&gt;</span> <span class="token number">4</span><span class="token punctuation">;</span>           <span class="token comment">//ADCL 寄存器低 2 位无效，由于他只有12位有效，ADCL寄存器低4位无效。网络上很多代码这里都是右移两位，那是不对的</span>
   value <span class="token operator">|=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>uint<span class="token punctuation">)</span>ADCH<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   
   <span class="token keyword">return</span> <span class="token punctuation">(</span>value<span class="token operator">-</span><span class="token number">1367.5</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">4.5</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">;</span>  <span class="token comment">//根据 AD 值，计算出实际的温度,芯片手册有错，温度系数应该是4.5 /℃</span>
                                 <span class="token comment">//进行温度校正，这里减去5℃（不同芯片根据具体情况校正）</span>
<span class="token punctuation">}</span>

<span class="token comment">/****************************************************************************
* 程序入口函数
****************************************************************************/</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span>   
    <span class="token keyword">char</span> i<span class="token punctuation">;</span> 
    <span class="token keyword">float</span> fSum<span class="token punctuation">,</span> AvgTemp<span class="token punctuation">;</span>   
    <span class="token keyword">char</span> strTemp<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    
    <span class="token function">InitUART</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                           <span class="token comment">//初始化串口 </span>
    <span class="token function">InitSensor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                         <span class="token comment">//初始化 ADC </span>
    
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> 
    <span class="token punctuation">{<!-- --></span>  
        fSum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">64</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> 
        <span class="token punctuation">{<!-- --></span>    
            fSum <span class="token operator">+=</span> <span class="token function">GetTemperature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">//取64次温度总和</span>
        <span class="token punctuation">}</span>
        AvgTemp <span class="token operator">=</span> fSum<span class="token operator">/</span><span class="token number">64</span><span class="token punctuation">;</span>                <span class="token comment">//取64次温度平均数</span>
       
        <span class="token function">memset</span><span class="token punctuation">(</span>strTemp<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">sprintf</span><span class="token punctuation">(</span>strTemp<span class="token punctuation">,</span><span class="token string">"%.02f"</span><span class="token punctuation">,</span> AvgTemp<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//将浮点数转成字符串，保留2位小数位</span>
        <span class="token function">UartSendString</span><span class="token punctuation">(</span>strTemp<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">//通过串口发给电脑显示芯片温度</span>
        <span class="token function">DelayMS</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">//延时</span>
    <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/53/9b/dM0VzhO2_o.png" alt="在这里插入图片描述"><br> 这俩东西要根据你自己的串口来。我的zigbeeUSB数据线连接COM4，波特率代码里是115200.</p> 
<h3><a id="ADC_193"></a>ADC</h3> 
<p>cc2530中文手册里的。<br> <img src="https://images2.imgbox.com/d1/29/ClKgtlQ8_o.png" alt="在这里插入图片描述"><br> <strong>12.2 ADC 操作</strong><br> 本节描述了 ADC 的一般安装和操作，并描述了 CPU 存取的 ADC 控制和状态寄存器的使用。<br> <strong>12.2.1 ADC 输入</strong><br> 端口 0 引脚的信号可以用作 ADC 输入。在下面的描述中，这些端口引脚指的是 AIN0-AIN7 引脚。输入引脚 AIN0-AIN7 是连接到 ADC 的。<br> 可以把输入配置为单端或差分输入。在选择差分输入的情况下，差分输入包括输入对AIN0-1、AIN2-3、AIN4-5 和 AIN6-7。<br> 注意负电压不适用于这些引脚，大于 VDD（未调节电压）的电压也不能。它们之间的差别是在差分模式下转换。它是在差分模式下转换的输入对之间的差。<br> 除了输入引脚 AIN0-AIN7，片上温度传感器的输出也可以选择作为 ADC 的输入，用于温度测量。为此寄存器 TR0.ADCTM 和 ATEST.ATESTCTRL 必须分别按 要求设置。<br> 还可以输入一个对应 AVDD5/3 的电压作为一个 ADC 输入。这个输入允许诸如需要在应用中实现一个电池监测器的功能。注意在这种情况下参考电压不能取决于电源电压，比如 AVDD5 电压不能用作一个参考电压。<br> 单端电压输入 AIN0 到 AIN7 以通道号码 0 到 7 表示。通道号码 8 到 11 表示差分输入，由 AIN0–AIN1、AIN2–AIN3、AIN4–AIN5 和 AIN6–AIN7 组成。通道号码 12 到 15 表示 G N D（12）温度传感器（14），和 AVDD5/3<br> （15）。这些值在 ADCCON2.SCH 和 ADCCON3.SCH 域中使用。<br> <strong>12.2.2 ADC 转换序列</strong><br> ADC 将执行一系列的转换，并把结果移动到存储器（通过 DMA），不需要任何 CPU 干预。<br> 转换序列可以被 APCFG 寄存器影响，八位模拟输入来自 I/O 引脚，不必经过编程变为模拟输入。如果一个通道正常情况下应是序列的一部分，但是相应的模拟输入在 APCFG 中禁用，那么通道将被跳过。<br> 当使用差分输入，处于差分对的两个引脚都必须在 APCFG 寄存器中设置为模拟输入引脚。<br> ADCCON2.SCH 寄存器位用于定义一个 ADC 转换序列，它来自 ADC 输入。<br> 如果 ADCCON2.SCH 设置为一个小于 8 的值，转换序列包括一个转换，来自每个通道，从 0 往上，包括 ADCCON2.SCH 编程的通道号码。<br> 当 ADCCON2.SCH 设置为一个在 8 和 12 之间的值，序列包括差分输入，从通道 8 开始，在已编程的通道结束。<br> 对于 ADCCON2.SCH 大于或等于 12，序列仅包括所选的通道<br> 12.2.3 单个 ADC 转换<br> 除了这一转换序列，ADC 可以编程为从任何通道执行一个转换。这样一个转换通过写 ADCCON3 寄存器<br> 触发。除非一个转换序列已经正在进行，转换立即开始，在这种情况下序列一完成单个转换就被执行。<br> <strong>12.2.4 ADC 运行模式</strong><br> 本节描述了运行模式和初始化转换。<br> ADC 有三种控制寄存器：ADCCON1, ADCCON2 和 ADCCON3。这些寄存器用于配置 ADC，并报告结果。<br> ADCCON1.EOC 位是一个状态位，当一个转换结束时，设置为高电平；当读取 ADCH 时，它就被清除。<br> ADCCON1.ST 位用于启动一个转换序列。当这个位设置为高电平，ADCCON1.STSEL 是 11，且当前没有转换正在运行时，就启动一个序列。当这个序列转换完成，这个位就被自动清除。<br> ADCCON1.STSEL 位选择哪个事件将启动一个新的转换序列。该选项可以选择为外部引脚 P2.0 上升沿或外部引脚事件，之前序列的结束事件，定时器 1 的通道 0 比较事件或 ADCCON1.ST 是 1。<br> ADCCON2 寄存器控制转换序列是如何执行的。<br> ADCCON2.SREF 用于选择参考电压。参考电压只能在没有转换运行的时候修改。<br> ADCCON2.SDIV 位选择抽取率（并因此也设置了分辨率和完成一个转换所需的时间，或样本率）。抽取率只能在没有转换运行的时候修改。转换序列的最后一个通道由 ADCCON2.SCH 位选择，如上所述。<br> ADCCON3 寄存器控制单个转换的通道号码、参考电压和抽取率。单个转换在寄存器 ADCCON3 写入后将立即发生，或如果一个转换序列正在进行，该序列结束之后立即发生。该寄存器位的编码和 ADCCON2 是完全一样的。<br> <strong>12.2.5 ADC 转换结果</strong><br> 数字转换结果以 2 的补码形式表示。对于单端配置，结果总是为正。这是因为结果是输入信号和地面之间的差值，它总是一个正符号数（Vconv=Vinp-Vinn，其中 Vinn=0V）。当输入幅度等于所选的电压参考 VREF时，达到最大值。对于差分配置，两个引脚对之间的差分被转换，这个差分可以是负符号数。对于抽取率是 512的一个数字转换结果的 12 位 MSB，当模拟输入 Vconv 等于 VREF 时，数字转换结果是 2047。当模拟输入等于-VREF 时，数字转换结果是-2048。 当 ADCCON1.EOC 设置为 1 时，数字转换结果是可以获得的，且结果放在 ADCH 和 ADCL 中。注意转换结果总是驻留在 ADCH 和 ADCL 寄存器组合的 MSB 段中。当读取 ADCCON2.SCH 位时，它们将指示转换在哪个通道上进行。ADCL 和 ADCH 中的结果一般适用于<br> 之前的转换。如果转换序列已经结束，ADCCON2.SCH 的值大于最后一个通道号码，但是如果最后写入ADCCON2.SCH 的通道号码是 12 或更大，将读回同一个值。<br> <strong>12.2.6 ADC 参考电压</strong><br> 模拟数字转换的正参考电压可选择为一个内部生成的电压，AVDD5 引脚，适用于 AIN7 输入引脚的外部电压，或适用于 AIN6-AIN7 输入引脚的差分电压。转换结果的准确性取决于参考电压的稳定性和噪音属性。希望的电压有偏差会导致 ADC 增益误差，与希望电压和实际电压的比例成正比。参考电压的噪音必须低于 ADC 的量化噪音，以确保达到规定的 SNR。<br> <strong>12.2.7 ADC 转换时间</strong><br> ADC 只能运行在 32 MHz XOSC 上，用户不能整除系统时钟。实际 ADC 采样的 4 MHz 的频率由固定的内部划分器产生。执行一个转换所需的时间取决于所选的抽取率。总的来说，转换时间由以下公式给定：<br> Tconv = (抽取率 + 16) x 0.25 μs。<br> <strong>12.2.8 ADC 中断</strong><br> 当通过写 ADCCON3 触发的一个单个转换完成时，ADC 将产生一个中断。当完成一个序列转换时，不产生一个中断。<br> <strong>12.2.9 ADC DMA 触发</strong><br> 每完成一个序列转换，ADC 将产生一个 DMA 触发。当完成一个单个转换，不产生 DMA 触发。对于 ADCCON2.SCH 中头 8 位可能的设置所定义的八个通道，每一个都有一个 DMA 触发。当通道中一个新的样本准备转换，DMA 触发是活动的。DMA 触发命名为表 8-1 中的 ADC_CHsd，其中 s 是单端通道，d 是差分通道。<br> 另外，还有一个 DMA 触发 ADC_CHALL，当 ADC 转换序列的任何通道中有新的数据准备好时，它是活动的。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/277f1ed38bc01d20c31cff4e873df091/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">logback漏洞、继log4j2之后logback也发现了问题？</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9555d64270c8b9fcbe6701b742a4102c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">解决ORB SLAM3加载词库慢的问题</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>