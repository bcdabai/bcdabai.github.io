<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Nginx&#43;Tomcat负载均衡集群 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Nginx&#43;Tomcat负载均衡集群" />
<meta property="og:description" content="目录
前言
一、Nginx&#43;Tomcat
二、配置Nginx服务器
三、部署Tomcat应用服务器
总结
前言 介绍Tomcat及Nginx&#43;Tomcat负载均衡集群，Tomcat的应用场景，然后重点介绍Tomcat的安装配置。Nginx&#43;Tomcat负载均衡集案列是应用于生产环境的一套可靠的Web站点解决方案。
一、Nginx&#43;Tomcat 通常情况下，一个Tomcat站点由于可能出现单点故障及无法应付过多客户复杂多样的请求等问题，不能单独应用于生产环境下，所以我们需要一套更可靠的解决方案来完善Web站点架构。
Nginx是一款非常优秀的http服务器软件，它能够支持高达50000个并发连接数的相应，拥有强大的静态资源的处理能力，运行稳定，并且内存、CPU等系统资源消耗非常低。目前很多大型网站都应用Nginx服务器为后端网站程序的反向代理及负载均衡器，来提升整个站点的负载并发能力。
部署环境
主机操作系统IP地址主要软件 Nginx服务器
CentOS 7.4 x86_64
192.168.196.146
nginx-1.12.2.tar.gz
Tomcat服务器1
CentOS 7.4 x86_64
192.168.196.147
①apache-tomcat-9.0.16.tar.gz / ②jdk-8u201-linux-x64.rpm
Tomcat服务器2
CentOS 7.4 x86_64
192.168.196.153
①apache-tomcat-9.0.16.tar.gz / ② jdk-8u201-linux-x64.rpm
二、配置Nginx服务器 1.关闭防火墙相关服务
[root@localhost ~]# systemctl stop firewalld [root@localhost ~]# systemctl disable firewalld [root@localhost ~]# setenforce 0 [root@localhost ~]# vim /etc/resolv.conf nameserver 114.114.114.114 2.安装依赖包
[root@nginx ~]# yum install -y gcc gcc-c&#43;&#43; pcre-devel zlib-devel make 3." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/5e51b6e78da0241e5953295595c517b0/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-10-19T22:51:55+08:00" />
<meta property="article:modified_time" content="2021-10-19T22:51:55+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Nginx&#43;Tomcat负载均衡集群</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="%E5%89%8D%E8%A8%80-toc" style="margin-left:0px;"><a href="#%E5%89%8D%E8%A8%80" rel="nofollow" title="前言">前言</a></p> 
<p id="%E4%B8%80%E3%80%81Nginx%2BTomcat-toc" style="margin-left:40px;"><a href="#%E4%B8%80%E3%80%81Nginx%2BTomcat" rel="nofollow" title="一、Nginx+Tomcat">一、Nginx+Tomcat</a></p> 
<p id="%E4%BA%8C%E3%80%81%E9%85%8D%E7%BD%AENginx%E6%9C%8D%E5%8A%A1%E5%99%A8-toc" style="margin-left:40px;"><a href="#%E4%BA%8C%E3%80%81%E9%85%8D%E7%BD%AENginx%E6%9C%8D%E5%8A%A1%E5%99%A8" rel="nofollow" title="二、配置Nginx服务器">二、配置Nginx服务器</a></p> 
<p id="%E4%B8%89%E3%80%81%E9%83%A8%E7%BD%B22%E5%8F%B0Tomcat%E5%BA%94%E7%94%A8%E6%9C%8D%E5%8A%A1%E5%99%A8-toc" style="margin-left:40px;"><a href="#%E4%B8%89%E3%80%81%E9%83%A8%E7%BD%B22%E5%8F%B0Tomcat%E5%BA%94%E7%94%A8%E6%9C%8D%E5%8A%A1%E5%99%A8" rel="nofollow" title="三、部署Tomcat应用服务器">三、部署Tomcat应用服务器</a></p> 
<p id="%E6%80%BB%E7%BB%93-toc" style="margin-left:0px;"><a href="#%E6%80%BB%E7%BB%93" rel="nofollow" title="总结">总结</a></p> 
<hr id="hr-toc"> 
<h2>前言</h2> 
<p>介绍Tomcat及Nginx+Tomcat负载均衡集群，Tomcat的应用场景，然后重点介绍Tomcat的安装配置。Nginx+Tomcat负载均衡集案列是应用于生产环境的一套可靠的Web站点解决方案。</p> 
<h3 id="%E4%B8%80%E3%80%81Nginx%2BTomcat">一、Nginx+Tomcat</h3> 
<p>通常情况下，一个Tomcat站点由于可能出现单点故障及无法应付过多客户复杂多样的请求等问题，不能单独应用于生产环境下，所以我们需要一套更可靠的解决方案来完善Web站点架构。</p> 
<p>Nginx是一款非常优秀的http服务器软件，它能够支持高达50000个并发连接数的相应，拥有强大的静态资源的处理能力，运行稳定，并且内存、CPU等系统资源消耗非常低。目前很多大型网站都应用Nginx服务器为后端网站程序的反向代理及负载均衡器，来提升整个站点的负载并发能力。</p> 
<p id="%E9%83%A8%E7%BD%B2%E7%8E%AF%E5%A2%83"><strong>部署环境</strong></p> 
<table align="center" border="1" cellpadding="1" cellspacing="1"><tbody><tr><td style="text-align:center;width:112px;">主机</td><td style="text-align:center;width:137px;">操作系统</td><td style="text-align:center;width:111px;">IP地址</td><td style="text-align:center;width:335px;">主要软件</td></tr><tr><td style="width:112px;"> <p style="text-align:center;">Nginx服务器</p> </td><td style="width:137px;"> <p style="text-align:center;">CentOS 7.4 x86_64</p> </td><td style="width:111px;"> <p style="text-align:center;">192.168.196.146</p> </td><td style="width:335px;"> <p>nginx-1.12.2.tar.gz</p> </td></tr><tr><td style="width:112px;"> <p style="text-align:center;">Tomcat服务器1</p> </td><td style="width:137px;"> <p style="text-align:center;">CentOS 7.4 x86_64</p> </td><td style="width:111px;"> <p style="text-align:center;">192.168.196.147</p> </td><td style="width:335px;"> <p>①apache-tomcat-9.0.16.tar.gz / ②jdk-8u201-linux-x64.rpm</p> </td></tr><tr><td style="width:112px;"> <p style="text-align:center;">Tomcat服务器2</p> </td><td style="width:137px;"> <p style="text-align:center;">CentOS 7.4 x86_64</p> </td><td style="width:111px;"> <p style="text-align:center;">192.168.196.153</p> </td><td style="width:335px;"> <p>①apache-tomcat-9.0.16.tar.gz / ② jdk-8u201-linux-x64.rpm</p> </td></tr></tbody></table> 
<h3 id="%E4%BA%8C%E3%80%81%E9%85%8D%E7%BD%AENginx%E6%9C%8D%E5%8A%A1%E5%99%A8">二、配置Nginx服务器</h3> 
<p id="1.%E5%85%B3%E9%97%AD%E9%98%B2%E7%81%AB%E5%A2%99%E7%9B%B8%E5%85%B3%E6%9C%8D%E5%8A%A1">1.关闭防火墙相关服务</p> 
<pre><code class="language-cpp">[root@localhost ~]# systemctl stop firewalld
[root@localhost ~]# systemctl disable firewalld
[root@localhost ~]# setenforce 0
 
[root@localhost ~]# vim /etc/resolv.conf
nameserver 114.114.114.114</code></pre> 
<p>2.安装依赖包</p> 
<pre><code class="language-cpp">[root@nginx ~]# yum install -y gcc gcc-c++ pcre-devel zlib-devel make
</code></pre> 
<p id="3.%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85Nginx">3.编译安装Nginx</p> 
<pre><code class="language-cs">[root@nginx ~]# tar zxvf nginx-1.12.2.tar.gz -C /opt/
 
[root@nginx ~]# cd /opt/nginx-1.12.2/
[root@nginx ~]# nginx-1.12.2]# ./configure \
--prefix=/usr/local/nginx \
--user=nginx \
--group=nginx \
--with-http_stub_status_module
 
[root@nginx nginx-1.12.2]# make &amp;&amp; make install

[root@nginx nginx-1.12.2]# ln -s /usr/local/nginx/sbin/* /usr/local/sbin/
[root@nginx ~]# useradd -M -s /sbin/nologin nginx</code></pre> 
<p id="4.%E6%A3%80%E6%9F%A5%E3%80%81%E5%90%AF%E5%8A%A8%E3%80%81%E5%81%9C%E6%AD%A2nginx%E6%9C%8D%E5%8A%A1">4.添加Nginx系统服务</p> 
<pre><code class="language-cs">[root@nginx ~]# vim /lib/systemd/system/nginx.service
 
[Unit]
Description=nginx
After=network.target
[Service]
Type=forking
PIDFile=/usr/local/nginx/logs/nginx.pid
ExecStart=/usr/local/nginx/sbin/nginx
ExecrReload=/bin/kill -s HUP $MAINPID
ExecrStop=/bin/kill -s QUIT $MAINPID
PrivateTmp=true
[Install]
WantedBy=multi-user.target

[root@nginx ~]# chmod 754 /lib/systemd/system/nginx.service	 #赋权，除了root以外的用户都不能修改
[root@nginx ~]# systemctl start nginx.service
[root@nginx ~]# systemctl enable nginx.service</code></pre> 
<p>5.网页测试</p> 
<p style="text-align:center;"><img alt="" height="374" src="https://images2.imgbox.com/2b/85/Au3tL5DH_o.png" width="1200"></p> 
<h3 id="%E4%B8%89%E3%80%81%E9%83%A8%E7%BD%B22%E5%8F%B0Tomcat%E5%BA%94%E7%94%A8%E6%9C%8D%E5%8A%A1%E5%99%A8">三、部署Tomcat应用服务器</h3> 
<p>1.实施准备(两台tomcat)</p> 
<pre><code class="language-cpp">[root@tomcat ~]# systemctl stop firewalld
[root@tomcat ~]# systemctl disable firewalld.service
[root@tomcat ~]# setenforce 0</code></pre> 
<p>2.安装JDK，配置Java环境</p> 
<pre><code class="language-cs">[root@tomcat ~]# rpm -ivh jdk-8u201-linux-x64.rpm</code></pre> 
<p>3.设置JDK环境</p> 
<pre><code class="language-cs">[root@tomcat ~]# vim /etc/profile
...
#插入三行内容
export JAVA_HOME=/usr/java/jdk1.8.0_201-amd64
export CLASSPATH=.:$JAVA_HOME/lib/tools.jar:$JAVA_HOME/lib/dt.jar
export PATH=$JAVA_HOME/bin:$PATH
 
[root@tomcat ~]# source /etc/profile</code></pre> 
<p> 4.安装配置Tomcat</p> 
<pre><code class="language-cs">[root@tomcat ~]# tar zxvf apache-tomcat-9.0.16.tar.gz -C /opt/
[root@tomcat ~]# cd /opt/
[root@tomcat opt]# mv apache-tomcat-9.0.16/ /usr/local/tomcat</code></pre> 
<p>5. 优化管理</p> 
<pre><code class="language-cs">[root@tomcat ~]# ln -s /usr/local/tomcat/bin/startup.sh /usr/local/bin/
[root@tomcat ~]# ln -s /usr/local/tomcat/bin/shutdown.sh /usr/local/bin/</code></pre> 
<p>6.启动服务startup.sh</p> 
<p style="text-align:center;"><img alt="" height="432" src="https://images2.imgbox.com/94/39/YMEuyCo4_o.png" width="1200"></p> 
<p style="text-align:center;"><img alt="" height="401" src="https://images2.imgbox.com/5d/b0/2uKTW20g_o.png" width="1200"></p> 
<p><strong>Tomcat1的配置</strong></p> 
<p>1.创建一个测试目录</p> 
<pre><code class="language-cpp">[root@tomcat1 ~]# mkdir /usr/local/tomcat/webapps/test      </code></pre> 
<p>2.动态页面的配置</p> 
<pre><code class="language-cs">[root@tomcat1 ~]# vim /usr/local/tomcat/webapps/test/index.jsp
&lt;%@ page language="java" import="java.util.*" pageEncoding="UTF-8"%&gt;
&lt;html&gt; 
&lt;head&gt;
&lt;title&gt;JSP test1 page &lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;% out.println("动态页面 1,http://www.test1.com");%&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre> 
<pre><code class="language-cpp">[root@tomcat1 ~]# vim /usr/local/tomcat/conf/server.xml
...
&lt;Context docBase="/usr/local/tomcat/webapps/test" path="" reloadable="true" /&gt;   #大约163行插入
...

[root@localhost ~]# shutdown.sh
[root@localhost ~]# startup.sh</code></pre> 
<p><strong>Tomcat2配置</strong></p> 
<p>1.创建一个测试目录</p> 
<pre><code class="language-cpp">[root@tomcat2 ~]# mkdir /usr/local/tomcat/webapps/test    </code></pre> 
<p>2.动态页面的配置</p> 
<pre><code class="language-cs">[root@tomcat2 ~]# vim /usr/local/tomcat/webapps/test/index.jsp
&lt;%@ page language="java" import="java.util.*" pageEncoding="UTF-8"%&gt;
&lt;html&gt; 
&lt;head&gt;
&lt;title&gt;JSP test2 page &lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;% out.println("动态页面 2,http://www.test2.com");%&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre> 
<pre><code class="language-cpp">[root@tomcat2 ~]# vim /usr/local/tomcat/conf/server.xml
...
&lt;Context docBase="/usr/local/tomcat/webapps/test" path="" reloadable="true" /&gt;   #大约163行插入
...

[root@tomcat2 ~]# shutdown.sh
[root@tomcat2 ~]# startup.sh</code></pre> 
<p>3.nginx准备静态页面</p> 
<pre><code class="language-Delphi">[root@nginx ~]# echo '&lt;html&gt;&lt;body&gt;&lt;h1&gt;this is static...&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;' &gt; /usr/local/nginx/html/index.html</code></pre> 
<pre><code class="language-cpp">[root@nginx ~]# vim /usr/local/nginx/conf/nginx.conf
...
#gzip  on;
upstream tomcat_server {
        server 192.168.192.147:8080 weight=1;
        server 192.168.192.153:8080 weight=1;
}

location ~ .*\.jsp$ {			 #把nginx接收到的客户端的ip地址赋值给跳转到tomcat请求中的源ip；识别客户的真实ip，并且赋值与跳转
        proxy_pass http://tomcat_server; 
        proxy_set_header HOST $host;	##设定后端的web服务器接收到的请求访问的主机名（域名或ip、端口），默认host的值为proxy_pass直连设置的主机名
        proxy_set_header X-Real-IP $remote_addr;	#把$remote_addr复制给X-Real-IP(自定义)，来回去源IP
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;	#在nginx最为代理服务器时，设置的IP列表，会把经过的及其ip，代理及其ip都记录下来
}
...

[root@nginx ~]#systemctl restart nginx.service</code></pre> 
<p>4.网页测试效果（访问nginx的地址后面加/index.jsp，会实现跳转）</p> 
<p style="text-align:center;"><img alt="" height="304" src="https://images2.imgbox.com/35/c0/7nD5O4AI_o.png" width="1200"></p> 
<p style="text-align:center;"><img alt="" height="310" src="https://images2.imgbox.com/56/1f/uqmrA20g_o.png" width="1200"></p> 
<p style="text-align:center;"><img alt="" height="309" src="https://images2.imgbox.com/f8/ee/cjLWAZu7_o.png" width="1200"></p> 
<h2 id="%E6%80%BB%E7%BB%93">总结</h2> 
<p>可将两个或多个Tomcat server 放到 Nginx 的 upstream 中组成一个负载均衡集群，然后通过 proxy_pass 这种 Web 代理的方式在 location 中设置集群站点，然后再通过 weight 值来分别对 Tomcat server 进行权重的设置。</p> 
<p>在生产环境中，Tomcat server 的硬件配置可能不尽相同，可以通过修改相应服务器的 weight 值，对配置较高或配置较低的服务器的访问请求进行分配控制</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/035a14a9f04e375a2436f42b4a0e93e7/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">使用 -Wl,rpath设置动态库的指定搜索路径</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/dde52d4fd9666da6c8e508b63b07e1c2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">苹果电脑Xcode快速打开苹果模拟器</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>