<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【Docker】Nacos2.0.3的配置部署与基于SpringBoot3.0.5的代码基础配置 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【Docker】Nacos2.0.3的配置部署与基于SpringBoot3.0.5的代码基础配置" />
<meta property="og:description" content="目录 一、Nacos的Docker配置部署1 查看镜像2 拉取镜像3 查看已拉取镜像4 创建挂载文件夹5 启动容器以复制配置文件6 导入Nacos数据表7 停止并删除容器8 启动容器9 查看容器日志10 开放对应端口 二、搭建测试项目1 Nacos配置1.1 创建命名空间1.2 创建配置文件 2 项目信息2.1 版本2.2 依赖2.3 项目结构2.4 bootstrap.properties配置文件2.5 Application启动类 3 启动项目 一、Nacos的Docker配置部署 1 查看镜像 docker search nacos/nacos-server 2 拉取镜像 docker pull nacos/nacos-server:v2.0.3 3 查看已拉取镜像 docker images 4 创建挂载文件夹 mkdir /home/nacos/logs -p 5 启动容器以复制配置文件 5.1 启动容器
docker run \ -p 8848:8848 \ --name testnacos \ -d nacos/nacos-server:v2.0.3 5.2 复制配置文件
docker cp testnacos:/home/nacos/logs/ /home/nacos/logs/ 6 导入Nacos数据表 文件名：nacos-mysql.sql" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/1fb7b57e1ece16e47089fe00a24ebf49/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-05-02T22:30:02+08:00" />
<meta property="article:modified_time" content="2023-05-02T22:30:02+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【Docker】Nacos2.0.3的配置部署与基于SpringBoot3.0.5的代码基础配置</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#NacosDocker_2" rel="nofollow">一、Nacos的Docker配置部署</a></li><li><ul><li><a href="#1__3" rel="nofollow">1 查看镜像</a></li><li><a href="#2__8" rel="nofollow">2 拉取镜像</a></li><li><a href="#3__13" rel="nofollow">3 查看已拉取镜像</a></li><li><a href="#4__19" rel="nofollow">4 创建挂载文件夹</a></li><li><a href="#5__25" rel="nofollow">5 启动容器以复制配置文件</a></li><li><a href="#6_Nacos_39" rel="nofollow">6 导入Nacos数据表</a></li><li><a href="#7__262" rel="nofollow">7 停止并删除容器</a></li><li><a href="#8__269" rel="nofollow">8 启动容器</a></li><li><a href="#9__296" rel="nofollow">9 查看容器日志</a></li><li><a href="#10__302" rel="nofollow">10 开放对应端口</a></li></ul> 
  </li><li><a href="#_305" rel="nofollow">二、搭建测试项目</a></li><li><ul><li><a href="#1_Nacos_306" rel="nofollow">1 Nacos配置</a></li><li><ul><li><a href="#11__307" rel="nofollow">1.1 创建命名空间</a></li><li><a href="#12__309" rel="nofollow">1.2 创建配置文件</a></li></ul> 
   </li><li><a href="#2__311" rel="nofollow">2 项目信息</a></li><li><ul><li><a href="#21__312" rel="nofollow">2.1 版本</a></li><li><a href="#22__318" rel="nofollow">2.2 依赖</a></li><li><a href="#23__352" rel="nofollow">2.3 项目结构</a></li><li><a href="#24_bootstrapproperties_354" rel="nofollow">2.4 bootstrap.properties配置文件</a></li><li><a href="#25_Application_368" rel="nofollow">2.5 Application启动类</a></li></ul> 
   </li><li><a href="#3__395" rel="nofollow">3 启动项目</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<hr> 
<h2><a id="NacosDocker_2"></a>一、Nacos的Docker配置部署</h2> 
<h3><a id="1__3"></a>1 查看镜像</h3> 
<pre><code class="prism language-powershell">docker search nacos/nacos-server
</code></pre> 
<h3><a id="2__8"></a>2 拉取镜像</h3> 
<pre><code class="prism language-powershell">docker pull nacos/nacos-server:v2<span class="token punctuation">.</span>0<span class="token punctuation">.</span>3
</code></pre> 
<h3><a id="3__13"></a>3 查看已拉取镜像</h3> 
<pre><code class="prism language-powershell">docker images
</code></pre> 
<p><img src="https://images2.imgbox.com/58/b5/7OHIZEyz_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="4__19"></a>4 创建挂载文件夹</h3> 
<pre><code class="prism language-powershell">mkdir <span class="token operator">/</span>home/nacos/logs <span class="token operator">-</span>p
</code></pre> 
<h3><a id="5__25"></a>5 启动容器以复制配置文件</h3> 
<p><strong>5.1 启动容器</strong></p> 
<pre><code class="prism language-powershell">docker run \
<span class="token operator">-</span>p 8848:8848 \ 
<span class="token operator">--</span>name testnacos \
<span class="token operator">-</span>d nacos/nacos-server:v2<span class="token punctuation">.</span>0<span class="token punctuation">.</span>3
</code></pre> 
<p><strong>5.2 复制配置文件</strong></p> 
<pre><code class="prism language-powershell">docker <span class="token function">cp</span> testnacos:<span class="token operator">/</span>home/nacos/logs/ <span class="token operator">/</span>home/nacos/logs/
</code></pre> 
<h3><a id="6_Nacos_39"></a>6 导入Nacos数据表</h3> 
<p><strong>文件名：nacos-mysql.sql</strong></p> 
<pre><code class="prism language-powershell"><span class="token operator">/</span><span class="token operator">*</span>
 <span class="token operator">*</span> Copyright 1999-2018 Alibaba <span class="token function">Group</span> Holding Ltd<span class="token punctuation">.</span>
 <span class="token operator">*</span>
 <span class="token operator">*</span> Licensed under the Apache License<span class="token punctuation">,</span> Version 2<span class="token punctuation">.</span>0 <span class="token punctuation">(</span>the <span class="token string">"License"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token operator">*</span> you may not use this file except in compliance with the License<span class="token punctuation">.</span>
 <span class="token operator">*</span> You may obtain a <span class="token function">copy</span> of the License at
 <span class="token operator">*</span>
 <span class="token operator">*</span>      http:<span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>org/licenses/LICENSE-2<span class="token punctuation">.</span>0
 <span class="token operator">*</span>
 <span class="token operator">*</span> Unless required by applicable law or agreed to in writing<span class="token punctuation">,</span> software
 <span class="token operator">*</span> distributed under the License is distributed on an <span class="token string">"AS IS"</span> BASIS<span class="token punctuation">,</span>
 <span class="token operator">*</span> WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND<span class="token punctuation">,</span> either express or implied<span class="token punctuation">.</span>
 <span class="token operator">*</span> See the License <span class="token keyword">for</span> the specific language governing permissions and
 <span class="token operator">*</span> limitations under the License<span class="token punctuation">.</span>
 <span class="token operator">*</span><span class="token operator">/</span>

<span class="token operator">/</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">/</span>
<span class="token operator">/</span><span class="token operator">*</span>   数据库全名 = nacos_config   <span class="token operator">*</span><span class="token operator">/</span>
<span class="token operator">/</span><span class="token operator">*</span>   表名称 = config_info   <span class="token operator">*</span><span class="token operator">/</span>
<span class="token operator">/</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">/</span>
CREATE TABLE `config_info` <span class="token punctuation">(</span>
  `id` bigint<span class="token punctuation">(</span>20<span class="token punctuation">)</span> NOT NULL AUTO_INCREMENT COMMENT <span class="token string">'id'</span><span class="token punctuation">,</span>
  `data_id` varchar<span class="token punctuation">(</span>255<span class="token punctuation">)</span> NOT NULL COMMENT <span class="token string">'data_id'</span><span class="token punctuation">,</span>
  `group_id` varchar<span class="token punctuation">(</span>255<span class="token punctuation">)</span> DEFAULT NULL<span class="token punctuation">,</span>
  `content` longtext NOT NULL COMMENT <span class="token string">'content'</span><span class="token punctuation">,</span>
  `md5` varchar<span class="token punctuation">(</span>32<span class="token punctuation">)</span> DEFAULT NULL COMMENT <span class="token string">'md5'</span><span class="token punctuation">,</span>
  `gmt_create` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT <span class="token string">'创建时间'</span><span class="token punctuation">,</span>
  `gmt_modified` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT <span class="token string">'修改时间'</span><span class="token punctuation">,</span>
  `src_user` text COMMENT <span class="token string">'source user'</span><span class="token punctuation">,</span>
  `src_ip` varchar<span class="token punctuation">(</span>50<span class="token punctuation">)</span> DEFAULT NULL COMMENT <span class="token string">'source ip'</span><span class="token punctuation">,</span>
  `app_name` varchar<span class="token punctuation">(</span>128<span class="token punctuation">)</span> DEFAULT NULL<span class="token punctuation">,</span>
  `tenant_id` varchar<span class="token punctuation">(</span>128<span class="token punctuation">)</span> DEFAULT <span class="token string">''</span> COMMENT <span class="token string">'租户字段'</span><span class="token punctuation">,</span>
  `c_desc` varchar<span class="token punctuation">(</span>256<span class="token punctuation">)</span> DEFAULT NULL<span class="token punctuation">,</span>
  `c_use` varchar<span class="token punctuation">(</span>64<span class="token punctuation">)</span> DEFAULT NULL<span class="token punctuation">,</span>
  `effect` varchar<span class="token punctuation">(</span>64<span class="token punctuation">)</span> DEFAULT NULL<span class="token punctuation">,</span>
  `<span class="token function">type</span>` varchar<span class="token punctuation">(</span>64<span class="token punctuation">)</span> DEFAULT NULL<span class="token punctuation">,</span>
  `c_schema` text<span class="token punctuation">,</span>
  PRIMARY KEY <span class="token punctuation">(</span>`id`<span class="token punctuation">)</span><span class="token punctuation">,</span>
  UNIQUE KEY `uk_configinfo_datagrouptenant` <span class="token punctuation">(</span>`data_id`<span class="token punctuation">,</span>`group_id`<span class="token punctuation">,</span>`tenant_id`<span class="token punctuation">)</span>
<span class="token punctuation">)</span> ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT=<span class="token string">'config_info'</span><span class="token punctuation">;</span>

<span class="token operator">/</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">/</span>
<span class="token operator">/</span><span class="token operator">*</span>   数据库全名 = nacos_config   <span class="token operator">*</span><span class="token operator">/</span>
<span class="token operator">/</span><span class="token operator">*</span>   表名称 = config_info_aggr   <span class="token operator">*</span><span class="token operator">/</span>
<span class="token operator">/</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">/</span>
CREATE TABLE `config_info_aggr` <span class="token punctuation">(</span>
  `id` bigint<span class="token punctuation">(</span>20<span class="token punctuation">)</span> NOT NULL AUTO_INCREMENT COMMENT <span class="token string">'id'</span><span class="token punctuation">,</span>
  `data_id` varchar<span class="token punctuation">(</span>255<span class="token punctuation">)</span> NOT NULL COMMENT <span class="token string">'data_id'</span><span class="token punctuation">,</span>
  `group_id` varchar<span class="token punctuation">(</span>255<span class="token punctuation">)</span> NOT NULL COMMENT <span class="token string">'group_id'</span><span class="token punctuation">,</span>
  `datum_id` varchar<span class="token punctuation">(</span>255<span class="token punctuation">)</span> NOT NULL COMMENT <span class="token string">'datum_id'</span><span class="token punctuation">,</span>
  `content` longtext NOT NULL COMMENT <span class="token string">'内容'</span><span class="token punctuation">,</span>
  `gmt_modified` datetime NOT NULL COMMENT <span class="token string">'修改时间'</span><span class="token punctuation">,</span>
  `app_name` varchar<span class="token punctuation">(</span>128<span class="token punctuation">)</span> DEFAULT NULL<span class="token punctuation">,</span>
  `tenant_id` varchar<span class="token punctuation">(</span>128<span class="token punctuation">)</span> DEFAULT <span class="token string">''</span> COMMENT <span class="token string">'租户字段'</span><span class="token punctuation">,</span>
  PRIMARY KEY <span class="token punctuation">(</span>`id`<span class="token punctuation">)</span><span class="token punctuation">,</span>
  UNIQUE KEY `uk_configinfoaggr_datagrouptenantdatum` <span class="token punctuation">(</span>`data_id`<span class="token punctuation">,</span>`group_id`<span class="token punctuation">,</span>`tenant_id`<span class="token punctuation">,</span>`datum_id`<span class="token punctuation">)</span>
<span class="token punctuation">)</span> ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT=<span class="token string">'增加租户字段'</span><span class="token punctuation">;</span>


<span class="token operator">/</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">/</span>
<span class="token operator">/</span><span class="token operator">*</span>   数据库全名 = nacos_config   <span class="token operator">*</span><span class="token operator">/</span>
<span class="token operator">/</span><span class="token operator">*</span>   表名称 = config_info_beta   <span class="token operator">*</span><span class="token operator">/</span>
<span class="token operator">/</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">/</span>
CREATE TABLE `config_info_beta` <span class="token punctuation">(</span>
  `id` bigint<span class="token punctuation">(</span>20<span class="token punctuation">)</span> NOT NULL AUTO_INCREMENT COMMENT <span class="token string">'id'</span><span class="token punctuation">,</span>
  `data_id` varchar<span class="token punctuation">(</span>255<span class="token punctuation">)</span> NOT NULL COMMENT <span class="token string">'data_id'</span><span class="token punctuation">,</span>
  `group_id` varchar<span class="token punctuation">(</span>128<span class="token punctuation">)</span> NOT NULL COMMENT <span class="token string">'group_id'</span><span class="token punctuation">,</span>
  `app_name` varchar<span class="token punctuation">(</span>128<span class="token punctuation">)</span> DEFAULT NULL COMMENT <span class="token string">'app_name'</span><span class="token punctuation">,</span>
  `content` longtext NOT NULL COMMENT <span class="token string">'content'</span><span class="token punctuation">,</span>
  `beta_ips` varchar<span class="token punctuation">(</span>1024<span class="token punctuation">)</span> DEFAULT NULL COMMENT <span class="token string">'betaIps'</span><span class="token punctuation">,</span>
  `md5` varchar<span class="token punctuation">(</span>32<span class="token punctuation">)</span> DEFAULT NULL COMMENT <span class="token string">'md5'</span><span class="token punctuation">,</span>
  `gmt_create` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT <span class="token string">'创建时间'</span><span class="token punctuation">,</span>
  `gmt_modified` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT <span class="token string">'修改时间'</span><span class="token punctuation">,</span>
  `src_user` text COMMENT <span class="token string">'source user'</span><span class="token punctuation">,</span>
  `src_ip` varchar<span class="token punctuation">(</span>50<span class="token punctuation">)</span> DEFAULT NULL COMMENT <span class="token string">'source ip'</span><span class="token punctuation">,</span>
  `tenant_id` varchar<span class="token punctuation">(</span>128<span class="token punctuation">)</span> DEFAULT <span class="token string">''</span> COMMENT <span class="token string">'租户字段'</span><span class="token punctuation">,</span>
  PRIMARY KEY <span class="token punctuation">(</span>`id`<span class="token punctuation">)</span><span class="token punctuation">,</span>
  UNIQUE KEY `uk_configinfobeta_datagrouptenant` <span class="token punctuation">(</span>`data_id`<span class="token punctuation">,</span>`group_id`<span class="token punctuation">,</span>`tenant_id`<span class="token punctuation">)</span>
<span class="token punctuation">)</span> ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT=<span class="token string">'config_info_beta'</span><span class="token punctuation">;</span>

<span class="token operator">/</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">/</span>
<span class="token operator">/</span><span class="token operator">*</span>   数据库全名 = nacos_config   <span class="token operator">*</span><span class="token operator">/</span>
<span class="token operator">/</span><span class="token operator">*</span>   表名称 = config_info_tag   <span class="token operator">*</span><span class="token operator">/</span>
<span class="token operator">/</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">/</span>
CREATE TABLE `config_info_tag` <span class="token punctuation">(</span>
  `id` bigint<span class="token punctuation">(</span>20<span class="token punctuation">)</span> NOT NULL AUTO_INCREMENT COMMENT <span class="token string">'id'</span><span class="token punctuation">,</span>
  `data_id` varchar<span class="token punctuation">(</span>255<span class="token punctuation">)</span> NOT NULL COMMENT <span class="token string">'data_id'</span><span class="token punctuation">,</span>
  `group_id` varchar<span class="token punctuation">(</span>128<span class="token punctuation">)</span> NOT NULL COMMENT <span class="token string">'group_id'</span><span class="token punctuation">,</span>
  `tenant_id` varchar<span class="token punctuation">(</span>128<span class="token punctuation">)</span> DEFAULT <span class="token string">''</span> COMMENT <span class="token string">'tenant_id'</span><span class="token punctuation">,</span>
  `tag_id` varchar<span class="token punctuation">(</span>128<span class="token punctuation">)</span> NOT NULL COMMENT <span class="token string">'tag_id'</span><span class="token punctuation">,</span>
  `app_name` varchar<span class="token punctuation">(</span>128<span class="token punctuation">)</span> DEFAULT NULL COMMENT <span class="token string">'app_name'</span><span class="token punctuation">,</span>
  `content` longtext NOT NULL COMMENT <span class="token string">'content'</span><span class="token punctuation">,</span>
  `md5` varchar<span class="token punctuation">(</span>32<span class="token punctuation">)</span> DEFAULT NULL COMMENT <span class="token string">'md5'</span><span class="token punctuation">,</span>
  `gmt_create` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT <span class="token string">'创建时间'</span><span class="token punctuation">,</span>
  `gmt_modified` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT <span class="token string">'修改时间'</span><span class="token punctuation">,</span>
  `src_user` text COMMENT <span class="token string">'source user'</span><span class="token punctuation">,</span>
  `src_ip` varchar<span class="token punctuation">(</span>50<span class="token punctuation">)</span> DEFAULT NULL COMMENT <span class="token string">'source ip'</span><span class="token punctuation">,</span>
  PRIMARY KEY <span class="token punctuation">(</span>`id`<span class="token punctuation">)</span><span class="token punctuation">,</span>
  UNIQUE KEY `uk_configinfotag_datagrouptenanttag` <span class="token punctuation">(</span>`data_id`<span class="token punctuation">,</span>`group_id`<span class="token punctuation">,</span>`tenant_id`<span class="token punctuation">,</span>`tag_id`<span class="token punctuation">)</span>
<span class="token punctuation">)</span> ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT=<span class="token string">'config_info_tag'</span><span class="token punctuation">;</span>

<span class="token operator">/</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">/</span>
<span class="token operator">/</span><span class="token operator">*</span>   数据库全名 = nacos_config   <span class="token operator">*</span><span class="token operator">/</span>
<span class="token operator">/</span><span class="token operator">*</span>   表名称 = config_tags_relation   <span class="token operator">*</span><span class="token operator">/</span>
<span class="token operator">/</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">/</span>
CREATE TABLE `config_tags_relation` <span class="token punctuation">(</span>
  `id` bigint<span class="token punctuation">(</span>20<span class="token punctuation">)</span> NOT NULL COMMENT <span class="token string">'id'</span><span class="token punctuation">,</span>
  `tag_name` varchar<span class="token punctuation">(</span>128<span class="token punctuation">)</span> NOT NULL COMMENT <span class="token string">'tag_name'</span><span class="token punctuation">,</span>
  `tag_type` varchar<span class="token punctuation">(</span>64<span class="token punctuation">)</span> DEFAULT NULL COMMENT <span class="token string">'tag_type'</span><span class="token punctuation">,</span>
  `data_id` varchar<span class="token punctuation">(</span>255<span class="token punctuation">)</span> NOT NULL COMMENT <span class="token string">'data_id'</span><span class="token punctuation">,</span>
  `group_id` varchar<span class="token punctuation">(</span>128<span class="token punctuation">)</span> NOT NULL COMMENT <span class="token string">'group_id'</span><span class="token punctuation">,</span>
  `tenant_id` varchar<span class="token punctuation">(</span>128<span class="token punctuation">)</span> DEFAULT <span class="token string">''</span> COMMENT <span class="token string">'tenant_id'</span><span class="token punctuation">,</span>
  `nid` bigint<span class="token punctuation">(</span>20<span class="token punctuation">)</span> NOT NULL AUTO_INCREMENT<span class="token punctuation">,</span>
  PRIMARY KEY <span class="token punctuation">(</span>`nid`<span class="token punctuation">)</span><span class="token punctuation">,</span>
  UNIQUE KEY `uk_configtagrelation_configidtag` <span class="token punctuation">(</span>`id`<span class="token punctuation">,</span>`tag_name`<span class="token punctuation">,</span>`tag_type`<span class="token punctuation">)</span><span class="token punctuation">,</span>
  KEY `idx_tenant_id` <span class="token punctuation">(</span>`tenant_id`<span class="token punctuation">)</span>
<span class="token punctuation">)</span> ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT=<span class="token string">'config_tag_relation'</span><span class="token punctuation">;</span>

<span class="token operator">/</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">/</span>
<span class="token operator">/</span><span class="token operator">*</span>   数据库全名 = nacos_config   <span class="token operator">*</span><span class="token operator">/</span>
<span class="token operator">/</span><span class="token operator">*</span>   表名称 = group_capacity   <span class="token operator">*</span><span class="token operator">/</span>
<span class="token operator">/</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">/</span>
CREATE TABLE `group_capacity` <span class="token punctuation">(</span>
  `id` bigint<span class="token punctuation">(</span>20<span class="token punctuation">)</span> unsigned NOT NULL AUTO_INCREMENT COMMENT <span class="token string">'主键ID'</span><span class="token punctuation">,</span>
  `group_id` varchar<span class="token punctuation">(</span>128<span class="token punctuation">)</span> NOT NULL DEFAULT <span class="token string">''</span> COMMENT <span class="token string">'Group ID，空字符表示整个集群'</span><span class="token punctuation">,</span>
  `quota` int<span class="token punctuation">(</span>10<span class="token punctuation">)</span> unsigned NOT NULL DEFAULT <span class="token string">'0'</span> COMMENT <span class="token string">'配额，0表示使用默认值'</span><span class="token punctuation">,</span>
  `usage` int<span class="token punctuation">(</span>10<span class="token punctuation">)</span> unsigned NOT NULL DEFAULT <span class="token string">'0'</span> COMMENT <span class="token string">'使用量'</span><span class="token punctuation">,</span>
  `max_size` int<span class="token punctuation">(</span>10<span class="token punctuation">)</span> unsigned NOT NULL DEFAULT <span class="token string">'0'</span> COMMENT <span class="token string">'单个配置大小上限，单位为字节，0表示使用默认值'</span><span class="token punctuation">,</span>
  `max_aggr_count` int<span class="token punctuation">(</span>10<span class="token punctuation">)</span> unsigned NOT NULL DEFAULT <span class="token string">'0'</span> COMMENT <span class="token string">'聚合子配置最大个数，，0表示使用默认值'</span><span class="token punctuation">,</span>
  `max_aggr_size` int<span class="token punctuation">(</span>10<span class="token punctuation">)</span> unsigned NOT NULL DEFAULT <span class="token string">'0'</span> COMMENT <span class="token string">'单个聚合数据的子配置大小上限，单位为字节，0表示使用默认值'</span><span class="token punctuation">,</span>
  `max_history_count` int<span class="token punctuation">(</span>10<span class="token punctuation">)</span> unsigned NOT NULL DEFAULT <span class="token string">'0'</span> COMMENT <span class="token string">'最大变更历史数量'</span><span class="token punctuation">,</span>
  `gmt_create` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT <span class="token string">'创建时间'</span><span class="token punctuation">,</span>
  `gmt_modified` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT <span class="token string">'修改时间'</span><span class="token punctuation">,</span>
  PRIMARY KEY <span class="token punctuation">(</span>`id`<span class="token punctuation">)</span><span class="token punctuation">,</span>
  UNIQUE KEY `uk_group_id` <span class="token punctuation">(</span>`group_id`<span class="token punctuation">)</span>
<span class="token punctuation">)</span> ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT=<span class="token string">'集群、各Group容量信息表'</span><span class="token punctuation">;</span>

<span class="token operator">/</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">/</span>
<span class="token operator">/</span><span class="token operator">*</span>   数据库全名 = nacos_config   <span class="token operator">*</span><span class="token operator">/</span>
<span class="token operator">/</span><span class="token operator">*</span>   表名称 = his_config_info   <span class="token operator">*</span><span class="token operator">/</span>
<span class="token operator">/</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">/</span>
CREATE TABLE `his_config_info` <span class="token punctuation">(</span>
  `id` bigint<span class="token punctuation">(</span>64<span class="token punctuation">)</span> unsigned NOT NULL<span class="token punctuation">,</span>
  `nid` bigint<span class="token punctuation">(</span>20<span class="token punctuation">)</span> unsigned NOT NULL AUTO_INCREMENT<span class="token punctuation">,</span>
  `data_id` varchar<span class="token punctuation">(</span>255<span class="token punctuation">)</span> NOT NULL<span class="token punctuation">,</span>
  `group_id` varchar<span class="token punctuation">(</span>128<span class="token punctuation">)</span> NOT NULL<span class="token punctuation">,</span>
  `app_name` varchar<span class="token punctuation">(</span>128<span class="token punctuation">)</span> DEFAULT NULL COMMENT <span class="token string">'app_name'</span><span class="token punctuation">,</span>
  `content` longtext NOT NULL<span class="token punctuation">,</span>
  `md5` varchar<span class="token punctuation">(</span>32<span class="token punctuation">)</span> DEFAULT NULL<span class="token punctuation">,</span>
  `gmt_create` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP<span class="token punctuation">,</span>
  `gmt_modified` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP<span class="token punctuation">,</span>
  `src_user` text<span class="token punctuation">,</span>
  `src_ip` varchar<span class="token punctuation">(</span>50<span class="token punctuation">)</span> DEFAULT NULL<span class="token punctuation">,</span>
  `op_type` char<span class="token punctuation">(</span>10<span class="token punctuation">)</span> DEFAULT NULL<span class="token punctuation">,</span>
  `tenant_id` varchar<span class="token punctuation">(</span>128<span class="token punctuation">)</span> DEFAULT <span class="token string">''</span> COMMENT <span class="token string">'租户字段'</span><span class="token punctuation">,</span>
  PRIMARY KEY <span class="token punctuation">(</span>`nid`<span class="token punctuation">)</span><span class="token punctuation">,</span>
  KEY `idx_gmt_create` <span class="token punctuation">(</span>`gmt_create`<span class="token punctuation">)</span><span class="token punctuation">,</span>
  KEY `idx_gmt_modified` <span class="token punctuation">(</span>`gmt_modified`<span class="token punctuation">)</span><span class="token punctuation">,</span>
  KEY `idx_did` <span class="token punctuation">(</span>`data_id`<span class="token punctuation">)</span>
<span class="token punctuation">)</span> ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT=<span class="token string">'多租户改造'</span><span class="token punctuation">;</span>


<span class="token operator">/</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">/</span>
<span class="token operator">/</span><span class="token operator">*</span>   数据库全名 = nacos_config   <span class="token operator">*</span><span class="token operator">/</span>
<span class="token operator">/</span><span class="token operator">*</span>   表名称 = tenant_capacity   <span class="token operator">*</span><span class="token operator">/</span>
<span class="token operator">/</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">/</span>
CREATE TABLE `tenant_capacity` <span class="token punctuation">(</span>
  `id` bigint<span class="token punctuation">(</span>20<span class="token punctuation">)</span> unsigned NOT NULL AUTO_INCREMENT COMMENT <span class="token string">'主键ID'</span><span class="token punctuation">,</span>
  `tenant_id` varchar<span class="token punctuation">(</span>128<span class="token punctuation">)</span> NOT NULL DEFAULT <span class="token string">''</span> COMMENT <span class="token string">'Tenant ID'</span><span class="token punctuation">,</span>
  `quota` int<span class="token punctuation">(</span>10<span class="token punctuation">)</span> unsigned NOT NULL DEFAULT <span class="token string">'0'</span> COMMENT <span class="token string">'配额，0表示使用默认值'</span><span class="token punctuation">,</span>
  `usage` int<span class="token punctuation">(</span>10<span class="token punctuation">)</span> unsigned NOT NULL DEFAULT <span class="token string">'0'</span> COMMENT <span class="token string">'使用量'</span><span class="token punctuation">,</span>
  `max_size` int<span class="token punctuation">(</span>10<span class="token punctuation">)</span> unsigned NOT NULL DEFAULT <span class="token string">'0'</span> COMMENT <span class="token string">'单个配置大小上限，单位为字节，0表示使用默认值'</span><span class="token punctuation">,</span>
  `max_aggr_count` int<span class="token punctuation">(</span>10<span class="token punctuation">)</span> unsigned NOT NULL DEFAULT <span class="token string">'0'</span> COMMENT <span class="token string">'聚合子配置最大个数'</span><span class="token punctuation">,</span>
  `max_aggr_size` int<span class="token punctuation">(</span>10<span class="token punctuation">)</span> unsigned NOT NULL DEFAULT <span class="token string">'0'</span> COMMENT <span class="token string">'单个聚合数据的子配置大小上限，单位为字节，0表示使用默认值'</span><span class="token punctuation">,</span>
  `max_history_count` int<span class="token punctuation">(</span>10<span class="token punctuation">)</span> unsigned NOT NULL DEFAULT <span class="token string">'0'</span> COMMENT <span class="token string">'最大变更历史数量'</span><span class="token punctuation">,</span>
  `gmt_create` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT <span class="token string">'创建时间'</span><span class="token punctuation">,</span>
  `gmt_modified` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT <span class="token string">'修改时间'</span><span class="token punctuation">,</span>
  PRIMARY KEY <span class="token punctuation">(</span>`id`<span class="token punctuation">)</span><span class="token punctuation">,</span>
  UNIQUE KEY `uk_tenant_id` <span class="token punctuation">(</span>`tenant_id`<span class="token punctuation">)</span>
<span class="token punctuation">)</span> ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT=<span class="token string">'租户容量信息表'</span><span class="token punctuation">;</span>


CREATE TABLE `tenant_info` <span class="token punctuation">(</span>
  `id` bigint<span class="token punctuation">(</span>20<span class="token punctuation">)</span> NOT NULL AUTO_INCREMENT COMMENT <span class="token string">'id'</span><span class="token punctuation">,</span>
  `kp` varchar<span class="token punctuation">(</span>128<span class="token punctuation">)</span> NOT NULL COMMENT <span class="token string">'kp'</span><span class="token punctuation">,</span>
  `tenant_id` varchar<span class="token punctuation">(</span>128<span class="token punctuation">)</span> default <span class="token string">''</span> COMMENT <span class="token string">'tenant_id'</span><span class="token punctuation">,</span>
  `tenant_name` varchar<span class="token punctuation">(</span>128<span class="token punctuation">)</span> default <span class="token string">''</span> COMMENT <span class="token string">'tenant_name'</span><span class="token punctuation">,</span>
  `tenant_desc` varchar<span class="token punctuation">(</span>256<span class="token punctuation">)</span> DEFAULT NULL COMMENT <span class="token string">'tenant_desc'</span><span class="token punctuation">,</span>
  `create_source` varchar<span class="token punctuation">(</span>32<span class="token punctuation">)</span> DEFAULT NULL COMMENT <span class="token string">'create_source'</span><span class="token punctuation">,</span>
  `gmt_create` bigint<span class="token punctuation">(</span>20<span class="token punctuation">)</span> NOT NULL COMMENT <span class="token string">'创建时间'</span><span class="token punctuation">,</span>
  `gmt_modified` bigint<span class="token punctuation">(</span>20<span class="token punctuation">)</span> NOT NULL COMMENT <span class="token string">'修改时间'</span><span class="token punctuation">,</span>
  PRIMARY KEY <span class="token punctuation">(</span>`id`<span class="token punctuation">)</span><span class="token punctuation">,</span>
  UNIQUE KEY `uk_tenant_info_kptenantid` <span class="token punctuation">(</span>`kp`<span class="token punctuation">,</span>`tenant_id`<span class="token punctuation">)</span><span class="token punctuation">,</span>
  KEY `idx_tenant_id` <span class="token punctuation">(</span>`tenant_id`<span class="token punctuation">)</span>
<span class="token punctuation">)</span> ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT=<span class="token string">'tenant_info'</span><span class="token punctuation">;</span>

CREATE TABLE `users` <span class="token punctuation">(</span>
	`username` varchar<span class="token punctuation">(</span>50<span class="token punctuation">)</span> NOT NULL PRIMARY KEY<span class="token punctuation">,</span>
	`password` varchar<span class="token punctuation">(</span>500<span class="token punctuation">)</span> NOT NULL<span class="token punctuation">,</span>
	`enabled` boolean NOT NULL
<span class="token punctuation">)</span><span class="token punctuation">;</span>

CREATE TABLE `roles` <span class="token punctuation">(</span>
	`username` varchar<span class="token punctuation">(</span>50<span class="token punctuation">)</span> NOT NULL<span class="token punctuation">,</span>
	`role` varchar<span class="token punctuation">(</span>50<span class="token punctuation">)</span> NOT NULL<span class="token punctuation">,</span>
	UNIQUE INDEX `idx_user_role` <span class="token punctuation">(</span>`username` ASC<span class="token punctuation">,</span> `role` ASC<span class="token punctuation">)</span> <span class="token keyword">USING</span> BTREE
<span class="token punctuation">)</span><span class="token punctuation">;</span>

CREATE TABLE `permissions` <span class="token punctuation">(</span>
    `role` varchar<span class="token punctuation">(</span>50<span class="token punctuation">)</span> NOT NULL<span class="token punctuation">,</span>
    `resource` varchar<span class="token punctuation">(</span>255<span class="token punctuation">)</span> NOT NULL<span class="token punctuation">,</span>
    `action` varchar<span class="token punctuation">(</span>8<span class="token punctuation">)</span> NOT NULL<span class="token punctuation">,</span>
    UNIQUE INDEX `uk_role_permission` <span class="token punctuation">(</span>`role`<span class="token punctuation">,</span>`resource`<span class="token punctuation">,</span>`action`<span class="token punctuation">)</span> <span class="token keyword">USING</span> BTREE
<span class="token punctuation">)</span><span class="token punctuation">;</span>

INSERT INTO users <span class="token punctuation">(</span>username<span class="token punctuation">,</span> password<span class="token punctuation">,</span> enabled<span class="token punctuation">)</span> VALUES <span class="token punctuation">(</span><span class="token string">'nacos'</span><span class="token punctuation">,</span> <span class="token string">'$2a$10$EuWPZHzz32dJN7jexM34MOeYirDdFAZm2kuWj7VEOJhhZkDrxfvUu'</span><span class="token punctuation">,</span> TRUE<span class="token punctuation">)</span><span class="token punctuation">;</span>

INSERT INTO roles <span class="token punctuation">(</span>username<span class="token punctuation">,</span> role<span class="token punctuation">)</span> VALUES <span class="token punctuation">(</span><span class="token string">'nacos'</span><span class="token punctuation">,</span> <span class="token string">'ROLE_ADMIN'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> 
<h3><a id="7__262"></a>7 停止并删除容器</h3> 
<pre><code class="prism language-powershell">docker stop testnacos

docker <span class="token function">rm</span> testnacos
</code></pre> 
<h3><a id="8__269"></a>8 启动容器</h3> 
<pre><code class="prism language-powershell">docker run <span class="token operator">-</span>d \
<span class="token operator">-</span>v <span class="token operator">/</span>docker/nacos/logs:<span class="token operator">/</span>home/nacos/logs \
<span class="token operator">-</span>e TZ=<span class="token string">"Asia/Shanghai"</span> \
<span class="token operator">-</span>e PREFER_HOST_MODE=hostname \
<span class="token operator">-</span>e MODE=standalone \
<span class="token operator">-</span>e SPRING_DATASOURCE_PLATFORM=mysql \
<span class="token comment"># 你的数据库服务器公网IP地址</span>
<span class="token operator">-</span>e MYSQL_SERVICE_HOST=127<span class="token punctuation">.</span>0<span class="token punctuation">.</span>0<span class="token punctuation">.</span>1 \
<span class="token comment"># 你的数据库服务器端口</span>
<span class="token operator">-</span>e MYSQL_SERVICE_PORT=3306 \
<span class="token comment"># 你的数据库账号</span>
<span class="token operator">-</span>e MYSQL_SERVICE_USER=root \
<span class="token comment"># 你的数据库密码</span>
<span class="token operator">-</span>e MYSQL_SERVICE_PASSWORD=root \
<span class="token operator">-</span>e MYSQL_SERVICE_DB_NAME=nacos \
<span class="token operator">-</span>e MYSQL_SERVICE_DB_PARAM= \
<span class="token operator">-</span>e NACOS_APPLICATION_PORT=8848 \
<span class="token operator">-</span>p 8848:8848 \
<span class="token operator">-</span>p 9848:9848 \
<span class="token operator">-</span>p 9849:9849 \
<span class="token operator">--</span>name nacos \
<span class="token operator">--</span>restart=always \
nacos/nacos-server:v2<span class="token punctuation">.</span>0<span class="token punctuation">.</span>3
</code></pre> 
<h3><a id="9__296"></a>9 查看容器日志</h3> 
<pre><code class="prism language-powershell">docker logs <span class="token operator">-</span>f nacos
</code></pre> 
<p><img src="https://images2.imgbox.com/01/08/qZiozPvV_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="10__302"></a>10 开放对应端口</h3> 
<p><strong>P.S. 9848与9849端口为RPC调用端口，都需要开放</strong><br> <img src="https://images2.imgbox.com/67/a7/ghaH9mMM_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_305"></a>二、搭建测试项目</h2> 
<h3><a id="1_Nacos_306"></a>1 Nacos配置</h3> 
<h4><a id="11__307"></a>1.1 创建命名空间</h4> 
<p><img src="https://images2.imgbox.com/d3/0d/4PcbmO2I_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="12__309"></a>1.2 创建配置文件</h4> 
<p><img src="https://images2.imgbox.com/2e/03/5pFPx0Gr_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="2__311"></a>2 项目信息</h3> 
<h4><a id="21__312"></a>2.1 版本</h4> 
<ol><li>JAVA 17</li><li>Nacos 2.0.3</li><li>SpringBoot 3.0.5</li><li>CentOS 7.5</li></ol> 
<h4><a id="22__318"></a>2.2 依赖</h4> 
<pre><code class="prism language-java"><span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">"1.0"</span> encoding<span class="token operator">=</span><span class="token string">"UTF-8"</span><span class="token operator">?</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>project xmlns<span class="token operator">=</span><span class="token string">"http://maven.apache.org/POM/4.0.0"</span>
         xmlns<span class="token operator">:</span>xsi<span class="token operator">=</span><span class="token string">"http://www.w3.org/2001/XMLSchema-instance"</span>
         xsi<span class="token operator">:</span>schemaLocation<span class="token operator">=</span><span class="token string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span><span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>modelVersion<span class="token punctuation">&gt;</span></span><span class="token number">4.0</span><span class="token number">.0</span><span class="token operator">&lt;</span><span class="token operator">/</span>modelVersion<span class="token operator">&gt;</span>

    <span class="token generics"><span class="token punctuation">&lt;</span>parent<span class="token punctuation">&gt;</span></span>
        <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
        <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>spring<span class="token operator">-</span>boot<span class="token operator">-</span>starter<span class="token operator">-</span>parent<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
        <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">3.0</span><span class="token number">.5</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>parent<span class="token operator">&gt;</span>

    <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>com<span class="token punctuation">.</span>catalpa<span class="token punctuation">.</span>study<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>nacos<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">1.0</span><span class="token operator">-</span>SNAPSHOT<span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>

    <span class="token generics"><span class="token punctuation">&lt;</span>dependencies<span class="token punctuation">&gt;</span></span>
        <span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
            <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
            <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>spring<span class="token operator">-</span>boot<span class="token operator">-</span>starter<span class="token operator">-</span>web<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>

        <span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
            <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>cloud<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
            <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>spring<span class="token operator">-</span>cloud<span class="token operator">-</span>starter<span class="token operator">-</span>alibaba<span class="token operator">-</span>nacos<span class="token operator">-</span>config<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
            <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">2022.0</span><span class="token number">.0</span><span class="token number">.0</span><span class="token operator">-</span>RC1<span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>dependencies<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>project<span class="token operator">&gt;</span>
</code></pre> 
<h4><a id="23__352"></a>2.3 项目结构</h4> 
<p><img src="https://images2.imgbox.com/d7/3c/OqIYcm7u_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="24_bootstrapproperties_354"></a>2.4 bootstrap.properties配置文件</h4> 
<pre><code class="prism language-java"># 你的服务器公网IP地址与端口
spring<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>nacos<span class="token punctuation">.</span>config<span class="token punctuation">.</span>server<span class="token operator">-</span>addr<span class="token operator">=</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">8848</span>
# 项目的命名空间的ID
spring<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>nacos<span class="token punctuation">.</span>config<span class="token punctuation">.</span>namespace<span class="token operator">=</span>xxx
# 当前的<span class="token class-name">Group</span>
spring<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>nacos<span class="token punctuation">.</span>config<span class="token punctuation">.</span>group<span class="token operator">=</span>DEFAULT_GROUP
# 配置文件的文件后缀
spring<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>nacos<span class="token punctuation">.</span>config<span class="token punctuation">.</span>fileExtension<span class="token operator">=</span>properties
# 项目名称
spring<span class="token punctuation">.</span>application<span class="token punctuation">.</span>name<span class="token operator">=</span>bread<span class="token operator">-</span>backend
</code></pre> 
<h4><a id="25_Application_368"></a>2.5 Application启动类</h4> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>catalpa<span class="token punctuation">.</span>study</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>client<span class="token punctuation">.</span>discovery<span class="token punctuation">.</span></span><span class="token class-name">EnableDiscoveryClient</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ComponentScan</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author zjwu
 */</span>
<span class="token annotation punctuation">@ComponentScan</span>
<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@EnableDiscoveryClient</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Application</span> <span class="token punctuation">{<!-- --></span>

	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">"nacos.logging.default.config.enabled"</span><span class="token punctuation">,</span> <span class="token string">"false"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">"spring.cloud.bootstrap.enabled"</span><span class="token punctuation">,</span> <span class="token string">"true"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Application</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre> 
<h3><a id="3__395"></a>3 启动项目</h3> 
<p><strong>端口一致，配置成功</strong><br> <img src="https://images2.imgbox.com/9c/78/EssbnbFL_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1ba7c857aa76f153a1e5ca349b95b46c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">springboot系列四：集成log4j2</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e51ef23a4ee380d620d0003fe7242651/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Rust-Rocket框架笔记</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>