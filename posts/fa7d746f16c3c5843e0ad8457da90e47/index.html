<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Oracle学习笔记 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Oracle学习笔记" />
<meta property="og:description" content="一、Oracle的表空间 Oracle数据库开创性地提出了表空间的设计理念，这为Oracle数据库的高性能做出了不可磨灭的贡献。可以这么说，Oracle中很多优化都是基于表空间的设计理念而实现的。
ORACLE数据库被划分成称作为表空间 [1] 的逻辑区域——形成ORACLE数据库的逻辑结构。一个ORACLE数据库能够有一个或多个表空间,而一个表空间则对应着一个或多个物理的数据库文件。表空间是ORACLE数据库恢复的最小单位,容纳着许多数据库实体,如表、视图、索引、聚簇、回退段和临时段等。
1、Oracle中表空间的作用：
1.决定数据库实体的空间分配
2.设置数据库用户的空间份额
3.控制数据库部分数据的可用性;
4.分布数据于不同的设备之间以改善性能;
5.备份和恢复数据。
一个数据库可以包含多个表空间（主要用于存放表的区域），一个表空间只能属于一个数据库。同样，一个表空间内可以包含多个数据文件，但一个数据文件只能属于一个表空间。Oracle中至少存在一个表空间，即SYSTEM表空间，系统中默认存在的表空间System、Sysaux、users、undotbs1、Example、TEMP
2、表空间操作
注意操作表空间需要使用dba用户或拥有dba用户授予的权限
1.查看表空间（需要dba权限）
select * from v$tablespace; 2.查看表空间中的数据文件
select file_name,tablespace_name from dba_data_files; 3.创建表空间
create tablespace test_data datafile &#39;test_data01.dbf &#39; size 32m autoextend on next 32m maxsize 2048m extent management local; 4.删除表空间
drop tablespace test_data including contents and datafiles; 5.创建临时表空间
create temporary tablespace test_temp tempfile &#39;mp01.dbf&#39; size 32m autoextend on next 32m maxsize 2048m extent management local; 临时表空间用来管理数据库排序操作以及用于存储临时表、中间排序结果等临时对象。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/fa7d746f16c3c5843e0ad8457da90e47/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-11-17T10:37:00+08:00" />
<meta property="article:modified_time" content="2021-11-17T10:37:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Oracle学习笔记</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="Oracle_0"></a>一、Oracle的表空间</h3> 
<p>Oracle数据库开创性地提出了表空间的设计理念，这为Oracle数据库的高性能做出了不可磨灭的贡献。可以这么说，Oracle中很多优化都是基于表空间的设计理念而实现的。<br> ORACLE数据库被划分成称作为表空间 [1] 的逻辑区域——形成ORACLE数据库的逻辑结构。一个ORACLE数据库能够有一个或多个表空间,而一个表空间则对应着一个或多个物理的数据库文件。表空间是ORACLE数据库恢复的最小单位,容纳着许多数据库实体,如表、视图、索引、聚簇、回退段和临时段等。</p> 
<p><strong>1、Oracle中表空间的作用：</strong></p> 
<p>1.决定数据库实体的空间分配</p> 
<p>2.设置数据库用户的空间份额</p> 
<p>3.控制数据库部分数据的可用性;</p> 
<p>4.分布数据于不同的设备之间以改善性能;</p> 
<p>5.备份和恢复数据。</p> 
<blockquote> 
 <p>一个数据库可以包含多个表空间（主要用于存放表的区域），一个表空间只能属于一个数据库。同样，一个表空间内可以包含多个数据文件，但一个数据文件只能属于一个表空间。Oracle中至少存在一个表空间，即SYSTEM表空间，系统中默认存在的表空间System、Sysaux、users、undotbs1、Example、TEMP</p> 
</blockquote> 
<p><strong>2、表空间操作</strong></p> 
<p><code>注意操作表空间需要使用dba用户或拥有dba用户授予的权限</code><br> 1.查看表空间（需要dba权限）</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> v$<span class="token keyword">tablespace</span><span class="token punctuation">;</span>
</code></pre> 
<p>2.查看表空间中的数据文件</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> file_name<span class="token punctuation">,</span>tablespace_name <span class="token keyword">from</span> dba_data_files<span class="token punctuation">;</span>
</code></pre> 
<p>3.创建表空间</p> 
<pre><code class="prism language-sql"><span class="token keyword">create</span> <span class="token keyword">tablespace</span> test_data  
datafile <span class="token string">'test_data01.dbf '</span>  
size <span class="token number">32</span>m  
autoextend <span class="token keyword">on</span>  
<span class="token keyword">next</span> <span class="token number">32</span>m 
maxsize <span class="token number">2048</span>m  
extent management <span class="token keyword">local</span><span class="token punctuation">;</span>
</code></pre> 
<p>4.删除表空间</p> 
<pre><code class="prism language-sql"><span class="token keyword">drop</span> <span class="token keyword">tablespace</span> test_data including contents <span class="token operator">and</span> datafiles<span class="token punctuation">;</span>
</code></pre> 
<p>5.创建临时表空间</p> 
<pre><code class="prism language-sql"><span class="token keyword">create</span> <span class="token keyword">temporary</span> <span class="token keyword">tablespace</span> test_temp 
tempfile <span class="token string">'mp01.dbf'</span> 
size <span class="token number">32</span>m 
autoextend <span class="token keyword">on</span> <span class="token keyword">next</span> <span class="token number">32</span>m 
maxsize <span class="token number">2048</span>m 
extent management <span class="token keyword">local</span><span class="token punctuation">;</span>
</code></pre> 
<p>临时表空间用来管理数据库排序操作以及用于存储临时表、中间排序结果等临时对象。<br> 1、局部临时表（#开头）只对当前连接有效，当前连接断开时自动删除。<br> 2、全局临时表（##开头）对其它连接也有效，在当前连接和其他访问过它的连接都断开时自动删除。<br> 3、不管局部临时表还是全局临时表，只要连接有访问权限，都可以用drop table #Tmp(或者drop table ##Tmp)来显式删除临时表。</p> 
<p>扩展：<br> <strong>同义词</strong><br> 同异词是数据库对象的一个别名，经常用于简化对象访问和提高对象访问的安全性。同义词有私有同义词和公用同义词。私有同义词只供创建它的用户使用，公用同义词可供数据库所有对象使用。</p> 
<p>创建同义词</p> 
<pre><code class="prism language-sql"><span class="token keyword">create</span> <span class="token punctuation">[</span><span class="token keyword">public</span><span class="token punctuation">]</span> synonym 同义词名称 <span class="token keyword">for</span> <span class="token punctuation">[</span>username<span class="token punctuation">.</span><span class="token punctuation">]</span>objectName
</code></pre> 
<p>删除同义词</p> 
<pre><code class="prism language-sql"><span class="token keyword">drop</span> <span class="token punctuation">[</span><span class="token keyword">public</span><span class="token punctuation">]</span> synonym 同义词<span class="token punctuation">;</span>
</code></pre> 
<p>查看同义词</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> dba_synonyms<span class="token operator">/</span>user_synonyms<span class="token punctuation">;</span>
</code></pre> 
<h3><a id="_75"></a>二、用户权限管理</h3> 
<p>引言：学会在Oracle中如何创建表空间后，就要学会怎么去给用户分配这些表空间的使用，即给用户使用、查看的权限。<code>注意以下操作需要使用sys或system用户权限</code></p> 
<p><strong>用户管理</strong><br> 1.创建用户</p> 
<pre><code class="prism language-sql"><span class="token keyword">create</span> <span class="token keyword">user</span> username identified <span class="token keyword">by</span> password<span class="token punctuation">;</span>
</code></pre> 
<p>2.创建并给用户分配表空间</p> 
<pre><code class="prism language-sql"><span class="token keyword">create</span> <span class="token keyword">user</span> username
identified <span class="token keyword">by</span> <span class="token number">1223456</span>
<span class="token keyword">default</span> <span class="token keyword">tablespace</span> tablespacename
<span class="token keyword">temporary</span> <span class="token keyword">tablespace</span> temp_tablespacename<span class="token punctuation">;</span>
</code></pre> 
<p>3.删除用户</p> 
<pre><code class="prism language-sql"><span class="token comment"># 用户下没有任何对象</span>
<span class="token keyword">drop</span> <span class="token keyword">user</span> xxx
<span class="token comment"># 用户下存在对象，必须加cascade删除用户下所有对象。</span>
<span class="token keyword">drop</span> <span class="token keyword">user</span> xxx <span class="token keyword">cascade</span>
</code></pre> 
<p>4.锁定/解锁用户（可以不删除用户，拒绝用户连接）</p> 
<pre><code class="prism language-sql"><span class="token keyword">alter</span> <span class="token keyword">user</span> username account <span class="token keyword">lock</span><span class="token operator">/</span><span class="token keyword">unlock</span><span class="token punctuation">;</span>
</code></pre> 
<p>5.修改用户密码</p> 
<pre><code class="prism language-sql"><span class="token comment"># 如果忘记了普通用户的密码，也可在这里直接修改。</span>
<span class="token keyword">alter</span> <span class="token keyword">user</span> username identified <span class="token keyword">by</span> password<span class="token punctuation">;</span>
</code></pre> 
<p>6.查看当前用户的相关信息（用户名、默认表空间…）</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> user_users<span class="token punctuation">;</span>
</code></pre> 
<blockquote> 
 <p>一个用户可以使用一个或多个表空间，一个表空间也可以供多个用户使用。用户与表空间没有隶属关系。</p> 
</blockquote> 
<p><strong>权限（privilege）管理</strong><br> 用户权限有系统权限和对象权限两种。系统权限即数据库的使用权限，只能由DBA用户（sys，system）授出。用户权限包括：</p> 
<ul><li>dba：拥有全部特权，是系统最高权限。</li><li>resource：拥有访问数据库对象的权限。</li><li>connect：拥有连接数据库的权限，但不可以访问数据库对象。</li></ul> 
<p>对象权限是某种权限用户对其他用户的表或视图的存取权限，它允许用户对一些特定的对象，进行更新、插入等操作。对象权限包括：</p> 
<ul><li>select ，update，insert ，alter ，alter ，index，delete，all（所有权限），execute（执行存储过程的权限）</li></ul> 
<p>1.给用户授予系统权限 √ connect,resource…</p> 
<pre><code class="prism language-sql"><span class="token keyword">grant</span> privilege <span class="token keyword">to</span> username
</code></pre> 
<p>2.给用户授予对象权限 √select ，update，insert…</p> 
<pre><code class="prism language-sql"><span class="token keyword">grant</span> <span class="token keyword">select</span> <span class="token keyword">on</span> tablename <span class="token keyword">to</span> username
</code></pre> 
<p>3.撤销用户权限</p> 
<pre><code class="prism language-sql"><span class="token comment"># 撤销系统权限</span>
<span class="token keyword">revoke</span> <span class="token keyword">connect</span> <span class="token keyword">from</span> username<span class="token punctuation">;</span>
<span class="token comment"># 撤销对象权限</span>
<span class="token keyword">revoke</span> <span class="token keyword">select</span> <span class="token keyword">on</span> tablename <span class="token keyword">from</span> username
</code></pre> 
<p>4.给用户授予<strong>系统权限</strong>并拥有授予其他用户的权利。例如授权给A ，A可以授权给B。<code>撤销A的权限后，B不会受到影响</code>。</p> 
<pre><code class="prism language-sql"><span class="token comment"># with admin option只能用于系统权限授权</span>
<span class="token keyword">grant</span> privilege <span class="token keyword">to</span> username <span class="token keyword">with</span> admin <span class="token keyword">option</span>
</code></pre> 
<p>5.给用户授予<strong>对象权限</strong>并拥有授权给其他用户的权利。<code>撤销权限级联，如给A授权后，A授权给B。撤销A的权限后，B的权限也会撤销。注意不能直接撤销B的权限！</code></p> 
<pre><code class="prism language-sql"><span class="token comment"># with grant option只能用于给对象权限授权</span>
<span class="token keyword">grant</span> <span class="token keyword">select</span> <span class="token keyword">on</span> tablename <span class="token keyword">to</span> username <span class="token keyword">with</span> <span class="token keyword">grant</span> <span class="token keyword">option</span>
</code></pre> 
<p><strong>角色管理</strong><br> 角色就是一组权限，更加方便权限管理。例如给多个用户赋予一个角色role0，那么就可以通过修改这个角色的权限达到批处理的功能。<br> 1.创建角色</p> 
<pre><code class="prism language-sql"><span class="token keyword">create</span> role 角色名
</code></pre> 
<p>2.给角色授权</p> 
<pre><code class="prism language-sql"><span class="token keyword">grant</span> 系统权限 <span class="token keyword">to</span> 角色
<span class="token keyword">grant</span> 对象权限 <span class="token keyword">on</span> 对象 <span class="token keyword">to</span> 角色
</code></pre> 
<p>3.撤销角色权限</p> 
<pre><code class="prism language-sql"><span class="token keyword">revoke</span> 系统权限 <span class="token keyword">from</span> 角色
<span class="token keyword">revoke</span> 对象权限 <span class="token keyword">on</span> 对象 <span class="token keyword">from</span> 角色
</code></pre> 
<p>4.将角色赋予用户</p> 
<pre><code class="prism language-sql"><span class="token keyword">grant</span> 角色 <span class="token keyword">to</span> 用户
</code></pre> 
<p>查看权限</p> 
<pre><code class="prism language-sql"><span class="token comment"># 查看用户所有系统权限</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> user_sys_privs

<span class="token comment"># 查看用户所属角色</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> user_role_privs<span class="token punctuation">;</span>

<span class="token comment"># 角色有哪些系统权限</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> role_sys_privs<span class="token punctuation">;</span>

<span class="token comment"># 角色有哪些对象权限</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> role_tab privs<span class="token punctuation">;</span>
</code></pre> 
<h3><a id="PLSQL_183"></a>三、PLSQL编程</h3> 
<p>简介：PL/SQL (Procedure Language &amp; Structured Query Language)，PL/SQL是Oracle数据库对SQL语句的扩展。它在普通SQL语句的使用上增加了编程语言的特点，所以PL/SQL就是把数据操作和查询语句组织在PL/SQL代码的过程性单元中，通过逻辑判断、循环等操作实现复杂的功能或者计算的程序语言。<br> 简单来说就是：PLSQL能够帮助我们实现SQL语句的复用，还可以在中间添加逻辑代码。</p> 
<p><strong>PL/SQL具有的特点：</strong><br> ⒈能够使一组SQL语句的功能更具模块化程序特点;（模块化就是可以实现复用）<br> ⒉采用了过程性语言控制程序的结构；<br> ⒊可以对程序中的错误进行自动处理，使程序能够在遇到错误的时候不会被中断；<br> ⒋具有较好的可移植性，可以移植到另一个Oracle数据库中；<br> ⒌集成在数据库中，调用更快；<br> ⒍减少了网络的交互，有助于提高程序性能；<br> 7 运行错误的可处理性；<br> 8 提供大量内置程序包；</p> 
<p>注意：在 PL/SQL中只能用 SQL语句中的 DML 部分，不能用 DDL 部分，如果要在PL/SQL中使用DDL(如CREATE table 等)的话，只能以动态的方式来使用。</p> 
<blockquote> 
 <p>DML（Data Manipulation Language）数据操作语言，如SELECT，UPDATE，INSERT，DELETE。<br> DDL（Data Definition Language）数据定义语言，如CREATE、ALTER、DROP。<br> DCL（Data Control Language）数据控制语言，如Commit，Rollback，Grant。</p> 
</blockquote> 
<p><strong>PL/SQL程序由三个块组成，即声明部分、执行部分、异常处理部分。</strong><br> 示例：</p> 
<pre><code class="prism language-sql"><span class="token keyword">declare</span>
	<span class="token comment">--声明语句;</span>
<span class="token keyword">begin</span>
	<span class="token comment">--执行语句;</span>
exception
	<span class="token comment">--异常处理</span>
<span class="token keyword">end</span><span class="token punctuation">;</span>
</code></pre> 
<p><strong>声明变量与赋值</strong></p> 
<pre><code class="prism language-sql"><span class="token number">1.</span>声明变量的格式： 变量名 数据类型<span class="token punctuation">;</span> i <span class="token keyword">int</span> :<span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token number">2.</span>变量类型：<span class="token keyword">char</span>、varchar2、number、long、<span class="token keyword">date</span>、<span class="token keyword">boolean</span>

<span class="token number">3.</span>变量赋值：
（<span class="token number">1</span>）普通赋值方式：a :<span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
（<span class="token number">2</span>）数据库赋值（使用<span class="token keyword">select</span> <span class="token keyword">into</span>）：
<span class="token keyword">DECLARE</span> 
  n VARCHAR2<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">BEGIN</span>  
  <span class="token keyword">SELECT</span> ename <span class="token keyword">INTO</span> n <span class="token keyword">FROM</span> emp 
  <span class="token keyword">WHERE</span> empno <span class="token operator">=</span> <span class="token number">7900</span><span class="token punctuation">;</span>
  dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>
（<span class="token number">3</span>）数据库赋值（使用<span class="token keyword">insert</span><span class="token operator">/</span><span class="token keyword">update</span><span class="token operator">/</span><span class="token keyword">delete</span>的<span class="token keyword">returning</span>赋值）
<span class="token keyword">declare</span> 
  n <span class="token keyword">varchar</span>
  row_id rowid
<span class="token keyword">begin</span>
  <span class="token keyword">insert</span> <span class="token keyword">into</span> emp<span class="token punctuation">(</span>empno<span class="token punctuation">,</span>ename<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1234</span><span class="token punctuation">,</span><span class="token string">'孙杨'</span><span class="token punctuation">)</span>
  <span class="token keyword">returning</span> rowid<span class="token punctuation">,</span>ename <span class="token keyword">into</span> row_id<span class="token punctuation">,</span>n<span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span>

（<span class="token number">4</span>）复合数据类型——记录类型
记录类型是将逻辑相关的分离的基本数据类型的变量组合成一个类型，相当于封装了不同类的对象类型。
<span class="token keyword">declare</span>
  <span class="token keyword">type</span> student <span class="token operator">is</span> record<span class="token punctuation">(</span>
    sid_ <span class="token keyword">int</span>
    name_ varchar2<span class="token punctuation">,</span>
    birth <span class="token keyword">date</span>
  <span class="token punctuation">)</span>
  stu student<span class="token punctuation">;</span>
<span class="token keyword">begin</span>
  <span class="token keyword">select</span> empno<span class="token punctuation">,</span>ename<span class="token punctuation">,</span>hiredate <span class="token keyword">into</span> stu <span class="token keyword">from</span> emp 
  <span class="token keyword">where</span> empno<span class="token operator">=</span><span class="token number">7900</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span>

（<span class="token number">5</span>）复合数据类型——表类型
表类型是对记录类型的扩展。它可以处理多行记录，类似于高级中的二维数组，使得可以在PL<span class="token operator">/</span><span class="token keyword">SQL</span>中模仿数据库中的表。
使用表格类型的优点：
所引用的数据库列的数据类型可以不必知道。
所引用的数据库列的数据类型可以实时改变，容易保持一致，也不用修改PL<span class="token operator">/</span><span class="token keyword">SQL</span>程序。
例<span class="token number">1</span>：记录某个表字段类型使用<span class="token operator">%</span><span class="token keyword">type</span>
empno_ emp<span class="token punctuation">.</span>empno<span class="token operator">%</span><span class="token keyword">TYPE</span>
例<span class="token number">2</span>：记录某个表行（所有字段的类型）使用<span class="token operator">%</span>rowtype
<span class="token keyword">declare</span>
  r_emp emp<span class="token operator">%</span>ROWTYPE<span class="token punctuation">;</span>
<span class="token keyword">begin</span>
  <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">into</span> r_emp <span class="token keyword">from</span> emp
  <span class="token keyword">where</span> empno<span class="token operator">=</span><span class="token number">7900</span>
  dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span>r_emp<span class="token punctuation">.</span>ename<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span>
</code></pre> 
<p><strong>条件语句</strong></p> 
<pre><code class="prism language-sql"><span class="token number">1.</span><span class="token keyword">if</span>条件语句
<span class="token keyword">declare</span>
  salary emp<span class="token punctuation">.</span>sal<span class="token operator">%</span><span class="token keyword">type</span><span class="token punctuation">;</span>
  empno_ emp<span class="token punctuation">.</span>empno<span class="token operator">%</span><span class="token keyword">type</span><span class="token punctuation">;</span>
<span class="token keyword">begin</span>
  empno_ :<span class="token operator">=</span> <span class="token operator">&amp;</span>请出入员工编号<span class="token punctuation">;</span>
  <span class="token keyword">select</span> sal <span class="token keyword">into</span> salary <span class="token keyword">from</span> emp <span class="token keyword">where</span> empno <span class="token operator">=</span> empno_<span class="token punctuation">;</span>
  <span class="token keyword">if</span> salary <span class="token operator">&gt;</span> <span class="token number">2000</span> <span class="token keyword">then</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  elsif salary <span class="token operator">between</span> <span class="token number">1000</span> <span class="token operator">and</span> <span class="token number">2000</span> <span class="token keyword">then</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  <span class="token keyword">else</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  <span class="token keyword">end</span> <span class="token keyword">if</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span>
<span class="token number">2.</span><span class="token keyword">case</span>条件语句
例<span class="token number">1</span>：<span class="token keyword">case</span>在<span class="token keyword">SQL</span>语句中使用
<span class="token keyword">select</span> <span class="token keyword">case</span> grade 
  <span class="token keyword">when</span> <span class="token number">1</span> <span class="token keyword">then</span> <span class="token string">'一级'</span>
  <span class="token keyword">when</span> <span class="token number">2</span> <span class="token keyword">then</span> <span class="token string">'二级'</span>
  <span class="token keyword">else</span> <span class="token string">'更高级'</span>
  <span class="token keyword">end</span>
<span class="token keyword">from</span> salgrade<span class="token punctuation">;</span>
例<span class="token number">2</span>：<span class="token keyword">case</span>在pl<span class="token operator">/</span><span class="token keyword">sql</span>中使用
<span class="token keyword">DECLARE</span>
  g VARCHAR2<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  v <span class="token keyword">INT</span><span class="token punctuation">;</span>
<span class="token keyword">BEGIN</span>
  v :<span class="token operator">=</span> <span class="token operator">&amp;</span>请输入数字<span class="token punctuation">;</span>
  g :<span class="token operator">=</span> <span class="token keyword">CASE</span> v <span class="token keyword">WHEN</span> <span class="token number">1</span> <span class="token keyword">THEN</span> <span class="token string">'一级'</span>
    <span class="token keyword">WHEN</span> <span class="token number">2</span> <span class="token keyword">THEN</span> <span class="token string">'二级'</span>
      <span class="token keyword">ELSE</span> <span class="token string">'错误'</span>
        <span class="token keyword">END</span><span class="token punctuation">;</span>
  dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>
</code></pre> 
<p><strong>循环</strong></p> 
<pre><code class="prism language-sql"><span class="token number">1.</span>简单循环 <span class="token keyword">loop</span> 
<span class="token keyword">declare</span>
  i <span class="token keyword">int</span> :<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">begin</span>
  <span class="token keyword">loop</span>
    i:<span class="token operator">=</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">exit</span> <span class="token keyword">when</span> i <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span> <span class="token comment">-- 作用类似java循环中break语句</span>
  <span class="token keyword">end</span> <span class="token keyword">loop</span><span class="token punctuation">;</span>
  dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span>

<span class="token number">2.</span><span class="token keyword">while</span>循环
<span class="token keyword">declare</span>
  i <span class="token keyword">int</span> :<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">begin</span>
  <span class="token keyword">while</span> i<span class="token operator">&lt;</span><span class="token number">100</span> <span class="token keyword">loop</span> <span class="token comment">--判断条件写在前面</span>
    i:<span class="token operator">=</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span> 
  <span class="token keyword">end</span> <span class="token keyword">loop</span><span class="token punctuation">;</span>
  dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span>

<span class="token number">3.</span>数字式循环 <span class="token keyword">for</span> <span class="token operator">in</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token keyword">loop</span>
<span class="token keyword">DECLARE</span>
  i <span class="token keyword">INT</span> :<span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">BEGIN</span>
  <span class="token keyword">FOR</span> i <span class="token operator">IN</span> REVERSE <span class="token number">0.</span><span class="token number">.100</span> <span class="token keyword">LOOP</span>
  <span class="token keyword">END</span> <span class="token keyword">LOOP</span><span class="token punctuation">;</span>
  dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>
<span class="token comment">-- Reverse为可选参数</span>
</code></pre> 
<p><strong>游标(cursor)</strong><br> 游标提供了一种对从表中检索出的数据进行操作的灵活手段，就本质而言，游标实际上是一种能从包括多条数据记录的结果集中每次提取一条记录的机制<br> 在PL/SQL块中执行SELECT、INSERT、DELETE和UPDATE语句时，ORACLE会在内存中为其分配上下文区（Context Area），即缓冲区。游标是指向该区的一个指针<br> 1.显示游标与隐式游标<br> 显式游标：<br> 显式游标主要是用于对查询语句的处理，尤其是在查询结果为多条记录的情况下<br> 隐式游标：<br> 对于非查询语句，如修改、删除操作，则由ORACLE系统自动设置游标</p> 
<p>2.显示游标处理步骤<br> 1）定义/声明游标<br> 2）打开游标<br> 3）提取游标数据<br> 4）关闭游标</p> 
<p>案例1： 游标基本使用</p> 
<pre><code class="prism language-sql"><span class="token keyword">DECLARE</span>
  <span class="token keyword">CURSOR</span> c <span class="token operator">IS</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> dept<span class="token punctuation">;</span> <span class="token comment">-- 1定义用于遍历查询结果的游标</span>
  v_dept dept<span class="token operator">%</span>ROWTYPE<span class="token punctuation">;</span>
<span class="token keyword">BEGIN</span>
  <span class="token keyword">OPEN</span> c<span class="token punctuation">;</span> <span class="token comment">-- 2打开游标</span>
  <span class="token keyword">FETCH</span> c <span class="token keyword">INTO</span> v_dept<span class="token punctuation">;</span> <span class="token comment">-- 3提取游标数据</span>
  <span class="token keyword">WHILE</span> c<span class="token operator">%</span>FOUND <span class="token keyword">LOOP</span>  <span class="token comment">--判断上一次提取游标操作是否成功</span>
    dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span>v_dept<span class="token punctuation">.</span>dname<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token keyword">FETCH</span> c <span class="token keyword">INTO</span> v_dept
  <span class="token keyword">END</span> <span class="token keyword">LOOP</span><span class="token punctuation">;</span>
  <span class="token keyword">CLOSE</span> c<span class="token punctuation">;</span><span class="token comment">--4关闭游标</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>

案例<span class="token number">2</span>： 基于游标定义变量
<span class="token keyword">DECLARE</span>
  <span class="token keyword">CURSOR</span> c<span class="token punctuation">(</span>no_ dept<span class="token punctuation">.</span>deptno<span class="token operator">%</span><span class="token keyword">TYPE</span><span class="token punctuation">)</span> 
         <span class="token operator">IS</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> dept <span class="token keyword">where</span> dept<span class="token punctuation">.</span>deptno <span class="token operator">&gt;=</span> no_<span class="token punctuation">;</span>
  v_dept c<span class="token operator">%</span>ROWTYPE<span class="token punctuation">;</span>
<span class="token keyword">BEGIN</span>
  <span class="token keyword">OPEN</span> c<span class="token punctuation">(</span>no_ <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">-- 该参数用于填充到Select游标绑定的查询语句中</span>
  <span class="token keyword">FETCH</span> c <span class="token keyword">INTO</span> v_dept<span class="token punctuation">;</span>
  <span class="token keyword">WHILE</span> c<span class="token operator">%</span>FOUND <span class="token keyword">LOOP</span>
    dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span>v_dept<span class="token punctuation">.</span>dname<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">FETCH</span> c <span class="token keyword">INTO</span> v_dept<span class="token punctuation">;</span>
  <span class="token keyword">END</span> <span class="token keyword">LOOP</span><span class="token punctuation">;</span>
  <span class="token keyword">CLOSE</span> c<span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>

案例<span class="token number">3</span>：
<span class="token keyword">DECLARE</span>
  <span class="token keyword">CURSOR</span> c <span class="token operator">IS</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> dept<span class="token punctuation">;</span>
  <span class="token keyword">TYPE</span> t_dept <span class="token operator">IS</span> <span class="token keyword">TABLE</span> <span class="token keyword">OF</span> dept<span class="token operator">%</span>ROWTYPE <span class="token keyword">INDEX</span> <span class="token keyword">BY</span> BINARY_INTEGER<span class="token punctuation">;</span>
  v_dept t_dept<span class="token punctuation">;</span>
  i <span class="token keyword">INT</span> :<span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">BEGIN</span>
  <span class="token keyword">OPEN</span> c<span class="token punctuation">;</span>
  <span class="token keyword">FETCH</span> c <span class="token keyword">INTO</span> v_dept<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">WHILE</span> c<span class="token operator">%</span>FOUND <span class="token keyword">LOOP</span>
    i :<span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">FETCH</span> c <span class="token keyword">INTO</span> v_dept<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">END</span> <span class="token keyword">LOOP</span><span class="token punctuation">;</span>
  <span class="token keyword">CLOSE</span> c<span class="token punctuation">;</span>
  <span class="token keyword">FOR</span> i <span class="token operator">IN</span> v_dept<span class="token punctuation">.</span><span class="token keyword">first</span><span class="token punctuation">.</span><span class="token punctuation">.</span>v_dept<span class="token punctuation">.</span><span class="token keyword">last</span> <span class="token keyword">LOOP</span>
    <span class="token keyword">IF</span> v_dept<span class="token punctuation">.</span><span class="token keyword">exists</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token boolean">TRUE</span> <span class="token keyword">THEN</span>
       dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span>v_dept<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span>dname<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>
  <span class="token keyword">END</span> <span class="token keyword">LOOP</span><span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>
</code></pre> 
<p>3.游标的for循环<br> PL/SQL语言提供了游标FOR循环语句，自动执行游标的OPEN、FETCH、CLOSE语句和循环语句的功能</p> 
<pre><code class="prism language-sql"><span class="token keyword">DECLARE</span>
  <span class="token keyword">CURSOR</span> x <span class="token operator">IS</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> dept<span class="token punctuation">;</span>
<span class="token keyword">BEGIN</span>
  <span class="token keyword">FOR</span> y <span class="token operator">IN</span> x <span class="token keyword">LOOP</span>
    dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span>y<span class="token punctuation">.</span>dname<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">END</span> <span class="token keyword">LOOP</span><span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>
</code></pre> 
<p>4.隐式游标的用法<br> 对于非查询语句，如修改、删除操作，ORACLE 系统会自动地为这些操作设置游标并创建其工作区，这些由系统隐含创建的游标称为隐式游标。<br> 隐式游标的名字为SQL<br> 对于隐式游标的操作，如定义、打开、取值及关闭操作，都由ORACLE 系统自动地完成，无需用户进行处理<br> 用户只能通过隐式游标的相关属性，来完成相应的操作<br> 在隐式游标的工作区中，所存放的数据是与用户自定义的显示游标无关的、最新处理的一条SQL语句所包含的数据</p> 
<p><strong>隐式游标的属性</strong><br> <img src="https://images2.imgbox.com/11/9a/s0tABQma_o.png" alt="在这里插入图片描述"></p> 
<p>隐式游标使用案例1：</p> 
<pre><code class="prism language-sql"><span class="token keyword">DECLARE</span>
    V_deptno department_id<span class="token operator">%</span><span class="token keyword">TYPE</span> :<span class="token operator">=</span><span class="token operator">&amp;</span>p_deptno<span class="token punctuation">;</span>
<span class="token keyword">BEGIN</span>
    <span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> employees <span class="token keyword">WHERE</span> department_id<span class="token operator">=</span>v_deptno<span class="token punctuation">;</span>
    <span class="token keyword">IF</span> <span class="token keyword">SQL</span><span class="token operator">%</span>NOTFOUND <span class="token keyword">THEN</span>
        <span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> departments <span class="token keyword">WHERE</span> department_id<span class="token operator">=</span>v_deptno<span class="token punctuation">;</span>
    <span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>
</code></pre> 
<p>5.锁定游标的结果集<br> 游标修改和删除操作是指在游标定位下，修改或删除表中指定的数据行。这时，要求游标查询语句中必须使用FOR UPDATE选项，<br> 以便在打开游标时锁定游标结果集合在表中对应数据行的所有列和部分列。</p> 
<p>案例：从EMPLOYEES表中查询某部门的员工情况，将其工资少于1000的调整为1000</p> 
<pre><code class="prism language-sql"><span class="token keyword">DECLARE</span>
  <span class="token keyword">CURSOR</span> c <span class="token operator">IS</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> emp <span class="token keyword">FOR</span> <span class="token keyword">UPDATE</span><span class="token punctuation">;</span>
<span class="token keyword">BEGIN</span>
  <span class="token keyword">FOR</span> x <span class="token operator">IN</span> c <span class="token keyword">LOOP</span>
    <span class="token keyword">IF</span> x<span class="token punctuation">.</span>sal <span class="token operator">&lt;</span> <span class="token number">1000</span> <span class="token keyword">THEN</span>
      <span class="token keyword">UPDATE</span> emp <span class="token keyword">SET</span> sal <span class="token operator">=</span> <span class="token number">1000</span> <span class="token keyword">WHERE</span> <span class="token keyword">CURRENT</span> <span class="token keyword">OF</span> c<span class="token punctuation">;</span>
    <span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>
  <span class="token keyword">END</span> <span class="token keyword">LOOP</span><span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="_462"></a>四、函数</h3> 
<p>Oracle中的函数一般都是对数据的简单处理，可以方便复用。<br> <code>说明：以下示例中的dual是一个伪表，用于返回一个结果集的临时视图</code></p> 
<p><strong>日期函数</strong></p> 
<pre><code class="prism language-sql">获取系统日期
sysdate

获取系统时间
<span class="token keyword">current_timestamp</span>
 
格式化日期
to_char<span class="token punctuation">(</span>sysdate<span class="token punctuation">,</span><span class="token string">'yyyy-mm-dd hh24:mi:ss'</span><span class="token punctuation">)</span>

将字符串转换成日期
to_date<span class="token punctuation">(</span><span class="token string">'2004-05-07 13:23:44'</span><span class="token punctuation">,</span><span class="token string">'yyyy-mm-dd hh24:mi:ss'</span><span class="token punctuation">)</span>

添加月份
<span class="token keyword">select</span> add_months<span class="token punctuation">(</span>sysdate<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">from</span> dual<span class="token punctuation">;</span>

返回日期中指定月的最后一天
<span class="token keyword">select</span> last_day<span class="token punctuation">(</span>sysdate<span class="token punctuation">)</span> <span class="token keyword">from</span> dual

计算两个日期之前相差多少个月
<span class="token keyword">select</span> months_between<span class="token punctuation">(</span>sysdate<span class="token punctuation">,</span> add_months<span class="token punctuation">(</span>sysdate<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">from</span> dual

返回下个星期<span class="token number">2</span>是哪一天
<span class="token comment"># 星期日 = 1  星期一 = 2  星期二 = 3  星期三 = 4  星期四 = 5  星期五 = 6  星期六 = </span>
<span class="token comment"># 7</span>
<span class="token keyword">SELECT</span> NEXT_DAY<span class="token punctuation">(</span>SYSDATE<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> DUAL<span class="token punctuation">;</span>

用于返回日期<span class="token operator">/</span>时间的单独部分，比如年、月、日、小时、分钟等等
<span class="token comment"># year、month、day、hour、minute、second</span>
<span class="token keyword">select</span> extract<span class="token punctuation">(</span><span class="token keyword">year</span> <span class="token keyword">from</span> sysdate<span class="token punctuation">)</span> <span class="token keyword">from</span> dual<span class="token punctuation">;</span>
</code></pre> 
<p><strong>数字函数</strong></p> 
<pre><code class="prism language-sql">返回x的绝对值
abs<span class="token punctuation">(</span>x<span class="token punctuation">)</span>

返回大于等于x的最小整数值
ceil<span class="token punctuation">(</span>x<span class="token punctuation">)</span> 

返回小于等于x的最大整数值 
floor<span class="token punctuation">(</span>x<span class="token punctuation">)</span> 

返回x的y次幂
power<span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span> 

返回x除以y的余数 
<span class="token function">mod</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span> 

返回四舍五入后的值
<span class="token function">round</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token punctuation">,</span>y<span class="token punctuation">]</span><span class="token punctuation">)</span> 

返回x的平方根 
sqrt<span class="token punctuation">(</span>x<span class="token punctuation">)</span> 

返回x按精度y截取后的值，y为正，表示保留的小数位数，y为负，小数点左边y位变成<span class="token number">0</span>，y为<span class="token number">0</span>或不写取整
trunc<span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token punctuation">,</span>y<span class="token punctuation">]</span><span class="token punctuation">)</span> 
</code></pre> 
<p><strong>字符函数</strong></p> 
<pre><code class="prism language-sql">将数字转换成字符
chr<span class="token punctuation">(</span>x<span class="token punctuation">)</span>

将字符转换成数字
ascii

连接字符串
concat

删除左边空格
ltrim

删除右边空格
rtrim

删除两边空格
trim

转换成大写
upper

转换成小写
lower

替换
<span class="token keyword">replace</span>（string，search_str<span class="token punctuation">[</span><span class="token punctuation">,</span>replace_str<span class="token punctuation">]</span>）

替换，和<span class="token keyword">replace</span>相同，但比<span class="token keyword">replace</span>强大。如<span class="token keyword">select</span> 
translate<span class="token punctuation">(</span>string<span class="token punctuation">,</span>from_str<span class="token punctuation">,</span>to_str<span class="token punctuation">)</span>
translate<span class="token punctuation">(</span><span class="token string">'abcbbaadef'</span><span class="token punctuation">,</span><span class="token string">'bad'</span><span class="token punctuation">,</span><span class="token string">'#@'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> dual　（b将被＃替代，a将被＠替代，d对应的值是空值，将被移走）

填充<span class="token operator">/</span>截取到x个长度，不足的话右边用指定字符填充
rpad（string1<span class="token punctuation">,</span>x<span class="token punctuation">[</span><span class="token punctuation">,</span>string2<span class="token punctuation">]</span>）

填充<span class="token operator">/</span>截取到x个长度，不足的话左边用指定字符填充
lpad（string1<span class="token punctuation">,</span>x<span class="token punctuation">[</span><span class="token punctuation">,</span>string2<span class="token punctuation">]</span>）

截取子串
substr（string<span class="token punctuation">,</span>a<span class="token punctuation">[</span><span class="token punctuation">,</span>b<span class="token punctuation">]</span>）

求字符串的长度
length
</code></pre> 
<p><strong>转换函数</strong><br> 这里主要讲decode()函数<br> decode函数格式为decode(condition,val1,result1,val2,result2…)<br> 其中condition为判断值（可以为一个值，也可以是一个表达式），val1与val2为比较值，当有一个val值与判断值相等时，此方法就会返回这个val值后的result值。返回的result值也可以是一个表示式或是一个查询语句。<br> 下面案例列举出来了它的用法：</p> 
<pre><code class="prism language-sql"><span class="token comment">-- 当查询的d_id值为1是方法的最终结果为'一号'，为2时返回值为'二号'。</span>
<span class="token keyword">select</span> decode<span class="token punctuation">(</span>d_id<span class="token punctuation">,</span>
<span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'一号'</span><span class="token punctuation">,</span>
<span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'二号'</span><span class="token punctuation">,</span>
<span class="token number">3</span><span class="token punctuation">,</span><span class="token string">'三号'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> dept<span class="token punctuation">;</span>

<span class="token comment">-- 嵌套查询的用法</span>
<span class="token keyword">select</span> decode<span class="token punctuation">(</span>d_id<span class="token punctuation">,</span>
<span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> d_name <span class="token keyword">from</span> dept <span class="token keyword">where</span> d_id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> d_name <span class="token keyword">from</span> dept <span class="token keyword">where</span> d_id <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> d_name <span class="token keyword">from</span> dept <span class="token keyword">where</span> d_id <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">from</span> dept<span class="token punctuation">;</span>
</code></pre> 
<p><strong>空值函数</strong><br> 用于补充空值</p> 
<pre><code class="prism language-sql"><span class="token comment">-- expr1为NULL，返回expr2；不为NULL，返回expr1。注意两者的类型要一致</span>
<span class="token keyword">select</span> NVL<span class="token punctuation">(</span>d_name<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">from</span> dept<span class="token punctuation">;</span>

<span class="token comment">-- expr1不为NULL，返回expr2；为NULL，返回expr3。expr2和expr3类型不同的话，expr3会转换为expr2的类型</span>
NVL2<span class="token punctuation">(</span>expr1<span class="token punctuation">,</span> expr2<span class="token punctuation">,</span> expr3<span class="token punctuation">)</span>

<span class="token comment">-- expr1和expr2相等返回NULL，不等则返回expr1</span>
<span class="token keyword">NULLIF</span> <span class="token punctuation">(</span>expr1<span class="token punctuation">,</span> expr2<span class="token punctuation">)</span> 
</code></pre> 
<h3><a id="_605"></a>五、索引与序列</h3> 
<p><strong>索引</strong></p> 
<blockquote> 
 <p><strong>索引的优点：</strong><br> 索引是关系数据库中用于存放每一条记录的一种对象，<code>主要目的是加快数据的读取速度和完整性检查</code>。通过创建唯一性索引，可以保证数据库表中每一行数据的唯一性。 通过使用索引，可以在查询的过程中，使用优化隐藏器，提高系统的性能。<br> <strong>索引的不足：</strong><br> 1、<code>创建索引和维护索引要耗费时间</code>，当对表中的数据进行增加、删除和修改的时候，索引也要动态的维护。<br> 2、索引需要<code>占物理空间</code>，除了数据表占数据空间之外，每一个索引还要占一定的物理空间，如果要建立聚簇索引，那么需要的空间就会更大。</p> 
</blockquote> 
<p>创建和删除索引的方式</p> 
<pre><code class="prism language-sql"><span class="token comment"># 创建索引</span>
<span class="token keyword">CREATE</span> <span class="token punctuation">[</span><span class="token keyword">unique</span><span class="token punctuation">]</span> <span class="token keyword">INDEX</span> <span class="token punctuation">[</span><span class="token keyword">user</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token keyword">index</span><span class="token keyword">ON</span> <span class="token punctuation">[</span><span class="token keyword">user</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token keyword">table</span> <span class="token punctuation">(</span><span class="token keyword">column</span> <span class="token punctuation">[</span><span class="token keyword">ASC</span> <span class="token operator">|</span> <span class="token keyword">DESC</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token keyword">column</span><span class="token punctuation">[</span><span class="token keyword">ASC</span> <span class="token operator">|</span> <span class="token keyword">DESC</span><span class="token punctuation">]</span> <span class="token punctuation">]</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">)</span>
<span class="token comment"># 删除索引</span>
<span class="token keyword">DROP</span> <span class="token keyword">INDEX</span> <span class="token punctuation">[</span><span class="token keyword">schema</span><span class="token punctuation">.</span><span class="token punctuation">]</span>indexname
</code></pre> 
<p><strong>序列</strong></p> 
<blockquote> 
 <p>序列是为数据插入时提供一个自动增长的数值，它是一个数据库对象，专门用于生产数字，该数字通常为记录的id提供一个唯一的标识值</p> 
</blockquote> 
<p>创建和删除序列</p> 
<pre><code class="prism language-sql"><span class="token comment">-- 创建序列</span>
<span class="token keyword">create</span> sequence 序列名 
increment <span class="token keyword">by</span> n
<span class="token keyword">start</span> <span class="token keyword">with</span> x
<span class="token punctuation">[</span><span class="token punctuation">(</span>maxvalue<span class="token operator">/</span>minvalue y<span class="token punctuation">)</span><span class="token operator">|</span>nomaxvalue<span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token keyword">cycle</span><span class="token operator">|</span>nocycle<span class="token punctuation">]</span>
<span class="token punctuation">[</span>cache n<span class="token operator">|</span>nocache<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">--删除序列</span>
<span class="token keyword">drop</span> sequence 序列名
</code></pre> 
<h3><a id="Oracle__638"></a>六、Oracle 高级对象（存储过程、异常处理、自定义函数、包、视图）</h3> 
<p><strong>存储过程</strong><br> <code>存储过程是一个可以用编程的方式来操作SQL的集合，其实就是一个带名字的pl/sql块</code><br> 优点：<br> 1、执行效率高。因为存储过程是预编译的，即创建时编译，而SQL语句是执行一次，编译一次。<br> 2、调用存储过程可以大大减少同数据库的交互次数。<br> 3、降低网络通信量。因为存储过程执行的时候，只需要call存储过程名，不需要传递大量的SQl语句。<br> 4、有利于复用<br> 缺点：<br> 1、移植性非常差，如果在oracle上写的存储过程，移植到mysql需要修改。<br> 2、代码可读性差，实现一个简单的逻辑，代码会非常长。</p> 
<p>如何定义存储过程<br> 语法：</p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token punctuation">[</span><span class="token operator">OR</span> <span class="token keyword">REPLACE</span><span class="token punctuation">]</span> <span class="token keyword">PROCEDURE</span> 
   <span class="token operator">&lt;</span><span class="token keyword">procedure</span> name<span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>parameter list<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token operator">IS</span><span class="token operator">|</span><span class="token keyword">AS</span> 
   <span class="token operator">&lt;</span><span class="token keyword">local</span> variable declaration<span class="token operator">&gt;</span>
<span class="token keyword">BEGIN</span>
   <span class="token operator">&lt;</span>executable statements<span class="token operator">&gt;</span>
<span class="token punctuation">[</span>EXCEPTION
   <span class="token operator">&lt;</span>exception handlers<span class="token operator">&gt;</span><span class="token punctuation">]</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>
</code></pre> 
<p>示例：</p> 
<pre><code class="prism language-sql"><span class="token comment">-- 创建一个存储过程</span>
<span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token keyword">PROCEDURE</span> <span class="token keyword">simple</span><span class="token punctuation">(</span>a <span class="token keyword">INT</span> <span class="token keyword">DEFAULT</span> <span class="token number">200</span> <span class="token punctuation">,</span> b <span class="token keyword">INT</span><span class="token punctuation">)</span> <span class="token operator">IS</span>
  c <span class="token keyword">INT</span><span class="token punctuation">;</span>
<span class="token keyword">BEGIN</span>
  c :<span class="token operator">=</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
  dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>

<span class="token comment">-- 执行存储过程</span>
<span class="token keyword">set</span> serveroutput <span class="token keyword">on</span><span class="token punctuation">;</span>
<span class="token keyword">BEGIN</span>
  <span class="token keyword">simple</span><span class="token punctuation">(</span>b <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>
</code></pre> 
<p>存储过程的参数类型<br> 1.IN<br> 表示输入参数，是参数的默认模式。<br> 2.OUT <br> 表示返回值参数，类型可以使用任意Oracle中的合法类型。模式定义的参数只能在过程体内部赋值，表示该参数可以将某个值传递回调用他的过程<br> 3.IN OUT <br> 表示该参数可以向该过程中传递值，也可以将某个值传出去</p> 
<p>示例：</p> 
<pre><code class="prism language-sql"><span class="token comment"># 创建存储过程</span>
<span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token keyword">PROCEDURE</span> simp<span class="token punctuation">(</span>
       s_no <span class="token operator">in</span> <span class="token keyword">int</span><span class="token punctuation">,</span>
       s_name <span class="token keyword">out</span> <span class="token keyword">varchar</span><span class="token punctuation">,</span>
       s_part <span class="token operator">in</span> <span class="token keyword">out</span> <span class="token keyword">varchar</span>
       <span class="token punctuation">)</span> <span class="token keyword">AS</span>
<span class="token keyword">BEGIN</span>
  dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'程序内可用:'</span><span class="token operator">||</span>s_no<span class="token punctuation">)</span><span class="token punctuation">;</span>
  dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'程序内不可用:'</span><span class="token operator">||</span>s_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'程序内可用:'</span><span class="token operator">||</span>s_part<span class="token punctuation">)</span><span class="token punctuation">;</span>
  s_name :<span class="token operator">=</span> <span class="token string">'小明'</span><span class="token punctuation">;</span>
  s_part :<span class="token operator">=</span> <span class="token string">'市场部'</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span>

<span class="token comment"># 测试使用</span>
<span class="token keyword">set</span> serveroutput <span class="token keyword">on</span><span class="token punctuation">;</span>
<span class="token keyword">declare</span>
  s1 varchar2<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>:<span class="token operator">=</span><span class="token string">'初始值'</span><span class="token punctuation">;</span>
  s2 varchar2<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>:<span class="token operator">=</span><span class="token string">'初始值'</span><span class="token punctuation">;</span>
<span class="token keyword">begin</span>
  simp<span class="token punctuation">(</span>s_no <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">,</span>s_name <span class="token operator">=</span><span class="token operator">&gt;</span> s1<span class="token punctuation">,</span>s_part <span class="token operator">=</span><span class="token operator">&gt;</span> s2<span class="token punctuation">)</span><span class="token punctuation">;</span>
  dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'值被返回了:'</span><span class="token operator">||</span>s1<span class="token punctuation">)</span><span class="token punctuation">;</span>
  dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'值被返回了:'</span><span class="token operator">||</span>s2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span>
</code></pre> 
<p>测试结果：<br> <img src="https://images2.imgbox.com/ea/cc/w5PM4yHC_o.png" alt="在这里插入图片描述"></p> 
<p>删除存储过程</p> 
<pre><code class="prism language-sql"><span class="token keyword">drop</span> <span class="token keyword">procedure</span> 过程名
</code></pre> 
<p>存储过程使用注意事项！！！<br> 1.数据量大的时候（10万+），一定要做压力测试，有些存储过程在大数据量的情况下才会出现问题。<br> 2.如果插入或者更新的次数比较多，为了提高效率，可以执行一万次，再commit一次。<br> 3.如果先插入记录，没有commit，再对这条记录进行更新，会引起死锁。如果先后对同一笔记录进行更新，又没有commit，也会引起死锁。因为后一条语句会等待前一条语句提交。如果出现这种情况，则需要一条条commit。<br> 4.不要忘记在存储过程里写commit。</p> 
<p><strong>异常处理</strong><br> 在存储过程中，要处理异常。异常的类型包括预定义异常，非预定义异常和自定义异常</p> 
<table><thead><tr><th>预定义异常</th><th>说明</th></tr></thead><tbody><tr><td>access_into_null</td><td>试图给一个没有初始化的对象赋值</td></tr><tr><td>case_not_found</td><td>在Case语句中没有WHEN子句被选择，并且没有ELSE子句</td></tr><tr><td>invalid_number</td><td>试图将一个非有效的字符串转换成数字</td></tr><tr><td>loggin_denied</td><td>使用无效的用户名和口令登录oracle</td></tr><tr><td>no_data_found</td><td>查询语句无返回数据，或者引用了一个被删除的元素，或者引用了一个没有被初始化的元素</td></tr><tr><td>timeout_on_resource</td><td>oracle在等待资源时发生超时的现象</td></tr></tbody></table> 
<p>预定义异常处理案例<br> 预定义即系统已经定义好的异常，我们可以直接使用它。</p> 
<pre><code class="prism language-sql">REATE <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token keyword">PROCEDURE</span> <span class="token keyword">simple</span> <span class="token operator">IS</span>
       v <span class="token keyword">INT</span><span class="token punctuation">;</span>
<span class="token keyword">BEGIN</span>
  v :<span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">/</span> <span class="token number">0</span><span class="token punctuation">;</span>
EXCEPTION
  <span class="token keyword">WHEN</span> ZERO_DIVIDE <span class="token keyword">THEN</span>
    dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'除数不能为0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>

<span class="token keyword">BEGIN</span>
  <span class="token keyword">simple</span><span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>
</code></pre> 
<p>非预定义异常处理案例<br> 非预定义异常是Oracle没有提供的常量，由我们自定义，然后由Oracle自动引发。</p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token keyword">PROCEDURE</span> ins <span class="token operator">IS</span>
  myerror EXCEPTION<span class="token punctuation">;</span>
  PRAGMA EXCEPTION_INIT<span class="token punctuation">(</span>myerror<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">BEGIN</span>
  <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> dept <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">'aaa'</span><span class="token punctuation">,</span> <span class="token string">'aa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
EXCEPTION
  <span class="token keyword">WHEN</span> myerror <span class="token keyword">THEN</span>
    dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'主键重复'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>

<span class="token keyword">BEGIN</span>
  ins<span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>
</code></pre> 
<p><strong>自定义异常</strong><br> 自定义异常也是需要我们自己定义，与预定义异常不同的是自定义异常需要使用Raise关键字显示的引发异常。</p> 
<pre><code class="prism language-sql"><span class="token keyword">DECLARE</span>
     temp_ex exception<span class="token punctuation">;</span>
     t_num <span class="token keyword">integer</span><span class="token punctuation">;</span>
<span class="token keyword">BEGIN</span>
    <span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">into</span> t_num <span class="token keyword">from</span> temp_table <span class="token keyword">where</span>   id<span class="token operator">=</span><span class="token string">'1031'</span><span class="token punctuation">;</span>
    <span class="token keyword">IF</span> t_num<span class="token operator">&gt;=</span><span class="token number">1</span> <span class="token keyword">THEN</span>
         RAISE temp_ex<span class="token punctuation">;</span>
    <span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>
    DBMS_OUTPUT<span class="token punctuation">.</span>PUT_LINE<span class="token punctuation">(</span><span class="token string">'该用户不存在'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    EXCEPTION
        <span class="token keyword">WHEN</span> temp_ex <span class="token keyword">THEN</span>
              DBMS_OUTPUT<span class="token punctuation">.</span>PUT_LINE <span class="token punctuation">(</span><span class="token string">'该用户已存在'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>
</code></pre> 
<p><strong>自定义函数</strong><br> 函数的结构<br> （1）声明部分：包括类型、变量、游标<br> （2）执行部分：完成功能而编写的SQL语句或则是PL/SQL代码块<br> （3）异常处理部分<br> 语法：</p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token punctuation">[</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span><span class="token punctuation">]</span> <span class="token keyword">FUNCTION</span> function_name
<span class="token punctuation">[</span> <span class="token punctuation">(</span> parameter1 <span class="token punctuation">[</span> { <span class="token operator">IN</span> <span class="token operator">|</span> <span class="token keyword">OUT</span> <span class="token operator">|</span> <span class="token operator">IN</span> <span class="token keyword">OUT</span>} param1_type
parameter2 <span class="token punctuation">[</span> { <span class="token operator">IN</span> <span class="token operator">|</span> <span class="token keyword">OUT</span> <span class="token operator">|</span> <span class="token operator">IN</span> <span class="token keyword">OUT</span>} param2_type
……
parameterN <span class="token punctuation">[</span> { <span class="token operator">IN</span> <span class="token operator">|</span> <span class="token keyword">OUT</span> <span class="token operator">|</span> <span class="token operator">IN</span> <span class="token keyword">OUT</span>} paramN_type<span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token keyword">RETURN</span> returntype { <span class="token operator">IS</span> <span class="token operator">|</span> <span class="token keyword">AS</span> }
<span class="token keyword">function</span> _body<span class="token punctuation">;</span>
</code></pre> 
<p>案例</p> 
<pre><code class="prism language-sql"><span class="token keyword">create</span> <span class="token operator">or</span> <span class="token keyword">replace</span> <span class="token keyword">function</span> maxvalue0<span class="token punctuation">(</span>a number<span class="token punctuation">,</span>b number<span class="token punctuation">)</span>
<span class="token keyword">return</span> number  <span class="token comment">--设置方法返回类型</span>
<span class="token keyword">as</span>
  c number<span class="token punctuation">;</span> <span class="token comment">--声明变量，函数中不需要declare语句</span>
<span class="token keyword">begin</span> <span class="token comment">--执行程序</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>a <span class="token operator">&gt;</span> b<span class="token punctuation">)</span> <span class="token keyword">then</span>
    c:<span class="token operator">=</span>a<span class="token punctuation">;</span>
  <span class="token keyword">else</span>
    c:<span class="token operator">=</span>b<span class="token punctuation">;</span>
  <span class="token keyword">end</span> <span class="token keyword">if</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> c<span class="token punctuation">;</span> <span class="token comment">--返回值</span>
<span class="token keyword">end</span><span class="token punctuation">;</span>
</code></pre> 
<p>过程与函数的比较</p> 
<table><thead><tr><th></th><th>过程</th><th>函数</th></tr></thead><tbody><tr><td>标识符</td><td>PROCEDURE</td><td>FUNCTION</td></tr><tr><td>返回值</td><td>必须使用变量形参</td><td>用函数名直接返回</td></tr><tr><td>赋值</td><td>不能赋值并定义类型</td><td>可以定义类型，并直接赋值</td></tr><tr><td>调用方式</td><td>独立的过程调用句</td><td>以表达式调用</td></tr><tr><td>目的</td><td>完成一系列的数据处理</td><td>获得函数返回值</td></tr></tbody></table> 
<p><strong>包</strong><br> <code>包用于管理过程与函数</code></p> 
<p>包规范<br> 用于定义常量、变量、游标、过程和函数等用户与程序的接口<br> 可以在包内引用，也可以被外部程序调用</p> 
<p>包主体<br> 是包规范的实现，包括变量、游标、过程和函数等<br> 包体内的内容不能被外部应用程序调用</p> 
<p>包的定义与调用</p> 
<pre><code class="prism language-sql"><span class="token comment">-- 包的定义</span>
<span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> PACKAGE BODY mypck
<span class="token operator">IS</span>
  <span class="token keyword">FUNCTION</span> add_<span class="token punctuation">(</span>a <span class="token keyword">INT</span><span class="token punctuation">,</span> b <span class="token keyword">INT</span><span class="token punctuation">)</span> <span class="token keyword">RETURN</span> <span class="token keyword">INT</span> <span class="token operator">IS</span>
  <span class="token keyword">BEGIN</span>
    <span class="token keyword">RETURN</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
  <span class="token keyword">END</span><span class="token punctuation">;</span>
  <span class="token keyword">PROCEDURE</span> dept_count<span class="token punctuation">(</span>c <span class="token keyword">OUT</span> <span class="token keyword">INT</span><span class="token punctuation">)</span> <span class="token operator">IS</span>
  <span class="token keyword">BEGIN</span>
    <span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">INTO</span> c <span class="token keyword">FROM</span> dept<span class="token punctuation">;</span>
  <span class="token keyword">END</span><span class="token punctuation">;</span>
  <span class="token keyword">PROCEDURE</span> print_emp<span class="token punctuation">(</span>ci <span class="token keyword">OUT</span> c<span class="token punctuation">)</span> <span class="token operator">IS</span>
  <span class="token keyword">BEGIN</span>
    <span class="token keyword">OPEN</span> ci <span class="token keyword">FOR</span> <span class="token keyword">SELECT</span> ename <span class="token keyword">FROM</span> emp<span class="token punctuation">;</span> <span class="token comment">--返回游标</span>
  <span class="token keyword">END</span><span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>

<span class="token comment">-- 调用包</span>
<span class="token keyword">DECLARE</span>
  c <span class="token keyword">INT</span><span class="token punctuation">;</span>
  ci mypck<span class="token punctuation">.</span>c<span class="token punctuation">;</span>
  n emp<span class="token punctuation">.</span>ename<span class="token operator">%</span><span class="token keyword">TYPE</span><span class="token punctuation">;</span>
<span class="token keyword">BEGIN</span>
  c :<span class="token operator">=</span> mypck<span class="token punctuation">.</span>add_<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
  mypck<span class="token punctuation">.</span>dept_count<span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
  dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
  mypck<span class="token punctuation">.</span>print_emp<span class="token punctuation">(</span>ci<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">FETCH</span> ci <span class="token keyword">INTO</span> n<span class="token punctuation">;</span>
  <span class="token keyword">WHILE</span><span class="token punctuation">(</span>ci<span class="token operator">%</span>FOUND<span class="token punctuation">)</span> <span class="token keyword">LOOP</span>
    dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">FETCH</span> ci <span class="token keyword">INTO</span> n<span class="token punctuation">;</span>
  <span class="token keyword">END</span> <span class="token keyword">LOOP</span><span class="token punctuation">;</span>
  <span class="token keyword">CLOSE</span> ci<span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>
</code></pre> 
<p><strong>视图</strong><br> 视图的特点<br> （1）视图一个数据库中虚拟的表<br> （2）经过查询操作形成的结果<br> （3）具有普通表的结构<br> （4）不能实现数据的存储<br> （5）对视图的修改将会影响实际的数据表</p> 
<p>创建和销毁视图</p> 
<pre><code class="prism language-sql"><span class="token comment">-- 创建视图</span>
<span class="token keyword">create</span> <span class="token punctuation">[</span><span class="token operator">or</span> <span class="token keyword">replace</span><span class="token punctuation">]</span> <span class="token keyword">view</span> view_name <span class="token keyword">as</span>
<span class="token operator">&lt;</span><span class="token keyword">select</span> statement<span class="token operator">&gt;</span>
<span class="token comment">-- 销毁视图</span>
<span class="token keyword">drop</span> <span class="token keyword">view</span> view_name
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5fddd80ec9a1b9410e480442e18f5f9f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【知识兔】Excel教程：文本转数值的这些套路，你都会了吗？</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2103b96a1df0ceb9dfd81582c14680ac/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">kali base64 编码和解码</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>