<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>JPA（Java Persistence API，Java持久化API)从入门到精通 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="JPA（Java Persistence API，Java持久化API)从入门到精通" />
<meta property="og:description" content="#
1.JPA和Hibernate的关系 1.1 JPA的供应商 1.2 JPA的优势 1.3 JPA 包含三方面的技术 2.Holle Word 2.1 使用JPA持久化对象的步骤
创建 persistence.xml, 在这个文件中配置持久化单元
------需要指定跟哪个数据库进行交互;
------需要指定 JPA 使用哪个持久化的框架以及配置该框架的基本属性
2.2创建实体类, 使用 annotation 来描述实体类跟数据库表之间的映射关系.
使用 JPA API 完成数据增加、删除、修改和查询操作
2.3创建 EntityManagerFactory (对应 Hibernate 中的 SessionFactory);
2.4创建 EntityManager (对应 Hibernate 中的Session);
2.5 在Eclipse下创建JPA工程 2.5.1创建jpa项目
2.5.2 JPA版本选择2.0
2.5.3 3. JPA基本注解 @Entity
标注用于实体类声明语句之前，指出该Java 类为实体类，将映射到指定的数据库表。如声明一个实体类 Customer，它将映射到数据库中的 customer 表上。
@Table
当实体类与其映射的数据库表名不同名时需要使用 @Table 标注说明，该标注与 @Entity 标注并列使用，置于实体类声明语句之前，可写于单独语句行，也可与声明语句同行。
@Table 标注的常用选项是 name，用于指明数据库的表名
@Table标注还有一个两个选项 catalog 和 schema 用于设置表所属的数据库目录或模式，通常为数据库名。uniqueConstraints 选项用于设置约束条件，通常不须设置。
@Id" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/a37ca0401c082ee5b579cad28fa68b5a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-05-12T23:49:48+08:00" />
<meta property="article:modified_time" content="2019-05-12T23:49:48+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">JPA（Java Persistence API，Java持久化API)从入门到精通</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>#<img src="https://images2.imgbox.com/54/d4/9drpLLcJ_o.png" alt="："><img src="https://images2.imgbox.com/63/a0/hYqjzYvN_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/e5/12/NRukqLpr_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/c8/d4/f8nJMRsp_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="1JPAHibernate_3"></a>1.JPA和Hibernate的关系</h4> 
<p><img src="https://images2.imgbox.com/e2/84/W9cnRz3r_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="11_JPA_5"></a>1.1 JPA的供应商</h4> 
<p><img src="https://images2.imgbox.com/27/8d/XG4GSu5F_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="12__JPA_7"></a>1.2 JPA的优势</h4> 
<p><img src="https://images2.imgbox.com/5c/48/QRPVtyEj_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="13_JPA__9"></a>1.3 JPA 包含三方面的技术</h4> 
<p><img src="https://images2.imgbox.com/2f/00/i4z09nit_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="2Holle_Word_11"></a>2.Holle Word</h2> 
<p><strong>2.1</strong> 使用JPA持久化对象的步骤<br> 创建 persistence.xml, 在这个文件中配置持久化单元<br> ------需要指定跟哪个数据库进行交互;<br> ------需要指定 JPA 使用哪个持久化的框架以及配置该框架的基本属性<br> <strong>2.2</strong>创建实体类, 使用 annotation 来描述实体类跟数据库表之间的映射关系.<br> 使用 JPA API 完成数据增加、删除、修改和查询操作<br> <strong>2.3</strong>创建 EntityManagerFactory (对应 Hibernate 中的 SessionFactory);<br> <strong>2.4</strong>创建 EntityManager (对应 Hibernate 中的Session);</p> 
<h5><a id="25_EclipseJPA_22"></a>2.5 在Eclipse下创建JPA工程</h5> 
<p><strong>2.5.1</strong>创建jpa项目<br> <img src="https://images2.imgbox.com/11/4d/RHY5NV73_o.png" alt="在这里插入图片描述"><br> <strong>2.5.2</strong> JPA版本选择2.0<br> <img src="https://images2.imgbox.com/fd/f7/5BDZvKP4_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/65/4c/PLgkV2TK_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/bf/a4/HQWJceSs_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="253_aahttpsimgblogcsdnimgcn20190512222849880png_28"></a>2.5.3 <img src="https://images2.imgbox.com/17/68/2rX1e1Wr_o.png" alt="aa"></h3> 
<h2><a id="3__JPA_29"></a>3. JPA基本注解</h2> 
<p><strong>@Entity</strong><br> 标注用于实体类声明语句之前，指出该Java 类为实体类，将映射到指定的数据库表。如声明一个实体类 Customer，它将映射到数据库中的 customer 表上。</p> 
<p><strong>@Table</strong><br> 当实体类与其映射的数据库表名不同名时需要使用 @Table 标注说明，该标注与 @Entity 标注并列使用，置于实体类声明语句之前，可写于单独语句行，也可与声明语句同行。<br> @Table 标注的常用选项是 name，用于指明数据库的表名<br> @Table标注还有一个两个选项 catalog 和 schema 用于设置表所属的数据库目录或模式，通常为数据库名。uniqueConstraints 选项用于设置约束条件，通常不须设置。</p> 
<p><img src="https://images2.imgbox.com/42/0b/qyCsDLKt_o.png" alt="在这里插入图片描述"></p> 
<p><strong>@Id</strong><br> @Id 标注用于声明一个实体类的属性映射为数据库的主键列。该属性通常置于属性声明语句之前，可与声明语句同行，也可写在单独行上。<br> @Id标注也可置于属性的getter方法之前。<br> <img src="https://images2.imgbox.com/7a/89/utR79Ger_o.png" alt="在这里插入图片描述"><br> <strong>@GeneratedValue</strong><br> @GeneratedValue 用于标注主键的生成策略，通过 strategy 属性指定。默认情况下，JPA 自动选择一个最适合底层数据库的主键生成策略：SqlServer 对应 identity，MySQL 对应 auto increment。<br> 在 javax.persistence.GenerationType 中定义了以下几种可供选择的策略：<br> <img src="https://images2.imgbox.com/a9/e4/wLT5tSK2_o.png" alt="在这里插入图片描述"><br> <strong>@Basic</strong><br> 1.@Basic 表示一个简单的属性到数据库表的字段的映射,对于没有任何标注的 getXxxx() 方法,默认即为<br> 2.fetch: 表示该属性的读取策略,有 EAGER 和 LAZY 两种,分别表示主支抓取和延迟加载,默认为 EAGER.<br> 3.optional:表示该属性是否允许为null, 默认为true</p> 
<p><strong>@Column</strong><br> 当实体的属性与其映射的数据库表的列不同名时需要使用<br> @Column 标注说明，该属性通常置于实体的属性声明语句之前，还可与 @Id 标注一起使用。<br> @Column 标注的常用属性是 name，用于设置映射数据库表的列名。此外，该标注还包含其它多个属性，如：unique 、nullable、length 等。<br> @Column 标注的 columnDefinition 属性: 表示该字段在数据库中的实际类型.通常 ORM 框架可以根据属性类型自动判断数据库中字段的类型,但是对于Date类型仍无法确定数据库中字段类型究竟是DATE,TIME还是TIMESTAMP.此外,String的默认映射类型为VARCHAR, 如果要将 String 类型映射到特定数据库的 BLOB 或TEXT 字段类型.<br> @Column标注也可置于属性的getter方法之前</p> 
<p><strong>@Transient</strong><br> 1.表示该属性并非一个到数据库表的字段的映射,ORM框架将忽略该属性.<br> 2.如果一个属性并非数据库表的字段映射,就务必将其标示为@Transient<br> 否则,ORM框架默认其注解为@Basic</p> 
<p><strong>@Temporal</strong><br> 在核心的 Java API 中并没有定义 Date 类型的精度(temporal precision). 而在数据库中,表示 Date 类型的数据有 DATE, TIME, 和 TIMESTAMP 三种精度(即单纯的日期,时间,或者两者 兼备). 在进行属性映射时可使用@Temporal注解来调整精度.</p> 
<p><strong>加粗样式</strong>在这里插入图片描述<br> <img src="https://images2.imgbox.com/05/24/fpYGUoqn_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/27/2d/0a3rf7A1_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="4_JPA___API_76"></a>4. JPA API</h2> 
<p><img src="https://images2.imgbox.com/09/8c/aGiPpDps_o.png" alt=""><br> 1.Persistence 类是用于获取 EntityManagerFactory 实例。该类包含一个名为 createEntityManagerFactory 的静态方法 。<br> 2.createEntityManagerFactory 方法有如下两个重载版本。<br> 带有一个参数的方法以 JPA 配置文件 persistence.xml 中的持久化单元名为参数<br> 带有两个参数的方法：前一个参数含义相同，后一个参数 Map类型，用于设置 JPA 的相关属性，这时将忽略其它地方设置的属性。Map 对象的属性名必须是 JPA 实现库提供商的名字空间约定的属性名。</p> 
<p><img src="https://images2.imgbox.com/6b/ea/PLZ6Lc7s_o.png" alt="在这里插入图片描述"><br> 1.EntityManagerFactory 接口主要用来创建 EntityManager 实例。该接口约定了如下4个方法：<br> createEntityManager()：用于创建实体管理器对象实例。<br> createEntityManager(Map map)：用于创建实体管理器对象实例的重载方法，Map 参数用于提供 EntityManager 的属性。<br> isOpen()：检查 EntityManagerFactory 是否处于打开状态。实体管理器工厂创建后一直处于打开状态，除非调用close()方法将其关闭。<br> close()：关闭 EntityManagerFactory 。 EntityManagerFactory 关闭后将释放所有资源，isOpen()方法测试将返回 false，其它方法将不能调用，否则将导致IllegalStateException异常。</p> 
<p><img src="https://images2.imgbox.com/a8/72/THYeI054_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="1_JPA__EntityManager__Java__EntityManager_EntityManager__OR__Entity_Bean__Entity_Bean_JPQL_93"></a>1.在 JPA 规范中, EntityManager 是完成持久化操作的核心对象。实体作为普通 Java 对象，只有在调用 EntityManager 将其持久化后才会变成持久化对象。EntityManager 对象在一组实体类与底层数据源之间进行 O/R 映射的管理。它可以用来管理和更新 Entity Bean, 根椐主键查找 Entity Bean, 还可以通过JPQL语句查询实体。</h5> 
<h4><a id="2__94"></a>2 .实体的状态:</h4> 
<h5><a id="____95"></a>新建状态: 新创建的对象，尚未拥有持久性主键。</h5> 
<h5><a id="_96"></a>持久化状态：已经拥有持久性主键并和持久化建立了上下文环境</h5> 
<h5><a id="_97"></a>游离状态：拥有持久化主键，但是没有与持久化建立上下文环境</h5> 
<h5><a id="___98"></a>删除状态: 拥有持久化主键，已经和持久化建立上下文环境，但是从数据库中删除。</h5> 
<h5><a id="3find_ClassT_entityClassObject_primaryKey_OID__Entity__OID__null_100"></a>3.find (Class entityClass,Object primaryKey)：返回指定的 OID 对应的实体类对象，如果这个实体存在于当前的持久化环境，则返回一个被缓存的对象；否则会创建一个新的 Entity, 并加载数据库中相关信息；若 OID 不存在于数据库中，则返回一个 null。第一个参数为被查询的实体类类型，第二个参数为待查找实体的主键值。</h5> 
<h5><a id="4getReference_ClassT_entityClassObject_primaryKeyfind_Entity_EntityManager__Entity__Entity__OID_getReference__null__EntityNotFoundException_101"></a>4.getReference (Class entityClass,Object primaryKey)：与find()方法类似，不同的是：如果缓存中不存在指定的 Entity, EntityManager 会创建一个 Entity 类的代理，但是不会立即加载数据库中的信息，只有第一次真正使用此 Entity 的属性才加载，所以如果此 OID 在数据库不存在，getReference() 不会返回 null 值, 而是抛出EntityNotFoundException</h5> 
<h5><a id="5_persist_Object_entity_Entity__EntityManager__persist__Entity__103"></a>5. persist (Object entity)：用于将新创建的 Entity 纳入到 EntityManager 的管理。该方法执行后，传入 persist() 方法的 Entity 对象转换成持久化状态。</h5> 
<h5><a id="_persist__Entity__persist__104"></a>如果传入 persist() 方法的 Entity 对象已经处于持久化状态，则 persist() 方法什么都不做。</h5> 
<h5><a id="_Entity__persist__105"></a>如果对删除状态的 Entity 进行 persist() 操作，会转换为持久化状态。</h5> 
<h5><a id="_persist__persist__EntityExistExceptionflush_106"></a>如果对游离状态的实体执行 persist() 操作，可能会在 persist() 方法抛出 EntityExistException(也有可能是在flush或事务提交后抛出)。</h5> 
<h5><a id="6remove_Object_entity_107"></a>6.remove (Object entity)：删除实例。如果实例是被管理的，即与数据库实体记录关联，则同时会删除关联的数据库记录。</h5> 
<h6><a id="7merge_T_entitymerge__Entity__108"></a>7.merge (T entity)：merge() 用于处理 Entity 的同步。即数据库的插入和更新操作</h6> 
<p><img src="https://images2.imgbox.com/92/16/IpYZ2kAr_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="7flush__112"></a>7.flush ()：同步持久上下文环境，即将持久上下文环境的所有未保存实体的状态信息保存到数据库中。</h5> 
<h5><a id="8setFlushMode_FlushModeType_flushModeFlush2_113"></a>8.setFlushMode (FlushModeType flushMode)：设置持久上下文环境的Flush模式。参数可以取2个枚举</h5> 
<h5><a id="FlushModeTypeAUTO__114"></a>—FlushModeType.AUTO 为自动更新数据库实体，</h5> 
<h5><a id="FlushModeTypeCOMMIT__115"></a>—FlushModeType.COMMIT 为直到提交事务时才更新数据库记录。</h5> 
<h5><a id="9getFlushMode_FlushFlushModeType_116"></a>9.getFlushMode ()：获取持久上下文环境的Flush模式。返回FlushModeType类的枚举值。</h5> 
<h5><a id="10refresh_Object_entity_118"></a>10.refresh (Object entity)：用数据库实体记录的值更新实体对象的状态，即更新实例的属性值。</h5> 
<h5><a id="11clear__119"></a>11.clear ()：清除持久上下文环境，断开所有关联的实体。如果这时还有未提交的更新则会被撤消。</h5> 
<h5><a id="12contains_Object_entity_120"></a>12.contains (Object entity)：判断一个实例是否属于当前持久上下文环境管理的实体。</h5> 
<h5><a id="13isOpen__121"></a>13.isOpen ()：判断当前的实体管理器是否是打开状态。</h5> 
<h5><a id="14getTransaction_EntityTransaction_122"></a>14.getTransaction ()：返回资源层的事务对象。EntityTransaction实例可以用于开始和提交多个事务。</h5> 
<h5><a id="15close__IllegalstateException_getTransaction__isOpen_false_close__123"></a>15.close ()：关闭实体管理器。之后若调用实体管理器实例的方法或其派生的查询对象的方法都将抛出 IllegalstateException 异常，除了getTransaction 和 isOpen方法(返回 false)。不过，当与实体管理器关联的事务处于活动状态时，调用 close 方法后持久上下文将仍处于被管理状态，直到事务完成。</h5> 
<h5><a id="16createQuery_String_qlString_124"></a>16.createQuery (String qlString)：创建一个查询对象。</h5> 
<h5><a id="17createNamedQuery_String_name_125"></a>17.createNamedQuery (String name)：根据命名的查询语句块创建查询对象。参数为命名的查询语句。</h5> 
<h5><a id="18createNativeQuery_String_sqlString_SQLSQL_126"></a>18.createNativeQuery (String sqlString)：使用标准 SQL语句创建查询对象。参数为标准SQL语句字符串。</h5> 
<h5><a id="19createNativeQuery_String_sqls_String_resultSetMappingSQL_Map__127"></a>19.createNativeQuery (String sqls, String resultSetMapping)：使用标准SQL语句创建查询对象，并指定返回结果集 Map的 名称。</h5> 
<h5><a id="20EntityTransaction_getTransaction__128"></a>20.EntityTransaction 接口用来管理资源层实体管理器的事务操作。通过调用实体管理器的getTransaction方法 获得其实例。</h5> 
<p><img src="https://images2.imgbox.com/c7/69/F0JYaXzF_o.png" alt="在这里插入图片描述"><br> <strong>1.begin ()</strong><br> -------用于启动一个事务，此后的多个数据库操作将作为整体被提交或撤消。若这时事务已启动则会抛出 ------------IllegalStateException 异常。<br> <strong>2.commit ()</strong><br> -------用于提交当前事务。即将事务启动以后的所有数据库更新操作持久化至数据库中。<br> <strong>3.rollback ()</strong><br> -------撤消(回滚)当前事务。即撤消事务启动后的所有数据库更新操作，从而不对数据库产生影响。<br> <strong>4.setRollbackOnly ()</strong><br> -------使当前事务只能被撤消。<br> <strong>5.getRollbackOnly ()</strong><br> -------查看当前事务是否设置了只能撤消标志。</p> 
<h6><a id="6isActive__143"></a><strong>6.isActive ()</strong></h6> 
<p>查看当前事务是否是活动的。如果返回true则不能调用begin方法，否则将抛出 IllegalStateException 异常；如果返回 false 则不能调用 commit、rollback、setRollbackOnly 及 getRollbackOnly 方法，否则将抛出 IllegalStateException 异常。</p> 
<h2><a id="5__147"></a>5. 映射关联关系</h2> 
<p><img src="https://images2.imgbox.com/04/df/2GIvR4EJ_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="51_150"></a>5.1.双向一对多及多对一映射</h4> 
<p><img src="https://images2.imgbox.com/5c/c0/ta3bATIO_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="52_153"></a>5.2双向一对一映射</h4> 
<p><img src="https://images2.imgbox.com/18/bb/bto4acKv_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="53__11__155"></a>5.3 双向 1-1 不延迟加载的问题</h4> 
<p><img src="https://images2.imgbox.com/32/5f/LntpFDua_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="54__157"></a>5.4 双向多对多关联关系</h4> 
<p><img src="https://images2.imgbox.com/d9/9b/tVdQKOuB_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="6_159"></a>6.使用二级缓存</h2> 
<p><strong>6.1.创建 ehcache.xml文件</strong></p> 
<pre><code class="prism language-javascript"><span class="token operator">&lt;</span>ehcache<span class="token operator">&gt;</span>

 	<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>磁盘存储<span class="token punctuation">:</span>将缓存中暂时不使用的对象<span class="token punctuation">,</span>转移到硬盘<span class="token punctuation">,</span>类似于Windows系统的虚拟内存<span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>path<span class="token punctuation">:</span>指定在硬盘上存储对象的路径<span class="token operator">--</span><span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>tmpdir 是默认的临时文件路径。 可以通过如下方式打印出具体的文件路径System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"java.io.tmpdir"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">--</span><span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 指定二级缓存存放在磁盘上的位置，可以使用磁盘目录，也可以使用Java System Property目录，<span class="token operator">--</span><span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>user<span class="token punctuation">.</span>home是用户目录、user<span class="token punctuation">.</span>dir是用户当前工作目录、java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>tmpdir是默认临时文件路径<span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>diskStore path<span class="token operator">=</span><span class="token string">"java.io.tmpdir"</span><span class="token operator">/</span><span class="token operator">&gt;</span>


    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>defaultCache：默认的管理策略<span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>eternal：设定缓存的elements是否永远不过期。如果为<span class="token boolean">true</span>，则缓存的数据始终有效，如果为<span class="token boolean">false</span>那么还要
    根据timeToIdleSeconds，timeToLiveSeconds判断<span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>maxElementsInMemory：在内存中缓存的element的最大数目<span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>overflowToDisk：如果内存中数据超过内存限制，是否要缓存到磁盘上<span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>diskPersistent：是否在磁盘上持久化。指重启jvm后，数据是否有效。默认为<span class="token boolean">false</span><span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span><span class="token function">timeToIdleSeconds：对象空闲时间</span><span class="token punctuation">(</span>单位：秒<span class="token punctuation">)</span>，指对象在多长时间没有被访问就会失效。只对eternal为
    <span class="token boolean">false</span>的有效。默认值<span class="token number">0</span>，表示一直可以访问<span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span><span class="token function">timeToLiveSeconds：对象存活时间</span><span class="token punctuation">(</span>单位：秒<span class="token punctuation">)</span>，指对象从创建到失效所需要的时间。只对eternal为<span class="token boolean">false</span>的
    有效。默认值<span class="token number">0</span>，表示一直可以访问<span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>memoryStoreEvictionPolicy：缓存的<span class="token number">3</span> 种清空策略<span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span><span class="token constant">FIFO</span>：first <span class="token keyword">in</span> first <span class="token function">out</span> <span class="token punctuation">(</span>先进先出<span class="token punctuation">)</span><span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span><span class="token constant">LFU</span>：Less Frequently <span class="token function">Used</span> <span class="token punctuation">(</span>最少使用<span class="token punctuation">)</span><span class="token punctuation">.</span>意思是一直以来最少被使用的。缓存的元素有一个hit 属性，hit 
    值最小的将会被清出缓存<span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span><span class="token constant">LRU</span>：Least Recently <span class="token function">Used</span><span class="token punctuation">(</span>最近最少使用<span class="token punctuation">)</span><span class="token punctuation">.</span> <span class="token punctuation">(</span>ehcache 默认值<span class="token punctuation">)</span><span class="token punctuation">.</span>缓存的元素有一个时间戳，当缓存容量满
    了，而又需要腾出地方来缓存新的元素的时候，那么现有缓存元素中时间戳离当前时间最远的元素将被清出缓存<span class="token operator">--</span><span class="token operator">&gt;</span>


    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> Sets the path to the directory where cache <span class="token punctuation">.</span>data files are created<span class="token punctuation">.</span>

         If the path is a Java System Property it is replaced by
         its value <span class="token keyword">in</span> the running <span class="token constant">VM</span><span class="token punctuation">.</span>

         The following properties are translated<span class="token punctuation">:</span>
         user<span class="token punctuation">.</span>home <span class="token operator">-</span> User's home directory
         user<span class="token punctuation">.</span>dir <span class="token operator">-</span> User's current working directory
         java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>tmpdir <span class="token operator">-</span> Default temp file path <span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>diskStore path<span class="token operator">=</span><span class="token string">"java.io.tmpdir"</span><span class="token operator">/</span><span class="token operator">&gt;</span>


    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>Default Cache configuration<span class="token punctuation">.</span> These will applied to caches programmatically created through
        the CacheManager<span class="token punctuation">.</span>

        The following attributes are required <span class="token keyword">for</span> defaultCache<span class="token punctuation">:</span>

        maxInMemory       <span class="token operator">-</span> Sets the maximum number <span class="token keyword">of</span> objects that will be created <span class="token keyword">in</span> memory
        eternal           <span class="token operator">-</span> Sets whether elements are eternal<span class="token punctuation">.</span> If eternal<span class="token punctuation">,</span>  timeouts are ignored and the element
                            is never expired<span class="token punctuation">.</span>
        timeToIdleSeconds <span class="token operator">-</span> Sets the time to idle <span class="token keyword">for</span> an element before it expires<span class="token punctuation">.</span> Is only used
                            <span class="token keyword">if</span> the element is not eternal<span class="token punctuation">.</span> Idle time is now <span class="token operator">-</span> last accessed time
        timeToLiveSeconds <span class="token operator">-</span> Sets the time to live <span class="token keyword">for</span> an element before it expires<span class="token punctuation">.</span> Is only used
                            <span class="token keyword">if</span> the element is not eternal<span class="token punctuation">.</span> <span class="token constant">TTL</span> is now <span class="token operator">-</span> creation time
        overflowToDisk    <span class="token operator">-</span> Sets whether elements can overflow to disk when the <span class="token keyword">in</span><span class="token operator">-</span>memory cache
                            has reached the maxInMemory limit<span class="token punctuation">.</span>

        <span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>defaultCache
        maxElementsInMemory<span class="token operator">=</span><span class="token string">"10000"</span>
        eternal<span class="token operator">=</span><span class="token string">"false"</span>
        timeToIdleSeconds<span class="token operator">=</span><span class="token string">"120"</span>
        timeToLiveSeconds<span class="token operator">=</span><span class="token string">"120"</span>
        overflowToDisk<span class="token operator">=</span><span class="token string">"true"</span>
        <span class="token operator">/</span><span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>Predefined caches<span class="token punctuation">.</span>  Add your cache configuration settings here<span class="token punctuation">.</span>
        If you <span class="token keyword">do</span> not have a configuration <span class="token keyword">for</span> your cache a <span class="token constant">WARNING</span> will be issued when the
        CacheManager starts

        The following attributes are required <span class="token keyword">for</span> defaultCache<span class="token punctuation">:</span>

        name              <span class="token operator">-</span> Sets the name <span class="token keyword">of</span> the cache<span class="token punctuation">.</span> This is used to identify the cache<span class="token punctuation">.</span> It must be unique<span class="token punctuation">.</span>
        maxInMemory       <span class="token operator">-</span> Sets the maximum number <span class="token keyword">of</span> objects that will be created <span class="token keyword">in</span> memory
        eternal           <span class="token operator">-</span> Sets whether elements are eternal<span class="token punctuation">.</span> If eternal<span class="token punctuation">,</span>  timeouts are ignored and the element
                            is never expired<span class="token punctuation">.</span>
        timeToIdleSeconds <span class="token operator">-</span> Sets the time to idle <span class="token keyword">for</span> an element before it expires<span class="token punctuation">.</span> Is only used
                            <span class="token keyword">if</span> the element is not eternal<span class="token punctuation">.</span> Idle time is now <span class="token operator">-</span> last accessed time
        timeToLiveSeconds <span class="token operator">-</span> Sets the time to live <span class="token keyword">for</span> an element before it expires<span class="token punctuation">.</span> Is only used
                            <span class="token keyword">if</span> the element is not eternal<span class="token punctuation">.</span> <span class="token constant">TTL</span> is now <span class="token operator">-</span> creation time
        overflowToDisk    <span class="token operator">-</span> Sets whether elements can overflow to disk when the <span class="token keyword">in</span><span class="token operator">-</span>memory cache
                            has reached the maxInMemory limit<span class="token punctuation">.</span>

        <span class="token operator">--</span><span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> Sample cache named sampleCache1
        This cache contains a maximum <span class="token keyword">in</span> memory <span class="token keyword">of</span> <span class="token number">10000</span> elements<span class="token punctuation">,</span> and will expire
        an element <span class="token keyword">if</span> it is idle <span class="token keyword">for</span> more than <span class="token number">5</span> minutes and lives <span class="token keyword">for</span> more than
        <span class="token number">10</span> minutes<span class="token punctuation">.</span>

        If there are more than <span class="token number">10000</span> elements it will overflow to the
        disk cache<span class="token punctuation">,</span> which <span class="token keyword">in</span> <span class="token keyword">this</span> configuration will go to wherever java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>tmp is
        defined on your system<span class="token punctuation">.</span> On a standard Linux system <span class="token keyword">this</span> will be <span class="token operator">/</span>tmp"
        <span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>cache name<span class="token operator">=</span><span class="token string">"sampleCache1"</span>
        maxElementsInMemory<span class="token operator">=</span><span class="token string">"10000"</span>
        eternal<span class="token operator">=</span><span class="token string">"false"</span>
        timeToIdleSeconds<span class="token operator">=</span><span class="token string">"300"</span>
        timeToLiveSeconds<span class="token operator">=</span><span class="token string">"600"</span>
        overflowToDisk<span class="token operator">=</span><span class="token string">"true"</span>
        <span class="token operator">/</span><span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> Sample cache named sampleCache2
        This cache contains <span class="token number">1000</span> elements<span class="token punctuation">.</span> Elements will always be held <span class="token keyword">in</span> memory<span class="token punctuation">.</span>
        They are not expired<span class="token punctuation">.</span> <span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>cache name<span class="token operator">=</span><span class="token string">"sampleCache2"</span>
        maxElementsInMemory<span class="token operator">=</span><span class="token string">"1000"</span>
        eternal<span class="token operator">=</span><span class="token string">"true"</span>
        timeToIdleSeconds<span class="token operator">=</span><span class="token string">"0"</span>
        timeToLiveSeconds<span class="token operator">=</span><span class="token string">"0"</span>
        overflowToDisk<span class="token operator">=</span><span class="token string">"false"</span>
        <span class="token operator">/</span><span class="token operator">&gt;</span> <span class="token operator">--</span><span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> Place configuration <span class="token keyword">for</span> your caches following <span class="token operator">--</span><span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>ehcache<span class="token operator">&gt;</span>


</code></pre> 
<h5><a id="62_persistencexml_279"></a>6.2 在persistence.xml文件中添加一下节点</h5> 
<pre><code class="prism language-javascript"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 配置二级缓存的策略 <span class="token operator">--</span><span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 
		配置二级缓存的策略 
		<span class="token constant">ALL</span>：所有的实体类都被缓存
		<span class="token constant">NONE</span>：所有的实体类都不被缓存<span class="token punctuation">.</span> 
		<span class="token constant">ENABLE_SELECTIVE</span>：标识 @<span class="token function">Cacheable</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> 注解的实体类将被缓存
		<span class="token constant">DISABLE_SELECTIVE</span>：缓存除标识 @<span class="token function">Cacheable</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span> 以外的所有实体类
		<span class="token constant">UNSPECIFIED</span>：默认值，<span class="token constant">JPA</span> 产品默认值将被使用
		<span class="token operator">--</span><span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>shared<span class="token operator">-</span>cache<span class="token operator">-</span>mode<span class="token operator">&gt;</span><span class="token constant">ENABLE_SELECTIVE</span><span class="token operator">&lt;</span><span class="token operator">/</span>shared<span class="token operator">-</span>cache<span class="token operator">-</span>mode<span class="token operator">&gt;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/69/49/SKubR0ec_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="persistencexml_294"></a>小编的persistence.xml配置文件</h4> 
<pre><code class="prism language-javascript"><span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">"1.0"</span> encoding<span class="token operator">=</span><span class="token string">"UTF-8"</span><span class="token operator">?</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>persistence version<span class="token operator">=</span><span class="token string">"2.0"</span> xmlns<span class="token operator">=</span><span class="token string">"http://java.sun.com/xml/ns/persistence"</span> xmlns<span class="token punctuation">:</span>xsi<span class="token operator">=</span><span class="token string">"http://www.w3.org/2001/XMLSchema-instance"</span> xsi<span class="token punctuation">:</span>schemaLocation<span class="token operator">=</span><span class="token string">"http://java.sun.com/xml/ns/persistence http://java.sun.com/xml/ns/persistence/persistence_2_0.xsd"</span><span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>persistence<span class="token operator">-</span>unit name<span class="token operator">=</span><span class="token string">"jpa-3"</span> transaction<span class="token operator">-</span>type<span class="token operator">=</span><span class="token string">"RESOURCE_LOCAL"</span><span class="token operator">&gt;</span>
	
		<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 
		配置使用什么 <span class="token constant">ORM</span> 产品来作为 <span class="token constant">JPA</span> 的实现 
		<span class="token number">1.</span> 实际上配置的是  javax<span class="token punctuation">.</span>persistence<span class="token punctuation">.</span>spi<span class="token punctuation">.</span>PersistenceProvider 接口的实现类
		<span class="token number">2.</span> 若 <span class="token constant">JPA</span> 项目中只有一个 <span class="token constant">JPA</span> 的实现产品<span class="token punctuation">,</span> 则也可以不配置该节点<span class="token punctuation">.</span> 
		<span class="token operator">--</span><span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>provider<span class="token operator">&gt;</span>org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>ejb<span class="token punctuation">.</span>HibernatePersistence<span class="token operator">&lt;</span><span class="token operator">/</span>provider<span class="token operator">&gt;</span>
		
		
		<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 配置持久化类 <span class="token operator">--</span><span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span><span class="token keyword">class</span><span class="token operator">&gt;</span>com<span class="token punctuation">.</span>zking<span class="token punctuation">.</span>model<span class="token punctuation">.</span>User<span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">class</span><span class="token operator">&gt;</span> 
		
		<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 配置二级缓存的策略 <span class="token operator">--</span><span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 
		配置二级缓存的策略 
		<span class="token constant">ALL</span>：所有的实体类都被缓存
		<span class="token constant">NONE</span>：所有的实体类都不被缓存<span class="token punctuation">.</span> 
		<span class="token constant">ENABLE_SELECTIVE</span>：标识 @<span class="token function">Cacheable</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> 注解的实体类将被缓存
		<span class="token constant">DISABLE_SELECTIVE</span>：缓存除标识 @<span class="token function">Cacheable</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span> 以外的所有实体类
		<span class="token constant">UNSPECIFIED</span>：默认值，<span class="token constant">JPA</span> 产品默认值将被使用
		<span class="token operator">--</span><span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>shared<span class="token operator">-</span>cache<span class="token operator">-</span>mode<span class="token operator">&gt;</span><span class="token constant">ENABLE_SELECTIVE</span><span class="token operator">&lt;</span><span class="token operator">/</span>shared<span class="token operator">-</span>cache<span class="token operator">-</span>mode<span class="token operator">&gt;</span>
	
		<span class="token operator">&lt;</span>properties<span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 配置数据源 <span class="token operator">--</span><span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"javax.persistence.jdbc.driver"</span> value<span class="token operator">=</span><span class="token string">"com.mysql.jdbc.Driver"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"javax.persistence.jdbc.url"</span> value<span class="token operator">=</span><span class="token string">"jdbc:mysql://localhost:3306/jpa"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"javax.persistence.jdbc.user"</span> value<span class="token operator">=</span><span class="token string">"root"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"javax.persistence.jdbc.password"</span> value<span class="token operator">=</span><span class="token string">"123"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
			
			<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 配置数据库方言 <span class="token operator">--</span><span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"hibernate.dialect"</span> value<span class="token operator">=</span><span class="token string">"org.hibernate.dialect.MySQLDialect"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
			
			<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 配置基本信息 <span class="token operator">--</span><span class="token operator">&gt;</span>   
			<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 配置mysql方言 <span class="token operator">--</span><span class="token operator">&gt;</span> 
			<span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"hibernate.dealect"</span> value<span class="token operator">=</span><span class="token string">"org.hibernate.dialect.MySQLDialect"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 配置自动创建数据库表 <span class="token operator">--</span><span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"hibernate.hbm2ddl.auto"</span> value<span class="token operator">=</span><span class="token string">"update"</span> <span class="token operator">/</span><span class="token operator">&gt;</span> 
			<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 显示sql打印 <span class="token operator">--</span><span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"hibernate.show_sql"</span> value<span class="token operator">=</span><span class="token string">"true"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 设置初始化sql语句格式 <span class="token operator">--</span><span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"hibernate.format_sql"</span> value<span class="token operator">=</span><span class="token string">"true"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
			
			<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 启用二级缓存 <span class="token operator">--</span><span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"hibernate.cache.use_second_level_cache"</span> value<span class="token operator">=</span><span class="token string">"true"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"hibernate.cache.region.factory_class"</span> value<span class="token operator">=</span><span class="token string">"org.hibernate.cache.ehcache.EhCacheRegionFactory"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"hibernate.cache.use_query_cache"</span> value<span class="token operator">=</span><span class="token string">"true"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
			
		<span class="token operator">&lt;</span><span class="token operator">/</span>properties<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span><span class="token operator">/</span>persistence<span class="token operator">-</span>unit<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>persistence<span class="token operator">&gt;</span>

</code></pre> 
<h2><a id="7_JPQL_352"></a>7. JPQL语言</h2> 
<p>1.JPQL语言，即 Java Persistence Query Language 的简称。JPQL 是一种和 SQL 非常类似的中间性和对象化查询语言，它最终会被编译成针对不同底层数据库的 SQL 查询，从而屏蔽不同数据库的差异。<br> 2.JPQL语言的语句可以是 select 语句、update 语句或delete语句，它们都通过 Query 接口封装执行</p> 
<h2><a id="javaxpersistenceQuery_357"></a>javax.persistence.Query接口</h2> 
<p>Query接口封装了执行数据库查询的相关方法。调用 EntityManager 的 createQuery、create NamedQuery 及 createNativeQuery 方法可以获得查询对象，进而可调用 Query 接口的相关方法来执行查询操作。<br> <img src="https://images2.imgbox.com/91/3d/UNlR1zkp_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/06/f9/E4HYoKlF_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/6e/d9/uPrhubl5_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="select_362"></a>select语句</h4> 
<p>select语句用于执行查询。其语法可表示为：<br> select_clause<br> form_clause<br> [where_clause]<br> [groupby_clause]<br> [having_clause]<br> [orderby_clause]</p> 
<h4><a id="selectfrom__371"></a>select-from 子句</h4> 
<p>1.from 子句是查询语句的必选子句。<br> ------Select 用来指定查询返回的结果实体或实体的某些属性<br> 2.From 子句声明查询源实体类，并指定标识符变量（相当于SQL表的别名）。<br> 如果不希望返回重复实体，可使用关键字 distinct 修饰。select、from 都是 JPQL 的关键字，通常全大写或全小写，建议不要大小写混用。</p> 
<p><img src="https://images2.imgbox.com/a1/45/KQvRGFhh_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/4b/74/yUkTBOwS_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/cf/1d/FG8ZMkIh_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/4b/b0/1hlEd9pO_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/2f/7a/hGWApbKA_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/bd/f9/r2lEpY1L_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="71_Hibernate__384"></a>7.1使用 Hibernate 的查询缓存</h2> 
<p><img src="https://images2.imgbox.com/a4/17/JNYb2t0Z_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="72_order_by_386"></a>7.2 order by子句</h2> 
<p>order by子句用于对查询结果集进行排序。和SQL的用法类似，可以用 “asc“ 和 "desc“ 指定升降序。如果不显式注明，默认为升序。</p> 
<pre><code class="prism language-script">select o from Orders o order by o.id
select o from Orders o order by o.address.streetNumber desc
select o from Orders o order by o.customer asc, o.id desc
</code></pre> 
<h2><a id="73_group_by_394"></a>7.3 group by子句与聚合查询</h2> 
<p>group by 子句用于对查询结果分组统计，通常需要使用聚合函数。常用的聚合函数主要有 AVG、SUM、COUNT、MAX、MIN 等，它们的含义与SQL相同。例如：select max(<a href="http://o.id" rel="nofollow">o.id</a>) from Orders o</p> 
<pre><code class="prism language-script">//没有 group by 子句的查询是基于整个实体类的，使用聚合函数将返回单个结果值，可以使用Query.getSingleResult()得到查询结果。例如：
Query query = entityManager.createQuery(
					"select max(o.id) from Orders o");
Object result = query.getSingleResult();
Long max = (Long)result;
</code></pre> 
<h2><a id="74_having	_404"></a>7.4 having 子句</h2> 
<p>Having 子句用于对 group by 分组设置约束条件，用法与where 子句基本相同，不同是 where 子句作用于基表或视图，以便从中选择满足条件的记录；having 子句则作用于分组，用于选择满足条件的组，其条件表达式中通常会使用聚合函数。<br> 例如，以下语句用于查询订购总数大于100的商家所售商品及数量：</p> 
<pre><code>select o.seller, o.goodId, sum(o.amount) from V_Orders o group by 
o.seller, o.goodId having sum(o.amount) &gt; 100
</code></pre> 
<p>having子句与where子句一样都可以使用参数。</p> 
<h2><a id="8_413"></a>8.关联查询</h2> 
<p><strong>1.在JPQL中，很多时候都是通过在实体类中配置实体关联的类属性来实现隐含的关联(join)查询。例如：<br> select o from Orders o where o.address.streetNumber=2000<br> 2.上述JPQL语句编译成以下SQL时就会自动包含关联，默认为左关联。<br> 3.在某些情况下可能仍然需要对关联做精确的控制。为此，JPQL 也支持和 SQL 中类似的关联语法。如：<br> ------left out join / left join<br> ------inner join<br> ------left join / inner join fetch<br> ------其中，left join和left out join等义，都是允许符合条件的右边表达式中的实体为空。<br> 4.例如，以下外关联查询可以找出所有客户实体记录，即使它未曾订货：<br> select c from Customers c left join c.orders o<br> 5.以下内关联查询只找出所有曾订过商品的客户实体记录：<br> select c from Customers c inner join c.orders o<br> 6.如果001号客户下过5次订单的话，以下fetch关联查询将得到 5个客户实体的引用，并且执行了 5 个订单的查询：<br> select c from Customers c left join fetch c.orders o where c.id=001</strong></p> 
<h2><a id="9_428"></a>9.子查询</h2> 
<p><strong>JPQL也支持子查询，在 where 或 having 子句中可以包含另一个查询。当子查询返回多于 1 个结果集时，它常出现在 any、all、exist s表达式中用于集合匹配查询。它们的用法与SQL语句基本相同。</strong><br> <img src="https://images2.imgbox.com/84/e7/YJ0UqZGq_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="10_JPQLhttpsimgblogcsdnimgcn20190512233122565pngxossprocessimagewatermarktype_ZmFuZ3poZW5naGVpdGkshadow_10text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQyNTMxODc0size_16color_FFFFFFt_70_431"></a>10. JPQL函数<img src="https://images2.imgbox.com/f9/f1/LBbB0TWU_o.png" alt="在这里插入图片描述"></h2> 
<p><img src="https://images2.imgbox.com/06/0d/ksaTXCB1_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="11UPDATE__434"></a>11.UPDATE 语句</h2> 
<p><strong>1.update语句用于执行数据更新操作。主要用于针对单个实体类的批量更新<br> 以下语句将帐户余额不足万元的客户状态设置为未偿付：</strong></p> 
<pre><code class="prism language-script">update Customers c set c.status = '未偿付' where c.balance &lt; 
10000
</code></pre> 
<h2><a id="12DELETE__442"></a>12DELETE 语句</h2> 
<p>delete语句用于执行数据更新操作。<br> 以下语句删除不活跃的、没有订单的客户：</p> 
<pre><code class="prism language-script">delete from Customers c where c.status = 
'inactive' and c.orders is empty
</code></pre> 
<h4><a id="_451"></a><em><strong>本片文章分享到这，如有不足请在下方评论。</strong></em></h4>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/8a14be38ce5be5bf09966366030e5466/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">第一阶段SCRUM冲刺-07</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/36a115d80dac95c4a9d2018ed5dcf7af/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">npm设置淘宝源</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>