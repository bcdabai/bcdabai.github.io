<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>蚁群算法原理及c&#43;&#43;实现 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="蚁群算法原理及c&#43;&#43;实现" />
<meta property="og:description" content="参考博客
https://blog.csdn.net/Oudasheng/article/details/84994336
https://blog.csdn.net/wayjj/article/details/72809344#commentsedit
https://blog.csdn.net/Oudasheng/article/details/84994336
https://www.cnblogs.com/mahaitao/p/5572095.html
https://www.cnblogs.com/Horizon-asd/p/12723886.html
https://blog.csdn.net/chen10217/article/details/100762552
一、原理 1. 蚂蚁觅食行为 蚁群在寻找食物时，总能找到一条蚁穴到食物的最短路径，并且能随着环境的变化而更新最优路径。究其原因，是因为蚂蚁在运动过程中，会在所经过路径上留下一种称为信息素（pheromone）的物质，其他蚂蚁在运动中可以感知到这种物质，并以此来指导自己的运动方向。
蚁群的这种行为表现出一种信息正反馈现象：某一路径上走过的蚂蚁越多，则后来者选择该路径的概率越大。
2.蚁群算法 又称蚂蚁算法，是一种基于群体智能的算法，用来在图中寻找优化路径的概率型。它由Marco Dorigo于1992年在他的博士论文中提出，其灵感来源于蚂蚁在寻找食物过程中发现路径的行为。在解决实际问题时，人工蚁群相较于自然蚁群有一定的记忆能力，可记住已访问过的节点，其次人工蚁群在选择路径时依照一定规律，并不是盲目的。蚁群算法常用来解决路径规划等离散优化问题，如旅行商问题（TSP）、指派问题、调度问题。
2,1 特点 正反馈：可较快发现较优解。分布式：基于种群的进化算法，本质具有并行性，易于并行实现。启发式搜索：反映搜索中的的先验性和确定性因素（如距离）强度。鲁棒性强：不易受某个个体影响。 2.2 算法流程（以TSP问题为例） TSP问题：一商人去n个城市销货，所有城市走一遍再回到起点，使所走路程最短。
初始化相关参数：蚁群规模、信息素因子、启发函数因子、信息素挥发因子、信息素常数和最大迭代次数等。将城市信息读入程序并进行预处理，即将城市间信息转化为矩阵。随机将蚂蚁放入不同出发点，计算每个蚂蚁的下一步要访问的城市，直到有蚂蚁访问完所有城市。计算每个蚂蚁经过的路径长度Lk，记录当前迭代次数下的最优解（访问完所有城市且路径长度最短），更新各条路径上的信息素浓度。断是否达到最大迭代次数，若否则返回步骤2，若是则顺序执行。输出最优路径和相关指标，如运行时间和迭代次数。 2.3 相关公式 2.4 流程图 三、例子 试设计一个并行算法，求下图中一个源点到其他定点的最短路径。（VS2019&#43;Eigen）
3.1 关键代码 数据结构： 将蚂蚁设置为一个结构体，包含所在位置、禁忌表、所走路径和是否到达终点标志四项内容。为了便于计算，将信息素、启发信息与距离信息分别在8*8的矩阵中存放，这样可以调用Eigen库直接进行矩阵计算，达到更新信息素的目的。
城市也设为一个结构体，包含城市编号和选择概率两项内容。这里将城市设置为结构体，主要是考虑到在选择下一步行进城市时，要先计算选择概率再通过轮盘赌来确定下一步城市，轮盘赌时需要将城市编号与其选择概率一一对应。
具体代码部分如下：
struct ant //蚂蚁结构体 { int loc; //位置 int tabu[cityNum]; //禁忌表 int antPath[pathNum]; //走过的路 bool flag; //是否到达终点7 }; struct ant ants[antNum]; //蚁群 typedef Matrix&lt;double, 8, 8&gt; Matrix8d; Matrix8d dist; //距离矩阵 Matrix8d pher; //信息素矩阵 Matrix8d nextPher; //下一代信息素矩阵 Matrix8d insp; //启发信息矩阵 struct city //城市结构体 { int num; //编号 double prob; //选择概率 }; struct city cityProb[cityNum]; //可到达城市组 double lineCityProb[cityNum]; //线性化 可到达城市的选择概率 城市选择方式 当蚂蚁k选择下一步要去的城市时，有以下几个步骤：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/905e2a418605c86b7f9a8ef4b43151c6/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-01-11T13:31:47+08:00" />
<meta property="article:modified_time" content="2021-01-11T13:31:47+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">蚁群算法原理及c&#43;&#43;实现</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>参考博客<br> <a href="https://blog.csdn.net/Oudasheng/article/details/84994336">https://blog.csdn.net/Oudasheng/article/details/84994336</a><br> <a href="https://blog.csdn.net/wayjj/article/details/72809344#commentsedit">https://blog.csdn.net/wayjj/article/details/72809344#commentsedit</a><br> <a href="https://blog.csdn.net/Oudasheng/article/details/84994336">https://blog.csdn.net/Oudasheng/article/details/84994336</a><br> <a href="https://www.cnblogs.com/mahaitao/p/5572095.html" rel="nofollow">https://www.cnblogs.com/mahaitao/p/5572095.html</a><br> <a href="https://www.cnblogs.com/Horizon-asd/p/12723886.html" rel="nofollow">https://www.cnblogs.com/Horizon-asd/p/12723886.html</a><br> <a href="https://blog.csdn.net/chen10217/article/details/100762552">https://blog.csdn.net/chen10217/article/details/100762552</a></p> 
<h2><a id="_7"></a>一、原理</h2> 
<h3><a id="1__9"></a>1. 蚂蚁觅食行为</h3> 
<p>蚁群在寻找食物时，总能找到一条蚁穴到食物的最短路径，并且能随着环境的变化而更新最优路径。究其原因，是因为蚂蚁在运动过程中，会在所经过路径上留下一种称为<strong>信息素</strong>（pheromone）的物质，其他蚂蚁在运动中可以感知到这种物质，并以此来指导自己的运动方向。<br> 蚁群的这种行为表现出一种<strong>信息正反馈现象</strong>：某一路径上走过的蚂蚁越多，则后来者选择该路径的概率越大。</p> 
<h3><a id="2_12"></a>2.蚁群算法</h3> 
<p>又称蚂蚁算法，是一种基于群体智能的算法，用来在图中寻找优化路径的概率型。它由Marco Dorigo于1992年在他的博士论文中提出，其灵感来源于蚂蚁在寻找食物过程中发现路径的行为。在解决实际问题时，人工蚁群相较于自然蚁群有一定的记忆能力，可记住已访问过的节点，其次人工蚁群在选择路径时依照一定规律，并不是盲目的。蚁群算法常用来解决路径规划等离散优化问题，如旅行商问题（TSP）、指派问题、调度问题。</p> 
<h4><a id="21__15"></a>2,1 特点</h4> 
<ol><li>正反馈：可较快发现较优解。</li><li>分布式：基于种群的进化算法，本质具有并行性，易于并行实现。</li><li>启发式搜索：反映搜索中的的先验性和确定性因素（如距离）强度。</li><li>鲁棒性强：不易受某个个体影响。</li></ol> 
<h4><a id="22_TSP_20"></a>2.2 算法流程（以TSP问题为例）</h4> 
<p>TSP问题：一商人去n个城市销货，所有城市走一遍再回到起点，使所走路程最短。</p> 
<ol><li>初始化相关参数：蚁群规模、信息素因子、启发函数因子、信息素挥发因子、信息素常数和最大迭代次数等。将城市信息读入程序并进行预处理，即将城市间信息转化为矩阵。</li><li>随机将蚂蚁放入不同出发点，计算每个蚂蚁的下一步要访问的城市，直到有蚂蚁访问完所有城市。</li><li>计算每个蚂蚁经过的路径长度Lk，记录当前迭代次数下的最优解（访问完所有城市且路径长度最短），更新各条路径上的信息素浓度。</li><li>断是否达到最大迭代次数，若否则返回步骤2，若是则顺序执行。</li><li>输出最优路径和相关指标，如运行时间和迭代次数。</li></ol> 
<h4><a id="23__27"></a>2.3 相关公式</h4> 
<p><img src="https://images2.imgbox.com/c6/30/OIFvhRIm_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/be/77/fdzXlpIk_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="24__30"></a>2.4 流程图</h4> 
<p><img src="https://images2.imgbox.com/4a/69/zLyQwXGG_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_33"></a>三、例子</h2> 
<p>试设计一个并行算法，求下图中一个源点到其他定点的最短路径。（VS2019+Eigen）<br> <img src="https://images2.imgbox.com/25/6d/YaZ0gzer_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="31__36"></a>3.1 关键代码</h4> 
<h5><a id="_37"></a>数据结构：</h5> 
<p>将蚂蚁设置为一个结构体，包含所在位置、禁忌表、所走路径和是否到达终点标志四项内容。为了便于计算，将信息素、启发信息与距离信息分别在8*8的矩阵中存放，这样可以调用Eigen库直接进行矩阵计算，达到更新信息素的目的。<br> 城市也设为一个结构体，包含城市编号和选择概率两项内容。这里将城市设置为结构体，主要是考虑到在选择下一步行进城市时，要先计算选择概率再通过轮盘赌来确定下一步城市，轮盘赌时需要将城市编号与其选择概率一一对应。<br> 具体代码部分如下：</p> 
<pre><code class="prism language-cpp"><span class="token keyword">struct</span> ant                 <span class="token comment">//蚂蚁结构体</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">int</span> loc<span class="token punctuation">;</span>               <span class="token comment">//位置</span>
	<span class="token keyword">int</span> tabu<span class="token punctuation">[</span>cityNum<span class="token punctuation">]</span><span class="token punctuation">;</span>     <span class="token comment">//禁忌表</span>
	<span class="token keyword">int</span> antPath<span class="token punctuation">[</span>pathNum<span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">//走过的路</span>
	<span class="token keyword">bool</span> flag<span class="token punctuation">;</span>             <span class="token comment">//是否到达终点7</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">struct</span> ant ants<span class="token punctuation">[</span>antNum<span class="token punctuation">]</span><span class="token punctuation">;</span>   <span class="token comment">//蚁群</span>

<span class="token keyword">typedef</span> Matrix<span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token operator">&gt;</span> Matrix8d<span class="token punctuation">;</span>
Matrix8d dist<span class="token punctuation">;</span>             <span class="token comment">//距离矩阵</span>
Matrix8d pher<span class="token punctuation">;</span>             <span class="token comment">//信息素矩阵</span>
Matrix8d nextPher<span class="token punctuation">;</span>         <span class="token comment">//下一代信息素矩阵</span>
Matrix8d insp<span class="token punctuation">;</span>             <span class="token comment">//启发信息矩阵</span>

<span class="token keyword">struct</span> city                <span class="token comment">//城市结构体</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">int</span> num<span class="token punctuation">;</span>               <span class="token comment">//编号</span>
	<span class="token keyword">double</span> prob<span class="token punctuation">;</span>           <span class="token comment">//选择概率</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">struct</span> city cityProb<span class="token punctuation">[</span>cityNum<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token comment">//可到达城市组</span>
<span class="token keyword">double</span> lineCityProb<span class="token punctuation">[</span>cityNum<span class="token punctuation">]</span><span class="token punctuation">;</span>     <span class="token comment">//线性化 可到达城市的选择概率</span>
</code></pre> 
<h5><a id="_66"></a>城市选择方式</h5> 
<p>当蚂蚁k选择下一步要去的城市时，有以下几个步骤：</p> 
<ol><li>对照蚂蚁k的禁忌表，求出下一步所有可去的城市各自的选择概率(概率计算见公式(1)）；</li><li>线性化所有可去城市的概率，生成介于0~1之间的随机数（线性化概率的目的是实现轮盘赌）；</li><li>使用轮盘赌方法选择下一步要去的城市。<br> 概率计算与轮盘赌选择对应代码片如下：</li></ol> 
<pre><code class="prism language-cpp"><span class="token comment">//轮盘赌选择下一步行进城市</span>
<span class="token keyword">int</span> <span class="token function">citySelect</span><span class="token punctuation">(</span><span class="token keyword">int</span> k<span class="token punctuation">,</span> <span class="token keyword">int</span> f<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">int</span> c <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//记录蚂蚁可行进的城市个数</span>


	<span class="token comment">//1、计算可行进的各城市 选择概率</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> m <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> m <span class="token operator">&lt;</span> cityNum<span class="token punctuation">;</span> m<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token comment">//若城市（i,j）之间有路且j不在蚂蚁k的禁忌表中，则计算概率</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">dist</span><span class="token punctuation">(</span>ants<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">.</span>loc<span class="token punctuation">,</span> m<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">ifCityInTabu</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			cityProb<span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">.</span>num <span class="token operator">=</span> m<span class="token punctuation">;</span>
			cityProb<span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">.</span>prob <span class="token operator">=</span> <span class="token function">citySelProb</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> m<span class="token punctuation">)</span><span class="token punctuation">;</span>
			c<span class="token operator">++</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//2、线性化选择概率</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> m <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> m <span class="token operator">&lt;</span> c<span class="token punctuation">;</span> m<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> n <span class="token operator">=</span> m<span class="token punctuation">;</span> n <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> n<span class="token operator">--</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			lineCityProb<span class="token punctuation">[</span>m<span class="token punctuation">]</span> <span class="token operator">+</span><span class="token operator">=</span> cityProb<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">.</span>prob<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//3、产生随机数选择城市</span>
	<span class="token keyword">double</span> r <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword">double</span><span class="token punctuation">(</span>RAND_MAX<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>   <span class="token comment">//选取的目标城市</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> m <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> m <span class="token operator">&lt;</span> cityNum<span class="token punctuation">;</span> m<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>r <span class="token operator">&lt;=</span> lineCityProb<span class="token punctuation">[</span>m<span class="token punctuation">]</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			j <span class="token operator">=</span> cityProb<span class="token punctuation">[</span>m<span class="token punctuation">]</span><span class="token punctuation">.</span>num<span class="token punctuation">;</span>
			<span class="token function">updateAnt</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>j <span class="token operator">==</span> f<span class="token punctuation">)</span>
				ants<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">.</span>flag <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token comment">//若蚂蚁k下一步城市为目的地城市，则修改标志</span>
			<span class="token keyword">return</span> j<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="_118"></a>信息素更新</h5> 
<p>因为将信息素存入矩阵，所以在计算时较为简单，具体分为如下几步：</p> 
<ol><li>计算信息素增量矩阵：<br> for k = 1 to m do (遍历蚁群)<br> for j = 1 to n do (遍历蚂蚁k的行走路径)<br> 　　 计算蚂蚁k在路径(i, j)对应的信息素增量（见公式（3））;<br> 更新路径(i, j)在上一轮的信息素增量；<br> 　 end for<br> end for</li><li>计算更新后的信息素矩阵：<br> 信息素挥发系数*信息素矩阵+信息素增量矩阵（见公式（2））。<br> 对应代码片如下：</li></ol> 
<pre><code class="prism language-cpp"> <span class="token keyword">void</span> <span class="token function">updatePher</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> antNum<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>ants<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>flag <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment">//只对到达目的点的蚂蚁 所走过路径 更新信息素</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> pathNum<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>ants<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>antPath<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">||</span> ants<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>antPath<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
					<span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token keyword">else</span>
					<span class="token function">nextPher</span><span class="token punctuation">(</span>ants<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>antPath<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> ants<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>antPath<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
					<span class="token operator">+</span><span class="token operator">=</span> pQ <span class="token operator">/</span> <span class="token function">getAntLen</span><span class="token punctuation">(</span>ants<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		
	<span class="token punctuation">}</span>
	nextPher <span class="token operator">=</span> pVol <span class="token operator">*</span> pher <span class="token operator">+</span> nextPher<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="32__150"></a>3.2 运行结果</h4> 
<p>参数设置</p> 
<pre><code class="prism language-cpp"><span class="token keyword">const</span> <span class="token keyword">int</span> cityNum <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>     <span class="token comment">//城市数量</span>
<span class="token keyword">const</span> <span class="token keyword">int</span> pathNum <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">;</span>    <span class="token comment">//路径数量</span>
<span class="token keyword">const</span> <span class="token keyword">int</span> antNum <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span>     <span class="token comment">//蚂蚁数量（1.5倍城市数量）</span>
<span class="token keyword">const</span> <span class="token keyword">double</span> pVol <span class="token operator">=</span> <span class="token number">0.3</span><span class="token punctuation">;</span>   <span class="token comment">//信息素挥发系数 0.2~0.5</span>
<span class="token keyword">const</span> <span class="token keyword">int</span> pQ <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>         <span class="token comment">//信息素强度 10~1000</span>
<span class="token keyword">const</span> <span class="token keyword">double</span> pImp <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>     <span class="token comment">//信息素相对重要性 1~4</span>
<span class="token keyword">const</span> <span class="token keyword">double</span> qImp <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>     <span class="token comment">//启发信息相对重要性 3~4.5</span>
<span class="token keyword">const</span> <span class="token keyword">int</span> gen <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>       <span class="token comment">//迭代次数 100~500</span>
</code></pre> 
<p>运行结果</p> 
<p><img src="https://images2.imgbox.com/e7/05/nghDc6O9_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_167"></a>问题</h3> 
<ol><li>各项参数初始值虽然知道设置范围，但因为不够理解参数如何影响迭代的结果，参数设定主要依靠猜测。</li><li>代码运行后，发现回归太早，不符合蚁群算法回归较慢（200~500）的特点，后经过检查，发现是计算蚂蚁k在路径(i,j)上的信息素增量时，将除数Lk理解成了路径(i，j) 的距离，但实际上应该为蚂蚁k本次迭代中做走过路径距离之和。经修改后，可以符合蚁群算法回归较慢的特点。</li><li>只计算源点到某一个定点时，代码没有问题，循环结算到每个顶点最短路径时，有时运行会报如下错误，有时不会，不太明白。<br> <img src="https://images2.imgbox.com/ab/c2/hK55KJlm_o.png" alt="在这里插入图片描述"></li></ol> 
<h3><a id="_173"></a>源码</h3> 
<pre><code class="prism language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span><span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span><span class="token string">&lt;Eigen\Dense&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span><span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span><span class="token string">&lt;time.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span><span class="token string">&lt;math.h&gt;</span></span>

<span class="token keyword">using</span> <span class="token keyword">namespace</span> Eigen<span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>

<span class="token comment">/* 
   功能：此代码使用蚁群算法计算源点0 ~ 其他定点的最短路径
   author：yuzewei
   date：2020/12/19
*/</span>

<span class="token macro property">#<span class="token directive keyword">define</span> CLOCK_PER_SEC ((clock_t)1000)</span>

<span class="token keyword">const</span> <span class="token keyword">int</span> cityNum <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>     <span class="token comment">//城市数量</span>
<span class="token keyword">const</span> <span class="token keyword">int</span> pathNum <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">;</span>    <span class="token comment">//路径数量</span>
<span class="token keyword">const</span> <span class="token keyword">int</span> antNum <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span>     <span class="token comment">//蚂蚁数量（1.5倍城市数量）</span>
<span class="token keyword">const</span> <span class="token keyword">double</span> pVol <span class="token operator">=</span> <span class="token number">0.3</span><span class="token punctuation">;</span>   <span class="token comment">//信息素挥发系数 0.2~0.5</span>
<span class="token keyword">const</span> <span class="token keyword">int</span> pQ <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>         <span class="token comment">//信息素强度 10~1000</span>
<span class="token keyword">const</span> <span class="token keyword">double</span> pImp <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>     <span class="token comment">//信息素相对重要性 1~4</span>
<span class="token keyword">const</span> <span class="token keyword">double</span> qImp <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>     <span class="token comment">//启发信息相对重要性 3~4.5</span>
<span class="token keyword">const</span> <span class="token keyword">int</span> gen <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>       <span class="token comment">//迭代次数 100~500</span>

<span class="token keyword">struct</span> ant                 <span class="token comment">//蚂蚁结构体</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">int</span> loc<span class="token punctuation">;</span>               <span class="token comment">//位置</span>
	<span class="token keyword">int</span> tabu<span class="token punctuation">[</span>cityNum<span class="token punctuation">]</span><span class="token punctuation">;</span>     <span class="token comment">//禁忌表</span>
	<span class="token keyword">int</span> antPath<span class="token punctuation">[</span>pathNum<span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">//走过的路</span>
	<span class="token keyword">bool</span> flag<span class="token punctuation">;</span>             <span class="token comment">//是否到达终点7</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">struct</span> ant ants<span class="token punctuation">[</span>antNum<span class="token punctuation">]</span><span class="token punctuation">;</span>   <span class="token comment">//蚁群</span>

<span class="token keyword">typedef</span> Matrix<span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token operator">&gt;</span> Matrix8d<span class="token punctuation">;</span>
Matrix8d dist<span class="token punctuation">;</span>             <span class="token comment">//距离矩阵</span>
Matrix8d pher<span class="token punctuation">;</span>             <span class="token comment">//信息素矩阵</span>
Matrix8d nextPher<span class="token punctuation">;</span>         <span class="token comment">//下一代信息素矩阵</span>
Matrix8d insp<span class="token punctuation">;</span>             <span class="token comment">//启发信息矩阵</span>

<span class="token keyword">struct</span> city                <span class="token comment">//城市结构体</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">int</span> num<span class="token punctuation">;</span>               <span class="token comment">//编号</span>
	<span class="token keyword">double</span> prob<span class="token punctuation">;</span>           <span class="token comment">//选择概率</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">struct</span> city cityProb<span class="token punctuation">[</span>cityNum<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token comment">//可到达城市组</span>
<span class="token keyword">double</span> lineCityProb<span class="token punctuation">[</span>cityNum<span class="token punctuation">]</span><span class="token punctuation">;</span>     <span class="token comment">//线性化 可到达城市的选择概率</span>

clock_t start<span class="token punctuation">,</span> finish<span class="token punctuation">;</span>     
<span class="token keyword">double</span> duration<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">initAnts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                  
<span class="token keyword">void</span> <span class="token function">initCityProb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              
<span class="token keyword">void</span> <span class="token function">initMarix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   
<span class="token keyword">bool</span> <span class="token function">ifCityInTabu</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">citySelect</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">updateAnt</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">double</span> <span class="token function">citySelProb</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">getAntLen</span><span class="token punctuation">(</span>ant<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">getBestPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">printBestPath</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">updatePher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">evolution</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">srand</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span><span class="token punctuation">)</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">evolution</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//蚁群初始化</span>
<span class="token keyword">void</span> <span class="token function">initAnts</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">//初始化禁忌表与行走路线</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> antNum<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> cityNum<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			ants<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>tabu<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> pathNum<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			ants<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>antPath<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//将蚂蚁放入城市</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> antNum<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token comment">//ants[i].loc = rand() % 8;</span>
		ants<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>loc <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//出发点都在起点</span>
		ants<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>tabu<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> ants<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>loc<span class="token punctuation">;</span>
		ants<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>antPath<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> ants<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>loc<span class="token punctuation">;</span>
		ants<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>flag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//初始化城市选择概率数组</span>
<span class="token keyword">void</span> <span class="token function">initCityProb</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>

	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> cityNum<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		cityProb<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>num <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
		cityProb<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>prob <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		lineCityProb<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//初始化距离、信息素、启发信息矩阵</span>
<span class="token keyword">void</span> <span class="token function">initMarix</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	dist <span class="token operator">=</span> Matrix8d<span class="token operator">::</span><span class="token function">Constant</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">dist</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">47</span><span class="token punctuation">;</span>
	<span class="token function">dist</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">70</span><span class="token punctuation">;</span>
	<span class="token function">dist</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">24</span><span class="token punctuation">;</span>

	<span class="token function">dist</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">31</span><span class="token punctuation">;</span>
	<span class="token function">dist</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">74</span><span class="token punctuation">;</span>
	<span class="token function">dist</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">79</span><span class="token punctuation">;</span>

	<span class="token function">dist</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">55</span><span class="token punctuation">;</span>
	<span class="token function">dist</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">88</span><span class="token punctuation">;</span>
	<span class="token function">dist</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">23</span><span class="token punctuation">;</span>
	<span class="token function">dist</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">66</span><span class="token punctuation">;</span>

	<span class="token function">dist</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">29</span><span class="token punctuation">;</span>

	<span class="token function">dist</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">31</span><span class="token punctuation">;</span>
	<span class="token function">dist</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>

	<span class="token function">dist</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">25</span><span class="token punctuation">;</span>
	<span class="token function">dist</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">120</span><span class="token punctuation">;</span>

	<span class="token function">dist</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">66</span><span class="token punctuation">;</span>

	pher <span class="token operator">=</span> Matrix8d<span class="token operator">::</span><span class="token function">Zero</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	nextPher <span class="token operator">=</span> Matrix8d<span class="token operator">::</span><span class="token function">Zero</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	insp <span class="token operator">=</span> Matrix8d<span class="token operator">::</span><span class="token function">Zero</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">dist</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token function">insp</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">/</span> <span class="token function">dist</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//启发信息为距离的倒数</span>
				<span class="token function">pher</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>             <span class="token comment">//信息素浓度初始值为1</span>
			<span class="token punctuation">}</span>

		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//轮盘赌选择下一步行进城市</span>
<span class="token keyword">int</span> <span class="token function">citySelect</span><span class="token punctuation">(</span><span class="token keyword">int</span> k<span class="token punctuation">,</span> <span class="token keyword">int</span> f<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">int</span> c <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//记录蚂蚁可行进的城市个数</span>


	<span class="token comment">//1、计算可行进的各城市 选择概率</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> m <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> m <span class="token operator">&lt;</span> cityNum<span class="token punctuation">;</span> m<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token comment">//若城市（i,j）之间有路且j不在蚂蚁k的禁忌表中，则计算概率</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">dist</span><span class="token punctuation">(</span>ants<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">.</span>loc<span class="token punctuation">,</span> m<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">ifCityInTabu</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			cityProb<span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">.</span>num <span class="token operator">=</span> m<span class="token punctuation">;</span>
			cityProb<span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">.</span>prob <span class="token operator">=</span> <span class="token function">citySelProb</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> m<span class="token punctuation">)</span><span class="token punctuation">;</span>
			c<span class="token operator">++</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//2、线性化选择概率</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> m <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> m <span class="token operator">&lt;</span> c<span class="token punctuation">;</span> m<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> n <span class="token operator">=</span> m<span class="token punctuation">;</span> n <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> n<span class="token operator">--</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			lineCityProb<span class="token punctuation">[</span>m<span class="token punctuation">]</span> <span class="token operator">+</span><span class="token operator">=</span> cityProb<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">.</span>prob<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//3、产生随机数选择城市</span>
	<span class="token keyword">double</span> r <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword">double</span><span class="token punctuation">(</span>RAND_MAX<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>   <span class="token comment">//选取的目标城市</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> m <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> m <span class="token operator">&lt;</span> cityNum<span class="token punctuation">;</span> m<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>r <span class="token operator">&lt;=</span> lineCityProb<span class="token punctuation">[</span>m<span class="token punctuation">]</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			j <span class="token operator">=</span> cityProb<span class="token punctuation">[</span>m<span class="token punctuation">]</span><span class="token punctuation">.</span>num<span class="token punctuation">;</span>
			<span class="token function">updateAnt</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>j <span class="token operator">==</span> f<span class="token punctuation">)</span>
				ants<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">.</span>flag <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token comment">//若蚂蚁k下一步城市为目的地城市，则修改标志</span>
			<span class="token keyword">return</span> j<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//更新蚂蚁信息</span>
<span class="token keyword">void</span> <span class="token function">updateAnt</span><span class="token punctuation">(</span><span class="token keyword">int</span> k<span class="token punctuation">,</span> <span class="token keyword">int</span> l<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	ants<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">.</span>loc <span class="token operator">=</span> l<span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> cityNum<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>ants<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">.</span>tabu<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			ants<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">.</span>tabu<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> l<span class="token punctuation">;</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> pathNum<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>ants<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">.</span>antPath<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			ants<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">.</span>antPath<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> l<span class="token punctuation">;</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//蚂蚁k从当前城市i选择下一步行进城市为j市的概率</span>
<span class="token keyword">double</span> <span class="token function">citySelProb</span><span class="token punctuation">(</span><span class="token keyword">int</span> k<span class="token punctuation">,</span> <span class="token keyword">int</span> j<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">double</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> prob<span class="token punctuation">;</span>
	a <span class="token operator">=</span> b <span class="token operator">=</span> c <span class="token operator">=</span> prob <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> i <span class="token operator">=</span> ants<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">.</span>loc<span class="token punctuation">;</span>

	a <span class="token operator">=</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token function">pher</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">,</span> pImp<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token function">insp</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">,</span> qImp<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> m <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> m <span class="token operator">&lt;</span> cityNum<span class="token punctuation">;</span> m<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">dist</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> m<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">ifCityInTabu</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			b <span class="token operator">=</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token function">pher</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> m<span class="token punctuation">)</span><span class="token punctuation">,</span> pImp<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token function">insp</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> m<span class="token punctuation">)</span><span class="token punctuation">,</span> qImp<span class="token punctuation">)</span><span class="token punctuation">;</span>
			c <span class="token operator">+</span><span class="token operator">=</span> b<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	prob <span class="token operator">=</span> a <span class="token operator">/</span> c<span class="token punctuation">;</span>
	<span class="token keyword">return</span> prob<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//判断城市j是否在蚂蚁k的禁忌表中</span>
<span class="token keyword">bool</span> <span class="token function">ifCityInTabu</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token punctuation">,</span> <span class="token keyword">int</span> k<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> cityNum<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>j <span class="token operator">==</span> ants<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">.</span>tabu<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
			<span class="token comment">//break;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//计算路径长度</span>
<span class="token keyword">int</span> <span class="token function">getAntLen</span><span class="token punctuation">(</span><span class="token keyword">struct</span> ant a<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> pathNum<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span>antPath<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">||</span> a<span class="token punctuation">.</span>antPath<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">else</span>
			len <span class="token operator">+</span><span class="token operator">=</span> <span class="token function">dist</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>antPath<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> a<span class="token punctuation">.</span>antPath<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> len<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//计算最优路径对应的蚂蚁编号</span>
<span class="token keyword">int</span> <span class="token function">getBestPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">int</span> d<span class="token punctuation">[</span>antNum<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> min<span class="token punctuation">;</span>
	<span class="token keyword">int</span> k<span class="token punctuation">;</span>  <span class="token comment">//蚂蚁k的路线到达目的地节点最短</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> antNum<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		d<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> antNum<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		
		d<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">getAntLen</span><span class="token punctuation">(</span>ants<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	min <span class="token operator">=</span> d<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> antNum<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>d<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;</span> min <span class="token operator">&amp;&amp;</span> ants<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>flag <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment">// 最优路径只从到达目标点的蚂蚁中筛选</span>
		<span class="token punctuation">{<!-- --></span>
			min <span class="token operator">=</span> d<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
			k <span class="token operator">=</span> i<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> k<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//打印最优路径、最短距离</span>
<span class="token keyword">void</span> <span class="token function">printBestPath</span><span class="token punctuation">(</span><span class="token keyword">int</span> k<span class="token punctuation">,</span> <span class="token keyword">int</span> f<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"  最短路径为："</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> pathNum<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>ants<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">.</span>antPath<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>

		cout <span class="token operator">&lt;&lt;</span> ants<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">.</span>antPath<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>ants<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">.</span>antPath<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
			cout <span class="token operator">&lt;&lt;</span> <span class="token string">"-&gt;"</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	cout <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"  对应距离为："</span> <span class="token operator">&lt;&lt;</span> <span class="token function">getAntLen</span><span class="token punctuation">(</span>ants<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//更新信息素矩阵</span>
<span class="token keyword">void</span> <span class="token function">updatePher</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> antNum<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>ants<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>flag <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment">//只对到达目的点的蚂蚁 所走过路径 更新信息素</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> pathNum<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>ants<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>antPath<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">||</span> ants<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>antPath<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
					<span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token keyword">else</span>
					<span class="token function">nextPher</span><span class="token punctuation">(</span>ants<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>antPath<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> ants<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>antPath<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
					<span class="token operator">+</span><span class="token operator">=</span> pQ <span class="token operator">/</span> <span class="token function">getAntLen</span><span class="token punctuation">(</span>ants<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		
	<span class="token punctuation">}</span>
	nextPher <span class="token operator">=</span> pVol <span class="token operator">*</span> pher <span class="token operator">+</span> nextPher<span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token comment">//迭代</span>
<span class="token keyword">void</span> <span class="token function">evolution</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> f <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> f <span class="token operator">&lt;</span> cityNum<span class="token punctuation">;</span> f<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"【从源点0到定点"</span> <span class="token operator">&lt;&lt;</span> f <span class="token operator">&lt;&lt;</span> <span class="token string">"】"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"开始迭代........."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>

		<span class="token comment">//初始化参数</span>
		<span class="token function">initAnts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">initMarix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">int</span> g <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//当前代数</span>
		start <span class="token operator">=</span> <span class="token function">clock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">while</span> <span class="token punctuation">(</span>g <span class="token operator">&lt;</span> gen<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token comment">//1、蚁群内所有蚂蚁都到达目的地</span>
			<span class="token keyword">int</span> p <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//蚁群前进步数</span>
			<span class="token keyword">while</span> <span class="token punctuation">(</span>p <span class="token operator">&lt;</span> pathNum<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> antNum<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>ants<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>flag <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token comment">//到达目的地</span>
						<span class="token keyword">continue</span><span class="token punctuation">;</span>
					<span class="token function">citySelect</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token function">initCityProb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				p<span class="token operator">++</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token keyword">if</span> <span class="token punctuation">(</span>g <span class="token operator">==</span> gen <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				cout <span class="token operator">&lt;&lt;</span> <span class="token string">"达到最高迭代次数!"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
				<span class="token function">printBestPath</span><span class="token punctuation">(</span><span class="token function">getBestPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
				

			<span class="token comment">//3、更新信息素矩阵</span>
			<span class="token function">updatePher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token comment">//4、初始化蚁群；更新信息素矩阵</span>
			<span class="token function">initAnts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			pher <span class="token operator">=</span> nextPher<span class="token punctuation">;</span>
			nextPher <span class="token operator">=</span> Matrix8d<span class="token operator">::</span><span class="token function">Zero</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			g<span class="token operator">++</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		finish <span class="token operator">=</span> <span class="token function">clock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		duration <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span>finish <span class="token operator">-</span> start<span class="token punctuation">)</span> <span class="token operator">/</span> CLOCK_PER_SEC<span class="token punctuation">;</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"  耗时："</span> <span class="token operator">&lt;&lt;</span> duration <span class="token operator">&lt;&lt;</span> <span class="token string">"秒"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/74d72ba401a1c99ceb90a9a172d73b16/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">使用.Net Core开发WPF App系列教程(.Net Core和WPF介绍)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9c403aa9a1ef4461666c2d9f5a7462e9/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Nebula Exchange 工具 Hive 数据导入的踩坑之旅</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>