<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>如何实现Web应用、网站状态的监控？ - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="如何实现Web应用、网站状态的监控？" />
<meta property="og:description" content="如何实现Web应用、网站状态的监控？ 关键词：网站监控,服务器监控,页面性能监控,用户体验监控本文通过代码分析、网站应用介绍网站状态监控的方式下文主要分为网站应用、技术实现两部分 一、网站应用 现在网络上已经存在一些Web网站监控的服务，虽然功能五花八门，但限制较大，需付费使用本文介绍的技术运行网站见下方地址，不会关闭，可以直接使用一个朴实无华且免费的WEB网站监控工具先看下效果
1. 打开网站 【传送门】 https://www.xujian.tech/monitor 2. 微信扫码登录 这里通过微信扫码取得小程序openid，利用openid标记用户，不涉及隐私
扫码完成后会自动跳转到系统 3. 进入监控表 进入系统后，选中左侧菜单进入监控表页面
4. 添加监控器 监控器支持POST、GET两种请求方式GET请求时，如有参数，请直接放置在地址中POST请求时，如有参数，请在表单中填写JSON键值对对象Header如果有需要，也可按JSON对象方式填写仅需如下三步，即可完成设置提交后，点击刷新即可在页面上看到监控器记录（此时还未执行）
5. 说明和操作 5.1 关于成功率 初次时显示“未执行”，执行正确计算 5.2 关于监控频率 每次执行完成计算下一次执行时间，默认30分钟一次（免费用户暂不支持自定义频率）计时器每5分钟执行一次，发现监控器执行时间小于当前时间的，就执行请求所以监控频率并非严格按照30分钟一次 5.2 相关操作 新增/编辑监控器后，可以点击“立即执行”进行一次请求，观察设置是否正确需要修改时，可点击“编辑”按钮对监控器内容进行修改点击运行记录，可查看近期运行的情况运行记录中，点击结果复制，可以复制运行的结果（当返回内容大于512b的时候，只存储前512个内容）需要邮件通知的用户，可点击右上角头像设置邮箱，在系统异常的时候，会通过邮件进行提示，邮件内容如下：
6. 功能拓展 如果有更多建议、合作，请在本文下方留言或按网站提示添加作者 二、技术实现 1. 技术栈 实现一个监控器需前端、后端、数据库、缓存等技术本站主要应用了以下技术： 序号技术所属端1VUE前端2Vue Element Admin前端3Java后端4MySQL 数据库后端5Redis缓存后端6Nginx运维7MyBaits-plus后端 2. 核心代码 实现web应用监控的核心是定期按规则进行请求，并将结果记录，遇到错误时发送邮件提醒本文以在Spring Boot中实现为例，除Spring Boot基础依赖外，还需添加如下依赖 &lt;!--发送邮件--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-mail&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--糊涂工具，实现网络请求、工具类等--&gt; &lt;dependency&gt; &lt;groupId&gt;cn.hutool&lt;/groupId&gt; &lt;artifactId&gt;hutool-all&lt;/artifactId&gt; &lt;version&gt;5.8.20&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;version&gt;1.18.0&lt;/version&gt; &lt;/dependency&gt; 2.1 监控器实体 记录监控器基本属性、执行时间、统计结果等下方代码含实体和下次执行时间计算方法 @Data @Builder @TableName(&#34;m_monitor&#34;) public class MMonitor { @JsonFormat(shape = JsonFormat." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/4ed0a28c9fe4274c7a091b5e049a4968/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-09-17T10:59:10+08:00" />
<meta property="article:modified_time" content="2023-09-17T10:59:10+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">如何实现Web应用、网站状态的监控？</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="Web_0"></a>如何实现Web应用、网站状态的监控？</h2> 
<ul><li>关键词：网站监控,服务器监控,页面性能监控,用户体验监控</li><li>本文通过代码分析、网站应用介绍网站状态监控的方式</li><li>下文主要分为网站应用、技术实现两部分</li></ul> 
<h4><a id="_5"></a>一、网站应用</h4> 
<ul><li>现在网络上已经存在一些Web网站监控的服务，虽然功能五花八门，但限制较大，需付费使用</li><li>本文介绍的技术运行网站见下方地址，不会关闭，可以直接使用</li><li>一个朴实无华且免费的WEB网站监控工具</li><li>先看下效果<br> <img src="https://images2.imgbox.com/fb/ad/XE4hsuRQ_o.png" alt="在这里插入图片描述"></li></ul> 
<h5><a id="1__12"></a>1. 打开网站</h5> 
<ul><li><a href="https://www.xujian.tech/monitor" rel="nofollow">【传送门】</a></li></ul> 
<pre><code class="prism language-bash">https://www.xujian.tech/monitor
</code></pre> 
<h5><a id="2__18"></a>2. 微信扫码登录</h5> 
<ul><li>这里通过微信扫码取得小程序openid，利用openid标记用户，不涉及隐私<br> <img src="https://images2.imgbox.com/fe/68/g3C65DSQ_o.png" alt="在这里插入图片描述"></li><li>扫码完成后会自动跳转到系统</li></ul> 
<h5><a id="3__22"></a>3. 进入监控表</h5> 
<ul><li>进入系统后，选中左侧菜单进入监控表页面<br> <img src="https://images2.imgbox.com/0d/09/WbbFWs1l_o.png" alt="在这里插入图片描述"></li></ul> 
<h5><a id="4__25"></a>4. 添加监控器</h5> 
<ul><li>监控器支持POST、GET两种请求方式</li><li>GET请求时，如有参数，请直接放置在地址中</li><li>POST请求时，如有参数，请在表单中填写JSON键值对对象</li><li>Header如果有需要，也可按JSON对象方式填写</li><li>仅需如下三步，即可完成设置</li><li>提交后，点击刷新即可在页面上看到监控器记录（此时还未执行）<br> <img src="https://images2.imgbox.com/52/c7/l2gqbRLu_o.png" alt="在这里插入图片描述"></li></ul> 
<h5><a id="5__33"></a>5. 说明和操作</h5> 
<h6><a id="51__34"></a>5.1 关于成功率</h6> 
<ul><li>初次时显示“未执行”，执行正确计算</li></ul> 
<h6><a id="52__36"></a>5.2 关于监控频率</h6> 
<ul><li>每次执行完成计算下一次执行时间，默认30分钟一次（免费用户暂不支持自定义频率）</li><li>计时器每5分钟执行一次，发现监控器执行时间小于当前时间的，就执行请求</li><li>所以监控频率并非严格按照30分钟一次</li></ul> 
<h6><a id="52__40"></a>5.2 相关操作</h6> 
<ul><li>新增/编辑监控器后，可以点击“立即执行”进行一次请求，观察设置是否正确</li><li>需要修改时，可点击“编辑”按钮对监控器内容进行修改</li><li>点击运行记录，可查看近期运行的情况</li><li>运行记录中，点击结果复制，可以复制运行的结果（当返回内容大于512b的时候，只存储前512个内容）</li><li>需要邮件通知的用户，可点击右上角头像设置邮箱，在系统异常的时候，会通过邮件进行提示，邮件内容如下：<br> <img src="https://images2.imgbox.com/04/9c/bZuJ90K6_o.png" alt="在这里插入图片描述"></li></ul> 
<h5><a id="6__47"></a>6. 功能拓展</h5> 
<ul><li>如果有更多建议、合作，请在本文下方留言</li><li>或按网站提示添加作者</li></ul> 
<h4><a id="_50"></a>二、技术实现</h4> 
<h5><a id="1__51"></a>1. 技术栈</h5> 
<ul><li>实现一个监控器需前端、后端、数据库、缓存等技术</li><li>本站主要应用了以下技术：</li></ul> 
<table><thead><tr><th>序号</th><th>技术</th><th>所属端</th></tr></thead><tbody><tr><td>1</td><td>VUE</td><td>前端</td></tr><tr><td>2</td><td>Vue Element Admin</td><td>前端</td></tr><tr><td>3</td><td>Java</td><td>后端</td></tr><tr><td>4</td><td>MySQL 数据库</td><td>后端</td></tr><tr><td>5</td><td>Redis缓存</td><td>后端</td></tr><tr><td>6</td><td>Nginx</td><td>运维</td></tr><tr><td>7</td><td>MyBaits-plus</td><td>后端</td></tr></tbody></table> 
<h5><a id="2__64"></a>2. 核心代码</h5> 
<ul><li>实现web应用监控的核心是定期按规则进行请求，并将结果记录，遇到错误时发送邮件提醒</li><li>本文以在Spring Boot中实现为例，除Spring Boot基础依赖外，还需添加如下依赖</li></ul> 
<pre><code class="prism language-xml">	<span class="token comment">&lt;!--发送邮件--&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
	    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
	    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-mail<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token comment">&lt;!--糊涂工具，实现网络请求、工具类等--&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
	    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>cn.hutool<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
	    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hutool-all<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
	    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.8.20<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.18.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h6><a id="21__85"></a>2.1 监控器实体</h6> 
<ul><li>记录监控器基本属性、执行时间、统计结果等</li><li>下方代码含实体和下次执行时间计算方法</li></ul> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Builder</span>
<span class="token annotation punctuation">@TableName</span><span class="token punctuation">(</span><span class="token string">"m_monitor"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MMonitor</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@JsonFormat</span><span class="token punctuation">(</span>shape <span class="token operator">=</span> <span class="token class-name">JsonFormat<span class="token punctuation">.</span>Shape</span><span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
    <span class="token comment">//监控器名称</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token comment">//创建时间</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> createdAt<span class="token punctuation">;</span>
    <span class="token comment">//下次运行时间，定时器筛选时的重要指标</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> nextRunAt<span class="token punctuation">;</span>
    <span class="token comment">//上次运行时间</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> lastRunAt<span class="token punctuation">;</span>
    <span class="token comment">//计时器类型，1=分钟，2=小时，3=天</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> timerType<span class="token punctuation">;</span>
    <span class="token comment">//是否已伤处，1=已删除，0=正常</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> isDeleted<span class="token punctuation">;</span>
    <span class="token comment">//计时器步长，整数值</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> timerLength<span class="token punctuation">;</span>
    <span class="token comment">//监控器状态，1可用，0停用</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> status<span class="token punctuation">;</span>
    <span class="token comment">//用户微信小程序openid</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> openid<span class="token punctuation">;</span>
    <span class="token comment">//请求URL</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> toUrl<span class="token punctuation">;</span>
    <span class="token comment">//请求方法，GET、POST</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> toMethod<span class="token punctuation">;</span>
    <span class="token comment">//请求参数，JSON Object</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> toParams<span class="token punctuation">;</span>
    <span class="token comment">//请求header，JSON Object</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> toHeaders<span class="token punctuation">;</span>
    <span class="token comment">//返回结果包含为成功，当toResultCode不等于200的时候生效</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> toResult<span class="token punctuation">;</span>
    <span class="token comment">//返回结果code为成功，200表示用code，其他表示包含字符串</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> toResultCode<span class="token punctuation">;</span>
    <span class="token comment">//POST请求体格式，0=json,1=form</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> toBodyType<span class="token punctuation">;</span>
    <span class="token comment">// 最新一次运行情况：1正常，0异常</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> runStatus<span class="token punctuation">;</span>
    <span class="token comment">// 最新一次运行情况中文，成功、失败、失败原因</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> runResult<span class="token punctuation">;</span>
    <span class="token comment">// 运行成功次数</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> countSucceed<span class="token punctuation">;</span>
    <span class="token comment">// 总运行次数</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> countAll<span class="token punctuation">;</span>

    <span class="token comment">//分钟数最短步长，即最短30分钟一次</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">MIN_MINUTE_LENGTH</span> <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>

    <span class="token comment">// 下次执行时间计算方法</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">calNextRunAt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>lastRunAt <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>lastRunAt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        timerType <span class="token operator">=</span> timerType <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> timerType<span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>timerLength <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>timerLength <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>timerLength <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">int</span> addMinute <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>timerType<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span>
                addMinute <span class="token operator">=</span> timerLength<span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span>
                addMinute <span class="token operator">=</span> <span class="token number">60</span> <span class="token operator">*</span> timerLength<span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span>
                addMinute <span class="token operator">=</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">24</span> <span class="token operator">*</span> timerLength<span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        addMinute <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>addMinute<span class="token punctuation">,</span><span class="token constant">MIN_MINUTE_LENGTH</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>nextRunAt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1000L</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> addMinute<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<h6><a id="22__167"></a>2.2 计时器</h6> 
<ul><li>利用Spring Boot的Scheduled定时器实现</li></ul> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MonitorTimerTask</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token class-name">MMonitorMapper</span> monitorMapper<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">MonitorService</span> monitorService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Scheduled</span><span class="token punctuation">(</span>cron<span class="token operator">=</span><span class="token string">"0 0/5 * * * *"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MMonitor</span><span class="token punctuation">&gt;</span></span> monitorList <span class="token operator">=</span> monitorMapper<span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span>
                <span class="token keyword">new</span> <span class="token class-name">LambdaQueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MMonitor</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">isNotNull</span><span class="token punctuation">(</span><span class="token class-name">MMonitor</span><span class="token operator">::</span><span class="token function">getNextRunAt</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">lt</span><span class="token punctuation">(</span><span class="token class-name">MMonitor</span><span class="token operator">::</span><span class="token function">getNextRunAt</span><span class="token punctuation">,</span><span class="token class-name">DateUtil</span><span class="token punctuation">.</span><span class="token function">formatDateTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">MMonitor</span><span class="token operator">::</span><span class="token function">getStatus</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">MMonitor</span><span class="token operator">::</span><span class="token function">getIsDeleted</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"符合执行条件的监控器有%d个"</span><span class="token punctuation">,</span> monitorList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">MMonitor</span> mMonitor <span class="token operator">:</span> monitorList<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            monitorService<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>mMonitor<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li>定时器不生效？记得在SpringBootApplication上添加注解：@EnableScheduling</li></ul> 
<h6><a id="23__196"></a>2.3 按规则进行请求</h6> 
<ul><li>即按监控器的toXX字段配置的内容填充请求参数，进行请求！</li><li>本段不多说，直接上代码</li></ul> 
<pre><code class="prism language-java">
    <span class="token comment">/**
     * 运行监控器的方法实现，运行从这里开始
     * */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">MMonitor</span> monitor<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">long</span> timestamp <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>monitor<span class="token punctuation">.</span><span class="token function">getIsDeleted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> monitor<span class="token punctuation">.</span><span class="token function">getIsDeleted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">Date</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">boolean</span> isSucceed <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> resultMsg <span class="token operator">=</span> <span class="token string">"成功"</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> requestResult <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> code <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span><span class="token punctuation">{<!-- --></span>
            <span class="token class-name">HttpResponse</span> httpResponse <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>monitor<span class="token punctuation">.</span><span class="token function">getToMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> monitor<span class="token punctuation">.</span><span class="token function">getToMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span><span class="token string">"GET"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                <span class="token class-name">HttpRequest</span> httpRequest <span class="token operator">=</span>  <span class="token class-name">HttpRequest</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>monitor<span class="token punctuation">.</span><span class="token function">getToUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">setHeaders</span><span class="token punctuation">(</span>httpRequest<span class="token punctuation">,</span>monitor<span class="token punctuation">)</span><span class="token punctuation">;</span>
                httpResponse <span class="token operator">=</span> httpRequest<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
                <span class="token class-name">HttpRequest</span> httpRequest <span class="token operator">=</span>  <span class="token class-name">HttpRequest</span><span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>monitor<span class="token punctuation">.</span><span class="token function">getToUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">setHeaders</span><span class="token punctuation">(</span>httpRequest<span class="token punctuation">,</span>monitor<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">setPostParams</span><span class="token punctuation">(</span>httpRequest<span class="token punctuation">,</span>monitor<span class="token punctuation">)</span><span class="token punctuation">;</span>
                httpResponse <span class="token operator">=</span> httpRequest<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            code <span class="token operator">=</span> httpResponse<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            requestResult <span class="token operator">=</span> httpResponse<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>monitor<span class="token punctuation">.</span><span class="token function">getToResultCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                isSucceed <span class="token operator">=</span> code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>isSucceed<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Exception</span><span class="token punctuation">(</span><span class="token string">"返回结果HTTP CODE不为200"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                isSucceed <span class="token operator">=</span> requestResult<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>monitor<span class="token punctuation">.</span><span class="token function">getToResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>isSucceed<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Exception</span><span class="token punctuation">(</span><span class="token string">"返回结果缺少包含内容"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            isSucceed <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            resultMsg <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>isSucceed<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            monitor<span class="token punctuation">.</span><span class="token function">setCountSucceed</span><span class="token punctuation">(</span>monitor<span class="token punctuation">.</span><span class="token function">getCountSucceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        monitor<span class="token punctuation">.</span><span class="token function">setCountAll</span><span class="token punctuation">(</span>monitor<span class="token punctuation">.</span><span class="token function">getCountAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        monitor<span class="token punctuation">.</span><span class="token function">setRunStatus</span><span class="token punctuation">(</span>isSucceed <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        monitor<span class="token punctuation">.</span><span class="token function">setRunResult</span><span class="token punctuation">(</span>resultMsg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        monitor<span class="token punctuation">.</span><span class="token function">calNextRunAt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        monitor<span class="token punctuation">.</span><span class="token function">setLastRunAt</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span>
        monitorMapper<span class="token punctuation">.</span><span class="token function">updateById</span><span class="token punctuation">(</span>monitor<span class="token punctuation">)</span><span class="token punctuation">;</span>

        timestamp <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> timestamp<span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>monitor<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"检查完毕，耗时%dms."</span><span class="token punctuation">,</span> timestamp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>requestResult <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> requestResult<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">512</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            requestResult <span class="token operator">=</span> requestResult<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">511</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"..."</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">MRunRecord</span> runRecord <span class="token operator">=</span> <span class="token class-name">MRunRecord</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">monitorId</span><span class="token punctuation">(</span>monitor<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">runCode</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">runResult</span><span class="token punctuation">(</span>requestResult<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">runAt</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">timeSpent</span><span class="token punctuation">(</span>timestamp<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">openid</span><span class="token punctuation">(</span>monitor<span class="token punctuation">.</span><span class="token function">getOpenid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">runStatus</span><span class="token punctuation">(</span>isSucceed <span class="token operator">?</span> <span class="token number">1</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mRunRecordMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>runRecord<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">sendEmail</span><span class="token punctuation">(</span>runRecord<span class="token punctuation">,</span>monitor<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">/**
     * 发送邮件
     * */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">sendEmail</span><span class="token punctuation">(</span><span class="token class-name">MRunRecord</span> runRecord<span class="token punctuation">,</span><span class="token class-name">MMonitor</span> monitor<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>runRecord<span class="token punctuation">.</span><span class="token function">getRunStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> runRecord<span class="token punctuation">.</span><span class="token function">getRunStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">MUser</span> user <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">selectOne</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LambdaQueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MUser</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">MUser</span><span class="token operator">::</span><span class="token function">getOpenid</span><span class="token punctuation">,</span>runRecord<span class="token punctuation">.</span><span class="token function">getOpenid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orderByDesc</span><span class="token punctuation">(</span><span class="token class-name">MUser</span><span class="token operator">::</span><span class="token function">getId</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">last</span><span class="token punctuation">(</span><span class="token string">" LIMIT 1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>user <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token class-name">StrUtil</span><span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span> user<span class="token punctuation">.</span><span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">5</span> <span class="token operator">||</span> <span class="token operator">!</span>user<span class="token punctuation">.</span><span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"@"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">String</span> subject <span class="token operator">=</span> <span class="token string">"【亚特技术Web监控】【监控异常】"</span> <span class="token operator">+</span> monitor<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> text <span class="token operator">=</span>
                    <span class="token string">"----------------详情登录网站查看----------------\n"</span> <span class="token operator">+</span>
                    <span class="token string">"-------------------请求内容-------------------\n"</span> <span class="token operator">+</span>
                    <span class="token string">"URL："</span> <span class="token operator">+</span> monitor<span class="token punctuation">.</span><span class="token function">getToUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\n"</span> <span class="token operator">+</span>
                    <span class="token string">"Method："</span> <span class="token operator">+</span> monitor<span class="token punctuation">.</span><span class="token function">getToMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\n"</span> <span class="token operator">+</span>
                    <span class="token string">"-------------------返回内容-------------------\n"</span> <span class="token operator">+</span>
                    <span class="token string">"HttpCode："</span> <span class="token operator">+</span> runRecord<span class="token punctuation">.</span><span class="token function">getRunCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\n"</span> <span class="token operator">+</span>
                    <span class="token string">"Result："</span> <span class="token operator">+</span> runRecord<span class="token punctuation">.</span><span class="token function">getRunResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">;</span>
            eMailUtils<span class="token punctuation">.</span><span class="token function">sendTextMailMessage</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> subject<span class="token punctuation">,</span> text<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 分析规则设置Post参数
     * */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">setPostParams</span><span class="token punctuation">(</span><span class="token class-name">HttpRequest</span> httpRequest<span class="token punctuation">,</span><span class="token class-name">MMonitor</span> monitor<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>monitor<span class="token punctuation">.</span><span class="token function">getToBodyType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> monitor<span class="token punctuation">.</span><span class="token function">getToBodyType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token comment">//application/json 方式请求</span>
            httpRequest<span class="token punctuation">.</span><span class="token function">contentType</span><span class="token punctuation">(</span><span class="token string">"application/x-www-form-urlencoded;charset=GBK"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span><span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">JSONUtil</span><span class="token punctuation">.</span><span class="token function">isTypeJSONObject</span><span class="token punctuation">(</span>monitor<span class="token punctuation">.</span><span class="token function">getToParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">return</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token class-name">JSONObject</span> joParams <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSONObject</span><span class="token punctuation">(</span>monitor<span class="token punctuation">.</span><span class="token function">getToParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> paramsMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> key <span class="token operator">:</span> joParams<span class="token punctuation">.</span><span class="token function">keySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    paramsMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span>joParams<span class="token punctuation">.</span><span class="token function">getStr</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                httpRequest<span class="token punctuation">.</span><span class="token function">form</span><span class="token punctuation">(</span>paramsMap<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>

            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>monitor<span class="token punctuation">.</span><span class="token function">getToBodyType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> monitor<span class="token punctuation">.</span><span class="token function">getToBodyType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            httpRequest<span class="token punctuation">.</span><span class="token function">contentType</span><span class="token punctuation">(</span><span class="token string">"application/json"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            httpRequest<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span>monitor<span class="token punctuation">.</span><span class="token function">getToParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 分析规则设置header
     * */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">setHeaders</span><span class="token punctuation">(</span><span class="token class-name">HttpRequest</span> httpRequest<span class="token punctuation">,</span><span class="token class-name">MMonitor</span> monitor<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">try</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">JSONUtil</span><span class="token punctuation">.</span><span class="token function">isTypeJSONObject</span><span class="token punctuation">(</span>monitor<span class="token punctuation">.</span><span class="token function">getToHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">JSONObject</span> joHeader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSONObject</span><span class="token punctuation">(</span>monitor<span class="token punctuation">.</span><span class="token function">getToHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> headerMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> key <span class="token operator">:</span> joHeader<span class="token punctuation">.</span><span class="token function">keySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                headerMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span>joHeader<span class="token punctuation">.</span><span class="token function">getStr</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            httpRequest<span class="token punctuation">.</span><span class="token function">addHeaders</span><span class="token punctuation">(</span>headerMap<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>

        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> 
<h4><a id="_348"></a>三、结尾说明</h4> 
<ul><li>第一部分说的网站已经可用了，欢迎试用、欢迎长期使用、欢迎联系合作、欢迎定制功能</li><li>第二部分给出了核心内容，但这部分实际上不是实现整个网站最耗时的：前端开发工作也是费力不讨好的</li><li>本人同时还提供Java开发一对一教学，有需要的添加微信：xujian_cq详聊</li><li>欢迎点赞、收藏、评论</li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/764b716b8cda8fdad2858cf4a9a6746f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">《Python趣味工具》——自制emoji2（2）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/dcf4c9109cb585acc2d86362053771af/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Rocky Linux 安装图解（替代centos）服务器&#43;桌面</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>