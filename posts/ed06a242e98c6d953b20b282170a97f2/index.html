<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>xls批量转换为xlsx格式文件 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="xls批量转换为xlsx格式文件" />
<meta property="og:description" content="由于使用的PHP库解析xls格式文件有问题，而将xls格式转换为xlsx格式就可以解析，考虑到xls文件有很多，需要使用批量转换文件的方法，本文介绍两种方法。
目录 方法1：Python pandas库方法2：VBA批量转换 方法1：Python pandas库 使用Python pandas库的to_excel方法来另存为xlsx格式。
考虑到Excel文件一般有多个工作表，需要都读出来然后保存。下面直接给出代码：
import glob import os import time import pandas as pd class excelConvert(): def __init__(self): self.path = os.getcwd() # 当前工作路径 xlsxdirname = &#34;xlsx&#34; xlsxpath = os.path.join(self.path, xlsxdirname) if not os.path.exists(xlsxpath): print(f&#34;创建文件夹: {xlsxdirname}&#34;) os.makedirs(xlsxpath) self.xlsxpath = xlsxpath def batch_convert(self): xls_files = glob.glob(self.path &#43; &#34;/*.xls&#34;) if len(xls_files) != 0: print(&#39;当前目录下的xls格式文件：&#39;) for file in xls_files: print(os.path.basename(file)) fname, _ = os.path.splitext(file) basename = os.path.basename(fname) xlsxpathname = os." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/ed06a242e98c6d953b20b282170a97f2/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-03-27T17:23:53+08:00" />
<meta property="article:modified_time" content="2022-03-27T17:23:53+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">xls批量转换为xlsx格式文件</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>由于使用的PHP库解析xls格式文件有问题，而将xls格式转换为xlsx格式就可以解析，考虑到xls文件有很多，需要使用批量转换文件的方法，本文介绍两种方法。</p> 
<p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><ul><li><a href="#1Python_pandas_4" rel="nofollow">方法1：Python pandas库</a></li><li><a href="#2VBA_58" rel="nofollow">方法2：VBA批量转换</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="1Python_pandas_4"></a>方法1：Python pandas库</h3> 
<p>使用Python pandas库的to_excel方法来另存为xlsx格式。</p> 
<p>考虑到Excel文件一般有多个工作表，需要都读出来然后保存。下面直接给出代码：</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> glob
<span class="token keyword">import</span> os
<span class="token keyword">import</span> time
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd

<span class="token keyword">class</span> <span class="token class-name">excelConvert</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>path <span class="token operator">=</span> os<span class="token punctuation">.</span>getcwd<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 当前工作路径</span>
        xlsxdirname <span class="token operator">=</span> <span class="token string">"xlsx"</span>
        xlsxpath <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>self<span class="token punctuation">.</span>path<span class="token punctuation">,</span> xlsxdirname<span class="token punctuation">)</span>

        <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>xlsxpath<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"创建文件夹: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>xlsxdirname<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>xlsxpath<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>xlsxpath <span class="token operator">=</span> xlsxpath

    <span class="token keyword">def</span> <span class="token function">batch_convert</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        xls_files <span class="token operator">=</span> glob<span class="token punctuation">.</span>glob<span class="token punctuation">(</span>self<span class="token punctuation">.</span>path <span class="token operator">+</span> <span class="token string">"/*.xls"</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>xls_files<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'当前目录下的xls格式文件：'</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> <span class="token builtin">file</span> <span class="token keyword">in</span> xls_files<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>basename<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

                fname<span class="token punctuation">,</span> _ <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>splitext<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span>
                basename <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>basename<span class="token punctuation">(</span>fname<span class="token punctuation">)</span>
                xlsxpathname <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>self<span class="token punctuation">.</span>xlsxpath<span class="token punctuation">,</span> basename<span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>saveasxlsx<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> xlsxpathname<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'该目录下无xls格式文件，即将退出...'</span><span class="token punctuation">)</span>
            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
            os<span class="token punctuation">.</span>_exit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">saveasxlsx</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> xlspath<span class="token punctuation">,</span> xlsxpath<span class="token punctuation">)</span><span class="token punctuation">:</span>
        writer <span class="token operator">=</span> pd<span class="token punctuation">.</span>ExcelWriter<span class="token punctuation">(</span>xlsxpath <span class="token operator">+</span> <span class="token string">'.xlsx'</span><span class="token punctuation">)</span>
        datas <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>xlspath<span class="token punctuation">,</span>sheet_name<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> sheetname<span class="token punctuation">,</span> values <span class="token keyword">in</span> datas<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            data <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>values<span class="token punctuation">)</span>
            data<span class="token punctuation">.</span>to_excel<span class="token punctuation">(</span>writer<span class="token punctuation">,</span> sheet_name<span class="token operator">=</span>sheetname<span class="token punctuation">)</span>
        writer<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
        writer<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__<span class="token operator">==</span><span class="token string">'__main__'</span><span class="token punctuation">:</span>
    excel <span class="token operator">=</span> excelConvert<span class="token punctuation">(</span><span class="token punctuation">)</span>
    excel<span class="token punctuation">.</span>batch_convert<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>使用上述代码无法保留原Excel文件中的单元格样式，接下来介绍使用VBA代码进行转换。</p> 
<h3><a id="2VBA_58"></a>方法2：VBA批量转换</h3> 
<p>使用VBA代码进行批量转换，代码来源：<a href="https://www.extendoffice.com/documents/excel/1349-excel-batch-convert-xls-to-xlsx.html" rel="nofollow">https://www.extendoffice.com/documents/excel/1349-excel-batch-convert-xls-to-xlsx.html</a></p> 
<p>打开Excel 2007或者以上版本，<strong>ALT + F11</strong> 打开 Microsoft Visual Basic for Applications窗口，点击 插入-&gt; 模块，会打开代码窗口。</p> 
<p>或者右键点击工作表，选择【查看代码】：</p> 
<p><img src="https://images2.imgbox.com/31/0a/0UgbLjVD_o.png" alt="image"></p> 
<p>输入以下代码：</p> 
<pre><code class="prism language-vba">Sub ConvertToXlsx()
'Updateby Extendoffice
Dim strPath As String
Dim strFile As String
Dim xWbk As Workbook
Dim xSFD, xRFD As FileDialog
Dim xSPath As String
Dim xRPath As String
Set xSFD = Application.FileDialog(msoFileDialogFolderPicker)
With xSFD
.Title = "Please select the folder contains the xls files:"
.InitialFileName = "C:\"
End With
If xSFD.Show &lt;&gt; -1 Then Exit Sub
xSPath = xSFD.SelectedItems.Item(1)
Set xRFD = Application.FileDialog(msoFileDialogFolderPicker)
With xRFD
.Title = "Please select a folder for outputting the new files:"
.InitialFileName = "C:\"
End With
If xRFD.Show &lt;&gt; -1 Then Exit Sub
xRPath = xRFD.SelectedItems.Item(1) &amp; "\"
strPath = xSPath &amp; "\"
strFile = Dir(strPath &amp; "*.xls")
Application.ScreenUpdating = False
Application.DisplayAlerts = False
Do While strFile &lt;&gt; ""
If Right(strFile, 3) = "xls" Then
Set xWbk = Workbooks.Open(Filename:=strPath &amp; strFile)
xWbk.SaveAs Filename:=xRPath &amp; strFile &amp; "x", _
FileFormat:=xlOpenXMLWorkbook
xWbk.Close SaveChanges:=False
End If
strFile = Dir
Loop
Application.DisplayAlerts = True
Application.ScreenUpdating = True
End Sub

</code></pre> 
<p>点击<strong>F5</strong>运行，选择xls文件目录和保存xlsx文件的目录，然后会进行批量转换。</p> 
<center> 
 <b>--THE END--<b></b></b> 
</center> 
<blockquote> 
 <p>逃离是事实，但我没有背叛。——刘慈欣《三体2：黑暗森林》</p> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c1a6153789147e2f4d5d1c7c423e0c82/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">OHIF简介</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9824da389e7ebd90d095b877507e424d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">一文彻底解密Spring 源码之Spring MVC</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>