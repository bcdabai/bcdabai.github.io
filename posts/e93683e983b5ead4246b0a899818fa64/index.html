<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>springboot2.x整合kafka【详细】 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="springboot2.x整合kafka【详细】" />
<meta property="og:description" content="文章目录 一、中间件部署1. 环境2. 版本选择依据3. 解压安装3.1 zookeeper安装部署3.2 kafka安装部署 二、springboot整合1. pom.xml添加依赖2. application.yml添加kafka配置3. service下创建kafka文件夹，新建生产者4. service.kafka文件夹下，新建消费者5. 测试 一、中间件部署 1. 环境 服务器系统版本：CentOS 7.3.1611zookeeper使用版本：zookeeper-3.4.14kafka使用版本：kafka_2.12-2.3.1 2. 版本选择依据 kafka-zookeeper对应版本（最新可参考官网：http://kafka.apache.org/downloads）：
springboot-kafka客户端对应版本（https://spring.io/projects/spring-kafka）：
下载地址（多个镜像仓库可选）：https://www.apache.org/dyn/closer.cgi?path=/kafka/2.3.1/kafka_2.12-2.3.1.tgz
3. 解压安装 3.1 zookeeper安装部署 下载并拷贝zookeeper-3.4.14.tar.gz文件到指定目录下（下面假设安装在/home/tools下）
解压、进入到/home/tools目录执行命令：tar -xvf zookeeper-3.4.14.tar.gz
解压完成后，cd /home/tools/zookeeper-3.4.14/conf
拷贝文件、执行命令：cp zoo_sample.cfg zoo.cfg
创建数据文件夹/data/dataDir和日志文件夹/data/dataLogDir
cd /home/tools/zookeeper-3.4.14/ mkdir /data mkdir /data/dataDir mkdir /data/dataLogDir 编辑zoo.cfg文件，修改dataDir和dataLogDir的路径
启动zookeeper
执行命令：/home/tools/zookeeper-3.4.14/bin/zkServer.sh start
扩展：方便起见，为zookeeper设置启动脚本
进入到/etc/rc.d/init.d目录下： cd /etc/rc.d/init.d新建一个名为zookeeper的文件： touch zookeeper修改zookeeper内容: vim zookeeper
注意文件中JAVA_HOME每个机子配置不同，查询命令：echo $JAVA_HOME#!/bin/bash #chkconfig: 2345 10 90 #description: service zookeeper export JAVA_HOME=/usr/java/jdk1.8.0_181 export ZOOKEEPER_HOME=/home/tools/zookeeper-3." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/e93683e983b5ead4246b0a899818fa64/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-07-10T17:03:35+08:00" />
<meta property="article:modified_time" content="2020-07-10T17:03:35+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">springboot2.x整合kafka【详细】</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_1" rel="nofollow">一、中间件部署</a></li><li><ul><li><a href="#1__2" rel="nofollow">1. 环境</a></li><li><a href="#2__7" rel="nofollow">2. 版本选择依据</a></li><li><a href="#3__15" rel="nofollow">3. 解压安装</a></li><li><ul><li><a href="#31_zookeeper_16" rel="nofollow">3.1 zookeeper安装部署</a></li><li><a href="#32_kafka_65" rel="nofollow">3.2 kafka安装部署</a></li></ul> 
  </li></ul> 
  </li><li><a href="#springboot_112" rel="nofollow">二、springboot整合</a></li><li><ul><li><a href="#1_pomxml_113" rel="nofollow">1. pom.xml添加依赖</a></li><li><a href="#2_applicationymlkafka_122" rel="nofollow">2. application.yml添加kafka配置</a></li><li><a href="#3_servicekafka_152" rel="nofollow">3. service下创建kafka文件夹，新建生产者</a></li><li><a href="#4_servicekafka_194" rel="nofollow">4. service.kafka文件夹下，新建消费者</a></li><li><a href="#5__218" rel="nofollow">5. 测试</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="_1"></a>一、中间件部署</h2> 
<h3><a id="1__2"></a>1. 环境</h3> 
<ul><li>服务器系统版本：CentOS 7.3.1611</li><li>zookeeper使用版本：zookeeper-3.4.14</li><li>kafka使用版本：kafka_2.12-2.3.1</li></ul> 
<h3><a id="2__7"></a>2. 版本选择依据</h3> 
<ul><li> <p>kafka-zookeeper对应版本（最新可参考官网：<a href="http://kafka.apache.org/downloads" rel="nofollow">http://kafka.apache.org/downloads</a>）：<br> <img src="https://images2.imgbox.com/ef/c7/CuhzM86Q_o.png" alt="在这里插入图片描述" width="360"></p> </li><li> <p>springboot-kafka客户端对应版本（<a href="https://spring.io/projects/spring-kafka" rel="nofollow">https://spring.io/projects/spring-kafka</a>）：<br> <img src="https://images2.imgbox.com/da/fc/cRnUiMWi_o.png" alt="在这里插入图片描述" width="600"><br> 下载地址（多个镜像仓库可选）：<a href="https://www.apache.org/dyn/closer.cgi?path=/kafka/2.3.1/kafka_2.12-2.3.1.tgz" rel="nofollow">https://www.apache.org/dyn/closer.cgi?path=/kafka/2.3.1/kafka_2.12-2.3.1.tgz</a></p> </li></ul> 
<h3><a id="3__15"></a>3. 解压安装</h3> 
<h4><a id="31_zookeeper_16"></a>3.1 zookeeper安装部署</h4> 
<ol><li> <p>下载并拷贝zookeeper-3.4.14.tar.gz文件到指定目录下（下面假设安装在/home/tools下）</p> </li><li> <p>解压、进入到/home/tools目录执行命令：<code>tar -xvf zookeeper-3.4.14.tar.gz</code></p> </li><li> <p>解压完成后，<code>cd /home/tools/zookeeper-3.4.14/conf</code></p> </li><li> <p>拷贝文件、执行命令：<code>cp zoo_sample.cfg zoo.cfg</code></p> </li><li> <p>创建数据文件夹/data/dataDir和日志文件夹/data/dataLogDir</p> <pre><code class="prism language-powershell">cd <span class="token operator">/</span>home<span class="token operator">/</span>tools<span class="token operator">/</span>zookeeper<span class="token operator">-</span>3<span class="token punctuation">.</span>4<span class="token punctuation">.</span>14<span class="token operator">/</span>
mkdir <span class="token operator">/</span><span class="token keyword">data</span>
mkdir <span class="token operator">/</span><span class="token keyword">data</span><span class="token operator">/</span>dataDir
mkdir <span class="token operator">/</span><span class="token keyword">data</span><span class="token operator">/</span>dataLogDir
</code></pre> </li><li> <p>编辑zoo.cfg文件，修改dataDir和dataLogDir的路径<br> <img src="https://images2.imgbox.com/d8/15/6y1tHesf_o.png" alt="在这里插入图片描述" width="500"></p> </li><li> <p>启动zookeeper<br> 执行命令：<code>/home/tools/zookeeper-3.4.14/bin/zkServer.sh start</code></p> </li><li> <p>扩展：方便起见，为zookeeper设置启动脚本</p> </li></ol> 
<ul><li>进入到/etc/rc.d/init.d目录下： <code>cd /etc/rc.d/init.d</code></li><li>新建一个名为zookeeper的文件： <code>touch zookeeper</code></li><li>修改zookeeper内容: <code>vim zookeeper</code><br> 注意文件中JAVA_HOME每个机子配置不同，查询命令：<code>echo $JAVA_HOME</code><pre><code class="prism language-powershell"><span class="token comment">#!/bin/bash</span>
<span class="token comment">#chkconfig: 2345 10 90</span>
<span class="token comment">#description: service zookeeper</span>
export JAVA_HOME=<span class="token operator">/</span>usr<span class="token operator">/</span>java<span class="token operator">/</span>jdk1<span class="token punctuation">.</span>8<span class="token punctuation">.</span>0_181
export ZOOKEEPER_HOME=<span class="token operator">/</span>home<span class="token operator">/</span>tools<span class="token operator">/</span>zookeeper<span class="token operator">-</span>3<span class="token punctuation">.</span>4<span class="token punctuation">.</span>14
case <span class="token string">"<span class="token variable">$1</span>"</span> in
　　<span class="token function">start</span><span class="token punctuation">)</span> su root $<span class="token punctuation">{<!-- --></span>ZOOKEEPER_HOME<span class="token punctuation">}</span><span class="token operator">/</span>bin<span class="token operator">/</span>zkServer<span class="token punctuation">.</span>sh <span class="token function">start</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
　　<span class="token function">start</span><span class="token operator">-</span>foreground<span class="token punctuation">)</span> su root $<span class="token punctuation">{<!-- --></span>ZOOKEEPER_HOME<span class="token punctuation">}</span><span class="token operator">/</span>bin<span class="token operator">/</span>zkServer<span class="token punctuation">.</span>sh <span class="token function">start</span><span class="token operator">-</span>foreground<span class="token punctuation">;</span><span class="token punctuation">;</span>
　　stop<span class="token punctuation">)</span> su root $<span class="token punctuation">{<!-- --></span>ZOOKEEPER_HOME<span class="token punctuation">}</span><span class="token operator">/</span>bin<span class="token operator">/</span>zkServer<span class="token punctuation">.</span>sh stop<span class="token punctuation">;</span><span class="token punctuation">;</span>
　　status<span class="token punctuation">)</span> su root $<span class="token punctuation">{<!-- --></span>ZOOKEEPER_HOME<span class="token punctuation">}</span><span class="token operator">/</span>bin<span class="token operator">/</span>zkServer<span class="token punctuation">.</span>sh status<span class="token punctuation">;</span><span class="token punctuation">;</span>
　　restart<span class="token punctuation">)</span> su root $<span class="token punctuation">{<!-- --></span>ZOOKEEPER_HOME<span class="token punctuation">}</span><span class="token operator">/</span>bin<span class="token operator">/</span>zkServer<span class="token punctuation">.</span>sh restart<span class="token punctuation">;</span><span class="token punctuation">;</span>
　　upgrade<span class="token punctuation">)</span>su root $<span class="token punctuation">{<!-- --></span>ZOOKEEPER_HOME<span class="token punctuation">}</span><span class="token operator">/</span>bin<span class="token operator">/</span>zkServer<span class="token punctuation">.</span>sh upgrade<span class="token punctuation">;</span><span class="token punctuation">;</span>
　　print<span class="token operator">-</span>cmd<span class="token punctuation">)</span>su root $<span class="token punctuation">{<!-- --></span>ZOOKEEPER_HOME<span class="token punctuation">}</span><span class="token operator">/</span>bin<span class="token operator">/</span>zkServer<span class="token punctuation">.</span>sh print<span class="token operator">-</span>cmd<span class="token punctuation">;</span><span class="token punctuation">;</span>
　　<span class="token operator">*</span><span class="token punctuation">)</span> <span class="token function">echo</span> <span class="token string">"requirestart|start-foreground|stop|status|restart|print-cmd"</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
esac
</code></pre> </li><li>为新建的/etc/rc.d/init.d/zookeeper文件添加可执行权限：<code>chmod +x /etc/rc.d/init.d/zookeeper</code></li><li>把zookeeper这个脚本添加到开机启动项里面： <code>chkconfig --add zookeeper</code></li><li>查看是否添加成功：<code>chkconfig --list</code></li><li>最后就可以执行：<code>service zookeeper start/restart/stop/status</code> 来快速启动、停止</li></ul> 
<h4><a id="32_kafka_65"></a>3.2 kafka安装部署</h4> 
<ol><li> <p>下载并拷贝kafka_2.12-2.3.1.tgz文件到/home/tools目录下</p> </li><li> <p>在/home/tools目录下解压，执行命令：<code>tar -xvf kafka_2.12-2.3.1.tgz</code></p> </li><li> <p>进入/home/tools/kafka_2.12-2.3.1/config目录</p> </li><li> <p>编辑server.properties文件<br> 注意：不修改listeners（本地访问），只修改advertised.listeners（远程访问），否则本地和远程都无法获取数据<br> <img src="https://images2.imgbox.com/8b/0f/NXr2b2Rs_o.png" alt="在这里插入图片描述"><br> 修改日志路径：<br> <img src="https://images2.imgbox.com/ea/ad/uUcYgwUC_o.png" alt="在这里插入图片描述"><br> 配置zookeeper：<br> <img src="https://images2.imgbox.com/30/6b/Iz3ZIhNa_o.png" alt="在这里插入图片描述"></p> </li><li> <p>修改producer.properties和consumer.properties，都只修改地址<br> <img src="https://images2.imgbox.com/7f/2d/dQhyz0dv_o.png" alt="在这里插入图片描述"></p> </li><li> <p>前台启动kafka<br> 执行命令：<code>/home/tools/kafka_2.12-2.3.1/bin/kafka-server-start.sh /home/tools/kafka_2.12-2.3.1/config/server.properties</code><br> 查看日志是否报错，如果没有报错可以ctrl+c然后进行后台启动</p> </li><li> <p>后台启动kafka<br> 执行命令：<code>/home/tools/kafka_2.12-2.3.1/bin/kafka-server-start.sh -daemon /home/tools/kafka_2.12-2.3.1/config/server.properties</code></p> </li><li> <p>登录zookeeper验证是否连接成功<br> <code>cd /home/tools/zookeeper-3.4.14/bin</code><br> <code>./zkCli.sh -server localhost:2181</code><br> 进入zookeeper命令行后执行<br> <code>get /brokers/ids/0</code><br> <img src="https://images2.imgbox.com/69/56/XfHea9zc_o.png" alt="在这里插入图片描述"></p> </li><li> <p>创建topic<br> <code>/home/tools/kafka_2.12-2.3.1/bin/kafka-topics.sh --create --bootstrap-server ip:9092 --replication-factor 1 --partitions 1 --topic test</code></p> </li><li> <p>多窗口测试消息收发<br> 开两个窗口分别 <code>cd /home/tools/kafka_2.12-2.3.1</code><br> 一个执行：<br> <code>./bin/kafka-console-producer.sh --broker-list localhost:9092 --topic test</code><br> <img src="https://images2.imgbox.com/47/7e/5LTWEUya_o.png" alt="在这里插入图片描述"><br> 另一个执行：<br> <code>./bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic test --from-beginning</code><br> <img src="https://images2.imgbox.com/5c/fe/HI6UaJgF_o.png" alt="在这里插入图片描述"><br> 获取到了数据则说明部署成功。</p> </li><li> <p>kafka数据维护</p> </li></ol> 
<ul><li>清空指定topic的数据（实测只清空数据，topic不会被删除）：<code>./bin/kafka-topics.sh --zookeeper ip:2181 --delete --topic test</code>；</li><li>清空所有数据，比较麻烦，自行查阅。</li></ul> 
<h2><a id="springboot_112"></a>二、springboot整合</h2> 
<h3><a id="1_pomxml_113"></a>1. pom.xml添加依赖</h3> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.kafka<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-kafka<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h3><a id="2_applicationymlkafka_122"></a>2. application.yml添加kafka配置</h3> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> XXX
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token punctuation">...</span><span class="token comment">#其他配置项</span>
  <span class="token key atrule">kafka</span><span class="token punctuation">:</span>
    <span class="token key atrule">bootstrap-servers</span><span class="token punctuation">:</span> kafka's<span class="token punctuation">-</span>ip<span class="token punctuation">:</span><span class="token number">9092</span>
    <span class="token comment">#=============== provider  =======================</span>
    <span class="token key atrule">producer</span><span class="token punctuation">:</span>
      <span class="token key atrule">retries</span><span class="token punctuation">:</span> <span class="token number">0</span>
      <span class="token comment"># 每次批量发送消息的数量</span>
      <span class="token key atrule">batch-size</span><span class="token punctuation">:</span> <span class="token number">16384</span>
      <span class="token key atrule">buffer-memory</span><span class="token punctuation">:</span> <span class="token number">33554432</span>
      <span class="token comment"># 指定消息key和消息体的编解码方式,StringSerializer支持Json对象的序列化</span>
      <span class="token key atrule">key-serializer</span><span class="token punctuation">:</span> org.apache.kafka.common.serialization.StringSerializer
      <span class="token key atrule">value-serializer</span><span class="token punctuation">:</span> org.apache.kafka.common.serialization.StringSerializer
    <span class="token comment">#=============== consumer  =======================</span>
    <span class="token comment"># 指定默认消费者group id</span>
    <span class="token key atrule">consumer</span><span class="token punctuation">:</span>
      <span class="token key atrule">group-id</span><span class="token punctuation">:</span> test<span class="token punctuation">-</span>consumer<span class="token punctuation">-</span>group
      <span class="token key atrule">auto-offset-reset</span><span class="token punctuation">:</span> earliest
      <span class="token key atrule">enable-auto-commit</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
      <span class="token key atrule">auto-commit-interval</span><span class="token punctuation">:</span> <span class="token number">100</span>
      <span class="token comment"># 指定消息key和消息体的编解码方式,StringDeserializer支持Json对象的反序列化</span>
      <span class="token key atrule">key-deserializer</span><span class="token punctuation">:</span> org.apache.kafka.common.serialization.StringDeserializer
      <span class="token key atrule">value-deserializer</span><span class="token punctuation">:</span> org.apache.kafka.common.serialization.StringDeserializer
</code></pre> 
<h3><a id="3_servicekafka_152"></a>3. service下创建kafka文件夹，新建生产者</h3> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">KafkaProducer</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> Logger logger <span class="token operator">=</span> LoggerFactory<span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span>KafkaProducer<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> KafkaTemplate<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">,</span> String<span class="token punctuation">&gt;</span></span> kafkaTemplate<span class="token punctuation">;</span>

    <span class="token keyword">private</span> Gson gson <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GsonBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//发送消息方法</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">5</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            Message message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            message<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            message<span class="token punctuation">.</span><span class="token function">setMsg</span><span class="token punctuation">(</span>UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span> <span class="token string">"---"</span> <span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            message<span class="token punctuation">.</span><span class="token function">setSendTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"发送消息 =&gt; message = {}"</span><span class="token punctuation">,</span> gson<span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            kafkaTemplate<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">,</span> gson<span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>其中的Message对象如下：</p> 
<pre><code class="prism language-java"><span class="token comment">//@Data使用了lombok，也可以手动写get/set</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Message</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token keyword">long</span> id<span class="token punctuation">;</span>

    <span class="token keyword">private</span> String msg<span class="token punctuation">;</span>

    <span class="token keyword">private</span> Date sendTime<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="4_servicekafka_194"></a>4. service.kafka文件夹下，新建消费者</h3> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">KafkaReceiver</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> Logger logger <span class="token operator">=</span> LoggerFactory<span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span>KafkaReceiver<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@KafkaListener</span><span class="token punctuation">(</span>topics <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"test"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">listen</span><span class="token punctuation">(</span>ConsumerRecord<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token punctuation">,</span> <span class="token operator">?</span><span class="token operator">&gt;</span> record<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        Optional<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">&gt;</span> kafkaMessage <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>record<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>kafkaMessage<span class="token punctuation">.</span><span class="token function">isPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            Object message <span class="token operator">=</span> kafkaMessage<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"----------------- record ="</span> <span class="token operator">+</span> record<span class="token punctuation">)</span><span class="token punctuation">;</span>
            logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"----------------- message ="</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            Gson gson <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GsonBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Message msg <span class="token operator">=</span> gson<span class="token punctuation">.</span><span class="token function">fromJson</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Message<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"content =&gt; "</span><span class="token operator">+</span>msg<span class="token punctuation">.</span><span class="token function">getMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p>注意：上面两段代码中的 <strong>topics</strong> 均对应第一节中在中间件所在服务器创建的 topic</p> 
</blockquote> 
<h3><a id="5__218"></a>5. 测试</h3> 
<p>可以在服务器创建消息，也可以在本地项目中调用 <code>producer.send()</code> 方法测试。<br> <img src="https://images2.imgbox.com/1d/1b/FwYDUYIC_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/eb/2b/LOON8Qbd_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/d0/4a/Xt4B2XmO_o.png" alt="在这里插入图片描述"><br> 完毕！</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5902c3a68a6d24be94630ffa418476f8/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">python文件编译与pyc反编译</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b82589dffddeb0c106138cba5de2f78b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">最新React使用 http-proxy-middleware解决多跨域问题(完美篇)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>