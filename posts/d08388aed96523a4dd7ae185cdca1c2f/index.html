<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>mysql shell 配置mysql_mysql shell安装 mysql8.0 MGR - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="mysql shell 配置mysql_mysql shell安装 mysql8.0 MGR" />
<meta property="og:description" content="1. 节点信息
hostname
IP地址
mysql MGR
mysql1
172.16.230.51
mysql2
172.16.230.52
mysql3
172.16.230.53
2. 三个节点安装mysql8 实例
3. 每个节点初始化mysql账号
create user &#39;fengjian&#39;@&#39;%&#39; identified by &#39;123456&#39;;
grant all on*.* to &#39;fengjian&#39;@&#39;%&#39; with grant option;
4. 下载 mysql shell
[root@mysql1 ~]# wget https://cdn.mysql.com//Downloads/MySQL-Shell/mysql-shell-8.0.23-linux-glibc2.12-x86-64bit.tar.gz
[root@mysql1 ~]# tar -zxvf mysql-shell-8.0.23-linux-glibc2.12-x86-64bit.tar.gz
[root@mysql1 ~]# mv mysql-shell-8.0.23-linux-glibc2.12-x86-64bit /usr/local/mysqlshell[root@mysql3 ~]# chown -R mysql.mysql /usr/local/mysqlshell
5. 拷贝mysqlshell 到其他节点
[root@mysql1 ~]#scp - /usr/local/mysqlshell root@172.16.230.52:/usr/local/[root@mysql2~]#chown -R mysql.mysql /usr/local/mysqlshell
[root@mysql1~]# scp - /usr/local/mysqlshell root@172." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/d08388aed96523a4dd7ae185cdca1c2f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-02-17T19:12:33+08:00" />
<meta property="article:modified_time" content="2021-02-17T19:12:33+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">mysql shell 配置mysql_mysql shell安装 mysql8.0 MGR</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div style="font-size:16px;"> 
 <p>1. 节点信息</p> 
 <p>hostname</p> 
 <p>IP地址</p> 
 <p>mysql  MGR</p> 
 <p>mysql1</p> 
 <p>172.16.230.51</p> 
 <p>mysql2</p> 
 <p>172.16.230.52</p> 
 <p>mysql3</p> 
 <p>172.16.230.53</p> 
 <p>2. 三个节点安装mysql8 实例</p> 
 <p>3. 每个节点初始化mysql账号</p> 
 <p>create user 'fengjian'@'%' identified by '123456';</p> 
 <p>grant all on*.* to 'fengjian'@'%' with grant option;</p> 
 <p>4. 下载 mysql shell</p> 
 <p>[root@mysql1 ~]# wget https://cdn.mysql.com//Downloads/MySQL-Shell/mysql-shell-8.0.23-linux-glibc2.12-x86-64bit.tar.gz</p> 
 <p>[root@mysql1 ~]# tar -zxvf mysql-shell-8.0.23-linux-glibc2.12-x86-64bit.tar.gz</p> 
 <p>[root@mysql1 ~]# mv mysql-shell-8.0.23-linux-glibc2.12-x86-64bit /usr/local/mysqlshell[root@mysql3 ~]# chown -R mysql.mysql /usr/local/mysqlshell</p> 
 <p>5. 拷贝mysqlshell 到其他节点</p> 
 <p>[root@mysql1 ~]#scp - /usr/local/mysqlshell root@172.16.230.52:/usr/local/[root@mysql2~]#chown -R mysql.mysql /usr/local/mysqlshell</p> 
 <p>[root@mysql1~]# scp - /usr/local/mysqlshell root@172.16.230.52:/usr/local/[root@mysql3~]# chown -R mysql.mysql /usr/local/mysqlshell</p> 
 <p>6. 利用mysql shell 构建MGR</p> 
 <p>[root@mysql1 ~]# /usr/local/mysqlshell/bin/mysqlsh</p> 
 <p># 链接一个mysql节点</p> 
 <p>shell.connect('fengjian@172.16.230.51:3306')</p> 
 <p>#定义一个集群var cluster = dba.createCluster('SenyintCluster')</p> 
 <p># 其他节点实例加入到集群</p> 
 <p>cluster.addinstance('fengjian@172.16.230.52:3306')</p> 
 <p align="center"><img src="https://images2.imgbox.com/45/db/ZqWSEgRw_o.png" alt="68fe632268668eb515a7ae975adeb594.png"></p> 
 <p>cluster.addinstance('fengjian@172.16.230.53:3306')</p> 
 <p>#查看集群状态</p> 
 <p>cluster.status()</p> 
 <p># 当链接超时需要 重新链接</p> 
 <p>MySQL  172.16.230.51:3306 ssl  JS &gt; shell.connect('fengjian@172.16.230.51:3306')</p> 
 <p>#cluster 表示获取var cluster = dba.getCluster('SenyintCluster')</p> 
 <p>报错信息:</p> 
 <p>MySQL 172.16.230.51:3306 ssl JS &gt; var cluster=dba.createCluster('SenyintCluster')</p> 
 <p>Anew InnoDB cluster will be created on instance '172.16.230.51:3306'.</p> 
 <p>Validating instance configuration at172.16.230.51:3306...</p> 
 <p>This instance reports its own addressas mysql1:3306NOTE: Some configuration options need to befixed:+-----------------------------+---------------+----------------+----------------------------+</p> 
 <p>| Variable | Current Value | Required Value | Note |</p> 
 <p>+-----------------------------+---------------+----------------+----------------------------+</p> 
 <p>| slave_preserve_commit_order | OFF | ON | Update the server variable |</p> 
 <p>+-----------------------------+---------------+----------------+----------------------------+NOTE: Please use the dba.configureInstance() command to repair these issues.</p> 
 <p>ERROR: Instance must be configured and validated with dba.checkInstanceConfiguration() and dba.configureInstance() before it can be usedinan InnoDB cluster.</p> 
 <p>Dba.createCluster: Instance check failed (RuntimeError)</p> 
 <p>修复:</p> 
 <p>set global slave_preserve_commit_order = 1;</p> 
 <p>数据复制: 分两种情况</p> 
 <p>1.  正常复制通道 group_replication_applier 状态:   online 无延迟状态下复制</p> 
 <p>2.  延迟复制通道 group_replication_recovery 出现在复制延迟扬中, MGR 节点退化recovery 状态, SQL_Thread 从 relay_log中应用数据.</p> 
 <p align="center"><img src="https://images2.imgbox.com/4c/84/BujY8j96_o.png" alt="6c150ae0a35bdd22daed41ad2b892a82.png"></p> 
 <p>多主模式如何实现多点写入(multi-master)</p> 
 <p>1. 修改了每个节点的 auto_increment_offset, auto_increment_increment</p> 
 <p>2. 每个节点一个独立的GTID区间</p> 
 <p>3. 实现同一条数据, 同时一时间只能在一个节点上update, 同时下次修改必须保证前面的数据应用完毕</p> 
 <p>MySQL 172.16.230.51:3306 ssl JS &gt;cluster.status()</p> 
 <p>{"clusterName": "SenyintCluster","defaultReplicaSet": {"name": "default","primary": "mysql1:3306","ssl": "REQUIRED","status": "OK","statusText": "Cluster is ONLINE and can tolerate up to ONE failure.","topology": {"mysql1:3306": {"address": "mysql1:3306","mode": "R/W","readReplicas": {},"replicationLag": null,"role": "HA","status": "ONLINE","version": "8.0.22"},"mysql2:3306": {"address": "mysql2:3306","mode": "R/O","readReplicas": {},"replicationLag": null,"role": "HA","status": "ONLINE","version": "8.0.22"},"mysql3:3306": {"address": "mysql3:3306","mode": "R/O","readReplicas": {},"replicationLag": null,"role": "HA","status": "ONLINE","version": "8.0.22"}</p> 
 <p>},"topologyMode": "Single-Primary"},"groupInformationSourceMember": "mysql1:3306"}</p> 
 <p>mysql shell 切换成 multi-master 模式</p> 
 <p>MySQL 172.16.230.51:3306 ssl JS &gt;cluster.switchToMultiPrimaryMode()</p> 
 <p>Switching cluster'SenyintCluster' to Multi-Primary mode...</p> 
 <p>Instance'mysql1:3306'remains PRIMARY.</p> 
 <p>Instance'mysql2:3306' was switched fromSECONDARY to PRIMARY.</p> 
 <p>Instance'mysql3:3306' was switched fromSECONDARY to PRIMARY.</p> 
 <p>The cluster successfully switched to Multi-Primary mode.</p> 
 <p align="center"><img src="https://images2.imgbox.com/3a/8b/WXBbeL8V_o.png" alt="27494182cab1f4090558b767e9ad407a.png"></p> 
 <p align="center"><img src="https://images2.imgbox.com/6d/97/Ad5R4gn9_o.png" alt="3a4436e90446940d2cefd2751934d2b2.png"></p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9c79d23950d91abcf346a0963c7a4165/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">mysql dos入门_mysql入门基本</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/caac2c9e596d0d76ac6cc55305f9523e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title"># C语言金字塔问题（字符三角形）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>