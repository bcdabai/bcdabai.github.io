<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Mysql被黑客入侵及安全措施总结 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Mysql被黑客入侵及安全措施总结" />
<meta property="og:description" content="情况概述 今天登陆在腾讯云服务器上搭建的Mysql数据库，发现数据库被黑了，黑客提示十分明显。
Mysql中只剩下两个数据库，一个是information_schema，另一个是黑客创建的PLEASE_READ，其中有一张info表，内容如下：
Info: Your DB is Backed up at our servers, to restore send 0.2 BTC to the Bitcoin Address then send an email with your server ipBitcoin_Address: 1F33LEJjdphD6YpaonNCHejwLcgkgDGQW9Email: mysqldata@mail2tor.com 显然，我这是遇到比特币敲诈了。我的数据在别人的服务器里安然的躺着，需要向黑客支付0.2比特币才有可能恢复。按照当前的汇率，0.2比特币大约为1400人民币，这是我第一次遇到网络敲诈，金额还不小。
所幸数据库里并没有值钱的数据，就当是送给黑客了，不过 数据库安全问题 引起了我的注意。
安全措施 由于缺乏必要的安全措施和备份机制，数据库中原有的数据均已丢失。为了恢复到Mysql初始的状态，重新安装了Mysql数据库，并且重新创建原先存在的数据库，同时，为了防止再次被黑客入侵，对Mysql进行了一些安全配置。
禁用或限制远程访问。若允许远程访问，需要确保特定主机才拥有访问权。对用户进行合理授权，应用程序中最好不要直接使用root用户。限制打开网络socket，此时仍可以建立与Mysql服务器的本地连接。 [mysqld] skip-networking 强迫Mysql仅监听本机。 [mysqld] bind-address=127.0.0.1 更改root用户的登录名称和密码。移除测试数据库和匿名账户及废弃的账户。禁用LOCAL INFILE。 [mysqld] set-variable=local-infile=0 删除历史命令记录。 cat /dev/null &gt; ~/.bash_history cat /dev/null &gt; ~/.mysql_history 及时安装Mysql安全补丁。使用chroot限制Mysql运行环境。自动定期备份数据库。 用防火墙实现mysql绑定多个ip
my.cnf中有选项bind-address=127.0.0.1，是说mysql server监听的是本地发来的请求，如果是任意主机都可以请求，则写为0.0.0.0，但是这样又不太安全。监听某ip，指定此ip地址即可，但是要保证mysql的user中有允许此ip访问，否则不能对数据库操作。那么是否可以在配置里只规定几个ip呢？
简单直接回答：不可能
请参考：http://dev.mysql.com/doc/refman/5.1/en/server-options.html#option_mysqld_bind-address
The MySQL server listens on a single network socket for TCP/IP connections." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/2cbca54008951f60af26ac2d913f4ac3/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-03-06T09:43:21+08:00" />
<meta property="article:modified_time" content="2018-03-06T09:43:21+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Mysql被黑客入侵及安全措施总结</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h4 style="padding:0px;background-color:rgb(255,255,255);">情况概述</h4> 
<p style="background-color:rgb(255,255,255);">今天登陆在腾讯云服务器上搭建的Mysql数据库，发现数据库被黑了，黑客提示十分明显。</p> 
<p style="background-color:rgb(255,255,255);">Mysql中只剩下两个数据库，一个是<code style="font-size:14px;line-height:22px;">information_schema</code>，另一个是黑客创建的<code style="font-size:14px;line-height:22px;">PLEASE_READ</code>，其中有一张<code style="font-size:14px;line-height:22px;">info</code>表，内容如下：</p> 
<ul style="list-style:none;color:rgb(69,69,69);background-color:rgb(255,255,255);"><li style="padding:0px;"><code style="font-size:14px;line-height:22px;">Info</code>: Your DB is Backed up at our servers, to restore send 0.2 BTC to the Bitcoin Address then send an email with your server ip</li><li style="padding:0px;"><code style="font-size:14px;line-height:22px;">Bitcoin_Address</code>: 1F33LEJjdphD6YpaonNCHejwLcgkgDGQW9</li><li style="padding:0px;"><code style="font-size:14px;line-height:22px;">Email</code>: mysqldata@mail2tor.com</li></ul> 
<p style="background-color:rgb(255,255,255);">显然，我这是遇到比特币敲诈了。我的数据在别人的服务器里安然的躺着，需要向黑客支付0.2比特币才有可能恢复。按照当前的汇率，0.2比特币大约为1400人民币，这是我第一次遇到网络敲诈，金额还不小。</p> 
<p style="background-color:rgb(255,255,255);">所幸数据库里并没有值钱的数据，就当是送给黑客了，不过 <span style="font-weight:700;"><em>数据库安全问题</em></span> 引起了我的注意。</p> 
<hr style="color:rgb(69,69,69);background-color:rgb(255,255,255);"> 
<h4 style="padding:0px;background-color:rgb(255,255,255);"><a style="margin:0px;padding:0px;font-weight:400;"></a>安全措施</h4> 
<p style="background-color:rgb(255,255,255);">由于缺乏必要的安全措施和备份机制，数据库中原有的数据均已丢失。为了恢复到Mysql初始的状态，重新安装了Mysql数据库，并且重新创建原先存在的数据库，同时，为了防止再次被黑客入侵，对Mysql进行了一些安全配置。</p> 
<ul style="list-style:none;color:rgb(69,69,69);background-color:rgb(255,255,255);"><li style="padding:0px;">禁用或限制远程访问。若允许远程访问，需要确保特定主机才拥有访问权。</li><li style="padding:0px;">对用户进行合理授权，应用程序中最好不要直接使用<code style="font-size:14px;line-height:22px;">root</code>用户。</li><li style="padding:0px;">限制打开网络socket，此时仍可以建立与Mysql服务器的本地连接。</li></ul> 
<pre class="prettyprint" style="font-size:14px;line-height:22px;"><code class="hljs css has-numbering"><span class="hljs-attr_selector" style="margin:0px;padding:0px;">[mysqld]</span>
<span class="hljs-tag" style="margin:0px;padding:0px;">skip-networking</span></code></pre> 
<ul style="list-style:none;color:rgb(69,69,69);background-color:rgb(255,255,255);"><li style="padding:0px;">强迫Mysql仅监听本机。</li></ul> 
<pre class="prettyprint" style="font-size:14px;line-height:22px;"><code class="hljs ini has-numbering"><span class="hljs-title" style="margin:0px;padding:0px;">[mysqld]</span>
<span class="hljs-setting" style="margin:0px;padding:0px;">bind-address=<span class="hljs-value" style="margin:0px;padding:0px;"><span class="hljs-number" style="margin:0px;padding:0px;">127.0</span>.<span class="hljs-number" style="margin:0px;padding:0px;">0.1</span></span></span></code></pre> 
<ul style="list-style:none;color:rgb(69,69,69);background-color:rgb(255,255,255);"><li style="padding:0px;">更改<code style="font-size:14px;line-height:22px;">root</code>用户的登录名称和密码。</li><li style="padding:0px;">移除测试数据库和匿名账户及废弃的账户。</li><li style="padding:0px;">禁用<code style="font-size:14px;line-height:22px;">LOCAL INFILE</code>。</li></ul> 
<pre class="prettyprint" style="font-size:14px;line-height:22px;"><code class="hljs sql has-numbering">[mysqld]
<span class="hljs-operator" style="margin:0px;padding:0px;"><span class="hljs-keyword" style="margin:0px;padding:0px;">set</span>-variable=<span class="hljs-keyword" style="margin:0px;padding:0px;">local</span>-infile=<span class="hljs-number" style="margin:0px;padding:0px;">0</span></span></code></pre> 
<ul style="list-style:none;color:rgb(69,69,69);background-color:rgb(255,255,255);"><li style="padding:0px;">删除历史命令记录。</li></ul> 
<pre class="prettyprint" style="font-size:14px;line-height:22px;"><code class="language-bash hljs has-numbering">cat /dev/null &gt; ~/.bash_history
cat /dev/null &gt; ~/.mysql_history</code></pre> 
<ul style="list-style:none;color:rgb(69,69,69);background-color:rgb(255,255,255);"><li style="padding:0px;">及时安装Mysql安全补丁。</li><li style="padding:0px;">使用<code style="font-size:14px;line-height:22px;">chroot</code>限制Mysql运行环境。</li><li style="padding:0px;">自动定期备份数据库。</li></ul> 
<p><strong><span style="color:#000000;background-color:rgb(255,153,0);">用防火墙实现mysql绑定多个ip</span></strong></p> 
<p style="background-color:rgb(255,255,255);">my.cnf中有选项bind-address=127.0.0.1，是说mysql server监听的是本地发来的请求，如果是任意主机都可以请求，则写为0.0.0.0，但是这样又不太安全。监听某ip，指定此ip地址即可，但是要保证mysql的user中有允许此ip访问，否则不能对数据库操作。那么是否可以在配置里只规定几个ip呢？</p> 
<p style="background-color:rgb(255,255,255);">简单直接回答：不可能</p> 
<p style="background-color:rgb(255,255,255);">请参考：<a href="http://dev.mysql.com/doc/refman/5.1/en/server-options.html#option_mysqld_bind-address" rel="nofollow" style="margin:0px;padding:0px;">http://dev.mysql.com/doc/refman/5.1/en/server-options.html#option_mysqld_bind-address</a></p> 
<p style="background-color:rgb(255,255,255);">The MySQL server listens on a single network socket for TCP/IP connections. This socket is bound to a single address, but it is possible for an address to map onto multiple network interfaces. The default address is 0.0.0.0. To specify an address explicitly, use the –bind-address=addr option at server startup, where addr is an IPv4 address or a host name. If addr is a host name, the server resolves the name to an IPv4 address and binds to that address. The server treats different types of addresses as follows:</p> 
<p style="background-color:rgb(255,255,255);">If the address is 0.0.0.0, the server accepts TCP/IP connections on all server host IPv4 interfaces.<br>If the address is a “regular” IPv4 address (such as 127.0.0.1), the server accepts TCP/IP connections only for that particular IPv4 address.</p> 
<p style="background-color:rgb(255,255,255);">但是有此需求，就会到访问控制，那么使用防火墙iptables可实现此效果</p> 
<p style="background-color:rgb(255,255,255);">mysql-server为192.168.1.3，只允许192.168.1.4,  192.168.1.5,  192.168.1.6来访问3306端口</p> 
<p style="background-color:rgb(255,255,255);">在my.cnf中</p> 
<pre style="padding-right:0px;padding-left:0px;font-size:14px;line-height:22px;">bind-address = 0.0.0.0</pre> 
<p style="background-color:rgb(255,255,255);">在访问3306端口的主机中，只允许192.168.1.4-6，其他ip一律DROP掉</p> 
<pre style="padding-right:0px;padding-left:0px;font-size:14px;line-height:22px;">/sbin/iptables -A INPUT -p tcp -s 192.168.1.4 --dport 3306 -j ACCEPT
/sbin/iptables -A INPUT -p tcp -s 192.168.1.5 --dport 3306 -j ACCEPT
/sbin/iptables -A INPUT -p tcp -s 192.168.1.6 --dport 3306 -j ACCEPT
/sbin/iptables -A INPUT -p tcp --dport 3306 -j DROP</pre> 
<p style="background-color:rgb(255,255,255);">或</p> 
<pre style="padding-right:0px;padding-left:0px;font-size:14px;line-height:22px;">/sbin/iptables -A INPUT -p tcp --dport 3306 ! -s 192.168.1.4 -j DROP
/sbin/iptables -A INPUT -p tcp --dport 3306 ! -s 192.168.1.5 -j DROP
/sbin/iptables -A INPUT -p tcp --dport 3306 ! -s 192.168.1.6 -j DROP</pre> 
<p style="background-color:rgb(255,255,255);">保存防火墙规则</p> 
<pre style="padding-right:0px;padding-left:0px;font-size:14px;line-height:22px;">service iptables save</pre> 
<p style="background-color:rgb(255,255,255);">查看INPUT链包含3306的规则</p> 
<pre style="padding-right:0px;padding-left:0px;font-size:14px;line-height:22px;">echo -e "target prot opt source destination\n$(iptables -L INPUT -n | grep 3306)"</pre> 
<p style="background-color:rgb(255,255,255);">这样就实现了mysql只允许指定ip访问。</p> 
<p style="background-color:rgb(255,255,255);">参考：</p> 
<p style="background-color:rgb(255,255,255);">http://www.cyberciti.biz/faq/unix-linux-mysqld-server-bind-to-more-than-one-ip-address/</p> 
<p></p> 
<h2 class="postTitle" style="margin-top:0px;margin-bottom:0px;font-size:14px;line-height:1.5;padding:0px 0px 0px 5px;width:1161.33px;clear:both;font-family:Verdana, Arial, Helvetica, sans-serif;text-align:left;"><span style="color:#ffcc00;margin:0px;padding:0px;background-color:rgb(255,153,0);"><a class="postTitle2" href="http://www.cnblogs.com/zhangzhen894095789/p/6443227.html" rel="nofollow" style="margin:0px;padding:0px;">yum 和 rpm安装mysql彻底删除</a></span></h2> 
<div class="clear" style="margin:0px;padding:0px;clear:both;color:rgb(0,0,0);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;text-align:left;background-color:rgb(254,254,242);"></div> 
<div class="postBody" style="margin:5px 0px 0px;padding:5px 2px 5px 5px;line-height:1.5;color:rgb(0,0,0);font-size:13px;font-family:Verdana, Arial, Helvetica, sans-serif;text-align:left;background-color:rgb(254,254,242);"> 
 <div class="blogpost-body" style="margin:0px 0px 20px;padding:0px;"> 
  <p style="margin:10px auto;line-height:1.5;color:rgb(0,0,0);font-size:13px;">1、yum方式安装的<a class="replace_word" title="MySQL知识库" href="http://lib.csdn.net/base/14" rel="nofollow" style="margin:0px;padding:0px;color:rgb(7,93,179);text-decoration:underline;">MySQL</a></p> 
  <p style="margin:10px auto;line-height:1.5;color:rgb(0,0,0);font-size:13px;"> $ yum remove mysql mysql-server mysql-libs compat-mysql51</p> 
  <p style="margin:10px auto;line-height:1.5;color:rgb(0,0,0);font-size:13px;">$ rm -rf /var/lib/mysq</p> 
  <p style="margin:10px auto;line-height:1.5;color:rgb(0,0,0);font-size:13px;">$ rm /etc/my.cnf</p> 
  <p style="margin:10px auto;line-height:1.5;color:rgb(0,0,0);font-size:13px;">查看是否还有mysql软件：</p> 
  <p style="margin:10px auto;line-height:1.5;color:rgb(0,0,0);font-size:13px;">$ rpm -qa|grep mysql</p> 
  <p style="margin:10px auto;line-height:1.5;color:rgb(0,0,0);font-size:13px;">如果存在的话，继续删除即可，删除方式：yum remove + 【名字】。</p> 
  <p style="margin:10px auto;line-height:1.5;color:rgb(0,0,0);font-size:13px;"> </p> 
  <p style="margin:10px auto;line-height:1.5;color:rgb(0,0,0);font-size:13px;">2、rpm方式安装的mysql</p> 
  <p style="margin:10px auto;line-height:1.5;color:rgb(0,0,0);font-size:13px;"> </p> 
  <p style="margin:10px auto;line-height:1.5;color:rgb(0,0,0);font-size:13px;">a）查看系统中是否以rpm包安装的mysql：</p> 
  <p style="margin:10px auto;line-height:1.5;color:rgb(0,0,0);font-size:13px;"> </p> 
  <p style="margin:10px auto;line-height:1.5;color:rgb(0,0,0);font-size:13px;">[root@localhost opt]# rpm -qa | grep -i mysql<br style="margin:0px;padding:0px;">MySQL-server-5.6.17-1.el6.i686<br style="margin:0px;padding:0px;">MySQL-client-5.6.17-1.el6.i686</p> 
  <p style="margin:10px auto;line-height:1.5;color:rgb(0,0,0);font-size:13px;"> </p> 
  <p style="margin:10px auto;line-height:1.5;color:rgb(0,0,0);font-size:13px;">b)卸载mysql</p> 
  <p style="margin:10px auto;line-height:1.5;color:rgb(0,0,0);font-size:13px;">[root@localhost local]# rpm -e MySQL-server-5.6.17-1.el6.i686<br style="margin:0px;padding:0px;">[root@localhost local]# rpm -e MySQL-client-5.6.17-1.el6.i686</p> 
  <p style="margin:10px auto;line-height:1.5;color:rgb(0,0,0);font-size:13px;">c)删除mysql服务</p> 
  <p style="margin:10px auto;line-height:1.5;color:rgb(0,0,0);font-size:13px;">[root@localhost local]# chkconfig --list | grep -i mysql<br style="margin:0px;padding:0px;">[root@localhost local]# chkconfig --del mysql</p> 
  <p style="margin:10px auto;line-height:1.5;color:rgb(0,0,0);font-size:13px;">d)删除分散mysql文件夹</p> 
  <p style="margin:10px auto;line-height:1.5;color:rgb(0,0,0);font-size:13px;">[root@localhost local]# whereis mysql 或者 find / -name mysql</p> 
  <p style="margin:10px auto;line-height:1.5;color:rgb(0,0,0);font-size:13px;"> </p> 
  <p style="margin:10px auto;line-height:1.5;color:rgb(0,0,0);font-size:13px;">mysql: /usr/lib/mysql /usr/share/mysql</p> 
  <p style="margin:10px auto;line-height:1.5;color:rgb(0,0,0);font-size:13px;">清空相关mysql的所有目录以及文件<br style="margin:0px;padding:0px;">rm -rf /usr/lib/mysql<br style="margin:0px;padding:0px;">rm -rf /usr/share/mysql</p> 
  <p style="margin:10px auto;line-height:1.5;color:rgb(0,0,0);font-size:13px;">rm -rf /usr/my.cnf</p> 
  <p style="margin:10px auto;line-height:1.5;color:rgb(0,0,0);font-size:13px;"> </p> 
  <p style="margin:10px auto;line-height:1.5;color:rgb(0,0,0);font-size:13px;">通过以上几步，mysql应该已经完全卸载干净了。</p> 
 </div> 
</div> 
<br>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f0cdb9fe57cd18b85a3e9d43053af98b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">34.	注入篇——Cookie注入</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/96d7450e70eca5b0ab0a9befecdf562c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">syntax error near unexpected token `do</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>