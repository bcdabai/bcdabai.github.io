<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>SHT3x-DIS驱动及应用详解 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="SHT3x-DIS驱动及应用详解" />
<meta property="og:description" content="SHT3x-DIS是Sensirion新一代的温湿度传感器，精度为±2%RH和±0.3℃，输入电压范围从2.4V到5.5V，采用IIC总线接口，速率可达1MHz。测量温湿度范围分别为是-40℃ ~ 125℃和0 ~ 100%。
一、电路组成
从下图可以看到SHT3x内部集成了湿度传感器和温度传感器，通过ADC采样输入到数据处理和线性化单元，同时带有校正储存器，处理环境对器件测量的影响。通过数字接口IIC读取数据。带警报引脚，可通过修改寄存器的值设定阈值，当测量的温湿度超过阈值时它会被置位。
引脚分布如下，1和4号脚是IIC总线接口；2号脚是决定地址的引脚，当ADDR接VSS时芯片地址为0x44，接VCC时芯片地址为0x45；3号脚警报引脚（当不使用时浮空），当温湿度超过设定的阈值则该脚会被置位；5号和8号脚是电源引脚；6号引脚是复位引脚（当不使用时接VDD），低电平有效；7号脚是为了封装而保留的引脚。
下图是设备地址分配情况。
典型电路如下，由于SCL和SDA为开漏输出，驱动能力不足，需要接上拉电阻。VDD和VSS之间接一个小电容滤除高频杂波，另外nRESET和ALERT根据情况进行选择，若不需要使用，nRESET接高电平，ALERT浮空。Die Pad接地即可。
二、通讯指令说明
写好IIC驱动程序后，便可以开始和SHT3x进行通讯了，下面是SHT3x的所有指令说明。
（一）、单次获取数据指令
单次获取数据指令的详细数据格式如下图。首先从表格最上面开始，Repeatability指的是重复性，Clock Stretching指的是时钟延伸，它们的作用下面再讲述。数据流动过程如下：
1，发送起始信号以及由高7位的器件地址和最低位的写信号（WR=0） 组成的一字节地址，等待应答信号。（注意地址位于高7位，所以传址的时候需要将地址左移一位并加上读1/写0信号，如ADDR&lt;&lt;1 | WR）
2，发送指令的高字节并等待应答信号。
3，发送指令的低字节并等待应答信号，之后发送停止信号。
4，等待一段时间（测量正在进行）。
5，发送起始信号以及由高7位的器件地址和最低位的读信号（RD=1） 组成的一字节地址，然后根据选择的Clock Stretching从两个方向选择。假如失能了时钟延长功能，则等待非应答信号，发送停止信号，延迟一段时间（这步很重要！！延迟时间大约为50ms左右）等待转换结束，然后发送八位的应答信号并等待应答信号，之后便是逐字节分别读取温度和湿度的高字节、低字节以及CRC校验字节，每字节接收完都要发送应答信号，最后发送停止信号即可。而如果使能了是时钟延长功能，则总线的SCL由SHT3x控制，我们只需要通过while(SCL==0)阻塞程序，等待其释放总线然后MCU读取数据即可。
（二）、周期获取数据指令
周期获取数据指令的详细数据格式如下图。周期获取数据需要先配置读取模式然后再进行读取。
1、配置模式
周期读取数据的配置主要是配置重复性和每秒测量次数。数据发送的方式同上。
2、读取数据
读取的步骤和上述单次读取数据指令的流程类似，下面大概说一下。
发送起始信号，发送写地址，等待应答信号，注意如果传感器没有测量完，它只会返回非应答信号。发送16位命令0xE000。读取初始数据。
（三）、加快响应时间指令
加快响应时间指令，用于周期读取数据指令，开启后传感器开始采集频率为4Hz的数据。它的使用方法跟上述配置模式相同，在读取之前配置好就可以了。
发送起始信号，发送写地址，等待应答信号。发送16位命令0x2B32，等待应答信号。接着继续配置或者读取数据。
（四）、停止周期读取数据指令
停止周期读取数据指令，有时为了实现低功耗或暂时不需要传感器测量数据，可以通过该指令进行关闭。
发送起始信号，发送写地址，等待应答信号。发送16位命令0x3093，等待应答信号，发送停止信号。
（五）、复位
复位（RESET）的方式有很多种。
1、IIC接口复位
当通讯设备丢失时，在接下来的信号序列将会复位串口接口，此序列仅重置接口。状态寄存器保留其内容。SDA线置位，翻转SCL线的电平9次以上。接下来必须在下一个命令之前执行传输开始序列。
2、软复位/重新初始化
软复位/重新初始化的指令格式如下。
发送起始信号，发送写地址，等待应答信号。发送16位命令0x30A2，等待应答信号，发送停止信号。
3、一般呼叫复位指令
发送起始信号，发送通用呼叫地址0x00，等待应答信号。发送第二个字节0x06，等待应答信号。
4、通过nRESET引脚复位
拉低nRESET引脚的电平（至少350ns）将会产生硬复位信号重置传感器。
5、硬复位
重新上电。
（六）、加热器开启/关闭指令
该指令的用法同上，至于该加热器的作用是什么我也不清楚，明明是测温用的还要加热？！大概是想在温度很低的环境但想要它还能正常工作所以才设置这功能吧。
（七）、读取状态寄存器
状态寄存器包含有关加热器运行状态、警报模式以及最后一个命令的执行状态和最后一个写序列的信息。
发送起始信号，发送写地址，发送16位命令。发送起始信号，发送读地址，依次接收状态寄存器的高字节、低字节和CRC校验，每次接收都需要发送应答信号，直到接收的最后一个字节发送非应答信号，发送停止信号。
状态寄存器每一位代表的含义如下所示。
我们试一下读取状态寄存器看返回什么。可以发现二进制数1000 0000 0001 0000 1110 0001都为上面表格的默认值，至于CRC校验要根据给定公式对前两字节进行计算和比较。下面来讲CRC校验。
（八）、CRC校验
循环冗余校验(CRC)其实就是一种异或计算(模2运算)。获取的CRC校验码就是模2运算后的余数。
（九）、转换温湿度数据 由于从传感器获取到的数据不是最终的温湿度，所以我们需要根据公式进行转换，转换公式如下，在计算之前我们要对温湿度数据进行整合。 ==========" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/598f4ffd3d0d0a3c4838f44cc1a29fc5/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-02T21:00:24+08:00" />
<meta property="article:modified_time" content="2024-01-02T21:00:24+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">SHT3x-DIS驱动及应用详解</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div id="js_content"> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/9c/a6/K5FJKy0r_o.png" alt="7aee07f5c4ae4754320ba5548c78b514.png"></p> 
 <p>SHT3x-DIS是Sensirion新一代的温湿度传感器，精度为±2%RH和±0.3℃，输入电压范围从2.4V到5.5V，采用IIC总线接口，速率可达1MHz。测量温湿度范围分别为是-40℃ ~ 125℃和0 ~ 100%。</p> 
 <p>一、电路组成</p> 
 <p>从下图可以看到SHT3x内部集成了湿度传感器和温度传感器，通过ADC采样输入到数据处理和线性化单元，同时带有校正储存器，处理环境对器件测量的影响。通过数字接口IIC读取数据。带警报引脚，可通过修改寄存器的值设定阈值，当测量的温湿度超过阈值时它会被置位。</p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/83/cb/YyCaq9uZ_o.png" alt="95250d80da715cd741bc7c15d87dacdb.png"></p> 
 <p>引脚分布如下，1和4号脚是IIC总线接口；2号脚是决定地址的引脚，当ADDR接VSS时芯片地址为0x44，接VCC时芯片地址为0x45；3号脚警报引脚（当不使用时浮空），当温湿度超过设定的阈值则该脚会被置位；5号和8号脚是电源引脚；6号引脚是复位引脚（当不使用时接VDD），低电平有效；7号脚是为了封装而保留的引脚。</p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/1e/fb/RKaGTJpL_o.png" alt="11e20c4cff277d884a9e6dc2ba8359f4.png"></p> 
 <p>下图是设备地址分配情况。<br></p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/c4/73/WZn1kant_o.png" alt="8ec5317b1ec4295bc9c820237a0a048f.png"></p> 
 <p>典型电路如下，由于SCL和SDA为开漏输出，驱动能力不足，需要接上拉电阻。VDD和VSS之间接一个小电容滤除高频杂波，另外nRESET和ALERT根据情况进行选择，若不需要使用，nRESET接高电平，ALERT浮空。Die Pad接地即可。<br></p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/39/66/ULwBQZaI_o.png" alt="86df9f46fe1ccc0f09a85087f89880cb.png"></p> 
 <p>二、通讯指令说明</p> 
 <p>写好IIC驱动程序后，便可以开始和SHT3x进行通讯了，下面是SHT3x的所有指令说明。</p> 
 <p>（一）、单次获取数据指令</p> 
 <p>单次获取数据指令的详细数据格式如下图。首先从表格最上面开始，Repeatability指的是重复性，Clock Stretching指的是时钟延伸，它们的作用下面再讲述。数据流动过程如下：</p> 
 <p>1，发送起始信号以及由高7位的器件地址和最低位的写信号（WR=0） 组成的一字节地址，等待应答信号。（注意地址位于高7位，所以传址的时候需要将地址左移一位并加上读1/写0信号，如ADDR&lt;&lt;1 | WR）</p> 
 <p>2，发送指令的高字节并等待应答信号。</p> 
 <p>3，发送指令的低字节并等待应答信号，之后发送停止信号。</p> 
 <p>4，等待一段时间（测量正在进行）。</p> 
 <p>5，发送起始信号以及由高7位的器件地址和最低位的读信号（RD=1） 组成的一字节地址，然后根据选择的Clock Stretching从两个方向选择。假如失能了时钟延长功能，则等待非应答信号，发送停止信号，延迟一段时间（这步很重要！！延迟时间大约为50ms左右）等待转换结束，然后发送八位的应答信号并等待应答信号，之后便是逐字节分别读取温度和湿度的高字节、低字节以及CRC校验字节，每字节接收完都要发送应答信号，最后发送停止信号即可。而如果使能了是时钟延长功能，则总线的SCL由SHT3x控制，我们只需要通过while(SCL==0)阻塞程序，等待其释放总线然后MCU读取数据即可。</p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/60/5f/gfHcgjCH_o.png" alt="baa6f9c5f025583b23b53c6157f8a872.png"></p> 
 <p>（二）、周期获取数据指令</p> 
 <p>周期获取数据指令的详细数据格式如下图。周期获取数据需要先配置读取模式然后再进行读取。</p> 
 <p>1、配置模式</p> 
 <p>周期读取数据的配置主要是配置重复性和每秒测量次数。数据发送的方式同上。</p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/e6/c2/9EzqINrI_o.png" alt="e1c1a373983e0ad4df2bd97668a561ba.png"></p> 
 <p>2、读取数据</p> 
 <p>读取的步骤和上述单次读取数据指令的流程类似，下面大概说一下。</p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/c7/12/wcE2TdPr_o.png" alt="41bb42696d50bafcab952e04d43e6278.png"></p> 
 <p>发送起始信号，发送写地址，等待应答信号，注意如果传感器没有测量完，它只会返回非应答信号。发送16位命令0xE000。读取初始数据。</p> 
 <p>（三）、加快响应时间指令</p> 
 <p>加快响应时间指令，用于周期读取数据指令，开启后传感器开始采集频率为4Hz的数据。它的使用方法跟上述配置模式相同，在读取之前配置好就可以了。</p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/d7/08/7DxLzNaS_o.png" alt="89181282ae257897781e622adef8f4dc.png"></p> 
 <p>发送起始信号，发送写地址，等待应答信号。发送16位命令0x2B32，等待应答信号。接着继续配置或者读取数据。</p> 
 <p>（四）、停止周期读取数据指令</p> 
 <p>停止周期读取数据指令，有时为了实现低功耗或暂时不需要传感器测量数据，可以通过该指令进行关闭。</p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/8d/f9/49jh3FAx_o.png" alt="ffb719cd08cd04a2c9420948d078dd33.png"></p> 
 <p>发送起始信号，发送写地址，等待应答信号。发送16位命令0x3093，等待应答信号，发送停止信号。</p> 
 <p>（五）、复位</p> 
 <p>复位（RESET）的方式有很多种。</p> 
 <p>1、IIC接口复位</p> 
 <p>当通讯设备丢失时，在接下来的信号序列将会复位串口接口，此序列仅重置接口。状态寄存器保留其内容。SDA线置位，翻转SCL线的电平9次以上。接下来必须在下一个命令之前执行传输开始序列。</p> 
 <p>2、软复位/重新初始化</p> 
 <p>软复位/重新初始化的指令格式如下。</p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/05/0f/22KqQ1Ca_o.png" alt="14587385afed23f67e19255442f572df.png"></p> 
 <p>发送起始信号，发送写地址，等待应答信号。发送16位命令0x30A2，等待应答信号，发送停止信号。</p> 
 <p>3、一般呼叫复位指令</p> 
 <p>发送起始信号，发送通用呼叫地址0x00，等待应答信号。发送第二个字节0x06，等待应答信号。</p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/4b/cf/051iOuqT_o.png" alt="ddf8b3f2081f96e01ce197da64a04014.png"></p> 
 <p>4、通过nRESET引脚复位</p> 
 <p>拉低nRESET引脚的电平（至少350ns）将会产生硬复位信号重置传感器。</p> 
 <p>5、硬复位</p> 
 <p>重新上电。</p> 
 <p>（六）、加热器开启/关闭指令</p> 
 <p>该指令的用法同上，至于该加热器的作用是什么我也不清楚，明明是测温用的还要加热？！大概是想在温度很低的环境但想要它还能正常工作所以才设置这功能吧。</p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/a5/d3/WZSD0hf7_o.png" alt="a81b050a2b852c8930bde80aa0c57f19.png"></p> 
 <p>（七）、读取状态寄存器</p> 
 <p>状态寄存器包含有关加热器运行状态、警报模式以及最后一个命令的执行状态和最后一个写序列的信息。</p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/66/e1/zqjHguRf_o.png" alt="ec97f7e75de415fb5b9087f6442cca04.png"></p> 
 <p>发送起始信号，发送写地址，发送16位命令。发送起始信号，发送读地址，依次接收状态寄存器的高字节、低字节和CRC校验，每次接收都需要发送应答信号，直到接收的最后一个字节发送非应答信号，发送停止信号。</p> 
 <p>状态寄存器每一位代表的含义如下所示。</p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/37/60/QcqE2dH2_o.png" alt="b3923a8ecd8566b35bd4371644134a8d.png"></p> 
 <p>我们试一下读取状态寄存器看返回什么。可以发现二进制数1000 0000 0001 0000 1110 0001都为上面表格的默认值，至于CRC校验要根据给定公式对前两字节进行计算和比较。下面来讲CRC校验。</p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/18/8a/LHoAUONe_o.png" alt="ca265359c6b55b5990cc0ac8eb2df331.png"></p> 
 <p>（八）、CRC校验</p> 
 <p>循环冗余校验(CRC)其实就是一种异或计算(模2运算)。获取的CRC校验码就是模2运算后的余数。</p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/04/af/olwemsEX_o.png" alt="ef16279014b8939b1102b07948c24657.png"></p> 
 <h5>（九）、转换温湿度数据</h5> 
 <h5>由于从传感器获取到的数据不是最终的温湿度，所以我们需要根据公式进行转换，转换公式如下，在计算之前我们要对温湿度数据进行整合。</h5> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/6f/58/2SXCcsCS_o.png" alt="af4522fbb516b4338d3845b075dda912.png"></p> 
 <p>==========<br></p> 
 <p>往期回顾：</p> 
 <p><a href="" rel="nofollow">两步判断一款U盘读写性能</a><br></p> 
 <p><a href="" rel="nofollow">示波器最重要的三个参数</a><br></p> 
 <p><a href="" rel="nofollow">全攻略自制esp8266 WIFI智能排插教程</a><br></p> 
 <p><a href="" rel="nofollow">一个通道如何捕获PWM的频率和占空比？</a><br></p> 
 <p><a href="" rel="nofollow">MCU需要去耦电容的原因</a><br></p> 
 <p>==========</p> 
 <p><img src="https://images2.imgbox.com/e5/f1/rQtExcXU_o.png" alt="7b55d86044a082de3c7a4bfbff743909.png"></p> 
 <p><img src="https://images2.imgbox.com/1a/e6/HOrYkaAN_o.png" alt="6f0986c6fe5af304a23ebf4a70c62f05.png"></p> 
 <p><img src="https://images2.imgbox.com/b7/3c/vE4XWTkB_o.png" alt="6b3907119663c1b01af93d55d9f39f64.png"></p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/660c789a5a3f91199bea17eb34e38fd0/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">数据库, 数据仓库, 数据集市，数据湖，数据中台</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8ab864f0d25fa2587dc1e6e4eafeb984/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">运算符的优先级（规矩是人定的）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>