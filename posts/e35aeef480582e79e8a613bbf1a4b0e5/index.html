<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>sql：mysql：MySql 不存在则插入，存在则更新或忽略 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="sql：mysql：MySql 不存在则插入，存在则更新或忽略" />
<meta property="og:description" content="前言 在插入数据时，可能需要忽略或替换掉重复的数据（依据某个字段），这时可以在应用层处理，也可以使用复杂的 SQL 语句来处理（如果仅仅知道一些简单的 SQL 语法的话），当然也可以使用一些简单的 SQL 语法，不过它并不是通用所有的数据库类型。
以下所有实例仅针对MySQL而言，并不能随意用于其它数据库
以下的表建的唯一索引，无论一个或多个，只要导致任何一个 UNIQUE 索引或PRIMARY KEY发生冲突/重复，都适用。
实例 表名称：student
表字段：
Column NamePrimary KeyAuto IncrementUniqueidtruetrue name trueage 初始表数据：
idnameage1Jack18 注：以下所有的示例都需要被插入的数据中需要存在UNIQUE索引或PRIMARY KEY字段，同时这里引入表的主键id，并设置成自动递增，后面可以看到它的变化
1. 不存在则插入，存在则更新（插入或可指定更新个别字段） 1.1 on duplicate key update 如果插入的数据会导致UNIQUE 索引或PRIMARY KEY发生冲突/重复，则执行UPDATE语句，例：
INSERT INTO `student`(`name`, `age`) VALUES(&#39;Jack&#39;, 19) ON DUPLICATE KEY UPDATE `age`=19; -- If will happen conflict, the update statement is executed -- 2 row(s) affected 这里受影响的行数是2，因为数据库中存在name=&#39;Jack&#39;的数据，如果不存在此条数据，则受影响的行数为1
最新的表数据如下：
idnameage1Jack19 1.2 replace into（插入或直接更新为最新的记录） 如果插入的数据会导致UNIQUE 索引或PRIMARY KEY发生冲突/重复，则先删除旧数据再插入最新的数据（注意未指定的字段可能被插入空值），例：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/e35aeef480582e79e8a613bbf1a4b0e5/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-10-23T10:40:20+08:00" />
<meta property="article:modified_time" content="2020-10-23T10:40:20+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">sql：mysql：MySql 不存在则插入，存在则更新或忽略</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h3 id="前言">前言</h3> 
<p>在插入数据时，可能需要忽略或替换掉重复的数据（依据某个字段），这时可以在应用层处理，也可以使用复杂的 SQL 语句来处理（如果仅仅知道一些简单的 SQL 语法的话），当然也可以使用一些简单的 SQL 语法，不过它并不是通用所有的数据库类型。</p> 
<blockquote> 
 <p>以下所有实例仅针对<code>MySQL</code>而言，并不能随意用于其它数据库</p> 
 <p>以下的表建的唯一索引，无论一个或多个，只要导致任何一个 <code>UNIQUE 索引</code>或<code>PRIMARY KEY</code>发生冲突/重复，都适用。</p> 
</blockquote> 
<h3 id="实例"><a name="t1"></a>实例</h3> 
<p>表名称：student</p> 
<p>表字段：</p> 
<table><thead><tr><th>Column Name</th><th>Primary Key</th><th>Auto Increment</th><th>Unique</th></tr></thead><tbody><tr><td>id</td><td>true</td><td>true</td><td> </td></tr><tr><td>name</td><td> </td><td> </td><td>true</td></tr><tr><td>age</td><td> </td><td> </td><td> </td></tr></tbody></table> 
<p>初始表数据：</p> 
<table><thead><tr><th>id</th><th>name</th><th>age</th></tr></thead><tbody><tr><td>1</td><td>Jack</td><td>18</td></tr></tbody></table> 
<blockquote> 
 <p>注：以下所有的示例都需要被插入的数据中需要存在<code>UNIQUE索引</code>或<code>PRIMARY KEY</code>字段，同时这里引入表的主键<code>id</code>，并设置成<code>自动递增</code>，后面可以看到它的变化</p> 
</blockquote> 
<h4 id="1-不存在则插入存在则更新"><a name="t2"></a>1. 不存在则插入，存在则更新（插入或可指定更新个别字段）</h4> 
<h4 id="11-on-duplicate-key-update"><a name="t3"></a>1.1 on duplicate key update</h4> 
<p>如果插入的数据会导致<code>UNIQUE 索引</code>或<code>PRIMARY KEY</code>发生冲突/重复，则<strong>执行<code>UPDATE</code>语句</strong>，例：</p> 
<pre><code>INSERT INTO `student`(`name`, `age`) VALUES('Jack', 19)
  ON DUPLICATE KEY 
  UPDATE `age`=19; -- If will happen conflict, the update statement is executed

-- 2 row(s) affected</code></pre> 
<p>这里受影响的行数是<code>2</code>，因为数据库中存在<code>name='Jack'</code>的数据，如果不存在此条数据，则受影响的行数为<code>1</code></p> 
<p>最新的表数据如下：</p> 
<table><thead><tr><th>id</th><th>name</th><th>age</th></tr></thead><tbody><tr><td>1</td><td>Jack</td><td>19</td></tr></tbody></table> 
<h4 id="12-replace-into"><a name="t4"></a>1.2 replace into（插入或直接更新为最新的记录）</h4> 
<p>如果插入的数据会导致<code>UNIQUE 索引</code>或<code>PRIMARY KEY</code>发生冲突/重复，则<strong>先删除旧数据再插入最新的数据（注意未指定的字段可能被插入空值）</strong>，例：</p> 
<pre><code>REPLACE INTO `student`(`name`, `age`) VALUES('Jack', 18);

-- 2 row(s) affected</code></pre> 
<p>这里受影响的行数是<code>2</code>，因为数据库中存在<code>name='Jack'</code>的数据，并且<code>id</code>的值会变成<code>2</code>，因为它是先删除旧数据，然后再插入数据，最新的表数据如下：</p> 
<table><thead><tr><th>id</th><th>name</th><th>age</th></tr></thead><tbody><tr><td>2</td><td>Jack</td><td>19</td></tr></tbody></table> 
<h4 id="2-避免重复插入"><a name="t5"></a>2. insert ignore into 避免重复插入</h4> 
<p>关键字/句：<code>insert ignore into</code>，如果插入的数据会导致<code>UNIQUE索引</code>或<code>PRIMARY KEY</code>发生冲突/重复，则忽略此次操作/不插入数据，例：</p> 
<pre><code>INSERT IGNORE INTO `student`(`name`, `age`) VALUES('Jack', 18);

-- 0 row(s) affected</code></pre> 
<p>这里已经存在<code>name='Jack'</code>的数据，所以会忽略掉新插入的数据，受影响行数为<code>0</code>，表数据不变。</p> 
<p>以上。</p> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c7a506d6ebb51979c0bf0142ce772010/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">(1) 如何写一个gym环境——学习笔记</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2276c6cb4af5f8659aeefc92a80a1a0c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">CentOS8 开启端口转发</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>