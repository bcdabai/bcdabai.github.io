<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>爬虫基础-数据存储 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="爬虫基础-数据存储" />
<meta property="og:description" content="注：本文章为学习过程中对知识点的记录，供自己复习使用，也给大家做个参考，如有错误，麻烦指出，大家共同探讨，互相进步。
借鉴出处：
该文章的路线和主要内容：崔庆才（第2版）python3网络爬虫开发实战
文章目录 1、Text文本文件存储2、JSON文件存储3、CSV文件存储4、MySQL存储5、MongoDB文档存储6、Redis缓存存储7、Elasticsearch搜索引擎存储8、RabbitMq消息队列存储（后续再补，现在用不到，待开发中扩展到mq时，再学习此模块） 1、Text文本文件存储 def open(file, mode=&#39;r&#39;, buffering=None, encoding=None, errors=None, newline=None, closefd=True)
file表示要保存或者打开的文件路径。mode是一个可选字符串，指定文件的模式打开。encoding指定文件的编码方式。buffering用于设置缓冲策略的可选整数。传递0以关闭缓冲（仅在二进制模式下允许），传递1以选择行缓冲（仅在文本模式下可用），以及大于1的整数表示固定大小块缓冲区的大小。
当没有缓冲参数时给定，默认缓冲策略的工作方式如下：二进制文件以固定大小的块缓冲；缓冲区的大小使用试探法选择，试图确定底层设备的“块大小”并返回io.DEFAULT_BUFFER_size。在许多系统上，缓冲区通常为4096或8192字节长。“交互式”文本文件（isatty（）返回True的文件）使用行缓冲。其他文本文件使用上述策略用于二进制文件。errors是一个可选字符串，指定编码错误的方式此参数不应在二进制模式下使用。通过“strict”用于在存在编码错误时引发ValueError异常（默认值“无”具有相同的效果），或传递“忽略”以忽略错误。（请注意，忽略编码错误可能会导致数据丢失。）newline换行符控制通用换行符的工作方式（它仅适用于文本模式）。它可以是None、“”、“\n”、“\r”和“\r\n”。如果closefd为False，则底层文件描述符将保持打开状态当文件关闭时。当给定文件名时，此操作无效并且在这种情况下必须为True。 但常用的三个参数就是file、mode、encoding了。
mode的几种模式：
r：以只读方式打开一个文件，默认模式。rb：以二进制方式打开一个文件，例如音频、图片、视频等。r&#43;：以读写方式打开一个文件，既可以读文件又可以写文件。rb&#43;：以二进制读写方式打开一个文件，即可以读也可以写，读写都是二进制数据。w：以写入的方式打开一个文件。如果该文件已存在，则将其覆盖；否则创建文件（下面几个都是）。wb：以二进制写入方式打开一个文件。w&#43;：以读写方式打开一个文件。wb&#43;：以二进制读写格式打开一个文件。a：以追加方式打开一个文件。若文件已存在，文件指针会放在文件结尾；否则创建文件来写入。（下面几个都是）。ab：以二进制追加方式打开一个文件。a&#43;：以读写方式打开一个文件。ab&#43;：以二进制追加方式打开一个文件。 每回调用open方法后，要用close()方法关闭文件对象。
为了简化方法，采用with as语法。当with控制块语句结束时，文件会自动关闭，意味着不需要在调用close方法。
with open(&#39;movies.txt&#39;, &#39;w&#39;, encoding=&#39;utf-8&#39;) as file: file.write(f&#39;名称&#39;:{name}\n} file.write(f&#39;类别&#39;:{categories}\n} file.write(f&#39;上映事件&#39;:{published_at}\n} file.write(f&#39;评分&#39;:{score}\n} 2、JSON文件存储 在JSON对象中用’[]&#39;包围的内容相当于数组，数组中的每个元素都可以是任意类型，数据结构类型为[“java”,“javascript”,“vb”,…]。‘{}’包围的内容相当于对象，数据结构类型是{key1:value1,key2:value2,…}
JSON可以有对象和数组两种形式自由组合，能够嵌套无限次，并且结构清晰，是数据交换的极佳实现方式。
JSON库中的loads方法将JSON文本字符串转为JSON对象，反过来通过dumps方法将JSON对象转换为文本字符串。
loads
输入：
import json str = &#39;&#39;&#39;[{&#34;name&#34;:&#34;Bob&#34;},{&#34;name&#34;:&#34;Tom&#34;}]&#39;&#39;&#39; print(type(str)) data = json.loads(str) print(type(data)) print(data) print(data[1].get(&#39;name&#39;)) 输出：
&lt;class &#39;str&#39;&gt; &lt;class &#39;list&#39;&gt; [{&#39;name&#39;: &#39;Bob&#39;}, {&#39;name&#39;: &#39;Tom&#39;}] Tom 注意：JSON字符串的表示需要用双引号，否则loads方法会解析失败。同时还有load方法，与loads功能一致，只不过load接收的是文件操作对象，loads接收的是JSON字符串。
dumps
输入：
import json data = [{&#39;name&#39;:&#39;张三&#39;},{&#39;name&#39;:&#39;Tom&#39;}] with open(&#39;data." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/022471a77b3889561ab6004c9cee608e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-10-26T00:54:00+08:00" />
<meta property="article:modified_time" content="2022-10-26T00:54:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">爬虫基础-数据存储</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>注：本文章为学习过程中对知识点的记录，供自己复习使用，也给大家做个参考，如有错误，麻烦指出，大家共同探讨，互相进步。<br> 借鉴出处：<br> <a href="https://book.douban.com/subject/35681856/" rel="nofollow">该文章的路线和主要内容：崔庆才（第2版）python3网络爬虫开发实战</a></p> 
<hr> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><a href="#1Text_6" rel="nofollow">1、Text文本文件存储</a></li><li><a href="#2JSON_44" rel="nofollow">2、JSON文件存储</a></li><li><a href="#3CSV_92" rel="nofollow">3、CSV文件存储</a></li><li><a href="#4MySQL_210" rel="nofollow">4、MySQL存储</a></li><li><a href="#5MongoDB_279" rel="nofollow">5、MongoDB文档存储</a></li><li><a href="#6Redis_343" rel="nofollow">6、Redis缓存存储</a></li><li><a href="#7Elasticsearch_378" rel="nofollow">7、Elasticsearch搜索引擎存储</a></li><li><a href="#8RabbitMqmq_441" rel="nofollow">8、RabbitMq消息队列存储（后续再补，现在用不到，待开发中扩展到mq时，再学习此模块）</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="1Text_6"></a>1、Text文本文件存储</h3> 
<p><code>def open(file, mode='r', buffering=None, encoding=None, errors=None, newline=None, closefd=True)</code></p> 
<ul><li>file表示要保存或者打开的文件路径。</li><li>mode是一个可选字符串，指定文件的模式打开。</li><li>encoding指定文件的编码方式。</li><li>buffering用于设置缓冲策略的可选整数。传递0以关闭缓冲（仅在二进制模式下允许），传递1以选择行缓冲（仅在文本模式下可用），以及大于1的整数表示固定大小块缓冲区的大小。<br> 当没有缓冲参数时给定，默认缓冲策略的工作方式如下：二进制文件以固定大小的块缓冲；缓冲区的大小使用试探法选择，试图确定底层设备的“块大小”并返回<code>io.DEFAULT_BUFFER_size</code>。在许多系统上，缓冲区通常为4096或8192字节长。“交互式”文本文件（isatty（）返回True的文件）使用行缓冲。其他文本文件使用上述策略用于二进制文件。</li><li>errors是一个可选字符串，指定编码错误的方式此参数不应在二进制模式下使用。通过“strict”用于在存在编码错误时引发ValueError异常（默认值“无”具有相同的效果），或传递“忽略”以忽略错误。（请注意，忽略编码错误可能会导致数据丢失。）</li><li>newline换行符控制通用换行符的工作方式（它仅适用于文本模式）。它可以是None、“”、“\n”、“\r”和“\r\n”。</li><li>如果closefd为False，则底层文件描述符将保持打开状态当文件关闭时。当给定文件名时，此操作无效并且在这种情况下必须为True。</li></ul> 
<p><strong>但常用的三个参数就是file、mode、encoding了。</strong><br> mode的几种模式：</p> 
<ul><li>r：以只读方式打开一个文件，默认模式。</li><li>rb：以二进制方式打开一个文件，例如音频、图片、视频等。</li><li>r+：以读写方式打开一个文件，既可以读文件又可以写文件。</li><li>rb+：以二进制读写方式打开一个文件，即可以读也可以写，读写都是二进制数据。</li><li>w：以写入的方式打开一个文件。如果该文件已存在，则将其覆盖；否则创建文件（下面几个都是）。</li><li>wb：以二进制写入方式打开一个文件。</li><li>w+：以读写方式打开一个文件。</li><li>wb+：以二进制读写格式打开一个文件。</li><li>a：以追加方式打开一个文件。若文件已存在，文件指针会放在文件结尾；否则创建文件来写入。（下面几个都是）。</li><li>ab：以二进制追加方式打开一个文件。</li><li>a+：以读写方式打开一个文件。</li><li>ab+：以二进制追加方式打开一个文件。</li></ul> 
<p>每回调用open方法后，要用close()方法关闭文件对象。<br> 为了简化方法，采用with as语法。当with控制块语句结束时，文件会自动关闭，意味着不需要在调用close方法。</p> 
<pre><code class="prism language-python"><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'movies.txt'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>
	<span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'名称'</span></span><span class="token punctuation">:</span><span class="token punctuation">{<!-- --></span>name<span class="token punctuation">}</span>\n<span class="token punctuation">}</span>
	<span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'类别'</span></span><span class="token punctuation">:</span><span class="token punctuation">{<!-- --></span>categories<span class="token punctuation">}</span>\n<span class="token punctuation">}</span>
	<span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'上映事件'</span></span><span class="token punctuation">:</span><span class="token punctuation">{<!-- --></span>published_at<span class="token punctuation">}</span>\n<span class="token punctuation">}</span>
	<span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'评分'</span></span><span class="token punctuation">:</span><span class="token punctuation">{<!-- --></span>score<span class="token punctuation">}</span>\n<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="2JSON_44"></a>2、JSON文件存储</h3> 
<p>在JSON对象中用’[]'包围的内容相当于数组，数组中的每个元素都可以是任意类型，数据结构类型为[“java”,“javascript”,“vb”,…]。‘{}’包围的内容相当于对象，数据结构类型是{key1:value1,key2:value2,…}<br> JSON可以有对象和数组两种形式自由组合，能够嵌套无限次，并且结构清晰，是数据交换的极佳实现方式。<br> JSON库中的loads方法将JSON文本字符串转为JSON对象，反过来通过dumps方法将JSON对象转换为文本字符串。<br> <strong>loads</strong><br> 输入：</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> json
<span class="token builtin">str</span> <span class="token operator">=</span> <span class="token triple-quoted-string string">'''[{"name":"Bob"},{"name":"Tom"}]'''</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
data <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>输出：</p> 
<pre><code class="prism language-python"><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'str'</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'list'</span><span class="token operator">&gt;</span>
<span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Bob'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Tom'</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
Tom
</code></pre> 
<p>注意：JSON字符串的表示需要用双引号，否则loads方法会解析失败。同时还有load方法，与loads功能一致，只不过load接收的是<strong>文件操作对象</strong>，loads接收的是<strong>JSON字符串</strong>。<br> <strong>dumps</strong><br> 输入：</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> json
data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">'name'</span><span class="token punctuation">:</span><span class="token string">'张三'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{<!-- --></span><span class="token string">'name'</span><span class="token punctuation">:</span><span class="token string">'Tom'</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'data.json'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>	
	<span class="token comment"># indent缩进字符的个数;ensure_ascii=False表示不让中文转Unicode字符</span>
    <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>data<span class="token punctuation">,</span>indent<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>ensure_ascii<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>输出：</p> 
<pre><code class="prism language-python"><span class="token comment"># data.json</span>
<span class="token punctuation">[</span>
  <span class="token punctuation">{<!-- --></span>
    <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"张三"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{<!-- --></span>
    <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"Tom"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre> 
<p>注意：dumps同样有dump方法，与load使用方式一致。</p> 
<h3><a id="3CSV_92"></a>3、CSV文件存储</h3> 
<p>CSV比Excel文件更加简洁，XLS文本是电子表格，包含文本、数值、公式和格式等内容，CSV中不包含这些，就是以特定字符作为分隔符的纯文本，结构简单清晰。所以，有时候使用CSV来存储数据是比较方便的。<br> <strong>写入</strong><br> 输入：</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> csv
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'data.csv'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> csvFile<span class="token punctuation">:</span>
    <span class="token comment"># writer初始化csv写入对象;delimiter用于传列与列之间的分隔符</span>
    writer <span class="token operator">=</span> csv<span class="token punctuation">.</span>writer<span class="token punctuation">(</span>csvFile<span class="token punctuation">,</span> delimiter<span class="token operator">=</span><span class="token string">','</span><span class="token punctuation">)</span>
    writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token comment"># writerow写入单行数据</span>
    writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'10001'</span><span class="token punctuation">,</span><span class="token string">'Tom'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'10002'</span><span class="token punctuation">,</span><span class="token string">'Jack'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token comment"># writerows写入多行数据</span>
    writer<span class="token punctuation">.</span>writerows<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'10003'</span><span class="token punctuation">,</span><span class="token string">'Jerry'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'10004'</span><span class="token punctuation">,</span><span class="token string">'Bob'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p>输出：</p> 
<pre><code class="prism language-python"><span class="token comment"># data.csv</span>
<span class="token builtin">id</span><span class="token punctuation">,</span>name

<span class="token number">10001</span><span class="token punctuation">,</span>Tom

<span class="token number">10002</span><span class="token punctuation">,</span>Jack

<span class="token number">10003</span><span class="token punctuation">,</span>Jerry

<span class="token number">10004</span><span class="token punctuation">,</span>Bob
</code></pre> 
<p>但一般情况下，爬虫爬取的都是结构化的数据，我们一般会用字典表示这种数据。csv库提供了字典的写入方式，如下：<br> 输入：</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> csv
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'data.csv'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> csvFile<span class="token punctuation">:</span>
    fieldnames <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">]</span>
    <span class="token comment"># DictWriter初始化csv写入对象并定义好字段;delimiter用于传列与列之间的分隔符</span>
    writer <span class="token operator">=</span> csv<span class="token punctuation">.</span>DictWriter<span class="token punctuation">(</span>csvFile<span class="token punctuation">,</span> fieldnames<span class="token operator">=</span>fieldnames<span class="token punctuation">,</span> delimiter<span class="token operator">=</span><span class="token string">';'</span><span class="token punctuation">)</span>
    <span class="token comment"># writeheader方法写入fieldnames头信息</span>
    writer<span class="token punctuation">.</span>writeheader<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># writerow写入单行数据</span>
    writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'id'</span><span class="token punctuation">:</span><span class="token string">'10001'</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token punctuation">:</span><span class="token string">'Tom'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'id'</span><span class="token punctuation">:</span><span class="token string">'10002'</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token punctuation">:</span><span class="token string">'Jack'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment"># writerows写入多行数据</span>
    writer<span class="token punctuation">.</span>writerows<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">'id'</span><span class="token punctuation">:</span><span class="token string">'10003'</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token punctuation">:</span><span class="token string">'Jerry'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{<!-- --></span><span class="token string">'id'</span><span class="token punctuation">:</span><span class="token string">'10004'</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token punctuation">:</span><span class="token string">'Bob'</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p>输出：</p> 
<pre><code class="prism language-python"><span class="token comment"># data.csv</span>
<span class="token builtin">id</span><span class="token punctuation">;</span>name

<span class="token number">10001</span><span class="token punctuation">;</span>Tom

<span class="token number">10002</span><span class="token punctuation">;</span>Jack

<span class="token number">10003</span><span class="token punctuation">;</span>Jerry

<span class="token number">10004</span><span class="token punctuation">;</span>Bob
</code></pre> 
<p>同时，通过pandas库DataFrame对象的to_csv方法将数据写入CSV文件中。<br> 安装pandas库<code>pip install pandas</code><br> 输入：</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span><span class="token string">'id'</span><span class="token punctuation">:</span><span class="token string">'10001'</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token punctuation">:</span><span class="token string">'Tom'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{<!-- --></span><span class="token string">'id'</span><span class="token punctuation">:</span><span class="token string">'10002'</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token punctuation">:</span><span class="token string">'Jack'</span><span class="token punctuation">}</span>
<span class="token punctuation">]</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
df<span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span><span class="token string">'data.csv'</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
</code></pre> 
<p>输出：</p> 
<pre><code class="prism language-python"><span class="token comment"># data.csv</span>
<span class="token builtin">id</span><span class="token punctuation">,</span>name
<span class="token number">10001</span><span class="token punctuation">,</span>Tom
<span class="token number">10002</span><span class="token punctuation">,</span>Jack
</code></pre> 
<p><strong>读取</strong><br> 采用csv中的reader函数进行读取csv文件。<br> 输入：</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> csv
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'data.csv'</span><span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> csvFile<span class="token punctuation">:</span>
    reader <span class="token operator">=</span> csv<span class="token punctuation">.</span>reader<span class="token punctuation">(</span>csvFile<span class="token punctuation">)</span>
    <span class="token keyword">for</span> row <span class="token keyword">in</span> reader<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>row<span class="token punctuation">)</span>
</code></pre> 
<p>输出：</p> 
<pre><code class="prism language-python"><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token string">'10001'</span><span class="token punctuation">,</span> <span class="token string">'Tom'</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token string">'10002'</span><span class="token punctuation">,</span> <span class="token string">'Jack'</span><span class="token punctuation">]</span>
</code></pre> 
<p>也可以用read_csv方法将数据从CSV文件中读取出来。<br> 输入：</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'data.csv'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">)</span>
<span class="token comment"># 转换成列表或元组</span>
data <span class="token operator">=</span> df<span class="token punctuation">.</span>values<span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
</code></pre> 
<p>输出：</p> 
<pre><code class="prism language-python">      <span class="token builtin">id</span>  name
<span class="token number">0</span>  <span class="token number">10001</span>   Tom
<span class="token number">1</span>  <span class="token number">10002</span>  Jack
<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">10001</span><span class="token punctuation">,</span> <span class="token string">'Tom'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">10002</span><span class="token punctuation">,</span> <span class="token string">'Jack'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
</code></pre> 
<h3><a id="4MySQL_210"></a>4、MySQL存储</h3> 
<p>关系型数据库是基于关系模型的数据库，而关系模型是通过二维表来保存的，所以关系型数据库中数据的存储方式就是行列组成的表，每一列代表一个字段、每一行代表一条记录。表可以看作某个实体的集合，实体之间存在的联系需要通过表与表之间的关联关系体现，例如主键和外键的关联关系。由多个表组成的数据库，就是关系型数据库。<br> 关系型数据库有多种，例如SQLite、MySQL、Oracle、SQL Server、DB2等。<br> 安装连接库<code>pip install pymysql</code><br> 输入：</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> pymysql
<span class="token comment"># 与mysql建立连接，填写mysql的host,port,user,password</span>
db <span class="token operator">=</span> pymysql<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span>port<span class="token operator">=</span><span class="token number">3306</span><span class="token punctuation">,</span> user<span class="token operator">=</span><span class="token string">'root'</span><span class="token punctuation">,</span> password<span class="token operator">=</span><span class="token string">'password'</span><span class="token punctuation">)</span>
<span class="token comment"># 获取mysql的操作游标，利用游标执行sql语句</span>
cursor<span class="token operator">=</span> db<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>
sql1 <span class="token operator">=</span> <span class="token string">'CREATE DATABASE IF NOT EXISTS TestDataBase;'</span>
sql2 <span class="token operator">=</span> <span class="token string">'USE TestDataBase;'</span>
sql3 <span class="token operator">=</span> <span class="token string">'CREATE TABLE IF NOT EXISTS students (id VARCHAR(255) NOT NULL ,name VARCHAR(255) NOT NULL , primary key (id));'</span>
<span class="token comment"># execute执行语句</span>
cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql1<span class="token punctuation">)</span>
cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql2<span class="token punctuation">)</span>
cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql3<span class="token punctuation">)</span>
data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">'id'</span><span class="token punctuation">:</span><span class="token string">'100001'</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token punctuation">:</span><span class="token string">'Tom'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{<!-- --></span><span class="token string">'id'</span><span class="token punctuation">:</span><span class="token string">'100002'</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token punctuation">:</span><span class="token string">'Jerry'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{<!-- --></span><span class="token string">'id'</span><span class="token punctuation">:</span><span class="token string">'100003'</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token punctuation">:</span><span class="token string">'Jack'</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token comment"># 插入数据</span>
sql4 <span class="token operator">=</span> <span class="token string">'INSERT INTO students(id, name) values(%s ,%s)'</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql4<span class="token punctuation">,</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># 提交到数据库</span>
    db<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> EOFError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
    <span class="token comment"># 如果执行异常，用rollback回滚</span>
    db<span class="token punctuation">.</span>rollback<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 更新数据</span>
sql5 <span class="token operator">=</span> <span class="token string">'UPDATE students SET name=%s WHERE id=%s;'</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
    cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql5<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">'Bob'</span><span class="token punctuation">,</span><span class="token string">'100001'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    db<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> EOFError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
    db<span class="token punctuation">.</span>rollback<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 删除数据</span>
sql6 <span class="token operator">=</span> <span class="token string">'DELETE FROM students where name=%s;'</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
    cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql6<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">'Jerry'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    db<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> EOFError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
    db<span class="token punctuation">.</span>rollback<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 查询数据</span>
sql7 <span class="token operator">=</span> <span class="token string">'SELECT * FROM students;'</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
    cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql7<span class="token punctuation">)</span>
    <span class="token comment"># 如果先fetchone再fetchall，那fetchall就查询不到第一条数据了</span>
    <span class="token comment"># one = cursor.fetchone()</span>
    alls <span class="token operator">=</span> cursor<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> row <span class="token keyword">in</span> alls<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>row<span class="token punctuation">)</span>
<span class="token keyword">except</span> EOFError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
    db<span class="token punctuation">.</span>rollback<span class="token punctuation">(</span><span class="token punctuation">)</span>
db<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>其他知识点：<br> 事务的4个属性：</p> 
<table><thead><tr><th>属性</th><th>解释</th></tr></thead><tbody><tr><td>原子性</td><td>事务是一个不可分割的工作单位，一个事务要么全部提交成功，要么全部失败回滚，不能只执行其中的一部分操作</td></tr><tr><td>一致性</td><td>事务的执行不能破坏数据库数据的完整性和一致性，一个事务在执行之前和执行之后，数据库都必须处于一致性状态如果数据库系统在运行过程中发生故障，有些事务尚未完成就被迫中断，这些未完成的事务对数据库所作的修改有一部分已写入物理数据库，这是数据库就处于一种不正确的状态，也就是不一致的状态。</td></tr><tr><td>隔离性</td><td>一个事务的执行不能被其他事务干扰，即一个事务内部的操作及使用的数据对并发的其他事务是隔离的，并发执行的各个事务之间不能互相干扰</td></tr><tr><td>持久性</td><td>持续性也称持久性，指一个事务一旦提交，它对数据库中数据做的改变就应该是永久性的。接下来的其他操作或故障不应该对数据有任何影响。即使发生系统崩溃或机器宕机等故障，只要数据库能够重新启动，那么一定能够将其恢复到事务成功结束的状态。</td></tr></tbody></table> 
<h3><a id="5MongoDB_279"></a>5、MongoDB文档存储</h3> 
<ul><li>键值存储数据库：Redis、Voldmort、Oracle BDB等。</li><li>列存储数据库：Cassandra、HBase、Riak等。</li><li>文档型数据库：CouchDB、MongoDB等。</li><li>键值存储数据库：Redis、Voldmort、Oracle BDB等。</li><li>图形数据库：Neo4J、InfoGrid、Infinite Graph等。<br> MongoDB事由C++语言编写的非关系型数据库，是一个基于分布式文件存储的开源数据库系统，其内容的存储形式类似JSON对象。它的字段值可以包含其他文档、数组及文档数组，非常灵活。<br> 安装<code>pip install pymongo</code><br> 输入：</li></ul> 
<pre><code class="prism language-python"><span class="token keyword">import</span> pymongo
<span class="token triple-quoted-string string">'''建立连接'''</span>
client <span class="token operator">=</span> pymongo<span class="token punctuation">.</span>MongoClient<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'localhost'</span><span class="token punctuation">,</span>port<span class="token operator">=</span><span class="token number">27017</span><span class="token punctuation">)</span>
<span class="token comment"># 或者这种方式client = pymongo.MongoClient('mongodb://localhost:27017')</span>
<span class="token triple-quoted-string string">'''指定数据库'''</span>
db <span class="token operator">=</span> client<span class="token punctuation">.</span>test
<span class="token comment"># 或者这种方式db = client['test']</span>
<span class="token triple-quoted-string string">'''指定集合'''</span>
collection <span class="token operator">=</span> db<span class="token punctuation">.</span>students
<span class="token comment"># 或者这种方式collection = db['students']</span>
<span class="token triple-quoted-string string">'''插入数据'''</span>
student1 <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'id'</span><span class="token punctuation">:</span><span class="token string">'100001'</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token punctuation">:</span><span class="token string">'Tom'</span><span class="token punctuation">}</span>
result <span class="token operator">=</span> collection<span class="token punctuation">.</span>insert<span class="token punctuation">(</span>student1<span class="token punctuation">)</span>
<span class="token comment"># 每条数据都有一个_id属性作为唯一标识。如果没有显式指明该属性，那么MongoDB会自动产生一个Object类型的_id属性，insert方法会在执行后返回_id值。</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">'''插入多条数据'''</span>
student2 <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'id'</span><span class="token punctuation">:</span><span class="token string">'100002'</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token punctuation">:</span><span class="token string">'Jerry'</span><span class="token punctuation">}</span>
result <span class="token operator">=</span> collection<span class="token punctuation">.</span>insert<span class="token punctuation">(</span><span class="token punctuation">[</span>student1<span class="token punctuation">,</span>student2<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># PyMongo3.x版本中推荐使用insert_one和insert_many方法，继续使用insert也没问题。</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">'''查询'''</span>
result <span class="token operator">=</span> collection<span class="token punctuation">.</span>find_one<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'name'</span><span class="token punctuation">:</span><span class="token string">'Tom'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment"># find_one查询一条数据；find查询所有数据。返回的是一个字典类型。</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">'''计数'''</span>
count <span class="token operator">=</span> collection<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">'''排序'''</span>
<span class="token comment">#ASCENDING升序，DESCENDING降序</span>
results <span class="token operator">=</span> collection<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>sort<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> pymongo<span class="token punctuation">.</span>ASCENDING<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">[</span>result<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span> <span class="token keyword">for</span> result <span class="token keyword">in</span> results<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">'''偏移'''</span>
<span class="token comment"># skip(2)偏移2个位置即忽略前两个元素，获取第三个及以后的元素</span>
results <span class="token operator">=</span> collection<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>sort<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> pymongo<span class="token punctuation">.</span>ASCENDING<span class="token punctuation">)</span><span class="token punctuation">.</span>skip<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">[</span>result<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span> <span class="token keyword">for</span> result <span class="token keyword">in</span> results<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># limit(2)指定获取前两个</span>
<span class="token comment"># 数据库中数据量偏大时，最好不要使用大偏移来查询数据，可能导致内存溢出。</span>
results <span class="token operator">=</span> collection<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>sort<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> pymongo<span class="token punctuation">.</span>ASCENDING<span class="token punctuation">)</span><span class="token punctuation">.</span>skip<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>limit<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">[</span>result<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span> <span class="token keyword">for</span> result <span class="token keyword">in</span> results<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># 数据量偏大时，根据id查询,这里需要记录好上次查询的_id</span>
<span class="token keyword">from</span> bson<span class="token punctuation">.</span>objectid <span class="token keyword">import</span> ObjectId
collection<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'_id'</span><span class="token punctuation">:</span><span class="token punctuation">{<!-- --></span><span class="token string">'$gt'</span><span class="token punctuation">:</span>ObjectId<span class="token punctuation">(</span><span class="token string">'2738192731720a1902c38103d'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">'''更新'''</span>
student <span class="token operator">=</span> collection<span class="token punctuation">.</span>find_one<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'id'</span><span class="token punctuation">:</span><span class="token string">'100001'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
student<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'Bob'</span>
result <span class="token operator">=</span> collection<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'id'</span><span class="token punctuation">:</span><span class="token string">'100001'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>student<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">'''删除'''</span>
result <span class="token operator">=</span> collection<span class="token punctuation">.</span>remove<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'name'</span><span class="token punctuation">:</span><span class="token string">'Tom'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">'''还有find_one_and_delete\find_one_and_replace\find_one_and_update\create_index\create_indexes\drop_index等方法，实际使用时，再根据官方提供的api操作即可'''</span>
</code></pre> 
<p>还有一些常用操作符，如比较符号、正则匹配 $ regex、类型判断$type、文本查询 $ text等，用到时百度即可。</p> 
<h3><a id="6Redis_343"></a>6、Redis缓存存储</h3> 
<p>Redis是一个基于内存的、高效的键值型数据库，存取效率极高，而且支持多种数据存储结构，使用起来也非常简单。<br> 安装<code>pip install redis</code><br> 输入：</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> redis <span class="token keyword">import</span> StrictRedis
redis <span class="token operator">=</span> StrictRedis<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'localhost'</span><span class="token punctuation">,</span>port<span class="token operator">=</span><span class="token number">6379</span><span class="token punctuation">,</span> db<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> password<span class="token operator">=</span><span class="token string">'password'</span><span class="token punctuation">)</span>
    <span class="token comment">## 构建连接的其他方法</span>
    <span class="token comment"># 1、ConnectionPool连接方式</span>
    <span class="token comment"># from redis import StrictRedis,ConnectionPool</span>
    <span class="token comment"># pool = ConnectionPool(host='localhost',port=6379, db=0, password='password')</span>
    <span class="token comment"># redis = StrictRedis(connection_pool=pool)</span>
    <span class="token comment"># 2、通过URL连接</span>
    <span class="token comment"># url = 'redis://:redisredis@localhost:6379/0'</span>
    <span class="token comment"># pool = ConnectionPool.from_url(url)</span>
    <span class="token comment"># redis = StrictRedis(connection_pool=pool)</span>
redis<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span><span class="token string">'Bob'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>redis<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>输出：<br> b’Bob’<br> <strong>1、键的一些判断和操作方法</strong><br> <img src="https://images2.imgbox.com/10/87/EiC8uRVz_o.png" alt="在这里插入图片描述"><br> <strong>2、键值对存储的相关方法</strong><br> <img src="https://images2.imgbox.com/6e/2c/o47zBFsX_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/15/c1/skZs2AJz_o.png" alt="在这里插入图片描述"><br> <strong>3、列表操作</strong><br> <img src="https://images2.imgbox.com/95/ba/gAeOkhO9_o.png" alt="在这里插入图片描述"><br> <strong>4、集合操作</strong><br> <img src="https://images2.imgbox.com/70/83/in6wh5aB_o.png" alt="在这里插入图片描述"><br> <strong>5、有序集合操作</strong><br> <img src="https://images2.imgbox.com/50/fe/xQlzSyvH_o.png" alt="在这里插入图片描述"><br> <strong>6、散列操作</strong><br> <img src="https://images2.imgbox.com/97/b2/TFDjmKRj_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="7Elasticsearch_378"></a>7、Elasticsearch搜索引擎存储</h3> 
<p>Elasticsearch是一个开源的搜索引擎，建议在一个全文搜索引擎库Lucene的基础之上。（Lucene拥有最先进、高性能和全功能搜索引擎功能的库，但也仅仅只是一个库。）Elasticsearch也是使用Java编写的，其内部使用Lucene实现索引和搜索，但它的目标是使全文检索变得简单，相当于Lucene的一层封装，它提供了一套简单一致的RESTful Api来帮助我们实现存储和检索。<br> 特点：</p> 
<ul><li>一个分布式的实时文档存储库，每个字段都可以被索引和检索；</li><li>一个分布式的实时分析搜索引擎；</li><li>能胜任上百个服务节点的扩展，并支持PB级别的结构化或者非结构化数据。</li></ul> 
<p>介绍几个概念：</p> 
<ol><li>节点和集群<br> Elasticsearch 本质上是一个分布式数据库，允许多台服务器协同工作，每台服务器可以运行多个 Elasticsearch 实例。单个 Elasticsearch 实例称为一个节点（Node），一组节点构成一个集群（Cluster）</li><li>索引<br> 索引，即 Index，Elasticsearch 会索引所有字段，经过处理后写入一个反向索引（Inverted Index）。查找数据的时候，直接查找该索引。所以，Elasticsearch 数据管理的顶层单位就叫作索引，其实就相当于 MySQL、MongoDB 等中数据库的概念。</li><li>文档<br> 文档，即 Document。索引里面单条记录称为文档，许多条文档构成了一个索引。同一个索引里面的文档，不要求有相同的结构（Schema），但是最好保持一致，因为这样有利于提高搜索效率。</li><li>类型<br> 文档可以分组，比如 weather 这个索引里面，既可以按城市分组（北京和上海），也可以按气候分组（晴天和雨天）。这种分组就叫作类型（Type），它是虚拟的逻辑分组，用来过滤文档，类似 MySQL 中的数据表、MongoDB 中的 Collection。<br> 不同的类型应该有相似的结构。举例来说，id 字段不能在这个组中是字符串，在另一个组中是数值。这是与关系型数据库的表的一个区别。性质完全不同的数据（比如 products 和 logs）应该存成两个索引，而不是一个索引里面的两个类型（虽然可以做到）。<br> 根据规划，Elastic 6.x 版只允许每个索引包含一个类型，Elastic 7.x 开始将会将其彻底移除。</li><li>字段<br> 每个文档都类似一个 JSON 结构，它包含了许多字段，每个字段都有其对应的值，多个字段组成了一个文档，其实就可以类比 MySQL 数据表中的字段。</li></ol> 
<p>安装<code>pip install elasticsearch</code></p> 
<p>输入：</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> elasticsearch <span class="token keyword">import</span> Elasticsearch
<span class="token triple-quoted-string string">'''建立连接'''</span>
es <span class="token operator">=</span> Elasticsearch<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'http://[username:password@]hostname:port'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> verify_certs<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">'''创建索引'''</span>
<span class="token comment"># 合理利用ignore可以避免没必要的错误</span>
result <span class="token operator">=</span> es<span class="token punctuation">.</span>indices<span class="token punctuation">.</span>create<span class="token punctuation">(</span>index<span class="token operator">=</span><span class="token string">'news'</span><span class="token punctuation">,</span> ignore<span class="token operator">=</span><span class="token number">400</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">'''删除索引'''</span>
result <span class="token operator">=</span> es<span class="token punctuation">.</span>indices<span class="token punctuation">.</span>delete<span class="token punctuation">(</span>index<span class="token operator">=</span><span class="token string">'news'</span><span class="token punctuation">,</span> ignore<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">400</span><span class="token punctuation">,</span><span class="token number">404</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">'''插入数据'''</span>
data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'title'</span><span class="token punctuation">:</span><span class="token string">'乘风破浪会有时，直挂云帆济沧海'</span><span class="token punctuation">,</span><span class="token string">'url'</span><span class="token punctuation">:</span><span class="token string">'http://view.inew.com/asd098092sa8d90890890'</span><span class="token punctuation">}</span>
<span class="token comment">#create需要指定id; es.index(index='news', body=data) --- index不需要指定id，会自动生成。</span>
result <span class="token operator">=</span> es<span class="token punctuation">.</span>create<span class="token punctuation">(</span>index<span class="token operator">=</span><span class="token string">'news'</span><span class="token punctuation">,</span> <span class="token builtin">id</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> body<span class="token operator">=</span>data<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">'''更新数据'''</span>
data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'title'</span><span class="token punctuation">:</span><span class="token string">'乘风破浪会有时，直挂云帆济沧海'</span><span class="token punctuation">,</span><span class="token string">'url'</span><span class="token punctuation">:</span><span class="token string">'http://view.inew.com/asd098092sa8d90890890'</span><span class="token punctuation">,</span><span class="token string">'date'</span><span class="token punctuation">:</span><span class="token string">'2022-10-23'</span><span class="token punctuation">}</span>
<span class="token comment">#es.index(index='news',doc_type='politics',body=data, id=1)</span>
result <span class="token operator">=</span> es<span class="token punctuation">.</span>update<span class="token punctuation">(</span>index<span class="token operator">=</span><span class="token string">'news'</span><span class="token punctuation">,</span> body<span class="token operator">=</span>data<span class="token punctuation">,</span> <span class="token builtin">id</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">'''删除数据'''</span>
result <span class="token operator">=</span> es<span class="token punctuation">.</span>delete<span class="token punctuation">(</span>index<span class="token operator">=</span><span class="token string">'news'</span><span class="token punctuation">,</span> <span class="token builtin">id</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">'''查询数据'''</span>
<span class="token comment"># 根据索引查询该索引下的所有数据</span>
result <span class="token operator">=</span> es<span class="token punctuation">.</span>search<span class="token punctuation">(</span>index<span class="token operator">=</span><span class="token string">'news'</span><span class="token punctuation">)</span>
dsl <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'query'</span><span class="token punctuation">:</span><span class="token punctuation">{<!-- --></span>
        <span class="token string">'match'</span><span class="token punctuation">:</span><span class="token punctuation">{<!-- --></span>
            <span class="token string">'title'</span><span class="token punctuation">:</span><span class="token string">'hello'</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment"># 全文检索符合的字段</span>
result <span class="token operator">=</span> es<span class="token punctuation">.</span>search<span class="token punctuation">(</span>index<span class="token operator">=</span><span class="token string">'news'</span><span class="token punctuation">,</span> body<span class="token operator">=</span>dsl<span class="token punctuation">)</span>
</code></pre> 
<h3><a id="8RabbitMqmq_441"></a>8、RabbitMq消息队列存储（后续再补，现在用不到，待开发中扩展到mq时，再学习此模块）</h3> 
<p>在爬取过程中，可能需要一些进程间的通信机制：</p> 
<ul><li>一个进程负责构造爬取请求，另一个进程负责执行爬取请求。</li><li>某个数据爬取进程执行完毕，通知另外一个负责数据处理的进程开始处理数据。</li><li>某个进程新建了一个爬取任务，通知另外一个负责数据爬取的进程开始爬取数据。</li></ul> 
<p>为了降低这些进程的耦合度，需要一个类似消息队列的中间件来存储和转发消息，实现进程间的通信。有了消息队列中间件之后，以上各机制中的两个进程就可以独立执行，它们之间的通信则由消息队列实现。</p> 
<ul><li>一个进程根据需要爬取的任务，构造请求对象并放入消息队列，另一个进程从队列中取出请求对象并执行爬取。</li><li>某个数据爬取进程执行完毕，就像消息队列发送消息，当另一个负责数据处理的进程监听到这类消息时，就开始处理数据。</li><li>某个进程新建了一个爬取任务后，就向消息队列发送消息，当另一个负责数据爬取的进程监听到这类消息时吗，就开始爬取数据。</li></ul> 
<p>RabbitMQ介绍<br> RabbitMQ是使用Erlang语言开发的开源消息队列系统，基于AMQP协议实现，其主要特点有面向消息、队列、路由（包括点对点和发布/订阅）、可靠性、安全性。具有以下特点：</p> 
<ul><li>可靠性：RabbitMQ通过一些机制保证可靠性，如持久化、传输确认、发布确认。</li><li>灵活的路由：有Exchange将消息路由至消息队列。RabbitMQ已经提供了一些内置的Exchange来实现典型的路由功能；对于较复杂的路由功能，则将多个Exchange绑定在一起，或者通过插件机制实现自己的Exchange。</li><li>消息集群：多个RabbitMQ服务器可以组成一个集群，形成一个逻辑Broker。</li><li>高可用：消息队列可以在集群中的机器上镜像存储，使得队列在部分节点出问题的情况下仍然可用。</li><li>多种协议支持：RabbitMQ支持多种消息队列协议，如STOMP、MQTT。</li><li>多语言客户端：RabbitMQ几乎支持所有常用语言。</li><li>管理界面：RabbitMQ提供了一个易用的用户界面，使得用户可以监听和监管消息Broker的多个方面。</li><li>跟踪机制：RabbitMQ提供了消息跟踪机制，如果消息异常，使用者就可以找出发生了什么。</li><li>插件机制：RabbitMQ提供了许多插件，实现了多方面的扩展，用户也可以编写自己的插件。<br> 安装<code>pip install pika</code></li></ul> 
<p>基本了解：<br> 从本质上讲是一个生产者-消费者模型。</p> 
<ul><li>生命队列：通过指定一些参数，创建消息队列。</li><li>生产内容：生产者根据队列的连接信息连接队列，往队列中放入消息。</li><li>消费内容：消费者根据队列的连接信息连接队列，从队列中取出消息。</li></ul> 
<pre><code class="prism language-python"><span class="token triple-quoted-string string">'''声明一个队列'''</span>
<span class="token keyword">import</span> pika
QUEUE_NAME <span class="token operator">=</span> <span class="token string">'scrape'</span>
connection <span class="token operator">=</span> pika<span class="token punctuation">.</span>BlockingConnection<span class="token punctuation">(</span>pika<span class="token punctuation">.</span>ConnectionParameters<span class="token punctuation">(</span><span class="token string">'localhost'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
channel <span class="token operator">=</span> connection<span class="token punctuation">.</span>channel<span class="token punctuation">(</span><span class="token punctuation">)</span>
channel<span class="token punctuation">.</span>queue_declare<span class="token punctuation">(</span>queue<span class="token operator">=</span>QUEUE_NAME<span class="token punctuation">)</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b060e935a8f68a933745c80d0361d5d2/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">爬虫基础-Ajax爬取实战</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e30c693d43a2b215f278bc5bce9911b0/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">zabbix图像监控图像监控数标以及文字不显示问题</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>