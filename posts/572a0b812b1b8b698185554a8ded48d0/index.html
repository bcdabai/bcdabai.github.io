<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Linux时钟配置 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Linux时钟配置" />
<meta property="og:description" content="Linux系统时间不对可以通过以下三种方法修复 1、将硬件时间同步到系统时间
2、修改系统的时区
3、配置NTP客户端
系统时钟VS硬件时钟 在Linux中有硬件时钟与系统时钟等两种时钟。硬件时钟是指主机板上的时钟设备，也就是通常可在BIOS画面设定的时钟。系统时钟则是指kernel中的时钟。当Linux启动时，系统时钟会去读取硬件时钟的设定，之后系统时钟即独立运作。所有Linux相关指令与函数都是读取系统时钟的设定。
date 查看系统时间
date -s 设置系统时间
hwclock查看硬件时间
hwclock -w 将硬件时间同步到系统时间
Linux系统时钟不对一般为时区设置有误 Centos7查询时区方法
[zyq@zyq ~]$ timedatectl Local time: Tue 2023-01-17 13:56:36 CST Universal time: Tue 2023-01-17 05:56:36 UTC RTC time: Tue 2023-01-17 05:56:36 Time zone: Asia/Shanghai (CST, &#43;0800) NTP enabled: yes NTP synchronized: yes RTC in local TZ: no DST active: n/a Centos6查询方法
cat /etc/sysconfig/clock
如果时区不是Asia/Shanghai,通过修改时区即可修复
时区如果没有问题可通过配置时钟客户端修复
常用的时钟服务器 cn.pool.ntp.org、asia.pool.ntp.org、pool.ntp.org、hk.pool.ntp.org
配置客户端 [zyq@zyq tmp]$ grep server /etc/ntp.conf # Use public servers from the pool." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/572a0b812b1b8b698185554a8ded48d0/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-04-10T18:18:36+08:00" />
<meta property="article:modified_time" content="2023-04-10T18:18:36+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Linux时钟配置</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div class="kdocs-document"> 
 <h3 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">Linux系统时间不对可以通过以下三种方法修复</span></h3> 
 <p style="text-align:null;">1、将硬件时间同步到系统时间</p> 
 <p style="text-align:null;">2、修改系统的时区</p> 
 <p style="text-align:null;">3、配置NTP客户端</p> 
 <h3 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">系统时钟VS硬件时钟</span></h3> 
 <p style="text-align:null;">在Linux中有硬件时钟与系统时钟等两种时钟。硬件时钟是指主机板上的时钟设备，也就是通常可在BIOS画面设定的时钟。系统时钟则是指kernel中的时钟。当Linux启动时，系统时钟会去读取硬件时钟的设定，之后系统时钟即独立运作。所有Linux相关指令与函数都是读取系统时钟的设定。</p> 
 <p style="text-align:null;"> </p> 
 <p style="text-align:null;">date 查看系统时间</p> 
 <p style="text-align:null;">date -s 设置系统时间</p> 
 <p style="text-align:null;">hwclock查看硬件时间</p> 
 <p style="text-align:null;">hwclock -w 将硬件时间同步到系统时间</p> 
 <h3 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">Linux系统时钟不对一般为时区设置有误</span></h3> 
 <p style="text-align:null;"><span class="kdocs-bold" style="font-weight:bold;">Centos7查询时区方法</span></p> 
 <pre class="kdocs-bash"><code class="language-bash">[zyq@zyq ~]$ timedatectl 
      Local time: Tue 2023-01-17 13:56:36 CST
  Universal time: Tue 2023-01-17 05:56:36 UTC
        RTC time: Tue 2023-01-17 05:56:36
       Time zone: Asia/Shanghai (CST, +0800)
     NTP enabled: yes
NTP synchronized: yes
 RTC in local TZ: no
      DST active: n/a
</code></pre> 
 <p style="text-align:null;"><span class="kdocs-bold" style="font-weight:bold;">Centos6查询方法</span></p> 
 <p style="text-align:null;">cat /etc/sysconfig/clock</p> 
 <p style="text-align:null;">如果时区不是Asia/Shanghai,通过修改时区即可修复</p> 
 <p style="text-align:null;">时区如果没有问题可通过配置时钟客户端修复</p> 
 <p style="text-align:null;"></p> 
 <h3 style="text-align:null;">常用的时钟服务器</h3> 
 <p style="text-align:null;"><a class="kdocs-link" style="color:#0A6CFF;" href="https://cn.pool.ntp.org" rel="nofollow noopener noreferrer" target="_blank">cn.pool.ntp.org</a>、<a class="kdocs-link" style="color:#0A6CFF;" href="https://asia.pool.ntp.org" rel="nofollow noopener noreferrer" target="_blank">asia.pool.ntp.org</a>、<a class="kdocs-link" style="color:#0A6CFF;" href="https://pool.ntp.org" rel="nofollow noopener noreferrer" target="_blank">pool.ntp.org</a>、<a class="kdocs-link" style="color:#0A6CFF;" href="https://hk.pool.ntp.org" rel="nofollow noopener noreferrer" target="_blank">hk.pool.ntp.org</a></p> 
 <p style="text-align:null;"></p> 
 <h3 style="text-align:null;">配置客户端</h3> 
 <pre class="kdocs-bash"><code class="language-bash">[zyq@zyq tmp]$ grep server  /etc/ntp.conf 
# Use public servers from the pool.ntp.org project.
server 0.rhel.pool.ntp.org iburst
server 1.rhel.pool.ntp.org iburst
server 2.rhel.pool.ntp.org iburst
server 3.rhel.pool.ntp.org iburst
#broadcast 192.168.1.255 autokey    # broadcast server
#broadcast 224.0.1.1 autokey        # multicast server
#manycastserver 239.255.254.254        # manycast server
</code></pre> 
 <p style="">以上是系统自带的服务器地址，如果要指定添加“serve 域名” 即可；没有ntp客户端sudo yum install ntpd即可</p> 
 <p style=""></p> 
 <h3 style="">启动客户端</h3> 
 <pre class="kdocs-bash"><code class="language-bash">[zyq@zyq ~]$ sudo systemctl restart ntpd
</code></pre> 
 <h3 style="text-align:null;">检查与上层NTP服务器是否时钟同步成功</h3> 
 <pre class="kdocs-bash"><code class="language-bash">[zyq@zyq ~]$ ntpq -p
     remote           refid      st t when poll reach   delay   offset  jitter
==============================================================================
 time.cloudflare 10.208.8.4       3 u   34   64    1  218.271  -14.928  20.049
*trabant.uid0.hu 84.2.44.19       3 u   33   64    1  245.959  -20.544  37.502
 139.199.215.251 100.122.36.196   2 u   34   64    1   46.197    8.340  10.811
[zyq@zyq ~]$ 
</code></pre> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p>remote：表示NTP服务器的IP地址或者主机名；</p></li></ul> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p>refid：表示NTP服务器所参考的时间源，通常为另一个NTP服务器或者外部时钟源；</p></li></ul> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p>st：表示NTP服务器的层级，层级数越小表示离主时钟源越近；</p></li></ul> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p>t：表示NTP服务器所使用的时钟类型，通常为u表示UDP时钟；</p></li></ul> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p>when：表示NTP客户端最后一次与该NTP服务器进行时间同步的时间，以秒为单位；</p></li></ul> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p>poll：表示NTP客户端与该NTP服务器之间的时间同步间隔，以2的幂次方秒为单位；</p></li></ul> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p>reach：表示NTP客户端最近8次向该NTP服务器发送时间同步请求的状态，1表示成功，0表示失败；</p></li></ul> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p>delay：表示NTP客户端与该NTP服务器之间的网络延迟，以毫秒为单位；</p></li></ul> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p>offset：表示NTP客户端与该NTP服务器之间的时间误差，以毫秒为单位；</p></li></ul> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p>jitter：表示NTP客户端与该NTP服务器之间时间误差的方差，以毫秒为单位。</p></li></ul> 
 <p style="">在这个输出中，星号（*）表示当前系统正在使用的NTP服务器，也就是主NTP服务器。可以看到，当前NTP客户端与NTP服务器之间的时间误差（offset）为-20.544毫秒，网络延迟（delay）为245.959毫秒，时间同步的状态较为稳定。</p> 
 <p style=""></p> 
 <p style="">ntp客户端与服务端都使用udp 123端口进行通信，默认11分钟会进行一次udp连接的建立。</p> 
 <p style=""></p> 
 <p style="text-align:null;"><span class="kdocs-bold" style="font-weight:bold;">注意：此ntpq工具需安装后使用yum -y install ntp</span></p> 
 <p style="text-align:null;">首次进行NTP时钟同步需要一定时间，请等待几分钟再进行检查。</p> 
 <p style="text-align:null;"></p> 
 <p style="text-align:null;"><span class="kdocs-bold" style="font-weight:bold;">注意：</span>chronyd进程会与ntp进程冲突，确保系统没有此进程</p> 
 <p style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">systemctl stop chronyd</span></p> 
 <p style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">systemctl disable chronyd</span></p> 
 <p style="text-align:null;"></p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/07603c07bbd1bae9bf0712a660aa769f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Git使用教程：从入门到精通（以Gitee为例）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/063e84d6af4cdc543bad921fe8b88ba6/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">vue3 对元素拖拽、缩放</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>