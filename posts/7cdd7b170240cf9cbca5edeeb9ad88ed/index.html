<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>springboot2实现图片文件上传与mysql存储路径并回显 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="springboot2实现图片文件上传与mysql存储路径并回显" />
<meta property="og:description" content="环境介绍
技术栈
springboot&#43;mybatis&#43;mysql
软件
版本
mysql
8
IDEA
IntelliJ IDEA 2022.2.1
JDK
1.8
Spring Boot
2.7.13
mybatis
2.3.1
springboot是基于spring 4.0，springboot2是基于spring5.0,springboot2由pivotal公司在2018发布,这个框架主要用来简化ssm开发，核心思想“约定大于配置”。
上传图片，数据库存储图片路径，但前端页面无法显示图片的问题有
1、windos与linux的路径不同
2、mysql存储路径的长度不够
前端界面
&lt;form id=&#34;form-changeAvatar&#34;
class=&#34;form-horizontal&#34; role=&#34;form&#34;&gt;
&lt;div class=&#34;form-group&#34;&gt;
&lt;label class=&#34;col-md-2 control-label&#34;&gt;选择图片:&lt;/label&gt;
&lt;div class=&#34;col-md-5&#34;&gt;
&lt;img id=&#34;img-avatar&#34; src=&#34;../images/index/user.jpg&#34; class=&#34;img-responsive&#34; /&gt;
&lt;/div&gt;
&lt;div class=&#34;clearfix&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;col-md-offset-2 col-md-4&#34;&gt;
&lt;input type=&#34;file&#34; name=&#34;file&#34;&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;form-group&#34;&gt;
&lt;div class=&#34;col-sm-offset-2 col-sm-10&#34;&gt;
&lt;input id=&#34;btn-changeAvatar&#34; type=&#34;button&#34; class=&#34;btn btn-primary&#34; value=&#34;上传&#34; /&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/form&gt;
前端ajax
&lt;script type=&#34;text/javascript&#34;&gt; $(document)." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/7cdd7b170240cf9cbca5edeeb9ad88ed/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-08-22T23:18:07+08:00" />
<meta property="article:modified_time" content="2023-08-22T23:18:07+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">springboot2实现图片文件上传与mysql存储路径并回显</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="text-align:center;">环境介绍</p> 
<table border="0" style="width:277px;"><tbody><tr><td> <p>技术栈</p> </td><td> <p>springboot+mybatis+mysql</p> </td></tr><tr><td> <p>软件</p> </td><td> <p>版本</p> </td></tr><tr><td> <p>mysql</p> </td><td> <p>8</p> </td></tr><tr><td> <p>IDEA</p> </td><td> <p>IntelliJ IDEA 2022.2.1</p> </td></tr><tr><td> <p>JDK</p> </td><td> <p>1.8</p> </td></tr><tr><td> <p>Spring Boot</p> </td><td> <p>2.7.13</p> </td></tr><tr><td> <p>mybatis</p> </td><td> <p>2.3.1</p> </td></tr></tbody></table> 
<p>springboot是基于spring 4.0，springboot2是基于spring5.0,springboot2由pivotal公司在2018发布,这个框架主要用来简化ssm开发，核心思想“约定大于配置”。</p> 
<p></p> 
<p>上传图片，数据库存储图片路径，但前端页面无法显示图片的问题有</p> 
<p>1、windos与linux的路径不同</p> 
<p>2、mysql存储路径的长度不够</p> 
<p></p> 
<p></p> 
<p>前端界面</p> 
<p><img alt="" height="419" src="https://images2.imgbox.com/7a/7f/h0Z6TJe2_o.png" width="768"></p> 
<p> &lt;form id="form-changeAvatar"<br>      class="form-horizontal" role="form"&gt;<br>    &lt;div class="form-group"&gt;<br>       &lt;label class="col-md-2 control-label"&gt;选择图片:&lt;/label&gt;<br>       &lt;div class="col-md-5"&gt;<br>          &lt;img id="img-avatar" src="../images/index/user.jpg" class="img-responsive" /&gt;<br>       &lt;/div&gt;<br>       &lt;div class="clearfix"&gt;&lt;/div&gt;<br>       &lt;div class="col-md-offset-2 col-md-4"&gt;<br>          &lt;input type="file" name="file"&gt;<br>       &lt;/div&gt;<br>    &lt;/div&gt;<br>    &lt;div class="form-group"&gt;<br>       &lt;div class="col-sm-offset-2 col-sm-10"&gt;<br>          &lt;input id="btn-changeAvatar" type="button" class="btn btn-primary" value="上传" /&gt;<br>       &lt;/div&gt;<br>    &lt;/div&gt;<br> &lt;/form&gt;</p> 
<p></p> 
<p>前端ajax</p> 
<pre><code>&lt;script type="text/javascript"&gt;
   
   $(document).ready(function (){
      let avatar = $.cookie("avatar");
      console.log(avatar);
      $("#img-avatar").attr("src",avatar);
   });

   //监听注册按钮
   $("#btn-changeAvatar").click(function () {
      //发送ajax()的异步请求来完成用户的登入功能
      $.ajax({
         url: "/boot/users/changeAvatar",
         type: "POST",
         data: new FormData($("#form-changeAvatar")[0]),
         processData: false,//处理数据的形式，关闭处理数据
         contentType: false,    //提交数据的形式，关闭处理的形式
         dataType: "JSON",
         success: function (json){
            if (json.state == 200){
               alert("头像修改成功");
               //将服务器端返回的头像地址设置img标签上的path地址
               //attr(属性，属性值)：给某个属性设置某个值
               $("#img-avatar").attr("src",json.data)
               
               location.href ="../web/upload.html";
            }else {
               alert("头像修改失败，请重新再试!");
            }
         },
         error: function (xhr){
            alert("头像修改产生未知的错误!"+xhr.message);
         }
      });
   });
&lt;/script&gt;</code></pre> 
<p>或者</p> 
<p>$(document).ready(function () {<!-- --><br>                 //发送ajax()的异步请求来完成用户的登入功能<br>                 $.ajax({<!-- --><br>                     url: "/WMS/products/getImageAvatar",<br>                     type: "get",<br>                     dataType: "JSON",<br>                     success: function (json){<!-- --><br>                             alert("头像修改成功");<br>                         $("#img-avatar").attr("src",json.avatar);<br>                     },<br>                     error: function (xhr){<!-- --><br>                         alert("图片修改产生未知的错误!"+xhr.message);<br>                     }<br>                 });<br>             });</p> 
<p></p> 
<p>controller控制层</p> 
<pre><code>@RequestMapping("/changeAvatar")
public JsonResult&lt;String&gt; changeAvatar(HttpSession session,
                                       @RequestParam("file") MultipartFile file){
    //判断文件是否为空
    if(file.isEmpty()){
        throw new FileEmptyException("文件为空");
    }

    //文件大小判断
    if (file.getSize() &gt; AVATAR_MAX_SIZE){
        throw new FileSizeException("文件超出限制");
    }
    //判断文件类型
    String fileType = file.getContentType();
    if (!AVATAR_TYPE.contains(fileType)){
        throw new FileTypeException("文件类型不支持");
    }

    //获取绝对路径
    String parent = new File("static/images/wms").getAbsolutePath();

    File dir = new File(parent);
    if (!dir.exists()){
        dir.mkdirs();//创建当前的目录
    }

    //获取文件名称,UUID工具生成新的字符串作为文件名
    String originalFilename = file.getOriginalFilename();
    System.out.println("originalFilename原始文件路径:"+originalFilename);

    int index = originalFilename.lastIndexOf(".");
    String suffix = originalFilename.substring(index);
    String newFileName = UUID.randomUUID().toString().toUpperCase()+suffix;

    File dest = new File(dir,newFileName);//空文件

    try {
        //将参数file文件中的数据写入到dest文件中
        file.transferTo(dest);
    } catch (IOException e) {
        throw new FileIOException("文件写入异常");
    }

    Integer uid = getUidFromSession(session);
    String uname =getUserNameFromSession(session);

    String avatar = "../images/wms/"+newFileName;

    userModuleService.updateAvatar(uid,avatar,uname);

    //返回路径给前端页面,用于展示头像使用
    return new JsonResult&lt;&gt;(ok,avatar);
}</code></pre> 
<p></p> 
<p></p> 
<p class="img-center"><img alt="" height="337" id="images_16908113278615" src="https://images2.imgbox.com/8c/d7/mySJrf32_o.png" width="407"></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/28f96d673adb88b532ecfb86c7b13a90/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">DCFW DHCP</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/af3e2a56919f103edd5139dda2c5877f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【并发编程】经典线程不安全问题（多线程操作同一个资源容易产生相互覆盖）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>