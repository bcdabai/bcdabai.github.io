<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Mysql自动备份--dump - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Mysql自动备份--dump" />
<meta property="og:description" content="mysql自动备份成sql格式，脚本如下：
#/usr/local/crontab/dumpbackup
# use like this : dumpbackup db1 db2 db3 ...
#! /bin/bash
dbsum=$#
if [ &#34;${dbsum}&#34; -eq 0 ];then
echo &#34;Error:no database chosed&#34;
exit 1
fi
mkdir -p /opt/hotbackup/innodb/
backdir=/opt/hotbackup/innodb/
touch /var/log/pixplayerbackup.log
datetime=`date &#43;&#34;%Y%m%d%H%M&#34;`
filesum=`ls ${backdir} | wc -l`
if [ &#34;${filesum}&#34; -ge 5 ];then
cd ${backdir}
rm -rf `ls | head -1`
fi
cd /usr/local/mysql/bin
for i in $*;do
echo &#34;backing up for database $i starting ." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/d1a3fdf6f277751a8d3f2ce6bca821f8/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-12-09T16:35:56+08:00" />
<meta property="article:modified_time" content="2022-12-09T16:35:56+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Mysql自动备份--dump</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>mysql自动备份成sql格式，脚本如下：</p> 
<p></p> 
<p>#/usr/local/crontab/dumpbackup</p> 
<p># use like this : dumpbackup db1 db2 db3 ...<br> #! /bin/bash</p> 
<p><br> dbsum=$#<br> if [ "${dbsum}" -eq 0 ];then<br> echo "Error:no database chosed"<br> exit 1<br> fi<br> mkdir -p /opt/hotbackup/innodb/<br> backdir=/opt/hotbackup/innodb/<br> touch  /var/log/pixplayerbackup.log<br> datetime=`date +"%Y%m%d%H%M"`</p> 
<p>filesum=`ls  ${backdir} | wc -l`<br> if [ "${filesum}" -ge 5 ];then<br> cd ${backdir}<br> rm -rf `ls | head -1`<br> fi<br> cd /usr/local/mysql/bin</p> 
<p>for i in $*;do<br> echo "backing up for database $i starting ..."<br> /usr/local/mysql/bin/mysqldump -uroot -p123456 --master-data=2 --flush-logs --opt --default-character-set=utf8 $i &gt; ${backdir}$i.sql<br> echo "backing up for database $i completed"<br> done<br> echo "tar and gzip the backed file now ..."<br> cd ${backdir}<br> tar -c *.sql | gzip &gt;./${datetime}.tar.gz<br> rm -rf *.sql<br> echo "all success ! you  can find the backed file in ${backdir} suffixed by .tar.gz"<br> exit 0</p> 
<p></p> 
<p>脚本说明，保留最近5天的备份，将数据库备份成sql格式，这种备份能保证数据备份的完整性及正确性。<br><br> 备注：<br> mysqldump命令说明：<br> --databases (--all-databases)<br> 这个选项是备份所有的数据库。<br><br> --add-drop-table<br> 这个选项将会在每一个表的前面加上DROP TABLE IF EXISTS语句，这样可以保证IMPORT您的MySQL数据库的时候不会出错，因为每次导回的时候，都会首先检查表是否存在，存在就删除。<br><br> --add-locks<br> 这个选项会在INSERT语句中捆上一个LOCK TABLE和UNLOCK TABLE语句。这就防止在这些记录被再次导入数据库时其他用户对表进行的操作.此时，mysqldump命令给每一个产生INSERT语句加上列（field）的名字。当把数据导出导另外一个数据库时这个选项很有用。<br><br> -F or -flush-logs<br> 在执行导出之前将会刷新MySQL服务器的log。<br><br> -f or -force<br> 即使有错误发生，仍然继续导出。<br><br> -l or --lock-tables<br> 导出表的时候服务器将会给表加锁。（同上：--add-locks）<br><br> --opt<br> 此选项将打开所有会提高文件导出速度和创造一个可以更快导入的文件的选项。<br> 如果没有使用--opt，MYSQLDUMP就会把整个结果集装载到内存中，然后导出。如果数据非常大就会导致导出失败。这个开关在默认情况下是启用的，如果不想启用它：--skip-opt来关闭它。）<br><br> -R<br> 如果要导出存储过程，加 -R开关即可。<br><br> --master-data<br> 该选项可以会将当前mysql使用的binlog日志的名称和位置记录到dump中，方便进行在线搭建从服务器，也可以在某些恢复的过程中通过备份的binlog做进一步的恢复操作。<br> 如果--master-data=2，以注释的形式存在<br> 如果--master-data=1，不已注释的形式存在<br><br> --no-data<br> 紧紧dump数据库结构创建脚本</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/45c1414f8de769b12f7fd06b463dbec4/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">实现无入侵式C&#43;&#43;代码mock工具</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e87efdeb871818b1091e6cc17c50412b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">python java lambda表达式自定义排序</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>