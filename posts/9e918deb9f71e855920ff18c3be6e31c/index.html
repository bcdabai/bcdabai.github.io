<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>è¯¦è§£SpringCloudå¾®æœåŠ¡æŠ€æœ¯æ ˆï¼šFeignè¿œç¨‹è°ƒç”¨ã€æœ€ä½³å®è·µã€é”™è¯¯æ’æŸ¥ - ç¼–ç¨‹å¤§ç™½çš„åšå®¢</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="è¯¦è§£SpringCloudå¾®æœåŠ¡æŠ€æœ¯æ ˆï¼šFeignè¿œç¨‹è°ƒç”¨ã€æœ€ä½³å®è·µã€é”™è¯¯æ’æŸ¥" />
<meta property="og:description" content="ğŸ‘¨â€ğŸ“ä½œè€…ç®€ä»‹ï¼šä¸€ä½å¤§å››ã€ç ”0å­¦ç”Ÿï¼Œæ­£åœ¨åŠªåŠ›å‡†å¤‡å¤§å››æš‘å‡çš„å®ä¹ 
ğŸŒŒä¸ŠæœŸæ–‡ç« ï¼šè¯¦è§£SpringCloudå¾®æœåŠ¡æŠ€æœ¯æ ˆï¼šNacosé…ç½®ç®¡ç†
ğŸ“šè®¢é˜…ä¸“æ ï¼šå¾®æœåŠ¡æŠ€æœ¯å…¨å®¶æ¡¶
å¸Œæœ›æ–‡ç« å¯¹ä½ ä»¬æœ‰æ‰€å¸®åŠ©
ä¹‹å‰ä½¿ç”¨RestTemplateæ¥å®ç°è¿œç¨‹è°ƒç”¨ï¼Œè¿™ç§æ–¹å¼å­˜åœ¨äº†ä¸€äº›é—®é¢˜ï¼Œæ›´ä¼˜çš„è§£å†³æ–¹å¼æ˜¯ä½¿ç”¨Feignæ¥å®ç°è¿œç¨‹è°ƒç”¨ã€‚
è¿™é‡Œå°†ä¼šè®²è§£å¦‚ä½•ç”¨Feignå®ç°è¿œç¨‹è°ƒç”¨ï¼Œå¹¶è¿›è¡Œæœ€ä½³å®è·µã€‚
Feignçš„è¿œç¨‹è°ƒç”¨ä¸æœ€ä½³å®è·µ åŸºäºFeignå®ç°è¿œç¨‹è°ƒç”¨è‡ªå®šä¹‰é…ç½®æ€§èƒ½ä¼˜åŒ–Feignæœ€ä½³å®è·µåˆ†æå®ç° åŸºäºFeignå®ç°è¿œç¨‹è°ƒç”¨ RestTemplateçš„é—®é¢˜ï¼š
1ã€ä»£ç å¯è¯»æ€§å·®ï¼Œå˜æˆä½“éªŒä¸ç»Ÿä¸€
2ã€å‚æ•°æ¯”è¾ƒå¤æ‚çš„urlï¼Œéš¾ä»¥ç»´æŠ¤
Feignæ˜¯ä¸€ä¸ªå£°æ˜å¼çš„httpå®¢æˆ·ç«¯ï¼Œå®˜æ–¹åœ°å€ï¼šFeignå®˜ç½‘
å£°æ˜å¼åœ¨Springä¸­å¼€å§‹æåˆ°ï¼Œæ˜¯åˆ©ç”¨é…ç½®æ–‡ä»¶æ¥åŠ äº‹åŠ¡ã€‚è€Œå£°æ˜å¼httpå®¢æˆ·ç«¯ä¹Ÿæ˜¯ç±»ä¼¼ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠå‘httpè¯·æ±‚æ‰€éœ€è¦çš„ä¿¡æ¯å£°æ˜å‡ºæ¥å³å¯ï¼Œå‰©ä¸‹çš„ä¸œè¥¿éƒ½äº¤ç»™Feignæ¥å®ç°ã€‚
ä½¿ç”¨Feignçš„æ­¥éª¤ï¼š
1ã€å¼•å…¥ä¾èµ–ï¼š
&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt; &lt;/dependency&gt; 2ã€åœ¨order-serviceçš„å¯åŠ¨ç±»æ·»åŠ å¼€å¯Feignçš„åŠŸèƒ½ï¼šåŠ æ³¨è§£@EnableFeignClients
3ã€åšå£°æ˜ï¼ˆç¼–å†™Feignå®¢æˆ·ç«¯ï¼‰ï¼š
@FeignClient(&#34;userservice&#34;) //å£°æ˜å‡ºæœåŠ¡åç§° public interface UserClient { @GetMapping(&#34;/user/{id}&#34;) User findById(@PathVariable(&#34;id&#34;) Long id); } ä¸»è¦æ˜¯åŸºäºSpringMVCçš„æ³¨è§£æ¥å£°æ˜è¿œç¨‹è°ƒç”¨çš„ä¿¡æ¯ï¼Œå¦‚æœåŠ¡åç§°ã€ è¯·æ±‚æ–¹å¼ã€è¯·æ±‚è·¯å¾„ã€è¯·æ±‚å‚æ•°ã€è¿”å›å€¼ç±»å‹ç­‰ï¼Œç›´æ¥å£°æ˜è¿™äº›ä¿¡æ¯å°±è¡Œã€‚
è¿™æ ·çš„æ–¹å¼ä¼šç®€å•å¾ˆå¤šï¼Œæ³¨è§£å¼€å‘å¤ªæ–¹ä¾¿äº†ï¼ŒèŠ‚çº¦äº†å¾ˆå¤šå­¦ä¹ æˆæœ¬ï¼Œå³ä¾¿urlçš„å‚æ•°å¾ˆå¤æ‚ï¼Œæˆ‘ä»¬åˆ©ç”¨æ³¨è§£å¼€å‘å†™å‚æ•°åˆ—è¡¨ä¹Ÿæ˜¯å¾ˆæ–¹ä¾¿çš„ã€‚
ç°åœ¨æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ä¸ªå®¢æˆ·ç«¯äº†ï¼Œç›´æ¥ä¿®æ”¹orderæŸ¥è¯¢çš„æ¥å£ï¼š
@Resource private OrderMapper orderMapper; @Resource private UserClient userClient; public Order queryOrderById(Long orderId){ //æŸ¥è¯¢è®¢å• Order order = orderMapper.findById(orderId); //æ ¹æ®ç”¨æˆ·idæ¥æŸ¥è¯¢ç”¨æˆ·ï¼Œç”¨Feignå®ç°è¿œç¨‹è°ƒç”¨ User user = userClient.findById(order.getUserId()); //å°†ç”¨æˆ·æ³¨å…¥åˆ°orderä¸­ order.setUser(user); // 4.è¿”å› return order; } åŒæ—¶å¤šæ¬¡åˆ·æ–°ç½‘å€ï¼Œå¯ä»¥éªŒè¯å‡ºFeignè¿˜é›†æˆäº†Ribbonè´Ÿè½½å‡è¡¡ï¼Œæ˜¯æ¯”è¾ƒå¼ºå¤§çš„ã€‚
æ€»ç»“Feignä½¿ç”¨æ­¥éª¤ï¼š" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/9e918deb9f71e855920ff18c3be6e31c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-17T11:00:52+08:00" />
<meta property="article:modified_time" content="2024-01-17T11:00:52+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="ç¼–ç¨‹å¤§ç™½çš„åšå®¢" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">ç¼–ç¨‹å¤§ç™½çš„åšå®¢</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">è¯¦è§£SpringCloudå¾®æœåŠ¡æŠ€æœ¯æ ˆï¼šFeignè¿œç¨‹è°ƒç”¨ã€æœ€ä½³å®è·µã€é”™è¯¯æ’æŸ¥</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <p>ğŸ‘¨â€ğŸ“ä½œè€…ç®€ä»‹ï¼šä¸€ä½å¤§å››ã€ç ”0å­¦ç”Ÿï¼Œæ­£åœ¨åŠªåŠ›å‡†å¤‡å¤§å››æš‘å‡çš„å®ä¹ <br> ğŸŒŒä¸ŠæœŸæ–‡ç« ï¼š<a href="https://blog.csdn.net/m0_52380556/article/details/135604828?spm=1001.2014.3001.5502">è¯¦è§£SpringCloudå¾®æœåŠ¡æŠ€æœ¯æ ˆï¼šNacosé…ç½®ç®¡ç†</a><br> ğŸ“šè®¢é˜…ä¸“æ ï¼š<a href="https://blog.csdn.net/m0_52380556/category_12554499.html?spm=1001.2014.3001.5482">å¾®æœåŠ¡æŠ€æœ¯å…¨å®¶æ¡¶</a><br> å¸Œæœ›æ–‡ç« å¯¹ä½ ä»¬æœ‰æ‰€å¸®åŠ©</p> 
</blockquote> 
<p>ä¹‹å‰ä½¿ç”¨RestTemplateæ¥å®ç°è¿œç¨‹è°ƒç”¨ï¼Œè¿™ç§æ–¹å¼å­˜åœ¨äº†ä¸€äº›é—®é¢˜ï¼Œæ›´ä¼˜çš„è§£å†³æ–¹å¼æ˜¯ä½¿ç”¨Feignæ¥å®ç°è¿œç¨‹è°ƒç”¨ã€‚<br> è¿™é‡Œå°†ä¼šè®²è§£å¦‚ä½•ç”¨Feignå®ç°è¿œç¨‹è°ƒç”¨ï¼Œå¹¶è¿›è¡Œæœ€ä½³å®è·µã€‚</p> 
<p></p> 
<div class="toc"> 
 <h4>Feignçš„è¿œç¨‹è°ƒç”¨ä¸æœ€ä½³å®è·µ</h4> 
 <ul><li><a href="#Feign_9" rel="nofollow">åŸºäºFeignå®ç°è¿œç¨‹è°ƒç”¨</a></li><li><a href="#_68" rel="nofollow">è‡ªå®šä¹‰é…ç½®</a></li><li><a href="#_120" rel="nofollow">æ€§èƒ½ä¼˜åŒ–</a></li><li><a href="#Feign_155" rel="nofollow">Feignæœ€ä½³å®è·µ</a></li><li><ul><li><a href="#_156" rel="nofollow">åˆ†æ</a></li><li><a href="#_181" rel="nofollow">å®ç°</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="Feign_9"></a>åŸºäºFeignå®ç°è¿œç¨‹è°ƒç”¨</h2> 
<p>RestTemplateçš„é—®é¢˜ï¼š</p> 
<blockquote> 
 <p>1ã€ä»£ç å¯è¯»æ€§å·®ï¼Œå˜æˆä½“éªŒä¸ç»Ÿä¸€<br> 2ã€å‚æ•°æ¯”è¾ƒå¤æ‚çš„urlï¼Œéš¾ä»¥ç»´æŠ¤</p> 
</blockquote> 
<p>Feignæ˜¯ä¸€ä¸ªå£°æ˜å¼çš„httpå®¢æˆ·ç«¯ï¼Œå®˜æ–¹åœ°å€ï¼š<a href="https://github.com/OpenFeign/feign">Feignå®˜ç½‘</a><br> å£°æ˜å¼åœ¨Springä¸­å¼€å§‹æåˆ°ï¼Œæ˜¯åˆ©ç”¨é…ç½®æ–‡ä»¶æ¥åŠ äº‹åŠ¡ã€‚è€Œå£°æ˜å¼httpå®¢æˆ·ç«¯ä¹Ÿæ˜¯ç±»ä¼¼ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠå‘httpè¯·æ±‚æ‰€éœ€è¦çš„ä¿¡æ¯å£°æ˜å‡ºæ¥å³å¯ï¼Œå‰©ä¸‹çš„ä¸œè¥¿éƒ½äº¤ç»™Feignæ¥å®ç°ã€‚</p> 
<p>ä½¿ç”¨Feignçš„æ­¥éª¤ï¼š<br> 1ã€å¼•å…¥ä¾èµ–ï¼š</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-openfeign<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>2ã€åœ¨order-serviceçš„å¯åŠ¨ç±»æ·»åŠ å¼€å¯Feignçš„åŠŸèƒ½ï¼šåŠ æ³¨è§£@EnableFeignClients<br> 3ã€åšå£°æ˜ï¼ˆç¼–å†™Feignå®¢æˆ·ç«¯ï¼‰ï¼š</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span><span class="token string">"userservice"</span><span class="token punctuation">)</span> <span class="token comment">//å£°æ˜å‡ºæœåŠ¡åç§°</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserClient</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/user/{id}"</span><span class="token punctuation">)</span>
    <span class="token class-name">User</span> <span class="token function">findById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>ä¸»è¦æ˜¯åŸºäºSpringMVCçš„æ³¨è§£æ¥å£°æ˜è¿œç¨‹è°ƒç”¨çš„ä¿¡æ¯ï¼Œå¦‚æœåŠ¡åç§°ã€ è¯·æ±‚æ–¹å¼ã€è¯·æ±‚è·¯å¾„ã€è¯·æ±‚å‚æ•°ã€è¿”å›å€¼ç±»å‹ç­‰ï¼Œç›´æ¥å£°æ˜è¿™äº›ä¿¡æ¯å°±è¡Œã€‚<br> è¿™æ ·çš„æ–¹å¼ä¼šç®€å•å¾ˆå¤šï¼Œæ³¨è§£å¼€å‘å¤ªæ–¹ä¾¿äº†ï¼ŒèŠ‚çº¦äº†å¾ˆå¤šå­¦ä¹ æˆæœ¬ï¼Œå³ä¾¿urlçš„å‚æ•°å¾ˆå¤æ‚ï¼Œæˆ‘ä»¬åˆ©ç”¨æ³¨è§£å¼€å‘å†™å‚æ•°åˆ—è¡¨ä¹Ÿæ˜¯å¾ˆæ–¹ä¾¿çš„ã€‚</p> 
<p>ç°åœ¨æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ä¸ªå®¢æˆ·ç«¯äº†ï¼Œç›´æ¥ä¿®æ”¹orderæŸ¥è¯¢çš„æ¥å£ï¼š</p> 
<pre><code class="prism language-java">    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">OrderMapper</span> orderMapper<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">UserClient</span> userClient<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Order</span> <span class="token function">queryOrderById</span><span class="token punctuation">(</span><span class="token class-name">Long</span> orderId<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">//æŸ¥è¯¢è®¢å•</span>
        <span class="token class-name">Order</span> order <span class="token operator">=</span> orderMapper<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>orderId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æ ¹æ®ç”¨æˆ·idæ¥æŸ¥è¯¢ç”¨æˆ·ï¼Œç”¨Feignå®ç°è¿œç¨‹è°ƒç”¨</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> userClient<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>order<span class="token punctuation">.</span><span class="token function">getUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//å°†ç”¨æˆ·æ³¨å…¥åˆ°orderä¸­</span>
        order<span class="token punctuation">.</span><span class="token function">setUser</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 4.è¿”å›</span>
        <span class="token keyword">return</span> order<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>åŒæ—¶å¤šæ¬¡åˆ·æ–°ç½‘å€ï¼Œå¯ä»¥éªŒè¯å‡ºFeignè¿˜é›†æˆäº†Ribbonè´Ÿè½½å‡è¡¡ï¼Œæ˜¯æ¯”è¾ƒå¼ºå¤§çš„ã€‚</p> 
<p>æ€»ç»“Feignä½¿ç”¨æ­¥éª¤ï¼š</p> 
<blockquote> 
 <p>å¼•å…¥ä¾èµ–<br> æ·»åŠ @EnableFeignClientsæ³¨è§£<br> ç¼–å†™FeignClientæ¥å£<br> ä½¿ç”¨FeignClientä¸­å®šä¹‰çš„æ–¹æ³•æ¥ä»£æ›¿RestTemplate</p> 
</blockquote> 
<h2><a id="_68"></a>è‡ªå®šä¹‰é…ç½®</h2> 
<p>Feignå¯ä»¥è®©æˆ‘ä»¬è‡ªå®šä¹‰é…ç½®æ¥è¦†ç›–é»˜è®¤é…ç½®ï¼Œä¸€èˆ¬éœ€è¦é…ç½®çš„æ˜¯æ—¥å¿—çº§åˆ«çš„ç±»å‹feign.Logger.Levelã€‚<br> é…ç½®Feignæ—¥å¿—æœ‰2ç§æ–¹å¼ã€‚</p> 
<p><strong>æ–¹å¼ä¸€ï¼šé…ç½®æ–‡ä»¶</strong><br> 1ã€å…¨å±€ç”Ÿæ•ˆ</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">feign</span><span class="token punctuation">:</span>
  <span class="token key atrule">client</span><span class="token punctuation">:</span>
    <span class="token key atrule">config</span><span class="token punctuation">:</span>
      <span class="token key atrule">default</span><span class="token punctuation">:</span>
        <span class="token key atrule">loggerLevel</span><span class="token punctuation">:</span> FULL <span class="token comment"># æœ€é«˜çº§åˆ«ï¼Œæ—¥å¿—ä¸­ä¼šåŒ…å«å‘èµ·çš„è¯·æ±‚ï¼Œä»¥åŠè¿œç¨‹è°ƒç”¨ç­‰ä¿¡æ¯</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/43/2e/9piGnAZa_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>2ã€å±€éƒ¨ç”Ÿæ•ˆ</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">feign</span><span class="token punctuation">:</span>
  <span class="token key atrule">client</span><span class="token punctuation">:</span>
    <span class="token key atrule">config</span><span class="token punctuation">:</span>
      <span class="token key atrule">userservice</span><span class="token punctuation">:</span>
        <span class="token key atrule">loggerLevel</span><span class="token punctuation">:</span> FULL
</code></pre> 
<p><strong>æ–¹å¼äºŒï¼šJavaä»£ç </strong><br> å…ˆå£°æ˜ä¸€ä¸ªBeanï¼š</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DefaultFeignConfiguration</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Logger<span class="token punctuation">.</span>Level</span> <span class="token class-name">LogLevel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token class-name">Logger<span class="token punctuation">.</span>Level</span><span class="token punctuation">.</span><span class="token constant">BASIC</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>æƒ³è¦è¿™ä¸ªç±»ç”Ÿæ•ˆï¼Œéœ€è¦é…ç½®ã€‚<br> 1ã€å…¨å±€é…ç½®ï¼šæŠŠå®ƒæ”¾åˆ°@EnableFeignClientsè¿™ä¸ªæ³¨è§£ä¸­ï¼š</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@EnableFeignClients</span><span class="token punctuation">(</span>defaultConfiguration <span class="token operator">=</span> <span class="token class-name">DefaultFeignConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
</code></pre> 
<p>2ã€å±€éƒ¨é…ç½®ï¼šæŠŠå®ƒæ”¾åˆ°@FeignClientè¿™ä¸ªæ³¨è§£ä¸­ï¼š</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"userservice"</span><span class="token punctuation">,</span> configuration <span class="token operator">=</span> <span class="token class-name">DefaultFeignConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
</code></pre> 
<p>é‡å¯order-serviceï¼Œè®¿é—®ç½‘å€åæŸ¥çœ‹æ§åˆ¶å°çš„æ—¥å¿—ï¼Œé™¤äº†SQLè¯­å¥ä¹‹å¤–ï¼Œè¿˜æœ‰å…³äºFeignçš„æ—¥å¿—ä¿¡æ¯ï¼ˆåªæœ‰è¯·æ±‚è¡Œå’Œç›¸åº”è¡Œï¼‰</p> 
<h2><a id="_120"></a>æ€§èƒ½ä¼˜åŒ–</h2> 
<p>Feignå…¶å®æ€§èƒ½ä¸€ç›´å¾ˆä¸é”™äº†ï¼Œä½†æ˜¯è¿˜æ˜¯å¯ä»¥è¢«ä¼˜åŒ–ï¼ŒFeignåº•å±‚çš„å®¢æˆ·ç«¯å®ç°ï¼š</p> 
<blockquote> 
 <p>URLConnectionï¼šé»˜è®¤å®ç°ï¼Œä¸æ”¯æŒè¿æ¥æ± <br> Apache HttpClientï¼šæ”¯æŒè¿æ¥æ± <br> OKHttpï¼šæ”¯æŒè¿æ¥æ± </p> 
</blockquote> 
<p>Feignåº•å±‚è¿˜æ˜¯ä¼šç”¨åˆ°å…¶ä»–çš„å®¢æˆ·ç«¯ï¼Œé»˜è®¤ä½¿ç”¨URLConnectionï¼Œä½†æ˜¯å®ƒä¸æ”¯æŒè¿æ¥æ± ï¼Œè¿™å°±ä¼šä½¿å¾—æ€§èƒ½ä¸æ˜¯å¤ªå¥½ã€‚å› æ­¤æ›´æ¨èä½¿ç”¨å…¶ä»–ä¸¤ç§ã€‚</p> 
<p>Feignçš„æ€§èƒ½ä¼˜åŒ–ä¸»è¦åŒ…æ‹¬ï¼š</p> 
<blockquote> 
 <p>ä½¿ç”¨è¿æ¥æ± ä»£æ›¿é»˜è®¤çš„URLConnection<br> æ—¥å¿—çº§åˆ«ï¼Œæœ€å¥½ç”¨BASICæˆ–NONEï¼Œæ—¥å¿—çº§åˆ«å¤ªé«˜ä¹Ÿä¼šé€ æˆä¸€äº›æ€§èƒ½æŸè€—</p> 
</blockquote> 
<p>å°†URLConnectionæ¢æˆApache HttpClientï¼š<br> 1ã€å¼•å…¥ä¾èµ–ï¼š</p> 
<pre><code class="prism language-xml">	<span class="token comment">&lt;!--å¼•å…¥HttpClientä¾èµ–--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.github.openfeign<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>feign-httpclient<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>2ã€é…ç½®è¿æ¥æ± ï¼š</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">feign</span><span class="token punctuation">:</span>
  <span class="token key atrule">httpclient</span><span class="token punctuation">:</span>
    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># æ”¯æŒHttpClientçš„å¼€å…³</span>
    <span class="token key atrule">max-connections</span><span class="token punctuation">:</span> <span class="token number">200</span> <span class="token comment"># æœ€å¤§è¿æ¥æ•°</span>
    <span class="token key atrule">max-connections-per-route</span><span class="token punctuation">:</span> <span class="token number">50</span> <span class="token comment"># å•ä¸ªè·¯å¾„çš„æœ€å¤§è¿æ¥æ•°</span>
</code></pre> 
<p>å…¶ä¸­ï¼Œæœ€å¤§è¿æ¥æ•°å’Œå•ä¸ªè·¯å¾„æœ€å¤§è¿æ¥æ•°å¹¶ä¸èƒ½é‚£ä¹ˆå®¹æ˜“ç¡®å®šï¼Œå…·ä½“çš„è¿æ¥æ•°éœ€è¦æ ¹æ®ä¸šåŠ¡çš„æƒ…å†µï¼Œå¯¹äºä¸åŒçš„ä¸šåŠ¡ï¼Œå¯ä»¥ç”¨jmeterè¿›è¡Œå‹åŠ›æµ‹è¯•ã€‚</p> 
<h2><a id="Feign_155"></a>Feignæœ€ä½³å®è·µ</h2> 
<h3><a id="_156"></a>åˆ†æ</h3> 
<p>æ–¹å¼ä¸€ï¼šç»§æ‰¿</p> 
<blockquote> 
 <p>ç»™æ¶ˆè´¹è€…çš„FeignClientå’Œæä¾›è€…çš„controllerå®šä¹‰ç»Ÿä¸€çš„çˆ¶æ¥å£ä½œä¸ºæ ‡å‡†</p> 
</blockquote> 
<p>ä¹ä¸€çœ‹è¿˜æ˜¯æœ‰ç‚¹æŠ½è±¡çš„ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥æ‰“å¼€ä¸€ä¸‹order-serviceçš„UserClientæ¥å£ä¸user-serviceçš„UserControllerï¼š<br> <img src="https://images2.imgbox.com/c4/e9/Q8j3zX7M_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br> <img src="https://images2.imgbox.com/ff/3c/LHrRTgnl_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br> è¿™ä¸¤ä¸ªçš„å‡½æ•°å…¶å®æ˜¯å·®ä¸å¤šçš„ï¼Œå› ä¸ºæ¶ˆè´¹è€…è¦é€šè¿‡Feignè§£æç½‘å€è¯·æ±‚ï¼Œå°±éœ€è¦å¸¦ä¸Šç›¸åº”çš„ä¿¡æ¯ï¼ˆè¯·æ±‚æ–¹å¼ã€ç½‘å€ã€å‚æ•°ç­‰ï¼‰ï¼Œè€Œæä¾›è€…åˆ™éœ€è¦æä¾›æ­£ç¡®çš„æ–¹å¼ç»™æ¶ˆè´¹è€…ï¼Œå› æ­¤ä¿¡æ¯ä¸Šä¸¤è€…åŸºæœ¬ä¸Šéƒ½æ˜¯å·®ä¸å¤šçš„ã€‚<br> æ‰€ä»¥ç†è®ºä¸Šå¯ä»¥å®šä¹‰ä¸€ä¸ªç»Ÿä¸€çš„çˆ¶æ¥å£æ¥ä½œä¸ºæ ‡å‡†ã€‚</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserAPI</span><span class="token punctuation">{<!-- --></span>
	<span class="token annotation punctuation">@GetMapping</span>
	<span class="token class-name">User</span> <span class="token function">findById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>è€Œæ¶ˆè´¹è€…å’Œæä¾›è€…åªéœ€è¦åˆ†åˆ«ç»§æ‰¿å’Œå®ç°è¿™ä¸ªæ¥å£å°±å¯ä»¥äº†ã€‚<br> ä½†æ˜¯è¿™ç§æ–¹å¼æœ‰ä¸€å®šçš„é—®é¢˜ï¼ŒSpringå®˜æ–¹ä¹Ÿä¸æ¨èè®©å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯å…±ç”¨ä¸€ä¸ªæ¥å£ï¼Œå› ä¸ºè¿™æ ·çš„è€¦åˆåº¦å¤ªé«˜äº†ã€‚</p> 
<p>æ–¹å¼äºŒï¼šæŠ½å–</p> 
<blockquote> 
 <p>å°†FeignClientæŠ½å–ä¸ºç‹¬ç«‹æ¨¡å—ï¼Œå¹¶ä¸”æŠŠæ¥å£æœ‰å…³çš„pojoã€é»˜è®¤çš„Feignéƒ½æ”¾åˆ°è¿™ä¸ªæ¨¡å—ä¸­ï¼Œæä¾›ç»™æ‰€æœ‰æ¶ˆè´¹è€…ä½¿ç”¨ã€‚</p> 
</blockquote> 
<p>è§£æä¸€ä¸‹ï¼Œåœ¨ä¹‹å‰çš„ä»£ç ä¸­ï¼Œorder-serviceçš„UserClientä¼šå»è°ƒç”¨user-serviceä¸­çš„UserControllerï¼Œä½†æ˜¯å¦‚æœè¿˜æœ‰å¾ˆå¤šæ¨¡å—çš„UserClientéƒ½è¦è°ƒç”¨ï¼Œå¯èƒ½å°±ä¼šæœ‰å¾ˆå¤šåœ°æ–¹é‡å¤å†™äº†ï¼Œå› æ­¤å¯ä»¥ä¸“é—¨å®šä¹‰ä¸€ä¸ªfeign-apiï¼Œåœ¨é‡Œé¢å£°æ˜UserClientï¼Œå¹¶ä¸”æ¶‰åŠåˆ°çš„å®ä½“ç±»ã€é»˜è®¤é…ç½®éƒ½åœ¨feign-apiä¸­å®ç°ã€‚è€Œorder-serviceè¦ä½¿ç”¨çš„æ—¶å€™ï¼Œåªéœ€è¦å¼•å…¥feign-apiçš„ä¾èµ–å°±å¯ä»¥äº†ã€‚</p> 
<h3><a id="_181"></a>å®ç°</h3> 
<p>è¿™é‡Œå°†ä¼šå®ç°æ–¹å¼äºŒï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š<br> 1ã€æ–°å»ºmoduleï¼Œå‘½åä¸ºfeign-apiï¼Œç„¶åå¼•å…¥feignçš„starterä¾èµ–</p> 
<pre><code class="prism language-xml">	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-openfeign<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>2ã€å°†order-serviceä¸­ç¼–å†™çš„UserClientã€Userã€DefaultFeignConfigurationéƒ½å¤åˆ¶åˆ°feign-apié¡¹ç›®ä¸­<br> <img src="https://images2.imgbox.com/78/d7/7myBpGzH_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br> ä¸Šé¢æ‹¥æœ‰çš„éƒ¨åˆ†ï¼Œåœ¨order-serviceé‡Œé¢éƒ½å¯ä»¥ç›´æ¥åˆ é™¤äº†ï¼Œä»¥åéœ€è¦ç›´æ¥å»ç”¨feign-apié‡Œé¢çš„ä¸œè¥¿å°±å¯ä»¥äº†ã€‚</p> 
<p>3ã€åœ¨order-serviceä¸­å¼•å…¥feign-apiçš„ä¾èµ–</p> 
<pre><code class="prism language-xml">	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token comment">&lt;!--groupIdæ˜¯ä½ åˆ›å»ºapiçš„è¿™ä¸ªmoduleæ—¶å€™çš„ç›¸å…³åŒ…--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.wang<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>feign-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>4ã€ä¿®æ”¹order-serviceä¸­çš„æ‰€æœ‰ä¸ä¸Šè¿°ç»„ä»¶æœ‰å…³çš„importéƒ¨åˆ†ï¼Œæ”¹æˆå¯¼å…¥feign-apiçš„åŒ…</p> 
<p>5ã€é‡å¯æµ‹è¯•</p> 
<p>è¿è¡Œåå‘ç°ä¼šæŠ¥é”™ï¼ŒæŸ¥çœ‹æŠ¥é”™ä¿¡æ¯ï¼š<br> <img src="https://images2.imgbox.com/17/f6/o8ITG2K7_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br> æ²¡æœ‰æ‰¾åˆ°UserClientçš„å¯¹è±¡ï¼Œä½†æ˜¯ç¼–è¯‘æ²¡æœ‰æŠ¥é”™ï¼Œåªæ˜¯è¿è¡ŒæŠ¥é”™äº†ï¼ŒæŸ¥çœ‹OrderServiceï¼š<br> <img src="https://images2.imgbox.com/43/e0/FQwEE52U_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br> å¯ä»¥æƒ³åˆ°ï¼ŒSpringæ²¡æœ‰è·å¾—è¿™ä¸ªå®¹å™¨çš„å¯¹è±¡ï¼Œè¿™ç§æƒ…å†µçš„å‘ç”Ÿæ˜¯å› ä¸ºæ‰«æåŒ…å‡ºç°äº†é—®é¢˜ï¼Œåªæ˜¯å› ä¸ºå¯åŠ¨ç±»æŒ‡å®šçš„Mapperæ˜¯åœ¨cn.itcast.orderä¸‹é¢çš„ï¼Œç„¶è€ŒUserClientæ˜¯åœ¨cn.itcast.feignä¸‹é¢çš„ã€‚<br> <img src="https://images2.imgbox.com/b4/c7/k5azCOXY_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br> ç®€å•ç²—æš´çš„è§£å†³æ–¹å¼æ˜¯ç›´æ¥æŠŠMapperScanæ‰«æèŒƒå›´æ‰©å¤§ï¼Œä½†æ˜¯è¿™è‚¯å®šæ˜¯ä¸åˆé€‚çš„ï¼Œå¯åŠ¨ç±»åº”è¯¥é»˜è®¤æ‰«æçš„èŒƒå›´å°±æ˜¯æ‰€åœ¨çš„åŒ…ä¸‹é¢çš„ï¼Œåº”è¯¥æƒ³æƒ³åˆ«çš„åŠæ³•ã€‚</p> 
<p>æ–¹å¼ä¸€ï¼šæŒ‡å®šFeignClientæ‰€åœ¨åŒ…ï¼ˆå…¨ç›˜æ‹¿æ¥ï¼‰</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@EnableFeignClients</span><span class="token punctuation">(</span>basePackages <span class="token operator">=</span> <span class="token string">"cn.itcast.feign.clients"</span><span class="token punctuation">,</span> defaultConfiguration <span class="token operator">=</span> <span class="token class-name">DefaultFeignConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
</code></pre> 
<p>æ–¹å¼äºŒï¼šæŒ‡å®šFeignClientå­—èŠ‚ç ï¼ˆç²¾å‡†å®šä½ï¼Œæ¨èæ–¹æ¡ˆï¼‰</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@EnableFeignClients</span><span class="token punctuation">(</span>clients <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token class-name">UserClient</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">,</span> defaultConfiguration <span class="token operator">=</span> <span class="token class-name">DefaultFeignConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/8e9fa852fc18184bb302ac306414831f/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">å®é›†å¹²è´§ä¸¨æ¢ç´¢ç‰©è”ç½‘HMIçš„ç«¯å£è½¬å‘å’ŒNATåŠŸèƒ½</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4253c2566c9ac013fd852d77f614d879/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">mavenç¯å¢ƒæ­å»ºï¼ˆæ‰“åŒ…é¡¹ç›®ï¼‰</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 ç¼–ç¨‹å¤§ç™½çš„åšå®¢.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>