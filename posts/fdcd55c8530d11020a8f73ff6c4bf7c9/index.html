<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>腾讯云frp连接失败。login to server failed: dial tcp x:7000: connectex: A connection attempt failed because - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="腾讯云frp连接失败。login to server failed: dial tcp x:7000: connectex: A connection attempt failed because" />
<meta property="og:description" content="地址：https://github.com/fatedier/frp
简介：一个高效的反向代理：A fast reverse proxy to help you expose a local server behind a NAT or firewall to the internet.
最全面的官方教程文档：https://gofrp.org
自我记录： a、使用TCP代理，开启本地服务器的访问。 Linux服务器启动 frps
命令：nohup ./frps -c frps.ini（无挂起启动命令。可以自定义个shell脚本，避免每次切换目录，再启动）
配置：frps.init
[common] bind_port = 7000 token = 123456 Windows启动 frpc
CMD命令：frpc -c testzyh.ini
配置：testzyh.ini
C:\Users\Administrator\Desktop\frpjk&gt;frpc -c testzyh.ini
2022/01/25 14:18:15 [W] [service.go:86] login to server failed: dial tcp 124.223.72.221:7000: connectex: A connection attempt failed because the connected party did not properly respond after a period of time, or established connection failed because connected host has failed to respond." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/fdcd55c8530d11020a8f73ff6c4bf7c9/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-01-26T15:39:56+08:00" />
<meta property="article:modified_time" content="2022-01-26T15:39:56+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">腾讯云frp连接失败。login to server failed: dial tcp x:7000: connectex: A connection attempt failed because</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-github-gist">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>地址：https://github.com/fatedier/frp<br> 简介：一个高效的反向代理：A fast reverse proxy to help you expose a local server behind a NAT or firewall to the internet.</p> 
<p>最全面的官方教程文档：https://gofrp.org</p> 
<h3><a id="_6"></a>自我记录：</h3> 
<h4><a id="aTCP_8"></a>a、使用TCP代理，开启本地服务器的访问。</h4> 
<p>Linux服务器启动 frps</p> 
<p>命令：<code>nohup ./frps -c frps.ini</code>（无挂起启动命令。可以自定义个shell脚本，避免每次切换目录，再启动）<br> 配置：<code>frps.init</code></p> 
<pre><code class="prism language-ini">[common]
bind_port = 7000
token = 123456
</code></pre> 
<p>Windows启动 frpc</p> 
<p>CMD命令：<code>frpc -c testzyh.ini</code></p> 
<p>配置：<code>testzyh.ini</code></p> 
<blockquote> 
 <p>C:\Users\Administrator\Desktop\frpjk&gt;frpc -c testzyh.ini<br> <font color="red">2022/01/25 14:18:15 [W] [service.go:86] login to server failed: dial tcp 124.223.72.221:7000: connectex: A connection attempt failed because the connected party did not properly respond after a period of time, or established connection failed because connected host has failed to respond.</font><br> dial tcp 124.223.72.221:7000: connectex: A connection attempt failed because the connected party did not properly respond after a period of time, or established connection failed because connected host has failed to respond.</p> 
 <p>失败案例：腾讯云的Linux的frps启动成功，Windows的客户端启动失败。连接超时，无响应等。应为腾讯云服务器的，防火墙规则，对于进入服务器的是有限制。需要开启。（腾讯云服务器的服务器防火墙入站及出站规则限制）（路径：腾讯云网页控制台—》轻量服务器—》服务器—》防火墙—》添加规则）</p> 
 <p>自身问题：不知道Linux服务器的防火墙规则，导致不知道怎么做。</p> 
 <pre><code>wireshark抓包（过滤规则：ip.addr == 124.223.72.221）

130	8.568352	192.168.1.155	124.223.72.221	TCP	66	63289 → 7000 [SYN] Seq=0 Win=64240 Len=0 MSS=1460 WS=256 SACK_PERM=1
131	8.599347	124.223.72.221	192.168.1.155	ICMP	94	Destination unreachable (Host administratively prohibited)
142	9.571653	192.168.1.155	124.223.72.221	TCP	66	[TCP Retransmission] [TCP Port numbers reused] 63289 → 7000 [SYN] Seq=0 Win=64240 Len=0 MSS=1460 WS=256 SACK_PERM=1
143	9.590816	124.223.72.221	192.168.1.155	ICMP	94	Destination unreachable (Host administratively prohibited)
219	11.584799	192.168.1.155	124.223.72.221	TCP	66	[TCP Retransmission] [TCP Port numbers reused] 63289 → 7000 [SYN] Seq=0 Win=64240 Len=0 MSS=1460 WS=256 SACK_PERM=1
220	11.614667	124.223.72.221	192.168.1.155	ICMP	94	Destination unreachable (Host administratively prohibited)
</code></pre> 
 <p>二.通过防火墙，开启端口</p> 
 <p>1.安装防火墙</p> 
 <p>安装iptables-services ：</p> 
 <p>2.防火墙基本操作<br> 查看版本： firewall-cmd --version<br> 显示状态： firewall-cmd --state<br> 查看所有打开的端口： netstat -anp</p> 
 <p>开启防火墙 systemctl start firewalld<br> <font color="red">关闭防火墙 systemctl stop firewalld</font></p> 
 <p>开启防火墙 service firewalld start<br> 若遇到无法开启<br> 先用：systemctl unmask firewalld.service<br> 然后：systemctl start firewalld.service</p> 
 <p>3.端口查询</p> 
 <p>查询指定端口是否已开 firewall-cmd --query-port=666/tcp</p> 
 <p>提示yes or no</p> 
 <p>查询所有开启的端口 netstat -anp</p> 
 <p>4.开启端口</p> 
 <p>如果上面端口查询没有开启的话，需要重新开启一下</p> 
 <p>开启端口命令</p> 
 <p>添加 firewall-cmd --zone=public --add-port=80/tcp --permanent （–permanent永久生效，没有此参数重启后失效）</p> 
 <p>重新载入 firewall-cmd --reload</p> 
 <p>查看 firewall-cmd --zone= public --query-port=80/tcp</p> 
 <p>删除 firewall-cmd --zone= public --remove-port=80/tcp --permanent</p> 
 <p><font color="green">最终结果：终于结束痛苦的失败</font></p> 
 <p>Linux服务器启动：</p> 
 <pre><code>[lighthouse@VM-16-13-centos ~]$ ./frp a
2022/01/25 15:15:40 [I] [root.go:200] frps uses config file: frps.ini
2022/01/25 15:15:40 [I] [service.go:192] frps tcp listen on 0.0.0.0:7000
2022/01/25 15:15:40 [I] [root.go:209] frps started successfully
</code></pre> 
 <p>window客户端启动成功：</p> 
 <pre><code>C:\Users\Administrator\Desktop\frpjk&gt;frpc -c testzyh.ini
2022/01/25 15:15:49 [I] [service.go:234] login to server success, get run id [fc18ba4b6640781d], server udp port [0]
2022/01/25 15:15:49 [I] [proxy_manager.go:144] [fc18ba4b6640781d] proxy added: [test_web_1 test_web_2]
2022/01/25 15:15:49 [I] [control.go:153] [test_web_1] start proxy success
2022/01/25 15:15:49 [I] [control.go:153] [test_web_2] start proxy success
</code></pre> 
 <p>Linux服务器响应成功：</p> 
 <pre><code>[lighthouse@VM-16-13-centos ~]$ ./frp a
2022/01/25 15:15:40 [I] [root.go:200] frps uses config file: frps.ini
2022/01/25 15:15:40 [I] [service.go:192] frps tcp listen on 0.0.0.0:7000
2022/01/25 15:15:40 [I] [root.go:209] frps started successfully
2022/01/25 15:15:48 [I] [service.go:447] [fc18ba4b6640781d] client login info: ip [115.219.252.237:59640] version [0.29.0] hostname [] os [windows] arch [amd64]
2022/01/25 15:15:48 [I] [tcp.go:63] [fc18ba4b6640781d] [test_web_1] tcp proxy listen port [15556]
2022/01/25 15:15:48 [I] [control.go:444] [fc18ba4b6640781d] new proxy [test_web_1] success
2022/01/25 15:15:48 [I] [tcp.go:63] [fc18ba4b6640781d] [test_web_2] tcp proxy listen port [15557]
2022/01/25 15:15:48 [I] [control.go:444] [fc18ba4b6640781d] new proxy [test_web_2] success
</code></pre> 
 <p><strong>其他的验证方法，使用telnet进行验证：</strong></p> 
 <ul><li>前置步骤，安装：<code>sudo yum install telnet</code></li></ul> 
 <pre><code>#成功连接
[lighthouse@VM-16-13-centos ~]$ telnet 124.223.72.221 7000
Trying 124.223.72.221...
Connected to 124.223.72.221.
Escape character is '^]'.
Connection closed by foreign host.

#失败连接
[lighthouse@VM-16-13-centos ~]$ telnet 124.223.72.221 7000
Trying 124.223.72.221...
telnet: connect to address 124.223.72.221: No route to host
</code></pre> 
 <p>要检查一下这几个方面：</p> 
 <ul><li>服务器端口是否可用，客户端是去连接服务器的相应端口的，所以要保证端口是能被客户端访问的</li></ul> 
 <p>（1）先看看服务器是否开启了任务监听对应端口，我这里端口是7000</p> 
 <pre><code class="prism language-text">sudo netstat -tunlp | grep 7000
</code></pre> 
 <p>（2）如果任务已开始监听，然后看看防火墙是否开放了这个端口，很重要</p> 
 <pre><code class="prism language-text">sudo iptables -L -n --line-numbers | grep 7000
</code></pre> 
 <p>（3）如果防火墙没有开启这个端口，需要自己添加规则开启</p> 
 <pre><code class="prism language-text">sudo iptables -I INPUT -ptcp --dport 7000 -j ACCEPT
</code></pre> 
 <p>（4）补充iptables相关命令</p> 
 <p>查找所有规则</p> 
 <pre><code class="prism language-text">sudo iptables -L INPUT --line-numbers
</code></pre> 
</blockquote> 
<pre><code class="prism language-ini">[common]
token = 123456
# Linux服务器的公网IP地址
server_addr = 124.223.72.221
server_port = 7000
[test_web_1]
type = tcp
local_ip = 127.0.0.1
local_port = 8080
remote_port = 15556
[test_web_2]
type = tcp
local_ip = 127.0.0.1
local_port = 8180
remote_port = 15557
</code></pre> 
<h4><a id="bHTTP_190"></a>b、使用HTTP代理</h4> 
<p>略</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/cbd072ec244677ed36fbb51aad1ced86/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">5.数据库完整性</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7b76d6e3c829ff8ec88dd8ebaf192e33/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【已解决】Caused by: java.lang.ClassNotFoundException: org.springframework.boot.context.properties.</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>