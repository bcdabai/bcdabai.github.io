<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>H5打开外部APP - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="H5打开外部APP" />
<meta property="og:description" content="H5开发我们会遇到这样的需求，在页面中打开外部APP。下面我们来总结一下H5打开APP的方式。并详细介绍 URL Scheme 打开方式。
目前常见的唤醒APP方式有：
1：URL Scheme
2：Android intent
3：Safari内置APP广告条
4：Universal Links
方式一：URL Scheme
IOS和Android都支持Scheme，在APP开发时注册一下scheme就可以使用了。如果想跳转指定页面还可以借助URL Router机制。
这种打开APP的方式是现在使用比较多的方式，相对比较简单。但是不同浏览器的错误不同，处理起来比较困难。不同浏览器的支持情况也不同：IOS9以后Safari不再支持js,iframe来触发scheme跳转，并加入了确认机制，这让之前通过js超时机制处理的方式基本不可用。有的应用内置浏览器也不支持这种方式比如：微信、微博等
下面是通过scheme打开app的代码。但是不完全兼容所有浏览器但相对比较稳定，可以参考一下：
/* * brower:{brower: 浏览器, sys: 浏览器系统} * appSrc:{android: 安卓app scheme,ios: IOS scheme} * downSrc:{android: 安卓下载地址,ios: IOS下载地址} * srtt:默认null用于记录定时器 */ function openApp(brower, appSrc, downSrc, srtt) { let openUrl = function() { // 通过iframe的方式试图打开APP，如果能正常打开，会直接切换到APP，并自动阻止a标签的默认行为 // 否则打开a标签的href链接 if (brower.brower == &#39;Safari&#39;) { if (brower.sys === &#39;ios&#39;) { window.location.href = appSrc.ios if (srtt) clearTimeout(srtt) srtt = setTimeout(() =&gt; { // document." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/2564ece2e3ecc662f67774fd384d33c2/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-08T19:42:28+08:00" />
<meta property="article:modified_time" content="2023-02-08T19:42:28+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">H5打开外部APP</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>H5开发我们会遇到这样的需求，在页面中打开外部APP。下面我们来总结一下H5打开APP的方式。并详细介绍 <strong>URL Scheme</strong> 打开方式<strong>。</strong></p> 
<p>目前常见的唤醒APP方式有：</p> 
<p>1：URL Scheme</p> 
<p>2：Android intent</p> 
<p>3：Safari内置APP广告条</p> 
<p>4：Universal Links</p> 
<p><strong>方式一：URL Scheme</strong></p> 
<p>IOS和Android都支持Scheme，在APP开发时注册一下scheme就可以使用了。如果想跳转指定页面还可以借助<em>URL Router</em>机制。</p> 
<p>这种打开APP的方式是现在使用比较多的方式，相对比较简单。但是不同浏览器的错误不同，处理起来比较困难。不同浏览器的支持情况也不同：IOS9以后Safari不再支持js,iframe来触发scheme跳转，并加入了确认机制，这让之前通过js超时机制处理的方式基本不可用。有的应用内置浏览器也不支持这种方式比如：微信、微博等</p> 
<p>下面是通过scheme打开app的代码。但是不完全兼容所有浏览器但相对比较稳定，可以参考一下：</p> 
<p></p> 
<pre class="has"><code class="language-javascript">/*
* brower:{brower: 浏览器, sys: 浏览器系统}
* appSrc:{android: 安卓app scheme,ios: IOS scheme}
* downSrc:{android: 安卓下载地址,ios: IOS下载地址}
* srtt:默认null用于记录定时器
*/
function openApp(brower, appSrc, downSrc, srtt) {
    let openUrl = function() {
      // 通过iframe的方式试图打开APP，如果能正常打开，会直接切换到APP，并自动阻止a标签的默认行为
      // 否则打开a标签的href链接
      if (brower.brower == 'Safari') {
        if (brower.sys === 'ios') {
          window.location.href = appSrc.ios
          if (srtt) clearTimeout(srtt)
          srtt = setTimeout(() =&gt; {
            // document.getElementById('dc').innerHTML = '下载1'
            window.location.href = downSrc.ios
          }, 500)
          return true
        } else {
          window.location.href = appSrc.android
        }
      } else {
        let ifr = document.createElement('iframe')
        ifr.src = brower.sys === 'ios' ? appSrc.ios : appSrc.android
        ifr.style.display = 'none'
        document.body.appendChild(ifr)
        window.setTimeout(function() {
          document.body.removeChild(ifr)
        }, 2000)
      }
    }
    if (brower.brower == 'weixin' || brower.brower == 'weibo') {
      // 引导用户在浏览器中打开
      alert('1、请点击页面右上角按钮\n2、选择“在浏览器打开”')
      return
    }
    let d = new Date()
    let t0 = d.getTime()
    if (openUrl()) {
    } else {
      let ta = Date.now()
      // document.getElementById('dc').innerHTML = ta - t0
      if (brower.sys === 'android' &amp;&amp; ta - t0 &gt; 22) return
      if (brower.sys === 'ios' &amp;&amp; ta - t0 &gt; 70) return
      // 由于打开需要1～2秒，利用这个时间差来处理－－打开app后，返回h5页面会出现页面变成app下载页面，影响用户体验
      let delay = setInterval(function() {
        let d = new Date()
        let t1 = d.getTime()
        if (t1 - t0 &lt; 3000 &amp;&amp; t1 - t0 &gt; 2000) {
          if (brower.sys === 'ios') {
            window.location.href = downSrc.ios
          } else {
            alert('请下载APP')
          }
          // window.location.href = downSrc.android
        }
        if (t1 - t0 &gt;= 3000) {
          clearInterval(delay)
        }
      }, 1000)
    }
  }</code></pre> 
<p>此方法支持大部分浏览器打开APP，请根据业务场景修改此方法。</p> 
<p><strong>方式二：Android intent</strong></p> 
<p>可以看出这是Android特有的方式不支持iOS，使用方法如下：</p> 
<p></p> 
<pre class="has"><code class="language-html">&lt;!-- 唤醒APP并跳转至指定的path页面 --&gt;
&lt;a href="intent://&lt;role&gt;/&lt;path&gt;#Intent;scheme=&lt;scheme&gt;;package=com. domain;end""&gt;打开APP&lt;/a&gt;</code></pre> 
<p>如果手机能找到相应的APP就打开否则跳转到手机默认的应用商店。</p> 
<p>次方法相对scheme优点是打开失败后可以跳转到失败URL,并且可以通过参数<em> S.browser_fallback_url </em>指定URL</p> 
<p><strong>方式三：Safari内置APP广告</strong></p> 
<p>通过在head中添加meta属性为apple-itunes-app的标签来实现。次方法只针对Safari</p> 
<p>详细文档请参考：<a href="https://developer.apple.com/library/content/documentation/AppleApplications/Reference/SafariWebContent/PromotingAppswithAppBanners/PromotingAppswithAppBanners.html" rel="nofollow" title="链接">链接</a></p> 
<p></p> 
<pre class="has"><code class="language-html">&lt;meta name="apple-itunes-app" content="app-id=myAppStoreID, affiliate-data=myAffiliateData, app-argument=myURL"&gt;
</code></pre> 
<p><strong>方式四：Universal Links</strong></p> 
<p><em>Universal Links </em>通用链接是2015 WWDC上Apple推出的iOS 9的一个功能。</p> 
<p>如果App支持，那么就可以通过http/https链接来直接打开app,如果App没有安装可以打开自定义页面</p> 
<p>更多关于<em>Universal Links </em>的使用请参考：<a href="https://www.jianshu.com/p/862885bd8ea2" rel="nofollow" title="链接">链接</a></p> 
<p><a href="https://github.com/AlanZhang001/H5CallUpNative" title="GitHub - AlanZhang001/H5CallUpNative: H5端唤醒移动客户端程序">GitHub - AlanZhang001/H5CallUpNative: H5端唤醒移动客户端程序</a> 这个项目可以研究一下</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f417853d7ffcd832beca10fc396e3e58/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">通过k8s管理界面部署项目服务</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d4715eab0668794d7d6d75cb7b634491/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">拯救者Y9000P突然很卡</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>