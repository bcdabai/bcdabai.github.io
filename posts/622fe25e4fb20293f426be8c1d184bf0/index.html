<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Spring学习之使用 JdbcTemplate 与 NamedParameterJdbcTemplate 连接数据库 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Spring学习之使用 JdbcTemplate 与 NamedParameterJdbcTemplate 连接数据库" />
<meta property="og:description" content="在项目工程中，我们一定会使用程序去连接数据库，Spring 中给我们提供了两个特别方便连接数据库的操作： JdbcTemplate 与 NamedParameterJdbcTemplate，如果不用Spring 提供的 JdbcTemplate，必须创建大量的冗余代码(创建连接，关闭连接，处理异常)中的所有DAO数据库的操作方法 - 插入，更新和删除。下面就介绍如果使用。
工程项目结构 数据库操作 CREATE TABLE `customer` ( `ID` int(10) unsigned NOT NULL AUTO_INCREMENT, `NAME` varchar(100) NOT NULL, `AGE` int(10) unsigned NOT NULL, PRIMARY KEY (`CUST_ID`) ) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8; 程序代码 Customer.java 创建一个 model，用于与数据库中的表对应上
package com.wq.spring.customer.model; /** * 创建一个 Customer的model * 用来对应上数据库中的表 * @author wuq * */ public class Customer { private int id; private String name; private int age; public Customer(int id, String name, int age) { this." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/622fe25e4fb20293f426be8c1d184bf0/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-07-14T09:47:48+08:00" />
<meta property="article:modified_time" content="2022-07-14T09:47:48+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Spring学习之使用 JdbcTemplate 与 NamedParameterJdbcTemplate 连接数据库</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>在项目工程中，我们一定会使用程序去连接数据库，Spring 中给我们提供了两个特别方便连接数据库的操作： <strong>JdbcTemplate </strong>与 <strong>NamedParameterJdbcTemplate</strong>，如果不用Spring 提供的 JdbcTemplate，必须创建大量的冗余代码(创建连接，关闭连接，处理异常)中的所有DAO数据库的操作方法 - 插入，更新和删除。下面就介绍如果使用。</p> 
<h3>工程项目结构</h3> 
<p><img alt="" class="has" height="482" src="https://images2.imgbox.com/a2/94/xLS7pMjL_o.png" width="373"></p> 
<h4>数据库操作</h4> 
<pre class="has"><code class="language-sql">CREATE TABLE `customer` (
  `ID` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `NAME` varchar(100) NOT NULL,
  `AGE` int(10) unsigned NOT NULL,
  PRIMARY KEY (`CUST_ID`)
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;</code></pre> 
<h4>程序代码</h4> 
<p><strong>Customer.java    </strong>创建一个 model，用于与数据库中的表对应上</p> 
<pre class="has"><code class="language-java">package com.wq.spring.customer.model;

/**
 * 创建一个 Customer的model
 * 用来对应上数据库中的表
 * @author wuq
 *
 */
public class Customer {

	private int id;
	private String name;
	private int age;
	
	public Customer(int id, String name, int age) {
		this.id = id;
		this.name = name;
		this.age = age;
	}
	
	public int getId() {
		return id;
	}
	public void setId(int id) {
		this.id = id;
	}
	public String getName() {
		return name;
	}
	public void setName(String name) {
		this.name = name;
	}
	public int getAge() {
		return age;
	}
	public void setAge(int age) {
		this.age = age;
	}

	@Override
	public String toString() {
		return "Customer [age=" + age + ", id=" + id + ", name=" + name+ "]";
	}
}</code></pre> 
<p><strong>CustomerDao.java </strong>   数据的访问层 dao</p> 
<pre class="has"><code class="language-java">package com.wq.spring.customer.dao;

import com.wq.spring.customer.model.Customer;

// 数据的访问层 dao
public interface CustomerDao {

	public void insert(Customer customer);
	public Customer findByCustomerById(int id);
	
}</code></pre> 
<p><strong>JdbcCustomerDAO.java</strong>    通过 JdbcTemplate 的方式连接数据库。</p> 
<p>使用 <strong>JdbcCustomerDAO </strong>操作数据库，需要继承与<strong> JdbcDaoSupport，</strong>通过 <strong>JdbcDaoSupport </strong>来获取数据源操作类。使用<strong>JdbcTemplate </strong>可节省大量的冗余代码，因为 <strong>JdbcTemplate</strong>类 会自动处理它。</p> 
<pre class="has"><code class="language-java">package com.wq.spring.customer.dao.impl;

import java.util.Map;

import org.springframework.jdbc.core.support.JdbcDaoSupport;

import com.wq.spring.customer.dao.CustomerDao;
import com.wq.spring.customer.model.Customer;

public class JdbcCustomerDAO extends JdbcDaoSupport implements CustomerDao {

	@Override
	public void insert(Customer customer) {
		String sql = "INSERT INTO CUSTOMER (ID, NAME, AGE) VALUES (?, ?, ?)";

		getJdbcTemplate().update( sql, new Object[] { customer.getId(), customer.getName(),
						customer.getAge() });
	}

	@Override
	public Customer findByCustomerById(int id) {
		String sql = "SELECT * FROM CUSTOMER WHERE ID = ?";
		Map&lt;String, Object&gt;  customerMap =  getJdbcTemplate().queryForMap(sql, id);
		
		Customer customer = new Customer( 
				Integer.parseInt(customerMap.get("ID").toString()), 
				customerMap.get("NAME").toString(),
				Integer.valueOf(customerMap.get("AGE").toString()));
		return customer;
	}
}</code></pre> 
<p><strong>SimpleJdbcCustomerDAO.java   </strong>使用 <strong>NamedParameterJdbcTemplate </strong>操作数据库</p> 
<pre class="has"><code class="language-java">package com.wq.spring.customer.dao.impl;

import java.util.HashMap;
import java.util.List;
import java.util.Map;

import org.springframework.jdbc.core.namedparam.BeanPropertySqlParameterSource;
import org.springframework.jdbc.core.namedparam.NamedParameterJdbcDaoSupport;
import org.springframework.jdbc.core.namedparam.SqlParameterSource;

import com.wq.spring.customer.dao.CustomerDao;
import com.wq.spring.customer.model.Customer;
																		   
public class SimpleJdbcCustomerDAO extends NamedParameterJdbcDaoSupport implements CustomerDao{

	@Override
	public void insert(Customer customer) {
		// :name 需要为小写的，大写的会报错
		String sql = "UPDATE CUSTOMER SET NAME = :name WHERE ID = :id";
		
		SqlParameterSource ps=new BeanPropertySqlParameterSource(customer);
		int i = getNamedParameterJdbcTemplate().update(sql, ps);	// 传入的参数也可以使用 map
		System.out.println("更新影响行数：" + i);
	}
	
	@Override
	public Customer findByCustomerById(int id) {
		// :ID 需要和 map 中的 key 大小写保持一致
		String sql = "SELECT * FROM CUSTOMER WHERE ID = :ID";
		
		// 拼接条件
		Map&lt;String, Object&gt; map = new HashMap();
		map.put("ID", id);
		
		// 查询返回一个 list
		List&lt;Map&lt;String, Object&gt;&gt; list = getNamedParameterJdbcTemplate().queryForList(sql, map);
		System.out.println( list.toString() );
		
		// 查询返回 map
		Map&lt;String, Object&gt;  customerMap =  getNamedParameterJdbcTemplate().queryForMap(sql, map);
		
		Customer customer = new Customer( 
				Integer.parseInt(customerMap.get("ID").toString()), 
				customerMap.get("NAME").toString(),
				Integer.valueOf(customerMap.get("AGE").toString()));
		
		return customer;
	}
}
</code></pre> 
<p><strong>Test.java  </strong>测试类</p> 
<pre class="has"><code class="language-java">package com.wq.spring.customer.app;

import org.springframework.context.ApplicationContext;
import org.springframework.context.support.ClassPathXmlApplicationContext;

import com.wq.spring.customer.dao.CustomerDao;
import com.wq.spring.customer.model.Customer;

public class Test {

	public static void main(String[] args) {
		ApplicationContext context = new ClassPathXmlApplicationContext("spring-jdbc-connect.xml");
   	 
        CustomerDao customerDAO = (CustomerDao) context.getBean("customerSimpleDAO");
        
       /* Customer customer = new Customer(1, "Wayfreem", 29);
        customerDAO.insert(customer);*/
    	
        Customer customer1 = customerDAO.findByCustomerById(1);
        System.out.println(customer1);
        
	}
}
</code></pre> 
<p><strong>jdbc.properties  数据源相关配置</strong></p> 
<pre class="has"><code class="language-bash">jdbc.driverClass=com.mysql.cj.jdbc.Driver
jdbc.url=jdbc\:mysql\://localhost\:3306/study_db?serverTimezone\=GMT%2B8
jdbc.username=root
jdbc.password=admin</code></pre> 
<p><strong>spring-jdbc-connect.xml 配置文件</strong></p> 
<pre class="has"><code class="language-html">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans" 
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
	xmlns:tx="http://www.springframework.org/schema/tx" 
	xmlns:aop="http://www.springframework.org/schema/aop" 
	xmlns:context="http://www.springframework.org/schema/context"
	xsi:schemaLocation="http://www.springframework.org/schema/beans 
	    http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
	    http://www.springframework.org/schema/tx
	    http://www.springframework.org/schema/tx/spring-tx-3.0.xsd
	    http://www.springframework.org/schema/aop
	    http://www.springframework.org/schema/aop/spring-aop-3.0.xsd
	    http://www.springframework.org/schema/context 
	    http://www.springframework.org/schema/context/spring-context.xsd"&gt;
	
	&lt;!-- 引入外部的属性文件 --&gt;
	&lt;context:property-placeholder location="classpath:jdbc.properties"/&gt;
	
	&lt;!-- 配置数据源 --&gt;
	&lt;bean id="dataSource" class="org.springframework.jdbc.datasource.DriverManagerDataSource"&gt;
		&lt;property name="driverClassName" value="${jdbc.driverClass}" /&gt;
		&lt;property name="url" value="${jdbc.url}" /&gt;
		&lt;property name="username" value="${jdbc.username}" /&gt;
		&lt;property name="password" value="${jdbc.password}" /&gt;
	&lt;/bean&gt;
	
	&lt;!-- 通过 spring ioc 容器自动注入 JdbcCustomerDAO  --&gt;
	&lt;bean id="customerDAO" class="com.wq.spring.customer.dao.impl.JdbcCustomerDAO"&gt;
		&lt;property name="dataSource" ref="dataSource" /&gt;
	&lt;/bean&gt;
	
	&lt;bean id="customerSimpleDAO" class="com.wq.spring.customer.dao.impl.SimpleJdbcCustomerDAO"&gt;
		&lt;property name="dataSource" ref="dataSource" /&gt;
	&lt;/bean&gt;
	
&lt;/beans&gt;</code></pre> 
<p><strong>启动测试类，查询结果如下</strong></p> 
<p><img alt="" class="has" height="256" src="https://images2.imgbox.com/94/44/wqA2muCI_o.png" width="776"></p> 
<h4>附</h4> 
<p>如果不继承于 <strong>JdbcDaoSupport </strong>来获取数据源，可以使用下面的操作代码</p> 
<pre class="has"><code class="language-java">package com.wq.spring.customer.dao.impl;

import java.util.Map;
import javax.sql.DataSource;

import org.springframework.jdbc.core.JdbcTemplate;

import com.wq.spring.customer.dao.CustomerDao;
import com.wq.spring.customer.model.Customer;

public class JdbcCustomerDAO implements CustomerDao {

	private DataSource dataSource;

	private JdbcTemplate jdbcTemplate;

	public void setDataSource(DataSource dataSource) {
		this.dataSource = dataSource;
	}

	@Override
	public void insert(Customer customer) {
		String sql = "INSERT INTO CUSTOMER (ID, NAME, AGE) VALUES (?, ?, ?)";

		jdbcTemplate = new JdbcTemplate(dataSource);
		jdbcTemplate.update( sql, new Object[] { customer.getId(), customer.getName(),
						customer.getAge() });
	}

	@Override
	public Customer findByCustomerById(int id) {
		String sql = "SELECT * FROM CUSTOMER WHERE ID = ?";
		
		jdbcTemplate = new JdbcTemplate(dataSource);
		Map&lt;String, Object&gt;  customerMap =  jdbcTemplate.queryForMap(sql, id);
		
		Customer customer = new Customer( 
				Integer.parseInt(customerMap.get("ID").toString()), 
				customerMap.get("NAME").toString(),
				Integer.valueOf(customerMap.get("AGE").toString()));
		return customer;
	}

}</code></pre> 
<p>源码地址：</p> 
<p>链接：https://pan.baidu.com/s/1y8RHwHw2rPc8NUIysC2m-A</p> 
<p>提取码：e7fr</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1621141f4ddc3397d961504017f31d28/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">python基础之--人机大战，编程思维</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1c0018c3c39468ca4ff03e842b2665b7/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">git执行git push -u origin main 报错 error: src refspec main does not match any</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>