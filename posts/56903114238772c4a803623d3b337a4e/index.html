<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>网络实验之VTP协议 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="网络实验之VTP协议" />
<meta property="og:description" content="一、VTP协议简介 VLAN中继协议，VTP，VLAN TRUNKING PROTOCOL，是CISCO专用协议，大多数交换机都支持该协议。VTP负责在VTP域内同步VLAN信息，这样就不必在每个交换上配置相同的VLAN信息。如协议名称，VTP协议需要依赖trunk链路承载。VTP是一种消息协议，使用第2层帧，在全网的基础上管理VLAN的添加、删除和重命名，以实现VLAN配置的一致性。可以用VTP管理网络中VLAN1到1005。有了VTP，就可以在一台交换机上集中进行配置变更，所作的变更会被自动传播到网络中所有其他的交换机上。（前提是在同一个VTP域）。VTP协议需要为了实现此功能，必须先建立一个VTP管理域，VTP有三种运行模式Server、Transparent、Client，Server模式是默认模式，各模式的区别如下：
功能项ServerClientTransparent（透明模式）增/删/改√×√（仅在本地有效）转发VTP(vlan)信息√√√同步vlan信息√√×保存NVRAM√×√ 二、VTP协议实践 1、实验环境说明 博文实验环境采用GNS3模拟器搭建VTP网络实验环境，三层交换机使用3640，iso系统版本为c3640-jk9o3s-mz.124-10a.bin。
2、拓扑图 如下拓扑图，网络中存在三个网段，分别属于不同的vlan，网关位于SW1交换机上。SW1交换机作为VTP的server，负责维护整个VTP域的vlan信息，SW3和SW4作为末端交换机，配置VTP client模式，从SW1同步vlan信息。SW2配置为transparent模式，可以传递VTP信息，但是不更新本地vlan信息，自行维护。
3、网络配置 初始配置的情况下，SW1手动创建了vlan100-102，并配置了interface100-102的网关地址，SW2手动创建了vlan100，SW3-SW4通过VTP自动学习到vlan100-102。
交换机SW1配置 #如下是vlan database模式下配置 SW1#vlan database SW1(vlan)#vtp server SW1(vlan)#vtp domain sunsite SW1(vlan)#vlan 100 name vlan100 SW1(vlan)#vlan 101 name vlan101 SW1(vlan)#vlan 102 name vlan102 SW1(vlan)#exit #如下是全局模式下配置 conf t hostname SW1 interface FastEthernet0/14 switchport mode trunk switchport trunk allow vlan all switchport trunk encapsulation dot1q no shutdown ! interface FastEthernet0/15 switchport mode trunk switchport trunk allow vlan all switchport trunk encapsulation dot1q no shutdown !" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/56903114238772c4a803623d3b337a4e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-12-23T08:30:00+08:00" />
<meta property="article:modified_time" content="2022-12-23T08:30:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">网络实验之VTP协议</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="VTP_0"></a>一、VTP协议简介</h2> 
<p>  VLAN中继协议，VTP，VLAN TRUNKING PROTOCOL，是CISCO专用协议，大多数交换机都支持该协议。VTP负责在VTP域内同步VLAN信息，这样就不必在每个交换上配置相同的VLAN信息。如协议名称，VTP协议需要依赖trunk链路承载。VTP是一种消息协议，使用第2层帧，在全网的基础上管理VLAN的添加、删除和重命名，以实现VLAN配置的一致性。可以用VTP管理网络中VLAN1到1005。有了VTP，就可以在一台交换机上集中进行配置变更，所作的变更会被自动传播到网络中所有其他的交换机上。（前提是在同一个VTP域）。VTP协议需要为了实现此功能，必须先建立一个VTP管理域，VTP有三种运行模式Server、Transparent、Client，Server模式是默认模式，各模式的区别如下：</p> 
<table><thead><tr><th align="left">功能项</th><th align="left">Server</th><th align="left">Client</th><th align="left">Transparent（透明模式）</th></tr></thead><tbody><tr><td align="left">增/删/改</td><td align="left">√</td><td align="left">×</td><td align="left">√（仅在本地有效）</td></tr><tr><td align="left">转发VTP(vlan)信息</td><td align="left">√</td><td align="left">√</td><td align="left">√</td></tr><tr><td align="left">同步vlan信息</td><td align="left">√</td><td align="left">√</td><td align="left">×</td></tr><tr><td align="left">保存NVRAM</td><td align="left">√</td><td align="left">×</td><td align="left">√</td></tr></tbody></table> 
<h2><a id="VTP_8"></a>二、VTP协议实践</h2> 
<h3><a id="1_9"></a>1、实验环境说明</h3> 
<p>  博文实验环境采用GNS3模拟器搭建VTP网络实验环境，三层交换机使用3640，iso系统版本为c3640-jk9o3s-mz.124-10a.bin。</p> 
<h3><a id="2_11"></a>2、拓扑图</h3> 
<p>  如下拓扑图，网络中存在三个网段，分别属于不同的vlan，网关位于SW1交换机上。SW1交换机作为VTP的server，负责维护整个VTP域的vlan信息，SW3和SW4作为末端交换机，配置VTP client模式，从SW1同步vlan信息。SW2配置为transparent模式，可以传递VTP信息，但是不更新本地vlan信息，自行维护。<br> <img src="https://images2.imgbox.com/f4/18/2OHrOVPZ_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="3_14"></a>3、网络配置</h3> 
<p>  初始配置的情况下，SW1手动创建了vlan100-102，并配置了interface100-102的网关地址，SW2手动创建了vlan100，SW3-SW4通过VTP自动学习到vlan100-102。</p> 
<ul><li>交换机SW1配置</li></ul> 
<pre><code>#如下是vlan database模式下配置
SW1#vlan database 
SW1(vlan)#vtp server 
SW1(vlan)#vtp domain sunsite
SW1(vlan)#vlan 100 name vlan100
SW1(vlan)#vlan 101 name vlan101
SW1(vlan)#vlan 102 name vlan102
SW1(vlan)#exit
#如下是全局模式下配置
conf t
hostname SW1
interface FastEthernet0/14
 switchport mode trunk
 switchport trunk allow vlan all
 switchport trunk encapsulation dot1q
 no shutdown 
!
interface FastEthernet0/15
 switchport mode trunk
 switchport trunk allow vlan all
 switchport trunk encapsulation dot1q
 no shutdown
!
interface Vlan100
 ip address 192.168.0.254 255.255.255.0
 no shutdown 
!
interface Vlan101
 ip address 192.168.1.254 255.255.255.0
 no shutdown 
!
interface Vlan102
 ip address 192.168.2.254 255.255.255.0
 no shutdown 
!
</code></pre> 
<ul><li>交换机SW2配置</li></ul> 
<pre><code>#如下是vlan database模式下配置
SW2#vlan database 
SW2(vlan)#vtp transparent
SW2(vlan)#vlan 100 name vlan100
SW2(vlan)#exit
#如下是全局模式下配置
conf t
hostname SW2
interface FastEthernet0/0
 switchport mode access
 switchport access vlan 100
 no shutdown
!
interface FastEthernet0/14
 switchport mode trunk
 switchport trunk allow vlan all
 switchport trunk encapsulation dot1q
 no shutdown 
!
interface FastEthernet0/15
 switchport mode trunk
 switchport trunk allow vlan all
 switchport trunk encapsulation dot1q
 no shutdown
!
</code></pre> 
<ul><li>交换机SW3配置</li></ul> 
<pre><code>#如下是vlan database模式下配置
SW3#vlan database 
SW3(vlan)#vtp client 
SW3(vlan)#vtp domain sunsite
SW3(vlan)#exit
#如下是全局模式下配置
conf t
hostname SW3
interface FastEthernet0/0
 switchport mode access
 switchport access vlan 100
 no shutdown
!
interface FastEthernet0/1
 switchport mode access
 switchport access vlan 101
 no shutdown
!
interface FastEthernet0/2
 switchport mode access
 switchport access vlan 102
 no shutdown
!
interface FastEthernet0/15
 switchport mode trunk
 switchport trunk allow vlan all
 switchport trunk encapsulation dot1q
 no shutdown
!
</code></pre> 
<ul><li>交换机SW4配置</li></ul> 
<pre><code>#如下是vlan database模式下配置
SW4#vlan database 
SW4(vlan)#vtp client 
SW4(vlan)#vtp domain sunsite
SW4(vlan)#exit
#如下是全局模式下配置
conf t
hostname SW4
interface FastEthernet0/0
 switchport mode access
 switchport access vlan 100
 no shutdown
!
interface FastEthernet0/1
 switchport mode access
 switchport access vlan 101
 no shutdown
!
interface FastEthernet0/2
 switchport mode access
 switchport access vlan 102
 no shutdown
!
interface FastEthernet0/15
 switchport mode trunk
 switchport trunk allow vlan all
 switchport trunk encapsulation dot1q
 no shutdown
!
</code></pre> 
<h3><a id="4_146"></a>4、协议实践验证</h3> 
<ul><li>vtp client模式下的vlan同步情况检查<br> 我们可以看到SW3,SW4虽然没有配置任何自定义vlan，但是通过VTP server学到了vlan100,vlan101,vlan102的配置。<br> <img src="https://images2.imgbox.com/f6/24/YKjCq3EA_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/90/13/PtuOzNtY_o.png" alt="在这里插入图片描述"></li><li>vlan100网络通断性验证<br> <img src="https://images2.imgbox.com/3b/07/DOsMlM04_o.png" alt="在这里插入图片描述"></li><li>vlan101网络通断性验证<br> <img src="https://images2.imgbox.com/1b/bf/MFskC9DL_o.png" alt="在这里插入图片描述"></li><li>交换机SW2上配置vlan101信息后验证PC2和网关的网络通断性<br> <img src="https://images2.imgbox.com/5f/cc/mx8mogho_o.png" alt="在这里插入图片描述"></li><li>SW1上删除vlan102，查看vtp client变化<br> vlan信息同步是随即发送的，但是网络的通断性恢复还需要一些时间，主要是vlan的变化，需要重新计算生成树，待生成树收敛完成网络就恢复通了。</li></ul> 
<blockquote> 
 <p>SW1#vlan database<br> SW1(vlan)#no vlan 102<br> Deleting VLAN 102…<br> SW1(vlan)#exi<br> APPLY completed.<br> Exiting…<br> SW1#<br> <img src="https://images2.imgbox.com/27/c2/5FuPrmnO_o.png" alt="在这里插入图片描述"></p> 
</blockquote> 
<ul><li>vtp域密码认证<br> 我们在server端配置vtp域的密码认证，因为client端没有配置密码，所以不会同步更新。</li></ul> 
<blockquote> 
 <p>SW1#vlan database<br> SW1(vlan)#vtp pass<br> SW1(vlan)#vtp password cisco<br> Password already set to cisco.<br> SW1(vlan)#vlan 103 name vlan103<br> VLAN 103 modified:<br> Name: vlan103<br> SW1(vlan)#exit<br> APPLY completed.<br> Exiting…<br> <img src="https://images2.imgbox.com/03/c3/9xcDxyOH_o.png" alt="在这里插入图片描述"></p> 
</blockquote> 
<ul><li>客户端配置vtp认证密码<br> vlan信息没有修改的情况下同步信息5分钟更新一次，认证密码不一致时不会进行更新。</li></ul> 
<blockquote> 
 <p>#SW1<br> SW1#vlan database<br> SW1(vlan)#vtp pass<br> SW1(vlan)#vtp password cisco<br> Password already set to cisco.<br> SW1(vlan)#exit<br> APPLY completed.<br> Exiting…<br> #SW2<br> SW2#vlan database<br> SW2(vlan)#vtp pass<br> SW2(vlan)#vtp password yhxx<br> Password already set to yhxx<br> SW2(vlan)#exit<br> APPLY completed.<br> Exiting…<br> <img src="https://images2.imgbox.com/2a/c2/9DaUu7Pm_o.png" alt="在这里插入图片描述"></p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/24/56/dWvlhRbm_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_202"></a>三、总结</h2> 
<ul><li>VTP信息每5分钟通告一次， 或 触发更新(VLAN配置改变时通告)。</li><li>VTP通告帧发向组播MAC地址，0100.0ccc.cccc。</li><li>VTP有四种消息类型：1、汇总通告 2、子网通告 3、通告请求 4、VTP加入消息。</li><li>VTP的同步是由低版本号的交换机跟着高版本号的交换机做同步。</li><li>每当修改VLAN信息一次，版本号就加1，版本低的SW跟版本高的SW学习VLAN信息。</li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/60a371bada430b9d9670fa70a1b87eb3/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">解决PageHelper版本不匹配，结果可能全部返回问题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4694b882bffd8898b8778199b62772b3/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">谷粒商城P184中elasticsearch出错问题</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>