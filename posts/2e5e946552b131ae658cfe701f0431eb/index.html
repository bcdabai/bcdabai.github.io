<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>bat替换文件中的字符串_实例14：用Python批量替换多个Word文件中的文字 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="bat替换文件中的字符串_实例14：用Python批量替换多个Word文件中的文字" />
<meta property="og:description" content="我们在实例7中批量生成了采购合同。但是假设现在我方的公司名由“ABC商贸有限公司”变成了“ABC贸易有限公司”，那我们就需要去每份合同中对应位置进行替换。当然也可以修改原始模板，然后重新生成合同。此处介绍一下如何使用Python批量替换多个Word文件中的文字，即将“商贸”替换为“贸易”。
我们先去到Word文件中，查找一下“商贸”这个词出现了多少次。下图可见，运气不错，只出现了两次，一次在正文的段落中，另一次在末尾的表格中，而且都是我们要替换的。
import docx
def info_update(doc,old_info, new_info):
&#39;&#39;&#39;此函数用于批量替换合同中需要替换的信息
doc:文件
old_info和new_info：原文字和需要替换的新文字
&#39;&#39;&#39;
#读取段落中的所有run，找到需替换的信息进行替换
for para in doc.paragraphs: #
for run in para.runs:
run.text = run.text.replace(old_info, new_info) #替换信息
#读取表格中的所有单元格，找到需替换的信息进行替换
for table in doc.tables:
for row in table.rows:
for cell in row.cells:
cell.text = cell.text.replace(old_info, new_info) #替换信息 我们上面直接借用实例7中定义好的用于替换文字的函数info_update。只需要向其中传入目标文件路径，待替换的词和新词即可。然后导入os库，获取目标文件及其路径，如下。
import os #用于获取目标文件所在路径
path=&#34;data/&#34; # 文件夹路径
files=[]
for file in os.listdir(path):
if file.endswith(&#34;.docx&#34;): #排除文件夹内的其它干扰文件，只获取word文件
files.append(path&#43;file) files
&gt;&gt;
[&#39;data/公司001合同.docx&#39;,
&#39;data/公司002合同.docx&#39;,
&#39;data/公司003合同.docx&#39;,
&#39;data/公司004合同.docx&#39;,
&#39;data/公司005合同.docx&#39;,
&#39;data/公司006合同.docx&#39;,
&#39;data/公司007合同.docx&#39;," />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/2e5e946552b131ae658cfe701f0431eb/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-11-23T13:42:17+08:00" />
<meta property="article:modified_time" content="2020-11-23T13:42:17+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">bat替换文件中的字符串_实例14：用Python批量替换多个Word文件中的文字</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div class="._5ce-wx-style" style="font-size:16px;"> 
 <div class="rich_media_content" id="js_content"> 
  <p>我们在实例7中批量生成了采购合同。但是假设现在我方的公司名由“ABC商贸有限公司”变成了“ABC贸易有限公司”，那我们就需要去每份合同中对应位置进行替换。当然也可以修改原始模板，然后重新生成合同。此处介绍一下如何使用Python批量替换多个Word文件中的文字，即将“商贸”替换为“贸易”。</p> 
  <p>我们先去到Word文件中，查找一下“商贸”这个词出现了多少次。下图可见，运气不错，只出现了两次，一次在正文的段落中，另一次在末尾的表格中，而且都是我们要替换的。</p> 
  <p><img src="https://images2.imgbox.com/7c/86/nKEVjDAd_o.png" alt="d236dae12eb98c196e369bf4ca4c92fc.png"></p> 
  <pre class="has"><code>import docx<br>def info_update(doc,old_info, new_info):<br>'''此函数用于批量替换合同中需要替换的信息<br>    doc:文件<br>    old_info和new_info：原文字和需要替换的新文字<br>    '''<br>#读取段落中的所有run，找到需替换的信息进行替换<br>for para in doc.paragraphs: #<br>for run in para.runs:<br>run.text = run.text.replace(old_info, new_info) #替换信息<br>#读取表格中的所有单元格，找到需替换的信息进行替换<br>for table in doc.tables:<br>for row in table.rows:<br>for cell in row.cells:<br>cell.text = cell.text.replace(old_info, new_info) #替换信息</code></pre> 
  <p>我们上面直接借用实例7中定义好的用于替换文字的函数<code>info_update</code>。只需要向其中传入目标文件路径，待替换的词和新词即可。然后导入<code>os</code>库，获取目标文件及其路径，如下。</p> 
  <pre class="has"><code>import os #用于获取目标文件所在路径<br>path="data/" # 文件夹路径<br>files=[]<br>for file in os.listdir(path):<br>if file.endswith(".docx"): #排除文件夹内的其它干扰文件，只获取word文件<br>files.append(path+file) <br>files<br>&gt;&gt;<br>['data/公司001合同.docx',<br>'data/公司002合同.docx',<br>'data/公司003合同.docx',<br>'data/公司004合同.docx',<br>'data/公司005合同.docx',<br>'data/公司006合同.docx',<br>'data/公司007合同.docx',<br>'data/公司008合同.docx',<br>'data/公司009合同.docx',<br>'data/公司010合同.docx']</code></pre> 
  <p>然后就可以开始进行批量替换操作了。可到文件夹“替换结果”中查看结果。</p> 
  <pre class="has"><code>for file in files:<br>doc = docx.Document(file)<br>info_update(doc,"商贸", "贸易")<br>doc.save("data/替换结果/{}".format(file.split("/")[-1]))<br>print("{}替换完成".format(file))<br>&gt;&gt;<br>data/公司001合同.docx替换完成<br>data/公司002合同.docx替换完成<br>data/公司003合同.docx替换完成<br>data/公司004合同.docx替换完成<br>data/公司005合同.docx替换完成<br>data/公司006合同.docx替换完成<br>data/公司007合同.docx替换完成<br>data/公司008合同.docx替换完成<br>data/公司009合同.docx替换完成<br>data/公司010合同.docx替换完成</code></pre> 
  <p>但如果另外的地方也出现了一次或多次“商贸”这个词，且是不能替换的呢？也有办法，我们可以指定替换的段落范围。比如我们故意在“特殊_含干扰词.docx”中间插入4个词“商贸”。这样，我们就有6个“商贸”在文档里了。</p> 
  <p><img src="https://images2.imgbox.com/6b/44/buT6fL8M_o.png" alt="8c990f0144d93e18122653af7550ab34.png"></p> 
  <p>假设我们要替换第一、第三、第六个“商贸”为“贸易”，那我们要先确定出它们在那个段落，即对应<code>paragraph</code>的索引。由于第六个“商贸”在表格中，不在段落中，所以我们只需要找出第一、第三个所在的段落即可。</p> 
  <pre class="has"><code>#获取词"商贸"所在段落<br>import docx #导入docx库<br>doc = docx.Document("data/含干扰词/特殊_含干扰词.docx") #打开word文件<br>text=[]<br>for para in doc.paragraphs: #读取word中的每个段落<br>text.append(para.text)<br>print(len(text))<br><br>target_index=[]<br>for i in text:<br>if "商贸" in i:<br>target_index.append(text.index(i))<br>target_index<br>&gt;&gt;<br>77<br>[15, 26, 32, 38, 66]</code></pre> 
  <p>以上，我们还是使用<code>docx</code>模块来读取目标word文件。我们需要知道包含“商贸”一词所在段落，就需要知道其索引。但是我在<code>docx</code>模块中未找到索引相关的函数，因此这里使用了一个变通的方法。即新建一个空列表<code>text</code>，然后将word文档中的所有段落对应的文本提取并存入这个列表。列表是可以使用索引函数的，而列表里面元素的索引正好对应段落的索引。所以只要找到“商贸”一词在列表<code>text</code>中的索引，也就找到了其在段落<code>paragraph</code>中的索引。通过<code>len(text)</code>可知共有77个段落。</p> 
  <p>然后再新建一个空列表<code>target_index</code>，用于存储包含“商贸”一词的字符串在列表<code>text</code>中的索引。使用<code>for</code>循环遍历列表<code>text</code>中的所有元素，通过<code>if</code>语句判断其中是否包含“商贸”字符，如果包含，则将这个元素对应的索引<code>text.index(i)</code>存入列表<code>target_index</code>。通过结果，可见找到5处含有“商贸”字符串，索引分别为15, 26, 32, 38, 66。</p> 
  <p>为了验证是否准确，我们可以打印看一下相应索引对应的段落是否真的包含“商贸”一词。如下打印结果显示，结果很理想。</p> 
  <pre class="has"><code>for j in target_index:<br>print(doc.paragraphs[j].text)<br><br>&gt;&gt;<br>乙方：ABC商贸有限责任公司<br>1.交货方法：由乙方送货(国家主管部门规定有送货办法的，按规定的办法执行；没有规定送货办法的，按双方协议执行)；商贸<br>1.所有货物由乙方送到交货地点且甲方确认收货后5天内，由甲乙双方共同对货物的包装、外观、数量、商标、型号、规格及性能<br>等进行验收，签署检验报告。如乙方未按约定到甲方指定地点参加检验的，应视为乙方对甲方单方检验的结果予以确认。验收标准<br>执行合同规定的货物质量标准。商贸<br>总价指甲方的交货价格，该价格应包含货物价格、通关费、包装费、物流费、装卸费、保险费、在甲方指定场所的安装调试费、<br>必要的培训费以及增值税等一切费用。在乙方完全履行本合同下全部义务的情形下，除非另有书面约定，否则合同金额是甲方应<br>当向乙方支付的全部费用 。商贸<br>本合同自双方法定代表人或委托代理人签字盖章后生效，至合同条款履行完毕时终止。商贸</code></pre> 
  <p>因为我们只替换第一、第三、第六个“商贸”为“贸易”，而第六个在表格中。所以需要改一下原来的替换函数<code>info_update</code>，命名为新的函数<code>info_update_new</code>，我们在函数内指定只替换段落15和32中的目标词，表格中的目标词也继续替换。</p> 
  <pre class="has"><code>import docx<br>def info_update_new(doc,old_info, new_info):<br>'''此函数用于批量替换合同中需要替换的信息<br>    doc:文件<br>    old_info和new_info：原文字和需要替换的新文字<br>    '''<br>#读取段落中的所有run，找到需替换的信息进行替换<br>for i in [15,32]:<br>para=doc.paragraphs[i]<br>for run in para.runs:<br>run.text = run.text.replace(old_info, new_info) #替换信息<br>#读取表格中的所有单元格，找到需替换的信息进行替换<br>for table in doc.tables:<br>for row in table.rows:<br>for cell in row.cells:<br>cell.text = cell.text.replace(old_info, new_info) #替换信息</code></pre> 
  <pre class="has"><code>import os #用于获取目标文件所在路径<br>path="data/含干扰词/" # 文件夹路径<br>files=[]<br>for file in os.listdir(path):<br>if file.endswith(".docx"): #排除文件夹内的其它干扰文件，只获取word文件<br>files.append(path+file) <br><br>for file in files:<br>doc = docx.Document(file)<br>info_update_new(doc,"商贸", "贸易")<br>doc.save("data/替换结果/{}".format(file.split("/")[-1]))<br>print("{}替换完成".format(file))<br>&gt;&gt;<br>data/含干扰词/特殊_含干扰词.docx替换完成</code></pre> 
  <p>调用新的替换函数<code>info_update_new</code>，将结果也保存到文件夹“data/替换结果”内。<br>结果如下，可见在完成替换后的文件中，词“商贸”和“贸易”各有3个，只有我们指定位置的词被替换掉了。</p> 
  <p><img src="https://images2.imgbox.com/aa/be/UOBXEoFg_o.png" alt="605dc3269658d2ac5c0c35a8bc73b79b.png"></p> 
  <p>所有源代码和说明都在Jupyter notebook上完成，所用到的Excel 资料已上传GitHub, 欢迎Fork或下载到本地随意玩。。。转载请注明出处，谢谢。GitHub链接：</p> 
  <p>https://github.com/weidylan/Office_Automation_by_Using_Python</p> 
  <p>知乎专栏：https://zhuanlan.zhihu.com/c_1093482152993316864</p> 
 </div> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/be60860e6640304fa679427fb9abc8c6/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">python使用redis_Python操作Redis，你要的都在这了！</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b1d2af597518def546195b185b4a3245/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">python启动方法_Python之启动App--冷启动，热启动</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>