<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Redis部署全攻略——主从模式 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Redis部署全攻略——主从模式" />
<meta property="og:description" content="目录
主节点修改配置文件
从节点修改配置文件 启动主从节点
验证redis主从模式
查看进程（所有主从主机分别查看启动结果）
登录主节点客户端验证
登录从节点进行验证
主从切换
主从模式下，主节点宕机，从节点无法自动升级为主节点，需要人为干预。分别在两台主机上进行安装，安装过程与单机模式相同，不再赘述。以下配置内容，均在单机模式的基础上进行增加额外的配置。 主节点修改配置文件 如要为redis设定密码，则在配置文件redis.conf中添加requirepass XXXXXX和masterauth XXXXXX，其中XXXXXX即为密码。
masterauth作用：主要是针对master对应的slave节点设置的，在slave节点数据同步的时候用到。requirepass作用：对登录权限做限制，redis每个节点的requirepass可以是独立、不同的。建议两个密码设置为相同密码，防止因为对应关系错误导致无法正常使用 如：
从节点修改配置文件 如主节点配置了master密码，则从节点也许对应设置，在配置文件redis.conf中添加requirepass XXXXXX和masterauth XXXXXX，其中XXXXXX即为密码。 masterauth作用：主要是针对master对应的slave节点设置的，在slave节点数据同步的时候用到。requirepass作用：对登录权限做限制，redis每个节点的requirepass可以是独立、不同的。建议两个密码设置为相同密码，防止因为对应关系错误导致无法正常使用 如：
从节点配置主节点同步信息 找到replicaof配置信息（大约在479行），去除注释并配置主节点信息如下：
replicaof 10.8.15.102 6379 启动主从节点 指定配置文件启动（分别启动主从节点）
/opt/tools/redis-6.2.7/src/redis-server /opt/tools/redis-cluster/redis.conf 验证redis主从模式 查看进程（所有主从主机分别查看启动结果） ps -ef|grep redis 登录主节点客户端验证 /opt/tools/redis-6.2.6/src/redis-cli -h 10.8.10.125 -p 6379 若有设置密码，则auth 密码进入
查看集群信息 info Replication 创建key进行测试 #创建key set name &#34;test&#34; #获取key get name 登录从节点进行验证 查看集群信息 info Replication 获取主节点创建的key进行测试 #获取key get name 可正确获取，表明主从建立成功
主从切换 redis的主从模式，不支持自动切换主从节点。意味着当主节点宕机后，需要手动切换为主节点；主节点恢复后，也需要手动切换原从节点为从节点。
关闭主节点，模拟主节点宕机 shutdown save 手动关闭从节点复制功能，使其临时变更为单机模式。 slaveof no one 再次查看主从信息，可以看到从节点已变为主" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/a19b8da8ea8c018a12fd36ebff14d862/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-07-05T16:15:16+08:00" />
<meta property="article:modified_time" content="2023-07-05T16:15:16+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Redis部署全攻略——主从模式</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="%E4%B8%BB%E8%8A%82%E7%82%B9%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-toc" style="margin-left:0px;"><a href="#%E4%B8%BB%E8%8A%82%E7%82%B9%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6" rel="nofollow">主节点修改配置文件</a></p> 
<p id="%E4%BB%8E%E8%8A%82%E7%82%B9%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%C2%A0-toc" style="margin-left:0px;"><a href="#%E4%BB%8E%E8%8A%82%E7%82%B9%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%C2%A0" rel="nofollow">从节点修改配置文件 </a></p> 
<p id="%E5%90%AF%E5%8A%A8%E4%B8%BB%E4%BB%8E%E8%8A%82%E7%82%B9-toc" style="margin-left:0px;"><a href="#%E5%90%AF%E5%8A%A8%E4%B8%BB%E4%BB%8E%E8%8A%82%E7%82%B9" rel="nofollow">启动主从节点</a></p> 
<p id="%E9%AA%8C%E8%AF%81redis%E4%B8%BB%E4%BB%8E%E6%A8%A1%E5%BC%8F-toc" style="margin-left:0px;"><a href="#%E9%AA%8C%E8%AF%81redis%E4%B8%BB%E4%BB%8E%E6%A8%A1%E5%BC%8F" rel="nofollow">验证redis主从模式</a></p> 
<p id="%E6%9F%A5%E7%9C%8B%E8%BF%9B%E7%A8%8B%EF%BC%88%E6%89%80%E6%9C%89%E4%B8%BB%E4%BB%8E%E4%B8%BB%E6%9C%BA%E5%88%86%E5%88%AB%E6%9F%A5%E7%9C%8B%E5%90%AF%E5%8A%A8%E7%BB%93%E6%9E%9C%EF%BC%89-toc" style="margin-left:40px;"><a href="#%E6%9F%A5%E7%9C%8B%E8%BF%9B%E7%A8%8B%EF%BC%88%E6%89%80%E6%9C%89%E4%B8%BB%E4%BB%8E%E4%B8%BB%E6%9C%BA%E5%88%86%E5%88%AB%E6%9F%A5%E7%9C%8B%E5%90%AF%E5%8A%A8%E7%BB%93%E6%9E%9C%EF%BC%89" rel="nofollow">查看进程（所有主从主机分别查看启动结果）</a></p> 
<p id="%E7%99%BB%E5%BD%95%E4%B8%BB%E8%8A%82%E7%82%B9%E5%AE%A2%E6%88%B7%E7%AB%AF%E9%AA%8C%E8%AF%81-toc" style="margin-left:40px;"><a href="#%E7%99%BB%E5%BD%95%E4%B8%BB%E8%8A%82%E7%82%B9%E5%AE%A2%E6%88%B7%E7%AB%AF%E9%AA%8C%E8%AF%81" rel="nofollow">登录主节点客户端验证</a></p> 
<p id="%C2%A0%E7%99%BB%E5%BD%95%E4%BB%8E%E8%8A%82%E7%82%B9%E8%BF%9B%E8%A1%8C%E9%AA%8C%E8%AF%81-toc" style="margin-left:40px;"><a href="#%C2%A0%E7%99%BB%E5%BD%95%E4%BB%8E%E8%8A%82%E7%82%B9%E8%BF%9B%E8%A1%8C%E9%AA%8C%E8%AF%81" rel="nofollow"> 登录从节点进行验证</a></p> 
<p id="%E4%B8%BB%E4%BB%8E%E5%88%87%E6%8D%A2-toc" style="margin-left:0px;"><a href="#%E4%B8%BB%E4%BB%8E%E5%88%87%E6%8D%A2" rel="nofollow">主从切换</a></p> 
<hr id="hr-toc"> 
<p></p> 
<ol><li style="text-align:justify;"><span style="color:#ff0000;">主从模式下，主节点宕机，从节点无法自动升级为主节点，需要人为干预。</span></li><li style="text-align:justify;"><span style="color:#ff0000;">分别在两台主机上进行安装，安装过程与单机模式相同，不再赘述。</span></li><li style="text-align:justify;"><span style="color:#ff0000;">以下配置内容，均在单机模式的基础上进行增加额外的配置。</span></li></ol> 
<h2 id="%E4%B8%BB%E8%8A%82%E7%82%B9%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6" style="text-align:justify;">主节点修改配置文件</h2> 
<p>如要为redis设定密码，则在配置文件redis.conf中添加requirepass XXXXXX和masterauth XXXXXX，其中XXXXXX即为密码。</p> 
<ul><li>masterauth作用：主要是针对master对应的slave节点设置的，在slave节点数据同步的时候用到。</li><li>requirepass作用：对登录权限做限制，redis每个节点的requirepass可以是独立、不同的。</li><li>建议两个密码设置为相同密码，防止因为对应关系错误导致无法正常使用</li></ul> 
<p>如：</p> 
<p> <img alt="" height="41" src="https://images2.imgbox.com/c7/86/Xi512v8e_o.png" width="250"> </p> 
<h2 id="%E4%BB%8E%E8%8A%82%E7%82%B9%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%C2%A0">从节点修改配置文件 </h2> 
<p></p> 
<ul><li>如主节点配置了master密码，则从节点也许对应设置，在配置文件redis.conf中添加requirepass XXXXXX和masterauth XXXXXX，其中XXXXXX即为密码。 
  <ul><li>masterauth作用：主要是针对master对应的slave节点设置的，在slave节点数据同步的时候用到。</li><li>requirepass作用：对登录权限做限制，redis每个节点的requirepass可以是独立、不同的。</li><li>建议两个密码设置为相同密码，防止因为对应关系错误导致无法正常使用</li></ul></li></ul> 
<p>如：</p> 
<p><img alt="" height="41" src="https://images2.imgbox.com/32/4b/7fomIkKV_o.png" width="250"></p> 
<ul><li>从节点配置主节点同步信息</li></ul> 
<p style="margin-left:.0001pt;text-align:justify;">找到replicaof配置信息（大约在479行），去除注释并配置主节点信息如下：</p> 
<pre><code class="language-bash">replicaof 10.8.15.102 6379</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="30" src="https://images2.imgbox.com/7c/95/KWGZVCPS_o.png" width="270"></p> 
<h2 id="%E5%90%AF%E5%8A%A8%E4%B8%BB%E4%BB%8E%E8%8A%82%E7%82%B9">启动主从节点</h2> 
<p><span style="color:#5b9bd5;">指定配置文件启动</span><span style="color:#5b9bd5;">（</span><span style="color:#5b9bd5;">分别启动主从节点</span><span style="color:#5b9bd5;">）</span></p> 
<pre><code class="language-bash">/opt/tools/redis-6.2.7/src/redis-server /opt/tools/redis-cluster/redis.conf</code></pre> 
<h2 id="%E9%AA%8C%E8%AF%81redis%E4%B8%BB%E4%BB%8E%E6%A8%A1%E5%BC%8F">验证redis主从模式</h2> 
<h3 id="%E6%9F%A5%E7%9C%8B%E8%BF%9B%E7%A8%8B%EF%BC%88%E6%89%80%E6%9C%89%E4%B8%BB%E4%BB%8E%E4%B8%BB%E6%9C%BA%E5%88%86%E5%88%AB%E6%9F%A5%E7%9C%8B%E5%90%AF%E5%8A%A8%E7%BB%93%E6%9E%9C%EF%BC%89"><span style="color:#5b9bd5;">查看进程</span><span style="color:#5b9bd5;">（</span><span style="color:#5b9bd5;">所有主从</span><span style="color:#5b9bd5;">主机分别查看启动结果）</span></h3> 
<pre><code class="language-bash">ps -ef|grep redis</code></pre> 
<p><img alt="" height="47" src="https://images2.imgbox.com/1b/da/zwRJZXPR_o.png" width="554"></p> 
<h3 id="%E7%99%BB%E5%BD%95%E4%B8%BB%E8%8A%82%E7%82%B9%E5%AE%A2%E6%88%B7%E7%AB%AF%E9%AA%8C%E8%AF%81"><span style="color:#5b9bd5;">登录</span><span style="color:#5b9bd5;">主节点</span><span style="color:#5b9bd5;">客户端验证</span></h3> 
<pre><code class="language-bash">/opt/tools/redis-6.2.6/src/redis-cli -h 10.8.10.125 -p 6379</code></pre> 
<p> <img alt="" height="47" src="https://images2.imgbox.com/2d/77/mQrEyuBM_o.png" width="554"></p> 
<p style="margin-left:.0001pt;text-align:justify;">若有设置密码，则auth 密码进入</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="82" src="https://images2.imgbox.com/6b/c7/oJBoI2XU_o.png" width="555"></p> 
<ul><li>查看集群信息</li></ul> 
<pre><code class="language-bash">info Replication</code></pre> 
<p> <img alt="" height="254" src="https://images2.imgbox.com/1b/b5/v4yJfmYQ_o.png" width="554"></p> 
<ul><li>创建key进行测试</li></ul> 
<pre><code class="language-bash">#创建key
set name "test"
#获取key
get name</code></pre> 
<p><img alt="" height="82" src="https://images2.imgbox.com/08/2f/8O8LX38r_o.png" width="334"></p> 
<h3 id="%C2%A0%E7%99%BB%E5%BD%95%E4%BB%8E%E8%8A%82%E7%82%B9%E8%BF%9B%E8%A1%8C%E9%AA%8C%E8%AF%81"> <span style="color:#5b9bd5;">登录从节点进行验证</span></h3> 
<ul><li>查看集群信息</li></ul> 
<pre><code class="language-bash">info Replication</code></pre> 
<p><img alt="" height="254" src="https://images2.imgbox.com/e8/b0/OwcpfsF9_o.png" width="554"></p> 
<ul><li>获取主节点创建的key进行测试</li></ul> 
<pre><code class="language-bash">#获取key
get name</code></pre> 
<p><img alt="" height="46" src="https://images2.imgbox.com/32/d3/JdzdcTIu_o.png" width="272"></p> 
<p>可正确获取，表明主从建立成功</p> 
<h2 id="%E4%B8%BB%E4%BB%8E%E5%88%87%E6%8D%A2" style="text-align:justify;"><strong><strong><strong>主从切换</strong></strong></strong></h2> 
<p> redis的主从模式，不支持自动切换主从节点。意味着当主节点宕机后，需要手动切换为主节点；主节点恢复后，也需要手动切换原从节点为从节点。</p> 
<ul><li style="text-align:justify;">关闭主节点，模拟主节点宕机</li></ul> 
<pre><code class="language-bash">shutdown save</code></pre> 
<p><img alt="" height="49" src="https://images2.imgbox.com/08/a7/0qd84Uih_o.png" width="321"></p> 
<ul><li style="text-align:justify;">手动关闭从节点复制功能，使其临时变更为单机模式。</li></ul> 
<pre><code class="language-bash">slaveof no one</code></pre> 
<p><img alt="" height="46" src="https://images2.imgbox.com/74/46/xO8VIfGa_o.png" width="328"></p> 
<p style="text-align:justify;">再次查看主从信息，可以看到从节点已变为主</p> 
<p style="text-align:justify;"><img alt="" height="257" src="https://images2.imgbox.com/36/40/v8YQ0HAA_o.png" width="554"></p> 
<p style="text-align:justify;">slaveof no one命令只是临时生效。若主节点一时半会无法修复，需将从节点长期变更为主节点，则需将从节点的配置文件redis.conf中注释掉replicaof。</p> 
<ul><li> 切换原从节点为从节点</li></ul> 
<p> 当主节点修复后，可选择重启从节点，使其重新开启从节点的复制功能。若不想重启，也可通过命令手动开启复制。</p> 
<pre><code class="language-bash">replicaof 10.8.15.102 6379</code></pre> 
<p><img alt="" height="45" src="https://images2.imgbox.com/85/7d/tSHUSHrx_o.png" width="451"></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5e497890ee556f480c6accb93213cbe9/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Linux 系统（Ubuntu）下安装 Qt 环境</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/75b523ede46203baff5d156de12485bb/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">TiDB部署全攻略——安全加固</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>