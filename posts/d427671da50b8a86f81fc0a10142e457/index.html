<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>postgres-exporter部署书册 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="postgres-exporter部署书册" />
<meta property="og:description" content="目录 postgres-exporter部署书册来源说明兼容性部署方式docker部署：二进制文件部署： postgres-exporter部署书册 来源 https://github.com/prometheus-community/postgres_exporter
说明 用于 PostgreSQL 服务器指标的 Prometheus 导出器。
兼容性 PostgreSQL 可用版本：9.4, 9.5, 9.6, 10, 11, 12,13
部署方式 docker部署： Start an example database:
docker run --net=host -it --rm -e POSTGRES_PASSWORD=password postgres Connect to it:
docker run --net=host -e DATA_SOURCE_NAME=&#34;postgresql://postgres:password@localhost:5432/postgres?sslmode=disable&#34; quay.io/prometheuscommunity/postgres-exporter 二进制文件部署： 使用环境变量运行：
export DATA_SOURCE_NAME=&#34;user=postgres_exporter host=192.168.12.50 password=123456a? port=9999 dbname=postgres sslmode=disable&#34; ./postgres_exporter &lt;flags&gt; 注：
PostgreSQL 服务器的数据源名称 必须通过DATA_SOURCE_NAME环境变量设置。
解压进入目录执行./postgres_exporter --help可查看具体配置项:
usage: postgres_exporter [&lt;flags&gt;] Flags: --help Show context-sensitive help (also try --help-long and --help-man)." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/d427671da50b8a86f81fc0a10142e457/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-07-16T14:11:51+08:00" />
<meta property="article:modified_time" content="2021-07-16T14:11:51+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">postgres-exporter部署书册</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#postgresexporter_1" rel="nofollow">postgres-exporter部署书册</a></li><li><ul><li><a href="#_2" rel="nofollow">来源</a></li><li><a href="#_4" rel="nofollow">说明</a></li><li><a href="#_6" rel="nofollow">兼容性</a></li><li><a href="#_8" rel="nofollow">部署方式</a></li><li><ul><li><a href="#docker_9" rel="nofollow">docker部署：</a></li><li><a href="#_18" rel="nofollow">二进制文件部署：</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="postgresexporter_1"></a>postgres-exporter部署书册</h2> 
<h3><a id="_2"></a>来源</h3> 
<p><a href="https://github.com/prometheus-community/postgres_exporter">https://github.com/prometheus-community/postgres_exporter</a></p> 
<h3><a id="_4"></a>说明</h3> 
<p>用于 PostgreSQL 服务器指标的 Prometheus 导出器。</p> 
<h3><a id="_6"></a>兼容性</h3> 
<p>PostgreSQL 可用版本：9.4, 9.5, 9.6, 10, 11, 12,13</p> 
<h3><a id="_8"></a>部署方式</h3> 
<h4><a id="docker_9"></a>docker部署：</h4> 
<p>Start an example database:</p> 
<pre><code>docker run --net=host -it --rm -e POSTGRES_PASSWORD=password postgres
</code></pre> 
<p>Connect to it:</p> 
<pre><code>docker run  --net=host -e DATA_SOURCE_NAME="postgresql://postgres:password@localhost:5432/postgres?sslmode=disable" quay.io/prometheuscommunity/postgres-exporter
</code></pre> 
<h4><a id="_18"></a>二进制文件部署：</h4> 
<p>使用环境变量运行：</p> 
<pre><code>export  DATA_SOURCE_NAME="user=postgres_exporter host=192.168.12.50 password=123456a? port=9999 dbname=postgres sslmode=disable"
./postgres_exporter &lt;flags&gt;
</code></pre> 
<p><strong>注：</strong><br> PostgreSQL 服务器的数据源名称 必须通过DATA_SOURCE_NAME环境变量设置。</p> 
<p>解压进入目录执行./postgres_exporter --help可查看具体配置项:</p> 
<pre><code>usage: postgres_exporter [&lt;flags&gt;]

Flags:
  --help                        Show context-sensitive help (also try
                                --help-long and --help-man).
  --web.listen-address=":9187"  Address to listen on for web interface and
                                telemetry.
  --web.telemetry-path="/metrics"
                                Path under which to expose metrics.
  --disable-default-metrics     Do not include default metrics.
  --disable-settings-metrics    Do not include pg_settings metrics.
  --auto-discover-databases     Whether to discover the databases on a server
                                dynamically.
  --extend.query-path=""        Path to custom queries to run.
  --dumpmaps                    Do not run, simply dump the maps.
  --constantLabels=""           A list of label=value separated by comma(,).
  --exclude-databases=""        A list of databases to remove when
                                autoDiscoverDatabases is enabled
  --metric-prefix="pg"          A metric prefix can be used to have non-default
                                (not "pg") prefixes for each of the metrics
  --version                     Show application version.
  --log.level="info"            Only log messages with the given severity or
                                above. Valid levels: [debug, info, warn, error,
                                fatal]
  --log.format="logger:stderr"  Set the log target and format. Example:
                                "logger:syslog?appname=bob&amp;local=7" or
                                "logger:stdout?json=true"

</code></pre> 
<p><strong>注：</strong><br> 以非超级用户身份运行：<br>   为了能够从pg_stat_activity和pg_stat_replication 作为非超级用户收集指标，您必须以超级用户的身份创建功能和视图，并分别为它们分配权限。<br>   在 PostgreSQL 中，视图通过创建它们的用户的权限运行，因此它们可以充当安全屏障。需要创建函数以与非超级用户共享此数据。只有创建视图才会遗漏最重要的数据位。</p> 
<pre><code>-- To use IF statements, hence to be able to check if the user exists before
-- attempting creation, we need to switch to procedural SQL (PL/pgSQL)
-- instead of standard SQL.
-- More: https://www.postgresql.org/docs/9.3/plpgsql-overview.html
-- To preserve compatibility with &lt;9.0, DO blocks are not used; instead,
-- a function is created and dropped.
CREATE OR REPLACE FUNCTION __tmp_create_user() returns void as $$
BEGIN
  IF NOT EXISTS (
          SELECT                       -- SELECT list can stay empty for this
          FROM   pg_catalog.pg_user
          WHERE  usename = 'postgres_exporter') THEN
    CREATE USER postgres_exporter;
  END IF;
END;
$$ language plpgsql;

SELECT __tmp_create_user();
DROP FUNCTION __tmp_create_user();

ALTER USER postgres_exporter WITH PASSWORD 'password';
ALTER USER postgres_exporter SET SEARCH_PATH TO postgres_exporter,pg_catalog;

-- If deploying as non-superuser (for example in AWS RDS), uncomment the GRANT
-- line below and replace &lt;MASTER_USER&gt; with your root user.
-- GRANT postgres_exporter TO &lt;MASTER_USER&gt;;
CREATE SCHEMA IF NOT EXISTS postgres_exporter;
GRANT USAGE ON SCHEMA postgres_exporter TO postgres_exporter;
GRANT CONNECT ON DATABASE postgres TO postgres_exporter;

CREATE OR REPLACE FUNCTION get_pg_stat_activity() RETURNS SETOF pg_stat_activity AS
$$ SELECT * FROM pg_catalog.pg_stat_activity; $$
LANGUAGE sql
VOLATILE
SECURITY DEFINER;

CREATE OR REPLACE VIEW postgres_exporter.pg_stat_activity
AS
  SELECT * from get_pg_stat_activity();

GRANT SELECT ON postgres_exporter.pg_stat_activity TO postgres_exporter;

CREATE OR REPLACE FUNCTION get_pg_stat_replication() RETURNS SETOF pg_stat_replication AS
$$ SELECT * FROM pg_catalog.pg_stat_replication; $$
LANGUAGE sql
VOLATILE
SECURITY DEFINER;

CREATE OR REPLACE VIEW postgres_exporter.pg_stat_replication
AS
  SELECT * FROM get_pg_stat_replication();

GRANT SELECT ON postgres_exporter.pg_stat_replication TO postgres_exporter;

CREATE OR REPLACE FUNCTION get_pg_stat_statements() RETURNS SETOF pg_stat_statements AS
$$ SELECT * FROM public.pg_stat_statements; $$
LANGUAGE sql
VOLATILE
SECURITY DEFINER;

CREATE OR REPLACE VIEW postgres_exporter.pg_stat_statements
AS
  SELECT * FROM get_pg_stat_statements();

GRANT SELECT ON postgres_exporter.pg_stat_statements TO postgres_exporter;
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9920a6da05fc5313cf44da499018c5a9/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">计算机主板设置怎么恢复出场设置密码,高手教你如何快速还原BIOS出厂设置</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/89f369567cd7c0a449e07f5d8b13a60e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">rabbitmq-exporter部署方式</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>