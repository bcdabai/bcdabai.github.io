<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>DM-DM DBLINK使用配置 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="DM-DM DBLINK使用配置" />
<meta property="og:description" content="简单介绍 DM-DM DBLINK支持3种连接方式创建，分别是：dmmal、dpi、odbc。
其中dpi、odbc属于第三方接口，dmmal属于原生接口。dpi类型dblink为新版本新添加支持，以前版本中不支持。
环境说明 （1）数据库版本：
DM Database Server 64 V8
DB Version: 0x7000c
03134283904-20220714-165042-20005
（2）数据库信息
本地：端口 5236，实例名DMSERVER01，字符集GB18030
远端：端口 5237，实例名DMSERVER02，字符集GB18030
（3）已配置LD_LIBRARY_PATH环境变量
echo /usr/local/lib &gt; /etc/ld.so.conf.d/libodbc.conf echo /home/dmdba/dm128/bin &gt; /etc/ld.so.conf.d/dm8.conf ldconfig 使用配置 dmmal方式 dmmal类型dblink，需要两端数据库设置dm.ini参数MAL_INI=1，并配置相同的dmmal.ini文件，重启数据库服务生效。
创建语法：
---方式1 ---mal_inst_host/mal_inst_port create link &#34;链接名&#34; connect &#39;DAMENG&#39; with &#34;用户名&#34; identified by &#34;密码&#34; using &#39;实例IP地址/实例端口号&#39;; ---方式2 ---mal_host/mal_port create link &#34;链接名&#34; connect &#39;DAMENG&#39; with &#34;用户名&#34; identified by &#34;密码&#34; using &#39;MAL IP地址/MAL 端口号&#39;; ---方式3 ---mal_inst_name create link &#34;链接名&#34; connect &#39;DAMENG&#39; with &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/3a7451b142c80eaa586abf41230ac79f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-10-25T19:15:45+08:00" />
<meta property="article:modified_time" content="2022-10-25T19:15:45+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">DM-DM DBLINK使用配置</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_0"></a>简单介绍</h3> 
<p>DM-DM DBLINK支持3种连接方式创建，分别是：dmmal、dpi、odbc。<br> 其中dpi、odbc属于第三方接口，dmmal属于原生接口。dpi类型dblink为新版本新添加支持，以前版本中不支持。</p> 
<h3><a id="_4"></a>环境说明</h3> 
<p>（1）数据库版本：<br> DM Database Server 64 V8<br> DB Version: 0x7000c<br> 03134283904-20220714-165042-20005<br> （2）数据库信息<br> 本地：端口 5236，实例名DMSERVER01，字符集GB18030<br> 远端：端口 5237，实例名DMSERVER02，字符集GB18030<br> （3）已配置LD_LIBRARY_PATH环境变量</p> 
<pre><code>echo /usr/local/lib &gt; /etc/ld.so.conf.d/libodbc.conf
echo /home/dmdba/dm128/bin &gt; /etc/ld.so.conf.d/dm8.conf
ldconfig
</code></pre> 
<h3><a id="_18"></a>使用配置</h3> 
<h4><a id="dmmal_19"></a>dmmal方式</h4> 
<p>dmmal类型dblink，需要两端数据库设置dm.ini参数MAL_INI=1，并配置相同的dmmal.ini文件，重启数据库服务生效。<br> 创建语法：</p> 
<pre><code class="prism language-SQL">---方式1  ---mal_inst_host/mal_inst_port
create link "链接名" connect 'DAMENG' with "用户名" identified by "密码" using '实例IP地址/实例端口号';  
---方式2  ---mal_host/mal_port
create link "链接名" connect 'DAMENG' with "用户名" identified by "密码" using 'MAL IP地址/MAL 端口号';  
---方式3  ---mal_inst_name
create link "链接名" connect 'DAMENG' with "用户名" identified by "密码" using '实例名';  
</code></pre> 
<h5><a id="Step1_dmmal_30"></a>Step1 两端数据库配置dmmal（操作以及文件内容均相同）</h5> 
<p>1、设置dm.ini文件中MAL_INI参数值为1</p> 
<pre><code>sp_set_para_value(2,'MAL_INI',1);
或者直接vi dm.ini文件修改文件中MAL_INI参数值
</code></pre> 
<p>2、创建并配置dmmal.ini文件，（dmmal.ini文件路径为dm.ini中的CONFIG_PATH值，默认与系统库目录相同）<br> vi dmmal.ini 内容如下：</p> 
<pre><code>[MAL_INST1]
MAL_INST_NAME=DMSERVER01
MAL_HOST=192.168.238.20
MAL_PORT=62141
MAL_INST_PORT=5236
MAL_INST_HOST=192.168.238.20
[MAL_INST2]
MAL_INST_NAME=DMSERVER02
MAL_HOST=192.168.238.20
MAL_PORT=62142
MAL_INST_PORT=5237
MAL_INST_HOST=192.168.238.20
</code></pre> 
<blockquote> 
 <p>关于dmmal.ini中相关配置项的含义，参考《DM8 系统管理员手册》。</p> 
</blockquote> 
<p>3、重启两端数据库服务<br> cd $DM_HOME/bin<br> ./DmServiceXXX restart</p> 
<h5><a id="Step2_DBLINK_58"></a>Step2 创建DBLINK</h5> 
<p>本地库访问远端库，在本地库中创建dblink。</p> 
<pre><code class="prism language-SQL">################方式1
SQL&gt; create link LINK_M1 connect 'DAMENG' with "SYSDBA" identified by "SYSDBA" using '192.168.238.20/5237';  
操作已执行
已用时间: 17.286(毫秒). 执行号:1300.
SQL&gt; 
SQL&gt; select * from T1@LINK_M1;

行号     ID         
---------- -----------
1          1
SQL&gt; 

################方式2
SQL&gt; create link LINK_M2 connect 'DAMENG' with "SYSDBA" identified by "SYSDBA" using '192.168.238.20/62142';
操作已执行
已用时间: 6.763(毫秒). 执行号:1302.
SQL&gt; select * from T1@LINK_M2;

行号     ID         
---------- -----------
1          1

已用时间: 14.197(毫秒). 执行号:1303.
SQL&gt; 

################方式3
SQL&gt; create link LINK_M3 connect 'DAMENG' with "SYSDBA" identified by "SYSDBA" using 'DMSERVER02';  
操作已执行
已用时间: 6.312(毫秒). 执行号:1304.
SQL&gt; select * from T1@LINK_M3;

行号     ID         
---------- -----------
1          1

已用时间: 16.392(毫秒). 执行号:1305.
SQL&gt; 

</code></pre> 
<h4><a id="ODBC_100"></a>ODBC方式</h4> 
<p>odbc类型的dblink，本地端数据库服务器上需要安装odbc包，并配置odbc数据源。<br> 创建语法：</p> 
<pre><code class="prism language-SQL">create link "链接名" connect 'ODBC' with "用户名" identified by "密码" using 'ODBC数据源名称';  
</code></pre> 
<h5><a id="Step1_ODBC_106"></a>Step1 配置ODBC数据源</h5> 
<p>1、Linux环境odbc包安装（两种方式均可）<br> （1）方式一、源码编译安装<br> [root@localhost ~]# tar -zxvf unixODBC-2.3.9.tar.gz<br> [root@localhost ~]# cd unixODBC-2.3.9<br> [root@localhost unixODBC-2.3.9]# ./configure --enable-gui=no<br> [root@localhost unixODBC-2.3.9]# make<br> [root@localhost unixODBC-2.3.9]# make install</p> 
<p>（2）方式二、yum安装unixODBC、unixODBC-devel</p> 
<p>（3）配置odbcinst.ini和odbc.ini文件<br> 源码编译方式安装的odbc包对应配置文件目录为： /usr/local/etc/<br> yum方式安装的odbc包对应的配置文件路径为：/etc</p> 
<p>odbcinst.ini配置文件内容：</p> 
<pre><code>[DM8 ODBC DRIVER]
Description=ODBC DRIVER FOR DM8
DRIVER=/home/dmdba/dm128/bin/libdodbc.so  ---$DM_HOME/bin/libdodbc.so
</code></pre> 
<p>odbc.ini 配置文件内容：</p> 
<pre><code>#####IP方式访问
[dm8]
Description=DM ODBC DSND
Driver= DM8 ODBC DRIVER
SERVER=192.168.238.20
UID=SYSDBA
PWD=SYSDBA
TCP_PORT=5237

#####DM 服务名方式访问
[dm8_svc]
Description=DM ODBC DSND
Driver= DM8 ODBC DRIVER
SERVER=SERVER_5237   ### dm_svc.conf中配置的服务名
UID=SYSDBA
PWD=SYSDBA
TCP_PORT=5237

</code></pre> 
<p>（4）dm_svc.conf文件配置如下：<br> [root@localhost ~]# cat /etc/dm_svc.conf</p> 
<pre><code>TIME_ZONE=(480)
LANGUAGE=(cn)

SERVER_5237=(192.168.238.20:5237)
</code></pre> 
<p>2、Windows环境ODBC配置<br> Windows系统配置较简单，Windows管理工具中打开"ODBC数据源(64位)"进行配置DSN。</p> 
<h5><a id="Step2_DBLINK_160"></a>Step2 创建DBLINK</h5> 
<p>本地库访问远端库，在本地库中创建dblink。</p> 
<pre><code class="prism language-SQL">####使用IP方式的odbc数据源
SQL&gt; create link LINK_ODBC connect 'ODBC' with "SYSDBA" identified by "SYSDBA" using 'dm8';
操作已执行
已用时间: 17.831(毫秒). 执行号:1600.
SQL&gt; select * from T1@LINK_ODBC;

行号     ID         
---------- -----------
1          1

####使用服务名方式的odbc数据源
SQL&gt; create link LINK_ODBC_SVC connect 'ODBC' with "SYSDBA" identified by "SYSDBA" using 'dm8_svc';
操作已执行
已用时间: 9.148(毫秒). 执行号:700.
SQL&gt; select * from T1@LINK_ODBC_SVC;

行号     ID         
---------- -----------
1          1

已用时间: 80.391(毫秒). 执行号:701.
SQL&gt; 
</code></pre> 
<h4><a id="DPI_186"></a>DPI方式</h4> 
<p>dpi类型的dblink，达梦数据库软件安装完成后自带DPI库，无需进行其他配置操作即可在数据库中直接创建dblink。<br> 创建语法：</p> 
<pre><code class="prism language-SQL">---方式1  IP:端口
create link "链接名" connect 'DPI' with "用户名" identified by "密码" using 'IP:端口';  
---方式2  使用dm_svc.conf中服务名
create link "链接名" connect 'DPI' with "用户名" identified by "密码" using '服务名';  
</code></pre> 
<h5><a id="DBLINK_195"></a>创建DBLINK示例</h5> 
<pre><code class="prism language-SQL">#### IP:Port的方式
SQL&gt; create link LINK_DPI connect 'DPI' with "SYSDBA" identified by "SYSDBA" using '192.168.238.20:5237';
操作已执行
已用时间: 13.716(毫秒). 执行号:1800.
SQL&gt; select * from t1@LINK_DPI;

行号     ID         
---------- -----------
1          1

已用时间: 9.878(毫秒). 执行号:1801.

#### 服务名的方式
SQL&gt; create link LINK_DPI_SVC connect 'DPI' with "SYSDBA" identified by "SYSDBA" using 'SERVER_5237';
操作已执行
已用时间: 776.228(毫秒). 执行号:702.
SQL&gt; 
SQL&gt; select * from T1@LINK_DPI_SVC;

行号     ID         
---------- -----------
1          1

已用时间: 158.347(毫秒). 执行号:703.
</code></pre> 
<h4><a id="DBLINK_223"></a>DBLINK使用限制</h4> 
<p><img src="https://images2.imgbox.com/17/7f/EXl4ibxE_o.png" alt="20220801170257"><br> 注：上述第8项主要是指dmmal方式的dblink。</p> 
<h4><a id="_227"></a>测试遇到的问题</h4> 
<p>在上面测试中使用<strong>服务名</strong>方式创建DBLINK之后，使用对应dblink查询遇到报错"连接丢失"。初步判断该问题的原因可能是环境变量加载的问题，本次测试时处理的方法是重启数据库服务（或者重启操作系统）解决，使用数据库IP均正常。</p> 
<h3><a id="_230"></a>简单总结</h3> 
<p>1、当前版本开始，达梦数据库DBLINK的支持多种类型的DBLINK，包括DM-DM、ODBC、DPI、DM-ORACLE(OCI)。<br> 2、对于DM与DM之间的DBLINK，三种方式中，使用DPI方式配置上最为方便，ODBC方式需要安装ODBC包并配置ODBC数据源，dmmal方式需要设置MAL_INI数据库参数、配置dmmal.ini文件并需要重启数据库服务。<br> 3、该版本之后的正式发布的版本，ODBC、DPI方式应该支持了本地端通过创建远端对象dblink同义词（包同义词、序列同义词、函数同义词等）调用相关方法。比如：</p> 
<pre><code class="prism language-sql"><span class="token comment">---seq1为远端序列</span>
<span class="token keyword">create</span> <span class="token operator">or</span> <span class="token keyword">replace</span> SYNONYM sym_seq1 <span class="token keyword">for</span> seq1<span class="token variable">@LINK1</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> sym_seq1<span class="token punctuation">.</span>nextval <span class="token keyword">from</span> dual<span class="token punctuation">;</span>
</code></pre> 
<p>4、使用使建议阅读《SQL使用手册》上DBLINK相关使用介绍以及使用限制。<br> 5、随着产品不断完善，DBLINK支持的相关功能也会越来越完善。大家如果有其他DBLINK相关需求以及其他功能需求可以在社区发帖留言。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/8cdfa5b976b80704b64ca5b54705d5b2/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">使用mybatis-plus批量插入遇到的两个问题记录</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0259203340b7f534d22037b2eada3e08/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">SQL语句中不可见字符M-oM-；M-?导致语句执行失败</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>