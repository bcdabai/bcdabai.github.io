<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Jupyter Notebook 遇上 NebulaGraph，可视化探索图数据库 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Jupyter Notebook 遇上 NebulaGraph，可视化探索图数据库" />
<meta property="og:description" content="在之前的《手把手教你用 NebulaGraph AI 全家桶跑图算法》中，除了介绍了 ngai 这个小工具之外，还提到了一件事有了 Jupyter Notebook 插件: https://github.com/wey-gu/ipython-ngql，可以更便捷地操作 NebulaGraph。
本文就手把手教你咋在 Jupyter Notebook 中，愉快地玩图数据库。
只要你仔细读完本文，一条 %ngql MATCH p=(n:player)-&gt;() RETURN p 命令就可以直接查询出数据，再接上 %ng_draw 就可以画出返回结果。
下面，进入今天的主菜——Jupyter Notebook 扩展：ipython-ngql。
其实，ipython-ngql 这个扩展断断续续地开发了两年，我一直没有开发完成。恰好之前有空，并完成了一直以来的心愿，把 ipython-ngql 重构并正式发布了。它除了完全适配 NebulaGrpah 3.x 所有查询之外，还支持了 Notebook 内的返回结果可视化。
在介绍 ipython-ngql 是什么之前，我先做个简单的 Jupyter Notebook 介绍，虽然大多数的 Python 开发都知道。
什么是 Jupyter Notebook Jupyter Notebook / Jupyter Labs 项目最初起源自 IPython 这个项目，后者是一个命令行上的交互式 Python 解释环境。因为有很好的补全、高亮和丰富的扩展能力，IPython 很快就成为了 Python 的第一 IDLE 替代项目，并且后来衍生出来了可以在浏览器里做更多事情的笔记本模式。
Jupyter 的笔记本模式改变了数据科学和相关科研、工业领域里人们协作、开发、分享面向数据的工作方式。有了它，我们可以在一个笔记本中可复现、可分享地进行代码执行、科学计算、数据可视化等等操作，是数据科学家、科研工作者的非常喜欢的工具，而且它还早就引入了 Python 之外的很多其他语言作为执行内核支持。
因为在 Jupyter Notebook 中进行 NebulaGraph 的查询、计算、可视化一直是很多社区同学的心愿，在前阵子 NebulaGrpah AI Suite 的开发过程中，我并实现了 Jupyter 中方便进行 NetworkX / PySpark 的计算。既然有图计算了，索性我就把相关的查询、可视化功能一起做掉，并作为 Jupyter 的扩展一起发布出来给大家使用啦。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/5c17e15061d750e2f6366d42f42f7c79/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-08-08T18:08:46+08:00" />
<meta property="article:modified_time" content="2023-08-08T18:08:46+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Jupyter Notebook 遇上 NebulaGraph，可视化探索图数据库</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><img src="https://images2.imgbox.com/04/cc/4iJP7Tfv_o.jpg" alt=""></p> 
<p>在之前的《手把手教你用 NebulaGraph AI 全家桶跑图算法》中，除了介绍了 ngai 这个小工具之外，还提到了一件事有了 Jupyter Notebook 插件: <a href="https://github.com/wey-gu/ipython-ngql">https://github.com/wey-gu/ipython-ngql</a>，可以更便捷地操作 NebulaGraph。</p> 
<p>本文就手把手教你咋在 Jupyter Notebook 中，愉快地玩图数据库。</p> 
<p>只要你仔细读完本文，一条 <code>%ngql MATCH p=(n:player)-&gt;() RETURN p</code> 命令就可以直接查询出数据，再接上 <code>%ng_draw</code> 就可以画出返回结果。</p> 
<p>下面，进入今天的主菜——Jupyter Notebook 扩展：<code>ipython-ngql</code>。</p> 
<p>其实，<code>ipython-ngql</code> 这个扩展断断续续地开发了两年，我一直没有开发完成。恰好之前有空，并完成了一直以来的心愿，把 <code>ipython-ngql</code> 重构并正式发布了。它除了完全适配 NebulaGrpah 3.x 所有查询之外，还支持了 Notebook 内的返回结果可视化。</p> 
<p>在介绍 <code>ipython-ngql</code> 是什么之前，我先做个简单的 Jupyter Notebook 介绍，虽然大多数的 Python 开发都知道。</p> 
<h3><a id="_Jupyter_Notebook_14"></a>什么是 Jupyter Notebook</h3> 
<p>Jupyter Notebook / Jupyter Labs 项目最初起源自 IPython 这个项目，后者是一个命令行上的交互式 Python 解释环境。因为有很好的补全、高亮和丰富的扩展能力，IPython 很快就成为了 Python 的第一 IDLE 替代项目，并且后来衍生出来了可以在浏览器里做更多事情的笔记本模式。</p> 
<p>Jupyter 的笔记本模式改变了数据科学和相关科研、工业领域里人们协作、开发、分享面向数据的工作方式。有了它，我们可以在一个笔记本中可复现、可分享地进行代码执行、科学计算、数据可视化等等操作，是数据科学家、科研工作者的非常喜欢的工具，而且它还早就引入了 Python 之外的很多其他语言作为执行内核支持。</p> 
<p>因为在 Jupyter Notebook 中进行 NebulaGraph 的查询、计算、可视化一直是很多社区同学的心愿，在前阵子 NebulaGrpah AI Suite 的开发过程中，我并实现了 Jupyter 中方便进行 NetworkX / PySpark 的计算。既然有图计算了，索性我就把相关的查询、可视化功能一起做掉，并作为 Jupyter 的扩展一起发布出来给大家使用啦。</p> 
<h3><a id="ipythonngql__22"></a>ipython-ngql 的安装</h3> 
<p>因为 ipython-ngql 本文就是一个基于 Jupyter Notebook 的扩展，所以它的安装非常简单。只需要在 Jupyter Notebook 中执行 <code>%pip install ipython-ngql</code> ，再加载它就好：</p> 
<pre><code class="prism language-python"><span class="token operator">%</span>pip install ipython<span class="token operator">-</span>ngql
<span class="token operator">%</span>load_ext ngql
</code></pre> 
<p>然后，我们就可以用 <code>%ngql</code> 这个 Jupyter Magic word 连接 NebulaGraph 了：</p> 
<pre><code class="prism language-python"><span class="token operator">%</span>ngql <span class="token operator">-</span><span class="token operator">-</span>address <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span> <span class="token operator">-</span><span class="token operator">-</span>port <span class="token number">9669</span> <span class="token operator">-</span><span class="token operator">-</span>user root <span class="token operator">-</span><span class="token operator">-</span>password nebula <span class="token comment">#填入 ip 地址和 graphd 的端口号</span>
</code></pre> 
<p>当成功连接服务之后，<code>SHOW SPACES</code> 的结果会返回在 notebook cell 下。</p> 
<p>除了上面的扩展安装方法之外，你可以从 Docker 桌面版的扩展市场里搜索 NebulaGraph，一键安装本地开发环境。安装完毕之后，进入 NebulaGraph Docker 扩展内部，点击 NebulaGraph AI ，点击 <strong>Install NX Mode</strong> 安装本地的 NebulaGraph + Jupyter Notebook 开发环境。</p> 
<p><img src="https://images2.imgbox.com/54/c1/pmuQxW1b_o.png" alt=""></p> 
<h3><a id="_43"></a>数据查询</h3> 
<p>ipython-ngql 现在支持两种语法 <code>%ngql</code> 接单行查询和 <code>%%ngql</code> 接多行查询。</p> 
<h4><a id="_47"></a>单行查询</h4> 
<p>例如：</p> 
<pre><code class="prism language-shell">%ngql USE basketballplayer<span class="token punctuation">;</span>
%ngql MATCH <span class="token punctuation">(</span>v:player<span class="token punctuation">{<!-- --></span>name:<span class="token string">"Tim Duncan"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>--<span class="token operator">&gt;</span><span class="token punctuation">(</span>v2:player<span class="token punctuation">)</span> RETURN v2.player.name AS Name<span class="token punctuation">;</span>
</code></pre> 
<h4><a id="_56"></a>多行查询</h4> 
<p>例如：</p> 
<pre><code class="prism language-shell">%%ngql
ADD HOSTS <span class="token string">"storaged3"</span>:9779,<span class="token string">"storaged4"</span>:9779<span class="token punctuation">;</span>
SHOW HOSTS<span class="token punctuation">;</span>
</code></pre> 
<h3><a id="_66"></a>渲染结果</h3> 
<p>在任意一个查询后面紧跟着一个 <code>%ng_draw</code> 指令，就可以把结果可视化渲染出来。像是这样：</p> 
<pre><code class="prism language-python"><span class="token comment"># one query</span>
<span class="token operator">%</span>ngql GET SUBGRAPH <span class="token number">2</span> STEPS FROM <span class="token string">"player101"</span> YIELD VERTICES AS nodes<span class="token punctuation">,</span> EDGES AS relationships<span class="token punctuation">;</span>
<span class="token operator">%</span>ng_draw

<span class="token comment"># another query</span>
<span class="token operator">%</span>ngql <span class="token keyword">match</span> p<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">:</span>player<span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">return</span> p LIMIT <span class="token number">5</span>
<span class="token operator">%</span>ng_draw
</code></pre> 
<p>效果：</p> 
<p><img src="https://images2.imgbox.com/02/a4/xJHQujBo_o.png" alt="render_result"></p> 
<p>此外，你的渲染的结果还会被保存为<a href="https://github.com/wey-gu/ipython-ngql/blob/main/examples/nebulagraph_draw_match.html">单文件 html</a> ，方便我们可以内嵌到任意网页中。</p> 
<p>像是下面，其实就是一个内嵌的页面：</p> 
<p><img src="https://images2.imgbox.com/fb/5f/G9SCH06W_o.gif" alt="render_result"></p> 
<h3><a id="_90"></a>高阶用法</h3> 
<p>下面，我们来展示一些便捷的高阶用法。比如 <code>%ngql help</code>，可以获得更多帮助信息。</p> 
<h4><a id="_pandas_DF_94"></a>操作查询结果为 pandas DF</h4> 
<p>你的每次查询，返回的结果会被存到 <code>_</code> 变量中，方便我们对它进行读取。像是这样：</p> 
<p><img src="https://images2.imgbox.com/40/db/eg8Iv068_o.png" alt="load_result"></p> 
<h4><a id="_ResultSet_100"></a>返回原始 ResultSet</h4> 
<p>ipython-ngql 默认返回的结果格式是 pandas DF，如果我们想在 Jupyter Notebook 中交互地调试 Python 的 NebulaGraph 应用代码，可以将返回结果设置为原始的 ResultSet 格式，方便直观进行 query 与结果解析。例如：</p> 
<pre><code class="prism language-python">In <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token operator">%</span>config IPythonNGQL<span class="token punctuation">.</span>ngql_result_style<span class="token operator">=</span><span class="token string">"raw"</span>

In <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token operator">%</span><span class="token operator">%</span>ngql USE pokemon_club<span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">:</span> GO FROM <span class="token string">"Tom"</span> OVER owns_pokemon YIELD owns_pokemon<span class="token punctuation">.</span>_dst <span class="token keyword">as</span> pokemon_id
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">:</span> <span class="token operator">|</span> GO FROM $<span class="token operator">-</span><span class="token punctuation">.</span>pokemon_id OVER owns_pokemon REVERSELY YIELD owns_pokemon<span class="token punctuation">.</span>_dst AS Trainer_Name<span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">:</span>
Out<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
ResultSet<span class="token punctuation">(</span>ExecutionResponse<span class="token punctuation">(</span>
    error_code<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>
    latency_in_us<span class="token operator">=</span><span class="token number">3270</span><span class="token punctuation">,</span>
    data<span class="token operator">=</span>DataSet<span class="token punctuation">(</span>
        column_names<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">b'Trainer_Name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        rows<span class="token operator">=</span><span class="token punctuation">[</span>Row<span class="token punctuation">(</span>
            values<span class="token operator">=</span><span class="token punctuation">[</span>Value<span class="token punctuation">(</span>
                sVal<span class="token operator">=</span><span class="token string">b'Tom'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        Row<span class="token punctuation">(</span>
            values<span class="token operator">=</span><span class="token punctuation">[</span>Value<span class="token punctuation">(</span>
                sVal<span class="token operator">=</span><span class="token string">b'Wey'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    space_name<span class="token operator">=</span><span class="token string">b'pokemon_club'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

In <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">:</span> r <span class="token operator">=</span> _

In <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">:</span> r<span class="token punctuation">.</span>column_values<span class="token punctuation">(</span>key<span class="token operator">=</span><span class="token string">'Trainer_Name'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>cast<span class="token punctuation">(</span><span class="token punctuation">)</span>
Out<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token string">'Tom'</span>
</code></pre> 
<h4><a id="_133"></a>查询模板</h4> 
<p>除了上面那些功能，我还支持了模板功能，语法沿用了 <a href="https://jinja.palletsprojects.com/" rel="nofollow">Jinja2</a> 的 <code>{<!-- -->{ variable }}</code>。详见这个例子：</p> 
<p><img src="https://images2.imgbox.com/fb/1d/PtaTsGb8_o.png" alt="query_template"></p> 
<h3><a id="_139"></a>未来</h3> 
<p>后续，我打算增强可视化的自定义选项，也欢迎社区里的大伙来贡献新的 feature、idea。</p> 
<p>项目的 repo 在 👉🏻<a href="https://github.com/wey-gu/ipython-ngql">https://github.com/wey-gu/ipython-ngql</a></p> 
<hr> 
<p><strong>谢谢你读完本文</strong> (///▽///)</p> 
<p>如果你想尝鲜图数据库 NebulaGraph，记得去 GitHub 下载、使用、(<sup>з</sup>)-☆ star 它 -&gt; <a href="https://github.com/vesoft-inc/nebula">GitHub</a>；和其他的 NebulaGraph 用户一起交流图数据库技术和应用技能，留下<a href="https://wj.qq.com/s2/8321168/8e2f/" rel="nofollow">「你的名片」</a>一起玩耍呀~</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/efbc8967d1adde1da3b6c5b6fd85d152/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">C&#43;&#43;游戏开发《天天酷跑》</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ddc569a808f77d55bef808970df98569/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【转载】今日头条 Android ‘秒‘ 级编译速度优化</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>