<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>外卖数据库管理系统 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="外卖数据库管理系统" />
<meta property="og:description" content="环境 MySQL Community Server 8.0.25 、Python 3.8、Tkinter
需求分析 本程序模拟一个外卖平台系统，该系统由三端构成即用户&#43;商家&#43;配送员。
不同的用户(三类)有不同的ID，姓名可重名。每个用户可以下多个订单，每个订单对应一个配送员，一个订单内可包含多个同一家店铺的商品，每个商家可以同时处理来自多个用户的多个订单。一个配送员可以同时派送多个订单，订单对应的配送员由外卖平台统一分配。
三类用户均可以以自己的账号密码登录对应的系统，可以注册新账号
实现的功能： 用户：登录/注册功能，修改用户信息功能，充值账户余额功能，获取正在营业的店铺菜单功能，点外卖提交订单功能，查询订单功能。商家：登录/注册功能，一键上/下班功能 ，修改商家信息功能，营业额提现功能，商品管理模块包括：查询商品详情、新建商品、修改原有商品、删除商品功能。接单窗口显示已接单未出餐商品，标记餐品为我已出餐功能，查询最近已出餐商品功能。配送员：登录/注册功能，一键上/下班功能 ，修改个人信息功能，工资提现功能，工作窗口显示派送给自己的所有订单，修改订单状态为已完成（点击我已送达）功能，查看最近派送完成的订单功能。 数据库设计 逻辑结构设计 商家：店名，商家号，登录密码，地址，电话，营业额，状态，商品：编号，商品名，价格，商家号，库存骑手：编号，登录密码，姓名，性别，电话，工资，状态，顾客：ID，登录密码，姓名，性别，地址， 电话，余额。订单：订单号，骑手号，顾客ID，状态，备注，配送费，金额，发起时间订单详情：订单号，商品号，数量 关系属性 Store（Sno，Spass，Sname，Saddr，Stel，Smoney，Sstate）Goods（Gno，Sno，Gname，Gprice，Gstock）Customer（Cno，Cpass，Cname，Csex，Caddr，Ctel，Cmoney）Deliverer（Dno，Dpass，Dname，Dsex，Dtel，Dmoney，Dstate）Order（Ono，Dno，Cno，Ostate，Otip，ODelfee，Omoney，Obtime）Purchase（Ono，Gno，Pamount） E-R图 数据表 商店表（store） 主码：Sno自定义完整性：
CHECK (Sstate IN (‘工作’,‘休息’)),
CHECK (Smoney &gt;= 0)
商品表（goods） 主码：Gno外码：FOREIGN KEY (Sno) REFERENCES Store(Sno)
顾客表（Customer） 主码：Cno自定义完整性：
CHECK (Csex IN (‘M’,‘F’)),
CHECK (Cmoney &gt;= 0)
派送员表（deliverer） 主码：Dno自定义完整性：
CHECK (Dsex IN (‘M’,‘F’)),
CHECK (Dstate IN (‘工作’,‘休息’)),
CHECK (Dmoney &gt;= 0)
订单表（orderr） 主码：Ono外码：
FOREIGN KEY (Dno) REFERENCES Deliverer(Dno)," />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/0abfc660a33cdcbb2eb0e83f80210043/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-07-17T10:40:35+08:00" />
<meta property="article:modified_time" content="2022-07-17T10:40:35+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">外卖数据库管理系统</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <p>环境 MySQL Community Server 8.0.25 、Python 3.8、Tkinter</p> 
</blockquote> 
<hr> 
<h2><a id="_2"></a>需求分析</h2> 
<p><strong>本程序模拟一个外卖平台系统，该系统由三端构成即用户+商家+配送员。</strong><br> 不同的用户(三类)有不同的ID，姓名可重名。每个用户可以下多个订单，每个订单对应一个配送员，一个订单内可包含多个同一家店铺的商品，每个商家可以同时处理来自多个用户的多个订单。一个配送员可以同时派送多个订单，订单对应的配送员由外卖平台统一分配。<br> 三类用户均可以以自己的账号密码登录对应的系统，可以注册新账号</p> 
<h3><a id="_6"></a>实现的功能：</h3> 
<ul><li>用户：登录/注册功能，修改用户信息功能，充值账户余额功能，获取正在营业的店铺菜单功能，点外卖提交订单功能，查询订单功能。</li><li>商家：登录/注册功能，一键上/下班功能 ，修改商家信息功能，营业额提现功能，商品管理模块包括：查询商品详情、新建商品、修改原有商品、删除商品功能。接单窗口显示已接单未出餐商品，标记餐品为我已出餐功能，查询最近已出餐商品功能。</li><li>配送员：登录/注册功能，一键上/下班功能 ，修改个人信息功能，工资提现功能，工作窗口显示派送给自己的所有订单，修改订单状态为已完成（点击我已送达）功能，查看最近派送完成的订单功能。</li></ul> 
<center> 
 <img src="https://images2.imgbox.com/f4/60/K1aMpX53_o.png" width="80%"> 
</center> 
<h2><a id="_13"></a>数据库设计</h2> 
<h3><a id="_14"></a>逻辑结构设计</h3> 
<ul><li>商家：店名，商家号，登录密码，地址，电话，营业额，状态，</li><li>商品：编号，商品名，价格，商家号，库存</li><li>骑手：编号，登录密码，姓名，性别，电话，工资，状态，</li><li>顾客：ID，登录密码，姓名，性别，地址， 电话，余额。</li><li>订单：订单号，骑手号，顾客ID，状态，备注，配送费，金额，发起时间</li><li>订单详情：订单号，商品号，数量</li></ul> 
<h3><a id="_21"></a>关系属性</h3> 
<ul><li>Store（Sno，Spass，Sname，Saddr，Stel，Smoney，Sstate）</li><li>Goods（Gno，Sno，Gname，Gprice，Gstock）</li><li>Customer（Cno，Cpass，Cname，Csex，Caddr，Ctel，Cmoney）</li><li>Deliverer（Dno，Dpass，Dname，Dsex，Dtel，Dmoney，Dstate）</li><li>Order（Ono，Dno，Cno，Ostate，Otip，ODelfee，Omoney，Obtime）</li><li>Purchase（Ono，Gno，Pamount）</li></ul> 
<h3><a id="ER_28"></a>E-R图</h3> 
<center> 
 <img src="https://images2.imgbox.com/b6/77/w9NRLwvD_o.png" width="80%"> 
</center> 
<h3><a id="_32"></a>数据表</h3> 
<h4><a id="store_33"></a>商店表（store）</h4> 
<ul><li>主码：Sno</li><li>自定义完整性：<br> CHECK (Sstate IN (‘工作’,‘休息’)),<br> CHECK (Smoney &gt;= 0)<br> <img src="https://images2.imgbox.com/01/ee/3AWxCIp4_o.png" alt="在这里插入图片描述"></li></ul> 
<h4><a id="goods_40"></a>商品表（goods）</h4> 
<ul><li>主码：Gno</li><li>外码：FOREIGN KEY (Sno) REFERENCES Store(Sno)<br> <img src="https://images2.imgbox.com/ab/2a/rtYJwOCj_o.png" alt="在这里插入图片描述"></li></ul> 
<h4><a id="Customer_45"></a>顾客表（Customer）</h4> 
<ul><li>主码：Cno</li><li>自定义完整性：<br> CHECK (Csex IN (‘M’,‘F’)),<br> CHECK (Cmoney &gt;= 0)<br> <img src="https://images2.imgbox.com/7d/bd/exQ7wEKh_o.png" alt="在这里插入图片描述"></li></ul> 
<h4><a id="deliverer_51"></a>派送员表（deliverer）</h4> 
<ul><li>主码：Dno</li><li>自定义完整性：<br> CHECK (Dsex IN (‘M’,‘F’)),<br> CHECK (Dstate IN (‘工作’,‘休息’)),<br> CHECK (Dmoney &gt;= 0)<br> <img src="https://images2.imgbox.com/9e/21/3XWaSnvs_o.png" alt="在这里插入图片描述"></li></ul> 
<h4><a id="orderr_59"></a>订单表（orderr）</h4> 
<ul><li>主码：Ono</li><li>外码：<br> FOREIGN KEY (Dno) REFERENCES Deliverer(Dno),<br> FOREIGN KEY (Cno) REFERENCES Customer(Cno) ,<br> FOREIGN KEY (Sno) REFERENCES Store(Sno) ,</li><li>自定义完整性：<br> CHECK (Omoney &gt;= 0),<br> CHECK (ODelfee &gt;= 0),<br> CHECK (Ostate IN(‘正在出餐’,‘正在配送’,‘订单完成’))<br> <img src="https://images2.imgbox.com/43/f3/FahPQOIb_o.png" alt="在这里插入图片描述"></li></ul> 
<h4><a id="purchase_71"></a>订单详情表（purchase）</h4> 
<ul><li>主码：PRIMARY KEY (Ono, Gno ),</li><li>外码：FOREIGN KEY (Ono) REFERENCES Orderr(Ono) ,<br> FOREIGN KEY (Gno) REFERENCES Goods(Gno) ,<br> <img src="https://images2.imgbox.com/da/f9/SdyWDRua_o.png" alt="在这里插入图片描述"></li></ul> 
<h3><a id="_79"></a>视图</h3> 
<h4><a id="_80"></a>用户点单视图</h4> 
<p>用户点单时可以看见所有商家的所有菜品。用户需要看到的是商店名而不是商店编号，商品名而不是商品编号。</p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> view_Cus_buy <span class="token keyword">AS</span> 
<span class="token keyword">SELECT</span> Sname <span class="token string">'店名'</span><span class="token punctuation">,</span>Gname <span class="token string">'商品'</span><span class="token punctuation">,</span>Gprice <span class="token string">'价格'</span>
<span class="token keyword">FROM</span> goods<span class="token punctuation">,</span>store
<span class="token keyword">WHERE</span> goods<span class="token punctuation">.</span>Sno <span class="token operator">=</span> store<span class="token punctuation">.</span>Sno
<span class="token operator">AND</span> store<span class="token punctuation">.</span>Sstate <span class="token operator">=</span> <span class="token string">'工作'</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> store<span class="token punctuation">.</span>Sno <span class="token punctuation">;</span>
</code></pre> 
<h4><a id="_92"></a>用户订单视图</h4> 
<p>用户可以看到订单的信息。</p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> view_Cus_look <span class="token keyword">AS</span> <span class="token keyword">SELECT</span>
orderr<span class="token punctuation">.</span>Ono<span class="token punctuation">,</span>
store<span class="token punctuation">.</span>Sname<span class="token punctuation">,</span>
orderr<span class="token punctuation">.</span>Omoney<span class="token punctuation">,</span>
orderr<span class="token punctuation">.</span>Ostate<span class="token punctuation">,</span>
orderr<span class="token punctuation">.</span>Obtime<span class="token punctuation">,</span>
orderr<span class="token punctuation">.</span>Cno
<span class="token keyword">FROM</span> orderr<span class="token punctuation">,</span>store 
<span class="token keyword">WHERE</span> store<span class="token punctuation">.</span>Sno <span class="token operator">=</span> Orderr<span class="token punctuation">.</span>Sno
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> orderr<span class="token punctuation">.</span>Obtime <span class="token keyword">DESC</span> <span class="token punctuation">;</span>
</code></pre> 
<h4><a id="_107"></a>密码视图</h4> 
<p>将三类用户的密码整合在一起，并根据来源添加类型字段。方便验证密码。</p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> Password ID<span class="token punctuation">,</span><span class="token string">'密码'</span><span class="token punctuation">,</span><span class="token string">'类型'</span><span class="token keyword">AS</span> 
<span class="token keyword">SELECT</span> Cno <span class="token punctuation">,</span>Cpass <span class="token punctuation">,</span><span class="token string">'用户'</span> 
<span class="token keyword">FROM</span> Customer
<span class="token keyword">UNION</span>
<span class="token keyword">SELECT</span> Sno<span class="token punctuation">,</span>Spass<span class="token punctuation">,</span><span class="token string">'商家'</span>
<span class="token keyword">FROM</span> Store
<span class="token keyword">UNION</span>
<span class="token keyword">SELECT</span> Dno<span class="token punctuation">,</span>Dpass<span class="token punctuation">,</span><span class="token string">'配送员'</span>
<span class="token keyword">FROM</span> Deliverer <span class="token punctuation">;</span>
</code></pre> 
<h4><a id="_121"></a>配送员视图</h4> 
<p>骑手无法查看订单所有信息，需要快速查看地址电话等，故需要单独设计视图。</p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> view_del_unfinish <span class="token keyword">AS</span> 
<span class="token keyword">SELECT</span> store<span class="token punctuation">.</span>Sname<span class="token punctuation">,</span>customer<span class="token punctuation">.</span>Caddress<span class="token punctuation">,</span>customer<span class="token punctuation">.</span>Ctel<span class="token punctuation">,</span>orderr<span class="token punctuation">.</span>ODelfee<span class="token punctuation">,</span>orderr<span class="token punctuation">.</span>Ono
<span class="token keyword">FROM</span> store<span class="token punctuation">,</span>customer<span class="token punctuation">,</span>orderr
<span class="token keyword">WHERE</span> orderr<span class="token punctuation">.</span>Ostate <span class="token operator">=</span> <span class="token string">'正在配送'</span>
<span class="token operator">AND</span> orderr<span class="token punctuation">.</span>Sno<span class="token operator">=</span>store<span class="token punctuation">.</span>Sno
<span class="token operator">AND</span> orderr<span class="token punctuation">.</span>Cno<span class="token operator">=</span>customer<span class="token punctuation">.</span>Cno
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> orderr<span class="token punctuation">.</span>Obtime <span class="token keyword">DESC</span> <span class="token punctuation">;</span>
</code></pre> 
<h4><a id="_134"></a>商家端订单视图</h4> 
<p>商家看到的待出餐的订单信息。</p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> view_store_unfinish <span class="token keyword">AS</span> 
<span class="token keyword">SELECT</span> orderr<span class="token punctuation">.</span>Ono<span class="token punctuation">,</span>customer<span class="token punctuation">.</span>Cname<span class="token punctuation">,</span>customer<span class="token punctuation">.</span>Ctel<span class="token punctuation">,</span>orderr<span class="token punctuation">.</span>Omoney
<span class="token keyword">FROM</span> store<span class="token punctuation">,</span>customer<span class="token punctuation">,</span>orderr
<span class="token keyword">WHERE</span> orderr<span class="token punctuation">.</span>Ostate <span class="token operator">=</span> <span class="token string">'正在出餐'</span>
<span class="token operator">AND</span> orderr<span class="token punctuation">.</span>Sno<span class="token operator">=</span>store<span class="token punctuation">.</span>Sno
<span class="token operator">AND</span> orderr<span class="token punctuation">.</span>Cno<span class="token operator">=</span>customer<span class="token punctuation">.</span>Cno
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> orderr<span class="token punctuation">.</span>Obtime <span class="token keyword">DESC</span> <span class="token punctuation">;</span>
</code></pre> 
<h3><a id="_146"></a>存储过程</h3> 
<h4><a id="_147"></a>利用存储过程实现对金融的操作(扣款/提现/充值)</h4> 
<p>顾客的充值与扣费函数+配送员获得工作与提现函数+商家获得订单利润与提现函数。<br> 使用存储过程的好处：可以使计算过程在服务器完成，减轻本地负担，对敏感信息的操作与客户端分离，增强安全性。</p> 
<pre><code class="prism language-sql"><span class="token keyword">DELIMITER</span> $
<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> alter_del_money<span class="token punctuation">(</span><span class="token operator">IN</span> user_id <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">IN</span> amount <span class="token keyword">INT</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span> 
<span class="token keyword">update</span> deliverer <span class="token keyword">set</span> Dmoney<span class="token operator">=</span>amount <span class="token keyword">WHERE</span> Dno<span class="token operator">=</span>user_id<span class="token punctuation">;</span>
<span class="token keyword">END</span> $
<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>
</code></pre> 
<h3><a id="_160"></a>触发器</h3> 
<h4><a id="PurchaseOrderr_161"></a>插入具体商品(Purchase表)时更新订单(Orderr表)信息</h4> 
<p>这里在插入一个商品后自动在对应的订单增加一个数量（对应配送费），修改对应的总金额。<br> 使用触发器的好处：自动完成修改，防止遗漏，且操作在服务器，与客户端分离。</p> 
<pre><code class="prism language-sql"><span class="token keyword">BEGIN</span>
	<span class="token keyword">DECLARE</span> a <span class="token keyword">INT</span><span class="token punctuation">;</span>
	<span class="token keyword">DECLARE</span> b <span class="token keyword">INT</span><span class="token punctuation">;</span>
	<span class="token keyword">DECLARE</span> c <span class="token keyword">INT</span><span class="token punctuation">;</span>
	
	<span class="token keyword">SET</span> a <span class="token operator">=</span> <span class="token punctuation">(</span> <span class="token keyword">SELECT</span> orderr<span class="token punctuation">.</span>ODelfee <span class="token keyword">FROM</span> orderr <span class="token keyword">WHERE</span> orderr<span class="token punctuation">.</span>Ono <span class="token operator">=</span> new<span class="token punctuation">.</span>Ono <span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">SET</span> b <span class="token operator">=</span> <span class="token punctuation">(</span> <span class="token keyword">SELECT</span> orderr<span class="token punctuation">.</span>Omoney <span class="token keyword">FROM</span> orderr <span class="token keyword">WHERE</span> orderr<span class="token punctuation">.</span>Ono <span class="token operator">=</span> new<span class="token punctuation">.</span>Ono <span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">SET</span> c <span class="token operator">=</span> <span class="token punctuation">(</span> <span class="token keyword">SELECT</span> goods<span class="token punctuation">.</span>Gprice <span class="token keyword">FROM</span> goods <span class="token keyword">WHERE</span> goods<span class="token punctuation">.</span>Gno <span class="token operator">=</span> new<span class="token punctuation">.</span>Gno <span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">UPDATE</span> orderr 
	<span class="token keyword">SET</span> orderr<span class="token punctuation">.</span>ODelfee <span class="token operator">=</span> a <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>
		orderr<span class="token punctuation">.</span>Omoney <span class="token operator">=</span> b <span class="token operator">+</span> c 
	<span class="token keyword">WHERE</span>
		orderr<span class="token punctuation">.</span>Ono <span class="token operator">=</span> new<span class="token punctuation">.</span>Ono<span class="token punctuation">;</span>
<span class="token keyword">END</span>
</code></pre> 
<hr> 
<h2><a id="UI_184"></a>UI设计</h2> 
<h3><a id="_185"></a>主界面</h3> 
<p>三个程序在界面上大体相同，我把他们的主界面分为几个几个区域：1.选择列表区 2.订单信息区 3.功能区</p> 
<ul><li>选择列表区:显示部分主要是由标题加表格和勾选框以及滑动条组成，操作有全选/取消全选、提交操作、刷新列表。</li><li>订单信息区：这个区域是只读的，只有刷新列表一个功能。</li><li>功能区：这个区域实时的显示用户信息并且有若干功能按钮，点击相应的按钮就进入相应的功能模块。<br> <img src="https://images2.imgbox.com/1b/20/QG8wP9zh_o.png" alt="在这里插入图片描述"></li></ul> 
<p>主界面是用<code>tkinter.TK（）</code>创建出来的，起到 ‘根界面’ 的作用即其它所有界面都是基于他来做的。创建主界面之后要用<code>mainloop</code>将其显示出来。由于实际操作中需要先登录再进入主界面所以先把主界面用<code>.withdrew()</code>方法隐藏起来，成功登录之后再用<code>main_window.deiconify()</code>将其显示出来。</p> 
<h3><a id="_195"></a>登录界面</h3> 
<p>打开程序最先跳出的就是登陆界面，在该界面输入用户密码后点击登录，如果验证正确则进入主界面，如果验证失败则跳出警告框提示，用户名密码信息均来自数据库。如果账户类型和程序不匹配也无法进入程序。<br> 点击注册按钮会跳出注册界面，输入信息后点击确认注册，则会在对应的用户类型的数据表中插入一条记录，注册成功后就可以用该账户登录系统。<br> <img src="https://images2.imgbox.com/0b/15/p3AFq9YR_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_200"></a>子窗口</h3> 
<p>点击一些功能按钮(如注册、修改信息、商品管理等)时会跳出一个子窗口在主界面上层以完成相应的模块的功能。<br> 这里是用<code>tk.Toplevel()</code>实现的，比如</p> 
<pre><code class="prism language-python">window_sign_up <span class="token operator">=</span> tk<span class="token punctuation">.</span>Toplevel<span class="token punctuation">(</span>loggin_window<span class="token punctuation">)</span> 
</code></pre> 
<p>就在loggin_window界面的基础上创建了window_sign_up子界面。tk.Toplevel()和tk.TK()的功能几乎完全一样，不同的是tk.TK()是根界面不建立在其它界面之上。<br> 这里采用模块化的设计方式，即一个子界面的所有内容都包装在一个函数(Python允许函数嵌套)或者一个类当中。<br> 我这里大部分都是用函数嵌套来完成的，首先在函数内部定义子功能对应的子函数，然后设计对应子界面上的控件，并在控件的响应函数中调用上述定义的子函数。</p> 
<h3><a id="_214"></a>消息窗口</h3> 
<p><code>messagebox</code>用于弹出消息窗口，通常用于显示提示消息，例如登录成功、登录失败</p> 
<pre><code class="prism language-sql">tk<span class="token punctuation">.</span>messagebox<span class="token punctuation">.</span>showerror<span class="token punctuation">(</span>message<span class="token operator">=</span><span class="token string">'密码错误'</span><span class="token punctuation">)</span>
tk<span class="token punctuation">.</span>messagebox<span class="token punctuation">.</span>showinfo<span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">'welcome'</span><span class="token punctuation">,</span>message<span class="token operator">=</span><span class="token string">'登陆成功'</span><span class="token punctuation">)</span>
</code></pre> 
<p>以上是两类不同的messagebox，一个用来显示常规信息，一个用来提示错误信息。<br> 每个消息窗口都可以用title=‘’来指定信息窗口的标签，用message=‘’来指定消息窗口的内容。</p> 
<h3><a id="_224"></a>标签</h3> 
<p><code>label</code>一般用来显示静态的文本或者图像，比如</p> 
<pre><code class="prism language-sql">tk<span class="token punctuation">.</span>Label<span class="token punctuation">(</span>main_window<span class="token punctuation">,</span> <span class="token keyword">text</span><span class="token operator">=</span><span class="token string">'用户名:'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>place<span class="token punctuation">(</span>x<span class="token operator">=</span>left_index<span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">15</span><span class="token punctuation">)</span>
tk<span class="token punctuation">.</span>Label<span class="token punctuation">(</span>main_window<span class="token punctuation">,</span> <span class="token keyword">text</span><span class="token operator">=</span><span class="token string">'余  额:'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>place<span class="token punctuation">(</span>x<span class="token operator">=</span>left_index<span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">55</span><span class="token punctuation">)</span>
tk<span class="token punctuation">.</span>Label<span class="token punctuation">(</span>main_window<span class="token punctuation">,</span> <span class="token keyword">text</span><span class="token operator">=</span><span class="token string">'已选:'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>place<span class="token punctuation">(</span>x<span class="token operator">=</span><span class="token number">40</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">480</span><span class="token punctuation">)</span>
tk<span class="token punctuation">.</span>Label<span class="token punctuation">(</span>main_window<span class="token punctuation">,</span> <span class="token keyword">text</span><span class="token operator">=</span><span class="token string">'最近购买的订单：'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>place<span class="token punctuation">(</span>x<span class="token operator">=</span><span class="token number">440</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">180</span><span class="token punctuation">)</span>
</code></pre> 
<p>表示在main_window,这个界面上设置标签，放置位置在(x,y)处，内容是text。</p> 
<p><code>label</code>还可以用来显示动态的内容，根据程序的进行不断改变内容。</p> 
<pre><code class="prism language-sql">total_wallet_show <span class="token operator">=</span> tk<span class="token punctuation">.</span>StringVar<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 用于展示余额</span>
tk<span class="token punctuation">.</span>Label<span class="token punctuation">(</span>main_window<span class="token punctuation">,</span> textvariable<span class="token operator">=</span>total_wallet_show<span class="token punctuation">)</span><span class="token punctuation">.</span>place<span class="token punctuation">(</span>x<span class="token operator">=</span>left_index <span class="token operator">+</span> <span class="token number">40</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">55</span><span class="token punctuation">)</span>

total_wallet_show<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span>rest_money<span class="token punctuation">)</span>
</code></pre> 
<p>以上建立了一个标签，显示内容为<code>total_wallet_show</code>，其是<code>tk.StringVar()</code>类型的变量，然后在程序需要刷新这个内容的时候调用<code>total_wallet_show.set（)</code>将其标签上的内容刷新。</p> 
<h3><a id="_245"></a>按钮</h3> 
<p>按钮<code>button</code>用来实现用户对某个功能的选择，button是可以点击的，点击相应的button就会跳转到对应的处理函数。</p> 
<pre><code class="prism language-sql">bt_charge <span class="token operator">=</span> tk<span class="token punctuation">.</span>Button<span class="token punctuation">(</span>main_window<span class="token punctuation">,</span> <span class="token keyword">text</span><span class="token operator">=</span><span class="token string">'充值余额'</span><span class="token punctuation">,</span> height<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> width<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">,</span> command<span class="token operator">=</span>charge_money<span class="token punctuation">)</span>
bt_charge<span class="token punctuation">.</span>place<span class="token punctuation">(</span>x<span class="token operator">=</span>left_index <span class="token operator">-</span> <span class="token number">140</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">)</span>
bt_user_info <span class="token operator">=</span> tk<span class="token punctuation">.</span>Button<span class="token punctuation">(</span>main_window<span class="token punctuation">,</span> <span class="token keyword">text</span><span class="token operator">=</span><span class="token string">'查询修改个人信息'</span><span class="token punctuation">,</span> height<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> width<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">,</span> command<span class="token operator">=</span>alter_info<span class="token punctuation">)</span>
bt_user_info<span class="token punctuation">.</span>place<span class="token punctuation">(</span>x<span class="token operator">=</span>left_index <span class="token operator">-</span> <span class="token number">140</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
</code></pre> 
<p>比如这里设置了bt_charge和bt_user_info两个按钮，按钮放置在main_window的(x,y)位置，按钮上的显示信息是test，按钮大小是height X width，点击按钮会跳转到command指定的函数中去。</p> 
<h3><a id="_258"></a>列表</h3> 
<p>本程序中的用户点单列表、订单列表、商品管理里面的商品详情等都是用<code>Treeview</code>来做的，比如：</p> 
<pre><code class="prism language-sql"><span class="token keyword">columns</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'订单号'</span><span class="token punctuation">,</span> <span class="token string">'商家名'</span><span class="token punctuation">,</span> <span class="token string">'金额'</span><span class="token punctuation">,</span> <span class="token string">'状态'</span><span class="token punctuation">,</span> <span class="token string">'日期'</span><span class="token punctuation">]</span>
width_ord <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">110</span><span class="token punctuation">]</span>
order_list_table <span class="token operator">=</span> Treeview<span class="token punctuation">(</span> master<span class="token operator">=</span>main_window<span class="token punctuation">,</span> height<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span>  <span class="token keyword">columns</span><span class="token operator">=</span><span class="token keyword">columns</span><span class="token punctuation">,</span> <span class="token keyword">show</span><span class="token operator">=</span><span class="token string">'headings'</span><span class="token punctuation">)</span>

order_list_table<span class="token punctuation">.</span>place<span class="token punctuation">(</span>x<span class="token operator">=</span><span class="token number">440</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token operator">in</span> <span class="token keyword">columns</span>:
    order_list_table<span class="token punctuation">.</span>heading<span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token keyword">text</span><span class="token operator">=</span>i<span class="token punctuation">)</span>  <span class="token comment"># 定义表头</span>
t <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">for</span> i <span class="token operator">in</span> <span class="token keyword">columns</span>:
    order_list_table<span class="token punctuation">.</span><span class="token keyword">column</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> width<span class="token operator">=</span>width_ord<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">,</span> minwidth<span class="token operator">=</span><span class="token number">40</span><span class="token punctuation">,</span> anchor<span class="token operator">=</span>S<span class="token punctuation">,</span> <span class="token punctuation">)</span>  <span class="token comment"># 定义列</span>
    t <span class="token operator">+</span><span class="token operator">=</span> <span class="token number">1</span>
</code></pre> 
<p>这里定义了一个Tree view表格<code>order_list_table</code>表格共五列，分别对应columns中的元素。<code>width_ord</code>的每一项分别是每列的宽度，其父容器是main_window，高度是10行，展示方式是’headings’即展示首行标题<br> 插入待展示的数据的方式：</p> 
<pre><code class="prism language-sql"> <span class="token keyword">for</span> <span class="token keyword">row</span> <span class="token operator">in</span> flu_list:  <span class="token comment"># 格式：店名、商品、价格</span>
        i <span class="token operator">+</span><span class="token operator">=</span> <span class="token number">1</span>
        order_list_table<span class="token punctuation">.</span><span class="token keyword">insert</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token keyword">values</span><span class="token operator">=</span><span class="token keyword">row</span><span class="token punctuation">)</span>
</code></pre> 
<p>这里的<code>flu_list</code>是一个从数据库中获取的二位列表<br> 通过这种方式就把数据库中的数据展示在表格中了。</p> 
<h3><a id="_283"></a>勾选框</h3> 
<p>用户点单，商家和配送员完成订单都需要勾选列表中的内容，这里利用 <code>check button</code>实现，在treeview的每一行前面都设置一个checkbutton，由于treeview和checkbutton都是有编号的，所以可以将每一个勾选框的勾选状态和列表元素的选择联系起来。</p> 
<pre><code class="prism language-sql">ck_button<span class="token punctuation">[</span><span class="token string">'command'</span><span class="token punctuation">]</span> <span class="token operator">=</span> lambda item<span class="token operator">=</span>tv_item: self<span class="token punctuation">.</span>select_button<span class="token punctuation">(</span>item<span class="token punctuation">)</span>

def select_button<span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">)</span>:
    a <span class="token operator">=</span> eval<span class="token punctuation">(</span><span class="token string">"0x"</span> <span class="token operator">+</span> str<span class="token punctuation">(</span>item<span class="token punctuation">[</span><span class="token number">1</span>:<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token function">len</span><span class="token punctuation">(</span>cur_menu<span class="token punctuation">)</span>
    <span class="token keyword">if</span> a <span class="token operator">in</span> order_list:
        order_list<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>a<span class="token punctuation">)</span>
    <span class="token keyword">else</span>:
        order_list<span class="token punctuation">.</span><span class="token keyword">add</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
</code></pre> 
<p>这里的order_list 集合内存的就是勾选的行对应在菜单内的编号，即勾选了的行的编号都在order_list内。</p> 
<hr> 
<h2><a id="_300"></a>数据库相关算法设计</h2> 
<h3><a id="_301"></a>连接数据库</h3> 
<p>这里使用的是pymysql连接到本地的mysql数据库。</p> 
<p>连接之后利用cursor方法创建普通的游标对象。</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> pymysql

<span class="token comment"># 连接数据库</span>
db <span class="token operator">=</span> pymysql<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> user<span class="token operator">=</span><span class="token string">"root"</span><span class="token punctuation">,</span> passwd<span class="token operator">=</span><span class="token string">"xxxxxx"</span><span class="token punctuation">,</span> db<span class="token operator">=</span><span class="token string">"restaurant"</span><span class="token punctuation">)</span>
<span class="token comment"># 使用cursor()方法获取操作游标</span>
cursor <span class="token operator">=</span> db<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="_314"></a>从数据库获取数据（查）</h3> 
<p>这里我自己简单的封装了一个函数，用来做SELECT查询操作。该函数有两个参数，第一个是必选的参数用来指定选择的范围，第二个参数是可选参数用来指定选择条件等。返回值有两个列表类型的量，分别是结果的标题和结果本身(结果是二维列表)，内部设有错误捕获语句，执行出错时会打印出出错的SQL语句，方便调试。</p> 
<pre><code class="prism language-sql">
def <span class="token keyword">select</span><span class="token punctuation">(</span><span class="token keyword">table</span><span class="token punctuation">,</span> par<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span>:
    <span class="token comment"># SQL 查询语句</span>
    data_dict <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">sql</span> <span class="token operator">=</span> <span class="token string">"SELECT * FROM %s %s;"</span> <span class="token operator">%</span> \
          <span class="token punctuation">(</span><span class="token keyword">table</span><span class="token punctuation">,</span> par<span class="token punctuation">)</span>
    try:
        <span class="token comment"># 执行SQL语句</span>
        <span class="token keyword">cursor</span><span class="token punctuation">.</span><span class="token keyword">execute</span><span class="token punctuation">(</span><span class="token keyword">sql</span><span class="token punctuation">)</span>
        <span class="token comment"># 获取所有记录列表</span>
        results <span class="token operator">=</span> <span class="token keyword">cursor</span><span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span>

        data_dict <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token comment"># 打印出标题</span>
        <span class="token keyword">for</span> field <span class="token operator">in</span> <span class="token keyword">cursor</span><span class="token punctuation">.</span>description:
            data_dict<span class="token punctuation">.</span>append<span class="token punctuation">(</span>field<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span>:
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token keyword">sql</span> <span class="token operator">+</span> <span class="token string">"_失败"</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Error: unable to fetch data"</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> data_dict<span class="token punctuation">,</span> results

</code></pre> 
<h3><a id="_342"></a>插入到数据库（增）</h3> 
<p>另一个封装的是插入INSERT函数，这个函数也很简单，两个参数分别是要插入的表(或者表中具体的列)和要插入的数据(VALUES后面的内容包括括号)。该函数没有返回值，若出错则会在错误捕获语句输出该语句，并回滚。</p> 
<pre><code class="prism language-sql">def <span class="token keyword">Insert</span><span class="token punctuation">(</span><span class="token keyword">table</span><span class="token punctuation">,</span> par<span class="token punctuation">)</span>:
    <span class="token keyword">sql</span> <span class="token operator">=</span> <span class="token string">"INSERT INTO %s VALUES %s;"</span> <span class="token operator">%</span> \
          <span class="token punctuation">(</span><span class="token keyword">table</span><span class="token punctuation">,</span> par<span class="token punctuation">)</span>
    try:
        <span class="token comment"># 执行SQL语句</span>
        <span class="token keyword">cursor</span><span class="token punctuation">.</span><span class="token keyword">execute</span><span class="token punctuation">(</span><span class="token keyword">sql</span><span class="token punctuation">)</span>
        db<span class="token punctuation">.</span><span class="token keyword">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token keyword">sql</span> <span class="token operator">+</span> <span class="token string">"成功"</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span>:
        db<span class="token punctuation">.</span><span class="token keyword">rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token keyword">sql</span> <span class="token operator">+</span> <span class="token string">"_失败"</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Error: file to insert"</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="_359"></a>修改数据（改）</h3> 
<p>修改数据功能在本程序中没有统一的格式，故没有封装成函数的形式。这里就拿修改商家个人信息举例(其余的大同小异)。<br> 由于可修改的信息不止一个，每个也都可以选择是否修改(若要修改就在相应位置填值反之不填)，而UPDATE语句的SET之间要用逗号隔开且第一个之前没有逗号。<br> 所以要做两个判断 ：</p> 
<ol><li>判断每个属性是否需要被修改，需要的话就在SQL语句加上相应的部分</li><li>修改当前属性之前是否有属性已经被修改过(当前是否是第一个被修改的属性)，若前面都没有被修改过即当前是第一个被修改的属性则前面不需要加上逗号否则需要加上逗号。</li></ol> 
<pre><code class="prism language-sql"> <span class="token comment"># 将新信息提交到数据库</span>
        changed <span class="token operator">=</span> <span class="token number">0</span>
        sql_alt <span class="token operator">=</span> <span class="token string">'UPDATE store SET '</span>
        <span class="token keyword">if</span> altered_pwd <span class="token operator">!=</span> <span class="token string">""</span>:
            sql_alt <span class="token operator">+</span><span class="token operator">=</span> <span class="token string">" Spass=\'"</span> <span class="token operator">+</span> altered_pwd <span class="token operator">+</span> <span class="token string">"\'"</span>
            changed <span class="token operator">=</span> <span class="token number">1</span>
        <span class="token keyword">if</span> altered_addr <span class="token operator">!=</span> <span class="token string">""</span>:
            <span class="token keyword">if</span> changed <span class="token operator">=</span><span class="token operator">=</span> <span class="token number">1</span>:
                sql_alt <span class="token operator">+</span><span class="token operator">=</span> <span class="token string">','</span>
            sql_alt <span class="token operator">+</span><span class="token operator">=</span> <span class="token string">" Saddr=\'"</span> <span class="token operator">+</span> altered_addr <span class="token operator">+</span> <span class="token string">"\'"</span>
            changed <span class="token operator">=</span> <span class="token number">1</span>
        <span class="token keyword">if</span> altered_tel <span class="token operator">!=</span> <span class="token string">""</span>:
            <span class="token keyword">if</span> changed <span class="token operator">=</span><span class="token operator">=</span> <span class="token number">1</span>:
                sql_alt <span class="token operator">+</span><span class="token operator">=</span> <span class="token string">','</span>
            sql_alt <span class="token operator">+</span><span class="token operator">=</span> <span class="token string">" Stel=\'"</span> <span class="token operator">+</span> altered_tel <span class="token operator">+</span> <span class="token string">"\'"</span>
            changed <span class="token operator">=</span> <span class="token number">1</span>
        <span class="token keyword">if</span> altered_name <span class="token operator">!=</span> <span class="token string">""</span>:
            <span class="token keyword">if</span> changed <span class="token operator">=</span><span class="token operator">=</span> <span class="token number">1</span>:
                sql_alt <span class="token operator">+</span><span class="token operator">=</span> <span class="token string">','</span>
            sql_alt <span class="token operator">+</span><span class="token operator">=</span> <span class="token string">" Sname=\'"</span> <span class="token operator">+</span> altered_name <span class="token operator">+</span> <span class="token string">"\'"</span>
        sql_alt <span class="token operator">+</span><span class="token operator">=</span> <span class="token string">"WHERE Sno=\'"</span> <span class="token operator">+</span> user_id <span class="token operator">+</span> <span class="token string">"\';"</span>
        try:  <span class="token comment"># 执行SQL语句</span>
            <span class="token keyword">cursor</span><span class="token punctuation">.</span><span class="token keyword">execute</span><span class="token punctuation">(</span>sql_alt<span class="token punctuation">)</span>
            db<span class="token punctuation">.</span><span class="token keyword">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            user_pwd <span class="token operator">=</span> identify_pwd  <span class="token comment"># 修改本地缓存的密码</span>
            tk<span class="token punctuation">.</span>messagebox<span class="token punctuation">.</span>showinfo<span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">"通知"</span><span class="token punctuation">,</span> message<span class="token operator">=</span><span class="token string">"修改成功！"</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span>:
            db<span class="token punctuation">.</span><span class="token keyword">rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>sql_alt <span class="token operator">+</span> <span class="token string">"_失败"</span><span class="token punctuation">)</span>
</code></pre> 
<hr> 
<h2><a id="_400"></a>其它算法设计</h2> 
<h3><a id="_401"></a>涉及金融的修改</h3> 
<p>涉及到金融的修改全部不直接用UPDATE的方式，而是调用在服务器端设置的三个存储过程</p> 
<pre><code class="prism language-sql"><span class="token identifier"><span class="token punctuation">`</span>alter_cus_money<span class="token punctuation">`</span></span>、<span class="token identifier"><span class="token punctuation">`</span>alter_del_money<span class="token punctuation">`</span></span>、<span class="token identifier"><span class="token punctuation">`</span>alter_store_money<span class="token punctuation">`</span></span>。
</code></pre> 
<p>三个存储过程的功能完全相同，不同之处在于面向的对象以及被调用的场景。<br> <code>alter_cus_money</code>在用户提交订单并做相应的检查(余额是否足够等)之后扣除本次用户的花费，在用户充值余额并成功验证密码之后增加充值的金额。<br> <code>alter_store_money</code>在用户提交订单完成之后，商家界面上的列表出现对应的订单，在商家对订单点击我已出餐之后，商家营业额会增加该订单对应的金额。在商家提现并验证完密码做完安全性检查之后营业额会减去相应的提现金额。<br> <code>alter_del_money</code>商家点击我已出餐之后，配送员界面上未配送订单会出现，配送员送完餐后点击我已送达（完成订单）之后配送员的工资会增加该单对应的配送费会。在配送员点击提现按钮，提现并验证完密码做完安全性检查之后营业额会减去相应的提现金额。</p> 
<h3><a id="_412"></a>顾客提交订单功能</h3> 
<p>用户提交订单的时候，程序只知道两个消息 一是提交时刻对应的菜单 二是订单内所有的商品在菜单中的编号，这两个商品分别存在以下全局变量中</p> 
<pre><code class="prism language-sql">order_list <span class="token operator">=</span> <span class="token keyword">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 当前购买的</span>
cur_menu <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment"># 当前的菜单</span>
</code></pre> 
<p>由于每个订单内都有可能包含来自多个商家的多个商品。需要处理的问题是如何正确更新orderr和purchase两个表，如何分配配送员。<br> <strong>解决方法：</strong><br> 用户下一次订单，系统识别出来自哪些商家，并将其按照商家拆分成不同的订单，每个订单对应一个商家以及一个配送员，每个订单只对应来自一个商家的商品。</p> 
<p>实际操作过程中只需要遍历整个列表，并记录当前下的单对应的商店集合，如果当前商品来自的商店不在该集合内则加入进去并在orderr中插入一条记录。然后对于每个商品，其对应的店铺无论是否在集合内(不在的刚才已经新建了，所以最终结果是都在)，均要在purchase表中插入一条记录。</p> 
<p>在插入orderr表的时候需要为其分配一个订单号和一个配送员，所以需要事先获取订单表已经存在的最大编号，将新订单号分配为这个最大编号+1，还要获取全部在上班的配送员列表，在列表中随机挑选一个配送员将其信息插入对应的订单中。</p> 
<p>订单插入orderrd的时候还没有订单对应的商品，所以订单金额和配送费都是初始值。每在purchase表中插入一条记录时，要在对应的orderr记录配送费加一以及总金额加上商品价格。这里是用触发器来实现的，每次在purchase插入新内容之后自动完成这一任务，不再需要程序干预。</p> 
<p>当<code>order_list</code>遍历结束后订单的提交也就结束了。</p> 
<h3><a id="_431"></a>商家和配送员完成订单功能</h3> 
<p>在用户提交一个订单之后，该订单的状态为正在出餐，商家可以在未出餐列表中看到该订单，商家准备完成后，选择相应的订单点击我已出餐，订单状态变为正在配送，配送员在待配送列表中可以看到该订单，配送员配送完成后点击我已送达，订单状态变为订单完成。全程都可以在订单栏看到订单的状态。</p> 
<p>商家和配送员的完成订单功能类似，因为程序沿用了客户端的部分代码，命名规则也直接沿用了过来， <code>cur_menu，order_list = set()</code>这两个变量分别代表当前待处理的订单列表，和已选择的订单编号。所以提交处理订单时只需要遍历order_list 列表并找到cur_menu对应编号的订单，修改状态即可。</p> 
<h3><a id="_438"></a>一键修改工作状态</h3> 
<p>商家和配送员都有切换工作状态的功能，按下相应按钮后会在工作/休息之间切换。<br> 商家的状态决定了其商品是否能在用户的菜单上显示，用户的菜单只会显示当前在工作状态的商店的菜品，所以处于休息状态的商家无法接到新订单。配送员类似，系统分配新订单给派送员的时候只会分配给在工作状态的配送员。<br> 实现方法：<br> 在程序中创建一键切换工作状态后，将其command设置为<code>change_work_state()</code>函数，在此函数内会先读取工作状态(全局变量，每次刷新控件时都会更新一次)，然后再根据当前状态生成UPDATE语句提交到数据库执行，并将执行的结果反馈在消息框中。<br> <img src="https://images2.imgbox.com/11/98/hkxmbzrP_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_446"></a>商品管理模块</h3> 
<p>这个模块有查询商品详情、新建商品、修改原有商品、删除商品四个功能。</p> 
<p>点击商品管理后进入该模块，左侧是商品详情区域，展示所有本店铺的商品信息。右上方是输入区，输入对应功能需要的信息，右下方是功能选择区域，点击其中的按钮会读取上方对应的信息并做对应的操作。</p> 
<p>新建商品功能需要录入全部的信息并且保证商品ID不重复，价格和库存不为负值。<br> 修改商品必须填入ID，其它选择要修改的填写即可。<br> 删除商品只需要填入商品ID即可。<br> <img src="https://images2.imgbox.com/47/97/93AgvYwZ_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_457"></a>感谢支持</h3> 
<center> 
 <img src="https://images2.imgbox.com/e4/cf/bP46wXHP_o.gif" width="60%"> 
</center>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/cc91d675b3d3da2f89b665090b3593fb/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">java中 Excel文件解析及超大Excel文件读写</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6ca6321552aa5b6bd4d0f6b354fff561/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">（一）K8S集群部署——master节点部署</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>