<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【安装】自建Rustdesk Server - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【安装】自建Rustdesk Server" />
<meta property="og:description" content="文章目录 RustDesk说明RustDesk优点RustDesk相关链接非Docker基于CentOSRustDesk默认程序占用端口说明 启动 hbbr 是中继服务器启动 hbbs 是ID服务器客户端配置编写启动脚本hbbr、hbbs命令详细说明 RustDesk说明 RustDesk优点 自建服务端。搭建在自己的云服务器就相当于独享高速带宽！点对点通信。TCP隧道功能一旦打洞成功，相当于用户之间直连，不走服务器带宽！信加密。配置公钥后，必须拥有公钥才能正常使用！内置文件传输。得益于点对点通信，文件传输不也是手到擒来嘛！ RustDesk相关链接 官方介绍：https://rustdesk.com/zh/
服务下载地址：https://github.com/rustdesk/rustdesk-server/releases
客户端下载地址：https://rustdesk.com/zh/ 支持IOS、Mac、Windows、Android、Linux等等！
非Docker基于CentOS [root@VM-4-14-centos rustdesk]# tree . └── amd64 ├── db_v2.sqlite3 ├── db_v2.sqlite3-shm ├── db_v2.sqlite3-wal ├── hbbr ├── hbbs ├── id_ed25519 （一开始不会有这个文件，启动后会自动生成，如需更换删除重启服务） ├── id_ed25519.pub （一开始不会有这个文件，启动后会自动生成，如需更换删除重启服务） └── rustdesk-utils RustDesk默认程序占用端口说明 hbbs是ID/Rendezvous 服务器。默认监听：21115(tcp), 21116(tcp/udp), 21118(tcp)
hbbr是中继服务器。默认监听：21117(tcp), 21119(tcp)
如果只需要基本的远程控制： 请注意21116同时要开启TCP和UDP。
其中21115是hbbs用作NAT类型测试（无需开启，不用关注）
hbbs：21116/UDP是hbbs用作ID注册与心跳服务，21116/TCP是hbbs用作TCP打洞与连接服务
hbbr：只用TCP。21117是hbbr用作中继服务使用。21118、21119是为了支持网页客户端。如果您不需要网页客户端（21118，21119）支持，端口可以不开。
总结：hbbs需要指定端口用于客户端的ID服务器、hbbr用于中继服务器。
启动 hbbr 是中继服务器 修改hbbr默认端口为 21117 -&gt; 36001（注意要去云安全组、服务器系统防火墙方形哦 注意是TCP即可）
-k 是加密 参数使用固定的_ 公钥在id_ed25519.pub文件中。秘钥你也可以自定义字符串哦
nohup ./hbbr -p 36001 -k _ &gt; hbbr." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/9192342807c85dd0e6c5065677bceb96/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-01T11:22:30+08:00" />
<meta property="article:modified_time" content="2023-11-01T11:22:30+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【安装】自建Rustdesk Server</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-github-gist">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><a href="#RustDesk_1" rel="nofollow">RustDesk说明</a></li><li><ul><li><a href="#RustDesk_2" rel="nofollow">RustDesk优点</a></li><li><a href="#RustDesk_7" rel="nofollow">RustDesk相关链接</a></li><li><a href="#DockerCentOS_12" rel="nofollow">非Docker基于CentOS</a></li><li><a href="#RustDesk_26" rel="nofollow">RustDesk默认程序占用端口说明</a></li></ul> 
   </li><li><a href="#_hbbr__38" rel="nofollow">启动 hbbr 是中继服务器</a></li><li><a href="#_hbbs_ID_62" rel="nofollow">启动 hbbs 是ID服务器</a></li><li><a href="#_90" rel="nofollow">客户端配置</a></li><li><a href="#_93" rel="nofollow">编写启动脚本</a></li><li><a href="#hbbrhbbs_103" rel="nofollow">hbbr、hbbs命令详细说明</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="RustDesk_1"></a>RustDesk说明</h3> 
<h4><a id="RustDesk_2"></a>RustDesk优点</h4> 
<ol><li>自建服务端。搭建在自己的云服务器就相当于独享高速带宽！</li><li>点对点通信。TCP隧道功能一旦打洞成功，相当于用户之间直连，不走服务器带宽！</li><li>信加密。配置公钥后，必须拥有公钥才能正常使用！</li><li>内置文件传输。得益于点对点通信，文件传输不也是手到擒来嘛！</li></ol> 
<h4><a id="RustDesk_7"></a>RustDesk相关链接</h4> 
<p>官方介绍：<a href="https://rustdesk.com/zh/" rel="nofollow">https://rustdesk.com/zh/</a><br> 服务下载地址：<a href="https://github.com/rustdesk/rustdesk-server/releases">https://github.com/rustdesk/rustdesk-server/releases</a><br> 客户端下载地址：<a href="https://rustdesk.com/zh/" rel="nofollow">https://rustdesk.com/zh/</a> 支持IOS、Mac、Windows、Android、Linux等等！</p> 
<h4><a id="DockerCentOS_12"></a>非Docker基于CentOS</h4> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@VM-4-14-centos rustdesk<span class="token punctuation">]</span><span class="token comment"># tree</span>
<span class="token builtin class-name">.</span>
└── amd64
    ├── db_v2.sqlite3
    ├── db_v2.sqlite3-shm
    ├── db_v2.sqlite3-wal
    ├── hbbr
    ├── hbbs
    ├── id_ed25519     （一开始不会有这个文件，启动后会自动生成，如需更换删除重启服务）
    ├── id_ed25519.pub （一开始不会有这个文件，启动后会自动生成，如需更换删除重启服务）
    └── rustdesk-utils
</code></pre> 
<h4><a id="RustDesk_26"></a>RustDesk默认程序占用端口说明</h4> 
<p>hbbs是ID/Rendezvous 服务器。默认监听：21115(tcp), 21116(tcp/udp), 21118(tcp)<br> hbbr是中继服务器。默认监听：21117(tcp), 21119(tcp)<br> 如果只需要基本的远程控制： 请注意21116同时要开启TCP和UDP。</p> 
<p>其中21115是hbbs用作NAT类型测试（无需开启，不用关注）</p> 
<blockquote> 
 <p>hbbs：21116/UDP是hbbs用作ID注册与心跳服务，21116/TCP是hbbs用作TCP打洞与连接服务<br> hbbr：只用TCP。21117是hbbr用作中继服务使用。21118、21119是为了支持网页客户端。如果您不需要网页客户端（21118，21119）支持，端口可以不开。</p> 
</blockquote> 
<p>总结：hbbs需要指定端口用于客户端的ID服务器、hbbr用于中继服务器。</p> 
<h3><a id="_hbbr__38"></a>启动 hbbr 是中继服务器</h3> 
<p>修改hbbr默认端口为 21117 -&gt; 36001（注意要去云安全组、服务器系统防火墙方形哦 注意是TCP即可）</p> 
<p>-k 是加密 参数使用固定的_ 公钥在id_ed25519.pub文件中。秘钥你也可以自定义字符串哦</p> 
<pre><code class="prism language-shell"><span class="token function">nohup</span> ./hbbr <span class="token parameter variable">-p</span> <span class="token number">36001</span> <span class="token parameter variable">-k</span> _ <span class="token operator">&gt;</span> hbbr.out <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span>  <span class="token operator">&amp;</span>
</code></pre> 
<p>查看hbbr日志</p> 
<pre><code>[2023-10-31 10:20:19.210728 +08:00] INFO [src/common.rs:121] Private key comes from id_ed25519
[2023-10-31 10:20:19.210797 +08:00] INFO [src/relay_server.rs:581] Key: z0woOfOAfIxk5t5JlcFiDFmHMewHcV9KjrhAh4sv2LE=
[2023-10-31 10:20:19.210811 +08:00] INFO [src/relay_server.rs:60] #blacklist(blacklist.txt): 0
[2023-10-31 10:20:19.210817 +08:00] INFO [src/relay_server.rs:75] #blocklist(blocklist.txt): 0
[2023-10-31 10:20:19.210819 +08:00] INFO [src/relay_server.rs:81] Listening on tcp :36001
[2023-10-31 10:20:19.210821 +08:00] INFO [src/relay_server.rs:83] Listening on websocket :36003
[2023-10-31 10:20:19.210827 +08:00] INFO [src/relay_server.rs:86] Start
[2023-10-31 10:20:19.210865 +08:00] INFO [src/relay_server.rs:106] DOWNGRADE_THRESHOLD: 0.66
[2023-10-31 10:20:19.210873 +08:00] INFO [src/relay_server.rs:115] DOWNGRADE_START_CHECK: 1800s
[2023-10-31 10:20:19.210876 +08:00] INFO [src/relay_server.rs:124] LIMIT_SPEED: 4Mb/s
[2023-10-31 10:20:19.210878 +08:00] INFO [src/relay_server.rs:134] TOTAL_BANDWIDTH: 1024Mb/s
[2023-10-31 10:20:19.210880 +08:00] INFO [src/relay_server.rs:148] SINGLE_BANDWIDTH: 16Mb/s

</code></pre> 
<h3><a id="_hbbs_ID_62"></a>启动 hbbs 是ID服务器</h3> 
<pre><code class="prism language-shell"><span class="token function">nohup</span> ./hbbs <span class="token parameter variable">-r</span> 你的IP或域名:36001 <span class="token parameter variable">-p</span> <span class="token number">36000</span> <span class="token parameter variable">-k</span> _ <span class="token operator">&gt;</span> hbbs.out <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span>
</code></pre> 
<p>hbbs日志</p> 
<pre><code class="prism language-powershell"><span class="token namespace">[root@linuxcentos rustdesk]</span><span class="token comment"># tail -f hbbs.out </span>
<span class="token punctuation">[</span>2023-10-31 10:20:32<span class="token punctuation">.</span>476159 <span class="token operator">+</span>08:00<span class="token punctuation">]</span> INFO <span class="token namespace">[src/rendezvous_server.rs:101]</span> Listening on tcp :35999<span class="token punctuation">,</span> extra port <span class="token keyword">for</span> NAT test
<span class="token punctuation">[</span>2023-10-31 10:20:32<span class="token punctuation">.</span>476161 <span class="token operator">+</span>08:00<span class="token punctuation">]</span> INFO <span class="token namespace">[src/rendezvous_server.rs:102]</span> Listening on websocket :36002
<span class="token punctuation">[</span>2023-10-31 10:20:32<span class="token punctuation">.</span>476186 <span class="token operator">+</span>08:00<span class="token punctuation">]</span> INFO <span class="token namespace">[libs/hbb_common/src/udp.rs:35]</span> Receive buf size of udp <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:36000: Ok<span class="token punctuation">(</span>212992<span class="token punctuation">)</span>
<span class="token punctuation">[</span>2023-10-31 10:20:32<span class="token punctuation">.</span>476249 <span class="token operator">+</span>08:00<span class="token punctuation">]</span> INFO <span class="token namespace">[src/rendezvous_server.rs:137]</span> mask: None
<span class="token punctuation">[</span>2023-10-31 10:20:32<span class="token punctuation">.</span>476256 <span class="token operator">+</span>08:00<span class="token punctuation">]</span> INFO <span class="token namespace">[src/rendezvous_server.rs:138]</span> local-ip: <span class="token string">""</span>
<span class="token punctuation">[</span>2023-10-31 10:20:32<span class="token punctuation">.</span>481969 <span class="token operator">+</span>08:00<span class="token punctuation">]</span> INFO <span class="token namespace">[src/common.rs:46]</span> relay-servers=<span class="token punctuation">[</span><span class="token string">"huistudy.cn:36001"</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span>2023-10-31 10:20:32<span class="token punctuation">.</span>482051 <span class="token operator">+</span>08:00<span class="token punctuation">]</span> INFO <span class="token namespace">[src/rendezvous_server.rs:154]</span> ALWAYS_USE_RELAY=N
<span class="token punctuation">[</span>2023-10-31 10:20:32<span class="token punctuation">.</span>482098 <span class="token operator">+</span>08:00<span class="token punctuation">]</span> INFO <span class="token namespace">[src/rendezvous_server.rs:186]</span> <span class="token function">Start</span>
<span class="token punctuation">[</span>2023-10-31 10:20:32<span class="token punctuation">.</span>482137 <span class="token operator">+</span>08:00<span class="token punctuation">]</span> INFO <span class="token namespace">[libs/hbb_common/src/udp.rs:35]</span> Receive buf size of udp <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:0: Ok<span class="token punctuation">(</span>212992<span class="token punctuation">)</span>
<span class="token punctuation">[</span>2023-10-31 10:20:32<span class="token punctuation">.</span>483510 <span class="token operator">+</span>08:00<span class="token punctuation">]</span> INFO <span class="token namespace">[libs/hbb_common/src/udp.rs:35]</span> Receive buf size of udp 0<span class="token punctuation">.</span>0<span class="token punctuation">.</span>0<span class="token punctuation">.</span>0:0: Ok<span class="token punctuation">(</span>212992<span class="token punctuation">)</span>

</code></pre> 
<p>启动完成，查看hbbs、hbbr是否正常运行</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@linuxcentos rustdesk<span class="token punctuation">]</span><span class="token comment"># ps -a | grep hbb</span>
<span class="token number">32358</span> pts/1    00:00:00 hbbr
<span class="token number">32374</span> pts/1    00:00:00 hbbs
</code></pre> 
<p>有hbbr、hbbs说明正常运行，继续配置客户端</p> 
<h3><a id="_90"></a>客户端配置</h3> 
<p><img src="https://images2.imgbox.com/4f/9b/kVUcCbTs_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/7a/c9/m5twm1Qf_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_93"></a>编写启动脚本</h3> 
<p><code> vim reloadRustDesk.sh</code></p> 
<pre><code class="prism language-shell"><span class="token function">nohup</span> ./hbbr <span class="token parameter variable">-p</span> <span class="token number">36001</span> <span class="token parameter variable">-k</span> _ <span class="token operator">&gt;</span> hbbr.out <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span>  <span class="token operator">&amp;</span>
<span class="token function">nohup</span> ./hbbs <span class="token parameter variable">-r</span> 你的IP或域名:36001 <span class="token parameter variable">-p</span> <span class="token number">36000</span> <span class="token parameter variable">-k</span> _ <span class="token operator">&gt;</span> hbbs.out <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span>
</code></pre> 
<p><code>:wq</code>保存退出</p> 
<pre><code class="prism language-shell"><span class="token function">chmod</span> +x reloadRustDesk.sh
</code></pre> 
<h3><a id="hbbrhbbs_103"></a>hbbr、hbbs命令详细说明</h3> 
<p>hbbr<br> [root@VM-4-14-centos amd64]# ./hbbr --help<br> hbbr 1.1.7<br> Purslane Ltd. <a href="mailto:info@rustdesk.com" rel="nofollow">info@rustdesk.com</a><br> RustDesk Relay Server</p> 
<p>USAGE:<br> hbbr [OPTIONS]</p> 
<p>FLAGS:<br> -h, --help 打印帮助信息<br> -V, --version 打印版本信息</p> 
<p>OPTIONS:<br> -k, --key 客户端拥有相同的key才允许链接<br> -p, --port &lt;NUMBER(default=21117)&gt; 指定监听的端口<br> 复制<br> 复制<br> hbbs<br> [root@VM-4-14-centos amd64]# ./hbbs --help<br> hbbs 1.1.7<br> Purslane Ltd. <a href="mailto:info@rustdesk.com" rel="nofollow">info@rustdesk.com</a><br> RustDesk ID/Rendezvous Server</p> 
<p>USAGE:<br> hbbs [OPTIONS]</p> 
<p>FLAGS:<br> -h, --help 打印帮助信息<br> -V, --version 打印版本信息</p> 
<p>OPTIONS:<br> -c, --config 设置自定义配置<br> -k, --key 仅允许具有相同密钥的客户端远程目标电脑，被远程者，暂时无需填写，只需要填写ID服务器即可！<br> –mask Determine if the connection comes from LAN, e.g. 192.168.0.0/16<br> -p, --port &lt;NUMBER(default=21116)&gt; 指定监听的端口<br> -r, --relay-servers 设置中继服务器 Sets the default relay servers, seperated by colon<br> -R, --rendezvous-servers Sets rendezvous servers, seperated by colon<br> -M, --rmem &lt;NUMBER(default=0)&gt; Sets UDP recv buffer size, set system rmem_max first, e.g., sudo sysctl -w<br> net.core.rmem_max=52428800. vi /etc/sysctl.conf, net.core.rmem_max=52428800,<br> sudo sysctl –p<br> -s, --serial &lt;NUMBER(default=0)&gt; Sets configure update serial number<br> -u, --software-url Sets download url of RustDesk software of newest version复制<br> 复制<br> 终止RustDesk服务端<br> 因为服务前缀都是hbb（hbbr、hbbs）开头的，所以直接查询所有的hbb命令的进程</p> 
<pre><code class="prism language-powershell"><span class="token function">ps</span> <span class="token operator">-</span>a <span class="token punctuation">|</span> grep hbb
</code></pre> 
<p>然后执行杀掉PID</p> 
<pre><code class="prism language-powershell"><span class="token function">kill</span> <span class="token operator">-</span>9 PID
</code></pre> 
<p>Linux一键启动hbbr、hbbs</p> 
<p>“设置中继服务器的端口：当前是36001”</p> 
<pre><code class="prism language-powershell">nohup <span class="token punctuation">.</span><span class="token operator">/</span>hbbr <span class="token operator">-</span>p 36001 <span class="token operator">-</span>k _ &gt; hbbr<span class="token punctuation">.</span>out 2&gt;&amp;1  &amp;
<span class="token function">echo</span> <span class="token string">"Hbbr is OK!"</span>
<span class="token function">sleep</span> 3
</code></pre> 
<p>“设置ID服务器的端口：-r 指定中级服务器，-p指定ID服务器端口”<br> 示例：nohup ./hbbs -r baidu.com:36001 -p 36000 -k _ &gt; hbbs.out 2&gt;&amp;1 &amp;</p> 
<pre><code class="prism language-powershell">nohup <span class="token punctuation">.</span><span class="token operator">/</span>hbbs <span class="token operator">-</span>r 你的中继服务器IP:上面你指定的中继端口 <span class="token operator">-</span>p 36000 <span class="token operator">-</span>k _ &gt; hbbs<span class="token punctuation">.</span>out 2&gt;&amp;1 &amp;
<span class="token function">echo</span> <span class="token string">"Hbbs is OK!"</span>
<span class="token function">sleep</span> 3
<span class="token function">echo</span> <span class="token string">"如果有hbbr、hbbs就算启动成功！"</span>
<span class="token function">ps</span> <span class="token operator">-</span>a <span class="token punctuation">|</span> grep hbb
</code></pre> 
<p>参考：<br> <a href="https://cloud.tencent.com/developer/article/2209494" rel="nofollow">https://cloud.tencent.com/developer/article/2209494</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4914dcec005527521d753a084ef2e948/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">nginx转发接口一会正常一会返回404.html</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b4c2636a6b7a42b6d13ab10775f33352/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Qt中串口模块的使用</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>