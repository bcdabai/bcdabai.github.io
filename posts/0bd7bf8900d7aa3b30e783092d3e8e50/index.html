<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>第P7周：咖啡豆识别（VGG-16复现） - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="第P7周：咖啡豆识别（VGG-16复现）" />
<meta property="og:description" content="&gt;- **🍨 本文为[🔗365天深度学习训练营](https://mp.weixin.qq.com/s/rbOOmire8OocQ90QM78DRA) 中的学习记录博客** &gt;- **🍖 原作者：[K同学啊 | 接辅导、项目定制](https://mtyjkh.blog.csdn.net/)** 一、前期工作
import torch import torch.nn as nn import torchvision.transforms as transforms import torchvision from torchvision import transforms, datasets import os,PIL,pathlib,warnings warnings.filterwarnings(&#34;ignore&#34;) #忽略警告信息 device = torch.device(&#34;cuda&#34; if torch.cuda.is_available() else &#34;cpu&#34;) device 2. 导入数据
import os,PIL,random,pathlib data_dir = &#39;./7-data/&#39; data_dir = pathlib.Path(data_dir) data_paths = list(data_dir.glob(&#39;*&#39;)) classeNames = [str(path).split(&#34;\\&#34;)[1] for path in data_paths] classeNames # 关于transforms.Compose的更多介绍可以参考：https://blog.csdn.net/qq_38251616/article/details/124878863 train_transforms = transforms.Compose([ transforms.Resize([224, 224]), # 将输入图片resize成统一尺寸 # transforms." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/0bd7bf8900d7aa3b30e783092d3e8e50/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-15T22:39:19+08:00" />
<meta property="article:modified_time" content="2023-12-15T22:39:19+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">第P7周：咖啡豆识别（VGG-16复现）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p></p> 
<pre><code class="hljs">&gt;- **🍨 本文为[🔗365天深度学习训练营](https://mp.weixin.qq.com/s/rbOOmire8OocQ90QM78DRA) 中的学习记录博客**
&gt;- **🍖 原作者：[K同学啊 | 接辅导、项目定制](https://mtyjkh.blog.csdn.net/)**</code></pre> 
<p>一、前期工作</p> 
<p></p> 
<pre><code class="language-python">import torch
import torch.nn as nn
import torchvision.transforms as transforms
import torchvision
from torchvision import transforms, datasets
import os,PIL,pathlib,warnings

warnings.filterwarnings("ignore")             #忽略警告信息

device = torch.device("cuda" if torch.cuda.is_available() else "cpu")
device</code></pre> 
<p><br><br> 2. 导入数据</p> 
<pre><code class="language-python">import os,PIL,random,pathlib

data_dir = './7-data/'
data_dir = pathlib.Path(data_dir)

data_paths  = list(data_dir.glob('*'))
classeNames = [str(path).split("\\")[1] for path in data_paths]
classeNames</code></pre> 
<pre><code class="language-python">
# 关于transforms.Compose的更多介绍可以参考：https://blog.csdn.net/qq_38251616/article/details/124878863
train_transforms = transforms.Compose([
    transforms.Resize([224, 224]),  # 将输入图片resize成统一尺寸
    # transforms.RandomHorizontalFlip(), # 随机水平翻转
    transforms.ToTensor(),          # 将PIL Image或numpy.ndarray转换为tensor，并归一化到[0,1]之间
    transforms.Normalize(           # 标准化处理--&gt;转换为标准正太分布（高斯分布），使模型更容易收敛
        mean=[0.485, 0.456, 0.406], 
        std=[0.229, 0.224, 0.225])  # 其中 mean=[0.485,0.456,0.406]与std=[0.229,0.224,0.225] 从数据集中随机抽样计算得到的。
])

test_transform = transforms.Compose([
    transforms.Resize([224, 224]),  # 将输入图片resize成统一尺寸
    transforms.ToTensor(),          # 将PIL Image或numpy.ndarray转换为tensor，并归一化到[0,1]之间
    transforms.Normalize(           # 标准化处理--&gt;转换为标准正太分布（高斯分布），使模型更容易收敛
        mean=[0.485, 0.456, 0.406], 
        std=[0.229, 0.224, 0.225])  # 其中 mean=[0.485,0.456,0.406]与std=[0.229,0.224,0.225] 从数据集中随机抽样计算得到的。
])

total_data = datasets.ImageFolder("./7-data/",transform=train_transforms)
total_data
</code></pre> 
<p>3. 划分数据集<br><br><br><br><br><br> 二、手动搭建VGG-16模型<br><br> VGG-16结构说明：<br><br> ●13个卷积层（Convolutional Layer），分别用blockX_convX表示<br> ●3个全连接层（Fully connected Layer），分别用fcX与predictions表示<br> ●5个池化层（Pool layer），分别用blockX_pool表示<br><br> VGG-16包含了16个隐藏层（13个卷积层和3个全连接层），故称为VGG-16<br><br> 这里，我制作了一个视频来展示VGG-16的传播过程</p> 
<p class="img-center"><img alt="play" height="299" src="https://images2.imgbox.com/10/6e/XNCGUISu_o.png" width="534"></p> 
<p>0:00/0:22</p> 
<p>倍速</p> 
<p class="img-center"><img alt="volumeUp" height="299" src="https://images2.imgbox.com/6c/89/K2R188cB_o.png" width="534"></p> 
<p class="img-center"><img alt="fullscreen" height="299" src="https://images2.imgbox.com/17/1b/pf6TbbTD_o.png" width="534"></p> 
<p class="img-center"><img alt="fullscreen" height="299" src="https://images2.imgbox.com/8c/f8/Kgx25yzA_o.png" width="534"></p> 
<p></p> 
<p>VGG-16网络动画展示</p> 
<p>FC7</p> 
<p>FE8</p> 
<p>FC6</p> 
<p>7*7*512</p> 
<p>1*1*512</p> 
<p>1*1*1000</p> 
<p>1*1*512</p> 
<p>CONV5</p> 
<p>CONV4</p> 
<p>14*14*512</p> 
<p>CONV3</p> 
<p>28*28*512</p> 
<p>CONV2</p> 
<p>56*56*256</p> 
<p>112*112*128</p> 
<p>CONVOLUTION+RELU</p> 
<p>K同学啊制作</p> 
<p>MAX POOLING</p> 
<p>CONVI</p> 
<p>百度/谷歌/微信搜索:K同学啊</p> 
<p>224*224*64</p> 
<p>FULLY CONNECTED+RELU</p> 
<p></p> 
<p class="img-center"><img alt="image.png" height="579" src="https://images2.imgbox.com/8b/d1/D8Csb5hZ_o.png" width="1075"></p> 
<p><br> 1. 搭建模型<br><br><br><br> 2. 查看模型详情<br><br><br> 三、 训练模型<br> 1. 编写训练函数<br><br><br> 2. 编写测试函数<br><br> 测试函数和训练函数大致相同，但是由于不进行梯度下降对网络权重进行更新，所以不需要传入优化器<br><br><br> 3. 正式训练<br><br> model.train()、model.eval()训练营往期文章中有详细的介绍。<br><br> 📌如果将优化器换成 SGD 会发生什么呢？请自行探索接下来发生的诡异事件的原因。<br><br><br><br> 四、 结果可视化<br> 1. Loss与Accuracy图<br><br>  </p> 
<p>TRAINING AND VALIDATION ACCURACY</p> 
<p>TRAINING AND</p> 
<p>VALIDATION LOSS</p> 
<p>1.4</p> 
<p>1.0</p> 
<p>TRAINING LOSS</p> 
<p>1.2</p> 
<p>TEST LOSS</p> 
<p>1.0</p> 
<p>0.8</p> 
<p>0.8</p> 
<p>0.6</p> 
<p>0.6</p> 
<p>0.4</p> 
<p>0.4</p> 
<p>0.2</p> 
<p>TRAINING ACCURACY</p> 
<p>TEST ACCURACY</p> 
<p>0.0</p> 
<p>75</p> 
<p>35</p> 
<p>15</p> 
<p>35</p> 
<p>25</p> 
<p>20</p> 
<p>40</p> 
<p>30</p> 
<p>40</p> 
<p>30</p> 
<p></p> 
<p class="img-center"><img alt="output_29_0.png" height="293" src="https://images2.imgbox.com/a2/a5/CjfXzqyj_o.png" width="980"></p> 
<p><br> 2. 指定图片进行预测<br>  </p> 
<p>Python复制代码</p> 
<p>1</p> 
<p>2</p> 
<p>3</p> 
<p>4</p> 
<p>5</p> 
<p>6</p> 
<p>7</p> 
<p>8</p> 
<p>9</p> 
<p>10</p> 
<p>11</p> 
<p>12</p> 
<p>13</p> 
<p>14</p> 
<p>15</p> 
<p>16</p> 
<p>17</p> 
<p>18</p> 
<p>from PIL import Image</p> 
<p></p> 
<p>classes = list(total_data.class_to_idx)</p> 
<p></p> 
<p>def predict_one_image(image_path, model, transform, classes):</p> 
<p>test_img = Image.open(image_path).convert('RGB')</p> 
<p>plt.imshow(test_img) # 展示预测的图片</p> 
<p></p> 
<p>test_img = transform(test_img)</p> 
<p>img = test_img.to(device).unsqueeze(0)</p> 
<p>model.eval()</p> 
<p>output = model(img)</p> 
<p></p> 
<p>_,pred = torch.max(output,1)</p> 
<p>pred_class = classes[pred]</p> 
<p>print(f'预测结果是：{pred_class}')</p> 
<p></p> 
<p>Python复制代码</p> 
<p>1</p> 
<p>2</p> 
<p>3</p> 
<p>4</p> 
<p>5</p> 
<p># 预测训练集中的某张照片</p> 
<p>predict_one_image(image_path='./7-data/Dark/dark (1).png',</p> 
<p>model=model,</p> 
<p>transform=train_transforms,</p> 
<p>classes=classes)</p> 
<p></p> 
<p>Plain Text复制代码</p> 
<p>1</p> 
<p>预测结果是：Dark</p> 
<p></p> 
<p>25</p> 
<p>50</p> 
<p>75</p> 
<p>100</p> 
<p>125</p> 
<p>150</p> 
<p>175</p> 
<p>200</p> 
<p>50</p> 
<p>100</p> 
<p>150</p> 
<p>200</p> 
<p></p> 
<p class="img-center"><img alt="output_32_1.png" height="415" src="https://images2.imgbox.com/f3/70/nEXruA37_o.png" width="420"></p> 
<p><br> 3. 模型评估<br>  </p> 
<p>Python复制代码</p> 
<p>1</p> 
<p>2</p> 
<p>best_model.eval()</p> 
<p>epoch_test_acc, epoch_test_loss = test(test_dl, best_model, loss_fn)</p> 
<p>Python复制代码</p> 
<p>1</p> 
<p>epoch_test_acc, epoch_test_loss</p> 
<p>Plain Text复制代码</p> 
<p>1</p> 
<p>(0.9916666666666667, 0.035762640996836126)</p> 
<p>Python复制代码</p> 
<p>1</p> 
<p>2</p> 
<p># 查看是否与我们记录的最高准确率一致</p> 
<p>epoch_test_acc</p> 
<p>Plain Text复制代码</p> 
<p>1</p> 
<p>0.9916666666666667</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a9cae59370acdce7d84ed3fb45537eb5/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">netcat瑞士军刀</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f5b8f6319787dd7ad25da988c29fb426/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">UDS DTC老化机制</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>