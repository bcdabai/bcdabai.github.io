<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>银河麒麟V4服务器升级openssh - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="银河麒麟V4服务器升级openssh" />
<meta property="og:description" content="首先添加源地址
vi /etc/apt/sources.list
deb http://archive.kylinos.cn/kylin/KYLIN-ALL 4.0.2sp2-server-ft2000 main restricted universe multiverse
第一步：
#卸载原openssh
apt-get remove openssh-server openssh-client
#安装 libpam0g-dev
apt-get install libpam0g-dev
第二步：
正式开始安装openssl和openssh，在各个官网下载openssl,openssh和zlib的源码包。
1.安装zlib
tar -xvzf zlib-1.2.11.tar.gz cd zlib-1.2.11
./configure --prefix=/usr/local/zlib
make &amp;&amp; make install
2.升级openssl
tar -xvzf openssl-1.0.2o.tar.gz （换成你自己下载包的名称，具体的版本可能不一样）
cd openssl-1.0.2o
./config --prefix=/usr/local/openssl shared zlib #一定要加上shared 参数，要不在安装openssh的时候就无法找到,最好指定安装路径，不然找不到安装好的openssl在哪
make &amp;&amp; make install
#备份原来的openssl
mv /usr/bin/openssl /usr/bin/openssl.bak
mv /usr/include/openssl /usr/include/openssl.bak
#因为源码安装默认安装的位置是 /usr/local/openssl 需要将创建软链接到系统位置
ln -s /usr/local/openssl/bin/openssl /usr/bin/openssl
ln -s /usr/local/openssl/include/openssl /usr/include/openssl" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/3eb0b81420b989234fe7810730409aba/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-11-04T11:43:48+08:00" />
<meta property="article:modified_time" content="2022-11-04T11:43:48+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">银河麒麟V4服务器升级openssh</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="margin-left:.0001pt;text-align:justify;">首先添加源地址</p> 
<p style="margin-left:.0001pt;text-align:justify;">vi  /etc/apt/sources.list</p> 
<p style="margin-left:.0001pt;text-align:justify;">deb http://archive.kylinos.cn/kylin/KYLIN-ALL 4.0.2sp2-server-ft2000 main restricted universe multiverse</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">第一步：</p> 
<p style="margin-left:.0001pt;text-align:justify;">#卸载原openssh</p> 
<p style="margin-left:.0001pt;text-align:justify;">apt-get remove openssh-server openssh-client</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">#安装 libpam0g-dev</p> 
<p style="margin-left:.0001pt;text-align:justify;">apt-get install libpam0g-dev</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">第二步：</p> 
<p style="margin-left:.0001pt;text-align:justify;">正式开始安装openssl和openssh，在各个官网下载openssl,openssh和zlib的源码包。</p> 
<p style="text-align:justify;">1.安装zlib</p> 
<p style="margin-left:.0001pt;text-align:justify;">tar -xvzf zlib-1.2.11.tar.gz </p> 
<p style="margin-left:.0001pt;text-align:justify;">cd zlib-1.2.11</p> 
<p style="margin-left:.0001pt;text-align:justify;">./configure --prefix=/usr/local/zlib</p> 
<p style="margin-left:.0001pt;text-align:justify;">make &amp;&amp; make install</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">2.升级openssl</p> 
<p style="margin-left:.0001pt;text-align:justify;">tar -xvzf openssl-1.0.2o.tar.gz （换成你自己下载包的名称，具体的版本可能不一样）</p> 
<p style="margin-left:.0001pt;text-align:justify;">cd openssl-1.0.2o</p> 
<p style="margin-left:.0001pt;text-align:justify;">./config --prefix=/usr/local/openssl  shared  zlib  #一定要加上shared 参数，要不在安装openssh的时候就无法找到,最好指定安装路径，不然找不到安装好的openssl在哪</p> 
<p style="margin-left:.0001pt;text-align:justify;">make &amp;&amp; make install</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">#备份原来的openssl</p> 
<p style="margin-left:.0001pt;text-align:justify;">mv /usr/bin/openssl  /usr/bin/openssl.bak</p> 
<p style="margin-left:.0001pt;text-align:justify;">mv /usr/include/openssl  /usr/include/openssl.bak</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">#因为源码安装默认安装的位置是 /usr/local/openssl 需要将创建软链接到系统位置</p> 
<p style="margin-left:.0001pt;text-align:justify;">ln -s /usr/local/openssl/bin/openssl  /usr/bin/openssl</p> 
<p style="margin-left:.0001pt;text-align:justify;">ln -s /usr/local/openssl/include/openssl  /usr/include/openssl</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">#将openssl 的lib 库添加到系统</p> 
<p style="margin-left:.0001pt;text-align:justify;">echo "/usr/local/openssl/lib" &gt; /etc/ld.so.conf.d/openssl.conf</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">#使新添加的lib 被系统找到</p> 
<p style="margin-left:.0001pt;text-align:justify;">ldconfig</p> 
<p style="margin-left:.0001pt;text-align:justify;">#查看openssl版本</p> 
<p style="margin-left:.0001pt;text-align:justify;">openssl version -a</p> 
<p style="margin-left:.0001pt;text-align:justify;">如果能正常显示openssl最新的版本，证明安装成功</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">3.升级openssh</p> 
<p style="margin-left:.0001pt;text-align:justify;">#备份原openssh文件</p> 
<p style="margin-left:.0001pt;text-align:justify;">mv /etc/init.d/ssh /etc/init.d/ssh.old</p> 
<p style="margin-left:.0001pt;text-align:justify;">cp -r /etc/ssh /etc/ssh.old</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">#开始安装对应版本的openssh</p> 
<p style="margin-left:.0001pt;text-align:justify;">tar -xvzf openssh-xxx.xx.xx.tar.gz</p> 
<p style="margin-left:.0001pt;text-align:justify;">cd openssh-xxx.xxx</p> 
<p style="margin-left:.0001pt;text-align:justify;">./configure --prefix=/usr --sysconfdir=/etc/ssh --with-md5-passwords --with-pam --with-zlib --with-ssl-dir=/usr/local/openssl --with-privsep-path=/var/lib/sshd   #需要指定openssl的安装路径</p> 
<p style="margin-left:.0001pt;text-align:justify;">make &amp;&amp; make install</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">#可查看当前SSH的版本。</p> 
<p style="margin-left:.0001pt;text-align:justify;">ssh -V</p> 
<p style="margin-left:.0001pt;text-align:justify;">到目前所有升级就已经完成了</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">重点，以下需要操作：</p> 
<p style="margin-left:.0001pt;text-align:justify;">#使用原来的/etc/init.d/ssh</p> 
<p style="margin-left:.0001pt;text-align:justify;">mv /etc/init.d/ssh.old /etc/init.d/ssh</p> 
<p style="margin-left:.0001pt;text-align:justify;">#取消注销指定服务</p> 
<p style="margin-left:.0001pt;text-align:justify;">systemctl unmask ssh</p> 
<p style="margin-left:.0001pt;text-align:justify;">#重启服务</p> 
<p style="margin-left:.0001pt;text-align:justify;">systemctl restart sshd</p> 
<p style="margin-left:.0001pt;text-align:justify;">这样openssh就升级完成了。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4c02752cf5da19da7d46f2b97f0671fc/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">jquery---动画</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/20b253b3f464d805f9a43a6b46e32463/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Linux同步时间的方法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>