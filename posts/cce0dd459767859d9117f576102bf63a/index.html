<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ã€æ•°æ®åº“8.0å¤‡ä»½è¿˜åŸã€‘ä¹‹Percona XtraBackup - ç¼–ç¨‹å¤§ç™½çš„åšå®¢</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="ã€æ•°æ®åº“8.0å¤‡ä»½è¿˜åŸã€‘ä¹‹Percona XtraBackup" />
<meta property="og:description" content="ç›®å½• Percona XtraBackupå¤‡ä»½æ•°æ®åº“1ã€Percona XtraBackupçš„ä»‹ç»2ã€Percona XtraBackupå®‰è£…3ã€Percona XtraBackup8.0çš„ä½¿ç”¨1.å…¨åº“å¤‡ä»½å’Œè¿˜åŸ2.å¢é‡å¤‡ä»½å’Œè¿˜åŸ3.å·®å¼‚å¤‡ä»½å’Œè¿˜åŸ4.å·®å¼‚å¤‡ä»½å’Œå¢é‡å¤‡ä»½çš„åŒºåˆ«5.å‹ç¼©å¤‡ä»½å’Œè¿˜åŸ Percona XtraBackupå¤‡ä»½æ•°æ®åº“ yumæºå®‰è£…ï¼šç½‘ç«™ï¼š https://repo.percona.com/yum/
Percona XtraBackup ä¸‹è½½ç½‘ç«™ï¼šhttps://repo.percona.com/yum/
https://www.percona.com/downloads
å®˜æ–¹ä¸‹è½½å¤ªæ…¢
1ã€Percona XtraBackupçš„ä»‹ç» æ— è®ºæ˜¯ 24x7 é«˜è´Ÿè½½æœåŠ¡å™¨è¿˜æ˜¯ä½äº‹åŠ¡é‡æœåŠ¡å™¨ ç¯å¢ƒä¸­ï¼ŒPercona XtraBackup æ—¨åœ¨å®ç°æ— ç¼å¤‡ä»½ è¿‡ç¨‹ï¼Œè€Œä¸ä¼šä¸­æ–­ç”Ÿäº§ä¸­æœåŠ¡å™¨çš„æ€§èƒ½ ç¯å¢ƒã€‚Percona XtraBackup ï¼ˆPXBï¼‰ æ˜¯ä¸€ä¸ª 100% å¼€æºå¤‡ä»½è§£å†³æ–¹æ¡ˆï¼Œä¸ºå¸Œæœ›ä» MySQL çš„å…¨é¢ã€å“åº”è¿…é€Ÿä¸”ç»æµçµæ´»çš„æ•°æ®åº“æ”¯æŒä¸­å—ç›Šçš„ç»„ç»‡æä¾›å•†ä¸šæ”¯æŒã€‚
Percona XtraBackup æ˜¯ä¸–ç•Œä¸Šå”¯ä¸€çš„å¼€æºå…è´¹ MySQL çƒ­å¤‡ä»½ ä¸º InnoDB å’Œ XtraDB æ‰§è¡Œéé˜»å¡å¤‡ä»½çš„è½¯ä»¶ æ•°æ®åº“ã€‚ä½¿ç”¨ Percona XtraBackupï¼Œæ‚¨å¯ä»¥è·å¾—ä»¥ä¸‹ä¼˜åŠ¿ï¼š
å¿«é€Ÿå¯é åœ°å®Œæˆå¤‡ä»½ å¤‡ä»½æœŸé—´ä¸é—´æ–­çš„äº‹åŠ¡å¤„ç† èŠ‚çœç£ç›˜ç©ºé—´å’Œç½‘ç»œå¸¦å®½ è‡ªåŠ¨å¤‡ä»½éªŒè¯ ç”±äºæ¢å¤æ—¶é—´æ›´å¿«ï¼Œæ­£å¸¸è¿è¡Œæ—¶é—´æ›´é•¿ xtrabakackupæœ‰3ä¸ªå·¥å…·ï¼Œåˆ†åˆ«æ˜¯
xtrabakupã€
innobakupexã€
xbstream é€šè¿‡æµæ•°æ®åŠŸèƒ½ï¼Œå¯å°†å¤‡ä»½å†…å®¹æ‰“åŒ…å¹¶ä¼ ç»™ç®¡é“åçš„å‹ç¼©å·¥å…·è¿›è¡Œå‹ç¼©
xtrabackup æ”¯æŒInnoDBï¼ŒXtraDB
innobakupex æ”¯æŒMyisam,InnoDBã€XtraaDB
xbstreamï¼šä»¥ä¸“æœ‰æ ¼å¼å‹ç¼© xtrabackup è¾“å‡ºçš„ä¿¡æ¯
æ”¯æŒçš„å­˜å‚¨å¼•æ“ï¼š
Percona XtraBackup å¯ä»¥å¤‡ä»½ MySQL 8.0 æœåŠ¡å™¨ä»¥åŠ Percona Server for MySQL with XtraDBã€Percona Server for MySQL 8." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/cce0dd459767859d9117f576102bf63a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-16T18:09:56+08:00" />
<meta property="article:modified_time" content="2024-01-16T18:09:56+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="ç¼–ç¨‹å¤§ç™½çš„åšå®¢" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">ç¼–ç¨‹å¤§ç™½çš„åšå®¢</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ã€æ•°æ®åº“8.0å¤‡ä»½è¿˜åŸã€‘ä¹‹Percona XtraBackup</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>ç›®å½•</h4> 
 <ul><li><ul><li><a href="#Percona_XtraBackup_2" rel="nofollow">Percona XtraBackupå¤‡ä»½æ•°æ®åº“</a></li><li><ul><li><a href="#1Percona_XtraBackup_8" rel="nofollow">1ã€Percona XtraBackupçš„ä»‹ç»</a></li><li><a href="#2Percona_XtraBackup_41" rel="nofollow">2ã€Percona XtraBackupå®‰è£…</a></li><li><a href="#3Percona_XtraBackup80_98" rel="nofollow">3ã€Percona XtraBackup8.0çš„ä½¿ç”¨</a></li><li><ul><li><a href="#1_118" rel="nofollow">1.å…¨åº“å¤‡ä»½å’Œè¿˜åŸ</a></li><li><a href="#2_161" rel="nofollow">2.å¢é‡å¤‡ä»½å’Œè¿˜åŸ</a></li><li><a href="#3_214" rel="nofollow">3.å·®å¼‚å¤‡ä»½å’Œè¿˜åŸ</a></li><li><a href="#4_241" rel="nofollow">4.å·®å¼‚å¤‡ä»½å’Œå¢é‡å¤‡ä»½çš„åŒºåˆ«</a></li><li><a href="#5_244" rel="nofollow">5.å‹ç¼©å¤‡ä»½å’Œè¿˜åŸ</a></li></ul> 
   </li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="Percona_XtraBackup_2"></a>Percona XtraBackupå¤‡ä»½æ•°æ®åº“</h3> 
<p>yumæºå®‰è£…ï¼šç½‘ç«™ï¼š https://repo.percona.com/yum/</p> 
<p>Percona XtraBackup ä¸‹è½½ç½‘ç«™ï¼š<a href="https://repo.percona.com/yum/" rel="nofollow">https://repo.percona.com/yum/</a><br> <a href="https://www.percona.com/downloads" rel="nofollow"><strong>https://www.percona.com/downloads</strong></a><br> <mark>å®˜æ–¹ä¸‹è½½å¤ªæ…¢</mark></p> 
<h4><a id="1Percona_XtraBackup_8"></a>1ã€Percona XtraBackupçš„ä»‹ç»</h4> 
<p>æ— è®ºæ˜¯ 24x7 é«˜è´Ÿè½½æœåŠ¡å™¨è¿˜æ˜¯ä½äº‹åŠ¡é‡æœåŠ¡å™¨ ç¯å¢ƒä¸­ï¼ŒPercona XtraBackup æ—¨åœ¨å®ç°æ— ç¼å¤‡ä»½ è¿‡ç¨‹ï¼Œè€Œä¸ä¼šä¸­æ–­ç”Ÿäº§ä¸­æœåŠ¡å™¨çš„æ€§èƒ½ ç¯å¢ƒã€‚Percona XtraBackup ï¼ˆPXBï¼‰ æ˜¯ä¸€ä¸ª 100% å¼€æºå¤‡ä»½è§£å†³æ–¹æ¡ˆï¼Œä¸ºå¸Œæœ›ä» MySQL çš„å…¨é¢ã€å“åº”è¿…é€Ÿä¸”ç»æµçµæ´»çš„æ•°æ®åº“æ”¯æŒä¸­å—ç›Šçš„ç»„ç»‡æä¾›å•†ä¸šæ”¯æŒã€‚</p> 
<p>Percona XtraBackup æ˜¯ä¸–ç•Œä¸Šå”¯ä¸€çš„å¼€æºå…è´¹ MySQL çƒ­å¤‡ä»½ ä¸º InnoDB å’Œ XtraDB æ‰§è¡Œéé˜»å¡å¤‡ä»½çš„è½¯ä»¶ æ•°æ®åº“ã€‚ä½¿ç”¨ Percona XtraBackupï¼Œæ‚¨å¯ä»¥è·å¾—ä»¥ä¸‹ä¼˜åŠ¿ï¼š</p> 
<pre><code class="prism language-bash">å¿«é€Ÿå¯é åœ°å®Œæˆå¤‡ä»½
å¤‡ä»½æœŸé—´ä¸é—´æ–­çš„äº‹åŠ¡å¤„ç†
èŠ‚çœç£ç›˜ç©ºé—´å’Œç½‘ç»œå¸¦å®½
è‡ªåŠ¨å¤‡ä»½éªŒè¯
ç”±äºæ¢å¤æ—¶é—´æ›´å¿«ï¼Œæ­£å¸¸è¿è¡Œæ—¶é—´æ›´é•¿
</code></pre> 
<blockquote> 
 <p>xtrabakackupæœ‰3ä¸ªå·¥å…·ï¼Œåˆ†åˆ«æ˜¯<br> xtrabakupã€<br> innobakupexã€</p> 
</blockquote> 
<blockquote> 
 <p>xbstream é€šè¿‡æµæ•°æ®åŠŸèƒ½ï¼Œå¯å°†å¤‡ä»½å†…å®¹æ‰“åŒ…å¹¶ä¼ ç»™ç®¡é“åçš„å‹ç¼©å·¥å…·è¿›è¡Œå‹ç¼©<br> xtrabackup æ”¯æŒInnoDBï¼ŒXtraDB<br> innobakupex æ”¯æŒMyisam,InnoDBã€XtraaDB<br> xbstreamï¼šä»¥ä¸“æœ‰æ ¼å¼å‹ç¼© xtrabackup è¾“å‡ºçš„ä¿¡æ¯</p> 
</blockquote> 
<p><strong>æ”¯æŒçš„å­˜å‚¨å¼•æ“ï¼š</strong><br> Percona XtraBackup å¯ä»¥å¤‡ä»½ MySQL 8.0 æœåŠ¡å™¨ä»¥åŠ Percona Server for MySQL with XtraDBã€Percona Server for MySQL 8.0 å’Œ Percona XtraDB Cluster 8.0 ä¸Šçš„ InnoDBã€XtraDBã€MyISAM å’Œ MyRocks è¡¨ä¸­çš„æ•°æ®ã€‚<br> <strong>å±€é™æ€§ï¼š</strong></p> 
<pre><code class="prism language-bash"><span class="token number">1</span>ã€Percona XtraBackup <span class="token number">8.0</span> ç›®å‰ä¸å¯èƒ½åŒæ—¶æ”¯æŒ <span class="token number">8.0</span> ä¹‹å‰çš„ç‰ˆæœ¬
<span class="token number">2</span>ã€Percona XtraBackup <span class="token number">2.4</span> æ”¯æŒ MySQL å’Œ Percona Server <span class="token keyword">for</span> MySQL <span class="token number">5.6</span> å’Œ <span class="token number">5.7</span> æ•°æ®åº“
<span class="token number">3</span>ã€Percona XtraBackup <span class="token number">8.1</span> ä¸æ”¯æŒå¯¹æ•°æ®åº“è¿›è¡Œå¤‡ä»½ åœ¨ MySQL <span class="token number">8.1</span> ä¹‹å‰çš„ç‰ˆæœ¬ä¸­åˆ›å»ºï¼ŒPercona Server <span class="token keyword">for</span> MySQL æˆ– Percona XtraDB é›†ç¾¤ã€‚
</code></pre> 
<h4><a id="2Percona_XtraBackup_41"></a>2ã€Percona XtraBackupå®‰è£…</h4> 
<p>ç”¨é˜¿é‡Œæˆ–è€…æ¸…åå¤§å­¦perconaæºyumå®‰è£…Percona XtraBackup==<br> <mark>äº‹ä¾‹ï¼šæˆ‘ç”¨çš„redhat9å®‰è£…è¿™ä¸ªè½¯ä»¶</mark><br> <strong>å†™æºä»“åº“ï¼š</strong><br> cat &lt;&gt;/etc/yum.repos.d/percona.repo<br> [percona]<br> name = Percona<br> baseurl = https://mirrors.tuna.tsinghua.edu.cn/percona/release/$releasever/RPMS/$basearch<br> enabled = 1<br> gpgcheck = 0</p> 
<p>[epel]<br> name=epelrepo<br> baseurl=https://mirrors.aliyun.com/epel/$releasever/$basearch<br> gpgcheck=0<br> enable=1<br> eof</p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@manged ~<span class="token punctuation">]</span><span class="token comment"># yum list all| grep xtraback -i    æŸ¥çœ‹xtrabackæœ‰å“ªäº›è½¯ä»¶åŒ…</span>
æŠ¥é”™
Errors during downloading metadata <span class="token keyword">for</span> repository <span class="token string">'epel'</span><span class="token builtin class-name">:</span>
  - Status code: <span class="token number">404</span> <span class="token keyword">for</span> https://mirrors.aliyun.com/epel/9/x86_64/repodata/repomd.xml <span class="token punctuation">(</span>IP: <span class="token number">118.112</span>.22.214<span class="token punctuation">)</span>
é”™è¯¯ï¼šä¸ºä»“åº“ <span class="token string">'epel'</span> ä¸‹è½½å…ƒæ•°æ®å¤±è´¥ <span class="token builtin class-name">:</span> Cannot download repomd.xml: Cannot download repodata/repomd.xml: All mirrors were tried
</code></pre> 
<p>å»epelå®˜ç½‘ï¼š<a href="https://docs.fedoraproject.org/en-US/epel/" rel="nofollow">https://docs.fedoraproject.org/en-US/epel/</a> ä¸‹è½½é¢å¤–çš„è½¯ä»¶åŒ…ã€‚</p> 
<blockquote> 
 <p>dnf install<br> https://dl.fedoraproject.org/pub/epel/epel-release-latest-9.noarch.rpm</p> 
</blockquote> 
<p>å¦‚æœå®‰è£…å¤±è´¥ï¼Œå°±ä¸‹è½½ä¸‹æ¥rpmå®‰è£…ï¼š</p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@manged ~<span class="token punctuation">]</span><span class="token comment"># wget https://dl.fedoraproject.org/pub/epel/epel-release-latest-9.noarch.rpm</span>
<span class="token punctuation">[</span>root@manged ~<span class="token punctuation">]</span><span class="token comment"># rpm -ivh epel-release-latest-9.noarch.rpm </span>
å¯ä»¥<span class="token punctuation">[</span>root@manged ~<span class="token punctuation">]</span><span class="token comment"># yum repolist   æŸ¥çœ‹</span>
</code></pre> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@manged ~<span class="token punctuation">]</span><span class="token comment"># yum list all| grep xtraback -i   å¥½äº†è€¶</span>
Repository epel is listed <span class="token function">more</span> than once <span class="token keyword">in</span> the configuration
holland-xtrabackup.noarch                                                                <span class="token number">1.2</span>.10-1.el9                                   epel               
percona-xtrabackup-24.x86_64                                                             <span class="token number">2.4</span>.28-1.el9                                   percona            
percona-xtrabackup-24-debuginfo.x86_64                                                   <span class="token number">2.4</span>.28-1.el9                                   percona            
percona-xtrabackup-24-debugsource.x86_64                                                 <span class="token number">2.4</span>.28-1.el9                                   percona            
percona-xtrabackup-80.x86_64                                                             <span class="token number">8.0</span>.35-30.1.el9                                percona            
percona-xtrabackup-80-debuginfo.x86_64                                                   <span class="token number">8.0</span>.35-30.1.el9                                percona            
percona-xtrabackup-80-debugsource.x86_64                                                 <span class="token number">8.0</span>.35-30.1.el9                                percona            
percona-xtrabackup-81.x86_64                                                             <span class="token number">8.1</span>.0-1.1.el9                                  percona            
percona-xtrabackup-81-debuginfo.x86_64                                                   <span class="token number">8.1</span>.0-1.1.el9
</code></pre> 
<blockquote> 
 <p>[root@manged ~]# yum install percona-xtrabackup-80<br> å®‰è£…å¯¹åº”æ•°æ®åº“ç‰ˆæœ¬çš„ï¼Œé€Ÿåº¦å¿«å¤šäº†ã€‚</p> 
</blockquote> 
<h4><a id="3Percona_XtraBackup80_98"></a>3ã€Percona XtraBackup8.0çš„ä½¿ç”¨</h4> 
<pre><code class="prism language-bash">å¸¸ç”¨é€‰é¡¹:  
   <span class="token parameter variable">--host</span>     æŒ‡å®šä¸»æœº
   <span class="token parameter variable">--user</span>     æŒ‡å®šç”¨æˆ·å
   <span class="token parameter variable">--password</span>    æŒ‡å®šå¯†ç 
   <span class="token parameter variable">--port</span>     æŒ‡å®šç«¯å£
   <span class="token parameter variable">--databases</span>     æŒ‡å®šæ•°æ®åº“
   <span class="token parameter variable">--incremental</span>    åˆ›å»ºå¢é‡å¤‡ä»½
   --incremental-basedir   æŒ‡å®šåŒ…å«å®Œå…¨å¤‡ä»½çš„ç›®å½•
   --incremental-dir      æŒ‡å®šåŒ…å«å¢é‡å¤‡ä»½çš„ç›®å½•   
   --apply-log        å¯¹å¤‡ä»½è¿›è¡Œé¢„å¤„ç†æ“ä½œ 
   --defaults-file	  æŒ‡å®šé»˜è®¤é…ç½®æ–‡ä»¶ï¼Œé»˜è®¤æ˜¯è¯»å–/etc/my.cf
</code></pre> 
<p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåœ¨å¤‡ä»½å®Œæˆåï¼Œæ•°æ®å°šä¸”ä¸èƒ½ç”¨äºæ¢å¤æ“ä½œï¼Œå› ä¸ºå¤‡ä»½çš„æ•°æ®ä¸­å¯èƒ½ä¼šåŒ…å«å°šæœªæäº¤çš„äº‹åŠ¡æˆ–å·²ç»æäº¤ä½†å°šæœªåŒæ­¥è‡³æ•°æ®æ–‡ä»¶ä¸­çš„äº‹åŠ¡ã€‚å› æ­¤ï¼Œæ­¤æ—¶æ•°æ®æ–‡ä»¶ä»å¤„ç†ä¸ä¸€è‡´çŠ¶æ€ã€‚â€œå‡†å¤‡â€çš„ä¸»è¦ä½œç”¨æ­£æ˜¯é€šè¿‡å›æ»šæœªæäº¤çš„äº‹åŠ¡åŠåŒæ­¥å·²ç»æäº¤çš„äº‹åŠ¡è‡³æ•°æ®æ–‡ä»¶ä¹Ÿä½¿å¾—æ•°æ®æ–‡ä»¶å¤„äºä¸€è‡´æ€§çŠ¶æ€ã€‚<br> â€“redo-only ä¸å›æ»šæœªæäº¤äº‹åŠ¡<br> â€“copy-back æ¢å¤å¤‡ä»½ç›®å½•</p> 
<h5><a id="1_118"></a>1.å…¨åº“å¤‡ä»½å’Œè¿˜åŸ</h5> 
<p><strong>ä¸€ã€å…¨åº“å¤‡ä»½</strong><br> xtrabackup --defaults-file=/etc/my.cnf --backup --target-dir=/data/backup -uroot -predhat -H localhost -P 3306</p> 
<blockquote> 
 <p>-p åé¢æ˜¯mysqlçš„å¯†ç  -H åé¢æ˜¯ä¸»æœºï¼Œæ”¯æŒè¿œç¨‹å¤‡ä»½ï¼Œ-Pæ˜¯ç«¯å£</p> 
</blockquote> 
<pre><code class="prism language-bash">   å¦‚æœå‡ºç°å¦‚ä¸‹é—®é¢˜æ˜¯åœ¨æ²¡æœ‰åˆ›å»º/data/backup/ç›®å½•
<span class="token number">2023</span>-12-13T18:05:19.164770+08:00 <span class="token number">0</span> <span class="token punctuation">[</span>Note<span class="token punctuation">]</span> <span class="token punctuation">[</span>MY-011825<span class="token punctuation">]</span> <span class="token punctuation">[</span>Xtrabackup<span class="token punctuation">]</span> Redo Log Archiving is not <span class="token builtin class-name">set</span> up.
<span class="token number">2023</span>-12-13T18:05:19.257242+08:00 <span class="token number">0</span> <span class="token punctuation">[</span>ERROR<span class="token punctuation">]</span> <span class="token punctuation">[</span>MY-011825<span class="token punctuation">]</span> <span class="token punctuation">[</span>Xtrabackup<span class="token punctuation">]</span> cannot mkdir: <span class="token number">2</span> /data/backup/
</code></pre> 
<p>å‡ºç°çš„è¿™ä¸ªæ²¡æœ‰æƒé™é—®é¢˜ï¼š</p> 
<pre><code class="prism language-bash"><span class="token number">2023</span>-12-13T11:40:23.815725-05:00 <span class="token number">0</span> <span class="token punctuation">[</span>ERROR<span class="token punctuation">]</span> <span class="token punctuation">[</span>MY-011825<span class="token punctuation">]</span> <span class="token punctuation">[</span>Xtrabackup<span class="token punctuation">]</span> failed to execute query <span class="token string">'LOCK INSTANCE FOR BACKUP'</span> <span class="token builtin class-name">:</span> <span class="token number">1227</span> <span class="token punctuation">(</span><span class="token number">42000</span><span class="token punctuation">)</span> 
Access denied<span class="token punctuation">;</span> you need <span class="token punctuation">(</span>at least one of<span class="token punctuation">)</span> the BACKUP_ADMIN privilege<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">for</span> this operation
</code></pre> 
<p>è§£å†³æ–¹æ³•ï¼š</p> 
<pre><code class="prism language-bash">GRANT BACKUP_ADMIN ON *.* TO <span class="token string">'root'</span>@<span class="token string">'localhost'</span><span class="token punctuation">;</span>  
FLUSH PRIVILEGES<span class="token punctuation">;</span>
</code></pre> 
<p><strong>äºŒã€æ•°æ®åº“æ¢å¤</strong><br> åˆ æ‰æ•°æ®åº“ï¼š</p> 
<pre><code class="prism language-bash">å…ˆåœæ‰æ•°æ®åº“systemctl stop mysqld
<span class="token function">rm</span> <span class="token parameter variable">-rf</span>  /var/lib/mysql/*         mysqlè¿™ä¸ªç›®å½•çš„æ‰€æœ‰è€…ï¼Œæ‰€å±ç»„éƒ½æ˜¯mysql   
è¿™ä¸ªç›®å½•åˆ é™¤ä¹‹åï¼Œé‡å¯æ•°æ®åº“å°±æ˜¯ä¸€ä¸ªå…¨æ–°çš„æ•°æ®åº“
</code></pre> 
<p>å¯åŠ¨æ•°æ®åº“ï¼Œè¿™æ—¶æ˜¯ä¸€ä¸ªå…¨æ–°çš„æ•°æ®åº“ã€‚</p> 
<p>å¤‡ä»½ä¹‹å‰è¦<mark>åˆ é™¤/var/lib/mysql/* <mark>çš„æ–‡ä»¶ï¼Œå¹¶ä¸”</mark>å…ˆåœæ‰æ•°æ®åº“</mark><strong>ï¼Œè¿˜åŸçš„æ—¶å€™æ•°æ®åº“deadçŠ¶æ€</strong><br> å…ˆå¤‡ä»½å¤‡ä»½é›†ï¼š<br> å¤‡ä»½åçš„æ•°æ®å¹¶ä¸å¤„äºä¸€è‡´æ€§çŠ¶æ€ï¼Œä¸ºäº†å¯ä»¥ç”¨æ¥æ¢å¤ï¼Œéœ€è¦ä½¿ç”¨-prepareå‡†å¤‡å¤‡ä»½é›†<br> [root@redhat ~]# xtrabackup --prepare --target-dir=/data/backup å‡†å¤‡æ•°æ®å¤‡ä»½é›†<br> [root@redhat ~]# xtrabackup --copy-back --target-dir=/data/backup å¤‡ä»½<br> ç„¶å<strong>chown mysql:mysql /var/lib/mysql/ -R</strong><br> å†é‡å¯æ•°æ®åº“å°±å®Œæˆäº†ã€‚éå¸¸å®Œç¾ï¼</p> 
<p><strong>æ³¨æ„ï¼šå¥½åƒæ•°æ®åº“ç‰ˆæœ¬ä¸ä¸€æ ·ï¼Œè¿˜åŸçš„æ—¶å€™ä¼šå‡ºé”™</strong></p> 
<h5><a id="2_161"></a>2.å¢é‡å¤‡ä»½å’Œè¿˜åŸ</h5> 
<p>å…ˆè¿›è¡Œå…¨å¤‡ï¼š<br> xtrabackup --defaults-file=/etc/my.cnf --backup --target-dir=/data/backup -uroot -predhat -H localhost -P 3306<br> å¢å¤‡ä»½1ï¼š<br> xtrabackup --defaults-file=/etc/my.cnf --backup --target-dir=/data/inc1 --incremental-basedir=/data/backup -uroot -predhat -H localhost -P 3306</p> 
<pre><code class="prism language-bash">è§£é‡Šï¼štarget-dir<span class="token operator">=</span>/data/inc1ä¸­çš„inc1ç›®å½•ä¸ç”¨è‡ªå·±åˆ›å»ºï¼Œ--incremental-basedir<span class="token operator">=</span>/data/backupå¢å¤‡ä»½æ˜¯åœ¨å…¨å¤‡çš„åŸºç¡€ä¸Šåšå¾—ï¼Œè¿™ä¸ªå‚æ•°æ˜¯å¡«å…¨å¤‡çš„è·¯å¾„ï¼Œå…¨å¤‡å’Œå¢å¤‡çš„ç›®å½•è¦åˆ†å¼€ï¼Œä¸èƒ½æ”¾åœ¨ä¸€èµ·ã€‚
</code></pre> 
<p>å¢å¤‡ä»½2ï¼š<br> xtrabackup --defaults-file=/etc/my.cnf --backup --target-dir=/data/inc2 --incremental-basedir=/data/inc1 -uroot -predhat -H localhost -P 3306</p> 
<pre><code class="prism language-bash">ç¬¬äºŒå¤©ä¹Ÿåšäº†å¢é‡å¤‡ä»½ ï¼Œincremental-basedir<span class="token operator">=</span>/data/inc1ï¼Œè¿™é‡Œçš„å‚æ•°æ˜¯å‚ç…§å¢å¤‡1é‡Œå¤‡ä»½çš„ï¼Œæ‰€ä»¥è¿™ä¸ªå‚æ•°æ˜¯å¡«å¢å¤‡1çš„è·¯å¾„ã€‚
</code></pre> 
<p><mark>å¤‡ä»½å¥½åä¼šåœ¨/dataå‡ºç°3ä¸ªç›®å½•ï¼Œä¸€ä¸ªæ˜¯å…¨å¤‡çš„æ•°æ®ï¼Œè¿˜æœ‰ä¸ªå¢å¤‡1çš„æ•°æ®ï¼Œè¿˜æœ‰ä¸ªå¢å¤‡2çš„æ•°æ®ã€‚</mark></p> 
<p><strong>æ¢å¤æ•°æ®ï¼š</strong><br> <strong>å‡†å¤‡è¿˜åŸå‘½ä»¤ï¼š</strong><br> xtrabackup --defaults-file=/etc/my.cnf --prepare --apply-log-only --target-dir=/data/backup/</p> 
<p>xtrabackup --defaults-file=/etc/my.cnf --prepare --apply-log-only --target-dir=/data/backup --incremental-dir=/data/inc1/</p> 
<p>xtrabackup --defaults-file=/etc/my.cnf --prepare --target-dir=/data/backup --incremental-dir=/data/inc2/</p> 
<pre><code class="prism language-bash">ä»¥ä¸Šå‘½ä»¤å°±æ˜¯æŠŠå¢é‡å¤‡ä»½åˆå¹¶åˆ°å®Œå…¨å¤‡ä»½çš„æ—¥å¿—é‡Œï¼Œåˆ°æ—¶å€™ç›´æ¥è¿˜åŸå®Œå…¨å¤‡ä»½çš„ç›®å½•æ•°æ®å°±è¡Œ
</code></pre> 
<p><mark>æ³¨æ„ï¼šæœ€å¥½ä¸€æ¬¡æŠŠå¢é‡å¤‡ä»½æ¢å¤åˆ°å…¨éƒ¨ä¸è¦åŠ  --apply-log-onlyï¼Œä¸ç„¶ä¼šå‡ºç°é—®é¢˜ï¼Œè¯´ä½ æ²¡æœ‰å‡†å¤‡å¥½ã€‚</mark></p> 
<p><strong>æ¢å¤æ•°æ®åˆ°ç›®å½•ï¼š</strong><br> åœæ­¢æ•°æ®åº“å¹¶æ¸…ç©ºæ•°æ®åº“ç›®å½•<br> xtrabackup --defaults-file=/etc/my.cnf --copy-back --target-dir=/data/backup æ¢å¤<br> chown mysql:mysql /var/lib/mysql/ -R æŠŠæ–‡ä»¶çš„æ‰€æœ‰æ–‡ä»¶å±ç»„æ”¹æˆmysql</p> 
<p>é‡å¯æ•°æ®åº“ï¼Œæ‰€æœ‰çš„æ•°æ®éƒ½åœ¨ï¼Œå®éªŒå®Œæˆï¼<em>ğŸ‘Œ</em><br> <mark>é‡åˆ°é—®é¢˜ï¼š</mark><br> å½“æœ€åä¸€æ¬¡å¢å¤‡åŠ äº† --apply-log-onlyï¼Œè¿˜åŸçš„æ—¶å€™ä¼šæŠ¥è¿™ä¸ªé”™è¯¯ï¼š</p> 
<pre><code class="prism language-bash"><span class="token number">2023</span>-12-15T08:03:29.481391-05:00 <span class="token number">0</span> <span class="token punctuation">[</span>Note<span class="token punctuation">]</span> <span class="token punctuation">[</span>MY-011825<span class="token punctuation">]</span> <span class="token punctuation">[</span>Xtrabackup<span class="token punctuation">]</span> <span class="token builtin class-name">cd</span> to /datas/backup/
<span class="token number">2023</span>-12-15T08:03:29.481464-05:00 <span class="token number">0</span> <span class="token punctuation">[</span>ERROR<span class="token punctuation">]</span> <span class="token punctuation">[</span>MY-011825<span class="token punctuation">]</span> <span class="token punctuation">[</span>Xtrabackup<span class="token punctuation">]</span> The target is not fully prepared. Please prepare it without option --apply-log-only
</code></pre> 
<pre><code class="prism language-bash">è§£å†³æ–¹æ³•ï¼š
xtrabackup --defaults-file<span class="token operator">=</span>/etc/my.cnf <span class="token parameter variable">--prepare</span> --target-dir<span class="token operator">=</span>/datas/backup/
xtrabackup --defaults-file<span class="token operator">=</span>/etc/my.cnf --copy-back --target-dir<span class="token operator">=</span>/datas/backup
è§£é‡Šï¼šä¹Ÿå°±æ˜¯åœ¨åšä¸€æ¬¡å…¨å¤‡ä»½ï¼Œå¹¶ä¸”å…¨å¤‡çš„æ—¶å€™åˆ é™¤--apply-log-onlyï¼Œå†è¿›è¡Œè¿˜åŸï¼Œè¿™æ—¶å€™å°±æˆåŠŸäº†ã€‚
</code></pre> 
<h5><a id="3_214"></a>3.å·®å¼‚å¤‡ä»½å’Œè¿˜åŸ</h5> 
<p>å…ˆè¿›è¡Œå…¨å¤‡ï¼š<br> xtrabackup --defaults-file=/etc/my.cnf --backup --target-dir=/data/backup -uroot -predhat -H localhost -P 3306<br> å¢å¤‡ä»½1ï¼š<br> xtrabackup --defaults-file=/etc/my.cnf --backup --target-dir=/data/inc1 --incremental-basedir=/data/backup -uroot -predhat -H localhost -P 3306<br> å¢å¤‡ä»½2ï¼š<br> xtrabackup --defaults-file=/etc/my.cnf --backup --target-dir=/data/inc2 --incremental-basedir=/data/backup -uroot -predhat -H localhost -P 3306</p> 
<pre><code class="prism language-bash">è§£é‡Šï¼šå·®å¼‚å¤‡ä»½è·Ÿå¢é‡å¤‡ä»½å…¶å®å·®ä¸å¤šï¼Œåªä¸è¿‡å¢é‡å¤‡ä»½æ¯æ¬¡çš„å‚ç…§ç‰©æ˜¯å‰ä¸€ä¸ªï¼Œè€Œå·®å¼‚å¤‡ä»½çš„å‚ç…§ç‰©å°±æ˜¯å…¨å¤‡
</code></pre> 
<p><strong>æ¢å¤æ•°æ®ï¼š</strong><br> <strong>å‡†å¤‡è¿˜åŸå‘½ä»¤ï¼š</strong><br> xtrabackup --defaults-file=/etc/my.cnf --prepare --apply-log-only --target-dir=/data/backup/</p> 
<p>xtrabackup --defaults-file=/etc/my.cnf --prepare --target-dir=/data/backup --incremental-dir=/data/inc2/</p> 
<pre><code class="prism language-bash">è§£é‡Šï¼šå‡†å¤‡è¿˜åŸåªéœ€è¦ç¬¬ä¸€æ¬¡å¤‡ä»½å’Œæœ€åä¸€æ¬¡å¤‡ä»½å°±è¡Œ
</code></pre> 
<p><strong>æ¢å¤æ•°æ®åˆ°ç›®å½•ï¼š</strong><br> åœæ­¢æ•°æ®åº“å¹¶æ¸…ç©ºæ•°æ®åº“ç›®å½•<br> xtrabackup --defaults-file=/etc/my.cnf --copy-back --target-dir=/data/backup æ¢å¤<br> chown mysql:mysql /var/lib/mysql/ -R æŠŠæ–‡ä»¶çš„æ‰€æœ‰æ–‡ä»¶å±ç»„æ”¹æˆmysql<br> é‡å¯æ•°æ®åº“ï¼Œæ‰€æœ‰çš„æ•°æ®éƒ½åœ¨ï¼Œå·®å¼‚å¤‡ä»½å®éªŒå®Œæˆï¼<em>ğŸ‘Œ</em></p> 
<h5><a id="4_241"></a>4.å·®å¼‚å¤‡ä»½å’Œå¢é‡å¤‡ä»½çš„åŒºåˆ«</h5> 
<p><img src="https://images2.imgbox.com/42/6a/ZCWPGhkt_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br> æ€»ç»“ä¸€ä¸‹ï¼Œæ„Ÿè§‰å·®å¼‚å¤‡ä»½æ›´å¥½ç”¨ã€‚å·®å¼‚å¤‡ä»½éƒ½æ˜¯åŸºäºå…¨å¤‡å¤‡ä»½çš„ï¼Œè€Œä¸”è¿˜åŸçš„ æ—¶å€™åªéœ€è¦å‡†å¤‡å…¨å¤‡å’Œæœ€åä¸€æ¬¡å¢é‡å¤‡ä»½å°±è¡Œã€‚</p> 
<h5><a id="5_244"></a>5.å‹ç¼©å¤‡ä»½å’Œè¿˜åŸ</h5> 
<p>xtrabackup --defaults-file=/etc/my.cnf --backup --compress --target-dir=/data/backup/compressed/ -uroot -predhat -H localhost -P3306<br> è§£é‡Šï¼šcompresså°±æ˜¯å‹ç¼©çš„å‘½ä»¤ï¼Œå› ä¸ºæ•°æ®åº“çš„å¤‡ä»½çš„æ•°æ®æ¯”è¾ƒå¤§ï¼Œå ç”¨çš„ç©ºé—´ä¹Ÿæ¯”è¾ƒå¤šï¼Œè€Œå‹ç¼©å°±èƒ½å‡å°‘æ–‡ä»¶å¤§å°ã€‚</p> 
<pre><code class="prism language-bash">xtrabackup --defaults-file<span class="token operator">=</span>/etc/my.cnf <span class="token parameter variable">--backup</span> --compress-threads<span class="token operator">=</span><span class="token number">4</span> --target-dir<span class="token operator">=</span>/data/backup/compress/ <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-predhat</span> <span class="token parameter variable">-H</span> localhost <span class="token parameter variable">-P3306</span>
å¦‚æœè¦åŠ é€Ÿå‹ç¼©ï¼Œå¯ä»¥ä½¿ç”¨--compress-threads<span class="token operator">=</span><span class="token number">4</span> ï¼Œä½¿ç”¨å››ä¸ªçº¿ç¨‹åŒæ—¶è¿›è¡Œå‹ç¼©
</code></pre> 
<p><strong>è§£å‹ç¼©å’Œè¿˜åŸï¼š</strong><br> xtrabackup --defaults-file=/etc/my.cnf --decompress --target-dir=/data/backup/compressed/<br> è§£é‡Š:è§£å‹å‘½ä»¤ --decompressï¼Œä½¿ç”¨è¿™ä¸ªå‹ç¼©çš„å¤‡ä»½é›†åœ¨å‡†å¤‡å¤‡ä»½ä¹‹å‰éœ€è¦è§£å‹ï¼Œè§£å‹å·¥å…·æ˜¯qpressï¼ˆæŠ¥é”™å°±å®‰è£…è¿™ä¸ªï¼‰ï¼Œè§£å‹çš„åŸæ¥çš„æ–‡ä»¶ä¸ä¼šè¢«åˆ é™¤ï¼Œå¯ä»¥ä½¿ç”¨ --remove-originalé€‰é¡¹æ¸…é™¤ã€‚</p> 
<p>xtrabackup --prepare --target-dir=/data/backup/compressed/ å‡†å¤‡æ•°æ®é›†<br> xtrabackup --copy-back --target-dir=/data/backup/compressed è¿˜åŸ</p> 
<p>è§£é‡Šï¼šè·Ÿå…¨å¤‡ä¸€æ ·çš„è¿˜åŸ<br> chown mysql:mysql /var/lib/mysql/ -R æŠŠæ–‡ä»¶çš„æ‰€æœ‰æ–‡ä»¶å±ç»„æ”¹æˆmysql<br> é‡å¯æ•°æ®åº“ï¼Œæ‰€æœ‰çš„æ•°æ®éƒ½åœ¨ï¼Œå‹ç¼©å¤‡ä»½å®éªŒå®Œæˆï¼<em>ğŸ‘Œ</em></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1c8fa48059850eddc722a8b86363b43c/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">STM32 IAPè¿œç¨‹ç¨‹åºå‡çº§ï¼ˆåŸºäºHTTPï¼‰</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0ccb7d9698b45776566691bc8efedcb6/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">å®‰å…¨ç‹—è¿ç»­3å¹´è·å¾—ä¸­å›½ç½‘ç»œç©ºé—´å®‰å…¨åä¼šæ„Ÿè°¢</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 ç¼–ç¨‹å¤§ç™½çš„åšå®¢.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>