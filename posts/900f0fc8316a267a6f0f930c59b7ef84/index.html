<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【FPGA零基础学习之旅#12】三线制数码管驱动（74HC595）串行移位寄存器驱动 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【FPGA零基础学习之旅#12】三线制数码管驱动（74HC595）串行移位寄存器驱动" />
<meta property="og:description" content="🎉欢迎来到FPGA专栏~三线制数码管驱动
☆* o(≧▽≦)o *☆嗨~我是小夏与酒🍹 ✨博客主页：小夏与酒的博客 🎈该系列文章专栏：FPGA学习之旅 文章作者技术和水平有限，如果文中出现错误，希望大家能指正🙏📜 欢迎大家关注！ ❤️
🎉 目录-三线制数码管驱动 一、效果演示二、电路结构三、代码详解3.1 总体结构设计3.2 驱动74HC595芯片3.3 HEX8模块3.4 顶层模块 四、按键控制改变数据值 一、效果演示 🥝ISSP调试演示：
程序配置完成：
调试：
🥝按键控制演示：
二、电路结构 在三线制的数码管驱动中，使用74HC595芯片来减少FPGA的管脚数量使用。
关于74HC595芯片的介绍和时序图，参考文章：74HC595介绍 和 74HC595 驱动。
在AC620开发板上的数码管驱动电路：
AC620开发板使用的是74HC595芯片的级联来驱动显示：
三、代码详解 3.1 总体结构设计 先上RTL视图：
HEX8模块将seg和sel信号传给m74HC595_Driver模块，然后将接收到的信号转换为DS、SH_CP和ST_CP信号；ISSP模块用于调试。
3.2 驱动74HC595芯片 关于74HC595芯片的驱动，主要参考该时序图进行代码编写：
74HC595是8位串行移位寄存器，带有存储寄存器和三态寄存器，其中移位寄存器和存储寄存器分别采用不同的时钟。其可以把串行的信号转为并行的信号，因此常用做各种数码管以及点阵屏的驱动芯片。
该芯片的主要IO：
IO名称功能DS / SER串行数据输入端STCP / RCK存储寄存器的时钟输入。上升沿时移位寄存器中的数据进入存储寄存器，下降沿时存储寄存器中的数据保持不变。应用时通常将 ST_CP 置为低点平，移位结束后再在 ST_CP 端产生一个正脉冲更新显示数据。SHCP / SCK移位寄存器的时钟输入。上升沿时移位寄存器中的数据依次移动一位，即 Q0 中的数据移到 Q1 中，Q1 中的数据移到 Q2 中，依次类推；下降沿时移位寄存器中的数据保持不变。 由于在AC620开发板中芯片采用3.3V供电，这样在设计74HC595工作频率时，直接使用50M晶振四分频后的时钟作为其工作时钟。
74HC595的驱动代码，由于模块命名不能以数字开头，所以加了个m：
m74HC595_Driver.v：
module m74HC595_Driver( Clk, Rst_n, Data, S_EN, SH_CP,	//SCK ST_CP,	//RCK DS	//Data ); parameter DATA_WIDTH = 16; input Clk; input Rst_n; input [DATA_WIDTH-1 : 0] Data;	//data to send input S_EN;	//send en output reg SH_CP;	//shift clock output reg ST_CP;	//latch data clock output reg DS;	//shift serial data parameter CNT_MAX = 4; reg [15:0] divider_cnt;//分频计数器 wire sck_pluse; reg [4:0]SHCP_EDGE_CNT;//SH_CP EDGE counter reg [15:0]r_data; always@(posedge Clk or negedge Rst_n)begin if(!" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/900f0fc8316a267a6f0f930c59b7ef84/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-09-10T13:11:11+08:00" />
<meta property="article:modified_time" content="2023-09-10T13:11:11+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【FPGA零基础学习之旅#12】三线制数码管驱动（74HC595）串行移位寄存器驱动</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <p><font size="5" face="微软雅黑">🎉欢迎来到FPGA专栏~三线制数码管驱动</font></p> 
 <hr color="#000000" size='5"'> 
 <ul><li><font size="2" face="微软雅黑"> ☆* o(≧▽≦)o *☆<strong>嗨</strong>~我是<strong>小夏与酒</strong>🍹</font></li><li><font size="2" face="微软雅黑"> ✨<strong>博客主页：</strong><a href="https://blog.csdn.net/m0_56262476?type=blog">小夏与酒的博客</a></font></li><li><font size="2" face="微软雅黑"> 🎈该系列<strong>文章专栏：</strong><a href="https://blog.csdn.net/m0_56262476/category_12100936.html">FPGA学习之旅</a></font></li><li><font size="2" face="微软雅黑"> 文章作者技术和水平有限，如果文中出现错误，希望大家能指正🙏</font></li><li><font size="2" face="微软雅黑">📜 <strong>欢迎大家关注！</strong> ❤️</font><br> <img src="https://images2.imgbox.com/52/d9/MNCEsUak_o.jpg" alt="FPGQ2" width="90%"></li></ul> 
</blockquote> 
<p><img src="https://images2.imgbox.com/67/ca/5ahZ0UC8_o.gif" alt="CSDN"></p> 
<p></p> 
<div class="toc"> 
 <h4>🎉 目录-三线制数码管驱动</h4> 
 <ul><li><a href="#_18" rel="nofollow">一、效果演示</a></li><li><a href="#_33" rel="nofollow">二、电路结构</a></li><li><a href="#_42" rel="nofollow">三、代码详解</a></li><li><ul><li><a href="#31__43" rel="nofollow">3.1 总体结构设计</a></li><li><a href="#32_74HC595_49" rel="nofollow">3.2 驱动74HC595芯片</a></li><li><a href="#33_HEX8_184" rel="nofollow">3.3 HEX8模块</a></li><li><a href="#34__286" rel="nofollow">3.4 顶层模块</a></li></ul> 
  </li><li><a href="#_334" rel="nofollow">四、按键控制改变数据值</a></li></ul> 
</div> 
<p></p> 
<p><img src="https://images2.imgbox.com/c8/12/IpsysULp_o.png" alt="遇见未来"></p> 
<h2><a id="_18"></a>一、效果演示</h2> 
<p>🥝<strong>ISSP调试演示：</strong><br> 程序配置完成：<br> <img src="https://images2.imgbox.com/38/23/6tdprgZB_o.png" alt="程序配置"></p> 
<p>调试：<br> <img src="https://images2.imgbox.com/a3/47/D0ajKxgm_o.png" alt="测试结果"></p> 
<p>🥝<strong>按键控制演示：</strong><br> <img src="https://images2.imgbox.com/8e/b3/sD5XrT1T_o.gif" alt="按键控制"></p> 
<h2><a id="_33"></a>二、电路结构</h2> 
<p>在<strong>三线制</strong>的数码管驱动中，使用<strong>74HC595</strong>芯片来<strong>减少</strong>FPGA的管脚数量使用。</p> 
<p>关于74HC595芯片的介绍和<strong>时序图</strong>，参考文章：<a href="https://blog.csdn.net/qq_48764574/article/details/118463276?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=74HC595&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~blog~sobaiduweb~default-0-118463276.268%5Ev1%5Ekoosearch&amp;spm=1018.2226.3001.4450">74HC595介绍</a> 和 <a href="https://blog.csdn.net/zhuimeng_ruili/article/details/112537225?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522169374495916800197020929%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&amp;request_id=169374495916800197020929&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_ecpm_v1~rank_v31_ecpm-16-112537225-null-null.268%5Ev1%5Ekoosearch&amp;utm_term=74HC595%E6%97%B6%E5%BA%8F%E5%9B%BE&amp;spm=1018.2226.3001.4450">74HC595 驱动</a>。</p> 
<p>在AC620开发板上的数码管驱动电路：<br> <img src="https://images2.imgbox.com/95/6a/GyHhdGAc_o.png" alt="电路1"><br> AC620开发板使用的是74HC595芯片的<mark>级联</mark>来驱动显示：<br> <img src="https://images2.imgbox.com/1a/95/zMkK2PdF_o.png" alt="电路2"></p> 
<h2><a id="_42"></a>三、代码详解</h2> 
<h3><a id="31__43"></a>3.1 总体结构设计</h3> 
<p>先上RTL视图：<br> <img src="https://images2.imgbox.com/74/45/jkXHmAS2_o.png" alt="RTL"><br> HEX8模块将<mark>seg</mark>和<mark>sel</mark>信号传给m74HC595_Driver模块，然后将接收到的信号转换为<mark>DS、SH_CP和ST_CP</mark>信号；ISSP模块用于调试。</p> 
<h3><a id="32_74HC595_49"></a>3.2 驱动74HC595芯片</h3> 
<p>关于74HC595芯片的驱动，主要参考该时序图进行代码编写：<br> <img src="https://images2.imgbox.com/8a/05/0bB3Jz3B_o.png" alt="时序图"></p> 
<blockquote> 
 <p>74HC595是<mark>8位</mark>串行移位寄存器，带有存储寄存器和三态寄存器，其中移位寄存器和存储寄存器分别采用不同的时钟。其可以<mark>把串行的信号转为并行的信号</mark>，因此常用做各种数码管以及点阵屏的驱动芯片。</p> 
</blockquote> 
<p>该芯片的主要IO：</p> 
<table><thead><tr><th>IO名称</th><th>功能</th></tr></thead><tbody><tr><td>DS / SER</td><td>串行数据输入端</td></tr><tr><td>STCP / RCK</td><td>存储寄存器的时钟输入。上升沿时移位寄存器中的数据进入存储寄存器，下降沿时存储寄存器中的数据保持不变。应用时通常将 ST_CP 置为低点平，移位结束后再在 ST_CP 端产生一个正脉冲更新显示数据。</td></tr><tr><td>SHCP / SCK</td><td>移位寄存器的时钟输入。上升沿时移位寄存器中的数据依次移动一位，即 Q0 中的数据移到 Q1 中，Q1 中的数据移到 Q2 中，依次类推；下降沿时移位寄存器中的数据保持不变。</td></tr></tbody></table> 
<p>由于在AC620开发板中芯片采用<mark>3.3V</mark>供电，这样在设计74HC595工作频率时，<strong>直接使用50M晶振四分频后的时钟作为其工作时钟。</strong></p> 
<p>74HC595的驱动代码，由于模块命名不能以数字开头，所以加了个m：</p> 
<blockquote> 
 <p>m74HC595_Driver.v：</p> 
</blockquote> 
<pre><code class="prism language-c">module <span class="token function">m74HC595_Driver</span><span class="token punctuation">(</span>
		Clk<span class="token punctuation">,</span>
		Rst_n<span class="token punctuation">,</span>
		Data<span class="token punctuation">,</span>
		S_EN<span class="token punctuation">,</span>
		SH_CP<span class="token punctuation">,</span>	<span class="token comment">//SCK</span>
		ST_CP<span class="token punctuation">,</span>	<span class="token comment">//RCK</span>
		DS		<span class="token comment">//Data</span>
	<span class="token punctuation">)</span><span class="token punctuation">;</span>

	parameter DATA_WIDTH <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">;</span>

	input 		Clk<span class="token punctuation">;</span>
	input 		Rst_n<span class="token punctuation">;</span>
	input 		<span class="token punctuation">[</span>DATA_WIDTH<span class="token operator">-</span><span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">]</span> Data<span class="token punctuation">;</span>	<span class="token comment">//data to send</span>
	input 		S_EN<span class="token punctuation">;</span>						<span class="token comment">//send en</span>
	output reg 	SH_CP<span class="token punctuation">;</span>						<span class="token comment">//shift clock</span>
	output reg 	ST_CP<span class="token punctuation">;</span>						<span class="token comment">//latch data clock</span>
	output reg 	DS<span class="token punctuation">;</span>							<span class="token comment">//shift serial data</span>
	
	parameter CNT_MAX <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
		
	reg <span class="token punctuation">[</span><span class="token number">15</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span> divider_cnt<span class="token punctuation">;</span><span class="token comment">//分频计数器</span>
	wire sck_pluse<span class="token punctuation">;</span>
	
	reg <span class="token punctuation">[</span><span class="token number">4</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span>SHCP_EDGE_CNT<span class="token punctuation">;</span><span class="token comment">//SH_CP EDGE counter</span>
	
	reg <span class="token punctuation">[</span><span class="token number">15</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span>r_data<span class="token punctuation">;</span>
	
	always@<span class="token punctuation">(</span>posedge Clk or negedge Rst_n<span class="token punctuation">)</span>begin
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>Rst_n<span class="token punctuation">)</span>
			r_data <span class="token operator">&lt;=</span> <span class="token number">16</span>'d0<span class="token punctuation">;</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>S_EN<span class="token punctuation">)</span>
			r_data <span class="token operator">&lt;=</span> Data<span class="token punctuation">;</span>
		<span class="token keyword">else</span>
			r_data <span class="token operator">&lt;=</span> r_data<span class="token punctuation">;</span>
	end
		
	<span class="token comment">//clock divide</span>
	always@<span class="token punctuation">(</span>posedge Clk or negedge Rst_n<span class="token punctuation">)</span>begin
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>Rst_n<span class="token punctuation">)</span>
			divider_cnt <span class="token operator">&lt;=</span> <span class="token number">16</span>'d0<span class="token punctuation">;</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>divider_cnt <span class="token operator">==</span> CNT_MAX<span class="token punctuation">)</span>
			divider_cnt <span class="token operator">&lt;=</span> <span class="token number">16</span>'d0<span class="token punctuation">;</span>
		<span class="token keyword">else</span>
			divider_cnt <span class="token operator">&lt;=</span> divider_cnt <span class="token operator">+</span> <span class="token number">1</span>'b1<span class="token punctuation">;</span>
	end
	
	assign sck_pluse <span class="token operator">=</span> <span class="token punctuation">(</span>divider_cnt <span class="token operator">==</span> CNT_MAX<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	always@<span class="token punctuation">(</span>posedge Clk or negedge Rst_n<span class="token punctuation">)</span>begin
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>Rst_n<span class="token punctuation">)</span>
			SHCP_EDGE_CNT <span class="token operator">&lt;=</span> <span class="token number">5</span>'d0<span class="token punctuation">;</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>sck_pluse<span class="token punctuation">)</span>begin
			<span class="token keyword">if</span><span class="token punctuation">(</span>SHCP_EDGE_CNT <span class="token operator">==</span>  <span class="token number">5</span>'d31<span class="token punctuation">)</span>
				SHCP_EDGE_CNT <span class="token operator">&lt;=</span> <span class="token number">5</span>'d0<span class="token punctuation">;</span>
			<span class="token keyword">else</span>
				SHCP_EDGE_CNT <span class="token operator">&lt;=</span> SHCP_EDGE_CNT <span class="token operator">+</span> <span class="token number">1</span>'b1<span class="token punctuation">;</span>
		end
		<span class="token keyword">else</span>
			SHCP_EDGE_CNT <span class="token operator">&lt;=</span> SHCP_EDGE_CNT<span class="token punctuation">;</span>
	end	
		
	always@<span class="token punctuation">(</span>posedge Clk or negedge Rst_n<span class="token punctuation">)</span>begin
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>Rst_n<span class="token punctuation">)</span>begin
			SH_CP <span class="token operator">&lt;=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
			ST_CP <span class="token operator">&lt;=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
			DS <span class="token operator">&lt;=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>	
		end
		<span class="token keyword">else</span> begin
			<span class="token keyword">case</span><span class="token punctuation">(</span>SHCP_EDGE_CNT<span class="token punctuation">)</span>
				<span class="token number">5</span><span class="token char">'d0: begin SH_CP &lt;= 1'</span>b0<span class="token punctuation">;</span> ST_CP <span class="token operator">&lt;=</span> <span class="token number">1</span>'b1<span class="token punctuation">;</span> DS <span class="token operator">&lt;=</span> r_data<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">;</span> end
				<span class="token number">5</span><span class="token char">'d1: begin SH_CP &lt;= 1'</span>b1<span class="token punctuation">;</span> ST_CP <span class="token operator">&lt;=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>end
				<span class="token number">5</span><span class="token char">'d2: begin SH_CP &lt;= 1'</span>b0<span class="token punctuation">;</span> DS <span class="token operator">&lt;=</span> r_data<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span><span class="token punctuation">;</span>end
				<span class="token number">5</span><span class="token char">'d3: begin SH_CP &lt;= 1'</span>b1<span class="token punctuation">;</span> end
				<span class="token number">5</span><span class="token char">'d4: begin SH_CP &lt;= 1'</span>b0<span class="token punctuation">;</span> DS <span class="token operator">&lt;=</span> r_data<span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">]</span><span class="token punctuation">;</span>end
				<span class="token number">5</span><span class="token char">'d5: begin SH_CP &lt;= 1'</span>b1<span class="token punctuation">;</span> end
				<span class="token number">5</span><span class="token char">'d6: begin SH_CP &lt;= 1'</span>b0<span class="token punctuation">;</span> DS <span class="token operator">&lt;=</span> r_data<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">;</span>end
				<span class="token number">5</span><span class="token char">'d7: begin SH_CP &lt;= 1'</span>b1<span class="token punctuation">;</span> end
				<span class="token number">5</span><span class="token char">'d8: begin SH_CP &lt;= 1'</span>b0<span class="token punctuation">;</span> DS <span class="token operator">&lt;=</span> r_data<span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">;</span>end
				<span class="token number">5</span><span class="token char">'d9: begin SH_CP &lt;= 1'</span>b1<span class="token punctuation">;</span> end
				<span class="token number">5</span><span class="token char">'d10:begin SH_CP &lt;= 1'</span>b0<span class="token punctuation">;</span> DS <span class="token operator">&lt;=</span> r_data<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span>end
				<span class="token number">5</span><span class="token char">'d11:begin SH_CP &lt;= 1'</span>b1<span class="token punctuation">;</span> end
				<span class="token number">5</span><span class="token char">'d12:begin SH_CP &lt;= 1'</span>b0<span class="token punctuation">;</span> DS <span class="token operator">&lt;=</span> r_data<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">;</span>end
				<span class="token number">5</span><span class="token char">'d13:begin SH_CP &lt;= 1'</span>b1<span class="token punctuation">;</span> end
				<span class="token number">5</span><span class="token char">'d14:begin SH_CP &lt;= 1'</span>b0<span class="token punctuation">;</span> DS <span class="token operator">&lt;=</span> r_data<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span>end
				<span class="token number">5</span><span class="token char">'d15:begin SH_CP &lt;= 1'</span>b1<span class="token punctuation">;</span> end
				<span class="token number">5</span><span class="token char">'d16:begin SH_CP &lt;= 1'</span>b0<span class="token punctuation">;</span> DS <span class="token operator">&lt;=</span> r_data<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">;</span>end
				<span class="token number">5</span><span class="token char">'d17:begin SH_CP &lt;= 1'</span>b1<span class="token punctuation">;</span> end
				<span class="token number">5</span><span class="token char">'d18:begin SH_CP &lt;= 1'</span>b0<span class="token punctuation">;</span> DS <span class="token operator">&lt;=</span> r_data<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span>end
				<span class="token number">5</span><span class="token char">'d19:begin SH_CP &lt;= 1'</span>b1<span class="token punctuation">;</span> end
				<span class="token number">5</span><span class="token char">'d20:begin SH_CP &lt;= 1'</span>b0<span class="token punctuation">;</span> DS <span class="token operator">&lt;=</span> r_data<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>end
				<span class="token number">5</span><span class="token char">'d21:begin SH_CP &lt;= 1'</span>b1<span class="token punctuation">;</span> end
				<span class="token number">5</span><span class="token char">'d22:begin SH_CP &lt;= 1'</span>b0<span class="token punctuation">;</span> DS <span class="token operator">&lt;=</span> r_data<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>end
				<span class="token number">5</span><span class="token char">'d23:begin SH_CP &lt;= 1'</span>b1<span class="token punctuation">;</span> end
				<span class="token number">5</span><span class="token char">'d24:begin SH_CP &lt;= 1'</span>b0<span class="token punctuation">;</span> DS <span class="token operator">&lt;=</span> r_data<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>end
				<span class="token number">5</span><span class="token char">'d25:begin SH_CP &lt;= 1'</span>b1<span class="token punctuation">;</span> end
				<span class="token number">5</span><span class="token char">'d26:begin SH_CP &lt;= 1'</span>b0<span class="token punctuation">;</span> DS <span class="token operator">&lt;=</span> r_data<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>end
				<span class="token number">5</span><span class="token char">'d27:begin SH_CP &lt;= 1'</span>b1<span class="token punctuation">;</span> end
				<span class="token number">5</span><span class="token char">'d28:begin SH_CP &lt;= 1'</span>b0<span class="token punctuation">;</span> DS <span class="token operator">&lt;=</span> r_data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>end
				<span class="token number">5</span><span class="token char">'d29:begin SH_CP &lt;= 1'</span>b1<span class="token punctuation">;</span> end
				<span class="token number">5</span><span class="token char">'d30:begin SH_CP &lt;= 1'</span>b0<span class="token punctuation">;</span> DS <span class="token operator">&lt;=</span> r_data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>end
				<span class="token number">5</span><span class="token char">'d31:begin SH_CP &lt;= 1'</span>b1<span class="token punctuation">;</span> end
				<span class="token keyword">default</span><span class="token operator">:</span>begin SH_CP <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token char">'b0;ST_CP &lt;= 1'</span>b0<span class="token punctuation">;</span>DS <span class="token operator">&lt;=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>	end
			endcase	
		end
	end

endmodule

</code></pre> 
<blockquote> 
 <p>RTL视图：</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/9f/06/wB9pkSHl_o.png" alt="RTL74"></p> 
<h3><a id="33_HEX8_184"></a>3.3 HEX8模块</h3> 
<p>该模块的设计是在该文章的讲解基础之上进行修改：<a href="https://blog.csdn.net/m0_56262476/article/details/132528587?spm=1001.2014.3001.5502">【FPGA零基础学习之旅#11】数码管动态扫描</a>。</p> 
<p>上述参考文章中的模块可以称为HEX6，驱动了6个数码管，在此我们<strong>需要驱动8个数码管</strong>，故可以将模块命名为HEX8。</p> 
<p><mark>需要注意的是，在设计数码管位选的时候，一定要看清使用板子的电路结构，弄清楚是高电平位选还是低电平位选！</mark></p> 
<blockquote> 
 <p>HEX8.v：</p> 
</blockquote> 
<pre><code class="prism language-c">module <span class="token function">HEX8</span><span class="token punctuation">(</span>
		input 					Clk<span class="token punctuation">,</span>		<span class="token comment">//50M</span>
		input 					Rst_n<span class="token punctuation">,</span>		<span class="token comment">//复位</span>
		input 					En<span class="token punctuation">,</span>			<span class="token comment">//数码管显示使能</span>
		input 		<span class="token punctuation">[</span><span class="token number">31</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span>		disp_data<span class="token punctuation">,</span>	<span class="token comment">//8 × 4 = 32（8个数码管，数据格式为hex，总共输32位）</span>
		output reg 	<span class="token punctuation">[</span><span class="token number">7</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span>		seg<span class="token punctuation">,</span> 		<span class="token comment">//数码管段选</span>
		output 		<span class="token punctuation">[</span><span class="token number">7</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span>		sel	 		<span class="token comment">//数码管位选（数码管选择）</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
	reg <span class="token punctuation">[</span><span class="token number">7</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span>sel_r<span class="token punctuation">;</span>

<span class="token comment">//--------&lt;分频器&gt;--------</span>
	reg <span class="token punctuation">[</span><span class="token number">14</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span>divider_cnt<span class="token punctuation">;</span><span class="token comment">//25000-1</span>
	
	reg clk_1K<span class="token punctuation">;</span>
	
	reg <span class="token punctuation">[</span><span class="token number">3</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span>data_tmp<span class="token punctuation">;</span><span class="token comment">//待显示数据缓存</span>
	
	<span class="token comment">//1KHz分频计数器</span>
	always@<span class="token punctuation">(</span>posedge Clk or negedge Rst_n<span class="token punctuation">)</span>begin
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>Rst_n<span class="token punctuation">)</span>
			divider_cnt <span class="token operator">&lt;=</span> <span class="token number">15</span>'d0<span class="token punctuation">;</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>En<span class="token punctuation">)</span>
			divider_cnt <span class="token operator">&lt;=</span> <span class="token number">15</span>'d0<span class="token punctuation">;</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>divider_cnt <span class="token operator">==</span> <span class="token number">24999</span><span class="token punctuation">)</span>
			divider_cnt <span class="token operator">&lt;=</span> <span class="token number">15</span>'d0<span class="token punctuation">;</span>
		<span class="token keyword">else</span>
			divider_cnt <span class="token operator">&lt;=</span> divider_cnt <span class="token operator">+</span> <span class="token number">1</span>'b1<span class="token punctuation">;</span>
	end
	
	<span class="token comment">//1KHz扫描时钟</span>
	always@<span class="token punctuation">(</span>posedge Clk or negedge Rst_n<span class="token punctuation">)</span>begin
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>Rst_n<span class="token punctuation">)</span>
			clk_1K <span class="token operator">&lt;=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>divider_cnt <span class="token operator">==</span> <span class="token number">24999</span><span class="token punctuation">)</span>
			clk_1K <span class="token operator">&lt;=</span> <span class="token operator">~</span>clk_1K<span class="token punctuation">;</span>
		<span class="token keyword">else</span>
			clk_1K <span class="token operator">&lt;=</span> clk_1K<span class="token punctuation">;</span>
	end
	
<span class="token comment">//--------&lt;6位循环移位寄存器&gt;--------	</span>
	always@<span class="token punctuation">(</span>posedge clk_1K or negedge Rst_n<span class="token punctuation">)</span>begin
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>Rst_n<span class="token punctuation">)</span>
			sel_r <span class="token operator">&lt;=</span> <span class="token number">8</span>'b0000_0001<span class="token punctuation">;</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>sel_r <span class="token operator">==</span> <span class="token number">8</span>'b1000_0000<span class="token punctuation">)</span>
			sel_r <span class="token operator">&lt;=</span> <span class="token number">8</span>'b0000_0001<span class="token punctuation">;</span>
		<span class="token keyword">else</span>
			sel_r <span class="token operator">&lt;=</span> sel_r <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">;</span>
	end	

<span class="token comment">//--------&lt;6选1多路器&gt;--------		</span>
	always@<span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span>begin
		<span class="token keyword">case</span><span class="token punctuation">(</span>sel_r<span class="token punctuation">)</span>
			<span class="token number">8</span>'b0000_0001<span class="token operator">:</span>data_tmp <span class="token operator">=</span> disp_data<span class="token punctuation">[</span><span class="token number">3</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
			<span class="token number">8</span>'b0000_0010<span class="token operator">:</span>data_tmp <span class="token operator">=</span> disp_data<span class="token punctuation">[</span><span class="token number">7</span><span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
			<span class="token number">8</span>'b0000_0100<span class="token operator">:</span>data_tmp <span class="token operator">=</span> disp_data<span class="token punctuation">[</span><span class="token number">11</span><span class="token operator">:</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
			<span class="token number">8</span>'b0000_1000<span class="token operator">:</span>data_tmp <span class="token operator">=</span> disp_data<span class="token punctuation">[</span><span class="token number">15</span><span class="token operator">:</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
			<span class="token number">8</span>'b0001_0000<span class="token operator">:</span>data_tmp <span class="token operator">=</span> disp_data<span class="token punctuation">[</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
			<span class="token number">8</span>'b0010_0000<span class="token operator">:</span>data_tmp <span class="token operator">=</span> disp_data<span class="token punctuation">[</span><span class="token number">23</span><span class="token operator">:</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
			<span class="token number">8</span>'b0100_0000<span class="token operator">:</span>data_tmp <span class="token operator">=</span> disp_data<span class="token punctuation">[</span><span class="token number">27</span><span class="token operator">:</span><span class="token number">24</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
			<span class="token number">8</span>'b1000_0000<span class="token operator">:</span>data_tmp <span class="token operator">=</span> disp_data<span class="token punctuation">[</span><span class="token number">31</span><span class="token operator">:</span><span class="token number">28</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
			<span class="token keyword">default</span><span class="token operator">:</span>data_tmp <span class="token operator">=</span> <span class="token number">4</span>'b0000<span class="token punctuation">;</span>
		endcase
	end

<span class="token comment">//--------&lt;LUT&gt;--------		</span>
	always@<span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span>begin
		<span class="token keyword">case</span><span class="token punctuation">(</span>data_tmp<span class="token punctuation">)</span>
			<span class="token number">4</span><span class="token char">'h0:seg = 8'</span>hc0<span class="token punctuation">;</span>
			<span class="token number">4</span><span class="token char">'h1:seg = 8'</span>hf9<span class="token punctuation">;</span>
			<span class="token number">4</span><span class="token char">'h2:seg = 8'</span>ha4<span class="token punctuation">;</span>
			<span class="token number">4</span><span class="token char">'h3:seg = 8'</span>hb0<span class="token punctuation">;</span>
			<span class="token number">4</span><span class="token char">'h4:seg = 8'</span>h99<span class="token punctuation">;</span>
			<span class="token number">4</span><span class="token char">'h5:seg = 8'</span>h92<span class="token punctuation">;</span>
			<span class="token number">4</span><span class="token char">'h6:seg = 8'</span>h82<span class="token punctuation">;</span>
			<span class="token number">4</span><span class="token char">'h7:seg = 8'</span>hf8<span class="token punctuation">;</span>
			<span class="token number">4</span><span class="token char">'h8:seg = 8'</span>h80<span class="token punctuation">;</span>
			<span class="token number">4</span><span class="token char">'h9:seg = 8'</span>h90<span class="token punctuation">;</span>
			<span class="token number">4</span><span class="token char">'ha:seg = 8'</span>h88<span class="token punctuation">;</span>
			<span class="token number">4</span><span class="token char">'hb:seg = 8'</span>h83<span class="token punctuation">;</span>
			<span class="token number">4</span><span class="token char">'hc:seg = 8'</span>hc6<span class="token punctuation">;</span>
			<span class="token number">4</span><span class="token char">'hd:seg = 8'</span>ha1<span class="token punctuation">;</span>
			<span class="token number">4</span><span class="token char">'he:seg = 8'</span>h86<span class="token punctuation">;</span>
			<span class="token number">4</span><span class="token char">'hf:seg = 8'</span>h8e<span class="token punctuation">;</span>
		endcase
	end
		
<span class="token comment">//--------&lt;2选1多路器&gt;--------		</span>
	assign sel <span class="token operator">=</span> <span class="token punctuation">(</span>En<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">(</span>sel_r<span class="token punctuation">)</span><span class="token operator">:</span><span class="token number">8</span>'b1111_1111<span class="token punctuation">;</span>
		
endmodule

</code></pre> 
<h3><a id="34__286"></a>3.4 顶层模块</h3> 
<p>在顶层模块中需要调用ISSP这样的一个IP核，操作过程和调试方法参考：<a href="https://blog.csdn.net/m0_56262476/article/details/132528587?spm=1001.2014.3001.5502">【FPGA零基础学习之旅#11】数码管动态扫描</a>。</p> 
<blockquote> 
 <p>smg.v：</p> 
</blockquote> 
<pre><code class="prism language-c">module <span class="token function">smg</span><span class="token punctuation">(</span>
	input 			Clk<span class="token punctuation">,</span>		<span class="token comment">//50M</span>
	input 			Rst_n<span class="token punctuation">,</span>
	<span class="token comment">//input [31:0] 	disp_data,</span>
	output 			SH_CP<span class="token punctuation">,</span>		<span class="token comment">//shift clock</span>
	output 			ST_CP<span class="token punctuation">,</span>		<span class="token comment">//latch data clock</span>
	output 			DS			<span class="token comment">//shift serial data</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	wire <span class="token punctuation">[</span><span class="token number">7</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span> sel<span class="token punctuation">;</span><span class="token comment">//数码管位选（选择当前要显示的数码管）</span>
	wire <span class="token punctuation">[</span><span class="token number">7</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span> seg<span class="token punctuation">;</span><span class="token comment">//数码管段选（当前要显示的内容）	</span>

	wire  <span class="token punctuation">[</span><span class="token number">31</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span> disp_data<span class="token punctuation">;</span>
	
	ISSP <span class="token function">UISSP</span><span class="token punctuation">(</span>
		<span class="token punctuation">.</span><span class="token function">probe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span>disp_data<span class="token punctuation">)</span>
	<span class="token punctuation">)</span><span class="token punctuation">;</span>
		
	HEX8 <span class="token function">UHEX8</span><span class="token punctuation">(</span>
		<span class="token punctuation">.</span><span class="token function">Clk</span><span class="token punctuation">(</span>Clk<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">.</span><span class="token function">Rst_n</span><span class="token punctuation">(</span>Rst_n<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">.</span><span class="token function">En</span><span class="token punctuation">(</span><span class="token number">1</span>'b1<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">.</span><span class="token function">disp_data</span><span class="token punctuation">(</span>disp_data<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">.</span><span class="token function">sel</span><span class="token punctuation">(</span>sel<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">.</span><span class="token function">seg</span><span class="token punctuation">(</span>seg<span class="token punctuation">)</span>
	<span class="token punctuation">)</span><span class="token punctuation">;</span>
		
	m74HC595_Driver <span class="token function">Um74HC595_Driver</span><span class="token punctuation">(</span>
		<span class="token punctuation">.</span><span class="token function">Clk</span><span class="token punctuation">(</span>Clk<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">.</span><span class="token function">Rst_n</span><span class="token punctuation">(</span>Rst_n<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">.</span><span class="token function">Data</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>seg<span class="token punctuation">,</span>sel<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">.</span><span class="token function">S_EN</span><span class="token punctuation">(</span><span class="token number">1</span>'b1<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">.</span><span class="token function">SH_CP</span><span class="token punctuation">(</span>SH_CP<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">.</span><span class="token function">ST_CP</span><span class="token punctuation">(</span>ST_CP<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">.</span><span class="token function">DS</span><span class="token punctuation">(</span>DS<span class="token punctuation">)</span>
	<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
endmodule

</code></pre> 
<h2><a id="_334"></a>四、按键控制改变数据值</h2> 
<p><strong>项目要求：</strong> 通过控制按键，使得数码管显示不同的数据内容。</p> 
<p><strong>实现效果：</strong><br> <img src="https://images2.imgbox.com/2f/78/gOuQSOU2_o.gif" alt="实现效果"><br> 先看<strong>RTL视图</strong>来理解整体框架：<br> <img src="https://images2.imgbox.com/33/5f/yaSf8YRh_o.png" alt="RTL3"><br> 按下按键1，数码管显示12345678；按下按键2，数码管显示89abcdef。</p> 
<p>按键消抖模块的设计参考该文章：<a href="https://blog.csdn.net/m0_56262476/article/details/132248452?spm=1001.2014.3001.5502">【FPGA零基础学习之旅#10】按键消抖模块设计与验证（一段式状态机实现）</a>。</p> 
<p>在此贴出按键消抖的代码：</p> 
<blockquote> 
 <p>KeyFilter.v：</p> 
</blockquote> 
<pre><code class="prism language-c"><span class="token comment">//</span>
<span class="token comment">//模块：按键消抖模块</span>
<span class="token comment">//key_state：输出消抖之后按键的状态</span>
<span class="token comment">//key_flag：按键消抖结束时产生一个时钟周期的高电平脉冲</span>
<span class="token comment">//</span>
module <span class="token function">KeyFilter</span><span class="token punctuation">(</span>
	input Clk<span class="token punctuation">,</span>
	input Rst_n<span class="token punctuation">,</span>
	input key_in<span class="token punctuation">,</span>
	output reg key_flag<span class="token punctuation">,</span>
	output reg key_state
<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//按键的四个状态</span>
	localparam
		IDLE 		<span class="token operator">=</span> <span class="token number">4</span>'b0001<span class="token punctuation">,</span>
		FILTER1 	<span class="token operator">=</span> <span class="token number">4</span>'b0010<span class="token punctuation">,</span>
		DOWN 		<span class="token operator">=</span> <span class="token number">4</span>'b0100<span class="token punctuation">,</span>
		FILTER2 	<span class="token operator">=</span> <span class="token number">4</span>'b1000<span class="token punctuation">;</span>

	<span class="token comment">//状态寄存器</span>
	reg <span class="token punctuation">[</span><span class="token number">3</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span> curr_st<span class="token punctuation">;</span>
	
	<span class="token comment">//边沿检测输出上升沿或下降沿</span>
	wire pedge<span class="token punctuation">;</span>
	wire nedge<span class="token punctuation">;</span>
	
	<span class="token comment">//计数寄存器</span>
	reg <span class="token punctuation">[</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span>cnt<span class="token punctuation">;</span>
	
	<span class="token comment">//使能计数寄存器</span>
	reg en_cnt<span class="token punctuation">;</span>
	
	<span class="token comment">//计数满标志信号</span>
	reg cnt_full<span class="token punctuation">;</span><span class="token comment">//计数满寄存器</span>
	
<span class="token comment">//------&lt;边沿检测电路的实现&gt;------</span>
	<span class="token comment">//边沿检测电路寄存器</span>
	reg key_tmp0<span class="token punctuation">;</span>
	reg key_tmp1<span class="token punctuation">;</span>
	
	<span class="token comment">//边沿检测</span>
	always@<span class="token punctuation">(</span>posedge Clk or negedge Rst_n<span class="token punctuation">)</span>begin
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>Rst_n<span class="token punctuation">)</span>begin
			key_tmp0 <span class="token operator">&lt;=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
			key_tmp1 <span class="token operator">&lt;=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
		end
		<span class="token keyword">else</span> begin
			key_tmp0 <span class="token operator">&lt;=</span> key_in<span class="token punctuation">;</span>
			key_tmp1 <span class="token operator">&lt;=</span> key_tmp0<span class="token punctuation">;</span>
		end	
	end
		
	assign nedge <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">!</span>key_tmp0<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>key_tmp1<span class="token punctuation">)</span><span class="token punctuation">;</span>
	assign pedge <span class="token operator">=</span> <span class="token punctuation">(</span>key_tmp0<span class="token punctuation">)</span>  <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token operator">!</span>key_tmp1<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//------&lt;状态机主程序&gt;------	</span>
	<span class="token comment">//状态机主程序</span>
	always@<span class="token punctuation">(</span>posedge Clk or negedge Rst_n<span class="token punctuation">)</span>begin
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>Rst_n<span class="token punctuation">)</span>begin
			curr_st <span class="token operator">&lt;=</span> IDLE<span class="token punctuation">;</span>
			en_cnt <span class="token operator">&lt;=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
			key_flag <span class="token operator">&lt;=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
			key_state <span class="token operator">&lt;=</span> <span class="token number">1</span>'b1<span class="token punctuation">;</span>
		end
		<span class="token keyword">else</span> begin
			<span class="token keyword">case</span><span class="token punctuation">(</span>curr_st<span class="token punctuation">)</span>
				IDLE<span class="token operator">:</span>begin
					key_flag <span class="token operator">&lt;=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
					<span class="token keyword">if</span><span class="token punctuation">(</span>nedge<span class="token punctuation">)</span>begin
						curr_st <span class="token operator">&lt;=</span> FILTER1<span class="token punctuation">;</span>
						en_cnt <span class="token operator">&lt;=</span> <span class="token number">1</span>'b1<span class="token punctuation">;</span>
					end
					<span class="token keyword">else</span>
						curr_st <span class="token operator">&lt;=</span> IDLE<span class="token punctuation">;</span>
				end
				
				FILTER1<span class="token operator">:</span>begin
					<span class="token keyword">if</span><span class="token punctuation">(</span>cnt_full<span class="token punctuation">)</span>begin
						key_flag <span class="token operator">&lt;=</span> <span class="token number">1</span>'b1<span class="token punctuation">;</span>
						key_state <span class="token operator">&lt;=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
						curr_st <span class="token operator">&lt;=</span> DOWN<span class="token punctuation">;</span>
						en_cnt <span class="token operator">&lt;=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
					end	
					<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>pedge<span class="token punctuation">)</span>begin
						curr_st <span class="token operator">&lt;=</span> IDLE<span class="token punctuation">;</span>
						en_cnt <span class="token operator">&lt;=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
					end
					<span class="token keyword">else</span>
						curr_st <span class="token operator">&lt;=</span> FILTER1<span class="token punctuation">;</span>
				end
				
				DOWN<span class="token operator">:</span>begin
					key_flag <span class="token operator">&lt;=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
					<span class="token keyword">if</span><span class="token punctuation">(</span>pedge<span class="token punctuation">)</span>begin
						curr_st <span class="token operator">&lt;=</span> FILTER2<span class="token punctuation">;</span>
						en_cnt <span class="token operator">&lt;=</span> <span class="token number">1</span>'b1<span class="token punctuation">;</span>
					end
					<span class="token keyword">else</span>
						curr_st <span class="token operator">&lt;=</span> DOWN<span class="token punctuation">;</span>
				end
				
				FILTER2<span class="token operator">:</span>begin
					<span class="token keyword">if</span><span class="token punctuation">(</span>cnt_full<span class="token punctuation">)</span>begin
						key_flag <span class="token operator">&lt;=</span> <span class="token number">1</span>'b1<span class="token punctuation">;</span>
						key_state <span class="token operator">&lt;=</span> <span class="token number">1</span>'b1<span class="token punctuation">;</span>
						curr_st <span class="token operator">&lt;=</span> IDLE<span class="token punctuation">;</span>
						en_cnt <span class="token operator">&lt;=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
					end	
					<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>nedge<span class="token punctuation">)</span>begin
						curr_st <span class="token operator">&lt;=</span> DOWN<span class="token punctuation">;</span>
						en_cnt <span class="token operator">&lt;=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
					end
					<span class="token keyword">else</span>
						curr_st <span class="token operator">&lt;=</span> FILTER2<span class="token punctuation">;</span>
				end
				
				<span class="token keyword">default</span><span class="token operator">:</span>begin
					curr_st <span class="token operator">&lt;=</span> IDLE<span class="token punctuation">;</span>
					en_cnt <span class="token operator">&lt;=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
					key_flag <span class="token operator">&lt;=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
					key_state <span class="token operator">&lt;=</span> <span class="token number">1</span>'b1<span class="token punctuation">;</span>
				end
			endcase
		end
	end
	
<span class="token comment">//------&lt;20ms计数器&gt;------		</span>
	<span class="token comment">//20ms计数器</span>
	<span class="token comment">//Clk 50_000_000Hz</span>
	<span class="token comment">//一个时钟周期为20ns</span>
	<span class="token comment">//需要计数20_000_000 / 20 = 1_000_000次</span>
	
	always@<span class="token punctuation">(</span>posedge Clk or negedge Rst_n<span class="token punctuation">)</span>begin
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>Rst_n<span class="token punctuation">)</span>
			cnt <span class="token operator">&lt;=</span> <span class="token number">20</span>'d0<span class="token punctuation">;</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>en_cnt<span class="token punctuation">)</span>
			cnt <span class="token operator">&lt;=</span> cnt <span class="token operator">+</span> <span class="token number">1</span>'b1<span class="token punctuation">;</span>
		<span class="token keyword">else</span>
			cnt <span class="token operator">&lt;=</span> <span class="token number">20</span>'d0<span class="token punctuation">;</span>
	end
	
	always@<span class="token punctuation">(</span>posedge Clk or negedge Rst_n<span class="token punctuation">)</span>begin
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>Rst_n<span class="token punctuation">)</span>
			cnt_full <span class="token operator">&lt;=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>cnt <span class="token operator">==</span> <span class="token number">999</span>_999<span class="token punctuation">)</span>
			cnt_full <span class="token operator">&lt;=</span> <span class="token number">1</span>'b1<span class="token punctuation">;</span>
		<span class="token keyword">else</span>
			cnt_full <span class="token operator">&lt;=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
	end
	
endmodule

</code></pre> 
<p>简单编写了一个KeyData模块<strong>用于不同数据的输入</strong>：</p> 
<blockquote> 
 <p>KeyData.v：</p> 
</blockquote> 
<pre><code class="prism language-c">module <span class="token function">KeyData</span><span class="token punctuation">(</span>
	input Clk<span class="token punctuation">,</span>
	input Rst_n<span class="token punctuation">,</span>
	input Key_state1<span class="token punctuation">,</span>
	input Key_flag1<span class="token punctuation">,</span>
	input Key_state2<span class="token punctuation">,</span>
	input Key_flag2<span class="token punctuation">,</span>
	output reg <span class="token punctuation">[</span><span class="token number">31</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span> dis_data
<span class="token punctuation">)</span><span class="token punctuation">;</span>

	always@<span class="token punctuation">(</span>posedge Clk or negedge Rst_n<span class="token punctuation">)</span>begin
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>Rst_n<span class="token punctuation">)</span>
			dis_data <span class="token operator">&lt;=</span> <span class="token number">32</span>'h00000000<span class="token punctuation">;</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>Key_flag1 <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>Key_state1<span class="token punctuation">)</span>
			dis_data <span class="token operator">&lt;=</span> <span class="token number">32</span>'h12345678<span class="token punctuation">;</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>Key_flag2 <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>Key_state2<span class="token punctuation">)</span>
			dis_data <span class="token operator">&lt;=</span> <span class="token number">32</span>'h89abcdef<span class="token punctuation">;</span>
		<span class="token keyword">else</span> 
			dis_data <span class="token operator">&lt;=</span> dis_data<span class="token punctuation">;</span>
	end

endmodule

</code></pre> 
<blockquote> 
 <p>顶层模块KeyCtrlSmg.v：</p> 
</blockquote> 
<pre><code class="prism language-c">module <span class="token function">KeyCtrlSmg</span><span class="token punctuation">(</span>
	input 	Clk<span class="token punctuation">,</span>
	input 	Rst_n<span class="token punctuation">,</span>
	input 	KeyIn1<span class="token punctuation">,</span>
	input 	KeyIn2<span class="token punctuation">,</span>
	output 	SH_CP<span class="token punctuation">,</span>		<span class="token comment">//shift clock</span>
	output 	ST_CP<span class="token punctuation">,</span>		<span class="token comment">//latch data clock</span>
	output 	DS			<span class="token comment">//shift serial data</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

	wire key_state1<span class="token punctuation">;</span>
	wire key_flag1<span class="token punctuation">;</span>
	wire key_state2<span class="token punctuation">;</span>
	wire key_flag2<span class="token punctuation">;</span>
	
	wire <span class="token punctuation">[</span><span class="token number">7</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span> sel<span class="token punctuation">;</span><span class="token comment">//数码管位选（选择当前要显示的数码管）</span>
	wire <span class="token punctuation">[</span><span class="token number">7</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span> seg<span class="token punctuation">;</span><span class="token comment">//数码管段选（当前要显示的内容）	</span>

	wire  <span class="token punctuation">[</span><span class="token number">31</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span> dis_data<span class="token punctuation">;</span>
	
	KeyFilter <span class="token function">KeyFilter1</span><span class="token punctuation">(</span>
		<span class="token punctuation">.</span><span class="token function">Clk</span><span class="token punctuation">(</span>Clk<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">.</span><span class="token function">Rst_n</span><span class="token punctuation">(</span>Rst_n<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">.</span><span class="token function">key_in</span><span class="token punctuation">(</span>KeyIn1<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">.</span><span class="token function">key_flag</span><span class="token punctuation">(</span>key_flag1<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">.</span><span class="token function">key_state</span><span class="token punctuation">(</span>key_state1<span class="token punctuation">)</span>
	<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	KeyFilter <span class="token function">KeyFilter2</span><span class="token punctuation">(</span>
		<span class="token punctuation">.</span><span class="token function">Clk</span><span class="token punctuation">(</span>Clk<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">.</span><span class="token function">Rst_n</span><span class="token punctuation">(</span>Rst_n<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">.</span><span class="token function">key_in</span><span class="token punctuation">(</span>KeyIn2<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">.</span><span class="token function">key_flag</span><span class="token punctuation">(</span>key_flag2<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">.</span><span class="token function">key_state</span><span class="token punctuation">(</span>key_state2<span class="token punctuation">)</span>
	<span class="token punctuation">)</span><span class="token punctuation">;</span>

	KeyData <span class="token function">UKeyData</span><span class="token punctuation">(</span>
		<span class="token punctuation">.</span><span class="token function">Clk</span><span class="token punctuation">(</span>Clk<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">.</span><span class="token function">Rst_n</span><span class="token punctuation">(</span>Rst_n<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">.</span><span class="token function">Key_state1</span><span class="token punctuation">(</span>key_state1<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">.</span><span class="token function">Key_flag1</span><span class="token punctuation">(</span>key_flag1<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">.</span><span class="token function">Key_state2</span><span class="token punctuation">(</span>key_state2<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">.</span><span class="token function">Key_flag2</span><span class="token punctuation">(</span>key_flag2<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">.</span><span class="token function">dis_data</span><span class="token punctuation">(</span>dis_data<span class="token punctuation">)</span>
	<span class="token punctuation">)</span><span class="token punctuation">;</span>

	HEX8 <span class="token function">UHEX8</span><span class="token punctuation">(</span>
		<span class="token punctuation">.</span><span class="token function">Clk</span><span class="token punctuation">(</span>Clk<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">.</span><span class="token function">Rst_n</span><span class="token punctuation">(</span>Rst_n<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">.</span><span class="token function">En</span><span class="token punctuation">(</span><span class="token number">1</span>'b1<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">.</span><span class="token function">disp_data</span><span class="token punctuation">(</span>dis_data<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">.</span><span class="token function">sel</span><span class="token punctuation">(</span>sel<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">.</span><span class="token function">seg</span><span class="token punctuation">(</span>seg<span class="token punctuation">)</span>
	<span class="token punctuation">)</span><span class="token punctuation">;</span>
		
	m74HC595_Driver <span class="token function">Um74HC595_Driver</span><span class="token punctuation">(</span>
		<span class="token punctuation">.</span><span class="token function">Clk</span><span class="token punctuation">(</span>Clk<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">.</span><span class="token function">Rst_n</span><span class="token punctuation">(</span>Rst_n<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">.</span><span class="token function">Data</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>seg<span class="token punctuation">,</span>sel<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">.</span><span class="token function">S_EN</span><span class="token punctuation">(</span><span class="token number">1</span>'b1<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">.</span><span class="token function">SH_CP</span><span class="token punctuation">(</span>SH_CP<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">.</span><span class="token function">ST_CP</span><span class="token punctuation">(</span>ST_CP<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">.</span><span class="token function">DS</span><span class="token punctuation">(</span>DS<span class="token punctuation">)</span>
	<span class="token punctuation">)</span><span class="token punctuation">;</span>

endmodule

</code></pre> 
<blockquote> 
 <p>测试激励文件：</p> 
</blockquote> 
<pre><code class="prism language-c">`timescale <span class="token number">1</span>ns<span class="token operator">/</span><span class="token number">1</span>ns
`define clock_period <span class="token number">20</span>

module KeyCtrlSmg_tb<span class="token punctuation">;</span>

	reg Clk<span class="token punctuation">;</span>
	reg Rst_n<span class="token punctuation">;</span>
	reg KeyIn1<span class="token punctuation">;</span>
	reg KeyIn2<span class="token punctuation">;</span>
	
	wire SH_CP<span class="token punctuation">;</span>
	wire ST_CP<span class="token punctuation">;</span>
	wire DS<span class="token punctuation">;</span>

	KeyCtrlSmg <span class="token function">UKeyCtrlSmg</span><span class="token punctuation">(</span>
		<span class="token punctuation">.</span><span class="token function">Clk</span><span class="token punctuation">(</span>Clk<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">.</span><span class="token function">Rst_n</span><span class="token punctuation">(</span>Rst_n<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">.</span><span class="token function">KeyIn1</span><span class="token punctuation">(</span>KeyIn1<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">.</span><span class="token function">KeyIn2</span><span class="token punctuation">(</span>KeyIn2<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">.</span><span class="token function">SH_CP</span><span class="token punctuation">(</span>SH_CP<span class="token punctuation">)</span><span class="token punctuation">,</span>		<span class="token comment">//shift clock</span>
		<span class="token punctuation">.</span><span class="token function">ST_CP</span><span class="token punctuation">(</span>ST_CP<span class="token punctuation">)</span><span class="token punctuation">,</span>		<span class="token comment">//latch data clock</span>
		<span class="token punctuation">.</span><span class="token function">DS</span><span class="token punctuation">(</span>DS<span class="token punctuation">)</span>				<span class="token comment">//shift serial data</span>
	<span class="token punctuation">)</span><span class="token punctuation">;</span>

	initial Clk <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	always#<span class="token punctuation">(</span>`clock_period <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> Clk <span class="token operator">=</span> <span class="token operator">~</span>Clk<span class="token punctuation">;</span>
	
	initial begin 
		Rst_n <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		KeyIn1 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		KeyIn2 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		#<span class="token number">200</span><span class="token punctuation">;</span>
		Rst_n <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		#<span class="token number">200</span><span class="token punctuation">;</span>
		KeyIn1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		KeyIn2 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		#<span class="token punctuation">(</span>`clock_period<span class="token operator">*</span><span class="token number">10000</span><span class="token punctuation">)</span>
		KeyIn1 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		KeyIn2 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		#<span class="token punctuation">(</span>`clock_period<span class="token operator">*</span><span class="token number">10000</span><span class="token punctuation">)</span>
		KeyIn1 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		KeyIn2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		#<span class="token punctuation">(</span>`clock_period<span class="token operator">*</span><span class="token number">10000</span><span class="token punctuation">)</span>
		$stop<span class="token punctuation">;</span>
	end


endmodule

</code></pre> 
<blockquote> 
 <p>仿真结果：</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/7a/65/Ul35hcgn_o.png" alt="仿真结果"></p> 
<p><img src="https://images2.imgbox.com/a6/99/Ti8AFQPQ_o.gif" alt="csdn"></p> 
<blockquote> 
 <p><font size="5" face="微软雅黑">🧸结尾</font></p> 
 <hr color="#000000" size='5"'> 
 <ul><li><font size="2" face="微软雅黑">❤️ <strong>感谢您的支持和鼓励！</strong> 😊🙏</font></li><li><font size="2" face="微软雅黑"> 📜<strong>您可能感兴趣的内容：</strong></font></li><li><font size="2" face="微软雅黑"><a href="https://blog.csdn.net/m0_56262476/article/details/131711615?spm=1001.2014.3001.5502">【FPGA】串口通信讲解-状态机判断数据值</a></font></li><li><font size="2" face="微软雅黑"><a href="https://blog.csdn.net/m0_56262476/article/details/131711699?spm=1001.2014.3001.5502">【Python】串口通信-与FPGA、蓝牙模块实现串口通信（Python+FPGA）</a></font></li><li><font size="2" face="微软雅黑"> <a href="https://blog.csdn.net/m0_56262476/article/details/128679309">【Arduino TinyGo】【最新】使用Go语言编写Arduino-环境搭建和点亮LED灯</a></font></li><li><font size="2" face="微软雅黑"><a href="https://blog.csdn.net/m0_56262476/article/details/130464276?spm=1001.2014.3001.5502">【全网首发开源教程】【Labview机器人仿真与控制】Labview与Solidworks多路支配关系-四足爬行机器人仿真与控制</a></font><br> <img src="https://images2.imgbox.com/1a/97/PdlYJtgn_o.png" alt="遇见未来" width="90%"></li></ul> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0eb5c04a8368b9ffad2f2084e4e9f933/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">矩阵论—线性子空间、生成子空间、核空间、零度、子空间的交与和、直和</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d5c29d09ca3c407c44a6f41aeaacd165/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">安装Burp suitev过程中出现错误--illegal-access=permit</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>