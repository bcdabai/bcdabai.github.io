<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ART-Pi程序下载 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="ART-Pi程序下载" />
<meta property="og:description" content="ART-Pi
原文地址
开发环境：
RT-Thread版本：4.0.3
操作系统：Windows10
Keil版本：V5.30
开发板MCU：STM32H750XB
3.1引言 在开始本章之前，笔者先批评下自己，拿到板子后也没看官方的手册，直接凭着经验一通玩，结果导致板子的 boot_loader 被擦除了，出厂固件也烧写不了，使用Keil&#43;STlink还会出现以下错误：
使用STM32CubeProgrammer也烧写不了，出现以下错误：
有问题咱就去找原因，想办法解决啊。这就是BootLoader错误或者工作不正常，另外就是未加载下载算法，导致应用程序固件不能刷入到W25Q64JV 存储器中导致的。因此第一步重新刷入BootLoader，第二步加载下载算法。
官方的回答以及解决办法：
未添加下载算法导致，下载算法在 &#34;sdk-bsp-stm32h750-realthread-artpi\debug\flm\ART-Pi_W25Q64.FLM&#34;然后把ART-Pi_W25Q64.FLM拷贝到MDK安装目录Keil_v5\ARM\Flash下，注意RAM for Algorithm 需要调整成 0x4000。STM32H750 执行片外 QSPI FLASH 上的程序需要有一个 bootloader 来跳转过去，出厂前已经默认烧录了 bootloader，所以可以运行，如果不小心擦除了，请重新烧录 bootloader。
3.2编译和烧写Bootloader 在 BSP 目录下打开 Env，首先进入工程目录，sdk-bsp-stm32h750-realthread-artpi \projects\art_pi_bootloader，如图所示以管理员身份打开 PowerShell：
依次输入如下三个命令：
#cmd #mklink /D rt-thread ..\..\rt-thread #mklink /D libraries ..\..\libraries 123 使用 RT-Thread 官方提供的 env 工具按照 rt-thread 开发的正常流程创建 MDK 工程。输入 scons --target=mdk5 命令生成 MDK 工程。
然后打开MDK编译即可，ART-Pi带有烧写工具ST-link，因此可直接下载，但在下载前，注意下Debug的配置，
如果烧写不进去，有可能已经存在 bootloader，勾选 Dowload Function 中的 Erase Full Chip 选项先擦除重新烧写 bootloader，不过默认配置就是上图所示的配置。值得注意的是，Bootloader是烧写到片上Flash中，ART-Pi还另外配有外部存储，毕竟要跑操作系统，内部的Flash还是不够用的。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/60c63408df1a1bfb12bc096450a4a389/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-08-15T15:32:19+08:00" />
<meta property="article:modified_time" content="2023-08-15T15:32:19+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ART-Pi程序下载</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night-eighties">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>ART-Pi<br> <a href="https://blog.bruceou.cn/2020/12/3-art-pi-firmware-download-and-use/350/" rel="nofollow">原文地址</a></p> 
<p><strong>开发环境：</strong><br> RT-Thread版本：4.0.3<br> 操作系统：Windows10<br> Keil版本：V5.30<br> 开发板MCU：STM32H750XB</p> 
<h3><a id="31_9"></a>3.1引言</h3> 
<p>在开始本章之前，笔者先批评下自己，拿到板子后也没看官方的手册，直接凭着经验一通玩，结果导致板子的 boot_loader 被擦除了，出厂固件也烧写不了，使用Keil+STlink还会出现以下错误：</p> 
<p><img src="https://images2.imgbox.com/d4/ab/ueNeL4vb_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/23/a7/DZ9hjDtq_o.png" alt="在这里插入图片描述"></p> 
<p>使用STM32CubeProgrammer也烧写不了，出现以下错误：<br> <img src="https://images2.imgbox.com/57/d0/rPriqsYd_o.png" alt="在这里插入图片描述"></p> 
<p>有问题咱就去找原因，想办法解决啊。这就是BootLoader错误或者工作不正常，另外就是未加载下载算法，导致应用程序固件不能刷入到W25Q64JV 存储器中导致的。<strong>因此第一步重新刷入BootLoader，第二步加载下载算法。</strong></p> 
<p><strong>官方的回答以及解决办法：</strong><br> 未添加下载算法导致，下载算法在 <code>"sdk-bsp-stm32h750-realthread-artpi\debug\flm\ART-Pi_W25Q64.FLM"</code>然后把<code>ART-Pi_W25Q64.FLM</code>拷贝到MDK安装目录<code>Keil_v5\ARM\Flash</code>下，注意<code>RAM for Algorithm</code> 需要调整成 <code>0x4000</code>。STM32H750 执行片外 QSPI FLASH 上的程序需要有一个 bootloader 来跳转过去，出厂前已经默认烧录了 bootloader，所以可以运行，如果不小心擦除了，请重新烧录 bootloader。</p> 
<h3><a id="32Bootloader_24"></a>3.2编译和烧写Bootloader</h3> 
<p>在 BSP 目录下打开 Env，首先进入工程目录，sdk-bsp-stm32h750-realthread-artpi \projects\art_pi_bootloader，如图所示以管理员身份打开 PowerShell：<br> <img src="https://images2.imgbox.com/01/a9/8xsLMVpk_o.png" alt="在这里插入图片描述"></p> 
<p>依次输入如下三个命令：</p> 
<pre class="prettyprint"><code class="has-numbering">#cmd
#mklink /D rt-thread ..\..\rt-thread
#mklink /D libraries ..\..\libraries
</code>
 
 <div class="hljs-button {2}"></div>
 
 </pre><ul class="pre-numbering"><li>1</li><li>2</li><li>3</li></ul> 
<p><img src="https://images2.imgbox.com/a1/31/oiWcMSbj_o.png" alt="在这里插入图片描述"></p> 
<p>使用 RT-Thread 官方提供的 env 工具按照 rt-thread 开发的正常流程创建 MDK 工程。输入 <code>scons --target=mdk5</code> 命令生成 MDK 工程。</p> 
<p><img src="https://images2.imgbox.com/cf/2b/W5ksx46o_o.png" alt="在这里插入图片描述"></p> 
<p>然后打开MDK编译即可，ART-Pi带有烧写工具ST-link，因此可直接下载，但在下载前，注意下Debug的配置，</p> 
<p><img src="https://images2.imgbox.com/12/e8/vz0huhKD_o.png" alt="在这里插入图片描述"></p> 
<p>如果烧写不进去，有可能已经存在 bootloader，勾选 Dowload Function 中的 Erase Full Chip 选项先擦除重新烧写 bootloader，不过默认配置就是上图所示的配置。值得注意的是，Bootloader是烧写到片上Flash中，ART-Pi还另外配有外部存储，毕竟要跑操作系统，内部的Flash还是不够用的。</p> 
<p><font color="#DD0000">【注1】MDK5需要安装 pack 支持包，可以去 keil 官网下载 Keil.STM32H7xx_DFP.2.7.0.pack 并安装，因为我们的板子处理器是 STM32H7 系列。<br> 【注2】如果你没装MDK5，也可直接通过ENV编译工具进行编译，反正笔者很喜欢，很多命令都是和Linux相通的。编译完成后可使用STM32CubeProgrammer烧写。<br> </font></p> 
<p><img src="https://images2.imgbox.com/ce/2d/U1X1SmUD_o.png" alt="在这里插入图片描述"></p> 
<p>编译成功后我们直接使用MDK烧写就行了，也可用STM32CubeProgrammer烧写。</p> 
<h3><a id="33_55"></a>3.3应用下载与使用</h3> 
<p>接下来我们就要下载应用， ART-Pi的应用程序是存放在外部Flash W25Q64中的。首先我们就需要安装下载算法， QSPI-FLASH烧录算法文件在 sdk-bsp-stm32h750-realthread-artpi\debug\flm 目录下，名字是 ART-Pi_W25Q64.FLM。<br> <img src="https://images2.imgbox.com/16/9b/5ncOztR7_o.png" alt="在这里插入图片描述"></p> 
<p>将ART-Pi_W25Q64.FLM文件复制到 Keil 的安装目录，例如我的是 D:\Keil\ARM\Flash。</p> 
<p>接下来我们用同样的方式使用 ENV 将点灯示例 art_pi_blink_led 生成 MDK5 工程。<br> <img src="https://images2.imgbox.com/98/00/REAv5bNA_o.png" alt="在这里插入图片描述"></p> 
<p>然后去配置 Flash Download:<br> <img src="https://images2.imgbox.com/8e/61/UD01dicY_o.png" alt="在这里插入图片描述"></p> 
<p>需要注意的是 Address Range 的配置一定要从 90000000H 开始到 907FFFFFH。RAM for Algorithm需要调整成 0x4000，这都是默认配置好的，如果没有就需要手动修改。</p> 
<p>最后点击下载固件即可下载应用到板子的外部Flash中。<br> <img src="https://images2.imgbox.com/1a/d4/BosqPR6x_o.png" alt="在这里插入图片描述"></p> 
<p>下载完成后，就可看到D2不断闪烁。</p> 
<h3><a id="34_ARTPi_BT_WiFi__75"></a>3.4 ART-Pi BT_WiFi 模块固件下载</h3> 
<p>ART-Pi 板卡在出厂时已经烧录过 BT_WiFi 固件，存储在外部 Flash W25Q128 。如果固件被不慎擦除，会导致 BT_WiFi 模组的功能无法正常使用，出现异常情况，需要重新烧录 BT_WiFi 固件。RT-Thread 提供的解决方式：先烧录出厂例程固件 <code>factory</code>，然后选择使用 Ymodem 下载固件。</p> 
<p>关于出厂例程的的烧写在上一讲已经说过了，下面我们烧写BT_WiFi 模块固件。</p> 
<p>WiFi和蓝牙固件的下载方式相同，可以通过终端进行 ymodem 传输。固件路径位于 <code>/tools/firmware/</code> 目录下。其中 <code>ap6212-bt-image-1.0.rbl</code> 为蓝牙固件，<code>ap6212-wifi-image-1.0.rbl</code> 为 WIFI 固件。<br> <img src="https://images2.imgbox.com/a9/e1/xs3MqRPp_o.png" alt="在这里插入图片描述"></p> 
<p>以 BT 固件上传为例，需要执行两个步骤：</p> 
<blockquote> 
 <ol><li>在终端命令行中输入 <code>update</code> 命令。</li><li>使用 ymodem 进行文件传输。</li></ol> 
</blockquote> 
<p><img src="https://images2.imgbox.com/72/7f/jBNQxu6A_o.gif" alt="在这里插入图片描述"></p> 
<p>完成后系统会自动识别传入的固件，若固件有效则会自动搬运到对应的固件存储区。</p> 
<p><strong>【注】ART-Pi配备了2块外部Flash，W25Q64JV 用于存放程序，W25Q128JV 用于存放 WIFI 固件，蓝牙固件，等其它数据。</strong></p> 
<h3><a id="35_ARTPi__93"></a>3.5 ART-Pi 网页下载</h3> 
<p>网页文件存在于 <code>/projects/art_pi_factory/applications/web_dist</code> 目录下。不同于 WIFI 及蓝牙固件的上传，网页文件需要联网后通过 adb工具进行上传, 需要将 <code>webnet</code> 目录上传到开发板的 <code>/flash / 目录下</code>。</p> 
<h4><a id="351_ADB_96"></a>3.5.1 ADB工具安装</h4> 
<p>【注】ADB工具获取方式见文末。</p> 
<p>下载ADB工具，放在一个磁盘目录，笔者放在C盘根目录。<br> <img src="https://images2.imgbox.com/41/c7/C9dtvZWf_o.png" alt="在这里插入图片描述"></p> 
<p>然后配置环境。<br> <img src="https://images2.imgbox.com/d1/95/CWoDrF7h_o.png" alt="在这里插入图片描述"></p> 
<p>然后输入adb，有以下信息表示安装成功。</p> 
<p><img src="https://images2.imgbox.com/fb/6a/YBCB8NpJ_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="352_111"></a>3.5.2网页下载</h4> 
<p>如图所示以管理员身份打开cmd，切换到projects/art_pi_factory/applications/web_dist` 目录下：<br> 输入以下命令：</p> 
<pre class="prettyprint"><code class="has-numbering">#adb connect 192.168.99.144
#adb push .\webnet /flash/
#adb disconnect
</code>
 
 <div class="hljs-button {2}"></div>
 
 </pre><ul class="pre-numbering"><li>1</li><li>2</li><li>3</li></ul> 
<p><img src="https://images2.imgbox.com/6d/b2/fHvbpskH_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>【注1】WIFI地址需要根据你的板子IP来设置。<br> 【注2】也可使用PowerShell，这也是Windows自带的工具。</p> 
</blockquote> 
<hr> 
<h4><a id="_129"> </a></h4>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c1ae9f097462302ebac1a013f3561d4d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">基于Docker配置Mysql主从同步</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6560d80c2e4733b8c2a86c4c72660c31/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">2023牛客暑期多校训练营9 B.Semi-Puzzle: Brain Storm</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>