<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>samba的使用 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="samba的使用" />
<meta property="og:description" content="一、samba的介绍 ​ Samba是一个开放源代码软件套件，用于在Linux和UNIX操作系统上实现文件和打印机共享。它可以与Windows操作系统无缝地协作，并支持各种不同的协议和功能，如SMB/CIFS、NetBIOS名称服务、Active Directory域控制器等。
​ 使用Samba，您可以将Linux或UNIX计算机配置为文件服务器，以便Windows客户端可以访问共享文件和目录。您还可以将Samba配置为打印服务器，以便Windows客户端可以连接到打印机并打印文档。
​ Samba也支持其他协议，如FTP和HTTP，以及一些高级功能，如用户身份验证、访问控制、加密和数据压缩等。
​ Samba软件包通常由几个组件组成，例如smbd、nmbd、winbindd等，每个组件都提供不同的功能和服务。 smbd是一个守护进程（daemon），用于提供文件和打印机共享。nmbd是另一个守护进程，用于实现NetBIOS名称服务。winbindd是用于集成Samba服务器和Windows域控制器的组件。
二、实验简介 使用两台虚拟机，server（IP：192.168.189.133）和client1（IP：192.168.189.128），在server上配置samba服务，使用samba共享文件。使用客户机client1来挂载使用server上的共享文件夹
三、实验过程 1、装包，server和client都执行一下操作 ​ samba-client是一个Samba软件包中的软件，它包含用于在Linux和UNIX操作系统上访问远程Samba共享的命令行工具。使用samba-client，您可以在本地计算机上列出、挂载和卸载远程Samba共享。
yum -y install samba #安装samba，服务端工具 yum -y install cifs-utils #提供格式支持 yum -y install samba-client #samba的客户端工具 2、编辑配置文件 查看配置文件
[globe]、[homes]等称为节。
[global]节
1、[g1oba1]节定义 Samba 服务器的基本配置·在此节中应配置三项内容
workgroup 用于指定服务器的 Windows 工作组·大部分 Windows 系统都默认为 WORKGROUP但 Windows XP Home 默认为 SHOME·这用于帮助系统浏览对 TCP/IP 名称服务使用 NetBIOS的服务器。
要将工作组设置为 WORKGROUP，请将 /etc/samba/smb.conf 中的现有工作组条目更改为:
workgroup= WORKGROUP
2、security 控制 Samba 对客户端进行身份验证的方式·对于 security = user，客户端使用本地 Samba 服务器管理的有效用户名和密码来登录·此设置是 /etc/samba/smb." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/6f5eb1e5d86bbc730bf0941b55b3a69e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-08-14T17:46:53+08:00" />
<meta property="article:modified_time" content="2023-08-14T17:46:53+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">samba的使用</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="samba_0"></a>一、samba的介绍</h3> 
<p>​ Samba是一个开放源代码软件套件，用于在Linux和UNIX操作系统上实现文件和打印机共享。它可以与Windows操作系统无缝地协作，并支持各种不同的协议和功能，如SMB/CIFS、NetBIOS名称服务、Active Directory域控制器等。</p> 
<p>​ 使用Samba，您可以将Linux或UNIX计算机配置为文件服务器，以便Windows客户端可以访问共享文件和目录。您还可以将Samba配置为打印服务器，以便Windows客户端可以连接到打印机并打印文档。</p> 
<p>​ Samba也支持其他协议，如FTP和HTTP，以及一些高级功能，如用户身份验证、访问控制、加密和数据压缩等。</p> 
<p>​ Samba软件包通常由几个组件组成，例如<code>smbd</code>、<code>nmbd</code>、<code>winbindd</code>等，每个组件都提供不同的功能和服务。 <code>smbd</code>是一个守护进程（daemon），用于提供文件和打印机共享。<code>nmbd</code>是另一个守护进程，用于实现NetBIOS名称服务。<code>winbindd</code>是用于集成Samba服务器和Windows域控制器的组件。</p> 
<h3><a id="_10"></a>二、实验简介</h3> 
<p>使用两台虚拟机，server（IP：192.168.189.133）和client1（IP：192.168.189.128），在server上配置samba服务，使用samba共享文件。使用客户机client1来挂载使用server上的共享文件夹</p> 
<h3><a id="_14"></a>三、实验过程</h3> 
<h4><a id="1serverclient_16"></a>1、装包，server和client都执行一下操作</h4> 
<p>​ <code>samba-client</code>是一个Samba软件包中的软件，它包含用于在Linux和UNIX操作系统上访问远程Samba共享的命令行工具。使用<code>samba-client</code>，您可以在本地计算机上列出、挂载和卸载远程Samba共享。</p> 
<pre><code class="prism language-shell"> yum <span class="token parameter variable">-y</span> <span class="token function">install</span> samba   <span class="token comment">#安装samba，服务端工具</span>
 yum <span class="token parameter variable">-y</span> <span class="token function">install</span> cifs-utils    <span class="token comment">#提供格式支持</span>
 yum <span class="token parameter variable">-y</span> <span class="token function">install</span> samba-client   <span class="token comment">#samba的客户端工具</span>
</code></pre> 
<h4><a id="2_26"></a>2、编辑配置文件</h4> 
<p>查看配置文件</p> 
<p><code>[globe]、[homes]</code>等称为节。</p> 
<p>[global]节<br> 1、[g1oba1]节定义 Samba 服务器的基本配置·在此节中应配置三项内容<br> workgroup 用于指定服务器的 Windows 工作组·大部分 Windows 系统都默认为 WORKGROUP但 Windows XP Home 默认为 SHOME·这用于帮助系统浏览对 TCP/IP 名称服务使用 NetBIOS的服务器。<br> 要将工作组设置为 WORKGROUP，请将 /etc/samba/smb.conf 中的现有工作组条目更改为:<br> workgroup= WORKGROUP<br> 2、security 控制 Samba 对客户端进行身份验证的方式·对于 security = user，客户端使用本地 Samba 服务器管理的有效用户名和密码来登录·此设置是 /etc/samba/smb.conf 中的默认设置。<br> 3、hosts a11ow 是允许访问 Samba 服务的主机的列表(以号、空格或制表符分隔)·如果未指定，则所有主机均可访问 Samba·如果 [global] 节中未指定此设置，则可以单独在每个共享中设置·如果在 [g1oba1] 节中指定，将适用于所有共享，无论每个共享是否具有不同的设置。<br> 可以通过主机名或源 IP 地址来指定主机·通过逆向解析传入连接尝试的 IP 地址来检查主机名·hosts_access(5) man page 中描逃了此指令的完整语法。<br> 可以通过多种方法来指定允许的主机:<br> ·IPv4 网络/前缀:172.25.0.0/24<br> ·IPv4 网络/网络掩码:172.25.0.0/255.255.255.0<br> ·如果 IPv4 子网前缀处于字节边界:172.25.0.<br> ·IPv6 网络/前缀:[2001:db8:0:1::/64]<br> ·主机名: desktop.example.com<br> ·以 example.com 结尾的所有主机: .example.com<br> 例如，要使用尾点表示法将访问权限限制为 172.25.0.0/16 网络中的主机，/etc/samba/smb.conf 配置文件中的 hosts allow 条目将为:<br> hosts allow = 172.25.<br> 要额外允许从主机名以“.example.com”结尾的所有主机中进行访问，/etc/samba/smb.conf配置文件条目应为:<br> hosts allow172.25. .ex4mple.com</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># ls /etc/samba/</span>
lmhosts  smb.conf（配置文件）  smb.conf.example
<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/samba/smb.conf | grep -v ^$ | grep -v ^#</span>
<span class="token punctuation">[</span>global<span class="token punctuation">]</span>     <span class="token comment">#此节为常规配置</span>
	workgroup <span class="token operator">=</span> SAMBA
	security <span class="token operator">=</span> user
	passdb backend <span class="token operator">=</span> tdbsam
	printing <span class="token operator">=</span> cups
	<span class="token function">printcap</span> name <span class="token operator">=</span> cups
	load printers <span class="token operator">=</span> <span class="token function">yes</span>
	cups options <span class="token operator">=</span> raw
	<span class="token comment"># Install samba-usershares package for support</span>
	include <span class="token operator">=</span> /etc/samba/usershares.conf
<span class="token punctuation">[</span>homes<span class="token punctuation">]</span>    <span class="token comment">#此节为共享用户家目录的设置</span>
	comment <span class="token operator">=</span> Home Directories
	valid <span class="token function">users</span> <span class="token operator">=</span> %S, %D%w%S
	browseable <span class="token operator">=</span> No
	<span class="token builtin class-name">read</span> only <span class="token operator">=</span> No
	inherit acls <span class="token operator">=</span> Yes
<span class="token punctuation">[</span>printers<span class="token punctuation">]</span>      <span class="token comment">#从此节往下是打印机配置文件</span>
	comment <span class="token operator">=</span> All Printers
	path <span class="token operator">=</span> /var/tmp
	printable <span class="token operator">=</span> Yes
	create mask <span class="token operator">=</span> 0600
	browseable <span class="token operator">=</span> No
<span class="token punctuation">[</span>print$<span class="token punctuation">]</span>
	comment <span class="token operator">=</span> Printer Drivers
	path <span class="token operator">=</span> /var/lib/samba/drivers
	<span class="token function">write</span> list <span class="token operator">=</span> @printadmin root
	force group <span class="token operator">=</span> @printadmin
	create mask <span class="token operator">=</span> 0664
	directory mask <span class="token operator">=</span> 0775
</code></pre> 
<p>编辑配置文件，留下有用的。</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/samba/smb.conf | grep -v ^$ | grep -v ^#</span>
<span class="token punctuation">[</span>global<span class="token punctuation">]</span>
	workgroup <span class="token operator">=</span> SAMBA
	security <span class="token operator">=</span> user
	passdb backend <span class="token operator">=</span> tdbsam
	<span class="token comment"># Install samba-usershares package for support</span>
	include <span class="token operator">=</span> /etc/samba/usershares.conf <span class="token comment">#此配置文件需装samba-usershares包才有</span>
<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre> 
<p>创建共享目录</p> 
<pre><code class="prism language-shell">创建共享目录：
<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># mkdir /sharedir</span>
<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># ll /sharedir -d</span>
drwxr-xr-x. <span class="token number">2</span> root root <span class="token number">6</span> May <span class="token number">11</span> <span class="token number">10</span>:07 /sharedir
<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre> 
<p>编辑配置文件<code>/etc/samba/smb.conf</code>，添加文件共享节，配置内容如下</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>myshare<span class="token punctuation">]</span>   <span class="token comment">#共享名</span>
      comment <span class="token operator">=</span> used <span class="token keyword">for</span> share <span class="token builtin class-name">test</span>   <span class="token comment">#描述信息</span>
      path <span class="token operator">=</span> /sharedir   <span class="token comment">#共享的目录</span>
      writable <span class="token operator">=</span> <span class="token function">yes</span>     <span class="token comment">#可写</span>
      browseable <span class="token operator">=</span> <span class="token function">yes</span>    <span class="token comment">#允许浏览器访问</span>
      valid <span class="token function">users</span> <span class="token operator">=</span> fred,test   <span class="token comment">#在列表中列出的用户才能够访问该共享</span>
      <span class="token function">write</span> list <span class="token operator">=</span> fred    <span class="token comment">#列出的用户可以创建、修改或删除共享中的文件和目录</span>
</code></pre> 
<p>检查配置语法</p> 
<pre><code class="prism language-shell">检查配置语法：
<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># testparm </span>
Load smb config files from /etc/samba/smb.conf
Loaded services <span class="token function">file</span> OK.
Weak crypto is allowed by GnuTLS <span class="token punctuation">(</span>e.g. NTLM as a compatibility fallback<span class="token punctuation">)</span>

Server role: ROLE_STANDALONE

Press enter to see a dump of your <span class="token function">service</span> definitions   <span class="token comment">#按enter键</span>

<span class="token comment"># Global parameters</span>
<span class="token punctuation">[</span>global<span class="token punctuation">]</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>输出省略
</code></pre> 
<h4><a id="3samba_144"></a>3、准备samba用户</h4> 
<p>创建用户，禁用登录</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># useradd -s /sbin/nologin fred</span>
<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># useradd -s /sbin/nologin test</span>
</code></pre> 
<p>将fred、test添加到samba用户</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># smbpasswd -a fred</span>
New SMB password:（123456）
Retype new SMB password:  <span class="token comment">#为fred设置密码</span>
Added user fred   <span class="token comment">#确认密码</span>
<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># smbpasswd -a test</span>
New SMB password:
Retype new SMB password:
Added user test.
</code></pre> 
<p>使用pdbedit查看管理samba用户：</p> 
<p>以下是一些常见的<code>pdbedit</code>命令：</p> 
<ul><li><code>pdbedit -a username</code>：用于添加新的Samba用户。在执行该命令时，您需要输入密码，然后确认密码。</li><li><code>pdbedit -x username</code>：用于删除现有的Samba用户。</li><li><code>pdbedit -u username</code>：用于更新现有的Samba用户。在执行该命令时，您可以更改用户的密码、描述信息等内容。</li><li><code>pdbedit -L</code>：用于列出所有当前配置的Samba用户的用户名和UID号码。</li><li><code>pdbedit -G groupname</code>：用于列出属于指定组的所有Samba用户。</li><li><code>pdbedit -a -u username -g groupname</code>：用于将现有的Samba用户添加到指定组中。</li></ul> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># pdbedit -L</span>
fred:1001:
<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># id fred</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">1001</span><span class="token punctuation">(</span>fred<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">1001</span><span class="token punctuation">(</span>fred<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">1001</span><span class="token punctuation">(</span>fred<span class="token punctuation">)</span>
<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment">#</span>

</code></pre> 
<h4><a id="4Samba_186"></a>4、启动Samba</h4> 
<p>启动并设置开机自启</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># systemctl start smb nmb</span>
<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># systemctl enable smb nmb</span>
</code></pre> 
<p>防火墙放行服务</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># firewall-cmd --add-service=samba</span>
success
<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># firewall-cmd --add-service=samba --permanent </span>
<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># setenforce 0</span>
</code></pre> 
<h4><a id="5_204"></a>5、客户端挂载</h4> 
<p>selinux设置为宽容模式</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@client ~<span class="token punctuation">]</span><span class="token comment"># setenforce 0</span>
</code></pre> 
<p>匿名登陆</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@client ~<span class="token punctuation">]</span><span class="token comment"># smbclient -L 192.168.99.142</span>
Password <span class="token keyword">for</span> <span class="token punctuation">[</span>SAMBA<span class="token punctuation">\</span>root<span class="token punctuation">]</span>:
Anonymous login successful

	Sharename       Type      Comment
	---------       ----      -------
	myshare         Disk      used <span class="token keyword">for</span> share <span class="token builtin class-name">test</span>
	IPC$            IPC       IPC Service <span class="token punctuation">(</span>Samba <span class="token number">4.17</span>.5<span class="token punctuation">)</span>
SMB1 disabled -- no workgroup available
</code></pre> 
<p>使用samba用户、密码查看：</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@client ~<span class="token punctuation">]</span><span class="token comment"># smbclient -L 192.168.99.142 -U fred</span>
Password <span class="token keyword">for</span> <span class="token punctuation">[</span>SAMBA<span class="token punctuation">\</span>fred<span class="token punctuation">]</span>:   <span class="token comment">#输入fred设置的密码</span>

	Sharename       Type      Comment
	---------       ----      -------
	myshare         Disk      used <span class="token keyword">for</span> share <span class="token builtin class-name">test</span>
	IPC$            IPC       IPC Service <span class="token punctuation">(</span>Samba <span class="token number">4.17</span>.5<span class="token punctuation">)</span>
SMB1 disabled -- no workgroup available
<span class="token punctuation">[</span>root@client ~<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre> 
<p>创建挂载点</p> 
<pre><code class="prism language-d">[root@client ~]# mkdir /smbmount     #创建挂载点
</code></pre> 
<p>使用fred用户挂载：</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@client ~<span class="token punctuation">]</span><span class="token comment"># mount -o username=fred //192.168.99.142/myshare /smbmount</span>
Password <span class="token keyword">for</span> fred@//192.168.99.142/myshare:  ******
<span class="token punctuation">[</span>root@client ~<span class="token punctuation">]</span><span class="token comment"># df -h /smbmount</span>
Filesystem                Size  Used Avail Use% Mounted on
//192.168.99.142/myshare   70G  <span class="token number">5</span>.9G   65G   <span class="token number">9</span>% /smbmount
<span class="token punctuation">[</span>root@client ~<span class="token punctuation">]</span><span class="token comment"># df -h /smbmount</span>
Filesystem                Size  Used Avail Use% Mounted on
//192.168.189.133/myshare   70G  <span class="token number">5</span>.9G   65G   <span class="token number">9</span>% /smbmount
<span class="token punctuation">[</span>root@client ~<span class="token punctuation">]</span><span class="token comment">#</span>

</code></pre> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@client ~<span class="token punctuation">]</span><span class="token comment"># umount /smbmount </span>
<span class="token punctuation">[</span>root@client ~<span class="token punctuation">]</span><span class="token comment"># mount -t cifs -o username=fred,password=123456 //192.168.99.142/myshare /smbmount</span>
<span class="token punctuation">[</span>root@client ~<span class="token punctuation">]</span><span class="token comment"># df -h /smbmount</span>
Filesystem                Size  Used Avail Use% Mounted on
//192.168.99.142/myshare   70G  <span class="token number">5</span>.9G   65G   <span class="token number">9</span>% /smbmount
</code></pre> 
<pre><code>[root@client ~]# umount /smbmount 
[root@client ~]# mount -t cifs -o user=fred,pass=123456 //192.168.99.142/myshare /smbmount
[root@client ~]# df -h /smbmount
Filesystem                Size  Used Avail Use% Mounted on
//192.168.99.142/myshare   70G  5.9G   65G   9% /smbmount
</code></pre> 
<p>使用用户密码文件挂载</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@client ~<span class="token punctuation">]</span><span class="token comment"># vim userinfo.txt</span>
<span class="token punctuation">[</span>root@client ~<span class="token punctuation">]</span><span class="token comment"># chmod 600 userinfo.txt</span>
<span class="token punctuation">[</span>root@client ~<span class="token punctuation">]</span><span class="token comment"># umount /smbmount </span>
<span class="token punctuation">[</span>root@client ~<span class="token punctuation">]</span><span class="token comment"># mount -t cifs -o credentials=/root/userinfo.txt //192.168.99.142/myshare /smbmount</span>
<span class="token punctuation">[</span>root@client ~<span class="token punctuation">]</span><span class="token comment"># df -h /smbmount</span>
Filesystem                Size  Used Avail Use% Mounted on
//192.168.99.142/myshare   70G  <span class="token number">5</span>.9G   65G   <span class="token number">9</span>% /smbmount
<span class="token punctuation">[</span>root@client ~<span class="token punctuation">]</span><span class="token comment">#</span>

</code></pre> 
<h4><a id="6_291"></a>6、测试读写</h4> 
<p>server端更改共享目录权限</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># chmod 755 /sharedir/</span>
<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># chown fred /sharedir/</span>
<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># ll -d /sharedir/</span>
drwxr-xr-x. <span class="token number">2</span> fred root <span class="token number">32</span> May <span class="token number">11</span> <span class="token number">10</span>:44 /sharedir/
</code></pre> 
<p>client端尝试写入</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@client ~<span class="token punctuation">]</span><span class="token comment"># echo 123 &gt; /smbmount/3.txt</span>
<span class="token punctuation">[</span>root@client ~<span class="token punctuation">]</span><span class="token comment"># cat /smbmount/3.txt</span>
<span class="token number">123</span>
</code></pre> 
<h4><a id="7_310"></a>7、开机自动挂载</h4> 
<p>编辑<code>/etc/fstab</code>问价加入以下内容</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@client1 ~<span class="token punctuation">]</span><span class="token comment"># tail -1 /etc/fstab </span>
//192.168.189.133/myshare /smbmount/    cifs    defaults,username<span class="token operator">=</span>fred,password<span class="token operator">=</span><span class="token number">123456</span>      <span class="token number">0</span> <span class="token number">0</span>
<span class="token punctuation">[</span>root@client1 ~<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre> 
<p>验证自动挂载</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@client1 ~<span class="token punctuation">]</span><span class="token comment"># mount /smbmount/</span>
<span class="token punctuation">[</span>root@client1 ~<span class="token punctuation">]</span><span class="token comment"># df /smbmount/</span>
Filesystem                1K-blocks    Used Available Use% Mounted on
//192.168.189.133/myshare  <span class="token number">38745616</span> <span class="token number">7741696</span>  <span class="token number">31003920</span>  <span class="token number">20</span>% /smbmount
</code></pre> 
<h4><a id="8_vaild_userswrite_listbrowseable_329"></a>8、验证 <code>vaild users、write list、browseable</code>参数的作用</h4> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># tail -7 /etc/samba/smb.conf</span>
<span class="token punctuation">[</span>myshare<span class="token punctuation">]</span>
      comment <span class="token operator">=</span> used <span class="token keyword">for</span> share <span class="token builtin class-name">test</span>
      path <span class="token operator">=</span> /sharedir
      writable <span class="token operator">=</span> <span class="token function">yes</span>
        browseable <span class="token operator">=</span> <span class="token function">yes</span>   <span class="token comment">#是否可以浏览器访问</span>
        valid <span class="token function">users</span> <span class="token operator">=</span> fred,test   <span class="token comment">#可用用户列表</span>
        <span class="token function">write</span> list <span class="token operator">=</span> fred    <span class="token comment">#可写用户列表</span>
<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre> 
<p>windows宿主机尝试访问共享</p> 
<p><img src="https://images2.imgbox.com/f2/04/GrbP1eff_o.png" alt="在这里插入图片描述"><br> 输入samba用户密码<br> <img src="https://images2.imgbox.com/b7/58/KxrrBJWP_o.png" alt="在这里插入图片描述"><br> 连接成功</p> 
<p><img src="https://images2.imgbox.com/df/40/sSjkL4iT_o.png" alt="在这里插入图片描述"><br> 验证写权限列表<br> client1客户端使用test用户登录，test用户不在<code>write list</code>中，没有写入权限</p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@client1 ~<span class="token punctuation">]</span><span class="token comment"># mount -t cifs -o user=test,pass=123456 //192.168.189.133/myshare /smbmount/</span>
<span class="token punctuation">[</span>root@client1 ~<span class="token punctuation">]</span><span class="token comment"># df /smbmount/</span>
Filesystem                1K-blocks    Used Available Use% Mounted on
//192.168.189.133/myshare  <span class="token number">38745616</span> <span class="token number">7741976</span>  <span class="token number">31003640</span>  <span class="token number">20</span>% /smbmount
<span class="token punctuation">[</span>root@client1 ~<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre> 
<p>尝试创建文件</p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@client1 ~<span class="token punctuation">]</span><span class="token comment"># ls /smbmount/</span>
<span class="token number">2</span>.txt  <span class="token number">3</span>.txt  <span class="token number">5</span>.txt  <span class="token number">6</span>.txt
<span class="token punctuation">[</span>root@client1 ~<span class="token punctuation">]</span><span class="token comment"># echo 1111 &gt; 7.txt</span>
<span class="token punctuation">[</span>root@client1 ~<span class="token punctuation">]</span><span class="token comment"># ls /smbmount/     #7.txt没有被创建</span>
<span class="token number">2</span>.txt  <span class="token number">3</span>.txt  <span class="token number">5</span>.txt  <span class="token number">6</span>.txt 
<span class="token punctuation">[</span>root@client1 ~<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre> 
<p>修改server端配置文件，将test用户移除，再在client端登录尝试，失败。</p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># tail -7 /etc/samba/smb.conf</span>
<span class="token punctuation">[</span>myshare<span class="token punctuation">]</span>
      comment <span class="token operator">=</span> used <span class="token keyword">for</span> share <span class="token builtin class-name">test</span>
      path <span class="token operator">=</span> /sharedir
      writable <span class="token operator">=</span> <span class="token function">yes</span>
        browseable <span class="token operator">=</span> <span class="token function">yes</span>
        valid <span class="token function">users</span> <span class="token operator">=</span> fred
        <span class="token function">write</span> list <span class="token operator">=</span> fred
<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@client1 ~<span class="token punctuation">]</span><span class="token comment"># mount -t cifs -o user=test,pass=123456 //192.168.189.133/myshare /smbmount/</span>
<span class="token function">mount</span> error<span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span>: Permission denied
Refer to the mount.cifs<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span> manual page <span class="token punctuation">(</span>e.g. <span class="token function">man</span> mount.cifs<span class="token punctuation">)</span> and kernel log messages <span class="token punctuation">(</span>dmesg<span class="token punctuation">)</span>
<span class="token punctuation">[</span>root@client1 ~<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9f573b2cc46764c876675ee11b17fd37/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">GIt Squash 多个提交压缩提交</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b4bb3535f3c70cf759ad625955245515/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">leetcode 516. 最长回文子序列(JAVA)题解</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>