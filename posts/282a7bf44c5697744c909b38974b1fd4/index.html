<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>爬虫实战小案例—获取喜马拉雅账号的关注数据和粉丝数据生成电子表格并实现批量关注或者取关然后生成表格文件 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="爬虫实战小案例—获取喜马拉雅账号的关注数据和粉丝数据生成电子表格并实现批量关注或者取关然后生成表格文件" />
<meta property="og:description" content="爬虫案例—获取喜马拉雅账号的关注数据和粉丝数据生成电子表格并实现批量关注或者取关然后生成表格文件 ​ 有好多人平时应该很喜欢听喜马拉雅的广播，也有自己的账号。我本人平时很少听喜马拉雅广播，前几天一个朋友问我能不能帮他获取喜马拉雅账号的已关注的数据和粉丝的数据， 然后再查找有哪些自己已关注的但没有关注自己（也就是不是自己的粉丝）的，还有自己没关注的粉丝数据。接下来这个朋友又提出能不能帮助实现批量取关和关注数据，然后再生成一个关注和取关的数据表格文件。
​ 大家听起来估计也有点绕了，我也是有这个同感。话不多说了，我接到他这个请求之后，第一时间想到用爬虫来实现这个功能。喜马拉雅的登录页面如下：
登录之后进入 个人主页，点击账号头像然后再点击个人页。如下图所示：
然后进入到个人主页，按下F12键进入开发者工具模式（Chrome浏览器），再点击关注标签，进入关注页面，如下图所示：
如红框所示就是关注页面的链接，点击红框可以看到headers请求头包含url，如下图所示：
通过分析此页面是异步加载方式，响应的数据为json格式，点击如下图红框所示的标签：
粉丝页面跟这个是同理。不在这里一一截图展示了。那么接下来就是如何获取关注和粉丝的数据了，登录账号以后，就很简单了，代码如下：
import pandas as pd import requests import datetime headers = { &#39;user-agent&#39;: &#39;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36&#39;, } # 粉丝数据函数 def get_fans_info(fans_url): # cookies = {&#39;Cookie&#39;:&#39;_xmLog=h5&amp;c8be971d-2bc5-45e7-8688-bcdd1db6756e&amp;process.env.sdkVersion; xm-page-viewid=ximalaya-web; impl=www.ximalaya.com.login; x_xmly_traffic=utm_source%253A%2526utm_medium%253A%2526utm_campaign%253A%2526utm_content%253A%2526utm_term%253A%2526utm_from%253A; Hm_lvt_4a7d8ec50cfd6af753c4f8aee3425070=1704697013; wfp=ACM3OGI2ZWMyZjA0YmZmNzZjbgf-TtTrRsF4bXdlYl93d3c; 1&amp;remember_me=y; 1&amp;_token=460178701&amp;BC39CDE0340ND8AF9619AA1EE929208BF9A358F59A66F0159C7A3207C10994A33085862F14E2119M775F0459473319F_; 1_l_flag=460178701&amp;BC39CDE0340ND8AF9619AA1EE929208BF9A358F59A66F0159C7A3207C10994A33085862F14E2119M775F0459473319F__2024-01-2419:20:17; Hm_lpvt_4a7d8ec50cfd6af753c4f8aee3425070=1706145114; web_login=1706148245440&#39; # } session = requests.Session() res = session.get(fans_url, headers=headers)#, cookies=cookies) res_fans = res.json()[&#39;data&#39;][&#39;fansPageInfo&#39;] fans_id = [] fans_nickname = [] for fan in res_fans: fans_id." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/282a7bf44c5697744c909b38974b1fd4/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-25T22:46:02+08:00" />
<meta property="article:modified_time" content="2024-01-25T22:46:02+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">爬虫实战小案例—获取喜马拉雅账号的关注数据和粉丝数据生成电子表格并实现批量关注或者取关然后生成表格文件</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>爬虫案例—获取喜马拉雅账号的关注数据和粉丝数据生成电子表格并实现批量关注或者取关然后生成表格文件</h2> 
<p>​ 有好多人平时应该很喜欢听喜马拉雅的广播，也有自己的账号。我本人平时很少听喜马拉雅广播，前几天一个朋友问我能不能帮他获取喜马拉雅账号的已关注的数据和粉丝的数据， 然后再查找有哪些自己已关注的但没有关注自己（也就是不是自己的粉丝）的，还有自己没关注的粉丝数据。接下来这个朋友又提出能不能帮助实现批量取关和关注数据，然后再生成一个关注和取关的数据表格文件。</p> 
<p>​ 大家听起来估计也有点绕了，我也是有这个同感。话不多说了，我接到他这个请求之后，第一时间想到用爬虫来实现这个功能。喜马拉雅的登录页面如下：</p> 
<p><img src="https://images2.imgbox.com/28/80/1oVKIbHl_o.png" alt="Screenshot 2024-01-25 at 21.35.42"></p> 
<p>登录之后进入 个人主页，点击账号头像然后再点击个人页。如下图所示：</p> 
<p><img src="https://images2.imgbox.com/cb/22/QBGHyW69_o.png" alt="Screenshot 2024-01-25 at 21.37.42 1"></p> 
<p><img src="https://images2.imgbox.com/47/79/OpzQVXqB_o.png" alt="Screenshot 2024-01-25 at 21.38.42"></p> 
<p>然后进入到个人主页，按下F12键进入开发者工具模式（Chrome浏览器），再点击关注标签，进入关注页面，如下图所示：</p> 
<p><img src="https://images2.imgbox.com/ff/ed/RnOJVc6g_o.png" alt="Screenshot 2024-01-25 at 21.42.25"></p> 
<p>如红框所示就是关注页面的链接，点击红框可以看到headers请求头包含url，如下图所示：</p> 
<p><img src="https://images2.imgbox.com/c5/a2/jVlGxh1H_o.png" alt="Screenshot 2024-01-25 at 21.44.03"></p> 
<p>通过分析此页面是异步加载方式，响应的数据为json格式，点击如下图红框所示的标签：</p> 
<p><img src="https://images2.imgbox.com/63/d0/16ozaYFu_o.png" alt="Screenshot 2024-01-25 at 22.08.46"></p> 
<p>粉丝页面跟这个是同理。不在这里一一截图展示了。那么接下来就是如何获取关注和粉丝的数据了，登录账号以后，就很简单了，代码如下：</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> requests
<span class="token keyword">import</span> datetime


headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'user-agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>


<span class="token comment"># 粉丝数据函数</span>
<span class="token keyword">def</span> <span class="token function">get_fans_info</span><span class="token punctuation">(</span>fans_url<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># cookies = {'Cookie':'_xmLog=h5&amp;c8be971d-2bc5-45e7-8688-bcdd1db6756e&amp;process.env.sdkVersion; xm-page-viewid=ximalaya-web; impl=www.ximalaya.com.login; x_xmly_traffic=utm_source%253A%2526utm_medium%253A%2526utm_campaign%253A%2526utm_content%253A%2526utm_term%253A%2526utm_from%253A; Hm_lvt_4a7d8ec50cfd6af753c4f8aee3425070=1704697013; wfp=ACM3OGI2ZWMyZjA0YmZmNzZjbgf-TtTrRsF4bXdlYl93d3c; 1&amp;remember_me=y; 1&amp;_token=460178701&amp;BC39CDE0340ND8AF9619AA1EE929208BF9A358F59A66F0159C7A3207C10994A33085862F14E2119M775F0459473319F_; 1_l_flag=460178701&amp;BC39CDE0340ND8AF9619AA1EE929208BF9A358F59A66F0159C7A3207C10994A33085862F14E2119M775F0459473319F__2024-01-2419:20:17; Hm_lpvt_4a7d8ec50cfd6af753c4f8aee3425070=1706145114; web_login=1706148245440'</span>
    <span class="token comment">#    }</span>
    session <span class="token operator">=</span> requests<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span>
    res <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span>fans_url<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span><span class="token comment">#, cookies=cookies)</span>

    res_fans <span class="token operator">=</span> res<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'fansPageInfo'</span><span class="token punctuation">]</span>
    fans_id <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    fans_nickname <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> fan <span class="token keyword">in</span> res_fans<span class="token punctuation">:</span>
        fans_id<span class="token punctuation">.</span>append<span class="token punctuation">(</span>fan<span class="token punctuation">[</span><span class="token string">'uid'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        fans_nickname<span class="token punctuation">.</span>append<span class="token punctuation">(</span>fan<span class="token punctuation">[</span><span class="token string">'anchorNickName'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> fans_id<span class="token punctuation">,</span> fans_nickname

    <span class="token comment"># return fans_lst</span>


<span class="token comment"># 关注数据函数</span>
<span class="token keyword">def</span> <span class="token function">get_following_info</span><span class="token punctuation">(</span>following_url<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># cookies = {'Cookie':'_xmLog=h5&amp;c8be971d-2bc5-45e7-8688-bcdd1db6756e&amp;process.env.sdkVersion; xm-page-viewid=ximalaya-web; impl=www.ximalaya.com.login; x_xmly_traffic=utm_source%253A%2526utm_medium%253A%2526utm_campaign%253A%2526utm_content%253A%2526utm_term%253A%2526utm_from%253A; Hm_lvt_4a7d8ec50cfd6af753c4f8aee3425070=1704697013; wfp=ACM3OGI2ZWMyZjA0YmZmNzZjbgf-TtTrRsF4bXdlYl93d3c; 1&amp;remember_me=y; 1&amp;_token=460178701&amp;BC39CDE0340ND8AF9619AA1EE929208BF9A358F59A66F0159C7A3207C10994A33085862F14E2119M775F0459473319F_; 1_l_flag=460178701&amp;BC39CDE0340ND8AF9619AA1EE929208BF9A358F59A66F0159C7A3207C10994A33085862F14E2119M775F0459473319F__2024-01-2419:20:17; Hm_lpvt_4a7d8ec50cfd6af753c4f8aee3425070=1706148771; web_login=1706148792369'</span>
    <span class="token comment"># }</span>

    following_id <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    following_nickname <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    session <span class="token operator">=</span> requests<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span>
    res_follow <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span>following_url<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span><span class="token comment">#, cookies=cookies)</span>
    follow_data <span class="token operator">=</span> res_follow<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span>

    <span class="token keyword">for</span> following <span class="token keyword">in</span> follow_data<span class="token punctuation">[</span><span class="token string">'followingsPageInfo'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token comment"># if following['beFollow']:</span>
        following_id<span class="token punctuation">.</span>append<span class="token punctuation">(</span>following<span class="token punctuation">[</span><span class="token string">'uid'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        following_nickname<span class="token punctuation">.</span>append<span class="token punctuation">(</span>following<span class="token punctuation">[</span><span class="token string">'anchorNickName'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> following_id<span class="token punctuation">,</span> following_nickname


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    <span class="token comment"># 获取当前日期做文件名</span>
    file_date <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>datetime<span class="token punctuation">.</span>date<span class="token punctuation">.</span>today<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># 创建粉丝数据</span>
    fans_data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'UID'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                 <span class="token string">'粉丝昵称'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                 <span class="token punctuation">}</span>

    <span class="token comment"># 创建关注数据</span>
    following_data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">'UID'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'关注昵称'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>

    <span class="token comment"># 创建没有去关注的粉丝数据</span>
    un_following_fans_data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">'UID'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'粉丝昵称'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>

    <span class="token comment"># 创建已关注的非粉丝数据</span>
    un_fans_following_data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">'UID'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'关注昵称'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>

    <span class="token comment"># 粉丝的数据遍历</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        fans_url <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'https://www.ximalaya.com/revision/user/fans?page=</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>i<span class="token punctuation">}</span></span><span class="token string">&amp;pageSize=10&amp;keyWord=&amp;uid=460178701'</span></span>
        fans_id_lst<span class="token punctuation">,</span> fans_nickname_lst <span class="token operator">=</span> get_fans_info<span class="token punctuation">(</span>fans_url<span class="token punctuation">)</span>
        fans_data<span class="token punctuation">[</span><span class="token string">'UID'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>extend<span class="token punctuation">(</span>fans_id_lst<span class="token punctuation">)</span>
        fans_data<span class="token punctuation">[</span><span class="token string">'粉丝昵称'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>extend<span class="token punctuation">(</span>fans_nickname_lst<span class="token punctuation">)</span>

    <span class="token comment"># 已关注的数据遍历</span>
    <span class="token keyword">for</span> n <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        following_url <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'https://www.ximalaya.com/revision/user/following?page=</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>n<span class="token punctuation">}</span></span><span class="token string">&amp;pageSize=10&amp;keyWord=&amp;uid=460178701'</span></span>
        following_id_lst<span class="token punctuation">,</span> following_nickname_lst <span class="token operator">=</span> get_following_info<span class="token punctuation">(</span>following_url<span class="token punctuation">)</span>
        following_data<span class="token punctuation">[</span><span class="token string">'UID'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>extend<span class="token punctuation">(</span>following_id_lst<span class="token punctuation">)</span>
        following_data<span class="token punctuation">[</span><span class="token string">'关注昵称'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>extend<span class="token punctuation">(</span>following_nickname_lst<span class="token punctuation">)</span>

    <span class="token comment"># 已关注的非粉丝数据</span>
    <span class="token keyword">for</span> person_uid <span class="token keyword">in</span> following_data<span class="token punctuation">[</span><span class="token string">'UID'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> person_uid <span class="token keyword">not</span> <span class="token keyword">in</span> fans_data<span class="token punctuation">[</span><span class="token string">'UID'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            un_fans_following_data<span class="token punctuation">[</span><span class="token string">'UID'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>person_uid<span class="token punctuation">)</span>
            un_fans_following_data<span class="token punctuation">[</span><span class="token string">'关注昵称'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>following_data<span class="token punctuation">[</span><span class="token string">'关注昵称'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>following_data<span class="token punctuation">[</span><span class="token string">'UID'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>index<span class="token punctuation">(</span>person_uid<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token comment"># 没有去关注的粉丝数据</span>
    <span class="token keyword">for</span> unfollow_uid <span class="token keyword">in</span> fans_data<span class="token punctuation">[</span><span class="token string">'UID'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> unfollow_uid <span class="token keyword">not</span> <span class="token keyword">in</span> following_data<span class="token punctuation">[</span><span class="token string">'UID'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            un_following_fans_data<span class="token punctuation">[</span><span class="token string">'UID'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>unfollow_uid<span class="token punctuation">)</span>
            un_following_fans_data<span class="token punctuation">[</span><span class="token string">'粉丝昵称'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>fans_data<span class="token punctuation">[</span><span class="token string">'粉丝昵称'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>fans_data<span class="token punctuation">[</span><span class="token string">'UID'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>index<span class="token punctuation">(</span>unfollow_uid<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token comment"># 创建DataFrame对象</span>
    df1 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>fans_data<span class="token punctuation">)</span>
    df2 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>following_data<span class="token punctuation">)</span>
    df3 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>un_fans_following_data<span class="token punctuation">)</span>  <span class="token comment"># 关注的非粉丝数据</span>
    df4 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>un_following_fans_data<span class="token punctuation">)</span>  <span class="token comment"># 没有关注的粉丝数据</span>
    
		<span class="token comment"># 文件生成的路径可以根据自己实际情况设置</span>
    <span class="token keyword">with</span> pd<span class="token punctuation">.</span>ExcelWriter<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"../喜马拉雅项目/喜马拉雅数据表-</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>file_date<span class="token punctuation">}</span></span><span class="token string">.xlsx"</span></span><span class="token punctuation">)</span> <span class="token keyword">as</span> xlsx<span class="token punctuation">:</span>
        df1<span class="token punctuation">.</span>to_excel<span class="token punctuation">(</span>xlsx<span class="token punctuation">,</span> sheet_name<span class="token operator">=</span><span class="token string">"粉丝数据"</span><span class="token punctuation">)</span>
        df2<span class="token punctuation">.</span>to_excel<span class="token punctuation">(</span>xlsx<span class="token punctuation">,</span> sheet_name<span class="token operator">=</span><span class="token string">"已关注数据"</span><span class="token punctuation">)</span>
        df3<span class="token punctuation">.</span>to_excel<span class="token punctuation">(</span>xlsx<span class="token punctuation">,</span> sheet_name<span class="token operator">=</span><span class="token string">'已关注的非粉丝数据'</span><span class="token punctuation">)</span>
        df4<span class="token punctuation">.</span>to_excel<span class="token punctuation">(</span>xlsx<span class="token punctuation">,</span> sheet_name<span class="token operator">=</span><span class="token string">'没有去关注的粉丝数据'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'数据输出成功！'</span><span class="token punctuation">)</span>
</code></pre> 
<p>执行如上代码，会生成一个当日的获取数据。如下所示：</p> 
<p><img src="https://images2.imgbox.com/f6/7a/635TwKrS_o.png" alt="Screenshot 2024-01-25 at 22.18.58"></p> 
<p>接下来，去实现批量关注和取消关注数据的操作，这里涉及到请求头里必须携带cookie，本人是通过手动获取的，因为hook技术我还不熟悉，如果有人熟悉，可以帮我完善一下我的代码，感谢！！！手动获取取消或者关注的cookie，如下图所示：</p> 
<p><img src="https://images2.imgbox.com/68/3b/zux82vIc_o.png" alt="外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传"></p> 
<p><img src="https://images2.imgbox.com/87/6f/0PGTZz4H_o.png" alt="Screenshot 2024-01-25 at 22.24.26"></p> 
<p><img src="https://images2.imgbox.com/4f/04/C6PEd9nM_o.png" alt="Screenshot 2024-01-25 at 22.25.45"></p> 
<p>通过上图可以看到，取消关注的请求URL和请求方式POST，接下来点击Payload可以看到请求的data参数值，如下图所示：</p> 
<p><img src="https://images2.imgbox.com/8c/92/5nPhu0AJ_o.png" alt="Screenshot 2024-01-25 at 22.26.57"></p> 
<p>点击cancelFollow可以看到红框内的Cookie值，如下图所示：</p> 
<p><img src="https://images2.imgbox.com/00/f2/avPXwPDg_o.png" alt="Screenshot 2024-01-25 at 22.28.20"></p> 
<p>通过如上的分析，实现批量取关和关注的代码如下：</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> requests
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> datetime


headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'user-agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36'</span><span class="token punctuation">,</span>
    <span class="token string">'cookie'</span><span class="token punctuation">:</span> <span class="token string">'你的cookie值'</span>
<span class="token punctuation">}</span>


<span class="token comment"># 定义操作</span>
<span class="token keyword">def</span> <span class="token function">set_follow</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> uid<span class="token punctuation">)</span><span class="token punctuation">:</span>
    session <span class="token operator">=</span> requests<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'followingUid'</span><span class="token punctuation">:</span> uid<span class="token punctuation">}</span>
    res <span class="token operator">=</span> session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>
    <span class="token keyword">if</span> res<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>uid<span class="token punctuation">}</span></span><span class="token string"> '</span></span> <span class="token operator">+</span> res<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> res<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'isMutualFollowed'</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'此UID为互相关注'</span><span class="token punctuation">)</span>


<span class="token comment"># 取消关注</span>
<span class="token keyword">def</span> <span class="token function">cancel_follow</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> uid<span class="token punctuation">)</span><span class="token punctuation">:</span>
    session <span class="token operator">=</span> requests<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'followingUid'</span><span class="token punctuation">:</span> uid<span class="token punctuation">}</span>
    res <span class="token operator">=</span> session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>
    <span class="token keyword">if</span> res<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>uid<span class="token punctuation">}</span></span><span class="token string"> '</span></span> <span class="token operator">+</span> res<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">uid_input</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>
            uid <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'请输入uid：(q/Q退出)'</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> uid<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'q'</span><span class="token punctuation">:</span>
                <span class="token keyword">break</span>
            data_dict<span class="token punctuation">[</span><span class="token string">'UID'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>uid<span class="token punctuation">)</span>
        <span class="token keyword">return</span> data_dict<span class="token punctuation">[</span><span class="token string">'UID'</span><span class="token punctuation">]</span>
    <span class="token keyword">except</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'请核对输入信息！！！'</span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>

    file_date <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>datetime<span class="token punctuation">.</span>date<span class="token punctuation">.</span>today<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    cancel_follow_url <span class="token operator">=</span> <span class="token string">'https://www.ximalaya.com/revision/follow/cancelFollow'</span>
    set_follow_url <span class="token operator">=</span> <span class="token string">'https://www.ximalaya.com/revision/follow/setFollow'</span>

    url_dict <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'1'</span><span class="token punctuation">:</span> set_follow_url<span class="token punctuation">,</span>
                <span class="token string">'0'</span><span class="token punctuation">:</span> cancel_follow_url<span class="token punctuation">,</span>
                <span class="token punctuation">}</span>

    <span class="token comment"># 循环操作</span>
    <span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>

        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'&lt;操作选择&gt;:'</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">'\t'</span><span class="token punctuation">)</span>
        operation <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'关注（1）取关（0）(q/Q)退出：'</span><span class="token punctuation">)</span>

        <span class="token keyword">if</span> operation <span class="token operator">==</span> <span class="token string">'1'</span><span class="token punctuation">:</span>
            data_dict <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'UID'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
            data_uid <span class="token operator">=</span> uid_input<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> uid <span class="token keyword">in</span> data_uid<span class="token punctuation">:</span>
                set_follow<span class="token punctuation">(</span>url_dict<span class="token punctuation">[</span><span class="token string">'1'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>uid<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> data_dict<span class="token punctuation">[</span><span class="token string">'UID'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                df1 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>data_dict<span class="token punctuation">)</span>
                <span class="token keyword">with</span> pd<span class="token punctuation">.</span>ExcelWriter<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"./关注-</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>file_date<span class="token punctuation">}</span></span><span class="token string">.xlsx"</span></span><span class="token punctuation">)</span> <span class="token keyword">as</span> xlsx<span class="token punctuation">:</span>
                    df1<span class="token punctuation">.</span>to_excel<span class="token punctuation">(</span>xlsx<span class="token punctuation">,</span> sheet_name<span class="token operator">=</span><span class="token string">'关注数据'</span><span class="token punctuation">,</span>index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> operation<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'q'</span><span class="token punctuation">:</span>
            <span class="token keyword">break</span>

        <span class="token keyword">elif</span> operation <span class="token operator">==</span> <span class="token string">'0'</span><span class="token punctuation">:</span>
            data_dict <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'UID'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
            data_uid1 <span class="token operator">=</span> uid_input<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> uid <span class="token keyword">in</span> data_uid1<span class="token punctuation">:</span>
                cancel_follow<span class="token punctuation">(</span>url_dict<span class="token punctuation">[</span><span class="token string">'0'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>uid<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> data_dict<span class="token punctuation">[</span><span class="token string">'UID'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                df2 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>data_dict<span class="token punctuation">)</span>
                <span class="token keyword">with</span> pd<span class="token punctuation">.</span>ExcelWriter<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"./取关-</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>file_date<span class="token punctuation">}</span></span><span class="token string">.xlsx"</span></span><span class="token punctuation">)</span> <span class="token keyword">as</span> xlsx<span class="token punctuation">:</span>
                    df2<span class="token punctuation">.</span>to_excel<span class="token punctuation">(</span>xlsx<span class="token punctuation">,</span> sheet_name<span class="token operator">=</span><span class="token string">"取关数据"</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> operation<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'q'</span><span class="token punctuation">:</span>
                <span class="token keyword">break</span>
</code></pre> 
<p>运行如下图所示：</p> 
<p><img src="https://images2.imgbox.com/db/3a/5M85QKPS_o.png" alt="Screenshot 2024-01-25 at 22.40.04"></p> 
<p>代码都是同步请求方式实现的，代码中的页面数目根据自己的实际情况可以修改。通过朋友验证，效果基本达到了他的要求。我也有点小小的成就感。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/65e6687cbcc184e80a37ddd1e991ddd6/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Spring 事务和事务传播机制</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a0cb83e4d72ad1517f6d6bd3e26c493c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">UE4运用C&#43;&#43;和框架开发坦克大战教程笔记（十六）（第49~50集）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>