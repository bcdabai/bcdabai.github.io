<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>利用wkhtmltopdf插件做html转换PDF并实行在线打印或下载 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="利用wkhtmltopdf插件做html转换PDF并实行在线打印或下载" />
<meta property="og:description" content="最近项目需要使用到html转PDF，如翻阅了很多资料，自己整理了如下的内容做个笔记
博客：https://www.jianshu.com/p/559c594678b6
官方下载：https://wkhtmltopdf.org/downloads.html
我们一起踩过一坑：https://blog.csdn.net/qq_39541254/article/details/107541497
asp.net转换实例：https://www.cnblogs.com/ztf20/archive/2004/01/13/10414832.html
1、下载好 默认安装路径：C:\Program Files\wkhtmltopdf\bin\wkhtmltopdf.exe
2、根据情况把你安装wkhtmltopdf目录下的bin子目录加到 PATH 环境变量
3、导入类pdfconvert.cs 设计web.config 的wkhtmltopdf.exe路径如下 &lt;configuration&gt; &lt;appSettings&gt;
&lt;add key=&#34;wkhtmltopdf:path&#34; value=&#34;C:\Program Files\wkhtmltopdf\bin\wkhtmltopdf.exe&#34;/&gt;
&lt;/appSettings&gt;
&lt;/configuration&gt; 4、定义css类分页，增加qrcode.min.js 二维码连接，引入JS jquery.min.js 如下代码 增加生成动态二维码方法
string str = string.Format(@&#34;&lt;style&gt;div{0}&lt;/style&gt; &lt;script src=&#34;&#34;Scripts/jquery.min.js&#34;&#34;&gt;&lt;/script&gt;&lt;script src=&#34;&#34;Scripts/qrcode.min.js&#34;&#34;&gt;&lt;/script&gt;&lt;script&gt;{1}&lt;/script&gt;&lt;div id=&#34;&#34;tpdf&#34;&#34;&gt;&#34;, &#34;{page-break-before:always;font-size:8px;}&#34;, &#34;function makeCode(_div,str){var qrcode = new QRCode(document.getElementById(_div),{width:80,height:80});qrcode.makeCode(str);}&#34;);
5、后台动态接拼代码 ：
for (int i = 0; i &lt; 100; i&#43;&#43;)
{
str &#43;= string.Format(@&#34;&lt;div id=&#34;&#34;qrcode{0}&#34;&#34; &gt;測試&#34; &#43; i.ToString()&#43;&#34;&lt;/div&gt;&#34;,i.ToString());
endstr &#43;= string.Format(@&#34;makeCode(&#34;&#34;qrcode{0}&#34;&#34;,&#34;&#34;{1}&#34;&#34;);&#34;, i.ToString(),i.ToString());
}
endstr &#43;= &#34;&lt;/script&gt;&#34;;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/9542c0f99df5c1e1f085e683e09127c1/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-12-20T15:06:23+08:00" />
<meta property="article:modified_time" content="2020-12-20T15:06:23+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">利用wkhtmltopdf插件做html转换PDF并实行在线打印或下载</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>最近项目需要使用到html转PDF，如翻阅了很多资料，自己整理了如下的内容做个笔记</p> 
<p>博客：https://www.jianshu.com/p/559c594678b6<br> 官方下载：https://wkhtmltopdf.org/downloads.html<br> 我们一起踩过一坑：https://blog.csdn.net/qq_39541254/article/details/107541497<br> asp.net转换实例：https://www.cnblogs.com/ztf20/archive/2004/01/13/10414832.html</p> 
<p>1、下载好 默认安装路径：C:\Program Files\wkhtmltopdf\bin\wkhtmltopdf.exe<br> 2、根据情况把你安装wkhtmltopdf目录下的bin子目录加到 PATH 环境变量<br> 3、导入类pdfconvert.cs  设计web.config 的wkhtmltopdf.exe路径如下 <br> &lt;configuration&gt;  <br>   &lt;appSettings&gt;<br>     &lt;add key="wkhtmltopdf:path" value="C:\Program Files\wkhtmltopdf\bin\wkhtmltopdf.exe"/&gt;<br>   &lt;/appSettings&gt;<br> &lt;/configuration&gt;  <br> 4、定义css类分页，增加qrcode.min.js 二维码连接，引入JS jquery.min.js 如下代码  增加生成动态二维码方法<br> string str = string.Format(@"&lt;style&gt;div{0}&lt;/style&gt; &lt;script src=""Scripts/jquery.min.js""&gt;&lt;/script&gt;&lt;script src=""Scripts/qrcode.min.js""&gt;&lt;/script&gt;&lt;script&gt;{1}&lt;/script&gt;&lt;div id=""tpdf""&gt;", "{page-break-before:always;font-size:8px;}", "function makeCode(_div,str){var qrcode = new QRCode(document.getElementById(_div),{width:80,height:80});qrcode.makeCode(str);}");<br> 5、后台动态接拼代码 ：<br>  for (int i = 0; i &lt; 100; i++)<br>         {<!-- --><br>             str += string.Format(@"&lt;div id=""qrcode{0}"" &gt;測試" + i.ToString()+"&lt;/div&gt;",i.ToString());<br>             endstr += string.Format(@"makeCode(""qrcode{0}"",""{1}"");", i.ToString(),i.ToString());<br>         }<br>         endstr += "&lt;/script&gt;";</p> 
<p>6、调用转pdf方法<br>  PdfConvert.ConvertHtmlToPdf(<br>             new PdfDocument { Html = str,<br>                 Pageheight="80mm", //页面尺码<br>                 Pagewidth="30mm", //页面尺码<br>                 marginbottom="0mm", //边距<br>                 marginleft = "0mm",<br>                 marginright = "0mm",<br>                 margintop = "0mm"               <br>             },<br>             new PdfOutput { OutputFilePath = outpath }, true<br>         );</p> 
<p>7、整个调用方法如下</p> 
<p> protected void Button3_Click(object sender, EventArgs e)<br>     {<!-- --><br>         string url = @"https://www.baidu.com";<br>         string filename = Guid.NewGuid().ToString();<br>         string pdfpath = filename + ".pdf";<br>         string outpath = Server.MapPath(pdfpath);<br>         Console.InputEncoding = Encoding.UTF8;<br>         PdfConvert.Environment.Debug = false;</p> 
<p>        string endstr = "&lt;script&gt;";<br>         string str = string.Format(@"&lt;style&gt;div{0}&lt;/style&gt;&lt;script src=""Scripts/jquery.min.js""&gt;&lt;/script&gt;&lt;script src=""Scripts/qrcode.min.js""&gt;&lt;/script&gt;&lt;script&gt;{1}&lt;/script&gt;", "{page-break-before:always;font-size:8px;}", "function makeCode(_div,str){var qrcode = new QRCode(document.getElementById(_div),{width:80,height:80});qrcode.makeCode(str);}");<br>         for (int i = 0; i &lt; 100; i++)<br>         {<!-- --><br>             str += string.Format(@"&lt;div id=""qrcode{0}"" &gt;測試" + i.ToString()+"&lt;/div&gt;",i.ToString());<br>             endstr += string.Format(@"makeCode(""qrcode{0}"",""{1}"");", i.ToString(),i.ToString());<br>         }<br>         endstr += "&lt;/script&gt;";<br>         str += endstr;<br>         str11 = str;<br>         PdfConvert.ConvertHtmlToPdf(<br>             new PdfDocument { Html = str,<br>                 Pageheight="80mm",  <br>                 Pagewidth="30mm",<br>                 marginbottom="0mm",<br>                 marginleft = "0mm",<br>                 marginright = "0mm",<br>                 margintop = "0mm"               <br>             },<br>             new PdfOutput { OutputFilePath = outpath }, true<br>         );<br>       Response.Redirect(pdfpath); //转换后直接打开<br>     }<br> protected void Page_Load(object sender, EventArgs e)<br>     {<!-- --><br>         Button3.Attributes.Add("onclick", "this.form.target='_blank'");<br>     }<br> ###################################################################<br> 动态数据转换成PDF当方法：<br> &lt;script  type="text/javascript"&gt;<br>      document.getElementById("downpdf").onclick = function (){<!-- --><br>      var pages = document.querySelector('#divElehtml').children;//转PDF档起始元素divEle ID      <br>          console.log(pages[1].outerHTML);<br>          var str = "";<br>          for (var i = 0; i &lt; pages.length; i++) {<!-- --><br>              str += pages[i].outerHTML;<br>          }<br>          console.log(str);<br>         <br>          $.ajax({<!-- --><br>              type: "post",<br>              url: "./html2pdf/html2pdf.ashx",<br>              async: false,//同步<br>              data: {<!-- --><br>                  Method: 'ExceclPDF2',<br>                  HtmlStr:encodeURIComponent(str),//注意这里必须要进行转码，负责Ajax会报错 (已经把+号变成空格了) encodeURI会造成空格就成+号，请用encodeURIComponent<br>              },<br>              success: function (result) {<!-- --><br>                  //获取返回参数<br>                  if (result != undefined &amp;&amp; result != "") {<!-- --><br>                      //请求下载pdf的url                        <br>                   // window.location.href = result;<br>                      window.open(result);<br>                  }<br>              }<br>          });<br>      }  <br>     &lt;/script&gt;   </p> 
<p>html2pdf.ashx代码如下<br> ----------------------------------------------------------------------------------------------------------<br>  public void ProcessRequest(HttpContext context)<br>         {<!-- --><br>             context.Response.ContentType = "text/plain";            <br>             string ssss = Convert.ToString(context.Request.Params["HtmlStr"]);<br>             int MaxAndln = Convert.ToInt32(context.Request.Params["MaxAndln"].ToString());//订单编号与裁床单ID<br>             string htmlStr = HttpUtility.UrlDecode(ssss);            <br>             string htmlfileName = "html2pdf" + DateTime.Now.ToString("yyyyMMddHHmmss") + ".pdf";<br>             string htmlSavPath = context.Request.MapPath("~/slip/print/HtmlFile/" + htmlfileName);                     <br>             string html = @"&lt;html xmlns=""http://www.w3.org/1999/xhtml"" &gt; &lt;head runat=""server"" &gt;&lt;/head&gt;&lt;body&gt;" + htmlStr + "&lt;/body&gt;&lt;/html&gt;</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/de3aa57850889f81b33434bc79c3497e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">C# richTextBox控制最大行数</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4a376437ce61c1898270d87f8b00407b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">天线3db波束宽度_天线波束宽度计算公式</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>