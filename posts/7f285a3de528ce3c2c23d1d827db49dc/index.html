<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【ROS】dynamic_reconfigure配置详细说明 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【ROS】dynamic_reconfigure配置详细说明" />
<meta property="og:description" content="文章目录 文章目录
前言
一、编写.cfg文件
二、为节点配置dynamic_reconfigure
总结
前言 dynamic_reconfigure配置是ROS中为了方便用户对程序中的参数进行实时调整而推出的工具，配置好自己的dynamic_reconfigure文件后，可以很方便的使用ROS提供的rqt_reconfigure工具对程序的参数进行合理调整，以获得最优的性能。
例如：move_base中就针对costmap、planner等设置了很多动态调整的参数，可以方便用户在使用过程中调整得到合适的参数。
又例如：如果我们开发了一个PID控制器程序，如果这时能通过rqt_reconfigure工具，对PID参数进行合理的调整，然后直接将获得的参数写进程序，就能使工作更加高效。
一、编写.cfg文件 1.在功能包文件夹下，创建一个config文件夹（其他名字也行，比如cfg）
在其中创建一个后缀为.cfg的文件
2.在其中写入内容
#!/usr/bin/env python from dynamic_reconfigure.parameter_generator_catkin import * gen = ParameterGenerator() type_enum = gen.enum([gen.const(&#34;centroid&#34;, str_t, &#34;centroid&#34;, &#34;Use Centroid&#34;), gen.const(&#34;initial&#34;, str_t, &#34;initial&#34;, &#34;Use Initial&#34;), gen.const(&#34;middle&#34;, str_t, &#34;middle&#34;, &#34;Use Middle&#34;)], &#34;An enum to set frontier type&#34;) gen.add(&#34;timeout&#34;, double_t, 0, &#34;Explore Timeout(s)&#34;, 30.0, 10.0, 100.0) gen.add(&#34;min_frontier_size&#34;, double_t, 0, &#34;Min Frontier Size(m)&#34;, 0.75, 0.5, 2) gen.add(&#34;visualize&#34;, bool_t, 0, &#34;Is Visualize?&#34;, True) gen." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/7f285a3de528ce3c2c23d1d827db49dc/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-01-15T14:29:37+08:00" />
<meta property="article:modified_time" content="2023-01-15T14:29:37+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【ROS】dynamic_reconfigure配置详细说明</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h4 id="%E6%96%87%E7%AB%A0%E7%9B%AE%E5%BD%95">文章目录</h4> 
<p id="main-toc"><a href="#%E6%96%87%E7%AB%A0%E7%9B%AE%E5%BD%95" rel="nofollow">文章目录</a></p> 
<p id="%E5%89%8D%E8%A8%80-toc" style="margin-left:0px;"><a href="#%E5%89%8D%E8%A8%80" rel="nofollow">前言</a></p> 
<p id="%E4%B8%80%E3%80%81%E7%BC%96%E5%86%99.cfg%E6%96%87%E4%BB%B6-toc" style="margin-left:0px;"><a href="#%E4%B8%80%E3%80%81%E7%BC%96%E5%86%99.cfg%E6%96%87%E4%BB%B6" rel="nofollow">一、编写.cfg文件</a></p> 
<p id="%E4%BA%8C%E3%80%81%E4%B8%BA%E8%8A%82%E7%82%B9%E9%85%8D%E7%BD%AEdynamic_reconfigure-toc" style="margin-left:0px;"><a href="#%E4%BA%8C%E3%80%81%E4%B8%BA%E8%8A%82%E7%82%B9%E9%85%8D%E7%BD%AEdynamic_reconfigure" rel="nofollow">二、为节点配置dynamic_reconfigure</a></p> 
<p id="%E6%80%BB%E7%BB%93-toc" style="margin-left:0px;"><a href="#%E6%80%BB%E7%BB%93" rel="nofollow">总结</a></p> 
<hr> 
<h2 id="%E5%89%8D%E8%A8%80"><a id="_7"></a>前言</h2> 
<p></p> 
<p>dynamic_reconfigure配置是ROS中为了方便用户对程序中的参数进行实时调整而推出的工具，配置好自己的dynamic_reconfigure文件后，可以很方便的使用ROS提供的rqt_reconfigure工具对程序的参数进行合理调整，以获得最优的性能。</p> 
<p>例如：move_base中就针对costmap、planner等设置了很多动态调整的参数，可以方便用户在使用过程中调整得到合适的参数。</p> 
<p>又例如：如果我们开发了一个PID控制器程序，如果这时能通过rqt_reconfigure工具，对PID参数进行合理的调整，然后直接将获得的参数写进程序，就能使工作更加高效。</p> 
<p></p> 
<h2 id="%E4%B8%80%E3%80%81%E7%BC%96%E5%86%99.cfg%E6%96%87%E4%BB%B6"><a id="pandas_16"></a>一、编写.cfg文件</h2> 
<p></p> 
<p><strong>1.在功能包文件夹下，创建一个config文件夹（其他名字也行，比如cfg）</strong></p> 
<p class="img-center"><img alt="" height="379" src="https://images2.imgbox.com/00/60/7r0IvF75_o.png" width="829"></p> 
<p>在其中创建一个后缀为.cfg的文件</p> 
<p class="img-center"><img alt="" height="451" src="https://images2.imgbox.com/0f/5c/Ay0qWSih_o.png" width="496"></p> 
<p><strong>2.在其中写入内容</strong></p> 
<pre><code class="language-python">#!/usr/bin/env python

from dynamic_reconfigure.parameter_generator_catkin import *

gen = ParameterGenerator()

type_enum = gen.enum([gen.const("centroid", str_t, "centroid", "Use Centroid"),
                      gen.const("initial",  str_t, "initial",  "Use Initial"),
                      gen.const("middle",   str_t, "middle",   "Use Middle")],
                      "An enum to set frontier type")
gen.add("timeout",           double_t, 0, "Explore Timeout(s)", 30.0, 10.0, 100.0)
gen.add("min_frontier_size", double_t, 0, "Min Frontier Size(m)",  0.75,  0.5,   2)
gen.add("visualize",         bool_t,   0, "Is Visualize?",   True)
gen.add("frontier_type",     str_t,    0, "Select Frontier Type",   "centroid", edit_method=type_enum)
gen.add("potential_scale",   double_t, 0, "Distance Weight", 3.0)
gen.add("gain_scale",        double_t, 0, "Gain Weight",     1.0)
gen.add("information_scale", double_t, 0, "Information Weight",     1.2)
gen.add("information_r",     double_t, 0, "Information Radius",     3.0)

exit(gen.generate("explore_server", "explore_server", "Explore"))</code></pre> 
<p>进行逐行解析：</p> 
<pre><code class="language-python">#!/usr/bin/env python

from dynamic_reconfigure.parameter_generator_catkin import *</code></pre> 
<p>说明这是一个python文件，使用/usr/bin/env下的python解析，并引入dynamic_reconfigure头文件</p> 
<pre><code class="language-python">gen = ParameterGenerator()</code></pre> 
<p>创建一个参数生成器，然后可以使用add函数添加动态配置的参数，add函数的参数如下：</p> 
<ul><li> <p style="margin-left:.25em;"><strong>name</strong> - 一个字符串，指定应存储此参数的名称</p> </li><li> <p style="margin-left:.25em;"><strong>paramtype</strong> - 定义存储值的类型，可以是 int_t、double_t、str_t 或 bool_t 中的任何一个</p> </li><li> <p style="margin-left:.25em;"><strong>level</strong> - 稍后将传递给动态重新配置回调的位掩码。当回调被调用时，所有已更改参数的级别值将被或运算在一起，并将结果值传递给回调。</p> </li><li> <p style="margin-left:.25em;"><strong>description</strong> - 描述参数的字符串</p> </li><li> <p style="margin-left:.25em;"><strong>default</strong> - 指定默认值</p> </li><li> <p style="margin-left:.25em;"><strong>min</strong> - 指定最小值（可选，不适用于字符串和布尔值）</p> </li><li> <p style="margin-left:.25em;"><strong>max</strong> - 指定最大值（可选，不适用于字符串和布尔值）</p> </li></ul> 
<p>例如：</p> 
<pre><code class="language-python">gen.add("timeout",           double_t, 0, "Explore Timeout(s)", 30.0, 10.0, 100.0)</code></pre> 
<p>我想动态设置程序超时时间（timeout），该变量为double类型，位掩码为0，描述是"Explore Timeout(s)"，默认值为30.0，最小值为：10.0，最大值为：100.0，这个配置在rqt_reconfigure中的显示如下：</p> 
<p class="img-center"><img alt="" height="41" src="https://images2.imgbox.com/d5/7a/DaiCPCPO_o.png" width="706"></p> 
<p> 布尔类型的值没有最大最小值，它在程序中的显示如下：</p> 
<p class="img-center"><img alt="" height="31" src="https://images2.imgbox.com/a2/a6/dmTUDsHy_o.png" width="153"></p> 
<pre><code class="language-python">type_enum = gen.enum([gen.const("centroid", str_t, "centroid", "Use Centroid"),
                      gen.const("initial",  str_t, "initial",  "Use Initial"),
                      gen.const("middle",   str_t, "middle",   "Use Middle")],
                      "An enum to set frontier type")</code></pre> 
<p>这里我们可以使用gen.num创建一个枚举类型的变量，让用户可以通过下拉列表选择值，gen.num中有两个参数，一个是gen.const组成的列表，gen.const参数结构和gen.add一样，第二个参数就是枚举类型的描述。</p> 
<pre><code class="language-python">gen.add("frontier_type",     str_t,    0, "Select Frontier Type",   "centroid", edit_method=type_enum)</code></pre> 
<p>然后可以通过edit_method=type_enum参数将枚举类型添加进去，最后的显示效果如下：</p> 
<p><img alt="" height="259" src="https://images2.imgbox.com/30/bf/SgYB7oR0_o.png" width="711"></p> 
<p>最后，使用gen.generate生成config文件，并使用exit退出</p> 
<pre><code class="language-python">exit(gen.generate("explore_server", "explore_server", "Explore"))</code></pre> 
<p> gen.generate第一个参数是config的“命名空间”（功能包名），第二个参数是可以在其中运行的节点的名称（仅用于生成文档），第三个参数是生成的文件将获得的名称前缀。</p> 
<p>具体来说，第一个参数是我们使用生成的Config文件的命名空间（功能包名）</p> 
<p class="img-center"><img alt="" height="65" src="https://images2.imgbox.com/6b/00/ruHcGwtb_o.png" width="735"></p> 
<p>第二个参数是运行时的节点名</p> 
<p class="img-center"><img alt="" height="286" src="https://images2.imgbox.com/67/c8/tdjJG1Yq_o.png" width="896"></p> 
<p>第三个参数是生成配置头文件的前缀，我们需要包含我们生成的配置头文件</p> 
<p class="img-center"><img alt="" height="140" src="https://images2.imgbox.com/11/24/n1Lo1OXH_o.png" width="412"></p> 
<p> Explore就是头文件的前缀，可以在devel/include/功能包名 看到这个生成的头文件（这和msgs生成类似）</p> 
<p class="img-center"><img alt="" height="354" src="https://images2.imgbox.com/7e/88/BsKDtPRH_o.png" width="494"></p> 
<p><strong>3.CmakeLists.txt和package.xml文件修改 </strong></p> 
<p>首先需要在find_package和catkin_package函数中添加dynamic_reconfigure包的依赖</p> 
<p><img alt="" height="768" src="https://images2.imgbox.com/ba/91/EtMFdE2p_o.png" width="765"></p> 
<p>然后在generate_dynamic_reconfigure_options函数中添加.cfg文件，这与生成.msg类似，config/是你定义的文件夹名</p> 
<p class="img-center"><img alt="" height="598" src="https://images2.imgbox.com/c4/1d/LGpEU5HS_o.png" width="680"></p> 
<p>最后需要在add_dependencies中添加依赖项${PROJECT_NAME}_gencfg</p> 
<p><img alt="" height="308" src="https://images2.imgbox.com/a2/f9/uj1wxD1e_o.png" width="887"> 在package.xml文件中添加dynamic_reconfigure的依赖</p> 
<p class="img-center"><img alt="" height="277" src="https://images2.imgbox.com/e1/17/wLgnvOEj_o.png" width="555"></p> 
<h2 id="%E4%BA%8C%E3%80%81%E4%B8%BA%E8%8A%82%E7%82%B9%E9%85%8D%E7%BD%AEdynamic_reconfigure"><a id="_19"></a>二、为节点配置dynamic_reconfigure</h2> 
<h3><a id="1_20"></a></h3> 
<p>配置好.cfg文件后，就可以在我们自己编写的节点中使用生成的配置文件了。</p> 
<p>首先引入头文件：</p> 
<p class="img-center"><img alt="" height="140" src="https://images2.imgbox.com/c4/8c/b2AbiotL_o.png" width="412"></p> 
<p>第一个是dynamic_reconfigure服务器的头文件，用于创建服务器，第二个是我们自己写的.cfg文件生成的头文件，用于使用我们定义的参数。</p> 
<pre><code class="language-cpp">  dynamic_reconfigure::Server&lt;ExploreConfig&gt; configServer;
  dynamic_reconfigure::Server&lt;ExploreConfig&gt;::CallbackType cb;</code></pre> 
<p>然后，我们可以创建两个变量，第一个是动态配置参数服务器，第二个是回调函数，也就是我们使用rqt_reconfigure调参时进入的函数，需要我们自己编写。</p> 
<pre><code class="language-cpp">void Explore_Server::configCb(ExploreConfig&amp; config, uint32_t level)
{
  ROS_INFO("Dynamic Config Start");
  timeout = config.timeout;
  min_frontier_size_ = config.min_frontier_size;
  visualize_ = config.visualize;
  frontier_type_ = config.frontier_type;
  potential_scale_ = config.potential_scale;
  gain_scale_ = config.gain_scale;
  information_scale_ = config.information_scale;
  information_r_ = config.information_r;
}</code></pre> 
<p>然后可以在程序中编写自己的回调函数，我这里进行了赋值操作，当然也可以进行其他操作，这里configCb之前的Explore_Server::是我程序中的命名空间，<span style="background-color:#ffd900;">非必需，大家根据自己程序编写。</span></p> 
<pre><code class="language-cpp">cb = boost::bind(&amp;Explore_Server::configCb, this, _1, _2);
configServer.setCallback(cb);</code></pre> 
<p>然后使用bind函数将回调函数绑定后赋值给cb变量，然后使用setCallback函数为服务器设置回调函数。</p> 
<p>当然，这些修改的参数要在其他类中的方法使用，还应该提供一个参数更新的接口：</p> 
<pre><code class="language-cpp">search_.configUpdate(min_frontier_size_, potential_scale_, gain_scale_, information_scale_, information_r_);</code></pre> 
<p> 最后，可以使用dynparam dump将调好的参数写到文件中：</p> 
<pre><code class="language-bash">rosrun dynamic_reconfigure dynparam dump /your_node dump.yaml</code></pre> 
<p>也可以使用dynparam load将参数文件再次加载：</p> 
<pre><code class="language-bash">rosrun dynamic_reconfigure dynparam load /node dump.yaml</code></pre> 
<p> </p> 
<hr> 
<h2 id="%E6%80%BB%E7%BB%93"><a id="_45"></a>总结</h2> 
<p>到此为止就实现了一个动态参数配置的节点和我们自定义个.cfg文件，在运行程序时，我们就可以使用rqt_configure工具，实时的动态调节程序的参数，帮助我们高效便捷的获得最优程序参数。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/8572074358ad03ac1d38b30b312fd693/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Yolov5 更改识别窗口大小</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/605188b5cc80f25b810a7c6e5ba4a373/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Edge出现无法访问此页面xxxxxx已拒绝连接。</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>