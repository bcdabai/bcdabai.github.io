<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Ubuntu UFW 防火墙配置 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Ubuntu UFW 防火墙配置" />
<meta property="og:description" content="Ubuntu 附带的 UFW（Uncomplicated Firewall）防火墙配置工具，用于管理 iptables 防火墙规则，用于监视和过滤传入和传出网络流量的工具，通过定义一组安全规则来确定是允许还是阻止特定流量。本文基于 Ubuntu 20.04 上配置和管理UFW。
文章目录 1.安装UFW2.检查UFW状态3.UFW默认策略4.应用配置文件5.启用 UFW6.打开 UFW端口7.拒绝连接8.删除UFW规则9.UFW操作10.IP伪装和转发 1.安装UFW Ubuntu 20.04默认安装有UFW，如果不存在，请执行
sudo apt update sudo apt install ufw 2.检查UFW状态 默认情况下禁用 UFW，使用以下命令检查 UFW 服务的状态：
sudo ufw status verbose 3.UFW默认策略 UFW 防火墙的默认行为是阻止所有传入和转发流量并允许所有出站流量。默认策略在 /etc/default/ufw 文件中定义，可以通过手动修改文件或使用以下命令来更改。
sudo ufw default &lt;policy&gt; &lt;chain&gt; 4.应用配置文件 应用程序配置文件是 INI 格式的文本文件，用于描述服务并包含服务的防火墙规则。应用程序配置文件是在 /etc/ufw/applications.d 安装包期间在目录中创建的。列出服务器上可用的所有应用程序配置文件：
sudo ufw app list 根据系统上安装的软件包，输出将类似于以下内容：
Available applications: Nginx Full Nginx HTTP Nginx HTTPS OpenSSH 要查找有关特定配置文件和包含的规则的更多信息，请使用以下命令：
sudo ufw app info &#39;Nginx Full&#39; 5." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/1f244df8b5933adbd71013f9bae72a73/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-05-15T14:26:38+08:00" />
<meta property="article:modified_time" content="2022-05-15T14:26:38+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Ubuntu UFW 防火墙配置</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <p>Ubuntu 附带的 UFW（Uncomplicated Firewall）防火墙配置工具，用于管理 iptables 防火墙规则，用于监视和过滤传入和传出网络流量的工具，通过定义一组安全规则来确定是允许还是阻止特定流量。本文基于 Ubuntu 20.04 上配置和管理UFW。</p> 
</blockquote> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#1UFW_3" rel="nofollow">1.安装UFW</a></li><li><a href="#2UFW_9" rel="nofollow">2.检查UFW状态</a></li><li><a href="#3UFW_15" rel="nofollow">3.UFW默认策略</a></li><li><a href="#4_20" rel="nofollow">4.应用配置文件</a></li><li><a href="#5_UFW_39" rel="nofollow">5.启用 UFW</a></li><li><a href="#6_UFW_57" rel="nofollow">6.打开 UFW端口</a></li><li><a href="#7_96" rel="nofollow">7.拒绝连接</a></li><li><a href="#8UFW_104" rel="nofollow">8.删除UFW规则</a></li><li><a href="#9UFW_130" rel="nofollow">9.UFW操作</a></li><li><a href="#10IP_139" rel="nofollow">10.IP伪装和转发</a></li></ul> 
</div> 
<p></p> 
<h2><a id="1UFW_3"></a>1.安装UFW</h2> 
<p>Ubuntu 20.04默认安装有UFW，如果不存在，请执行</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> update
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> ufw
</code></pre> 
<h2><a id="2UFW_9"></a>2.检查UFW状态</h2> 
<p>默认情况下禁用 UFW，使用以下命令检查 UFW 服务的状态：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> ufw status verbose
</code></pre> 
<h2><a id="3UFW_15"></a>3.UFW默认策略</h2> 
<p>UFW 防火墙的默认行为是阻止所有传入和转发流量并允许所有出站流量。默认策略在 <mark>/etc/default/ufw</mark> 文件中定义，可以通过手动修改文件或使用以下命令来更改。</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> ufw default <span class="token operator">&lt;</span>policy<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>chain<span class="token operator">&gt;</span>
</code></pre> 
<h2><a id="4_20"></a>4.应用配置文件</h2> 
<p>应用程序配置文件是 INI 格式的文本文件，用于描述服务并包含服务的防火墙规则。应用程序配置文件是在 <mark>/etc/ufw/applications.d</mark> 安装包期间在目录中创建的。列出服务器上可用的所有应用程序配置文件：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> ufw app list
</code></pre> 
<p>根据系统上安装的软件包，输出将类似于以下内容：</p> 
<pre><code class="prism language-bash">Available applications:
  Nginx Full
  Nginx HTTP
  Nginx HTTPS
  OpenSSH
</code></pre> 
<p>要查找有关特定配置文件和包含的规则的更多信息，请使用以下命令：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> ufw app info <span class="token string">'Nginx Full'</span>
</code></pre> 
<h2><a id="5_UFW_39"></a>5.启用 UFW</h2> 
<p>如果从远程位置连接到 Ubuntu，则在启用 UFW 防火墙之前，必须明确允许传入的 SSH 连接。否则，将无法再连接到机器。要将 UFW 防火墙配置为允许传入 SSH 连接，命令：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> ufw allow <span class="token function">ssh</span>
</code></pre> 
<p>如果 SSH 在非标准端口上运行 ，则需要打开该端口。例如，如果ssh 守护程序侦听 port 5800，请输入以下命令以允许该端口上的连接：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> ufw allow <span class="token number">7722</span>
</code></pre> 
<p>现在防火墙已配置为允许传入的 SSH 连接，可以通过键入以下内容启用它（<strong>确保ssh端口已设置为 allow</strong>），启用防火墙可能会中断现有的 ssh 连接，只需键入y并点击Enter：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> ufw <span class="token builtin class-name">enable</span>
Command may disrupt existing <span class="token function">ssh</span> connections. Proceed with operation <span class="token punctuation">(</span>y<span class="token operator">|</span>n<span class="token punctuation">)</span>? y
Firewall is active and enabled on system startup
</code></pre> 
<h2><a id="6_UFW_57"></a>6.打开 UFW端口</h2> 
<p>打开端口的一般语法如下</p> 
<pre><code class="prism language-bash">ufw allow port_number/protocol
</code></pre> 
<p><mark>其他说明：</mark><br> UFW 检查/etc/services文件中指定服务的端口和协议，指定端口号和协议，当没有给出协议时，UFW 为tcp和都创建规则udp；选择是使用应用程序配置文件，在这种情况下，“Nginx HTTP”；UFW 还支持使用proto关键字指定协议的另一种语法：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> ufw allow http
<span class="token function">sudo</span> ufw allow <span class="token number">80</span>/tcp
<span class="token function">sudo</span> ufw allow <span class="token string">'Nginx HTTP'</span>
<span class="token function">sudo</span> ufw allow proto tcp to any port <span class="token number">80</span>
</code></pre> 
<p>UFW 还允许打开端口范围。开始和结束端口由冒号 ( :)分隔，必须指定协议，或者tcp或udp。例如，如果想在和上都允许从7100到到的端口，可以运行以下命令：7200 tcp udp</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> ufw allow <span class="token number">7100</span>:7200/tcp
<span class="token function">sudo</span> ufw allow <span class="token number">7100</span>:7200/udp
</code></pre> 
<p>特定 IP 地址和端口，要允许来自给定源 IP 的所有端口上的连接，请使用from后跟源地址的关键字。以下是将 IP 地址列入白名单的示例：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> ufw allow from <span class="token number">200.200</span>.200.200
</code></pre> 
<p>只想允许给定的 IP 地址访问特定端口，请使用to any port关键字后跟端口号。例如，要允许22从 IP 地址为 的机器访问端口200.200.200.200，请输入：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> ufw allow from <span class="token number">200.200</span>.200.200 to any port <span class="token number">22</span>
</code></pre> 
<p>允许连接到 IP 地址子网的语法与使用单个 IP 地址时的语法相同。唯一的区别是需要指定网络掩码。下面是一个示例，展示了如何允许访问范围从192.168.1.1到192.168.1.254到端口3360( MySQL ) 的IP 地址：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> ufw allow from <span class="token number">192.168</span>.1.0/24 to any port <span class="token number">3306</span>
</code></pre> 
<p>要允许特定网络接口上的连接，请使用in on后跟网络接口名称的关键字：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> ufw allow <span class="token keyword">in</span> on eth2 to any port <span class="token number">3306</span>
</code></pre> 
<h2><a id="7_96"></a>7.拒绝连接</h2> 
<p>所有传入连接的默认策略设置为deny，如果没有更改它，UFW 将阻止所有传入连接，除非专门打开连接。编写拒绝规则与编写允许规则相同；只需要使用deny关键字而不是allow.<br> 假设打开了端口80和443，并且您的服务器受到23.24.25.0/24网络攻击。要拒绝来自23.24.25.0/24您的所有连接，或者80，443 端口的连接，请运行以下命令：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> ufw deny from <span class="token number">23.24</span>.25.0/24
<span class="token function">sudo</span> ufw deny proto tcp from <span class="token number">23.24</span>.25.0/24 to any port <span class="token number">80,443</span>
</code></pre> 
<h2><a id="8UFW_104"></a>8.删除UFW规则</h2> 
<p>有两种不同的方法可以通过规则编号和指定实际规则来删除 UFW 规则。<br> 按规则编号删除规则更容易，尤其是当不熟悉 UFW 时。要先按规则编号删除规则，需要找到要删除的规则编号。要获取编号规则列表，请使用以下<font color="red"> ufw status numbered</font> 命令：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> ufw status numbered

Status: active

     To                         Action      From
     --                         ------      ----
<span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">22</span>/tcp                     ALLOW IN    Anywhere
<span class="token punctuation">[</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token number">80</span>/tcp                     ALLOW IN    Anywhere
<span class="token punctuation">[</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token number">8180</span>/tcp                   ALLOW IN    Anywhere
</code></pre> 
<p>要删除规则编号3，即允许连接到端口的规则编号8180，可以输入：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> ufw delete <span class="token number">3</span>
</code></pre> 
<p>第二种方法是通过指定实际规则来删除规则。例如，如果您添加了打开端口的规则，则 8280 可以使用以下命令将其删除：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> ufw delete allow <span class="token number">8280</span>
</code></pre> 
<h2><a id="9UFW_130"></a>9.UFW操作</h2> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> ufw disable  //禁用
<span class="token function">sudo</span> ufw <span class="token builtin class-name">enable</span>  //启用
<span class="token function">sudo</span> ufw reload  //重载
<span class="token function">sudo</span> ufw reset  //重置
</code></pre> 
<h2><a id="10IP_139"></a>10.IP伪装和转发</h2> 
<p>IP 伪装是 Linux 内核中 NAT（网络地址转换）的一种变体，它通过重写源和目标 IP 地址和端口来转换网络流量。使用 IP 伪装，可以允许专用网络中的一台或多台机器使用一台充当网关的 Linux 机器与 Internet 通信。使用 UFW 配置 IP 伪装涉及几个步骤。<br> 首先，需要启用IP转发。为此，请打开 <font color="red">/etc/ufw/sysctl.conf </font> 文件,查找并取消注释以下行</p> 
<pre><code class="prism language-bash">net.ipv4.ip_forward <span class="token operator">=</span> <span class="token number">1</span> 
</code></pre> 
<p>接下来，需要配置 UFW 以允许转发数据包。打开 UFW 配置文件：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">vi</span> /etc/default/ufw
</code></pre> 
<p>找到 DEFAULT_FORWARD_POLICY 键，并将值从 更改 DROP 为 ACCEPT：</p> 
<pre><code class="prism language-bash"><span class="token assign-left variable">DEFAULT_FORWARD_POLICY</span><span class="token operator">=</span><span class="token string">"ACCEPT"</span>
</code></pre> 
<p>现在需要为表中的POSTROUTING链nat和伪装规则设置默认策略。请打开 /etc/ufw/before.rules 文件并附加以下几行，如下所示( <mark>不要忘了替换eth0的-A POSTROUTING行相匹配的公共网络接口的名称</mark> )：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">vi</span> /etc/ufw/before.rules

<span class="token comment">#NAT table rules</span>
*nat
:POSTROUTING ACCEPT <span class="token punctuation">[</span><span class="token number">0</span>:0<span class="token punctuation">]</span>

<span class="token comment"># Forward traffic through eth0 - Change to public network interface</span>
-A POSTROUTING -s <span class="token number">10.8</span>.0.0/16 -o eth0 -j MASQUERADE

<span class="token comment"># don't delete the 'COMMIT' line or these rules won't be processed</span>
COMMIT
</code></pre> 
<p>：</p> 
<p>完成后，保存并关闭文件。最后，通过禁用和重新启用 UFW 来重新加载 UFW 规则。</p> 
<p><a href="https://manpages.ubuntu.com/manpages/focal/man8/ufw.8.html" rel="nofollow">UFW手册</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b7d4012fa8a53afde2d65c6d57918f0b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">谈谈「数据仓库构建与分层」</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f78b3b46246640c2441cb2e3dbec1e02/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">安全认证框架Shiro之认证</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>