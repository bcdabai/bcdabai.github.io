<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>笔记-微信订阅号开发 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="笔记-微信订阅号开发" />
<meta property="og:description" content="目录 笔记-微信订阅号开发流程创建菜单网页授权：js-sdk 笔记-微信订阅号开发流程 创建菜单 先进入：https://mp.weixin.qq.com/
创建一个小程序订阅号： 订阅号和服务号的区别：
订阅号相当于一个群里面的一个用户，他发的消息需要打开订阅号助手里面才能查看，个人就能申请。
服务号相当于一个好友，可以“单独”发消息给你，但是需要企业认证才能申请 。
所以我们这里做的是订阅号开发
订阅号有可视化操作界面，怎么设置看微信文档就行了，我们这里讲一些程序员怎么用代码来写订阅号：
首先进入微信公众号文档的 开发 选项的 开发者工具 里面的 公众平台测试号，登录
首先 给测试号加一个菜单，先使用我们的appid 和 appsecret(密码) 获取 access_token；
获取到access_token后，就可以用access_token来创建我们的菜单了：
其中body填你的菜单,具体怎么创建可以查看微信公众号文档：
//这是我随便建的的菜单 { &#34;button&#34;: [ { &#34;type&#34;: &#34;view&#34;, &#34;name&#34;: &#34;小米商城系统&#34;, &#34;url&#34;: &#34;http://47.117.121.44:3000/dist/index.html#/&#34; }, { &#34;type&#34;: &#34;click&#34;, &#34;name&#34;: &#34;按钮&#34;, &#34;key&#34;: &#34;图书管理系统&#34; }, { &#34;name&#34;: &#34;大菜单&#34;, &#34;sub_button&#34;: [ { &#34;type&#34;: &#34;view&#34;, &#34;name&#34;: &#34;小米商城后台&#34;, &#34;url&#34;: &#34;http://47.117.121.44:3000/object_admin/index.html&#34; }, { &#34;type&#34;: &#34;click&#34;, &#34;name&#34;: &#34;图书管理系统&#34;, &#34;key&#34;: &#34;图书管理系统&#34; } ] } ] } 网页授权： 访问地址:(转二维码扫码。或者放到菜单中点击)" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/676fed4bfeaca4a63c71df8be82ad3f3/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-04-20T18:46:33+08:00" />
<meta property="article:modified_time" content="2021-04-20T18:46:33+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">笔记-微信订阅号开发</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#_2" rel="nofollow">笔记-微信订阅号开发流程</a></li><li><ul><li><a href="#_3" rel="nofollow">创建菜单</a></li><li><a href="#_54" rel="nofollow">网页授权：</a></li><li><a href="#jssdk_156" rel="nofollow">js-sdk</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="_2"></a>笔记-微信订阅号开发流程</h2> 
<h3><a id="_3"></a>创建菜单</h3> 
<p>先进入：<a href="https://mp.weixin.qq.com/" rel="nofollow">https://mp.weixin.qq.com/</a><br> 创建一个小程序订阅号： <br> 订阅号和服务号的区别：</p> 
<ul><li> <p>订阅号相当于一个群里面的一个用户，他发的消息需要打开订阅号助手里面才能查看，个人就能申请。</p> </li><li> <p>服务号相当于一个好友，可以“单独”发消息给你，但是需要企业认证才能申请 。</p> </li></ul> 
<p>所以我们这里做的是订阅号开发<br> 订阅号有可视化操作界面，怎么设置看微信文档就行了，我们这里讲一些程序员怎么用代码来写订阅号：<br> 首先进入微信公众号文档的 <strong>开发</strong> 选项的 <strong>开发者工具</strong> 里面的 <strong>公众平台测试号</strong>，登录</p> 
<p>首先 给测试号加一个菜单，先使用我们的appid 和 appsecret(密码) 获取 access_token；<br> <img src="https://images2.imgbox.com/63/7f/N7JZx6Lu_o.png" alt="在这里插入图片描述"></p> 
<p>获取到access_token后，就可以用access_token来创建我们的菜单了：<img src="https://images2.imgbox.com/9b/dc/w40XwR6j_o.png" alt="在这里插入图片描述"><br> 其中body填你的菜单,具体怎么创建可以查看微信公众号文档：</p> 
<pre><code class="prism language-javascript"><span class="token comment">//这是我随便建的的菜单</span>
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"button"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span>
      <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"view"</span><span class="token punctuation">,</span>
      <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"小米商城系统"</span><span class="token punctuation">,</span>
      <span class="token string">"url"</span><span class="token punctuation">:</span> <span class="token string">"http://47.117.121.44:3000/dist/index.html#/"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{<!-- --></span>
      <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"click"</span><span class="token punctuation">,</span>
      <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"按钮"</span><span class="token punctuation">,</span>
      <span class="token string">"key"</span><span class="token punctuation">:</span> <span class="token string">"图书管理系统"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{<!-- --></span>
      <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"大菜单"</span><span class="token punctuation">,</span>
      <span class="token string">"sub_button"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{<!-- --></span>
          <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"view"</span><span class="token punctuation">,</span>
          <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"小米商城后台"</span><span class="token punctuation">,</span>
          <span class="token string">"url"</span><span class="token punctuation">:</span> <span class="token string">"http://47.117.121.44:3000/object_admin/index.html"</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{<!-- --></span>
          <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"click"</span><span class="token punctuation">,</span>
          <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"图书管理系统"</span><span class="token punctuation">,</span>
          <span class="token string">"key"</span><span class="token punctuation">:</span> <span class="token string">"图书管理系统"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="_54"></a>网页授权：</h3> 
<p>访问地址:(转二维码扫码。或者放到菜单中点击)</p> 
<pre><code class="prism language-css">  <span class="token property">https</span><span class="token punctuation">:</span>//open.weixin.qq.com/connect/oauth2/authorize?appid=wx0c72fc5efe593f65&amp;redirect_uri=http%3A%2F%2F1.sswmouse.applinzi.com%2Fb.php&amp;response_type=code&amp;scope=snsapi_userinfo&amp;state=123&amp;connect_redirect=1#wechat_redirect
</code></pre> 
<p>配置b.php文件：<br> 前往文件查看<br> 配置域名：</p> 
<pre><code>  **https://mp.weixin.qq.com/debug/cgi-bin/sandboxinfo?action=showinfo&amp;t=sandbox/index** 下可以修改的地方配置域名
</code></pre> 
<p>获取微信普通access_token:</p> 
<pre><code>**https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&amp;appid=wx0c72fc5efe593f65&amp;secret=302fc9886039a87c37c25795476716d2**
</code></pre> 
<p>创建微信菜单</p> 
<pre><code>https://mp.weixin.qq.com/debug/cgi-bin/apiinfo?t=index&amp;type=%E8%87%AA%E5%AE%9A%E4%B9%89%E8%8F%9C%E5%8D%95&amp;form=%E8%87%AA%E5%AE%9A%E4%B9%89%E8%8F%9C%E5%8D%95%E5%88%9B%E5%BB%BA%E6%8E%A5%E5%8F%A3%20/menu/creat
</code></pre> 
<p>关于网页授权的两种scope（域）的区别：</p> 
<ul><li> <p>snsapi_base 用来获取进入页面的用户的openid 是静默授权</p> </li><li> <p>snsapi_userinfo 是用来获取用户的基本信息的 授权需要用户手动同意，并且由于用户同意过，所以无须关注，就可在授权后获取该用户的基本信息。</p> </li></ul> 
<p>网页授权access_token和普通access_token的区别：（二者有效期均为二个小时）</p> 
<ul><li> <p>在用户授权给公众号后，公众号可以获取到一个网页授权特有的接口调用凭证（网页授权access_token），通过网页授权access_token可以进行授权后接口调用，如获取用户基本信息；</p> </li><li> <p>其他微信接口，需要通过基础支持中的“获取access_token”接口来获取到的普通access_token调用。</p> </li></ul> 
<p>三种id的区别：</p> 
<ul><li>openid 用户关注公众号产生的 用户在不同公众号中的openid不一样</li><li>UnionID 如果开发者拥有多个移动应用、网站应用和公众帐号，可通过获取用户基本信息中的unionid来区分用户的唯一性，因为同一用户，对同一个微信开放平台下的不同应用（移动应用、网站应用和公众帐号），unionid是相同的。</li><li>appid 开发者发布的公众号id 每个公众号id不一样</li></ul> 
<p>用户授权步骤：</p> 
<p>1.用户同意授权，获取code（code有效期为五分钟，同时只能有一个有效，一个code只能使用一次）</p> 
<pre><code> https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx0c72fc5efe593f65&amp;redirect_uri=http%3A%2F%2F1.sswmouse.applinzi.com%2Fb.php&amp;response_type=code&amp;scope=snsapi_userinfo&amp;state=123&amp;connect_redirect=1#wechat_redirect
 appid //公众号id
 redirect_uri // 重定向 写你同意授权后跳转的界面 即 新浪云的b.php (地址需要url转码)
 response_type // 返回值类型 写 code 
 scope // 应用授权作用域，snsapi_base （不弹出授权页面，直接跳转，只能获取用户openid），snsapi_userinfo （弹出授权页面，可通过openid拿到昵称、性别、所在地。并且， 即使在未关注的情况下，只要用户授权，也能获取其信息 ） 
 state // 附带的参数 可以随便写 开发者可以填写a-zA-Z0-9的参数值，最多128字节
</code></pre> 
<p>2.通过code换取网页授权access_token</p> 
<pre><code>$code = $_GET["code"]; //获取code
$appid = 'wx0c72fc5efe593f65'; //填自己的appid 
$secret = '302fc9886039a87c37c25795476716d2'; //填自己的appid密码
//写一个 php版本的网络请求,这里叫curl请求
$url_str = "https://api.weixin.qq.com/sns/oauth2/access_token?appid=".$appid."&amp;secret=".$secret."&amp;code=".$code."&amp;grant_type=authorization_code";
$ch = curl_init(); 
curl_setopt($ch, CURLOPT_URL, $url_str);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
$output = curl_exec($ch); // 获取输出 包含网络版access_token
curl_close($ch); 
$res1 = json_decode($output , true); //将获取的信息进行json解析
</code></pre> 
<p>3.拉取用户信息(需scope为 snsapi_userinfo)</p> 
<pre><code>$access_token = $res1["access_token"]; //从上一步网络请求中获取 网络授权的access_token
$openid = $res1["openid"]; // 获取openid
// 通过 网络版 access_token ---&gt; 用户的信息
$url_str = "https://api.weixin.qq.com/sns/userinfo?access_token=".$access_token."&amp;openid=".$openid."&amp;lang=zh_CN";
$ch = curl_init();
curl_setopt($ch, CURLOPT_URL, $url_str);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
$output2 = curl_exec($ch); // 获取输出 即用户信息
curl_close($ch);
$res2 = json_decode($output2 , true); //将获取的信息进行json解析
</code></pre> 
<ol start="4"><li>展示结果<br> 将步骤2,3的配置放到b.php中 用 &lt;?php 内容 ?&gt;<br> 下面展示：<br> //放到 b.php 中</li></ol> 
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
  &lt;head&gt;
      &lt;meta charset="UTF-8"&gt;
      &lt;meta http-equiv="X-UA-Compatible" content="IE=edge"&gt;
      &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
      &lt;title&gt;Document&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
      &lt;h1&gt;姓名： &lt;?php echo($res2["nickname"]); ?&gt;&lt;/h1&gt;
      头像: &lt;img style="width: 100px;" src="&lt;?php echo($res2["headimgurl"]); ?&gt;" alt=""&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre> 
<p>5.配置域名：<br> 在微信测试账号管理界面下<br> 有一个为修改的按钮 点击修改域名<br> 6.测试：<br> 将步骤1配置的网络链接放到公众号的按钮上<br> 或者将其转变成二维码 扫码测试</p> 
<h3><a id="jssdk_156"></a>js-sdk</h3> 
<p>第一步 获取access_token 需要用到appid 和 appid的密码 （获取方法见文档或者上一次笔记）</p> 
<p>第二步 获取票据<br> https://api.weixin.qq.com/cgi-bin/ticket/getticket?access_token=ACCESS_TOKEN&amp;type=jsapi<br> //ACCESS_TOKEN 替换成自己的access_token</p> 
<p>第三步 配置域名<br> 去测试和界面 <strong>JS接口安全域名</strong> 配置<br> 第四步 编写js-sdk</p> 
<pre><code> &lt;?php 
//获取当前页面的url 
$protocol = (!empty($_SERVER['HTTPS']) &amp;&amp; $_SERVER['HTTPS'] !== 'off' || $_SERVER['SERVER_PORT'] == 443) ? "https://" : "http://";
$url = "$protocol$_SERVER[HTTP_HOST]$_SERVER[REQUEST_URI]";
//生成随机数,长度16位 
$nonce_str = "lkioj8uy675tgfr4";
//获取票据 
$jsapi_ticket = "LIKLckvwlJT9cWIhEQTwfB0awuSrbj0cp6gq3Ey43FWkzgNtpLoZ_Mbf_NuS5u9Q8bbm5pgKDSOVgg5ms22smg";
//获取时间戳 
$time = time();
//拼接singnature--签名
$row_string = "jsapi_ticket=$jsapi_ticket&amp;noncestr=$nonce_str&amp;timestamp=$time&amp;url=$url";
//singnature加密--签名
$singnature = sha1($row_string);
?&gt;
&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
  &lt;meta charset="UTF-8"&gt;
  &lt;meta http-equiv="X-UA-Compatible" content="IE=edge"&gt;
  &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
  &lt;title&gt;Document&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;/body&gt;
&lt;script src="http://res.wx.qq.com/open/js/jweixin-1.6.0.js"&gt;&lt;/script&gt;
&lt;script&gt;
	  wx.config({
    	debug: false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
      	appId: 'wx0c72fc5efe593f65', // 必填，公众号的唯一标识
      	timestamp: '&lt;?php echo $time; ?&gt;', // 必填，生成签名的时间戳
      	nonceStr: '&lt;?php echo $nonce_str; ?&gt;', // 必填，生成签名的随机串
      	signature: '&lt;?php echo $singnature; ?&gt;',// 必填，签名
      	jsApiList: [] // 必填，需要使用的JS接口列表
  	});
&lt;/script&gt;
&lt;/html&gt;
</code></pre> 
<p>仅代表个人笔记</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/91c0b730b8a242d4a78a8f2ed577c054/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Metaspace内存溢出排查思路、定位、工具与解决</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d81e1734968f04a73d15400fc28fe026/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">论文阅读笔记（8）: 图卷积半监督分类</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>