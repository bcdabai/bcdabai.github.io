<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Kubernetes(k8s)基础之五：yaml文件详解 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Kubernetes(k8s)基础之五：yaml文件详解" />
<meta property="og:description" content="k8s之yaml文件详解 文章目录 k8s之yaml文件详解1. k8s支持的文件格式2. YAML语言格式3. 查看api资源版本标签4. 编写nginx-test.yaml资源配置清单4.1 编写资源配置清单4.2 创建资源对象4.3 查看创建的pod资源 5. 创建service服务对外提供访问并测试5.1 编写nginx-svc-test.yaml5.2 创建资源对象5.3 查看创建的service5.4 访问测试 6. 详解k8s中的port7. 试运行生成yaml模板后创建实例7.1 --dry-run：试运行7.2 查看生成yaml格式7.3 查看生成json格式7.4 yaml和json的主要区别7.5 使用yaml格式导出生成模板7.6 删除一些不必要的参数7.7 使用yaml模板创建实例 8. 将现有资源生成yaml模板导出并保存为文件8.1 --expose：查看现有资源的yaml配置清单8.2 保存到文件中 9. explain：查看字段帮助信息10. 获取资源配置清单的总结 1. k8s支持的文件格式 Kubernetes支持YAML和JSON格式管理资源对象
JSON格式：主要用于api接口之间消息的传递
YAML格式：用于配置和管理，YAML是一种简洁的非标记性语言，内容格式人性化，较易读
2. YAML语言格式 ● 大小写敏感
● 使用缩进表示层级关系
● 不支持Tab键制表符缩进，只使用空格缩进
● 缩进的空格数目不重要，只要相同层级的元素左侧对齐即可，通常开头缩进两个空格
● 符号字符后缩进一个空格，如冒号，逗号，短横杠（-）等
● “—”表示YAML格式，一个文件的开始，用于分隔文件
● “#”表示注释
3. 查看api资源版本标签 kubectl api-versions
[root@master ~]# kubectl api-versions admissionregistration.k8s.io/v1beta1 apiextensions.k8s.io/v1beta1 apiregistration.k8s.io/v1 apiregistration.k8s.io/v1beta1 apps/v1 apps/v1beta1 apps/v1beta2 authentication." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/1c38ed21e03f1e47822b1271761a5ca5/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-10-19T21:32:45+08:00" />
<meta property="article:modified_time" content="2022-10-19T21:32:45+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Kubernetes(k8s)基础之五：yaml文件详解</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="k8syaml_0"></a>k8s之yaml文件详解</h2> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#k8syaml_0" rel="nofollow">k8s之yaml文件详解</a></li><li><ul><li><a href="#1_k8s_3" rel="nofollow">1. k8s支持的文件格式</a></li><li><a href="#2_YAML_9" rel="nofollow">2. YAML语言格式</a></li><li><a href="#3_api_19" rel="nofollow">3. 查看api资源版本标签</a></li><li><a href="#4_nginxtestyaml_64" rel="nofollow">4. 编写nginx-test.yaml资源配置清单</a></li><li><ul><li><a href="#41__66" rel="nofollow">4.1 编写资源配置清单</a></li><li><a href="#42__113" rel="nofollow">4.2 创建资源对象</a></li><li><a href="#43_pod_122" rel="nofollow">4.3 查看创建的pod资源</a></li></ul> 
   </li><li><a href="#5_service_134" rel="nofollow">5. 创建service服务对外提供访问并测试</a></li><li><ul><li><a href="#51_nginxsvctestyaml_136" rel="nofollow">5.1 编写nginx-svc-test.yaml</a></li><li><a href="#52__158" rel="nofollow">5.2 创建资源对象</a></li><li><a href="#53_service_167" rel="nofollow">5.3 查看创建的service</a></li><li><a href="#54__178" rel="nofollow">5.4 访问测试</a></li></ul> 
   </li><li><a href="#6_k8sport_243" rel="nofollow">6. 详解k8s中的port</a></li><li><a href="#7_yaml_255" rel="nofollow">7. 试运行生成yaml模板后创建实例</a></li><li><ul><li><a href="#71_dryrun_257" rel="nofollow">7.1 --dry-run：试运行</a></li><li><a href="#72_yaml_273" rel="nofollow">7.2 查看生成yaml格式</a></li><li><a href="#73_json_309" rel="nofollow">7.3 查看生成json格式</a></li><li><a href="#74_yamljson_362" rel="nofollow">7.4 yaml和json的主要区别</a></li><li><a href="#75_yaml_372" rel="nofollow">7.5 使用yaml格式导出生成模板</a></li><li><a href="#76__383" rel="nofollow">7.6 删除一些不必要的参数</a></li><li><a href="#77_yaml_421" rel="nofollow">7.7 使用yaml模板创建实例</a></li></ul> 
   </li><li><a href="#8_yaml_438" rel="nofollow">8. 将现有资源生成yaml模板导出并保存为文件</a></li><li><ul><li><a href="#81_exposeyaml_440" rel="nofollow">8.1 --expose：查看现有资源的yaml配置清单</a></li><li><a href="#82__496" rel="nofollow">8.2 保存到文件中</a></li></ul> 
   </li><li><a href="#9_explain_507" rel="nofollow">9. explain：查看字段帮助信息</a></li><li><a href="#10__568" rel="nofollow">10. 获取资源配置清单的总结</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="1_k8s_3"></a>1. k8s支持的文件格式</h3> 
<p>Kubernetes支持YAML和JSON格式管理资源对象<br> JSON格式：主要用于api接口之间消息的传递<br> YAML格式：用于配置和管理，YAML是一种简洁的非标记性语言，内容格式人性化，较易读</p> 
<h3><a id="2_YAML_9"></a>2. YAML语言格式</h3> 
<p>● 大小写敏感<br> ● 使用缩进表示层级关系<br> ● 不支持Tab键制表符缩进，只使用空格缩进<br> ● 缩进的空格数目不重要，只要相同层级的元素左侧对齐即可，通常开头缩进两个空格<br> ● 符号字符后缩进一个空格，如冒号，逗号，短横杠（-）等<br> ● “—”表示YAML格式，一个文件的开始，用于分隔文件<br> ● “#”表示注释</p> 
<h3><a id="3_api_19"></a>3. 查看api资源版本标签</h3> 
<p>kubectl api-versions</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl api-versions</span>
admissionregistration.k8s.io/v1beta1
apiextensions.k8s.io/v1beta1
apiregistration.k8s.io/v1
apiregistration.k8s.io/v1beta1
apps/v1
apps/v1beta1
apps/v1beta2
authentication.k8s.io/v1
authentication.k8s.io/v1beta1
authorization.k8s.io/v1
authorization.k8s.io/v1beta1
autoscaling/v1
autoscaling/v2beta1
autoscaling/v2beta2
batch/v1
batch/v1beta1
certificates.k8s.io/v1beta1
coordination.k8s.io/v1
coordination.k8s.io/v1beta1
events.k8s.io/v1beta1
extensions/v1beta1
networking.k8s.io/v1
networking.k8s.io/v1beta1
node.k8s.io/v1beta1
policy/v1beta1
rbac.authorization.k8s.io/v1
rbac.authorization.k8s.io/v1beta1
scheduling.k8s.io/v1
scheduling.k8s.io/v1beta1
storage.k8s.io/v1
storage.k8s.io/v1beta1
v1
</code></pre> 
<p><img src="https://images2.imgbox.com/46/f5/u0X16B5M_o.png" alt="img"><br> 如果是业务场景，一般首选使用apps/v1（apps/v1从v1.9版本开始提供API）。<br> 在k8s v1.16版本之前使用的是extensions/v1beta1，extensions/v1beta1从v1.20版本开始不再提供Ingress资源。<br> 带有beta字样的代表的是测试版本，不用在生产环境中。</p> 
<h3><a id="4_nginxtestyaml_64"></a>4. 编写nginx-test.yaml资源配置清单</h3> 
<h4><a id="41__66"></a>4.1 编写资源配置清单</h4> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># mkdir /opt/test</span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># cd !$</span>
<span class="token builtin class-name">cd</span> /opt/test
<span class="token punctuation">[</span>root@master test<span class="token punctuation">]</span><span class="token comment"># vim nginx-test.yaml</span>
 
<span class="token comment">#指定api版本标签</span>
apiVersion: apps/v1
<span class="token comment">#定义资源的类型/角色，deployment为副本控制器</span>
<span class="token comment">#此处资源类型可以是Deployment、Job、Ingress、Service等</span>
kind: Deployment
<span class="token comment">#定义资源的元数据信息，比如资源的名称、namespace、标签等信息</span>
metadata:
<span class="token comment">#定义资源的名称，在同一个namespace空间中必须是唯一的</span>
  name: nginx-test
  lables:
    app: nginx
<span class="token comment">#定义deployment资源需要的参数属性，诸如是否在容器失败时重新启动容器的属性</span>
spec:
<span class="token comment">#定义副本数量</span>
  replicas: <span class="token number">3</span>
<span class="token comment">#定义标签选择器</span>
  selector:
<span class="token comment">#定义匹配标签</span>
    matchLabels:
<span class="token comment">#需与后面的.spec.template.metadata.labels定义的标签保持一致</span>
      app: nginx
<span class="token comment">#定义业务模板，如果有多个副本，所有副本的属性会按照模板的相关配置进行匹配</span>
  template:
    metadata:
<span class="token comment">#定义Pod副本将使用的标签，需与前面的.spec.selector.matchLabels定义的标签保持一致</span>
      labels:
        app: nginx
    spec:
<span class="token comment">#定义容器属性</span>
      containers:
<span class="token comment">#定义一个容器名，一个-name:定义一个容器</span>
      - name: nginx
<span class="token comment">#定义容器使用的镜像以及版本</span>
        image: nginx:1.15.4
        ports:
<span class="token comment">#定义容器对外的端口</span>
        - containerPort: <span class="token number">80</span>
</code></pre> 
<h4><a id="42__113"></a>4.2 创建资源对象</h4> 
<p>kubectl create -f nginx-test.yaml</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@master test<span class="token punctuation">]</span><span class="token comment"># kubectl create -f nginx-test.yaml </span>
deployment.apps/nginx-test created
</code></pre> 
<h4><a id="43_pod_122"></a>4.3 查看创建的pod资源</h4> 
<p>kubectl get pods -o wide</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@master test<span class="token punctuation">]</span><span class="token comment"># kubectl get pods -o wide</span>
NAME                         READY   STATUS              RESTARTS   AGE   IP       NODE     NOMINATED NODE   READINESS GATES
nginx-test-9b644dcd5-fdvn6   <span class="token number">0</span>/1     ContainerCreating   <span class="token number">0</span>          4s    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>   node02   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
nginx-test-9b644dcd5-j6cv7   <span class="token number">0</span>/1     ContainerCreating   <span class="token number">0</span>          4s    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>   node01   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
nginx-test-9b644dcd5-pwrt2   <span class="token number">0</span>/1     ContainerCreating   <span class="token number">0</span>          4s    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>   node02   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
</code></pre> 
<h3><a id="5_service_134"></a>5. 创建service服务对外提供访问并测试</h3> 
<h4><a id="51_nginxsvctestyaml_136"></a>5.1 编写nginx-svc-test.yaml</h4> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@master test<span class="token punctuation">]</span><span class="token comment"># vim nginx-svc-test.yaml</span>
 
apiVersion: v1
kind: Service
metadata:
  name: nginx-svc
  labels:
    app: nginx
spec:
  type: NodePort
  ports:
  - port: <span class="token number">80</span>
    targetPort: <span class="token number">80</span>
  selector:
<span class="token comment">#此处定义的selector要与deployment所定义的selector相同</span>
<span class="token comment">#service依靠标签选择器来检索提供服务的nodes</span>
    app: nginx
</code></pre> 
<h4><a id="52__158"></a>5.2 创建资源对象</h4> 
<p>kubectl create -f nginx-svc-test.yaml</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@master test<span class="token punctuation">]</span><span class="token comment"># kubectl create -f nginx-svc-test.yaml</span>
service/nginx-svc created
</code></pre> 
<h4><a id="53_service_167"></a>5.3 查看创建的service</h4> 
<p>kubectl get svc</p> 
<pre><code>[root@master test]# kubectl get svc
NAME         TYPE        CLUSTER-IP    EXTERNAL-IP   PORT(S)        AGE
kubernetes   ClusterIP   10.1.0.1      &lt;none&gt;        443/TCP        28h
nginx-svc    NodePort    10.1.101.27   &lt;none&gt;        80:32421/TCP   5s
</code></pre> 
<h4><a id="54__178"></a>5.4 访问测试</h4> 
<p>在浏览器输入nodeIP:nodePort即可访问<br> curl 192.168.122.11:32421</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@master test<span class="token punctuation">]</span><span class="token comment"># curl 192.168.122.11:32421</span>
<span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>Welcome to nginx<span class="token operator">!</span><span class="token operator">&lt;</span>/title<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>style<span class="token operator">&gt;</span>
    body <span class="token punctuation">{<!-- --></span>
        width: 35em<span class="token punctuation">;</span>
        margin: <span class="token number">0</span> auto<span class="token punctuation">;</span>
        font-family: Tahoma, Verdana, Arial, sans-serif<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token operator">&lt;</span>/style<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>h<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>Welcome to nginx<span class="token operator">!</span><span class="token operator">&lt;</span>/h<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>
<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>If you see this page, the nginx web server is successfully installed and
working. Further configuration is required.<span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>
 
<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>For online documentation and support please refer to
<span class="token operator">&lt;</span>a <span class="token assign-left variable">href</span><span class="token operator">=</span><span class="token string">"http://nginx.org/"</span><span class="token operator">&gt;</span>nginx.org<span class="token operator">&lt;</span>/a<span class="token operator">&gt;</span>.<span class="token operator">&lt;</span>br/<span class="token operator">&gt;</span>
Commercial support is available at
<span class="token operator">&lt;</span>a <span class="token assign-left variable">href</span><span class="token operator">=</span><span class="token string">"http://nginx.com/"</span><span class="token operator">&gt;</span>nginx.com<span class="token operator">&lt;</span>/a<span class="token operator">&gt;</span>.<span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>
 
<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token operator">&lt;</span>em<span class="token operator">&gt;</span>Thank you <span class="token keyword">for</span> using nginx.<span class="token operator">&lt;</span>/em<span class="token operator">&gt;</span><span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/html<span class="token operator">&gt;</span>
</code></pre> 
<p>curl 192.168.122.12:32421</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@master test<span class="token punctuation">]</span><span class="token comment"># curl 192.168.122.12:32421</span>
<span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>Welcome to nginx<span class="token operator">!</span><span class="token operator">&lt;</span>/title<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>style<span class="token operator">&gt;</span>
    body <span class="token punctuation">{<!-- --></span>
        width: 35em<span class="token punctuation">;</span>
        margin: <span class="token number">0</span> auto<span class="token punctuation">;</span>
        font-family: Tahoma, Verdana, Arial, sans-serif<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token operator">&lt;</span>/style<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>h<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>Welcome to nginx<span class="token operator">!</span><span class="token operator">&lt;</span>/h<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>
<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>If you see this page, the nginx web server is successfully installed and
working. Further configuration is required.<span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>
 
<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>For online documentation and support please refer to
<span class="token operator">&lt;</span>a <span class="token assign-left variable">href</span><span class="token operator">=</span><span class="token string">"http://nginx.org/"</span><span class="token operator">&gt;</span>nginx.org<span class="token operator">&lt;</span>/a<span class="token operator">&gt;</span>.<span class="token operator">&lt;</span>br/<span class="token operator">&gt;</span>
Commercial support is available at
<span class="token operator">&lt;</span>a <span class="token assign-left variable">href</span><span class="token operator">=</span><span class="token string">"http://nginx.com/"</span><span class="token operator">&gt;</span>nginx.com<span class="token operator">&lt;</span>/a<span class="token operator">&gt;</span>.<span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>
 
<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token operator">&lt;</span>em<span class="token operator">&gt;</span>Thank you <span class="token keyword">for</span> using nginx.<span class="token operator">&lt;</span>/em<span class="token operator">&gt;</span><span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/html<span class="token operator">&gt;</span>
</code></pre> 
<h3><a id="6_k8sport_243"></a>6. 详解k8s中的port</h3> 
<p><img src="https://images2.imgbox.com/76/10/ZaWU2Xdg_o.png" alt="img"><br> ● port<br> port是k8s集群内部访问service的端口，即通过clusterIP:port可以从Pod所在的Node上访问到service<br> ● nodePort<br> nodePort是外部访问k8s集群中service的端口，通过nodeIP:nodePort可以从外部访问到某个service<br> ● targetPort<br> targetPort是Pod的端口，从port或nodePort来的流量经过kube-proxy反向代理负载均衡转发到后端Pod的targetPort上，最后进入容器。<br> ● containerPort<br> containerPort是Pod内部容器的端口，targetPort映射到containerPort。</p> 
<h3><a id="7_yaml_255"></a>7. 试运行生成yaml模板后创建实例</h3> 
<h4><a id="71_dryrun_257"></a>7.1 --dry-run：试运行</h4> 
<p>kubectl run --dry-run打印相应的API对象而不执行创建<br> kubectl run dryrun-test --image=nginx --port=80 --replicas=3 --dry-run</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@master test<span class="token punctuation">]</span><span class="token comment"># kubectl run dryrun-test --image=nginx --port=80 --replicas=3 --dry-run</span>
kubectl run --generator<span class="token operator">=</span>deployment/apps.v1 is DEPRECATED and will be removed <span class="token keyword">in</span> a future version. Use kubectl run --generator<span class="token operator">=</span>run-pod/v1 or kubectl create instead.
deployment.apps/dryrun-test created <span class="token punctuation">(</span>dry run<span class="token punctuation">)</span>
<span class="token punctuation">[</span>root@master test<span class="token punctuation">]</span><span class="token comment"># kubectl get pod,deploy</span>
 
No resources found.
</code></pre> 
<p>–dry-run表示试运行，不真正执行命令（测试命令是否正确），即并不会真的创建出pod和deployment实例，去掉该参数后即可真正执行命令。</p> 
<h4><a id="72_yaml_273"></a>7.2 查看生成yaml格式</h4> 
<p>使用–dry-run试运行可不触发生成命令，然后通过-o yaml可实现对其yaml资源配置清单的查看<br> kubectl run dryrun-test --image=nginx --port=80 --replicas=3 --dry-run -o yaml</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@master test<span class="token punctuation">]</span><span class="token comment"># kubectl run dryrun-test --image=nginx --port=80 --replicas=3 --dry-run -o yaml</span>
kubectl run --generator<span class="token operator">=</span>deployment/apps.v1 is DEPRECATED and will be removed <span class="token keyword">in</span> a future version. Use kubectl run --generator<span class="token operator">=</span>run-pod/v1 or kubectl create instead.
apiVersion: apps/v1
kind: Deployment
metadata:
  creationTimestamp: null
  labels:
    run: dryrun-test
  name: dryrun-test
spec:
  replicas: <span class="token number">3</span>
  selector:
    matchLabels:
      run: dryrun-test
  strategy: <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
  template:
    metadata:
      creationTimestamp: null
      labels:
        run: dryrun-test
    spec:
      containers:
      - image: nginx
        name: dryrun-test
        ports:
        - containerPort: <span class="token number">80</span>
        resources: <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
status: <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
</code></pre> 
<h4><a id="73_json_309"></a>7.3 查看生成json格式</h4> 
<p>同理，可通过-o json查看该命令产生的json配置清单<br> kubectl run dryrun-test --image=nginx --port=80 --replicas=3 --dry-run -o json</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@master test<span class="token punctuation">]</span><span class="token comment"># kubectl run dryrun-test --image=nginx --port=80 --replicas=3 --dry-run -o json</span>
kubectl run --generator<span class="token operator">=</span>deployment/apps.v1 is DEPRECATED and will be removed <span class="token keyword">in</span> a future version. Use kubectl run --generator<span class="token operator">=</span>run-pod/v1 or kubectl create instead.
<span class="token punctuation">{<!-- --></span>
    <span class="token string">"kind"</span><span class="token builtin class-name">:</span> <span class="token string">"Deployment"</span>,
    <span class="token string">"apiVersion"</span><span class="token builtin class-name">:</span> <span class="token string">"apps/v1"</span>,
    <span class="token string">"metadata"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"name"</span><span class="token builtin class-name">:</span> <span class="token string">"dryrun-test"</span>,
        <span class="token string">"creationTimestamp"</span><span class="token builtin class-name">:</span> null,
        <span class="token string">"labels"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"run"</span><span class="token builtin class-name">:</span> <span class="token string">"dryrun-test"</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>,
    <span class="token string">"spec"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"replicas"</span><span class="token builtin class-name">:</span> <span class="token number">3</span>,
        <span class="token string">"selector"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"matchLabels"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"run"</span><span class="token builtin class-name">:</span> <span class="token string">"dryrun-test"</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"template"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"metadata"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"creationTimestamp"</span><span class="token builtin class-name">:</span> null,
                <span class="token string">"labels"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"run"</span><span class="token builtin class-name">:</span> <span class="token string">"dryrun-test"</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>,
            <span class="token string">"spec"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"containers"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
                    <span class="token punctuation">{<!-- --></span>
                        <span class="token string">"name"</span><span class="token builtin class-name">:</span> <span class="token string">"dryrun-test"</span>,
                        <span class="token string">"image"</span><span class="token builtin class-name">:</span> <span class="token string">"nginx"</span>,
                        <span class="token string">"ports"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
                            <span class="token punctuation">{<!-- --></span>
                                <span class="token string">"containerPort"</span><span class="token builtin class-name">:</span> <span class="token number">80</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">]</span>,
                        <span class="token string">"resources"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"strategy"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>,
    <span class="token string">"status"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="74_yamljson_362"></a>7.4 yaml和json的主要区别</h4> 
<p>● YAML使用空格缩进，这是Python开发人员熟悉的领域。<br> ● JavaScript开发人员喜欢JSON，因为它是JavaScript的一个子集，可以直接在JavaScript中解释和编写，同时使用简写方式声明JSON，在使用没有空格的典型变量名时，不需要键中的双引号。<br> ● 有很多解析器在YAML和JSON的所有语言中都能很好地工作。<br> ● 在许多情况下，YAML的空白格式可以更容易查看，因为格式化需要更人性化的方法。<br> ● 如果您的编辑器中没有空格可见或缩进线指示符，那么YAML的空白虽然更紧凑，更容易查看，但可能难以手动编辑。<br> ● JSON的序列化和反序列化要快得多，因为要检查的功能明显少于YAML，这使得更小更轻的代码能够处理JSON。<br> ● 一个常见的误解是YAML需要较少的标点符号并且比JSON更紧凑，但这完全是错误的。空格是不可见的，所以看起来字符较少，但是如果你计算实际的空格是必要的，以便正确解释YAML以及正确的缩进，你会发现YAML实际上需要比JSON更多的字符。JSON不使用空格来表示层次结构或分组，并且可以通过删除不必要的空格来轻松展平，以实现更紧凑的传输。</p> 
<h4><a id="75_yaml_372"></a>7.5 使用yaml格式导出生成模板</h4> 
<p>kubectl run dryrun-test --image=nginx --port=80 --replicas=3 --dry-run -o yaml &gt; dryrun-test.yaml</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@master test<span class="token punctuation">]</span><span class="token comment"># kubectl run dryrun-test --image=nginx --port=80 --replicas=3 --dry-run -o yaml &gt; dryrun-test.yaml</span>
kubectl run --generator<span class="token operator">=</span>deployment/apps.v1 is DEPRECATED and will be removed <span class="token keyword">in</span> a future version. Use kubectl run --generator<span class="token operator">=</span>run-pod/v1 or kubectl create instead.
<span class="token punctuation">[</span>root@master test<span class="token punctuation">]</span><span class="token comment"># ls</span>
dryrun-test.yaml  nginx-svc-test.yaml  nginx-test.yaml
</code></pre> 
<h4><a id="76__383"></a>7.6 删除一些不必要的参数</h4> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@master test<span class="token punctuation">]</span><span class="token comment"># vim dryrun-test.yaml </span>
 
apiVersion: apps/v1
kind: Deployment
metadata:
<span class="token comment">#删除下行</span>
  creationTimestamp: null
  labels:
    run: dryrun-test
  name: dryrun-test
spec:
  replicas: <span class="token number">3</span>
  selector:
    matchLabels:
      run: dryrun-test
<span class="token comment">#删除下行</span>
  strategy: <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
  template:
    metadata:
<span class="token comment">#删除下行</span>
      creationTimestamp: null
      labels:
        run: dryrun-test
    spec:
      containers:
      - image: nginx
        name: dryrun-test
        ports:
        - containerPort: <span class="token number">80</span>
<span class="token comment">#删除下行</span>
        resources: <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
<span class="token comment">#删除下行</span>
status: <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
</code></pre> 
<h4><a id="77_yaml_421"></a>7.7 使用yaml模板创建实例</h4> 
<p>kubectl apply -f dryrun-test.yaml</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@master test<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f dryrun-test.yaml </span>
deployment.apps/dryrun-test created
<span class="token punctuation">[</span>root@master test<span class="token punctuation">]</span><span class="token comment"># kubectl get pod,deploy</span>
NAME                               READY   STATUS    RESTARTS   AGE
pod/dryrun-test-6c4ddc89bd-25lcm   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          39s
pod/dryrun-test-6c4ddc89bd-bbsnm   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          39s
pod/dryrun-test-6c4ddc89bd-rnmjk   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          39s
 
NAME                                READY   UP-TO-DATE   AVAILABLE   AGE
deployment.extensions/dryrun-test   <span class="token number">3</span>/3     <span class="token number">3</span>            <span class="token number">3</span>           39s
</code></pre> 
<h3><a id="8_yaml_438"></a>8. 将现有资源生成yaml模板导出并保存为文件</h3> 
<h4><a id="81_exposeyaml_440"></a>8.1 --expose：查看现有资源的yaml配置清单</h4> 
<p>kubectl get deploy dryrun-test --export -o yaml</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@master test<span class="token punctuation">]</span><span class="token comment"># kubectl get deploy dryrun-test --export -o yaml</span>
Flag --export has been deprecated, This flag is deprecated and will be removed <span class="token keyword">in</span> future.
apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  annotations:
    deployment.kubernetes.io/revision: <span class="token string">"1"</span>
    kubectl.kubernetes.io/last-applied-configuration: <span class="token operator">|</span>
      <span class="token punctuation">{<!-- --></span><span class="token string">"apiVersion"</span><span class="token builtin class-name">:</span><span class="token string">"apps/v1"</span>,<span class="token string">"kind"</span><span class="token builtin class-name">:</span><span class="token string">"Deployment"</span>,<span class="token string">"metadata"</span>:<span class="token punctuation">{<!-- --></span><span class="token string">"annotations"</span>:<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>,<span class="token string">"labels"</span>:<span class="token punctuation">{<!-- --></span><span class="token string">"run"</span><span class="token builtin class-name">:</span><span class="token string">"dryrun-test"</span><span class="token punctuation">}</span>,<span class="token string">"name"</span><span class="token builtin class-name">:</span><span class="token string">"dryrun-test"</span>,<span class="token string">"namespace"</span><span class="token builtin class-name">:</span><span class="token string">"default"</span><span class="token punctuation">}</span>,<span class="token string">"spec"</span>:<span class="token punctuation">{<!-- --></span><span class="token string">"replicas"</span>:3,<span class="token string">"selector"</span>:<span class="token punctuation">{<!-- --></span><span class="token string">"matchLabels"</span>:<span class="token punctuation">{<!-- --></span><span class="token string">"run"</span><span class="token builtin class-name">:</span><span class="token string">"dryrun-test"</span><span class="token punctuation">}</span><span class="token punctuation">}</span>,<span class="token string">"template"</span>:<span class="token punctuation">{<!-- --></span><span class="token string">"metadata"</span>:<span class="token punctuation">{<!-- --></span><span class="token string">"labels"</span>:<span class="token punctuation">{<!-- --></span><span class="token string">"run"</span><span class="token builtin class-name">:</span><span class="token string">"dryrun-test"</span><span class="token punctuation">}</span><span class="token punctuation">}</span>,<span class="token string">"spec"</span>:<span class="token punctuation">{<!-- --></span><span class="token string">"containers"</span>:<span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">"image"</span><span class="token builtin class-name">:</span><span class="token string">"nginx"</span>,<span class="token string">"name"</span><span class="token builtin class-name">:</span><span class="token string">"dryrun-test"</span>,<span class="token string">"ports"</span>:<span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">"containerPort"</span>:80<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
   creationTimestamp: null
  generation: <span class="token number">1</span>
  labels:
    run: dryrun-test
  name: dryrun-test
  selfLink: /apis/extensions/v1beta1/namespaces/default/deployments/dryrun-test
spec:
  progressDeadlineSeconds: <span class="token number">600</span>
  replicas: <span class="token number">3</span>
  revisionHistoryLimit: <span class="token number">10</span>
  selector:
    matchLabels:
      run: dryrun-test
  strategy:
    rollingUpdate:
      maxSurge: <span class="token number">25</span>%
      maxUnavailable: <span class="token number">25</span>%
    type: RollingUpdate
  template:
    metadata:
      creationTimestamp: null
      labels:
        run: dryrun-test
    spec:
      containers:
      - image: nginx
        imagePullPolicy: Always
        name: dryrun-test
        ports:
        - containerPort: <span class="token number">80</span>
          protocol: TCP
        resources: <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
        terminationMessagePath: /dev/termination-log
        terminationMessagePolicy: File
      dnsPolicy: ClusterFirst
      restartPolicy: Always
      schedulerName: default-scheduler
      securityContext: <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
      terminationGracePeriodSeconds: <span class="token number">30</span>
status: <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
</code></pre> 
<h4><a id="82__496"></a>8.2 保存到文件中</h4> 
<p>kubectl get deploy dryrun-test --export -o yaml &gt; export-test.yaml</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@master test<span class="token punctuation">]</span><span class="token comment"># kubectl get deploy dryrun-test --export -o yaml &gt; export-test.yaml</span>
Flag --export has been deprecated, This flag is deprecated and will be removed <span class="token keyword">in</span> future.
<span class="token punctuation">[</span>root@master test<span class="token punctuation">]</span><span class="token comment"># ls</span>
dryrun-test.yaml  export-test.yaml  nginx-svc-test.yaml  nginx-test.yaml
</code></pre> 
<h3><a id="9_explain_507"></a>9. explain：查看字段帮助信息</h3> 
<p>可一层层的查看相关资源对象的帮助信息<br> kubectl explain deployments.spec.template.spec.containers</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@master test<span class="token punctuation">]</span><span class="token comment"># kubectl explain deployments.spec.template.spec.containers</span>
KIND:     Deployment
VERSION:  extensions/v1beta1
 
RESOURCE: containers <span class="token operator">&lt;</span><span class="token punctuation">[</span><span class="token punctuation">]</span>Object<span class="token operator">&gt;</span>
 
DESCRIPTION:
     List of containers belonging to the pod. Containers cannot currently be
     added or removed. There must be at least one container <span class="token keyword">in</span> a Pod. Cannot be
     updated.
 
     A single application container that you want to run within a pod.
 
FIELDS:
   args	<span class="token operator">&lt;</span><span class="token punctuation">[</span><span class="token punctuation">]</span>string<span class="token operator">&gt;</span>
     Arguments to the entrypoint. The <span class="token function">docker</span> image<span class="token string">'s CMD is used if this is not
     provided. Variable references $(VAR_NAME) are expanded using the
     container'</span>s environment. If a variable cannot be resolved, the reference <span class="token keyword">in</span>
     the input string will be unchanged. The <span class="token variable"><span class="token variable">$(</span>VAR_NAME<span class="token variable">)</span></span> syntax can be escaped
     with a double <span class="token variable">$$</span>, ie: $<span class="token variable"><span class="token variable">$(</span>VAR_NAME<span class="token variable">)</span></span><span class="token builtin class-name">.</span> Escaped references will never be
     expanded, regardless of whether the variable exists or not. Cannot be
     updated. More info:
     https://kubernetes.io/docs/tasks/inject-data-application/define-command-argument-container/<span class="token comment">#running-a-command-in-a-shell</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
</code></pre> 
<p>kubectl explain pods.spec.containers</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@master test<span class="token punctuation">]</span><span class="token comment"># kubectl explain pods.spec.containers</span>
KIND:     Pod
VERSION:  v1
 
RESOURCE: containers <span class="token operator">&lt;</span><span class="token punctuation">[</span><span class="token punctuation">]</span>Object<span class="token operator">&gt;</span>
 
DESCRIPTION:
     List of containers belonging to the pod. Containers cannot currently be
     added or removed. There must be at least one container <span class="token keyword">in</span> a Pod. Cannot be
     updated.
 
     A single application container that you want to run within a pod.
 
FIELDS:
   args	<span class="token operator">&lt;</span><span class="token punctuation">[</span><span class="token punctuation">]</span>string<span class="token operator">&gt;</span>
     Arguments to the entrypoint. The <span class="token function">docker</span> image<span class="token string">'s CMD is used if this is not
     provided. Variable references $(VAR_NAME) are expanded using the
     container'</span>s environment. If a variable cannot be resolved, the reference <span class="token keyword">in</span>
     the input string will be unchanged. The <span class="token variable"><span class="token variable">$(</span>VAR_NAME<span class="token variable">)</span></span> syntax can be escaped
     with a double <span class="token variable">$$</span>, ie: $<span class="token variable"><span class="token variable">$(</span>VAR_NAME<span class="token variable">)</span></span><span class="token builtin class-name">.</span> Escaped references will never be
     expanded, regardless of whether the variable exists or not. Cannot be
     updated. More info:
     https://kubernetes.io/docs/tasks/inject-data-application/define-command-argument-container/<span class="token comment">#running-a-command-in-a-shell</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
</code></pre> 
<h3><a id="10__568"></a>10. 获取资源配置清单的总结</h3> 
<p>● 没有相关资源，使用run命令–dry-run选项<br> kubectl run dryrun-test --image=nginx --port=80 --replicas=3 --dry-run -o yaml &gt; dryrun-test.yaml<br> ● 已有相关资源，使用get命令–export选项<br> kubectl get deploy dryrun-test --export -o yaml &gt; export-test.yaml</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f08e70c385364c7d5ed9c1015c1210a3/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">RT-Thread学习笔记（二）之STM32</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/67f0d972bd6f3de2e8247d95ea6078be/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">路由器连接光猫用桥接模式好还是用路由模式好？路由器桥接模式vs路由模式</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>