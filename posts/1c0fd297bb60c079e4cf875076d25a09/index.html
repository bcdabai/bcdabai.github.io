<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>鸿蒙开发笔记(十):Stage模型开发中的UIAbility使用(类Activity) - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="鸿蒙开发笔记(十):Stage模型开发中的UIAbility使用(类Activity)" />
<meta property="og:description" content="应用模型是HarmonyOS为开发者提供的应用程序所需能力的抽象提炼，它提供了应用程序必备的组件和运行机制。有了应用模型，开发者可以基于一套统一的模型进行应用开发，使应用开发更简单、高效。
1. 概述 HarmonyOS应用模型的构成要素包括：
应用组件
应用组件是应用的基本组成单位，是应用的运行入口。用户启动、使用和退出应用过程中，应用组件会在不同的状态间切换，这些状态称为应用组件的生命周期。应用组件提供生命周期的回调函数，开发者通过应用组件的生命周期回调感知应用的状态变化。应用开发者在编写应用时，首先需要编写的就是应用组件，同时还需编写应用组件的生命周期回调函数，并在应用配置文件中配置相关信息。这样，操作系统在运行期间通过配置文件创建应用组件的实例，并调度它的生命周期回调函数，从而执行开发者的代码。
应用进程模型
应用进程模型定义应用进程的创建和销毁方式，以及进程间的通信方式。
应用线程模型
应用线程模型定义应用进程内线程的创建和销毁方式、主线程和UI线程的创建方式、线程间的通信方式。
应用任务管理模型
应用任务管理模型定义任务（Mission）的创建和销毁方式，以及任务与组件间的关系。HarmonyOS应用任务管理由系统应用负责，三方应用无需关注，下文不做具体介绍。
应用配置文件
应用配置文件中包含应用配置信息、应用组件信息、权限信息、开发者自定义信息等，这些信息在编译构建、分发和运行阶段分别提供给编译工具、应用市场和操作系统使用。
随着系统的演进发展，HarmonyOS先后提供了两种应用模型：
FA（Feature Ability）模型：HarmonyOS早期版本开始支持的模型，已经不再主推。
Stage模型：HarmonyOS 3.1 Developer Preview版本开始新增的模型，是目前主推且会长期演进的模型。在该模型中，由于提供了AbilityStage、WindowStage等类作为应用组件和Window窗口的“舞台”，因此称这种应用模型为Stage模型。
Stage模型之所以成为主推模型，源于其设计思想。Stage模型的设计基于如下出发点。
为复杂应用而设计
多个应用组件共享同一个ArkTS引擎（运行ArkTS语言的虚拟机）实例，应用组件之间可以方便的共享对象和状态，同时减少复杂应用运行对内存的占用。采用面向对象的开发方式，使得复杂应用代码可读性高、易维护性好、可扩展性强。 支持多设备和多窗口形态
应用组件管理和窗口管理在架构层面解耦：
便于系统对应用组件进行裁剪（无屏设备可裁剪窗口）。
便于系统扩展窗口形态。
在多设备（如桌面设备和移动设备）上，应用组件可使用同一套生命周期。
平衡应用能力和系统管控成本
Stage模型重新定义应用能力的边界，平衡应用能力和系统管控成本。
提供特定场景（如卡片、输入法）的应用组件，以便满足更多的使用场景。规范化后台进程管理：为保障用户体验，Stage模型对后台应用进程进行了有序治理，应用程序不能随意驻留在后台，同时应用后台行为受到严格管理，防止恶意应用行为。 Stage模型与FA模型最大的区别在于：Stage模型中，多个应用组件共享同一个ArkTS引擎实例；而FA模型中，每个应用组件独享一个ArkTS引擎实例。因此在Stage模型中，应用组件之间可以方便的共享对象和状态，同时减少复杂应用运行对内存的占用。Stage模型作为主推的应用模型，开发者通过它能够更加便利地开发出分布式场景下的复杂应用。
2. Stage模型开发概述 Stage模型概念图
UIAbility组件和ExtensionAbility组件
Stage模型提供UIAbility和ExtensionAbility两种类型的组件，这两种组件都有具体的类承载，支持面向对象的开发方式。
UIAbility组件是一种包含UI界面的应用组件，主要用于和用户交互。例如，图库类应用可以在UIAbility组件中展示图片瀑布流，在用户选择某个图片后，在新的页面中展示图片的详细内容。同时用户可以通过返回键返回到瀑布流页面。UIAbility的生命周期只包含创建/销毁/前台/后台等状态，与显示相关的状态通过WindowStage的事件暴露给开发者。
ExtensionAbility组件是一种面向特定场景的应用组件。
WindowStage
每个UIAbility类实例都会与一个WindowStage类实例绑定，该类提供了应用进程内窗口管理器的作用。它包含一个主窗口。也就是说UIAbility通过WindowStage持有了一个窗口，该窗口为ArkUI提供了绘制区域。
Context
在Stage模型上，Context及其派生类向开发者提供在运行期可以调用的各种能力。UIAbility组件和各种ExtensionAbility派生类都有各自不同的Context类，他们都继承自基类Context，但是各自又根据所属组件，提供不同的能力。
AbilityStage
每个Entry类型或者Feature类型的HAP在运行期都有一个AbilityStage类实例，当HAP中的代码首次被加载到进程中的时候，系统会先创建AbilityStage实例。每个在该HAP中定义的UIAbility类，在实例化后都会与该实例产生关联。开发者可以使用AbilityStage获取该HAP中UIAbility实例的运行时信息。
基于Stage模型开发应用时，在应用模型部分，涉及如下开发过程。
3. 应用/组件级配置 在开发应用时，需要配置应用的一些标签，例如应用的包名、图标等标识特征的属性。图标和标签通常一起配置，可以分为应用图标、应用标签和入口图标、入口标签，分别对应app.json5配置文件和module.json5配置文件文件中的icon和label标签。应用图标和标签是在设置应用中使用，例如设置应用中的应用列表。入口图标是应用安装完成后在设备桌面上显示出来的，入口图标是以UIAbility为粒度，支持同一个应用存在多个入口图标和标签，点击后进入对应的UIAbility界面。
AppScope目录下的app.json5配置文件
应用包名配置
应用需要在工程的AppScope目录下的app.json5配置文件中配置bundleName标签，该标签用于标识应用的唯一性。推荐采用反域名形式命名（如com.example.demo，建议第一级为域名后缀com，第二级为厂商/个人名，第三级为应用名，也可以多级）。
应用图标和标签配置
应用图标需要在工程的AppScope目录下的app.json5配置文件中配置icon标签。应用图标需配置为图片的资源索引，配置完成后，该图片即为应用的图标。
应用标签需要在工程的AppScope模块下的app.json5配置文件中配置label标签。标识应用对用户显示的名称，需要配置为字符串资源的索引。
入口图标和标签配置
入口图标需要在module.json5配置文件中配置，在abilities标签下面有icon标签。例如希望在桌面上显示该UIAbility的图标，则需要在skills标签下面的entities中添加&#34;entity.system.home&#34;、actions中添加&#34;action.system.home&#34;。同一个应用有多个UIAbility配置上述字段时，桌面上会显示出多个图标，分别对应各自的UIAbility。
应用版本声明配置
应用版本声明需要在工程的AppScope目录下的app.json5配置文件中配置versionCode标签和versionName标签。versionCode用于标识应用的版本号，该标签值为32位非负整数。此数字仅用于确定某个版本是否比另一个版本更新，数值越大表示版本越高。versionName标签标识版本号的文字描述。
Module支持的设备类型配置
Module支持的设备类型需要在module.json5配置文件中配置deviceTypes标签，如果deviceTypes标签中添加了某种设备，则表明当前的Module支持在该设备上运行。
Module权限配置
Module访问系统或其他应用受保护部分所需的权限信息需要在module.json5配置文件中配置requestPermission标签。该标签用于声明需要申请权限的名称、申请权限的原因以及权限使用的场景。
4. UIAbility组件 – Activity 4.1 概述 UIAbility组件是一种包含UI界面的应用组件，主要用于和用户交互。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/1c0fd297bb60c079e4cf875076d25a09/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-17T15:03:06+08:00" />
<meta property="article:modified_time" content="2024-01-17T15:03:06+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">鸿蒙开发笔记(十):Stage模型开发中的UIAbility使用(类Activity)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>应用模型是HarmonyOS为开发者提供的应用程序所需能力的抽象提炼，它提供了应用程序必备的组件和运行机制。有了应用模型，开发者可以基于一套统一的模型进行应用开发，使应用开发更简单、高效。</p> 
<h2><a id="1__2"></a>1. 概述</h2> 
<p>HarmonyOS应用模型的构成要素包括：</p> 
<ol><li> <p><strong>应用组件</strong></p> <p>应用组件是应用的基本组成单位，是应用的运行入口。用户启动、使用和退出应用过程中，应用组件会在不同的状态间切换，这些状态称为应用组件的生命周期。应用组件提供生命周期的回调函数，开发者通过应用组件的生命周期回调感知应用的状态变化。应用开发者在编写应用时，首先需要编写的就是应用组件，同时还需编写应用组件的生命周期回调函数，并在应用配置文件中配置相关信息。这样，操作系统在运行期间通过配置文件创建应用组件的实例，并调度它的生命周期回调函数，从而执行开发者的代码。</p> </li><li> <p><strong>应用进程模型</strong></p> <p>应用进程模型定义应用进程的创建和销毁方式，以及进程间的通信方式。</p> </li><li> <p><strong>应用线程模型</strong></p> <p>应用线程模型定义应用进程内线程的创建和销毁方式、主线程和UI线程的创建方式、线程间的通信方式。</p> </li><li> <p><strong>应用任务管理模型</strong></p> <p>应用任务管理模型定义任务（Mission）的创建和销毁方式，以及任务与组件间的关系。HarmonyOS应用任务管理由系统应用负责，三方应用无需关注，下文不做具体介绍。</p> </li><li> <p><strong>应用配置文件</strong></p> <p>应用配置文件中包含应用配置信息、应用组件信息、权限信息、开发者自定义信息等，这些信息在编译构建、分发和运行阶段分别提供给编译工具、应用市场和操作系统使用。</p> </li></ol> 
<p>随着系统的演进发展，HarmonyOS先后提供了两种应用模型：</p> 
<ul><li> <p>FA（Feature Ability）模型：HarmonyOS早期版本开始支持的模型，已经不再主推。</p> </li><li> <p><strong>Stage模型</strong>：HarmonyOS 3.1 Developer Preview版本开始新增的模型，是目前主推且会长期演进的模型。在该模型中，由于提供了AbilityStage、WindowStage等类作为应用组件和Window窗口的“舞台”，因此称这种应用模型为Stage模型。</p> </li></ul> 
<p>Stage模型之所以成为主推模型，源于其设计思想。Stage模型的设计基于如下出发点。</p> 
<ol><li> <p>为复杂应用而设计</p> 
  <ul><li>多个应用组件共享同一个ArkTS引擎（运行ArkTS语言的虚拟机）实例，应用组件之间可以方便的共享对象和状态，同时减少复杂应用运行对内存的占用。</li><li>采用面向对象的开发方式，使得复杂应用代码可读性高、易维护性好、可扩展性强。</li></ul> </li><li> <p>支持多设备和多窗口形态</p> <p>应用组件管理和窗口管理在架构层面解耦：</p> 
  <ul><li> <p>便于系统对应用组件进行裁剪（无屏设备可裁剪窗口）。</p> </li><li> <p>便于系统扩展窗口形态。</p> </li><li> <p>在多设备（如桌面设备和移动设备）上，应用组件可使用同一套生命周期。</p> </li></ul> </li><li> <p>平衡应用能力和系统管控成本</p> <p>Stage模型重新定义应用能力的边界，平衡应用能力和系统管控成本。</p> 
  <ul><li>提供特定场景（如卡片、输入法）的应用组件，以便满足更多的使用场景。</li><li>规范化后台进程管理：为保障用户体验，Stage模型对后台应用进程进行了有序治理，应用程序不能随意驻留在后台，同时应用后台行为受到严格管理，防止恶意应用行为。</li></ul> </li></ol> 
<p>Stage模型与FA模型最大的区别在于：Stage模型中，多个应用组件共享同一个ArkTS引擎实例；而FA模型中，每个应用组件独享一个ArkTS引擎实例。因此在Stage模型中，应用组件之间可以方便的共享对象和状态，同时减少复杂应用运行对内存的占用。Stage模型作为主推的应用模型，开发者通过它能够更加便利地开发出分布式场景下的复杂应用。</p> 
<p><img src="https://images2.imgbox.com/58/16/jsLMKqQx_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="2_Stage_59"></a>2. Stage模型开发概述</h2> 
<p>Stage模型概念图</p> 
<p><img src="https://images2.imgbox.com/68/dd/PItqAIzT_o.png" alt="在这里插入图片描述"></p> 
<ul><li> <p>UIAbility组件和ExtensionAbility组件</p> <p>Stage模型提供UIAbility和ExtensionAbility两种类型的组件，这两种组件都有具体的类承载，支持面向对象的开发方式。</p> 
  <ol><li> <p>UIAbility组件是一种包含UI界面的应用组件，主要用于和用户交互。例如，图库类应用可以在UIAbility组件中展示图片瀑布流，在用户选择某个图片后，在新的页面中展示图片的详细内容。同时用户可以通过返回键返回到瀑布流页面。UIAbility的生命周期只包含创建/销毁/前台/后台等状态，与显示相关的状态通过WindowStage的事件暴露给开发者。</p> </li><li> <p>ExtensionAbility组件是一种面向特定场景的应用组件。</p> </li></ol> </li><li> <p>WindowStage</p> <p>每个UIAbility类实例都会与一个WindowStage类实例绑定，该类提供了应用进程内窗口管理器的作用。它包含一个主窗口。也就是说UIAbility通过WindowStage持有了一个窗口，该窗口为ArkUI提供了绘制区域。</p> </li><li> <p>Context</p> <p>在Stage模型上，Context及其派生类向开发者提供在运行期可以调用的各种能力。UIAbility组件和各种ExtensionAbility派生类都有各自不同的Context类，他们都继承自基类Context，但是各自又根据所属组件，提供不同的能力。</p> </li><li> <p>AbilityStage</p> <p>每个Entry类型或者Feature类型的HAP在运行期都有一个AbilityStage类实例，当HAP中的代码首次被加载到进程中的时候，系统会先创建AbilityStage实例。每个在该HAP中定义的UIAbility类，在实例化后都会与该实例产生关联。开发者可以使用AbilityStage获取该HAP中UIAbility实例的运行时信息。</p> </li></ul> 
<p>基于Stage模型开发应用时，在应用模型部分，涉及如下开发过程。<br> <img src="https://images2.imgbox.com/36/89/cJhlMVSA_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="3__88"></a>3. 应用/组件级配置</h2> 
<p>在开发应用时，需要配置应用的一些标签，例如应用的包名、图标等标识特征的属性。图标和标签通常一起配置，可以分为应用图标、应用标签和入口图标、入口标签，分别对应app.json5配置文件和module.json5配置文件文件中的icon和label标签。应用图标和标签是在设置应用中使用，例如设置应用中的应用列表。入口图标是应用安装完成后在设备桌面上显示出来的，入口图标是以UIAbility为粒度，支持同一个应用存在多个入口图标和标签，点击后进入对应的UIAbility界面。<br> <img src="https://images2.imgbox.com/25/1d/3W1zYxiH_o.png" alt="在这里插入图片描述"></p> 
<p><strong>AppScope目录下的app.json5配置文件</strong></p> 
<p><img src="https://images2.imgbox.com/93/6a/p5aOsHUQ_o.png" alt="在这里插入图片描述"></p> 
<ul><li> <p>应用包名配置</p> <p>应用需要在工程的AppScope目录下的app.json5配置文件中配置bundleName标签，该标签用于标识应用的唯一性。推荐采用反域名形式命名（如com.example.demo，建议第一级为域名后缀com，第二级为厂商/个人名，第三级为应用名，也可以多级）。</p> </li><li> <p>应用图标和标签配置</p> <p>应用图标需要在工程的AppScope目录下的app.json5配置文件中配置icon标签。应用图标需配置为图片的资源索引，配置完成后，该图片即为应用的图标。</p> <p>应用标签需要在工程的AppScope模块下的app.json5配置文件中配置label标签。标识应用对用户显示的名称，需要配置为字符串资源的索引。</p> </li><li> <p>入口图标和标签配置</p> <p>入口图标需要在module.json5配置文件中配置，在abilities标签下面有icon标签。例如希望在桌面上显示该UIAbility的图标，则需要在skills标签下面的entities中添加"entity.system.home"、actions中添加"action.system.home"。同一个应用有多个UIAbility配置上述字段时，桌面上会显示出多个图标，分别对应各自的UIAbility。</p> <p><img src="https://images2.imgbox.com/92/d5/LC0hLaAh_o.png" alt="在这里插入图片描述"></p> </li><li> <p>应用版本声明配置</p> <p>应用版本声明需要在工程的AppScope目录下的app.json5配置文件中配置versionCode标签和versionName标签。versionCode用于标识应用的版本号，该标签值为32位非负整数。此数字仅用于确定某个版本是否比另一个版本更新，数值越大表示版本越高。versionName标签标识版本号的文字描述。</p> </li><li> <p>Module支持的设备类型配置<br> Module支持的设备类型需要在module.json5配置文件中配置deviceTypes标签，如果deviceTypes标签中添加了某种设备，则表明当前的Module支持在该设备上运行。</p> </li></ul> 
<p><img src="https://images2.imgbox.com/79/e7/vVuYVjK8_o.png" alt="在这里插入图片描述"></p> 
<ul><li> <p>Module权限配置</p> <p>Module访问系统或其他应用受保护部分所需的权限信息需要在module.json5配置文件中配置requestPermission标签。该标签用于声明需要申请权限的名称、申请权限的原因以及权限使用的场景。</p> <p><img src="https://images2.imgbox.com/7a/f7/6bzC5jRF_o.png" alt="在这里插入图片描述"></p> </li></ul> 
<h2><a id="4_UIAbility__Activity_129"></a>4. UIAbility组件 – Activity</h2> 
<h3><a id="41__130"></a>4.1 概述</h3> 
<p>UIAbility组件是一种包含UI界面的应用组件，主要用于和用户交互。</p> 
<p>UIAbility组件是系统调度的基本单元，为应用提供绘制界面的窗口；一个UIAbility组件中可以通过多个页面来实现一个功能模块。每一个UIAbility组件实例，都对应于一个最近任务列表中的任务。</p> 
<p>为使应用能够正常使用UIAbility，需要在module.json5配置文件的abilities标签中声明UIAbility的名称、入口、标签等相关信息。</p> 
<pre><code class="prism language-javascript"><span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"module"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ...</span>
    <span class="token string-property property">"abilities"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">"name"</span><span class="token operator">:</span> <span class="token string">"EntryAbility"</span><span class="token punctuation">,</span> <span class="token comment">// UIAbility组件的名称</span>
        <span class="token string-property property">"srcEntrance"</span><span class="token operator">:</span> <span class="token string">"./ets/entryability/EntryAbility.ts"</span><span class="token punctuation">,</span> <span class="token comment">// UIAbility组件的代码路径</span>
        <span class="token string-property property">"description"</span><span class="token operator">:</span> <span class="token string">"$string:EntryAbility_desc"</span><span class="token punctuation">,</span> <span class="token comment">// UIAbility组件的描述信息</span>
        <span class="token string-property property">"icon"</span><span class="token operator">:</span> <span class="token string">"$media:icon"</span><span class="token punctuation">,</span> <span class="token comment">// UIAbility组件的图标</span>
        <span class="token string-property property">"label"</span><span class="token operator">:</span> <span class="token string">"$string:EntryAbility_label"</span><span class="token punctuation">,</span> <span class="token comment">// UIAbility组件的标签</span>
        <span class="token string-property property">"startWindowIcon"</span><span class="token operator">:</span> <span class="token string">"$media:icon"</span><span class="token punctuation">,</span> <span class="token comment">// UIAbility组件启动页面图标资源文件的索引</span>
        <span class="token string-property property">"startWindowBackground"</span><span class="token operator">:</span> <span class="token string">"$color:start_window_background"</span><span class="token punctuation">,</span> <span class="token comment">// UIAbility组件启动页面背景颜色资源文件的索引</span>
        <span class="token comment">// ...</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="42_UIAbility_157"></a>4.2 UIAbility组件生命周期</h3> 
<p>当用户打开、切换和返回到对应应用时，应用中的UIAbility实例会在其生命周期的不同状态之间转换。UIAbility类提供了一系列回调，通过这些回调可以知道当前UIAbility实例的某个状态发生改变，会经过UIAbility实例的创建和销毁，或者UIAbility实例发生了前后台的状态切换。</p> 
<p>UIAbility的生命周期包括Create、Foreground、Background、Destroy四个状态，如下图所示。</p> 
<p><img src="https://images2.imgbox.com/3a/74/lxd7N1uA_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="1_Create_163"></a>1. Create状态</h4> 
<p>Create状态为在应用加载过程中，UIAbility实例创建完成时触发，系统会调用onCreate()回调。可以在该回调中进行应用初始化操作，例如变量定义资源加载等，用于后续的UI界面展示。</p> 
<pre><code class="prism language-javascript"><span class="token keyword">import</span> UIAbility <span class="token keyword">from</span> <span class="token string">'@ohos.app.ability.UIAbility'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Window <span class="token keyword">from</span> <span class="token string">'@ohos.window'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">EntryAbility</span> <span class="token keyword">extends</span> <span class="token class-name">UIAbility</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token parameter">want<span class="token punctuation">,</span> launchParam</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 应用初始化</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="2_WindowStageCreateWindowStageDestroy_177"></a>2. WindowStageCreate和WindowStageDestroy状态</h4> 
<p>UIAbility实例创建完成之后，在进入Foreground之前，系统会创建一个WindowStage。WindowStage创建完成后会进入onWindowStageCreate()回调，可以在该回调中设置UI界面加载、设置WindowStage的事件订阅。</p> 
<p><img src="https://images2.imgbox.com/8e/6d/2W7JHdyP_o.png" alt="在这里插入图片描述"></p> 
<p>在onWindowStageCreate()回调中通过loadContent()方法设置应用要加载的页面并根据需要订阅WindowStage的事件（获焦/失焦、可见/不可见）。</p> 
<pre><code class="prism language-javascript"><span class="token keyword">import</span> UIAbility <span class="token keyword">from</span> <span class="token string">'@ohos.app.ability.UIAbility'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Window <span class="token keyword">from</span> <span class="token string">'@ohos.window'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">EntryAbility</span> <span class="token keyword">extends</span> <span class="token class-name">UIAbility</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">onWindowStageCreate</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">windowStage</span><span class="token operator">:</span> Window<span class="token punctuation">.</span>WindowStage</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 设置WindowStage的事件订阅（获焦/失焦、可见/不可见）</span>

        <span class="token comment">// 设置UI界面加载</span>
        windowStage<span class="token punctuation">.</span><span class="token function">loadContent</span><span class="token punctuation">(</span><span class="token string">'pages/Index'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// ...</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>对应于onWindowStageCreate()回调。在UIAbility实例销毁之前，则会先进入onWindowStageDestroy()回调，可以在该回调中释放UI界面资源。例如在onWindowStageDestroy()中注销获焦/失焦等WindowStage事件。</p> 
<pre><code class="prism language-javascript"><span class="token keyword">import</span> UIAbility <span class="token keyword">from</span> <span class="token string">'@ohos.app.ability.UIAbility'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Window <span class="token keyword">from</span> <span class="token string">'@ohos.window'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">EntryAbility</span> <span class="token keyword">extends</span> <span class="token class-name">UIAbility</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ...</span>

    <span class="token function">onWindowStageDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 释放UI界面资源</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="3_ForegroundBackground_213"></a>3. Foreground和Background状态</h4> 
<p>Foreground和Background状态分别在UIAbility实例切换至前台和切换至后台时触发，对应于onForeground()回调和onBackground()回调。</p> 
<p>onForeground()回调，在UIAbility的UI界面可见之前，如UIAbility切换至前台时触发。可以在onForeground()回调中申请系统需要的资源，或者重新申请在onBackground()中释放的资源。</p> 
<p>onBackground()回调，在UIAbility的UI界面完全不可见之后，如UIAbility切换至后台时候触发。可以在onBackground()回调中释放UI界面不可见时无用的资源，或者在此回调中执行较为耗时的操作，例如状态保存等。</p> 
<p>例如应用在使用过程中需要使用用户定位时，假设应用已获得用户的定位权限授权。在UI界面显示之前，可以在onForeground()回调中开启定位功能，从而获取到当前的位置信息。</p> 
<p>当应用切换到后台状态，可以在onBackground()回调中停止定位功能，以节省系统的资源消耗。</p> 
<pre><code class="prism language-javascript"><span class="token keyword">import</span> UIAbility <span class="token keyword">from</span> <span class="token string">'@ohos.app.ability.UIAbility'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">EntryAbility</span> <span class="token keyword">extends</span> <span class="token class-name">UIAbility</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">onForeground</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 申请系统需要的资源，或者重新申请在onBackground中释放的资源</span>
    <span class="token punctuation">}</span>

    <span class="token function">onBackground</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 释放UI界面不可见时无用的资源，或者在此回调中执行较为耗时的操作</span>
        <span class="token comment">// 例如状态保存等</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="4_Destroy_238"></a>4. Destroy状态</h4> 
<p>Destroy状态在UIAbility实例销毁时触发。可以在onDestroy()回调中进行系统资源的释放、数据的保存等操作。</p> 
<p>例如调用terminateSelf()方法停止当前UIAbility实例，从而完成UIAbility实例的销毁；或者用户使用最近任务列表关闭该UIAbility实例，完成UIAbility的销毁。</p> 
<pre><code class="prism language-javascript"><span class="token keyword">import</span> UIAbility <span class="token keyword">from</span> <span class="token string">'@ohos.app.ability.UIAbility'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Window <span class="token keyword">from</span> <span class="token string">'@ohos.window'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">EntryAbility</span> <span class="token keyword">extends</span> <span class="token class-name">UIAbility</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 系统资源的释放、数据的保存等</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="5_UIAbility_254"></a>5. UIAbility组件启动模式</h2> 
<p>UIAbility的启动模式是指UIAbility实例在启动时的不同呈现状态。针对不同的业务场景，系统提供了三种启动模式：</p> 
<ul><li> <p>singleton（单实例模式）</p> </li><li> <p>multiton（多实例模式）</p> </li><li> <p>specified（指定实例模式）</p> </li></ul> 
<h3><a id="51_singleton_263"></a>5.1 singleton启动模式</h3> 
<p>singleton启动模式为单实例模式，也是默认情况下的启动模式。</p> 
<p>每次调用startAbility()方法时，如果应用进程中该类型的UIAbility实例已经存在，则复用系统中的UIAbility实例。系统中只存在唯一一个该UIAbility实例，即在最近任务列表中只存在一个该类型的UIAbility实例。</p> 
<p>应用的UIAbility实例已创建，该UIAbility配置为单实例模式，再次调用startAbility()方法启动该UIAbility实例，此时只会进入该UIAbility的onNewWant()回调，不会进入其onCreate()和onWindowStageCreate()生命周期回调。</p> 
<p>如果需要使用singleton启动模式，在module.json5配置文件中的"launchType"字段配置为"singleton"即可。</p> 
<pre><code class="prism language-javascript"><span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"module"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ...</span>
    <span class="token string-property property">"abilities"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">"launchType"</span><span class="token operator">:</span> <span class="token string">"singleton"</span><span class="token punctuation">,</span>
        <span class="token comment">// ...</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="52_multiton_285"></a>5.2 multiton启动模式</h3> 
<p>multiton启动模式为多实例模式，每次调用startAbility()方法时，都会在应用进程中创建一个新的该类型UIAbility实例。即在最近任务列表中可以看到有多个该类型的UIAbility实例。这种情况下可以将UIAbility配置为multiton（多实例模式）。</p> 
<p>multiton启动模式的开发使用，在module.json5配置文件中的"launchType"字段配置为"multiton"即可。</p> 
<h3><a id="53_specified_290"></a>5.3 specified启动模式</h3> 
<p>specified启动模式为指定实例模式，针对一些特殊场景使用（例如文档应用中每次新建文档希望都能新建一个文档实例，重复打开一个已保存的文档希望打开的都是同一个文档实例）。</p> 
<p>在UIAbility实例创建之前，允许开发者为该实例创建一个唯一的字符串Key，创建的UIAbility实例绑定Key之后，后续每次调用startAbility()方法时，都会询问应用使用哪个Key对应的UIAbility实例来响应startAbility()请求。<em><strong>运行时由UIAbility内部业务决定是否创建多实例</strong></em>，如果匹配有该UIAbility实例的Key，则直接拉起与之绑定的UIAbility实例，否则创建一个新的UIAbility实例。</p> 
<p>应用的UIAbility实例已创建，该UIAbility配置为指定实例模式，再次调用startAbility()方法启动该UIAbility实例，且AbilityStage的onAcceptWant()回调匹配到一个已创建的UIAbility实例。此时，再次启动该UIAbility时，只会进入该UIAbility的onNewWant()回调，不会进入其onCreate()和onWindowStageCreate()生命周期回调。</p> 
<p>例如有两个UIAbility：EntryAbility和FuncAbility，FuncAbility配置为specified启动模式，需要从EntryAbility的页面中启动FuncAbility。</p> 
<ol><li>在FuncAbility中，将module.json5配置文件的"launchType"字段配置为"specified"。</li></ol> 
<pre><code class="prism language-javascript"><span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"module"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ...</span>
    <span class="token string-property property">"abilities"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">"launchType"</span><span class="token operator">:</span> <span class="token string">"specified"</span><span class="token punctuation">,</span>
        <span class="token comment">// ...</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="2"><li>在EntryAbility中，调用startAbility()方法时，在want参数中，增加一个自定义参数来区别UIAbility实例，例如增加一个"instanceKey"自定义参数。</li></ol> 
<pre><code class="prism language-javascript"><span class="token comment">// 在启动指定实例模式的UIAbility时，给每一个UIAbility实例配置一个独立的Key标识</span>
<span class="token comment">// 例如在文档使用场景中，可以用文档路径作为Key标识</span>
<span class="token keyword">function</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> want <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">deviceId</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token comment">// deviceId为空表示本设备</span>
    <span class="token literal-property property">bundleName</span><span class="token operator">:</span> <span class="token string">'com.example.myapplication'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">abilityName</span><span class="token operator">:</span> <span class="token string">'FuncAbility'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">moduleName</span><span class="token operator">:</span> <span class="token string">'module1'</span><span class="token punctuation">,</span> <span class="token comment">// moduleName非必选</span>
    <span class="token literal-property property">parameters</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 自定义信息</span>
        <span class="token literal-property property">instanceKey</span><span class="token operator">:</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token comment">// context为调用方UIAbility的AbilityContext</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">startAbility</span><span class="token punctuation">(</span>want<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<ol start="3"><li>由于FuncAbility的启动模式配置为了指定实例启动模式，在FuncAbility启动之前，会先进入其对应的AbilityStage的onAcceptWant()生命周期回调中，解析传入的want参数，获取"instanceKey"自定义参数。根据业务需要通过AbilityStage的onAcceptWant()生命周期回调返回一个字符串Key标识。如果返回的Key对应一个已启动的UIAbility，则会将之前的UIAbility拉回前台并获焦，而不创建新的实例，否则创建新的实例并启动。</li></ol> 
<pre><code class="prism language-javascript"><span class="token keyword">import</span> AbilityStage <span class="token keyword">from</span> <span class="token string">'@ohos.app.ability.AbilityStage'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">MyAbilityStage</span> <span class="token keyword">extends</span> <span class="token class-name">AbilityStage</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">onAcceptWant</span><span class="token punctuation">(</span>want<span class="token punctuation">)</span><span class="token operator">:</span> string <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 在被调用方的AbilityStage中，针对启动模式为specified的UIAbility返回一个UIAbility实例对应的一个Key值</span>
        <span class="token comment">// 当前示例指的是module1 Module的FuncAbility</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>want<span class="token punctuation">.</span>abilityName <span class="token operator">===</span> <span class="token string">'FuncAbility'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 返回的字符串Key标识为自定义拼接的字符串内容</span>
            <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">ControlModule_EntryAbilityInstance_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>want<span class="token punctuation">.</span>parameters<span class="token punctuation">.</span>instanceKey<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token string">''</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>例如在文档应用中，可以对不同的文档实例内容绑定不同的Key值。当每次新建文档的时候，可以传入不同的新Key值（如可以将文件的路径作为一个Key标识），此时AbilityStage中启动UIAbility时都会创建一个新的UIAbility实例；当新建的文档保存之后，回到桌面，或者新打开一个已保存的文档，回到桌面，此时再次打开该已保存的文档，此时AbilityStage中再次启动该UIAbility时，打开的仍然是之前原来已保存的文档界面。</p> 
<p>以如下步骤所示进行举例说明。</p> 
<ol><li> <p>打开文件A，对应启动一个新的UIAbility实例，例如启动“UIAbility实例1”。</p> </li><li> <p>在最近任务列表中关闭文件A的进程，此时UIAbility实例1被销毁，回到桌面，再次打开文件A，此时对应启动一个新的UIAbility实例，例如启动“UIAbility实例2”。</p> </li><li> <p>回到桌面，打开文件B，此时对应启动一个新的UIAbility实例，例如启动“UIAbility实例3”。</p> </li><li> <p>回到桌面，再次打开文件A，此时对应启动的还是之前的“UIAbility实例2”。</p> </li></ol> 
<h2><a id="6_UIAbility_369"></a>6. UIAbility组件基本用法</h2> 
<p>UIAbility组件的基本用法包括：指定UIAbility的启动页面以及获取UIAbility的上下文UIAbilityContext。</p> 
<h3><a id="61_UIAbilitysetContentView_372"></a>6.1 指定UIAbility的启动页面–setContentView</h3> 
<p>应用中的UIAbility在启动过程中，需要指定启动页面，否则应用启动后会因为没有默认加载页面而导致白屏。可以在UIAbility的onWindowStageCreate()生命周期回调中，通过WindowStage对象的loadContent()方法设置启动页面。</p> 
<pre><code class="prism language-javascript"><span class="token keyword">import</span> UIAbility <span class="token keyword">from</span> <span class="token string">'@ohos.app.ability.UIAbility'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Window <span class="token keyword">from</span> <span class="token string">'@ohos.window'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">EntryAbility</span> <span class="token keyword">extends</span> <span class="token class-name">UIAbility</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">onWindowStageCreate</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">windowStage</span><span class="token operator">:</span> Window<span class="token punctuation">.</span>WindowStage</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// Main window is created, set main page for this ability</span>
        windowStage<span class="token punctuation">.</span><span class="token function">loadContent</span><span class="token punctuation">(</span><span class="token string">'pages/Index'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// ...</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>在DevEco Studio中创建的UIAbility中，该UIAbility实例默认会加载Index页面，根据需要将Index页面路径替换为需要的页面路径即可。</p> 
<h3><a id="62_UIAbilitycontext_393"></a>6.2 获取UIAbility的上下文信息–context</h3> 
<p>UIAbility类拥有自身的上下文信息，该信息为UIAbilityContext类的实例，UIAbilityContext类拥有abilityInfo、currentHapModuleInfo等属性。通过UIAbilityContext可以获取UIAbility的相关配置信息，如包代码路径、Bundle名称、Ability名称和应用程序需要的环境状态等属性信息，以及可以获取操作UIAbility实例的方法（如startAbility()、connectServiceExtensionAbility()、terminateSelf()等）。</p> 
<ul><li>在UIAbility中可以通过this.context获取UIAbility实例的上下文信息。</li></ul> 
<pre><code class="prism language-javascript"><span class="token keyword">import</span> UIAbility <span class="token keyword">from</span> <span class="token string">'@ohos.app.ability.UIAbility'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">EntryAbility</span> <span class="token keyword">extends</span> <span class="token class-name">UIAbility</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token parameter">want<span class="token punctuation">,</span> launchParam</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 获取UIAbility实例的上下文</span>
        <span class="token keyword">let</span> context <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">;</span>

        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li>在页面中获取UIAbility实例的上下文信息，包括导入依赖资源context模块和在组件中定义一个context变量两个部分。</li></ul> 
<pre><code class="prism language-javascript"><span class="token keyword">import</span> common <span class="token keyword">from</span> <span class="token string">'@ohos.app.ability.common'</span><span class="token punctuation">;</span>

@Entry
@Component
struct Index <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">private</span> context <span class="token operator">=</span> <span class="token function">getContext</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token keyword">as</span> common<span class="token punctuation">.</span>UIAbilityContext<span class="token punctuation">;</span>

  <span class="token function">startAbilityTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">let</span> want <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
      <span class="token comment">// Want参数信息</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">startAbility</span><span class="token punctuation">(</span>want<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 页面展示</span>
  <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>也可以在导入依赖资源context模块后，在具体使用UIAbilityContext前进行变量定义。</p> 
<pre><code class="prism language-javascript"><span class="token keyword">import</span> common <span class="token keyword">from</span> <span class="token string">'@ohos.app.ability.common'</span><span class="token punctuation">;</span>

@Entry
@Component
struct Index <span class="token punctuation">{<!-- --></span>

  <span class="token function">startAbilityTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">let</span> context <span class="token operator">=</span> <span class="token function">getContext</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token keyword">as</span> common<span class="token punctuation">.</span>UIAbilityContext<span class="token punctuation">;</span>
    <span class="token keyword">let</span> want <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
      <span class="token comment">// Want参数信息</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    context<span class="token punctuation">.</span><span class="token function">startAbility</span><span class="token punctuation">(</span>want<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 页面展示</span>
  <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="7_UIAbilityUI_457"></a>7. UIAbility组件与UI的数据同步</h2> 
<p>基于HarmonyOS的应用模型，可以通过以下三种方式来实现UIAbility组件与UI之间的数据同步。</p> 
<ul><li> <p>使用EventHub进行数据通信：基于发布订阅模式来实现，事件需要先订阅后发布，订阅者收到消息后进行处理。</p> </li><li> <p>使用globalThis进行数据同步：ArkTS引擎实例内部的一个全局对象，在ArkTS引擎实例内部都能访问。</p> </li><li> <p>使用AppStorage/LocalStorage进行数据同步：ArkUI提供了AppStorage和LocalStorage两种应用级别的状态管理方案，可用于实现应用级别和UIAbility级别的数据同步。</p> </li></ul> 
<h3><a id="71_EventHub_466"></a>7.1 使用EventHub进行数据通信</h3> 
<p>EventHub提供了UIAbility组件/ExtensionAbility组件级别的事件机制，以UIAbility组件/ExtensionAbility组件为中心提供了订阅、取消订阅和触发事件的数据通信能力。接口说明请参见EventHub。</p> 
<p>在使用EventHub之前，首先需要获取EventHub对象。基类Context提供了EventHub对象，本章节以使用EventHub实现UIAbility与UI之间的数据通信为例进行说明。</p> 
<ol><li>在UIAbility中调用eventHub.on()方法注册一个自定义事件“event1”，eventHub.on()有如下两种调用方式，使用其中一种即可。</li></ol> 
<pre><code class="prism language-javascript"><span class="token keyword">import</span> UIAbility <span class="token keyword">from</span> <span class="token string">'@ohos.app.ability.UIAbility'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token constant">TAG</span><span class="token operator">:</span> string <span class="token operator">=</span> <span class="token string">'[Example].[Entry].[EntryAbility]'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">EntryAbility</span> <span class="token keyword">extends</span> <span class="token class-name">UIAbility</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">func1</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>data</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 触发事件，完成相应的业务操作</span>
        console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token constant">TAG</span><span class="token punctuation">,</span> <span class="token string">'1. '</span> <span class="token operator">+</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token parameter">want<span class="token punctuation">,</span> launch</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 获取eventHub</span>
        <span class="token keyword">let</span> eventhub <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span>eventHub<span class="token punctuation">;</span>
        <span class="token comment">// 执行订阅操作</span>
        eventhub<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'event1'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>func1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        eventhub<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'event1'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 触发事件，完成相应的业务操作</span>
            console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token constant">TAG</span><span class="token punctuation">,</span> <span class="token string">'2. '</span> <span class="token operator">+</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="2"><li>在UI界面中通过eventHub.emit()方法触发该事件，在触发事件的同时，根据需要传入参数信息。</li></ol> 
<pre><code class="prism language-javascript"><span class="token keyword">import</span> common <span class="token keyword">from</span> <span class="token string">'@ohos.app.ability.common'</span><span class="token punctuation">;</span>

@Entry
@Component
struct Index <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">private</span> context <span class="token operator">=</span> <span class="token function">getContext</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token keyword">as</span> common<span class="token punctuation">.</span>UIAbilityContext<span class="token punctuation">;</span>

  <span class="token function">eventHubFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 不带参数触发自定义“event1”事件</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span>eventHub<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'event1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 带1个参数触发自定义“event1”事件</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span>eventHub<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'event1'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 带2个参数触发自定义“event1”事件</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span>eventHub<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'event1'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'test'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 开发者可以根据实际的业务场景设计事件传递的参数</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 页面展示</span>
  <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="3"><li>在UIAbility的注册事件回调中可以得到对应的触发事件结果，运行日志结果如下所示。</li></ol> 
<pre><code class="prism language-javascript"><span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>

<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'test'</span><span class="token punctuation">]</span>
</code></pre> 
<ol start="4"><li>在自定义事件“event1”使用完成后，可以根据需要调用eventHub.off()方法取消该事件的订阅。</li></ol> 
<pre><code class="prism language-javascript"><span class="token comment">// context为UIAbility实例的AbilityContext</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span>eventHub<span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token string">'event1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="72_globalThis_538"></a>7.2 使用globalThis进行数据同步</h3> 
<p>globalThis是ArkTS引擎实例内部的一个全局对象，引擎内部的UIAbility/ExtensionAbility/Page都可以使用，因此可以使用globalThis全局对象进行数据同步。</p> 
<p><img src="https://images2.imgbox.com/74/48/ZHAhjBwE_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="1_UIAbilityPageglobalThis_544"></a>1. UIAbility和Page之间使用globalThis</h4> 
<p>globalThis为ArkTS引擎实例下的全局对象，可以通过globalThis绑定属性/方法来进行UIAbility组件与UI的数据同步。例如在UIAbility组件中绑定want参数，即可在UIAbility对应的UI界面上使用want参数信息。</p> 
<ol><li>调用startAbility()方法启动一个UIAbility实例时，被启动的UIAbility创建完成后会进入onCreate()生命周期回调，且在onCreate()生命周期回调中能够接受到传递过来的want参数，可以将want参数绑定到globalThis上。</li></ol> 
<pre><code class="prism language-javascript"><span class="token keyword">import</span> UIAbility <span class="token keyword">from</span> <span class="token string">'@ohos.app.ability.UIAbility'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">EntryAbility</span> <span class="token keyword">extends</span> <span class="token class-name">UIAbility</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token parameter">want<span class="token punctuation">,</span> launch</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        globalThis<span class="token punctuation">.</span>entryAbilityWant <span class="token operator">=</span> want<span class="token punctuation">;</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="2"><li>在UI界面中即可通过globalThis获取到want参数信息。</li></ol> 
<pre><code class="prism language-javascript"><span class="token keyword">let</span> entryAbilityWant<span class="token punctuation">;</span>

@Entry
@Component
struct Index <span class="token punctuation">{<!-- --></span>
  <span class="token function">aboutToAppear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    entryAbilityWant <span class="token operator">=</span> globalThis<span class="token punctuation">.</span>entryAbilityWant<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 页面展示</span>
  <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="2_UIAbilityUIAbilityglobalThis_580"></a>2. UIAbility和UIAbility之间使用globalThis</h4> 
<p>同一个应用中UIAbility和UIAbility之间的数据传递，可以通过将数据绑定到全局变量globalThis上进行同步，如在AbilityA中将数据保存在globalThis，然后跳转到AbilityB中取得该数据：</p> 
<ol><li>AbilityA中保存数据一个字符串数据并挂载到globalThis上。</li></ol> 
<pre><code class="prism language-javascript"><span class="token keyword">import</span> UIAbility <span class="token keyword">from</span> <span class="token string">'@ohos.app.ability.UIAbility'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">AbilityA</span> <span class="token keyword">extends</span> <span class="token class-name">UIAbility</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token parameter">want<span class="token punctuation">,</span> launch</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        globalThis<span class="token punctuation">.</span>entryAbilityStr <span class="token operator">=</span> <span class="token string">'AbilityA'</span><span class="token punctuation">;</span> <span class="token comment">// AbilityA存放字符串“AbilityA”到globalThis</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="2"><li>AbilityB中获取对应的数据。</li></ol> 
<pre><code class="prism language-javascript"><span class="token keyword">import</span> UIAbility <span class="token keyword">from</span> <span class="token string">'@ohos.app.ability.UIAbility'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">AbilityB</span> <span class="token keyword">extends</span> <span class="token class-name">UIAbility</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token parameter">want<span class="token punctuation">,</span> launch</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// AbilityB从globalThis读取name并输出</span>
        console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">'name from entryAbilityStr: '</span> <span class="token operator">+</span> globalThis<span class="token punctuation">.</span>entryAbilityStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="3_globalThis_610"></a>3. globalThis使用的注意事项</h4> 
<p><img src="https://images2.imgbox.com/b1/0b/4WjRbCPY_o.png" alt="在这里插入图片描述"></p> 
<ul><li> <p>Stage模型下进程内的UIAbility组件共享ArkTS引擎实例，使用globalThis时需要避免存放相同名称的对象。例如AbilityA和AbilityB可以使用globalThis共享数据，在存放相同名称的对象时，先存放的对象会被后存放的对象覆盖。</p> </li><li> <p>FA模型因为每个UIAbility组件之间引擎隔离，不会存在该问题。</p> </li><li> <p>对于绑定在globalThis上的对象，其生命周期与ArkTS虚拟机实例相同，建议在使用完成之后将其赋值为null，以减少对应用内存的占用。</p> </li></ul> 
<h3><a id="73_AppStorageLocalStorage_618"></a>7.3 使用AppStorage/LocalStorage进行数据同步</h3> 
<p>如前文所述,AppStorage是一个全局的状态管理器，适用于多个UIAbility共享同一状态数据的情况；而LocalStorage则是一个局部的状态管理器，适用于单个UIAbility内部使用的状态数据。</p> 
<h2><a id="8_UIAbility_621"></a>8. UIAbility组件间交互（设备内）</h2> 
<p>UIAbility是系统调度的最小单元。在设备内的功能模块之间跳转时，会涉及到启动特定的UIAbility，该UIAbility可以是应用内的其他UIAbility，也可以是其他应用的UIAbility（例如启动三方支付UIAbility）。</p> 
<p><em><strong>类似启动Activity的各种方式</strong></em></p> 
<h3><a id="81_UIAbility_626"></a>8.1 启动应用内的UIAbility</h3> 
<p>假设应用中有两个UIAbility：EntryAbility和FuncAbility（可以在同一个Module中，也可以在不同的Module中），需要从EntryAbility的页面中启动FuncAbility。</p> 
<ol><li> <p>在EntryAbility中，通过调用startAbility()方法启动UIAbility，want为UIAbility实例启动的入口参数，其中bundleName为待启动应用的Bundle名称，abilityName为待启动的UIAbility名称，moduleName在待启动的UIAbility属于不同的Module时添加，parameters为自定义信息参数。示例中的context的获取方式参见获取UIAbility的Context属性。</p> <p>类似startActivity(Intent)的形式</p> </li></ol> 
<pre><code class="prism language-javascript"><span class="token keyword">let</span> wantInfo <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">deviceId</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token comment">// deviceId为空表示本设备</span>
    <span class="token literal-property property">bundleName</span><span class="token operator">:</span> <span class="token string">'com.example.myapplication'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">abilityName</span><span class="token operator">:</span> <span class="token string">'FuncAbility'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">moduleName</span><span class="token operator">:</span> <span class="token string">'module1'</span><span class="token punctuation">,</span> <span class="token comment">// moduleName非必选</span>
    <span class="token literal-property property">parameters</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 自定义信息</span>
        <span class="token literal-property property">info</span><span class="token operator">:</span> <span class="token string">'来自EntryAbility Index页面'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token comment">// context为调用方UIAbility的AbilityContext</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">startAbility</span><span class="token punctuation">(</span>wantInfo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<ol start="2"><li>在FuncAbility的生命周期回调文件中接收EntryAbility传递过来的参数。</li></ol> 
<pre><code class="prism language-javascript"><span class="token keyword">import</span> UIAbility <span class="token keyword">from</span> <span class="token string">'@ohos.app.ability.UIAbility'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Window <span class="token keyword">from</span> <span class="token string">'@ohos.window'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">FuncAbility</span> <span class="token keyword">extends</span> <span class="token class-name">UIAbility</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token parameter">want<span class="token punctuation">,</span> launchParam</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 接收调用方UIAbility传过来的参数</span>
        <span class="token keyword">let</span> funcAbilityWant <span class="token operator">=</span> want<span class="token punctuation">;</span>
        <span class="token keyword">let</span> info <span class="token operator">=</span> funcAbilityWant<span class="token operator">?.</span>parameters<span class="token operator">?.</span>info<span class="token punctuation">;</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="3"><li>在FuncAbility业务完成之后，如需要停止当前UIAbility实例，在FuncAbility中通过调用terminateSelf()方法实现。类似finish()</li></ol> 
<pre><code class="prism language-javascript"><span class="token comment">// context为需要停止的UIAbility实例的AbilityContext</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">terminateSelf</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="82_UIAbility_672"></a>8.2 启动应用内的UIAbility并获取返回结果</h3> 
<ol><li>在EntryAbility中，调用startAbilityForResult()接口启动FuncAbility，异步回调中的data用于接收FuncAbility停止自身后返回给EntryAbility的信息。示例中的context的获取方式参见获取UIAbility的Context属性。</li></ol> 
<pre><code class="prism language-javascript"><span class="token keyword">let</span> wantInfo <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">deviceId</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token comment">// deviceId为空表示本设备</span>
    <span class="token literal-property property">bundleName</span><span class="token operator">:</span> <span class="token string">'com.example.myapplication'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">abilityName</span><span class="token operator">:</span> <span class="token string">'FuncAbility'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">moduleName</span><span class="token operator">:</span> <span class="token string">'module1'</span><span class="token punctuation">,</span> <span class="token comment">// moduleName非必选</span>
    <span class="token literal-property property">parameters</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 自定义信息</span>
        <span class="token literal-property property">info</span><span class="token operator">:</span> <span class="token string">'来自EntryAbility Index页面'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token comment">// context为调用方UIAbility的AbilityContext</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">startAbilityForResult</span><span class="token punctuation">(</span>wantInfo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<ol start="2"><li>在FuncAbility停止自身时，需要调用terminateSelfWithResult()方法，入参abilityResult为FuncAbility需要返回给EntryAbility的信息。</li></ol> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> <span class="token constant">RESULT_CODE</span><span class="token operator">:</span> number <span class="token operator">=</span> <span class="token number">1001</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> abilityResult <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">resultCode</span><span class="token operator">:</span> <span class="token constant">RESULT_CODE</span><span class="token punctuation">,</span>
    <span class="token literal-property property">want</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token literal-property property">bundleName</span><span class="token operator">:</span> <span class="token string">'com.example.myapplication'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">abilityName</span><span class="token operator">:</span> <span class="token string">'FuncAbility'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">moduleName</span><span class="token operator">:</span> <span class="token string">'module1'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">parameters</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token literal-property property">info</span><span class="token operator">:</span> <span class="token string">'来自FuncAbility Index页面'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token comment">// context为被调用方UIAbility的AbilityContext</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">terminateSelfWithResult</span><span class="token punctuation">(</span>abilityResult<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<ol start="3"><li>FuncAbility停止自身后，EntryAbility通过startAbilityForResult()方法回调接收被FuncAbility返回的信息，RESULT_CODE需要与前面的数值保持一致。</li></ol> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> <span class="token constant">RESULT_CODE</span><span class="token operator">:</span> number <span class="token operator">=</span> <span class="token number">1001</span><span class="token punctuation">;</span>

<span class="token comment">// ...</span>

<span class="token comment">// context为调用方UIAbility的AbilityContext</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">startAbilityForResult</span><span class="token punctuation">(</span>want<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token operator">?.</span>resultCode <span class="token operator">===</span> <span class="token constant">RESULT_CODE</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 解析被调用方UIAbility返回的信息</span>
        <span class="token keyword">let</span> info <span class="token operator">=</span> data<span class="token punctuation">.</span>want<span class="token operator">?.</span>parameters<span class="token operator">?.</span>info<span class="token punctuation">;</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="83_UIAbility_730"></a>8.3 启动其他应用的UIAbility</h3> 
<ul><li> <p>显式Want启动：启动一个确定应用的UIAbility，在want参数中需要设置该应用bundleName和abilityName，当需要拉起某个明确的UIAbility时，通常使用显式Want启动方式。</p> </li><li> <p>隐式Want启动：根据匹配条件由用户选择启动哪一个UIAbility，即不明确指出要启动哪一个UIAbility（abilityName参数未设置），在调用startAbility()方法时，其入参want中指定了一系列的entities字段（表示目标UIAbility额外的类别信息，如浏览器、视频播放器）和actions字段（表示要执行的通用操作，如查看、分享、应用详情等）等参数信息，然后由系统去分析want，并帮助找到合适的UIAbility来启动。当需要拉起其他应用的UIAbility时，开发者通常不知道用户设备中应用的安装情况，也无法确定目标应用的bundleName和abilityName，通常使用隐式Want启动方式。</p> </li></ul> 
<p>本章节主要讲解如何通过隐式Want启动其他应用的UIAbility。</p> 
<ol><li>将多个待匹配的文档应用安装到设备，在其对应UIAbility的module.json5配置文件中，配置skills的entities字段和actions字段。</li></ol> 
<pre><code class="prism language-javascript"><span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"module"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"abilities"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// ...</span>
        <span class="token string-property property">"skills"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{<!-- --></span>
            <span class="token string-property property">"entities"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
              <span class="token comment">// ...</span>
              <span class="token string">"entity.system.default"</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string-property property">"actions"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
              <span class="token comment">// ...</span>
              <span class="token string">"ohos.want.action.viewData"</span>
            <span class="token punctuation">]</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="2"><li>在调用方want参数中的entities和action需要被包含在待匹配UIAbility的skills配置的entities和actions中。系统匹配到符合entities和actions参数条件的UIAbility后，会弹出选择框展示匹配到的UIAbility实例列表供用户选择使用。</li></ol> 
<pre><code class="prism language-javascript"><span class="token keyword">let</span> wantInfo <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">deviceId</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token comment">// deviceId为空表示本设备</span>
    <span class="token comment">// 如果希望隐式仅在特定的捆绑包中进行查询，请取消下面的注释。</span>
    <span class="token comment">// bundleName: 'com.example.myapplication',</span>
    <span class="token literal-property property">action</span><span class="token operator">:</span> <span class="token string">'ohos.want.action.viewData'</span><span class="token punctuation">,</span>
    <span class="token comment">// entities可以被省略。</span>
    <span class="token literal-property property">entities</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'entity.system.default'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">// context为调用方UIAbility的AbilityContext</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">startAbility</span><span class="token punctuation">(</span>wantInfo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<ol start="3"><li>在文档应用使用完成之后，如需要停止当前UIAbility实例，通过调用terminateSelf()方法实现。</li></ol> 
<pre><code class="prism language-javascript"><span class="token comment">// context为需要停止的UIAbility实例的AbilityContext</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">terminateSelf</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="84_UIAbility_789"></a>8.4 启动其他应用的UIAbility并获取返回结果</h3> 
<p>同前面启动应用内UIAbility+隐式启动</p> 
<pre><code class="prism language-javascript"><span class="token keyword">let</span> wantInfo <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">deviceId</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token comment">// deviceId为空表示本设备</span>
    <span class="token comment">//如果需要启动指定包名的应用时,移除下行的注释.</span>
    <span class="token comment">// bundleName: 'com.example.myapplication',</span>
    <span class="token literal-property property">action</span><span class="token operator">:</span> <span class="token string">'ohos.want.action.editData'</span><span class="token punctuation">,</span>
    <span class="token comment">// entities can be omitted.</span>
    <span class="token literal-property property">entities</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'entity.system.default'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">// context为调用方UIAbility的AbilityContext</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">startAbilityForResult</span><span class="token punctuation">(</span>wantInfo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token operator">?.</span>resultCode <span class="token operator">===</span> <span class="token constant">RESULT_CODE</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
       <span class="token comment">// 解析被调用方UIAbility返回的信息</span>
       <span class="token keyword">let</span> payResult <span class="token operator">=</span> data<span class="token punctuation">.</span>want<span class="token operator">?.</span>parameters<span class="token operator">?.</span>payResult<span class="token punctuation">;</span>
       <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="85_UIAbility_813"></a>8.5 启动UIAbility的指定页面</h3> 
<p><strong>一个UIAbility可以对应多个页面，在不同的场景下启动该UIAbility时需要展示不同的页面</strong>，例如从一个UIAbility的页面中跳转到另外一个UIAbility时，希望启动目标UIAbility的指定页面。本文主要讲解目标UIAbility首次启动和目标UIAbility非首次启动两种启动指定页面的场景，以及在讲解启动指定页面之前会讲解到在调用方如何指定启动页面。</p> 
<h4><a id="1_UIAbility_816"></a>1. 调用方UIAbility指定启动页面</h4> 
<p>调用方UIAbility启动另外一个UIAbility时，通常需要跳转到指定的页面。例如FuncAbility包含两个页面（Index对应首页，Second对应功能A页面），此时需要在传入的want参数中配置指定的页面路径信息，可以通过want中的parameters参数增加一个自定义参数传递页面跳转信息。</p> 
<pre><code class="prism language-javascript"><span class="token keyword">let</span> wantInfo <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">deviceId</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token comment">// deviceId为空表示本设备</span>
    <span class="token literal-property property">bundleName</span><span class="token operator">:</span> <span class="token string">'com.example.myapplication'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">abilityName</span><span class="token operator">:</span> <span class="token string">'FuncAbility'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">moduleName</span><span class="token operator">:</span> <span class="token string">'module1'</span><span class="token punctuation">,</span> <span class="token comment">// moduleName非必选</span>
    <span class="token literal-property property">parameters</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 自定义参数传递页面信息</span>
        <span class="token literal-property property">router</span><span class="token operator">:</span> <span class="token string">'funcA'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token comment">// context为调用方UIAbility的AbilityContext</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">startAbility</span><span class="token punctuation">(</span>wantInfo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="2_UIAbility_836"></a>2. 目标UIAbility首次启动</h4> 
<p>目标UIAbility首次启动时，在目标UIAbility的onWindowStageCreate()生命周期回调中，解析EntryAbility传递过来的want参数，获取到需要加载的页面信息url，传入windowStage.loadContent()方法。</p> 
<pre><code class="prism language-javascript"><span class="token keyword">import</span> UIAbility <span class="token keyword">from</span> <span class="token string">'@ohos.app.ability.UIAbility'</span>
<span class="token keyword">import</span> Window <span class="token keyword">from</span> <span class="token string">'@ohos.window'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">FuncAbility</span> <span class="token keyword">extends</span> <span class="token class-name">UIAbility</span> <span class="token punctuation">{<!-- --></span>
    funcAbilityWant<span class="token punctuation">;</span>

    <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token parameter">want<span class="token punctuation">,</span> launchParam</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 接收调用方UIAbility传过来的参数</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>funcAbilityWant <span class="token operator">=</span> want<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">onWindowStageCreate</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">windowStage</span><span class="token operator">:</span> Window<span class="token punctuation">.</span>WindowStage</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// Main window is created, set main page for this ability</span>
        <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token string">'pages/Index'</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>funcAbilityWant<span class="token operator">?.</span>parameters<span class="token operator">?.</span>router<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>funcAbilityWant<span class="token punctuation">.</span>parameters<span class="token punctuation">.</span>router <span class="token operator">===</span> <span class="token string">'funA'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                url <span class="token operator">=</span> <span class="token string">'pages/Second'</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        windowStage<span class="token punctuation">.</span><span class="token function">loadContent</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// ...</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="3_UIAbility_865"></a>3. 目标UIAbility非首次启动</h4> 
<ol><li>在目标UIAbility中，默认加载的是Index页面。由于当前UIAbility实例之前已经创建完成，此时会进入UIAbility的onNewWant()回调中且不会进入onCreate()和onWindowStageCreate()生命周期回调，在onNewWant()回调中解析调用方传递过来的want参数，并挂在到全局变量globalThis中，以便于后续在页面中获取。</li></ol> 
<pre><code class="prism language-javascript"><span class="token keyword">import</span> UIAbility <span class="token keyword">from</span> <span class="token string">'@ohos.app.ability.UIAbility'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">FuncAbility</span> <span class="token keyword">extends</span> <span class="token class-name">UIAbility</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">onNewWant</span><span class="token punctuation">(</span><span class="token parameter">want<span class="token punctuation">,</span> launchParam</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 接收调用方UIAbility传过来的参数</span>
        globalThis<span class="token punctuation">.</span>funcAbilityWant <span class="token operator">=</span> want<span class="token punctuation">;</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="2"><li>在FuncAbility中，此时需要在Index页面中通过页面路由Router模块实现指定页面的跳转，由于此时FuncAbility对应的Index页面是处于激活状态，不会重新变量声明以及进入aboutToAppear()生命周期回调中。因此可以在Index页面的onPageShow()生命周期回调中实现页面路由跳转的功能。</li></ol> 
<pre><code class="prism language-javascript"><span class="token keyword">import</span> router <span class="token keyword">from</span> <span class="token string">'@ohos.router'</span><span class="token punctuation">;</span>

@Entry
@Component
struct Index <span class="token punctuation">{<!-- --></span>
  <span class="token function">onPageShow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">let</span> funcAbilityWant <span class="token operator">=</span> globalThis<span class="token punctuation">.</span>funcAbilityWant<span class="token punctuation">;</span>
    <span class="token keyword">let</span> url2 <span class="token operator">=</span> funcAbilityWant<span class="token operator">?.</span>parameters<span class="token operator">?.</span>router<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>url2 <span class="token operator">&amp;&amp;</span> url2 <span class="token operator">===</span> <span class="token string">'funcA'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      router<span class="token punctuation">.</span><span class="token function">replaceUrl</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
        <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'pages/Second'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 页面展示</span>
  <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>当被调用方Ability的启动模式设置为multiton启动模式时，每次启动都会创建一个新的实例，那么onNewWant()回调就不会被用到。</strong></p> 
<h2><a id="9_CallUIAbility_905"></a>9. 通过Call调用实现UIAbility交互（仅对系统应用开放）</h2> 
<p>Call调用是UIAbility能力的扩展，它为UIAbility提供一种能够被外部调用并与外部进行通信的能力。Call调用支持前台与后台两种启动方式，使UIAbility既能被拉起到前台展示UI，也可以在后台被创建并运行。Call调用在调用方与被调用方间建立了IPC通信，因此应用开发者可通过Call调用实现不同UIAbility之间的数据共享。</p> 
<p>Call调用的核心接口是startAbilityByCall方法，与startAbility接口的不同之处在于：</p> 
<ul><li> <p>startAbilityByCall支持前台与后台两种启动方式，而startAbility仅支持前台启动。</p> </li><li> <p>调用方可使用startAbilityByCall所返回的Caller对象与被调用方进行通信，而startAbility不具备通信能力。</p> </li></ul> 
<p>Call调用的使用场景主要包括：</p> 
<ul><li> <p>需要与被启动的UIAbility进行通信。</p> </li><li> <p>希望被启动的UIAbility在后台运行。</p> </li></ul> 
<p>Call调用相关名词解释</p> 
<p><img src="https://images2.imgbox.com/0c/06/bodAj31U_o.png" alt="在这里插入图片描述"></p> 
<p>Call调用示意图如下所示。</p> 
<p><img src="https://images2.imgbox.com/54/83/dxMpZnjK_o.png" alt="在这里插入图片描述"></p> 
<ul><li> <p>CallerAbility调用startAbilityByCall接口获取Caller，并使用Caller对象的call方法向CalleeAbility发送数据。</p> </li><li> <p>CalleeAbility持有一个Callee对象，通过Callee的on方法注册回调函数，当接收到Caller发送的数据时将会调用对应的回调函数。</p> </li></ul> 
<ol><li> <p>当前仅支持系统应用使用Call调用。</p> </li><li> <p>CalleeAbility的启动模式需要为单实例。</p> </li><li> <p>Call调用既支持本地（设备内）Call调用，也支持跨设备Call调用，下面介绍设备内Call调用方法。</p> </li></ol> 
<p>Call功能主要接口</p> 
<p><img src="https://images2.imgbox.com/8d/33/iYyQv4mc_o.png" alt="在这里插入图片描述"><br> 需要深入了解该部分内容的请参考<br> <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/uiability-intra-device-interaction-0000001478181149-V2" rel="nofollow">https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/uiability-intra-device-interaction-0000001478181149-V2</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/aaa5118e81ff1cfea68f3cf0acbd3a06/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">AI绘画软件Fooocus介绍</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/81e5f2deecd548b0668802d2de3a4dad/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">水质净化厂物联网远程监控系统解决方案</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>