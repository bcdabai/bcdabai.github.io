<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>文本情感分类 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="文本情感分类" />
<meta property="og:description" content="电影文本情感分类 Github地址 Kaggle地址
这个任务主要是对电影评论文本进行情感分类，主要分为正面评论和负面评论，所以是一个二分类问题，二分类模型我们可以选取一些常见的模型比如贝叶斯、逻辑回归等，这里挑战之一是文本内容的向量化，因此，我们首先尝试基于TF-IDF的向量化方法，然后尝试word2vec。
# -*- coding: UTF-8 -*- import pandas as pd import numpy as np import re from bs4 import BeautifulSoup def review_to_wordlist(review): &#39;&#39;&#39; 把IMDB的评论转成词序列 参考：http://blog.csdn.net/longxinchen_ml/article/details/50629613 &#39;&#39;&#39; # 去掉HTML标签，拿到内容 review_text = BeautifulSoup(review, &#34;html.parser&#34;).get_text() # 用正则表达式取出符合规范的部分 review_text = re.sub(&#34;[^a-zA-Z]&#34;,&#34; &#34;, review_text) # 小写化所有的词，并转成词list words = review_text.lower().split() # 返回words return words 载入数据集 # 载入数据集 train = pd.read_csv(&#39;/Users/frank/Documents/workspace/kaggle/dataset/Bag_of_Words_Meets_Bags_of_Popcorn/labeledTrainData.tsv&#39;, header=0, delimiter=&#34;\t&#34;, quoting=3) test = pd.read_csv(&#39;/Users/frank/Documents/workspace/kaggle/dataset/Bag_of_Words_Meets_Bags_of_Popcorn/testData.tsv&#39;, header=0, delimiter=&#34;\t&#34;, quoting=3) print train.head() print test." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/f85d93fbfbc3189a8e1ae929a48a0ee9/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-06-26T20:04:59+08:00" />
<meta property="article:modified_time" content="2017-06-26T20:04:59+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">文本情感分类</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h3 id="电影文本情感分类" style="margin:10px 0px; padding:0px; font-size:21px; line-height:1.5; font-family:Verdana,Arial,Helvetica,sans-serif"> 电影文本情感分类</h3> 
<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif"> <a target="_blank" href="https://github.com/lijingpeng/kaggle/tree/master/competitions/Bag_of_Words" style="margin:0px; padding:0px; color:rgb(0,0,0)" rel="noopener noreferrer">Github地址</a><br style="margin:0px; padding:0px"> <a target="_blank" href="https://www.kaggle.com/c/word2vec-nlp-tutorial/" rel="nofollow noopener noreferrer" style="margin:0px; padding:0px; color:rgb(0,0,0)">Kaggle地址</a></p> 
<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif"> 这个任务主要是对电影评论文本进行情感分类，主要分为正面评论和负面评论，所以是一个二分类问题，二分类模型我们可以选取一些常见的模型比如贝叶斯、逻辑回归等，这里挑战之一是文本内容的向量化，因此，我们首先尝试基于TF-IDF的向量化方法，然后尝试word2vec。</p> 
<div class="sourceCode" style="margin:0px; padding:0px; font-family:Verdana,Arial,Helvetica,sans-serif"> 
 <pre><code class="language-python"><code class="sourceCode python hljs" style='margin:auto; vertical-align:middle; display:block; background:rgb(255,255,255); height:auto; overflow-x:auto; padding:5px!important; line-height:1.5!important; font-family:"Courier New",sans-serif!important; border:1px solid rgb(204,204,204)!important'><span class="co" style="margin:0px; padding:0px"><span class="hljs-comment" style="margin:0px; padding:0px; color:green"># -*- coding: UTF-8 -*-</span></span>
<span class="im" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">import</span></span> pandas <span class="im" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">as</span></span> pd
<span class="im" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">import</span></span> numpy <span class="im" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">as</span></span> np
<span class="im" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">import</span></span> re
<span class="im" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">from</span></span> bs4 <span class="im" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">import</span></span> BeautifulSoup

<span class="kw" style="margin:0px; padding:0px"><span class="hljs-function" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">def</span></span></span><span class="hljs-function" style="margin:0px; padding:0px"> <span class="hljs-title" style="margin:0px; padding:0px; color:rgb(163,21,21)">review_to_wordlist</span><span class="hljs-params" style="margin:0px; padding:0px">(review)</span>:</span>
    <span class="co" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">'''</span></span><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">
</span><span class="co" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">    把IMDB的评论转成词序列</span></span><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">
</span><span class="co" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">    参考：http://blog.csdn.net/longxinchen_ml/article/details/50629613</span></span><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">
</span><span class="co" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">    '''</span></span>
    <span class="co" style="margin:0px; padding:0px"><span class="hljs-comment" style="margin:0px; padding:0px; color:green"># 去掉HTML标签，拿到内容</span></span>
    review_text <span class="op" style="margin:0px; padding:0px">=</span> BeautifulSoup(review, <span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">"html.parser"</span></span>).get_text()
    <span class="co" style="margin:0px; padding:0px"><span class="hljs-comment" style="margin:0px; padding:0px; color:green"># 用正则表达式取出符合规范的部分</span></span>
    review_text <span class="op" style="margin:0px; padding:0px">=</span> re.sub(<span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">"[^a-zA-Z]"</span></span>,<span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">" "</span></span>, review_text)
    <span class="co" style="margin:0px; padding:0px"><span class="hljs-comment" style="margin:0px; padding:0px; color:green"># 小写化所有的词，并转成词list</span></span>
    words <span class="op" style="margin:0px; padding:0px">=</span> review_text.lower().split()
    <span class="co" style="margin:0px; padding:0px"><span class="hljs-comment" style="margin:0px; padding:0px; color:green"># 返回words</span></span>
    <span class="cf" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">return</span></span> words</code></code></pre> 
</div> 
<h3 id="载入数据集" style="margin:10px 0px; padding:0px; font-size:21px; line-height:1.5; font-family:Verdana,Arial,Helvetica,sans-serif"> 载入数据集</h3> 
<div class="sourceCode" style="margin:0px; padding:0px; font-family:Verdana,Arial,Helvetica,sans-serif"> 
 <pre><code class="language-python"><code class="sourceCode python hljs" style='margin:auto; vertical-align:middle; display:block; background:rgb(255,255,255); height:auto; overflow-x:auto; padding:5px!important; line-height:1.5!important; font-family:"Courier New",sans-serif!important; border:1px solid rgb(204,204,204)!important'><span class="co" style="margin:0px; padding:0px"><span class="hljs-comment" style="margin:0px; padding:0px; color:green"># 载入数据集</span></span>
train <span class="op" style="margin:0px; padding:0px">=</span> pd.read_csv(<span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">'/Users/frank/Documents/workspace/kaggle/dataset/Bag_of_Words_Meets_Bags_of_Popcorn/labeledTrainData.tsv'</span></span>, header<span class="op" style="margin:0px; padding:0px">=</span><span class="dv" style="margin:0px; padding:0px">0</span>, delimiter<span class="op" style="margin:0px; padding:0px">=</span><span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">"</span></span><span class="ch" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">\t</span></span><span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">"</span></span>, quoting<span class="op" style="margin:0px; padding:0px">=</span><span class="dv" style="margin:0px; padding:0px">3</span>)
test <span class="op" style="margin:0px; padding:0px">=</span> pd.read_csv(<span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">'/Users/frank/Documents/workspace/kaggle/dataset/Bag_of_Words_Meets_Bags_of_Popcorn/testData.tsv'</span></span>, header<span class="op" style="margin:0px; padding:0px">=</span><span class="dv" style="margin:0px; padding:0px">0</span>, delimiter<span class="op" style="margin:0px; padding:0px">=</span><span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">"</span></span><span class="ch" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">\t</span></span><span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">"</span></span>, quoting<span class="op" style="margin:0px; padding:0px">=</span><span class="dv" style="margin:0px; padding:0px">3</span>)
<span class="bu" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">print</span></span> train.head()
<span class="bu" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">print</span></span> test.head()</code></code></pre> 
</div> 
<pre style="margin-top:10px; margin-bottom:10px; padding:0px; white-space:pre-wrap; word-wrap:break-word; background-color:rgb(255,255,255)"><code class="hljs fsharp" style='margin:auto; vertical-align:middle; display:block; height:auto; overflow-x:auto; padding:5px!important; line-height:1.5!important; font-family:"Courier New",sans-serif!important; border:1px solid rgb(204,204,204)!important'>         id  sentiment                                             review
<span class="hljs-number" style="margin:0px; padding:0px">0</span>  <span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">"5814_8"</span>          <span class="hljs-number" style="margin:0px; padding:0px">1</span>  <span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">"With all this stuff going down at the moment ...
1  "</span><span class="hljs-number" style="margin:0px; padding:0px">2381</span>_9<span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">"          1  "</span>\<span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">"The Classic War of the Worlds\" by Timothy ...
2  "</span><span class="hljs-number" style="margin:0px; padding:0px">7759</span>_3<span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">"          0  "</span>The film starts <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">with</span> a manager (Nicholas Bell...
<span class="hljs-number" style="margin:0px; padding:0px">3</span>  <span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">"3630_4"</span>          <span class="hljs-number" style="margin:0px; padding:0px">0</span>  <span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">"It must be assumed that those who praised thi...
4  "</span><span class="hljs-number" style="margin:0px; padding:0px">9495</span>_8<span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">"          1  "</span>Superbly trashy <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">and</span> wondrously unpretentious ...
           id                                             review
<span class="hljs-number" style="margin:0px; padding:0px">0</span>  <span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">"12311_10"</span>  <span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">"Naturally in a film who's main themes are of ...
1    "</span><span class="hljs-number" style="margin:0px; padding:0px">8348</span>_2<span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">"  "</span>This movie is a disaster within a disaster fi...
<span class="hljs-number" style="margin:0px; padding:0px">2</span>    <span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">"5828_4"</span>  <span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">"All in all, this is a movie for kids. We saw ...
3    "</span><span class="hljs-number" style="margin:0px; padding:0px">7186</span>_2<span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">"  "</span>Afraid <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">of</span> the Dark left me <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">with</span> the impressio...
<span class="hljs-number" style="margin:0px; padding:0px">4</span>   <span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">"12128_7"</span>  <span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">"A very accurate depiction of small time mob l...</span></code></pre> 
<h3 id="预处理数据" style="margin:10px 0px; padding:0px; font-size:21px; line-height:1.5; font-family:Verdana,Arial,Helvetica,sans-serif"> 预处理数据</h3> 
<div class="sourceCode" style="margin:0px; padding:0px; font-family:Verdana,Arial,Helvetica,sans-serif"> 
 <pre><code class="language-python"><code class="sourceCode python hljs" style='margin:auto; vertical-align:middle; display:block; background:rgb(255,255,255); height:auto; overflow-x:auto; padding:5px!important; line-height:1.5!important; font-family:"Courier New",sans-serif!important; border:1px solid rgb(204,204,204)!important'><span class="co" style="margin:0px; padding:0px"><span class="hljs-comment" style="margin:0px; padding:0px; color:green"># 预处理数据</span></span>
label <span class="op" style="margin:0px; padding:0px">=</span> train[<span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">'sentiment'</span></span>]
train_data <span class="op" style="margin:0px; padding:0px">=</span> []
<span class="cf" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">for</span></span> i <span class="op" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">in</span></span> <span class="bu" style="margin:0px; padding:0px">range</span>(<span class="bu" style="margin:0px; padding:0px">len</span>(train[<span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">'review'</span></span>])):
    train_data.append(<span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">' '</span></span>.join(review_to_wordlist(train[<span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">'review'</span></span>][i])))
test_data <span class="op" style="margin:0px; padding:0px">=</span> []
<span class="cf" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">for</span></span> i <span class="op" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">in</span></span> <span class="bu" style="margin:0px; padding:0px">range</span>(<span class="bu" style="margin:0px; padding:0px">len</span>(test[<span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">'review'</span></span>])):
    test_data.append(<span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">' '</span></span>.join(review_to_wordlist(test[<span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">'review'</span></span>][i])))

<span class="co" style="margin:0px; padding:0px"><span class="hljs-comment" style="margin:0px; padding:0px; color:green"># 预览数据</span></span>
<span class="bu" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">print</span></span> train_data[<span class="dv" style="margin:0px; padding:0px">0</span>], <span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">'</span></span><span class="ch" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">\n</span></span><span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">'</span></span>
<span class="bu" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">print</span></span> test_data[<span class="dv" style="margin:0px; padding:0px">0</span>]</code></code></pre> 
</div> 
<pre style="margin-top:10px; margin-bottom:10px; padding:0px; white-space:pre-wrap; word-wrap:break-word; background-color:rgb(255,255,255)"><code class="hljs vbnet" style='margin:auto; vertical-align:middle; display:block; height:auto; overflow-x:auto; padding:5px!important; line-height:1.5!important; font-family:"Courier New",sans-serif!important; border:1px solid rgb(204,204,204)!important'><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">with</span> all this stuff going down at the moment <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">with</span> mj i ve started listening <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">to</span> his music watching the odd documentary here <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">and</span> there watched the wiz <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">and</span> watched moonwalker again maybe i just want <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">to</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">get</span> a certain insight <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">into</span> this guy who i thought was really cool <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">in</span> the eighties just <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">to</span> maybe make up my mind whether he <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">is</span> guilty <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">or</span> innocent moonwalker <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">is</span> part biography part feature film which i remember going <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">to</span> see at the cinema <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">when</span> it was originally released some <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">of</span> it has subtle messages about mj s feeling towards the press <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">and</span> also the obvious message <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">of</span> drugs are bad m kay visually impressive but <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">of</span> course this <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">is</span> all about michael jackson so unless you remotely <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">like</span> mj <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">in</span> anyway <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">then</span> you are going <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">to</span> hate this <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">and</span> find it boring some may <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">call</span> mj an egotist <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">for</span> consenting <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">to</span> the making <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">of</span> this movie but mj <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">and</span> most <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">of</span> his fans would say that he made it <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">for</span> the fans which <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">if</span> <span class="hljs-literal" style="margin:0px; padding:0px; color:rgb(163,21,21)">true</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">is</span> really nice <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">of</span> him the actual feature film bit <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">when</span> it <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">finally</span> starts <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">is</span> only <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">on</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">for</span> minutes <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">or</span> so excluding the smooth criminal sequence <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">and</span> joe pesci <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">is</span> convincing <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">as</span> a psychopathic all powerful drug lord why he wants mj dead so bad <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">is</span> beyond <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">me</span> because mj overheard his plans nah joe pesci s character ranted that he wanted people <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">to</span> know it <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">is</span> he who <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">is</span> supplying drugs etc so i dunno maybe he just hates mj s music lots <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">of</span> cool things <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">in</span> this <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">like</span> mj turning <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">into</span> a car <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">and</span> a robot <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">and</span> the whole speed demon sequence also the director must have had the patience <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">of</span> a saint <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">when</span> it came <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">to</span> filming the kiddy bad sequence <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">as</span> usually directors hate working <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">with</span> one kid <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">let</span> alone a whole bunch <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">of</span> them performing a complex dance scene bottom line this movie <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">is</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">for</span> people who <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">like</span> mj <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">on</span> one level <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">or</span> another which i think <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">is</span> most people <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">if</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">not</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">then</span> stay away it does <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">try</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">and</span> give <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">off</span> a wholesome message <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">and</span> ironically mj s bestest buddy <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">in</span> this movie <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">is</span> a girl michael jackson <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">is</span> truly one <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">of</span> the most talented people ever <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">to</span> grace this planet but <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">is</span> he guilty well <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">with</span> all the attention i ve gave this subject hmmm well i don t know because people can be different behind closed doors i know this <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">for</span> a fact he <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">is</span> either an extremely nice but stupid guy <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">or</span> one <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">of</span> the most sickest liars i hope he <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">is</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">not</span> the latter

naturally <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">in</span> a film who s main themes are <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">of</span> mortality nostalgia <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">and</span> loss <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">of</span> innocence it <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">is</span> perhaps <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">not</span> surprising that it <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">is</span> rated more highly <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">by</span> older viewers than younger ones however there <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">is</span> a craftsmanship <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">and</span> completeness <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">to</span> the film which anyone can enjoy the pace <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">is</span> steady <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">and</span> constant the characters full <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">and</span> engaging the relationships <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">and</span> interactions natural showing that you <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">do</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">not</span> need floods <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">of</span> tears <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">to</span> show emotion screams <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">to</span> show fear shouting <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">to</span> show dispute <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">or</span> violence <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">to</span> show anger naturally joyce s <span class="hljs-built_in" style="margin:0px; padding:0px; color:rgb(0,0,255)">short</span> story lends the film a ready made <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">structure</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">as</span> perfect <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">as</span> a polished diamond but the small changes huston makes such <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">as</span> the inclusion <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">of</span> the poem fit <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">in</span> neatly it <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">is</span> truly a masterpiece <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">of</span> tact subtlety <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">and</span> overwhelming beauty</code></pre> 
<h3 id="特征处理" style="margin:10px 0px; padding:0px; font-size:21px; line-height:1.5; font-family:Verdana,Arial,Helvetica,sans-serif"> 特征处理</h3> 
<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif"> 直接丢给计算机这些词文本，计算机是无法计算的，因此我们需要把文本转换为向量，有几种常见的文本向量处理方法，比如：</p> 
<ol style="margin:0px; padding:0px 0px 0px 40px; font-family:Verdana,Arial,Helvetica,sans-serif"><li style="margin:0px 0px 1em; padding:0px; list-style:decimal">单词计数<br style="margin:0px; padding:0px"> </li><li style="margin:0px 0px 1em; padding:0px; list-style:decimal">TF-IDF向量<br style="margin:0px; padding:0px"> </li><li style="margin:0px 0px 1em; padding:0px; list-style:decimal">Word2vec向量<br style="margin:0px; padding:0px"> 我们先使用TF-IDF来试一下。</li></ol> 
<div class="sourceCode" style="margin:0px; padding:0px; font-family:Verdana,Arial,Helvetica,sans-serif"> 
 <pre><code class="language-python"><code class="sourceCode python hljs" style='margin:auto; vertical-align:middle; display:block; background:rgb(255,255,255); height:auto; overflow-x:auto; padding:5px!important; line-height:1.5!important; font-family:"Courier New",sans-serif!important; border:1px solid rgb(204,204,204)!important'><span class="im" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">from</span></span> sklearn.feature_extraction.text <span class="im" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">import</span></span> TfidfVectorizer <span class="im" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">as</span></span> TFIDF
<span class="co" style="margin:0px; padding:0px"><span class="hljs-comment" style="margin:0px; padding:0px; color:green"># 参考：http://blog.csdn.net/longxinchen_ml/article/details/50629613</span></span>
tfidf <span class="op" style="margin:0px; padding:0px">=</span> TFIDF(min_df<span class="op" style="margin:0px; padding:0px">=</span><span class="dv" style="margin:0px; padding:0px">2</span>, <span class="co" style="margin:0px; padding:0px"><span class="hljs-comment" style="margin:0px; padding:0px; color:green"># 最小支持度为2</span></span>
           max_features<span class="op" style="margin:0px; padding:0px">=</span><span class="va" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">None</span></span>,
           strip_accents<span class="op" style="margin:0px; padding:0px">=</span><span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">'unicode'</span></span>,
           analyzer<span class="op" style="margin:0px; padding:0px">=</span><span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">'word'</span></span>,
           token_pattern<span class="op" style="margin:0px; padding:0px">=</span><span class="vs" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">r'\w{1,}'</span></span>,
           ngram_range<span class="op" style="margin:0px; padding:0px">=</span>(<span class="dv" style="margin:0px; padding:0px">1</span>, <span class="dv" style="margin:0px; padding:0px">3</span>),  <span class="co" style="margin:0px; padding:0px"><span class="hljs-comment" style="margin:0px; padding:0px; color:green"># 二元文法模型</span></span>
           use_idf<span class="op" style="margin:0px; padding:0px">=</span><span class="dv" style="margin:0px; padding:0px">1</span>,
           smooth_idf<span class="op" style="margin:0px; padding:0px">=</span><span class="dv" style="margin:0px; padding:0px">1</span>,
           sublinear_tf<span class="op" style="margin:0px; padding:0px">=</span><span class="dv" style="margin:0px; padding:0px">1</span>,
           stop_words <span class="op" style="margin:0px; padding:0px">=</span> <span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">'english'</span></span>) <span class="co" style="margin:0px; padding:0px"><span class="hljs-comment" style="margin:0px; padding:0px; color:green"># 去掉英文停用词</span></span>

<span class="co" style="margin:0px; padding:0px"><span class="hljs-comment" style="margin:0px; padding:0px; color:green"># 合并训练和测试集以便进行TFIDF向量化操作</span></span>
data_all <span class="op" style="margin:0px; padding:0px">=</span> train_data <span class="op" style="margin:0px; padding:0px">+</span> test_data
len_train <span class="op" style="margin:0px; padding:0px">=</span> <span class="bu" style="margin:0px; padding:0px">len</span>(train_data)

tfidf.fit(data_all)
data_all <span class="op" style="margin:0px; padding:0px">=</span> tfidf.transform(data_all)
<span class="co" style="margin:0px; padding:0px"><span class="hljs-comment" style="margin:0px; padding:0px; color:green"># 恢复成训练集和测试集部分</span></span>
train_x <span class="op" style="margin:0px; padding:0px">=</span> data_all[:len_train]
test_x <span class="op" style="margin:0px; padding:0px">=</span> data_all[len_train:]
<span class="bu" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">print</span></span> <span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">'TF-IDF处理结束.'</span></span></code></code></pre> 
</div> 
<pre style="margin-top:10px; margin-bottom:10px; padding:0px; white-space:pre-wrap; word-wrap:break-word; background-color:rgb(255,255,255)"><code class="hljs prolog" style='margin:auto; vertical-align:middle; display:block; height:auto; overflow-x:auto; padding:5px!important; line-height:1.5!important; font-family:"Courier New",sans-serif!important; border:1px solid rgb(204,204,204)!important'><span class="hljs-symbol" style="margin:0px; padding:0px; color:rgb(0,176,232)">TF</span>-<span class="hljs-symbol" style="margin:0px; padding:0px; color:rgb(0,176,232)">IDF</span>处理结束.</code></pre> 
<h3 id="朴素贝叶斯训练" style="margin:10px 0px; padding:0px; font-size:21px; line-height:1.5; font-family:Verdana,Arial,Helvetica,sans-serif"> 朴素贝叶斯训练</h3> 
<div class="sourceCode" style="margin:0px; padding:0px; font-family:Verdana,Arial,Helvetica,sans-serif"> 
 <pre><code class="language-python"><code class="sourceCode python hljs" style='margin:auto; vertical-align:middle; display:block; background:rgb(255,255,255); height:auto; overflow-x:auto; padding:5px!important; line-height:1.5!important; font-family:"Courier New",sans-serif!important; border:1px solid rgb(204,204,204)!important'><span class="im" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">from</span></span> sklearn.naive_bayes <span class="im" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">import</span></span> MultinomialNB <span class="im" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">as</span></span> MNB

model_NB <span class="op" style="margin:0px; padding:0px">=</span> MNB()
model_NB.fit(train_x, label)
MNB(alpha<span class="op" style="margin:0px; padding:0px">=</span><span class="fl" style="margin:0px; padding:0px">1.0</span>, class_prior<span class="op" style="margin:0px; padding:0px">=</span><span class="va" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">None</span></span>, fit_prior<span class="op" style="margin:0px; padding:0px">=</span><span class="va" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">True</span></span>)

<span class="im" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">from</span></span> sklearn.cross_validation <span class="im" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">import</span></span> cross_val_score
<span class="im" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">import</span></span> numpy <span class="im" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">as</span></span> np

<span class="bu" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">print</span></span> <span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">"多项式贝叶斯分类器10折交叉验证得分: "</span></span>, np.mean(cross_val_score(model_NB, train_x, label, cv<span class="op" style="margin:0px; padding:0px">=</span><span class="dv" style="margin:0px; padding:0px">10</span>, scoring<span class="op" style="margin:0px; padding:0px">=</span><span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">'roc_auc'</span></span>))</code></code></pre> 
</div> 
<pre style="margin-top:10px; margin-bottom:10px; padding:0px; white-space:pre-wrap; word-wrap:break-word; background-color:rgb(255,255,255)"><code class="hljs css" style='margin:auto; vertical-align:middle; display:block; height:auto; overflow-x:auto; padding:5px!important; line-height:1.5!important; font-family:"Courier New",sans-serif!important; border:1px solid rgb(204,204,204)!important'>多项式贝叶斯分类器10折交叉验证得分:  0<span class="hljs-selector-class" style="margin:0px; padding:0px">.94983968</span></code></pre> 
<div class="sourceCode" style="margin:0px; padding:0px; font-family:Verdana,Arial,Helvetica,sans-serif"> 
 <pre><code class="language-python"><code class="sourceCode python hljs" style='margin:auto; vertical-align:middle; display:block; background:rgb(255,255,255); height:auto; overflow-x:auto; padding:5px!important; line-height:1.5!important; font-family:"Courier New",sans-serif!important; border:1px solid rgb(204,204,204)!important'>test_predicted <span class="op" style="margin:0px; padding:0px">=</span> np.array(model_NB.predict(test_x))
<span class="bu" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">print</span></span> <span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">'保存结果...'</span></span>
nb_output <span class="op" style="margin:0px; padding:0px">=</span> pd.DataFrame(data<span class="op" style="margin:0px; padding:0px">=</span>test_predicted, columns<span class="op" style="margin:0px; padding:0px">=</span>[<span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">'sentiment'</span></span>])
nb_output[<span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">'id'</span></span>] <span class="op" style="margin:0px; padding:0px">=</span> test[<span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">'id'</span></span>]
nb_output <span class="op" style="margin:0px; padding:0px">=</span> nb_output[[<span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">'id'</span></span>, <span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">'sentiment'</span></span>]]
nb_output.to_csv(<span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">'nb_output.csv'</span></span>, index<span class="op" style="margin:0px; padding:0px">=</span><span class="va" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">False</span></span>)
<span class="bu" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">print</span></span> <span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">'结束.'</span></span></code></code></pre> 
</div> 
<pre style="margin-top:10px; margin-bottom:10px; padding:0px; white-space:pre-wrap; word-wrap:break-word; background-color:rgb(255,255,255)"><code class="hljs prolog" style='margin:auto; vertical-align:middle; display:block; height:auto; overflow-x:auto; padding:5px!important; line-height:1.5!important; font-family:"Courier New",sans-serif!important; border:1px solid rgb(204,204,204)!important'>保存结果...
结束.</code></pre> 
<ol style="margin:0px; padding:0px 0px 0px 40px; font-family:Verdana,Arial,Helvetica,sans-serif"><li style="margin:0px 0px 1em; padding:0px; list-style:decimal">提交最终的结果到kaggle，AUC为：0.85728，排名300左右，50%的水平<br style="margin:0px; padding:0px"> </li><li style="margin:0px 0px 1em; padding:0px; list-style:decimal">ngram_range = 3, 三元文法，AUC为0.85924</li></ol> 
<h3 id="逻辑回归" style="margin:10px 0px; padding:0px; font-size:21px; line-height:1.5; font-family:Verdana,Arial,Helvetica,sans-serif"> 逻辑回归</h3> 
<div class="sourceCode" style="margin:0px; padding:0px; font-family:Verdana,Arial,Helvetica,sans-serif"> 
 <pre><code class="language-python"><code class="sourceCode python hljs" style='margin:auto; vertical-align:middle; display:block; background:rgb(255,255,255); height:auto; overflow-x:auto; padding:5px!important; line-height:1.5!important; font-family:"Courier New",sans-serif!important; border:1px solid rgb(204,204,204)!important'><span class="im" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">from</span></span> sklearn.linear_model <span class="im" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">import</span></span> LogisticRegression <span class="im" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">as</span></span> LR
<span class="im" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">from</span></span> sklearn.grid_search <span class="im" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">import</span></span> GridSearchCV

<span class="co" style="margin:0px; padding:0px"><span class="hljs-comment" style="margin:0px; padding:0px; color:green"># 设定grid search的参数</span></span>
grid_values <span class="op" style="margin:0px; padding:0px">=</span> {<!-- --><span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">'C'</span></span>:[<span class="dv" style="margin:0px; padding:0px">30</span>]}  
<span class="co" style="margin:0px; padding:0px"><span class="hljs-comment" style="margin:0px; padding:0px; color:green"># 设定打分为roc_auc</span></span>
model_LR <span class="op" style="margin:0px; padding:0px">=</span> GridSearchCV(LR(penalty <span class="op" style="margin:0px; padding:0px">=</span> <span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">'L2'</span></span>, dual <span class="op" style="margin:0px; padding:0px">=</span> <span class="va" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">True</span></span>, random_state <span class="op" style="margin:0px; padding:0px">=</span> <span class="dv" style="margin:0px; padding:0px">0</span>), grid_values, scoring <span class="op" style="margin:0px; padding:0px">=</span> <span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">'roc_auc'</span></span>, cv <span class="op" style="margin:0px; padding:0px">=</span> <span class="dv" style="margin:0px; padding:0px">20</span>)
model_LR.fit(train_x, label)
<span class="co" style="margin:0px; padding:0px"><span class="hljs-comment" style="margin:0px; padding:0px; color:green"># 20折交叉验证</span></span>
GridSearchCV(cv<span class="op" style="margin:0px; padding:0px">=</span><span class="dv" style="margin:0px; padding:0px">20</span>, estimator<span class="op" style="margin:0px; padding:0px">=</span>LR(C<span class="op" style="margin:0px; padding:0px">=</span><span class="fl" style="margin:0px; padding:0px">1.0</span>, class_weight<span class="op" style="margin:0px; padding:0px">=</span><span class="va" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">None</span></span>, dual<span class="op" style="margin:0px; padding:0px">=</span><span class="va" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">True</span></span>,
             fit_intercept<span class="op" style="margin:0px; padding:0px">=</span><span class="va" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">True</span></span>, intercept_scaling<span class="op" style="margin:0px; padding:0px">=</span><span class="dv" style="margin:0px; padding:0px">1</span>, penalty<span class="op" style="margin:0px; padding:0px">=</span><span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">'L2'</span></span>, random_state<span class="op" style="margin:0px; padding:0px">=</span><span class="dv" style="margin:0px; padding:0px">0</span>, tol<span class="op" style="margin:0px; padding:0px">=</span><span class="fl" style="margin:0px; padding:0px">0.0001</span>),
        fit_params<span class="op" style="margin:0px; padding:0px">=</span>{}, iid<span class="op" style="margin:0px; padding:0px">=</span><span class="va" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">True</span></span>, n_jobs<span class="op" style="margin:0px; padding:0px">=</span><span class="dv" style="margin:0px; padding:0px">1</span>,
        param_grid<span class="op" style="margin:0px; padding:0px">=</span>{<!-- --><span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">'C'</span></span>: [<span class="dv" style="margin:0px; padding:0px">30</span>]}, pre_dispatch<span class="op" style="margin:0px; padding:0px">=</span><span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">'2*n_jobs'</span></span>, refit<span class="op" style="margin:0px; padding:0px">=</span><span class="va" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">True</span></span>,
        scoring<span class="op" style="margin:0px; padding:0px">=</span><span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">'roc_auc'</span></span>, verbose<span class="op" style="margin:0px; padding:0px">=</span><span class="dv" style="margin:0px; padding:0px">0</span>)
<span class="co" style="margin:0px; padding:0px"><span class="hljs-comment" style="margin:0px; padding:0px; color:green">#输出结果</span></span>
<span class="bu" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">print</span></span> model_LR.grid_scores_</code></code></pre> 
</div> 
<pre style="margin-top:10px; margin-bottom:10px; padding:0px; white-space:pre-wrap; word-wrap:break-word; background-color:rgb(255,255,255)"><code class="hljs groovy" style='margin:auto; vertical-align:middle; display:block; height:auto; overflow-x:auto; padding:5px!important; line-height:1.5!important; font-family:"Courier New",sans-serif!important; border:1px solid rgb(204,204,204)!important'>[<span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">mean:</span> <span class="hljs-number" style="margin:0px; padding:0px">0.96497</span>, <span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">std:</span> <span class="hljs-number" style="margin:0px; padding:0px">0.00476</span>, <span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">params:</span> {<!-- --><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">'C'</span>: <span class="hljs-number" style="margin:0px; padding:0px">30</span>}]</code></pre> 
<div class="sourceCode" style="margin:0px; padding:0px; font-family:Verdana,Arial,Helvetica,sans-serif"> 
 <pre><code class="language-python"><code class="sourceCode python hljs" style='margin:auto; vertical-align:middle; display:block; background:rgb(255,255,255); height:auto; overflow-x:auto; padding:5px!important; line-height:1.5!important; font-family:"Courier New",sans-serif!important; border:1px solid rgb(204,204,204)!important'>test_predicted <span class="op" style="margin:0px; padding:0px">=</span> np.array(model_LR.predict(test_x))
<span class="bu" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">print</span></span> <span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">'保存结果...'</span></span>
lr_output <span class="op" style="margin:0px; padding:0px">=</span> pd.DataFrame(data<span class="op" style="margin:0px; padding:0px">=</span>test_predicted, columns<span class="op" style="margin:0px; padding:0px">=</span>[<span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">'sentiment'</span></span>])
lr_output[<span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">'id'</span></span>] <span class="op" style="margin:0px; padding:0px">=</span> test[<span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">'id'</span></span>]
lr_output <span class="op" style="margin:0px; padding:0px">=</span> lr_output[[<span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">'id'</span></span>, <span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">'sentiment'</span></span>]]
lr_output.to_csv(<span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">'lr_output.csv'</span></span>, index<span class="op" style="margin:0px; padding:0px">=</span><span class="va" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">False</span></span>)
<span class="bu" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">print</span></span> <span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">'结束.'</span></span></code></code></pre> 
</div> 
<pre style="margin-top:10px; margin-bottom:10px; padding:0px; white-space:pre-wrap; word-wrap:break-word; background-color:rgb(255,255,255)"><code class="hljs prolog" style='margin:auto; vertical-align:middle; display:block; height:auto; overflow-x:auto; padding:5px!important; line-height:1.5!important; font-family:"Courier New",sans-serif!important; border:1px solid rgb(204,204,204)!important'>保存结果...
结束.</code></pre> 
<ol style="margin:0px; padding:0px 0px 0px 40px; font-family:Verdana,Arial,Helvetica,sans-serif"><li style="margin:0px 0px 1em; padding:0px; list-style:decimal">提交最终的结果到kaggle，AUC为：0.88956，排名260左右，比之前贝叶斯模型有所提高<br style="margin:0px; padding:0px"> </li><li style="margin:0px 0px 1em; padding:0px; list-style:decimal">三元文法，AUC为0.89076</li></ol> 
<h3 id="word2vec" style="margin:10px 0px; padding:0px; font-size:21px; line-height:1.5; font-family:Verdana,Arial,Helvetica,sans-serif"> Word2vec</h3> 
<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif"> 神经网络语言模型L = SUM[log(p(w|contect(w))]，即在w的上下文下计算当前词w的概率，由公式可以看到，我们的核心是计算p(w|contect(w)， Word2vec给出了构造这个概率的一个方法。</p> 
<div class="sourceCode" style="margin:0px; padding:0px; font-family:Verdana,Arial,Helvetica,sans-serif"> 
 <pre><code class="language-python"><code class="sourceCode python hljs" style='margin:auto; vertical-align:middle; display:block; background:rgb(255,255,255); height:auto; overflow-x:auto; padding:5px!important; line-height:1.5!important; font-family:"Courier New",sans-serif!important; border:1px solid rgb(204,204,204)!important'><span class="im" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">import</span></span> gensim
<span class="im" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">import</span></span> nltk
<span class="im" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">from</span></span> nltk.corpus <span class="im" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">import</span></span> stopwords

tokenizer <span class="op" style="margin:0px; padding:0px">=</span> nltk.data.load(<span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">'tokenizers/punkt/english.pickle'</span></span>)

<span class="kw" style="margin:0px; padding:0px"><span class="hljs-function" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">def</span></span></span><span class="hljs-function" style="margin:0px; padding:0px"> <span class="hljs-title" style="margin:0px; padding:0px; color:rgb(163,21,21)">review_to_wordlist</span><span class="hljs-params" style="margin:0px; padding:0px">( review, remove_stopwords</span></span><span class="op" style="margin:0px; padding:0px">=</span><span class="va" style="margin:0px; padding:0px">False</span><span class="hljs-function" style="margin:0px; padding:0px"><span class="hljs-params" style="margin:0px; padding:0px"> )</span>:</span>
    review_text <span class="op" style="margin:0px; padding:0px">=</span> BeautifulSoup(review, <span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">"html.parser"</span></span>).get_text()
    review_text <span class="op" style="margin:0px; padding:0px">=</span> re.sub(<span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">"[^a-zA-Z]"</span></span>,<span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">" "</span></span>, review_text)

    words <span class="op" style="margin:0px; padding:0px">=</span> review_text.lower().split()

    <span class="cf" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">if</span></span> remove_stopwords:
        stops <span class="op" style="margin:0px; padding:0px">=</span> <span class="bu" style="margin:0px; padding:0px">set</span>(stopwords.words(<span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">"english"</span></span>))
        words <span class="op" style="margin:0px; padding:0px">=</span> [w <span class="cf" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">for</span></span> w <span class="op" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">in</span></span> words <span class="cf" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">if</span></span> <span class="op" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">not</span></span> w <span class="op" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">in</span></span> stops]

    <span class="cf" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">return</span></span>(words)

<span class="kw" style="margin:0px; padding:0px"><span class="hljs-function" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">def</span></span></span><span class="hljs-function" style="margin:0px; padding:0px"> <span class="hljs-title" style="margin:0px; padding:0px; color:rgb(163,21,21)">review_to_sentences</span><span class="hljs-params" style="margin:0px; padding:0px">( review, tokenizer, remove_stopwords</span></span><span class="op" style="margin:0px; padding:0px">=</span><span class="va" style="margin:0px; padding:0px">False</span><span class="hljs-function" style="margin:0px; padding:0px"><span class="hljs-params" style="margin:0px; padding:0px"> )</span>:</span>
    <span class="co" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">'''</span></span><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">
</span><span class="co" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">    将评论段落转换为句子，返回句子列表，每个句子由一堆词组成</span></span><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">
</span><span class="co" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">    '''</span></span>
    raw_sentences <span class="op" style="margin:0px; padding:0px">=</span> tokenizer.tokenize(review.strip().decode(<span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">'utf8'</span></span>))

    sentences <span class="op" style="margin:0px; padding:0px">=</span> []
    <span class="cf" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">for</span></span> raw_sentence <span class="op" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">in</span></span> raw_sentences:
        <span class="cf" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">if</span></span> <span class="bu" style="margin:0px; padding:0px">len</span>(raw_sentence) <span class="op" style="margin:0px; padding:0px">&gt;</span> <span class="dv" style="margin:0px; padding:0px">0</span>:
            <span class="co" style="margin:0px; padding:0px"><span class="hljs-comment" style="margin:0px; padding:0px; color:green"># 获取句子中的词列表</span></span>
            sentences.append( review_to_wordlist( raw_sentence, remove_stopwords ))
    <span class="cf" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">return</span></span> sentences</code></code></pre> 
</div> 
<div class="sourceCode" style="margin:0px; padding:0px; font-family:Verdana,Arial,Helvetica,sans-serif"> 
 <pre><code class="language-python"><code class="sourceCode python hljs" style='margin:auto; vertical-align:middle; display:block; background:rgb(255,255,255); height:auto; overflow-x:auto; padding:5px!important; line-height:1.5!important; font-family:"Courier New",sans-serif!important; border:1px solid rgb(204,204,204)!important'>sentences <span class="op" style="margin:0px; padding:0px">=</span> []
<span class="cf" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">for</span></span> i, review <span class="op" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">in</span></span> <span class="bu" style="margin:0px; padding:0px">enumerate</span>(train[<span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">"review"</span></span>]):
    sentences <span class="op" style="margin:0px; padding:0px">+=</span> review_to_sentences(review, tokenizer)</code></code></pre> 
</div> 
<div class="sourceCode" style="margin:0px; padding:0px; font-family:Verdana,Arial,Helvetica,sans-serif"> 
 <pre><code class="language-python"><code class="sourceCode python hljs" style='margin:auto; vertical-align:middle; display:block; background:rgb(255,255,255); height:auto; overflow-x:auto; padding:5px!important; line-height:1.5!important; font-family:"Courier New",sans-serif!important; border:1px solid rgb(204,204,204)!important'>unlabeled_train <span class="op" style="margin:0px; padding:0px">=</span> pd.read_csv(<span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">"/Users/frank/Documents/workspace/kaggle/dataset/Bag_of_Words_Meets_Bags_of_Popcorn/unlabeledTrainData.tsv"</span></span>, header<span class="op" style="margin:0px; padding:0px">=</span><span class="dv" style="margin:0px; padding:0px">0</span>, delimiter<span class="op" style="margin:0px; padding:0px">=</span><span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">"</span></span><span class="ch" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">\t</span></span><span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">"</span></span>, quoting<span class="op" style="margin:0px; padding:0px">=</span><span class="dv" style="margin:0px; padding:0px">3</span> )
<span class="cf" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">for</span></span> review <span class="op" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">in</span></span> unlabeled_train[<span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">"review"</span></span>]:
    sentences <span class="op" style="margin:0px; padding:0px">+=</span> review_to_sentences(review, tokenizer)
<span class="bu" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">print</span></span> <span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">'预处理unlabeled_train data...'</span></span>
<span class="bu" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">print</span></span> <span class="bu" style="margin:0px; padding:0px">len</span>(train_data)
<span class="bu" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">print</span></span> <span class="bu" style="margin:0px; padding:0px">len</span>(sentences)</code></code></pre> 
</div> 
<pre style="margin-top:10px; margin-bottom:10px; padding:0px; white-space:pre-wrap; word-wrap:break-word; background-color:rgb(255,255,255)"><code class="hljs haskell" style='margin:auto; vertical-align:middle; display:block; height:auto; overflow-x:auto; padding:5px!important; line-height:1.5!important; font-family:"Courier New",sans-serif!important; border:1px solid rgb(204,204,204)!important'>    预处理unlabeled_train <span class="hljs-class" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">data</span>...</span>
    <span class="hljs-number" style="margin:0px; padding:0px">25000</span>
    <span class="hljs-number" style="margin:0px; padding:0px">795538</span></code></pre> 
<h4 id="构建word2vec模型" style="margin:10px 0px; padding:0px; font-size:16px; line-height:1.5; font-family:Verdana,Arial,Helvetica,sans-serif"> 构建word2vec模型</h4> 
<div class="sourceCode" style="margin:0px; padding:0px; font-family:Verdana,Arial,Helvetica,sans-serif"> 
 <pre><code class="language-python"><code class="sourceCode python hljs" style='margin:auto; vertical-align:middle; display:block; background:rgb(255,255,255); height:auto; overflow-x:auto; padding:5px!important; line-height:1.5!important; font-family:"Courier New",sans-serif!important; border:1px solid rgb(204,204,204)!important'><span class="im" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">import</span></span> time
<span class="im" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">from</span></span> gensim.models <span class="im" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">import</span></span> Word2Vec
<span class="co" style="margin:0px; padding:0px"><span class="hljs-comment" style="margin:0px; padding:0px; color:green"># 模型参数</span></span>
num_features <span class="op" style="margin:0px; padding:0px">=</span> <span class="dv" style="margin:0px; padding:0px">300</span>    <span class="co" style="margin:0px; padding:0px"><span class="hljs-comment" style="margin:0px; padding:0px; color:green"># Word vector dimensionality                      </span></span>
min_word_count <span class="op" style="margin:0px; padding:0px">=</span> <span class="dv" style="margin:0px; padding:0px">40</span>   <span class="co" style="margin:0px; padding:0px"><span class="hljs-comment" style="margin:0px; padding:0px; color:green"># Minimum word count                        </span></span>
num_workers <span class="op" style="margin:0px; padding:0px">=</span> <span class="dv" style="margin:0px; padding:0px">4</span>       <span class="co" style="margin:0px; padding:0px"><span class="hljs-comment" style="margin:0px; padding:0px; color:green"># Number of threads to run in parallel</span></span>
context <span class="op" style="margin:0px; padding:0px">=</span> <span class="dv" style="margin:0px; padding:0px">10</span>          <span class="co" style="margin:0px; padding:0px"><span class="hljs-comment" style="margin:0px; padding:0px; color:green"># Context window size                                                                                    </span></span>
downsampling <span class="op" style="margin:0px; padding:0px">=</span> <span class="fl" style="margin:0px; padding:0px">1e-3</span>   <span class="co" style="margin:0px; padding:0px"><span class="hljs-comment" style="margin:0px; padding:0px; color:green"># Downsample setting for frequent words</span></span></code></code></pre> 
</div> 
<div class="sourceCode" style="margin:0px; padding:0px; font-family:Verdana,Arial,Helvetica,sans-serif"> 
 <pre><code class="language-python"><code class="sourceCode python hljs" style='margin:auto; vertical-align:middle; display:block; background:rgb(255,255,255); height:auto; overflow-x:auto; padding:5px!important; line-height:1.5!important; font-family:"Courier New",sans-serif!important; border:1px solid rgb(204,204,204)!important'><span class="op" style="margin:0px; padding:0px">%%</span>time
<span class="co" style="margin:0px; padding:0px"><span class="hljs-comment" style="margin:0px; padding:0px; color:green"># 训练模型</span></span>
<span class="bu" style="margin:0px; padding:0px">print</span>(<span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">"训练模型中..."</span></span>)
model <span class="op" style="margin:0px; padding:0px">=</span> Word2Vec(sentences, workers<span class="op" style="margin:0px; padding:0px">=</span>num_workers, <span class="op" style="margin:0px; padding:0px">\</span>
            size<span class="op" style="margin:0px; padding:0px">=</span>num_features, min_count <span class="op" style="margin:0px; padding:0px">=</span> min_word_count, <span class="op" style="margin:0px; padding:0px">\</span>
            window <span class="op" style="margin:0px; padding:0px">=</span> context, sample <span class="op" style="margin:0px; padding:0px">=</span> downsampling)</code></code></pre> 
</div> 
<pre style="margin-top:10px; margin-bottom:10px; padding:0px; white-space:pre-wrap; word-wrap:break-word; background-color:rgb(255,255,255)"><code class="hljs groovy" style='margin:auto; vertical-align:middle; display:block; height:auto; overflow-x:auto; padding:5px!important; line-height:1.5!important; font-family:"Courier New",sans-serif!important; border:1px solid rgb(204,204,204)!important'>训练模型中...
CPU <span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">times:</span> user <span class="hljs-number" style="margin:0px; padding:0px">6</span>min <span class="hljs-number" style="margin:0px; padding:0px">16</span>s, <span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">sys:</span> <span class="hljs-number" style="margin:0px; padding:0px">8.34</span> s, <span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">total:</span> <span class="hljs-number" style="margin:0px; padding:0px">6</span>min <span class="hljs-number" style="margin:0px; padding:0px">24</span>s
Wall <span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">time:</span> <span class="hljs-number" style="margin:0px; padding:0px">2</span>min <span class="hljs-number" style="margin:0px; padding:0px">27</span>s</code></pre> 
<div class="sourceCode" style="margin:0px; padding:0px; font-family:Verdana,Arial,Helvetica,sans-serif"> 
 <pre><code class="language-python"><code class="sourceCode python hljs" style='margin:auto; vertical-align:middle; display:block; background:rgb(255,255,255); height:auto; overflow-x:auto; padding:5px!important; line-height:1.5!important; font-family:"Courier New",sans-serif!important; border:1px solid rgb(204,204,204)!important'><span class="bu" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">print</span></span> <span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">'保存模型...'</span></span>
model.init_sims(replace<span class="op" style="margin:0px; padding:0px">=</span><span class="va" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">True</span></span>)
model_name <span class="op" style="margin:0px; padding:0px">=</span> <span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">"300features_40minwords_10context"</span></span>
model.save(model_name)</code></code></pre> 
</div> 
<pre style="margin-top:10px; margin-bottom:10px; padding:0px; white-space:pre-wrap; word-wrap:break-word; background-color:rgb(255,255,255)"><code class="hljs r" style='margin:auto; vertical-align:middle; display:block; height:auto; overflow-x:auto; padding:5px!important; line-height:1.5!important; font-family:"Courier New",sans-serif!important; border:1px solid rgb(204,204,204)!important'>保存模型<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">...</span></code></pre> 
<h4 id="预览模型" style="margin:10px 0px; padding:0px; font-size:16px; line-height:1.5; font-family:Verdana,Arial,Helvetica,sans-serif"> 预览模型</h4> 
<div class="sourceCode" style="margin:0px; padding:0px; font-family:Verdana,Arial,Helvetica,sans-serif"> 
 <pre><code class="language-python"><code class="sourceCode python hljs" style='margin:auto; vertical-align:middle; display:block; background:rgb(255,255,255); height:auto; overflow-x:auto; padding:5px!important; line-height:1.5!important; font-family:"Courier New",sans-serif!important; border:1px solid rgb(204,204,204)!important'>model.doesnt_match(<span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">"man woman child kitchen"</span></span>.split())</code></code></pre> 
</div> 
<pre style="margin-top:10px; margin-bottom:10px; padding:0px; white-space:pre-wrap; word-wrap:break-word; background-color:rgb(255,255,255)"><code class="hljs python" style='margin:auto; vertical-align:middle; display:block; height:auto; overflow-x:auto; padding:5px!important; line-height:1.5!important; font-family:"Courier New",sans-serif!important; border:1px solid rgb(204,204,204)!important'><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">'kitchen'</span></code></pre> 
<div class="sourceCode" style="margin:0px; padding:0px; font-family:Verdana,Arial,Helvetica,sans-serif"> 
 <pre><code class="language-python"><code class="sourceCode python hljs" style='margin:auto; vertical-align:middle; display:block; background:rgb(255,255,255); height:auto; overflow-x:auto; padding:5px!important; line-height:1.5!important; font-family:"Courier New",sans-serif!important; border:1px solid rgb(204,204,204)!important'>model.doesnt_match(<span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">"france england germany berlin"</span></span>.split())</code></code></pre> 
</div> 
<pre style="margin-top:10px; margin-bottom:10px; padding:0px; white-space:pre-wrap; word-wrap:break-word; background-color:rgb(255,255,255)"><code class="hljs python" style='margin:auto; vertical-align:middle; display:block; height:auto; overflow-x:auto; padding:5px!important; line-height:1.5!important; font-family:"Courier New",sans-serif!important; border:1px solid rgb(204,204,204)!important'><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">'berlin'</span></code></pre> 
<div class="sourceCode" style="margin:0px; padding:0px; font-family:Verdana,Arial,Helvetica,sans-serif"> 
 <pre><code class="language-python"><code class="sourceCode python hljs" style='margin:auto; vertical-align:middle; display:block; background:rgb(255,255,255); height:auto; overflow-x:auto; padding:5px!important; line-height:1.5!important; font-family:"Courier New",sans-serif!important; border:1px solid rgb(204,204,204)!important'>model.doesnt_match(<span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">"paris berlin london austria"</span></span>.split())</code></code></pre> 
</div> 
<pre style="margin-top:10px; margin-bottom:10px; padding:0px; white-space:pre-wrap; word-wrap:break-word; background-color:rgb(255,255,255)"><code class="hljs python" style='margin:auto; vertical-align:middle; display:block; height:auto; overflow-x:auto; padding:5px!important; line-height:1.5!important; font-family:"Courier New",sans-serif!important; border:1px solid rgb(204,204,204)!important'><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">'london'</span></code></pre> 
<div class="sourceCode" style="margin:0px; padding:0px; font-family:Verdana,Arial,Helvetica,sans-serif"> 
 <pre><code class="language-python"><code class="sourceCode python hljs" style='margin:auto; vertical-align:middle; display:block; background:rgb(255,255,255); height:auto; overflow-x:auto; padding:5px!important; line-height:1.5!important; font-family:"Courier New",sans-serif!important; border:1px solid rgb(204,204,204)!important'>model.most_similar(<span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">"man"</span></span>)</code></code></pre> 
</div> 
<pre style="margin-top:10px; margin-bottom:10px; padding:0px; white-space:pre-wrap; word-wrap:break-word; background-color:rgb(255,255,255)"><code class="hljs python" style='margin:auto; vertical-align:middle; display:block; height:auto; overflow-x:auto; padding:5px!important; line-height:1.5!important; font-family:"Courier New",sans-serif!important; border:1px solid rgb(204,204,204)!important'>[(<span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">u'woman'</span>, <span class="hljs-number" style="margin:0px; padding:0px">0.6246455907821655</span>),
 (<span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">u'lady'</span>, <span class="hljs-number" style="margin:0px; padding:0px">0.6008599400520325</span>),
 (<span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">u'lad'</span>, <span class="hljs-number" style="margin:0px; padding:0px">0.5698915719985962</span>),
 (<span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">u'businessman'</span>, <span class="hljs-number" style="margin:0px; padding:0px">0.5431989431381226</span>),
 (<span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">u'chap'</span>, <span class="hljs-number" style="margin:0px; padding:0px">0.53116375207901</span>),
 (<span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">u'monk'</span>, <span class="hljs-number" style="margin:0px; padding:0px">0.5250570774078369</span>),
 (<span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">u'men'</span>, <span class="hljs-number" style="margin:0px; padding:0px">0.5177899599075317</span>),
 (<span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">u'guy'</span>, <span class="hljs-number" style="margin:0px; padding:0px">0.517480731010437</span>),
 (<span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">u'farmer'</span>, <span class="hljs-number" style="margin:0px; padding:0px">0.5114585757255554</span>),
 (<span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">u'person'</span>, <span class="hljs-number" style="margin:0px; padding:0px">0.5109285116195679</span>)]</code></pre> 
<div class="sourceCode" style="margin:0px; padding:0px; font-family:Verdana,Arial,Helvetica,sans-serif"> 
 <pre><code class="language-python"><code class="sourceCode python hljs" style='margin:auto; vertical-align:middle; display:block; background:rgb(255,255,255); height:auto; overflow-x:auto; padding:5px!important; line-height:1.5!important; font-family:"Courier New",sans-serif!important; border:1px solid rgb(204,204,204)!important'>model.most_similar(<span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">"queen"</span></span>)</code></code></pre> 
</div> 
<pre style="margin-top:10px; margin-bottom:10px; padding:0px; white-space:pre-wrap; word-wrap:break-word; background-color:rgb(255,255,255)"><code class="hljs python" style='margin:auto; vertical-align:middle; display:block; height:auto; overflow-x:auto; padding:5px!important; line-height:1.5!important; font-family:"Courier New",sans-serif!important; border:1px solid rgb(204,204,204)!important'>[(<span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">u'princess'</span>, <span class="hljs-number" style="margin:0px; padding:0px">0.6759523153305054</span>),
 (<span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">u'bride'</span>, <span class="hljs-number" style="margin:0px; padding:0px">0.6207793951034546</span>),
 (<span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">u'belle'</span>, <span class="hljs-number" style="margin:0px; padding:0px">0.6001157760620117</span>),
 (<span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">u'shearer'</span>, <span class="hljs-number" style="margin:0px; padding:0px">0.5995810031890869</span>),
 (<span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">u'stepmother'</span>, <span class="hljs-number" style="margin:0px; padding:0px">0.596365749835968</span>),
 (<span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">u'victoria'</span>, <span class="hljs-number" style="margin:0px; padding:0px">0.5917614698410034</span>),
 (<span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">u'dame'</span>, <span class="hljs-number" style="margin:0px; padding:0px">0.589063286781311</span>),
 (<span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">u'latifah'</span>, <span class="hljs-number" style="margin:0px; padding:0px">0.5790275931358337</span>),
 (<span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">u'countess'</span>, <span class="hljs-number" style="margin:0px; padding:0px">0.5776904821395874</span>),
 (<span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">u'widow'</span>, <span class="hljs-number" style="margin:0px; padding:0px">0.5727116465568542</span>)]</code></pre> 
<div class="sourceCode" style="margin:0px; padding:0px; font-family:Verdana,Arial,Helvetica,sans-serif"> 
 <pre><code class="language-python"><code class="sourceCode python hljs" style='margin:auto; vertical-align:middle; display:block; background:rgb(255,255,255); height:auto; overflow-x:auto; padding:5px!important; line-height:1.5!important; font-family:"Courier New",sans-serif!important; border:1px solid rgb(204,204,204)!important'>model.most_similar(<span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">"awful"</span></span>)</code></code></pre> 
</div> 
<pre style="margin-top:10px; margin-bottom:10px; padding:0px; white-space:pre-wrap; word-wrap:break-word; background-color:rgb(255,255,255)"><code class="hljs python" style='margin:auto; vertical-align:middle; display:block; height:auto; overflow-x:auto; padding:5px!important; line-height:1.5!important; font-family:"Courier New",sans-serif!important; border:1px solid rgb(204,204,204)!important'>[(<span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">u'terrible'</span>, <span class="hljs-number" style="margin:0px; padding:0px">0.7642339468002319</span>),
 (<span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">u'atrocious'</span>, <span class="hljs-number" style="margin:0px; padding:0px">0.7405279874801636</span>),
 (<span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">u'horrible'</span>, <span class="hljs-number" style="margin:0px; padding:0px">0.7376815676689148</span>),
 (<span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">u'abysmal'</span>, <span class="hljs-number" style="margin:0px; padding:0px">0.7010303139686584</span>),
 (<span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">u'dreadful'</span>, <span class="hljs-number" style="margin:0px; padding:0px">0.6942194104194641</span>),
 (<span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">u'appalling'</span>, <span class="hljs-number" style="margin:0px; padding:0px">0.6887971758842468</span>),
 (<span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">u'lousy'</span>, <span class="hljs-number" style="margin:0px; padding:0px">0.6646767854690552</span>),
 (<span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">u'horrid'</span>, <span class="hljs-number" style="margin:0px; padding:0px">0.6554058194160461</span>),
 (<span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">u'horrendous'</span>, <span class="hljs-number" style="margin:0px; padding:0px">0.6533403992652893</span>),
 (<span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">u'amateurish'</span>, <span class="hljs-number" style="margin:0px; padding:0px">0.6079087853431702</span>)]</code></pre> 
<h4 id="使用word2vec特征" style="margin:10px 0px; padding:0px; font-size:16px; line-height:1.5; font-family:Verdana,Arial,Helvetica,sans-serif"> 使用Word2vec特征</h4> 
<div class="sourceCode" style="margin:0px; padding:0px; font-family:Verdana,Arial,Helvetica,sans-serif"> 
 <pre><code class="language-python"><code class="sourceCode python hljs" style='margin:auto; vertical-align:middle; display:block; background:rgb(255,255,255); height:auto; overflow-x:auto; padding:5px!important; line-height:1.5!important; font-family:"Courier New",sans-serif!important; border:1px solid rgb(204,204,204)!important'><span class="kw" style="margin:0px; padding:0px"><span class="hljs-function" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">def</span></span></span><span class="hljs-function" style="margin:0px; padding:0px"> <span class="hljs-title" style="margin:0px; padding:0px; color:rgb(163,21,21)">makeFeatureVec</span><span class="hljs-params" style="margin:0px; padding:0px">(words, model, num_features)</span>:</span>
    <span class="co" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">'''</span></span><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">
</span><span class="co" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">    对段落中的所有词向量进行取平均操作</span></span><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">
</span><span class="co" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">    '''</span></span>
    featureVec <span class="op" style="margin:0px; padding:0px">=</span> np.zeros((num_features,), dtype<span class="op" style="margin:0px; padding:0px">=</span><span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">"float32"</span></span>)
    nwords <span class="op" style="margin:0px; padding:0px">=</span> <span class="dv" style="margin:0px; padding:0px">0</span><span class="hljs-number" style="margin:0px; padding:0px">.</span>

    <span class="co" style="margin:0px; padding:0px"><span class="hljs-comment" style="margin:0px; padding:0px; color:green"># Index2word包含了词表中的所有词，为了检索速度，保存到set中</span></span>
    index2word_set <span class="op" style="margin:0px; padding:0px">=</span> <span class="bu" style="margin:0px; padding:0px">set</span>(model.index2word)
    <span class="cf" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">for</span></span> word <span class="op" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">in</span></span> words:
        <span class="cf" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">if</span></span> word <span class="op" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">in</span></span> index2word_set:
            nwords <span class="op" style="margin:0px; padding:0px">=</span> nwords <span class="op" style="margin:0px; padding:0px">+</span> <span class="dv" style="margin:0px; padding:0px">1</span><span class="hljs-number" style="margin:0px; padding:0px">.</span>
            featureVec <span class="op" style="margin:0px; padding:0px">=</span> np.add(featureVec, model[word])

    <span class="co" style="margin:0px; padding:0px"><span class="hljs-comment" style="margin:0px; padding:0px; color:green"># 取平均</span></span>
    featureVec <span class="op" style="margin:0px; padding:0px">=</span> np.divide(featureVec, nwords)
    <span class="cf" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">return</span></span> featureVec


<span class="kw" style="margin:0px; padding:0px"><span class="hljs-function" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">def</span></span></span><span class="hljs-function" style="margin:0px; padding:0px"> <span class="hljs-title" style="margin:0px; padding:0px; color:rgb(163,21,21)">getAvgFeatureVecs</span><span class="hljs-params" style="margin:0px; padding:0px">(reviews, model, num_features)</span>:</span>
    <span class="co" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">'''</span></span><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">
</span><span class="co" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">    给定一个文本列表，每个文本由一个词列表组成，返回每个文本的词向量平均值</span></span><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">
</span><span class="co" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">    '''</span></span>
    counter <span class="op" style="margin:0px; padding:0px">=</span> <span class="dv" style="margin:0px; padding:0px">0</span><span class="hljs-number" style="margin:0px; padding:0px">.</span>

    reviewFeatureVecs <span class="op" style="margin:0px; padding:0px">=</span> np.zeros((<span class="bu" style="margin:0px; padding:0px">len</span>(reviews), num_features), dtype<span class="op" style="margin:0px; padding:0px">=</span><span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">"float32"</span></span>)

    <span class="cf" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">for</span></span> review <span class="op" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">in</span></span> reviews:
       <span class="cf" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">if</span></span> counter <span class="op" style="margin:0px; padding:0px">%</span> <span class="dv" style="margin:0px; padding:0px">5000</span><span class="hljs-number" style="margin:0px; padding:0px">.</span> <span class="op" style="margin:0px; padding:0px">==</span> <span class="dv" style="margin:0px; padding:0px">0</span><span class="hljs-number" style="margin:0px; padding:0px">.</span>:
           <span class="bu" style="margin:0px; padding:0px">print</span>(<span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">"Review </span></span><span class="sc" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">%d</span></span><span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)"> of </span></span><span class="sc" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">%d</span></span><span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">"</span></span> <span class="op" style="margin:0px; padding:0px">%</span> (counter, <span class="bu" style="margin:0px; padding:0px">len</span>(reviews)))

       reviewFeatureVecs[counter] <span class="op" style="margin:0px; padding:0px">=</span> makeFeatureVec(review, model, <span class="op" style="margin:0px; padding:0px">\</span>
           num_features)

       counter <span class="op" style="margin:0px; padding:0px">=</span> counter <span class="op" style="margin:0px; padding:0px">+</span> <span class="dv" style="margin:0px; padding:0px">1</span><span class="hljs-number" style="margin:0px; padding:0px">.</span>
    <span class="cf" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">return</span></span> reviewFeatureVecs</code></code></pre> 
</div> 
<div class="sourceCode" style="margin:0px; padding:0px; font-family:Verdana,Arial,Helvetica,sans-serif"> 
 <pre><code class="language-python"><code class="sourceCode python hljs" style='margin:auto; vertical-align:middle; display:block; background:rgb(255,255,255); height:auto; overflow-x:auto; padding:5px!important; line-height:1.5!important; font-family:"Courier New",sans-serif!important; border:1px solid rgb(204,204,204)!important'><span class="op" style="margin:0px; padding:0px">%</span>time trainDataVecs <span class="op" style="margin:0px; padding:0px">=</span> getAvgFeatureVecs( train_data, model, num_features )</code></code></pre> 
</div> 
<pre style="margin-top:10px; margin-bottom:10px; padding:0px; white-space:pre-wrap; word-wrap:break-word; background-color:rgb(255,255,255)"><code class="hljs delphi" style='margin:auto; vertical-align:middle; display:block; height:auto; overflow-x:auto; padding:5px!important; line-height:1.5!important; font-family:"Courier New",sans-serif!important; border:1px solid rgb(204,204,204)!important'>Review <span class="hljs-number" style="margin:0px; padding:0px">0</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">of</span> <span class="hljs-number" style="margin:0px; padding:0px">25000</span>
Review <span class="hljs-number" style="margin:0px; padding:0px">5000</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">of</span> <span class="hljs-number" style="margin:0px; padding:0px">25000</span>
Review <span class="hljs-number" style="margin:0px; padding:0px">10000</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">of</span> <span class="hljs-number" style="margin:0px; padding:0px">25000</span>
Review <span class="hljs-number" style="margin:0px; padding:0px">15000</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">of</span> <span class="hljs-number" style="margin:0px; padding:0px">25000</span>
Review <span class="hljs-number" style="margin:0px; padding:0px">20000</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">of</span> <span class="hljs-number" style="margin:0px; padding:0px">25000</span>
CPU times: user <span class="hljs-number" style="margin:0px; padding:0px">1</span>min <span class="hljs-number" style="margin:0px; padding:0px">49</span>s, sys: <span class="hljs-number" style="margin:0px; padding:0px">1.9</span> s, total: <span class="hljs-number" style="margin:0px; padding:0px">1</span>min <span class="hljs-number" style="margin:0px; padding:0px">51</span>s
Wall time: <span class="hljs-number" style="margin:0px; padding:0px">1</span>min <span class="hljs-number" style="margin:0px; padding:0px">54</span>s</code></pre> 
<div class="sourceCode" style="margin:0px; padding:0px; font-family:Verdana,Arial,Helvetica,sans-serif"> 
 <pre><code class="language-python"><code class="sourceCode python hljs" style='margin:auto; vertical-align:middle; display:block; background:rgb(255,255,255); height:auto; overflow-x:auto; padding:5px!important; line-height:1.5!important; font-family:"Courier New",sans-serif!important; border:1px solid rgb(204,204,204)!important'><span class="op" style="margin:0px; padding:0px">%</span>time testDataVecs <span class="op" style="margin:0px; padding:0px">=</span> getAvgFeatureVecs(test_data, model, num_features)</code></code></pre> 
</div> 
<pre style="margin-top:10px; margin-bottom:10px; padding:0px; white-space:pre-wrap; word-wrap:break-word; background-color:rgb(255,255,255)"><code class="hljs delphi" style='margin:auto; vertical-align:middle; display:block; height:auto; overflow-x:auto; padding:5px!important; line-height:1.5!important; font-family:"Courier New",sans-serif!important; border:1px solid rgb(204,204,204)!important'>Review <span class="hljs-number" style="margin:0px; padding:0px">0</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">of</span> <span class="hljs-number" style="margin:0px; padding:0px">25000</span>
Review <span class="hljs-number" style="margin:0px; padding:0px">5000</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">of</span> <span class="hljs-number" style="margin:0px; padding:0px">25000</span>
Review <span class="hljs-number" style="margin:0px; padding:0px">10000</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">of</span> <span class="hljs-number" style="margin:0px; padding:0px">25000</span>
Review <span class="hljs-number" style="margin:0px; padding:0px">15000</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">of</span> <span class="hljs-number" style="margin:0px; padding:0px">25000</span>
Review <span class="hljs-number" style="margin:0px; padding:0px">20000</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">of</span> <span class="hljs-number" style="margin:0px; padding:0px">25000</span>
CPU times: user <span class="hljs-number" style="margin:0px; padding:0px">1</span>min <span class="hljs-number" style="margin:0px; padding:0px">44</span>s, sys: <span class="hljs-number" style="margin:0px; padding:0px">1.56</span> s, total: <span class="hljs-number" style="margin:0px; padding:0px">1</span>min <span class="hljs-number" style="margin:0px; padding:0px">46</span>s
Wall time: <span class="hljs-number" style="margin:0px; padding:0px">1</span>min <span class="hljs-number" style="margin:0px; padding:0px">48</span>s</code></pre> 
<h4 id="高斯贝叶斯word2vec训练" style="margin:10px 0px; padding:0px; font-size:16px; line-height:1.5; font-family:Verdana,Arial,Helvetica,sans-serif"> 高斯贝叶斯+Word2vec训练</h4> 
<div class="sourceCode" style="margin:0px; padding:0px; font-family:Verdana,Arial,Helvetica,sans-serif"> 
 <pre><code class="language-python"><code class="sourceCode python hljs" style='margin:auto; vertical-align:middle; display:block; background:rgb(255,255,255); height:auto; overflow-x:auto; padding:5px!important; line-height:1.5!important; font-family:"Courier New",sans-serif!important; border:1px solid rgb(204,204,204)!important'><span class="im" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">from</span></span> sklearn.naive_bayes <span class="im" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">import</span></span> GaussianNB <span class="im" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">as</span></span> GNB

model_GNB <span class="op" style="margin:0px; padding:0px">=</span> GNB()
model_GNB.fit(trainDataVecs, label)

<span class="im" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">from</span></span> sklearn.cross_validation <span class="im" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">import</span></span> cross_val_score
<span class="im" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">import</span></span> numpy <span class="im" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">as</span></span> np

<span class="bu" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">print</span></span> <span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">"高斯贝叶斯分类器10折交叉验证得分: "</span></span>, np.mean(cross_val_score(model_GNB, trainDataVecs, label, cv<span class="op" style="margin:0px; padding:0px">=</span><span class="dv" style="margin:0px; padding:0px">10</span>, scoring<span class="op" style="margin:0px; padding:0px">=</span><span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">'roc_auc'</span></span>))

result <span class="op" style="margin:0px; padding:0px">=</span> forest.predict( testDataVecs )

output <span class="op" style="margin:0px; padding:0px">=</span> pd.DataFrame( data<span class="op" style="margin:0px; padding:0px">=</span>{<!-- --><span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">"id"</span></span>:test[<span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">"id"</span></span>], <span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">"sentiment"</span></span>:result} )
output.to_csv( <span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">"gnb_word2vec.csv"</span></span>, index<span class="op" style="margin:0px; padding:0px">=</span><span class="va" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">False</span></span>, quoting<span class="op" style="margin:0px; padding:0px">=</span><span class="dv" style="margin:0px; padding:0px">3</span> )</code></code></pre> 
</div> 
<pre style="margin-top:10px; margin-bottom:10px; padding:0px; white-space:pre-wrap; word-wrap:break-word; background-color:rgb(255,255,255)"><code class="hljs css" style='margin:auto; vertical-align:middle; display:block; height:auto; overflow-x:auto; padding:5px!important; line-height:1.5!important; font-family:"Courier New",sans-serif!important; border:1px solid rgb(204,204,204)!important'>多项式贝叶斯分类器10折交叉验证得分:  0<span class="hljs-selector-class" style="margin:0px; padding:0px">.625579296</span></code></pre> 
<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif"> 从验证结果来看，没有超过基于TF-IDF多项式贝叶斯模型</p> 
<h4 id="随机森林word2vec训练" style="margin:10px 0px; padding:0px; font-size:16px; line-height:1.5; font-family:Verdana,Arial,Helvetica,sans-serif"> 随机森林+Word2vec训练</h4> 
<div class="sourceCode" style="margin:0px; padding:0px; font-family:Verdana,Arial,Helvetica,sans-serif"> 
 <pre><code class="language-python"><code class="sourceCode python hljs" style='margin:auto; vertical-align:middle; display:block; background:rgb(255,255,255); height:auto; overflow-x:auto; padding:5px!important; line-height:1.5!important; font-family:"Courier New",sans-serif!important; border:1px solid rgb(204,204,204)!important'><span class="im" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">from</span></span> sklearn.ensemble <span class="im" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">import</span></span> RandomForestClassifier

forest <span class="op" style="margin:0px; padding:0px">=</span> RandomForestClassifier( n_estimators <span class="op" style="margin:0px; padding:0px">=</span> <span class="dv" style="margin:0px; padding:0px">100</span>, n_jobs<span class="op" style="margin:0px; padding:0px">=</span><span class="dv" style="margin:0px; padding:0px">2</span>)

<span class="bu" style="margin:0px; padding:0px">print</span>(<span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">"Fitting a random forest to labeled training data..."</span></span>)
<span class="op" style="margin:0px; padding:0px">%</span>time forest <span class="op" style="margin:0px; padding:0px">=</span> forest.fit( trainDataVecs, label )
<span class="bu" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">print</span></span> <span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">"随机森林分类器10折交叉验证得分: "</span></span>, np.mean(cross_val_score(forest, trainDataVecs, label, cv<span class="op" style="margin:0px; padding:0px">=</span><span class="dv" style="margin:0px; padding:0px">10</span>, scoring<span class="op" style="margin:0px; padding:0px">=</span><span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">'roc_auc'</span></span>))

<span class="co" style="margin:0px; padding:0px"><span class="hljs-comment" style="margin:0px; padding:0px; color:green"># 测试集</span></span>
result <span class="op" style="margin:0px; padding:0px">=</span> forest.predict( testDataVecs )

output <span class="op" style="margin:0px; padding:0px">=</span> pd.DataFrame( data<span class="op" style="margin:0px; padding:0px">=</span>{<!-- --><span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">"id"</span></span>:test[<span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">"id"</span></span>], <span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">"sentiment"</span></span>:result} )
output.to_csv( <span class="st" style="margin:0px; padding:0px"><span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">"rf_word2vec.csv"</span></span>, index<span class="op" style="margin:0px; padding:0px">=</span><span class="va" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,255)">False</span></span>, quoting<span class="op" style="margin:0px; padding:0px">=</span><span class="dv" style="margin:0px; padding:0px">3</span> )</code></code></pre> 
</div> 
<pre style="margin-top:10px; margin-bottom:10px; padding:0px; white-space:pre-wrap; word-wrap:break-word; background-color:rgb(255,255,255)"><code class="hljs groovy" style='margin:auto; vertical-align:middle; display:block; height:auto; overflow-x:auto; padding:5px!important; line-height:1.5!important; font-family:"Courier New",sans-serif!important; border:1px solid rgb(204,204,204)!important'>Fitting a random forest to labeled training data...
CPU <span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">times:</span> user <span class="hljs-number" style="margin:0px; padding:0px">45</span> s, <span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">sys:</span> <span class="hljs-number" style="margin:0px; padding:0px">460</span> ms, <span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">total:</span> <span class="hljs-number" style="margin:0px; padding:0px">45.5</span> s
Wall <span class="hljs-string" style="margin:0px; padding:0px; color:rgb(163,21,21)">time:</span> <span class="hljs-number" style="margin:0px; padding:0px">24.2</span> s
随机森林分类器<span class="hljs-number" style="margin:0px; padding:0px">10</span>折交叉验证得分:  <span class="hljs-number" style="margin:0px; padding:0px">0.648426368</span></code></pre> 
<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif"> 改用随机森林之后，效果有提升，但是依然没有超过基于TF-IDF多项式贝叶斯模型</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/429bfb4f056e66dfb2ebbe2931bf8166/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">codeforces round#420</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e9fa8520b401fb0cb47cb84ad00c03ee/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【OpenCV3学习笔记 】相机标定函数 calibrateCamera( ) 使用详解（附相机标定程序和数据）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>