<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Android终端硬件通讯总结（串口通讯、Usb Com、Usb、蓝牙、Wifi） - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Android终端硬件通讯总结（串口通讯、Usb Com、Usb、蓝牙、Wifi）" />
<meta property="og:description" content="前言 如果你开发的App需要与硬件做通讯，获取相应数据进行业务处理，这个库肯定对你有帮助。常见的硬件通讯连接方式有：串口通讯、Usb Com、Usb、蓝牙（包括BLE）、Wifi等，实际硬件支持哪种连接方式，要看硬件支持哪种方式。应用层硬件通讯方案有两种：
硬件供应商有提供SDK,不需要关注连接通讯实现，直接集成到App中使用即可硬件供应商没有提供SDK，单提供有通讯协议，这时候自己需要分析协议流程和写通讯代码 本文针对第二点，封装了一个基础的、轻量级的通讯库，支持多种连接方式串口通讯、Usb Com、Usb、蓝牙（包括BLE）、Wifi，通讯流程为：
1. 初始化连接实例
2. 打开连接
3. 读写数据
4. 关闭连接
通讯库特点：上层调用一致，底层不同实现，方便使用者切换连接方式。为简化上层调用和方便数据处理，全部连接采用同步操作，即一发一收（一问一答）的方式通讯
调用 1.初始化实例
//串口 BaseConnectProvider baseConnectProvider = new SerialPortConnectProvider(SerialPortConfig serialPortConfig); //Usb Com BaseConnectProvider baseConnectProvider = new UsbComConnectProvider(int vendorId, int productId, SerialPortConfig serialPortConfig); //or BaseConnectProvider baseConnectProvider = new UsbComConnectProvider(UsbDevice usbDevice, SerialPortConfig serialPortConfig); //Usb BaseConnectProvider baseConnectProvider = new UsbConnectProvider(int vendorId, int productId); //or BaseConnectProvider baseConnectProvider = new UsbConnectProvider(UsbDevice usbDevice); //默认蓝牙 Com BaseConnectProvider baseConnectProvider = new BluetoothConnectProvider(BluetoothDevice bluetoothDevice); BaseConnectProvider baseConnectProvider = new BluetoothConnectProvider(String address); //指定蓝牙服务UUID BaseConnectProvider baseConnectProvider = new BluetoothConnectProvider(BluetoothDevice bluetoothDevice, String uuid); BaseConnectProvider baseConnectProvider = new BluetoothConnectProvider(String address, String uuid); //Wifi BaseConnectProvider baseConnectProvider = new WifiConnectProvider(String host, int port, int connectTimeout, int readTimeout); //特别地：蓝牙Ble BluetoothLeConnectProvider connectProvider = new BluetoothLeConnectProvider(BluetoothDevice bluetoothDevice); BluetoothLeConnectProvider connectProvider = new BluetoothLeConnectProvider(String address); 2." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/dcc09041c47517c327f89d32a3a9a889/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-03-18T15:11:04+08:00" />
<meta property="article:modified_time" content="2023-03-18T15:11:04+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Android终端硬件通讯总结（串口通讯、Usb Com、Usb、蓝牙、Wifi）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_0"></a>前言</h3> 
<p>如果你开发的App需要与硬件做通讯，获取相应数据进行业务处理，这个库肯定对你有帮助。常见的硬件通讯连接方式有：串口通讯、Usb Com、Usb、蓝牙（包括BLE）、Wifi等，实际硬件支持哪种连接方式，要看硬件支持哪种方式。应用层硬件通讯方案有两种：</p> 
<ol><li>硬件供应商有提供SDK,不需要关注连接通讯实现，直接集成到App中使用即可</li><li>硬件供应商没有提供SDK，单提供有通讯协议，这时候自己需要分析协议流程和写通讯代码</li></ol> 
<p>本文针对第二点，封装了一个基础的、轻量级的通讯库，支持多种连接方式串口通讯、Usb Com、Usb、蓝牙（包括BLE）、Wifi，通讯流程为：</p> 
<p><strong>1. 初始化连接实例</strong><br> <strong>2. 打开连接</strong><br> <strong>3. 读写数据</strong><br> <strong>4. 关闭连接</strong></p> 
<p>通讯库特点：上层调用一致，底层不同实现，方便使用者切换连接方式。为简化上层调用和方便数据处理，全部连接采用同步操作，即一发一收（一问一答）的方式通讯</p> 
<h3><a id="_17"></a>调用</h3> 
<p><strong>1.初始化实例</strong></p> 
<pre><code>//串口
BaseConnectProvider baseConnectProvider = new SerialPortConnectProvider(SerialPortConfig serialPortConfig);

//Usb Com
BaseConnectProvider baseConnectProvider = new UsbComConnectProvider(int vendorId, int productId, SerialPortConfig serialPortConfig);
//or
BaseConnectProvider baseConnectProvider = new UsbComConnectProvider(UsbDevice usbDevice, SerialPortConfig serialPortConfig);

//Usb
BaseConnectProvider baseConnectProvider = new UsbConnectProvider(int vendorId, int productId);
//or
BaseConnectProvider baseConnectProvider = new UsbConnectProvider(UsbDevice usbDevice);

//默认蓝牙 Com
BaseConnectProvider baseConnectProvider = new BluetoothConnectProvider(BluetoothDevice bluetoothDevice);
BaseConnectProvider baseConnectProvider = new BluetoothConnectProvider(String address);
//指定蓝牙服务UUID
BaseConnectProvider baseConnectProvider = new BluetoothConnectProvider(BluetoothDevice bluetoothDevice, String uuid);
BaseConnectProvider baseConnectProvider = new BluetoothConnectProvider(String address, String uuid);

//Wifi
BaseConnectProvider baseConnectProvider = new WifiConnectProvider(String host, int port, int connectTimeout, int readTimeout);

//特别地：蓝牙Ble
BluetoothLeConnectProvider connectProvider = new BluetoothLeConnectProvider(BluetoothDevice bluetoothDevice);
BluetoothLeConnectProvider connectProvider = new BluetoothLeConnectProvider(String address);
</code></pre> 
<p><strong>2.打开连接</strong></p> 
<pre><code>baseConnectProvider.open();
</code></pre> 
<p><strong>3.写和读数据</strong></p> 
<pre><code>baseConnectProvider.read(byte[] sendParams, byte[] buffer, int timeout);
</code></pre> 
<p><strong>3.1 蓝牙Ble通讯</strong></p> 
<p>蓝牙Ble,与其它连接方式不好统一，故做特殊处理</p> 
<pre><code>//特征写请求,其它请求创建不同的实例发送即可
CharacteristicWriteRequest bluetoothLeRequest = new CharacteristicWriteRequest();
bluetoothLeRequest.setService(UUID_SERVICE);
bluetoothLeRequest.setCharacter(UUID_CHARACTER_WRITE);
bluetoothLeRequest.setBytes(sendData);
BluetoothLeResponse response = new BluetoothLeResponse();
bluetoothLeRequest.sendRequest(bluetoothLeRequest,response,5*1000);

//蓝牙ble监听服务端(也叫从机/外围设备/peripheral)数据，分两步操作

//1.监听通知信息
 bluetoothLeConnectProvider.setBluetoothLeNotifyListener(new BluetoothLeNotifyListener() {
                        @Override
                        public void onNotify(UUID serviceId, UUID characterId, byte[] value) {
                            
                        }
                    });
//2.开启通知
NotifyRequest notifyRequest = new NotifyRequest();
notifyRequest.setService(UUID_SERVICE);
notifyRequest.setCharacter(UUID_CHARACTER_READ);
notifyRequest.setEnable(true);
BluetoothLeResponse response = new BluetoothLeResponse();
bluetoothLeConnectProvider.sendRequest(notifyRequest,response,5*1000);
</code></pre> 
<p><strong>4.关闭连接</strong></p> 
<pre><code>baseConnectProvider.close();
</code></pre> 
<h3><a id="_91"></a>小结</h3> 
<p>上面只是陈述了简单调用流程，实际使用要注意组装命令的格式是否正确，设备连接参数，数据转换等等，特别注意的是:不用连接实例的时候，要关闭连接，避免fd泄露，导致应用崩溃。</p> 
<h3><a id="_95"></a>更多用法参考</h3> 
<p><a href="https://github.com/kellysong/DeviceConnector">DeviceConnector</a>，欢迎star<br> 注：V1.1.0版本开始支持低功耗蓝牙</p> 
<h3><a id="PCBus_Hound_100"></a>PC端数据包监控工具-Bus Hound</h3> 
<p>Bus hound是一款为了在pc电脑上进行总线数据包监控以及操控的开发工具。用来捕捉来自设备的协议包和输入输出操作，它是功能强大的总线协议分析器</p> 
<p>支持监听：</p> 
<p>USB 1.0 - 4.0<br> NVMe<br> SATA &amp; IDE<br> SCSI &amp; ATAPI<br> FireWire, 1394A/B<br> Bluetooth<br> Fibre Channel<br> iSCSI, SAS<br> PC Card, PCMCIA<br> serial port<br> parallel port<br> ps/2 ports</p> 
<p>下载地址：<a href="https://perisoft.net/bushound/index.htm" rel="nofollow">https://perisoft.net/bushound/index.htm</a></p> 
<p>更多文章：</p> 
<p><a href="https://blog.csdn.net/u011082160/article/details/109963845?spm=1001.2014.3001.5502">关于Android终端机串口的理解</a><br> <a href="https://blog.csdn.net/u011082160/article/details/128207734">串口通信扩展知识</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0f3f00c9f363a584636c7322c0e0b2b8/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">解决 Cannot find any provider supporting AES/ECB/PKCS7Padding</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a5a23acd6dd19fb7e6f364cad4199beb/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【pyhton】遍历文件夹</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>