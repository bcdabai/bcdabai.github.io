<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>nginx配置ssl证书实现https访问 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="nginx配置ssl证书实现https访问" />
<meta property="og:description" content="配置ssl证书之前，先准备SSL证书，至于获取的途径很多（阿里云的服务，第三方服务购买）。这里不详细解释。以下是我的SSL证书
准备好证书后，找到nginx的安装目录，我的安装位置为：/usr/local/nginx
进入 config/nginx.conf
如果没有装winscp（一款可视化文件操作工具）的。可以通过命令行的方式，编辑nginx的config文件。
开始配置文件的修改 在修改配置文件之前，最好做一个备份，防止修改错误，也能及时回退错误
1、找到第一个监听80端口的server:一下是我修改好的server server { listen 80; server_name 需要访问的域名; rewrite ^(.*) https://servernameservername1 permanent; #这句是代表 把http的域名请求转成https #charset koi8-r; #access_log logs/host.access.log main; location / { root html; index index.html index.htm; proxy_pass http://需要访问的域名; #因为这里还是80端口，所以保持http就可以了 } } 在实际的配置文件中，最好把我上面的备注删除
2、第一个server修改好了之后。那么就需要开始配置第二个server。拉到文件的底部。看到有一个https类型的server。而且已经全部被注释封上了，这是我们需要改的第二个server，如图： 这里除了HTTPS server这行之外，其他的 # 删除，启动https模块
# HTTPS server # server { listen 443 ssl; server_name 需要访问的域名，这里也不用加https; ssl on; ssl_certificate /usr/local/nginx/ssl/ssl.pem; #这里是ssl key文件存放的绝对路径，根据自己的文件名称和路径来写 ssl_certificate_key /usr/local/nginx/ssl/ssl.key; #这里是ssl key文件存放的绝对路径，根据自己的文件名称和路径来写 ssl_session_cache shared:SSL:1m; ssl_session_timeout 5m; ssl_ciphers HIGH:!" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/3ef4dc01dc4af067e3155615d1cd125d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-06-04T07:37:49+08:00" />
<meta property="article:modified_time" content="2021-06-04T07:37:49+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">nginx配置ssl证书实现https访问</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>配置ssl证书之前，先准备SSL证书，至于获取的途径很多（阿里云的服务，第三方服务购买）。这里不详细解释。以下是我的SSL证书</p> 
<p><img alt="" src="https://images2.imgbox.com/bf/e5/SVPDDc65_o.png"></p> 
<p> </p> 
<p><br> 准备好证书后，找到nginx的安装目录，我的安装位置为：/usr/local/nginx</p> 
<p><img alt="" src="https://images2.imgbox.com/78/be/dE93x93E_o.png"></p> 
<p> </p> 
<p><br> 进入 config/nginx.conf<br> 如果没有装winscp（一款可视化文件操作工具）的。可以通过命令行的方式，编辑nginx的config文件。</p> 
<h2>开始配置文件的修改</h2> 
<p><br> 在修改配置文件之前，最好做一个备份，防止修改错误，也能及时回退错误</p> 
<h3>1、找到第一个监听80端口的server:一下是我修改好的server</h3> 
<pre><code class="language-Groovy">server {
listen 80;
server_name 需要访问的域名;

rewrite ^(.*) https://servernameservername1 permanent; #这句是代表 把http的域名请求转成https

#charset koi8-r;
#access_log logs/host.access.log main;
location / {
root html;
index index.html index.htm;
proxy_pass http://需要访问的域名; #因为这里还是80端口，所以保持http就可以了

}
}</code></pre> 
<p><br><br> 在实际的配置文件中，最好把我上面的备注删除</p> 
<h3>2、第一个server修改好了之后。那么就需要开始配置第二个server。拉到文件的底部。看到有一个https类型的server。而且已经全部被注释封上了，这是我们需要改的第二个server，如图：</h3> 
<p><img alt="" src="https://images2.imgbox.com/03/f4/2KjMIqZw_o.png"></p> 
<p> </p> 
<p><br> 这里除了HTTPS server这行之外，其他的 # 删除，启动https模块</p> 
<pre><code class="language-Groovy"># HTTPS server
#
server {
listen 443 ssl;
server_name 需要访问的域名，这里也不用加https;

ssl on;

ssl_certificate /usr/local/nginx/ssl/ssl.pem; #这里是ssl key文件存放的绝对路径，根据自己的文件名称和路径来写
ssl_certificate_key /usr/local/nginx/ssl/ssl.key; #这里是ssl key文件存放的绝对路径，根据自己的文件名称和路径来写

ssl_session_cache shared:SSL:1m;
ssl_session_timeout 5m;

ssl_ciphers HIGH:!aNULL:!MD5;
ssl_prefer_server_ciphers on;

location / {
proxy_pass http://需要访问的域名:8080/;
}
}</code></pre> 
<p><br><br> 配置好后，nginx的配置就算是完成了。不过这只是配置ssl证书的第一步！</p> 
<h2>接下来就是要让配置文件生效：</h2> 
<h3>1、进去nginx的sbin文件夹，我的sbin文件夹在：/usr/local/nginx/sbin</h3> 
<p><br> 执行以下语句：检验配置文件是否有错误</p> 
<p>./nginx -t<br><br> 如果nginx曾经安装过SSL模块，那么应该会显示以下界面：（如果已经显示配置成功，那么可以跳过这一步，直接重启nginx就可以了）<br><img alt="" src="https://images2.imgbox.com/5e/18/8flb3uOf_o.png"></p> 
<p> </p> 
<p><br> 可是大多数第一次安装https证书，都会报错，说缺少SSL模块，如下：</p> 
<p><img alt="" src="https://images2.imgbox.com/01/7e/pVUYEr1M_o.png"></p> 
<p> </p> 
<h3><br> 2、这时候我们就可以先安装SSL模块：</h3> 
<p><br> 先确认2个位置：<br> 1）我的nginx是安装在了/usr/local/nginx/下<br> 2）我的nginx的源码包放在了/usr/local/nginx/nginx/nginx-1.8.0下。如果没有的话，重新下载你对应的nginx版本的源码包，找个目录解压</p> 
<h3>3、目录切换到我们的源码包安装位置：</h3> 
<p>cd /usr/local/nginx/nginx/nginx-1.8.0</p> 
<h3><br><br> 4、执行语句，重新安装ssl模块：</h3> 
<p>./configure --prefix=/usr/local/nginx --with-http_stub_status_module --with-http_ssl_module<br> 这时候可能又会有点小插曲，启动ssl模块的时候，报错了：<br><img alt="" src="https://images2.imgbox.com/26/96/7oC8krnz_o.png"></p> 
<p> </p> 
<p><br> 看到了error。就知道linux安装失败，停止了。这个错误是因为我们没有安装openssl openssl-devel（如果这一步没有报错的话，可以跳过下面的安装openssl-devel的步骤）</p> 
<h3>5、那么可以先执行安装openssl openssl-devel语句：</h3> 
<p> </p> 
<p>yum -y install openssl openssl-devel<br><br> 安装上了 openssl-devel后，重新执行：./configure --prefix=/usr/local/nginx --with-http_stub_status_module --with-http_ssl_module</p> 
<h3>6、这时候应该就执行配置成功了。配置成功后，那么就需要编译我们的配置。（注意这里只能用make 而不要用make install，因为执行make install是覆盖安装的意思）</h3> 
<p><br> 运行：</p> 
<p>make<br><br> 等待执行完成后，我们需要把新编译的nginx模块替换原来的nginx。</p> 
<h3>7、还是老规矩，先备份旧的nginx，执行语句（这里面复制的文件的路径需要根据你们安装的目录自行修改，如果和我安装的路径是一样的那么可以直接运行该语句）：</h3> 
<p> </p> 
<p>cp /usr/local/nginx/sbin/nginx /usr/local/nginx/sbin/nginx.bak</p> 
<h3><br> 8、关闭nginx（因为要把新的模块覆盖旧的nginx）</h3> 
<p> </p> 
<p>先找到nginx端口号，如图，目前我nginx的进程号为：13542</p> 
<p>ps -ef|grep nginx<br><br><img alt="" src="https://images2.imgbox.com/3a/24/boe7GUvO_o.png"></p> 
<p> </p> 
<p><br> 杀死该进程就可以了，执行语句：</p> 
<p>kill -QUIT 13542</p> 
<h3><br><br> 9、关闭nginx进程后就可以开始替换了（注意：我当前的位置是在我nginx的源码包中，目录不要搞错了）</h3> 
<p><br><img alt="" src="https://images2.imgbox.com/82/e6/DtxTqKFb_o.png"></p> 
<p> </p> 
<p><br> 执行：（复制到我的nginx的目录中）</p> 
<p>cp ./objs/nginx /usr/local/nginx/sbin/<br><br> 然后就是启动nginx。在启动之前，也可以在测试一次配置文件是否已经生效：</p> 
<p>#先切换到sbin目录<br> cd /usr/local/nginx/sbin/<br> #检测nginx的配置文件是否有错误<br> ./niginx -t<br><br> 看到这样的，就是已经成功了</p> 
<p><img alt="" src="https://images2.imgbox.com/82/39/olRCkwY1_o.png"></p> 
<p> </p> 
<p><br> 最后启动nginx：</p> 
<p>/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf<br><br> 因为刚才替换nginx模块的时候是把nginx进程都杀死了，所以要用上面的命令进行启动，而不能使用reload重启。</p> 
<p>nginx正常启动后，我们在访问我们的网站，发现https就已经配置好了：</p> 
<p><img alt="" src="https://images2.imgbox.com/dd/a2/FCilmvNB_o.png"></p> 
<p> </p> 
<p><br> 小拓展：<br> 刚才配置nginx的时候是直接在配置文件上做修改，其实我们可以把小的配置抽离出去，尽量保持原配置文件不被修改</p> 
<p>我们可以在原有配置文件中，加上这句（注意作用域范围，是引入到http的｛｝之内）：</p> 
<p>include vhost/*.conf;<br><img alt="" src="https://images2.imgbox.com/b0/be/lU4Y4uvo_o.png"></p> 
<p> </p> 
<p><br> 接下来，需要找到对应的配置文件，因为我们这里的路径是直接 vhost。所以在配置文件同级目录，新建一个 vhost 文件夹，而且我们引入的是 *.conf 。意思就是引入vhost中所有后缀是.conf的配置文件：</p> 
<p><br> 在配置文件中，加上我们刚才教程提到的配置：</p> 
<pre><code class="language-Groovy">server {
listen 80;
server_name 需要访问的域名（不加http头）;

rewrite ^(.*) https://servernameservername1 permanent;

#charset koi8-r;
#access_log logs/host.access.log main;
location / {
root html;
index index.html index.htm;
proxy_pass http://需要访问的域名

}
}

# HTTPS server
#
server {
listen 443 ssl;
server_name 需要访问的域名;

ssl on;

ssl_certificate /usr/local/nginx/ssl/ssl.pem;
ssl_certificate_key /usr/local/nginx/ssl/ssl.key;

ssl_session_cache shared:SSL:1m;
ssl_session_timeout 5m;

ssl_ciphers HIGH:!aNULL:!MD5;
ssl_prefer_server_ciphers on;

location / {
proxy_pass http://需要访问的域名:8080/;
}
}</code></pre> 
<p><br><br> 保存后，也是使用nginx -t测试配置文件是否成功，成功后重启nginx即可。</p> 
<p>如果有多个二级域名，那么就复制多份 xx.conf文件即可，配置文件会自动引入到nginx的配置中，不过每次新增配置文件都需要检测一遍，然后重启nginx<br>  </p> 
<p>热爱世间万物，没例外，没最爱。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6715d3079dd6a98bc9ec6a2c2453a57c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">如何取消html5微信页面授权,微信授权管理在哪里？查看微信授权过的第三方应用并取消授权的方法图解...</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/bd648c2f630901b5bca8f14666afb0b4/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">爬取某小说榜单爬虫及可视化分析</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>