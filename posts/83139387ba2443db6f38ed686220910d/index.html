<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>oracle常用命令行&lt;2&gt; - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="oracle常用命令行&lt;2&gt;" />
<meta property="og:description" content="/申明：该文章为自己学习时查漏补缺所用，不足之处请见谅。/
—视图
—视图的概念：视图就是提供一个查询的窗口，所有数据来自于原表。
—查询语句创建表
create table emp as select * from scott.emp;
select * from emp;
—创建视图【必须有dba权限】
create view v_emp as select ename, job from emp;
—查询视图
select * from v_emp;
—修改视图[不推荐]
update v_emp set job=‘CLERK’ where ename=‘ALLEN’;
commit;
—创建只读视图
create view v_emp1 as select ename, job from emp with read only;
—视图的作用？
—第一：视图可以屏蔽掉一些敏感字段。
—第二：保证总部和分部数据及时统一。
—索引
–索引的概念：索引就是在表的列上构建一个二叉树
----达到大幅度提高查询效率的目的，但是索引会影响增删改的效率。
—单列索引
—创建单列索引
create index idx_ename on emp(ename);
—单列索引触发规则，条件必须是索引列中的原始值。
—单行函数，模糊查询，都会影响索引的触发。
select * from emp where ename=‘SCOTT’" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/83139387ba2443db6f38ed686220910d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-11-04T20:28:35+08:00" />
<meta property="article:modified_time" content="2019-11-04T20:28:35+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">oracle常用命令行&lt;2&gt;</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>/<em>申明：该文章为自己学习时查漏补缺所用，不足之处请见谅。</em>/</p> 
<p>—视图<br> —视图的概念：视图就是提供一个查询的窗口，所有数据来自于原表。</p> 
<p>—查询语句创建表<br> create table emp as select * from scott.emp;<br> select * from emp;<br> —创建视图【必须有dba权限】<br> create view v_emp as select ename, job from emp;<br> —查询视图<br> select * from v_emp;<br> —修改视图[不推荐]<br> update v_emp set job=‘CLERK’ where ename=‘ALLEN’;<br> commit;<br> —创建只读视图<br> create view v_emp1 as select ename, job from emp with read only;<br> —视图的作用？<br> —第一：视图可以屏蔽掉一些敏感字段。<br> —第二：保证总部和分部数据及时统一。</p> 
<p>—索引<br> –索引的概念：索引就是在表的列上构建一个二叉树<br> ----达到大幅度提高查询效率的目的，但是索引会影响增删改的效率。<br> —单列索引<br> —创建单列索引<br> create index idx_ename on emp(ename);<br> —单列索引触发规则，条件必须是索引列中的原始值。<br> —单行函数，模糊查询，都会影响索引的触发。<br> select * from emp where ename=‘SCOTT’<br> —复合索引<br> —创建复合索引<br> create index idx_enamejob on emp(ename, job);<br> —复合索引中第一列为优先检索列<br> —如果要触发复合索引，必须包含有优先检索列中的原始值。<br> select * from emp where ename=‘SCOTT’ and job=‘xx’;—触发复合索引<br> select * from emp where ename=‘SCOTT’ or job=‘xx’;—不触发索引<br> select * from emp where ename=‘SCOTT’;—触发单列索引。</p> 
<p>—pl/sql编程语言<br> —pl/sql编程语言是对sql语言的扩展，使得sql语言具有过程化编程的特性。<br> —pl/sql编程语言比一般的过程化编程语言，更加灵活高效。<br> —pl/sql编程语言主要用来编写存储过程和存储函数等。</p> 
<p>—声明方法<br> —赋值操作可以使用:=也可以使用into查询语句赋值<br> declare<br> i number(2) := 10;<br> s varchar2(10) := ‘小明’;<br> ena emp.ename%type;—引用型变量<br> emprow emp%rowtype;—记录型变量<br> begin<br> dbms_output.put_line(i);<br> dbms_output.put_line(s);<br> select ename into ena from emp where empno = 7788;<br> dbms_output.put_line(ena);<br> select * into emprow from emp where empno = 7788;<br> dbms_output.put_line(emprow.ename || ‘的工作为：’ || emprow.job);<br> end;</p> 
<p>—pl/sql中的if判断<br> —输入小于18的数字，输出未成年<br> —输入大于18小于40的数字，输出中年人<br> —输入大于40的数字，输出老年人<br> declare<br> i number(3) := ⅈ<br> begin<br> if i&lt;18 then<br> dbms_output.put_line(‘未成年’);<br> elsif i&lt;40 then<br> dbms_output.put_line(‘中年人’);<br> else<br> dbms_output.put_line(‘老年人’);<br> end if;<br> end;</p> 
<p>—pl/sql中的loop循环<br> —用三种方式输出1到10是个数字<br> —while循环<br> declare<br> i number(2) := 1;<br> begin<br> while i&lt;11 loop<br> dbms_output.put_line(i);<br> i := i+1;<br> end loop;<br> end;<br> —exit循环<br> declare<br> i number(2) := 1;<br> begin<br> loop<br> exit when i&gt;10;<br> dbms_output.put_line(i);<br> i := i+1;<br> end loop;<br> end;<br> —for循环<br> declare</p> 
<p>begin<br> for i in 1…10 loop<br> dbms_output.put_line(i);<br> end loop;<br> end;</p> 
<p>—游标：可以存放多个对象，多行记录。<br> —输出emp表中所有员工的姓名<br> declare<br> cursor c1 is select * from emp;<br> emprow emp%rowtype;<br> begin<br> open c1;<br> loop<br> fetch c1 into emprow;<br> exit when c1%notfound;<br> dbms_output.put_line(emprow.ename);<br> end loop;<br> close c1;<br> end;</p> 
<p>-----给指定部门员工涨工资<br> declare<br> cursor c2(eno emp.deptno%type)<br> is select empno from emp where deptno = eno;<br> en emp.empno%type;<br> begin<br> open c2(10);<br> loop<br> fetch c2 into en;<br> exit when c2%notfound;<br> update emp set sal=sal+100 where empno=en;<br> commit;<br> end loop;<br> close c2;<br> end;<br> ----查询10号部门员工信息<br> select * from emp where deptno = 10;</p> 
<p>—存储过程<br> –存储过程：存储过程就是提前已经编译好的一段pl/sql语言，放置在数据库端<br> --------可以直接被调用。这一段pl/sql一般都是固定步骤的业务。<br> ----给指定员工涨100块钱<br> create or replace procedure p1(eno emp.empno%type)<br> is</p> 
<p>begin<br> update emp set sal=sal+100 where empno = eno;<br> commit;<br> end;</p> 
<p>select * from emp where empno = 7788;<br> ----测试p1<br> declare</p> 
<p>begin<br> p1(7788);<br> end;</p> 
<p>----通过存储函数实现计算指定员工的年薪<br> ----存储过程和存储函数的参数都不能带长度<br> ----存储函数的返回值类型不能带长度<br> create or replace function f_yearsal(eno emp.empno%type) return number<br> is<br> s number(10);<br> begin<br> select sal*12+nvl(comm, 0) into s from emp where empno = eno;<br> return s;<br> end;</p> 
<p>----测试f_yearsal<br> ----存储函数在调用的时候，返回值需要接收。<br> declare<br> s number(10);<br> begin<br> s := f_yearsal(7788);<br> dbms_output.put_line(s);<br> end;</p> 
<p>—out类型参数如何使用<br> —使用存储过程来算年薪<br> create or replace procedure p_yearsal(eno emp.empno%type, yearsal out number)<br> is<br> s number(10);<br> c emp.comm%type;<br> begin<br> select sal*12, nvl(comm, 0) into s, c from emp where empno = eno;<br> yearsal := s+c;<br> end;</p> 
<p>—测试p_yearsal<br> declare<br> yearsal number(10);<br> begin<br> p_yearsal(7788, yearsal);<br> dbms_output.put_line(yearsal);<br> end;</p> 
<p>----in和out类型参数的区别是什么？<br> —凡是涉及到into查询语句赋值或者:=赋值操作的参数，都必须使用out来修饰。</p> 
<p>—存储过程和存储函数的区别<br> —语法区别：关键字不一样，<br> ------------存储函数比存储过程多了两个return。<br> —本质区别：存储函数有返回值，而存储过程没有返回值。<br> ----------如果存储过程想实现有返回值的业务，我们就必须使用out类型的参数。<br> ----------即便是存储过程使用了out类型的参数，起本质也不是真的有了返回值，<br> ----------而是在存储过程内部给out类型参数赋值，在执行完毕后，我们直接拿到输出类型参数的值。</p> 
<p>----我们可以使用存储函数有返回值的特性，来自定义函数。<br> ----而存储过程不能用来自定义函数。<br> ----案例需求：查询出员工姓名，员工所在部门名称。<br> ----案例准备工作：把scott用户下的dept表复制到当前用户下。<br> create table dept as select * from scott.dept;<br> ----使用传统方式来实现案例需求<br> select e.ename, d.dname<br> from emp e, dept d<br> where e.deptno=d.deptno;<br> ----使用存储函数来实现提供一个部门编号，输出一个部门名称。<br> create or replace function fdna(dno dept.deptno%type) return dept.dname%type<br> is<br> dna dept.dname%type;<br> begin<br> select dname into dna from dept where deptno = dno;<br> return dna;<br> end;<br> —使用fdna存储函数来实现案例需求：查询出员工姓名，员工所在部门名称。<br> select e.ename, fdna(e.deptno)<br> from emp e;</p> 
<p>—触发器，就是制定一个规则，在我们做增删改操作的时候，<br> ----只要满足该规则，自动触发，无需调用。<br> ----语句级触发器：不包含有for each row的触发器。<br> ----行级触发器：包含有for each row的就是行级触发器。<br> -----------加for each row是为了使用:old或者:new对象或者一行记录。</p> 
<p>—语句级触发器<br> ----插入一条记录，输出一个新员工入职<br> create or replace trigger t1<br> after<br> insert<br> on person<br> declare</p> 
<p>begin<br> dbms_output.put_line(‘一个新员工入职’);<br> end;<br> —触发t1<br> insert into person values (1, ‘小红’);<br> commit;<br> select * from person;</p> 
<p>—行级别触发器<br> —不能给员工降薪<br> —raise_application_error(-20001~-20999之间, ‘错误提示信息’);<br> create or replace trigger t2<br> before<br> update<br> on emp<br> for each row<br> declare</p> 
<p>begin<br> if :old.sal&gt;:new.sal then<br> raise_application_error(-20001, ‘不能给员工降薪’);<br> end if;<br> end;<br> ----触发t2<br> select * from emp where empno = 7788;<br> update emp set sal=sal-1 where empno = 7788;<br> commit;</p> 
<p>----触发器实现主键自增。【行级触发器】<br> —分析：在用户做插入操作的之前，拿到即将插入的数据，<br> ------给该数据中的主键列赋值。<br> create or replace trigger auid<br> before<br> insert<br> on person<br> for each row<br> declare</p> 
<p>begin<br> select s_person.nextval into :new.pid from dual;<br> end;<br> –查询person表数据<br> select * from person;<br> —使用auid实现主键自增<br> insert into person (pname) values (‘a’);<br> commit;<br> insert into person values (1, ‘b’);<br> commit;</p> 
<p>----oracle10g ojdbc14.jar<br> ----oracle11g ojdbc6.jar</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/70e24f0041827ce33a6639ec9a5b6e26/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Lua的学习-4-Table 表</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/471bd1b438e7babe67a9cdb435c69bdd/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Linux安装（CentOS7）与最小化安装配置</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>