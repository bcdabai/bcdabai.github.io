<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Nginx的重写功能——Rewrite - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Nginx的重写功能——Rewrite" />
<meta property="og:description" content="目录
Nginx常见模块
nginx内置模块
nginx配置文件的常见模块
location模块
常见的正则表达式
location常用的匹配规则 Rewrite模块 Rewrite功能
Rewrite跳转场景
Rewrite跳转实现
语法格式
基于旧域名跳转到新域名
基于客户端IP访问跳转
基于参数匹配的跳转
基于旧域名跳转到新域名
基于 目录下所有的php文件
基于普通的一条url
Nginx常见模块 nginx内置模块 nginx作为低资源低能耗高性能的一个web服务，它的模块相对于apache少，但是nginx他是高度模块化的设计，编写模块相对简单。下面就了解一下nginx的模块吧
官方文档地址
nginx documentationhttps://nginx.org/en/docs/一共有四大模块
第一块模块主要就是一些索引和核心功能的介绍
第二块模块，基于http操作和功能
第三块模块是邮箱代理
第四块模块就是基于tcp协议的stream（数据流）模块
觉得nginx还是很友好的吧，就四个模块，哈哈哈可是全拿下可不是很容易哦
Nginx_http常用模块
ngx_http_core_module 模块是 nginx 的核心模块，该模块提供了很多 http 代理基础功能
ngx_http_access_module 允许限制访问某些客户端地址。访问也可以通过密码，子请求的结果或JWT进行限制。通过地址和密码同时限制访问受到满足指令的控制。​​​​
ngx_http_gzip_module 模块是一个使用了 gzip 方法压缩响应的过滤器。有助于将传输数据的大小减少一半甚至更多。
ngx_http_ssl_module 模块为HTTPS提供了必要的支持。该模块不是默认生成的，它应该使用--with-http_ssl_module配置参数启用。为了减少处理器负载，建议使用
ngx_http_proxy_module 允许将请求传递给另一台服务器。常见于实现反向代理服务器。
ngx_http_rewrite_module 模块用于使用PCRE正则表达式更改请求URI，返回重定向并有条件地选择配置。
ngx_http_upstream_module 该模块用户分发到不同的服务器节点。支持由proxy_pass, fastcgi_pass, uwsgi_pass, scgi_pass, memcached_pass, grpc_pass等的服务器组。
ngx_http_log_module 模块以指定的格式写入请求日志。
ngx_http_stub_status_module 模块提供对基本状态信息的访问
ngx_http_auth_basic_module 模块允许通过使用“HTTP基本认证”协议验证用户名和密码来限制对资源的访问。
nginx配置文件的常见模块 http
http块是Nginx服务器配置中的重要部分，代理、缓存和日志定义等绝大多数的功能和第三方模块的配置都可以放在这模块中。作用包括：文件引入、MIME-Type定义、日志自定义、是否使用sendfile传输文件、连接超时时间、单连接请求数上限等。
server
server块，虚拟主机（虚拟服务器）。作用：使得Nginx服务器可以在同一台服务器上只要运行一组Nginx进程，就可以运行多个网站。
location
location块是server块的一个指令。作用：基于Nginx服务器接收到的请求字符串，虚拟主机名称（ip，域名）、url匹配，对特定请求进行处理。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/ddfa80e45d6bff4eaa585b81bad711e9/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-11-14T21:57:39+08:00" />
<meta property="article:modified_time" content="2021-11-14T21:57:39+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Nginx的重写功能——Rewrite</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="-toc" style="margin-left:0px;"></p> 
<p id="Nginx%E5%B8%B8%E8%A7%81%E6%A8%A1%E5%9D%97-toc" style="margin-left:0px;"><a href="#Nginx%E5%B8%B8%E8%A7%81%E6%A8%A1%E5%9D%97" rel="nofollow" title="Nginx常见模块">Nginx常见模块</a></p> 
<p id="%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20nginx%E5%86%85%E7%BD%AE%E6%A8%A1%E5%9D%97-toc" style="margin-left:40px;"><a href="#%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20nginx%E5%86%85%E7%BD%AE%E6%A8%A1%E5%9D%97" rel="nofollow" title="        nginx内置模块">        nginx内置模块</a></p> 
<p id="%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%C2%A0%20nginx%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%9A%84%E5%B8%B8%E8%A7%81%E6%A8%A1%E5%9D%97-toc" style="margin-left:80px;"><a href="#%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%C2%A0%20nginx%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%9A%84%E5%B8%B8%E8%A7%81%E6%A8%A1%E5%9D%97" rel="nofollow" title="                 nginx配置文件的常见模块">                 nginx配置文件的常见模块</a></p> 
<p id="%C2%A0location%E6%A8%A1%E5%9D%97-toc" style="margin-left:0px;"><a href="#%C2%A0location%E6%A8%A1%E5%9D%97" rel="nofollow" title=" location模块"> location模块</a></p> 
<p id="%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%E5%B8%B8%E8%A7%81%E7%9A%84%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F-toc" style="margin-left:80px;"><a href="#%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%E5%B8%B8%E8%A7%81%E7%9A%84%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F" rel="nofollow" title="                 常见的正则表达式">                 常见的正则表达式</a></p> 
<p id="%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20location%E5%B8%B8%E7%94%A8%E7%9A%84%E5%8C%B9%E9%85%8D%E8%A7%84%E5%88%99%C2%A0-toc" style="margin-left:80px;"><a href="#%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20location%E5%B8%B8%E7%94%A8%E7%9A%84%E5%8C%B9%E9%85%8D%E8%A7%84%E5%88%99%C2%A0" rel="nofollow" title="                location常用的匹配规则 ">                location常用的匹配规则 </a></p> 
<p id="Rewrite%E6%A8%A1%E5%9D%97%C2%A0-toc" style="margin-left:0px;"><a href="#Rewrite%E6%A8%A1%E5%9D%97%C2%A0" rel="nofollow" title="Rewrite模块 ">Rewrite模块 </a></p> 
<p id="%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20Rewrite%E5%8A%9F%E8%83%BD-toc" style="margin-left:40px;"><a href="#%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20Rewrite%E5%8A%9F%E8%83%BD" rel="nofollow" title="        Rewrite功能">        Rewrite功能</a></p> 
<p id="%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0Rewrite%E8%B7%B3%E8%BD%AC%E5%9C%BA%E6%99%AF-toc" style="margin-left:80px;"><a href="#%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0Rewrite%E8%B7%B3%E8%BD%AC%E5%9C%BA%E6%99%AF" rel="nofollow" title="                Rewrite跳转场景">                Rewrite跳转场景</a></p> 
<p id="%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20Rewrite%E8%B7%B3%E8%BD%AC%E5%AE%9E%E7%8E%B0-toc" style="margin-left:40px;"><a href="#%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20Rewrite%E8%B7%B3%E8%BD%AC%E5%AE%9E%E7%8E%B0" rel="nofollow" title="          Rewrite跳转实现">          Rewrite跳转实现</a></p> 
<p id="%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%E8%AF%AD%E6%B3%95%E6%A0%BC%E5%BC%8F-toc" style="margin-left:80px;"><a href="#%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%E8%AF%AD%E6%B3%95%E6%A0%BC%E5%BC%8F" rel="nofollow" title="                语法格式">                语法格式</a></p> 
<p id="%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%E5%9F%BA%E4%BA%8E%E6%97%A7%E5%9F%9F%E5%90%8D%E8%B7%B3%E8%BD%AC%E5%88%B0%E6%96%B0%E5%9F%9F%E5%90%8D-toc" style="margin-left:80px;"><a href="#%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%E5%9F%BA%E4%BA%8E%E6%97%A7%E5%9F%9F%E5%90%8D%E8%B7%B3%E8%BD%AC%E5%88%B0%E6%96%B0%E5%9F%9F%E5%90%8D" rel="nofollow" title="                基于旧域名跳转到新域名">                基于旧域名跳转到新域名</a></p> 
<p id="%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%E5%9F%BA%E4%BA%8E%E5%AE%A2%E6%88%B7%E7%AB%AFIP%E8%AE%BF%E9%97%AE%E8%B7%B3%E8%BD%AC-toc" style="margin-left:80px;"><a href="#%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%E5%9F%BA%E4%BA%8E%E5%AE%A2%E6%88%B7%E7%AB%AFIP%E8%AE%BF%E9%97%AE%E8%B7%B3%E8%BD%AC" rel="nofollow" title="                 基于客户端IP访问跳转">                 基于客户端IP访问跳转</a></p> 
<p id="%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%E5%9F%BA%E4%BA%8E%E5%8F%82%E6%95%B0%E5%8C%B9%E9%85%8D%E7%9A%84%E8%B7%B3%E8%BD%AC-toc" style="margin-left:80px;"><a href="#%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%E5%9F%BA%E4%BA%8E%E5%8F%82%E6%95%B0%E5%8C%B9%E9%85%8D%E7%9A%84%E8%B7%B3%E8%BD%AC" rel="nofollow" title="                基于参数匹配的跳转">                基于参数匹配的跳转</a></p> 
<p id="%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%E5%9F%BA%E4%BA%8E%E6%97%A7%E5%9F%9F%E5%90%8D%E8%B7%B3%E8%BD%AC%E5%88%B0%E6%96%B0%E5%9F%9F%E5%90%8D-toc" style="margin-left:80px;"><a href="#%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%E5%9F%BA%E4%BA%8E%E6%97%A7%E5%9F%9F%E5%90%8D%E8%B7%B3%E8%BD%AC%E5%88%B0%E6%96%B0%E5%9F%9F%E5%90%8D" rel="nofollow" title="                 基于旧域名跳转到新域名">                 基于旧域名跳转到新域名</a></p> 
<p id="%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%E5%9F%BA%E4%BA%8E%20%E7%9B%AE%E5%BD%95%E4%B8%8B%E6%89%80%E6%9C%89%E7%9A%84php%E6%96%87%E4%BB%B6-toc" style="margin-left:80px;"><a href="#%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%E5%9F%BA%E4%BA%8E%20%E7%9B%AE%E5%BD%95%E4%B8%8B%E6%89%80%E6%9C%89%E7%9A%84php%E6%96%87%E4%BB%B6" rel="nofollow" title="                基于 目录下所有的php文件">                基于 目录下所有的php文件</a></p> 
<p id="%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%E5%9F%BA%E4%BA%8E%E6%99%AE%E9%80%9A%E7%9A%84%E4%B8%80%E6%9D%A1url-toc" style="margin-left:80px;"><a href="#%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%E5%9F%BA%E4%BA%8E%E6%99%AE%E9%80%9A%E7%9A%84%E4%B8%80%E6%9D%A1url" rel="nofollow" title="                基于普通的一条url">                基于普通的一条url</a></p> 
<hr id="hr-toc"> 
<h2 id="Nginx%E5%B8%B8%E8%A7%81%E6%A8%A1%E5%9D%97">Nginx常见模块</h2> 
<h3 id="%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20nginx%E5%86%85%E7%BD%AE%E6%A8%A1%E5%9D%97">        nginx内置模块</h3> 
<p>        nginx作为低资源低能耗高性能的一个web服务，它的模块相对于apache少，但是nginx他是高度模块化的设计，编写模块相对简单。下面就了解一下nginx的模块吧</p> 
<p>官方文档地址</p> 
<p><a class="has-card" href="https://nginx.org/en/docs/" rel="nofollow" title="nginx documentation"><span class="link-card-box"><span class="link-title">nginx documentation</span><span class="link-link"><img class="link-link-icon" src="https://images2.imgbox.com/00/e5/RE8QpRVs_o.png" alt="icon-default.png?t=LA92">https://nginx.org/en/docs/</span></span></a>一共有四大模块</p> 
<p>第一块模块主要就是一些索引和核心功能的介绍</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/72/83/ic3Nvnvo_o.png"></p> 
<p> </p> 
<p>第二块模块，基于http操作和功能</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/e9/28/uacxQHa0_o.png"></p> 
<p>第三块模块是邮箱代理</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/7f/1d/dnXH3HGr_o.png"> </p> 
<p>第四块模块就是基于tcp协议的stream（数据流）模块</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/e0/54/zG20cWFi_o.png"> </p> 
<p>         觉得nginx还是很友好的吧，就四个模块，哈哈哈可是全拿下可不是很容易哦</p> 
<p><strong>Nginx_http常用模块</strong></p> 
<blockquote> 
 <p><span style="color:#fe2c24;">ngx_http_core_module </span>      模块是 nginx 的核心模块，该模块提供了很多 http 代理基础功能</p> 
 <p><span style="color:#fe2c24;">ngx_http_access_module</span>    允许限制访问某些客户端地址。访问也可以通过密码，子请求的结果或JWT进行限制。通过地址和密码同时限制访问受到满足指令的控制。​​​​</p> 
 <p><span style="color:#fe2c24;">ngx_http_gzip_module</span> 模块是一个使用了 <strong>gzip</strong> 方法压缩响应的过滤器。有助于将传输数据的大小减少一半甚至更多。</p> 
 <p><span style="color:#fe2c24;">ngx_http_ssl_module</span> 模块为HTTPS提供了必要的支持。该模块不是默认生成的，它应该使用<strong><code>--with-http_ssl_module</code></strong>配置参数启用。为了减少处理器负载，建议使用</p> 
 <p><span style="color:#fe2c24;">ngx_http_proxy_module </span>允许将请求传递给另一台服务器。常见于实现反向代理服务器。</p> 
 <p><span style="color:#fe2c24;">ngx_http_rewrite_module</span> 模块用于使用PCRE正则表达式更改请求URI，返回重定向并有条件地选择配置。</p> 
 <p><span style="color:#fe2c24;">ngx_http_upstream_module</span> 该模块用户分发到不同的服务器节点。支持由proxy_pass, fastcgi_pass, uwsgi_pass, scgi_pass, memcached_pass, grpc_pass等的服务器组。</p> 
 <p><span style="color:#fe2c24;">ngx_http_log_module</span> 模块以指定的格式写入请求日志。</p> 
 <p><span style="color:#fe2c24;">ngx_http_stub_status_module</span> 模块提供对基本状态信息的访问</p> 
 <p><span style="color:#fe2c24;">ngx_http_auth_basic_module </span>模块允许通过使用“HTTP基本认证”协议验证用户名和密码来限制对资源的访问。</p> 
</blockquote> 
<h4 id="%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%C2%A0%20nginx%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%9A%84%E5%B8%B8%E8%A7%81%E6%A8%A1%E5%9D%97">                 nginx配置文件的常见模块</h4> 
<ul><li> <p><span style="color:#fe2c24;"><strong>http</strong></span></p> <p>http块是Nginx服务器配置中的重要部分，代理、缓存和日志定义等绝大多数的功能和第三方模块的配置都可以放在这模块中。作用包括：文件引入、MIME-Type定义、日志自定义、是否使用sendfile传输文件、连接超时时间、单连接请求数上限等。</p> </li><li> <p><span style="color:#fe2c24;"><strong>server</strong></span></p> <p>server块，虚拟主机（虚拟服务器）。作用：使得Nginx服务器可以在同一台服务器上只要运行一组Nginx进程，就可以运行多个网站。</p> </li><li> <p><span style="color:#fe2c24;"><strong>location</strong></span></p> <p>location块是server块的一个指令。作用：基于Nginx服务器接收到的请求字符串，虚拟主机名称（ip，域名）、url匹配，对特定请求进行处理。</p> </li></ul> 
<h2 id="%C2%A0location%E6%A8%A1%E5%9D%97"> location模块</h2> 
<h4 id="%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%E5%B8%B8%E8%A7%81%E7%9A%84%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F">                 常见的正则表达式</h4> 
<table><thead><tr><th style="text-align:center;">字符</th><th style="text-align:center;">含义</th></tr></thead><tbody><tr><td style="text-align:center;">.</td><td style="text-align:center;">匹配任意单个字符，可以是一个汉字</td></tr><tr><td style="text-align:center;">^</td><td style="text-align:center;">行首锚定, 用于模式的最左侧</td></tr><tr><td style="text-align:center;">$</td><td style="text-align:center;">行尾锚定，用于模式的最右侧</td></tr><tr><td style="text-align:center;">*</td><td style="text-align:center;">匹配前面字符任意次(包括0次)</td></tr><tr><td style="text-align:center;">?</td><td style="text-align:center;">0或1次</td></tr><tr><td style="text-align:center;">+</td><td style="text-align:center;">1次或多次（1次或以上）</td></tr><tr><td style="text-align:center;">\</td><td style="text-align:center;">转义符</td></tr><tr><td style="text-align:center;">\d</td><td style="text-align:center;">只匹配数字</td></tr><tr><td style="text-align:center;">{n}</td><td style="text-align:center;">重复n次</td></tr><tr><td style="text-align:center;">{n,}</td><td style="text-align:center;">至少n次（n次货以上）</td></tr><tr><td style="text-align:center;">{n,m}</td><td style="text-align:center;">n到m次</td></tr><tr><td style="text-align:center;">[ ]</td><td style="text-align:center;">定义匹配字符的范围，只匹配一次</td></tr><tr><td style="text-align:center;">[c]</td><td style="text-align:center;">单个字符</td></tr><tr><td style="text-align:center;">[a-z]</td><td style="text-align:center;">匹配任意小写字母</td></tr><tr><td style="text-align:center;">[a-zA-Z0-9]</td><td style="text-align:center;">匹配任意字母和数字</td></tr><tr><td style="text-align:center;">（）</td><td style="text-align:center;">表达式的开始和结束位置</td></tr><tr><td style="text-align:center;">|</td><td style="text-align:center;">或运算符a|b</td></tr></tbody></table> 
<p><strong>location的几种匹配方式</strong></p> 
<blockquote> 
 <p>location：<br> 精确匹配：location = /  {.....}<br> 一般匹配：location  /  {.....}<br> 正则匹配：location ~ / {.....} </p> 
</blockquote> 
<h4 id="%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20location%E5%B8%B8%E7%94%A8%E7%9A%84%E5%8C%B9%E9%85%8D%E8%A7%84%E5%88%99%C2%A0">                location常用的匹配规则 </h4> 
<table><thead><tr><th style="text-align:center;">规则表达式</th><th style="text-align:center;">规则含义</th></tr></thead><tbody><tr><td style="text-align:center;">=</td><td style="text-align:center;">进行普通字符精确匹配。也就是完全匹配</td></tr><tr><td style="text-align:center;">^~</td><td style="text-align:center;">表示普通字符匹配。使用前缀匹配。如果匹配成功，则不再匹配其他 location</td></tr><tr><td style="text-align:center;">~</td><td style="text-align:center;">表示执行一个正则匹配，区分大小写</td></tr><tr><td style="text-align:center;">~*</td><td style="text-align:center;">表示执行一个正则匹配，不区分大小写</td></tr><tr><td style="text-align:center;">!~</td><td style="text-align:center;">表示执行一个正则匹配，区分大小写不匹配</td></tr><tr><td style="text-align:center;">!~*</td><td style="text-align:center;">表示执行一个正则匹配，不区分大小写不匹配</td></tr></tbody></table> 
<p><span style="color:#fe2c24;"><strong>说明</strong></span> </p> 
<blockquote> 
 <ol><li> <p>等号类型（=）的优先级最高。一旦匹配成功，则不再查找其他匹配项。</p> </li><li> <p>^~类型表达式。一旦匹配成功，则不再查找其他匹配项。</p> </li><li> <p>正则表达式类型（*）的优先级次之。常规字符串匹配类型（不带任何修饰符的匹配），按前缀匹配。/test</p> </li><li> <p>通用匹配（/），如果没有其它匹配，任何请求都会匹配到。</p> </li></ol> 
</blockquote> 
<blockquote> 
 <p>比如：</p> 
 <pre><code>[root@localhost /usr/local/nginx/conf]# vim nginx.conf</code></pre> 
 <p style="text-align:center;"> <img alt="" src="https://images2.imgbox.com/69/9b/29SaZEWU_o.png"></p> 
 <p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/4b/47/OzB7EyOn_o.png"> </p> 
 <p> 这样访问还是访问主页面，并没有啥卵用</p> 
 <p>必须要在后面跟具体的文件</p> 
 <p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/a1/88/Il4BVnMU_o.png"></p> 
 <p> </p> 
 <p style="text-align:center;"></p> 
 <p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/d1/a9/pKtWqYnq_o.png"> </p> 
 <p> 这样就优先与‘=’了</p> 
</blockquote> 
<p>再比如同一个文件名，不在同一目录下，会匹配谁呢</p> 
<pre><code>[root@localhost /usr/local/nginx/html/image]# ls
cat  dog
[root@localhost /usr/local/nginx/html/image]# cd cat
[root@localhost /usr/local/nginx/html/image/cat]# ls
1.jpg
[root@localhost /usr/local/nginx/html/image/cat]# cd ../dog/
[root@localhost /usr/local/nginx/html/image/dog]# ls
1.jpg
</code></pre> 
<p><strong>配置文件</strong></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/36/ce/aG64emWl_o.png"></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/bd/0b/GQRwZZo9_o.png"> </p> 
<p>当然是可爱的咪咪了！！！</p> 
<p></p> 
<p><strong>实际网站使用中，至少有三个匹配规则定义</strong></p> 
<p>第一个规则</p> 
<p>直接匹配网站根，通过域名访问网站首页比较频繁，使用这个会加速处理，比如说官网。</p> 
<p>可以是一个静态首页，也可以直接转发给后端应用服务器</p> 
<blockquote> 
 <pre>location = / {
    root html;
    index index.html index.htm;
    }</pre> 
</blockquote> 
<p>第二个规则</p> 
<p>是处理静态文件请求，这是nginx作为http服务器的强项有两种配置模式，目录匹配或后缀匹配,任选其一或搭配使用</p> 
<blockquote> 
 <pre>location ^~ /static/ {
       root /webroot/static/ ;
}      
​
location ~* \.(gif|jpg|jpeg)$ {
      root /webroot/static/ ;
}</pre> 
</blockquote> 
<p>第三个规则</p> 
<p>就是通用规则，比如用来转发带.php、.jsp后缀的动态请求到后端应用服务器。</p> 
<blockquote> 
 <pre>location  / {
       proxy_pass http://tomcat_server;
}      </pre> 
</blockquote> 
<h2 id="Rewrite%E6%A8%A1%E5%9D%97%C2%A0">Rewrite模块 </h2> 
<p>        现在 Nginx 已经成为很多公司作为前端反向代理服务器的首选，在实际工作中往往会 遇到很多跳转（重写 URL）的需求。比如更换域名后需要保持旧的域名能跳转到新的域名 上、某网页发生改变需要跳转到新的页面、网站防盗链等等需求。如果在后端使用的 Apache 服务器，虽然也能做跳转，规则库也很强大，但是用 Nginx 跳转效率会更高</p> 
<h3 id="%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20Rewrite%E5%8A%9F%E8%83%BD">        Rewrite功能</h3> 
<p>        rewrite功能就是，使用nginx提供的全局变量或自己设置的变量，结合正则表达式和标记位实现URL重写以及重定向。比如:更换域名后需要保持旧的域名能跳转到新的域名上、某网页发生改变需要跳转到新的页面、网站防盗链等等需求。</p> 
<blockquote> 
 <p>rewrite 只能在<br> server {}<br> location {}<br> if {}<br> 中，并且默认只能对域名后边的除去传递的参数外的字符串起作用<br>  例如：京东登录账号，就是一个跳转</p> 
 <p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/22/ff/SEJRpFQ0_o.png"></p> 
 <p>只针对“<strong>？前域名后</strong>”重写 </p> 
</blockquote> 
<h4 id="%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0Rewrite%E8%B7%B3%E8%BD%AC%E5%9C%BA%E6%99%AF">                Rewrite跳转场景</h4> 
<ol><li> <p>可以调整用户浏览的 URL，看起来更规范，合乎开发及产品人员的需求</p> </li><li> <p>为了让搜索引擎搜录网站内容及用户体验更好，企业会将动态 URL 地址伪装成静态地址提供服务</p> </li><li> <p>网址换新域名后，让旧的访问跳转到新的域名上。例如，访问京东的 360buy.com会跳转到 jd.com</p> </li><li> <p>根据特殊变量、目录、客户端的信息进行 URL 调整等。</p> </li></ol> 
<h3 id="%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20Rewrite%E8%B7%B3%E8%BD%AC%E5%AE%9E%E7%8E%B0">          Rewrite跳转实现</h3> 
<p>        Nginx 是通过 ngx_http_rewrite_module 模块支持 url 重写、支持 if 条件判断，但不支持 else。</p> 
<p>        另外该模块需要 PCRE 支持，应在编译 Nginx 时指定 PCRE 支持，默认已经安装。</p> 
<p>        根据相关变量重定向和选择不同的配置，从一个 location 跳转到另一个 location，不过这样 的循环最多可以执行 10 次，超过后 Nginx 将返回 500 错误。</p> 
<p>        同时，重写模块包含 set 指令，来创建新的变量并设其值，这在有些情景下非常有用的，如记录条件标识、传递参数到其他location、记录做了什么等等。</p> 
<p><span style="color:#fe2c24;"><strong>rewrite执行顺序如下:</strong></span></p> 
<ol><li> <p>执行server块里面的rewrite指令。</p> </li><li> <p>执行location 匹配。</p> </li><li> <p>执行选定的location中的rewrite指令。</p> </li></ol> 
<h4 id="%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%E8%AF%AD%E6%B3%95%E6%A0%BC%E5%BC%8F">                语法格式</h4> 
<blockquote> 
 <p><strong><span style="color:#4da8ee;">rewrite &lt;regex&gt; &lt;replacement&gt; [flag];<br> regex：表示正则匹配规则<br> replacement：表示跳转后的内容<br> flag：表示rewrite 支持的 flag 标记</span></strong></p> 
 <p>flag 标记说明：<br> last：本条规则匹配完成后，继续向下匹配新的location URL规则，一般用在server和if中</p> 
 <p>break：本条规则匹配完成即终止，不再匹配后面的任何规则。一般用在location中</p> 
 <p>redirect：返回 302 临时重定向，浏览器地址会显示跳转后的 URL 地址，爬虫不会更新 url（因为是临时）。</p> 
 <p>permanent：返回 301 永久重定向，浏览器地址栏会显示跳转后的 URL 地址，爬虫更新 url。</p> 
</blockquote> 
<h4 id="%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%E5%9F%BA%E4%BA%8E%E6%97%A7%E5%9F%9F%E5%90%8D%E8%B7%B3%E8%BD%AC%E5%88%B0%E6%96%B0%E5%9F%9F%E5%90%8D">                基于旧域名跳转到新域名</h4> 
<p>        例如现在访问的是www.xiao.com,现在需要将这个域名下面的发帖都跳转到 www.bin.com,后面的参数不变 </p> 
<p>创建目录</p> 
<pre><code>[root@localhost /usr/local/nginx/html]# ls
50x.html  image  index.html  test
[root@localhost /usr/local/nginx/html]# cd test/
[root@localhost /usr/local/nginx/html/test]# ls
index.html
[root@localhost /usr/local/nginx/html/test]# cat index.html 
this is test web</code></pre> 
<p>修改配置文件</p> 
<pre><code>[root@localhost /usr/local/nginx/conf]# vim nginx.conf</code></pre> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/ca/fd/fs8klnZu_o.png"></p> 
<p><strong>在Windows系统中记得要添加域名哦！！！</strong></p> 
<pre><code>C:\Windows\System32\drivers\etc</code></pre> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/71/57/hLlFXw0B_o.png"> </p> 
<p> </p> 
<p> 输入www.xiao.com就会转到www.bin.com</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/5d/f3/5JBoIztL_o.png"></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/3a/7c/Wy7z7NFe_o.png"> </p> 
<h4 id="%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%E5%9F%BA%E4%BA%8E%E5%AE%A2%E6%88%B7%E7%AB%AFIP%E8%AE%BF%E9%97%AE%E8%B7%B3%E8%BD%AC">                 基于客户端IP访问跳转</h4> 
<p>在/var目录下创建一个站点文件</p> 
<pre><code>[root@localhost /var]# mkdir -p www/html
[root@localhost /var/www/html]# vim weihu.html
[root@localhost /usr/local/nginx/html]# cat /var/www/html/weihu.html 
&lt;head&gt;&lt;h1&gt;This page is under maintenance, please come back later&lt;h1&gt;&lt;/head&gt;
</code></pre> 
<pre><code>[root@localhost /usr/local/nginx/conf]# vim nginx.conf</code></pre> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/34/23/hzE62zhE_o.png"> </p> 
<p> </p> 
<blockquote> 
 <p>###设置是否合法的IP标识###<br>         set $rewrite true;    <br>         <br>         ###判断是否合法的ip###<br>         if ($remote_addr = "192.168.91.103") {                                <br>         #当客户端IP为192.168.91.103时将变量值设为false，不进行重写<br>         set $rewrite false;                                                             }                           <br>           if ($rewrite = true) {                                                          rewrite (.+) /weihu.html;                                                          <br>         } <br>         location = /weihu.html {<!-- --><br>             root   /var/www.html;<br>         }<br>         <br>         location / {<!-- --><br>             root   html;<br>             index  index.html index.htm;<br>         }<br>  </p> 
</blockquote> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/6c/16/IoaTM2Lv_o.png"> </p> 
<p><strong> 这样在域名后瞎打或打错都会跳到这个错误页面中</strong></p> 
<h4 id="%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%E5%9F%BA%E4%BA%8E%E5%8F%82%E6%95%B0%E5%8C%B9%E9%85%8D%E7%9A%84%E8%B7%B3%E8%BD%AC"><strong>                基于参数匹配的跳转</strong></h4> 
<p>http://www.xiao.com/(100|200)-100.html跳转到http://www.xiao.com页面</p> 
<pre><code>[root@localhost /usr/local/nginx/conf]# vim nginx.conf
</code></pre> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/0b/e5/QvJn9iWa_o.png"></p> 
<p> 在网页测试输入www.xiao.com/100-100-任意/html</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/38/f3/cbUTsSSC_o.png"></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/d8/05/7IKEHkV8_o.png"> </p> 
<h4 id="%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%E5%9F%BA%E4%BA%8E%E6%97%A7%E5%9F%9F%E5%90%8D%E8%B7%B3%E8%BD%AC%E5%88%B0%E6%96%B0%E5%9F%9F%E5%90%8D">                 基于旧域名跳转到新域名</h4> 
<p>        比如我们用惯了一个网址，服务商想把地址改变，用户输入原来的网址，可以跳到新的地址</p> 
<p>比如，我们访问bbs.xiao.com/post它会跳到新的地址，www.xiao.com/bbs/post</p> 
<pre><code>[root@localhost /usr/local/nginx/conf]# vim nginx.conf
</code></pre> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/bf/9f/DuBMOgpc_o.png"></p> 
<blockquote> 
 <p><span style="color:#fe2c24;"><strong>#$1为位置变量，代表/post </strong></span></p> 
</blockquote> 
<p>创建站点文件</p> 
<pre><code>[root@localhost /usr/local/nginx/html]# mkdir -p bbs/post
[root@localhost /usr/local/nginx/html/bbs/post]# vim index.html
[root@localhost /usr/local/nginx/html/bbs/post]# cat index.html 
&lt;h1&gt;This is mylove&lt;/h1&gt;</code></pre> 
<p><span style="color:#fe2c24;"><strong>在网页输入bbs.xiao.com/post就会跳转到www.xiao.com/bbs/post</strong></span></p> 
<p><span style="color:#fe2c24;"><strong>记得hosts文件要加bbs.xiao.com哦，不然解析不出来</strong></span></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/bb/4e/EAlnjuSI_o.png"></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/09/72/P4lzhQ9J_o.png"> </p> 
<p> </p> 
<p></p> 
<h4 id="%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%E5%9F%BA%E4%BA%8E%20%E7%9B%AE%E5%BD%95%E4%B8%8B%E6%89%80%E6%9C%89%E7%9A%84php%E6%96%87%E4%BB%B6">                基于 目录下所有的php文件</h4> 
<p>访问任何php文件，都会返回首页</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/56/3f/avOOsLgv_o.png"></p> 
<p>在网址输入www.xiao.com/upload/*（任何）.php都会返回到首页 </p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/d9/49/v1gypvKa_o.png"> </p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/19/13/2GFLNYcb_o.png"> </p> 
<p> </p> 
<h4 id="%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%E5%9F%BA%E4%BA%8E%E6%99%AE%E9%80%9A%E7%9A%84%E4%B8%80%E6%9D%A1url">                基于普通的一条url</h4> 
<p>这个是最简单的，就利用正则表达式，以什么开头以什么结尾，改改不管什么都会跳到主页面</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/cf/34/H2MDMZI9_o.png"> </p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/09/31/CUfB0jyb_o.png"> </p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/49/1a/mObAWgQR_o.png"> </p> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/50d9463e0b1c80e0f8de25d08a5d0b44/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">一篇文章学会使用 CompletableFuture（JDK9）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9b88f51d3cbb3dff26525878124d5045/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">在浏览器地址栏输入URL，按下enter键后发生了什么？</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>