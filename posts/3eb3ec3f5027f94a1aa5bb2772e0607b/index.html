<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>云服务器使用docker-compose安装kafka - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="云服务器使用docker-compose安装kafka" />
<meta property="og:description" content="查了一些资料，终于改好了，整理一下发出来，记录一下，希望能帮到遇到问题的人
容器选择 本次使用bitnami/kafka，其实他们文档已经写得挺清楚了，但是我也是改了一段时间才改完，希望能方便不想看文档的兄弟们
docker-compose.yml 文件中除了宿主机外网ip需要改，其他地方基本不需要改
version: &#39;3.0&#39; services: zookeeper: image: &#39;bitnami/zookeeper:latest&#39; ports: - &#39;2181:2181&#39; environment: # 匿名登录 - ALLOW_ANONYMOUS_LOGIN=yes # volumes: # - ./zookeeper:/bitnami/zookeeper kafka: image: &#39;bitnami/kafka:2.8.0&#39; ports: - &#39;9092:9092&#39; environment: # 配置broker id - KAFKA_BROKER_ID=1 # 配置监听者的安全协议 - KAFKA_CFG_LISTENER_SECURITY_PROTOCOL_MAP=INTERNAL:PLAINTEXT,OUTSIDE:PLAINTEXT # 定义Kafka Broker的Listener的配置项，配置外部访问和内部访问 - KAFKA_CFG_LISTENERS=INTERNAL://:9093,OUTSIDE://:9092 # 将Broker的Listener信息发布到Zookeeper中，供Clients（Producer/Consumer）使用 - KAFKA_CFG_ADVERTISED_LISTENERS=INTERNAL://kafka:9093,OUTSIDE://宿主机外网ip:9092 - KAFKA_CFG_INTER_BROKER_LISTENER_NAME=INTERNAL - KAFKA_CFG_ZOOKEEPER_CONNECT=zookeeper:2181 - ALLOW_PLAINTEXT_LISTENER=yes - KAFKA_CFG_AUTO_CREATE_TOPICS_ENABLE=true # 全局消息过期时间 - KAFKA_CFG_LOG_RETENTION_HOURS=6 # volumes: # - ./kafka:/bitnami/kafka depends_on: - zookeeper 内外网隔离配置 KAFKA_CFG_LISTENER_SECURITY_PROTOCOL_MAP：监听器名称和安全协议的映射配置。每个监听器的名称只能在map中出现一次。KAFKA_CFG_INTER_BROKER_LISTENER_NAME:用于配置broker之间通信使用的监听器名称KAFKA_CFG_LISTENERS:用于配置broker监听的URI以及监听器名称列表KAFKA_CFG_ADVERTISED_LISTENERS:将该地址发布到zookeeper供客户端使用" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/3eb3ec3f5027f94a1aa5bb2772e0607b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-07-25T10:06:14+08:00" />
<meta property="article:modified_time" content="2023-07-25T10:06:14+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">云服务器使用docker-compose安装kafka</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>查了一些资料，终于改好了，整理一下发出来，记录一下，希望能帮到遇到问题的人</p> 
<h3><a id="_2"></a>容器选择</h3> 
<p>本次使用<a href="https://hub.docker.com/r/bitnami/kafka" rel="nofollow">bitnami/kafka</a>，其实他们文档已经写得挺清楚了，但是我也是改了一段时间才改完，希望能方便不想看文档的兄弟们</p> 
<h3><a id="dockercomposeyml_5"></a>docker-compose.yml</h3> 
<p>文件中除了宿主机外网ip需要改，其他地方基本不需要改</p> 
<pre><code class="prism language-yml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3.0'</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">zookeeper</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> <span class="token string">'bitnami/zookeeper:latest'</span>
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">'2181:2181'</span>
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token comment"># 匿名登录</span>
      <span class="token punctuation">-</span> ALLOW_ANONYMOUS_LOGIN=yes
   <span class="token comment"># volumes:</span>
   <span class="token comment">#   - ./zookeeper:/bitnami/zookeeper</span>
  <span class="token key atrule">kafka</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> <span class="token string">'bitnami/kafka:2.8.0'</span>
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">'9092:9092'</span>
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token comment"># 配置broker id</span>
      <span class="token punctuation">-</span> KAFKA_BROKER_ID=1
      <span class="token comment"># 配置监听者的安全协议</span>
      <span class="token punctuation">-</span> KAFKA_CFG_LISTENER_SECURITY_PROTOCOL_MAP=INTERNAL<span class="token punctuation">:</span>PLAINTEXT<span class="token punctuation">,</span>OUTSIDE<span class="token punctuation">:</span>PLAINTEXT
      <span class="token comment"># 定义Kafka Broker的Listener的配置项，配置外部访问和内部访问</span>
      <span class="token punctuation">-</span> KAFKA_CFG_LISTENERS=INTERNAL<span class="token punctuation">:</span>//<span class="token punctuation">:</span><span class="token number">9093</span><span class="token punctuation">,</span>OUTSIDE<span class="token punctuation">:</span>//<span class="token punctuation">:</span><span class="token number">9092</span>
      <span class="token comment"># 将Broker的Listener信息发布到Zookeeper中，供Clients（Producer/Consumer）使用</span>
      <span class="token punctuation">-</span> KAFKA_CFG_ADVERTISED_LISTENERS=INTERNAL<span class="token punctuation">:</span>//kafka<span class="token punctuation">:</span><span class="token number">9093</span><span class="token punctuation">,</span>OUTSIDE<span class="token punctuation">:</span>//宿主机外网ip<span class="token punctuation">:</span><span class="token number">9092</span>
      <span class="token punctuation">-</span> KAFKA_CFG_INTER_BROKER_LISTENER_NAME=INTERNAL
      <span class="token punctuation">-</span> KAFKA_CFG_ZOOKEEPER_CONNECT=zookeeper<span class="token punctuation">:</span><span class="token number">2181</span>
      <span class="token punctuation">-</span> ALLOW_PLAINTEXT_LISTENER=yes
      <span class="token punctuation">-</span> KAFKA_CFG_AUTO_CREATE_TOPICS_ENABLE=true
      <span class="token comment"># 全局消息过期时间</span>
      <span class="token punctuation">-</span> KAFKA_CFG_LOG_RETENTION_HOURS=6
   <span class="token comment"># volumes:</span>
   <span class="token comment">#   - ./kafka:/bitnami/kafka</span>
    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> zookeeper
</code></pre> 
<h4><a id="_43"></a>内外网隔离配置</h4> 
<ul><li>KAFKA_CFG_LISTENER_SECURITY_PROTOCOL_MAP：监听器名称和安全协议的映射配置。每个监听器的名称只能在map中出现一次。</li><li>KAFKA_CFG_INTER_BROKER_LISTENER_NAME:用于配置broker之间通信使用的监听器名称</li><li>KAFKA_CFG_LISTENERS:用于配置broker监听的URI以及监听器名称列表</li><li>KAFKA_CFG_ADVERTISED_LISTENERS:将该地址发布到zookeeper供客户端使用<br> 数据卷可以自己打开使用，这个容器时非root容器，所以创建挂载目录时候需要将文件夹权限打开！！</li></ul> 
<h4><a id="_50"></a>启动容器</h4> 
<pre><code class="prism language-shell"><span class="token function">docker-compose</span> up
</code></pre> 
<h3><a id="_54"></a>测试生产</h3> 
<p>使用kafka-client测试，client版本不能低于kafka版本，避免遇到各种意外</p> 
<ol><li>引入依赖</li></ol> 
<pre><code class="prism language-xml">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.kafka<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>kafka-clients<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.8.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<ol start="2"><li>写代码</li></ol> 
<pre><code class="prism language-java">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{<!-- --></span>

        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> configs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        configs<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"bootstrap.servers"</span><span class="token punctuation">,</span><span class="token string">"宿主机外网ip:9092"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        configs<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"key.serializer"</span><span class="token punctuation">,</span> <span class="token class-name">IntegerSerializer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        configs<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"value.serializer"</span><span class="token punctuation">,</span> <span class="token class-name">StringSerializer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">KafkaProducer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KafkaProducer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>configs<span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token class-name">ProducerRecord</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> record <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProducerRecord</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>
                <span class="token string">"topic_1"</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token string">"shall"</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RecordMetadata</span><span class="token punctuation">&gt;</span></span> send <span class="token operator">=</span> producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">RecordMetadata</span> recordMetadata <span class="token operator">=</span> send<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">String</span> topic <span class="token operator">=</span> recordMetadata<span class="token punctuation">.</span><span class="token function">topic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Integer</span> partition <span class="token operator">=</span> recordMetadata<span class="token punctuation">.</span><span class="token function">partition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span> offset <span class="token operator">=</span> recordMetadata<span class="token punctuation">.</span><span class="token function">offset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"主题："</span><span class="token operator">+</span>topic <span class="token operator">+</span> <span class="token string">",分区："</span> <span class="token operator">+</span> partition <span class="token operator">+</span> <span class="token string">",偏移量："</span> <span class="token operator">+</span> offset<span class="token punctuation">)</span><span class="token punctuation">;</span>

        producer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/662260c1cd60a30a56e36557edb267d6/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Mysql操作多表查询</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d1c325ed33f6c657f452acf787ba9380/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">elementui el-table折叠表格，点击主表数据展开从表明细</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>