<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Spring-----声明式事务管理-xml方式配置 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Spring-----声明式事务管理-xml方式配置" />
<meta property="og:description" content="一.准备配置文件 1.1 在配置文件中引入新的命名空间 tx
&lt;beans xmlns=&#34;http://www.springframework.org/schema/beans&#34; xmlns:p=&#34;http://www.springframework.org/schema/p&#34; xmlns:context=&#34;http://www.springframework.org/schema/context&#34; xmlns:aop=&#34;http://www.springframework.org/schema/aop&#34; **xmlns:tx=&#34;http://www.springframework.org/schema/tx&#34;** xmlns:xsi=&#34;http://www.w3.org/2001/XMLSchema-instance&#34; xsi:schemaLocation=&#34;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd &#34;&gt; 1.2 在配置文件中配置包扫描,读取配置文件,并配置数据源,配置jdbcTemplate
&lt;!--配置包扫描--&gt; &lt;context:component-scan base-package=&#34;com.sxt&#34;/&gt; &lt;!--读取配置文件--&gt; &lt;context:property-placeholder location=&#34;classpath:db.properties&#34;/&gt; &lt;!--配置数据源--&gt; &lt;bean id=&#34;dataSource&#34; class=&#34;com.alibaba.druid.pool.DruidDataSource&#34;&gt; &lt;property name=&#34;driverClassName&#34; value=&#34;${jdbc.driverClassName}&#34;/&gt; &lt;property name=&#34;url&#34; value=&#34;${jdbc.url}&#34;/&gt; &lt;property name=&#34;username&#34; value=&#34;${jdbc.username}&#34;/&gt; &lt;property name=&#34;password&#34; value=&#34;${jdbc.password}&#34;/&gt; &lt;/bean&gt; &lt;!--配置jdbcTemolate--&gt; &lt;bean id=&#34;jdbcTemplate&#34; class=&#34;org.springframework.jdbc.core.JdbcTemplate&#34;&gt; &lt;constructor-arg name=&#34;dataSource&#34; ref=&#34;dataSource&#34;/&gt; &lt;/bean&gt; 二.配置事务管理器 Spring对事务的支持，必须先配置事务管理器，事务管理器已经封装了事务的具体的处理
DataSourceTransactionManager
使用JDBC,MyBatis的事务管理器；(当前案例使用的Spring的JDBC操作,所以配置这个)
&lt;bean id=&#34;transactionManager&#34; class=&#34;org.springframework.jdbc.datasource.DataSourceTransactionManager&#34;&gt; &lt;!--事务管理器里面,需要注入dataSource --&gt; &lt;property name=&#34;dataSource&#34; ref=&#34;dataSource&#34;/&gt; &lt;/bean&gt; 三.配置事务通知/增强 &lt;tx:advice id=&#34;txAdvice&#34; transaction-manager=&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/d07479dc898c166baa727db0d2a30b6a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-08-17T17:26:43+08:00" />
<meta property="article:modified_time" content="2020-08-17T17:26:43+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Spring-----声明式事务管理-xml方式配置</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_0"></a>一.准备配置文件</h3> 
<p>1.1 在配置文件中引入新的命名空间 tx</p> 
<pre><code class="prism language-javascript"><span class="token operator">&lt;</span>beans xmlns<span class="token operator">=</span><span class="token string">"http://www.springframework.org/schema/beans"</span>
	xmlns<span class="token punctuation">:</span>p<span class="token operator">=</span><span class="token string">"http://www.springframework.org/schema/p"</span>
	xmlns<span class="token punctuation">:</span>context<span class="token operator">=</span><span class="token string">"http://www.springframework.org/schema/context"</span>
	xmlns<span class="token punctuation">:</span>aop<span class="token operator">=</span><span class="token string">"http://www.springframework.org/schema/aop"</span>
	<span class="token operator">**</span>xmlns<span class="token punctuation">:</span>tx<span class="token operator">=</span><span class="token string">"http://www.springframework.org/schema/tx"</span><span class="token operator">**</span>
	xmlns<span class="token punctuation">:</span>xsi<span class="token operator">=</span><span class="token string">"http://www.w3.org/2001/XMLSchema-instance"</span>
	xsi<span class="token punctuation">:</span>schemaLocation<span class="token operator">=</span>"http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>org<span class="token operator">/</span>schema<span class="token operator">/</span>beans
    http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>org<span class="token operator">/</span>schema<span class="token operator">/</span>beans<span class="token operator">/</span>spring<span class="token operator">-</span>beans<span class="token punctuation">.</span>xsd
    http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>org<span class="token operator">/</span>schema<span class="token operator">/</span>context
    http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>org<span class="token operator">/</span>schema<span class="token operator">/</span>context<span class="token operator">/</span>spring<span class="token operator">-</span>context<span class="token punctuation">.</span>xsd
    http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>org<span class="token operator">/</span>schema<span class="token operator">/</span>aop
    http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>org<span class="token operator">/</span>schema<span class="token operator">/</span>aop<span class="token operator">/</span>spring<span class="token operator">-</span>aop<span class="token punctuation">.</span>xsd
    http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>org<span class="token operator">/</span>schema<span class="token operator">/</span>tx
    http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>org<span class="token operator">/</span>schema<span class="token operator">/</span>tx<span class="token operator">/</span>spring<span class="token operator">-</span>tx<span class="token punctuation">.</span>xsd
    "<span class="token operator">&gt;</span>
</code></pre> 
<p>1.2 在配置文件中配置包扫描,读取配置文件,并配置数据源,配置jdbcTemplate</p> 
<pre><code class="prism language-javascript">     <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>配置包扫描<span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>context<span class="token punctuation">:</span>component<span class="token operator">-</span>scan base<span class="token operator">-</span><span class="token keyword">package</span><span class="token operator">=</span><span class="token string">"com.sxt"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>读取配置文件<span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>context<span class="token punctuation">:</span>property<span class="token operator">-</span>placeholder location<span class="token operator">=</span><span class="token string">"classpath:db.properties"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>配置数据源<span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">"dataSource"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"com.alibaba.druid.pool.DruidDataSource"</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"driverClassName"</span> value<span class="token operator">=</span><span class="token string">"${jdbc.driverClassName}"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"url"</span> value<span class="token operator">=</span><span class="token string">"${jdbc.url}"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"username"</span> value<span class="token operator">=</span><span class="token string">"${jdbc.username}"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"password"</span> value<span class="token operator">=</span><span class="token string">"${jdbc.password}"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>配置jdbcTemolate<span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">"jdbcTemplate"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"org.springframework.jdbc.core.JdbcTemplate"</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>constructor<span class="token operator">-</span>arg name<span class="token operator">=</span><span class="token string">"dataSource"</span> ref<span class="token operator">=</span><span class="token string">"dataSource"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">&gt;</span>
</code></pre> 
<h3><a id="_40"></a>二.配置事务管理器</h3> 
<p>Spring对事务的支持，必须先配置事务管理器，事务管理器已经封装了事务的具体的处理<br> DataSourceTransactionManager<br> 使用JDBC,MyBatis的事务管理器；(当前案例使用的Spring的JDBC操作,所以配置这个)</p> 
<pre><code class="prism language-javascript"> <span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">"transactionManager"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>事务管理器里面<span class="token punctuation">,</span>需要注入dataSource <span class="token operator">--</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"dataSource"</span> ref<span class="token operator">=</span><span class="token string">"dataSource"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">&gt;</span>
</code></pre> 
<h3><a id="_52"></a>三.配置事务通知/增强</h3> 
<pre><code class="prism language-javascript"><span class="token operator">&lt;</span>tx<span class="token punctuation">:</span>advice id<span class="token operator">=</span><span class="token string">"txAdvice"</span> transaction<span class="token operator">-</span>manager<span class="token operator">=</span><span class="token string">"transactionManager"</span><span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>tx<span class="token punctuation">:</span>attributes<span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 配置要切的方法 <span class="token punctuation">:</span> <span class="token function">trans</span> <span class="token punctuation">(</span>默认使用的是环绕通知<span class="token punctuation">)</span> <span class="token operator">--</span><span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span>tx<span class="token punctuation">:</span>method name<span class="token operator">=</span><span class="token string">"trans"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span><span class="token operator">/</span>tx<span class="token punctuation">:</span>attributes<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span><span class="token operator">/</span>tx<span class="token punctuation">:</span>advice<span class="token operator">&gt;</span>
</code></pre> 
<p>以上是因为service中只有一个转账的方法,所以可以直接写方法名,但如果方法很对,且都是增删查改的方法,可以做如下配置</p> 
<pre><code class="prism language-javascript">  <span class="token operator">&lt;</span>tx<span class="token punctuation">:</span>advice id<span class="token operator">=</span><span class="token string">"txAdvice"</span> transaction<span class="token operator">-</span>manager<span class="token operator">=</span><span class="token string">"transactionManager"</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>tx<span class="token punctuation">:</span>attributes<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>tx<span class="token punctuation">:</span>method name<span class="token operator">=</span><span class="token string">"select*"</span> read<span class="token operator">-</span>only<span class="token operator">=</span><span class="token string">"true"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>tx<span class="token punctuation">:</span>method name<span class="token operator">=</span><span class="token string">"get*"</span> read<span class="token operator">-</span>only<span class="token operator">=</span><span class="token string">"true"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>tx<span class="token punctuation">:</span>method name<span class="token operator">=</span><span class="token string">"find*"</span> read<span class="token operator">-</span>only<span class="token operator">=</span><span class="token string">"true"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>tx<span class="token punctuation">:</span>method name<span class="token operator">=</span><span class="token string">"query*"</span> read<span class="token operator">-</span>only<span class="token operator">=</span><span class="token string">"true"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>tx<span class="token punctuation">:</span>method name<span class="token operator">=</span><span class="token string">"*"</span> read<span class="token operator">-</span>only<span class="token operator">=</span><span class="token string">"false"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>tx<span class="token punctuation">:</span>attributes<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>tx<span class="token punctuation">:</span>advice<span class="token operator">&gt;</span>
</code></pre> 
<h3><a id="AOPService_76"></a>四.使用AOP将事务通知切入到Service层</h3> 
<pre><code class="prism language-javascript"> <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> <span class="token number">3.</span>使用<span class="token constant">AOP</span>将事务通知切入到Service层<span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>aop<span class="token punctuation">:</span>config<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>aop<span class="token punctuation">:</span>pointcut id<span class="token operator">=</span><span class="token string">"pt"</span> expression<span class="token operator">=</span><span class="token string">"execution(* com.sxt.service..*.*(..))"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>aop<span class="token punctuation">:</span>advisor advice<span class="token operator">-</span>ref<span class="token operator">=</span><span class="token string">"txAdvice"</span> pointcut<span class="token operator">-</span>ref<span class="token operator">=</span><span class="token string">"pt"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>aop<span class="token punctuation">:</span>config<span class="token operator">&gt;</span>
</code></pre> 
<h3><a id="_86"></a>五.事物方法的属性细节配置</h3> 
<pre><code class="prism language-javascript">  <span class="token operator">&lt;</span>tx<span class="token punctuation">:</span>method name<span class="token operator">=</span><span class="token string">"select*"</span> read<span class="token operator">-</span>only<span class="token operator">=</span><span class="token string">"true"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
  
</code></pre> 
<p>事务方法属性 <br> <strong>name</strong> <br> 匹配到的方法模式<br> <strong>read-only</strong> <br> 如果为true，开启一个只读事务，只读事务的性能较高，但是不能再只读事务中，使用DML<br> <strong>isolation</strong> <br> 代表数据库事务隔离级别(就使用默认)<br> DEFAULT:<br> 让spring使用数据库默认的事务隔离级别;<br> <strong>no-rollback-for</strong> <br> 如果遇到的异常是匹配的异常类型,就不回滚事务<br> <strong>rollback-for</strong> <br> 如果遇到的异常是指定匹配的异常类型,才回滚事务;spring默认情况下,spring只会去回滚RuntimeException及其子类,不会回滚Exception和Thowable<br> <strong>propagation</strong> <br> 事务的传播方式(当一个方法已经在一个开启的事务当中了，应该怎么处理自身的事务)<br> 1,REQUIRED（默认的传播属性）:如果当前方法运行在一个没有事务环境的情况下，则开启一个新的事务，如果当前方法运行在一个已经开启了的事务里面，把自己加入到开启的那个事务中<br> 2,REQUIRES_NEW:不管当前方法是否运行在一个事务空间之内，都要开启自己的事务<br> <strong>timeout</strong> <br> 事务处理的超时时间,默认事物管理自动处理 ,可以手动配置</p> 
<h3><a id="_112"></a>六.事务管理器的分类</h3> 
<p>在使用spring管理事务的时候，首先得告诉spring使用哪一个事务管理器,使用不同的框架(JdbcTemplate,MyBatis,Hibernate/JPA )使用事务管理器都不同<br> <img src="https://images2.imgbox.com/1d/37/NDOpz45l_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/8ef1107c35ff6c782b63cc56b465970b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">AJAX跨域</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3d719f0a0ae2535d72c50b8edaf05af8/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">[acwing面向模型编程]背包九讲</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>