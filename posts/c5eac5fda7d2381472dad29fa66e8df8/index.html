<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Centos Stream 8虚拟机搭建单节点OpenStack - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Centos Stream 8虚拟机搭建单节点OpenStack" />
<meta property="og:description" content="Centos Stream 8虚拟机搭建单节点OpenStack 注意 1、在实际搭建过程中，一定要注意自己的文件路径！ 2、centos stream 8虚拟机为最小化安装，该系统似乎没有自带的python，这与centos7相比，省去很多麻烦。 3、官方文档是建立一个python虚拟环境，在虚拟环境中部署OpenStack。但是尝试多次，在web验证阶段，始终失败，不知道是网络设置的原因，还是中间部署过程出现错误的原因，始终失败，因此选择不创建python虚拟环境的情况下进行部署。 4、本次安装的是OpenStack yoga版本。 参考文献 325.【openstack】kolla 搭建 openstack 单机版云环境
kolla-ansible虚拟机单节点部署OpenStack
Quick Start
一、Centos Stream 8虚拟机安装必要的工具软件 1、修改主机名 [root@localhost ~]# hostnamectl set-hostname controller 2、安装网络工具 [root@controller ~]# yum install -y net-tools 3、修改ens160网络配置 [外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-nABXLvEi-1669918781213)(E:\虚拟化技术\素材\ifconfig_1.png)]
（1）修改ens160网络配置文件 [root@controller ~]# vi /etc/sysconfig/network-scripts/ifcfg-ens160 （2）重启网络服务 [root@controller ~]# nmcli c reload [root@controller ~]# nmcli c up ens160 [root@controller ~]# nmcli networking off [root@controller ~]# nmcli networking on [root@controller ~]# ping www.baidu.com PING www." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/c5eac5fda7d2381472dad29fa66e8df8/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-12-02T03:05:51+08:00" />
<meta property="article:modified_time" content="2022-12-02T03:05:51+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Centos Stream 8虚拟机搭建单节点OpenStack</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="Centos_Stream_8OpenStack_0"></a>Centos Stream 8虚拟机搭建单节点OpenStack</h2> 
<h6><a id="_1"></a>注意</h6> 
<pre><code class="prism language-html">1、在实际搭建过程中，一定要注意自己的文件路径！
2、centos stream 8虚拟机为最小化安装，该系统似乎没有自带的python，这与centos7相比，省去很多麻烦。
3、官方文档是建立一个python虚拟环境，在虚拟环境中部署OpenStack。但是尝试多次，在web验证阶段，始终失败，不知道是网络设置的原因，还是中间部署过程出现错误的原因，始终失败，因此选择不创建python虚拟环境的情况下进行部署。
4、本次安装的是OpenStack yoga版本。
</code></pre> 
<h6><a id="_8"></a>参考文献</h6> 
<p><a href="https://developer.aliyun.com/article/984104" rel="nofollow">325.【openstack】kolla 搭建 openstack 单机版云环境</a></p> 
<p><a href="https://blog.csdn.net/qq_16942727/article/details/121081515">kolla-ansible虚拟机单节点部署OpenStack</a></p> 
<p><a href="https://docs.openstack.org/kolla-ansible/latest/user/quickstart.html" rel="nofollow">Quick Start</a></p> 
<h3><a id="Centos_Stream_8_14"></a>一、Centos Stream 8虚拟机安装必要的工具软件</h3> 
<h4><a id="1_15"></a>1、修改主机名</h4> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># hostnamectl set-hostname controller</span>
</code></pre> 
<h4><a id="2_19"></a>2、安装网络工具</h4> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># yum install -y net-tools</span>
</code></pre> 
<h4><a id="3ens160_23"></a>3、修改ens160网络配置</h4> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-nABXLvEi-1669918781213)(E:\虚拟化技术\素材\ifconfig_1.png)]</p> 
<h5><a id="1ens160_25"></a>（1）修改ens160网络配置文件</h5> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># vi /etc/sysconfig/network-scripts/ifcfg-ens160</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/af/5b/TTJiu4be_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="2_31"></a>（2）重启网络服务</h5> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># nmcli c reload</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># nmcli c up ens160</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># nmcli networking off</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># nmcli networking on</span>

<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># ping www.baidu.com</span>
PING www.a.shifen.com <span class="token punctuation">(</span><span class="token number">110.242</span>.68.3<span class="token punctuation">)</span> <span class="token number">56</span><span class="token punctuation">(</span><span class="token number">84</span><span class="token punctuation">)</span> bytes of data.
<span class="token number">64</span> bytes from <span class="token number">110.242</span>.68.3 <span class="token punctuation">(</span><span class="token number">110.242</span>.68.3<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">128</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">26.10</span> ms
<span class="token number">64</span> bytes from <span class="token number">110.242</span>.68.3 <span class="token punctuation">(</span><span class="token number">110.242</span>.68.3<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">128</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">14.9</span> ms
<span class="token number">64</span> bytes from <span class="token number">110.242</span>.68.3 <span class="token punctuation">(</span><span class="token number">110.242</span>.68.3<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">3</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">128</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">13.5</span> ms
<span class="token number">64</span> bytes from <span class="token number">110.242</span>.68.3 <span class="token punctuation">(</span><span class="token number">110.242</span>.68.3<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">4</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">128</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">12.9</span> ms

</code></pre> 
<h4><a id="4vim_46"></a>4、安装vim</h4> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># yum install vim -y</span>

Installed:
  gpm-libs-1.20.7-17.el8.x86_64                            vim-common-2:8.0.1763-19.el8.4.x86_64                     
  vim-enhanced-2:8.0.1763-19.el8.4.x86_64                  vim-filesystem-2:8.0.1763-19.el8.4.noarch                 

Complete<span class="token operator">!</span>

</code></pre> 
<h4><a id="5git_57"></a>5、安装git</h4> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># yum install git</span>
</code></pre> 
<h4><a id="6dnf_61"></a>6、安装dnf</h4> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># yum install dnf</span>
Last metadata expiration check: <span class="token number">0</span>:40:54 ago on Tue <span class="token number">29</span> Nov <span class="token number">2022</span> <span class="token number">12</span>:52:24 AM CST.
Package dnf-4.7.0-13.el8.noarch is already installed.
Dependencies resolved.
Nothing to do.
Complete<span class="token operator">!</span>

</code></pre> 
<h3><a id="Centos_Stream_8python39_71"></a>二、Centos Stream 8虚拟机安装python3.9</h3> 
<h4><a id="1_72"></a>1、准备编译环境</h4> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># sudo dnf groupinstall 'development tools' -y</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># sudo dnf install bzip2-devel expat-devel gdbm-devel \</span>
     ncurses-devel openssl-devel readline-devel <span class="token function">wget</span> <span class="token punctuation">\</span>
     sqlite-devel tk-devel xz-devel zlib-devel libffi-devel <span class="token parameter variable">-y</span>

</code></pre> 
<h4><a id="2Python_80"></a>2、下载Python源码</h4> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># curl -O https://www.python.org/ftp/python/3.9.15/Python-3.9.15.tar.xz</span>
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
<span class="token number">100</span> <span class="token number">18</span>.7M  <span class="token number">100</span> <span class="token number">18</span>.7M    <span class="token number">0</span>     <span class="token number">0</span>  3768k      <span class="token number">0</span>  <span class="token number">0</span>:00:05  <span class="token number">0</span>:00:05 --:--:-- 3974k
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># ls</span>
20221129_1.txt  <span class="token number">20221129</span>.txt  anaconda-ks.cfg  Python-3.9.15.tar.xz

</code></pre> 
<h4><a id="3Python_90"></a>3、配置Python编译环境</h4> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># tar -xvf Python-3.9.15.tar.xz</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># ls</span>
20221129_1.txt  <span class="token number">20221129</span>.txt  anaconda-ks.cfg  Python-3.9.15  Python-3.9.15.tar.xz
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># cd Python-3.9.15</span>
<span class="token punctuation">[</span>root@controller Python-3.9.15<span class="token punctuation">]</span><span class="token comment"># ./configure prefix=/usr/local/python3 --enable-optimizations</span>

</code></pre> 
<h4><a id="4Python_99"></a>4、编译安装Python</h4> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@controller Python-3.9.15<span class="token punctuation">]</span><span class="token comment"># make &amp;&amp; make install</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
running build_scripts
copying and adjusting /root/Python-3.9.15/Tools/scripts/pydoc3 -<span class="token operator">&gt;</span> build/scripts-3.9
copying and adjusting /root/Python-3.9.15/Tools/scripts/idle3 -<span class="token operator">&gt;</span> build/scripts-3.9
copying and adjusting /root/Python-3.9.15/Tools/scripts/2to3 -<span class="token operator">&gt;</span> build/scripts-3.9
changing mode of build/scripts-3.9/pydoc3 from <span class="token number">644</span> to <span class="token number">755</span>
changing mode of build/scripts-3.9/idle3 from <span class="token number">644</span> to <span class="token number">755</span>
changing mode of build/scripts-3.9/2to3 from <span class="token number">644</span> to <span class="token number">755</span>
renaming build/scripts-3.9/pydoc3 to build/scripts-3.9/pydoc3.9
renaming build/scripts-3.9/idle3 to build/scripts-3.9/idle3.9
renaming build/scripts-3.9/2to3 to build/scripts-3.9/2to3-3.9
make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: Leaving directory <span class="token string">'/root/Python-3.9.15'</span>

<span class="token punctuation">[</span>root@controller Python-3.9.15<span class="token punctuation">]</span><span class="token comment"># ls</span>
aclocal.m4          config.sub    install-sh      Makefile.pre     Parser             pyconfig.h        python-gdb.py
build               configure     Lib             Makefile.pre.in  PC                 pyconfig.h.in     README.rst
CODE_OF_CONDUCT.md  configure.ac  libpython3.9.a  Misc             PCbuild            python            setup.py
config.guess        Doc           LICENSE         Modules          profile-run-stamp  Python            Tools
config.log          Grammar       Mac             netlify.toml     Programs           python-config
config.status       Include       Makefile        Objects          pybuilddir.txt     python-config.py
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
Looking <span class="token keyword">in</span> links: /tmp/tmp5fwsn5c7
Processing /tmp/tmp5fwsn5c7/setuptools-58.1.0-py3-none-any.whl
Processing /tmp/tmp5fwsn5c7/pip-22.0.4-py3-none-any.whl
Installing collected packages: setuptools, pip
  WARNING: The script pip3.9 is installed <span class="token keyword">in</span> <span class="token string">'/usr/local/bin'</span> <span class="token function">which</span> is not on <span class="token environment constant">PATH</span><span class="token builtin class-name">.</span>
  Consider adding this directory to <span class="token environment constant">PATH</span> or, <span class="token keyword">if</span> you prefer to suppress this warning, use --no-warn-script-location.
Successfully installed pip-22.0.4 setuptools-58.1.0
WARNING: Running pip as the <span class="token string">'root'</span> user can result <span class="token keyword">in</span> broken permissions and conflicting behaviour with the system package manager. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv

<span class="token punctuation">[</span>root@controller Python-3.9.15<span class="token punctuation">]</span><span class="token comment"># python3 --version</span>
Python <span class="token number">3.9</span>.15
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># pip3 --version</span>
pip <span class="token number">22.3</span>.1 from /usr/local/python3/lib/python3.9/site-packages/pip <span class="token punctuation">(</span>python <span class="token number">3.9</span><span class="token punctuation">)</span>

</code></pre> 
<h4><a id="5_138"></a>5、修改环境变量（建立软连接）</h4> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@controller Python-3.9.15<span class="token punctuation">]</span><span class="token comment"># export PATH=$PATH:/usr/local/python3/bin/</span>
<span class="token punctuation">[</span>root@controller Python-3.9.15<span class="token punctuation">]</span><span class="token comment"># source /etc/profile</span>

<span class="token comment">#################################修改环境变量######################################################</span>
<span class="token comment">###########################上一步操作完，似乎不需要软链接了############################################</span>
<span class="token comment">######[root@controller Python-3.9.15]# ln -s /usr/local/bin/python3.9 /usr/local/bin/python3######</span>
<span class="token comment">######[root@controller Python-3.9.15]# ln -s /usr/local/bin/pip3.9 /usr/local/bin/pip3############</span>
<span class="token comment">######[root@controller Python-3.9.15]# python3 --version##########################################</span>
<span class="token comment">######Python 3.9.15##############################################################################</span>
</code></pre> 
<h4><a id="6pip_150"></a>6、更新pip</h4> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># pip3 install -U pip</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># pip --version</span>
pip <span class="token number">22.3</span>.1 from /usr/local/python3/lib/python3.9/site-packages/pip <span class="token punctuation">(</span>python <span class="token number">3.9</span><span class="token punctuation">)</span>
</code></pre> 
<h6><a id="_156"></a>参考文献</h6> 
<p><a href="https://www.myfreax.com/how-to-install-python-3-9-on-centos-8/" rel="nofollow">如何在CentOS 8安装Python 3.9</a></p> 
<p><a href="https://blog.csdn.net/Test_Sir_Cao/article/details/107356218">centos 8 安装 python3.9</a></p> 
<p><a href="https://blog.csdn.net/kdongyi/article/details/105384642">CentOS 8 上安装Python 3</a></p> 
<h3><a id="Centos_Stream_8SELINUX_163"></a>三、Centos Stream 8虚拟机关闭防火墙及SELINUX</h3> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@controller Python-3.9.15<span class="token punctuation">]</span><span class="token comment"># systemctl stop firewalld</span>
<span class="token punctuation">[</span>root@controller Python-3.9.15<span class="token punctuation">]</span><span class="token comment"># systemctl disable firewalld</span>
Removed /etc/systemd/system/multi-user.target.wants/firewalld.service.
Removed /etc/systemd/system/dbus-org.fedoraproject.FirewallD1.service.
<span class="token punctuation">[</span>root@controller Python-3.9.15<span class="token punctuation">]</span><span class="token comment"># systemctl status firewalld</span>
● firewalld.service - firewalld - dynamic firewall daemon
   Loaded: loaded <span class="token punctuation">(</span>/usr/lib/systemd/system/firewalld.service<span class="token punctuation">;</span> disabled<span class="token punctuation">;</span> vendor preset: enabled<span class="token punctuation">)</span>
   Active: inactive <span class="token punctuation">(</span>dead<span class="token punctuation">)</span>
     Docs: man:firewalld<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

Nov <span class="token number">29</span> 00:38:18 localhost.localdomain systemd<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: Starting firewalld - dynamic firewall daemon<span class="token punctuation">..</span>.
Nov <span class="token number">29</span> 00:38:21 localhost.localdomain systemd<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: Started firewalld - dynamic firewall daemon.
Nov <span class="token number">29</span> 00:38:23 localhost.localdomain firewalld<span class="token punctuation">[</span><span class="token number">1038</span><span class="token punctuation">]</span>: WARNING: AllowZoneDrifting is enabled. This is considered an i<span class="token operator">&gt;</span>
Nov <span class="token number">29</span> 02:08:58 OpenStack systemd<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: Stopping firewalld - dynamic firewall daemon<span class="token punctuation">..</span>.
Nov <span class="token number">29</span> 02:08:58 OpenStack systemd<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: firewalld.service: Succeeded.
Nov <span class="token number">29</span> 02:08:58 OpenStack systemd<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: Stopped firewalld - dynamic firewall daemon.

<span class="token punctuation">[</span>root@controller Python-3.9.15<span class="token punctuation">]</span><span class="token comment"># </span>

<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># vi /etc/sysconfig/selinux </span>

<span class="token comment">####################原内容########################################</span>
<span class="token comment"># This file controls the state of SELinux on the system.</span>
<span class="token comment"># SELINUX= can take one of these three values:</span>
<span class="token comment">#     enforcing - SELinux security policy is enforced.</span>
<span class="token comment">#     permissive - SELinux prints warnings instead of enforcing.</span>
<span class="token comment">#     disabled - No SELinux policy is loaded.</span>
<span class="token assign-left variable">SELINUX</span><span class="token operator">=</span>enforcing
<span class="token comment"># SELINUXTYPE= can take one of these three values:</span>
<span class="token comment">#     targeted - Targeted processes are protected,</span>
<span class="token comment">#     minimum - Modification of targeted policy. Only selected processes are protected.</span>
<span class="token comment">#     mls - Multi Level Security protection.</span>
<span class="token assign-left variable">SELINUXTYPE</span><span class="token operator">=</span>targeted

<span class="token comment">####################修改后的内容####################################</span>
<span class="token comment"># This file controls the state of SELinux on the system.</span>
<span class="token comment"># SELINUX= can take one of these three values:</span>
<span class="token comment">#     enforcing - SELinux security policy is enforced.</span>
<span class="token comment">#     permissive - SELinux prints warnings instead of enforcing.</span>
<span class="token comment">#     disabled - No SELinux policy is loaded.</span>
<span class="token assign-left variable">SELINUX</span><span class="token operator">=</span>disabled
<span class="token comment"># SELINUXTYPE= can take one of these three values:</span>
<span class="token comment">#     targeted - Targeted processes are protected,</span>
<span class="token comment">#     minimum - Modification of targeted policy. Only selected processes are protected.</span>
<span class="token comment">#     mls - Multi Level Security protection.</span>
<span class="token assign-left variable">SELINUXTYPE</span><span class="token operator">=</span>targeted
</code></pre> 
<h3><a id="epel_212"></a>四、下载epel源</h3> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># yum makecache</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># yum -y install epel-release</span>
</code></pre> 
<h3><a id="_217"></a>五、网卡信息</h3> 
<table><thead><tr><th>IP地址</th><th>网络类型</th><th>网卡</th><th>在OpenStack网络中的作用</th></tr></thead><tbody><tr><td>192.168.85.130</td><td>NAT</td><td>ens160</td><td>OpenStack内部管理网络（management network），Horizon web界面访问就是通过该网卡</td></tr><tr><td>无（不能配置IP地址）</td><td>bridge（桥接）</td><td>ens192</td><td>外部网络（external network），让neutron（OpenStack中的网络组件）的br-ex绑定使用，OpenStack中的虚拟机是通过该网卡与外网通信</td></tr></tbody></table> 
<h3><a id="ansiblekollaansible_223"></a>六、安装ansible和kolla-ansible</h3> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># pip install --upgrade setuptools</span>
Requirement already satisfied: setuptools <span class="token keyword">in</span> /usr/local/lib/python3.9/site-packages <span class="token punctuation">(</span><span class="token number">58.1</span>.0<span class="token punctuation">)</span>
Collecting setuptools
  Downloading setuptools-65.6.3-py3-none-any.whl <span class="token punctuation">(</span><span class="token number">1.2</span> MB<span class="token punctuation">)</span>
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class="token number">1.2</span>/1.2 MB <span class="token number">626.3</span> kB/s eta <span class="token number">0</span>:00:00
Installing collected packages: setuptools
  Attempting uninstall: setuptools
    Found existing installation: setuptools <span class="token number">58.1</span>.0
    Uninstalling setuptools-58.1.0:
      Successfully uninstalled setuptools-58.1.0
Successfully installed setuptools-65.6.3
WARNING: Running pip as the <span class="token string">'root'</span> user can result <span class="token keyword">in</span> broken permissions and conflicting behaviour with the system package manager. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv
WARNING: You are using pip version <span class="token number">22.0</span>.4<span class="token punctuation">;</span> however, version <span class="token number">22.3</span>.1 is available.
You should consider upgrading via the <span class="token string">'/usr/local/bin/python3.9 -m pip install --upgrade pip'</span> command.
</code></pre> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># pip install ansible</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
Collecting pycparser
  Downloading pycparser-2.21-py2.py3-none-any.whl <span class="token punctuation">(</span><span class="token number">118</span> kB<span class="token punctuation">)</span>
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class="token number">118.7</span>/118.7 KB <span class="token number">2.4</span> MB/s eta <span class="token number">0</span>:00:00
Installing collected packages: resolvelib, PyYAML, pyparsing, pycparser, MarkupSafe, packaging, jinja2, cffi, cryptography, ansible-core, ansible
Successfully installed MarkupSafe-2.1.1 PyYAML-6.0 ansible-7.0.0 ansible-core-2.14.0 cffi-1.15.1 cryptography-38.0.4 jinja2-3.1.2 packaging-21.3 pycparser-2.21 pyparsing-3.0.9 resolvelib-0.8.1
WARNING: Running pip as the <span class="token string">'root'</span> user can result <span class="token keyword">in</span> broken permissions and conflicting behaviour with the system package manager. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv
WARNING: You are using pip version <span class="token number">22.0</span>.4<span class="token punctuation">;</span> however, version <span class="token number">22.3</span>.1 is available.
You should consider upgrading via the <span class="token string">'/usr/local/bin/python3.9 -m pip install --upgrade pip'</span> command.

</code></pre> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># pip install kolla-ansible</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
Successfully built pyhcl
Installing collected packages: pytz, pyhcl, netifaces, netaddr, wrapt, urllib3, rfc3986, pbr, jmespath, iso8601, idna, charset-normalizer, certifi, stevedore, requests, oslo.i18n, debtcollector, oslo.utils, oslo.config, hvac, kolla-ansible
Successfully installed certifi-2022.9.24 charset-normalizer-2.1.1 debtcollector-2.5.0 hvac-1.0.2 idna-3.4 iso8601-1.1.0 jmespath-1.0.1 kolla-ansible-14.6.0 netaddr-0.8.0 netifaces-0.11.0 oslo.config-9.0.0 oslo.i18n-5.1.0 oslo.utils-6.1.0 pbr-5.11.0 pyhcl-0.4.4 pytz-2022.6 requests-2.28.1 rfc3986-2.0.0 stevedore-4.1.1 urllib3-1.26.13 wrapt-1.14.1
WARNING: Running pip as the <span class="token string">'root'</span> user can result <span class="token keyword">in</span> broken permissions and conflicting behaviour with the system package manager. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv
WARNING: You are using pip version <span class="token number">22.0</span>.4<span class="token punctuation">;</span> however, version <span class="token number">22.3</span>.1 is available.
You should consider upgrading via the <span class="token string">'/usr/local/bin/python3.9 -m pip install --upgrade pip'</span> command.

</code></pre> 
<h3><a id="ansible_264"></a>七、复制ansible相关配置</h3> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># cp -r /usr/local/python3/share/kolla-ansible/etc_examples/kolla /etc/ </span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># cp /usr/local/python3/share/kolla-ansible/ansible/inventory/* /etc/kolla/</span>

</code></pre> 
<h3><a id="OpenStackWeb_270"></a>八、生成OpenStack各个服务的密码文件，并修改Web页面登录密码</h3> 
<h4><a id="1OpenStack_271"></a>1、生成OpenStack各个服务的密码文件，并验证</h4> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># kolla-genpwd     </span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># ssh-copy-id root@controller            # 这一步操作完成后，即可在主机cmd中输入ssh root@ip进行验证。</span>
*************************************************************************************
C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span><span class="token number">2733</span><span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span>ssh root@192.168.85.130
The authenticity of <span class="token function">host</span> <span class="token string">'192.168.85.130 (192.168.85.130)'</span> can<span class="token string">'t be established.
ED25519 key fingerprint is SHA256:oee5rP/ej7rIJLXrU/GwPXXlMHooeQsFk2X2JiE7q4c.
This key is not known by any other names
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '</span><span class="token number">192.168</span>.85.130<span class="token string">' (ED25519) to the list of known hosts.
root@192.168.85.130'</span>s password:
Last login: Thu Dec  <span class="token number">1</span> 03:43:13 <span class="token number">2022</span> from <span class="token number">192.168</span>.85.130
**************************************************************************************
<span class="token comment"># 如果上述指令出现类似下面的报错信息，可以按照下列教程操作：</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/89/07/e8B0116Z_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-shell"><span class="token comment"># 在windows下 cmd 输入： ssh-keygen -R “远程服务器ip地址” ，清除当前机器缓存的之前的公钥信息。</span>
<span class="token comment"># 然后执行ssh root@ip，并通过密码验证，就可以连接上虚拟机了。</span>
*************************************************************************************
<span class="token comment"># 一般第一次进行ssh验证，基本上都能成功，不成功，说明虚拟机的IP已经在cmd中验证过，需要将前面的公钥信息清理。</span>
</code></pre> 
<h6><a id="_294"></a>参考文献</h6> 
<p><a href="https://blog.csdn.net/weixin_46935110/article/details/124682671">ECDSA host key for … has changed and you have requested strict checking.Host key verification fail</a></p> 
<h4><a id="2web_297"></a>2、修改web页面登录密码</h4> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># vi /etc/kolla/passwords.yml</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
horizon_secret_key: ********************************
infoblox_admin_password: *************************************
ironic_database_password: ****************************************
ironic_inspector_database_password: ****************************************
ironic_inspector_keystone_password: ****************************************
ironic_keystone_password: ****************************************
keepalived_password: ********************************************
<span class="token comment"># keystone_admin_password: ***************</span>
keystone_database_password: **********************************
keystone_federation_openid_crypto_password: **********************************
keystone_ssh_key:
  private_key: '-----BEGIN PRIVATE KEY-----

</code></pre> 
<p><img src="https://images2.imgbox.com/0d/82/F7ePwCQZ_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="etckollaglobalymlOpenStack_316"></a>九、编辑/etc/kolla/global.yml文件，自定义OpenStack部署项</h3> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># vi /etc/kolla/global.yml</span>
<span class="token comment">#选择下载的基础镜像</span>
kolla_base_distro: <span class="token string">"centos"</span>
<span class="token comment">#选择的安装方法，2选1。binary二进制安装，source源码安装</span>
kolla_install_type: <span class="token string">"source"</span>
<span class="token comment">#选择OpenStack的版本标签，</span>
openstack_release: <span class="token string">"yoga"</span>
<span class="token comment">#OpenStack内部管理网络地址，通过该IP访问OpenStack Web页面进行管理。如果启用了高可用，需要设置为VIP（浮动IP）</span>
kolla_internal_vip_address: <span class="token string">"192.168.85.130"</span>
<span class="token comment">#OpenStack内部管理网络地址的网卡接口</span>
network_interface: <span class="token string">"ens160"</span>
<span class="token comment">#此网卡应该在没有IP地址的情况下处于活动，如果不是，那么OpenStack云平台中的云主机实例将无法访问外部网络。（存在IP时br-ex桥接就不成功）</span>
neutron_external_interface: <span class="token string">"ens192"</span>
<span class="token comment">#关闭高可用</span>
enable_haproxy: <span class="token string">"no"</span>
<span class="token comment">#关闭cinder（块存储）</span>
enable_cinder: <span class="token string">"no"</span>
<span class="token comment">#指定nova-compute守护进程使用的虚拟化技术。（kvm好像有点问题，大家可以试试，看看你们能不能过nova下载）nova-compute是一个非常重要的守护进程，负责创建和终止虚拟机实例，即管理虚拟机实例的生命周期。</span>
nova_compute_virt_type: <span class="token string">"qemu"</span> <span class="token comment">#在物理机上部署时无需设置（默认kvm） ，仅在虚拟机中部署kolla-ansible-openstack时设置qemu</span>
</code></pre> 
<h3><a id="_338"></a>十、互信任</h3> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># ssh-keygen -t rsa	# 这一步会有选择密码存储位置的选项，直接将括号中的内容（./root/.ssh_rsa)，                                         # 然后是设置密码，可以直接两次Enter键，就是不设置密码。</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># ssh-copy-id -i ~/.ssh/id_rsa root@controller        #这里注意@后面是自己的主机名，也就是第                                                                          #一步设置的。</span>
</code></pre> 
<h3><a id="allinone_343"></a>十一、配置单节点（all-in-one）清单文件</h3> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># vi /etc/kolla/all-in-one</span>
<span class="token comment"># 在打开的vim文件中输入指令:</span>
：1，<span class="token variable">$s</span>/localhost       <span class="token assign-left variable">ansible_connection</span><span class="token operator">=</span>local/controller/

</code></pre> 
<p><img src="https://images2.imgbox.com/b6/c5/u6yer6QX_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="Ansible_Galaxyyoga_351"></a>十二、安装Ansible Galaxy依赖（yoga版本需要安装该依赖）</h3> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># yum install git -y</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># cp /usr/local/python3/share/kolla-ansible/requirements.yml /usr/local/python3/</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># kolla-ansible install-deps</span>
</code></pre> 
<h3><a id="_358"></a>十三、开始部署</h3> 
<pre><code class="prism language-shell"><span class="token comment"># 对主机进行部署前检查</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># kolla-ansible -i /etc/kolla/all-in-one prechecks</span>
</code></pre> 
<h4><a id="1TASK_prechecks__Checking_Docker_version_fatal_controller_FAILED_365"></a>1、如果上一步出现“TASK [prechecks : Checking Docker version] fatal: [controller]: FAILED!”错误，执行下一步：</h4> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># kolla-ansible -i /etc/kolla/all-in-one bootstrap-servers</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># kolla-ansible -i /etc/kolla/all-in-one prechecks</span>

</code></pre> 
<h4><a id="2TASK_prechecks__Checking_docker_SDK_version_fatal_controller_FAILED__372"></a>2、如果上一步操作仍然出现“TASK [prechecks : Checking docker SDK version] fatal: [controller]: FAILED! ”错误，执行下一步：</h4> 
<pre><code class="prism language-shell"><span class="token comment">#配置docker源</span>
<span class="token punctuation">[</span>root@all-in-one ~<span class="token punctuation">]</span><span class="token comment"># wget -O /etc/yum.repos.d/docker-ce.repo https://download.docker.com/linux/centos/docker-ce.repo</span>
<span class="token punctuation">[</span>root@all-in-one ~<span class="token punctuation">]</span><span class="token comment"># sed -i 's+download.docker.com+mirrors.tuna.tsinghua.edu.cn/docker-ce+' /etc/yum.repos.d/docker-ce.repo</span>

<span class="token comment"># 安装docker-ce</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># yum install docker-ce -y</span>
<span class="token comment"># 使用kolla部署依赖项的引导服务器</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># kolla-ansible -i /etc/kolla/all-in-one bootstrap-servers</span>
<span class="token comment"># 对主机进行部署前检查</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># kolla-ansible -i /etc/kolla/all-in-one prechecks</span>
</code></pre> 
<h4><a id="3_385"></a>3、上述不报错执行接下来的指令：</h4> 
<pre><code class="prism language-shell"><span class="token comment"># 拉取镜像</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># kolla-ansible -i /etc/kolla/all-in-one pull</span>
<span class="token comment"># 部署</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># kolla-ansible -i /etc/kolla/all-in-one deploy</span>

</code></pre> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-BAoRv6eV-1669918781216)(E:\虚拟化技术\教程\centos stream 8虚拟机搭建单节点OpenStack-图片文件\OpenStack部署.png)]</p> 
<h4><a id="4OpenStack_396"></a>4、安装OpenStack客户端</h4> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># pip install python-openstackclient -c https://releases.openstack.org/constraints/upper/master</span>
Collecting python-openstackclient
  Downloading python_openstackclient-6.0.0-py3-none-any.whl <span class="token punctuation">(</span><span class="token number">998</span> kB<span class="token punctuation">)</span>
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class="token number">998.5</span>/998.5 kB <span class="token number">2.7</span> MB/s eta <span class="token number">0</span>:00:00
Requirement already satisfied: iso860<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span><span class="token operator">=</span><span class="token number">0.1</span>.11 <span class="token keyword">in</span> /usr/local/python3/lib/python3.9/site-packages <span class="token punctuation">(</span>from python-openstackclient<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token number">1.1</span>.0<span class="token punctuation">)</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
</code></pre> 
<h4><a id="5etckollaadminopenrcsh_407"></a>5、验证部署，生成/etc/kolla/admin-openrc.sh</h4> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># kolla-ansible -i /etc/kolla/all-in-one post-deploy</span>
Post-Deploying Playbooks <span class="token builtin class-name">:</span> ansible-playbook <span class="token parameter variable">-e</span> @/etc/kolla/globals.yml  <span class="token parameter variable">-e</span> @/etc/kolla/passwords.yml <span class="token parameter variable">-e</span> <span class="token assign-left variable">CONFIG_DIR</span><span class="token operator">=</span>/etc/kolla  /usr/local/python3/ansible/post-deploy.yml  <span class="token parameter variable">--inventory</span> /etc/kolla/all-in-one
<span class="token punctuation">[</span>WARNING<span class="token punctuation">]</span>: Invalid characters were found <span class="token keyword">in</span> group names but not replaced, use <span class="token parameter variable">-vvvv</span> to see details

PLAY <span class="token punctuation">[</span>Creating admin openrc <span class="token function">file</span> on the deploy node<span class="token punctuation">]</span> *********************************************************************************

TASK <span class="token punctuation">[</span>Gathering Facts<span class="token punctuation">]</span> ***************************************************************************************************************
ok: <span class="token punctuation">[</span>localhost<span class="token punctuation">]</span>

TASK <span class="token punctuation">[</span>Template out admin-openrc.sh<span class="token punctuation">]</span> **************************************************************************************************
changed: <span class="token punctuation">[</span>localhost<span class="token punctuation">]</span>

TASK <span class="token punctuation">[</span>octavia <span class="token builtin class-name">:</span> Template out octavia-openrc.sh<span class="token punctuation">]</span> **************************************************************************************
skipping: <span class="token punctuation">[</span>localhost<span class="token punctuation">]</span>

PLAY RECAP ***************************************************************************************************************************
localhost                  <span class="token builtin class-name">:</span> <span class="token assign-left variable">ok</span><span class="token operator">=</span><span class="token number">2</span>    <span class="token assign-left variable">changed</span><span class="token operator">=</span><span class="token number">1</span>    <span class="token assign-left variable">unreachable</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">failed</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">skipped</span><span class="token operator">=</span><span class="token number">1</span>    <span class="token assign-left variable">rescued</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">ignored</span><span class="token operator">=</span><span class="token number">0</span>   

<span class="token punctuation">[</span>root@controller kolla<span class="token punctuation">]</span><span class="token comment"># vi admin-openrc.sh</span>
**********************************************************************************************
**********************************************************************************************
**********************************************************************************************
********<span class="token comment"># Ansible managed                                                             ********</span>
********                                                                              ********
********<span class="token comment"># Clear any old environment that may conflict.                                ********</span>
********for <span class="token for-or-select variable">key</span> <span class="token keyword">in</span> <span class="token variable"><span class="token variable">$(</span> <span class="token builtin class-name">set</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{FS="="}  /^OS_/ {print $1}'</span> <span class="token variable">)</span></span><span class="token punctuation">;</span> <span class="token keyword">do</span> <span class="token builtin class-name">unset</span> <span class="token variable">$key</span> <span class="token punctuation">;</span> <span class="token keyword">done</span> ********
********export <span class="token assign-left variable">OS_PROJECT_DOMAIN_NAME</span><span class="token operator">=</span>Default                                         ********
********export <span class="token assign-left variable">OS_USER_DOMAIN_NAME</span><span class="token operator">=</span>Default                                            ********
********export <span class="token assign-left variable">OS_PROJECT_NAME</span><span class="token operator">=</span>admin                                                  ********
********export <span class="token assign-left variable">OS_TENANT_NAME</span><span class="token operator">=</span>admin                                                   ********
********export <span class="token assign-left variable">OS_USERNAME</span><span class="token operator">=</span>admin  <span class="token comment"># web页面登录用户名                                   ********</span>
********export <span class="token assign-left variable">OS_PASSWORD</span><span class="token operator">=</span>****** <span class="token comment"># web页面登录密码                                     ********</span>
********export <span class="token assign-left variable">OS_AUTH_URL</span><span class="token operator">=</span>http://192.168.********  <span class="token comment"># web页面url               ********</span>
********export <span class="token assign-left variable">OS_INTERFACE</span><span class="token operator">=</span>internal                                                  ********
********export <span class="token assign-left variable">OS_ENDPOINT_TYPE</span><span class="token operator">=</span>internalURL                                           ********
********export <span class="token assign-left variable">OS_IDENTITY_API_VERSION</span><span class="token operator">=</span><span class="token number">3</span>                                              ********
********export <span class="token assign-left variable">OS_REGION_NAME</span><span class="token operator">=</span>RegionOne                                               ********
********export <span class="token assign-left variable">OS_AUTH_PLUGIN</span><span class="token operator">=</span>password                                                ********
**********************************************************************************************
**********************************************************************************************
**********************************************************************************************
</code></pre> 
<h3><a id="web_452"></a>十四、web页面验证</h3> 
<p>浏览器输入客户端地址：http://192.168.85.130/<br> <img src="https://images2.imgbox.com/88/68/An7nI2lQ_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/b2/d0/iLCeGbab_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_456"></a>十五、部署过程中遇到的错误记录（部分）</h3> 
<pre><code class="prism language-shell">RUNNING HANDLER <span class="token punctuation">[</span>common <span class="token builtin class-name">:</span> Restart fluentd container<span class="token punctuation">]</span> *****************************************************************
fatal: <span class="token punctuation">[</span>OpenStack<span class="token punctuation">]</span>: FAILED<span class="token operator">!</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span><span class="token string">"changed"</span><span class="token builtin class-name">:</span> true, <span class="token string">"msg"</span><span class="token builtin class-name">:</span> <span class="token string">"'Traceback (most recent call last):<span class="token entity" title="\\">\\</span>n  File <span class="token entity" title='\"'>\"</span>/usr/local/lib/python3.6/site-packages/docker/api/client.py<span class="token entity" title='\"'>\"</span>, line 268, in _raise_for_status<span class="token entity" title="\\">\\</span>n    response.raise_for_status()<span class="token entity" title="\\">\\</span>n  File <span class="token entity" title='\"'>\"</span>/usr/local/lib/python3.6/site-packages/requests/models.py<span class="token entity" title='\"'>\"</span>, line 960, in raise_for_status<span class="token entity" title="\\">\\</span>n    raise HTTPError(http_error_msg, response=self)<span class="token entity" title="\\">\\</span>nrequests.exceptions.HTTPError: 404 Client Error: Not Found for url: http+docker://localhost/v1.41/images/create?tag=yoga-centos-stream9&amp;fromImage=quay.io%2Fopenstack.kolla%2Ffluentd<span class="token entity" title="\\">\\</span>n<span class="token entity" title="\\">\\</span>nDuring handling of the above exception, another exception occurred:<span class="token entity" title="\\">\\</span>n<span class="token entity" title="\\">\\</span>nTraceback (most recent call last):<span class="token entity" title="\\">\\</span>n  File <span class="token entity" title='\"'>\"</span>/tmp/ansible_kolla_docker_payload_36i1ds38/ansible_kolla_docker_payload.zip/ansible/modules/kolla_docker.py<span class="token entity" title='\"'>\"</span>, line 381, in main<span class="token entity" title="\\">\\</span>n  File <span class="token entity" title='\"'>\"</span>/tmp/ansible_kolla_docker_payload_36i1ds38/ansible_kolla_docker_payload.zip/ansible/module_utils/kolla_docker_worker.py<span class="token entity" title='\"'>\"</span>, line 651, in recreate_or_restart_container<span class="token entity" title="\\">\\</span>n    self.start_container()<span class="token entity" title="\\">\\</span>n  File <span class="token entity" title='\"'>\"</span>/tmp/ansible_kolla_docker_payload_36i1ds38/ansible_kolla_docker_payload.zip/ansible/module_utils/kolla_docker_worker.py<span class="token entity" title='\"'>\"</span>, line 669, in start_container<span class="token entity" title="\\">\\</span>n    self.pull_image()<span class="token entity" title="\\">\\</span>n  File <span class="token entity" title='\"'>\"</span>/tmp/ansible_kolla_docker_payload_36i1ds38/ansible_kolla_docker_payload.zip/ansible/module_utils/kolla_docker_worker.py<span class="token entity" title='\"'>\"</span>, line 451, in pull_image<span class="token entity" title="\\">\\</span>n    repository=image, tag=tag, stream=True<span class="token entity" title="\\">\\</span>n  File <span class="token entity" title='\"'>\"</span>/usr/local/lib/python3.6/site-packages/docker/api/image.py<span class="token entity" title='\"'>\"</span>, line 430, in pull<span class="token entity" title="\\">\\</span>n    self._raise_for_status(response)<span class="token entity" title="\\">\\</span>n  File <span class="token entity" title='\"'>\"</span>/usr/local/lib/python3.6/site-packages/docker/api/client.py<span class="token entity" title='\"'>\"</span>, line 270, in _raise_for_status<span class="token entity" title="\\">\\</span>n    raise create_api_error_from_http_exception(e)<span class="token entity" title="\\">\\</span>n  File <span class="token entity" title='\"'>\"</span>/usr/local/lib/python3.6/site-packages/docker/errors.py<span class="token entity" title='\"'>\"</span>, line 31, in create_api_error_from_http_exception<span class="token entity" title="\\">\\</span>n    raise cls(e, response=response, explanation=explanation)<span class="token entity" title="\\">\\</span>ndocker.errors.NotFound: 404 Client Error for http+docker://localhost/v1.41/images/create?tag=yoga-centos-stream9&amp;fromImage=quay.io%2Fopenstack.kolla%2Ffluentd: Not Found (<span class="token entity" title='\"'>\"</span>manifest for quay.io/openstack.kolla/fluentd:yoga-centos-stream9 not found: manifest unknown: manifest unknown<span class="token entity" title='\"'>\"</span>)<span class="token entity" title="\\">\\</span>n'"</span><span class="token punctuation">}</span>

RUNNING HANDLER <span class="token punctuation">[</span>common <span class="token builtin class-name">:</span> Restart kolla-toolbox container<span class="token punctuation">]</span> ***********************************************************

RUNNING HANDLER <span class="token punctuation">[</span>common <span class="token builtin class-name">:</span> Restart <span class="token function">cron</span> container<span class="token punctuation">]</span> ********************************************************************

NO MORE HOSTS LEFT ***************************************************************************************************

PLAY RECAP ***********************************************************************************************************
OpenStack                  <span class="token builtin class-name">:</span> <span class="token assign-left variable">ok</span><span class="token operator">=</span><span class="token number">20</span>   <span class="token assign-left variable">changed</span><span class="token operator">=</span><span class="token number">10</span>   <span class="token assign-left variable">unreachable</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">failed</span><span class="token operator">=</span><span class="token number">1</span>    <span class="token assign-left variable">skipped</span><span class="token operator">=</span><span class="token number">1</span>    <span class="token assign-left variable">rescued</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">ignored</span><span class="token operator">=</span><span class="token number">0</span>   
localhost                  <span class="token builtin class-name">:</span> <span class="token assign-left variable">ok</span><span class="token operator">=</span><span class="token number">4</span>    <span class="token assign-left variable">changed</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">unreachable</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">failed</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">skipped</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">rescued</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">ignored</span><span class="token operator">=</span><span class="token number">0</span>   

<span class="token punctuation">(</span>venv<span class="token punctuation">)</span> <span class="token punctuation">[</span>root@OpenStack ~<span class="token punctuation">]</span><span class="token comment"># </span>

</code></pre> 
<pre><code class="prism language-shell">TASK <span class="token punctuation">[</span>prechecks <span class="token builtin class-name">:</span> Checking <span class="token function">host</span> OS release or version<span class="token punctuation">]</span> ***************************************************************
fatal: <span class="token punctuation">[</span>localhost<span class="token punctuation">]</span>: FAILED<span class="token operator">!</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span><span class="token string">"changed"</span><span class="token builtin class-name">:</span> false, <span class="token string">"msg"</span><span class="token builtin class-name">:</span> <span class="token string">"CentOS release Stream version 8 is not supported. Supported releases are: 9"</span><span class="token punctuation">}</span>
fatal: <span class="token punctuation">[</span>OpenStack<span class="token punctuation">]</span>: FAILED<span class="token operator">!</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span><span class="token string">"changed"</span><span class="token builtin class-name">:</span> false, <span class="token string">"msg"</span><span class="token builtin class-name">:</span> <span class="token string">"CentOS release Stream version 8 is not supported. Supported releases are: 9"</span><span class="token punctuation">}</span>

</code></pre> 
<pre><code class="prism language-shell">RUNNING HANDLER <span class="token punctuation">[</span>common <span class="token builtin class-name">:</span> Restart fluentd container<span class="token punctuation">]</span> *****************************************************************
fatal: <span class="token punctuation">[</span>OpenStack<span class="token punctuation">]</span>: FAILED<span class="token operator">!</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span><span class="token string">"changed"</span><span class="token builtin class-name">:</span> true, <span class="token string">"msg"</span><span class="token builtin class-name">:</span> <span class="token string">"'Traceback (most recent call last):<span class="token entity" title="\\">\\</span>n  File <span class="token entity" title='\"'>\"</span>/usr/local/lib/python3.6/site-packages/docker/api/client.py<span class="token entity" title='\"'>\"</span>, line 268, in _raise_for_status<span class="token entity" title="\\">\\</span>n    response.raise_for_status()<span class="token entity" title="\\">\\</span>n  File <span class="token entity" title='\"'>\"</span>/usr/local/lib/python3.6/site-packages/requests/models.py<span class="token entity" title='\"'>\"</span>, line 960, in raise_for_status<span class="token entity" title="\\">\\</span>n    raise HTTPError(http_error_msg, response=self)<span class="token entity" title="\\">\\</span>nrequests.exceptions.HTTPError: 500 Server Error: Internal Server Error for url: http+docker://localhost/v1.41/images/create?tag=train-centos-stream9&amp;fromImage=quay.io%2Fkolla%2Ffluentd<span class="token entity" title="\\">\\</span>n<span class="token entity" title="\\">\\</span>nDuring handling of the above exception, another exception occurred:<span class="token entity" title="\\">\\</span>n<span class="token entity" title="\\">\\</span>nTraceback (most recent call last):<span class="token entity" title="\\">\\</span>n  File <span class="token entity" title='\"'>\"</span>/tmp/ansible_kolla_docker_payload_3w3thase/ansible_kolla_docker_payload.zip/ansible/modules/kolla_docker.py<span class="token entity" title='\"'>\"</span>, line 381, in main<span class="token entity" title="\\">\\</span>n  File <span class="token entity" title='\"'>\"</span>/tmp/ansible_kolla_docker_payload_3w3thase/ansible_kolla_docker_payload.zip/ansible/module_utils/kolla_docker_worker.py<span class="token entity" title='\"'>\"</span>, line 651, in recreate_or_restart_container<span class="token entity" title="\\">\\</span>n    self.start_container()<span class="token entity" title="\\">\\</span>n  File <span class="token entity" title='\"'>\"</span>/tmp/ansible_kolla_docker_payload_3w3thase/ansible_kolla_docker_payload.zip/ansible/module_utils/kolla_docker_worker.py<span class="token entity" title='\"'>\"</span>, line 669, in start_container<span class="token entity" title="\\">\\</span>n    self.pull_image()<span class="token entity" title="\\">\\</span>n  File <span class="token entity" title='\"'>\"</span>/tmp/ansible_kolla_docker_payload_3w3thase/ansible_kolla_docker_payload.zip/ansible/module_utils/kolla_docker_worker.py<span class="token entity" title='\"'>\"</span>, line 451, in pull_image<span class="token entity" title="\\">\\</span>n    repository=image, tag=tag, stream=True<span class="token entity" title="\\">\\</span>n  File <span class="token entity" title='\"'>\"</span>/usr/local/lib/python3.6/site-packages/docker/api/image.py<span class="token entity" title='\"'>\"</span>, line 430, in pull<span class="token entity" title="\\">\\</span>n    self._raise_for_status(response)<span class="token entity" title="\\">\\</span>n  File <span class="token entity" title='\"'>\"</span>/usr/local/lib/python3.6/site-packages/docker/api/client.py<span class="token entity" title='\"'>\"</span>, line 270, in _raise_for_status<span class="token entity" title="\\">\\</span>n    raise create_api_error_from_http_exception(e)<span class="token entity" title="\\">\\</span>n  File <span class="token entity" title='\"'>\"</span>/usr/local/lib/python3.6/site-packages/docker/errors.py<span class="token entity" title='\"'>\"</span>, line 31, in create_api_error_from_http_exception<span class="token entity" title="\\">\\</span>n    raise cls(e, response=response, explanation=explanation)<span class="token entity" title="\\">\\</span>ndocker.errors.APIError: 500 Server Error for http+docker://localhost/v1.41/images/create?tag=train-centos-stream9&amp;fromImage=quay.io%2Fkolla%2Ffluentd: Internal Server Error (<span class="token entity" title='\"'>\"</span>unauthorized: access to the requested resource is not authorized<span class="token entity" title='\"'>\"</span>)<span class="token entity" title="\\">\\</span>n'"</span><span class="token punctuation">}</span>

</code></pre> 
<pre><code class="prism language-shell"><span class="token punctuation">(</span>venv<span class="token punctuation">)</span> <span class="token punctuation">[</span>root@controller yum.repos.d<span class="token punctuation">]</span><span class="token comment"># yum makecache</span>
CentOS-8 - RabbitMQ <span class="token number">38</span>                                                                 <span class="token number">67</span> kB/s <span class="token operator">|</span>  <span class="token number">80</span> kB     00:01    
CentOS- <span class="token number">8</span> - OpenStack train                                                           <span class="token number">8.3</span>  B/s <span class="token operator">|</span>  <span class="token number">38</span>  B     00:04    
Error: Failed to download metadata <span class="token keyword">for</span> repo <span class="token string">'centos-openstack-train'</span><span class="token builtin class-name">:</span> Cannot prepare internal mirrorlist: No URLs <span class="token keyword">in</span> mirrorlist

</code></pre> 
<pre><code class="prism language-shell"><span class="token function">sed</span> <span class="token parameter variable">-e</span> <span class="token string">'s|^mirrorlist=|#mirrorlist=|g'</span> <span class="token parameter variable">-e</span> <span class="token string">'s|^#baseurl=http://mirror.centos.org/centos|baseurl=https://mirrors.ustc.edu.cn/centos|g'</span> <span class="token parameter variable">-i.bak</span> /etc/yum.repos.d/CentOS-Base.repo

<span class="token function">wget</span> <span class="token parameter variable">-O</span> /etc/yum.repos.d/docker-ce.repo https://download.docker.com/linux/centos/docker-ce.repo

<span class="token function">cat</span> <span class="token operator">&gt;&gt;</span> /etc/docker/daemon.json <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
{
"registry-mirrors": [
"https://registry.docker-cn.com",
"http://hub-mirror.c.163.com",
"https://docker.mirrors.ustc.edu.cn"
]
}
EOF</span>

</code></pre> 
<pre><code class="prism language-shell">TASK <span class="token punctuation">[</span>prechecks <span class="token builtin class-name">:</span> Checking Docker version<span class="token punctuation">]</span> fatal: <span class="token punctuation">[</span>controller<span class="token punctuation">]</span>: FAILED<span class="token operator">!</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span><span class="token string">"changed"</span><span class="token builtin class-name">:</span> false, <span class="token string">"cmd"</span><span class="token builtin class-name">:</span> <span class="token string">"docker --version"</span>, <span class="token string">"failed_when_result"</span><span class="token builtin class-name">:</span> true, <span class="token string">"msg"</span><span class="token builtin class-name">:</span> <span class="token string">"[Errno 2] 没有那个文件或目录: b'docker': b'docker'"</span>, <span class="token string">"rc"</span><span class="token builtin class-name">:</span> <span class="token number">2</span>, <span class="token string">"stderr"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>, <span class="token string">"stderr_lines"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>, <span class="token string">"stdout"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>, <span class="token string">"stdout_lines"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span>

</code></pre> 
<h6><a id="Checking_docker_SDK_version_519"></a>Checking docker SDK version错误</h6> 
<pre><code class="prism language-shell">TASK <span class="token punctuation">[</span>prechecks <span class="token builtin class-name">:</span> Checking <span class="token function">docker</span> SDK version<span class="token punctuation">]</span> ***************************************************************************************
fatal: <span class="token punctuation">[</span>controller<span class="token punctuation">]</span>: FAILED<span class="token operator">!</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span><span class="token string">"changed"</span><span class="token builtin class-name">:</span> false, <span class="token string">"cmd"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">"/usr/libexec/platform-python"</span>, <span class="token string">"-c"</span>, <span class="token string">"import docker; print(docker.__version__)"</span><span class="token punctuation">]</span>, <span class="token string">"delta"</span><span class="token builtin class-name">:</span> <span class="token string">"0:00:00.015630"</span>, <span class="token string">"end"</span><span class="token builtin class-name">:</span> <span class="token string">"2022-12-01 02:43:02.499115"</span>, <span class="token string">"failed_when_result"</span><span class="token builtin class-name">:</span> true, <span class="token string">"msg"</span><span class="token builtin class-name">:</span> <span class="token string">"non-zero return code"</span>, <span class="token string">"rc"</span><span class="token builtin class-name">:</span> <span class="token number">1</span>, <span class="token string">"start"</span><span class="token builtin class-name">:</span> <span class="token string">"2022-12-01 02:43:02.483485"</span>, <span class="token string">"stderr"</span><span class="token builtin class-name">:</span> <span class="token string">"Traceback (most recent call last):<span class="token entity" title="\n">\n</span>  File <span class="token entity" title='\"'>\"</span>&lt;string&gt;<span class="token entity" title='\"'>\"</span>, line 1, in &lt;module&gt;<span class="token entity" title="\n">\n</span>ModuleNotFoundError: No module named 'docker'"</span>, <span class="token string">"stderr_lines"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">"Traceback (most recent call last):"</span>, <span class="token string">"  File <span class="token entity" title='\"'>\"</span>&lt;string&gt;<span class="token entity" title='\"'>\"</span>, line 1, in &lt;module&gt;"</span>, <span class="token string">"ModuleNotFoundError: No module named 'docker'"</span><span class="token punctuation">]</span>, <span class="token string">"stdout"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>, <span class="token string">"stdout_lines"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span>

PLAY RECAP ***************************************************************************************************************************
controller                 <span class="token builtin class-name">:</span> <span class="token assign-left variable">ok</span><span class="token operator">=</span><span class="token number">10</span>   <span class="token assign-left variable">changed</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">unreachable</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">failed</span><span class="token operator">=</span><span class="token number">1</span>    <span class="token assign-left variable">skipped</span><span class="token operator">=</span><span class="token number">12</span>   <span class="token assign-left variable">rescued</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">ignored</span><span class="token operator">=</span><span class="token number">0</span>   

</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0fb9e95b0cfe58466dd7bee1326ffc98/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">解开Kafka神秘的面纱(三)：kafka单机部署和集群部署</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ac9ffc8e239eb070484e08d80d9f57d3/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">word编号技巧：如何将手动编号批量转为自动编号</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>