<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>MyBatis-缓存 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="MyBatis-缓存" />
<meta property="og:description" content="1.了解一级缓存 MyBatis 一级缓存是指在同一个 SqlSession 中，对于相同的查询语句和参数，MyBatis会将查询的结果缓存起来，下次再执行相同的查询时，直接从缓存中获取结果，避免了重复查询数据库的开销。 一级缓存是默认开启的，可以通过配置来关闭或手动清除。一级缓存的作用范围是在一个SqlSession 内部有效，不同的SqlSession 之间的缓存互相独立。 一级缓存的工作原理如下： 当执行一个查询语句时，MyBatis会先检查缓存中是否已经有该查询的结果，如果有，则直接返回缓存中的结果。 如果缓存中没有该查询的结果，则继续执行查询操作，并将查询结果放入缓存中。 下次执行相同的查询时，MyBatis会先检查缓存中是否已经有该查询的结果，如果有，则直接返回缓存中的结果。 可以通过配置文件中的&lt;setting&gt;元素来控制一级缓存的开启和关闭，例如： &lt;setting name=&#34;localCacheScope&#34; value=&#34;STATEMENT&#34;/&gt; 将localCacheScope设置为STATEMENT表示关闭一级缓存，设置为SESSION表示开启一级缓存。另外，在需要手动清除一级缓存时，可以调用SqlSession的clearCache()方法来清空缓存。 2.MyBatis 一级缓存的简单示例 首先，假设我们有一个 StudentMapper 接口来操作用户信息，其中包含了查询用户列表的方法 getStudentClssAll()。 然后，在配置文件中设置开启一级缓存 接着，创建 StudentMapper.xml 文件，配置查询语句和映射规则 大家可以写单表的简单查询
在测试类代码中，我们可以通过 SqlSessionFactory 获取一个 SqlSession 实例，并调用 StudentMapper的方法进行查询 运行结果
在上述示例中，第一次调用 studentList1() 方法时，会从数据库中查询用户列表，并将结果放入一级缓存。然后，第二次调用 studentList2() 方法时，会直接从一级缓存中获取结果，而不再访问数据库。 2.了解二级缓存的配置 二级缓存是MyBatis中的一种缓存机制，用于缓存查询结果。它位于SqlSessionFactory的作用域内，可以在多个会话之间共享。
当使用二级缓存时，首先需要在配置文件中进行相应的设置。在 &lt;settings&gt; 标签下，添加 &lt;setting name=&#34;cacheEnabled&#34; value=&#34;true&#34;/&gt; ，这样即可启用二级缓存。
MyBatis的二级缓存可以提高查询性能，减少数据库访问次数，但需要注意处理对象修改和缓存命中率等问题。
&lt;setting name=&#34;cacheEnabled&#34; value=&#34;true&#34;/&gt; MyBaits二级缓存的示例 1.首先，在MyBatis配置文件中启用二级缓存。在 &lt;configuration&gt; 标签下添加如下配置 &lt;settings&gt; &lt;setting name=&#34;cacheEnabled&#34; value=&#34;true&#34;/&gt; &lt;/settings&gt; 2.在Mapper接口对应的映射文件中开启二级缓存。在需要缓存结果的查询语句上添加 cache=&#34;true&#34; 属性。 &lt;!-- UserMapper.xml --&gt; &lt;mapper namespace=&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/002a8ed90c340c35145be742483092b5/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-08-17T11:18:41+08:00" />
<meta property="article:modified_time" content="2023-08-17T11:18:41+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">MyBatis-缓存</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>1.了解一级缓存 </h2> 
<h4>        MyBatis 一级缓存是指在同一个 <span style="color:#38d8f0;">SqlSession </span>中，对于相同的查询语句和参数，MyBatis会将查询的结果缓存起来，下次再执行相同的查询时，直接从缓存中获取结果，避免了重复查询数据库的开销。</h4> 
<h4>        一级缓存是默认开启的，可以通过配置来关闭或手动清除。一级缓存的作用范围是在一个<span style="color:#38d8f0;">SqlSession </span>内部有效，不同的<span style="color:#38d8f0;">SqlSession </span>之间的缓存互相独立。</h4> 
<p></p> 
<h4><span style="color:#fe2c24;">一级缓存的工作原理如下：</span></h4> 
<ol><li> <h5><span style="background-color:#ffd900;">当执行一个查询语句时，MyBatis会先检查缓存中是否已经有该查询的结果，如果有，则直接返回缓存中的结果。</span></h5> </li><li> <h5><span style="background-color:#ffd900;">如果缓存中没有该查询的结果，则继续执行查询操作，并将查询结果放入缓存中。</span></h5> </li><li> <h5><span style="background-color:#ffd900;">下次执行相同的查询时，MyBatis会先检查缓存中是否已经有该查询的结果，如果有，则直接返回缓存中的结果。</span></h5> </li></ol> 
<h4>可以通过配置文件中的<span style="color:#fe2c24;"><code>&lt;setting&gt;</code></span>元素来控制一级缓存的开启和关闭，例如：</h4> 
<pre><code>&lt;setting name="localCacheScope" value="STATEMENT"/&gt;
</code></pre> 
<h4>        将<span style="color:#38d8f0;"><code>localCacheScope</code></span>设置为<span style="color:#38d8f0;"><code>STATEMENT</code></span>表示关闭一级缓存，设置为<code>SESSION</code>表示开启一级缓存。另外，在需要手动清除一级缓存时，可以调用SqlSession的<code>clearCache()</code>方法来清空缓存。</h4> 
<h3></h3> 
<h3>2.MyBatis 一级缓存的简单示例</h3> 
<h4>        首先，假设我们有一个 StudentMapper 接口来操作用户信息，其中包含了查询用户列表的方法 getStudentClssAll<code>()</code>。</h4> 
<p style="text-align:center;"><img alt="" height="187" src="https://images2.imgbox.com/f0/35/gaMQVLQp_o.png" width="580"></p> 
<p></p> 
<h4>然后，在配置文件中设置开启一级缓存</h4> 
<p style="text-align:center;"><img alt="" height="265" src="https://images2.imgbox.com/46/c9/0ivjhMfQ_o.png" width="598"></p> 
<h4> 接着，创建 <code>StudentMapper.xml</code> 文件，配置查询语句和映射规则       </h4> 
<p style="text-align:center;"><img alt="" height="312" src="https://images2.imgbox.com/ba/a4/S7EYW3rN_o.png" width="610"></p> 
<p>        大家可以写单表的简单查询</p> 
<p style="text-align:center;"></p> 
<h4>        在测试类代码中，我们可以通过 <code>SqlSessionFactory</code> 获取一个 <code>SqlSession</code> 实例，并调用 StudentMapper的方法进行查询</h4> 
<p style="text-align:center;"><img alt="" height="335" src="https://images2.imgbox.com/4a/e9/zPvfSRwt_o.png" width="618"></p> 
<p>        </p> 
<p>        运行结果</p> 
<p class="img-center"><img alt="" height="270" src="https://images2.imgbox.com/17/17/g3bU9JG5_o.png" width="636"></p> 
<h4>        在上述示例中，第一次调用 studentList1<code>()</code> 方法时，会从数据库中查询用户列表，并将结果放入一级缓存。然后，第二次调用 studentList2<code>()</code> 方法时，会直接从一级缓存中获取结果，而不再访问数据库。 </h4> 
<p style="text-align:center;"></p> 
<p></p> 
<h2>2.了解二级缓存的配置</h2> 
<p>        二级缓存是MyBatis中的一种缓存机制，用于缓存查询结果。它位于SqlSessionFactory的作用域内，可以在多个会话之间共享。</p> 
<p>        当使用二级缓存时，首先需要在配置文件中进行相应的设置。在 <code>&lt;settings&gt;</code> 标签下，添加 <code>&lt;setting name="cacheEnabled" value="true"/&gt;</code> ，这样即可启用二级缓存。</p> 
<p>        MyBatis的二级缓存可以提高查询性能，减少数据库访问次数，但需要注意处理对象修改和缓存命中率等问题。</p> 
<pre><code>
  &lt;setting name="cacheEnabled" value="true"/&gt;
</code></pre> 
<h3>MyBaits二级缓存的示例</h3> 
<h4>        1.首先，在MyBatis配置文件中启用二级缓存。在 <code>&lt;configuration&gt;</code> 标签下添加如下配置</h4> 
<pre><code>&lt;settings&gt;
  &lt;setting name="cacheEnabled" value="true"/&gt;
&lt;/settings&gt;
</code></pre> 
<h4>        2.在Mapper接口对应的映射文件中开启二级缓存。在需要缓存结果的查询语句上添加 <code>cache="true"</code> 属性。</h4> 
<pre><code>&lt;!-- UserMapper.xml --&gt;
&lt;mapper namespace="com.example.mapper.UserMapper"&gt;
  &lt;select id="getUserById" resultType="User" cache="true"&gt;
    SELECT * FROM users WHERE id = #{id}
  &lt;/select&gt;
&lt;/mapper&gt;
</code></pre> 
<h4>        3.在Java代码中使用Mapper接口调用查询方法，并观察缓存效果。</h4> 
<pre><code>// 创建SqlSessionFactory
SqlSessionFactory sqlSessionFactory = ... ;

// 打开一个会话
try (SqlSession sqlSession1 = sqlSessionFactory.openSession()) {
  // 获取Mapper接口实例
  UserMapper userMapper1 = sqlSession1.getMapper(UserMapper.class);

  // 第一次查询，会从数据库中获取数据并放入缓存
  User user1 = userMapper1.getUserById(1);
  
  // 第二次查询，直接从缓存中获取数据
  User user2 = userMapper1.getUserById(1);
  
  // 修改用户信息
  user2.setName("New Name");
  userMapper1.updateUser(user2);
  
  // 提交事务
  sqlSession1.commit();
}

// 再次打开一个会话
try (SqlSession sqlSession2 = sqlSessionFactory.openSession()) {
  // 获取Mapper接口实例
  UserMapper userMapper2 = sqlSession2.getMapper(UserMapper.class);
  
  // 第三次查询，由于修改了用户信息，缓存失效，会重新查询数据库
  User user3 = userMapper2.getUserById(1);
}
</code></pre> 
<h4>        在上述示例中，第一次查询会从数据库中获取数据并放入二级缓存。第二次查询时，由于缓存已经存在，就直接从缓存中获取数据，而不需要再次查询数据库。当修改了用户信息后，缓存自动失效，第三次查询会重新查询数据库。</h4> 
<h4>        这就是使用MyBatis二级缓存的一个简单示例。通过配置和合理使用缓存，可以提高查询性能和减少数据库访问次数。</h4>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/375e0d05a574af577d9d8f5e28c0df27/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【Python】Python 去除图片水印</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e498114bc62057b285219fe34e4c04b3/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">断点显示 由于目标计算机积极拒绝 127.0.0.1:11520 以及 断点启动失败 问题</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>