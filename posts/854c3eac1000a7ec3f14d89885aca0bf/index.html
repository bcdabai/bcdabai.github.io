<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>使用代理模式请求HTTP接口方法说明 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="使用代理模式请求HTTP接口方法说明" />
<meta property="og:description" content="一、GET方式 /** * @描述：HttpURLConnection 接口调用 GET方式 * @param strUrl 请求地址 * @param param 请求参数拼接 * @return 请求结果集 */ public static String httpURLConectionGET(String strUrl, String param) { StringBuffer sb = new StringBuffer(&#34;&#34;); BufferedReader br =null; HttpURLConnection connection =null; try { strUrl = strUrl &#43; &#34;?&#34; &#43; param.trim(); URL url = new URL(strUrl); // 把字符串转换为URL请求地址 // 实例化本地代理对象 Proxy proxy= new Proxy(Proxy.Type.HTTP,new InetSocketAddress(proxyIp,proxyPort)); Authenticator.setDefault(new SimpleAuthenticator(proxyUserName,proxyPassword)); connection = (HttpURLConnection) url.openConnection(proxy);// 打开连接 connection.setConnectTimeout(60000); connection.setDoOutput(true); connection." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/854c3eac1000a7ec3f14d89885aca0bf/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-02-09T14:19:01+08:00" />
<meta property="article:modified_time" content="2018-02-09T14:19:01+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">使用代理模式请求HTTP接口方法说明</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3 id="一get方式">一、GET方式</h3> 
<pre class="prettyprint"><code class=" hljs java">    <span class="hljs-javadoc">/**
     * @描述：HttpURLConnection 接口调用 GET方式
     *<span class="hljs-javadoctag"> @param</span> strUrl 请求地址
     *<span class="hljs-javadoctag"> @param</span> param 请求参数拼接
     *<span class="hljs-javadoctag"> @return</span> 请求结果集
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">httpURLConectionGET</span>(String strUrl, String param) {
        StringBuffer sb = <span class="hljs-keyword">new</span> StringBuffer(<span class="hljs-string">""</span>);

        BufferedReader br =<span class="hljs-keyword">null</span>;
        HttpURLConnection connection =<span class="hljs-keyword">null</span>;
        <span class="hljs-keyword">try</span> {
            strUrl = strUrl + <span class="hljs-string">"?"</span> + param.trim();
            URL url = <span class="hljs-keyword">new</span> URL(strUrl);    <span class="hljs-comment">// 把字符串转换为URL请求地址</span>

            <span class="hljs-comment">// 实例化本地代理对象</span>
            Proxy proxy= <span class="hljs-keyword">new</span> Proxy(Proxy.Type.HTTP,<span class="hljs-keyword">new</span> InetSocketAddress(proxyIp,proxyPort));  
            Authenticator.setDefault(<span class="hljs-keyword">new</span> SimpleAuthenticator(proxyUserName,proxyPassword));

            connection = (HttpURLConnection) url.openConnection(proxy);<span class="hljs-comment">// 打开连接</span>
            connection.setConnectTimeout(<span class="hljs-number">60000</span>);
            connection.setDoOutput(<span class="hljs-keyword">true</span>);
            connection.connect();<span class="hljs-comment">// 连接会话</span>

            <span class="hljs-keyword">if</span>(connection.getResponseCode()==<span class="hljs-number">200</span>){
                <span class="hljs-comment">// 获取输入流</span>
                br = <span class="hljs-keyword">new</span> BufferedReader(<span class="hljs-keyword">new</span> InputStreamReader(connection.getInputStream()));
                String line;
                <span class="hljs-keyword">while</span> ((line = br.readLine()) != <span class="hljs-keyword">null</span>) {<!-- --><span class="hljs-comment">// 循环读取流</span>
                    sb.append(line);
                }
            }<span class="hljs-keyword">else</span>{
                System.out.println(<span class="hljs-string">"请求失败!HTTP Status："</span>+connection.getResponseCode());
            }

        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
            System.out.println(<span class="hljs-string">"失败!"</span>);
        }<span class="hljs-keyword">finally</span>{
             <span class="hljs-keyword">try</span> {
                 <span class="hljs-keyword">if</span>(br != <span class="hljs-keyword">null</span>){
                     br.close();<span class="hljs-comment">// 关闭流</span>
                 }
                 <span class="hljs-keyword">if</span>(connection != <span class="hljs-keyword">null</span>){
                     connection.disconnect();<span class="hljs-comment">// 断开连接</span>
                 }
            } <span class="hljs-keyword">catch</span> (IOException e) {
                e.printStackTrace();
            }

        }
        <span class="hljs-keyword">return</span> sb.toString();
    }</code></pre> 
<h3 id="二post方式">二、POST方式</h3> 
<pre class="prettyprint"><code class=" hljs java">    <span class="hljs-javadoc">/**
     * 将字符串发送到指定url地址
     *<span class="hljs-javadoctag"> @param</span> url 请求地址
     *<span class="hljs-javadoctag"> @param</span> content 请求内容
     *<span class="hljs-javadoctag"> @return</span> 请求结果集
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">httpPost</span>(String url, String content) {
        String strResult = <span class="hljs-string">""</span>;
        CloseableHttpClient httpclient =<span class="hljs-keyword">null</span>;
        HttpEntity resEntity;
        CloseableHttpResponse response;
        <span class="hljs-keyword">try</span> {
            StringEntity myEntity = <span class="hljs-keyword">new</span> StringEntity(content, <span class="hljs-string">"UTF-8"</span>);
            HttpPost httpPost = <span class="hljs-keyword">new</span> HttpPost(url);


            CredentialsProvider credsProvider = <span class="hljs-keyword">new</span> BasicCredentialsProvider();
            credsProvider.setCredentials(<span class="hljs-keyword">new</span> AuthScope(proxyIp, proxyPort),
                         <span class="hljs-keyword">new</span> UsernamePasswordCredentials(proxyUserName, proxyPassword));

            HttpHost proxy = <span class="hljs-keyword">new</span> HttpHost(proxyIp,proxyPort); 

            RequestConfig requestConfig = RequestConfig.custom().setProxy(proxy)
                        .setConnectTimeout(<span class="hljs-number">120000</span>).setConnectionRequestTimeout(<span class="hljs-number">120000</span>)
                        .setSocketTimeout(<span class="hljs-number">120000</span>).build();

            httpclient = HttpClients.custom()
                        .setDefaultCredentialsProvider(credsProvider)
                        .setDefaultRequestConfig(requestConfig)
                        .build();

            httpPost.addHeader(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-string">"text/xml; charset=UTF-8"</span>);
            httpPost.setEntity(myEntity);
            response = httpclient.execute(httpPost);

            resEntity = response.getEntity();
            <span class="hljs-keyword">if</span> (response.getStatusLine().getStatusCode()==<span class="hljs-number">200</span> &amp;&amp; resEntity != <span class="hljs-keyword">null</span>) {
                strResult = EntityUtils.toString(resEntity, <span class="hljs-string">"UTF-8"</span>);
            }
            response.close();
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
            System.out.println(<span class="hljs-string">"接口异常："</span> + e.getMessage());
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (httpclient != <span class="hljs-keyword">null</span>) {
                <span class="hljs-keyword">try</span> {
                    httpclient.close();
                } <span class="hljs-keyword">catch</span> (IOException e) {
                    e.printStackTrace();
                    System.out.println(<span class="hljs-string">"关闭httpclient异常："</span> + e.getMessage());
                }
            }
        }
        <span class="hljs-keyword">return</span> strResult;
    }
</code></pre> 
<h3 id="三post方式-接口调用参数拼接">三、POST方式 （接口调用参数拼接）</h3> 
<pre class="prettyprint"><code class=" hljs java">    <span class="hljs-javadoc">/**
     * @描述：接口调用参数拼接POST方式
     *<span class="hljs-javadoctag"> @param</span> strUrl 请求地址
     *<span class="hljs-javadoctag"> @param</span> param 请求参数拼接
     *<span class="hljs-javadoctag"> @return</span> 请求结果集
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">httpURLConectionParamPOST</span>(String strUrl, String param) {
        StringBuffer sb = <span class="hljs-keyword">new</span> StringBuffer(<span class="hljs-string">""</span>);
        BufferedReader br =<span class="hljs-keyword">null</span>;
        HttpURLConnection connection =<span class="hljs-keyword">null</span>;
        Proxy proxy = <span class="hljs-keyword">null</span>;
        <span class="hljs-keyword">try</span> {
            strUrl = strUrl + <span class="hljs-string">"?"</span> + param.trim();
            URL url = <span class="hljs-keyword">new</span> URL(strUrl);    <span class="hljs-comment">// 把字符串转换为URL请求地址</span>

            proxy = <span class="hljs-keyword">new</span> Proxy(Proxy.Type.HTTP,<span class="hljs-keyword">new</span> InetSocketAddress(proxyIp,proxyPort));  <span class="hljs-comment">// 实例化本地代理对象</span>

            Authenticator.setDefault(<span class="hljs-keyword">new</span> SimpleAuthenticator(proxyUserName,proxyPassword));

            connection = (HttpURLConnection) url.openConnection(proxy);<span class="hljs-comment">// 打开连接</span>


            connection.setConnectTimeout(<span class="hljs-number">60000</span>);
            connection.setDoOutput(<span class="hljs-keyword">true</span>);
            connection.setUseCaches(<span class="hljs-keyword">false</span>);  
            connection.setRequestMethod(<span class="hljs-string">"POST"</span>);  
            connection.connect();<span class="hljs-comment">// 连接会话</span>


            <span class="hljs-keyword">if</span>(connection.getResponseCode()==<span class="hljs-number">200</span>){
                <span class="hljs-comment">// 获取输入流</span>
                br = <span class="hljs-keyword">new</span> BufferedReader(<span class="hljs-keyword">new</span> InputStreamReader(connection.getInputStream()));
                String line;
                <span class="hljs-keyword">while</span> ((line = br.readLine()) != <span class="hljs-keyword">null</span>) {<!-- --><span class="hljs-comment">// 循环读取流</span>
                    sb.append(line);
                }
            }<span class="hljs-keyword">else</span>{
                System.out.println(<span class="hljs-string">"请求失败!HTTP Status："</span>+connection.getResponseCode());
            }

        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
            System.out.println(<span class="hljs-string">"请求异常!"</span>);
        }<span class="hljs-keyword">finally</span>{
             <span class="hljs-keyword">try</span> {
                 <span class="hljs-keyword">if</span>(br != <span class="hljs-keyword">null</span>){
                     br.close();<span class="hljs-comment">// 关闭流</span>
                 }
                 <span class="hljs-keyword">if</span>(connection != <span class="hljs-keyword">null</span>){
                     connection.disconnect();<span class="hljs-comment">// 断开连接</span>
                 }
            } <span class="hljs-keyword">catch</span> (IOException e) {
                e.printStackTrace();
                System.out.println(<span class="hljs-string">"连接关闭异常!"</span>);
            }

        }
        <span class="hljs-keyword">return</span> sb.toString();
    }</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3308d055d5f169095c431793a9204710/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Java企业微信开发_00_源码及资源汇总贴</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8b46dade1138b41f4130e497bd81f1b6/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">第三方App点击关注公众号,跳转到微信公众号的实现方法.</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>