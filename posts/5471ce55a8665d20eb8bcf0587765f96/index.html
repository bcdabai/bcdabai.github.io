<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>原excel有合并单元格这种格式，openpyxl打开然后保存边框消失的问题 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="原excel有合并单元格这种格式，openpyxl打开然后保存边框消失的问题" />
<meta property="og:description" content="python3.5 openpyxl2.5可以用这个文件解决 文件名为：fix_border.py，代码见下面的代码片
在你写代码的那个文件里导入该文件
from fix_border import patch_worksheet
然后在load文件前加上patch_worksheet()
全部代码为
ws = opx.load_workbook(filename1) fix_border.patch_worksheet() ws.save(filename2) fix_border.py代码为
# -*- coding:utf-8 -*- from itertools import product import types import openpyxl from openpyxl.utils import get_column_letter from openpyxl import worksheet from openpyxl.utils import range_boundaries from itertools import product import regex as re def patch_worksheet(): &#34;&#34;&#34;This monkeypatches Worksheet.merge_cells to remove cell deletion bug https://bitbucket.org/openpyxl/openpyxl/issues/365/styling-merged-cells-isnt-working Thank you to Sergey Pikhovkin for the fix &#34;&#34;&#34; def merge_cells(self, range_string=None, start_row=None, start_column=None, end_row=None, end_column=None): &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/5471ce55a8665d20eb8bcf0587765f96/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-05-14T19:14:07+08:00" />
<meta property="article:modified_time" content="2018-05-14T19:14:07+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">原excel有合并单元格这种格式，openpyxl打开然后保存边框消失的问题</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="python35_openpyxl25_0"></a>python3.5 openpyxl2.5可以用这个文件解决</h3> 
<p>文件名为：fix_border.py，代码见下面的代码片</p> 
<p>在你写代码的那个文件里导入该文件<br> from fix_border import patch_worksheet<br> 然后在load文件前加上patch_worksheet()<br> 全部代码为</p> 
<pre><code>    ws = opx.load_workbook(filename1)
     fix_border.patch_worksheet()
    ws.save(filename2)
</code></pre> 
<p>fix_border.py代码为</p> 
<pre><code># -*- coding:utf-8 -*-
from itertools import product
import types
import openpyxl
from openpyxl.utils import get_column_letter
from openpyxl import worksheet
from openpyxl.utils import range_boundaries
from itertools import product
import regex as re
def patch_worksheet():
    """This monkeypatches Worksheet.merge_cells to remove cell deletion bug
    https://bitbucket.org/openpyxl/openpyxl/issues/365/styling-merged-cells-isnt-working
    Thank you to Sergey Pikhovkin for the fix
    """

    def merge_cells(self, range_string=None, start_row=None, start_column=None, end_row=None, end_column=None):
        """ Set merge on a cell range.  Range is a cell range (e.g. A1:E1)
        This is monkeypatched to remove cell deletion bug
        https://bitbucket.org/openpyxl/openpyxl/issues/365/styling-merged-cells-isnt-working
        """
        if not range_string and not all((start_row, start_column, end_row, end_column)):
            msg = "You have to provide a value either for 'coordinate' or for\
            'start_row', 'start_column', 'end_row' *and* 'end_column'"
            raise ValueError(msg)
        elif not range_string:
            range_string = '%s%s:%s%s' % (get_column_letter(start_column),
                                          start_row,
                                          get_column_letter(end_column),
                                          end_row)
        elif ":" not in range_string:
            if COORD_RE.match(range_string):
                return  # Single cell, do nothing
            raise ValueError("Range must be a cell range (e.g. A1:E1)")
        else:
            range_string = range_string.replace('$', '')

        if range_string not in self.merged_cells:
            self.merged_cells.add(range_string)


        # The following is removed by this monkeypatch:

        # min_col, min_row, max_col, max_row = range_boundaries(range_string)
        # rows = range(min_row, max_row+1)
        # cols = range(min_col, max_col+1)
        # cells = product(rows, cols)

        # all but the top-left cell are removed
        #for c in islice(cells, 1, None):
            #if c in self._cells:
                #del self._cells[c]

    # Apply monkey patch
    worksheet.Worksheet.merge_cells = merge_cells

patch_worksheet()
</code></pre> 
<h3><a id="openpyxl__73"></a>openpyxl 删除行操作，合并单元格格式混乱的问题</h3> 
<p>openpyxl在采取删除行操作后，即sheet.delete_rows(row,1)，即便使用了上面的patch_worksheet，但是还是不能解决这个单元格格式混乱的情况，目前没有找到解决的方案。</p> 
<p>##更新—openpyxl格式混乱问题解决方案2<br> 见链接<br> <a href="https://bitbucket.org/openpyxl/openpyxl/issues/700/cell-borders-lost-on-save" rel="nofollow">https://bitbucket.org/openpyxl/openpyxl/issues/700/cell-borders-lost-on-save</a><br> <img src="https://images2.imgbox.com/bc/30/P06R9F6C_o.png" alt="https://bitbucket.org/openpyxl/openpyxl/issues/700/cell-borders-lost-on-save"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/20d977dc1bb37d2076e3a7000b366623/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">zynq中三种GPIO的介绍和实现方式</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/27e2b8015363d7899488784573d1aece/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">[ 收藏]100个容器引擎项目，点亮你的容器集群技能树</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>