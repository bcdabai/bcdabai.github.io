<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Java实现头像上传 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Java实现头像上传" />
<meta property="og:description" content="#Java实现头像上传
看网课的时候视频中用到下方的路径
== String realPath = session.getServletContext().getRealPath(“/upload”);==
这样会导致一个问题，就是每次服务器重启之后，这个文件就会找不到，不过也不用担心，在企业里如果文件很多就会有专门的文件服务器，写ip地址加文件名字就行，自己解决这个bug的话，我用到的是写在本地文件中，下面开始代码环节
首先要写一个配置类，因为大多数浏览器为了安全不允许访问你的本地文件，所以写一个映射路径，这段代码的意思就是一个拦截器，只要访问addResourceHandler（“xxx”）这个路径就会映射到addResourceLocations（“mmm”）这个真实路径
public static final int AVATAR_MAX_SIZE =10 *1024*1024; //设置上传文件的最大值 public static final List&lt;String&gt; AVATAR_TYPE = new ArrayList&lt;&gt;(); //限制上传文件的类型 static { AVATAR_TYPE.add(&#34;image/jpeg&#34;); AVATAR_TYPE.add(&#34;image/png&#34;); AVATAR_TYPE.add(&#34;image/bmp&#34;); AVATAR_TYPE.add(&#34;image/gif&#34;); AVATAR_TYPE.add(&#34;image/webp&#34;); } //上面是无关的东西 //在这里我写在了控制层，可以传参到业务层写，JsonResult&lt;&gt;是模型类 public JsonResult&lt;String&gt; updateUserAvatar (HttpSession session, MultipartFile file){ if (!AVATAR_TYPE.contains(file.getContentType())){ //这些是抛出的异常可以不用管，但是也会介绍一下,file是上面的形参 throw new FileTypeException(); // 文件类型不符异常 } if (file==null){ throw new FileEmptyException(); //文件空异常，如果文件是个空，扔出去 } if (file.getSize()&gt;AVATAR_MAX_SIZE){ throw new FileSizeException(); //文件大小异常 } //第一步：：写一个路径，和配置类一样 String realPath = &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/3511bb5a52afaad10a7fe311503f434d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-09-21T11:12:43+08:00" />
<meta property="article:modified_time" content="2022-09-21T11:12:43+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Java实现头像上传</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>#Java实现头像上传</p> 
<p><strong>看网课的时候视频中用到下方的路径</strong><br> == String realPath = session.getServletContext().getRealPath(“/upload”);==</p> 
<p>这样会导致一个问题，就是每次服务器重启之后，这个文件就会找不到，不过也不用担心，在企业里如果文件很多就会有专门的文件服务器，写ip地址加文件名字就行，自己解决这个bug的话，我用到的是写在本地文件中，下面开始代码环节</p> 
<p><strong><strong>首先要写一个配置类，因为大多数浏览器为了安全不允许访问你的本地文件</strong></strong>，所以写一个映射路径，这段代码的意思就是一个拦截器，只要访问addResourceHandler（“xxx”）这个路径就会映射到addResourceLocations（“mmm”）这个真实路径<br> <img src="https://images2.imgbox.com/95/4a/t8tD8cjc_o.png" alt=""></p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">static</span>  <span class="token keyword">final</span> <span class="token keyword">int</span> AVATAR_MAX_SIZE <span class="token operator">=</span><span class="token number">10</span> <span class="token operator">*</span><span class="token number">1024</span><span class="token operator">*</span><span class="token number">1024</span><span class="token punctuation">;</span> <span class="token comment">//设置上传文件的最大值</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> AVATAR_TYPE <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//限制上传文件的类型</span>
    <span class="token keyword">static</span> <span class="token punctuation">{<!-- --></span>

        AVATAR_TYPE<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"image/jpeg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        AVATAR_TYPE<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"image/png"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        AVATAR_TYPE<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"image/bmp"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        AVATAR_TYPE<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"image/gif"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        AVATAR_TYPE<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"image/webp"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

<span class="token comment">//上面是无关的东西</span>

<span class="token comment">//在这里我写在了控制层，可以传参到业务层写，JsonResult&lt;&gt;是模型类</span>

    <span class="token keyword">public</span> <span class="token class-name">JsonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> updateUserAvatar <span class="token punctuation">(</span><span class="token class-name">HttpSession</span> session<span class="token punctuation">,</span> <span class="token class-name">MultipartFile</span> file<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>AVATAR_TYPE<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">getContentType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>  <span class="token comment">//这些是抛出的异常可以不用管，但是也会介绍一下,file是上面的形参</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">FileTypeException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                  <span class="token comment">// 文件类型不符异常</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>file<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">FileEmptyException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                 <span class="token comment">//文件空异常，如果文件是个空，扔出去</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">getSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span>AVATAR_MAX_SIZE<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">FileSizeException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                   <span class="token comment">//文件大小异常</span>
        <span class="token punctuation">}</span>
<span class="token comment">//第一步：：写一个路径，和配置类一样</span>
        <span class="token class-name">String</span> realPath <span class="token operator">=</span>
                <span class="token string">"C:/Users/32189/Desktop/壁纸/test/0/"</span><span class="token punctuation">;</span>       <span class="token comment">// 随便写一个路径，但是需要和配置类中一样，注意 / 符号别漏</span>
<span class="token comment">//                session.getServletContext().getRealPath("/upload"); 之前的路径</span>
<span class="token comment">//第二步：：用文件检测目录，没有就创建</span>
        <span class="token class-name">File</span> dir <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>realPath<span class="token punctuation">)</span><span class="token punctuation">;</span>                       <span class="token comment">//在这个路径下创建一个文件</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>dir<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> <span class="token comment">//检测目录是否存在                   //如果这个文件不存在（目录不存在自然就创建不了文件）,用文件指向目录，常用手段</span>
            dir<span class="token punctuation">.</span><span class="token function">mkdirs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//创建目录                           //创建这个目录</span>
        <span class="token punctuation">}</span>
<span class="token comment">//第三步：：统一后缀名</span>
        <span class="token class-name">String</span> originalFilename <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">getOriginalFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//获取传过来的文件的原来的名字</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span>                                               <span class="token comment">//lastIndexOf(“ . ”)，返回某个字符（串）在一个长的字符串中最后出现的位置</span>
                originalFilename<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//在这里是获取后缀名那个点（.png）中点的下标</span>
        
        <span class="token class-name">String</span> png <span class="token operator">=</span>                                          <span class="token comment">//substring(i),是获取从下标i开始到最后的字符串，包括i,例如（.png）</span>
                originalFilename<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">//substring(i,i+2)也有两个参数的用法，获取第i个和第i+2个之间的字符串</span>
        
        <span class="token class-name">String</span> filename <span class="token operator">=</span>                                     <span class="token comment">//随机生成一个名字加上后缀</span>
                UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span>png<span class="token punctuation">;</span> <span class="token comment">//为什么随机生成一个名字呢，因为大部分企业都这么做，如果两个用户上传两个名字一样的会覆盖（UUID是生成随机字符串的一个类，toUpperCase()是字母全部大写）</span>
<span class="token comment">//第四步：：在该目录下创建一个空白文件，文件名字随意</span>
        <span class="token class-name">File</span> dest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>dir<span class="token punctuation">,</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span>                  <span class="token comment">//在这个目录下创建一个空白的文件</span>
<span class="token comment">//第五步：：把形参的文件数据用提供的api写入到空白文件中        </span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            file<span class="token punctuation">.</span><span class="token function">transferTo</span><span class="token punctuation">(</span>dest<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//java提供了一个api，底层还是io流，需要保证后缀一致  //将file中的数据写入到这个空文件中</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span>  <span class="token keyword">new</span> <span class="token class-name">FileuploadIOException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
<span class="token comment">//第六步：：拼接完整地址 目录加文件名字        </span>
        <span class="token class-name">String</span> avatar <span class="token operator">=</span><span class="token string">"/test/"</span><span class="token operator">+</span>filename<span class="token punctuation">;</span>                    <span class="token comment">//返回配置类映射路径+文件名字 变量avatar是往数据库存放的地址，也是返回前端的数据，直接可用</span>
</code></pre> 
<p>希望可以帮助需要的人</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/40bd16d7dd1a51de839228712d3af59b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">修改tomcat文件访问路径</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/623a890bf80741c59889dc10ffeceabf/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">在window下使用 VScode 搭建 ARM 开发环境—— 详细版</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>