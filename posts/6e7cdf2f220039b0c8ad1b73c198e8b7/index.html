<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>MyBatis 万字长文：从入门到动态SQL超详细 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="MyBatis 万字长文：从入门到动态SQL超详细" />
<meta property="og:description" content="文章目录 1. 前言2. 创建项目3. 添加框架支持4. 建库5. 配置数据库连接信息和 XML 文件路径5.1 创建 Java 类5.2 Java 接口5.3 XML 文件 6. 查询6.1 不带参数的查询6.2 单元测试6.3 带参数的查询 7. 修改8. 增加8.1 将对象插入表中8.2 获取自增主键 9. 删除10. 数据库字段和类属性名字不一致的情况10.1 查询10.2 resultMap 11. 排序查询11.1 #{} 和 ${} 的区别 12. 模糊匹配13. 联合查询14. 动态 SQL14.1 if 标签14.2 trim 标签14.3 where 标签14.4 set 标签14.5 foreach 标签 15. 全代码 1. 前言 MyBatis是一个基于JDBC的半 ORM 持久化框架, 能通过 注解 或者 XML(主流方式) 和 映射原生类型, 接口和 java 的POJOs(Plain Old Java Objects,普通的 Java对象)映射成数据库中的记录。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/6e7cdf2f220039b0c8ad1b73c198e8b7/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-01-06T13:50:23+08:00" />
<meta property="article:modified_time" content="2023-01-06T13:50:23+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">MyBatis 万字长文：从入门到动态SQL超详细</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-dracula">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#1__1" rel="nofollow">1. 前言</a></li><li><a href="#2__15" rel="nofollow">2. 创建项目</a></li><li><a href="#3__28" rel="nofollow">3. 添加框架支持</a></li><li><a href="#4__38" rel="nofollow">4. 建库</a></li><li><a href="#5__XML__87" rel="nofollow">5. 配置数据库连接信息和 XML 文件路径</a></li><li><ul><li><a href="#51__Java__105" rel="nofollow">5.1 创建 Java 类</a></li><li><a href="#52_Java__124" rel="nofollow">5.2 Java 接口</a></li><li><a href="#53_XML__136" rel="nofollow">5.3 XML 文件</a></li></ul> 
  </li><li><a href="#6__171" rel="nofollow">6. 查询</a></li><li><ul><li><a href="#61__172" rel="nofollow">6.1 不带参数的查询</a></li><li><a href="#62__200" rel="nofollow">6.2 单元测试</a></li><li><a href="#63__229" rel="nofollow">6.3 带参数的查询</a></li></ul> 
  </li><li><a href="#7__268" rel="nofollow">7. 修改</a></li><li><a href="#8__306" rel="nofollow">8. 增加</a></li><li><ul><li><a href="#81__307" rel="nofollow">8.1 将对象插入表中</a></li><li><a href="#82__359" rel="nofollow">8.2 获取自增主键</a></li></ul> 
  </li><li><a href="#9__398" rel="nofollow">9. 删除</a></li><li><a href="#10__427" rel="nofollow">10. 数据库字段和类属性名字不一致的情况</a></li><li><ul><li><a href="#101__452" rel="nofollow">10.1 查询</a></li><li><a href="#102_resultMap_476" rel="nofollow">10.2 resultMap</a></li></ul> 
  </li><li><a href="#11__536" rel="nofollow">11. 排序查询</a></li><li><ul><li><a href="#111_____556" rel="nofollow">11.1 #{} 和 ${} 的区别</a></li></ul> 
  </li><li><a href="#12__562" rel="nofollow">12. 模糊匹配</a></li><li><a href="#13__596" rel="nofollow">13. 联合查询</a></li><li><a href="#14__SQL_625" rel="nofollow">14. 动态 SQL</a></li><li><ul><li><a href="#141_if__636" rel="nofollow">14.1 if 标签</a></li><li><a href="#142_trim__681" rel="nofollow">14.2 trim 标签</a></li><li><a href="#143_where__764" rel="nofollow">14.3 where 标签</a></li><li><a href="#144_set__812" rel="nofollow">14.4 set 标签</a></li><li><a href="#145_foreach__849" rel="nofollow">14.5 foreach 标签</a></li></ul> 
  </li><li><a href="#15__905" rel="nofollow">15. 全代码</a></li></ul> 
</div> 
<p></p> 
<h2><a id="1__1"></a>1. 前言</h2> 
<p>MyBatis是一个基于JDBC的半 ORM 持久化框架, 能通过 注解 或者 XML(主流方式) 和 映射原生类型, 接口和 java 的POJOs(Plain Old Java Objects,普通的 Java对象)映射成数据库中的记录。</p> 
<p>通俗来说，MyBatis 能够通过简单（指不繁琐）的操作实现对数据库的操作</p> 
<blockquote> 
 <p>ORM : Object Relational Mapping, 也就是对象关系映射框架, 它指的是够将数据库中的关系模型和 Java 对象建立起一种对应关系。例如数据库中有 Article 这张表，那么一个 Java 对象对应的就是 Article 这张表中的一行数据</p> 
</blockquote> 
<hr> 
<p>而完成一个 MyBatis 的操作只需要以下几个步骤：</p> 
<ol><li>创建项目</li><li>导入 MyBatis 的框架支持，而如果我们要连接的是 MySQL，那么还需要一个 MySQL Driver 的支持（本文重在 MySQL）</li><li>配置想要连接的数据库以及一些其他的配置</li><li>完成 XML 文件和 Java 接口的编写（一个 Java 接口对应一个 XML 文件）</li><li>在 XML 文件中编写 SQL 语句并测试</li></ol> 
<h2><a id="2__15"></a>2. 创建项目</h2> 
<p>首先是项目的创建，打开 IDEA 新建项目，然后按照如下步骤操作<br> (如果无法创建 Spring Boot 项目则可以在 IDEA 安装 Spring Boot Helper 插件)<br> <img src="https://images2.imgbox.com/c5/4d/LVlSh5Pv_o.png" alt="在这里插入图片描述"><br> 然后再按如下操作, (如果这里没有添加依赖, 后面仍然可以添加)</p> 
<p><img src="https://images2.imgbox.com/ec/15/DOvd72gy_o.png" alt="在这里插入图片描述">到此为止, 一个项目就算创建完了, 然后在刚开始目录结构可能有点复杂, 我们可以删除 4 个没用的文件, 如下</p> 
<p><img src="https://images2.imgbox.com/ef/55/6XZkYxvK_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="3__28"></a>3. 添加框架支持</h2> 
<p>如果创建项目之前已经添加了依赖，这一步就可以直接忽略。但是建议大家装一个 EditStarters 插件，后续导入依赖很方便。<br> 在项目自带的 pom.xml 文件中右键 → generate → EditStarters</p> 
<p><img src="https://images2.imgbox.com/d5/4e/Z8cKAXiu_o.png" alt="在这里插入图片描述"></p> 
<p>然后勾选以下这几项，然后等待下载即可</p> 
<p><img src="https://images2.imgbox.com/fe/bb/jtQMyMDp_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="4__38"></a>4. 建库</h2> 
<p>在练习 MyBatis 之前，需要本地建个数据库和建表</p> 
<p>想练习的也可以复制下面这段一样的建库代码，这里创建了文章表和作者表（复制粘贴到 MySQL 即可）</p> 
<pre><code class="prism language-sql"><span class="token comment">-- 创建数据库</span>
<span class="token keyword">drop</span> <span class="token keyword">database</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> practice<span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">database</span> practice <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8mb4<span class="token punctuation">;</span>

<span class="token comment">-- 使用数据数据</span>
<span class="token keyword">use</span> practice<span class="token punctuation">;</span>

<span class="token comment">-- 创建用户表</span>
<span class="token keyword">drop</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token keyword">exists</span>  <span class="token keyword">user</span><span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> <span class="token keyword">user</span><span class="token punctuation">(</span>
    id <span class="token keyword">int</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token keyword">auto_increment</span><span class="token punctuation">,</span>
    username <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
    password <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
    createtime <span class="token keyword">datetime</span> <span class="token keyword">default</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    updatetime <span class="token keyword">datetime</span> <span class="token keyword">default</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token keyword">charset</span> <span class="token string">'utf8mb4'</span><span class="token punctuation">;</span>

<span class="token comment">-- 创建文章表</span>
<span class="token keyword">drop</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token keyword">exists</span>  article<span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> article<span class="token punctuation">(</span>
    id <span class="token keyword">int</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token keyword">auto_increment</span><span class="token punctuation">,</span>
    title <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
    content <span class="token keyword">text</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
    createtime <span class="token keyword">datetime</span> <span class="token keyword">default</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    updatetime <span class="token keyword">datetime</span> <span class="token keyword">default</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    userid <span class="token keyword">int</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span> 			      <span class="token comment">-- 用户 id</span>
    visitcount <span class="token keyword">int</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token number">1</span>     <span class="token comment">-- 该文章访问次数</span>
<span class="token punctuation">)</span><span class="token keyword">default</span> <span class="token keyword">charset</span> <span class="token string">'utf8mb4'</span><span class="token punctuation">;</span>


<span class="token comment">-- 随便添加一个作者数据</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> <span class="token keyword">user</span><span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>username<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>password<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>createtime<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>updatetime<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">values</span>
<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'pig'</span><span class="token punctuation">,</span> <span class="token string">'pig'</span><span class="token punctuation">,</span> <span class="token string">'2022-12-14 00:00:00'</span><span class="token punctuation">,</span> <span class="token string">'2022-12-14 00:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 随便添加一个文章数据</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> article<span class="token punctuation">(</span>title<span class="token punctuation">,</span>content<span class="token punctuation">,</span>userid<span class="token punctuation">)</span>
    <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'MyBatis博客'</span><span class="token punctuation">,</span><span class="token string">'MyBatis增删查改'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>表结构如下</p> 
<p><img src="https://images2.imgbox.com/c4/d6/BHVdriOg_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="5__XML__87"></a>5. 配置数据库连接信息和 XML 文件路径</h2> 
<p>首先在 resources 目录底下创建一个 applictaion.yml 文件，然后在全局配置文件 application.yml 中（也是可以是 properties 文件，但是代码略有差异，效果一样，本文演示的是 yml 文件）， 加入下面这一段代码。</p> 
<p>⭐在 MyBatis 中，需要去定义 SQL 映射语句，一个MyBatis 的 xml 文件保存的是操作数据库的 sql 语句，而一个 xml 文件会实现一个Java接口中相应的操作数据库的方法，但是我们还需要让 MyBatis 知道这些 xml 文件在哪里，所以这里还需要配置 xml 的文件路径。</p> 
<pre><code class="prism language-yml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token comment"># 配置本地连接的数据库（此处我的数据库名字是 practice）</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//127.0.0.1/practice<span class="token punctuation">?</span>characterEncoding=utf8
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123456</span>  <span class="token comment"># 自己数据库的密码</span>
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver <span class="token comment"># 固定写法</span>
<span class="token key atrule">mybatis</span><span class="token punctuation">:</span>
  <span class="token comment"># 配置 xml 文件路径，此处表示配置在 当前目录的 mapper 包中</span>
  <span class="token key atrule">mapper-locations</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>mapper/<span class="token important">**Mapper.xml</span> 的 xml 文件都是
</code></pre> 
<p>上面代码中的 mapper-locations 的作用就是配置 xml 的文件路径，表示：当前目录下有个 mapper 包，并且包中以 xxMapper.xml 形式命名的文件都是和接口对应的 xml 文件</p> 
<h3><a id="51__Java__105"></a>5.1 创建 Java 类</h3> 
<p>前面说到 MyBatis 是一个半 ORM 框架，需要将数据库中的数据模型和 Java 对象对应起来，所以还需要创建和数据库中的表对应的 Java 类。</p> 
<p>而我们数据库中有 user 和 article 两张表，表中的一条数据就会对应一个 Java 对象，所以，分别创建 Article 类和 User 类（路径不限）。这里我们先拿 Article 举例子，这个表不涉及「字段名和属性名不相等」的问题。后面再拿 User 举重映射的例子</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Data</span>  <span class="token comment">// 这个注解就是给该类加上 toString, get, set 等方法</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Article</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> title<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> content<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> createtime<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> updatetime<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> userid<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> visitcount<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>（该 Article 类属性名和数据库字段名相等）</p> 
<h3><a id="52_Java__124"></a>5.2 Java 接口</h3> 
<p>在 MyBatis 中，一个 xml 文件和一个 接口是对应的，对于一个类，就会有一个接口和实现相关操作的 xml 文件</p> 
<p>⭐但是这个接口不只是普通的接口，还需要<strong>加上 @Mapper 注解来修饰</strong>，这个注解会对这个接口生成一个实现类，会将其类实例化成 Bean 对象存入 Spring 中进行管理。</p> 
<p>我们开始编写这个 接口 （接口命名无要求）</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Mapper</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ArticleMapper</span> <span class="token punctuation">{<!-- --></span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="53_XML__136"></a>5.3 XML 文件</h3> 
<p>然后就是创建 xml 文件，由于在前面我们配置了 xml 文件的路径，如下</p> 
<p><img src="https://images2.imgbox.com/c3/19/DkEOYBs5_o.png" alt="在这里插入图片描述"><br> 因此我们的 xml 不仅需要放在同一级目录中的 mapper 包中，还需要以 __Mapper.xml 的形式命名 xml 文件，这里我们就取名 ArticleMapper.xml</p> 
<p><img src="https://images2.imgbox.com/81/cb/PGN206Ul_o.png" alt="在这里插入图片描述"></p> 
<p>⭐然后在 MyBatis 中的 xml 文件中，还要加入一段固定的代码块👇，复制粘贴即可</p> 
<pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">mapper</span> <span class="token name">PUBLIC</span> <span class="token string">"-//mybatis.org//DTD Mapper 3.0//EN"</span> <span class="token string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<blockquote> 
 <p>在 xml 文件中，首先我们需要指定当前文件要和哪个接口进行对应，然后使用标签和 sql 语句去“实现”该接口中的哪个方法。</p> 
</blockquote> 
<p>接着在下面然后添加 &lt;mapper&gt; 标签，<strong>namespace 填的是当前 xml 对应的接口的完整路径</strong>，这里填的是 ArticleMapper 的路径，然后后续在该 &lt;mapper&gt; 标签中编写代码即可</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.blogtest.mapper.ArticleMapper<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> 
<span class="token prolog">&lt;? 后续内容都是在这个 Mapper 标签中填写 ?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>这个是我的目录结构</p> 
<p><img src="https://images2.imgbox.com/cc/d6/z4aBGpdH_o.png" alt="在这里插入图片描述"></p> 
<p>至此为止，我们就可以正式填写我们操作数据库的代码了。</p> 
<p>⭐而关于后续的增删查改，都是先在接口中声明一个方法，然后在对应的 xml 文件中对这个方法编写相应的标签和 sql 语句<br> ⭐而 sql 语句是用来用来操作数据库的，这里的 sql 语句和直接在 MySQL 中输入 sql 语句有些相似。</p> 
<hr> 
<h2><a id="6__171"></a>6. 查询</h2> 
<h3><a id="61__172"></a>6.1 不带参数的查询</h3> 
<blockquote> 
 <p>任务1：查询文章表中的所有文章</p> 
</blockquote> 
<p>（1）首先在接口中声明这个方法，由于查询所有文章，所以我们需要返回 List</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Mapper</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ArticleMapper</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Article</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 声明方法</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>（2）然后在该接口对应的 xml 文件中编写 sql 语句，查询语句需要用到 &lt;select&gt; 标签，而想要对应上接口中的某个方法，则还需要填写两个属性：</p> 
<ul><li>id ：填写接口中对应的方法，这个例子中填的就是 “selectAll”</li><li>resultType：返回的<strong>对象</strong>的类型的全路径（注意：这里填的不是容器的类型）</li></ul> 
<p>（3）sql 语句的编写<br> ⭐在该 xml 文件中编写的 sql 是和写在 MySQL 中的 sql 语句差不多的<br> 如果是直接在 MySQL 中查询，那么 sql 语句就是<code>select * from article</code>，而这里没有参数，所以也就不用做修改。</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.blogtest.mapper.ArticleMapper<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token comment">&lt;!-- 这里填的是接口路径 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selectAll<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.blogtest.model.Article<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token comment">&lt;!-- 这里填的是对象路径 --&gt;</span>
        select * from article
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>这样就完成了查询操作。然后我们需要检验一下是否符合预期（xml 中的 sql 语句可以不加分号）</p> 
<h3><a id="62__200"></a>6.2 单元测试</h3> 
<p>为了测试我们的代码有没有问题，我们可以使用单元测试来验证，其依赖 SpringBoot 项目中默认带有，所以还省事，只需要按以下步骤操作即可。（点击 OK 之后如果出现 ERROR，继续往下 Next 即可）</p> 
<p><img src="https://images2.imgbox.com/e7/a5/M44Nh9ae_o.png" alt="在这里插入图片描述">增加单元测试之后，还需要在<font color="red">该测试类的头上加上 @SpringBootTest 注解</font>，然后再补充点代码，将得到的数据打印出来。如下代码</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@SpringBootTest</span> <span class="token comment">// 这步很重要, 容易忘</span>
<span class="token keyword">class</span> <span class="token class-name">ArticleMapperTest</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">ArticleMapper</span> mapper<span class="token punctuation">;</span> <span class="token comment">// 注入依赖</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Article</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> mapper<span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 使用容器接收 selectAll 放回的数据</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Article</span> a <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>    <span class="token comment">// 打印</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>上述代码中还需要注意：原本 ArticleMapper 是一个接口，但是加上了 @Mapper 之后，会将经过一定处理实例化成Bean并存入 Spring 进行管理，所以此处进行依赖注入，才能测试它的方法。</p> 
<p>最后点击下图的运行即可：<br> <img src="https://images2.imgbox.com/10/d2/AH8egWA8_o.png" alt="在这里插入图片描述"></p> 
<p>测试结果如下</p> 
<p><img src="https://images2.imgbox.com/2c/6c/ixgqxqX7_o.png" alt="在这里插入图片描述">这就算完成 MyBatis 中最简单的查询操作了。接下来结合例子讲讲第二个带参数的查询</p> 
<h3><a id="63__229"></a>6.3 带参数的查询</h3> 
<blockquote> 
 <p>任务2：查询指定 id 的文章</p> 
</blockquote> 
<p>（1）第一步还是在接口中声明这个方法，但是由于 id 是我们指定的变量，所以我们需要进行传参，具体到接口的方法中，就是需要使用 <strong>@Param(“”)</strong> 修饰变量，作用就是给修饰的参数命名，<strong>能够让 MyBatis 正确识别到这个参数</strong>。如下</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Mapper</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ArticleMapper</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// newId 是给 id 起的新名字，如果不加上这个注解，那么默认名字就是 id</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Article</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"newId"</span><span class="token punctuation">)</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>如上，使用 @Param 注解为 id 起了个 “newId” 的名字，而这个名字就是使用在 xml 文件中。如果不加该注解，那么表示名字没有修改，具体到 MyBatis 中就是直接使用原名。</p> 
<p>（2） 然后在<strong>该接口对应的 xml 文件</strong>中编写该方法的代码，而 id 是一个变量，在MyBatis 中想要使用这个变量参数, <strong>就需要使用</strong> #{} , 括号中间放的是参数的名字（注解起的名，没加注解就是原名）</p> 
<p>如果是在 MySQL 中查询，那么 sql 语句是：<code>select * from article where id = ?</code>，而在 MyBatis 中，这里的 ” ? “ 就使用 #{} 并且括号中添加参数的名字来实现，如下。</p> 
<pre><code class="prism language-xml">	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selectById<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.blogtest.model.Article<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        select * from article where id = #{newId}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>(3) 单元测试：还是和上面一样生成测试方法，然后将得到的数据打印出来</p> 
<pre><code class="prism language-java">    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">selectById</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Article</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> mapper<span class="token punctuation">.</span><span class="token function">selectById</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 查询id 为 1 的文章</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Article</span> a <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>然后当我们传参 id 为 1 的时候，运行后查询结果如下，符合预期</p> 
<p><img src="https://images2.imgbox.com/75/1a/9TDVrSfk_o.png" alt="在这里插入图片描述"><br> 而关于排序查询，联合查询…我们下文会讲到</p> 
<h2><a id="7__268"></a>7. 修改</h2> 
<p>学会了带参数的查询之后，修改操作也不难了。</p> 
<blockquote> 
 <p>任务：将 article 表中指定 id 的文章内容修改成指定 content</p> 
</blockquote> 
<p>（1）在接口中声明这个方法，此时有两个参数：id 和 content，代码如下（该例子中不加 @Param 也行）。并且返回值为 int，表示受影响的行数</p> 
<pre><code class="prism language-java">    <span class="token comment">// 将 id = ? 的文章的 content 改成 ?</span>
    <span class="token keyword">int</span> <span class="token function">updateContentById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token keyword">int</span> id<span class="token punctuation">,</span> <span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"content"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> content<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>（2）在 xml 中添加 &lt;update&gt; 标签，并且在该标签中添加参数 id ，并为其设定方法名。然后编写 sql 语句。</p> 
<p>如果在 MySQL 中操作，sql 语句：<code>update article set content = ? where id = ?</code><br> 所以在 MyBatis 中，将 " ? " 替换成 #{变量名} 即可，如下：</p> 
<pre><code class="prism language-xml">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>update</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>updateContentById<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        update article set content = #{content} where id = #{id}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>update</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>(3) 生成测试方法，原表内容如下，假设我们将 id 为 1 的文章内容修改为 “准备冻手”，那么代码如下<br> <img src="https://images2.imgbox.com/74/64/dnKh4epJ_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-java">	<span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">updateContentById</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        mapper<span class="token punctuation">.</span><span class="token function">updateContentById</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"准备冻手"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"修改成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>然后执行单元测试，article 表如下，符合预期，修改操作完成。</p> 
<p><img src="https://images2.imgbox.com/da/fa/ffQnLKQi_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="8__306"></a>8. 增加</h2> 
<h3><a id="81__307"></a>8.1 将对象插入表中</h3> 
<blockquote> 
 <p>任务：添加一篇文章</p> 
</blockquote> 
<p>（1）第一步，在接口中声明方法，并且这个方法是带参数的，所以我们也给它命个名<br> （在 sql 中，insert 语句返回的是受影响的行数，所以这里返回值自然是 int 类型）</p> 
<pre><code class="prism language-java">	<span class="token comment">// 新增一篇文章</span>
    <span class="token keyword">int</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"article"</span><span class="token punctuation">)</span> <span class="token class-name">Article</span> article<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>（2）在 xml 文件中编写代码。这里要用到的标签是 &lt;insert&gt; ，标签里面依然有个参数 id，<strong>填写其所实现的方法名</strong>，具体到此就是 “add” 。</p> 
<p>但是这里和上面带参数的查询有点不一样了， 这里的参数是一个对象，那么这时候需要怎么做呢？<br> 假设想要插入一条「id = 2, title=“科学养猪”, content=“发家致富”, userid=1」这样的文章，那么 sql 语句是</p> 
<pre><code class="prism language-sql"><span class="token keyword">insert</span> <span class="token keyword">into</span> article <span class="token punctuation">(</span>id<span class="token punctuation">,</span> title<span class="token punctuation">,</span> content<span class="token punctuation">,</span> userid<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"科学养猪"</span><span class="token punctuation">,</span> <span class="token string">"发家致富"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>⭐由于我们的参数是一个对象，而 xml 文件中又需要获取到对象的属性。所以这时候我们可以使用两种解决方法来获取，如果参数是对象，那么</p> 
<ol><li>使用 @Param 进行对对象重命名（名字不变也行，但是注释要有），然后在 xml 中使用 #{对象.成员} 的方式获取</li><li>不使用 @Param, 也就是对于 xml 来说，名字就是原参数名，然后在 xml 中使用 #{成员} 的方式来获取</li></ol> 
<p>建议大家记住其中一种进行使用就好，否则容易乱，笔者记得是第一种，本文也使用第一种举例，虽然啰嗦但是能够重命名。</p> 
<p>因此在 xml 中的代码如下：</p> 
<pre><code class="prism language-java">    <span class="token operator">&lt;</span>insert id<span class="token operator">=</span><span class="token string">"add"</span><span class="token operator">&gt;</span>
        insert into article <span class="token punctuation">(</span>id<span class="token punctuation">,</span> title<span class="token punctuation">,</span> content<span class="token punctuation">,</span> userid<span class="token punctuation">)</span> 
        values <span class="token punctuation">(</span>#<span class="token punctuation">{<!-- --></span>article<span class="token punctuation">.</span>id<span class="token punctuation">}</span><span class="token punctuation">,</span> #<span class="token punctuation">{<!-- --></span>article<span class="token punctuation">.</span>title<span class="token punctuation">}</span><span class="token punctuation">,</span> #<span class="token punctuation">{<!-- --></span>article<span class="token punctuation">.</span>content<span class="token punctuation">}</span><span class="token punctuation">,</span> #<span class="token punctuation">{<!-- --></span>article<span class="token punctuation">.</span>userid<span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>insert<span class="token operator">&gt;</span>
</code></pre> 
<p>随后生成单元测试，然后构造上述对象，并调用该接口中的 add 方法</p> 
<pre><code class="prism language-java">    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Article</span> article <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Article</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        article<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        article<span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span><span class="token string">"科学养猪"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        article<span class="token punctuation">.</span><span class="token function">setContent</span><span class="token punctuation">(</span><span class="token string">"发家致富"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        article<span class="token punctuation">.</span><span class="token function">setUserid</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mapper<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>article<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 调用接口中的 add 方法，将这个对象传入</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"添加成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>然后运行这个方法，查看数据库中的表，如下，文章新增成功，也符合我们的预期</p> 
<p><img src="https://images2.imgbox.com/6e/09/8TW20ODX_o.png" alt="在这里插入图片描述"></p> 
<p>这样就玩完成了插入一个对象了</p> 
<h3><a id="82__359"></a>8.2 获取自增主键</h3> 
<p>因为增加操作的时候只会返回受影响的行数，而如何我们想要获取到增加的对象的自增 id ，需要怎么操作？<br> （1）这个操作和普通的增加操作区别不大，还是先定义方法</p> 
<pre><code class="prism language-java">    <span class="token comment">// 在添加新元素的时候，获取新元素的自增 id</span>
    <span class="token keyword">int</span> <span class="token function">addAndGetId</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"article"</span><span class="token punctuation">)</span> <span class="token class-name">Article</span> article<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>（2）然后在 xml 中，我们需要在 &lt;insert&gt; 标签中加入两个属性：useGeneratedKeys 和 keyProperty</p> 
<ul><li>useGeneratedKeys：默认是 false，如果为 true，那么 MyBatis 会取出数据库内部生成的主键</li><li>keyProperty：需要填写能够唯一识别对象的属性（是实体类的属性，不是数据库的字段），它会将新增行的主键赋值给插入的对象相应的属性。有点绕，举个例子就知道了👇</li></ul> 
<p>代码如下，useGeneratedKeys 设置为 true 表示「开启自动生成」，keyProperty 设为 id，表示会将新增行的主键赋值给「插入的对象的 id 属性中」，具体什么意思往下看：</p> 
<pre><code class="prism language-xml">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>insert</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>addAndGetId<span class="token punctuation">"</span></span> <span class="token attr-name">useGeneratedKeys</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> <span class="token attr-name">keyProperty</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        insert into article (id, title, content, userid) 
        values (#{id}, #{title}, #{content}, #{userid})
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>insert</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>（3）生成单元测试，代码如下（这里自增主键的进一步解释在代码的注释中）</p> 
<pre><code class="prism language-java">    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">addAndGetId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 这个是新插入的对象</span>
        <span class="token class-name">Article</span> article <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Article</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        article<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        article<span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span><span class="token string">"获取自增主键"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 然后 xml 文件中 keyProperty = 'id'，表示会将新增行的主键 id 赋值给这个对象的 id 属性！</span>
        article<span class="token punctuation">.</span><span class="token function">setContent</span><span class="token punctuation">(</span><span class="token string">"通过 useGeneratedKey 和 keyProperty 标签来设置"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        article<span class="token punctuation">.</span><span class="token function">setUserid</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mapper<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>article<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 调用接口中的 add 方法，将这个对象传入</span>
        <span class="token comment">// 由于新行的自增主键赋值给了这个对象的 id 属性，所以我们直接通过 article.getId() 方法就可以获取 自增主键</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>article<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>然后执行，数据库查询结果和终端打印结果如下：也符合预期<br> <img src="https://images2.imgbox.com/3b/5f/A6jgnGse_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="9__398"></a>9. 删除</h2> 
<p>看到这里，插入操作就没什么难度了，这里简单讲讲就过了</p> 
<blockquote> 
 <p>任务: 删除指定 id 的文章</p> 
</blockquote> 
<p>（1）在接口中声明这个方法</p> 
<pre><code class="prism language-java"><span class="token keyword">int</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>（2）在 xml 文件中添加 &lt;delete&gt; 标签，并指定标签 id 的值</p> 
<pre><code class="prism language-xml">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>delete</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>delete<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        delete from article where id = #{id}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>delete</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>（3）生成单元测试，将 id = 3 的文章删除</p> 
<pre><code class="prism language-java">    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        mapper<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>执行即可，然后查询数据库可以看出，id 为 3 的文章被正确删除了，也符合我们的预期<br> <img src="https://images2.imgbox.com/7d/53/4hGXMdgs_o.png" alt="在这里插入图片描述"></p> 
<p>至此，MyBatis 中，当 Java 类的属性名都和数据库字段名一致的时候，增删查改就没有什么问题了。<br> 接下来我们再来看看如果 Java 中类属性和数据库类属性不一样，需要怎么处理</p> 
<h2><a id="10__427"></a>10. 数据库字段和类属性名字不一致的情况</h2> 
<p>上面创建了文章表和作者表，现在拿作者表举例子，如下是文章表的结构</p> 
<p><img src="https://images2.imgbox.com/73/52/DmB0n4w3_o.png" alt="在这里插入图片描述"></p> 
<p>然后就需要要表中创建这个 User 类，但是我这时候觉得 username，createtime，updatetime 没有使用小驼峰，不好看，所以采用小驼峰的方式创建这个类。（这个类只是一个普通的类，不用加 mapper 注解，但是可以加上 @Data 注解，需要导入lombok依赖，上文已经有导入，能够自动为该类添加 set，get，toString 等方法）</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> id<span class="token punctuation">;</span>
    <span class="token class-name">String</span> userName<span class="token punctuation">;</span> <span class="token comment">// 使用驼峰命名</span>
    <span class="token class-name">String</span> password<span class="token punctuation">;</span>
    <span class="token class-name">Date</span> createTime<span class="token punctuation">;</span> <span class="token comment">// 使用 Date 类型即可</span>
    <span class="token class-name">Date</span> updateTime<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>然后现在需要对 作者表 进行操作了， 所以现在也需要重新创建一个接口，来声明相应操作数据库的方法。如下，别忘了加上 @Mapper 注解，再重复一下它的作用：它会将为该接口生成实现类，并为其实例化成 Bean 对象存入 Spring 中。</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Mapper</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserMapper</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 命名无要求</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="101__452"></a>10.1 查询</h3> 
<blockquote> 
 <p>任务：根据 id 查询作者</p> 
</blockquote> 
<p>（1）第一步还是声明，其实重映射的情况和上面的情况是很相似的。</p> 
<pre><code class="prism language-java">    <span class="token comment">// 根据 id 查询文章</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 返回值是 List 类型，使用 List 接收</span>
</code></pre> 
<p>（2）编写 xml 文件，这个就需要动点手脚了。<br> 还是一样，需要在指定的路径下创建 xml 文件并且名字也要符合规定。还要加上两行固定的代码：</p> 
<pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">mapper</span> <span class="token name">PUBLIC</span> <span class="token string">"-//mybatis.org//DTD Mapper 3.0//EN"</span> <span class="token string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p><img src="https://images2.imgbox.com/68/92/mLd62cgM_o.png" alt="在这里插入图片描述"><br> 然后还是一样，加上 &lt;mapper&gt; 标签，并且这个标签中还要填写 namespace，填的是对应接口的全路径。</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.blogtest.mapper.UserMapper<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token prolog">&lt;? 后续内容都是都是在这个 mapper 标签中写 ?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h3><a id="102_resultMap_476"></a>10.2 resultMap</h3> 
<p>（3）⭐指定完接口之后，就有点不一样了，我们需要对「数据库中的字段名和Java类中的属性」进行重映射，将数据库字段和Java类属性名字不一样的属性重新对应起来。这里需要用到 &lt;resultMap&gt; 标签，在头标签中需要填写两个参数，id 和 type</p> 
<ul><li>id：resultMap 标签的标识，就是给它起个名。</li><li>type：需要进行重映射的 Java 类路径，这里我们需要对 User 类进行重映射，所以路径就是 User 全路径</li></ul> 
<p>如下</p> 
<pre><code class="prism language-xml">	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>map<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.blogtest.model.User<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token prolog">&lt;? 这里填写 数据库字段 和 Java 类的重映射 ?&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>然后在该 resultMap 中填写要重映射的内容，其中主要有两个标签 &lt;id&gt; 和 &lt;result&gt;（属性有点多，但是不难，举个例子就明白了）</p> 
<ul><li>id ，用于设置<strong>主键</strong>字段与领域模型属性的映射关系</li><li>result ，用于设置<strong>普通</strong>字段与领域模型属性的映射关系</li></ul> 
<p>其中这两个标签需要填写：① column：数据库中的字段 ② property：Java 类中的属性</p> 
<p>至此就是 &lt;resultMap&gt; 的使用方式了，我们来操作一下（搭配注释食用）：</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.blogtest.mapper.UserMapper<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token prolog">&lt;? resultMap 需要指定 id, 和重映射的类路径 ?&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>map<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.blogtest.model.User<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    	<span class="token prolog">&lt;? id 标签用于主键的重映射，result 用于普通属性的重映射 ?&gt;</span>
    	<span class="token prolog">&lt;? column 填的是数据库字段，property 填的是 Java 类属性?&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>   <span class="token prolog">&lt;? 主键 ?&gt;</span>
        <span class="token prolog">&lt;? 将数据库中 username 和 Java 类中的 userName 重新对应上 ?&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userName<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>result</span><span class="token punctuation">&gt;</span></span>  
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>createtime<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>createTime<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>result</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>updatetime<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>updateTime<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>result</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">&gt;</span></span>
    <span class="token prolog">&lt;? 接下来的增删查改在 resultMap 标签的后面写 ?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>⭐而没有进行处理的字段会按照默认的规则来对应，也就是默认数据库字段和类属性名字一致的方式来对应。</p> 
<p>好了，然后在 xml 文件中我们继续处理「根据 id 查询文章」<br> 那么现在的 select 标签需要怎么写？首先 id 是肯定要写的，填接口中对应的方法名。但是这里不是使用 resultType 了，而是 resultMap，⭐并且 resultMap 填写相应的 resultMap 标识，也就是上面进行重映射的 resultMap 名字。</p> 
<p>具体点，在这里就是：</p> 
<pre><code class="prism language-xml">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selectById<span class="token punctuation">"</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>map<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> <span class="token prolog">&lt;? 填的是 resultMap 不是 resultType ?&gt;</span>
        select * from user where id = #{id}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>（4）生成单元测试，将结果打印出来，别忘了添加 @SpringBootTest 和 依赖注入。测试结果如下：符合预期</p> 
<p><img src="https://images2.imgbox.com/2d/c8/eYEr6HrW_o.png" alt="在这里插入图片描述"><br> 这样查询操作就完成了，而插入操作是没有变化的，跟原来一样插入即可，全过程图片如下</p> 
<p><img src="https://images2.imgbox.com/ca/41/vDi1BXSK_o.png" alt="在这里插入图片描述">其他操作基本上都差不多，简单做个总结：</p> 
<ol><li>首先都是在接口中声明这个方法，并且自行选择要不要添加 @Param 注解。</li><li>在 xml 文件中添加 &lt;mapper&gt; 标签，并指定相应的接口</li><li>如果一部分数据库字段名和Java属性名不一样，那么可以针对这一部分进行重映射，需要使用 &lt;resultMap&gt;，并指定对应的 Java 类</li><li>根据 sql 的操作类型来确定使用哪个标签(insert…)，如果没有重映射，那么查询的时候要指定 resultType，如果重映射了，那么 resultType 就要换成 resultMap ，resultMap 填写对应的标识</li></ol> 
<h2><a id="11__536"></a>11. 排序查询</h2> 
<p>排序查询：如果有这样一个场景：在文章表中，需要我们使用一个方法，就能完成对 访问量 的 <strong>升序或者降序查询</strong><br> 如果直接使用 sql 语句，那么是：<code>select * from article order by visitcount asc(或者 desc);</code>那么想实现这个功能，有聪明的小伙伴可能就想到了：可以进行传参，参数只能是<code>asc 或者 desc</code>，然后根据这个参数在 xml 中使用 <code>order by visitcount #{参数}</code>，这个方法听起来挺对的，实际上却行不通，我们来试试<br> （我们先在表中插入几个元素，方便演示）<br> <img src="https://images2.imgbox.com/44/e1/QrHq17FF_o.png" alt="在这里插入图片描述">然后按照上面的步骤，全过程步骤如下：</p> 
<p><img src="https://images2.imgbox.com/5d/c0/NvItpQDK_o.png" alt="在这里插入图片描述"><br> 但是为啥会报错嘞？</p> 
<ol><li>首先了解一下 #{} ：它的工作原理是预编译处理，MyBatis 在处理 #{} 的时候，会先将其中的变量替换成 ? 号，然后使用 PreparedStatement 中 set 方法进行赋值替换（JDBC中的处理）</li><li>而 rule 是一个字符串，搭配 #{} 使用的时候，真正执行的 sql 是：<code>select * from article order by visticount "desc";</code></li></ol> 
<p>但是实际上我们的 desc 是不需要双引号的，我们只需要直接按照原字符串插入就好了，那么有没有直接替换的方法，或者说<strong>字符串拼接</strong>的方法？有！那就是⭐ ${}</p> 
<p>${} 就是直接替换，它的工作原理是字符串拼接。<br> 所以我们只需要稍作修改，在上文基础上将 #{} 改成 ${} 就行：如下<br> <img src="https://images2.imgbox.com/af/ed/7jJbElkV_o.png" alt="在这里插入图片描述">就可以完成自定义升降序了<br> 但是 ${} 有一个致命的缺陷，可能发生 SQL 注入的安全问题，篇幅有限，这里不展开了，CSDN很多佬们都有写🌹</p> 
<h3><a id="111_____556"></a>11.1 #{} 和 ${} 的区别</h3> 
<p>这里涉及到一个常见面试题，总结一下：</p> 
<ol><li>#{} 采用的是预处理方法，比较安全</li><li>${} 采用的是直接替换</li><li>${} 含有 SQL 注入的安全隐患</li><li>但是 ${} 可以实现升序或者降序排序</li></ol> 
<h2><a id="12__562"></a>12. 模糊匹配</h2> 
<blockquote> 
 <p>任务：查找标题中带有某关键词的文章</p> 
</blockquote> 
<p>这里就需要用到 MySQL 自带的字符串拼接函数 concat 了。使用方式👇，能够将多个字符串拼接起来。</p> 
<blockquote> 
 <p>CONCAT(string1,string2, … )</p> 
</blockquote> 
<p>举个例子：<br> （1）声明方法</p> 
<pre><code class="prism language-java">    <span class="token comment">// 查找标题中带有 某关键词 的文章</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Article</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectByLike</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"key"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>（2）xml 文件中编写代码</p> 
<pre><code class="prism language-java">    <span class="token operator">&lt;</span>select id<span class="token operator">=</span><span class="token string">"selectByLike"</span> resultType<span class="token operator">=</span><span class="token string">"com.example.blogtest.model.Article"</span><span class="token operator">&gt;</span>
        select <span class="token operator">*</span> from article where title like <span class="token function">concat</span><span class="token punctuation">(</span><span class="token string">"%"</span><span class="token punctuation">,</span> #<span class="token punctuation">{<!-- --></span>key<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">"%"</span><span class="token punctuation">)</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>select<span class="token operator">&gt;</span>
</code></pre> 
<p>然后生成单元测试，查询一下标题中带有 “手机” 的文章</p> 
<pre><code class="prism language-java">    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">selectByLike</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Article</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> mapper<span class="token punctuation">.</span><span class="token function">selectByLike</span><span class="token punctuation">(</span><span class="token string">"手机"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Article</span> a <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>查询结果如下：符合预期<br> <img src="https://images2.imgbox.com/79/f3/KUIcUqXr_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="13__596"></a>13. 联合查询</h2> 
<p>这里我分享一个比较取巧的方法，操作也比较简单。</p> 
<blockquote> 
 <p>任务：结合两个表，查询所有用户的所有文章，并显示作者姓名</p> 
</blockquote> 
<p>（1）声明方法</p> 
<pre><code class="prism language-java">    <span class="token comment">// 联合两张表，查询所有作者的所有文章，并显示作者姓名</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Article</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectByUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>（2）在 xml 中编写代码，我们需要查询出来的字段有：文章表中的所有属性 + 作者的姓名。筛选条件自然就是 <code>article.userid = user.id</code><br> 首先写出 sql 语句：<code> select user.username, article.* from article join user on user.id = article.userid;;</code></p> 
<p>因此在 xml 中的代码就是：</p> 
<pre><code class="prism language-xml">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selectByUserId<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.blogtest.model.Article<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        select user.username, article.* from article join user on user.id = article.userid
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<ol><li>首先这些 select 出来的字段有：article 的全部字段，user 的 username 字段。</li><li>但是我填写的 resultType 却使用 Article 来接受，但是 Article 实际上却没有 username 这个属性</li><li>⭐所以我们可以<strong>直接在 Article 实体类中添加这个 username 属性！</strong>（也就是缺少什么属性，就在该类上补充什么属性就行了）这个方法较为取巧，没有用到其他标签</li></ol> 
<p>然后我们生成单元测试执行后的结果如下：符合预期</p> 
<p><img src="https://images2.imgbox.com/f6/d3/HluOIEbV_o.png" alt="在这里插入图片描述"><br> 这样就完成多表查询了，比较取巧，也比较好掌握。<br> 涉及到多表查询也是一样，在指定 resultType 这个类的基础上，多表查询还缺少哪个属性，就添加哪个属性。</p> 
<h2><a id="14__SQL_625"></a>14. 动态 SQL</h2> 
<p>动态 SQL 是 MyBatis 中一个很强大的特性，它能够将 sql 语句进行很方便的拼接<br> 本文主要分享5个标签的使用，在分享之前，可以在配置文件中配置如下代码：<br> 可以在控制台中打印实际上执行的 sql 语句</p> 
<pre><code class="prism language-xml">mybatis:
	configuration:
		log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
</code></pre> 
<h3><a id="141_if__636"></a>14.1 if 标签</h3> 
<p>在某些场景中，对于表中的某个属性，填的是<strong>空</strong>还是 <strong>null</strong> 是有很大区别的，例如，在本文中的 user 表中，如果 <code>createtime</code> 和 <code>updatetime</code> 不填，那么这两个属性会默认是当前时间，但是如果填的是 <code>null</code>，那就是不一样的结果，可能会对业务逻辑造成一定不便，例如：当不我们不填和填为 null 的两种情况，createtime 实际值如下。（user表在创建时指定了如果 createtime和updatetime 如果不填默认为当前时间）<br> <img src="https://images2.imgbox.com/87/5f/USuMkJa9_o.png" alt="在这里插入图片描述">因此，在 sql 语句中，我们可以通过 <code>&lt;if&gt;</code> 标签来根据某个条件是否成立来决定是否拼接 sql 语句，举个例子就明白了</p> 
<blockquote> 
 <p>任务：向 user 表中插入一个新数据，一定要有 id，username，password，但是 createtime 这个属性要取决于用户：如果用户没填（也就是 null），那就默认是当前时间，否则按照用户填的来</p> 
</blockquote> 
<p>（1）在接口中声明这个方法</p> 
<pre><code class="prism language-java"><span class="token comment">// 插入（但是 createtime 可能为空）</span>
<span class="token keyword">int</span> <span class="token function">insertIfCondition</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">,</span> <span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> userName<span class="token punctuation">,</span>
                      <span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> password<span class="token punctuation">,</span> <span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"createtime"</span><span class="token punctuation">)</span><span class="token class-name">Date</span> createTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>（2）在 xml 文件中编写 sql 语句<br> <code>&lt;if&gt;</code> 标签中还需要填写一个属性 <code>test</code>，表示：什么条件成立的情况下，<code>&lt;if&gt;</code>中的语句块参与拼接，<code>test</code>中的条件不成立，就不参与拼接。举个例子就懂了，xml 中编写代码如下：<br> <img src="https://images2.imgbox.com/82/c4/hFX3WdG7_o.png" alt="在这里插入图片描述"><br> （3）然后生成单元测试看一下是否符合预期，首先我们插入一个让 createtime 为空的数据，如下</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">insertIfCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    mapper<span class="token punctuation">.</span><span class="token function">insertIfCondition</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">"测试"</span><span class="token punctuation">,</span> <span class="token string">"test"</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// createtime 为空</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>然后运行，可以分别从控制台中看到实际的 sql 执行情况以及数据库中查看实际效果👇：<br> <img src="https://images2.imgbox.com/02/1a/kTDOGzFh_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/eb/09/XBfhMW74_o.png" alt="在这里插入图片描述">然后我们再测试一下 <code>createtime</code> 不为空的时候</p> 
<pre><code class="prism language-java">    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">insertIfCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        mapper<span class="token punctuation">.</span><span class="token function">insertIfCondition</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token string">"createtime不为空的test"</span><span class="token punctuation">,</span> <span class="token string">"test"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>执行后，查看真正执行的 sql 语句以及数据库的查询结果，可以看出，createtime 不为空，所以<code>&lt;if&gt;</code>标签中的语句块拼接正常</p> 
<p><img src="https://images2.imgbox.com/26/df/6fekhWTL_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/56/5b/Hy1bnMAD_o.png" alt="在这里插入图片描述"></p> 
<p>总结一下：<code>&lt;if&gt;</code>标签能够依赖于 test 属性中的条件，如果条件成立，那么该标签中的语句块参与拼接，否则不参与。⭐并且对于 test 属性用的变量名，使用的是「@Param 注解重命名的变量」，图解如下</p> 
<p><img src="https://images2.imgbox.com/a5/56/MhRshsxC_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="142_trim__681"></a>14.2 trim 标签</h3> 
<p><code>&lt;trim&gt;</code>标签能够对语句块进行前缀，后缀的添加和删除，其中有 4 个属性</p> 
<ul><li>prefix：表示标签中的语句块要以 prefix 作为前缀</li><li>suffix：表示标签中的语句块要以 suffix 作为后缀</li><li>prefixOverrides：表示整个语句块要删除的前缀</li><li>suffixOverrides：表示整个语句块要删除的后缀</li></ul> 
<p><img src="https://images2.imgbox.com/64/71/RIJEt0Do_o.png" alt="在这里插入图片描述"></p> 
<p>文绉绉的，举个例子就明白了</p> 
<blockquote> 
 <p>假设我们要向 user 表中插入一个新数据，但是<strong>除了 id</strong> 每一个值都有可能为 null ，也就是说我们要用 if 语句处理每一个属性。<br> <strong>（需要注意，在 user 表中设定了 id, username, password 都不能为空，这里只是举个这样的场景）</strong></p> 
</blockquote> 
<p>（1）还是一样，先在接口中声明这个方法</p> 
<pre><code class="prism language-java"><span class="token comment">// 插入（但是除了id，在上述场景中每一项都可能为空）</span>
<span class="token keyword">int</span> <span class="token function">insertTrim</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">,</span> <span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> userName<span class="token punctuation">,</span>
               <span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> password<span class="token punctuation">,</span> <span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"createtime"</span><span class="token punctuation">)</span><span class="token class-name">Date</span> createTime<span class="token punctuation">,</span> 
               <span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"updatetime"</span><span class="token punctuation">)</span> <span class="token class-name">Date</span> updateTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>（2）在 xml 文件中编写代码，如果只需要对其余的属性进行单独处理，那么有些小伙伴可以会这么做：<br> <img src="https://images2.imgbox.com/a8/a3/MRQey27T_o.png" alt="在这里插入图片描述"></p> 
<p>但是这样就会有一个问题，由于有些变量可能有，可能没有，你也就不知道哪个变量会是括号中的最后一个，所以逗号的问题就会比较尴尬，上述代码可能会出现这种 sql 语句：<code>insert into user (id, username, ) values (idValue, usernameValue, )</code>显然这些多余的逗号在 mysql 是报错的，这时候就可以使用 <code>&lt;trim&gt;</code>标签</p> 
<p>代码如下👇，为方便解释，注释会说的比较详细（代码看着多，实际上都是标签，不男）</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>insert</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>insertTrim<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    insert into user
        <span class="token comment">&lt;!-- trim 中的 prefix 和 suffix 能分别对语句块增加相应的前缀和后缀 --&gt;</span>
        <span class="token comment">&lt;!-- 所以这里就直接省略括号了，通过这两个属性添加 --&gt;</span>
        <span class="token comment">&lt;!-- 我们为每个字段都加上一个逗号，然后使用 suffixOverrides 将作为后缀的最后一个逗号去掉 --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>trim</span> <span class="token attr-name">prefix</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>(<span class="token punctuation">"</span></span> <span class="token attr-name">suffix</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>)<span class="token punctuation">"</span></span> <span class="token attr-name">suffixOverrides</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>,<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            id,
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username != null<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                username,
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password != null<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                password,
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>createtime != null<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                createtime,
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>updatetime != null<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                updatetime,
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>trim</span><span class="token punctuation">&gt;</span></span>
    values 
        <span class="token comment">&lt;!-- 这里和上面是一样的，需要注意需要使用 #{变量名} --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>trim</span> <span class="token attr-name">prefix</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>(<span class="token punctuation">"</span></span> <span class="token attr-name">suffix</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>)<span class="token punctuation">"</span></span> <span class="token attr-name">suffixOverrides</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>,<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            #{id},
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username != null<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                #{username},
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password != null<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                #{password},
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>createtime != null<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                #{createtime},
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>updatetime != null<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                #{updatetime},
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>trim</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>insert</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>（3）然后生成单元测试</p> 
<pre><code class="prism language-java">    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">insertTrim</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        mapper<span class="token punctuation">.</span><span class="token function">insertTrim</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token string">"trim测试"</span><span class="token punctuation">,</span> <span class="token string">"test"</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>如下，这是实际上的 sql 执行情况，可以看出：由于<code>createtime 和 updatetime</code>为空，所以这两属性就没参与拼接，多余的逗号也被删除了。</p> 
<p><img src="https://images2.imgbox.com/cf/90/UUPdfGwn_o.png" alt="在这里插入图片描述">数据库查询情况：也符合预期<br> <img src="https://images2.imgbox.com/50/32/dBe6JvOr_o.png" alt="在这里插入图片描述"></p> 
<p>总结一下：<code>&lt;trim&gt;</code>能够通过 <code>prefixOverrides 和 prefixOverrides</code>属性去除掉多余的前缀或者后缀，而 <code>prefix 和 suffix</code>属性能够将语句块和相应的前缀和后缀进行拼接</p> 
<h3><a id="143_where__764"></a>14.3 where 标签</h3> 
<p>接着是<code>&lt;where&gt;</code>标签，显然，这个是用于「需要用到 where 的情况」</p> 
<blockquote> 
 <p>场景：用户想要在 user 表中根据 id 和 username 进行查询，但是这两个筛选条件都可能为空<br> （显然，如果两个都为空，那么会是查询 user 表中所有记录）</p> 
</blockquote> 
<ul><li><code>&lt;where&gt;</code>标签中如果没有任何语句块，那么 where 关键字就不会存在；相反，如果有语句块，那 where 自然就在</li><li>并且 where 中的语句块以 <code>and 或 or</code> 开头，那么会自动删除</li></ul> 
<p>（1）在接口中声明方法</p> 
<pre><code class="prism language-java">    <span class="token comment">// 根据 id, userName 查询 user 表, 但 id 和 userName 都可能为空</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectWhere</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">,</span> <span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> userName<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>（2）在 xml 文件中编写代码，因为两者都可能不存在，所以使用 where 标签嵌套两个 if 标签实现：</p> 
<pre><code class="prism language-xml">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selectWhere<span class="token punctuation">"</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>map<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> <span class="token prolog">&lt;? User 类在上文进行了重映射，所以这里要用 resultMap ?&gt;</span>
        select from user
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>where</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id != null<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                and id = #{id}
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username != null<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                and username = #{username}
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>where</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>（3）生成单元测试</p> 
<pre><code class="prism language-java">    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">selectWhere</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> mapper<span class="token punctuation">.</span><span class="token function">selectWhere</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"小刘"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">User</span> user <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment">// 查询结果都打印出来</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>然后测试一下，当这两个都不为空的时候，执行的 sql 和 查询结果如下：符合预期<br> <img src="https://images2.imgbox.com/93/52/sNNESkKT_o.png" alt="在这里插入图片描述"><br> 当我们 <code>id = 2，username = null</code> 的时候，测试结果如下：符合预期</p> 
<p><img src="https://images2.imgbox.com/3a/db/eTuxANIW_o.png" alt="在这里插入图片描述"><br> 当我们输入两个都为空的时候，测试结果如下：从实际执行的 sql 可以看出两个属性都为空的时候，where 也自然被删除了，这里查询的就是所有数据</p> 
<p><img src="https://images2.imgbox.com/19/a8/GLj5BBs1_o.png" alt="在这里插入图片描述"><br> 总结一下：这就是<code>&lt;where&gt;</code>标签了，where 语句中的条件都是通过 and 或者 or 连接条件的，由于 where 的特性，我们在所有条件前都加上 and 或者 or 就可以了。</p> 
<h3><a id="144_set__812"></a>14.4 set 标签</h3> 
<p>这个标签和 where 标签很相似，where 用于筛选，set 用于update语句中</p> 
<ul><li><code>&lt;set&gt;</code>标签会自动将最后的逗号去掉</li></ul> 
<blockquote> 
 <p>场景：更新指定 id 的用户，修改用户名和密码，两者都可以为空</p> 
</blockquote> 
<p>（1）在接口中声明方法</p> 
<pre><code class="prism language-java">    <span class="token comment">// 修改指定 id 的用户的用户名和密码</span>
    <span class="token keyword">int</span> <span class="token function">updateSet</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">,</span> <span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> userName<span class="token punctuation">,</span> 
                  <span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>（2）在 xml 文件中编写代码</p> 
<pre><code class="prism language-java">    <span class="token operator">&lt;</span>update id<span class="token operator">=</span><span class="token string">"updateSet"</span><span class="token operator">&gt;</span>
        update user
            <span class="token generics"><span class="token punctuation">&lt;</span>set<span class="token punctuation">&gt;</span></span>
                <span class="token operator">&lt;</span><span class="token keyword">if</span> test<span class="token operator">=</span><span class="token string">"username != null"</span><span class="token operator">&gt;</span>
                    username <span class="token operator">=</span> #<span class="token punctuation">{<!-- --></span>username<span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">if</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token keyword">if</span> test<span class="token operator">=</span><span class="token string">"password != null"</span><span class="token operator">&gt;</span>
                    password <span class="token operator">=</span> #<span class="token punctuation">{<!-- --></span>password<span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">if</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>set<span class="token operator">&gt;</span>
        where id <span class="token operator">=</span> #<span class="token punctuation">{<!-- --></span>id<span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>update<span class="token operator">&gt;</span>
</code></pre> 
<p>（3）生成单元测试，首先将 id 为 2 的用户，用户名修改为“史强”，密码不做修改<br> 执行的 sql 和数据库查询结果如下👇，<code>&lt;set&gt;</code>标签将最后一个逗号也删除了，符合预期：</p> 
<p><img src="https://images2.imgbox.com/cc/7f/eluI51kJ_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/13/b1/feRVk4Zc_o.png" alt="在这里插入图片描述">总结一下：<code>&lt;set&gt;</code>标签用于 update 语句，用于更新一个或者多个值，并且可以删除最后一个多余的逗号。需要注意的是，当 <code>&lt;set&gt;</code> 标签的使用至少是要更新一个属性的，否则报错</p> 
<h3><a id="145_foreach__849"></a>14.5 foreach 标签</h3> 
<p>接下来是本文介绍的最后一点了：<code>&lt;foreach&gt;</code>标签，在我们需要遍历一个集合的时候，就可以用到，里面包含 5 个属性（但是不复杂，举个例子就明白了）</p> 
<ul><li><code>collection</code>：表示迭代集合的名称，可以填写 @Param 注解指定的名字</li><li><code>item</code>：该集合在进行迭代时起的别名，如果集合是 Map 集合，这里进行迭代的对象是 key-value 中的 value</li><li><code>open</code>：语句块开头的字符串</li><li><code>close</code>：语句块结尾的字符串</li><li><code>separator</code>：每次遍历之间间隔的字符串</li></ul> 
<blockquote> 
 <p>场景：在 user 表中删除 id 在指定集合（参数）中的记录</p> 
</blockquote> 
<p>前言：正常情况下我们想从 user 表中删除若干个 id 的记录，sql 语句可以是：<code>delete from user where id in (....)</code>，那么如果我们有了想删除的 id 集合，在 MyBatis 中的实现就要用到<code>&lt;foreach&gt;</code> 标签，它和 Java 中的 foreach 差不多，⭐不同的是它能够将遍历的元素按照一定的规则<font color="red">拼接起来</font>：</p> 
<p><img src="https://images2.imgbox.com/68/f8/DpjidoAl_o.png" alt="在这里插入图片描述"></p> 
<p>（1）在接口中声明这个方法，使用 @Param 起个顺眼的名字</p> 
<pre><code class="prism language-java">    <span class="token comment">// 将 user 表中 id 在 idList 中的记录都删除掉</span>
    <span class="token keyword">int</span> <span class="token function">deleteForeach</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"collection"</span><span class="token punctuation">)</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> idList<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>（2）在 xml 文件中编写代码</p> 
<pre><code class="prism language-xml">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>delete</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>deleteForeach<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        delete from user where id in
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>foreach</span> <span class="token attr-name">collection</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>collection<span class="token punctuation">"</span></span> <span class="token attr-name">item</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>curId<span class="token punctuation">"</span></span> <span class="token attr-name">open</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>(<span class="token punctuation">"</span></span> <span class="token attr-name">close</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>)<span class="token punctuation">"</span></span> <span class="token attr-name">separator</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>,<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                #{curId}
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>foreach</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>delete</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>这段代码是啥意思呢？下面是详细解析👇：</p> 
<p><img src="https://images2.imgbox.com/60/bc/HAahAdFd_o.png" alt="在这里插入图片描述"></p> 
<p>因此，这段<code>&lt;foreach&gt;</code>标签最终就会得到<code>(id1,id2,id3...)</code>这样的字符串，最终执行这样的 sql 语句<br> （3）生成单元测试，假设我们传入一个 (4, 5, 6) 的 id 集合：</p> 
<pre><code class="prism language-java">    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">deleteForeach</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> idList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        idList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        idList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        idList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mapper<span class="token punctuation">.</span><span class="token function">deleteForeach</span><span class="token punctuation">(</span>idList<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>执行的 sql 情况如下，in 后面的内容就是 <code>&lt;foreach&gt;</code> 拼接后的结果<br> <img src="https://images2.imgbox.com/23/9d/tZQxhNiL_o.png" alt="在这里插入图片描述">数据库执行情况：情况符合预期<br> <img src="https://images2.imgbox.com/66/f6/dZ1mPaiN_o.png" alt="在这里插入图片描述"></p> 
<p>这就是本文所有内容了，如果有错误欢迎大家指出~</p> 
<h2><a id="15__905"></a>15. 全代码</h2> 
<p><a href="https://github.com/Abibiboy/JavaCode/tree/main/blogTest">Github</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/597d98cbf18c25935cea63084d5cb64b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">基于java的简单学生宿舍管理系统</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/efca11a5aa24b3f66e8b1eb61ac46727/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">CNN 一般训练跟测试集的比例是 多少</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>