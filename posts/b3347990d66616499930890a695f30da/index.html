<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>BGP13条选路原则 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="BGP13条选路原则" />
<meta property="og:description" content="BGP选路原则 最高有weight优先，默认为0(思科特有，选大的)
本地优先级高的优先（只可以在IBGP邻居之间传递）
起源本路由器上的路由（network、aggregate-address）
as-path最短的优先
最小的起源代码 (IGP 优先 EGP 优先 incomplete)
最低的med
ebgp&gt;ibgp
通过最近BGP邻居的路由
如果配置了maixmum-path[IBGP]，就负载均衡
最老的EBGP邻居学到的路由,是路由最老
更低的router-id
始发路由器ID相同，那么选择 cluster-list短的
优选来自于最低的邻居地址的路径，是BGP的neigbor配置中地址 一、Weight值
简介：
1.优选有最大Weight的路由(范围0到65535)，weight是CISCO私有的参数。
2. 缺省情况下，通过本路由器宣告、重分布或者汇总的路由的weight为32768，从BGP邻居学习到的路由的weight为0。
3：只在本地(影响自己一个路由器)有用，影响本路由的选路。
修改方法：
1、neighbor xxx weight xxx (从此xxx邻居学到的所有的路由都加)
2、route-map xxx permit 10 set weight xxx
只能在本路由器的入方向上做。
二、local-prefrence 理论简介：
1.通过第一条选路原则不能选出最优BGP条目的情况下，优选有最大local preference值的BGP条目。
2.local preference值只在IBGP邻居之间传递，在EBGP邻居之间不能传递，也就是说不能在EBGP的出方向上做,因为只在本AS内生效。
3.对于从EBGP邻居学习到的BGP条目，local preference缺省值为100，这个值可以通过命令bgp default local-preference修改。
修改方法：
（1）bgp default local-preference xxx
修改后，对IBGP学来的路由不起作用，只对EBGP传来的和自己产生的路由起作用。
（2）route-map xxx permit 10
set local-preference xxx
（3）不能在EBGP邻居关系的出方向做修改。
3、local-preference的默认值是100
在show ip bgp 中看到是空，其实也是100，show ip bgp xxxx 看明细的时候可看见路由的local-preference。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/b3347990d66616499930890a695f30da/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-03-26T17:06:49+08:00" />
<meta property="article:modified_time" content="2018-03-26T17:06:49+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">BGP13条选路原则</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div class="artical-content-bak main-content editor-side-new"> 
 <div class="con editor-preview-side" id="result"> 
  <h3 style="font-family:'PingFang SC', 'Helvetica Neue', Helvetica, Arial, sans-serif;"><span style="font-size:36px;font-family:'微软雅黑', 'Microsoft YaHei';"><strong><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:36px;">BGP选路原则</span></strong></span></h3> 
  <ol class="list-paddingleft-2" style="list-style-type:decimal;"><li><p style="text-indent:27px;font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'宋体';">最高有</span><span style="font-size:18px;font-family:Simsun, serif;">weight</span><span style="font-size:18px;font-family:'宋体';">优先，默认为</span><span style="font-size:18px;font-family:Simsun, serif;">0(</span><span style="font-size:18px;font-family:'宋体';">思科特有，选大的</span><span style="font-size:18px;font-family:Simsun, serif;">)</span></p></li><li><p style="text-indent:27px;font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'宋体';">本地优先级高的优先（只可以在IBGP邻居之间传递）</span></p></li><li><p style="text-indent:27px;font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'宋体';">起源本路由器上的路由（</span><span style="font-size:18px;font-family:Simsun, serif;">network</span><span style="font-size:18px;font-family:'宋体';">、</span><span style="font-size:18px;font-family:Simsun, serif;">aggregate-address</span><span style="font-size:18px;font-family:'宋体';">）</span></p></li><li><p style="text-indent:27px;font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:Simsun, serif;">as-path</span><span style="font-size:18px;font-family:'宋体';">最短的优先</span></p></li><li><p style="text-indent:27px;font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'宋体';">最小的起源代码</span><span style="font-size:18px;font-family:Simsun, serif;"> (</span><span style="font-size:18px;font-family:'微软雅黑', sans-serif;">IGP 优先 EGP 优先 incomplete</span><span style="font-size:18px;font-family:Simsun, serif;">)</span></p></li><li><p style="text-indent:27px;font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'宋体';">最低的</span><span style="font-size:18px;font-family:Simsun, serif;">med</span></p></li><li><p style="text-indent:27px;font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:Simsun, serif;">ebgp&gt;ibgp</span></p></li><li><p style="text-indent:27px;font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'宋体';">通过最近</span><span style="font-size:18px;font-family:Simsun, serif;">BGP</span><span style="font-size:18px;font-family:'宋体';">邻居的路由</span></p></li><li><p style="text-indent:27px;font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'宋体';">如果配置了</span><span style="font-size:18px;font-family:Simsun, serif;">maixmum-path[IBGP]</span><span style="font-size:18px;font-family:'宋体';">，就负载均衡</span></p></li><li><p style="text-indent:27px;font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'宋体';">最老的</span><span style="font-size:18px;font-family:Simsun, serif;">EBGP</span><span style="font-size:18px;font-family:'宋体';">邻居学到的路由</span><span style="font-size:18px;font-family:Simsun, serif;">,</span><span style="font-size:18px;font-family:'宋体';">是路由最老</span></p></li><li><p style="text-indent:27px;font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'宋体';">更低的</span><span style="font-size:18px;font-family:Simsun, serif;">router-id</span></p></li><li><p style="text-indent:27px;font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'宋体';">始发路由器</span><span style="font-size:18px;font-family:Simsun, serif;">ID</span><span style="font-size:18px;font-family:'宋体';">相同，那么选择</span><span style="font-size:18px;font-family:Simsun, serif;"> cluster-list</span><span style="font-size:18px;font-family:'宋体';">短的</span></p></li><li><p style="text-indent:27px;font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'宋体';">优选来自于最低的邻居地址的路径，是</span><span style="font-size:18px;font-family:Simsun, serif;">BGP</span><span style="font-size:18px;font-family:'宋体';">的</span><span style="font-size:18px;font-family:Simsun, serif;">neigbor</span><span style="font-size:18px;font-family:'宋体';">配置中地址</span><span style="font-size:18px;font-family:Simsun, serif;"> </span></p></li></ol> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:Simsun, serif;"> </span></p> 
  <hr> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><strong><span style="font-family:'微软雅黑', 'Microsoft YaHei';color:#FF0000;background:#FFA500;font-size:20px;">一、Weight值</span></strong></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;color:#808000;font-family:'微软雅黑', 'Microsoft YaHei';">简介：</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:18px;">1.优选有最大Weight的路由(范围0到65535)，weight是CISCO私有的参数。</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'微软雅黑', sans-serif;">2. 缺省情况下，通过本路由器宣告、重分布或者汇总的路由的weight为32768，从BGP邻居学习到的路由的weight为0。</span></p> 
  <p style="font-size:14px;"><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:18px;">3：只在本地(影响自己一个路由器)有用，影响本路由的选路<span style="font-family:Simsun, serif;">。</span></span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;color:#808000;font-family:'微软雅黑', 'Microsoft YaHei';">修改方法：</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-family:'微软雅黑', 'Microsoft YaHei';"><span style="font-size:18px;"> </span><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:18px;">1、neighbor xxx weight xxx  (从此xxx邻居学到的所有的路由都加)</span></span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:18px;"> 2、route-map xxx permit 10 </span></p> 
  <p style="text-indent:28px;font-size:14px;font-family:Calibri, sans-serif;"><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:18px;">set weight  xxx</span></p> 
  <p style="font-size:14px;"><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:18px;"> 只能在本路由器的入方向上做。</span></p> 
  <hr> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><strong><span style="font-family:'微软雅黑', 'Microsoft YaHei';color:#FF0000;background:#FFA500;font-size:20px;">二、local-prefrence </span></strong></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'微软雅黑', sans-serif;">理论简介：</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'微软雅黑', sans-serif;">1.通过第一条选路原则不能选出最优BGP条目的情况下，优选有最大local preference值的BGP条目。</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'微软雅黑', sans-serif;">2.local preference值只在<strong>IBGP</strong>邻居之间传递，在EBGP邻居之间不能传递，也就是说<strong>不能在EBGP的出方向上做</strong>,因为只在本AS内生效。</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'微软雅黑', sans-serif;">3.对于从EBGP邻居学习到的BGP条目，local preference缺省值为100，这个值可以通过命令bgp default local-preference修改。</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'微软雅黑', sans-serif;">修改方法：</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'微软雅黑', sans-serif;">  （1）bgp default local-preference xxx</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'微软雅黑', sans-serif;">修改后，对IBGP学来的路由不起作用，只对EBGP传来的和自己产生的路由起作用。</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'微软雅黑', sans-serif;">  （2）route-map xxx permit 10</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'微软雅黑', sans-serif;">       set local-preference xxx</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'微软雅黑', sans-serif;">  （3）不能在EBGP邻居关系的出方向做修改。</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'微软雅黑', sans-serif;"> 3、local-preference的默认值是100</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'微软雅黑', sans-serif;">在show ip bgp 中看到是空，其实也是100，</span><span style="font-family:'微软雅黑', sans-serif;font-size:18px;">show ip bgp xxxx </span><span style="font-family:'微软雅黑', sans-serif;font-size:18px;">看明细的时候可看见路由的</span><span style="font-family:'微软雅黑', sans-serif;font-size:18px;">local-preference。</span></p> 
  <hr> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><strong><span style="font-family:'微软雅黑', 'Microsoft YaHei';color:#FF0000;background:#FFA500;font-size:20px;">三：起源本路由器上的路由 </span></strong></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'微软雅黑', sans-serif;">优选从本路由器始发的路由（包括本地network配置的重分布，或者在IGP表中已经有一些需要被配置路由聚合的地址，在BGP中用aggregate-address命令配置的路由聚合）。</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'微软雅黑', sans-serif;">注意：对于CISCO IOS，如果是从本地往BGP里注入一条路由，缺省的weight值为32768，由于这个weight值很大，对于该注入路由，会根据第一条选路原则成为最优BGP条目。因此对CISCO IOS来说，第三条选路原则作用不大。然而考虑到第一条选路原则为CISCO私有，不是所有厂家都支持，第三条选路原则的作用就显现出来了。</span></p> 
  <hr> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><strong><span style="font-family:'微软雅黑', 'Microsoft YaHei';color:#FF0000;background:#FFA500;font-size:20px;">四、AS-PATH</span></strong></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'微软雅黑', sans-serif;">在通过前三条选路原则不能选出最优BGP条目的情况下，优选AS path长度短的路由条目。</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'微软雅黑', sans-serif;color:#FF0000;">注意：修改AS path长度只能在EBGP邻居关系之间进行，IBGP邻居关系是不可以的</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'微软雅黑', sans-serif;">1、as-path只可以在EBGP邻居关系的out方向和in的方向去修改</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'微软雅黑', sans-serif;">   （1）out方向做: 加在本来AS号的前面(右边</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'微软雅黑', sans-serif;">   （2）in方向做: 加在本来AS号的后面(左边　</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'微软雅黑', sans-serif;">2、last-as 表示在离这个路由器最近的AS号，重复加次数</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'微软雅黑', sans-serif;">  route-map xx permit 10</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'微软雅黑', sans-serif;">     match ip address 1</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'微软雅黑', sans-serif;">     set as-path prepend last-as 数字(加多少次)</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'微软雅黑', sans-serif;">3、当写下面两个命令时，哪个先生效？</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'微软雅黑', sans-serif;">   set as-path prepend  23 </span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'微软雅黑', sans-serif;">   set as-path prepend last-as 数字</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'微软雅黑', sans-serif;">　入/出方向的时候,as-path prepend与last-as同时使用,都是last-as先生效,然后as-path prepend才生效</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'微软雅黑', sans-serif;">　（１）、聚合   聚合后的｛｝内的ＡＳ算几个？一个</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'微软雅黑', sans-serif;">　（２）、联邦   联盟内的（）内的ＡＳ算几个？一个也不算</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'微软雅黑', sans-serif;">　（３）、neighbor xxx remove-private-AS 删除私有AS号，起源于本AS无效，在出方向做。</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'微软雅黑', sans-serif;">5、如何跳过as-path选路原则</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'微软雅黑', sans-serif;">     bgp bestpath as-path ignore </span></p> 
  <hr> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><strong><span style="font-family:'微软雅黑', 'Microsoft YaHei';color:#FF0000;background:#FFA500;font-size:20px;">五、起源代码origin</span></strong></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'微软雅黑', sans-serif;">在通过前四条选路原则不能选出最优BGP条目的情况下，优选最低起源类型的BGP路由</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'微软雅黑', sans-serif;">最低起源类型的顺序是<strong> IGP 优先 EGP 优先 incomplete</strong>，其中EGP的方式现在已经不用了。</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'微软雅黑', sans-serif;">通过Network，aggregate方式产生的BGP路由的起源属性是i，通过重分布产生的BGP路由的起源属性是incomplete。</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'微软雅黑', sans-serif;">１：</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'微软雅黑', sans-serif;"> 　i--------igp  network xxxxx   </span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'微软雅黑', sans-serif;"> 　e-------egp  (没有了)</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'微软雅黑', sans-serif;">　 ?-------重分发</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'微软雅黑', sans-serif;">２、origin在 EBGP/或IBGP的in和out方向都可以做</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'微软雅黑', sans-serif;">　route-map xxx permit 10</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'微软雅黑', sans-serif;">     match ip address pre 1</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'微软雅黑', sans-serif;">     set origin incomplete ?</span></p> 
  <hr> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><strong><span style="font-family:'微软雅黑', 'Microsoft YaHei';color:#FF0000;background:#FFA500;font-size:20px;"> 六、MED</span></strong></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><strong><span style="font-size:18px;font-family:'微软雅黑', sans-serif;color:#FF0000;">MED</span></strong><strong><span style="font-size:18px;font-family:'微软雅黑', sans-serif;color:#FF0000;">值的用途</span></strong><span style="font-size:18px;font-family:'微软雅黑', sans-serif;">：在两个相临AS之间有多个BGP连接的情况下，MED值用于影响从相邻AS到本AS的路由选择，即用于影响邻居AS到本AS的流量从哪个接口进来，这是通过向相邻AS的EBGP邻居发送具有不同MED值的路由条目来实现的，但是需要注意选路过程的实现是相邻AS的路由器自身根据13条选路原则独立完成，MED值的的比较是前面的五条选路原则都不能选出最优的情况下才起作用。</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'微软雅黑', sans-serif;">MED的生成： </span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'微软雅黑', sans-serif;">1）本地network方式生成的BGP条目，会带上IGP的metric，（同时也会带上路由的下一跳，开启汇总后会被取消）会传给所有邻居。</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'微软雅黑', sans-serif;">2）如果从EBGP邻居学习到的BGP条目的metric值传递给其他IBGP邻居，但不传给EBGP。</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'微软雅黑', sans-serif;">                -----以上表示MED值只传递一次EBGP邻居-----</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'微软雅黑', sans-serif;">3）如果从IBGP邻居学习到一条BGP条目的metric为0或者其他值，缺省不会传给给EBGP邻居，显示为空。</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'微软雅黑', sans-serif;">4）汇总方式生成的BGP条目，metric值为空。</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'微软雅黑', sans-serif;">5）重分布方式生成的BGP条目，metric值为IGP的cost、metric、hop，如果开启自动汇总会被清除。</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'微软雅黑', sans-serif;">6）缺省情况下，空的metric当0看待 。</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'微软雅黑', sans-serif;">优选最小MED 值的路由(范围 0到4,294,967,295). </span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'微软雅黑', sans-serif;">  A．只有在通过两条路径得到第一个AS（对等体）是同一个AS时才进行MED比较；任何子自治域的联盟系统都会被忽略。也就是说，只有在AS序列号中第一个AS号码一致时，才进行MED比较；任何联盟AS序列号(AS_CONFED_SEQUENCE)都会被忽略,也就是说从不同联邦AS学到的路由都会比较MED</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'微软雅黑', sans-serif;">  B．如果路由器上配置了 bgp always-compare-med，在全部的路径进行MED比较。但是这需要全体AS都同时启用这个功能，否则有可能发生路由环路</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'微软雅黑', sans-serif;">  C．如果路由器上配置了bgp bestpath med confed，将对所有包括/.AS_CONFED_SEQUENCE的路径进行MED比较。默认不比较</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'微软雅黑', sans-serif;">  D．如果接收到的路径没有分配MED值，则将此路径分配为0，除非路由器上配置了bgp bestpath med missing-as-worst，将被看作MED值为4，294，967，295的路由将在注入到路由选择表之前被改为4，294，967，294</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'微软雅黑', sans-serif;">  E.   只能在相邻的AS传递，一般在EBGP邻居的OUT方向的做。影响入站的流量。（IBGP之间是可以修改的）</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-size:18px;font-family:'微软雅黑', sans-serif;">  F.   bgp deterministic-med</span><span style="font-family:'微软雅黑', sans-serif;font-size:18px;">是指把路由过来的</span><span style="font-family:'微软雅黑', sans-serif;font-size:18px;">MED</span><span style="font-family:'微软雅黑', sans-serif;font-size:18px;">值进行分组，</span><span style="font-family:'微软雅黑', sans-serif;font-size:18px;">同一个</span><span style="font-family:'微软雅黑', sans-serif;font-size:18px;">AS</span><span style="font-family:'微软雅黑', sans-serif;font-size:18px;">的分一组，</span><span style="font-family:'微软雅黑', sans-serif;font-size:18px;">其他的</span><span style="font-family:'微软雅黑', sans-serif;font-size:18px;">AS</span><span style="font-family:'微软雅黑', sans-serif;font-size:18px;">的分一组</span><span style="font-family:'微软雅黑', sans-serif;font-size:18px;">，</span><span style="font-family:'微软雅黑', sans-serif;font-size:18px;">先比较同一个</span><span style="font-family:'微软雅黑', sans-serif;font-size:18px;">AS</span><span style="font-family:'微软雅黑', sans-serif;font-size:18px;">的</span><span style="font-family:'微软雅黑', sans-serif;font-size:18px;">MED</span><span style="font-family:'微软雅黑', sans-serif;font-size:18px;">值，在和其他</span><span style="font-family:'微软雅黑', sans-serif;font-size:18px;">AS</span><span style="font-family:'微软雅黑', sans-serif;font-size:18px;">的</span><span style="font-family:'微软雅黑', sans-serif;font-size:18px;">MED</span><span style="font-family:'微软雅黑', sans-serif;font-size:18px;">值比较路由器那个最小的</span><span style="font-family:'微软雅黑', sans-serif;font-size:18px;">ROUTE-ID</span></p> 
  <hr> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><strong><span style="font-family:'微软雅黑', 'Microsoft YaHei';color:#FF0000;background:#FFA500;font-size:20px;">七、EBGP &gt; IBGP</span></strong></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-family:'微软雅黑', sans-serif;font-size:18px;">   与EBGP的AD小于IBGP的AD是无关的 </span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-family:'微软雅黑', sans-serif;font-size:18px;">   EBGP&gt;联盟EBGP&gt;IBGP</span></p> 
  <hr> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><strong><span style="font-family:'微软雅黑', 'Microsoft YaHei';color:#FF0000;background:#FFA500;font-size:20px;">八、最近的BGP邻居</span></strong></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-family:'微软雅黑', sans-serif;font-size:18px;">指的去往BGP邻居用的IGP路由的metric值,</span><span style="font-family:'微软雅黑', sans-serif;font-size:18px;">对</span><span style="font-family:'微软雅黑', sans-serif;font-size:18px;">EBGP,IBGP</span><span style="font-family:'微软雅黑', sans-serif;font-size:18px;">邻居都会有效。</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-family:'微软雅黑', sans-serif;font-size:18px;">r3#sh ip b 22.22.22.0</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-family:'微软雅黑', sans-serif;font-size:18px;">BGP routing table entry for 22.22.22.0/24, version 4</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-family:'微软雅黑', sans-serif;font-size:18px;">Paths: (1 available, best #1, table Default-IP-Routing-Table)</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-family:'微软雅黑', sans-serif;font-size:18px;">  Not advertised to any peer</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-family:'微软雅黑', sans-serif;font-size:18px;">  1</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-family:'微软雅黑', sans-serif;font-size:18px;">    1.1.1.1 (metric 1) from 1.1.1.1 (1.1.1.1)</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-family:'微软雅黑', sans-serif;font-size:18px;">      Origin IGP, localpref 100, valid, external, best</span></p> 
  <hr> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><strong><span style="font-family:'微软雅黑', 'Microsoft YaHei';color:#FF0000;background:#FFA500;font-size:20px;">九、配置了maixmum-path [IBGP]，存在多条等价的路径，会负载均衡 </span></strong><span style="font-size:18px;font-family:Simsun, serif;">    </span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-family:'微软雅黑', sans-serif;font-size:18px;">其实这不算选路的原则，是指当前面的八条选不出最优路由时，在BGP 的进程下配置maximum-paths 命令后，会产生负载均衡</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-family:'微软雅黑', sans-serif;font-size:18px;">   r3(config)#router bgp 3</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-family:'微软雅黑', sans-serif;font-size:18px;">   r3(config-router)#maximum-paths ?</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-family:'微软雅黑', sans-serif;font-size:18px;">       &lt;1-6&gt;  Number of paths</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-family:'微软雅黑', sans-serif;font-size:18px;">       ibgp   iBGP-multipath</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-family:'微软雅黑', sans-serif;font-size:18px;">非等价的负载---bgp dmzlink-bw –先进程启用</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-family:'微软雅黑', sans-serif;font-size:18px;">               Neighbor xxxx dmzlink-bw  再针对邻居启用</span></p> 
  <hr> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><strong><span style="font-family:'微软雅黑', 'Microsoft YaHei';color:#FF0000;background:#FFA500;font-size:20px;">十、old最长的EBGP路由，存在时间最长的优先</span></strong></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-family:'微软雅黑', sans-serif;font-size:18px;">bgp bestpath compare-routerid </span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-family:'微软雅黑', sans-serif;font-size:18px;">   这句命令的意思是指，选路是前8条都选不出来时，跳过第十条最老的EBGP邻居</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-family:'微软雅黑', sans-serif;font-size:18px;">   直接选最小的ROUTE-ID</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-family:'微软雅黑', sans-serif;font-size:18px;">   </span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-family:'微软雅黑', sans-serif;font-size:18px;">优选最老的路由(最先被学习到的路由). </span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-family:'微软雅黑', sans-serif;font-size:18px;">  A.此步骤可以将路由摆动的影响减到最小，因为新接收到的路径不会取代老的，即使这条新接收的路径是通过下面提及到的额外路径选择标准来进行选择的。这使得只在iBGP路径下应用额外的选择步骤更有意义。 </span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-family:'微软雅黑', sans-serif;font-size:18px;">  B.此步骤可以被bgp bestpath compare_routerid命令语句所关闭。 </span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-family:'微软雅黑', sans-serif;font-size:18px;">  C.如果路由器标志是一样的，此步骤可以被屏蔽，因为这说明路由器正在从自己那里接收路由。 </span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-family:'微软雅黑', sans-serif;font-size:18px;">  D.如果当前没有最优路由器，此步骤可以被屏蔽。当提供某个路径的对等体路由器宏机，就会发生丢失 </span></p> 
  <hr> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><strong><span style="font-family:'微软雅黑', 'Microsoft YaHei';color:#FF0000;background:#FFA500;font-size:20px;">十一、 lowest router-id</span></strong></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-family:'微软雅黑', sans-serif;font-size:18px;">最小的IBGP邻居route-id</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-family:'微软雅黑', sans-serif;font-size:18px;">在有RR的情况下不比邻居的route-ID,比起原ID 起始者标识将代替route-id在路径选择过程中起作用。</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-family:'微软雅黑', sans-serif;font-size:18px;">将不会用到11条选路原则，会用到12或者13条选路原则。</span></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-family:'微软雅黑', sans-serif;font-size:18px;">一个路由器从多个RR收到相同路由进行最优路径选择时，第11条选路原则用的Router-ID被更改为originator ID（此ID既是在本AS学得路由的第一跳路由器的Router-ID，是RR的一个client），而不是RR的Router-ID，因此如果BGP路由只是从一个ASBR学习到然后传入AS内部，将不会用到11条选路原则，会用到12或者13条选路原则。</span></p> 
  <hr> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><strong><span style="font-family:'微软雅黑', 'Microsoft YaHei';color:#FF0000;background:#FFA500;font-size:20px;">十二、cluster list length</span></strong></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-family:'微软雅黑', sans-serif;font-size:18px;">多条路径的始发路由器ID相同，那么选择 cluster-list短的，</span><span style="font-family:'微软雅黑', sans-serif;font-size:18px;">因为每经过一个</span><span style="font-family:'微软雅黑', sans-serif;font-size:18px;">RR</span><span style="font-family:'微软雅黑', sans-serif;font-size:18px;">，</span><span style="font-family:'微软雅黑', sans-serif;font-size:18px;"> cluster-list</span><span style="font-family:'微软雅黑', sans-serif;font-size:18px;">会加上这个</span><span style="font-family:'微软雅黑', sans-serif;font-size:18px;">RR</span><span style="font-family:'微软雅黑', sans-serif;font-size:18px;">的</span><span style="font-family:'微软雅黑', sans-serif;font-size:18px;"> cluster-id。</span></p> 
  <hr> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><strong><span style="font-family:'微软雅黑', 'Microsoft YaHei';color:#FF0000;background:#FFA500;font-size:20px;">十三、lowest neihbor address</span></strong></p> 
  <p style="font-size:14px;font-family:Calibri, sans-serif;"><span style="font-family:'微软雅黑', sans-serif;font-size:18px;">BGP优选来自于最低的邻居地址的路径，是BGP的neigbor配置中地址。</span></p> 
  <p style="text-align:justify;font-size:14px;font-family:Calibri, sans-serif;"> </p> 
  <p style="font-family:'PingFang SC', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:14px;"><br></p> 
  <p><br></p> 
 </div> 
</div> 
<p>转载于:https://blog.51cto.com/ilctc/2091246</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e526f20fc979f90098e45a5d1934feef/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">简述 TensorFlow 计算模型——计算图</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/18dec83d6f4e180e566899207c191161/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">MySQL请求处理过程</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>