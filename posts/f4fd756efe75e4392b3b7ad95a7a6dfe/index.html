<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>[Python人工智能] 二十二.基于大连理工情感词典的情感分析和情绪计算 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="[Python人工智能] 二十二.基于大连理工情感词典的情感分析和情绪计算" />
<meta property="og:description" content="从本专栏开始，作者正式研究Python深度学习、神经网络及人工智能相关知识。前一篇文章分享了CNN实现中文文本分类的过程，并与贝叶斯、决策树、逻辑回归、随机森林、KNN、SVM等分类算法进行对比。这篇文章将详细讲解通过自定义情感词典（大连理工词典）实现情感分析和情绪分类的过程，并与SnowNLP进行对比，为后续深度学习和自然语言处理（情感分析、实体识别、实体对齐、知识图谱构建、文本挖掘）结合做基础，希望对您有所帮助~
本专栏主要结合作者之前的博客、AI经验和相关视频及论文介绍，后面随着深入会讲解更多的Python人工智能案例及应用。基础性文章，希望对您有所帮助，如果文章中存在错误或不足之处，还请海涵！作者作为人工智能的菜鸟，希望大家能与我在这一笔一划的博客中成长起来。写了这么多年博客，尝试第一个付费专栏，为小宝赚点奶粉钱，但更多博客尤其基础性文章，还是会继续免费分享，该专栏也会用心撰写，望对得起读者。如果有问题随时私聊我，只望您能从这个系列中学到知识，一起加油喔~
TF下载地址：https://github.com/eastmountyxz/AI-for-TensorFlowKeras下载地址：https://github.com/eastmountyxz/AI-for-Keras情感分析地址：https://github.com/eastmountyxz/Sentiment-Analysis PS：本文参考了作者YX学生的学习思路，以及哈工大邓旭东老的方法，再次非常感激，向他们学习。
文章目录 一.大连理工中文情感词典二.七种情绪计算三.七种情绪词云可视化1.基本用法2.统计七种情绪特征词3.词云分析 四.自定义词典情感分析五.SnowNLP情感分析六.总结 同时推荐前面作者另外五个Python系列文章。从2014年开始，作者主要写了三个Python系列文章，分别是基础知识、网络爬虫和数据分析。2018年陆续增加了Python图像识别和Python人工智能专栏。
Python基础知识系列：Python基础知识学习与提升Python网络爬虫系列：Python爬虫之Selenium&#43;BeautifulSoup&#43;RequestsPython数据分析系列：知识图谱、web数据挖掘及NLPPython图像识别系列：Python图像处理及图像识别Python人工智能系列：Python人工智能及知识图谱实战 前文：
[Python人工智能] 一.TensorFlow2.0环境搭建及神经网络入门
[Python人工智能] 二.TensorFlow基础及一元直线预测案例
[Python人工智能] 三.TensorFlow基础之Session、变量、传入值和激励函数
[Python人工智能] 四.TensorFlow创建回归神经网络及Optimizer优化器
[Python人工智能] 五.Tensorboard可视化基本用法及绘制整个神经网络
[Python人工智能] 六.TensorFlow实现分类学习及MNIST手写体识别案例
[Python人工智能] 七.什么是过拟合及dropout解决神经网络中的过拟合问题
[Python人工智能] 八.卷积神经网络CNN原理详解及TensorFlow编写CNN
[Python人工智能] 九.gensim词向量Word2Vec安装及《庆余年》中文短文本相似度计算
[Python人工智能] 十.Tensorflow&#43;Opencv实现CNN自定义图像分类案例及与机器学习KNN图像分类算法对比
[Python人工智能] 十一.Tensorflow如何保存神经网络参数
[Python人工智能] 十二.循环神经网络RNN和LSTM原理详解及TensorFlow编写RNN分类案例
[Python人工智能] 十三.如何评价神经网络、loss曲线图绘制、图像分类案例的F值计算
[Python人工智能] 十四.循环神经网络LSTM RNN回归案例之sin曲线预测
[Python人工智能] 十五.无监督学习Autoencoder原理及聚类可视化案例详解
[Python人工智能] 十六.Keras环境搭建、入门基础及回归神经网络案例
[Python人工智能] 十七.Keras搭建分类神经网络及MNIST数字图像案例分析
[Python人工智能] 十八.Keras搭建卷积神经网络及CNN原理详解
[Python人工智能] 十九.Keras搭建循环神经网络分类案例及RNN原理详解
[Python人工智能] 二十.基于Keras&#43;RNN的文本分类vs基于传统机器学习的文本分类
[Python人工智能] 二十一.Word2Vec&#43;CNN中文文本分类详解及与机器学习（RF\DTC\SVM\KNN\NB\LR）分类对比
《人工智能狂潮》读后感——什么是人工智能？(一)
一.大连理工中文情感词典 情感分析 (Sentiment Analysis)和情绪分类 (Emotion Classification）都是非常重要的文本挖掘手段。情感分析的基本流程如下图所示，通常包括：
自定义爬虫抓取文本信息；使用Jieba工具进行中文分词、词性标注；定义情感词典提取每行文本的情感词；通过情感词构建情感矩阵，并计算情感分数；结果评估，包括将情感分数置于0.5到-0.5之间，并可视化显示。 目前中国研究成熟的词典有大连理工大学情感词汇本体库、知网的 HowNet 情感词典及TW大学中文情感极性词典等。本文选择的基础词典是大连理工大学情感词汇本体库，此词典将情感分为“乐”“好”“怒”“哀”“惧”“恶”“惊”7 个大类和 21 个小类，其情感词的初始情感强度被设置为 1、3、5、7、9 五个等级，较其他词典而言，强度划分得更为细致。情感词的情感极性有中性、褒义、贬义 3 类，分别对应值 0、1、2。为便于计算机作情感计算，文中将代表贬义的极性值2 修改为-1。词汇的情感值公式为：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/f4fd756efe75e4392b3b7ad95a7a6dfe/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-08-09T12:56:04+08:00" />
<meta property="article:modified_time" content="2020-08-09T12:56:04+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">[Python人工智能] 二十二.基于大连理工情感词典的情感分析和情绪计算</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>从本专栏开始，作者正式研究Python深度学习、神经网络及人工智能相关知识。前一篇文章分享了CNN实现中文文本分类的过程，并与贝叶斯、决策树、逻辑回归、随机森林、KNN、SVM等分类算法进行对比。这篇文章将详细讲解通过自定义情感词典（大连理工词典）实现情感分析和情绪分类的过程，并与SnowNLP进行对比，为后续深度学习和自然语言处理（情感分析、实体识别、实体对齐、知识图谱构建、文本挖掘）结合做基础，希望对您有所帮助~</p> 
<p><img src="https://images2.imgbox.com/5e/7c/yZmJSVrt_o.png" alt="在这里插入图片描述" width="500" height="400"></p> 
<p><img src="https://images2.imgbox.com/98/cf/EtNDWp4U_o.png" alt="在这里插入图片描述" width="500" height="400"></p> 
<p>本专栏主要结合作者之前的博客、AI经验和相关视频及论文介绍，后面随着深入会讲解更多的Python人工智能案例及应用。基础性文章，希望对您有所帮助，如果文章中存在错误或不足之处，还请海涵！作者作为人工智能的菜鸟，希望大家能与我在这一笔一划的博客中成长起来。写了这么多年博客，尝试第一个付费专栏，为小宝赚点奶粉钱，但更多博客尤其基础性文章，还是会继续免费分享，该专栏也会用心撰写，望对得起读者。如果有问题随时私聊我，只望您能从这个系列中学到知识，一起加油喔~</p> 
<ul><li>TF下载地址：<a href="https://github.com/eastmountyxz/AI-for-TensorFlow">https://github.com/eastmountyxz/AI-for-TensorFlow</a></li><li>Keras下载地址：<a href="https://github.com/eastmountyxz/AI-for-Keras">https://github.com/eastmountyxz/AI-for-Keras</a></li><li>情感分析地址：<a href="https://github.com/eastmountyxz/Sentiment-Analysis">https://github.com/eastmountyxz/Sentiment-Analysis</a></li></ul> 
<br> 
<p>PS：本文参考了作者YX学生的学习思路，以及哈工大邓旭东老的方法，再次非常感激，向他们学习。</p> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_61" rel="nofollow">一.大连理工中文情感词典</a></li><li><a href="#_104" rel="nofollow">二.七种情绪计算</a></li><li><a href="#_565" rel="nofollow">三.七种情绪词云可视化</a></li><li><ul><li><a href="#1_569" rel="nofollow">1.基本用法</a></li><li><a href="#2_638" rel="nofollow">2.统计七种情绪特征词</a></li><li><a href="#3_844" rel="nofollow">3.词云分析</a></li></ul> 
  </li><li><a href="#_1014" rel="nofollow">四.自定义词典情感分析</a></li><li><a href="#SnowNLP_1342" rel="nofollow">五.SnowNLP情感分析</a></li><li><a href="#_1447" rel="nofollow">六.总结</a></li></ul> 
</div> 
<p></p> 
<p>同时推荐前面作者另外五个Python系列文章。从2014年开始，作者主要写了三个Python系列文章，分别是基础知识、网络爬虫和数据分析。2018年陆续增加了Python图像识别和Python人工智能专栏。</p> 
<ul><li>Python基础知识系列：<a href="https://blog.csdn.net/eastmount/category_2547623.html">Python基础知识学习与提升</a></li><li>Python网络爬虫系列：<a href="https://blog.csdn.net/eastmount/category_9264385.html">Python爬虫之Selenium+BeautifulSoup+Requests</a></li><li>Python数据分析系列：<a href="https://blog.csdn.net/eastmount/category_9265165.html">知识图谱、web数据挖掘及NLP</a></li><li>Python图像识别系列：<a href="https://blog.csdn.net/eastmount/category_9278090.html">Python图像处理及图像识别</a></li><li>Python人工智能系列：<a href="https://blog.csdn.net/eastmount/category_9292178.html">Python人工智能及知识图谱实战</a></li></ul> 
<p><img src="https://images2.imgbox.com/5a/4b/SUFNUlEL_o.png" alt="在这里插入图片描述"></p> 
<p>前文：<br> <a href="https://blog.csdn.net/Eastmount/article/details/103282042">[Python人工智能] 一.TensorFlow2.0环境搭建及神经网络入门</a><br> <a href="https://blog.csdn.net/Eastmount/article/details/103322331">[Python人工智能] 二.TensorFlow基础及一元直线预测案例</a><br> <a href="https://blog.csdn.net/Eastmount/article/details/103336214">[Python人工智能] 三.TensorFlow基础之Session、变量、传入值和激励函数</a><br> <a href="https://blog.csdn.net/Eastmount/article/details/103410289">[Python人工智能] 四.TensorFlow创建回归神经网络及Optimizer优化器</a><br> <a href="https://blog.csdn.net/Eastmount/article/details/103569858">[Python人工智能] 五.Tensorboard可视化基本用法及绘制整个神经网络</a><br> <a href="https://blog.csdn.net/Eastmount/article/details/103586271">[Python人工智能] 六.TensorFlow实现分类学习及MNIST手写体识别案例</a><br> <a href="https://blog.csdn.net/Eastmount/article/details/103595096">[Python人工智能] 七.什么是过拟合及dropout解决神经网络中的过拟合问题</a><br> <a href="https://blog.csdn.net/Eastmount/article/details/103620235">[Python人工智能] 八.卷积神经网络CNN原理详解及TensorFlow编写CNN</a><br> <a href="https://blog.csdn.net/Eastmount/article/details/103647573">[Python人工智能] 九.gensim词向量Word2Vec安装及《庆余年》中文短文本相似度计算</a><br> <a href="https://blog.csdn.net/Eastmount/article/details/103757386">[Python人工智能] 十.Tensorflow+Opencv实现CNN自定义图像分类案例及与机器学习KNN图像分类算法对比</a><br> <a href="https://blog.csdn.net/Eastmount/article/details/103810291">[Python人工智能] 十一.Tensorflow如何保存神经网络参数</a><br> <a href="https://blog.csdn.net/Eastmount/article/details/103811752">[Python人工智能] 十二.循环神经网络RNN和LSTM原理详解及TensorFlow编写RNN分类案例</a><br> <a href="https://blog.csdn.net/Eastmount/article/details/103847406">[Python人工智能] 十三.如何评价神经网络、loss曲线图绘制、图像分类案例的F值计算</a><br> <a href="https://blog.csdn.net/Eastmount/article/details/103914851">[Python人工智能] 十四.循环神经网络LSTM RNN回归案例之sin曲线预测</a><br> <a href="https://blog.csdn.net/Eastmount/article/details/103990297">[Python人工智能] 十五.无监督学习Autoencoder原理及聚类可视化案例详解</a><br> <a href="https://blog.csdn.net/Eastmount/article/details/104313140">[Python人工智能] 十六.Keras环境搭建、入门基础及回归神经网络案例</a><br> <a href="https://blog.csdn.net/Eastmount/article/details/104366166">[Python人工智能] 十七.Keras搭建分类神经网络及MNIST数字图像案例分析</a><br> <a href="https://blog.csdn.net/Eastmount/article/details/104399015">[Python人工智能] 十八.Keras搭建卷积神经网络及CNN原理详解</a><br> <a href="https://blog.csdn.net/Eastmount/article/details/104458677">[Python人工智能] 十九.Keras搭建循环神经网络分类案例及RNN原理详解</a><br> <a href="https://blog.csdn.net/Eastmount/article/details/105165164">[Python人工智能] 二十.基于Keras+RNN的文本分类vs基于传统机器学习的文本分类</a><br> <a href="https://blog.csdn.net/Eastmount/article/details/107004660">[Python人工智能] 二十一.Word2Vec+CNN中文文本分类详解及与机器学习（RF\DTC\SVM\KNN\NB\LR）分类对比</a><br> <a href="https://blog.csdn.net/Eastmount/article/details/104161047">《人工智能狂潮》读后感——什么是人工智能？(一)</a></p> 
<br> 
<hr> 
<h2><a id="_61"></a>一.大连理工中文情感词典</h2> 
<p>情感分析 (Sentiment Analysis)和情绪分类 (Emotion Classification）都是非常重要的文本挖掘手段。情感分析的基本流程如下图所示，通常包括：</p> 
<ul><li>自定义爬虫抓取文本信息；</li><li>使用Jieba工具进行中文分词、词性标注；</li><li>定义情感词典提取每行文本的情感词；</li><li>通过情感词构建情感矩阵，并计算情感分数；</li><li>结果评估，包括将情感分数置于0.5到-0.5之间，并可视化显示。</li></ul> 
<p><img src="https://images2.imgbox.com/4a/9e/83R5lvpH_o.png" alt="在这里插入图片描述" width="400" height="300"></p> 
<p>目前中国研究成熟的词典有大连理工大学情感词汇本体库、知网的 HowNet 情感词典及TW大学中文情感极性词典等。本文选择的基础词典是大连理工大学情感词汇本体库，此词典将情感分为“乐”“好”“怒”“哀”“惧”“恶”“惊”7 个大类和 21 个小类，其情感词的初始情感强度被设置为 1、3、5、7、9 五个等级，较其他词典而言，强度划分得更为细致。情感词的情感极性有中性、褒义、贬义 3 类，分别对应值 0、1、2。为便于计算机作情感计算，文中将代表贬义的极性值2 修改为-1。词汇的情感值公式为：</p> 
<p><img src="https://images2.imgbox.com/fd/e6/kn91quGz_o.png" alt="在这里插入图片描述"></p> 
<p>中文情感词汇本体库是大连理工大学信息检索研究室在 <strong>林鸿飞教授</strong> 的指导下经过全体 教研室成员的努力整理和标注的一个中文本体资源。该资源从不同角度描述一个中文词汇或 者短语，包括词语词性种类、情感类别、情感强度及极性等信息。中文情感词汇本体的情感分类体系是在国外比较有影响的 Ekman 的 6 大类情感分类体 系的基础上构建的。在 Ekman 的基础上，词汇本体加入情感类别“好”对褒义情感进行了 更细致的划分。最终词汇本体中的情感共分为 7 大类 21 小类。</p> 
<p>构造该资源的宗旨是在情感计算领域，为中文文本情感分析和倾向性分析提供一个便捷 可靠的辅助手段。中文情感词汇本体可以用于解决多类别情感分类的问题，同时也可以用于 解决一般的倾向性分析的问题。如下图所示，该词典共包括27466个词语，包含词语、词性种类、词义数、词义序号、情感分类、强度、极性、辅助情感分类、强度和极性。</p> 
<p><img src="https://images2.imgbox.com/cf/17/S40ylIHn_o.png" alt="在这里插入图片描述" width="600" height="350"></p> 
<p>注意，在情感词典中，一个情感词可能对应多个情感，情感分类用于刻画情感词的主要情感分类，辅助情感为该情感词在具有主要情感分类的同时含有的其他情感分类。</p> 
<p><img src="https://images2.imgbox.com/d1/1e/iCMDAwDb_o.png" alt="在这里插入图片描述" width="650" height="200"></p> 
<p>情感分类按照论文《情感词汇本体的构造》所述，情感分为 7 大类 21 小类。情感强度分为 1、3、5、7、9 五档，9 表示强度最大，1 为强度最小。情感分类如下表所示：</p> 
<p><img src="https://images2.imgbox.com/14/00/k4QjzdJt_o.png" alt="在这里插入图片描述" width="550" height="500"></p> 
<p>情感词汇本体中的词性种类一共分为 7 类，分别是名词（noun）、动词（verb）、形容词 （adj）、副词（adv）、网络词语（nw）、成语（idiom）、介词短语（prep）。同时，每个词在每一类情感下都对应了一个极性。其中，0代表中性，1代表褒义，2代表贬 义，3代表兼有褒贬两性。最后给出否定词和程序副词，否定词会将情感强度乘以-1，程度副词代表不同级别的情感倾向。</p> 
<p><img src="https://images2.imgbox.com/f4/3b/uANTJoma_o.png" alt="在这里插入图片描述" width="500" height="200"></p> 
<p><img src="https://images2.imgbox.com/2d/63/FiA5Dnfm_o.png" alt="在这里插入图片描述" width="500" height="400"></p> 
<br> 
<hr> 
<h2><a id="_104"></a>二.七种情绪计算</h2> 
<p>首先，我们的数据集如下图所示，是《庆余年》电视剧的评论，共计220条。</p> 
<p><img src="https://images2.imgbox.com/1b/ec/4zKB8ZSH_o.png" alt="在这里插入图片描述" width="600" height="320"></p> 
<p><strong>第一步，调用Pandas读取数据。</strong></p> 
<pre><code class="prism language-python"><span class="token comment"># coding: utf-8</span>
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd

<span class="token comment">#获取数据集</span>
f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'庆余年220.csv'</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'utf8'</span><span class="token punctuation">)</span>
weibo_df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>weibo_df<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>输出结果如下图所示：</p> 
<p><img src="https://images2.imgbox.com/89/df/AU19LpeV_o.png" alt="在这里插入图片描述" width="650" height="140"></p> 
<br> 
<p><strong>第二步，导入大连理工大学中文情感词典。</strong></p> 
<pre><code class="prism language-python"><span class="token comment"># coding: utf-8</span>
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd

<span class="token comment">#-------------------------------------获取数据集---------------------------------</span>
f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'庆余年220.csv'</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'utf8'</span><span class="token punctuation">)</span>
weibo_df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>weibo_df<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">#-------------------------------------情感词典读取-------------------------------</span>
<span class="token comment">#注意：</span>
<span class="token comment">#1.词典中怒的标记(NA)识别不出被当作空值,情感分类列中的NA都给替换成NAU</span>
<span class="token comment">#2.大连理工词典中有情感分类的辅助标注(有NA),故把情感分类列改好再替换原词典中</span>

<span class="token comment"># 扩展前的词典</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span><span class="token string">'大连理工大学中文情感词汇本体NAU.xlsx'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

df <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'词语'</span><span class="token punctuation">,</span> <span class="token string">'词性种类'</span><span class="token punctuation">,</span> <span class="token string">'词义数'</span><span class="token punctuation">,</span> <span class="token string">'词义序号'</span><span class="token punctuation">,</span> <span class="token string">'情感分类'</span><span class="token punctuation">,</span> <span class="token string">'强度'</span><span class="token punctuation">,</span> <span class="token string">'极性'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
df<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>下图展示了我们导入的词典。</p> 
<p><img src="https://images2.imgbox.com/55/b9/eAT6yzLE_o.png" alt="在这里插入图片描述" width="650" height="200"></p> 
<br> 
<p><strong>第三步，统计七种情绪分布情况。</strong></p> 
<pre><code class="prism language-python"><span class="token comment"># coding: utf-8</span>
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd

<span class="token comment">#-------------------------------------获取数据集---------------------------------</span>
f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'庆余年220.csv'</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'utf8'</span><span class="token punctuation">)</span>
weibo_df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>weibo_df<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">#-------------------------------------情感词典读取-------------------------------</span>
<span class="token comment">#注意：</span>
<span class="token comment">#1.词典中怒的标记(NA)识别不出被当作空值,情感分类列中的NA都给替换成NAU</span>
<span class="token comment">#2.大连理工词典中有情感分类的辅助标注(有NA),故把情感分类列改好再替换原词典中</span>

<span class="token comment"># 扩展前的词典</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span><span class="token string">'大连理工大学中文情感词汇本体NAU.xlsx'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

df <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'词语'</span><span class="token punctuation">,</span> <span class="token string">'词性种类'</span><span class="token punctuation">,</span> <span class="token string">'词义数'</span><span class="token punctuation">,</span> <span class="token string">'词义序号'</span><span class="token punctuation">,</span> <span class="token string">'情感分类'</span><span class="token punctuation">,</span> <span class="token string">'强度'</span><span class="token punctuation">,</span> <span class="token string">'极性'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
df<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">#-------------------------------------七种情绪的运用-------------------------------</span>
Happy <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
Good <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
Surprise <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
Anger <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
Sad <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
Fear <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
Disgust <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token comment">#df.iterrows()功能是迭代遍历每一行</span>
<span class="token keyword">for</span> idx<span class="token punctuation">,</span> row <span class="token keyword">in</span> df<span class="token punctuation">.</span>iterrows<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> row<span class="token punctuation">[</span><span class="token string">'情感分类'</span><span class="token punctuation">]</span> <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'PA'</span><span class="token punctuation">,</span> <span class="token string">'PE'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        Happy<span class="token punctuation">.</span>append<span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">'词语'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> row<span class="token punctuation">[</span><span class="token string">'情感分类'</span><span class="token punctuation">]</span> <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'PD'</span><span class="token punctuation">,</span> <span class="token string">'PH'</span><span class="token punctuation">,</span> <span class="token string">'PG'</span><span class="token punctuation">,</span> <span class="token string">'PB'</span><span class="token punctuation">,</span> <span class="token string">'PK'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        Good<span class="token punctuation">.</span>append<span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">'词语'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 
    <span class="token keyword">if</span> row<span class="token punctuation">[</span><span class="token string">'情感分类'</span><span class="token punctuation">]</span> <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'PC'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        Surprise<span class="token punctuation">.</span>append<span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">'词语'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>       
    <span class="token keyword">if</span> row<span class="token punctuation">[</span><span class="token string">'情感分类'</span><span class="token punctuation">]</span> <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'NB'</span><span class="token punctuation">,</span> <span class="token string">'NJ'</span><span class="token punctuation">,</span> <span class="token string">'NH'</span><span class="token punctuation">,</span> <span class="token string">'PF'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        Sad<span class="token punctuation">.</span>append<span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">'词语'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> row<span class="token punctuation">[</span><span class="token string">'情感分类'</span><span class="token punctuation">]</span> <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'NI'</span><span class="token punctuation">,</span> <span class="token string">'NC'</span><span class="token punctuation">,</span> <span class="token string">'NG'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        Fear<span class="token punctuation">.</span>append<span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">'词语'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> row<span class="token punctuation">[</span><span class="token string">'情感分类'</span><span class="token punctuation">]</span> <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'NE'</span><span class="token punctuation">,</span> <span class="token string">'ND'</span><span class="token punctuation">,</span> <span class="token string">'NN'</span><span class="token punctuation">,</span> <span class="token string">'NK'</span><span class="token punctuation">,</span> <span class="token string">'NL'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        Disgust<span class="token punctuation">.</span>append<span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">'词语'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> row<span class="token punctuation">[</span><span class="token string">'情感分类'</span><span class="token punctuation">]</span> <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'NAU'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>     <span class="token comment">#修改: 原NA算出来没结果</span>
        Anger<span class="token punctuation">.</span>append<span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">'词语'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  

<span class="token comment">#正负计算不是很准 自己可以制定规则       </span>
Positive <span class="token operator">=</span> Happy <span class="token operator">+</span> Good <span class="token operator">+</span> Surprise
Negative <span class="token operator">=</span> Anger <span class="token operator">+</span> Sad <span class="token operator">+</span> Fear <span class="token operator">+</span> Disgust
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'情绪词语列表整理完成'</span><span class="token punctuation">)</span>  
<span class="token keyword">print</span><span class="token punctuation">(</span>Anger<span class="token punctuation">)</span>
</code></pre> 
<p>比如输出Anger生气的情绪词语，如下图所示。</p> 
<p><img src="https://images2.imgbox.com/f9/a7/S05VOyTZ_o.png" alt="在这里插入图片描述" width="550" height="400"></p> 
<p>用Spyder集成环境打开可以看到情感特征词的具体分布情况。</p> 
<p><img src="https://images2.imgbox.com/89/3c/OHlsUZGZ_o.png" alt="在这里插入图片描述" width="600" height="300"></p> 
<br> 
<p><strong>第四步，增加中文分词和自定义停用词典的代码。</strong></p> 
<pre><code class="prism language-python"><span class="token comment">#---------------------------------------中文分词---------------------------------</span>
<span class="token keyword">import</span> jieba
<span class="token keyword">import</span> time

<span class="token comment">#添加使用者词典和停用词</span>
jieba<span class="token punctuation">.</span>load_userdict<span class="token punctuation">(</span><span class="token string">"user_dict.txt"</span><span class="token punctuation">)</span>              <span class="token comment">#自定义词典</span>
stop_list <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'stop_words.txt'</span><span class="token punctuation">,</span>
                        engine<span class="token operator">=</span><span class="token string">'python'</span><span class="token punctuation">,</span>
                        encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">,</span>
                        delimiter<span class="token operator">=</span><span class="token string">"\n"</span><span class="token punctuation">,</span>
                        names<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'t'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'t'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">txt_cut</span><span class="token punctuation">(</span>juzi<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>w <span class="token keyword">for</span> w <span class="token keyword">in</span> jieba<span class="token punctuation">.</span>lcut<span class="token punctuation">(</span>juzi<span class="token punctuation">)</span> <span class="token keyword">if</span> w <span class="token operator">not</span> <span class="token keyword">in</span> stop_list<span class="token punctuation">]</span>     <span class="token comment">#可增加len(w)&gt;1</span>
</code></pre> 
<p>部分停用词如下所示，它们没有意义，对情感也没有影响，所以需要进行过滤。</p> 
<p><img src="https://images2.imgbox.com/fc/b2/BLL5Q7ke_o.png" alt="在这里插入图片描述" width="350" height="380"></p> 
<br> 
<p><strong>第五步，计算七种情绪特征词的出现频率。</strong><br> 情绪包括anger、disgust、fear、sadness、surprise、good、happy。</p> 
<pre><code class="prism language-python"><span class="token comment">#---------------------------------------中文分词---------------------------------</span>
<span class="token keyword">import</span> jieba
<span class="token keyword">import</span> time

<span class="token comment">#添加自定义词典和停用词</span>
<span class="token comment">#jieba.load_userdict("user_dict.txt")</span>
stop_list <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'stop_words.txt'</span><span class="token punctuation">,</span>
                        engine<span class="token operator">=</span><span class="token string">'python'</span><span class="token punctuation">,</span>
                        encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">,</span>
                        delimiter<span class="token operator">=</span><span class="token string">"\n"</span><span class="token punctuation">,</span>
                        names<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'t'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">#获取重命名t列的值</span>
stop_list <span class="token operator">=</span> stop_list<span class="token punctuation">[</span><span class="token string">'t'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">txt_cut</span><span class="token punctuation">(</span>juzi<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>w <span class="token keyword">for</span> w <span class="token keyword">in</span> jieba<span class="token punctuation">.</span>lcut<span class="token punctuation">(</span>juzi<span class="token punctuation">)</span> <span class="token keyword">if</span> w <span class="token operator">not</span> <span class="token keyword">in</span> stop_list<span class="token punctuation">]</span>     <span class="token comment">#可增加len(w)&gt;1</span>

<span class="token comment">#---------------------------------------情感计算---------------------------------</span>
<span class="token keyword">def</span> <span class="token function">emotion_caculate</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>
    positive <span class="token operator">=</span> <span class="token number">0</span>
    negative <span class="token operator">=</span> <span class="token number">0</span>
    anger <span class="token operator">=</span> <span class="token number">0</span>
    disgust <span class="token operator">=</span> <span class="token number">0</span>
    fear <span class="token operator">=</span> <span class="token number">0</span>
    sad <span class="token operator">=</span> <span class="token number">0</span>
    surprise <span class="token operator">=</span> <span class="token number">0</span>
    good <span class="token operator">=</span> <span class="token number">0</span>
    happy <span class="token operator">=</span> <span class="token number">0</span>
    
    wordlist <span class="token operator">=</span> txt_cut<span class="token punctuation">(</span>text<span class="token punctuation">)</span>
    <span class="token comment">#wordlist = jieba.lcut(text)</span>
    wordset <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span>wordlist<span class="token punctuation">)</span>
    wordfreq <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> word <span class="token keyword">in</span> wordset<span class="token punctuation">:</span>
        freq <span class="token operator">=</span> wordlist<span class="token punctuation">.</span>count<span class="token punctuation">(</span>word<span class="token punctuation">)</span>
        <span class="token keyword">if</span> word <span class="token keyword">in</span> Positive<span class="token punctuation">:</span>
            positive<span class="token operator">+=</span>freq
        <span class="token keyword">if</span> word <span class="token keyword">in</span> Negative<span class="token punctuation">:</span>
            negative<span class="token operator">+=</span>freq
        <span class="token keyword">if</span> word <span class="token keyword">in</span> Anger<span class="token punctuation">:</span>
            anger<span class="token operator">+=</span>freq  
        <span class="token keyword">if</span> word <span class="token keyword">in</span> Disgust<span class="token punctuation">:</span>
            disgust<span class="token operator">+=</span>freq
        <span class="token keyword">if</span> word <span class="token keyword">in</span> Fear<span class="token punctuation">:</span>
            fear<span class="token operator">+=</span>freq
        <span class="token keyword">if</span> word <span class="token keyword">in</span> Sad<span class="token punctuation">:</span>
            sad<span class="token operator">+=</span>freq
        <span class="token keyword">if</span> word <span class="token keyword">in</span> Surprise<span class="token punctuation">:</span>
            surprise<span class="token operator">+=</span>freq
        <span class="token keyword">if</span> word <span class="token keyword">in</span> Good<span class="token punctuation">:</span>
            good<span class="token operator">+=</span>freq
        <span class="token keyword">if</span> word <span class="token keyword">in</span> Happy<span class="token punctuation">:</span>
            happy<span class="token operator">+=</span>freq
            
    emotion_info <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">'length'</span><span class="token punctuation">:</span><span class="token builtin">len</span><span class="token punctuation">(</span>wordlist<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">'positive'</span><span class="token punctuation">:</span> positive<span class="token punctuation">,</span>
        <span class="token string">'negative'</span><span class="token punctuation">:</span> negative<span class="token punctuation">,</span>
        <span class="token string">'anger'</span><span class="token punctuation">:</span> anger<span class="token punctuation">,</span>
        <span class="token string">'disgust'</span><span class="token punctuation">:</span> disgust<span class="token punctuation">,</span>
        <span class="token string">'fear'</span><span class="token punctuation">:</span>fear<span class="token punctuation">,</span>
        <span class="token string">'good'</span><span class="token punctuation">:</span>good<span class="token punctuation">,</span>
        <span class="token string">'sadness'</span><span class="token punctuation">:</span>sad<span class="token punctuation">,</span>
        <span class="token string">'surprise'</span><span class="token punctuation">:</span>surprise<span class="token punctuation">,</span>
        <span class="token string">'happy'</span><span class="token punctuation">:</span>happy<span class="token punctuation">,</span>
        
    <span class="token punctuation">}</span>

    indexs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'length'</span><span class="token punctuation">,</span> <span class="token string">'positive'</span><span class="token punctuation">,</span> <span class="token string">'negative'</span><span class="token punctuation">,</span> <span class="token string">'anger'</span><span class="token punctuation">,</span> <span class="token string">'disgust'</span><span class="token punctuation">,</span><span class="token string">'fear'</span><span class="token punctuation">,</span><span class="token string">'sadness'</span><span class="token punctuation">,</span><span class="token string">'surprise'</span><span class="token punctuation">,</span> <span class="token string">'good'</span><span class="token punctuation">,</span> <span class="token string">'happy'</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span>emotion_info<span class="token punctuation">,</span> index<span class="token operator">=</span>indexs<span class="token punctuation">)</span>

<span class="token comment">#测试</span>
text<span class="token operator">=</span><span class="token triple-quoted-string string">"""
原著的确更吸引编剧读下去，所以跟《诛仙》系列明显感觉到编剧只看过故事大纲比，这个剧的编剧完整阅读过小说。
配乐活泼俏皮，除了强硬穿越的台词轻微尴尬，最应该尴尬的感情戏反而入戏，
故意模糊了陈萍萍的太监身份、太子跟长公主的暧昧关系，
整体观影感受极好，很期待第二季拍大东山之役。玩弄人心的阴谋阳谋都不狗血，架空的设定能摆脱历史背景，
服装道具能有更自由的发挥空间，特别喜欢庆帝的闺房。以后还是少看国产剧，太长了，
还是精短美剧更适合休闲，追这个太累。王启年真是太可爱了。
"""</span>
res <span class="token operator">=</span> emotion_caculate<span class="token punctuation">(</span>text<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
</code></pre> 
<p>统计结果为disgust特征词6个，good特征词6个，开心特征词1个。</p> 
<pre><code class="prism language-python">length      <span class="token number">83</span>
positive     <span class="token number">7</span>
negative     <span class="token number">6</span>
anger        <span class="token number">0</span>
disgust      <span class="token number">6</span>
fear         <span class="token number">0</span>
sadness      <span class="token number">0</span>
surprise     <span class="token number">0</span>
good         <span class="token number">6</span>
happy        <span class="token number">1</span>
dtype<span class="token punctuation">:</span> int64
</code></pre> 
<p>进一步提取特征词，我们可以看到刚才那个句子的特征词如下所示（详见后续完整代码）。其中，disgust（恶）包括“阴谋”、“玩弄”等词语，good（好）包括“极好”、“喜欢”等词语，happy（乐）包括“摆脱”词语。</p> 
<p><img src="https://images2.imgbox.com/e0/9f/ZKff3HbL_o.png" alt="在这里插入图片描述" width="600" height="300"></p> 
<br> 
<p><strong>第六步，计算《庆余年》自定义数据集的七种情绪分布情况。</strong></p> 
<pre><code class="prism language-python"><span class="token comment"># coding: utf-8</span>
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> jieba
<span class="token keyword">import</span> time

<span class="token comment">#-------------------------------------获取数据集---------------------------------</span>
f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'庆余年220.csv'</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'utf8'</span><span class="token punctuation">)</span>
weibo_df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>weibo_df<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">#-------------------------------------情感词典读取-------------------------------</span>
<span class="token comment">#注意：</span>
<span class="token comment">#1.词典中怒的标记(NA)识别不出被当作空值,情感分类列中的NA都给替换成NAU</span>
<span class="token comment">#2.大连理工词典中有情感分类的辅助标注(有NA),故把情感分类列改好再替换原词典中</span>

<span class="token comment"># 扩展前的词典</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span><span class="token string">'大连理工大学中文情感词汇本体NAU.xlsx'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

df <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'词语'</span><span class="token punctuation">,</span> <span class="token string">'词性种类'</span><span class="token punctuation">,</span> <span class="token string">'词义数'</span><span class="token punctuation">,</span> <span class="token string">'词义序号'</span><span class="token punctuation">,</span> <span class="token string">'情感分类'</span><span class="token punctuation">,</span> <span class="token string">'强度'</span><span class="token punctuation">,</span> <span class="token string">'极性'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
df<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">#-------------------------------------七种情绪的运用-------------------------------</span>
Happy <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
Good <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
Surprise <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
Anger <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
Sad <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
Fear <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
Disgust <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token comment">#df.iterrows()功能是迭代遍历每一行</span>
<span class="token keyword">for</span> idx<span class="token punctuation">,</span> row <span class="token keyword">in</span> df<span class="token punctuation">.</span>iterrows<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> row<span class="token punctuation">[</span><span class="token string">'情感分类'</span><span class="token punctuation">]</span> <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'PA'</span><span class="token punctuation">,</span> <span class="token string">'PE'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        Happy<span class="token punctuation">.</span>append<span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">'词语'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> row<span class="token punctuation">[</span><span class="token string">'情感分类'</span><span class="token punctuation">]</span> <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'PD'</span><span class="token punctuation">,</span> <span class="token string">'PH'</span><span class="token punctuation">,</span> <span class="token string">'PG'</span><span class="token punctuation">,</span> <span class="token string">'PB'</span><span class="token punctuation">,</span> <span class="token string">'PK'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        Good<span class="token punctuation">.</span>append<span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">'词语'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 
    <span class="token keyword">if</span> row<span class="token punctuation">[</span><span class="token string">'情感分类'</span><span class="token punctuation">]</span> <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'PC'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        Surprise<span class="token punctuation">.</span>append<span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">'词语'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>       
    <span class="token keyword">if</span> row<span class="token punctuation">[</span><span class="token string">'情感分类'</span><span class="token punctuation">]</span> <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'NB'</span><span class="token punctuation">,</span> <span class="token string">'NJ'</span><span class="token punctuation">,</span> <span class="token string">'NH'</span><span class="token punctuation">,</span> <span class="token string">'PF'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        Sad<span class="token punctuation">.</span>append<span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">'词语'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> row<span class="token punctuation">[</span><span class="token string">'情感分类'</span><span class="token punctuation">]</span> <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'NI'</span><span class="token punctuation">,</span> <span class="token string">'NC'</span><span class="token punctuation">,</span> <span class="token string">'NG'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        Fear<span class="token punctuation">.</span>append<span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">'词语'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> row<span class="token punctuation">[</span><span class="token string">'情感分类'</span><span class="token punctuation">]</span> <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'NE'</span><span class="token punctuation">,</span> <span class="token string">'ND'</span><span class="token punctuation">,</span> <span class="token string">'NN'</span><span class="token punctuation">,</span> <span class="token string">'NK'</span><span class="token punctuation">,</span> <span class="token string">'NL'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        Disgust<span class="token punctuation">.</span>append<span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">'词语'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> row<span class="token punctuation">[</span><span class="token string">'情感分类'</span><span class="token punctuation">]</span> <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'NAU'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>     <span class="token comment">#修改: 原NA算出来没结果</span>
        Anger<span class="token punctuation">.</span>append<span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">'词语'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  

<span class="token comment">#正负计算不是很准 自己可以制定规则       </span>
Positive <span class="token operator">=</span> Happy <span class="token operator">+</span> Good <span class="token operator">+</span> Surprise
Negative <span class="token operator">=</span> Anger <span class="token operator">+</span> Sad <span class="token operator">+</span> Fear <span class="token operator">+</span> Disgust
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'情绪词语列表整理完成'</span><span class="token punctuation">)</span>  
<span class="token keyword">print</span><span class="token punctuation">(</span>Anger<span class="token punctuation">)</span>

<span class="token comment">#---------------------------------------中文分词---------------------------------</span>

<span class="token comment">#添加自定义词典和停用词</span>
<span class="token comment">#jieba.load_userdict("user_dict.txt")</span>
stop_list <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'stop_words.txt'</span><span class="token punctuation">,</span>
                        engine<span class="token operator">=</span><span class="token string">'python'</span><span class="token punctuation">,</span>
                        encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">,</span>
                        delimiter<span class="token operator">=</span><span class="token string">"\n"</span><span class="token punctuation">,</span>
                        names<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'t'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">#获取重命名t列的值</span>
stop_list <span class="token operator">=</span> stop_list<span class="token punctuation">[</span><span class="token string">'t'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">txt_cut</span><span class="token punctuation">(</span>juzi<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>w <span class="token keyword">for</span> w <span class="token keyword">in</span> jieba<span class="token punctuation">.</span>lcut<span class="token punctuation">(</span>juzi<span class="token punctuation">)</span> <span class="token keyword">if</span> w <span class="token operator">not</span> <span class="token keyword">in</span> stop_list<span class="token punctuation">]</span>     <span class="token comment">#可增加len(w)&gt;1</span>

<span class="token comment">#---------------------------------------情感计算---------------------------------</span>
<span class="token keyword">def</span> <span class="token function">emotion_caculate</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>
    positive <span class="token operator">=</span> <span class="token number">0</span>
    negative <span class="token operator">=</span> <span class="token number">0</span>
    
    anger <span class="token operator">=</span> <span class="token number">0</span>
    disgust <span class="token operator">=</span> <span class="token number">0</span>
    fear <span class="token operator">=</span> <span class="token number">0</span>
    sad <span class="token operator">=</span> <span class="token number">0</span>
    surprise <span class="token operator">=</span> <span class="token number">0</span>
    good <span class="token operator">=</span> <span class="token number">0</span>
    happy <span class="token operator">=</span> <span class="token number">0</span>

    anger_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    disgust_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    fear_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    sad_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    surprise_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    good_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    happy_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    
    wordlist <span class="token operator">=</span> txt_cut<span class="token punctuation">(</span>text<span class="token punctuation">)</span>
    <span class="token comment">#wordlist = jieba.lcut(text)</span>
    wordset <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span>wordlist<span class="token punctuation">)</span>
    wordfreq <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> word <span class="token keyword">in</span> wordset<span class="token punctuation">:</span>
        freq <span class="token operator">=</span> wordlist<span class="token punctuation">.</span>count<span class="token punctuation">(</span>word<span class="token punctuation">)</span>
        <span class="token keyword">if</span> word <span class="token keyword">in</span> Positive<span class="token punctuation">:</span>
            positive<span class="token operator">+=</span>freq
        <span class="token keyword">if</span> word <span class="token keyword">in</span> Negative<span class="token punctuation">:</span>
            negative<span class="token operator">+=</span>freq
        <span class="token keyword">if</span> word <span class="token keyword">in</span> Anger<span class="token punctuation">:</span>
            anger<span class="token operator">+=</span>freq
            anger_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>word<span class="token punctuation">)</span>
        <span class="token keyword">if</span> word <span class="token keyword">in</span> Disgust<span class="token punctuation">:</span>
            disgust<span class="token operator">+=</span>freq
            disgust_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>word<span class="token punctuation">)</span>
        <span class="token keyword">if</span> word <span class="token keyword">in</span> Fear<span class="token punctuation">:</span>
            fear<span class="token operator">+=</span>freq
            fear_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>word<span class="token punctuation">)</span>
        <span class="token keyword">if</span> word <span class="token keyword">in</span> Sad<span class="token punctuation">:</span>
            sad<span class="token operator">+=</span>freq
            sad_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>word<span class="token punctuation">)</span>
        <span class="token keyword">if</span> word <span class="token keyword">in</span> Surprise<span class="token punctuation">:</span>
            surprise<span class="token operator">+=</span>freq
            surprise_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>word<span class="token punctuation">)</span>
        <span class="token keyword">if</span> word <span class="token keyword">in</span> Good<span class="token punctuation">:</span>
            good<span class="token operator">+=</span>freq
            good_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>word<span class="token punctuation">)</span>
        <span class="token keyword">if</span> word <span class="token keyword">in</span> Happy<span class="token punctuation">:</span>
            happy<span class="token operator">+=</span>freq
            happy_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>word<span class="token punctuation">)</span>
            
    emotion_info <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">'length'</span><span class="token punctuation">:</span><span class="token builtin">len</span><span class="token punctuation">(</span>wordlist<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">'positive'</span><span class="token punctuation">:</span> positive<span class="token punctuation">,</span>
        <span class="token string">'negative'</span><span class="token punctuation">:</span> negative<span class="token punctuation">,</span>
        <span class="token string">'anger'</span><span class="token punctuation">:</span> anger<span class="token punctuation">,</span>
        <span class="token string">'disgust'</span><span class="token punctuation">:</span> disgust<span class="token punctuation">,</span>
        <span class="token string">'fear'</span><span class="token punctuation">:</span>fear<span class="token punctuation">,</span>
        <span class="token string">'good'</span><span class="token punctuation">:</span>good<span class="token punctuation">,</span>
        <span class="token string">'sadness'</span><span class="token punctuation">:</span>sad<span class="token punctuation">,</span>
        <span class="token string">'surprise'</span><span class="token punctuation">:</span>surprise<span class="token punctuation">,</span>
        <span class="token string">'happy'</span><span class="token punctuation">:</span>happy<span class="token punctuation">,</span>
        
    <span class="token punctuation">}</span>

    indexs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'length'</span><span class="token punctuation">,</span> <span class="token string">'positive'</span><span class="token punctuation">,</span> <span class="token string">'negative'</span><span class="token punctuation">,</span> <span class="token string">'anger'</span><span class="token punctuation">,</span> <span class="token string">'disgust'</span><span class="token punctuation">,</span><span class="token string">'fear'</span><span class="token punctuation">,</span><span class="token string">'sadness'</span><span class="token punctuation">,</span><span class="token string">'surprise'</span><span class="token punctuation">,</span> <span class="token string">'good'</span><span class="token punctuation">,</span> <span class="token string">'happy'</span><span class="token punctuation">]</span>
    <span class="token comment">#return pd.Series(emotion_info, index=indexs), anger_list, disgust_list, fear_list, sad_list, surprise_list, good_list, happy_list</span>
    <span class="token keyword">return</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span>emotion_info<span class="token punctuation">,</span> index<span class="token operator">=</span>indexs<span class="token punctuation">)</span>

<span class="token comment">#测试 (res, anger_list, disgust_list, fear_list, sad_list, surprise_list, good_list, happy_list)</span>
text <span class="token operator">=</span> <span class="token triple-quoted-string string">"""
原著的确更吸引编剧读下去，所以跟《诛仙》系列明显感觉到编剧只看过故事大纲比，这个剧的编剧完整阅读过小说。
配乐活泼俏皮，除了强硬穿越的台词轻微尴尬，最应该尴尬的感情戏反而入戏，
故意模糊了陈萍萍的太监身份、太子跟长公主的暧昧关系，
整体观影感受极好，很期待第二季拍大东山之役。玩弄人心的阴谋阳谋都不狗血，
架空的设定能摆脱历史背景，服装道具能有更自由的发挥空间，
特别喜欢庆帝的闺房。以后还是少看国产剧，太长了，还是精短美剧更适合休闲，追这个太累。王启年真是太可爱了。
"""</span>
<span class="token comment">#res, anger, disgust, fear, sad, surprise, good, happy = emotion_caculate(text)</span>
res <span class="token operator">=</span> emotion_caculate<span class="token punctuation">(</span>text<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>

<span class="token comment">#---------------------------------------情感计算---------------------------------</span>
start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>   
emotion_df <span class="token operator">=</span> weibo_df<span class="token punctuation">[</span><span class="token string">'review'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>emotion_caculate<span class="token punctuation">)</span>
end <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>end<span class="token operator">-</span>start<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>emotion_df<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">#输出结果</span>
output_df <span class="token operator">=</span> pd<span class="token punctuation">.</span>concat<span class="token punctuation">(</span><span class="token punctuation">[</span>weibo_df<span class="token punctuation">,</span> emotion_df<span class="token punctuation">]</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
output_df<span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span><span class="token string">'庆余年220_emotion.csv'</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'utf_8_sig'</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>output_df<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>输出结果如下图所示：</p> 
<p><img src="https://images2.imgbox.com/39/2c/B6pW5Vle_o.png" alt="在这里插入图片描述" width="600" height="400"></p> 
<p>对应的矩阵数据如下图所示：</p> 
<p><img src="https://images2.imgbox.com/18/fa/duiag9QC_o.png" alt="在这里插入图片描述" width="650" height="300"></p> 
<br> 
<p><strong>第七步，如果我们想获取某种情绪的结果，则可以通过下面的代码实现。</strong></p> 
<pre><code class="prism language-python"><span class="token comment">#显示fear、negative数据集</span>
fear_content <span class="token operator">=</span> output_df<span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span>by<span class="token operator">=</span><span class="token string">'fear'</span><span class="token punctuation">,</span>ascending<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>fear_content<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>fear_content<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'review'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

negative_content <span class="token operator">=</span> output_df<span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span>by<span class="token operator">=</span><span class="token string">'negative'</span><span class="token punctuation">,</span>ascending<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>negative_content<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>negative_content<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'review'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p>输出结果如下图所示：</p> 
<p><img src="https://images2.imgbox.com/d6/ad/8Plaf45R_o.png" alt="在这里插入图片描述" width="600" height="480"></p> 
<br> 
<hr> 
<h2><a id="_565"></a>三.七种情绪词云可视化</h2> 
<p>当我们获取了某个语料的情绪特征词之后，通常还会和词云结合起来进行可视化分析。首先，简单给出一个词云可视化的代码，接着结合该案例来进行分析。</p> 
<h3><a id="1_569"></a>1.基本用法</h3> 
<p>词云分析主要包括两种方法：</p> 
<ul><li>调用WordCloud扩展包画图（兼容性极强，之前介绍过）</li><li>调用PyEcharts中的WordCloud子包画图（本文推荐新方法）</li></ul> 
<p>PyEcharts绘制词云的基础代码如下：</p> 
<pre><code class="prism language-python"><span class="token comment"># coding=utf-8</span>
<span class="token keyword">from</span> pyecharts <span class="token keyword">import</span> options <span class="token keyword">as</span> opts
<span class="token keyword">from</span> pyecharts<span class="token punctuation">.</span>charts <span class="token keyword">import</span> WordCloud
<span class="token keyword">from</span> pyecharts<span class="token punctuation">.</span><span class="token builtin">globals</span> <span class="token keyword">import</span> SymbolType

<span class="token comment"># 数据</span>
words <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">(</span><span class="token string">'背包问题'</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">'大整数'</span><span class="token punctuation">,</span> <span class="token number">6181</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">'Karatsuba乘法算法'</span><span class="token punctuation">,</span> <span class="token number">4386</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">'穷举搜索'</span><span class="token punctuation">,</span> <span class="token number">4055</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">'傅里叶变换'</span><span class="token punctuation">,</span> <span class="token number">2467</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">'状态树遍历'</span><span class="token punctuation">,</span> <span class="token number">2244</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">'剪枝'</span><span class="token punctuation">,</span> <span class="token number">1868</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">'Gale-shapley'</span><span class="token punctuation">,</span> <span class="token number">1484</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">'最大匹配与匈牙利算法'</span><span class="token punctuation">,</span> <span class="token number">1112</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">'线索模型'</span><span class="token punctuation">,</span> <span class="token number">865</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">'关键路径算法'</span><span class="token punctuation">,</span> <span class="token number">847</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">'最小二乘法曲线拟合'</span><span class="token punctuation">,</span> <span class="token number">582</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">'二分逼近法'</span><span class="token punctuation">,</span> <span class="token number">555</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">'牛顿迭代法'</span><span class="token punctuation">,</span> <span class="token number">550</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">'Bresenham算法'</span><span class="token punctuation">,</span> <span class="token number">462</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">'粒子群优化'</span><span class="token punctuation">,</span> <span class="token number">366</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">'Dijkstra'</span><span class="token punctuation">,</span> <span class="token number">360</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">'A*算法'</span><span class="token punctuation">,</span> <span class="token number">282</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">'负极大极搜索算法'</span><span class="token punctuation">,</span> <span class="token number">273</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">'估值函数'</span><span class="token punctuation">,</span> <span class="token number">265</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>

<span class="token comment"># 渲染图</span>
<span class="token keyword">def</span> <span class="token function">wordcloud_base</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> WordCloud<span class="token punctuation">:</span>
    c <span class="token operator">=</span> <span class="token punctuation">(</span>
        WordCloud<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> words<span class="token punctuation">,</span> word_size_range<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">,</span> shape<span class="token operator">=</span><span class="token string">'diamond'</span><span class="token punctuation">)</span>  <span class="token comment"># SymbolType.ROUND_RECT</span>
        <span class="token punctuation">.</span>set_global_opts<span class="token punctuation">(</span>title_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>TitleOpts<span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">'WordCloud词云'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">return</span> c

<span class="token comment"># 生成图</span>
wordcloud_base<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string">'词云图.html'</span><span class="token punctuation">)</span>
</code></pre> 
<p>输出结果如下图所示，出现词频越高显示越大。</p> 
<p><img src="https://images2.imgbox.com/e8/3c/uokru1Ji_o.png" alt="在这里插入图片描述" width="550" height="380"></p> 
<p>核心代码为：<br> <strong>add(name, attr, value, shape=“circle”, word_gap=20, word_size_range=None, rotate_step=45)</strong></p> 
<ul><li>name -&gt; str: 图例名称</li><li>attr -&gt; list: 属性名称</li><li>value -&gt; list: 属性所对应的值</li><li>shape -&gt; list: 词云图轮廓，有’circle’, ‘cardioid’, ‘diamond’, ‘triangleforward’, ‘triangle’, ‘pentagon’, ‘star’可选</li><li>word_gap -&gt; int: 单词间隔,默认为20</li><li>word_size_range -&gt; list: 单词字体大小范围,默认为[12,60]</li><li>rotate_step -&gt; int: 旋转单词角度,默认为45</li></ul> 
<br> 
<hr> 
<h3><a id="2_638"></a>2.统计七种情绪特征词</h3> 
<p>我们先统计七种情绪特征词出现的次数，然后写入CSV文件中。</p> 
<pre><code class="prism language-python"><span class="token comment"># coding: utf-8</span>
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> jieba
<span class="token keyword">import</span> time
<span class="token keyword">import</span> csv

<span class="token comment">#-------------------------------------获取数据集---------------------------------</span>
f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'庆余年220.csv'</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'utf8'</span><span class="token punctuation">)</span>
weibo_df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>weibo_df<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">#-------------------------------------情感词典读取-------------------------------</span>
<span class="token comment">#注意：</span>
<span class="token comment">#1.词典中怒的标记(NA)识别不出被当作空值,情感分类列中的NA都给替换成NAU</span>
<span class="token comment">#2.大连理工词典中有情感分类的辅助标注(有NA),故把情感分类列改好再替换原词典中</span>

<span class="token comment"># 扩展前的词典</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span><span class="token string">'大连理工大学中文情感词汇本体NAU.xlsx'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

df <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'词语'</span><span class="token punctuation">,</span> <span class="token string">'词性种类'</span><span class="token punctuation">,</span> <span class="token string">'词义数'</span><span class="token punctuation">,</span> <span class="token string">'词义序号'</span><span class="token punctuation">,</span> <span class="token string">'情感分类'</span><span class="token punctuation">,</span> <span class="token string">'强度'</span><span class="token punctuation">,</span> <span class="token string">'极性'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
df<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">#-------------------------------------七种情绪的运用-------------------------------</span>
Happy <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
Good <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
Surprise <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
Anger <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
Sad <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
Fear <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
Disgust <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token comment">#df.iterrows()功能是迭代遍历每一行</span>
<span class="token keyword">for</span> idx<span class="token punctuation">,</span> row <span class="token keyword">in</span> df<span class="token punctuation">.</span>iterrows<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> row<span class="token punctuation">[</span><span class="token string">'情感分类'</span><span class="token punctuation">]</span> <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'PA'</span><span class="token punctuation">,</span> <span class="token string">'PE'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        Happy<span class="token punctuation">.</span>append<span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">'词语'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> row<span class="token punctuation">[</span><span class="token string">'情感分类'</span><span class="token punctuation">]</span> <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'PD'</span><span class="token punctuation">,</span> <span class="token string">'PH'</span><span class="token punctuation">,</span> <span class="token string">'PG'</span><span class="token punctuation">,</span> <span class="token string">'PB'</span><span class="token punctuation">,</span> <span class="token string">'PK'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        Good<span class="token punctuation">.</span>append<span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">'词语'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 
    <span class="token keyword">if</span> row<span class="token punctuation">[</span><span class="token string">'情感分类'</span><span class="token punctuation">]</span> <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'PC'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        Surprise<span class="token punctuation">.</span>append<span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">'词语'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>       
    <span class="token keyword">if</span> row<span class="token punctuation">[</span><span class="token string">'情感分类'</span><span class="token punctuation">]</span> <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'NB'</span><span class="token punctuation">,</span> <span class="token string">'NJ'</span><span class="token punctuation">,</span> <span class="token string">'NH'</span><span class="token punctuation">,</span> <span class="token string">'PF'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        Sad<span class="token punctuation">.</span>append<span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">'词语'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> row<span class="token punctuation">[</span><span class="token string">'情感分类'</span><span class="token punctuation">]</span> <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'NI'</span><span class="token punctuation">,</span> <span class="token string">'NC'</span><span class="token punctuation">,</span> <span class="token string">'NG'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        Fear<span class="token punctuation">.</span>append<span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">'词语'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> row<span class="token punctuation">[</span><span class="token string">'情感分类'</span><span class="token punctuation">]</span> <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'NE'</span><span class="token punctuation">,</span> <span class="token string">'ND'</span><span class="token punctuation">,</span> <span class="token string">'NN'</span><span class="token punctuation">,</span> <span class="token string">'NK'</span><span class="token punctuation">,</span> <span class="token string">'NL'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        Disgust<span class="token punctuation">.</span>append<span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">'词语'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> row<span class="token punctuation">[</span><span class="token string">'情感分类'</span><span class="token punctuation">]</span> <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'NAU'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>     <span class="token comment">#修改: 原NA算出来没结果</span>
        Anger<span class="token punctuation">.</span>append<span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">'词语'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  

<span class="token comment">#正负计算不是很准 自己可以制定规则       </span>
Positive <span class="token operator">=</span> Happy <span class="token operator">+</span> Good <span class="token operator">+</span> Surprise
Negative <span class="token operator">=</span> Anger <span class="token operator">+</span> Sad <span class="token operator">+</span> Fear <span class="token operator">+</span> Disgust
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'情绪词语列表整理完成'</span><span class="token punctuation">)</span>  
<span class="token keyword">print</span><span class="token punctuation">(</span>Anger<span class="token punctuation">)</span>

<span class="token comment">#---------------------------------------中文分词---------------------------------</span>

<span class="token comment">#添加自定义词典和停用词</span>
<span class="token comment">#jieba.load_userdict("user_dict.txt")</span>
stop_list <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'stop_words.txt'</span><span class="token punctuation">,</span>
                        engine<span class="token operator">=</span><span class="token string">'python'</span><span class="token punctuation">,</span>
                        encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">,</span>
                        delimiter<span class="token operator">=</span><span class="token string">"\n"</span><span class="token punctuation">,</span>
                        names<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'t'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">#获取重命名t列的值</span>
stop_list <span class="token operator">=</span> stop_list<span class="token punctuation">[</span><span class="token string">'t'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">txt_cut</span><span class="token punctuation">(</span>juzi<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>w <span class="token keyword">for</span> w <span class="token keyword">in</span> jieba<span class="token punctuation">.</span>lcut<span class="token punctuation">(</span>juzi<span class="token punctuation">)</span> <span class="token keyword">if</span> w <span class="token operator">not</span> <span class="token keyword">in</span> stop_list<span class="token punctuation">]</span>     <span class="token comment">#可增加len(w)&gt;1</span>

<span class="token comment">#---------------------------------------情感计算---------------------------------</span>
<span class="token comment">#文件写入</span>
c <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"Emotion_features.csv"</span><span class="token punctuation">,</span> <span class="token string">"a+"</span><span class="token punctuation">,</span> newline<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'gb18030'</span><span class="token punctuation">)</span>
writer <span class="token operator">=</span> csv<span class="token punctuation">.</span>writer<span class="token punctuation">(</span>c<span class="token punctuation">)</span>
writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"Emotion"</span><span class="token punctuation">,</span><span class="token string">"Word"</span><span class="token punctuation">,</span><span class="token string">"Num"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">#情感统计</span>
<span class="token keyword">def</span> <span class="token function">emotion_caculate</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>
    positive <span class="token operator">=</span> <span class="token number">0</span>
    negative <span class="token operator">=</span> <span class="token number">0</span>
    
    anger <span class="token operator">=</span> <span class="token number">0</span>
    disgust <span class="token operator">=</span> <span class="token number">0</span>
    fear <span class="token operator">=</span> <span class="token number">0</span>
    sad <span class="token operator">=</span> <span class="token number">0</span>
    surprise <span class="token operator">=</span> <span class="token number">0</span>
    good <span class="token operator">=</span> <span class="token number">0</span>
    happy <span class="token operator">=</span> <span class="token number">0</span>

    anger_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    disgust_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    fear_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    sad_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    surprise_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    good_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    happy_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    
    wordlist <span class="token operator">=</span> txt_cut<span class="token punctuation">(</span>text<span class="token punctuation">)</span>
    <span class="token comment">#wordlist = jieba.lcut(text)</span>
    wordset <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span>wordlist<span class="token punctuation">)</span>
    wordfreq <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> word <span class="token keyword">in</span> wordset<span class="token punctuation">:</span>
        freq <span class="token operator">=</span> wordlist<span class="token punctuation">.</span>count<span class="token punctuation">(</span>word<span class="token punctuation">)</span>
        tlist <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">if</span> word <span class="token keyword">in</span> Positive<span class="token punctuation">:</span>
            positive<span class="token operator">+=</span>freq
        <span class="token keyword">if</span> word <span class="token keyword">in</span> Negative<span class="token punctuation">:</span>
            negative<span class="token operator">+=</span>freq
        <span class="token keyword">if</span> word <span class="token keyword">in</span> Anger<span class="token punctuation">:</span>
            anger<span class="token operator">+=</span>freq
            anger_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>word<span class="token punctuation">)</span>
            tlist<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"anger"</span><span class="token punctuation">)</span>
            tlist<span class="token punctuation">.</span>append<span class="token punctuation">(</span>word<span class="token punctuation">)</span>
            tlist<span class="token punctuation">.</span>append<span class="token punctuation">(</span>freq<span class="token punctuation">)</span>
            writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span>tlist<span class="token punctuation">)</span>
        <span class="token keyword">if</span> word <span class="token keyword">in</span> Disgust<span class="token punctuation">:</span>
            disgust<span class="token operator">+=</span>freq
            disgust_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>word<span class="token punctuation">)</span>
            tlist<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"disgust"</span><span class="token punctuation">)</span>
            tlist<span class="token punctuation">.</span>append<span class="token punctuation">(</span>word<span class="token punctuation">)</span>
            tlist<span class="token punctuation">.</span>append<span class="token punctuation">(</span>freq<span class="token punctuation">)</span>
            writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span>tlist<span class="token punctuation">)</span>
        <span class="token keyword">if</span> word <span class="token keyword">in</span> Fear<span class="token punctuation">:</span>
            fear<span class="token operator">+=</span>freq
            fear_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>word<span class="token punctuation">)</span>
            tlist<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"fear"</span><span class="token punctuation">)</span>
            tlist<span class="token punctuation">.</span>append<span class="token punctuation">(</span>word<span class="token punctuation">)</span>
            tlist<span class="token punctuation">.</span>append<span class="token punctuation">(</span>freq<span class="token punctuation">)</span>
            writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span>tlist<span class="token punctuation">)</span>
        <span class="token keyword">if</span> word <span class="token keyword">in</span> Sad<span class="token punctuation">:</span>
            sad<span class="token operator">+=</span>freq
            sad_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>word<span class="token punctuation">)</span>
            tlist<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"sad"</span><span class="token punctuation">)</span>
            tlist<span class="token punctuation">.</span>append<span class="token punctuation">(</span>word<span class="token punctuation">)</span>
            tlist<span class="token punctuation">.</span>append<span class="token punctuation">(</span>freq<span class="token punctuation">)</span>
            writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span>tlist<span class="token punctuation">)</span>
        <span class="token keyword">if</span> word <span class="token keyword">in</span> Surprise<span class="token punctuation">:</span>
            surprise<span class="token operator">+=</span>freq
            surprise_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>word<span class="token punctuation">)</span>
            tlist<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"surprise"</span><span class="token punctuation">)</span>
            tlist<span class="token punctuation">.</span>append<span class="token punctuation">(</span>word<span class="token punctuation">)</span>
            tlist<span class="token punctuation">.</span>append<span class="token punctuation">(</span>freq<span class="token punctuation">)</span>
            writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span>tlist<span class="token punctuation">)</span>
        <span class="token keyword">if</span> word <span class="token keyword">in</span> Good<span class="token punctuation">:</span>
            good<span class="token operator">+=</span>freq
            good_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>word<span class="token punctuation">)</span>
            tlist<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"good"</span><span class="token punctuation">)</span>
            tlist<span class="token punctuation">.</span>append<span class="token punctuation">(</span>word<span class="token punctuation">)</span>
            tlist<span class="token punctuation">.</span>append<span class="token punctuation">(</span>freq<span class="token punctuation">)</span>
            writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span>tlist<span class="token punctuation">)</span>
        <span class="token keyword">if</span> word <span class="token keyword">in</span> Happy<span class="token punctuation">:</span>
            happy<span class="token operator">+=</span>freq
            happy_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>word<span class="token punctuation">)</span>
            tlist<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"happy"</span><span class="token punctuation">)</span>
            tlist<span class="token punctuation">.</span>append<span class="token punctuation">(</span>word<span class="token punctuation">)</span>
            tlist<span class="token punctuation">.</span>append<span class="token punctuation">(</span>freq<span class="token punctuation">)</span>
            writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span>tlist<span class="token punctuation">)</span>
            
    emotion_info <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">'length'</span><span class="token punctuation">:</span><span class="token builtin">len</span><span class="token punctuation">(</span>wordlist<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">'positive'</span><span class="token punctuation">:</span> positive<span class="token punctuation">,</span>
        <span class="token string">'negative'</span><span class="token punctuation">:</span> negative<span class="token punctuation">,</span>
        <span class="token string">'anger'</span><span class="token punctuation">:</span> anger<span class="token punctuation">,</span>
        <span class="token string">'disgust'</span><span class="token punctuation">:</span> disgust<span class="token punctuation">,</span>
        <span class="token string">'fear'</span><span class="token punctuation">:</span>fear<span class="token punctuation">,</span>
        <span class="token string">'good'</span><span class="token punctuation">:</span>good<span class="token punctuation">,</span>
        <span class="token string">'sadness'</span><span class="token punctuation">:</span>sad<span class="token punctuation">,</span>
        <span class="token string">'surprise'</span><span class="token punctuation">:</span>surprise<span class="token punctuation">,</span>
        <span class="token string">'happy'</span><span class="token punctuation">:</span>happy<span class="token punctuation">,</span>
        
    <span class="token punctuation">}</span>

    indexs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'length'</span><span class="token punctuation">,</span> <span class="token string">'positive'</span><span class="token punctuation">,</span> <span class="token string">'negative'</span><span class="token punctuation">,</span> <span class="token string">'anger'</span><span class="token punctuation">,</span> <span class="token string">'disgust'</span><span class="token punctuation">,</span><span class="token string">'fear'</span><span class="token punctuation">,</span><span class="token string">'sadness'</span><span class="token punctuation">,</span><span class="token string">'surprise'</span><span class="token punctuation">,</span> <span class="token string">'good'</span><span class="token punctuation">,</span> <span class="token string">'happy'</span><span class="token punctuation">]</span>
    <span class="token comment">#return pd.Series(emotion_info, index=indexs), anger_list, disgust_list, fear_list, sad_list, surprise_list, good_list, happy_list</span>
    <span class="token keyword">return</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span>emotion_info<span class="token punctuation">,</span> index<span class="token operator">=</span>indexs<span class="token punctuation">)</span>

<span class="token comment">#---------------------------------------情感计算---------------------------------</span>
start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>   
emotion_df <span class="token operator">=</span> weibo_df<span class="token punctuation">[</span><span class="token string">'review'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>emotion_caculate<span class="token punctuation">)</span>
end <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>end<span class="token operator">-</span>start<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>emotion_df<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">#输出结果</span>
output_df <span class="token operator">=</span> pd<span class="token punctuation">.</span>concat<span class="token punctuation">(</span><span class="token punctuation">[</span>weibo_df<span class="token punctuation">,</span> emotion_df<span class="token punctuation">]</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
output_df<span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span><span class="token string">'庆余年220_emotion.csv'</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'utf_8_sig'</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>output_df<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">#结束统计</span>
c<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>输出结果如下图所示：</p> 
<p><img src="https://images2.imgbox.com/5d/58/iyMrOLvO_o.png" alt="在这里插入图片描述" width="350" height="400"></p> 
<br> 
<hr> 
<h3><a id="3_844"></a>3.词云分析</h3> 
<p>接着通过Pandas获取不同情绪的特征词及数量，代码如下所示。</p> 
<pre><code class="prism language-python"><span class="token comment"># coding: utf-8</span>
<span class="token keyword">import</span> csv
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd

<span class="token comment">#读取数据</span>
f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'Emotion_features.csv'</span><span class="token punctuation">)</span>
data <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">#统计结果</span>
groupnum <span class="token operator">=</span> data<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Emotion'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>groupnum<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span>

<span class="token comment">#分组统计</span>
<span class="token keyword">for</span> groupname<span class="token punctuation">,</span>grouplist <span class="token keyword">in</span> data<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'Emotion'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>groupname<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>grouplist<span class="token punctuation">)</span>
</code></pre> 
<p>输出结果如下图所示：</p> 
<pre><code class="prism language-python">   Emotion Word  Num
<span class="token number">0</span>     good   人心    <span class="token number">1</span>
<span class="token number">1</span>     good   极好    <span class="token number">1</span>
<span class="token number">2</span>     good   活泼    <span class="token number">1</span>
<span class="token number">3</span>  disgust   强硬    <span class="token number">1</span>
<span class="token number">4</span>  disgust   尴尬    <span class="token number">2</span>

Emotion
anger         <span class="token number">2</span>
disgust     <span class="token number">208</span>
fear          <span class="token number">9</span>
good        <span class="token number">254</span>
happy        <span class="token number">39</span>
sad          <span class="token number">42</span>
surprise     <span class="token number">11</span>
dtype<span class="token punctuation">:</span> int64

anger
    Emotion Word  Num
<span class="token number">133</span>   anger   气愤    <span class="token number">1</span>
<span class="token number">382</span>   anger   报仇    <span class="token number">3</span>

disgust
     Emotion Word  Num
<span class="token number">3</span>    disgust   强硬    <span class="token number">1</span>
<span class="token number">4</span>    disgust   尴尬    <span class="token number">2</span>
<span class="token number">8</span>    disgust   模糊    <span class="token number">1</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span>       <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token number">558</span>  disgust   紧张    <span class="token number">1</span>
<span class="token number">560</span>  disgust   紧张    <span class="token number">1</span>
<span class="token number">561</span>  disgust   刺激    <span class="token number">1</span>
<span class="token punctuation">[</span><span class="token number">208</span> rows x <span class="token number">3</span> columns<span class="token punctuation">]</span>

fear
    Emotion  Word  Num
<span class="token number">93</span>     fear   鸿门宴    <span class="token number">1</span>
<span class="token number">111</span>    fear    吓人    <span class="token number">1</span>
<span class="token number">148</span>    fear    可怕    <span class="token number">1</span>
<span class="token number">170</span>    fear  没头苍蝇    <span class="token number">1</span>
<span class="token number">211</span>    fear    厉害    <span class="token number">1</span>
<span class="token number">290</span>    fear  刀光剑影    <span class="token number">1</span>
<span class="token number">292</span>    fear    忌惮    <span class="token number">1</span>
<span class="token number">342</span>    fear  无时无刻    <span class="token number">1</span>
<span class="token number">559</span>    fear    紧张    <span class="token number">1</span>

good
    Emotion Word  Num
<span class="token number">0</span>      good   人心    <span class="token number">1</span>
<span class="token number">1</span>      good   极好    <span class="token number">1</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span>       <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre> 
<p>但是我们会发现统计的结果分布不均匀，所以扩展情感词库是非常必要的。接下来我们以good、disgust、sad和happy作为示例进行词云对比。最终代码如下所示：</p> 
<pre><code class="prism language-python"><span class="token comment"># coding: utf-8</span>
<span class="token keyword">import</span> csv
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> operator

<span class="token comment">#------------------------------------统计结果------------------------------------</span>
<span class="token comment">#读取数据</span>
f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'Emotion_features.csv'</span><span class="token punctuation">)</span>
data <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">#统计结果</span>
groupnum <span class="token operator">=</span> data<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Emotion'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>groupnum<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span>

<span class="token comment">#分组统计</span>
<span class="token keyword">for</span> groupname<span class="token punctuation">,</span>grouplist <span class="token keyword">in</span> data<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'Emotion'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>groupname<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>grouplist<span class="token punctuation">)</span>

<span class="token comment">#生成数据 word = [('A',10), ('B',9), ('C',8)] 列表+Tuple</span>
i <span class="token operator">=</span> <span class="token number">0</span>
words <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
counts <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">while</span> i<span class="token operator">&lt;</span><span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> data<span class="token punctuation">[</span><span class="token string">'Emotion'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token keyword">in</span> <span class="token string">"sad"</span><span class="token punctuation">:</span> <span class="token comment">#相等</span>
        k <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">'Word'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        v <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">'Num'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        
        n <span class="token operator">=</span> <span class="token number">0</span>
        flag <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">while</span> n<span class="token operator">&lt;</span><span class="token builtin">len</span><span class="token punctuation">(</span>words<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment">#如果两个单词相同则增加次数</span>
            <span class="token keyword">if</span> words<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token operator">==</span>k<span class="token punctuation">:</span>
                counts<span class="token punctuation">[</span>n<span class="token punctuation">]</span> <span class="token operator">=</span> counts<span class="token punctuation">[</span>n<span class="token punctuation">]</span> <span class="token operator">+</span> v
                flag <span class="token operator">=</span> <span class="token number">1</span>
                <span class="token keyword">break</span>
            n <span class="token operator">=</span> n <span class="token operator">+</span> <span class="token number">1</span>
        <span class="token comment">#如果没有找到相同的特征词则添加</span>
        <span class="token keyword">if</span> flag<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">:</span>
            words<span class="token punctuation">.</span>append<span class="token punctuation">(</span>k<span class="token punctuation">)</span>
            counts<span class="token punctuation">.</span>append<span class="token punctuation">(</span>v<span class="token punctuation">)</span>
    i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>

<span class="token comment">#添加最终数组结果</span>
result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
k <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">while</span> k<span class="token operator">&lt;</span><span class="token builtin">len</span><span class="token punctuation">(</span>words<span class="token punctuation">)</span><span class="token punctuation">:</span>
    result<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>words<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>counts<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token operator">*</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">#注意：因数据集较少,作者扩大5倍方便绘图</span>
    k <span class="token operator">=</span> k <span class="token operator">+</span> <span class="token number">1</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>

<span class="token comment">#------------------------------------词云分析------------------------------------</span>
<span class="token keyword">from</span> pyecharts <span class="token keyword">import</span> options <span class="token keyword">as</span> opts
<span class="token keyword">from</span> pyecharts<span class="token punctuation">.</span>charts <span class="token keyword">import</span> WordCloud
<span class="token keyword">from</span> pyecharts<span class="token punctuation">.</span><span class="token builtin">globals</span> <span class="token keyword">import</span> SymbolType

<span class="token comment"># 渲染图</span>
<span class="token keyword">def</span> <span class="token function">wordcloud_base</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> WordCloud<span class="token punctuation">:</span>
    c <span class="token operator">=</span> <span class="token punctuation">(</span>
        WordCloud<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> result<span class="token punctuation">,</span> word_size_range<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">]</span><span class="token punctuation">,</span> shape<span class="token operator">=</span>SymbolType<span class="token punctuation">.</span>ROUND_RECT<span class="token punctuation">)</span>
        <span class="token punctuation">.</span>set_global_opts<span class="token punctuation">(</span>title_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>TitleOpts<span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">'情绪词云图'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">return</span> c

<span class="token comment"># 生成图</span>
wordcloud_base<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string">'情绪词云图.html'</span><span class="token punctuation">)</span>
</code></pre> 
<p>输出结果如下图所示：</p> 
<blockquote> 
 <p>[(‘可惜’, 5), (‘大失所望’, 1), (‘白搭’, 1), (‘情感’, 1), (‘失望’, 10), (‘鹤唳华亭’, 5), (‘引人深思’, 1), (‘不行’, 5), (‘难受’, 4), (‘艰苦’, 2), (‘俏皮话’, 1), (‘无语’, 2), (‘回忆’, 1), (‘悲剧’, 1), (‘江河日下’, 1), (‘战乱’, 2), (‘不忍’, 1)]</p> 
</blockquote> 
<p>由于数据集较少，作者将次数扩大了5倍，这种情况建议大家进行归一化处理。具体怎么做？这里不再详细讲解。</p> 
<p><img src="https://images2.imgbox.com/79/bd/cmnipW3E_o.png" alt="在这里插入图片描述" width="550" height="350"></p> 
<p>最终四个情绪Sad | Happy | Good | Disgust 对比图如下图所示：</p> 
<p><img src="https://images2.imgbox.com/aa/4c/NCpZNi7K_o.png" alt="在这里插入图片描述" width="550" height="450"></p> 
<br> 
<hr> 
<h2><a id="_1014"></a>四.自定义词典情感分析</h2> 
<p>下面我们进行基于大连理工自定义词典的情感分析。核心模块是load_sentiment_dict(self,dict_path)，功能如下：</p> 
<ul><li>调用大连理工词典，选取其中要用的列</li><li>将情感极性转化一下，并计算得出真正的情感值(强度×极性(转后))</li><li>找到情感词所属的大类</li><li>分词 =&gt; 情感词间是否有否定词/程度词+前后顺序 =&gt; 情感分数累加</li></ul> 
<p><strong>完整代码如下：</strong></p> 
<pre><code class="prism language-python"><span class="token comment"># coding: utf-8</span>
<span class="token keyword">import</span> sys
<span class="token keyword">import</span> gzip
<span class="token keyword">from</span> collections <span class="token keyword">import</span> defaultdict
<span class="token keyword">from</span> itertools <span class="token keyword">import</span> product
<span class="token keyword">import</span> jieba
<span class="token keyword">import</span> csv
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd

<span class="token keyword">class</span> <span class="token class-name">Struct</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> word<span class="token punctuation">,</span> sentiment<span class="token punctuation">,</span> pos<span class="token punctuation">,</span>value<span class="token punctuation">,</span> class_value<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>word <span class="token operator">=</span> word
        self<span class="token punctuation">.</span>sentiment <span class="token operator">=</span> sentiment
        self<span class="token punctuation">.</span>pos <span class="token operator">=</span> pos
        self<span class="token punctuation">.</span>value <span class="token operator">=</span> value
        self<span class="token punctuation">.</span>class_value <span class="token operator">=</span> class_value

<span class="token keyword">class</span> <span class="token class-name">Result</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>score<span class="token punctuation">,</span> score_words<span class="token punctuation">,</span>not_word<span class="token punctuation">,</span> degree_word <span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>score <span class="token operator">=</span> score
        self<span class="token punctuation">.</span>score_words <span class="token operator">=</span> score_words
        self<span class="token punctuation">.</span>not_word <span class="token operator">=</span> not_word
        self<span class="token punctuation">.</span>degree_word <span class="token operator">=</span> degree_word

<span class="token keyword">class</span> <span class="token class-name">Score</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 七个情感大类对应的小类简称: 尊敬</span>
        score_class <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'乐'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'PA'</span><span class="token punctuation">,</span><span class="token string">'PE'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                       <span class="token string">'好'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'PD'</span><span class="token punctuation">,</span><span class="token string">'PH'</span><span class="token punctuation">,</span> <span class="token string">'PG'</span><span class="token punctuation">,</span><span class="token string">'PB'</span><span class="token punctuation">,</span><span class="token string">'PK'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                       <span class="token string">'怒'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'NA'</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
                       <span class="token string">'哀'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'NB'</span><span class="token punctuation">,</span><span class="token string">'NJ'</span><span class="token punctuation">,</span><span class="token string">'NH'</span><span class="token punctuation">,</span> <span class="token string">'PF'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                       <span class="token string">'惧'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'NI'</span><span class="token punctuation">,</span> <span class="token string">'NC'</span><span class="token punctuation">,</span> <span class="token string">'NG'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                       <span class="token string">'恶'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'NE'</span><span class="token punctuation">,</span> <span class="token string">'ND'</span><span class="token punctuation">,</span> <span class="token string">'NN'</span><span class="token punctuation">,</span><span class="token string">'NK'</span><span class="token punctuation">,</span><span class="token string">'NL'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                       <span class="token string">'惊'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'PC'</span><span class="token punctuation">]</span>
                       <span class="token punctuation">}</span>
        <span class="token comment"># 大连理工大学 -&gt; ICTPOS 3.0</span>
        POS_MAP <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">'noun'</span><span class="token punctuation">:</span> <span class="token string">'n'</span><span class="token punctuation">,</span>
            <span class="token string">'verb'</span><span class="token punctuation">:</span> <span class="token string">'v'</span><span class="token punctuation">,</span>
            <span class="token string">'adj'</span><span class="token punctuation">:</span> <span class="token string">'a'</span><span class="token punctuation">,</span>
            <span class="token string">'adv'</span><span class="token punctuation">:</span> <span class="token string">'d'</span><span class="token punctuation">,</span>
            <span class="token string">'nw'</span><span class="token punctuation">:</span> <span class="token string">'al'</span><span class="token punctuation">,</span>  <span class="token comment"># 网络用语</span>
            <span class="token string">'idiom'</span><span class="token punctuation">:</span> <span class="token string">'al'</span><span class="token punctuation">,</span>
            <span class="token string">'prep'</span><span class="token punctuation">:</span> <span class="token string">'p'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>

        <span class="token comment"># 否定词</span>
        NOT_DICT <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'不'</span><span class="token punctuation">,</span><span class="token string">'不是'</span><span class="token punctuation">,</span><span class="token string">'不大'</span><span class="token punctuation">,</span> <span class="token string">'没'</span><span class="token punctuation">,</span> <span class="token string">'无'</span><span class="token punctuation">,</span> <span class="token string">'非'</span><span class="token punctuation">,</span> <span class="token string">'莫'</span><span class="token punctuation">,</span> <span class="token string">'弗'</span><span class="token punctuation">,</span> <span class="token string">'毋'</span><span class="token punctuation">,</span>
                        <span class="token string">'勿'</span><span class="token punctuation">,</span> <span class="token string">'未'</span><span class="token punctuation">,</span> <span class="token string">'否'</span><span class="token punctuation">,</span> <span class="token string">'别'</span><span class="token punctuation">,</span> <span class="token string">'無'</span><span class="token punctuation">,</span> <span class="token string">'休'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

        <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> sentiment_dict_path<span class="token punctuation">,</span> degree_dict_path<span class="token punctuation">,</span> stop_dict_path <span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>sentiment_struct<span class="token punctuation">,</span>self<span class="token punctuation">.</span>sentiment_dict <span class="token operator">=</span> self<span class="token punctuation">.</span>load_sentiment_dict<span class="token punctuation">(</span>sentiment_dict_path<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>degree_dict <span class="token operator">=</span> self<span class="token punctuation">.</span>load_degree_dict<span class="token punctuation">(</span>degree_dict_path<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>stop_words <span class="token operator">=</span> self<span class="token punctuation">.</span>load_stop_words<span class="token punctuation">(</span>stop_dict_path<span class="token punctuation">)</span>

        <span class="token keyword">def</span> <span class="token function">load_stop_words</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> stop_dict_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
            stop_words <span class="token operator">=</span> <span class="token punctuation">[</span>w <span class="token keyword">for</span> w <span class="token keyword">in</span> <span class="token builtin">open</span><span class="token punctuation">(</span>stop_dict_path<span class="token punctuation">)</span><span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
            <span class="token comment">#print (stop_words[:100])</span>
            <span class="token keyword">return</span> stop_words

        <span class="token keyword">def</span> <span class="token function">remove_stopword</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> words<span class="token punctuation">)</span><span class="token punctuation">:</span>
            words <span class="token operator">=</span> <span class="token punctuation">[</span>w <span class="token keyword">for</span> w <span class="token keyword">in</span> words <span class="token keyword">if</span> w <span class="token operator">not</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>stop_words<span class="token punctuation">]</span>
            <span class="token keyword">return</span> words

        <span class="token keyword">def</span> <span class="token function">load_degree_dict</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> dict_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">"""读取程度副词词典
            Args:
                dict_path: 程度副词词典路径. 格式为 word\tdegree
                           所有的词可以分为6个级别，分别对应极其, 很, 较, 稍, 欠, 超
           Returns:
                返回 dict = {word: degree}
            """</span>
            degree_dict <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
            <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>dict_path<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'UTF-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
                <span class="token keyword">for</span> line <span class="token keyword">in</span> f<span class="token punctuation">:</span>
                    line <span class="token operator">=</span> line<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
                    word<span class="token punctuation">,</span> degree <span class="token operator">=</span> line<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'\t'</span><span class="token punctuation">)</span>
                    degree <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>degree<span class="token punctuation">)</span>
                    degree_dict<span class="token punctuation">[</span>word<span class="token punctuation">]</span> <span class="token operator">=</span> degree
            <span class="token keyword">return</span> degree_dict

        <span class="token keyword">def</span> <span class="token function">load_sentiment_dict</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> dict_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">"""读取情感词词典
            Args:
                dict_path: 情感词词典路径. 格式请看 README.md
            Returns:
                返回 dict = {(word, postag): 极性}
            """</span>
            sentiment_dict <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
            sentiment_struct <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

            <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>dict_path<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'UTF-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
            <span class="token comment">#with gzip.open(dict_path) as f:</span>
                <span class="token keyword">for</span> index<span class="token punctuation">,</span> line <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">if</span> index <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>  <span class="token comment"># title,即第一行的标题</span>
                        <span class="token keyword">continue</span>
                    items <span class="token operator">=</span> line<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'\t'</span><span class="token punctuation">)</span>
                    word <span class="token operator">=</span> items<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
                    pos <span class="token operator">=</span> items<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
                    sentiment<span class="token operator">=</span>items<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span>
                    intensity <span class="token operator">=</span> items<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span>  <span class="token comment"># 1, 3, 5, 7, 9五档, 9表示强度最大, 1为强度最小.</span>
                    polar <span class="token operator">=</span> items<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span>      <span class="token comment"># 极性</span>
                    
                    <span class="token comment"># 将词性转为 ICTPOS 词性体系</span>
                    pos <span class="token operator">=</span> self<span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>POS_MAP<span class="token punctuation">[</span>pos<span class="token punctuation">]</span>
                    intensity <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>intensity<span class="token punctuation">)</span>
                    polar <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>polar<span class="token punctuation">)</span>

                    <span class="token comment"># 转换情感倾向的表现形式, 负数为消极, 0 为中性, 正数为积极</span>
                    <span class="token comment"># 数值绝对值大小表示极性的强度 // 分成3类，极性：褒(+1)、中(0)、贬(-1)； 强度为权重值</span>
                    value <span class="token operator">=</span> <span class="token boolean">None</span>
                    <span class="token keyword">if</span> polar <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>            <span class="token comment"># neutral</span>
                        value <span class="token operator">=</span> <span class="token number">0</span>
                    <span class="token keyword">elif</span> polar <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>          <span class="token comment"># positive</span>
                        value <span class="token operator">=</span> intensity
                    <span class="token keyword">elif</span> polar <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">:</span>          <span class="token comment"># negtive</span>
                        value <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">*</span> intensity
                    <span class="token keyword">else</span><span class="token punctuation">:</span>  <span class="token comment"># invalid</span>
                        <span class="token keyword">continue</span>

                    <span class="token comment">#key = (word, pos, sentiment )</span>
                    key <span class="token operator">=</span> word
                    sentiment_dict<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value

                    <span class="token comment">#找对应的大类</span>
                    <span class="token keyword">for</span> item <span class="token keyword">in</span> self<span class="token punctuation">.</span>score_class<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                        key <span class="token operator">=</span> item<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
                        values <span class="token operator">=</span> item<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
                        <span class="token comment">#print(key)</span>
                        <span class="token comment">#print(value)</span>
                        <span class="token keyword">for</span> x <span class="token keyword">in</span> values<span class="token punctuation">:</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span>sentiment<span class="token operator">==</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
                                class_value <span class="token operator">=</span> key <span class="token comment"># 如果values中包含，则获取key</span>
                    sentiment_struct<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Struct<span class="token punctuation">(</span>word<span class="token punctuation">,</span> sentiment<span class="token punctuation">,</span> pos<span class="token punctuation">,</span>value<span class="token punctuation">,</span> class_value<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span>  sentiment_struct<span class="token punctuation">,</span> sentiment_dict

        <span class="token keyword">def</span> <span class="token function">findword</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> text<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment">#查找文本中包含哪些情感词</span>
            word_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token keyword">for</span> item <span class="token keyword">in</span> self<span class="token punctuation">.</span>sentiment_struct<span class="token punctuation">:</span>
                <span class="token keyword">if</span> item<span class="token punctuation">.</span>word <span class="token keyword">in</span> text<span class="token punctuation">:</span>
                    word_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>item<span class="token punctuation">)</span>
            <span class="token keyword">return</span> word_list

        <span class="token keyword">def</span> <span class="token function">classify_words</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> words<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># 这3个键是词的序号(索引)</span>
            
            sen_word <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>                 
            not_word <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
            degree_word <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
            <span class="token comment"># 找到对应的sent, not, degree;      words 是分词后的列表</span>
            <span class="token keyword">for</span> index<span class="token punctuation">,</span> word <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>words<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> word <span class="token keyword">in</span> self<span class="token punctuation">.</span>sentiment_dict <span class="token operator">and</span> word <span class="token operator">not</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>NOT_DICT <span class="token operator">and</span> word <span class="token operator">not</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>degree_dict<span class="token punctuation">:</span>
                    sen_word<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>sentiment_dict<span class="token punctuation">[</span>word<span class="token punctuation">]</span>
                <span class="token keyword">elif</span> word <span class="token keyword">in</span> self<span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>NOT_DICT <span class="token operator">and</span> word <span class="token operator">not</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>degree_dict<span class="token punctuation">:</span>
                    not_word<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
                <span class="token keyword">elif</span> word <span class="token keyword">in</span> self<span class="token punctuation">.</span>degree_dict<span class="token punctuation">:</span>
                    degree_word<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>degree_dict<span class="token punctuation">[</span>word<span class="token punctuation">]</span>
            <span class="token keyword">return</span> sen_word<span class="token punctuation">,</span> not_word<span class="token punctuation">,</span> degree_word


        <span class="token keyword">def</span> <span class="token function">get2score_position</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> words<span class="token punctuation">)</span><span class="token punctuation">:</span>
            sen_word<span class="token punctuation">,</span> not_word<span class="token punctuation">,</span> degree_word <span class="token operator">=</span>  self<span class="token punctuation">.</span>classify_words<span class="token punctuation">(</span>words<span class="token punctuation">)</span>   <span class="token comment"># 是字典</span>

            score <span class="token operator">=</span> <span class="token number">0</span>
            start <span class="token operator">=</span> <span class="token number">0</span>
            <span class="token comment"># 存所有情感词、否定词、程度副词的位置(索引、序号)的列表</span>
            sen_locs <span class="token operator">=</span> sen_word<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span>
            not_locs <span class="token operator">=</span> not_word<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span>
            degree_locs <span class="token operator">=</span> degree_word<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span>
            senloc <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
            <span class="token comment"># 遍历句子中所有的单词words，i为单词的绝对位置</span>
            <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>words<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> i <span class="token keyword">in</span> sen_locs<span class="token punctuation">:</span>
                    W <span class="token operator">=</span> <span class="token number">1</span>  <span class="token comment"># 情感词间权重重置</span>
                    not_locs_index <span class="token operator">=</span> <span class="token number">0</span>
                    degree_locs_index <span class="token operator">=</span> <span class="token number">0</span>

                    <span class="token comment"># senloc为情感词位置列表的序号,之前的sen_locs是情感词再分词后列表中的位置序号</span>
                    senloc <span class="token operator">+=</span> <span class="token number">1</span>
                    <span class="token comment">#score += W * float(sen_word[i])</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>senloc<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># 第一个情感词,前面是否有否定词，程度词</span>
                        start <span class="token operator">=</span> <span class="token number">0</span>
                    <span class="token keyword">elif</span> senloc <span class="token operator">&lt;</span> <span class="token builtin">len</span><span class="token punctuation">(</span>sen_locs<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 和前面一个情感词之间，是否有否定词,程度词</span>
                        <span class="token comment"># j为绝对位置</span>
                        start <span class="token operator">=</span> previous_sen_locs

                    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># 词间的相对位置</span>
                        <span class="token comment"># 如果有否定词</span>
                        <span class="token keyword">if</span> j <span class="token keyword">in</span> not_locs<span class="token punctuation">:</span>
                            W <span class="token operator">*=</span> <span class="token operator">-</span><span class="token number">1</span>
                            not_locs_index<span class="token operator">=</span>j
                        <span class="token comment"># 如果有程度副词</span>
                        <span class="token keyword">elif</span> j <span class="token keyword">in</span> degree_locs<span class="token punctuation">:</span>
                            W <span class="token operator">*=</span> degree_word<span class="token punctuation">[</span>j<span class="token punctuation">]</span>
                            degree_locs_index<span class="token operator">=</span>j

                        <span class="token comment"># 判断否定词和程度词的位置：1）否定词在前，程度词减半(加上正值)；不是很   2）否定词在后，程度增强（不变），很不是</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>not_locs_index<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">and</span> <span class="token punctuation">(</span>degree_locs_index<span class="token operator">&gt;</span><span class="token number">0</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>not_locs_index <span class="token operator">&lt;</span> degree_locs_index <span class="token punctuation">)</span><span class="token punctuation">:</span>
                            degree_reduce <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">(</span>degree_word<span class="token punctuation">[</span>degree_locs_index<span class="token punctuation">]</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                            W <span class="token operator">+=</span>degree_reduce
                            <span class="token comment">#print (W)</span>
                    score <span class="token operator">+=</span> W <span class="token operator">*</span> <span class="token builtin">float</span><span class="token punctuation">(</span>sen_word<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># 直接添加该情感词分数</span>
                    <span class="token comment">#print(score)</span>
                    previous_sen_locs <span class="token operator">=</span> i
            <span class="token keyword">return</span> score

        <span class="token comment">#感觉get2score用处不是很大</span>
        <span class="token keyword">def</span> <span class="token function">get2score</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> text<span class="token punctuation">)</span><span class="token punctuation">:</span>
            word_list <span class="token operator">=</span> self<span class="token punctuation">.</span>findword<span class="token punctuation">(</span>text<span class="token punctuation">)</span>  <span class="token comment">##查找文本中包含哪些正负情感词，然后分别分别累计它们的数值</span>
            pos_score <span class="token operator">=</span> <span class="token number">0</span>
            pos_word <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            neg_score <span class="token operator">=</span> <span class="token number">0</span>
            neg_word<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token keyword">for</span> word <span class="token keyword">in</span> word_list<span class="token punctuation">:</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>word<span class="token punctuation">.</span>value<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    pos_score <span class="token operator">=</span> pos_score <span class="token operator">+</span> word<span class="token punctuation">.</span>value
                    pos_word<span class="token punctuation">.</span>append<span class="token punctuation">(</span>word<span class="token punctuation">.</span>word<span class="token punctuation">)</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    neg_score <span class="token operator">=</span> neg_score<span class="token operator">+</span>word<span class="token punctuation">.</span>value
                    neg_word<span class="token punctuation">.</span>append<span class="token punctuation">(</span>word<span class="token punctuation">.</span>word<span class="token punctuation">)</span>
            <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"pos_score=%d; neg_score=%d"</span> <span class="token operator">%</span><span class="token punctuation">(</span>pos_score<span class="token punctuation">,</span> neg_score<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token comment">#print('pos_word',pos_word)</span>
            <span class="token comment">#print('neg_word',neg_word)</span>

        <span class="token keyword">def</span> <span class="token function">getscore</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> text<span class="token punctuation">)</span><span class="token punctuation">:</span>
            word_list <span class="token operator">=</span> self<span class="token punctuation">.</span>findword<span class="token punctuation">(</span>text<span class="token punctuation">)</span>  <span class="token comment">##查找文本中包含哪些情感词</span>
            <span class="token comment"># 增加程度副词+否定词</span>
            not_w <span class="token operator">=</span> <span class="token number">1</span>
            not_word <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token keyword">for</span> notword <span class="token keyword">in</span> self<span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>NOT_DICT<span class="token punctuation">:</span>  <span class="token comment"># 否定词</span>
                <span class="token keyword">if</span> notword <span class="token keyword">in</span> text<span class="token punctuation">:</span>
                    not_w <span class="token operator">=</span> not_w <span class="token operator">*</span> <span class="token operator">-</span><span class="token number">1</span>
                    not_word<span class="token punctuation">.</span>append<span class="token punctuation">(</span>notword<span class="token punctuation">)</span>
            degree_word <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token keyword">for</span> degreeword <span class="token keyword">in</span> self<span class="token punctuation">.</span>degree_dict<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> degreeword <span class="token keyword">in</span> text<span class="token punctuation">:</span>
                    degree <span class="token operator">=</span> self<span class="token punctuation">.</span>degree_dict<span class="token punctuation">[</span>degreeword<span class="token punctuation">]</span>
                    <span class="token comment">#polar = polar + degree if polar &gt; 0 else polar - degree</span>
                    degree_word<span class="token punctuation">.</span>append<span class="token punctuation">(</span>degreeword<span class="token punctuation">)</span>
            <span class="token comment"># 7大类找对应感情大类的词语，分别统计分数= 词极性*词权重</span>
            result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token keyword">for</span> key <span class="token keyword">in</span> self<span class="token punctuation">.</span>score_class<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment">#区分7大类</span>
                score <span class="token operator">=</span> <span class="token number">0</span>
                score_words <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
                <span class="token keyword">for</span> word <span class="token keyword">in</span> word_list<span class="token punctuation">:</span>
                    
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">==</span> word<span class="token punctuation">.</span>class_value<span class="token punctuation">)</span><span class="token punctuation">:</span>
                        score <span class="token operator">=</span> score <span class="token operator">+</span> word<span class="token punctuation">.</span>value
                        score_words<span class="token punctuation">.</span>append<span class="token punctuation">(</span>word<span class="token punctuation">.</span>word<span class="token punctuation">)</span>
                <span class="token keyword">if</span> score <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
                    score <span class="token operator">=</span> score <span class="token operator">+</span> degree
                <span class="token keyword">elif</span> score<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">:</span>
                    score <span class="token operator">=</span> score <span class="token operator">-</span> degree  <span class="token comment"># 看分数&gt;0，程度更强； 分数&lt;0,程度减弱？</span>
                score <span class="token operator">=</span> score <span class="token operator">*</span> not_w

                x <span class="token operator">=</span> <span class="token string">'{}_score={}; word={}; nor_word={}; degree_word={};'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> score<span class="token punctuation">,</span> score_words<span class="token punctuation">,</span>not_word<span class="token punctuation">,</span> degree_word<span class="token punctuation">)</span>
                <span class="token keyword">print</span> <span class="token punctuation">(</span>x<span class="token punctuation">)</span>
                result<span class="token punctuation">.</span>append<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
                <span class="token comment">#key + '_score=%d; word=%s; nor_word=%s; degree_word=%s;'% (score, score_words,not_word, degree_word))</span>
            <span class="token keyword">return</span> result

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    sentiment_dict_path <span class="token operator">=</span> <span class="token string">"sentiment_words_chinese.tsv"</span> 
    degree_dict_path <span class="token operator">=</span> <span class="token string">"degree_dict.txt"</span>
    stop_dict_path <span class="token operator">=</span> <span class="token string">"stop_words.txt"</span>

    <span class="token comment">#文件读取</span>
    f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'庆余年220.csv'</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'utf8'</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>f<span class="token punctuation">)</span>

    <span class="token comment">#文件写入</span>
    c <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"Result.csv"</span><span class="token punctuation">,</span> <span class="token string">"a+"</span><span class="token punctuation">,</span> newline<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'gb18030'</span><span class="token punctuation">)</span>
    writer <span class="token operator">=</span> csv<span class="token punctuation">.</span>writer<span class="token punctuation">(</span>c<span class="token punctuation">)</span>
    writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"no"</span><span class="token punctuation">,</span><span class="token string">"review"</span><span class="token punctuation">,</span><span class="token string">"score"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token comment">#分句功能 否定词程度词位置判断</span>
    score <span class="token operator">=</span> Score<span class="token punctuation">(</span>sentiment_dict_path<span class="token punctuation">,</span> degree_dict_path<span class="token punctuation">,</span> stop_dict_path <span class="token punctuation">)</span>

    n <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">for</span> temp <span class="token keyword">in</span> data<span class="token punctuation">[</span><span class="token string">'review'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        tlist <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        words <span class="token operator">=</span> <span class="token punctuation">[</span>x <span class="token keyword">for</span> x <span class="token keyword">in</span> jieba<span class="token punctuation">.</span>cut<span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token comment">#分词</span>
        <span class="token comment">#print(words)     </span>
        words_ <span class="token operator">=</span> score<span class="token punctuation">.</span>remove_stopword<span class="token punctuation">(</span>words<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>words_<span class="token punctuation">)</span>
        
        <span class="token comment">#分词-&gt;情感词间是否有否定词/程度词+前后顺序-&gt;分数累加</span>
        result <span class="token operator">=</span> score<span class="token punctuation">.</span>get2score_position<span class="token punctuation">(</span>words_<span class="token punctuation">)</span>  
        <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
        
        tlist<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>
        tlist<span class="token punctuation">.</span>append<span class="token punctuation">(</span>words<span class="token punctuation">)</span>
        tlist<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span>
        writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span>tlist<span class="token punctuation">)</span>
        n <span class="token operator">=</span> n <span class="token operator">+</span> <span class="token number">1</span>

        <span class="token comment">#句子-&gt; 整句判断否定词/程度词 -&gt; 分正负词</span>
        <span class="token comment">#score.get2score(temp) </span>
        <span class="token comment">#score.getscore(text)</span>
    c<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>输出结果如下图所示，每条评论对应一个情感分析分数，总体效果较好，差评和好评基本能区分，但是有些“白瞎”、“烂”、“难受”、“尴尬”这些特征词没有识别，应该和大连理工情感词典有关。所以我们在情感分析时，是否可以考虑融合多个特征词典呢？</p> 
<p><img src="https://images2.imgbox.com/e6/21/UH2Hff1G_o.png" alt="在这里插入图片描述" width="650" height="350"></p> 
<p>同时，情感分析通常需要和评论时间结合起来，并进行舆情预测等，建议读者尝试将时间结合。比如王树义老师的文章《基于情感分类的竞争企业新闻文本主题挖掘》。我们可以和时间结合绘制相关的趋势图，如果某一天出现很多评论，可以计算该天所有评论的情感分数，求其平均值即可。最后，情感分析的分数最好进行归一化处理，也可以进行评价，比如抓取数据的分为5星评分，则可假设0-0.2位一星，0.2-0.4位二星，0.4-0.6为三星，0.6-0.8为四星，0.8-1.0为五星，这样我们可以计算它的准确率，召回率，F值，从而评论我的算法好坏。</p> 
<p><img src="https://images2.imgbox.com/9c/56/mPIttBim_o.png" alt="在这里插入图片描述" width="650" height="250"></p> 
<p><strong>最后第五部分我用SnowNLP情感分析，并绘制相应的情感分布图，方便大家对比。</strong></p> 
<br> 
<hr> 
<h2><a id="SnowNLP_1342"></a>五.SnowNLP情感分析</h2> 
<p>SnowNLP是一个常用的Python文本分析库，是受到TextBlob启发而发明的。由于当前自然语言处理库基本都是针对英文的，而中文没有空格分割特征词，Python做中文文本挖掘较难，后续开发了一些针对中文处理的库，例如SnowNLP、Jieba、BosonNLP等。注意SnowNLP处理的是unicode编码，所以使用时请自行decode成unicode。</p> 
<p><strong>Snownlp主要功能包括：</strong></p> 
<ul><li>中文分词（算法是Character-Based Generative Model）</li><li>词性标注（原理是TnT、3-gram 隐马）</li><li>情感分析</li><li>文本分类（原理是朴素贝叶斯）</li><li>转换拼音、繁体转简体</li><li>提取文本关键词（原理是TextRank）</li><li>提取摘要（原理是TextRank）、分割句子</li><li>文本相似（原理是BM25）</li></ul> 
<p>安装和其他库一样，使用pip安装即可。</p> 
<p><img src="https://images2.imgbox.com/0a/37/78ZucRP2_o.png" alt="在这里插入图片描述" width="600" height="200"></p> 
<p>SnowNLP情感分析也是基于情感词典实现的，其简单的将文本分为两类，积极和消极，返回值为情绪的概率，越接近1为积极，接近0为消极。下面是简单的实例。</p> 
<pre><code class="prism language-python"><span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token keyword">from</span> snownlp <span class="token keyword">import</span> SnowNLP
s1 <span class="token operator">=</span> SnowNLP<span class="token punctuation">(</span>u<span class="token string">"我今天很开心"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>u<span class="token string">"s1情感分数:"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>s1<span class="token punctuation">.</span>sentiments<span class="token punctuation">)</span>

s2 <span class="token operator">=</span> SnowNLP<span class="token punctuation">(</span>u<span class="token string">"我今天很沮丧"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>u<span class="token string">"s2情感分数:"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>s2<span class="token punctuation">.</span>sentiments<span class="token punctuation">)</span>

s3 <span class="token operator">=</span> SnowNLP<span class="token punctuation">(</span>u<span class="token string">"大傻瓜，你脾气真差，动不动就打人"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>u<span class="token string">"s3情感分数:"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>s3<span class="token punctuation">.</span>sentiments<span class="token punctuation">)</span>
</code></pre> 
<p>输出结果如下所示，当负面情感特征词越多，比如“傻瓜”、“差”、“打人”等，分数就会很低，同样当正免情感词多分数就高。</p> 
<pre><code class="prism language-python">s1情感分数<span class="token punctuation">:</span>
<span class="token number">0.842040189791</span>
s2情感分数<span class="token punctuation">:</span>
<span class="token number">0.648537121839</span>
s3情感分数<span class="token punctuation">:</span>
<span class="token number">0.049546727538</span>
</code></pre> 
<p>而在真实项目中，通常需要根据实际的数据重新训练情感分析的模型，导入正面样本和负面样本，再训练新模型。</p> 
<ul><li>sentiment.train(’./neg.txt’, ‘./pos.txt’)</li><li>sentiment.save(‘sentiment.marshal’)</li></ul> 
<br> 
<p>下面的代码是对《庆余年》电视剧部分评论进行情感分析。在做情感分析的时候，很多论文都是将情感区间从[0, 1.0]转换为[-0.5, 0.5]，这样的曲线更加好看，位于0以上的是积极评论，反之消极评论。最终代码如下：</p> 
<pre><code class="prism language-python"><span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token keyword">from</span> snownlp <span class="token keyword">import</span> SnowNLP
<span class="token keyword">import</span> codecs
<span class="token keyword">import</span> os
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd

<span class="token comment">#获取情感分数</span>
f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'庆余年220.csv'</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'utf8'</span><span class="token punctuation">)</span>
data <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
sentimentslist <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> data<span class="token punctuation">[</span><span class="token string">'review'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
    s <span class="token operator">=</span> SnowNLP<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>sentiments<span class="token punctuation">)</span>
    sentimentslist<span class="token punctuation">.</span>append<span class="token punctuation">(</span>s<span class="token punctuation">.</span>sentiments<span class="token punctuation">)</span>

<span class="token comment">#区间转换为[-0.5, 0.5]</span>
result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
i <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">while</span> i<span class="token operator">&lt;</span><span class="token builtin">len</span><span class="token punctuation">(</span>sentimentslist<span class="token punctuation">)</span><span class="token punctuation">:</span>
    result<span class="token punctuation">.</span>append<span class="token punctuation">(</span>sentimentslist<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">)</span>
    i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>

<span class="token comment">#可视化画图</span>
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">220</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> result<span class="token punctuation">,</span> <span class="token string">'k-'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Number'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'Sentiment'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Analysis of Sentiments'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>绘制图形如下所示，注意它表示每一条评论的情感分布趋势，我们同样可以绘制时间分布的情感趋势图。</p> 
<p><img src="https://images2.imgbox.com/18/6f/EXZzRy3F_o.png" alt="在这里插入图片描述" width="550" height="450"></p> 
<br> 
<p>最后推荐大家阅读作者前文系列：</p> 
<ul><li><a href="https://blog.csdn.net/Eastmount/article/details/104995419">[Pyhon大数据分析] 四.微博话题抓取及情文本挖掘和情感分析</a></li></ul> 
<br> 
<hr> 
<h2><a id="_1447"></a>六.总结</h2> 
<p>写到这里，这篇情感分析的文章就讲解完毕，希望对您有所帮助，尤其是想写文本挖掘论文的读者。后续还会分享深度学习和自然语言处理结合的文章。如果文章对您有所帮助，将是我写作的最大动力。作者将源代码上传至github，大家可以直接下载。你们的支持就是我撰写的最大动力，加油~</p> 
<ul><li>情感分析下载地址：<a href="https://github.com/eastmountyxz/Sentiment-Analysis">https://github.com/eastmountyxz/Sentiment-Analysis</a></li></ul> 
<p>最后，作为人工智能的菜鸟，我希望自己能不断进步并深入，后续将它应用于图像识别、网络安全、对抗样本等领域，指导大家撰写简单的学术论文，一起加油！感谢这些年遇到很多以前进步的博友，共勉~</p> 
<p><img src="https://images2.imgbox.com/d2/6d/OeMRPVRM_o.png" alt="在这里插入图片描述" width="350" height="500"></p> 
<p>(By:Eastmount 2020-08-09 周日中午12点写于武汉 <a href="http://blog.csdn.net/eastmount/">http://blog.csdn.net/eastmount/</a> )</p> 
<br> 
<hr> 
<p><mark>2020年8月18新开的“娜璋AI安全之家”，主要围绕Python大数据分析、网络空间安全、人工智能、Web渗透及攻防技术进行讲解，同时分享CCF、SCI、南核北核论文的算法实现。娜璋之家会更加系统，并重构作者的所有文章，从零讲解Python和安全，写了近十年文章，真心想把自己所学所感所做分享出来，还请各位多多指教，真诚邀请您的关注！谢谢。</mark></p> 
<div align="center"> 
 <img src="https://images2.imgbox.com/fe/6c/cqJM8mRo_o.png" height="20%" width="20%"> 
</div> 
<p><strong>参考文献：</strong></p> 
<p>[1] <a href="https://blog.csdn.net/weixin_38008864/article/details/103900840">大连理工大学中文情感词汇本体库(含情绪分析代码) - 邓旭东老师</a><br> [2] <a href="https://blog.csdn.net/Eastmount/article/details/104995419">[Pyhon大数据分析] 四.微博话题抓取及情文本挖掘和情感分析</a><br> [3] <a href="https://github.com/liuhuanyong/SentimentWordExpansion">https://github.com/liuhuanyong/SentimentWordExpansion</a><br> [4] 感谢学生YX强势指导<br> [5] 王树义老师的文章《基于情感分类的竞争企业新闻文本主题挖掘》</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a959ed03fb637641ad9e688e62e1997c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">SpringBoot项目报错：java.sql.SQLSyntaxErrorException: Unknown database ‘mscode‘</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/de692f00658045eac44f0f56b637bac5/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">马拉车算法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>