<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>springmvc的文件上传和下载 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="springmvc的文件上传和下载" />
<meta property="og:description" content="文章目录 前言一、添加相关配置1、在pom.xml中添加文件上传相关依赖2、配置文件上传解析器(CommonsMultipartResolver)，加在spring-mvc.xml配置文件中的最后(默认是叫springmvc-servlet.xml) 二、相关代码1、参考的数据库表t_file2.实体类File.java3.DAO层FileMapper.java（这里上传主要用到了insert方法）4.DAO层映射文件FileMapper.xml5.service层接口IFileService.java6.service层接口实现类FileServiceImpl.java7.junit测试公用类BaseTestCace.java8.service层接口实现类junit测试类FileServiceImplTest.java9.控制层FileController.java10.视图层index.jsp11.视图层upload.jsp12.视图层success.jsp13.效果图参考 总结 前言 本篇文章主要介绍ssm框架中springmvc的文件上传和下载，上传就是将需要的文件上传到指定目录并将文件信息保存到数据库，下载即到指定目录下载已上传的文件
提示：以下是本篇文章正文内容，下面案例可供参考
一、添加相关配置 1、在pom.xml中添加文件上传相关依赖 &lt;dependency&gt; &lt;groupId&gt;commons-fileupload&lt;/groupId&gt; &lt;artifactId&gt;commons-fileupload&lt;/artifactId&gt; &lt;version&gt;1.3.3&lt;/version&gt; &lt;/dependency&gt; 2、配置文件上传解析器(CommonsMultipartResolver)，加在spring-mvc.xml配置文件中的最后(默认是叫springmvc-servlet.xml) &lt;bean id=&#34;multipartResolver&#34; class=&#34;org.springframework.web.multipart.commons.CommonsMultipartResolver&#34;&gt; &lt;!-- 必须和用户JSP 的pageEncoding属性一致，以便正确解析表单的内容 --&gt; &lt;property name=&#34;defaultEncoding&#34; value=&#34;UTF-8&#34;&gt;&lt;/property&gt; &lt;!-- 文件最大大小(字节) 1024*1024*50=50M--&gt; &lt;property name=&#34;maxUploadSize&#34; value=&#34;52428800&#34;&gt;&lt;/property&gt; &lt;!--resolveLazily属性启用是为了推迟文件解析，以便捕获文件大小异常--&gt; &lt;property name=&#34;resolveLazily&#34; value=&#34;true&#34;/&gt; &lt;/bean&gt; 二、相关代码 1、参考的数据库表t_file create table t_file ( file_id varchar(32) primary key, real_name varchar(50) not null, content_type varchar(50) not null, url varchar(256) not null, update_datetime timestamp NULL default CURRENT_TIMESTAMP -- insert=false ); 2.实体类File.java package com.zking.ssm.model; import lombok." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/60430f76163c530878b0e95b2bfda9f6/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-10-15T23:53:14+08:00" />
<meta property="article:modified_time" content="2021-10-15T23:53:14+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">springmvc的文件上传和下载</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_3" rel="nofollow">前言</a></li><li><a href="#_11" rel="nofollow">一、添加相关配置</a></li><li><ul><li><a href="#1pomxml_12" rel="nofollow">1、在pom.xml中添加文件上传相关依赖</a></li><li><a href="#2CommonsMultipartResolverspringmvcxmlspringmvcservletxml_20" rel="nofollow">2、配置文件上传解析器(CommonsMultipartResolver)，加在spring-mvc.xml配置文件中的最后(默认是叫springmvc-servlet.xml)</a></li></ul> 
  </li><li><a href="#_32" rel="nofollow">二、相关代码</a></li><li><ul><li><a href="#1t_file_33" rel="nofollow">1、参考的数据库表t_file</a></li><li><a href="#2Filejava_44" rel="nofollow">2.实体类File.java</a></li><li><a href="#3DAOFileMapperjavainsert_99" rel="nofollow">3.DAO层FileMapper.java（这里上传主要用到了insert方法）</a></li><li><a href="#4DAOFileMapperxml_115" rel="nofollow">4.DAO层映射文件FileMapper.xml</a></li><li><a href="#5serviceIFileServicejava_215" rel="nofollow">5.service层接口IFileService.java</a></li><li><a href="#6serviceFileServiceImpljava_235" rel="nofollow">6.service层接口实现类FileServiceImpl.java</a></li><li><a href="#7junitBaseTestCacejava_265" rel="nofollow">7.junit测试公用类BaseTestCace.java</a></li><li><a href="#8servicejunitFileServiceImplTestjava_291" rel="nofollow">8.service层接口实现类junit测试类FileServiceImplTest.java</a></li><li><a href="#9FileControllerjava_335" rel="nofollow">9.控制层FileController.java</a></li><li><a href="#10indexjsp_430" rel="nofollow">10.视图层index.jsp</a></li><li><a href="#11uploadjsp_446" rel="nofollow">11.视图层upload.jsp</a></li><li><a href="#12successjsp_464" rel="nofollow">12.视图层success.jsp</a></li><li><a href="#13_481" rel="nofollow">13.效果图参考</a></li></ul> 
  </li><li><a href="#_485" rel="nofollow">总结</a></li></ul> 
</div> 
<p></p> 
<hr color="#000000" size='1"'> 
<h2><a id="_3"></a>前言</h2> 
<p><font color="#999AAA">本篇文章主要介绍ssm框架中springmvc的文件上传和下载，上传就是将需要的文件上传到指定目录并将文件信息保存到数据库，下载即到指定目录下载已上传的文件</font></p> 
<hr color="#000000" size='1"'> 
<p><font color="#999AAA">提示：以下是本篇文章正文内容，下面案例可供参考</font></p> 
<h2><a id="_11"></a>一、添加相关配置</h2> 
<h3><a id="1pomxml_12"></a>1、在pom.xml中添加文件上传相关依赖</h3> 
<pre><code class="prism language-xml"> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>commons-fileupload<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>commons-fileupload<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.3.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h3><a id="2CommonsMultipartResolverspringmvcxmlspringmvcservletxml_20"></a>2、配置文件上传解析器(CommonsMultipartResolver)，加在spring-mvc.xml配置文件中的最后(默认是叫springmvc-servlet.xml)</h3> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>multipartResolver<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.springframework.web.multipart.commons.CommonsMultipartResolver<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- 必须和用户JSP 的pageEncoding属性一致，以便正确解析表单的内容 --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>defaultEncoding<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- 文件最大大小(字节) 1024*1024*50=50M--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>maxUploadSize<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>52428800<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--resolveLazily属性启用是为了推迟文件解析，以便捕获文件大小异常--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>resolveLazily<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h2><a id="_32"></a>二、相关代码</h2> 
<h3><a id="1t_file_33"></a>1、参考的数据库表t_file</h3> 
<pre><code class="prism language-sql"><span class="token keyword">create</span> <span class="token keyword">table</span> t_file
<span class="token punctuation">(</span>
  file_id <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>
  real_name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
  content_type <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
  url <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
  update_datetime <span class="token keyword">timestamp</span> <span class="token boolean">NULL</span> <span class="token keyword">default</span> <span class="token keyword">CURRENT_TIMESTAMP</span>    <span class="token comment">-- insert=false</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="2Filejava_44"></a>2.实体类File.java</h3> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>zking<span class="token punctuation">.</span>ssm<span class="token punctuation">.</span>model</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">ToString</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span><span class="token punctuation">;</span>
<span class="token annotation punctuation">@ToString</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">File</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> fileId<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> realName<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> contentType<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> url<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> updateDatetime<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token class-name">String</span> fileId<span class="token punctuation">,</span> <span class="token class-name">String</span> realName<span class="token punctuation">,</span> <span class="token class-name">String</span> contentType<span class="token punctuation">,</span> <span class="token class-name">String</span> url<span class="token punctuation">,</span> <span class="token class-name">Date</span> updateDatetime<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>fileId <span class="token operator">=</span> fileId<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>realName <span class="token operator">=</span> realName<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>contentType <span class="token operator">=</span> contentType<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>url <span class="token operator">=</span> url<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>updateDatetime <span class="token operator">=</span> updateDatetime<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getFileId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> fileId<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setFileId</span><span class="token punctuation">(</span><span class="token class-name">String</span> fileId<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>fileId <span class="token operator">=</span> fileId<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getRealName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> realName<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setRealName</span><span class="token punctuation">(</span><span class="token class-name">String</span> realName<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>realName <span class="token operator">=</span> realName<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getContentType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> contentType<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token class-name">String</span> contentType<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>contentType <span class="token operator">=</span> contentType<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> url<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUrl</span><span class="token punctuation">(</span><span class="token class-name">String</span> url<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>url <span class="token operator">=</span> url<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token class-name">Date</span> <span class="token function">getUpdateDatetime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> updateDatetime<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUpdateDatetime</span><span class="token punctuation">(</span><span class="token class-name">Date</span> updateDatetime<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>updateDatetime <span class="token operator">=</span> updateDatetime<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="3DAOFileMapperjavainsert_99"></a>3.DAO层FileMapper.java（这里上传主要用到了insert方法）</h3> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>zking<span class="token punctuation">.</span>ssm<span class="token punctuation">.</span>mapper</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>zking<span class="token punctuation">.</span>ssm<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">File</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Repository</span><span class="token punctuation">;</span>
<span class="token annotation punctuation">@Repository</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">FileMapper</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> <span class="token function">deleteByPrimaryKey</span><span class="token punctuation">(</span><span class="token class-name">String</span> fileId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">File</span> <span class="token keyword">record</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> <span class="token function">insertSelective</span><span class="token punctuation">(</span><span class="token class-name">File</span> <span class="token keyword">record</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">File</span> <span class="token function">selectByPrimaryKey</span><span class="token punctuation">(</span><span class="token class-name">String</span> fileId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> <span class="token function">updateByPrimaryKeySelective</span><span class="token punctuation">(</span><span class="token class-name">File</span> <span class="token keyword">record</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> <span class="token function">updateByPrimaryKey</span><span class="token punctuation">(</span><span class="token class-name">File</span> <span class="token keyword">record</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="4DAOFileMapperxml_115"></a>4.DAO层映射文件FileMapper.xml</h3> 
<pre><code class="prism language-java"><span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">"1.0"</span> encoding<span class="token operator">=</span><span class="token string">"UTF-8"</span> <span class="token operator">?</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE mapper PUBLIC <span class="token string">"-//mybatis.org//DTD Mapper 3.0//EN"</span> <span class="token string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span> <span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>mapper namespace<span class="token operator">=</span><span class="token string">"com.zking.ssm.mapper.FileMapper"</span> <span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>resultMap id<span class="token operator">=</span><span class="token string">"BaseResultMap"</span> type<span class="token operator">=</span><span class="token string">"com.zking.ssm.model.File"</span> <span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>constructor <span class="token punctuation">&gt;</span></span>
      <span class="token operator">&lt;</span>idArg column<span class="token operator">=</span><span class="token string">"file_id"</span> jdbcType<span class="token operator">=</span><span class="token string">"VARCHAR"</span> javaType<span class="token operator">=</span><span class="token string">"java.lang.String"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>arg column<span class="token operator">=</span><span class="token string">"real_name"</span> jdbcType<span class="token operator">=</span><span class="token string">"VARCHAR"</span> javaType<span class="token operator">=</span><span class="token string">"java.lang.String"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>arg column<span class="token operator">=</span><span class="token string">"content_type"</span> jdbcType<span class="token operator">=</span><span class="token string">"VARCHAR"</span> javaType<span class="token operator">=</span><span class="token string">"java.lang.String"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>arg column<span class="token operator">=</span><span class="token string">"url"</span> jdbcType<span class="token operator">=</span><span class="token string">"VARCHAR"</span> javaType<span class="token operator">=</span><span class="token string">"java.lang.String"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>arg column<span class="token operator">=</span><span class="token string">"update_datetime"</span> jdbcType<span class="token operator">=</span><span class="token string">"TIMESTAMP"</span> javaType<span class="token operator">=</span><span class="token string">"java.util.Date"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>constructor<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>resultMap<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>sql id<span class="token operator">=</span><span class="token string">"Base_Column_List"</span> <span class="token operator">&gt;</span>
    file_id<span class="token punctuation">,</span> real_name<span class="token punctuation">,</span> content_type<span class="token punctuation">,</span> url<span class="token punctuation">,</span> update_datetime
  <span class="token operator">&lt;</span><span class="token operator">/</span>sql<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>select id<span class="token operator">=</span><span class="token string">"selectByPrimaryKey"</span> resultMap<span class="token operator">=</span><span class="token string">"BaseResultMap"</span> parameterType<span class="token operator">=</span><span class="token string">"java.lang.String"</span> <span class="token operator">&gt;</span>
    select 
    <span class="token operator">&lt;</span>include refid<span class="token operator">=</span><span class="token string">"Base_Column_List"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    from t_file
    where file_id <span class="token operator">=</span> #<span class="token punctuation">{<!-- --></span>fileId<span class="token punctuation">,</span>jdbcType<span class="token operator">=</span>VARCHAR<span class="token punctuation">}</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>select<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>delete id<span class="token operator">=</span><span class="token string">"deleteByPrimaryKey"</span> parameterType<span class="token operator">=</span><span class="token string">"java.lang.String"</span> <span class="token operator">&gt;</span>
    delete from t_file
    where file_id <span class="token operator">=</span> #<span class="token punctuation">{<!-- --></span>fileId<span class="token punctuation">,</span>jdbcType<span class="token operator">=</span>VARCHAR<span class="token punctuation">}</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>delete<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>insert id<span class="token operator">=</span><span class="token string">"insert"</span> parameterType<span class="token operator">=</span><span class="token string">"com.zking.ssm.model.File"</span> <span class="token operator">&gt;</span>
    insert into t_file <span class="token punctuation">(</span>file_id<span class="token punctuation">,</span> real_name<span class="token punctuation">,</span> content_type<span class="token punctuation">,</span> 
      url<span class="token punctuation">)</span>
    values <span class="token punctuation">(</span>#<span class="token punctuation">{<!-- --></span>fileId<span class="token punctuation">,</span>jdbcType<span class="token operator">=</span>VARCHAR<span class="token punctuation">}</span><span class="token punctuation">,</span> #<span class="token punctuation">{<!-- --></span>realName<span class="token punctuation">,</span>jdbcType<span class="token operator">=</span>VARCHAR<span class="token punctuation">}</span><span class="token punctuation">,</span> #<span class="token punctuation">{<!-- --></span>contentType<span class="token punctuation">,</span>jdbcType<span class="token operator">=</span>VARCHAR<span class="token punctuation">}</span><span class="token punctuation">,</span> 
      #<span class="token punctuation">{<!-- --></span>url<span class="token punctuation">,</span>jdbcType<span class="token operator">=</span>VARCHAR<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>insert<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>insert id<span class="token operator">=</span><span class="token string">"insertSelective"</span> parameterType<span class="token operator">=</span><span class="token string">"com.zking.ssm.model.File"</span> <span class="token operator">&gt;</span>
    insert into t_file
    <span class="token operator">&lt;</span>trim prefix<span class="token operator">=</span><span class="token string">"("</span> suffix<span class="token operator">=</span><span class="token string">")"</span> suffixOverrides<span class="token operator">=</span><span class="token string">","</span> <span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token keyword">if</span> test<span class="token operator">=</span><span class="token string">"fileId != null"</span> <span class="token operator">&gt;</span>
        file_id<span class="token punctuation">,</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">if</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token keyword">if</span> test<span class="token operator">=</span><span class="token string">"realName != null"</span> <span class="token operator">&gt;</span>
        real_name<span class="token punctuation">,</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">if</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token keyword">if</span> test<span class="token operator">=</span><span class="token string">"contentType != null"</span> <span class="token operator">&gt;</span>
        content_type<span class="token punctuation">,</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">if</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token keyword">if</span> test<span class="token operator">=</span><span class="token string">"url != null"</span> <span class="token operator">&gt;</span>
        url<span class="token punctuation">,</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">if</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token keyword">if</span> test<span class="token operator">=</span><span class="token string">"updateDatetime != null"</span> <span class="token operator">&gt;</span>
        update_datetime<span class="token punctuation">,</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">if</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>trim<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>trim prefix<span class="token operator">=</span><span class="token string">"values ("</span> suffix<span class="token operator">=</span><span class="token string">")"</span> suffixOverrides<span class="token operator">=</span><span class="token string">","</span> <span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token keyword">if</span> test<span class="token operator">=</span><span class="token string">"fileId != null"</span> <span class="token operator">&gt;</span>
        #<span class="token punctuation">{<!-- --></span>fileId<span class="token punctuation">,</span>jdbcType<span class="token operator">=</span>VARCHAR<span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">if</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token keyword">if</span> test<span class="token operator">=</span><span class="token string">"realName != null"</span> <span class="token operator">&gt;</span>
        #<span class="token punctuation">{<!-- --></span>realName<span class="token punctuation">,</span>jdbcType<span class="token operator">=</span>VARCHAR<span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">if</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token keyword">if</span> test<span class="token operator">=</span><span class="token string">"contentType != null"</span> <span class="token operator">&gt;</span>
        #<span class="token punctuation">{<!-- --></span>contentType<span class="token punctuation">,</span>jdbcType<span class="token operator">=</span>VARCHAR<span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">if</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token keyword">if</span> test<span class="token operator">=</span><span class="token string">"url != null"</span> <span class="token operator">&gt;</span>
        #<span class="token punctuation">{<!-- --></span>url<span class="token punctuation">,</span>jdbcType<span class="token operator">=</span>VARCHAR<span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">if</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token keyword">if</span> test<span class="token operator">=</span><span class="token string">"updateDatetime != null"</span> <span class="token operator">&gt;</span>
        #<span class="token punctuation">{<!-- --></span>updateDatetime<span class="token punctuation">,</span>jdbcType<span class="token operator">=</span>TIMESTAMP<span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">if</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>trim<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>insert<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>update id<span class="token operator">=</span><span class="token string">"updateByPrimaryKeySelective"</span> parameterType<span class="token operator">=</span><span class="token string">"com.zking.ssm.model.File"</span> <span class="token operator">&gt;</span>
    update t_file
    <span class="token generics"><span class="token punctuation">&lt;</span>set <span class="token punctuation">&gt;</span></span>
      <span class="token operator">&lt;</span><span class="token keyword">if</span> test<span class="token operator">=</span><span class="token string">"realName != null"</span> <span class="token operator">&gt;</span>
        real_name <span class="token operator">=</span> #<span class="token punctuation">{<!-- --></span>realName<span class="token punctuation">,</span>jdbcType<span class="token operator">=</span>VARCHAR<span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">if</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token keyword">if</span> test<span class="token operator">=</span><span class="token string">"contentType != null"</span> <span class="token operator">&gt;</span>
        content_type <span class="token operator">=</span> #<span class="token punctuation">{<!-- --></span>contentType<span class="token punctuation">,</span>jdbcType<span class="token operator">=</span>VARCHAR<span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">if</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token keyword">if</span> test<span class="token operator">=</span><span class="token string">"url != null"</span> <span class="token operator">&gt;</span>
        url <span class="token operator">=</span> #<span class="token punctuation">{<!-- --></span>url<span class="token punctuation">,</span>jdbcType<span class="token operator">=</span>VARCHAR<span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">if</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token keyword">if</span> test<span class="token operator">=</span><span class="token string">"updateDatetime != null"</span> <span class="token operator">&gt;</span>
        update_datetime <span class="token operator">=</span> #<span class="token punctuation">{<!-- --></span>updateDatetime<span class="token punctuation">,</span>jdbcType<span class="token operator">=</span>TIMESTAMP<span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">if</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>set<span class="token operator">&gt;</span>
    where file_id <span class="token operator">=</span> #<span class="token punctuation">{<!-- --></span>fileId<span class="token punctuation">,</span>jdbcType<span class="token operator">=</span>VARCHAR<span class="token punctuation">}</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>update<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>update id<span class="token operator">=</span><span class="token string">"updateByPrimaryKey"</span> parameterType<span class="token operator">=</span><span class="token string">"com.zking.ssm.model.File"</span> <span class="token operator">&gt;</span>
    update t_file
    set real_name <span class="token operator">=</span> #<span class="token punctuation">{<!-- --></span>realName<span class="token punctuation">,</span>jdbcType<span class="token operator">=</span>VARCHAR<span class="token punctuation">}</span><span class="token punctuation">,</span>
      content_type <span class="token operator">=</span> #<span class="token punctuation">{<!-- --></span>contentType<span class="token punctuation">,</span>jdbcType<span class="token operator">=</span>VARCHAR<span class="token punctuation">}</span><span class="token punctuation">,</span>
      url <span class="token operator">=</span> #<span class="token punctuation">{<!-- --></span>url<span class="token punctuation">,</span>jdbcType<span class="token operator">=</span>VARCHAR<span class="token punctuation">}</span><span class="token punctuation">,</span>
      update_datetime <span class="token operator">=</span> #<span class="token punctuation">{<!-- --></span>updateDatetime<span class="token punctuation">,</span>jdbcType<span class="token operator">=</span>TIMESTAMP<span class="token punctuation">}</span>
    where file_id <span class="token operator">=</span> #<span class="token punctuation">{<!-- --></span>fileId<span class="token punctuation">,</span>jdbcType<span class="token operator">=</span>VARCHAR<span class="token punctuation">}</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>update<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>mapper<span class="token operator">&gt;</span>  
</code></pre> 
<h3><a id="5serviceIFileServicejava_215"></a>5.service层接口IFileService.java</h3> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>zking<span class="token punctuation">.</span>ssm<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>transaction<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Transactional</span><span class="token punctuation">;</span>
<span class="token annotation punctuation">@Transactional</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IFileService</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">/**
     * 文件上传
     * @param file  文件对象
     */</span>
    <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>zking<span class="token punctuation">.</span>ssm<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span>File</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/**
     * 查询所有文件
     * @param fileId 文件id
     * @return  文件对象
     */</span>
    <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>zking<span class="token punctuation">.</span>ssm<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span>File</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token class-name">String</span> fileId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="6serviceFileServiceImpljava_235"></a>6.service层接口实现类FileServiceImpl.java</h3> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>zking<span class="token punctuation">.</span>ssm<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>zking<span class="token punctuation">.</span>ssm<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">FileMapper</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>zking<span class="token punctuation">.</span>ssm<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">File</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>zking<span class="token punctuation">.</span>ssm<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">IFileService</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span><span class="token punctuation">;</span>
<span class="token comment">/**
 * @ClassName FileServiceImpl
 * @Description TODO
 * @Author Yan
 * @Date 2021-10-14 17:39
 **/</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FileServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">IFileService</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">FileMapper</span> fileMapper<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">File</span> file<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        fileMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">File</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token class-name">String</span> fileId<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> fileMapper<span class="token punctuation">.</span><span class="token function">selectByPrimaryKey</span><span class="token punctuation">(</span>fileId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="7junitBaseTestCacejava_265"></a>7.junit测试公用类BaseTestCace.java</h3> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>zking<span class="token punctuation">.</span>ssm<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>zking<span class="token punctuation">.</span>ssm<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">PageBean</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Before</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runner<span class="token punctuation">.</span></span><span class="token class-name">RunWith</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">ContextConfiguration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span>junit4<span class="token punctuation">.</span></span><span class="token class-name">SpringJUnit4ClassRunner</span><span class="token punctuation">;</span>
<span class="token comment">/**
 * @ClassName BaseTestCase
 * @Description TODO
 * @Author Yan
 * @Date 2021-10-08 21:33
 **/</span>
<span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringJUnit4ClassRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ContextConfiguration</span><span class="token punctuation">(</span>locations<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">"classpath:spring.xml"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BaseTestCase</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">protected</span> <span class="token class-name">PageBean</span> pageBean<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Before</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        pageBean<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">PageBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="8servicejunitFileServiceImplTestjava_291"></a>8.service层接口实现类junit测试类FileServiceImplTest.java</h3> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>zking<span class="token punctuation">.</span>ssm<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>databind<span class="token punctuation">.</span></span><span class="token class-name">Module</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>zking<span class="token punctuation">.</span>ssm<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">File</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>zking<span class="token punctuation">.</span>ssm<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">IFileService</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>UUID<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Assert</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FileServiceImplTest</span> <span class="token keyword">extends</span> <span class="token class-name">BaseTestCase</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">IFileService</span> fileService<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>zking<span class="token punctuation">.</span>ssm<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span>File</span> file<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">setUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        file<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">String</span> fileId<span class="token operator">=</span>UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"-"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> realName<span class="token operator">=</span><span class="token string">"aaff.jpg"</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> str<span class="token operator">=</span>realName<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>realName<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> contentType<span class="token operator">=</span><span class="token string">"jpg/png/image"</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> url<span class="token operator">=</span><span class="token string">"E:\\temp\\uploads\\"</span><span class="token operator">+</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span>str<span class="token punctuation">;</span>

        file<span class="token punctuation">.</span><span class="token function">setFileId</span><span class="token punctuation">(</span>fileId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        file<span class="token punctuation">.</span><span class="token function">setRealName</span><span class="token punctuation">(</span>realName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        file<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span>contentType<span class="token punctuation">)</span><span class="token punctuation">;</span>
        file<span class="token punctuation">.</span><span class="token function">setUrl</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileService<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        file<span class="token punctuation">.</span><span class="token function">setFileId</span><span class="token punctuation">(</span><span class="token string">"6201e5fbf89043f58fde090775bb6be6"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">File</span> load <span class="token operator">=</span> fileService<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">getFileId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>load<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="9FileControllerjava_335"></a>9.控制层FileController.java</h3> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>zking<span class="token punctuation">.</span>ssm<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>zking<span class="token punctuation">.</span>ssm<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">File</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>zking<span class="token punctuation">.</span>ssm<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">IFileService</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">FileUtils</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpHeaders</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpStatus</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">MediaType</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">ResponseEntity</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Controller</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>ui<span class="token punctuation">.</span></span><span class="token class-name">Model</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>ui<span class="token punctuation">.</span></span><span class="token class-name">ModelMap</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestParam</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>multipart<span class="token punctuation">.</span></span><span class="token class-name">MultipartFile</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletRequest</span><span class="token punctuation">;</span>
<span class="token comment">//import java.io.File;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>UUID<span class="token punctuation">;</span>
<span class="token comment">/**
 * @ClassName FileController
 * @Description TODO
 * @Author Yan
 * @Date 2021-10-14 18:05
 **/</span>
<span class="token annotation punctuation">@Controller</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/file"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FileController</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">IFileService</span> fileService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/toUpload"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toUpload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token string">"upload"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/upload"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">upload</span><span class="token punctuation">(</span><span class="token class-name">MultipartFile</span> img<span class="token punctuation">,</span> <span class="token class-name">ModelMap</span> model<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{<!-- --></span>
     <span class="token comment">//1.将文件信息保存到数据库</span>
        <span class="token comment">//设置文件id</span>
        <span class="token class-name">String</span> fileId<span class="token operator">=</span> UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"-"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取到上传文件的真实文件名</span>
        <span class="token class-name">String</span> realName<span class="token operator">=</span>img<span class="token punctuation">.</span><span class="token function">getOriginalFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//截取到真实文件名的后缀名，并且使用时间戳重命名新文件组成最后上传文件的文件名</span>
        <span class="token class-name">String</span> str<span class="token operator">=</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span>realName<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>realName<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取到文件的类型</span>
        <span class="token class-name">String</span> contentType<span class="token operator">=</span>img<span class="token punctuation">.</span><span class="token function">getContentType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//设置上传文件的上传路径</span>
        <span class="token class-name">String</span> url<span class="token operator">=</span><span class="token string">"E:\\temp\\uploads\\"</span><span class="token operator">+</span>str<span class="token punctuation">;</span>

        <span class="token comment">//实例化文件对象，将文件信息保存到数据库</span>
        <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>zking<span class="token punctuation">.</span>ssm<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span>File</span> file<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        file<span class="token punctuation">.</span><span class="token function">setFileId</span><span class="token punctuation">(</span>fileId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        file<span class="token punctuation">.</span><span class="token function">setRealName</span><span class="token punctuation">(</span>realName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        file<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span>contentType<span class="token punctuation">)</span><span class="token punctuation">;</span>
        file<span class="token punctuation">.</span><span class="token function">setUrl</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileService<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>

     <span class="token comment">//2.将文件写入到文件服务器</span>
        <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>File</span> targetFile<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>File</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
        img<span class="token punctuation">.</span><span class="token function">transferTo</span><span class="token punctuation">(</span>targetFile<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//将上传的文件路径、真实文件名和文件名存到作用域</span>
        model<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"url"</span><span class="token punctuation">,</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
        model<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"realName"</span><span class="token punctuation">,</span>realName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        model<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"str"</span><span class="token punctuation">,</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">"success"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/download"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResponseEntity</span><span class="token operator">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token function">download</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">String</span> fileName<span class="token punctuation">,</span> <span class="token class-name">Model</span> model<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>

        <span class="token comment">//下载文件路径</span>
        <span class="token class-name">String</span> realPath <span class="token operator">=</span><span class="token string">"E:\\temp\\uploads\\"</span><span class="token punctuation">;</span>
        <span class="token comment">//创建文件对象</span>
        <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>File</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>File</span><span class="token punctuation">(</span>realPath<span class="token operator">+</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>File</span><span class="token punctuation">.</span>separator<span class="token operator">+</span>fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//设置响应头</span>
        <span class="token class-name">HttpHeaders</span> headers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//解决中文乱码问题</span>
        <span class="token class-name">String</span> downloadFileName <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>fileName<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"ISO-8859-1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//通知浏览器下载文件</span>
        headers<span class="token punctuation">.</span><span class="token function">setContentDispositionFormData</span><span class="token punctuation">(</span><span class="token string">"attachment"</span><span class="token punctuation">,</span>downloadFileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//以二进制文件流的形式下载文件数据</span>
        headers<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span>APPLICATION_OCTET_STREAM<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//返回封装后的下载数据</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ResponseEntity</span><span class="token operator">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token class-name">FileUtils</span><span class="token punctuation">.</span><span class="token function">readFileToByteArray</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">,</span>headers<span class="token punctuation">,</span> <span class="token class-name">HttpStatus</span><span class="token punctuation">.</span>CREATED<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="10indexjsp_430"></a>10.视图层index.jsp</h3> 
<pre><code class="prism language-java"><span class="token operator">&lt;</span><span class="token operator">%</span>@ page contentType<span class="token operator">=</span><span class="token string">"text/html;charset=UTF-8"</span> language<span class="token operator">=</span><span class="token string">"java"</span> <span class="token operator">%</span><span class="token operator">&gt;</span>
<span class="token generics"><span class="token punctuation">&lt;</span>html<span class="token punctuation">&gt;</span></span>
<span class="token generics"><span class="token punctuation">&lt;</span>head<span class="token punctuation">&gt;</span></span>
    <span class="token generics"><span class="token punctuation">&lt;</span>title<span class="token punctuation">&gt;</span></span><span class="token class-name">Title</span><span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>jsp<span class="token operator">:</span>include page<span class="token operator">=</span><span class="token string">"/common/head.jsp"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>jsp<span class="token operator">:</span>include<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span>
<span class="token generics"><span class="token punctuation">&lt;</span>body<span class="token punctuation">&gt;</span></span>
    <span class="token generics"><span class="token punctuation">&lt;</span>div<span class="token punctuation">&gt;</span></span>
        <span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"${ctx}/file/toUpload"</span><span class="token operator">&gt;</span>图片上传<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span>
</code></pre> 
<h3><a id="11uploadjsp_446"></a>11.视图层upload.jsp</h3> 
<pre><code class="prism language-java"><span class="token operator">&lt;</span><span class="token operator">%</span>@ page contentType<span class="token operator">=</span><span class="token string">"text/html;charset=UTF-8"</span> language<span class="token operator">=</span><span class="token string">"java"</span> <span class="token operator">%</span><span class="token operator">&gt;</span>
<span class="token generics"><span class="token punctuation">&lt;</span>html<span class="token punctuation">&gt;</span></span>
<span class="token generics"><span class="token punctuation">&lt;</span>head<span class="token punctuation">&gt;</span></span>
    <span class="token generics"><span class="token punctuation">&lt;</span>title<span class="token punctuation">&gt;</span></span><span class="token class-name">Title</span><span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>jsp<span class="token operator">:</span>include page<span class="token operator">=</span><span class="token string">"/common/head.jsp"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>jsp<span class="token operator">:</span>include<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span>
<span class="token generics"><span class="token punctuation">&lt;</span>body<span class="token punctuation">&gt;</span></span>
    <span class="token generics"><span class="token punctuation">&lt;</span>h1<span class="token punctuation">&gt;</span></span>文件上传<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>form action<span class="token operator">=</span><span class="token string">"${ctx}/file/upload"</span> enctype<span class="token operator">=</span><span class="token string">"multipart/form-data"</span> method<span class="token operator">=</span><span class="token string">"post"</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"file"</span> name<span class="token operator">=</span><span class="token string">"img"</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"submit"</span> value<span class="token operator">=</span><span class="token string">"上传"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span>

</code></pre> 
<h3><a id="12successjsp_464"></a>12.视图层success.jsp</h3> 
<pre><code class="prism language-java"><span class="token operator">&lt;</span><span class="token operator">%</span>@ page contentType<span class="token operator">=</span><span class="token string">"text/html;charset=UTF-8"</span> language<span class="token operator">=</span><span class="token string">"java"</span> <span class="token operator">%</span><span class="token operator">&gt;</span>
<span class="token generics"><span class="token punctuation">&lt;</span>html<span class="token punctuation">&gt;</span></span>
<span class="token generics"><span class="token punctuation">&lt;</span>head<span class="token punctuation">&gt;</span></span>
    <span class="token operator">&lt;</span>jsp<span class="token operator">:</span>include page<span class="token operator">=</span><span class="token string">"/common/head.jsp"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>jsp<span class="token operator">:</span>include<span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>title<span class="token punctuation">&gt;</span></span>文件上传成功<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span>
<span class="token generics"><span class="token punctuation">&lt;</span>body<span class="token punctuation">&gt;</span></span>
<span class="token generics"><span class="token punctuation">&lt;</span>h1<span class="token punctuation">&gt;</span></span>文件上传成功！<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
真实文件名$<span class="token punctuation">{<!-- --></span>realName<span class="token punctuation">}</span><span class="token generics"><span class="token punctuation">&lt;</span>br<span class="token punctuation">&gt;</span></span>
文件路径$<span class="token punctuation">{<!-- --></span>url<span class="token punctuation">}</span><span class="token generics"><span class="token punctuation">&lt;</span>br<span class="token punctuation">&gt;</span></span>
加时间戳的文件名$<span class="token punctuation">{<!-- --></span>str<span class="token punctuation">}</span><span class="token generics"><span class="token punctuation">&lt;</span>br<span class="token punctuation">&gt;</span></span>
<span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"${ctx}/file/download?fileName=${str}"</span><span class="token operator">&gt;</span>$<span class="token punctuation">{<!-- --></span>str<span class="token punctuation">}</span>下载<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span>
</code></pre> 
<h3><a id="13_481"></a>13.效果图参考</h3> 
<p><img src="https://images2.imgbox.com/3c/db/BkE3Cpq8_o.png" alt="请添加图片描述"></p> 
<h2><a id="_485"></a>总结</h2> 
<font color="#999AAA"> 以上就是今天要讲的内容，本文简单介绍了springMVC中文件上传和下载的使用，需要注意的是表单提交方式为method="post" enctype="multipart/form-data"，文件项需要用spring提供的MultipartFile进行接收 </font>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c4c09d6663cc249a85683b32edb05f0e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">IDEA切换主题(换背景颜色)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/31b071f97d843a53004f64c5482395fa/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">2021-10-16【严蔚敏数据结构代码实现合集】【c语言学习必备】</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>