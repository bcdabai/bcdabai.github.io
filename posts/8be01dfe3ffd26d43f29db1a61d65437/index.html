<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>《树莓派4B家庭服务器搭建指南》第二十一期：安装开源远程桌面服务rustdesk, 内网丝滑,外网流畅控制 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="《树莓派4B家庭服务器搭建指南》第二十一期：安装开源远程桌面服务rustdesk, 内网丝滑,外网流畅控制" />
<meta property="og:description" content="title: 《树莓派4B家庭服务器搭建指南》第二十一期：安装开源远程桌面服务rustdesk, 内网丝滑,外网流畅控制Windows,macOS,Linux设备
tags:
个人成长
categories:树莓派不吃灰 前段时间, 有一台老式MacBook Pro被我改造成了影视资源解码主机, 《树莓派4B家庭服务器搭建指南》第十七期：树莓派配合性能更好的闲置笔记本搭建开源免费jellyfin私人影院 https://v2fy.com/p/2023-06-10-jellyfin-1686388142000/ , 我想通过远程桌面访问这台MacBook Pro, 发现Mac虽然原生支持VNC连接，但实际用起来经常画面撕裂，于是我找了一款开源的远程桌面程序rustdesk, 将其服务部署在树莓派上，实现局域网设备丝滑访问, 外网设备也可以通过内网穿透直接访问macOS
rustdesk 的Github开源地址 https://github.com/rustdesk/rustdesk
在树莓派部署rustdesk，实现局域网Windows控制macOS # 创建挂载目录 mkdir -p /opt/rustdesk chmod 755 -R /opt/rustdesk # 创建用于存放docker-compose.yml的目录 mkdir -p /opt/rustdesk-docker-compose-yml chmod 755 -R /opt/rustdesk-docker-compose-yml # 创建docker-compose.yml touch /opt/rustdesk-docker-compose-yml/docker-compose.yml 在docker-compose.yml中写入配置内容
cat &lt;&lt; &#39;EOF&#39; &gt; /opt/rustdesk-docker-compose-yml/docker-compose.yml version: &#39;3&#39; networks: rustdesk-net: external: false services: hbbs: container_name: hbbs ports: - 21115:21115 - 21116:21116 - 21116:21116/udp - 21118:21118 image: rustdesk/rustdesk-server:latest command: hbbs -r rustdesk." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/8be01dfe3ffd26d43f29db1a61d65437/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-09-12T15:01:07+08:00" />
<meta property="article:modified_time" content="2023-09-12T15:01:07+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">《树莓派4B家庭服务器搭建指南》第二十一期：安装开源远程桌面服务rustdesk, 内网丝滑,外网流畅控制</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <hr> 
<p>title: 《树莓派4B家庭服务器搭建指南》第二十一期：安装开源远程桌面服务rustdesk, 内网丝滑,外网流畅控制Windows,macOS,Linux设备<br> tags:</p> 
<ul><li>个人成长<br> categories:</li><li>树莓派不吃灰</li></ul> 
<hr> 
<p>前段时间, 有一台老式MacBook Pro被我改造成了影视资源解码主机, <a href="https://v2fy.com/p/2023-06-10-jellyfin-1686388142000/" rel="nofollow">《树莓派4B家庭服务器搭建指南》第十七期：树莓派配合性能更好的闲置笔记本搭建开源免费jellyfin私人影院 https://v2fy.com/p/2023-06-10-jellyfin-1686388142000/</a> , 我想通过远程桌面访问这台MacBook Pro, 发现Mac虽然原生支持VNC连接，但实际用起来经常画面撕裂，于是我找了一款开源的远程桌面程序rustdesk, 将其服务部署在树莓派上，实现局域网设备丝滑访问, 外网设备也可以通过内网穿透直接访问macOS</p> 
<p>rustdesk 的Github开源地址 https://github.com/rustdesk/rustdesk</p> 
<h3><a id="rustdeskWindowsmacOS_12"></a>在树莓派部署rustdesk，实现局域网Windows控制macOS</h3> 
<pre><code># 创建挂载目录
mkdir -p /opt/rustdesk
chmod 755 -R /opt/rustdesk
# 创建用于存放docker-compose.yml的目录
mkdir -p /opt/rustdesk-docker-compose-yml
chmod 755 -R /opt/rustdesk-docker-compose-yml
# 创建docker-compose.yml
touch /opt/rustdesk-docker-compose-yml/docker-compose.yml 
</code></pre> 
<p>在<code>docker-compose.yml</code>中写入配置内容</p> 
<pre><code>cat &lt;&lt; 'EOF' &gt; /opt/rustdesk-docker-compose-yml/docker-compose.yml
version: '3'

networks:
  rustdesk-net:
    external: false

services:
  hbbs:
    container_name: hbbs
    ports:
      - 21115:21115
      - 21116:21116
      - 21116:21116/udp
      - 21118:21118
    image: rustdesk/rustdesk-server:latest
    command: hbbs -r rustdesk.example.com:21117
    volumes:
      - /opt/rustdesk:/root
    networks:
      - rustdesk-net
    depends_on:
      - hbbr
    restart: unless-stopped

  hbbr:
    container_name: hbbr
    ports:
      - 21117:21117
      - 21119:21119
    image: rustdesk/rustdesk-server:latest
    command: hbbr
    volumes:
      - /opt/rustdesk:/root
    networks:
      - rustdesk-net
    restart: unless-stopped
EOF
</code></pre> 
<ul><li>启动服务</li></ul> 
<pre><code>cd /opt/rustdesk-docker-compose-yml/
sudo docker-compose up -d
</code></pre> 
<p><img src="https://images2.imgbox.com/f6/37/MurLsHo0_o.png" alt="image-20230912100942170"></p> 
<p>我的树莓派局域网IP为<code>192.168.50.10</code>, 将<code>192.168.50.10</code> 填入rustdesk 的客户端即可（发起端和被控端都需要下载安装rustdesk客户端，并填写好ID Server）, rustdesk客户端下载地址 https://github.com/rustdesk/rustdesk/releases</p> 
<p><img src="https://images2.imgbox.com/cd/93/uSiBsSvi_o.png" alt="image-20230912101426079"></p> 
<p>客户端保存后，会显示配置成功</p> 
<p><img src="https://images2.imgbox.com/61/fc/sdO5u4ZC_o.png" alt="image-20230912101459339"></p> 
<p>配置完成后，我们就可以通过树莓派运行的rustdesk服务，进行局域网内设备相互远程控制了</p> 
<p><img src="https://images2.imgbox.com/72/71/Mkm4DdaX_o.png" alt="image-20230912102038004"></p> 
<p>被控制主机的ID不会变（除非用户主动改），但密码经常会随机变化，如果你想使用固定密码，可以直接按照下图进行设置</p> 
<p><img src="https://images2.imgbox.com/29/5c/yLWZR7YN_o.png" alt="image-20230912102601840"></p> 
<p><img src="https://images2.imgbox.com/7e/0f/IRKzTjlA_o.png" alt="image-20230912102727070"></p> 
<p>显示方面可以自定义设置，局域网的延迟可以到5ms, 用Windows控制macOS非常顺滑跟手</p> 
<p><img src="https://images2.imgbox.com/46/a7/7sFwFu1o_o.png" alt="image-20230912103259426"></p> 
<p>遇到的一个小坑：如果MacBook不外接显示器合上盖子，rustdesk经常会几十秒就自动断开，如果你也是想控制MacBook，请不要合上盖子。</p> 
<h3><a id="rustdesk_109"></a>让家里树莓派的rustdesk服务支持外网访问</h3> 
<p>外网访问其实也很简单，用frp做几个端口映射就好了</p> 
<p><img src="https://images2.imgbox.com/76/e0/EiJX2lN5_o.png" alt="image-20230912111138990"></p> 
<ul><li>在树莓派的frpc.ini文件中新增以下配置，重启frpc即可</li></ul> 
<pre><code>[rustdesk-tcp-21115]
type = tcp
local_ip = 127.0.0.1
local_port = 21115
remote_port = 21115


[rustdesk-tcp-21116]
type = tcp
local_ip = 127.0.0.1
local_port = 21116
remote_port = 21116


[rustdesk-udp-21116]
type = udp
local_ip = 127.0.0.1
local_port = 21116
remote_port = 21116


[rustdesk-tcp-21117]
type = tcp
local_ip = 127.0.0.1
local_port = 21117
remote_port = 21117


[rustdesk-tcp-21118]
type = tcp
local_ip = 127.0.0.1
local_port = 21118
remote_port = 21118


[rustdesk-tcp-21119]
type = tcp
local_ip = 127.0.0.1
local_port = 21119
remote_port = 21119
</code></pre> 
<p>如果想让<strong>内网主机A</strong>可以接收外网连接，我们需要将<strong>内网主机A</strong>的ID server设置为云服务器IP（云服务器的IP为公网IP, 会接收请求，并转发到树莓派）</p> 
<p>当然，外网发起控制的主机，也要设置外网IP, 才能发起控制。</p> 
<p><img src="https://images2.imgbox.com/e8/53/pb7gA0b1_o.png" alt="image-20230912135153485"></p> 
<p>如果<strong>发起控制端</strong>在家庭内网环境下，可以将<strong>ID server</strong> 设置为树莓派内网IP，也可以设置为<strong>云服务器公网IP</strong></p> 
<h3><a id="rustdesk_178"></a>直接将rustdesk服务放到服务器运行不就好了，为何要放在树莓派运行？</h3> 
<p>rustdesk有两个服务，hbbs负责验证签名，hbbr负责转发远程控制产生的数据包。</p> 
<p><img src="https://images2.imgbox.com/ca/0d/GlJzhpB7_o.png" alt="170487506-8ef1f025-ad42-47f9-8d82-b49d0ec759ad"></p> 
<p>我们在设置界面，只填写了hbbs信息（ID server） ，没有填写hbbr信息，hbbr就会自动判断是否走公网流量。</p> 
<p>如果我们的<strong>被控主机</strong>和<strong>发起控制的主机</strong>都在内网，二者就会直接走内网流量，体验将无比丝滑。</p> 
<p>当然控制端或被控端，一旦离开了内网，就走云服务器转发流量。</p> 
<p><img src="https://images2.imgbox.com/5d/e4/Bflsb3d0_o.png" alt="image-20230912141949102"></p> 
<p><strong>那ID server到底应该怎么填</strong>？</p> 
<p>只要在外网，控制端和被控制端，一律填写外网IP！</p> 
<p>如果在内网，控制端和被控端，依然可以全部填写外网IP；（如果被控端和控制端设备同时在内网，会自动走内网流量，无比顺滑）</p> 
<p>如果某台设备，只希望被内网的设备连接，则填写内网IP!</p> 
<p>(内网IP是指树莓派IP, 外网IP是指云服务器IP)</p> 
<h3><a id="_209"></a>小结</h3> 
<p>我看到有些youtuber把mac mini改成了家庭服务器，由于macOS对VNC协议的负优化，导致画面撕裂，于是只能捏着鼻子用ssh连接服务器，但我感觉放弃macOS顺滑的动画太可惜了, 于是就有了树莓派运行开源rustdesk的方案。</p> 
<p>虽然有Teamviewer , ToDesk , 向日葵等方案，但都无法实现内网丝滑流畅的远程桌面体验。</p> 
<p>这个树莓派rustdesk方案保证了远程桌面内网丝滑，外网流畅，即使没有树莓派，也可以通过虚拟机运行rustdesk服务器实现，让老旧的MacBook焕发流光溢彩。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9d21d1ac0318aa7f9e160f44d8520abc/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">scss的&amp;-</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/621698fe9aa55c9cddf9367e19796d67/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">C&#43;&#43;中的双冒号(::) 使用小结</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>