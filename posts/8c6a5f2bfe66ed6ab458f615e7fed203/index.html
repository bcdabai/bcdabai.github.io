<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【delphi】类和记录的 helpers（助手） - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【delphi】类和记录的 helpers（助手）" />
<meta property="og:description" content="类和记录的 helpers（助手） 前言一、关于类和记录的 helpers（助手）二、helpers（助手）语法定义三、定义Helpers（助手）总结附： helpers（助手）实际应用A、Delphi原生的JSON操作助手实现TJSONObject 的Helper 单元：使用样例： 前言 Delphi 从XE版本开始提供类和记录的 Helper（助手） 封装，这样就可以很方便的在不修改原来类或者记录的原始定义情况下，给类和记录增加新的功能。 本文简要介绍 Helper 的实现，最后实际举例实现了TJSONObject的Helper,让使用delphi原生的JSON对象也能像SuperObject一样书写方式操作。 一、关于类和记录的 helpers（助手） Helpers(助手)是一种不使用继承的方法来扩充类或者记录的功能，对于记录类型更是有用，因为类可以通过继承来增加功能二记录不可以继承。适用于一些没有源代码或者源代码不适合进行变更的类的扩展。对于自己原始设计的程序，不应该使用这种类的扩展方法，应该始终依赖于普通的类继承和接口实现。
二、helpers（助手）语法定义 type identifierName = class|record helper [(ancestor list)] for TypeIdentifierName memberList end; ancestor list 是可选的，而且只能适用于类Helpers；助手类型不能声明实例数据，但允许使用类字段（class fields）；其他可见性范围规则和成员列表语法与普通类和记录类型相同。
例如：
type TJSONObjectHelper = class helper for TJSONObject 注意：类和记录Helpers不支持运算符重载。
可以定义多个辅助helpers（助手）并将其与单个类型关联。但是，只有零个或一个helpers（助手）起作用，这决定于助手定义的单元引入的位置。类或记录助手作用域是以正常的Delphi方式确定的（例如，在单元的uses子句中从右到左）。
三、定义Helpers（助手） 下面的代码演示类助手的声明（记录助手的行为方式相同）：
type TMyClass = class procedure MyProc; function MyFunc: Integer; end; ... procedure TMyClass.MyProc; var X: Integer; begin X := MyFunc; end; function TMyClass.MyFunc: Integer; begin ." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/8c6a5f2bfe66ed6ab458f615e7fed203/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-06-19T16:40:19+08:00" />
<meta property="article:modified_time" content="2021-06-19T16:40:19+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【delphi】类和记录的 helpers（助手）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>类和记录的 helpers（助手）</h4> 
 <ul><li><a href="#_8" rel="nofollow">前言</a></li><li><a href="#_helpers_19" rel="nofollow">一、关于类和记录的 helpers（助手）</a></li><li><a href="#helpers_26" rel="nofollow">二、helpers（助手）语法定义</a></li><li><a href="#Helpers_48" rel="nofollow">三、定义Helpers（助手）</a></li><li><a href="#_104" rel="nofollow">总结</a></li><li><a href="#_helpers_109" rel="nofollow">附： helpers（助手）实际应用</a></li><li><ul><li><a href="#ADelphiJSON_110" rel="nofollow">A、Delphi原生的JSON操作助手实现</a></li><li><ul><li><ul><li><ul><li><a href="#TJSONObject_Helper__121" rel="nofollow">TJSONObject 的Helper 单元：</a></li><li><a href="#_362" rel="nofollow">使用样例：</a></li></ul> 
    </li></ul> 
   </li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<hr color="#000000" size='1"'> 
<h2><a id="_8"></a>前言</h2> 
<font color="#009AAA">         Delphi 从XE版本开始提供类和记录的 Helper（助手） 封装，这样就可以很方便的在不修改原来类或者记录的原始定义情况下，给类和记录增加新的功能。 本文简要介绍 Helper 的实现，最后实际举例实现了TJSONObject的Helper,让使用delphi原生的JSON对象也能像SuperObject一样书写方式操作。 </font> 
<hr color="#000000" size='1"'> 
<h2><a id="_helpers_19"></a>一、关于类和记录的 helpers（助手）</h2> 
<p><font color="#999CAA">        Helpers(助手)是一种不使用继承的方法来扩充类或者记录的功能，对于记录类型更是有用，因为类可以通过继承来增加功能二记录不可以继承。适用于一些没有源代码或者源代码不适合进行变更的类的扩展。对于自己原始设计的程序，不应该使用这种类的扩展方法，应该始终依赖于普通的类继承和接口实现。</font></p> 
<h2><a id="helpers_26"></a>二、helpers（助手）语法定义</h2> 
<pre><code class="prism language-csharp">type
   identifierName <span class="token operator">=</span> <span class="token keyword">class</span><span class="token operator">|</span>record helper <span class="token punctuation">[</span><span class="token punctuation">(</span>ancestor list<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">for</span> <span class="token class-name">TypeIdentifierName</span>
     memberList
   end<span class="token punctuation">;</span>

</code></pre> 
<p>ancestor list 是可选的，而且只能适用于类Helpers；助手类型不能声明实例数据，但允许使用类字段（class fields）；其他可见性范围规则和成员列表语法与普通类和记录类型相同。</p> 
<p>例如：</p> 
<pre><code class="prism language-csharp">type
  TJSONObjectHelper <span class="token operator">=</span> <span class="token keyword">class</span> helper <span class="token keyword">for</span> TJSONObject
</code></pre> 
<p><strong>注意：类和记录Helpers不支持运算符重载。</strong><br> 可以定义多个辅助helpers（助手）并将其与单个类型关联。但是，只有零个或一个helpers（助手）起作用，这决定于助手定义的单元引入的位置。类或记录助手作用域是以正常的Delphi方式确定的（例如，在单元的uses子句中从右到左）。</p> 
<h2><a id="Helpers_48"></a>三、定义Helpers（助手）</h2> 
<p>下面的代码演示类助手的声明（记录助手的行为方式相同）：</p> 
<pre><code class="prism language-csharp">type
    TMyClass <span class="token operator">=</span> <span class="token keyword">class</span>
       procedure MyProc<span class="token punctuation">;</span>
       function  MyFunc<span class="token punctuation">:</span> Integer<span class="token punctuation">;</span>
    end<span class="token punctuation">;</span>
 
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
 
    procedure TMyClass<span class="token punctuation">.</span>MyProc<span class="token punctuation">;</span>
    <span class="token keyword">var</span> X<span class="token punctuation">:</span> Integer<span class="token punctuation">;</span>
    begin
       X <span class="token punctuation">:</span><span class="token operator">=</span> MyFunc<span class="token punctuation">;</span>
    end<span class="token punctuation">;</span>
 
    function TMyClass<span class="token punctuation">.</span>MyFunc<span class="token punctuation">:</span> Integer<span class="token punctuation">;</span>
    begin
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    end<span class="token punctuation">;</span>
 
 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
 
 type
    TMyClassHelper <span class="token operator">=</span> <span class="token keyword">class</span> helper <span class="token keyword">for</span> <span class="token class-name">TMyClass</span>
      procedure HelloWorld<span class="token punctuation">;</span>
      function MyFunc<span class="token punctuation">:</span> Integer<span class="token punctuation">;</span>
    end<span class="token punctuation">;</span>
 
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
 
    procedure TMyClassHelper<span class="token punctuation">.</span>HelloWorld<span class="token punctuation">;</span>
    begin
       <span class="token function">Writeln</span><span class="token punctuation">(</span>Self<span class="token punctuation">.</span>ClassName<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Self refers to TMyClass type, not TMyClassHelper</span>
    end<span class="token punctuation">;</span>
 
    function TMyClassHelper<span class="token punctuation">.</span>MyFunc<span class="token punctuation">:</span> Integer<span class="token punctuation">;</span>
    begin
      <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    end<span class="token punctuation">;</span>
 
 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
 
 <span class="token keyword">var</span>
   X<span class="token punctuation">:</span> TMyClass<span class="token punctuation">;</span>
 begin
   X <span class="token punctuation">:</span><span class="token operator">=</span> TMyClass<span class="token punctuation">.</span>Create<span class="token punctuation">;</span>
   X<span class="token punctuation">.</span>MyProc<span class="token punctuation">;</span>    <span class="token comment">// 调用 TMyClass.MyProc</span>
   X<span class="token punctuation">.</span>HelloWorld<span class="token punctuation">;</span> <span class="token comment">// 调用 TMyClassHelper.HelloWorld</span>
   X<span class="token punctuation">.</span>MyFunc<span class="token punctuation">;</span>    <span class="token comment">// 调用 TMyClassHelper.MyFunc</span>

</code></pre> 
<p><strong>提示：请记住，调用类助手函数MyFunc是因为类助手优先于实际的类类型。</strong></p> 
<h2><a id="_104"></a>总结</h2> 
<p><font color="#009AAA"> 1. Helpers语法定义：TJSONObjectHelper = class <strong>helper for</strong> TJSONObject<br><br> 2.定义好Helper单元后，需要在使用的单元中引用，Helper（助手）才会起作用；<br><br> 3.Helper是一种类的扩展方法，但不是设计时使用的方法，原始设计应该始终依赖于普通的类继承和接口实现。</font></p> 
<h2><a id="_helpers_109"></a>附： helpers（助手）实际应用</h2> 
<h3><a id="ADelphiJSON_110"></a>A、Delphi原生的JSON操作助手实现</h3> 
<p>使用Delphi的朋友都知道，三方JSON处理单元SuperObject.pas非常有名气，特别是操作JSON对象的方法非常简单。例如：jo.S[‘Name’] := ‘sensor’，或者 i := jo.I[‘age’]，非常方便。但是delphi原生的操作起来，代码就多很多，例如：jo.TryGetValue(‘Name’,js)，才能取出值，书写的代码比较多，繁琐，那么通过给TJSONObject 增加一个Helper（助手）就可以实现和SuperObject一样的操作方法。</p> 
<p>S[]：表示字符串<br> I[]：表示整型数<br> I64[]：表示int63<br> D[]：表示日期<br> A[]：表示数组<br> O[]：表示TJSONObject对象<br> B[]：表示逻辑值</p> 
<h6><a id="TJSONObject_Helper__121"></a>TJSONObject 的Helper 单元：</h6> 
<pre><code class="prism language-csharp"><span class="token punctuation">{<!-- --></span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
时间：<span class="token number">2021</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">18</span>
功能：<span class="token number">1</span> 实现delphi原生的JSON操作为 S<span class="token punctuation">[</span><span class="token punctuation">]</span> 操作方式
作者：sensor
<span class="token punctuation">}</span>
unit uSZHN_JSON<span class="token punctuation">;</span>

<span class="token keyword">interface</span>
uses
  <span class="token comment">//System.Classes,</span>
  <span class="token comment">//System.Types,</span>
  <span class="token comment">//System.DateUtil,</span>
  <span class="token comment">//System.Generics.Collections,</span>
  <span class="token comment">//System.SysUtils,</span>
  System<span class="token punctuation">.</span>JSON<span class="token punctuation">;</span>

type
  TJSONObjectHelper <span class="token operator">=</span> <span class="token keyword">class</span> helper <span class="token keyword">for</span> <span class="token class-name">TJSONObject</span>
    <span class="token keyword">private</span>
       function  <span class="token function">Get_ValueS</span><span class="token punctuation">(</span>PairName <span class="token punctuation">:</span> <span class="token keyword">string</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">string</span><span class="token punctuation">;</span>
       procedure <span class="token function">Set_ValueS</span><span class="token punctuation">(</span>PairName<span class="token punctuation">,</span>PairValue <span class="token punctuation">:</span> <span class="token keyword">string</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       function  <span class="token function">Get_ValueI</span><span class="token punctuation">(</span>PairName <span class="token punctuation">:</span> <span class="token keyword">string</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> Integer<span class="token punctuation">;</span>
       procedure <span class="token function">Set_ValueI</span><span class="token punctuation">(</span>PairName <span class="token punctuation">:</span> <span class="token keyword">string</span><span class="token punctuation">;</span> PairValue <span class="token punctuation">:</span> Integer<span class="token punctuation">)</span><span class="token punctuation">;</span>

       function  <span class="token function">Get_ValueI64</span><span class="token punctuation">(</span>PairName <span class="token punctuation">:</span> <span class="token keyword">string</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> Int64<span class="token punctuation">;</span>
       procedure <span class="token function">Set_ValueI64</span><span class="token punctuation">(</span>PairName <span class="token punctuation">:</span> <span class="token keyword">string</span><span class="token punctuation">;</span> PairValue <span class="token punctuation">:</span> Int64<span class="token punctuation">)</span><span class="token punctuation">;</span>

       function  <span class="token function">Get_ValueD</span><span class="token punctuation">(</span>PairName <span class="token punctuation">:</span> <span class="token keyword">string</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> TDateTime<span class="token punctuation">;</span>
       procedure <span class="token function">Set_ValueD</span><span class="token punctuation">(</span>PairName <span class="token punctuation">:</span> <span class="token keyword">string</span><span class="token punctuation">;</span> PairValue <span class="token punctuation">:</span> TDateTime<span class="token punctuation">)</span><span class="token punctuation">;</span>

       function  <span class="token function">Get_ValueB</span><span class="token punctuation">(</span>PairName <span class="token punctuation">:</span> <span class="token keyword">string</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> Boolean<span class="token punctuation">;</span>
       procedure <span class="token function">Set_ValueB</span><span class="token punctuation">(</span>PairName <span class="token punctuation">:</span> <span class="token keyword">string</span><span class="token punctuation">;</span> PairValue <span class="token punctuation">:</span> Boolean<span class="token punctuation">)</span><span class="token punctuation">;</span>

       function  <span class="token function">Get_ValueA</span><span class="token punctuation">(</span>PairName <span class="token punctuation">:</span> <span class="token keyword">string</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> TJSONArray<span class="token punctuation">;</span>
       procedure <span class="token function">Set_ValueA</span><span class="token punctuation">(</span>PairName <span class="token punctuation">:</span> <span class="token keyword">string</span><span class="token punctuation">;</span> PairValue <span class="token punctuation">:</span> TJSONArray<span class="token punctuation">)</span><span class="token punctuation">;</span>

       function  <span class="token function">Get_ValueO</span><span class="token punctuation">(</span>PairName <span class="token punctuation">:</span> <span class="token keyword">string</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> TJSONObject<span class="token punctuation">;</span>
       procedure <span class="token function">Set_ValueO</span><span class="token punctuation">(</span>PairName <span class="token punctuation">:</span> <span class="token keyword">string</span><span class="token punctuation">;</span> PairValue <span class="token punctuation">:</span> TJSONObject<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span>
      <span class="token comment">//判断某个字段是否存在</span>
      function <span class="token function">PairExists</span><span class="token punctuation">(</span>PairName <span class="token punctuation">:</span> <span class="token keyword">string</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> Boolean<span class="token punctuation">;</span>

      <span class="token comment">//定义字段读取函数</span>
      property S<span class="token punctuation">[</span><span class="token class-name">PairName</span> <span class="token punctuation">:</span> <span class="token keyword">string</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token keyword">string</span>      read <span class="token class-name">Get_ValueS</span>   write Set_ValueS<span class="token punctuation">;</span>
      property I<span class="token punctuation">[</span><span class="token class-name">PairName</span> <span class="token punctuation">:</span> <span class="token keyword">string</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> integer     read <span class="token class-name">Get_ValueI</span>   write Set_ValueI<span class="token punctuation">;</span>
      property I64<span class="token punctuation">[</span><span class="token class-name">PairName</span> <span class="token punctuation">:</span> <span class="token keyword">string</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token class-name">Int64</span>     read <span class="token class-name">Get_ValueI64</span> write Set_ValueI64<span class="token punctuation">;</span>
      property D<span class="token punctuation">[</span><span class="token class-name">PairName</span> <span class="token punctuation">:</span> <span class="token keyword">string</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token class-name">TDateTime</span>   read <span class="token class-name">Get_ValueD</span>   write Set_ValueD<span class="token punctuation">;</span>
      property B<span class="token punctuation">[</span><span class="token class-name">PairName</span> <span class="token punctuation">:</span> <span class="token keyword">string</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token class-name">Boolean</span>     read <span class="token class-name">Get_ValueB</span>   write Set_ValueB<span class="token punctuation">;</span>
      property A<span class="token punctuation">[</span><span class="token class-name">PairName</span> <span class="token punctuation">:</span> <span class="token keyword">string</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token class-name">TJSONArray</span>  read <span class="token class-name">Get_ValueA</span>   write Set_ValueA<span class="token punctuation">;</span>
      property O<span class="token punctuation">[</span><span class="token class-name">PairName</span> <span class="token punctuation">:</span> <span class="token keyword">string</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token class-name">TJSONObject</span> read <span class="token class-name">Get_ValueO</span>   write Set_ValueO<span class="token punctuation">;</span>
  end<span class="token punctuation">;</span>

implementation

<span class="token punctuation">{<!-- --></span> TJSONObjectHelper <span class="token punctuation">}</span>



function TJSONObjectHelper<span class="token punctuation">.</span><span class="token function">Get_ValueS</span><span class="token punctuation">(</span>PairName<span class="token punctuation">:</span> <span class="token keyword">string</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">string</span><span class="token punctuation">;</span>
<span class="token keyword">var</span>
  js <span class="token punctuation">:</span> TJSONString<span class="token punctuation">;</span>
begin
  <span class="token keyword">if</span> PairName <span class="token operator">=</span> <span class="token string">''</span> then  Exit<span class="token punctuation">;</span>

  <span class="token keyword">if</span> Self<span class="token punctuation">.</span><span class="token function">TryGetValue</span><span class="token punctuation">(</span>PairName<span class="token punctuation">,</span>js<span class="token punctuation">)</span> then
     Result <span class="token punctuation">:</span><span class="token operator">=</span> js<span class="token punctuation">.</span><span class="token class-name">Value</span>
  <span class="token keyword">else</span>
     Result <span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
end<span class="token punctuation">;</span>

function TJSONObjectHelper<span class="token punctuation">.</span><span class="token function">PairExists</span><span class="token punctuation">(</span>PairName<span class="token punctuation">:</span> <span class="token keyword">string</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Boolean<span class="token punctuation">;</span>
begin
  Result <span class="token punctuation">:</span><span class="token operator">=</span> Self<span class="token punctuation">.</span>Values<span class="token punctuation">[</span><span class="token class-name">PairName</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span><span class="token operator">&gt;</span> nil<span class="token punctuation">;</span>
end<span class="token punctuation">;</span>

procedure TJSONObjectHelper<span class="token punctuation">.</span><span class="token function">Set_ValueS</span><span class="token punctuation">(</span>PairName<span class="token punctuation">,</span> PairValue<span class="token punctuation">:</span> <span class="token keyword">string</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span>
  js <span class="token punctuation">:</span> TJSONString<span class="token punctuation">;</span>
begin
  <span class="token comment">//1. 首先查找有没有该字段, 如果有，则直接删除</span>
  <span class="token keyword">if</span> Self<span class="token punctuation">.</span><span class="token function">TryGetValue</span><span class="token punctuation">(</span>PairName<span class="token punctuation">,</span>js<span class="token punctuation">)</span> then
     begin
       Self<span class="token punctuation">.</span><span class="token function">RemovePair</span><span class="token punctuation">(</span>PairName<span class="token punctuation">)</span><span class="token punctuation">.</span>Free<span class="token punctuation">;</span> <span class="token comment">//如果没有free，就会产生内存泄露</span>
     end<span class="token punctuation">;</span>
  <span class="token comment">//2. 然后在增加</span>
  Self<span class="token punctuation">.</span><span class="token function">AddPair</span><span class="token punctuation">(</span>PairName<span class="token punctuation">,</span> PairValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
end<span class="token punctuation">;</span>

function TJSONObjectHelper<span class="token punctuation">.</span><span class="token function">Get_ValueI</span><span class="token punctuation">(</span>PairName<span class="token punctuation">:</span> <span class="token keyword">string</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Integer<span class="token punctuation">;</span>
<span class="token keyword">var</span>
  ji <span class="token punctuation">:</span> TJSONNumber<span class="token punctuation">;</span>
begin
  <span class="token keyword">if</span> PairName <span class="token operator">=</span> <span class="token string">''</span> then  <span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> Self<span class="token punctuation">.</span><span class="token function">TryGetValue</span><span class="token punctuation">(</span>PairName<span class="token punctuation">,</span>ji<span class="token punctuation">)</span> then
     Result <span class="token punctuation">:</span><span class="token operator">=</span> ji<span class="token punctuation">.</span><span class="token class-name">AsInt</span>
  <span class="token keyword">else</span>
     Result <span class="token punctuation">:</span><span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
end<span class="token punctuation">;</span>

procedure TJSONObjectHelper<span class="token punctuation">.</span><span class="token function">Set_ValueI</span><span class="token punctuation">(</span>PairName<span class="token punctuation">:</span> <span class="token keyword">string</span><span class="token punctuation">;</span> PairValue<span class="token punctuation">:</span> Integer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span>
  jn <span class="token punctuation">:</span> TJSONNumber<span class="token punctuation">;</span>
begin
  <span class="token comment">//1. 首先查找有没有该字段, 如果有，则直接删除</span>
  <span class="token keyword">if</span> Self<span class="token punctuation">.</span><span class="token function">TryGetValue</span><span class="token punctuation">(</span>PairName<span class="token punctuation">,</span>jn<span class="token punctuation">)</span> then
     Self<span class="token punctuation">.</span><span class="token function">RemovePair</span><span class="token punctuation">(</span>PairName<span class="token punctuation">)</span><span class="token punctuation">.</span>Free<span class="token punctuation">;</span>
  <span class="token comment">//2. 然后在增加</span>
  Self<span class="token punctuation">.</span><span class="token function">AddPair</span><span class="token punctuation">(</span>PairName<span class="token punctuation">,</span> TJSONNumber<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span>PairValue<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
end<span class="token punctuation">;</span>

function TJSONObjectHelper<span class="token punctuation">.</span><span class="token function">Get_ValueD</span><span class="token punctuation">(</span>PairName<span class="token punctuation">:</span> <span class="token keyword">string</span><span class="token punctuation">)</span><span class="token punctuation">:</span> TDateTime<span class="token punctuation">;</span>
<span class="token keyword">var</span>
  ji <span class="token punctuation">:</span> TJSONNumber<span class="token punctuation">;</span>
begin
  <span class="token keyword">if</span> PairName <span class="token operator">=</span> <span class="token string">''</span> then  <span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> Self<span class="token punctuation">.</span><span class="token function">TryGetValue</span><span class="token punctuation">(</span>PairName<span class="token punctuation">,</span>ji<span class="token punctuation">)</span> then
     Result <span class="token punctuation">:</span><span class="token operator">=</span> ji<span class="token punctuation">.</span><span class="token class-name">AsDouble</span>
  <span class="token keyword">else</span>
     Result <span class="token punctuation">:</span><span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
end<span class="token punctuation">;</span>

procedure TJSONObjectHelper<span class="token punctuation">.</span><span class="token function">Set_ValueD</span><span class="token punctuation">(</span>PairName<span class="token punctuation">:</span> <span class="token keyword">string</span><span class="token punctuation">;</span> PairValue<span class="token punctuation">:</span> TDateTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span>
  jn <span class="token punctuation">:</span> TJSONNumber<span class="token punctuation">;</span>
begin
  <span class="token comment">//1. 首先查找有没有该字段, 如果有，则直接删除</span>
  <span class="token keyword">if</span> Self<span class="token punctuation">.</span><span class="token function">TryGetValue</span><span class="token punctuation">(</span>PairName<span class="token punctuation">,</span>jn<span class="token punctuation">)</span> then
     Self<span class="token punctuation">.</span><span class="token function">RemovePair</span><span class="token punctuation">(</span>PairName<span class="token punctuation">)</span><span class="token punctuation">.</span>Free<span class="token punctuation">;</span>
  Self<span class="token punctuation">.</span><span class="token function">AddPair</span><span class="token punctuation">(</span>PairName<span class="token punctuation">,</span> TJSONNumber<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span>PairValue<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
end<span class="token punctuation">;</span>


function TJSONObjectHelper<span class="token punctuation">.</span><span class="token function">Get_ValueB</span><span class="token punctuation">(</span>PairName<span class="token punctuation">:</span> <span class="token keyword">string</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Boolean<span class="token punctuation">;</span>
<span class="token keyword">var</span>
  jb <span class="token punctuation">:</span> TJSONBool<span class="token punctuation">;</span>
begin
  <span class="token keyword">if</span> PairName <span class="token operator">=</span> <span class="token string">''</span> then  <span class="token function">Exit</span><span class="token punctuation">(</span>False<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> Self<span class="token punctuation">.</span><span class="token function">TryGetValue</span><span class="token punctuation">(</span>PairName<span class="token punctuation">,</span>jb<span class="token punctuation">)</span> then
     Result <span class="token punctuation">:</span><span class="token operator">=</span> jb<span class="token punctuation">.</span><span class="token class-name">AsBoolean</span>
  <span class="token keyword">else</span>
     Result <span class="token punctuation">:</span><span class="token operator">=</span> False<span class="token punctuation">;</span>
end<span class="token punctuation">;</span>

procedure TJSONObjectHelper<span class="token punctuation">.</span><span class="token function">Set_ValueB</span><span class="token punctuation">(</span>PairName<span class="token punctuation">:</span> <span class="token keyword">string</span><span class="token punctuation">;</span> PairValue<span class="token punctuation">:</span> Boolean<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span>
  jb <span class="token punctuation">:</span> TJSONBool<span class="token punctuation">;</span>
begin
  <span class="token comment">//1. 首先查找有没有该字段, 如果有，则直接删除</span>
  <span class="token keyword">if</span> Self<span class="token punctuation">.</span><span class="token function">TryGetValue</span><span class="token punctuation">(</span>PairName<span class="token punctuation">,</span>jb<span class="token punctuation">)</span> then
     Self<span class="token punctuation">.</span><span class="token function">RemovePair</span><span class="token punctuation">(</span>PairName<span class="token punctuation">)</span><span class="token punctuation">.</span>Free<span class="token punctuation">;</span>
  Self<span class="token punctuation">.</span><span class="token function">AddPair</span><span class="token punctuation">(</span>PairName<span class="token punctuation">,</span> TJSONBool<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span>PairValue<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
end<span class="token punctuation">;</span>


function TJSONObjectHelper<span class="token punctuation">.</span><span class="token function">Get_ValueI64</span><span class="token punctuation">(</span>PairName<span class="token punctuation">:</span> <span class="token keyword">string</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Int64<span class="token punctuation">;</span>
<span class="token keyword">var</span>
  ji <span class="token punctuation">:</span> TJSONNumber<span class="token punctuation">;</span>
begin
  <span class="token keyword">if</span> PairName <span class="token operator">=</span> <span class="token string">''</span> then  <span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> Self<span class="token punctuation">.</span><span class="token function">TryGetValue</span><span class="token punctuation">(</span>PairName<span class="token punctuation">,</span>ji<span class="token punctuation">)</span> then
     Result <span class="token punctuation">:</span><span class="token operator">=</span> ji<span class="token punctuation">.</span><span class="token class-name">AsInt64</span>
  <span class="token keyword">else</span>
     Result <span class="token punctuation">:</span><span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
end<span class="token punctuation">;</span>


procedure TJSONObjectHelper<span class="token punctuation">.</span><span class="token function">Set_ValueI64</span><span class="token punctuation">(</span>PairName<span class="token punctuation">:</span> <span class="token keyword">string</span><span class="token punctuation">;</span> PairValue<span class="token punctuation">:</span> Int64<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span>
  jn <span class="token punctuation">:</span> TJSONNumber<span class="token punctuation">;</span>
begin
  <span class="token comment">//1. 首先查找有没有该字段, 如果有，则直接删除</span>
  <span class="token keyword">if</span> Self<span class="token punctuation">.</span><span class="token function">TryGetValue</span><span class="token punctuation">(</span>PairName<span class="token punctuation">,</span>jn<span class="token punctuation">)</span> then
     Self<span class="token punctuation">.</span><span class="token function">RemovePair</span><span class="token punctuation">(</span>PairName<span class="token punctuation">)</span><span class="token punctuation">.</span>Free<span class="token punctuation">;</span>
  Self<span class="token punctuation">.</span><span class="token function">AddPair</span><span class="token punctuation">(</span>PairName<span class="token punctuation">,</span> TJSONNumber<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span>PairValue<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
end<span class="token punctuation">;</span>





function TJSONObjectHelper<span class="token punctuation">.</span><span class="token function">Get_ValueA</span><span class="token punctuation">(</span>PairName<span class="token punctuation">:</span> <span class="token keyword">string</span><span class="token punctuation">)</span><span class="token punctuation">:</span> TJSONArray<span class="token punctuation">;</span>
<span class="token keyword">var</span>
  ja <span class="token punctuation">:</span> TJSONArray<span class="token punctuation">;</span>
begin
  <span class="token keyword">if</span> PairName <span class="token operator">=</span> <span class="token string">''</span> then  <span class="token function">Exit</span><span class="token punctuation">(</span>nil<span class="token punctuation">)</span><span class="token punctuation">;</span>

  Self<span class="token punctuation">.</span><span class="token function">TryGetValue</span><span class="token punctuation">(</span>PairName<span class="token punctuation">,</span>Result<span class="token punctuation">)</span><span class="token punctuation">;</span>
end<span class="token punctuation">;</span>





procedure TJSONObjectHelper<span class="token punctuation">.</span><span class="token function">Set_ValueA</span><span class="token punctuation">(</span>PairName<span class="token punctuation">:</span> <span class="token keyword">string</span><span class="token punctuation">;</span> PairValue<span class="token punctuation">:</span> TJSONArray<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span>
  ja <span class="token punctuation">:</span> TJSONArray<span class="token punctuation">;</span>
begin
  <span class="token comment">//1. 首先查找有没有该字段, 如果有，则直接删除</span>
  <span class="token keyword">if</span> Self<span class="token punctuation">.</span><span class="token function">TryGetValue</span><span class="token punctuation">(</span>PairName<span class="token punctuation">,</span>ja<span class="token punctuation">)</span> then
     Self<span class="token punctuation">.</span><span class="token function">RemovePair</span><span class="token punctuation">(</span>PairName<span class="token punctuation">)</span><span class="token punctuation">.</span>Free<span class="token punctuation">;</span>

  Self<span class="token punctuation">.</span><span class="token function">AddPair</span><span class="token punctuation">(</span>PairName<span class="token punctuation">,</span> PairValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
end<span class="token punctuation">;</span>


function TJSONObjectHelper<span class="token punctuation">.</span><span class="token function">Get_ValueO</span><span class="token punctuation">(</span>PairName<span class="token punctuation">:</span> <span class="token keyword">string</span><span class="token punctuation">)</span><span class="token punctuation">:</span> TJSONObject<span class="token punctuation">;</span>
<span class="token keyword">var</span>
  jo <span class="token punctuation">:</span> TJSONObject<span class="token punctuation">;</span>
begin
  <span class="token keyword">if</span> PairName <span class="token operator">=</span> <span class="token string">''</span> then  <span class="token function">Exit</span><span class="token punctuation">(</span>nil<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> Self<span class="token punctuation">.</span><span class="token function">TryGetValue</span><span class="token punctuation">(</span>PairName<span class="token punctuation">,</span>jo<span class="token punctuation">)</span> then
     Result <span class="token punctuation">:</span><span class="token operator">=</span> jo
  <span class="token keyword">else</span>
     Result <span class="token punctuation">:</span><span class="token operator">=</span> nil<span class="token punctuation">;</span>
end<span class="token punctuation">;</span>

procedure TJSONObjectHelper<span class="token punctuation">.</span><span class="token function">Set_ValueO</span><span class="token punctuation">(</span>PairName<span class="token punctuation">:</span> <span class="token keyword">string</span><span class="token punctuation">;</span> PairValue<span class="token punctuation">:</span> TJSONObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span>
  jo <span class="token punctuation">:</span> TJSONObject<span class="token punctuation">;</span>
begin
  <span class="token comment">//1. 首先查找有没有该字段, 如果有，则直接删除</span>
  <span class="token keyword">if</span> Self<span class="token punctuation">.</span><span class="token function">TryGetValue</span><span class="token punctuation">(</span>PairName<span class="token punctuation">,</span>jo<span class="token punctuation">)</span> then
     Self<span class="token punctuation">.</span><span class="token function">RemovePair</span><span class="token punctuation">(</span>PairName<span class="token punctuation">)</span><span class="token punctuation">.</span>Free<span class="token punctuation">;</span>
  Self<span class="token punctuation">.</span><span class="token function">AddPair</span><span class="token punctuation">(</span>PairName<span class="token punctuation">,</span> <span class="token class-name">PairValue</span> <span class="token keyword">as</span> TJSONObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
end<span class="token punctuation">;</span>

end<span class="token punctuation">.</span>
</code></pre> 
<h6><a id="_362"></a>使用样例：</h6> 
<pre><code class="prism language-csharp">uses
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
	uSZHN_JSON<span class="token punctuation">;</span>

function TForm1<span class="token punctuation">.</span>Create_JSON<span class="token punctuation">:</span> <span class="token keyword">string</span><span class="token punctuation">;</span>
<span class="token keyword">var</span>
 jo<span class="token punctuation">,</span>jo1 <span class="token punctuation">:</span> TJSONObject<span class="token punctuation">;</span>
 ja <span class="token punctuation">:</span> TJSONArray<span class="token punctuation">;</span>

begin
  jo  <span class="token punctuation">:</span><span class="token operator">=</span> TJSONObject<span class="token punctuation">.</span>Create<span class="token punctuation">;</span>
  jo1  <span class="token punctuation">:</span><span class="token operator">=</span> TJSONObject<span class="token punctuation">.</span>Create<span class="token punctuation">;</span>
  <span class="token comment">//ja := TJSONArray.Create;</span>
  <span class="token keyword">try</span>
    jo<span class="token punctuation">.</span>S<span class="token punctuation">[</span><span class="token string">'Name'</span><span class="token punctuation">]</span> <span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">'sensor'</span><span class="token punctuation">;</span>
    jo<span class="token punctuation">.</span>S<span class="token punctuation">[</span><span class="token string">'Name'</span><span class="token punctuation">]</span> <span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">'sensor11'</span><span class="token punctuation">;</span>   <span class="token comment">//重复字段，内容以最后一个为准</span>


    jo<span class="token punctuation">.</span>I<span class="token punctuation">[</span><span class="token string">'age'</span><span class="token punctuation">]</span>  <span class="token punctuation">:</span><span class="token operator">=</span> <span class="token number">54</span><span class="token punctuation">;</span>
    jo<span class="token punctuation">.</span>I<span class="token punctuation">[</span><span class="token string">'age'</span><span class="token punctuation">]</span>  <span class="token punctuation">:</span><span class="token operator">=</span> <span class="token number">64</span><span class="token punctuation">;</span>	<span class="token comment">//按照最后一个</span>

    jo<span class="token punctuation">.</span>D<span class="token punctuation">[</span><span class="token string">'birth'</span><span class="token punctuation">]</span> <span class="token punctuation">:</span><span class="token operator">=</span> now<span class="token punctuation">;</span>
    jo<span class="token punctuation">.</span>B<span class="token punctuation">[</span><span class="token string">'worked'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token operator">=</span> True<span class="token punctuation">;</span>
    jo<span class="token punctuation">.</span>I64<span class="token punctuation">[</span><span class="token string">'money'</span><span class="token punctuation">]</span> <span class="token punctuation">:</span><span class="token operator">=</span> $<span class="token number">7F</span>F1F2F3F4F5F6F7<span class="token punctuation">;</span>  <span class="token comment">//大数据</span>


    jo<span class="token punctuation">.</span>O<span class="token punctuation">[</span><span class="token string">'OBJ'</span><span class="token punctuation">]</span> <span class="token punctuation">:</span><span class="token operator">=</span> TJSONObject<span class="token punctuation">.</span>Create<span class="token punctuation">;</span>
    jo<span class="token punctuation">.</span>O<span class="token punctuation">[</span><span class="token string">'OBJ'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>S<span class="token punctuation">[</span><span class="token string">'AAAA'</span><span class="token punctuation">]</span> <span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">'1200'</span><span class="token punctuation">;</span>

    jo<span class="token punctuation">.</span>O<span class="token punctuation">[</span><span class="token string">'jjoo11'</span><span class="token punctuation">]</span> <span class="token punctuation">:</span><span class="token operator">=</span> jo1<span class="token punctuation">;</span>
    jo1<span class="token punctuation">.</span><span class="token function">AddPair</span><span class="token punctuation">(</span><span class="token string">'ABC'</span><span class="token punctuation">,</span><span class="token string">'ABC1000'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    jo<span class="token punctuation">.</span>a<span class="token punctuation">[</span><span class="token string">'ArrayDemo'</span><span class="token punctuation">]</span> <span class="token punctuation">:</span><span class="token operator">=</span> TJSONArray<span class="token punctuation">.</span>Create<span class="token punctuation">;</span><span class="token punctuation">;</span>
    jo<span class="token punctuation">.</span>a<span class="token punctuation">[</span><span class="token string">'ArrayDemo'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">'中国'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    jo<span class="token punctuation">.</span>a<span class="token punctuation">[</span><span class="token string">'ArrayDemo'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    jo<span class="token punctuation">.</span>a<span class="token punctuation">[</span><span class="token string">'ArrayDemo'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">'wwww'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    jo<span class="token punctuation">.</span>a<span class="token punctuation">[</span><span class="token string">'ArrayDemo'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    Result <span class="token punctuation">:</span><span class="token operator">=</span> jo<span class="token punctuation">.</span>ToString<span class="token punctuation">;</span>
  <span class="token keyword">finally</span>
    jo<span class="token punctuation">.</span>Free<span class="token punctuation">;</span>  <span class="token comment">//释放只需要释放jo就可以，其他的会自动释放(包括jo1)</span>

  end<span class="token punctuation">;</span>
end<span class="token punctuation">;</span>
</code></pre> 
<p>看完本片文章后，你能否实现将TFDQuery也Helper，让其操作也能使用S[]模式，而不在是FieldByName的模式！减少代码编写量！</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/06ef4a0110ddd79293508a776b7105f4/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">vue.js 中两个等号和三个等号的区别</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/36eae573b73a4d26486cca3ba0a20744/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【项目实战】仓库信息管理系统（layui&#43;SSM&#43;SpringBoot）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>