<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>数据治理（十五）：Ranger管理Hive安全 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="数据治理（十五）：Ranger管理Hive安全" />
<meta property="og:description" content="文章目录 Ranger管理Hive安全
一、配置HiveServer2
1）在Hive服务端配置hive-site.xml
2）在每台Hadoop 节点配置core-site.xml,记得发送到所有节点
3）重启HDFS ，Hive ，在Hive服务端启动Metastore 和 HiveServer2服务
4）在客户端通过beeline连接Hive
二、安装Ranger-hive-plugin
1）远程发送编译好的“hive-plugin”到node1节点“/software”目录下，并解压
2）配置“install.properties”文件
3）执行“enable-hive-plugin.sh”脚本启动hive插件
三、配置Ranger连接Hive服务
1）启动HDFS，启动Hive、Hive MeateStore、Hive Server2
2）在Ranger页面中配置Hive
3）连接测试是否可以jdbc方式连接上Hive
四、Ranger对Hive用户进行权限管理
Ranger管理Hive安全 一、配置HiveServer2 访问Hive有两种方式：HiveServer2和Hive Client，Hive Client需要Hive和Hadoop的jar包，配置环境。HiveServer2使得连接Hive的Client从Yarn和HDFS集群中独立出来，不需要每个节点都配置Hive和Hadoop的jar包和一系列环境。
Ranger管理Hive权限只能针对HiveServer2 jdbc方式连接，所以这里需要配置HiveServer2。
配置HiveServer2步骤如下：
1）在Hive服务端配置hive-site.xml #在Hive 服务端 $HIVE_HOME/conf/hive-site.xml中配置： &lt;!-- 配置hiveserver2 --&gt; &lt;property&gt; &lt;name&gt;hive.server2.thrift.port&lt;/name&gt; &lt;value&gt;10000&lt;/value&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;hive.server2.thrift.bind.host&lt;/name&gt; &lt;value&gt;192.168.179.4&lt;/value&gt; &lt;/property&gt; &lt;!-- 配置hiveserver2使用的zookeeper --&gt; &lt;property&gt; &lt;name&gt;hive.zookeeper.quorum&lt;/name&gt; &lt;value&gt; node3:2181,node4:2181,node5:2181&lt;/value&gt; &lt;/property&gt; 注意：“hive.zookeeper.quorum”搭建hiveserver2HA使用配置项，可以不配置，如果不配置启动hiveServer2时一直连接本地zookeeper,导致大量错误日志（/tmp/root/hive.log），从而导致通过beeline连接当前node1节点的hiveserver2时不稳定，会有连接不上错误信息。
2）在每台Hadoop 节点配置core-site.xml,记得发送到所有节点 &lt;!-- 配置代理访问用户，如果不配置下列信息 hive的jdbc连接会报错 --&gt; &lt;property&gt; &lt;name&gt;hadoop.proxyuser.root.hosts&lt;/name&gt; &lt;value&gt;*&lt;/value&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;hadoop.proxyuser.root.groups&lt;/name&gt; &lt;value&gt;*&lt;/value&gt; &lt;/property&gt; 3）重启HDFS ，Hive ，在Hive服务端启动Metastore 和 HiveServer2服务 [root@node1 conf]# hive --service metastore &amp; [root@node1 conf]# hive --service hiveserver2 &gt; /root/hiveserver2_log." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/7449222caf0faf4feb9050608e11df19/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-07-10T11:42:35+08:00" />
<meta property="article:modified_time" content="2022-07-10T11:42:35+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">数据治理（十五）：Ranger管理Hive安全</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><img alt="" src="https://images2.imgbox.com/dd/db/YWPvqHW6_o.jpg"></p> 
<p><strong>文章目录</strong> </p> 
<p id="Ranger%E7%AE%A1%E7%90%86Hive%E5%AE%89%E5%85%A8-toc" style="margin-left:0px;"><a href="#Ranger%E7%AE%A1%E7%90%86Hive%E5%AE%89%E5%85%A8" rel="nofollow">Ranger管理Hive安全</a></p> 
<p id="%E4%B8%80%E3%80%81%E9%85%8D%E7%BD%AEHiveServer2-toc" style="margin-left:40px;"><a href="#%E4%B8%80%E3%80%81%E9%85%8D%E7%BD%AEHiveServer2" rel="nofollow">一、配置HiveServer2</a></p> 
<p id="1%EF%BC%89%E5%9C%A8Hive%E6%9C%8D%E5%8A%A1%E7%AB%AF%E9%85%8D%E7%BD%AEhive-site.xml-toc" style="margin-left:80px;"><a href="#1%EF%BC%89%E5%9C%A8Hive%E6%9C%8D%E5%8A%A1%E7%AB%AF%E9%85%8D%E7%BD%AEhive-site.xml" rel="nofollow">1）在Hive服务端配置hive-site.xml</a></p> 
<p id="2%EF%BC%89%E5%9C%A8%E6%AF%8F%E5%8F%B0Hadoop%20%E8%8A%82%E7%82%B9%E9%85%8D%E7%BD%AEcore-site.xml%2C%E8%AE%B0%E5%BE%97%E5%8F%91%E9%80%81%E5%88%B0%E6%89%80%E6%9C%89%E8%8A%82%E7%82%B9-toc" style="margin-left:80px;"><a href="#2%EF%BC%89%E5%9C%A8%E6%AF%8F%E5%8F%B0Hadoop%20%E8%8A%82%E7%82%B9%E9%85%8D%E7%BD%AEcore-site.xml%2C%E8%AE%B0%E5%BE%97%E5%8F%91%E9%80%81%E5%88%B0%E6%89%80%E6%9C%89%E8%8A%82%E7%82%B9" rel="nofollow">2）在每台Hadoop 节点配置core-site.xml,记得发送到所有节点</a></p> 
<p id="3%EF%BC%89%E9%87%8D%E5%90%AFHDFS%20%EF%BC%8CHive%20%EF%BC%8C%E5%9C%A8Hive%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%90%AF%E5%8A%A8Metastore%20%E5%92%8C%20HiveServer2%E6%9C%8D%E5%8A%A1-toc" style="margin-left:80px;"><a href="#3%EF%BC%89%E9%87%8D%E5%90%AFHDFS%20%EF%BC%8CHive%20%EF%BC%8C%E5%9C%A8Hive%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%90%AF%E5%8A%A8Metastore%20%E5%92%8C%20HiveServer2%E6%9C%8D%E5%8A%A1" rel="nofollow">3）重启HDFS ，Hive ，在Hive服务端启动Metastore 和 HiveServer2服务</a></p> 
<p id="4%EF%BC%89%E5%9C%A8%E5%AE%A2%E6%88%B7%E7%AB%AF%E9%80%9A%E8%BF%87beeline%E8%BF%9E%E6%8E%A5Hive-toc" style="margin-left:80px;"><a href="#4%EF%BC%89%E5%9C%A8%E5%AE%A2%E6%88%B7%E7%AB%AF%E9%80%9A%E8%BF%87beeline%E8%BF%9E%E6%8E%A5Hive" rel="nofollow">4）在客户端通过beeline连接Hive</a></p> 
<p id="%E4%BA%8C%E3%80%81%E5%AE%89%E8%A3%85Ranger-hive-plugin-toc" style="margin-left:40px;"><a href="#%E4%BA%8C%E3%80%81%E5%AE%89%E8%A3%85Ranger-hive-plugin" rel="nofollow">二、安装Ranger-hive-plugin</a></p> 
<p id="1%EF%BC%89%E8%BF%9C%E7%A8%8B%E5%8F%91%E9%80%81%E7%BC%96%E8%AF%91%E5%A5%BD%E7%9A%84%E2%80%9Chive-plugin%E2%80%9D%E5%88%B0node1%E8%8A%82%E7%82%B9%E2%80%9C%2Fsoftware%E2%80%9D%E7%9B%AE%E5%BD%95%E4%B8%8B%EF%BC%8C%E5%B9%B6%E8%A7%A3%E5%8E%8B-toc" style="margin-left:80px;"><a href="#1%EF%BC%89%E8%BF%9C%E7%A8%8B%E5%8F%91%E9%80%81%E7%BC%96%E8%AF%91%E5%A5%BD%E7%9A%84%E2%80%9Chive-plugin%E2%80%9D%E5%88%B0node1%E8%8A%82%E7%82%B9%E2%80%9C%2Fsoftware%E2%80%9D%E7%9B%AE%E5%BD%95%E4%B8%8B%EF%BC%8C%E5%B9%B6%E8%A7%A3%E5%8E%8B" rel="nofollow">1）远程发送编译好的“hive-plugin”到node1节点“/software”目录下，并解压</a></p> 
<p id="2%EF%BC%89%E9%85%8D%E7%BD%AE%E2%80%9Cinstall.properties%E2%80%9D%E6%96%87%E4%BB%B6-toc" style="margin-left:80px;"><a href="#2%EF%BC%89%E9%85%8D%E7%BD%AE%E2%80%9Cinstall.properties%E2%80%9D%E6%96%87%E4%BB%B6" rel="nofollow">2）配置“install.properties”文件</a></p> 
<p id="3%EF%BC%89%E6%89%A7%E8%A1%8C%E2%80%9Cenable-hive-plugin.sh%E2%80%9D%E8%84%9A%E6%9C%AC%E5%90%AF%E5%8A%A8hive%E6%8F%92%E4%BB%B6-toc" style="margin-left:80px;"><a href="#3%EF%BC%89%E6%89%A7%E8%A1%8C%E2%80%9Cenable-hive-plugin.sh%E2%80%9D%E8%84%9A%E6%9C%AC%E5%90%AF%E5%8A%A8hive%E6%8F%92%E4%BB%B6" rel="nofollow">3）执行“enable-hive-plugin.sh”脚本启动hive插件</a></p> 
<p id="%E4%B8%89%E3%80%81%E9%85%8D%E7%BD%AERanger%E8%BF%9E%E6%8E%A5Hive%E6%9C%8D%E5%8A%A1-toc" style="margin-left:40px;"><a href="#%E4%B8%89%E3%80%81%E9%85%8D%E7%BD%AERanger%E8%BF%9E%E6%8E%A5Hive%E6%9C%8D%E5%8A%A1" rel="nofollow">三、配置Ranger连接Hive服务</a></p> 
<p id="1%EF%BC%89%E5%90%AF%E5%8A%A8HDFS%EF%BC%8C%E5%90%AF%E5%8A%A8Hive%E3%80%81Hive%20MeateStore%E3%80%81Hive%20Server2-toc" style="margin-left:80px;"><a href="#1%EF%BC%89%E5%90%AF%E5%8A%A8HDFS%EF%BC%8C%E5%90%AF%E5%8A%A8Hive%E3%80%81Hive%20MeateStore%E3%80%81Hive%20Server2" rel="nofollow">1）启动HDFS，启动Hive、Hive MeateStore、Hive Server2</a></p> 
<p id="2%EF%BC%89%E5%9C%A8Ranger%E9%A1%B5%E9%9D%A2%E4%B8%AD%E9%85%8D%E7%BD%AEHive-toc" style="margin-left:80px;"><a href="#2%EF%BC%89%E5%9C%A8Ranger%E9%A1%B5%E9%9D%A2%E4%B8%AD%E9%85%8D%E7%BD%AEHive" rel="nofollow">2）在Ranger页面中配置Hive</a></p> 
<p id="3%EF%BC%89%E8%BF%9E%E6%8E%A5%E6%B5%8B%E8%AF%95%E6%98%AF%E5%90%A6%E5%8F%AF%E4%BB%A5jdbc%E6%96%B9%E5%BC%8F%E8%BF%9E%E6%8E%A5%E4%B8%8AHive-toc" style="margin-left:80px;"><a href="#3%EF%BC%89%E8%BF%9E%E6%8E%A5%E6%B5%8B%E8%AF%95%E6%98%AF%E5%90%A6%E5%8F%AF%E4%BB%A5jdbc%E6%96%B9%E5%BC%8F%E8%BF%9E%E6%8E%A5%E4%B8%8AHive" rel="nofollow">3）连接测试是否可以jdbc方式连接上Hive</a></p> 
<p id="%E5%9B%9B%E3%80%81%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8BRanger%E5%AF%B9Hive%E7%94%A8%E6%88%B7%E8%BF%9B%E8%A1%8C%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86-toc" style="margin-left:40px;"><a href="#%E5%9B%9B%E3%80%81%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8BRanger%E5%AF%B9Hive%E7%94%A8%E6%88%B7%E8%BF%9B%E8%A1%8C%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86" rel="nofollow">四、Ranger对Hive用户进行权限管理</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h2>Ranger管理Hive安全</h2> 
<h3 id="%E4%B8%80%E3%80%81%E9%85%8D%E7%BD%AEHiveServer2">一、<strong>配置HiveServer2</strong></h3> 
<p style="margin-left:.0001pt;text-align:justify;">访问Hive有两种方式：HiveServer2和Hive Client，Hive Client需要Hive和Hadoop的jar包，配置环境。HiveServer2使得连接Hive的Client从Yarn和HDFS集群中独立出来，不需要每个节点都配置Hive和Hadoop的jar包和一系列环境。</p> 
<p style="margin-left:.0001pt;text-align:justify;">Ranger管理Hive权限只能针对HiveServer2 jdbc方式连接，所以这里需要配置HiveServer2。</p> 
<p style="margin-left:.0001pt;text-align:justify;">配置HiveServer2步骤如下：</p> 
<h4 id="1%EF%BC%89%E5%9C%A8Hive%E6%9C%8D%E5%8A%A1%E7%AB%AF%E9%85%8D%E7%BD%AEhive-site.xml" style="margin-left:.0001pt;text-align:justify;"><strong>1）在Hive服务端配置hive-site.xml</strong></h4> 
<pre><code class="language-XML">#在Hive 服务端 $HIVE_HOME/conf/hive-site.xml中配置：
&lt;!-- 配置hiveserver2 --&gt;
&lt;property&gt;
	 &lt;name&gt;hive.server2.thrift.port&lt;/name&gt;
	 &lt;value&gt;10000&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
	&lt;name&gt;hive.server2.thrift.bind.host&lt;/name&gt;
	&lt;value&gt;192.168.179.4&lt;/value&gt;
&lt;/property&gt;
&lt;!-- 配置hiveserver2使用的zookeeper --&gt;
&lt;property&gt;
	&lt;name&gt;hive.zookeeper.quorum&lt;/name&gt;
	&lt;value&gt; node3:2181,node4:2181,node5:2181&lt;/value&gt;
&lt;/property&gt; </code></pre> 
<p>注意：“hive.zookeeper.quorum”搭建hiveserver2HA使用配置项，可以不配置，如果不配置启动hiveServer2时一直连接本地zookeeper,导致大量错误日志（/tmp/root/hive.log），从而导致通过beeline连接当前node1节点的hiveserver2时不稳定，会有连接不上错误信息。</p> 
<p></p> 
<h4 id="2%EF%BC%89%E5%9C%A8%E6%AF%8F%E5%8F%B0Hadoop%20%E8%8A%82%E7%82%B9%E9%85%8D%E7%BD%AEcore-site.xml%2C%E8%AE%B0%E5%BE%97%E5%8F%91%E9%80%81%E5%88%B0%E6%89%80%E6%9C%89%E8%8A%82%E7%82%B9"><strong>2）在每台Hadoop 节点配置core-site.xml,记得发送到所有节点</strong></h4> 
<pre><code class="language-XML">&lt;!-- 配置代理访问用户，如果不配置下列信息 hive的jdbc连接会报错 --&gt;
&lt;property&gt;     
	&lt;name&gt;hadoop.proxyuser.root.hosts&lt;/name&gt;     
	&lt;value&gt;*&lt;/value&gt;
 &lt;/property&gt; 
&lt;property&gt;     
	&lt;name&gt;hadoop.proxyuser.root.groups&lt;/name&gt;    
    &lt;value&gt;*&lt;/value&gt; 
&lt;/property&gt;</code></pre> 
<p></p> 
<h4 id="3%EF%BC%89%E9%87%8D%E5%90%AFHDFS%20%EF%BC%8CHive%20%EF%BC%8C%E5%9C%A8Hive%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%90%AF%E5%8A%A8Metastore%20%E5%92%8C%20HiveServer2%E6%9C%8D%E5%8A%A1"><strong>3）<strong>重启HDFS ，Hive ，在Hive服务端启动Metastore 和 HiveServer2服务</strong></strong></h4> 
<pre><code class="language-XML">[root@node1 conf]# hive --service metastore &amp;
[root@node1 conf]# hive --service hiveserver2 &gt; /root/hiveserver2_log.txt &amp;</code></pre> 
<p></p> 
<h4 id="4%EF%BC%89%E5%9C%A8%E5%AE%A2%E6%88%B7%E7%AB%AF%E9%80%9A%E8%BF%87beeline%E8%BF%9E%E6%8E%A5Hive"><strong>4）在客户端通过beeline连接Hive</strong></h4> 
<pre><code class="language-bash">[root@node3 test]# beeline
beeline&gt; !connect jdbc:hive2://node1:10000 root
Enter password for jdbc:hive2://node1:10000: **** #可以输入任意密码,没有验证
0: jdbc:hive2://node1:10000&gt; show tables;</code></pre> 
<p><img alt="" height="295" src="https://images2.imgbox.com/e1/49/q4lAE4Si_o.png" width="464"></p> 
<p></p> 
<h3 id="%E4%BA%8C%E3%80%81%E5%AE%89%E8%A3%85Ranger-hive-plugin">二、<strong>安装Ranger-hive-plugin</strong></h3> 
<p style="margin-left:.0001pt;text-align:justify;">我们可以使用Ranger对Hive数据安全进行管理，这里需要安装Hive插件“ranger-2.1.0-hive-plugin”，此插件只能对jdbc方式连接Hive的请求进行权限管理，不能对hive-cli客户端方式进行权限管理（一般安装Hive的节点才能使用Hive客户端访问）。步骤如下：</p> 
<h4 id="1%EF%BC%89%E8%BF%9C%E7%A8%8B%E5%8F%91%E9%80%81%E7%BC%96%E8%AF%91%E5%A5%BD%E7%9A%84%E2%80%9Chive-plugin%E2%80%9D%E5%88%B0node1%E8%8A%82%E7%82%B9%E2%80%9C%2Fsoftware%E2%80%9D%E7%9B%AE%E5%BD%95%E4%B8%8B%EF%BC%8C%E5%B9%B6%E8%A7%A3%E5%8E%8B" style="margin-left:.0001pt;text-align:justify;"><strong>1）远程发送编译好的“hive-plugin”到node1节点“/software”目录下，并解压</strong></h4> 
<p>远程发送“/software/apache-ranger-2.1.0/target/”下的“ranger-2.1.0-hive-plugin.tar.gz”到node1节点“/software”下：</p> 
<pre><code class="language-bash">[root@node3 /]# scp /software/apache-ranger-2.1.0/target/ranger-2.1.0-hive-plugin.tar.gz node1:/software/
#在node1节点操作
[root@node1 ~]# cd /software/
[root@node1 software]# tar -zxvf ./ranger-2.1.0-hive-plugin.tar.gz</code></pre> 
<h4 id="2%EF%BC%89%E9%85%8D%E7%BD%AE%E2%80%9Cinstall.properties%E2%80%9D%E6%96%87%E4%BB%B6"><strong>2）配置“install.properties”文件</strong></h4> 
<p style="margin-left:.0001pt;text-align:justify;">进入到“/software/ranger-2.1.0-hive-plugin”目录中，修改“install.properties”文件：</p> 
<pre><code class="language-bash">[root@node1 ranger-2.1.0-hive-plugin]# vim install.properties
#配置Ranger-Admin访问地址
POLICY_MGR_URL=http://node1:6080
#配置Hive 仓库名称，可以自定义，需要后期在Ranger中使用
REPOSITORY_NAME=hive_repo
#配置Hive的安装目录
COMPONENT_INSTALL_DIR_NAME=/software/hive-3.1.2/
#配置使用插件的用户和用户组
CUSTOM_USER=root
CUSTOM_GROUP=root</code></pre> 
<h4 id="3%EF%BC%89%E6%89%A7%E8%A1%8C%E2%80%9Cenable-hive-plugin.sh%E2%80%9D%E8%84%9A%E6%9C%AC%E5%90%AF%E5%8A%A8hive%E6%8F%92%E4%BB%B6"><strong>3）执行“enable-hive-plugin.sh”脚本启动hive插件</strong></h4> 
<p style="margin-left:.0001pt;text-align:justify;">进入到“/software/ranger-2.1.0-hive-plugin”目录下，执行如下命令，启用插件：</p> 
<pre><code class="language-bash">[root@node1 ~]# cd /software/ranger-2.1.0-hive-plugin
[root@node1 ranger-2.1.0-hive-plugin]# enable-hive-plugin.sh</code></pre> 
<p></p> 
<h3 id="%E4%B8%89%E3%80%81%E9%85%8D%E7%BD%AERanger%E8%BF%9E%E6%8E%A5Hive%E6%9C%8D%E5%8A%A1">三、配置Ranger连接Hive服务</h3> 
<p style="margin-left:.0001pt;text-align:justify;">安装好以上Hive-Plugin之后，重新启动HDFS，启动Hive,HiveMetastore、HiveServer2等。如果想要对连接Hive的用户进行表、列权限管理，需要在Ranger中添加对应的Hive服务，才可以使用Ranger通过这个服务配置每个用户对Hive库、表、列权限管理。配置如下：</p> 
<h4 id="1%EF%BC%89%E5%90%AF%E5%8A%A8HDFS%EF%BC%8C%E5%90%AF%E5%8A%A8Hive%E3%80%81Hive%20MeateStore%E3%80%81Hive%20Server2" style="margin-left:.0001pt;text-align:justify;"><strong>1）启动HDFS，启动Hive、Hive MeateStore、Hive Server2</strong></h4> 
<pre><code class="language-bash">#启动HDFS，在node1节点上启动Hive metastore
[root@node1 conf]# start-all.sh
[root@node1 conf]# hive --service metastore &amp;
[root@node1 conf]# hive --service hiveserver2 &gt; /root/hiveserver2_log.txt &amp;</code></pre> 
<h4 id="2%EF%BC%89%E5%9C%A8Ranger%E9%A1%B5%E9%9D%A2%E4%B8%AD%E9%85%8D%E7%BD%AEHive"><strong>2）在Ranger页面中配置Hive</strong></h4> 
<p><img alt="" height="480" src="https://images2.imgbox.com/66/d2/kNW8k0zj_o.png" width="962"></p> 
<p><img alt="" height="906" src="https://images2.imgbox.com/5a/9a/4BYwpLaY_o.png" width="924"></p> 
<p>注意，以上参数解释如下： </p> 
<ul><li style="text-align:justify;">“Service Name”填写当前Hive 服务名称，与Hive插件中"install.properties"文件配置参数"REPOSITORY_NAME"保持一致。</li><li style="text-align:justify;">配置的“user”和“password”也是与"install.properties"文件中配置的“CUSTOM_USER=root”、“CUSTOM_GROUP=root”保持一致。</li><li style="text-align:justify;">“jdbc.url”填写“jdbc:hive2://node1:10000”即可，这里连接node1。</li></ul> 
<p style="margin-left:.0001pt;text-align:justify;">添加完成之后：</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="517" src="https://images2.imgbox.com/ea/7c/JL6JTvEL_o.png" width="957"></p> 
<p></p> 
<h4 id="3%EF%BC%89%E8%BF%9E%E6%8E%A5%E6%B5%8B%E8%AF%95%E6%98%AF%E5%90%A6%E5%8F%AF%E4%BB%A5jdbc%E6%96%B9%E5%BC%8F%E8%BF%9E%E6%8E%A5%E4%B8%8AHive"><strong>3）连接测试是否可以jdbc方式连接上Hive</strong></h4> 
<p><img alt="" height="533" src="https://images2.imgbox.com/f7/53/Bmrm31i4_o.png" width="1014"></p> 
<p>注意：这里连接时，单机测试连接时需要等待一段时间，才能正常连接。</p> 
<p></p> 
<h3 id="%E5%9B%9B%E3%80%81%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8BRanger%E5%AF%B9Hive%E7%94%A8%E6%88%B7%E8%BF%9B%E8%A1%8C%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86"><strong>四、​​​​​​​Ranger对Hive用户进行权限管理</strong></h3> 
<p style="margin-left:.0001pt;text-align:justify;">查看Ranger中配置好的Hive权限管理服务：</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="586" src="https://images2.imgbox.com/58/4b/BFkcqnnR_o.png" width="1200"></p> 
<p>修改上图中只有root用户对所以库、表、列具有操作权限,修改后如下： </p> 
<p><img alt="" height="378" src="https://images2.imgbox.com/8b/af/wuqdk7cz_o.png" width="930"></p> 
<p>在node3中登录beeline连接node1 hive：</p> 
<pre><code class="language-bash">#node3 通过beeline连接Hive
[root@node3 ~]# beeline
#连接HiveServer2 jdbc连接
beeline&gt; !connect jdbc:hive2://node1:10000
#这里用户名目前可以随意输入，在Hive中没有校验，这里可以通过Hive配置有哪些用
#户可以连接Hive，然后通过Ranger再管理这些用户的细粒度访问权限。从上图中可以
#看到目前只有root用户可以访问表数据，可以使用非root用户测试，这里使用
#“diaochan”用户：
Enter username for jdbc:hive2://node1:10000: diaochan
#由于Hive中没有检验密码，所以这里可以随意输入任意密码
Enter password for jdbc:hive2://node1:10000: ****
#查询库下的表，没有权限。
0: jdbc:hive2://node1:10000&gt; show tables
Error: Error while compiling statement: FAILED: HiveAccessControlException Permission denied: user [daochan] does not have [USE] privilege on [de
fault] (state=42000,code=40000)

#重新使用root用户登录beeline，查询对应的表，有权限
[root@node3 ~]# beeline
beeline&gt; !connect jdbc:hive2://node1:10000
Enter username for jdbc:hive2://node1:10000: root
Enter password for jdbc:hive2://node1:10000: *** #密码随意
0: jdbc:hive2://node1:10000&gt; show tables;</code></pre> 
<p><img alt="" height="370" src="https://images2.imgbox.com/1e/0e/dQRU2Oox_o.png" width="474"></p> 
<p>下面在Hive中创建两张表进行权限管理：</p> 
<pre><code class="language-bash">#在Hive中创建两张表
create table student (id int,name string,age int) row format delimited fields terminated by '\t';
create table score (id int,name string,score int) row format delimited fields terminated by '\t';</code></pre> 
<p>上传数据附件，将以上文件上传到node3“/software/test”下</p> 
<p><img alt="" height="96" src="https://images2.imgbox.com/46/91/F7jE87ck_o.png" width="124"></p> 
<pre><code>1	zhangsan	18
2	lisi	19
3	wangwu	20
4	maliu	21
5	tianqi	22
6	zhaoba	23</code></pre> 
<p><img alt="" height="104" src="https://images2.imgbox.com/3b/c4/sEf238lr_o.png" width="153"></p> 
<pre><code>1	zhangsan	100
2	lisi	200
3	wangwu	300
4	maliu	400
5	tianqi	500
6	zhaoba	600</code></pre> 
<pre><code class="language-bash">#加载数据：
hive&gt; load data local inpath '/root/test/students.txt' into table student;
hive&gt; load data local inpath '/root/test/scores.txt' into table score;</code></pre> 
<p> <strong><strong>权限需求：对用户“user1”配置以上两张表的访问和修改权限，对用户“user2”配置对两张表只有访问权限。</strong></strong></p> 
<p style="margin-left:.0001pt;text-align:justify;">配置步骤如下：</p> 
<p style="text-align:justify;"><strong><strong>1）在node1节点创建两个用户，密码为对应用户名称</strong></strong></p> 
<pre><code class="language-bash">#创建两个用户user1,和user2
[root@node1 ~]# useradd user1
[root@node1 ~]# passwd user1

[root@node1 ~]# useradd user2
[root@node1 ~]# passwd user2</code></pre> 
<p><strong>2）在Ranger页面，打开“hive_repo”服务，配置如下：</strong></p> 
<p style="margin-left:.0001pt;text-align:justify;">配置“Student”表权限：</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="358" src="https://images2.imgbox.com/5c/51/MA8uD1hW_o.png" width="910"></p> 
<p> <img alt="" height="587" src="https://images2.imgbox.com/8c/17/GGTIXiGa_o.png" width="1037"></p> 
<p></p> 
<p> <img alt="" height="580" src="https://images2.imgbox.com/18/36/cLEqysXK_o.png" width="1068"></p> 
<p><img alt="" height="587" src="https://images2.imgbox.com/9a/6d/R51qiHBU_o.png" width="984"></p> 
<p>最终配置好如下：</p> 
<p><img alt="" height="291" src="https://images2.imgbox.com/f8/a4/te50OiRt_o.png" width="1094"></p> 
<p style="text-align:justify;"><strong>3）登录Hive Beeline测试：</strong></p> 
<p style="margin-left:.0001pt;text-align:justify;">向HDFS中插入数据时，user1，user2用户需要操作HDFS和Yarn，所以这里将HDFS中Hive对应的路径“/user/hive/warehouse”中的“/user”路径权限改成“777”，将Yarn使用目录“tmp”路径权限改成“777”</p> 
<pre><code class="language-bash">[root@node5 bin]# hdfs dfs -chmod -R 777 /user
[root@node5 bin]# hdfs dfs -chmod -R 777 /tmp</code></pre> 
<p> 测试登录user1，对“student”、“score”表有操作和修改权限，如下：</p> 
<pre><code class="language-bash">[root@node3 ~]# beeline
beeline&gt; !connect jdbc:hive2://node1:10000
0: jdbc:hive2://node1:10000&gt; select * from student;</code></pre> 
<p><img alt="" height="279" src="https://images2.imgbox.com/bd/d6/Jb2AahkI_o.png" width="692"></p> 
<p></p> 
<pre><code class="language-bash">0: jdbc:hive2://node1:10000&gt; select * from score;</code></pre> 
<p><img alt="" height="308" src="https://images2.imgbox.com/f1/b6/PUti0xx2_o.png" width="692"></p> 
<pre><code class="language-bash">#向表student、score中插入数据,也能通过。
0: jdbc:hive2://node1:10000&gt; insert into student values (7,"aa",24);
0: jdbc:hive2://node1:10000&gt; insert into score values (7,"bb",700);</code></pre> 
<p>测试登录user2，对“student”、“score”表有操作和修改权限，如下：</p> 
<pre><code class="language-bash">[root@node3 software]# beeline
beeline&gt; !connect jdbc:hive2://node1:10000
Enter username for jdbc:hive2://node1:10000: user2
Enter password for jdbc:hive2://node1:10000: *** #密码随便输入
0: jdbc:hive2://node1:10000&gt; select * from student;</code></pre> 
<p><img alt="" height="305" src="https://images2.imgbox.com/db/63/MrFX8xPE_o.png" width="692"></p> 
<pre><code class="language-bash">0: jdbc:hive2://node1:10000&gt; select * from score;</code></pre> 
<p><img alt="" height="334" src="https://images2.imgbox.com/3e/b1/ZB2ZhiIo_o.png" width="689"></p> 
<pre><code class="language-bash">#测试向“student”和“score”中插入数据，没有对应权限：
0: jdbc:hive2://node1:10000&gt; insert into table student values (8,"cc",25);
Error: Error while compiling statement: FAILED: HiveAccessControlException Permission denied: user [user2] does not have [UPDATE] privilege on [d
efault/student] (state=42000,code=40000)

0: jdbc:hive2://node1:10000&gt; insert into table score values (8,"dd",800);
Error: Error while compiling statement: FAILED: HiveAccessControlException Permission denied: user [user2] does not have [UPDATE] privilege on [d
efault/score] (state=42000,code=40000)</code></pre> 
<p> <strong><strong>权限需求：对用户“user3”配置对“student”表中“id、name”两列有查询权限，其他列没有查询权限。</strong></strong></p> 
<p style="margin-left:.0001pt;text-align:justify;">配置步骤如下：</p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong>1）在node1节点中添加用户“user3”</strong></p> 
<pre><code class="language-bash">#创建两个用户user3
[root@node1 ~]# useradd user3
[root@node1 ~]# passwd user3</code></pre> 
<p></p> 
<p style="text-align:justify;"><strong><strong>2）给用户“user3”配置表“student”的访问权限</strong></strong></p> 
<p style="text-align:justify;"><img alt="" height="684" src="https://images2.imgbox.com/d6/63/fhf5YsI9_o.png" width="1045"></p> 
<p></p> 
<p><strong>3）测试</strong></p> 
<pre><code class="language-bash">#user3登录beeline
[root@node3 software]# beeline
beeline&gt; !connect jdbc:hive2://node1:10000
Enter username for jdbc:hive2://node1:10000: user3
#访问表“student”数据，“age”列无法查询，select * 查询不允许
0: jdbc:hive2://node1:10000&gt; select id ,name from student;</code></pre> 
<p><img alt="" height="339" src="https://images2.imgbox.com/a4/5d/zmnltj4o_o.png" width="328"></p> 
<p></p> 
<p style="text-align:justify;"><strong><strong>权限需求：对用户“user1”访问表“student”时，“age”列进行空值输出，进行脱敏。</strong></strong></p> 
<p style="margin-left:.0001pt;text-align:justify;">配置步骤如下：</p> 
<p style="text-align:justify;"><strong><strong>1）给用户“user1”配置表“student”的“Masking”访问权限</strong></strong></p> 
<p style="text-align:justify;"><img alt="" height="262" src="https://images2.imgbox.com/b2/0e/a1uGqOGl_o.png" width="1104"></p> 
<p> <img alt="" height="692" src="https://images2.imgbox.com/5d/b6/Ptm5f1NA_o.png" width="1081"></p> 
<p><img alt="" height="617" src="https://images2.imgbox.com/63/be/sUUW8S4X_o.png" width="1057"></p> 
<p></p> 
<p><strong>2）登录Hive Beeline测试</strong></p> 
<pre><code class="language-bash">[root@node3 software]# beeline
beeline&gt; !connect jdbc:hive2://node1:10000
Enter username for jdbc:hive2://node1:10000: user1
0: jdbc:hive2://node1:10000&gt; select * from student;</code></pre> 
<p> <img alt="" height="309" src="https://images2.imgbox.com/e6/72/I89wHfN5_o.png" width="692"></p> 
<p></p> 
<p style="text-align:justify;"><strong><strong>权限需求：对用户“user2”访问表“student”时，“age”列只能插叙小于等于20的行数据。</strong></strong></p> 
<p style="margin-left:.0001pt;text-align:justify;">配置步骤如下：</p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong>1）给用户“user1”配置表“student”的“Masking”访问权限</strong></p> 
<p> <img alt="" height="259" src="https://images2.imgbox.com/62/e2/NujNcQHu_o.png" width="1086"></p> 
<p><img alt="" height="597" src="https://images2.imgbox.com/b2/24/IXAGXXQ4_o.png" width="1067"></p> 
<p><img alt="" height="374" src="https://images2.imgbox.com/2e/7f/DAdKomRD_o.png" width="1045"></p> 
<p></p> 
<p><strong>2）登录Hive Beeline测试</strong></p> 
<pre><code class="language-bash">[root@node3 software]# beeline
beeline&gt; !connect jdbc:hive2://node1:10000
Enter username for jdbc:hive2://node1:10000: user2
#查询只有3行满足条件的数据
0: jdbc:hive2://node1:10000&gt; select * from student;</code></pre> 
<p><img alt="" height="193" src="https://images2.imgbox.com/ae/b2/FTozYI17_o.png" width="692"></p> 
<hr> 
<ul><li>📢博客主页：<a href="https://lansonli.blog.csdn.net/" rel="nofollow" title="https://lansonli.blog.csdn.net">https://lansonli.blog.csdn.net</a></li><li>📢欢迎点赞 👍 收藏 ⭐留言 📝 如有错误敬请指正！</li><li>📢本文由 Lansonli 原创，首发于 CSDN博客🙉</li><li>📢停下休息的时候不要忘了别人还在奔跑，希望大家抓紧时间学习，全力奔赴更美好的生活✨ </li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a6f424ce8d6c1be78ecd2a1714a78633/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">easyExcel导出</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6a402be728ef3aa572227e0fde94a140/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Java解析剑指offer链表篇(3)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>