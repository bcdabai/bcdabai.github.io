<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>node.js的学习 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="node.js的学习" />
<meta property="og:description" content="nodejs 官网 Node.js (nodejs.org)
nodejs中代码由V8引擎解析，内置fs，http等api
不包含dom和bom，不可以在nodejs中使用bom和dom
nodejs可以做什么
基于Express框架，可以快速构架web应用基于Electron框架，构建跨平台的桌面应用基于restify框架，构架api接口项目读写操作数据库… 环境安装 官网下载，双击安装（lts版）
lts为长期稳定版
current为新特性尝鲜版（测试版）
Node.js 安装配置 | 菜鸟教程 (runoob.com)
配置的时候如果更改了安装路径，需要配置一下环境变量
运行nodejs，在终端中输入 node demo.js
遇到文件命比较长时，输入文件开头，再敲tab键可以自动补充
cls可以清空终端，ecs可以清除当前命令
内置模块 Index | Node.js v17.9.1 Documentation (nodejs.org)官方文档
Node.js 教程 | 菜鸟教程 (runoob.com)菜鸟文档
1.fs模块 fs.readFile()方法，用来读取指定文件内容
fs.readFile(path[, options], callback) path：必选参数，字符串，表示文件路径
option：可选参数，表示什么编码格式来读取文件
callback：必选参数，文件读取完成后，通过回调函数拿到结果
var fs = require(&#34;fs&#34;); fs.readFile(&#39;study.md&#39;,&#39;utf8&#39;,function(err,data){ // console.log(err); console.log(data); if(err){ return console.log(&#39;读取文件失败&#39;&#43;err.message); } else{ console.log(&#39;文件读取成功&#39;) } }) fs.writeFilr()方法，向指定文件写内容（写入时没有指定文件会自动创建文件，但不会创建文件夹，默认会覆盖之前文件的数据）
fs.writeFile(file, data[, options], callback) file:必选参数，需要指定文件路径字符串，表示文件存放路径
data：必选参数，表示要写入内容
option：可选参数，默认utf8
callback：必选参数，回调函数
var fs = require(&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/0fe5a417100237ebc4ed2239a38b778d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-23T14:41:47+08:00" />
<meta property="article:modified_time" content="2023-02-23T14:41:47+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">node.js的学习</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="nodejs_0"></a>nodejs</h2> 
<ol><li> <p>官网 <a href="https://nodejs.org/zh-cn/" rel="nofollow">Node.js (nodejs.org)</a></p> <p>nodejs中代码由V8引擎解析，内置fs，http等api</p> <p>不包含dom和bom，不可以在nodejs中使用bom和dom</p> </li><li> <p>nodejs可以做什么</p> 
  <ol><li>基于Express框架，可以快速构架web应用</li><li>基于Electron框架，构建跨平台的桌面应用</li><li>基于restify框架，构架api接口项目</li><li>读写操作数据库…</li></ol> </li></ol> 
<h3><a id="_15"></a>环境安装</h3> 
<ol><li> <p>官网下载，双击安装（lts版）</p> <p>lts为长期稳定版</p> <p>current为新特性尝鲜版（测试版）</p> </li><li> <p><a href="https://www.runoob.com/nodejs/nodejs-install-setup.html" rel="nofollow">Node.js 安装配置 | 菜鸟教程 (runoob.com)</a></p> <p>配置的时候如果更改了安装路径，需要配置一下环境变量</p> </li><li> <p>运行nodejs，在终端中输入 node demo.js</p> </li><li> <p>遇到文件命比较长时，输入文件开头，再敲tab键可以自动补充</p> </li><li> <p>cls可以清空终端，ecs可以清除当前命令</p> </li></ol> 
<h3><a id="_33"></a>内置模块</h3> 
<p><a href="https://nodejs.org/docs/latest-v17.x/api/" rel="nofollow">Index | Node.js v17.9.1 Documentation (nodejs.org)</a>官方文档</p> 
<p><a href="https://www.runoob.com/nodejs/nodejs-tutorial.html" rel="nofollow">Node.js 教程 | 菜鸟教程 (runoob.com)</a>菜鸟文档</p> 
<h4><a id="1fs_39"></a>1.fs模块</h4> 
<ol><li> <p>fs.readFile()方法，用来读取指定文件内容</p> <h5><a id="fsreadFilepath_options_callback_43"></a><code>fs.readFile(path[, options], callback)</code></h5> <p>path：必选参数，字符串，表示文件路径</p> <p>option：可选参数，表示什么编码格式来读取文件</p> <p>callback：必选参数，文件读取完成后，通过回调函数拿到结果</p> <pre><code class="prism language-js"><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"fs"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'study.md'</span><span class="token punctuation">,</span><span class="token string">'utf8'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>data</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">// console.log(err);</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'读取文件失败'</span><span class="token operator">+</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'文件读取成功'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> </li><li> <p>fs.writeFilr()方法，向指定文件写内容（写入时没有指定文件会自动创建文件，但不会创建文件夹，默认会覆盖之前文件的数据）</p> <h5><a id="fswriteFilefile_data_options_callback_69"></a><code>fs.writeFile(file, data[, options], callback)</code></h5> <p>file:必选参数，需要指定文件路径字符串，表示文件存放路径</p> <p>data：必选参数，表示要写入内容</p> <p>option：可选参数，默认utf8</p> <p>callback：必选参数，回调函数</p> <pre><code class="prism language-js"><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"fs"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token string">'2.txt'</span><span class="token punctuation">,</span><span class="token string">'abcd'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">//err为空时，就表示没有错误</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'失败'</span><span class="token operator">+</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <h4><a id="fs_92"></a>fs模块路径拼接问题</h4> <p>会根据当前路径拼接成path</p> <p>__dirname:表示当前文件所处的目录，可以解决路径拼接问题</p> <h4><a id="path_98"></a>path路径模块</h4> <p>使用方法</p> <pre><code class="prism language-js"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
path<span class="token punctuation">.</span><span class="token function">jion</span><span class="token punctuation">(</span><span class="token punctuation">[</span>多个路径片段<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">//用于拼接多个路径片段</span>
path<span class="token punctuation">.</span><span class="token function">jion</span><span class="token punctuation">(</span><span class="token string">'/a'</span><span class="token punctuation">,</span><span class="token string">'/b'</span><span class="token punctuation">,</span><span class="token string">'.../'</span><span class="token punctuation">)</span>
<span class="token comment">//../会抵消前面的一层路径</span>
path<span class="token punctuation">.</span><span class="token function">jion</span><span class="token punctuation">(</span>__dirnaeme<span class="token punctuation">,</span><span class="token string">'/a/1.txt'</span><span class="token punctuation">)</span>
</code></pre> <pre><code class="prism language-js"><span class="token keyword">const</span> fpath <span class="token operator">=</span> <span class="token string">'/a/b/1.txt'</span>
<span class="token keyword">var</span> filename <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">basename</span><span class="token punctuation">(</span>fpath<span class="token punctuation">)</span>
<span class="token comment">//获取文件命(包含扩展命)</span>
<span class="token keyword">var</span> name <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">basename</span><span class="token punctuation">(</span>fpath<span class="token punctuation">,</span><span class="token string">'.txt'</span><span class="token punctuation">)</span>
<span class="token comment">//去除扩展名</span>
</code></pre> <pre><code class="prism language-js"><span class="token comment">//获取扩展名</span>
<span class="token keyword">const</span> fpath <span class="token operator">=</span> <span class="token string">'/a/b/1.txt'</span>
<span class="token keyword">var</span> fext <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">extname</span><span class="token punctuation">(</span>fpath<span class="token punctuation">)</span>
</code></pre> <pre><code class="prism language-js"><span class="token comment">//案例</span>
<span class="token comment">//拆分html中的style部分</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token comment">// const path = require('path')</span>
<span class="token comment">// 正则表达式</span>
<span class="token comment">// \s:匹配空白字符</span>
<span class="token comment">// \S:匹配非空白字符</span>
<span class="token keyword">const</span> restyle <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&lt;style&gt;[\s\S]*&lt;\/style&gt;</span><span class="token regex-delimiter">/</span></span>
<span class="token keyword">const</span> rescript <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&lt;script&gt;[\s\S]*&lt;\/script&gt;</span><span class="token regex-delimiter">/</span></span>

<span class="token keyword">const</span> html <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">,</span><span class="token string">'utf-8'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>data</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'读取失败'</span><span class="token operator">+</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// console.log(data)</span>
    <span class="token function">resolveCss</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 处理css函数</span>
<span class="token keyword">function</span> <span class="token function">resolveCss</span><span class="token punctuation">(</span><span class="token parameter">htmlStr</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> r1 <span class="token operator">=</span> restyle<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>htmlStr<span class="token punctuation">)</span>
    <span class="token keyword">const</span> newcss <span class="token operator">=</span> r1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'&lt;style&gt;'</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'&lt;/style&gt;'</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span>
    fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token string">'index.css'</span><span class="token punctuation">,</span>newcss<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'写入失败'</span><span class="token operator">+</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'写入成功'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> </li></ol> 
<h4><a id="2http_159"></a>2.http模块</h4> 
<ol><li> <p>费资源的电脑叫客户端，负责对外提供网络资源的电脑叫服务器（简单理解）</p> <p>普通电脑安装web服务器软件，例如apache等，可以将电脑变成服务器</p> </li><li> <p>调用</p> <pre><code class="prism language-js"><span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span>
</code></pre> <p>在nodejs中不用安装web服务器，利用<code>http</code>模块</p> </li><li> <p>ip地址：每台计算机的唯一地址，具有唯一性</p> <p>互联网中每台web服务器都有自己的ip地址</p> <pre><code class="prism language-js">ping www<span class="token punctuation">.</span>baidu<span class="token punctuation">.</span>com
<span class="token comment">//可以查看百度的ip地址</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>
<span class="token comment">//自己的IP地址</span>
</code></pre> <p>域名服务器（DNS）用于将域名解析为ip地址</p> <p>端口号：在同一台电脑中，会有很多服务，端口号用来标识各个服务，同一个端口不可以被多个web服务占用，url中只有80端口可以省略</p> </li><li> <p>创建web服务器基本步骤</p> <pre><code class="prism language-js"><span class="token comment">// 导入模块</span>
<span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span>
<span class="token comment">//创建web服务器实例</span>
<span class="token keyword">const</span> serve <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 为服务器绑定事件</span>
<span class="token comment">// 当有服务请求的时候，就会触发request事件</span>
serve<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 触发request后，会执行回调函数</span>
    <span class="token comment">//获取url和访问方式</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>method<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> str <span class="token operator">=</span> req<span class="token punctuation">.</span>url<span class="token operator">+</span><span class="token string">':'</span><span class="token operator">+</span>req<span class="token punctuation">.</span>method<span class="token operator">+</span><span class="token string">'你好啊'</span>
    <span class="token comment">// 调用res.end(),响应一些数据</span>
    <span class="token comment">//设置编码，解决中文乱码</span>
    res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span><span class="token string">'text/html;charset=utf-8'</span><span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
    
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 启动服务器</span>
serve<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 启动成功之后会调用回调函数</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'start'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
  <ol><li> <p>req请求对象</p> <p>只要服务器接收到了客户端的请求，就会调用server.on()中为服务器绑定的request事件处理函数，也就是其中的回调函数</p> <p>req为请求对象，可以拿到请求端的数据</p> </li><li> <p>res响应对象</p> <p>访问服务器相关的数据和属性</p> </li><li> <p>解决中文乱码问题</p> <p>需要手动设置编码格式</p> </li></ol> </li></ol> 
<h3><a id="_231"></a>模块化概念</h3> 
<h4><a id="1__233"></a>1. 模块化基本概念</h4> 
<p>自顶向下把系统分成若干个模块的过程，模块是可组合，分解和更换的单元</p> 
<p>生活中的例子，如小霸王游戏机，可分为卡带，手柄，主体三部分，三部分都是可以替换组合的</p> 
<p>编程领域中的模块化，遵守固定的规则，把一个大文件拆分成独立并且相互依赖的多个小模块</p> 
<h4><a id="2__241"></a>2. 模块化规范</h4> 
<ol><li> <p>nodejs中模块分类</p> 
  <ol><li>内置模块：nodejs自带的模块。如http，fs</li><li>自定义模块：用户创建的，每个js文件都是自定义模块</li><li>第三方模块：使用前需要先下载</li></ol> </li><li> <p>加载模块</p> <p>使用<code>require()</code>来加载模块</p> <pre><code class="prism language-js"><span class="token comment">//内置模块</span>
<span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span>
<span class="token comment">//加载用户自定义模块，需要写路径</span>
<span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./http.js'</span><span class="token punctuation">)</span>
<span class="token comment">//加载第三方模块，需要先下载</span>
<span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'demohttp'</span><span class="token punctuation">)</span>
</code></pre> <p>注意：使用<code>require()</code>加载模块时，<strong>会执行加载模块中的代码</strong></p> </li><li> <p>模块作用域(模块级别的访问限制)</p> <p>在自定义模块中定义的方法，变量等成员，<strong>只能在当前模块被访问</strong></p> <p>防止全局变量污染的问题</p> </li><li> <p><strong>如何向外共享模块中的成员（变量，方法等）</strong></p> <p>每个.js自定义模块中，都有一个<code>module</code>对象</p> <pre><code class="prism language-js"><span class="token comment">//在任意js文件中都有这个对象</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>module<span class="token punctuation">)</span>
</code></pre> </li></ol> 
<pre><code>Module {
  id: '.',
  path: 'D:\\0.vue\\0.nodejs',
  exports: {},
  filename: 'D:\\0.vue\\0.nodejs\\4.module测试.js',   
  loaded: false,
  children: [
    Module {
      id: 'D:\\0.vue\\0.nodejs\\test.js',
      path: 'D:\\0.vue\\0.nodejs',
      exports: {},
      filename: 'D:\\0.vue\\0.nodejs\\test.js',       
      loaded: true,
      children: [],
      paths: [Array]
    }
  ],
  paths: [
    'D:\\0.vue\\0.nodejs\\node_modules',
    'D:\\0.vue\\node_modules',
    'D:\\node_modules'
  ]
}
</code></pre> 
<ol start="5"><li> <p>module.exports对象</p> <p>在自定义模块中，可以使用module.exports对象，将模块内成员共享出去</p> <p>外界用<code>require()</code>方法导入的就是module.exports对象</p> <p><strong>该对象默认为空</strong></p> <p>test.js</p> <pre><code class="prism language-js"><span class="token comment">//共享成员</span>
module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span>name<span class="token operator">=</span><span class="token string">'zhangsan'</span>
module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span><span class="token function-variable function">sayHello</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'你好啊'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

或者
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    一个json对象
<span class="token punctuation">}</span>
</code></pre> <p>执行代码</p> <pre><code class="prism language-js"><span class="token keyword">const</span> test <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./test.js'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>test<span class="token punctuation">)</span><span class="token punctuation">;</span>
test<span class="token punctuation">.</span><span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <p>注：<strong>导入的对象以module.exports对象为准</strong></p> </li><li> <p>exports对象</p> <p>nodejs提供exports对象，与module.exports指向同一个对象，但最终结果还是<strong>以module.exports指向的对象为准</strong></p> </li></ol> 
<pre><code class="prism language-js"><span class="token comment">//共享成员</span>
exports<span class="token punctuation">.</span>name<span class="token operator">=</span><span class="token string">'zhangsan'</span>
exports<span class="token punctuation">.</span><span class="token function-variable function">sayHello</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'你好啊'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="7"><li> <p>exports和module.exports的使用误区</p> <p>####require（）得到的一直都是module.exports所指对象</p> <p>将<strong>对象赋值给module.exports时，会开辟新的空间</strong>，增加属性则不会</p> <p>对象的赋值都会开辟新的空间？</p> </li></ol> 
<p>###3. Commonjs规范</p> 
<p>​ nodejs遵循了commonjs模块化规范</p> 
<p>​ commonjs规定</p> 
<pre><code>1. 每个模块内部。moudule变量代表当前模块
2. modoule变量是一个对象，该对象的exports（module.exports）属性是对外的接口
</code></pre> 
<ol start="3"><li>加载模块，使用require()</li></ol> 
<h4><a id="4_npm_369"></a>4. npm与包</h4> 
<p>​ npm是包管理器<a href="https://www.npmjs.com/" rel="nofollow">npm (npmjs.com)</a></p> 
<p>​ 网站用于搜索包，下包在另外一个服务器地址</p> 
<p>​ 包是基于内置模块封装出来的，可以极大提高开发效率</p> 
<ol><li> <p>如何下载包</p> <p>下包管理工具，在安装nodejs时会同时安装此工具</p> <pre><code class="prism language-js">npm <span class="token operator">-</span>v 
查看当前npm版本
npm install 包名
简写
npm i 包名
</code></pre> <pre><code>npm install --save mybatis-mapper
</code></pre> </li><li> <p>初次装包后多了一些文件</p> <p>node_modules：用来存放包</p> <p>package-lock.json：记录下载信息</p> <p>npm i 包名</p> <p>会安装最新的版本</p> <p>npm i moment@2.22.2</p> <p>安装指定的包版本（不用先卸载旧版本，会自动替换）</p> </li><li> <p>快速创建package.json</p> <pre><code>npm init -y
项目目录不能有中文
</code></pre> <p>npm i</p> <p>会根据package.json的内容，一次安装所有的包</p> <p>npm uninstall 包名</p> <p>卸载包</p> <p>devDependencies节点</p> <pre><code>如果有些包只在项目开发的时候用到，上线之后不会用到
npm i 包名 -D

如果开发和上线都需要用到就正常安装
</code></pre> </li><li> <p>解决下包速度慢</p> <pre><code class="prism language-js">查看当前下载源
npm config <span class="token keyword">get</span> registry

使用淘宝服务器下载
npm config <span class="token keyword">set</span> registry<span class="token operator">=</span>https<span class="token operator">:</span><span class="token operator">/</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">registry.npm.taobao.org</span><span class="token regex-delimiter">/</span></span>
</code></pre> </li><li> <p>nrm 方便切换下载源</p> <p>npm i nrm -g</p> <p>-g为全局安装</p> <pre><code>nrm ls
查看所有可用下载源
nrm use taobao
使用淘宝下载源
</code></pre> </li><li> <p>包的分类</p> <p>项目包</p> <p>​ 开发依赖包（包只在项目开发的时候用到，上线之后不会用到）</p> <p>​ <code>npm i 包名 -D</code></p> <p>​ 核心依赖包（开发和上线都需要用到）</p> <p>​ <code>npm i 包名</code></p> <p>全局包</p> <p>​ 提供-g参数，会把包安装为全局包</p> <p>​ <code>npm i 包名 -g</code></p> <p>​ <code>npm uninstall 包名 -g</code> 卸载全局包</p> <p>​ 全局包默认会被安装到(打开隐藏文件)</p> <p>​ <code> C:\User\用户\AppData\Roaming\npm\node_modules</code></p> <p>​ 一般而言，只有工具包才有全局安装必要，如nrm</p> <p>​ 也可以参考官网，看是否建议全局安装</p> <p><code>npm install -g i5ting_toc</code>:把.文档装换成html页面的小工具</p> <p>使用</p> <pre><code>i5ting_toc -f .\study.md
</code></pre> </li><li> <p>规范包的结构</p> 
  <ol><li> <p>包必须以单独的目录存在</p> </li><li> <p>顶级目录下需要有package.json包管理配置文件</p> </li><li> <p>package.json必须包含<code>name</code>, <code>version</code>, <code>main</code>这三个属性</p> <p>分别为名字，版本号，包的入口</p> </li></ol> </li><li> <p>发布自己的包</p> 
  <ol><li> <p>新建文件夹作为包的根目录，（命名为包名）</p> </li><li> <p>在文件夹中，新建如下三个文件</p> <p>· package.json (包管理配置文件)</p> <p>· index.js (包的入口文件)</p> <p>· README.md (包的说明文档)</p> </li><li> <p>初始化package.js</p> <p>name为包的名字，命名前需在npm官网上面查询一下，命名不允许重复</p> <p>mian用来指定导包的入口</p> <pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"name"</span><span class="token operator">:</span> <span class="token string">"mypackage"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"version"</span><span class="token operator">:</span> <span class="token string">"1.0.0"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"main"</span><span class="token operator">:</span> <span class="token string">"index.js"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"description"</span><span class="token operator">:</span> <span class="token string">"提供了什么什么功能"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"keywords"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"关键字"</span><span class="token punctuation">,</span><span class="token string">"第二个关键字"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">//开源许可协议</span>
    <span class="token string-property property">"license"</span><span class="token operator">:</span> <span class="token string">"ISC"</span>
<span class="token punctuation">}</span>
</code></pre> </li><li> <p>index.js (编写实现功能代码)</p> <pre><code class="prism language-js"><span class="token comment">// 定义格式化时间函数</span>
<span class="token keyword">function</span> <span class="token function">dataFormat</span><span class="token punctuation">(</span><span class="token parameter">dataStr</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> dt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>dataStr<span class="token punctuation">)</span>
    <span class="token keyword">const</span> y <span class="token operator">=</span> <span class="token function">padZero</span><span class="token punctuation">(</span>dt<span class="token punctuation">.</span><span class="token function">getFullYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> m <span class="token operator">=</span> <span class="token function">padZero</span><span class="token punctuation">(</span>dt<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> d <span class="token operator">=</span> <span class="token function">padZero</span><span class="token punctuation">(</span>dt<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>y<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>m<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>d<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">padZero</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> n <span class="token operator">&gt;</span> <span class="token number">9</span> <span class="token operator">?</span> n <span class="token operator">:</span> <span class="token string">'0'</span><span class="token operator">+</span> n
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports<span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    dataFormat
<span class="token punctuation">}</span>
</code></pre> <p>使用</p> <pre><code class="prism language-js"> <span class="token keyword">const</span> dt <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./mypackage/index'</span><span class="token punctuation">)</span>
 console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>dt<span class="token punctuation">)</span>
 <span class="token keyword">const</span> dt1 <span class="token operator">=</span> dt<span class="token punctuation">.</span><span class="token function">dataFormat</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>dt1<span class="token punctuation">)</span>
</code></pre> </li><li> <p>如果index.js中的功能很多，可以进行模块化拆分</p> 
    <ol><li> <p>提取某个函数，拆分到<code>src</code>(新建目录)下的<code>功能名.js</code>文件当中</p> </li><li> <p>在index.js中，导入各个模块（就是src下的各个<code>功能名.js</code>文件）</p> </li><li> <p>在index.js中，使用module.exports把对应的方法暴露出去</p> </li></ol> </li><li> <p>发布自己的包</p> <p>在运行npm login之前，必须将下包的服务器切换为官方服务器</p> <pre><code>nrm ls
nrm use npm
</code></pre> 
    <ol><li> <p>注册账号，在官网注册</p> </li><li> <p>登陆npm账号</p> <p>在终端输入npm login命令</p> <p>依次输入用户名、密码、邮箱</p> </li><li> <p>登陆成功之后，切换到包的根目录</p> <p>运行<code>npm publish</code>命令，就可以发布包（包名不能有已经存在的）</p> </li><li> <p>删除已发布的包</p> <p><code>npm unpublish 包名 --force</code></p> <p>该命令只能删除72小时以内的包，72小时之后将永远不能删除</p> <p>删除的包，24小时内不准重复发布</p> </li><li> <p>尽量不要往npm中发布没有意义的包</p> </li></ol> </li></ol> </li></ol> 
<h4><a id="5__600"></a>5. 模块加载机制</h4> 
<p><a href="https://www.bilibili.com/video/BV1a34y167AZ?p=37&amp;spm_id_from=pageDriver" rel="nofollow">09.模块的加载机制_哔哩哔哩_bilibili</a></p> 
<ol><li> <p>模块优先从缓存中加载</p> <p>所有的模块在第一次加载后，会被缓存，使用的时候优先从缓存中加载</p> </li><li> <p>内置模块加载优先级最高，第三方模块与内置模块相同时，以内置模块为准</p> </li><li> <p><strong>自定义模块</strong>（本地自己写的）需要以<code>./</code>或者<code>../</code>开头,不然会被当成内置模块或者第三方模块</p> </li><li> <p>使用require（）导入<strong>自定义模块</strong>时，如果省略扩展名</p> <p>会按照如下顺序寻找文件</p> 
  <ol><li>确切文件</li><li>补全.js</li><li>补全.json</li><li>补全.node</li></ol> </li><li> <p>第三方模块加载机制</p> <p>调用require（）时</p> <p>会从当前目录查找node_modules文件夹，到里面查找包</p> <p>如果没有node_modules文件夹，就会往上退一级目录，继续找</p> <p>直到为根目录为止</p> </li></ol> 
<h3><a id="Express_631"></a>Express</h3> 
<h4><a id="1_Express_633"></a>1. 初步认识Express</h4> 
<p><a href="https://www.expressjs.com.cn/" rel="nofollow">Express - 基于 Node.js 平台的 web 应用开发框架 - Express 中文文档 | Express 中文网 (expressjs.com.cn)</a></p> 
<p>​ 基于nodejs平台，快速，开发，极简的web开发框架</p> 
<p>​ 类似于nodejs中的http模块，专门用来创建web服务器的</p> 
<p>​ 本质上就是一个npm的第三方包</p> 
<p>​ 基于http模块封装出来的</p> 
<h4><a id="2__645"></a>2. 基本使用</h4> 
<ol><li> <p>安装</p> <pre><code>npm i express@4.17.1
</code></pre> 
  <ol start="2"><li>创建最基本的服务器</li></ol> <pre><code class="prism language-js"><span class="token comment">// 导入包</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token comment">// 创建web服务器</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">expres</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 调用app.listen(端口号，启动成功后的回调函数)</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'express server running'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
  <ol start="3"><li>监听get请求</li></ol> <pre><code class="prism language-js"><span class="token comment">// 导入包</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token comment">// 创建web服务器</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 调用app.listen(端口号，启动成功后的回调函数)</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'express server running'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// get第一个参数为url</span>
<span class="token comment">// 第二个参数：请求对应的函数</span>
<span class="token comment">//     req：请求对象，包含请求的属性和方法</span>
<span class="token comment">//     res：响应对象，包含响应的属性和方法</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
<span class="token comment">// app.send()向客户端发送响应数据</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Hello World!'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre> <p>post请求：</p> <pre><code class="prism language-js">与<span class="token keyword">get</span>请求相同
<span class="token comment">// post第一个参数为url</span>
<span class="token comment">// 第二个参数：请求对应的函数</span>
<span class="token comment">//     req：请求对象，包含请求的属性和方法</span>
<span class="token comment">//     res：响应对象，包含响应的属性和方法</span>
app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
<span class="token comment">// app.send()向客户端发送响应数据</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'post请求成功'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
  <ol start="4"><li>获取url中携带的查询参数</li></ol> <p>通过<code>req.query</code>对象，可以访问到客户端通过查询字符串的形式发送到服务器的参数（默认为空对象）</p> <pre><code class="prism language-js">app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
<span class="token comment">//   客户端使用?name=zs&amp;age=20这种查询字符串的形式发送到服务器的参数</span>
<span class="token comment">// 可以通过req.query对象访问到</span>
 console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>query<span class="token punctuation">)</span>
 res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>query<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <p>访问<a href="http://localhost/?name=zs&amp;age=1" rel="nofollow">localhost/?name=zs&amp;age=1</a></p> <p><strong>获取url中的动态参数</strong></p> <p>通过<code>req.params</code>对象，可以访问到url中，通过<code>:</code>匹配的动态参数</p> <pre><code class="prism language-js"><span class="token comment">//多个参数时url为</span>
<span class="token comment">//		/user/:id/:name</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user/:id'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// req.params 默认是一个空对象</span>
    <span class="token comment">// 里面存放动态匹配到的参数</span>
     console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>params<span class="token punctuation">)</span>
     res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>params<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <p>访问<a href="http://localhost/user/2" rel="nofollow">localhost/user/2</a></p> 
  <ol start="5"><li>express.static()</li></ol> <p>通过该函数，可以非常方便的创建一个<strong>静态资源服务器</strong></p> <pre><code class="prism language-js">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span><span class="token string">'public'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">//之后可以访问public目录下所有的文件了，不用加public前缀</span>
<span class="token comment">//如果需要加上public前缀</span>
</code></pre> </li></ol> 
<p>app.use(‘/public’,express.static(‘public’))<br> ```</p> 
<pre><code>访问[demo.jpg (1196×1982)](http://localhost/demo.jpg)

url不用包含public

托管多个静态资源目录，多次调用`app.use(express.static('public'))`就行
</code></pre> 
<h4><a id="3_nodemon_751"></a>3. nodemon的使用</h4> 
<p>nodemon会自动帮我们重启项目，方便开发和调试</p> 
<p>安装 <code>npm i -g nodemon</code></p> 
<p>使用nodemon</p> 
<pre><code>之前是使用 
node demo.js
来运行代码，需要手动重启
使用
nodemon demo.js
会自动监听代码改动
保存之后会自动重启
</code></pre> 
<h4><a id="4_Express_771"></a>4. Express中路由的学习</h4> 
<p>Express中的路由指的是<strong>客户处理请求</strong>与<strong>服务器处理函数</strong>之间的关系</p> 
<p>Express中的路由分三部分组成，<strong>请求类型</strong>，<strong>请求url地址</strong>，<strong>处理函数</strong></p> 
<p>格式如下：</p> 
<pre><code>app.METHOD(PATH,HANDLER)
</code></pre> 
<p>定义路由（挂载路由）</p> 
<pre><code class="prism language-js">app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
<span class="token comment">// app.send()向客户端发送响应数据</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Hello World!'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<ol><li> <p>路由的匹配过程</p> <p>按照代码中定义的<strong>先后顺序</strong></p> <p>并且需要<strong>请求类型</strong>和<strong>请求url地址</strong>都匹配</p> </li><li> <p><strong>路由的模块化</strong></p> <p>不建议将路由直接挂载到app上</p> <p>将路由分离为单独模块的步骤</p> 
  <ol><li>创建路由模块的.js文件</li><li>调用express.Router()函数创建路由对象</li><li>向路由对象上挂载具体路由</li><li>使用module.exports()向外共享路由对象</li><li>使用app.use()函数注册路由模块</li></ol> </li></ol> 
<p>创建<code>router.js</code>文件(作为路由模块)</p> 
<pre><code class="prism language-js"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token comment">// 调用express.Router()函数创建路由对象</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 向路由对象上挂载具体路由</span>
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'get user'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user2'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'get user2'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 使用module.exports向外共享路由对象</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router
</code></pre> 
<p>执行文件</p> 
<pre><code class="prism language-js"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token comment">//导入自定义的路由模块</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./router'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 注册路由模块</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'server start'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong>注意：app.use()函数的作用，是用来注册全局中间件的</strong></p> 
<ol start="3"><li> <p>为路由模块添加前缀</p> <pre><code class="prism language-js"><span class="token comment">//之后要访问router中所有的路由，都需要加api前缀</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/api'</span><span class="token punctuation">,</span>router<span class="token punctuation">)</span>
</code></pre> </li></ol> 
<h4><a id="5_Express_851"></a>5. Express中间件</h4> 
<p>业务处理过程中的中间处理环节</p> 
<p><strong>都有输入和输出</strong></p> 
<p>例子：污水处理</p> 
<p>一级处理 二级处理 三级处理</p> 
<p>前一个的输出作为后一个的输入</p> 
<p>处理污水的这三个环节，就可以叫作中间件</p> 
<ol><li> <p>中间件调用流程</p> <p>浏览器发起一次请求之后，可能需要多个中间件介入处理</p> <p>在请求经过多个中间件处理完成之后</p> <p><strong>最后通过路由来响应这次请求</strong></p> </li></ol> 
<p>当一个请求到达express服务器之后，可以连续调用多个中间件，对这次请求进行预处理</p> 
<ol start="2"><li> <p><strong>Express中间件</strong>的格式</p> <p>本质是一个<code>function</code>处理函数</p> <pre><code class="prism language-js">app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span>next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> </li></ol> 
<p>注意：中间件的形参列表中，<strong>必须包含next参数</strong>，而路由处理函数只包含req和res</p> 
<ol start="3"><li> <p>next()函数的作用</p> <p>实现多个中间件<strong>连续调用</strong>,把流转关系转交给下一个中间件，或者下一个路由</p> </li><li> <p>定义中间件函数</p> <pre><code class="prism language-js"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">//定义一个简单的中间件函数</span>
<span class="token keyword">const</span> <span class="token function-variable function">mw</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res<span class="token punctuation">,</span>next</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'这是最简单的中间件'</span><span class="token punctuation">)</span>
    <span class="token comment">//把流转关系交给中间件或者路由，没有下一个中间件就交给路由</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'server start'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> </li><li> <p><strong>全局生效</strong>的中间件</p> <p><strong>任何请求</strong>，到达服务器之后，<strong>都会触发</strong>的中间件，叫全局生效的中间件</p> <pre><code class="prism language-js"><span class="token comment">// 通过app.use(中间件函数)，来注册一个全局生效的中间件</span>
<span class="token comment">//全局生效的中间件，发起任何请求都会被执行</span>
<span class="token comment">//接上面</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>mw<span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'get user'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user2'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'get user2'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <p><strong>多个中间件和路由之间共享同一份req和res，在上游添加的属性可以在下游被使用</strong></p> <pre><code class="prism language-js"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">//定义一个的中间件函数</span>
<span class="token comment">// 需要获取每次响应时间</span>
<span class="token keyword">const</span> <span class="token function-variable function">mw1</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res<span class="token punctuation">,</span>next</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'server start'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>mw<span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'get user'</span><span class="token operator">+</span>req<span class="token punctuation">.</span>startTime<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user2'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'get user2'</span><span class="token operator">+</span>req<span class="token punctuation">.</span>startTime<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <p>连续定义多个中间件（按照先后顺序执行）</p> <pre><code class="prism language-js"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">//定义第一个的中间件函数</span>
<span class="token keyword">const</span> <span class="token function-variable function">mw1</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res<span class="token punctuation">,</span>next</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'调用第一个中间件'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> <span class="token function-variable function">mw2</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res<span class="token punctuation">,</span>next</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'调用第二个中间件'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'server start'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>mw1<span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>mw2<span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'get user'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user2'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'get user2'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <p><strong>局部生效的中间件</strong></p> <pre><code class="prism language-js"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">//定义局部中间件</span>
<span class="token keyword">const</span> <span class="token function-variable function">mw1</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res<span class="token punctuation">,</span>next</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'调用一个中间件'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'server start'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 创建路由</span>
<span class="token comment">// 让中间件只在第一个路由里面生效</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span>mw1<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">//当请求地址为/user时，中间件生效</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'get user'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user2'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">//当请求地址为/user2时，中间件不会生效</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'get user2'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <p>定义多个中间件</p> <pre><code class="prism language-js">方式<span class="token number">1</span>：
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user2'</span><span class="token punctuation">,</span>mw1<span class="token punctuation">,</span>mw2<span class="token punctuation">,</span>mw3<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">//当请求地址为/user2时，中间件不会生效</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'get user2'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

方式<span class="token number">2</span>：
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user2'</span><span class="token punctuation">,</span><span class="token punctuation">[</span>mw1<span class="token punctuation">,</span>mw2<span class="token punctuation">,</span>mw3<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">//当请求地址为/user2时，中间件不会生效</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'get user2'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <p><strong>中间件的五个注意事项</strong></p> 
  <ol><li>一定要在<strong>路由之前</strong>注册中间件</li><li>执行完中间件业务代码后，一<strong>定要调用next()函数</strong></li><li>多个中间件之间，共享req和res</li></ol> </li></ol> 
<h4><a id="6__1026"></a>6. 中间件分类</h4> 
<ol><li> <p>应用级别中间件</p> <p>通过<code>app.use()</code>或者<code>app.get()</code>或者<code>app.post()</code>绑定到app实例身上的中间件</p> 
  <ol start="2"><li>路由级别的中间件</li></ol> <p>绑定到<code>express.Router()</code>实例上的中间件</p> <p><code>router.use(中间件)</code></p> 
  <ol start="3"><li>错误级别的中间件</li></ol> <p>专门捕获整个项目中发生的异常错误</p> <p>错误级别的中间件function处理函数中，<strong>必须有四个参数</strong></p> </li></ol> 
<pre><code class="prism language-js"><span class="token comment">//错误级别中间件可以用来捕获错误</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>req<span class="token punctuation">,</span>res<span class="token punctuation">,</span>next</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'发生了错误'</span><span class="token operator">+</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token operator">+</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p>错误发生时，服务器会崩溃</p> 
<pre><code class="prism language-js"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'server start'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 人为制造错误</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'服务器内部发生了错误'</span><span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'get user'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user2'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'get user2'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p>捕获错误：(错误级别中间件要写在路由后面)</p> 
<p><strong>错误级别的中间件，必须注册在所有中间件之后</strong></p> 
<pre><code class="prism language-js"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 人为制造错误</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'服务器内部发生了错误'</span><span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'get user'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//定义错误级别中间件</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>req<span class="token punctuation">,</span>res<span class="token punctuation">,</span>next</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'发生了错误'</span><span class="token operator">+</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token operator">+</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'server start'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<ol start="4"><li> <p><strong>Express内置</strong>的中间件</p> 
  <ol><li> <p>express.static 快速托管静态资源的内置中间件，（无兼容性）</p> </li><li> <p>express.json 解析JSON格式的请求体数据（有兼容性，仅在4.16.0+版本中可用）</p> <pre><code class="prism language-js">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> </li></ol> <pre><code class="prism language-js"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'server start'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 配置josn解析中间件</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 在服务器，可以使用req.body这个属性，接收客户端发送的数据</span>
    <span class="token comment">// 默认情况下，如果配置解析表单数据的中间件</span>
    <span class="token comment">//body默认等于underfind</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'get user'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
  <ol start="3"><li>express.urlencoded解析URL-encoded格式的请求数据（有兼容性，4.16.0+）</li></ol> <pre><code class="prism language-js">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token literal-property property">extended</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <pre><code class="prism language-js"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'server start'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 配置josn解析中间件</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">//配置url-encoded解析中间件</span>
<span class="token comment">//解析url-encoded格式数据</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token literal-property property">extended</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 在服务器，可以使用req.body这个属性，接收客户端发送的数据</span>
    <span class="token comment">// 默认情况下，如果配置解析表单数据的中间件</span>
    <span class="token comment">//req.body默认等于underfind</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'get user'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/user2'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 在服务器，可以使用req.body这个属性，接收客户端发送的数据</span>
    <span class="token comment">// 默认情况下，如果配置解析表单数据的中间件</span>
    <span class="token comment">//body默认等于underfind</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'get user'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> </li><li> <p>第三方中间件</p> <p>非官方内置的，由第三方开发出来的中间件</p> <p>举例： <code>body-parser</code>使用步骤如下</p> <p>运行 <code>npm i body-parser </code>安装</p> <p>使用require导入</p> <p>app.use()调用</p> <p><strong>注意：Express.urlencoded中间件，就是基于body-parser这个第三方中间件封装出来的</strong></p> </li></ol> 
<h4><a id="7_expressurlencoded_1173"></a>7. 案例，手动模拟express.urlencoded中间件</h4> 
<pre><code class="prism language-js"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token comment">// 内置模块querystring，专门用来处理查询字符串</span>
<span class="token comment">// 该模块的parse()函数可以将查询字符串解析成对象的格式</span>
<span class="token keyword">const</span> qs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'querystring'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'server start'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//解析中间件</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res<span class="token punctuation">,</span>next</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token comment">// 监听req的data事件</span>
    <span class="token comment">//只要有数据到达服务器，就会触发data事件</span>
    req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
        str <span class="token operator">+=</span> chunk
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// 监听req的end事件</span>
    <span class="token comment">// 当请求体数据接收完毕之后，会自动触发req的end事件</span>
    req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 打印完整的请求体</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
        <span class="token comment">//解析请求体</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>qs<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment">// 将解析出来的数据，挂载到自定义属性body里面去</span>
        req<span class="token punctuation">.</span>body<span class="token operator">=</span>qs<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
        <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre> 
<p>将自定义中间件封装为模块</p> 
<pre><code class="prism language-js"><span class="token comment">// 内置模块querystring，专门用来处理查询字符串</span>
<span class="token comment">// 该模块的parse()函数可以将查询字符串解析成对象的格式</span>
<span class="token keyword">const</span> qs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'querystring'</span><span class="token punctuation">)</span>
<span class="token comment">//解析中间件</span>
<span class="token keyword">const</span> <span class="token function-variable function">fun</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res<span class="token punctuation">,</span>next</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token comment">// 监听req的data事件</span>
    <span class="token comment">//只要有数据到达服务器，就会触发data事件</span>
    req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
        str <span class="token operator">+=</span> chunk
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// 监听req的end事件</span>
    <span class="token comment">// 当请求体数据接收完毕之后，会自动触发req的end事件</span>
    req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 打印完整的请求体</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
        <span class="token comment">//解析请求体</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>qs<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment">// 将解析出来的数据，挂载到自定义属性body里面去</span>
        req<span class="token punctuation">.</span>body<span class="token operator">=</span>qs<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
        <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> fun
</code></pre> 
<p>测试</p> 
<pre><code class="prism language-js"><span class="token keyword">const</span> fun <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./模块化自定义函数.js'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'server start'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//自定义中间件函数，注册为全局中间件</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>fun<span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="8_Express_1258"></a>8. 使用Express写接口</h4> 
<p><strong>编写get接口</strong></p> 
<p>router.js</p> 
<pre><code class="prism language-js"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token comment">// 调用express.Router()函数创建路由对象</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/get'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">//获取查询字符串</span>
    <span class="token keyword">const</span> query <span class="token operator">=</span>req<span class="token punctuation">.</span>query
    <span class="token comment">//响应结果</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
        <span class="token literal-property property">statu</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token literal-property property">msg</span><span class="token operator">:</span><span class="token string">'请求成功'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">data</span><span class="token operator">:</span>query
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router
</code></pre> 
<p>test.js</p> 
<pre><code class="prism language-js"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./router'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">//配置解析表单中间件</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token literal-property property">extended</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/api'</span><span class="token punctuation">,</span>router<span class="token punctuation">)</span>
<span class="token comment">//启动服务器</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'server start'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong>编写post接口</strong></p> 
<p><strong>app.use(express.urlencoded({extended: false}))</strong></p> 
<p>使用post需要解析请求体时，要加入上面代码才能显示body</p> 
<p>在router.js中添加</p> 
<pre><code class="prism language-js">router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/post'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">//获取请求体url-encoded格式的数据</span>
    <span class="token keyword">const</span> body <span class="token operator">=</span>req<span class="token punctuation">.</span>body
    <span class="token comment">//响应结果</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
        <span class="token literal-property property">statu</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token literal-property property">msg</span><span class="token operator">:</span><span class="token string">'请求成功'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">data</span><span class="token operator">:</span>body
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="9__1318"></a>9. 接口的跨域问题</h4> 
<p>协议，域名，端口号<strong>都需要相同</strong>才能进行访问</p> 
<p>访问端：</p> 
<pre><code class="prism language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>IE=edge<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>get<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>get<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>post<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">//测试get接口</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#get'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                <span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">'GET'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">url</span><span class="token operator">:</span><span class="token string">'http://localhost:80/api/get'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">data</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">'zs'</span><span class="token punctuation">,</span><span class="token literal-property property">age</span><span class="token operator">:</span><span class="token string">'20'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token comment">//成功的回调函数</span>
                <span class="token function-variable function">success</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token comment">//测试post接口</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#post'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                <span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">'POST'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">url</span><span class="token operator">:</span><span class="token string">'http://localhost:80/api/post'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">data</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">'zs'</span><span class="token punctuation">,</span><span class="token literal-property property">age</span><span class="token operator">:</span><span class="token string">'20'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token comment">//成功的回调函数</span>
                <span class="token function-variable function">success</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>服务器端用上面写的接口</p> 
<p>解决跨域问题的方案主要有两种：</p> 
<pre><code>1. CORS（主流的解决方案，推荐使用）
2. JSONP（只支持GET请求）
</code></pre> 
<p>使用CORS中间件解决跨域问题</p> 
<pre><code class="prism language-js"><span class="token number">1.</span>安装中间件
 npm i cors
<span class="token number">2.</span><span class="token function">使用require</span><span class="token punctuation">(</span><span class="token string">'cors'</span><span class="token punctuation">)</span>导入中间件
<span class="token keyword">const</span> cors<span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cors'</span><span class="token punctuation">)</span>
<span class="token number">3.</span>在路由之前调用中间件
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">cors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>只需要在上面服务端代码加上</p> 
<pre><code class="prism language-js"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./apiRouter'</span><span class="token punctuation">)</span>
<span class="token comment">// 2.使用require('cors')导入中间件</span>
<span class="token keyword">const</span> cors<span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cors'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token literal-property property">extended</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">//解决跨域问题</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">cors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/api'</span><span class="token punctuation">,</span>router<span class="token punctuation">)</span>
<span class="token comment">//启动服务器</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'server start'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="10CORS_1408"></a>10.CORS(三个请求头)</h4> 
<p><strong>CORS跨域资源共享</strong><br> 什么是CORS<br> CORS (Cross-Origin Resource Sharing，跨域资源共享）由一系列HTTP响应头组成，这些HTTP响应头决定浏览器是否阻止前端JS代码跨域获取资源。<br> 浏览器的<strong>同源安全策略</strong>默认会阻止网页“跨域”获取资源。但如果接口服务器配置了CORS相关的<strong>HTTP响应头</strong>，就可以解除浏览器端的跨域访问限制。</p> 
<p><strong>CORS的注意事项</strong><br> CORS主要在<strong>服务器端进行配置</strong>。客户端浏览器无须做任何额外的配置，即可请求开启了CORS的接口。</p> 
<p>CORS在浏览器中有兼容性。只有支持XMLHttpRequest Level2的浏览器，才能正常访问开启了CORS的服务端接口(例如:IE10+、Chrome4+、FireFox3.5+)。</p> 
<p><strong>CORS响应头部：</strong><br> CORS响应头部– <strong>Access-Control-Allow-Origin</strong></p> 
<p>响应头部中可以携带一个Access-Control-Allow-Origin字段，其语法如下:</p> 
<pre><code class="prism language-js">Access<span class="token operator">-</span>Control<span class="token operator">-</span>Allow<span class="token operator">-</span>origin<span class="token operator">:</span> <span class="token operator">&lt;</span>origin<span class="token operator">&gt;</span> <span class="token operator">|</span><span class="token operator">*</span>
</code></pre> 
<p>其中，origin参数的值指定了允许访问该资源的外域URL。例如，下面的字段值将只允许来自http://itcast.cn的请求:</p> 
<pre><code class="prism language-js">res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span> <span class="token string">'Access-Control-Allow-Origin'</span><span class="token punctuation">,</span><span class="token string">'htp://itcast.cn'</span><span class="token punctuation">)</span>
</code></pre> 
<p>默认情况下，CORS仅支持客户端向服务器发送如下的9个请求头:<br> Accept、Accept-Language、Content-Language、DPR、Downlink、Save-Data、Viewport-Width、Width ,Content-Type (值仅限于text/plain、multipart/form-data、application/x-www-form-urlencoded三者之一)如果客户端向服务器发送了额外的请求头信息，则需要在服务器端，通过<strong>Access-Control-Allow-Headers</strong> 对额外的请求头进行声明，否则这次请求会失败!</p> 
<pre><code class="prism language-js"><span class="token comment">//允许客户端额外向服务器发送Content-Type 请求头和X-Custom-Header请求头</span>
<span class="token comment">//注意:多个请求头之间使用英文的逗号进行分割</span>
res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span> <span class="token string">'Access-Control-Allow-Headers '</span> <span class="token punctuation">,</span><span class="token string">'Content-Type，x-Custom-Header'</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong>CORS响应头部–Access-Control-Allow-Methods</strong><br> 默认情况下，CORS仅支持客户端发起GET、POST、HEAD请求。<br> 如果客户端希望通过PUT、DELETE等方式请求服务器的资源，则需要在服务器端，通过Access-Control-Alow-Methods来指明实际请求所允许使用的HTTP方法。<br> 示例代码如下:</p> 
<pre><code class="prism language-js"><span class="token comment">//只允许POST、GET、DELETE、HEAD请求方法</span>
res<span class="token punctuation">.</span><span class="token function">setHeader</span> <span class="token punctuation">(</span> <span class="token string">' Access-Control-Allow-Methods '</span>，<span class="token string">'POST，GET，DELETE，HEAD'</span><span class="token punctuation">)</span>
<span class="token comment">//允许所有的 HTTP请求方法</span>
res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span> <span class="token string">' Access-Control-Allow-Methods '</span><span class="token punctuation">,</span> <span class="token string">'*'</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="11_CORS_1456"></a>11. CORS请求的分类</h4> 
<ol><li> <p>简单请求</p> <p>同时满足两个条件</p> <p>请求方式为：get，post，head三者之一</p> <p>并且头部信息不超过九个请求体，（就是无自定义头部字段）</p> </li><li> <p>预检请求</p> <p><strong>在浏览器与服务器正式通信之前，浏览器会先发送OPTION请求进行预检，以获知服务器是否允许该实际请求，所以这一次的OPTION请求称为“预检请求”。服务器成功响应预检请求后，才会发送真正的请求，并且携带真实数据。</strong></p> <p>不满足简单请求条件的，都是预检请求</p> <p>只要符合以下任何一个条件的请求，都需要进行预检请求:</p> <p>一、请求方式为GET、POST、HEAD之外的请求Method类型<br> 二、请求头中包含自定义头部字段<br> 三、向服务器发送了application/json格式的数据</p> </li><li> <p>简单请求和预检请求的区别</p> <p>简单请求的特点:客户端与服务器之间只会发生一次请求。<br> 预检请求的特点∶客户端与服务器之间会发生两次请求，OPTION预检请求成功之后，才会发起真正的请求。</p> <p>测试时，不能用chome浏览器</p> <pre><code class="prism language-js"><span class="token comment">//预检请求代码</span>
<span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">//测试get接口</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#get'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                <span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">'GET'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">url</span><span class="token operator">:</span><span class="token string">'http://localhost:80/api/get'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">data</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">'zs'</span><span class="token punctuation">,</span><span class="token literal-property property">age</span><span class="token operator">:</span><span class="token string">'20'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token comment">//成功的回调函数</span>
                <span class="token function-variable function">success</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token comment">//测试post接口</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#post'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                <span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">'POST'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">url</span><span class="token operator">:</span><span class="token string">'http://localhost:80/api/post'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">data</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">'zs'</span><span class="token punctuation">,</span><span class="token literal-property property">age</span><span class="token operator">:</span><span class="token string">'20'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token comment">//成功的回调函数</span>
                <span class="token function-variable function">success</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

        <span class="token comment">//为删除按钮绑定点击事件处理函数</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#delete'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                <span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">'DELETE'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">url</span><span class="token operator">:</span><span class="token string">'http://localhost:80/api/delete'</span><span class="token punctuation">,</span>
                <span class="token comment">//成功的回调函数</span>
                <span class="token function-variable function">success</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> </li></ol> 
<h4><a id="12jsonp_1529"></a>12.jsonp接口</h4> 
<p>1.回顾JSONP的概念与特点<br> 概念:浏览器端通过</p> 
<p>​ JSONP仅支持GET请求，不支持POST、PUT、DELETE 等请求。</p> 
<p>创建jsonp接口的注意事项:</p> 
<p>如果项目中已经配置了CORS跨域资源共享，为了防止冲突，<strong>必须在配置CORS 中间件之前声明JSONP的接口</strong>。否则JSONP接口会被处理成开启了CORS的接口。示例代码如下:</p> 
<pre><code class="prism language-js"><span class="token comment">//优先创建JSONP接口【这个接口不会被处理成CORS接口】</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/api/jsonp'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//再配置 CORS中间件【后续的所有接口，都会被处理成CORS接口】</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">cors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">//这是一个开启了CORS的接口</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span> <span class="token string">'/api/get'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong>实现JSONP 接口的步骤</strong></p> 
<ol><li> <p>获取客户端发送过来的回调函数的名字</p> </li><li> <p>得到要通过JSONP形式发送给客户端的数据</p> </li><li> <p>根据前两步得到的数据，拼接出一个函数调用的字符串</p> </li><li> <p>把上一步拼接得到的字符串，响应给客户端的</p></li></ol> 
<p>在网页中使用jQuery发起JSONP请求</p> 
<pre><code class="prism language-js"><span class="token comment">//调用ajax函数，提供JSONP的配置选项，从而发起JSONP请求，示例代码如下:</span>
<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#btnJSONP'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
        <span class="token literal-property property">method</span><span class="token operator">:</span><span class="token string">'GET'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">url</span><span class="token operator">:</span><span class="token string">'http://localhost/api/jsonp'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">dataType</span><span class="token operator">:</span><span class="token string">'jsonp'</span><span class="token punctuation">,</span>
        <span class="token function-variable function">success</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="13_1591"></a>13.完整代码</h4> 
<p>apiRouter.js</p> 
<pre><code class="prism language-js"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token comment">// 调用express.Router()函数创建路由对象</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/get'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">//获取查询字符串</span>
    <span class="token keyword">const</span> query <span class="token operator">=</span>req<span class="token punctuation">.</span>query
    <span class="token comment">//响应结果</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
        <span class="token literal-property property">statu</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token literal-property property">msg</span><span class="token operator">:</span><span class="token string">'请求成功'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">data</span><span class="token operator">:</span>query
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/post'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">//获取请求体</span>
    <span class="token keyword">const</span> body <span class="token operator">=</span>req<span class="token punctuation">.</span>body
    <span class="token comment">//响应结果</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
        <span class="token literal-property property">statu</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token literal-property property">msg</span><span class="token operator">:</span><span class="token string">'请求成功'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">data</span><span class="token operator">:</span>body
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">'/delete'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
        <span class="token literal-property property">status</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token literal-property property">message</span><span class="token operator">:</span><span class="token string">'delete请求成功'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router
</code></pre> 
<p>apiRun.js</p> 
<pre><code class="prism language-js"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./apiRouter'</span><span class="token punctuation">)</span>
<span class="token comment">// 2.使用require('cors')导入中间件</span>
<span class="token keyword">const</span> cors<span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cors'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token literal-property property">extended</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">//优先创建JSONP接口【这个接口不会被处理成CORS接口】</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/api/jsonp'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span> 
    <span class="token comment">//1．获取客户端发送过来的回调函数的名字</span>
    <span class="token keyword">const</span> funcName <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>callback
<span class="token comment">//得到要通过JSONP形式发送给客户端的数据</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'zs '</span><span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">22</span> <span class="token punctuation">}</span>
<span class="token comment">//根据前两步得到的数据，拼接出一个函数调用的字符串</span>
   <span class="token keyword">const</span> scriptstr <span class="token operator">=</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>funcName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span>
<span class="token comment">//把上一步拼接得到的字符串，响应给客户端的&lt;script&gt;标签进行解析执行			</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>scriptstr<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//再配置 CORS中间件【后续的所有接口，都会被处理成CORS接口】</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">cors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/api'</span><span class="token punctuation">,</span>router<span class="token punctuation">)</span>
<span class="token comment">//启动服务器</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'server start'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p>html</p> 
<pre><code class="prism language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>IE=edge<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>get<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>get<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>post<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>delete<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>delete<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>jsonp<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>jsonp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">//测试get接口</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#get'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                <span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">'GET'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">url</span><span class="token operator">:</span><span class="token string">'http://localhost:80/api/get'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">data</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">'zs'</span><span class="token punctuation">,</span><span class="token literal-property property">age</span><span class="token operator">:</span><span class="token string">'20'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token comment">//成功的回调函数</span>
                <span class="token function-variable function">success</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token comment">//测试post接口</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#post'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                <span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">'POST'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">url</span><span class="token operator">:</span><span class="token string">'http://localhost:80/api/post'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">data</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">'zs'</span><span class="token punctuation">,</span><span class="token literal-property property">age</span><span class="token operator">:</span><span class="token string">'20'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token comment">//成功的回调函数</span>
                <span class="token function-variable function">success</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

        <span class="token comment">//为删除按钮绑定点击事件处理函数</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#delete'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                <span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">'POST'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">url</span><span class="token operator">:</span><span class="token string">'http://localhost:80/api/delete'</span><span class="token punctuation">,</span>
                <span class="token comment">//成功的回调函数</span>
                <span class="token function-variable function">success</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

        <span class="token comment">//</span>
        <span class="token comment">//调用ajax函数，提供JSONP的配置选项，从而发起JSONP请求，示例代码如下:</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#jsonp'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                <span class="token literal-property property">method</span><span class="token operator">:</span><span class="token string">'GET'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">url</span><span class="token operator">:</span><span class="token string">'http://localhost/api/jsonp'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">dataType</span><span class="token operator">:</span><span class="token string">'jsonp'</span><span class="token punctuation">,</span>
                <span class="token function-variable function">success</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/7bd0199aeba7122dc3d2f659379da35a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">安全测试的最佳实践</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/52fef88ff1e306892955ac22876a442f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">数据结构 —— 双向链表（超详细图解 &amp; 接口函数实现）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>