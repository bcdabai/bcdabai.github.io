<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>深入理解ICMP协议 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="深入理解ICMP协议" />
<meta property="og:description" content="ICMP概述：ICMP使用IP数据报传送。允许主机或路由器报告差错情况和提供有关异常的报告。使IP数据报转发更有效，提高交付成功的机会。 不产生ICMP差错报文的情况： 1）ICMP差错报文（但是，ICMP查询报文可能会产生） 2）目的地址是广播地址或多播地址的IP数据报。 3）作为链路层广播的数据报。 4）不是IP分片的第一片。 5）源地址不是单个主机的数据报。 目的是为了不产生广播风暴。 ICMP的规则：ICMP差错报文必须包括生成该差错报文的数据报IP首部，还必须至少包括跟在IP首部后面的前8个字节（TCP/UDP首部等）。
ICMP报文的分类 一、ICMP差错报告报文 1、终点不可达 Destination Unreachable Message 代码Code：
0 = net unreachable网络不可达; 1 = host unreachable主机不可达; 2 = protocol unreachable协议不可达; 3 = port unreachable端口不可达; 4 = fragmentation needed and DF set需要分片但设置了不可分片比特; 5 = source route failed源站选路失败. 123456789101112 产生的原因：UDP的规则之一是，如果收到一份UDP数据报而目的端口与某个正在使用的进程不相符，那么UDP返回一个ICMP不可达报文。
2、 源点抑制Source Quench Message 产生的原因：当一个系统（路由器或主机）接收数据报的速度比其处理速度快时，即路由器或者主机因拥塞丢弃数据报，可能产生这个差错，以减慢发送速度。
3、 时间超过Time Exceeded Message Code :
0 = time to live exceeded in transit传输期间生存时间为0; 1 = fragment reassembly time exceeded在数据报重装期间生存时间为0." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/1f819635aeb02fcf07782ae57f27ae45/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-06-26T16:16:36+08:00" />
<meta property="article:modified_time" content="2018-06-26T16:16:36+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">深入理解ICMP协议</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);"><span style="font-weight:700;">ICMP概述</span>：ICMP使用IP数据报传送。允许主机或路由器报告差错情况和提供有关异常的报告。使IP数据报转发更有效，提高交付成功的机会。 <br><span style="font-weight:700;">不产生ICMP差错报文的情况</span>： <br>1）ICMP差错报文（但是，ICMP查询报文可能会产生） <br>2）目的地址是广播地址或多播地址的IP数据报。 <br>3）作为链路层广播的数据报。 <br>4）不是IP分片的第一片。 <br>5）源地址不是单个主机的数据报。 <br>目的是为了不产生广播风暴。 <br><span style="font-weight:700;">ICMP的规则</span>：ICMP差错报文必须包括生成该差错报文的数据报IP首部，还必须至少包括跟在IP首部后面的前8个字节（TCP/UDP首部等）。</p> 
<h2 id="icmp报文的分类" style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);"><a name="t0"></a>ICMP报文的分类</h2> 
<h3 id="一icmp差错报告报文" style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);"><a name="t1"></a>一、ICMP差错报告报文</h3> 
<p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">1、终点不可达 Destination Unreachable Message <br><img src="https://images2.imgbox.com/d4/2a/wKkfcpvy_o.png" alt="这里写图片描述" title=""> <br>代码Code：</p> 
<pre class="prettyprint" style="font-size:14px;line-height:22px;"><code class="has-numbering">  0 = net unreachable网络不可达;

  1 = host unreachable主机不可达;

  2 = protocol unreachable协议不可达;

  3 = port unreachable端口不可达;

  4 = fragmentation needed and DF set需要分片但设置了不可分片比特;

  5 = source route failed源站选路失败.
</code></pre> 
<ul class="pre-numbering"><li style="color:rgb(153,153,153);">1</li><li style="color:rgb(153,153,153);">2</li><li style="color:rgb(153,153,153);">3</li><li style="color:rgb(153,153,153);">4</li><li style="color:rgb(153,153,153);">5</li><li style="color:rgb(153,153,153);">6</li><li style="color:rgb(153,153,153);">7</li><li style="color:rgb(153,153,153);">8</li><li style="color:rgb(153,153,153);">9</li><li style="color:rgb(153,153,153);">10</li><li style="color:rgb(153,153,153);">11</li><li style="color:rgb(153,153,153);">12</li></ul> 
<p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);"><span style="font-weight:700;">产生的原因</span>：UDP的规则之一是，如果收到一份UDP数据报而目的端口与某个正在使用的进程不相符，那么UDP返回一个ICMP不可达报文。</p> 
<p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">2、 源点抑制Source Quench Message <br><img src="https://images2.imgbox.com/40/2f/UaKCkAtI_o.png" alt="这里写图片描述" title=""> <br><span style="font-weight:700;">产生的原因</span>：当一个系统（路由器或主机）接收数据报的速度比其处理速度快时，即路由器或者主机因拥塞丢弃数据报，可能产生这个差错，以减慢发送速度。</p> 
<p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">3、 时间超过Time Exceeded Message <br><img src="https://images2.imgbox.com/21/fa/1B0uryJM_o.png" alt="这里写图片描述" title=""> <br>Code :</p> 
<pre class="prettyprint" style="font-size:14px;line-height:22px;"><code class="has-numbering">  0 = time to live exceeded in transit传输期间生存时间为0;

  1 = fragment reassembly time exceeded在数据报重装期间生存时间为0.
</code></pre> 
<ul class="pre-numbering"><li style="color:rgb(153,153,153);">1</li><li style="color:rgb(153,153,153);">2</li><li style="color:rgb(153,153,153);">3</li><li style="color:rgb(153,153,153);">4</li></ul> 
<p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);"><span style="font-weight:700;">产生的原因</span>：1、生存时间(实际是跳数)递减为0,数据报被丢弃,只有可能是路由器发送2、当目的主机收到一个分片时,就会启动一个分片计时器,如果计时器内其它分片没完全到达,丢弃已经收到的所有分片。</p> 
<p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">4、 参数问题Parameter Problem Message <br><img src="https://images2.imgbox.com/b5/46/hakHtetz_o.png" alt="这里写图片描述" title=""> <br>Code :</p> 
<pre class="prettyprint" style="font-size:14px;line-height:22px;"><code class="has-numbering">  0 = pointer indicates the error坏的IP首部；
  1 = Require option missing缺少必须选项.
</code></pre> 
<ul class="pre-numbering"><li style="color:rgb(153,153,153);">1</li><li style="color:rgb(153,153,153);">2</li><li style="color:rgb(153,153,153);">3</li></ul> 
<p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);"><span style="font-weight:700;">产生的原因</span>：数据报首部出现错误或者首部缺少一些选项。</p> 
<p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">5、改变路由Redirect Message <br><img src="https://images2.imgbox.com/eb/12/mOL8XFDU_o.png" alt="这里写图片描述" title=""> <br>Code :</p> 
<pre class="prettyprint" style="font-size:14px;line-height:22px;"><code class="has-numbering">  0 = Redirect datagrams for the Network网络重定向.

  1 = Redirect datagrams for the Host主机重定向.

  2 = Redirect datagrams for the Type of Service and Network服务类型和网络重定向.

  3 = Redirect datagrams for the Type of Service and Host服务类型和主机重定向.
</code></pre> 
<ul class="pre-numbering"><li style="color:rgb(153,153,153);">1</li><li style="color:rgb(153,153,153);">2</li><li style="color:rgb(153,153,153);">3</li><li style="color:rgb(153,153,153);">4</li><li style="color:rgb(153,153,153);">5</li><li style="color:rgb(153,153,153);">6</li><li style="color:rgb(153,153,153);">7</li><li style="color:rgb(153,153,153);">8</li></ul> 
<p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);"><span style="font-weight:700;">产生的原因</span>：路由器要经常更新自己的路由表,网络上主机的数量远远大于路由器的数量,如果主机也动态更新,将产生无法忍受的通信量,所以主机使用静态路由选择,一般情况下,开始时主机只知道默认路由地址,IP数据报将被发送到默认路由器,但也许此数据报应该被发到另外的路由器,默认路由器知道这种情况后,转发此数据报,并向源点发送改变路由ICMP,让主机刷新自己的路由表,主机的路由表通过这种方式进行更新 <br>说明:改变路由是唯一一个不会丢弃数据报的差错报告报文</p> 
<h3 id="二icmp询问报文" style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);"><a name="t2"></a>二、ICMP询问报文</h3> 
<p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">1、 回送请求和回答Echo or Echo Reply Message <br><img src="https://images2.imgbox.com/96/89/KywWgaSo_o.png" alt="这里写图片描述" title=""> <br>Type</p> 
<pre class="prettyprint" style="font-size:14px;line-height:22px;"><code class="has-numbering">  8 for echo message请求回显;

  0 for echo reply message回显应答.
</code></pre> 
<ul class="pre-numbering"><li style="color:rgb(153,153,153);">1</li><li style="color:rgb(153,153,153);">2</li><li style="color:rgb(153,153,153);">3</li><li style="color:rgb(153,153,153);">4</li></ul> 
<p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);"><span style="font-weight:700;">产生的原因</span>：一般用于源主机或源路由器判断目的主机或目的路由器能否与其通信,主机和路由器都能发送此报文,此报文包括了回送请求报文和回送回答报文,ping命令便是此报文 <br>2、时间戳请求和回答Timestamp or Timestamp Reply Message <br><img src="https://images2.imgbox.com/8e/08/FDk5G9iK_o.png" alt="这里写图片描述" title=""> <br>Type</p> 
<pre class="prettyprint" style="font-size:14px;line-height:22px;"><code class="has-numbering">  13 for timestamp message时间戳请求;

  14 for timestamp reply message时间戳应答.
</code></pre> 
<ul class="pre-numbering"><li style="color:rgb(153,153,153);">1</li><li style="color:rgb(153,153,153);">2</li><li style="color:rgb(153,153,153);">3</li><li style="color:rgb(153,153,153);">4</li></ul> 
<p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);"><span style="font-weight:700;">产生的原因</span>：包括时间戳请求报文和时间戳回答报文,它能够确定IP数据报在两台机器的往返时间,即使两个路由器本地时间不同步,但他们的往返时间仍然是精确的。 <br>三、完整的ICMP类型列表 <br><img src="https://images2.imgbox.com/a8/8e/TI49gOqC_o.png" alt="这里写图片描述" title=""> <br><img src="https://images2.imgbox.com/d1/d6/4lGpnqTd_o.png" alt="这里写图片描述" title=""> <br>四、ICMP报文的处理 <br><img src="https://images2.imgbox.com/22/34/1unXLgMW_o.png" alt="这里写图片描述" title=""> <br><img src="https://images2.imgbox.com/9e/09/7nLQWdDa_o.png" alt="这里写图片描述" title=""> <br><img src="https://images2.imgbox.com/c1/a5/E9EopHCo_o.png" alt="这里写图片描述" title=""> <br></p> 
<p><img src="https://images2.imgbox.com/b8/e1/6xUGuSa0_o.png" alt="这里写图片描述" title=""></p> 
<p>原文见：https://blog.csdn.net/liao152/article/details/44887263</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b3e0509446fe5521ad0bfb8a80f1f621/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">强迫症适用的python中文对齐问题.format细节修改</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2a4d0b79869e07f7341b0b829980bebb/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Java Web项目登录报Session Error</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>