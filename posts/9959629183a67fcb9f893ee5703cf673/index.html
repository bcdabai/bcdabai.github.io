<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>charles的基本介绍与使用 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="charles的基本介绍与使用" />
<meta property="og:description" content="目录 Charles安装一、抓包1.http请求1）Charles设置2）手机设置3）抓包 2.https请求1）前提2）手机安装证书3）电脑安装证书4）Charles开启Enable SSL Proxying 二、重定向（Map）1.Map Remote2.Map Local 三、Mock数据1.断点（Breakpoints）2.文件映射（Map Local） 四、其他1.限速五、Q&amp;A Charles安装 下载链接：https://www.charlesproxy.com/download/
同时支持Windows和Mac平台
以下内容基于Charles V 3.11.5
Fiddler/charles
一、抓包 1.http请求 1）Charles设置 Help - Local IP Address，可以查看电脑IP：
查看IP其它方法：
Windows：
WIN&#43;R，打开“cmd”
输入命令ipconfig
Mac：
系统偏好设置 -&gt; 网络
Proxy - Proxy Settings，查看代理端口，默认值8888，也可自行修改：
2）手机设置 iPhone：
点击红框位置打开代理设置页面，填写电脑端的IP和端口：
Android：
手机-设置-WiFi-已连接WiFi-详情-高级-代理-手动-主机名/端口
手机连上代理后，Charles将弹Access Control弹框，点击「allow」
误点了Deny？
Proxy - Access Control Setting，把手机的IP地址加上
3）抓包 选择一个请求
Overview：
请求的总体概况，包括请求URL/状态/请求方式/耗时/流量等信息，其中size是本次请求消耗的流量，具体到request和response的流量
Request：
点击「Form」，列出请求的所有参数
部分请求带了cookie，如打开团单详情页时请求的itemDetailNew接口
ctag埋点也在cookie中，即图中的bn_na_ctag字段，值经base64加密处理
Response：
以JSON或者JSON Text形式查看response
2.https请求 1）前提 Server端支持https请求
证书
证书是在Client和Server间建立SSL连接的基础
在Client和Server间加了代理后，要在 手机 - 代理工具、代理工具 - Server 间建立SSL连接，手机和电脑上都要安装证书" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/9959629183a67fcb9f893ee5703cf673/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-10-21T12:15:39+08:00" />
<meta property="article:modified_time" content="2023-10-21T12:15:39+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">charles的基本介绍与使用</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-kimbie-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#Charles_4" rel="nofollow">Charles安装</a></li><li><a href="#_10" rel="nofollow">一、抓包</a></li><li><ul><li><a href="#1http_11" rel="nofollow">1.http请求</a></li><li><ul><li><a href="#1Charles_12" rel="nofollow">1）Charles设置</a></li><li><a href="#2_28" rel="nofollow">2）手机设置</a></li><li><a href="#3_41" rel="nofollow">3）抓包</a></li></ul> 
   </li><li><a href="#2https_61" rel="nofollow">2.https请求</a></li><li><ul><li><a href="#1_62" rel="nofollow">1）前提</a></li><li><a href="#2_71" rel="nofollow">2）手机安装证书</a></li><li><a href="#3_84" rel="nofollow">3）电脑安装证书</a></li><li><a href="#4CharlesEnable_SSL_Proxying_88" rel="nofollow">4）Charles开启Enable SSL Proxying</a></li></ul> 
  </li></ul> 
  </li><li><a href="#Map_105" rel="nofollow">二、重定向（Map）</a></li><li><ul><li><a href="#1Map_Remote_106" rel="nofollow">1.Map Remote</a></li><li><a href="#2Map_Local_125" rel="nofollow">2.Map Local</a></li></ul> 
  </li><li><a href="#Mock_137" rel="nofollow">三、Mock数据</a></li><li><ul><li><a href="#1Breakpoints_138" rel="nofollow">1.断点（Breakpoints）</a></li><li><a href="#2Map_Local_143" rel="nofollow">2.文件映射（Map Local）</a></li></ul> 
  </li><li><a href="#_144" rel="nofollow">四、其他</a></li><li><a href="#1_145" rel="nofollow">1.限速</a></li><li><a href="#QA_154" rel="nofollow">五、Q&amp;A</a></li></ul> 
</div> 
<br> 
<img src="https://images2.imgbox.com/53/ef/aeoxv3U1_o.png" alt="在这里插入图片描述"> 
<p></p> 
<h2><a id="Charles_4"></a>Charles安装</h2> 
<p>下载链接：https://www.charlesproxy.com/download/<br> 同时支持Windows和Mac平台<br> 以下内容基于Charles V 3.11.5<br> Fiddler/charles</p> 
<h2><a id="_10"></a>一、抓包</h2> 
<h3><a id="1http_11"></a>1.http请求</h3> 
<h4><a id="1Charles_12"></a>1）Charles设置</h4> 
<p>Help - Local IP Address，可以查看电脑IP：<br> <img src="https://images2.imgbox.com/19/36/V09NLlpY_o.png" alt="在这里插入图片描述"></p> 
<p>查看IP其它方法：<br> Windows：</p> 
<p>WIN+R，打开“cmd”<br> 输入命令ipconfig<br> Mac：<br> 系统偏好设置 -&gt; 网络<br> Proxy - Proxy Settings，查看代理端口，默认值8888，也可自行修改：<br> <img src="https://images2.imgbox.com/e5/4b/NAvE4bJ5_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/47/64/Rv7uw6vG_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="2_28"></a>2）手机设置</h4> 
<p>iPhone：<br> 点击红框位置打开代理设置页面，填写电脑端的IP和端口：<br> <img src="https://images2.imgbox.com/9d/7d/p3krX7a0_o.png" alt="在这里插入图片描述"></p> 
<p>Android：<br> 手机-设置-WiFi-已连接WiFi-详情-高级-代理-手动-主机名/端口<br> <img src="https://images2.imgbox.com/44/ea/mwfH0YLZ_o.png" alt="在这里插入图片描述"></p> 
<p>手机连上代理后，Charles将弹Access Control弹框，点击「allow」</p> 
<p>误点了Deny？<br> Proxy - Access Control Setting，把手机的IP地址加上</p> 
<h4><a id="3_41"></a>3）抓包</h4> 
<p>选择一个请求<br> Overview：<br> 请求的总体概况，包括请求URL/状态/请求方式/耗时/流量等信息，其中size是本次请求消耗的流量，具体到request和response的流量<br> <img src="https://images2.imgbox.com/ab/7b/VthCwTrC_o.png" alt="在这里插入图片描述"></p> 
<p>Request：<br> 点击「Form」，列出请求的所有参数<br> <img src="https://images2.imgbox.com/fd/e0/jl8uAfJD_o.png" alt="在这里插入图片描述"></p> 
<p>部分请求带了cookie，如打开团单详情页时请求的itemDetailNew接口<br> ctag埋点也在cookie中，即图中的bn_na_ctag字段，值经base64加密处理<br> <img src="https://images2.imgbox.com/d5/ae/O98sEnRC_o.png" alt="在这里插入图片描述"></p> 
<p>Response：<br> 以JSON或者JSON Text形式查看response<br> <img src="https://images2.imgbox.com/5e/2d/LVwh8wS7_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/df/95/B1m8eBr9_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="2https_61"></a>2.https请求</h3> 
<h4><a id="1_62"></a>1）前提</h4> 
<p>Server端支持https请求<br> 证书<br> <img src="https://images2.imgbox.com/60/49/5HooJjtu_o.png" alt="在这里插入图片描述"></p> 
<p>证书是在Client和Server间建立SSL连接的基础<br> 在Client和Server间加了代理后，要在 手机 - 代理工具、代理工具 - Server 间建立SSL连接，手机和电脑上都要安装证书</p> 
<h4><a id="2_71"></a>2）手机安装证书</h4> 
<p>在手机连上代理后，用手机浏览器打开网址：http://charlesproxy.com/getssl，或是chl.pro/ssl，按提示安装证书。在安装证书前，手机需启用解锁密码。<br> <img src="https://images2.imgbox.com/7a/5d/M2nhRWwI_o.png" alt="在这里插入图片描述"></p> 
<p>Android：<br> <img src="https://images2.imgbox.com/74/e6/mIYfQjDU_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/57/59/hMuEYtvv_o.png" alt=""></p> 
<p>iOS：<br> 浏览器（建议用Safari）打开网址：http://charlesproxy.com/getssl<br> 手机未安装过描述文件时，证书状态是“尚未验证”，点击安装<br> 输入手机解锁密码，手机需设置密码后才能安装证书</p> 
<h4><a id="3_84"></a>3）电脑安装证书</h4> 
<p>Help - SSL Proxying - Install Charles Root Certificate<br> <img src="https://images2.imgbox.com/66/6e/xStnLv8z_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="4CharlesEnable_SSL_Proxying_88"></a>4）Charles开启Enable SSL Proxying</h4> 
<p>未开启Enable SSL Proxying时抓到的请求<br> <img src="https://images2.imgbox.com/bb/01/lDpk4V87_o.png" alt="在这里插入图片描述"></p> 
<p>开启SSL Proxying：<br> 点击选择一个host，右键弹出菜单，点击「Enable SSL Proxying」<br> <img src="https://images2.imgbox.com/a5/c5/iAqE07So_o.png" alt="在这里插入图片描述"></p> 
<p>在Proxy - SSL Proxying Settings中可以查看已经开启SSL Proxying的host<br> <img src="https://images2.imgbox.com/13/27/FfKegRQo_o.png" alt="在这里插入图片描述"></p> 
<p>TIPS：由于对app.nuomi.com域名做了dns-Proxy（防止运营商劫持，app.nuomi.com域名会解析成若干个IP），APP通过IP请求服务端，需要开启这些IP（约3-5个）的SSL Proxy<br> <img src="https://images2.imgbox.com/f0/81/iPmgTAAl_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="Map_105"></a>二、重定向（Map）</h2> 
<h3><a id="1Map_Remote_106"></a>1.Map Remote</h3> 
<p>naserver上线回归预览机或者单台时，通过以下配置，可将所有请求naserver的接口重定向至某台特定的机器<br> Tools - Map Remote<br> <img src="https://images2.imgbox.com/d6/7d/P5rIXYao_o.png" alt="在这里插入图片描述"></p> 
<p>配置Map From：配置支持通配符，Path填写：/naserver*<br> 配置Map To：http://nj03-orp-app1159.nj03:8200（2016.7.21 naserver单台机器，可能有变化，以上线当天orp上线单的机器为准）<br> <img src="https://images2.imgbox.com/35/be/j8p141iD_o.png" alt="在这里插入图片描述"></p> 
<p>启用Enabel Map Remote，勾选需要的规则<br> <img src="https://images2.imgbox.com/93/dc/yUmASOli_o.png" alt="在这里插入图片描述"></p> 
<p>使用Map Remote的一些场景<br> 背景：首页组件猜你喜欢样式优化，naserver likeitem接口的代码未上线，部署在QA环境，homepage接口无改动<br> 问题：QA环境的homepage接口暂时不可用，组件无法回归到金刚分类和各类运营位<br> 解决方案：<br> 请naserver QA调通QA环境的homepage接口，请MIS QA配置各类运营位<br> 将homepage接口通过map remote重定向到线上</p> 
<h3><a id="2Map_Local_125"></a>2.Map Local</h3> 
<p><img src="https://images2.imgbox.com/4f/15/PfKu9NFD_o.png" alt="在这里插入图片描述"></p> 
<p>保存接口的response至本地<br> 开启：Tools - Map Local - Enable Map Local<br> <img src="https://images2.imgbox.com/7a/48/hxRGyZZY_o.png" alt="在这里插入图片描述"></p> 
<p>配置map规则，并勾选<br> <img src="https://images2.imgbox.com/b2/55/Fw2wFvB4_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/3f/5f/I3DCTpdD_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="Mock_137"></a>三、Mock数据</h2> 
<h3><a id="1Breakpoints_138"></a>1.断点（Breakpoints）</h3> 
<p>选择一个接口-右键-breakpoints-设置断点-刷新手机页面-edit response-excute-检查手机展示的是不是你edit的response的内容<br> 1、今天讲的断点修改request后，返回报错的问题，是因为我们修改了request参数值之后sign值就变了，sign不对的话，会导致验参不通过，所以就报错；<br> 2、考虑生成正确的sign值，但是因为我们不知道秘钥也不知道接收方的编码方式，所以无法生成正确的sign值进行验参；<br> 3、所以就像我们今天操作的那样，不编辑request，直接下一步，然后编辑response，再对照手机看是否修改成功；</p> 
<h3><a id="2Map_Local_143"></a>2.文件映射（Map Local）</h3> 
<h2><a id="_144"></a>四、其他</h2> 
<h2><a id="1_145"></a>1.限速</h2> 
<p>限流：<br> Charles限流<br> Proxy-throting setting-enable<br> 注：Bandwidth（带宽）：模拟连接速度、<br> Utilistation（利用百分比）<br> Round-trip（往返延迟）：延迟也可以设置为任意毫秒数。延迟延迟模拟在较慢连接上经历的延迟，即在发出请求和在另一端接收请求之间的延迟<br> MTU（最大传输单元）<br> 3G随使用环境的不同约有300k-2Mbps左右的水平，2.5G(GPRS)一般在100kbps左右，2G（GSM）一般在5-9kbps左右</p> 
<h2><a id="QA_154"></a>五、Q&amp;A</h2> 
<p>1.Charles无法抓到手机的请求，或者切换网络环境后无法抓到请求<br> 表现：1.手机正常连接代理，但Charles无法抓到任何请求；2.在公司网络环境下使用正确，但在家里手机连接IP后，Charles没有弹出是否要接入的弹窗。<br> 问题：请求被防火墙拦截<br> 解决方法：控制面板-&gt;系统和安全-&gt;Windows 防火墙-&gt;允许程序通过windows防火墙通信，允许通过所有请求即可，如图</p> 
<p><img src="https://images2.imgbox.com/a3/ca/LuehmUnt_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4ea80f32d8751cf8b867b89d6b13ee7b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">C语言switch、while、for、do while干货~小白快看过来</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/46a345d586fc189e5fd58d9945a4dee1/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">k8s ingress注解</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>