<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Echarts图表通过Ajax动态更新数据 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Echarts图表通过Ajax动态更新数据" />
<meta property="og:description" content="由于业务需求需要做一个可视化的展示Demo，这个Demo需要前后端的共同支撑，所以思路大致是：首先我们想到的是用ajax动态请求服务端获取到json文件后，然后将其解析为可以直接使用的数据，最后把这些数据更新到Echarts中去。 简单的代码实现如下：
HTML：
&lt;div id=&#34;myId&#34;&gt;&lt;div/&gt; var myChart = echarts.init(document.getElementById(&#39;myId&#39;)); // 初始化 var dispute,traffice,criminal,fire,public_sercurity; //纠纷，交通，犯罪，火情，公共安全 var receive = []; // Echarts中data使用的更新数据数组 function getCategoryPolice(){ $.ajax({ type:&#34;GET&#34;, url:&#34;http://10.x.x.11:8080/SSH_Backstage/demoAction&#34;, dataType:&#39;json&#39;, async:true, beforeSend: function(){ // alert(&#34;loading....&#34;); }, //加载执行方法 error: function(){ alert(&#34;error&#34;); }, //错误执行方法 success: function(CategoryCon){ // 这里弹出某几项验证一下是否获取到了数据或者正确与否 /* alert(&#34;纠纷：&#34;&#43;CategoryCon.list[0].dispute); alert(&#34;交通:&#34;&#43;CategoryCon.list[0].traffice); alert(&#34;刑事:&#34;&#43;CategoryCon.list[0].criminal); alert(&#34;火情:&#34;&#43;CategoryCon.list[0].fire); alert(&#34;治安:&#34;&#43;CategoryCon.list[0].public_sercurity); */ // 解析数据并赋值给事先声明好的变量 dispute = CategoryCon.list[0].dispute; traffice = CategoryCon.list[0].traffice; criminal = CategoryCon.list[0].criminal; fire = CategoryCon.list[0].fire; public_sercurity = CategoryCon.list[0].public_sercurity; receive = []; // 将使用的数组置空，因为我做demo时在声明数组时有实际测试的数据 // 也可以这样置空数组:receive." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/eed3121c152faba0db522ae494611a1d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-07-07T11:45:15+08:00" />
<meta property="article:modified_time" content="2017-07-07T11:45:15+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Echarts图表通过Ajax动态更新数据</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>由于业务需求需要做一个可视化的展示Demo，这个Demo需要前后端的共同支撑，所以思路大致是：首先我们想到的是用ajax动态请求服务端获取到json文件后，然后将其解析为可以直接使用的数据，最后把这些数据更新到Echarts中去。 <br> 简单的代码实现如下：</p> 
<p>HTML：</p> 
<pre class="prettyprint"><code class=" hljs applescript">&lt;<span class="hljs-keyword">div</span> <span class="hljs-property">id</span>=<span class="hljs-string">"myId"</span>&gt;&lt;<span class="hljs-keyword">div</span>/&gt;</code></pre> 
<pre class="prettyprint"><code class=" hljs javascript"><span class="hljs-keyword">var</span> myChart = echarts.init(document.getElementById(<span class="hljs-string">'myId'</span>));   <span class="hljs-comment">// 初始化</span>

<span class="hljs-keyword">var</span> dispute,traffice,criminal,fire,public_sercurity;     <span class="hljs-comment">//纠纷，交通，犯罪，火情，公共安全 </span>
<span class="hljs-keyword">var</span> receive = [];                <span class="hljs-comment">// Echarts中data使用的更新数据数组</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getCategoryPolice</span><span class="hljs-params">()</span>{<!-- --></span>
       $.ajax({
           type:<span class="hljs-string">"GET"</span>,
           url:<span class="hljs-string">"http://10.x.x.11:8080/SSH_Backstage/demoAction"</span>,
           dataType:<span class="hljs-string">'json'</span>,
           async:<span class="hljs-literal">true</span>, 

            beforeSend: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{<!-- --></span>
    <span class="hljs-comment">//                     alert("loading....");</span>
                        }, <span class="hljs-comment">//加载执行方法</span>

            error: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{<!-- --></span>
                        alert(<span class="hljs-string">"error"</span>);
                   },  <span class="hljs-comment">//错误执行方法</span>

            success: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(CategoryCon)</span>{<!-- --></span>
                    <span class="hljs-comment">// 这里弹出某几项验证一下是否获取到了数据或者正确与否</span>
                    <span class="hljs-comment">/*
                    alert("纠纷："+CategoryCon.list[0].dispute);
                    alert("交通:"+CategoryCon.list[0].traffice);
                    alert("刑事:"+CategoryCon.list[0].criminal);
                    alert("火情:"+CategoryCon.list[0].fire);
                    alert("治安:"+CategoryCon.list[0].public_sercurity);
                    */</span>   
                    <span class="hljs-comment">// 解析数据并赋值给事先声明好的变量</span>
                        dispute = CategoryCon.list[<span class="hljs-number">0</span>].dispute;
                        traffice = CategoryCon.list[<span class="hljs-number">0</span>].traffice;
                        criminal = CategoryCon.list[<span class="hljs-number">0</span>].criminal;
                        fire = CategoryCon.list[<span class="hljs-number">0</span>].fire;
                        public_sercurity = CategoryCon.list[<span class="hljs-number">0</span>].public_sercurity;

                        receive = []; 
                        <span class="hljs-comment">// 将使用的数组置空，因为我做demo时在声明数组时有实际测试的数据</span>
                        <span class="hljs-comment">// 也可以这样置空数组:receive.splice(0，receive.length);</span>
                        <span class="hljs-comment">// 将解析好的json数据push到数组中，当然你也可以使用其他办法，我们这里为了简单明了，是写的直接push的方法。</span>
                        receive.push(<span class="hljs-built_in">parseInt</span>(dispute));
                        receive.push(<span class="hljs-built_in">parseInt</span>(traffice));
                        receive.push(<span class="hljs-built_in">parseInt</span>(criminal));
                        receive.push(<span class="hljs-built_in">parseInt</span>(fire));
                        receive.push(<span class="hljs-built_in">parseInt</span>(public_sercurity));

                        receive.push(<span class="hljs-built_in">parseInt</span>(dispute));
                        receive.push(<span class="hljs-built_in">parseInt</span>(dispute));
                        console.log(receive); <span class="hljs-comment">//此处可以打印数组</span>

                       <span class="hljs-comment">//myChart.hideLoading();    //隐藏加载动画</span>
                        myChart.setOption(
                            {
                                backgroundColor: <span class="hljs-string">"rgb(7,14,45)"</span>,     <span class="hljs-comment">//背景色</span>
                                title: {
                                text: <span class="hljs-string">'police'</span>,
                                <span class="hljs-comment">// 标题样式</span>
                                textStyle: {  
                                    color: <span class="hljs-string">'#fff'</span>  
                                }
                            },
                                tooltip: {},
                                legend: {
                                    data:[<span class="hljs-string">'人数'</span>,<span class="hljs-string">"sex"</span>],
                                    textStyle: {  
                                        color: <span class="hljs-string">'#fff'</span>     <span class="hljs-comment">// legend字体颜色 </span>
                                        }
                                },
                    xAxis: {
                        data: [<span class="hljs-string">"罗湖"</span>,<span class="hljs-string">"福田"</span>,<span class="hljs-string">"南山"</span>,<span class="hljs-string">"盐田"</span>,<span class="hljs-string">"宝安"</span>,<span class="hljs-string">"龙华"</span>,<span class="hljs-string">"龙岗"</span>],
                        axisLabel: {                      <span class="hljs-comment">// x轴的字体样式</span>
                                    show: <span class="hljs-literal">true</span>,
                                    textStyle: {
                                    fontSize:<span class="hljs-number">12</span>,          <span class="hljs-comment">// xAxis fontSize                                 </span>
                                        color: <span class="hljs-string">'#fff'</span>
                                    }
                                },
                        <span class="hljs-comment">// x轴的颜色和宽度</span>
                        axisLine:{
                            lineStyle:{
                                color:<span class="hljs-string">'#fff'</span>,
                                  width:<span class="hljs-number">1</span>,                  <span class="hljs-comment">//这里是坐标轴的宽度</span>
                            }
                        }
                    },


                    yAxis: { 
                        <span class="hljs-comment">// y轴的字体样式</span>
                        axisLabel: {
                                    show: <span class="hljs-literal">true</span>,
                                    textStyle: {
                                        color: <span class="hljs-string">'#fff'</span>
                                    }
                               },
                        <span class="hljs-comment">// y轴的颜色和宽度</span>
                        axisLine:{
                            lineStyle:{
                                color:<span class="hljs-string">'#fff'</span>,
                                  width:<span class="hljs-number">1</span>,                  <span class="hljs-comment">//这里是坐标轴的宽度</span>
                            }
                        }
                    },
                    series: [{
                        name: <span class="hljs-string">'人数'</span>,
                        type: <span class="hljs-string">'bar'</span>,
                        data: receive             <span class="hljs-comment">// 需要更新的数据在这里</span>
                    }]
                }

           );  <span class="hljs-comment">// setOption</span>

         } <span class="hljs-comment">//成功执行方法</span>
       }) <span class="hljs-comment">//ajax</span>
      } <span class="hljs-comment">// ajax外面的方法</span>

<span class="hljs-comment">// setInterval(function(){getCategoryPolice()}, 6*1000);    // 间歇执行</span>
   getCategoryPolice();
</code></pre> 
<p>由于一个问题，中间思考了一下，比如之前把setOption放在了ajax的外面，每次请求到正确的json数据，解析好push到声明好的数组中，数组是okay的，把它使用在Echarts的data处就是毫无反应（这里指的是我们之前声明的是有数据的数组，而并非是一个空数组），Echarts表使用的仍然时最初我们声明数组时的数据，原因是数组的值被改变了，但是没有把传给Echarts图表的值刷新（echarts使用的依旧是以前的值）。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a749afa35c68b563bb5f4155772b33de/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Xcode使用之安装ipa文件</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0a60cd69f5cdde6979c96bf0d03d09fb/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Rss Feed是什么？</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>