<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Jetson TX2 NX(Ubuntu 18.04) &#43; ROS melodic &#43; turtlebot功能包 &#43; realsense d455 &#43; ORB-SLAM2 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Jetson TX2 NX(Ubuntu 18.04) &#43; ROS melodic &#43; turtlebot功能包 &#43; realsense d455 &#43; ORB-SLAM2" />
<meta property="og:description" content="Jetson TX2 NX(Ubuntu 18.04) &#43; ROS melodic &#43; turtlebot功能包 &#43; realsense d455 &#43; ORB-SLAM2 1. 安装ROS melodic 更换中科大源 $ sudo sh -c &#39;. /etc/lsb-release &amp;&amp; echo &#34;deb http://mirrors.ustc.edu.cn/ros/ubuntu/ $DISTRIB_CODENAME main&#34; &gt; /etc/apt/sources.list.d/ros-latest.list&#39; 设置key $ sudo apt-key adv --keyserver &#39;hkp://keyserver.ubuntu.com:80&#39; --recv-key C1CF6E31E6BADE8868B172B4F42ED6FBAB17C654 更新软件源 sudo apt-get update 安装ROS桌面完整版 sudo apt-get install ros-melodic-desktop-full 初始化并更新 sudo apt-get install python3-pip sudo pip3 install rosdepc sudo rosdepc init rosdepc update 在sudo pip3 install rosdepc时遇到错误
[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-Xe8VLqC7-1684312007284)(C:\Users\chenl\AppData\Roaming\Typora\typora-user-images\image-20230510182544491.png)]" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/e12dfd70ecb9b922ad523c803f090b8a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-05-18T11:24:53+08:00" />
<meta property="article:modified_time" content="2023-05-18T11:24:53+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Jetson TX2 NX(Ubuntu 18.04) &#43; ROS melodic &#43; turtlebot功能包 &#43; realsense d455 &#43; ORB-SLAM2</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="Jetson_TX2_NXUbuntu_1804__ROS_melodic__turtlebot__realsense_d455__ORBSLAM2_1"></a>Jetson TX2 NX(Ubuntu 18.04) + ROS melodic + turtlebot功能包 + realsense d455 + ORB-SLAM2</h2> 
<h3><a id="1_ROS_melodic_3"></a>1. 安装ROS melodic</h3> 
<h4><a id="_5"></a>更换中科大源</h4> 
<pre><code class="prism language-c++">$ sudo sh -c '. /etc/lsb-release &amp;&amp; echo "deb http://mirrors.ustc.edu.cn/ros/ubuntu/ $DISTRIB_CODENAME main" &gt; /etc/apt/sources.list.d/ros-latest.list'
</code></pre> 
<h4><a id="key_11"></a>设置key</h4> 
<pre><code class="prism language-c++">$ sudo apt-key adv --keyserver 'hkp://keyserver.ubuntu.com:80' --recv-key C1CF6E31E6BADE8868B172B4F42ED6FBAB17C654
</code></pre> 
<h4><a id="_17"></a>更新软件源</h4> 
<pre><code class="prism language-c++">sudo apt-get update
</code></pre> 
<h4><a id="ROS_23"></a>安装ROS桌面完整版</h4> 
<pre><code class="prism language-c++">sudo apt-get install ros-melodic-desktop-full
</code></pre> 
<h4><a id="_29"></a>初始化并更新</h4> 
<pre><code class="prism language-c++">sudo apt-get install python3-pip 
sudo pip3 install rosdepc
sudo rosdepc init
rosdepc update
</code></pre> 
<p>在sudo pip3 install rosdepc时遇到错误</p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-Xe8VLqC7-1684312007284)(C:\Users\chenl\AppData\Roaming\Typora\typora-user-images\image-20230510182544491.png)]</p> 
<p>或为pip、pip3版本太旧导致的问题，升级即可。</p> 
<h3><a id="2_Ubuntu1804_turtlebot_44"></a>2. 在Ubuntu18.04 下安装turtlebot功能包</h3> 
<h4><a id="_46"></a>安装依赖</h4> 
<pre><code class="prism language-c++">$ sudo apt-get install ros-melodic-kobuki-*
$ sudo apt-get install ros-melodic-ecl-streams
$ sudo apt-get install libusb-dev
$ sudo apt-get install libspnav-dev
$ sudo apt-get install ros-melodic-joystick-drivers
$ sudo apt-get install bluetooth
$ sudo apt-get install libbluetooth-dev
$ sudo apt-get install libcwiid-dev
$ sudo apt-get install ros-melodic-bfl
</code></pre> 
<h4><a id="_60"></a>新建工作目录，准备相关包</h4> 
<pre><code class="prism language-c++">$ mkdir -p ~/turtlebot_ws/src 
$ cd ~/turtlebot_ws/src 

$ git clone https://github.com/turtlebot/turtlebot_simulator
$ git clone https://github.com/turtlebot/turtlebot.git
$ git clone https://github.com/turtlebot/turtlebot_apps.git
$ git clone https://github.com/udacity/robot_pose_ekf
$ git clone https://github.com/ros-perception/depthimage_to_laserscan.git 
$ git clone https://github.com/yujinrobot/kobuki_msgs.git
$ git clone https://github.com/yujinrobot/kobuki_desktop.git
$ cd kobuki_desktop/
$ rm -r kobuki_qtestsuite
$ cd ~/turtlebot_ws/src 
$ git clone https://ghproxy.com/https://github.com/toeklk/orocos-bayesian-filtering.git
$ git clone https://ghproxy.com/https://github.com/turtlebot/turtlebot_msgs.git
$ git clone https://ghproxy.com/https://github.com/ros-drivers/joystick_drivers.git
</code></pre> 
<p>若连接失败，在网站前加上</p> 
<pre><code class="prism language-c++">http://ghproxy.com/
</code></pre> 
<h4><a id="_87"></a>复制依赖库到工作空间下</h4> 
<pre><code class="prism language-c++">$ mkdir -p ~/repos/
$ cd ~/repos/
$ git clone https://ghproxy.com/https://github.com/yujinrobot/kobuki.git
$ cp -r kobuki/* ~/turtlebot_ws/src/
$ git clone https://ghproxy.com/https://github.com/yujinrobot/yujin_ocs.git
$ cp -r yujin_ocs/yocs_cmd_vel_mux/ yujin_ocs/yocs_controllers ~/turtlebot_ws/src/
</code></pre> 
<h4><a id="_98"></a>编译工作空间</h4> 
<pre><code class="prism language-c++">$ cd ~/turtlebot_ws
$ catkin_make
</code></pre> 
<p>编译时遇到错误，找不到opencv</p> 
<p>由于turtlebot功能包默认使用opencv版本为3.2.0，但是Jetson TX2 的opencv版本为4.1。</p> 
<p>Jetson在刷入系统和SDK manager时只能选择4.1版本的opencv。因为安装ROS melodic时附带3.2 版本的opencv，所以我还尝试过刷系统时不刷入SDK，但是装完ROS发现opencv版本还是4.1，于是放弃挣扎。</p> 
<p>解决方法：建立软连接</p> 
<pre><code class="prism language-c++">$ cd usr/local/include
$ sudo ln -s opencv4/ opencv  
</code></pre> 
<p>再重新catkin_make，通过。</p> 
<h4><a id="bashrc_120"></a>添加工作空间到bashrc文件</h4> 
<pre><code class="prism language-c++">$ echo "source ~/turtlebot_ws/devel/setup.bash" &gt;&gt; ~/.bashrc
$ source ~/.bashrc
</code></pre> 
<h4><a id="_127"></a>测试</h4> 
<pre><code class="prism language-c++">$ roslaunch turtlebot_bringup minimal.launch
</code></pre> 
<h3><a id="3__Realsense_SDK__realsenseros_133"></a>3. 安装Realsense SDK 和 realsense-ros</h3> 
<h4><a id="31__realsense_SDK_135"></a>3.1 安装realsense SDK</h4> 
<h5><a id="_137"></a>安装依赖</h5> 
<pre><code class="prism language-c++">$ sudo apt-get install libudev-dev pkg-config libgtk-3-dev
$ sudo apt-get install libusb-1.0-0-dev pkg-config
$ sudo apt-get install libglfw3-dev
$ sudo apt-get install libssl-dev
</code></pre> 
<p>遇到错误：安装libgtk-3-dev,未满足的依赖项。</p> 
<p>直接忽略，不要管，并不会影响后续包的安装，我把依赖项降级了，降级了两层依赖之后无法开机了，只能重新刷机，浪费了很多时间。</p> 
<h5><a id="github_150"></a>进入github网站下载源码</h5> 
<p>网址：https://github.com/IntelRealSense/librealsense/</p> 
<pre><code class="prism language-c++">$ mkdir build &amp;&amp; cd build
$ cmake
$ make -j4
$ sudo make install
</code></pre> 
<h5><a id="_161"></a>测试</h5> 
<pre><code class="prism language-c++">$ realsense-viewer
</code></pre> 
<h4><a id="32_ddynamic_reconfigure_167"></a>3.2 安装ddynamic_reconfigure</h4> 
<pre><code class="prism language-c++">$ sudo apt-get install ros-melodic-ddynamic-reconfigure
</code></pre> 
<h4><a id="33__realsenseros_173"></a>3.3 安装realsense-ros</h4> 
<p>创建工作空间</p> 
<pre><code class="prism language-c++">$ mkdir -p ~/catkin_ws/src
$ cd ~/catkin_ws/src/
</code></pre> 
<p>从github上下载realsense-ros并编译，访问github中realsense-ros，并查找历史版本</p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-kpl895el-1684312007285)(C:\Users\chenl\AppData\Roaming\Typora\typora-user-images\image-20230517155442347.png)]</p> 
<p>下载后放到src/文件夹中</p> 
<p>初始化工作空间并编译安装（依据官网教程）</p> 
<pre><code class="prism language-c++">$ catkin_init_workspace
$ cd ~/catkin_ws
$ catkin_make clean
$ catkin_make -DCATKIN_ENABLE_TESTING=False -DCMAKE_BUILD_TYPE=Release
$ catkin_make install
</code></pre> 
<p>添加工作路径到~/.bashrc</p> 
<pre><code class="prism language-c++">$ echo "source ~/catkin_ws/devel/setup.bash" &gt;&gt; ~/.bashrc
$ source ~/.bashrc
</code></pre> 
<p>测试使用</p> 
<pre><code class="prism language-c++">$ roslaunch realsense2_camera rs_camera.launch
</code></pre> 
<p>可以打开rostopic查看发布的话题</p> 
<p><img src="https://images2.imgbox.com/91/d5/4c4yGS6n_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="4_ORBSLAM2_216"></a>4. 安装ORB-SLAM2</h3> 
<h4><a id="41_Pangolin06_218"></a>4.1 安装Pangolin0.6版本</h4> 
<p>安装依赖项</p> 
<pre><code class="prism language-c++">sudo apt-get install libglew-dev libboost-dev libboost-thread-dev libboost-filesystem-dev
sudo apt-get install ffmpeg libavcodec-dev libavutil-dev libavformat-dev libswscale-dev libpng-dev
</code></pre> 
<p>编译并配置</p> 
<pre><code class="prism language-c++">cd Pangolin 
mkdir build &amp;&amp; cd build
cmake -DCPP11_NO_BOOST=1 ..
make
sudo make install
</code></pre> 
<h4><a id="42_Eigen_237"></a>4.2 安装Eigen</h4> 
<p>选择版本3.10.2，在网页上直接能搜索下载</p> 
<pre><code class="prism language-c++">cd eigen3
mkdir build
cd build
cmake ..
make
sudo make install
</code></pre> 
<p>移动头文件</p> 
<pre><code class="prism language-c++">sudo cp -r /usr/local/include/eigen3/Eigen /usr/local/include
</code></pre> 
<h4><a id="43_ORBSLAM2_256"></a>4.3 安装ORB-SLAM2</h4> 
<p>直接把ORB-SLAM2源码放在catkin_ws/src目录下</p> 
<pre><code class="prism language-c++">cd ORB_SLAM2
chmod +x build.sh build_ros.sh
./build.sh
./build_ros.sh
</code></pre> 
<p>编译时如果遇到错误</p> 
<pre><code class="prism language-c+">error: ’usleep’ was not declared in this scope
</code></pre> 
<p>在对应文件上加上</p> 
<pre><code class="prism language-c++">#include &lt;unistd.h&gt;
</code></pre> 
<p>由于使用的是opencv4.1.1而非opencv3.2.0</p> 
<p>遇到版本不兼容的问题</p> 
<p>错误1：找不到opencv，<a href="https://so.csdn.net/so/search?q=OpenCV&amp;spm=1001.2101.3001.7020">OpenCV</a> &gt; 2.4.3 not found<br> <img src="https://images2.imgbox.com/a4/ec/1MLJHwnr_o.png" alt="在这里插入图片描述"></p> 
<p>解决：修改cmakelist.txt, 将 opencv 3.0 改为 opencv 4.1</p> 
<p>错误2：#include &lt;opencv/cv.h&gt;</p> 
<p>解决：在对应位置替换为</p> 
<pre><code>#include&lt;opencv2/imgproc/imgproc_c.h&gt;
#include &lt;opencv2/highgui/highgui_c.h&gt;
</code></pre> 
<p>错误3：CV_LOAD_IMAGE_UNCHANGED</p> 
<p>解决：对应处替换为</p> 
<pre><code class="prism language-c++">cv::IMREAD_UNCHANGED
</code></pre> 
<p>错误4：undefined reference to symbol '_ZN5boost6system15system_categoryEv</p> 
<p>解决：在cmakelists.txt中添加</p> 
<pre><code class="prism language-c++">set(LIBS
${OpenCV_LIBS}
${EIGEN3_LIBS}
${Pangolin_LIBRARIES}
${PROJECT_SOURCE_DIR}/../../../Thirdparty/DBoW2/lib/libDBoW2.so
${PROJECT_SOURCE_DIR}/../../../Thirdparty/g2o/lib/libg2o.so
${PROJECT_SOURCE_DIR}/../../../lib/libORB_SLAM2.so
-lboost_system
)
</code></pre> 
<p>注意修改orb-slam2发布的ros话题，使用d455运行双目例子时，漂移严重且跟踪失败，注意关闭结构光，可在realsense-viewer处关闭</p> 
<p>靠回忆敲的过程，可能有遗漏和缺失，本文大部分参考：</p> 
<p>ROS https://blog.csdn.net/qq_45779334/article/details/119576218?spm=1001.2014.3001.5506</p> 
<p>turtlebot https://www.ncnynl.com/archives/201903/2884.html</p> 
<p>realsense d455 https://blog.csdn.net/qq_40186909/article/details/113104595?spm=1001.2014.3001.5506</p> 
<p>ORB-SLAM2 https://blog.csdn.net/zardforever123/article/details/127138151?spm=1001.2014.3001.5506</p> 
<p>opencv 4 ORB-SLAM2 编译问题 https://blog.csdn.net/K4762/article/details/105270600?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=opencv4%20%E5%AE%89%E8%A3%85orb-slam&amp;utm_medium=distribute.pc_search_result.none-task-blog-2<sub>all</sub>sobaiduweb~default-1-105270600.nonecase&amp;spm=1018.2226.3001.4187</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/80338976bf6c948db586209f17fe20ce/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【完美解决】ModuleNotFoundError: No module named ‘numpy‘</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/5da097fb06efe1758fcdeadc2bb6d4d7/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Python脚本实战【大麦网】抢票程序，我终于可以去看我杰哥的演唱会啦！</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>