<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Android 理解Context - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Android 理解Context" />
<meta property="og:description" content="文章目录 Android 理解ContextContext是什么Activity能直接new吗？ Context结构和源码一个程序有几个ContextContext的作用Context作用域获取ContextgetApplication()和getApplicationContext()区别Context引起的内存泄露错误的单例模式View持有Activity应用正确使用Context Android 理解Context Context是什么 Context可以理解为“上下文”或”环境“，它提供了访问系统服务及系统资源的功能，Context 参与加载资源、启动Activity、启动Service、获取系统服务/应用资源、创建View、数据库等操作。
通俗来讲：一个Android应用程序可以理解为一个部电影，Activity、Service、BroadcastReceiver、ContentProvider四大组件可以理解为电影中的四个主演。他们是由剧组（Android系统）一开始就制定好的，整部戏都是围绕这四位主演的，所以这四位主演不能随便在街上拉个人（new一个对象）就能演的，有了演员就需要摄像机拍摄，他们通过镜头（Context）将戏传递给观众，也就是说四大组件必须要在Context环境下运行，而其他的如Button、TextView、LinearLayout这些控件可以理解为配角，没有那么重要（可以new一个对象），
Activity能直接new吗？ 不能，Android的应用模型是基于组件的应用设计模式，组件的运行必须要一个完整的Android工程环境，只有在这个环境下，Activity、Service等系统组件才能正常运行。
Context结构和源码 Context源码：
public abstract class Context { // 作用1：获取应用相关信息 public abstract ApplicationInfo getApplicationInfo(); public abstract String getPackageName(); public abstract Looper getMainLooper(); public abstract int checkPermission(@NonNull String permission, int pid, int uid); // 作用2：获取系统/应用资源 // 如 AssetManager、PackageManager、Resources、System Service 以及 color、string、drawable 等 public abstract AssetManager getAssets(); public abstract Resources getResources(); public abstract PackageManager getPackageManager(); public abstract Context getApplicationContext(); public abstract ClassLoader getClassLoader(); public final @Nullable &lt;T&gt; T getSystemService(@NonNull Class&lt;T&gt; serviceClass) { ." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/338777dfb24ffd0fe02323e4b9d90a4f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-16T15:46:57+08:00" />
<meta property="article:modified_time" content="2024-01-16T15:46:57+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Android 理解Context</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-github-gist">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#Android_Context_2" rel="nofollow">Android 理解Context</a></li><li><ul><li><a href="#Context_4" rel="nofollow">Context是什么</a></li><li><ul><li><a href="#Activitynew_10" rel="nofollow">Activity能直接new吗？</a></li></ul> 
   </li><li><a href="#Context_16" rel="nofollow">Context结构和源码</a></li><li><a href="#Context_96" rel="nofollow">一个程序有几个Context</a></li><li><a href="#Context_104" rel="nofollow">Context的作用</a></li><li><a href="#Context_110" rel="nofollow">Context作用域</a></li><li><a href="#Context_132" rel="nofollow">获取Context</a></li><li><a href="#getApplicationgetApplicationContext_146" rel="nofollow">getApplication()和getApplicationContext()区别</a></li><li><a href="#Context_168" rel="nofollow">Context引起的内存泄露</a></li><li><ul><li><a href="#_170" rel="nofollow">错误的单例模式</a></li><li><a href="#ViewActivity_192" rel="nofollow">View持有Activity应用</a></li><li><a href="#Context_211" rel="nofollow">正确使用Context</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="Android_Context_2"></a>Android 理解Context</h2> 
<h3><a id="Context_4"></a>Context是什么</h3> 
<p>Context可以理解为“上下文”或”环境“，它提供了<strong>访问系统服务及系统资源的功能</strong>，Context 参与加载资源、启动Activity、启动Service、获取系统服务/应用资源、创建View、数据库等操作。</p> 
<p>通俗来讲：一个Android应用程序可以理解为一个部电影，Activity、Service、BroadcastReceiver、ContentProvider四大组件可以理解为电影中的四个主演。他们是由剧组（Android系统）一开始就制定好的，整部戏都是围绕这四位主演的，所以这四位主演不能随便在街上拉个人（new一个对象）就能演的，有了演员就需要摄像机拍摄，他们通过镜头（Context）将戏传递给观众，也就是说四大组件必须要在Context环境下运行，而其他的如Button、TextView、LinearLayout这些控件可以理解为配角，没有那么重要（可以new一个对象），</p> 
<h4><a id="Activitynew_10"></a>Activity能直接new吗？</h4> 
<p>不能，Android的应用模型是基于组件的应用设计模式，组件的运行必须要一个完整的Android工程环境，只有在这个环境下，Activity、Service等系统组件才能正常运行。</p> 
<h3><a id="Context_16"></a>Context结构和源码</h3> 
<p><img src="https://images2.imgbox.com/42/0b/Zd83bmZR_o.png" alt="在这里插入图片描述"></p> 
<p><strong>Context源码：</strong></p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Context</span> <span class="token punctuation">{<!-- --></span>
    
    <span class="token comment">// 作用1：获取应用相关信息</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token class-name">ApplicationInfo</span> <span class="token function">getApplicationInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token class-name">String</span> <span class="token function">getPackageName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token class-name">Looper</span> <span class="token function">getMainLooper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">int</span> <span class="token function">checkPermission</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> <span class="token class-name">String</span> permission<span class="token punctuation">,</span> <span class="token keyword">int</span> pid<span class="token punctuation">,</span> <span class="token keyword">int</span> uid<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 作用2：获取系统/应用资源</span>
    <span class="token comment">// 如 AssetManager、PackageManager、Resources、System Service 以及 color、string、drawable 等</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token class-name">AssetManager</span> <span class="token function">getAssets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token class-name">Resources</span> <span class="token function">getResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token class-name">PackageManager</span> <span class="token function">getPackageManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token class-name">Context</span> <span class="token function">getApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token class-name">ClassLoader</span> <span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token annotation punctuation">@Nullable</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">getSystemService</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> serviceClass<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token function">getString</span><span class="token punctuation">(</span><span class="token annotation punctuation">@StringRes</span> <span class="token keyword">int</span> resId<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">getColor</span><span class="token punctuation">(</span><span class="token annotation punctuation">@ColorRes</span> <span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">Drawable</span> <span class="token function">getDrawable</span><span class="token punctuation">(</span><span class="token annotation punctuation">@DrawableRes</span> <span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token class-name">Resources<span class="token punctuation">.</span>Theme</span> <span class="token function">getTheme</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">setTheme</span><span class="token punctuation">(</span><span class="token annotation punctuation">@StyleRes</span> <span class="token keyword">int</span> resid<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">TypedArray</span> <span class="token function">obtainStyledAttributes</span><span class="token punctuation">(</span><span class="token annotation punctuation">@StyleableRes</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> attrs<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

    <span class="token comment">// 作用3：四大组件之间的交互</span>
    <span class="token comment">// 如启动 Activity、Broadcast、Service，获取 ContentResolver 等</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">startActivity</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequiresPermission</span> <span class="token class-name">Intent</span> intent<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">sendBroadcast</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequiresPermission</span> <span class="token class-name">Intent</span> intent<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token class-name">Intent</span> <span class="token function">registerReceiver</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">BroadcastReceiver</span> receiver<span class="token punctuation">,</span>
                                            <span class="token class-name">IntentFilter</span> filter<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">unregisterReceiver</span><span class="token punctuation">(</span><span class="token class-name">BroadcastReceiver</span> receiver<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token class-name">ComponentName</span> <span class="token function">startService</span><span class="token punctuation">(</span><span class="token class-name">Intent</span> service<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">boolean</span> <span class="token function">stopService</span><span class="token punctuation">(</span><span class="token class-name">Intent</span> service<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">boolean</span> <span class="token function">bindService</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequiresPermission</span> <span class="token class-name">Intent</span> service<span class="token punctuation">,</span>
            <span class="token annotation punctuation">@NonNull</span> <span class="token class-name">ServiceConnection</span> conn<span class="token punctuation">,</span> <span class="token annotation punctuation">@BindServiceFlags</span> <span class="token keyword">int</span> flags<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">unbindService</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> <span class="token class-name">ServiceConnection</span> conn<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token class-name">ContentResolver</span> <span class="token function">getContentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 作用4：文件相关</span>
    <span class="token comment">// 如：获取缓存文件夹、删除文件、SharedPreference 相关等</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token class-name">File</span> <span class="token function">getSharedPreferencesPath</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token class-name">File</span> <span class="token function">getDataDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">boolean</span> <span class="token function">deleteFile</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token class-name">File</span> <span class="token function">getExternalFilesDir</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">String</span> type<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token class-name">File</span> <span class="token function">getCacheDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token class-name">SharedPreferences</span> <span class="token function">getSharedPreferences</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token annotation punctuation">@PreferencesMode</span> <span class="token keyword">int</span> mode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">boolean</span> <span class="token function">deleteSharedPreferences</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 作用5：数据库</span>
    <span class="token comment">// 如打开数据库、删除数据库、获取数据库路径等</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token class-name">SQLiteDatabase</span> <span class="token function">openOrCreateDatabase</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">boolean</span> <span class="token function">deleteDatabase</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token class-name">File</span> <span class="token function">getDatabasePath</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
   
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>Context是一个抽象类，提供了关于应用环境全局信息的信息，Android提供该抽象类的具体实现类，可以通过它获取应用程序的资源和启动Activity、发送广播等。</p> 
<p>Context有两个实现子类：ContextImpl类和ContextWrapper类。</p> 
<p>ContextWrapper类，如其名所言，是一个包装类，内部必须包含一个真正的Context引用，调用ContextWrapper的方法都会被指向真正的Context对。</p> 
<p>ContextThemeWrapper类，如起名所言，内部包含了与Theme（主题）相关的信息，这里的Theme就是定义在Androidmanifest.xml中主题，只有Activity才能定义主题，Servier是不需要主题的，所以Service直接继承自ContextWrapper，Application也同理。</p> 
<p>ContextImpl类是真正实现了Context中的所有方法，应用程序中所调用的各种Context类方法都来自该类。</p> 
<p>总的来讲：Context是一个抽象类，有两个子类，ContextImpl是具体实现类，ContextWrapper是包装类，Activity、Service、Application虽然都继承自ContextWrapper，但是在初始化是都会创建ContextImpl对象，有ContextImpl实现Context中的方法。</p> 
<h3><a id="Context_96"></a>一个程序有几个Context</h3> 
<p>Context数量 = Activity数量 + Service数量 + 1</p> 
<p>为什么没有BroadcastReceiver和ContentProvider，这是因为它们都不是Context的子类，所持有的Context对象是从其他地方传过来的。</p> 
<h3><a id="Context_104"></a>Context的作用</h3> 
<p>弹出Toast、启动Activity、启动Service、发送广播、操作数据库等。</p> 
<h3><a id="Context_110"></a>Context作用域</h3> 
<table><thead><tr><th>Context作用域</th><th>Application</th><th>Activity</th><th>Service</th></tr></thead><tbody><tr><td>Show a Dialog</td><td>No</td><td>Yes</td><td>No</td></tr><tr><td>Start an Activity</td><td>不推荐</td><td>Yes</td><td>不推荐</td></tr><tr><td>Layout Inflation</td><td>不推荐</td><td>Yes</td><td>不推荐</td></tr><tr><td>Start a Service</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>Send a Broadcast</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>Register Broadcast Receiver</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>Load Resource Values</td><td>Yes</td><td>Yes</td><td>Yes</td></tr></tbody></table> 
<p>启动Activity、弹出Dialog，必须使用Activity类型的Context。这是因为Android系统出于安全考虑，不允许Activity或Dialog凭空出现，一个Activity的启动必须建立在另一个Activity的基础上，也就是Activity任务栈。</p> 
<p>启动Activity也可以使用Application的Context，但是需要将启动模式改为singleTask。</p> 
<p>加载布局推荐使用Activity的Context，Application和Service当然也是合法的，但是会使用系统默认的主题样式。</p> 
<p>总而言之，Activity的Context作用域最广，这是因为Activity继承自ContextThemeWrapper，ContextThemeWrapper在ContextWrapper的基础上做了一些扩展，而Appliaction和Service继承自ContextWrapper。凡是和UI相关的都应该使用Activity的Context。</p> 
<h3><a id="Context_132"></a>获取Context</h3> 
<p>获取Context对象的四种方法：</p> 
<p>View#getContext()：通过View获取Context对象，也就是Activity对象。</p> 
<p>Activity#getApplicationContext()：获取Application的Context。</p> 
<p>ContextWrapper#getBaseContext()：获取ContextWrapper进行装饰前的Context。</p> 
<p>Activity#this：获取Activity对象。</p> 
<h3><a id="getApplicationgetApplicationContext_146"></a>getApplication()和getApplicationContext()区别</h3> 
<p>其实都是同一个对象，但是作用域不同。</p> 
<p>getApplication()表示获取一个Application，而Application本身就是一个Context，可以在Activity、Service中使用</p> 
<p>getApplicationContext()表示获取一个Application的Context，可以在BroadcastReceiver中使用</p> 
<p>比如可以通过BroadcastReiver中的Context获取Application对象。</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyReceiver</span> <span class="token keyword">extends</span> <span class="token class-name">BroadcastReceiver</span><span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token function">publicvoidonReceive</span><span class="token punctuation">(</span><span class="token class-name">Contextcontext</span><span class="token punctuation">,</span><span class="token class-name">Intentintent</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Application</span> myApp <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Application</span><span class="token punctuation">)</span>context<span class="token punctuation">.</span><span class="token function">getApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="Context_168"></a>Context引起的内存泄露</h3> 
<h4><a id="_170"></a>错误的单例模式</h4> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Singleton</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> instance<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Context</span> mContext<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>mContext <span class="token operator">=</span> context<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> instance<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>这个单例模式，instance作为静态变量，生命周期长于普通对象，如果使用Activity的Context，会导致Activity一直被持有，即使Activity被销毁了，这样会导致内存泄露。</p> 
<h4><a id="ViewActivity_192"></a>View持有Activity应用</h4> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainActivity</span> <span class="token keyword">extends</span> <span class="token class-name">Activity</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Drawable</span> mDrawable<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> saveInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>saveInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setContentView</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_main<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ImageView</span> iv <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ImageView</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mDrawable <span class="token operator">=</span> <span class="token function">getResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDrawable</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>ic_launcher<span class="token punctuation">)</span><span class="token punctuation">;</span>
        iv<span class="token punctuation">.</span><span class="token function">setImageDrawable</span><span class="token punctuation">(</span>mDrawable<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>mDrawable对象是一个静态变量会常驻内存，持有Activity的Context，即使Activity被销毁了也不会被回收，因此造成内存泄露。</p> 
<h4><a id="Context_211"></a>正确使用Context</h4> 
<ul><li>生命周期长的对象，优先使用Application的Context。</li><li>UI相关的场景，推荐使用Activity的Context。</li><li>尽量不要在Activity中使用非静态内部类，因为非静态内部类会隐式持有外部类实例的引用；如果需要使用静态内部类，应该将外部实例使用作为弱引用持有。</li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e67193964f98242a62afd7ca6df82466/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Android Context在四大组件及Application中的表现</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/fbdfc951ff1234e5f8dee648ca6a7fe9/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【加强版】小学数学出题，加减乘除混合运算，支持自定义数字，一键打印</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>