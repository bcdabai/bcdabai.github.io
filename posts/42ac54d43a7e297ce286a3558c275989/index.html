<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ZigBee-CC2530单片机 - 实现外部电压值的测量 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="ZigBee-CC2530单片机 - 实现外部电压值的测量" />
<meta property="og:description" content="ZigBee-CC2530单片机 - 实现外部电压值的测量 程序源码 /* 包含头文件 */ #include &#34;ioCC2530.h&#34; #include &lt;string.h&gt; #define LED1 P1_0 // P1_0定义为P1_0 led灯端口 #define uint16 unsigned short #define uint32 unsigned long #define uint unsigned int unsigned int flag,counter=0; //统计溢出次数 unsigned char s[8];//定义一个数组大小为8 void InitLED() { P1SEL&amp;=~0X01; //P1_0设置为普通的IO口 1111 1110 P1DIR |= 0x01; //配置P1_0的方向为输出 LED1=0; } void adc_Init(void) { APCFG |=1; P0SEL |= 0x01;	P0DIR &amp;= ~0x01;	} /************************************************************ * 名称 get_adc * 功能 读取ADC通道0电压值 * 入口参数 无 * 出口参数 16位电压值，分辨率为10mV ***************获取ADC通道0电压值************************/ uint16 get_adc(void) { uint32 value; ADCIF = 0; //清ADC 中断标志 //采用基准电压avdd5:3." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/42ac54d43a7e297ce286a3558c275989/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-02-14T20:17:35+08:00" />
<meta property="article:modified_time" content="2021-02-14T20:17:35+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ZigBee-CC2530单片机 - 实现外部电压值的测量</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="ZigBeeCC2530___0"></a>ZigBee-CC2530单片机 - 实现外部电压值的测量</h3> 
<h3><a id="_2"></a>程序源码</h3> 
<pre><code class="prism language-c"><span class="token comment">/* 包含头文件 */</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"ioCC2530.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">define</span> LED1 P1_0     </span><span class="token comment">// P1_0定义为P1_0  led灯端口</span>
<span class="token macro property">#<span class="token directive keyword">define</span> uint16 unsigned short</span>
<span class="token macro property">#<span class="token directive keyword">define</span> uint32 unsigned long</span>
<span class="token macro property">#<span class="token directive keyword">define</span> uint unsigned int</span>

<span class="token keyword">unsigned</span> <span class="token keyword">int</span> flag<span class="token punctuation">,</span>counter<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//统计溢出次数</span>
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> s<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//定义一个数组大小为8</span>

<span class="token keyword">void</span> <span class="token function">InitLED</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	P1SEL<span class="token operator">&amp;</span><span class="token operator">=</span><span class="token operator">~</span><span class="token number">0X01</span><span class="token punctuation">;</span>          <span class="token comment">//P1_0设置为普通的IO口 1111 1110</span>
	P1DIR <span class="token operator">|</span><span class="token operator">=</span> <span class="token number">0x01</span><span class="token punctuation">;</span>   			<span class="token comment">//配置P1_0的方向为输出</span>
	LED1<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">adc_Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	APCFG  <span class="token operator">|</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
	P0SEL  <span class="token operator">|</span><span class="token operator">=</span> <span class="token number">0x01</span><span class="token punctuation">;</span>	
	P0DIR  <span class="token operator">&amp;</span><span class="token operator">=</span> <span class="token operator">~</span><span class="token number">0x01</span><span class="token punctuation">;</span>	
<span class="token punctuation">}</span>
<span class="token comment">/************************************************************
* 名称       get_adc
* 功能       读取ADC通道0电压值
* 入口参数   无
* 出口参数   16位电压值，分辨率为10mV
***************获取ADC通道0电压值************************/</span>
uint16 <span class="token function">get_adc</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	uint32 value<span class="token punctuation">;</span>
	ADCIF <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>   <span class="token comment">//清ADC 中断标志</span>
	<span class="token comment">//采用基准电压avdd5:3.3V，通道0，启动AD转化</span>
	ADCCON3 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0x80</span> <span class="token operator">|</span> <span class="token number">0x10</span> <span class="token operator">|</span> <span class="token number">0x00</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span> <span class="token operator">!</span>ADCIF <span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token punctuation">;</span>  <span class="token comment">//等待AD转化结束</span>
	<span class="token punctuation">}</span>
	value <span class="token operator">=</span> ADCH<span class="token punctuation">;</span>
	value <span class="token operator">=</span> value<span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">;</span>
	value <span class="token operator">|</span><span class="token operator">=</span> ADCL<span class="token punctuation">;</span>
	<span class="token comment">// AD值转化成电压值</span>
	<span class="token comment">// 0 表示 0V ，32768 表示 3.3V</span>
	<span class="token comment">// 电压值 = (value*3.3)/32768 （V)</span>
	value <span class="token operator">=</span> <span class="token punctuation">(</span>value <span class="token operator">*</span> <span class="token number">330</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	value <span class="token operator">=</span> value <span class="token operator">&gt;&gt;</span> <span class="token number">15</span><span class="token punctuation">;</span>   <span class="token comment">// 除以32768</span>
	<span class="token comment">// 返回分辨率为0.01V的电压值</span>
	<span class="token keyword">return</span> <span class="token punctuation">(</span>uint16<span class="token punctuation">)</span>value<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">/**********串口通信初始化************************/</span>
<span class="token keyword">void</span> <span class="token function">initUART0</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	PERCFG <span class="token operator">=</span> <span class="token number">0x00</span><span class="token punctuation">;</span>	
	P0SEL <span class="token operator">=</span> <span class="token number">0x3c</span><span class="token punctuation">;</span>	
	U0CSR <span class="token operator">|</span><span class="token operator">=</span> <span class="token number">0x80</span><span class="token punctuation">;</span>
	U0BAUD <span class="token operator">=</span> <span class="token number">216</span><span class="token punctuation">;</span>
	U0GCR <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
	U0UCR <span class="token operator">|</span><span class="token operator">=</span> <span class="token number">0x80</span><span class="token punctuation">;</span>
	UTX0IF <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token comment">// 清零UART0 TX中断标志</span>
	EA <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>   <span class="token comment">//使能全局中断</span>
<span class="token punctuation">}</span>

<span class="token comment">/*************************************************
* 函数名称：inittTimer1
* 功    能：初始化定时器T1控制状态寄存器
******************定时器初始化*****************************/</span>
<span class="token keyword">void</span> <span class="token function">inittTimer1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	CLKCONCMD <span class="token operator">&amp;</span><span class="token operator">=</span> <span class="token number">0x80</span><span class="token punctuation">;</span>   <span class="token comment">//时钟速度设置为32MHz</span>
	T1CTL <span class="token operator">=</span> <span class="token number">0x0E</span><span class="token punctuation">;</span> <span class="token comment">// 配置128分频，模比较计数工作模式，并开始运行</span>
	T1CCTL0 <span class="token operator">|</span><span class="token operator">=</span> <span class="token number">0x04</span><span class="token punctuation">;</span>  <span class="token comment">//设定timer1通道0比较模式</span>
	T1CC0L <span class="token operator">=</span><span class="token number">50000</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">;</span>    <span class="token comment">// 把50000的低8位写入T1CC0L</span>
	T1CC0H <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">50000</span> <span class="token operator">&amp;</span> <span class="token number">0xFF00</span><span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//把50000的高8位写入T1CC0H</span>
	
	T1IF<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>           <span class="token comment">//清除timer1中断标志(同IRCON &amp;= ~0x02)</span>
	T1STAT <span class="token operator">&amp;</span><span class="token operator">=</span> <span class="token operator">~</span><span class="token number">0x01</span><span class="token punctuation">;</span>  <span class="token comment">//清除通道0中断标志</span>
	
	TIMIF <span class="token operator">&amp;</span><span class="token operator">=</span> <span class="token operator">~</span><span class="token number">0x40</span><span class="token punctuation">;</span>  <span class="token comment">//不产生定时器1的溢出中断</span>
	<span class="token comment">//定时器1的通道0的中断使能T1CCTL0.IM默认使能</span>
	IEN1 <span class="token operator">|</span><span class="token operator">=</span> <span class="token number">0x02</span><span class="token punctuation">;</span>    <span class="token comment">//使能定时器1的中断</span>
	EA <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token comment">//使能全局中断</span>
<span class="token punctuation">}</span>
<span class="token comment">/***********************************************************
* 函数名称：UART0SendByte
* 功    能：UART0发送一个字节
* 入口参数：c
* 出口参数：无
* 返 回 值：无
************************************************************/</span>
<span class="token keyword">void</span> <span class="token function">UART0SendByte</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> c<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	U0DBUF <span class="token operator">=</span> c<span class="token punctuation">;</span>		<span class="token comment">// 将要发送的1字节数据写入U0DBUF</span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>UTX0IF<span class="token punctuation">)</span> <span class="token punctuation">;</span>  <span class="token comment">// 等待TX中断标志，即U0DBUF就绪</span>
	UTX0IF <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>       <span class="token comment">// 清零TX中断标志</span>
<span class="token punctuation">}</span>

<span class="token comment">/**************************************************************
* 函数名称：UART0SendString
* 功    能：UART0发送一个字符串
* 入口参数：*str
* 出口参数：无
* 返 回 值：无
**********************************************************/</span>
<span class="token keyword">void</span> <span class="token function">UART0SendString</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>str<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">*</span>str <span class="token operator">!=</span> <span class="token string">'\0'</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">UART0SendByte</span><span class="token punctuation">(</span><span class="token operator">*</span>str<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 发送一字节</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**************获取电压值并处理数据******************/</span>
<span class="token keyword">void</span> <span class="token function">Get_val</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	uint16 sensor_val<span class="token punctuation">;</span>
	sensor_val<span class="token operator">=</span><span class="token function">get_adc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span>sensor_val<span class="token operator">/</span><span class="token number">100</span><span class="token operator">+</span><span class="token string">'0'</span><span class="token punctuation">;</span>
	s<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'.'</span><span class="token punctuation">;</span>
	s<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">=</span>sensor_val<span class="token operator">/</span><span class="token number">10</span><span class="token operator">%</span><span class="token number">10</span><span class="token operator">+</span><span class="token string">'0'</span><span class="token punctuation">;</span>
	s<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">=</span>sensor_val<span class="token operator">%</span><span class="token number">10</span><span class="token operator">+</span><span class="token string">'0'</span><span class="token punctuation">;</span>
	s<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'V'</span><span class="token punctuation">;</span>
	s<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'\n'</span><span class="token punctuation">;</span>
	s<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'\0'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">/******************************************
* 功    能：定时器T1中断服务子程序
************************************/</span>
<span class="token macro property">#<span class="token directive keyword">pragma</span> vector = T1_VECTOR </span><span class="token comment">//中断服务子程序</span>
__interrupt <span class="token keyword">void</span> <span class="token function">T1_ISR</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	EA <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>   <span class="token comment">//禁止全局中断</span>
	counter<span class="token operator">++</span><span class="token punctuation">;</span>
	T1STAT <span class="token operator">&amp;</span><span class="token operator">=</span> <span class="token operator">~</span><span class="token number">0x01</span><span class="token punctuation">;</span>  <span class="token comment">//清除通道0中断标志</span>
	EA <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>   <span class="token comment">//使能全局中断</span>
<span class="token punctuation">}</span>
<span class="token comment">/******************************************
* 函数名称：main
* 功    能：main函数入口
* 入口参数：无
* 出口参数：无
* 返 回 值：无
**************************************************/</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">InitLED</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">inittTimer1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//初始化Timer1</span>
	<span class="token function">initUART0</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// UART0初始化</span>
        <span class="token function">adc_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ADC初始化</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>counter<span class="token operator">&gt;=</span><span class="token number">15</span><span class="token punctuation">)</span>     <span class="token comment">//定时器每0.2S溢出中断计次</span>
		   <span class="token punctuation">{<!-- --></span>
			counter<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>       <span class="token comment">//清标志位</span>
			LED1 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token comment">//指示灯点亮</span>
			<span class="token function">Get_val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">UART0SendString</span><span class="token punctuation">(</span><span class="token string">"光照传感器电压值  "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">UART0SendString</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span> 
			LED1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token comment">//指示灯熄灭</span>
		    <span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/63a33e957044cbd1a148ef6cd5c6f5a1/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">TVM: Deep Learning模型的优化编译器(强烈推荐, 附踩坑记录)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/dca898020f15d10a39fc2fd196bd2fb9/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Ubuntu/linux下最强大的下载工具－aria2</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>