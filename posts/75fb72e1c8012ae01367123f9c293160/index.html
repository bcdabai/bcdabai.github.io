<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>多级反馈队列调度算法C语言 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="多级反馈队列调度算法C语言" />
<meta property="og:description" content="近期发现，网上对于多级反馈队列调度算法十分匮乏，要么代码太老，要么没什么用，限制性太大，要么copy来copy去，真没意思。正好自己操作系统上课要用，特此分享。
根据需求，自己可以在主函数中选择调度算法，包含抢占算法！
//RR(SLICE); // FCFS(); //SJF(); //SRTF(); //NonPriority(); Priority(); 完整代码 #include&lt;stdio.h&gt; #include&lt;stdlib.h&gt; #include&lt;stdbool.h&gt; #include&lt;unistd.h&gt; #include&lt;time.h&gt; #include&lt;string.h&gt; #include &lt;sys/types.h&gt; // #include&lt;sys/syscall.h&gt; /*本次实验模拟实现操作系统中进程调度算法,模拟进程在不同时刻到达的情况*/ #define PNUM 5 //进程的数量 #define TIMER 10 //定时器,最长CPU区间时间 #define SLICE 2//轮转算法的时间片 int timenow=0; //当前时刻 typedef struct node{ int pid; //进程号 int priority;//进程优先级,1~3,数字越小优先级越高 int arrival; //到达时间 int burst; //CPU区间时间 int rest; //剩余时间 char state;//进程状态,&#39;N&#39;新建,&#39;R&#39;运行,&#39;W&#39;等待CPU(就绪),&#39;T&#39;终止 struct node *next; }PCB; int gantt[TIMER*PNUM]={0}; //用一个gantt数组记录调度过程,每个时刻调度的进程号 PCB *job;//所有作业的序列,带头节点(为简化编程) PCB *ready=NULL; //进程就绪队列,不带头节点 PCB *tail=NULL; //记录就绪队列的尾节点 PCB *run=NULL;//正在运行中的进程,不带头结点 PCB *finish=NULL;//已经结束的程序,不带头结点 void InitialJob() { int i=0; PCB *p,*tail; job=(PCB *)malloc(sizeof(PCB));//生成头节点,其它域无意义 job-&gt;next=NULL; tail=job; for(i=0;i&lt;PNUM;i&#43;&#43;) //初始化进程的值 { p=(PCB *)malloc(sizeof(PCB));//生成新节点(新进程) p-&gt;pid=i&#43;1; p-&gt;priority=rand()%3&#43;1;//随机生成优先级:1~3 p-&gt;arrival=rand()%TIMER;//随机生成到达时刻0-9,(预计到达就绪队列的时间) p-&gt;burst=rand()%TIMER&#43;1;//随机生成CPU区间时间:1~10;(估计运行时间) p-&gt;rest=p-&gt;burst; p-&gt;state=&#39;N&#39;;//初始化进程的状态为&#39;新建&#39; p-&gt;next=NULL; tail-&gt;next=p; tail=p; //带头结点 } } void DisplayPCB(PCB *pcb) //显示队列 { struct node *p=pcb; if(pcb==NULL) {printf(&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/75fb72e1c8012ae01367123f9c293160/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-05-17T13:08:54+08:00" />
<meta property="article:modified_time" content="2022-05-17T13:08:54+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">多级反馈队列调度算法C语言</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>近期发现，网上对于多级反馈队列调度算法十分匮乏，要么代码太老，要么没什么用，限制性太大，要么copy来copy去，真没意思。正好自己操作系统上课要用，特此分享。<br> 根据需求，自己可以在主函数中选择调度算法，<strong>包含抢占算法</strong>！</p> 
<pre><code class="prism language-c">	<span class="token comment">//RR(SLICE);</span>
    <span class="token comment">// FCFS();</span>
    <span class="token comment">//SJF();</span>
    <span class="token comment">//SRTF();</span>
    <span class="token comment">//NonPriority();</span>
    <span class="token function">Priority</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre> 
<h4><a id="_13"></a>完整代码</h4> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdbool.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;time.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;string.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token comment">// #include&lt;sys/syscall.h&gt;</span>
<span class="token comment">/*本次实验模拟实现操作系统中进程调度算法,模拟进程在不同时刻到达的情况*/</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">PNUM</span>  <span class="token expression"><span class="token number">5</span> </span><span class="token comment">//进程的数量</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">TIMER</span> <span class="token expression"><span class="token number">10</span> </span><span class="token comment">//定时器,最长CPU区间时间</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">SLICE</span> <span class="token expression"><span class="token number">2</span></span><span class="token comment">//轮转算法的时间片</span></span>
 <span class="token keyword">int</span> timenow<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>     <span class="token comment">//当前时刻</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">node</span><span class="token punctuation">{<!-- --></span>
   <span class="token keyword">int</span> pid<span class="token punctuation">;</span>   <span class="token comment">//进程号</span>
   <span class="token keyword">int</span> priority<span class="token punctuation">;</span><span class="token comment">//进程优先级,1~3,数字越小优先级越高</span>
   <span class="token keyword">int</span> arrival<span class="token punctuation">;</span> <span class="token comment">//到达时间</span>
   <span class="token keyword">int</span> burst<span class="token punctuation">;</span>  <span class="token comment">//CPU区间时间</span>
   <span class="token keyword">int</span> rest<span class="token punctuation">;</span>  <span class="token comment">//剩余时间</span>
   <span class="token keyword">char</span> state<span class="token punctuation">;</span><span class="token comment">//进程状态,'N'新建,'R'运行,'W'等待CPU(就绪),'T'终止</span>
   <span class="token keyword">struct</span> <span class="token class-name">node</span> <span class="token operator">*</span>next<span class="token punctuation">;</span>
<span class="token punctuation">}</span>PCB<span class="token punctuation">;</span>

<span class="token keyword">int</span> gantt<span class="token punctuation">[</span>TIMER<span class="token operator">*</span>PNUM<span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">//用一个gantt数组记录调度过程,每个时刻调度的进程号 </span>

PCB <span class="token operator">*</span>job<span class="token punctuation">;</span><span class="token comment">//所有作业的序列,带头节点(为简化编程)</span>
PCB <span class="token operator">*</span>ready<span class="token operator">=</span><span class="token constant">NULL</span><span class="token punctuation">;</span> <span class="token comment">//进程就绪队列,不带头节点</span>
PCB <span class="token operator">*</span>tail<span class="token operator">=</span><span class="token constant">NULL</span><span class="token punctuation">;</span>  <span class="token comment">//记录就绪队列的尾节点</span>
PCB <span class="token operator">*</span>run<span class="token operator">=</span><span class="token constant">NULL</span><span class="token punctuation">;</span><span class="token comment">//正在运行中的进程,不带头结点</span>
PCB <span class="token operator">*</span>finish<span class="token operator">=</span><span class="token constant">NULL</span><span class="token punctuation">;</span><span class="token comment">//已经结束的程序,不带头结点</span>

<span class="token keyword">void</span> <span class="token function">InitialJob</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>   
    <span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    PCB <span class="token operator">*</span>p<span class="token punctuation">,</span><span class="token operator">*</span>tail<span class="token punctuation">;</span>
    job<span class="token operator">=</span><span class="token punctuation">(</span>PCB <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>PCB<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//生成头节点,其它域无意义</span>
    job<span class="token operator">-&gt;</span>next<span class="token operator">=</span><span class="token constant">NULL</span><span class="token punctuation">;</span>
    tail<span class="token operator">=</span>job<span class="token punctuation">;</span>
    
 <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>PNUM<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>         <span class="token comment">//初始化进程的值</span>
 <span class="token punctuation">{<!-- --></span> p<span class="token operator">=</span><span class="token punctuation">(</span>PCB <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>PCB<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//生成新节点(新进程)</span>
   p<span class="token operator">-&gt;</span>pid<span class="token operator">=</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
   p<span class="token operator">-&gt;</span>priority<span class="token operator">=</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">3</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//随机生成优先级:1~3</span>
   p<span class="token operator">-&gt;</span>arrival<span class="token operator">=</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">%</span>TIMER<span class="token punctuation">;</span><span class="token comment">//随机生成到达时刻0-9,(预计到达就绪队列的时间) </span>
   p<span class="token operator">-&gt;</span>burst<span class="token operator">=</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">%</span>TIMER<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//随机生成CPU区间时间:1~10;(估计运行时间)</span>
   p<span class="token operator">-&gt;</span>rest<span class="token operator">=</span>p<span class="token operator">-&gt;</span>burst<span class="token punctuation">;</span>
   p<span class="token operator">-&gt;</span>state<span class="token operator">=</span><span class="token char">'N'</span><span class="token punctuation">;</span><span class="token comment">//初始化进程的状态为'新建'</span>
   p<span class="token operator">-&gt;</span>next<span class="token operator">=</span><span class="token constant">NULL</span><span class="token punctuation">;</span> 
   tail<span class="token operator">-&gt;</span>next<span class="token operator">=</span>p<span class="token punctuation">;</span> 
   tail<span class="token operator">=</span>p<span class="token punctuation">;</span>  <span class="token comment">//带头结点</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">DisplayPCB</span><span class="token punctuation">(</span>PCB <span class="token operator">*</span>pcb<span class="token punctuation">)</span> <span class="token comment">//显示队列</span>
<span class="token punctuation">{<!-- --></span>
  <span class="token keyword">struct</span> <span class="token class-name">node</span> <span class="token operator">*</span>p<span class="token operator">=</span>pcb<span class="token punctuation">;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>pcb<span class="token operator">==</span><span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"XXXXXX\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"进程号 优先级 到达时刻 区间时间 剩余时间 进程状态\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">do</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"P%-3d\t"</span><span class="token punctuation">,</span>p<span class="token operator">-&gt;</span>pid<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%3d\t"</span><span class="token punctuation">,</span>p<span class="token operator">-&gt;</span>priority<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%3d\t"</span><span class="token punctuation">,</span>p<span class="token operator">-&gt;</span>arrival<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%3d\t"</span><span class="token punctuation">,</span>p<span class="token operator">-&gt;</span>burst<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%3d\t"</span><span class="token punctuation">,</span>p<span class="token operator">-&gt;</span>rest<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%3c\t"</span><span class="token punctuation">,</span>p<span class="token operator">-&gt;</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    p<span class="token operator">=</span>p<span class="token operator">-&gt;</span>next<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token keyword">while</span><span class="token punctuation">(</span>p<span class="token operator">!=</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">DisplayGantt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//显示甘特数组</span>
<span class="token punctuation">{<!-- --></span>
  <span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>timenow<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
  <span class="token punctuation">{<!-- --></span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>gantt<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"空闲,"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">else</span>
     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"P%d,"</span><span class="token punctuation">,</span>gantt<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/*注:关于周转时间,等待时间与响应时间的概念释疑:
  在课程教材&lt;操作系统概念第7版&gt;中(P141),上述三个时间是从进程到达的时间开始的.
  在辅助教材&lt;现代操作系统第4版&gt;中(P89),上述三个时间时从进程提交的时刻(0时刻)开始的.
  国内普遍接受前一种理解,本程序以课程教材中的解释为准来计算时间.
*/</span>
<span class="token keyword">void</span> <span class="token function">DisplayTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//显示周转时间t,等待时间w和响应时间r</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> t<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>w<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>r<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">float</span> t_avg<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>w_avg<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>r_avg<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
    <span class="token keyword">int</span> i<span class="token punctuation">,</span>j<span class="token punctuation">;</span>
    PCB <span class="token operator">*</span>p<span class="token punctuation">;</span> <span class="token comment">//用p遍历finish队列,查找进程Pi的到达时间,调用该函数时所有进程都已放入finish队列</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>finish<span class="token operator">==</span><span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token keyword">return</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"进程号    周转时间    等待时间    响应时间\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;=</span>PNUM<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span> p<span class="token operator">=</span>finish<span class="token punctuation">;</span>
       <span class="token keyword">while</span><span class="token punctuation">(</span>p<span class="token operator">-&gt;</span>pid<span class="token operator">!=</span>i<span class="token punctuation">)</span> p<span class="token operator">=</span>p<span class="token operator">-&gt;</span>next<span class="token punctuation">;</span>
       j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
       <span class="token keyword">while</span><span class="token punctuation">(</span>gantt<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">!=</span>i<span class="token punctuation">)</span> j<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">//遍历甘特数组,求进程Pi的响应时间</span>
        r<span class="token operator">=</span>j<span class="token punctuation">;</span>  <span class="token comment">//响应时刻</span>
        t<span class="token operator">=</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>        
       <span class="token keyword">for</span><span class="token punctuation">(</span>j<span class="token operator">=</span>r<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span>timenow<span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token comment">//继续遍历,求周转时间</span>
       <span class="token punctuation">{<!-- --></span> <span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">==</span>gantt<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> t<span class="token operator">=</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">//结束时刻</span>
       r<span class="token operator">=</span>r<span class="token operator">-</span>p<span class="token operator">-&gt;</span>arrival<span class="token punctuation">;</span>  <span class="token comment">//响应时间=响应时刻-到达时刻</span>
       t<span class="token operator">=</span>t<span class="token operator">-</span>p<span class="token operator">-&gt;</span>arrival<span class="token punctuation">;</span> <span class="token comment">//周转时间=结束时刻-到达时刻</span>
       w<span class="token operator">=</span>t<span class="token operator">-</span>p<span class="token operator">-&gt;</span>burst<span class="token punctuation">;</span> <span class="token comment">//等待时间=周转时间-运行时间</span>
       r_avg<span class="token operator">+=</span><span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>r<span class="token operator">/</span>PNUM<span class="token punctuation">;</span> <span class="token comment">//平均响应时间</span>
       w_avg<span class="token operator">+=</span><span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>w<span class="token operator">/</span>PNUM<span class="token punctuation">;</span>  <span class="token comment">//平均等待时间</span>
       t_avg<span class="token operator">+=</span><span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>t<span class="token operator">/</span>PNUM<span class="token punctuation">;</span>   <span class="token comment">//平均周转时间</span>
       
       <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"P%d       %4d       %4d       %4d\n"</span><span class="token punctuation">,</span>i<span class="token punctuation">,</span>t<span class="token punctuation">,</span>w<span class="token punctuation">,</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"平均周转时间:%.2f,平均等待时间%.2f,平均响应时间%.2f\n"</span><span class="token punctuation">,</span>t_avg<span class="token punctuation">,</span>w_avg<span class="token punctuation">,</span>r_avg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">ReadyQueue</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span> algo<span class="token punctuation">,</span><span class="token keyword">int</span> t<span class="token punctuation">)</span> <span class="token comment">//根据作业队列构造就绪队列,algo:算法,t:当前时刻</span>
<span class="token punctuation">{<!-- --></span>   
   <span class="token keyword">struct</span> <span class="token class-name">node</span> <span class="token operator">*</span>jpre<span class="token punctuation">,</span><span class="token operator">*</span>jcur<span class="token punctuation">,</span><span class="token operator">*</span>rpre<span class="token punctuation">,</span><span class="token operator">*</span> rcur<span class="token punctuation">;</span> 
   <span class="token keyword">int</span> j<span class="token punctuation">,</span>r<span class="token punctuation">,</span>a<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>         
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strcmp</span><span class="token punctuation">(</span>algo<span class="token punctuation">,</span><span class="token string">"FCFS"</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">0</span><span class="token operator">||</span><span class="token function">strcmp</span><span class="token punctuation">(</span>algo<span class="token punctuation">,</span><span class="token string">"RR"</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">//FCFS和RR的就绪队列的构造方式相同</span>
      a<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
   <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strcmp</span><span class="token punctuation">(</span>algo<span class="token punctuation">,</span><span class="token string">"SJF"</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment">//非抢占SJF</span>
      a<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
   <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strcmp</span><span class="token punctuation">(</span>algo<span class="token punctuation">,</span><span class="token string">"SRTF"</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment">//抢占式SJF,最短剩余时间优先</span>
      a<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>
   <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strcmp</span><span class="token punctuation">(</span>algo<span class="token punctuation">,</span><span class="token string">"Priority"</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">0</span><span class="token operator">||</span><span class="token function">strcmp</span><span class="token punctuation">(</span>algo<span class="token punctuation">,</span><span class="token string">"NonPriority"</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">//抢占和非抢占优先级 </span>
      a<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span>
   <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"ReadyQueue()函数调用参数错误!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>job<span class="token operator">-&gt;</span>next<span class="token operator">==</span><span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"作业队列为空!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span><span class="token punctuation">;</span><span class="token punctuation">}</span>  
    jpre<span class="token operator">=</span>job<span class="token punctuation">;</span>
    jcur<span class="token operator">=</span>job<span class="token operator">-&gt;</span>next<span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>jcur<span class="token operator">!=</span><span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token comment">//遍历作业序列中选择已到达进程,将其从作业队列移入就绪队列,直到作业队列为空 	  </span>
    <span class="token punctuation">{<!-- --></span>  
      <span class="token keyword">if</span><span class="token punctuation">(</span>jcur<span class="token operator">-&gt;</span>arrival<span class="token operator">&lt;=</span>t<span class="token punctuation">)</span> <span class="token comment">//如果当前时刻进程已经到达,则将其插入到就绪队列的合适位置</span>
      <span class="token punctuation">{<!-- --></span>
         <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"P%d到达.\n"</span><span class="token punctuation">,</span>jcur<span class="token operator">-&gt;</span>pid<span class="token punctuation">)</span><span class="token punctuation">;</span>
	     jpre<span class="token operator">-&gt;</span>next<span class="token operator">=</span>jcur<span class="token operator">-&gt;</span>next<span class="token punctuation">;</span>  <span class="token comment">//将jcur从作业队列移除</span>
         jcur<span class="token operator">-&gt;</span>state<span class="token operator">=</span><span class="token char">'W'</span><span class="token punctuation">;</span><span class="token comment">//将进程状态设置为就绪</span>
 	     <span class="token keyword">if</span><span class="token punctuation">(</span>ready<span class="token operator">==</span><span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token comment">//就绪队列为空</span>
         <span class="token punctuation">{<!-- --></span>jcur<span class="token operator">-&gt;</span>next<span class="token operator">=</span><span class="token constant">NULL</span><span class="token punctuation">;</span>ready<span class="token operator">=</span>jcur<span class="token punctuation">;</span>tail<span class="token operator">=</span>ready<span class="token punctuation">;</span><span class="token punctuation">}</span>
         <span class="token keyword">else</span>  <span class="token comment">//就绪队列不为空,遍历就绪队列,将jcur插入到合适位置</span>
         <span class="token punctuation">{<!-- --></span>	 rpre<span class="token operator">=</span>ready<span class="token punctuation">;</span>
             rcur<span class="token operator">=</span>ready<span class="token punctuation">;</span>
              <span class="token keyword">switch</span> <span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> <span class="token comment">//遍历就绪队列查找插入点</span>
                <span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span>    <span class="token comment">//FCFS,RR.根据到达时间arrival查找合适插入点</span>
                        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>rcur<span class="token operator">!=</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span>jcur<span class="token operator">-&gt;</span>arrival<span class="token operator">&gt;=</span>rcur<span class="token operator">-&gt;</span>arrival<span class="token punctuation">)</span><span class="token punctuation">)</span> 
                             <span class="token punctuation">{<!-- --></span>rpre<span class="token operator">=</span>rcur<span class="token punctuation">;</span>rcur<span class="token operator">=</span>rcur<span class="token operator">-&gt;</span>next<span class="token punctuation">;</span><span class="token punctuation">}</span>
						<span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span> <span class="token comment">//SJF,根据区间时间burst查找合适插入点 </span>
                         <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>rcur<span class="token operator">!=</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span>jcur<span class="token operator">-&gt;</span>burst<span class="token operator">&gt;=</span>rcur<span class="token operator">-&gt;</span>burst<span class="token punctuation">)</span><span class="token punctuation">)</span>
                               <span class="token punctuation">{<!-- --></span>rpre<span class="token operator">=</span>rcur<span class="token punctuation">;</span>rcur<span class="token operator">=</span>rcur<span class="token operator">-&gt;</span>next<span class="token punctuation">;</span><span class="token punctuation">}</span>
						 <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span>  <span class="token comment">//STRF,根据剩余时间rest查找合适插入点</span>
						<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>rcur<span class="token operator">!=</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span>jcur<span class="token operator">-&gt;</span>rest<span class="token operator">&gt;=</span>rcur<span class="token operator">-&gt;</span>rest<span class="token punctuation">)</span><span class="token punctuation">)</span>
                               <span class="token punctuation">{<!-- --></span>rpre<span class="token operator">=</span>rcur<span class="token punctuation">;</span>rcur<span class="token operator">=</span>rcur<span class="token operator">-&gt;</span>next<span class="token punctuation">;</span><span class="token punctuation">}</span>
						 <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span>  <span class="token comment">//Priority, Non-Priority,根据优先级查找合适插入点</span>
						<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>rcur<span class="token operator">!=</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span>jcur<span class="token operator">-&gt;</span>priority<span class="token operator">&gt;=</span>rcur<span class="token operator">-&gt;</span>priority<span class="token punctuation">)</span><span class="token punctuation">)</span> 
                             <span class="token punctuation">{<!-- --></span>rpre<span class="token operator">=</span>rcur<span class="token punctuation">;</span>rcur<span class="token operator">=</span>rcur<span class="token operator">-&gt;</span>next<span class="token punctuation">;</span><span class="token punctuation">}</span>
                       
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">default</span><span class="token operator">:</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
             <span class="token keyword">if</span><span class="token punctuation">(</span>rcur<span class="token operator">==</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token comment">// 插入点在就绪队列尾部</span>
             <span class="token punctuation">{<!-- --></span> 
               jcur<span class="token operator">-&gt;</span>next<span class="token operator">=</span><span class="token constant">NULL</span><span class="token punctuation">;</span>
               rpre<span class="token operator">-&gt;</span>next<span class="token operator">=</span>jcur<span class="token punctuation">;</span>
               tail<span class="token operator">=</span>jcur<span class="token punctuation">;</span>
			 <span class="token punctuation">}</span>
			 <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>rcur<span class="token operator">==</span>ready<span class="token punctuation">)</span> <span class="token comment">//插入点在头部</span>
             <span class="token punctuation">{<!-- --></span>
                jcur<span class="token operator">-&gt;</span>next<span class="token operator">=</span>rcur<span class="token punctuation">;</span>
                ready<span class="token operator">=</span>jcur<span class="token punctuation">;</span> 
             <span class="token punctuation">}</span>
             <span class="token keyword">else</span> <span class="token comment">//插入到rpre和rcur之间</span>
             <span class="token punctuation">{<!-- --></span>   
                jcur<span class="token operator">-&gt;</span>next<span class="token operator">=</span>rcur<span class="token punctuation">;</span>
                rpre<span class="token operator">-&gt;</span>next<span class="token operator">=</span>jcur<span class="token punctuation">;</span>  
             <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
          jcur<span class="token operator">=</span>jpre<span class="token operator">-&gt;</span>next<span class="token punctuation">;</span>  <span class="token comment">//下一个作业</span>
       <span class="token punctuation">}</span><span class="token keyword">else</span>   <span class="token comment">//当前作业未达到</span>
       <span class="token punctuation">{<!-- --></span>jpre<span class="token operator">=</span>jcur<span class="token punctuation">;</span>jcur<span class="token operator">=</span>jcur<span class="token operator">-&gt;</span>next<span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token comment">//下一个作业</span>
     <span class="token punctuation">}</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n作业队列:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">DisplayPCB</span><span class="token punctuation">(</span>job<span class="token operator">-&gt;</span>next<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">FCFS</span><span class="token punctuation">(</span> <span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>  
   timenow<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
   <span class="token keyword">while</span><span class="token punctuation">(</span>true<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n当前时刻:%d\n"</span><span class="token punctuation">,</span>timenow<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">ReadyQueue</span><span class="token punctuation">(</span><span class="token string">"FCFS"</span><span class="token punctuation">,</span>timenow<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//刷新就绪队列</span>
     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"就绪队列:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">DisplayPCB</span><span class="token punctuation">(</span>ready<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">if</span><span class="token punctuation">(</span>job<span class="token operator">-&gt;</span>next<span class="token operator">==</span><span class="token constant">NULL</span><span class="token operator">&amp;&amp;</span>ready<span class="token operator">==</span><span class="token constant">NULL</span><span class="token operator">&amp;&amp;</span>run<span class="token operator">==</span><span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token comment">//没有进程,结束循环   </span>
     <span class="token keyword">if</span><span class="token punctuation">(</span>ready<span class="token operator">!=</span><span class="token constant">NULL</span><span class="token operator">||</span>run<span class="token operator">!=</span><span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token comment">//有进程处于就绪或者运行状态</span>
     <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>run<span class="token operator">==</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token comment">//若CPU空闲</span>
		<span class="token punctuation">{<!-- --></span>        
		 run<span class="token operator">=</span>ready<span class="token punctuation">;</span>      <span class="token comment">//将CPU分配给ready队列的第一个进程</span>
     	 ready<span class="token operator">=</span>ready<span class="token operator">-&gt;</span>next<span class="token punctuation">;</span> 
     	 run<span class="token operator">-&gt;</span>next<span class="token operator">=</span><span class="token constant">NULL</span><span class="token punctuation">;</span>
         <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nP%d被调度程序分派CPU!\n"</span><span class="token punctuation">,</span>run<span class="token operator">-&gt;</span>pid<span class="token punctuation">)</span><span class="token punctuation">;</span>        
        <span class="token punctuation">}</span>
     	run<span class="token operator">-&gt;</span>rest<span class="token operator">--</span><span class="token punctuation">;</span>    <span class="token comment">//修改进程PCB</span>
     	run<span class="token operator">-&gt;</span>state<span class="token operator">=</span><span class="token char">'R'</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nP%d正在运行.......\n"</span><span class="token punctuation">,</span>run<span class="token operator">-&gt;</span>pid<span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"运行进程:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     	<span class="token function">DisplayPCB</span><span class="token punctuation">(</span>run<span class="token punctuation">)</span><span class="token punctuation">;</span>
        gantt<span class="token punctuation">[</span>timenow<span class="token punctuation">]</span><span class="token operator">=</span>run<span class="token operator">-&gt;</span>pid<span class="token punctuation">;</span> <span class="token comment">//记录当前时刻调度进程的ID号</span>
     	<span class="token keyword">if</span><span class="token punctuation">(</span>run<span class="token operator">-&gt;</span>rest<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>
     	<span class="token punctuation">{<!-- --></span>   <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nP%d结束!\n"</span><span class="token punctuation">,</span>run<span class="token operator">-&gt;</span>pid<span class="token punctuation">)</span><span class="token punctuation">;</span>
            run<span class="token operator">-&gt;</span>state<span class="token operator">=</span><span class="token char">'T'</span><span class="token punctuation">;</span>   
       		run<span class="token operator">-&gt;</span>next<span class="token operator">=</span>finish<span class="token punctuation">;</span>   <span class="token comment">//新完成的节点插入到finish的头结点,简单一点</span>
       		finish<span class="token operator">=</span>run<span class="token punctuation">;</span>
       		run<span class="token operator">=</span><span class="token constant">NULL</span><span class="token punctuation">;</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"结束进程队列:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      		<span class="token function">DisplayPCB</span><span class="token punctuation">(</span>finish<span class="token punctuation">)</span><span class="token punctuation">;</span>           
      	<span class="token punctuation">}</span>           	
      <span class="token punctuation">}</span>
      timenow<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">//下一时刻继续扫描作业队列  </span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">RR</span><span class="token punctuation">(</span><span class="token keyword">int</span> slice<span class="token punctuation">)</span>  <span class="token comment">//时间片作为参数</span>
<span class="token punctuation">{<!-- --></span>
   timenow<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> count<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//时间片计数,count==slice表示进程已经运行一个时间片</span>
   <span class="token keyword">while</span><span class="token punctuation">(</span>true<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n当前时刻:%d\n"</span><span class="token punctuation">,</span>timenow<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">ReadyQueue</span><span class="token punctuation">(</span><span class="token string">"RR"</span><span class="token punctuation">,</span>timenow<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//刷新就绪队列</span>
     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"就绪队列:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">DisplayPCB</span><span class="token punctuation">(</span>ready<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
     <span class="token keyword">if</span><span class="token punctuation">(</span>job<span class="token operator">-&gt;</span>next<span class="token operator">==</span><span class="token constant">NULL</span><span class="token operator">&amp;&amp;</span>ready<span class="token operator">==</span><span class="token constant">NULL</span><span class="token operator">&amp;&amp;</span>run<span class="token operator">==</span><span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token keyword">break</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token comment">//没有进程,结束循环 </span>
     <span class="token keyword">if</span><span class="token punctuation">(</span>ready<span class="token operator">==</span><span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>tail<span class="token operator">=</span><span class="token constant">NULL</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
     <span class="token keyword">if</span><span class="token punctuation">(</span>tail<span class="token operator">!=</span><span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"就绪队列尾节点:P%d\n"</span><span class="token punctuation">,</span>tail<span class="token operator">-&gt;</span>pid<span class="token punctuation">)</span><span class="token punctuation">;</span>  
     <span class="token keyword">if</span><span class="token punctuation">(</span>ready<span class="token operator">!=</span><span class="token constant">NULL</span><span class="token operator">||</span>run<span class="token operator">!=</span><span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token comment">//有进程处于就绪或者运行状态</span>
     <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>run<span class="token operator">==</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token comment">//若CPU空闲</span>
		<span class="token punctuation">{<!-- --></span>
         count<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>        
		 run<span class="token operator">=</span>ready<span class="token punctuation">;</span>      <span class="token comment">//将CPU分配给ready队列的第一个进程</span>
     	 ready<span class="token operator">=</span>ready<span class="token operator">-&gt;</span>next<span class="token punctuation">;</span> 
     	 run<span class="token operator">-&gt;</span>next<span class="token operator">=</span><span class="token constant">NULL</span><span class="token punctuation">;</span>
         <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nP%d被调度程序分派CPU!\n"</span><span class="token punctuation">,</span>run<span class="token operator">-&gt;</span>pid<span class="token punctuation">)</span><span class="token punctuation">;</span>        
        <span class="token punctuation">}</span>
        count<span class="token operator">++</span><span class="token punctuation">;</span>
     	run<span class="token operator">-&gt;</span>rest<span class="token operator">--</span><span class="token punctuation">;</span>    <span class="token comment">//修改进程PCB</span>
     	run<span class="token operator">-&gt;</span>state<span class="token operator">=</span><span class="token char">'R'</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nP%d正在运行.......\n"</span><span class="token punctuation">,</span>run<span class="token operator">-&gt;</span>pid<span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"运行进程:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     	<span class="token function">DisplayPCB</span><span class="token punctuation">(</span>run<span class="token punctuation">)</span><span class="token punctuation">;</span>
        gantt<span class="token punctuation">[</span>timenow<span class="token punctuation">]</span><span class="token operator">=</span>run<span class="token operator">-&gt;</span>pid<span class="token punctuation">;</span> <span class="token comment">//记录当前时刻调度进程的ID号</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\ncount=%d\n"</span><span class="token punctuation">,</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>run<span class="token operator">-&gt;</span>rest<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">//进程结束,将进程设置为终止状态,移入结束进程队列</span>
     	<span class="token punctuation">{<!-- --></span>   <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"P%d结束!\n"</span><span class="token punctuation">,</span>run<span class="token operator">-&gt;</span>pid<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment">// count=0;</span>
            run<span class="token operator">-&gt;</span>state<span class="token operator">=</span><span class="token char">'T'</span><span class="token punctuation">;</span>   
       		run<span class="token operator">-&gt;</span>next<span class="token operator">=</span>finish<span class="token punctuation">;</span>   <span class="token comment">//新完成的节点插入到finish的头结点,简单一点</span>
       		finish<span class="token operator">=</span>run<span class="token punctuation">;</span>
       		run<span class="token operator">=</span><span class="token constant">NULL</span><span class="token punctuation">;</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"结束进程队列:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      		<span class="token function">DisplayPCB</span><span class="token punctuation">(</span>finish<span class="token punctuation">)</span><span class="token punctuation">;</span>           
      	<span class="token punctuation">}</span> 
		<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>count<span class="token operator">==</span>slice<span class="token punctuation">)</span> <span class="token comment">//时间片结束,进程未结束,将run插入就绪队列尾部</span>
         <span class="token punctuation">{<!-- --></span>        
          <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"P%d时间片结束!\n"</span><span class="token punctuation">,</span>run<span class="token operator">-&gt;</span>pid<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token comment">// count=0;</span>
          run<span class="token operator">-&gt;</span>state<span class="token operator">=</span><span class="token char">'W'</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span><span class="token punctuation">(</span>ready<span class="token operator">!=</span><span class="token constant">NULL</span><span class="token punctuation">)</span>  
            <span class="token punctuation">{<!-- --></span>tail<span class="token operator">-&gt;</span>next<span class="token operator">=</span>run<span class="token punctuation">;</span>
             tail<span class="token operator">=</span>run<span class="token punctuation">;</span>
             <span class="token punctuation">}</span>
           <span class="token keyword">else</span> <span class="token comment">//时间片结束时就绪队列为空,将run直接放入就绪队列</span>
           <span class="token punctuation">{<!-- --></span> ready<span class="token operator">=</span>tail<span class="token operator">=</span>run<span class="token punctuation">;</span><span class="token punctuation">}</span>
          run<span class="token operator">=</span><span class="token constant">NULL</span><span class="token punctuation">;</span>           
         <span class="token punctuation">}</span>           	
      <span class="token punctuation">}</span>     	 
      timenow<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">//下一时刻继续扫描作业队列  </span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">SJF</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//课后完成,其实和FCFS的代码完全相同,除了构造就绪队列时按照短作业排序即可</span>
<span class="token punctuation">{<!-- --></span>
   timenow<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
   <span class="token keyword">while</span><span class="token punctuation">(</span>true<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n当前时刻:%d\n"</span><span class="token punctuation">,</span>timenow<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">ReadyQueue</span><span class="token punctuation">(</span><span class="token string">"SJF"</span><span class="token punctuation">,</span>timenow<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//以"SJF"方式构造就绪队列,除了这里,代码与FCFS完全相同</span>
     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"就绪队列:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">DisplayPCB</span><span class="token punctuation">(</span>ready<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">if</span><span class="token punctuation">(</span>job<span class="token operator">-&gt;</span>next<span class="token operator">==</span><span class="token constant">NULL</span><span class="token operator">&amp;&amp;</span>ready<span class="token operator">==</span><span class="token constant">NULL</span><span class="token operator">&amp;&amp;</span>run<span class="token operator">==</span><span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token comment">//没有进程,结束循环   </span>
     <span class="token keyword">if</span><span class="token punctuation">(</span>ready<span class="token operator">!=</span><span class="token constant">NULL</span><span class="token operator">||</span>run<span class="token operator">!=</span><span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token comment">//有进程处于就绪或者运行状态</span>
     <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>run<span class="token operator">==</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token comment">//若CPU空闲</span>
		<span class="token punctuation">{<!-- --></span>        
		 run<span class="token operator">=</span>ready<span class="token punctuation">;</span>      <span class="token comment">//将CPU分配给ready队列的第一个进程</span>
     	 ready<span class="token operator">=</span>ready<span class="token operator">-&gt;</span>next<span class="token punctuation">;</span> 
     	 run<span class="token operator">-&gt;</span>next<span class="token operator">=</span><span class="token constant">NULL</span><span class="token punctuation">;</span>
         <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nP%d被调度程序分派CPU!\n"</span><span class="token punctuation">,</span>run<span class="token operator">-&gt;</span>pid<span class="token punctuation">)</span><span class="token punctuation">;</span>        
        <span class="token punctuation">}</span>
     	run<span class="token operator">-&gt;</span>rest<span class="token operator">--</span><span class="token punctuation">;</span>    <span class="token comment">//修改进程PCB</span>
     	run<span class="token operator">-&gt;</span>state<span class="token operator">=</span><span class="token char">'R'</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nP%d正在运行.......\n"</span><span class="token punctuation">,</span>run<span class="token operator">-&gt;</span>pid<span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"运行进程:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     	<span class="token function">DisplayPCB</span><span class="token punctuation">(</span>run<span class="token punctuation">)</span><span class="token punctuation">;</span>
        gantt<span class="token punctuation">[</span>timenow<span class="token punctuation">]</span><span class="token operator">=</span>run<span class="token operator">-&gt;</span>pid<span class="token punctuation">;</span> <span class="token comment">//记录当前时刻调度进程的ID号</span>
     	<span class="token keyword">if</span><span class="token punctuation">(</span>run<span class="token operator">-&gt;</span>rest<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>
     	<span class="token punctuation">{<!-- --></span>   <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nP%d结束!\n"</span><span class="token punctuation">,</span>run<span class="token operator">-&gt;</span>pid<span class="token punctuation">)</span><span class="token punctuation">;</span>
            run<span class="token operator">-&gt;</span>state<span class="token operator">=</span><span class="token char">'T'</span><span class="token punctuation">;</span>   
       		run<span class="token operator">-&gt;</span>next<span class="token operator">=</span>finish<span class="token punctuation">;</span>   <span class="token comment">//新完成的节点插入到finish的头结点,简单一点</span>
       		finish<span class="token operator">=</span>run<span class="token punctuation">;</span>
       		run<span class="token operator">=</span><span class="token constant">NULL</span><span class="token punctuation">;</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"结束进程队列:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      		<span class="token function">DisplayPCB</span><span class="token punctuation">(</span>finish<span class="token punctuation">)</span><span class="token punctuation">;</span>           
      	<span class="token punctuation">}</span>           	
      <span class="token punctuation">}</span>
      timenow<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">//下一时刻继续扫描作业队列  </span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">SRTF</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span>   timenow<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    PCB <span class="token operator">*</span>rcur<span class="token punctuation">;</span><span class="token comment">//用于发生抢占时,遍历就绪队列,将被抢占的进程插入到就绪队列中合适的地方</span>
   <span class="token keyword">while</span><span class="token punctuation">(</span>true<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n当前时刻:%d\n"</span><span class="token punctuation">,</span>timenow<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">ReadyQueue</span><span class="token punctuation">(</span><span class="token string">"SRTF"</span><span class="token punctuation">,</span>timenow<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//刷新就绪队列</span>
     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"就绪队列:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">DisplayPCB</span><span class="token punctuation">(</span>ready<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">if</span><span class="token punctuation">(</span>job<span class="token operator">-&gt;</span>next<span class="token operator">==</span><span class="token constant">NULL</span><span class="token operator">&amp;&amp;</span>ready<span class="token operator">==</span><span class="token constant">NULL</span><span class="token operator">&amp;&amp;</span>run<span class="token operator">==</span><span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token comment">//没有进程,结束循环   </span>
     <span class="token keyword">if</span><span class="token punctuation">(</span>ready<span class="token operator">!=</span><span class="token constant">NULL</span><span class="token operator">||</span>run<span class="token operator">!=</span><span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token comment">//有进程处于就绪或者运行状态</span>
     <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>run<span class="token operator">==</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token comment">//若CPU空闲</span>
		<span class="token punctuation">{<!-- --></span>        
		 run<span class="token operator">=</span>ready<span class="token punctuation">;</span>      <span class="token comment">//将CPU分配给ready队列的第一个进程</span>
     	 ready<span class="token operator">=</span>ready<span class="token operator">-&gt;</span>next<span class="token punctuation">;</span> 
     	 run<span class="token operator">-&gt;</span>next<span class="token operator">=</span><span class="token constant">NULL</span><span class="token punctuation">;</span>
         <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nP%d被调度程序分派CPU!\n"</span><span class="token punctuation">,</span>run<span class="token operator">-&gt;</span>pid<span class="token punctuation">)</span><span class="token punctuation">;</span>        
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>ready<span class="token operator">!=</span><span class="token constant">NULL</span> <span class="token operator">&amp;&amp;</span> run<span class="token operator">-&gt;</span>rest <span class="token operator">&gt;</span> ready<span class="token operator">-&gt;</span>rest<span class="token punctuation">)</span> <span class="token comment">//run的剩余时间大于ready首进程的剩余时间</span>
        <span class="token punctuation">{<!-- --></span>   <span class="token comment">//run被就绪队列的首进程抢占)</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nP%d抢占P%d的CPU!\n"</span><span class="token punctuation">,</span>ready<span class="token operator">-&gt;</span>pid<span class="token punctuation">,</span>run<span class="token operator">-&gt;</span>pid<span class="token punctuation">)</span><span class="token punctuation">;</span>            
            rcur<span class="token operator">=</span>ready<span class="token punctuation">;</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span>rcur<span class="token operator">-&gt;</span>next<span class="token operator">!=</span><span class="token constant">NULL</span><span class="token operator">&amp;&amp;</span>rcur<span class="token operator">-&gt;</span>next<span class="token operator">-&gt;</span>rest <span class="token operator">&lt;=</span> run<span class="token operator">-&gt;</span>rest<span class="token punctuation">)</span> rcur<span class="token operator">=</span>rcur<span class="token operator">-&gt;</span>next<span class="token punctuation">;</span> 
            run<span class="token operator">-&gt;</span>state<span class="token operator">=</span><span class="token char">'W'</span><span class="token punctuation">;</span>
            run<span class="token operator">-&gt;</span>next<span class="token operator">=</span>rcur<span class="token operator">-&gt;</span>next<span class="token punctuation">;</span>  <span class="token comment">//将run插入到就绪队列中rcur的后面</span>
            rcur<span class="token operator">-&gt;</span>next<span class="token operator">=</span>run<span class="token punctuation">;</span>
            <span class="token comment">//if(run-&gt;next==NULL) tail=run; //如果run被插入到队尾,修改ready的尾指针;SRTF可以不维护tail</span>
            run<span class="token operator">=</span>ready<span class="token punctuation">;</span>      <span class="token comment">//将CPU分配给ready队列的第一个进程</span>
     	    ready<span class="token operator">=</span>ready<span class="token operator">-&gt;</span>next<span class="token punctuation">;</span> 
     	 	run<span class="token operator">-&gt;</span>next<span class="token operator">=</span><span class="token constant">NULL</span><span class="token punctuation">;</span>            
         <span class="token punctuation">}</span>
     	run<span class="token operator">-&gt;</span>rest<span class="token operator">--</span><span class="token punctuation">;</span>    <span class="token comment">//修改进程PCB</span>
     	run<span class="token operator">-&gt;</span>state<span class="token operator">=</span><span class="token char">'R'</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nP%d正在运行.......\n"</span><span class="token punctuation">,</span>run<span class="token operator">-&gt;</span>pid<span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"运行进程:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     	<span class="token function">DisplayPCB</span><span class="token punctuation">(</span>run<span class="token punctuation">)</span><span class="token punctuation">;</span>
        gantt<span class="token punctuation">[</span>timenow<span class="token punctuation">]</span><span class="token operator">=</span>run<span class="token operator">-&gt;</span>pid<span class="token punctuation">;</span> <span class="token comment">//记录当前时刻调度进程的ID号</span>
     	<span class="token keyword">if</span><span class="token punctuation">(</span>run<span class="token operator">-&gt;</span>rest<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>
     	<span class="token punctuation">{<!-- --></span>   <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nP%d结束!\n"</span><span class="token punctuation">,</span>run<span class="token operator">-&gt;</span>pid<span class="token punctuation">)</span><span class="token punctuation">;</span>
            run<span class="token operator">-&gt;</span>state<span class="token operator">=</span><span class="token char">'T'</span><span class="token punctuation">;</span>   
       		run<span class="token operator">-&gt;</span>next<span class="token operator">=</span>finish<span class="token punctuation">;</span>   <span class="token comment">//新完成的节点插入到finish的头结点,简单一点</span>
       		finish<span class="token operator">=</span>run<span class="token punctuation">;</span>
       		run<span class="token operator">=</span><span class="token constant">NULL</span><span class="token punctuation">;</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"结束进程队列:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      		<span class="token function">DisplayPCB</span><span class="token punctuation">(</span>finish<span class="token punctuation">)</span><span class="token punctuation">;</span>           
      	<span class="token punctuation">}</span>           	
      <span class="token punctuation">}</span>
      timenow<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">//下一时刻继续扫描作业队列  </span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">NonPriority</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//非抢占优先级</span>
<span class="token punctuation">{<!-- --></span>
 timenow<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
   <span class="token keyword">while</span><span class="token punctuation">(</span>true<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n当前时刻:%d\n"</span><span class="token punctuation">,</span>timenow<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">ReadyQueue</span><span class="token punctuation">(</span><span class="token string">"NonPriority"</span><span class="token punctuation">,</span>timenow<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//以"NonPriority"方式构造就绪队列,除了这里,代码与FCFS完全相同</span>
     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"就绪队列:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">DisplayPCB</span><span class="token punctuation">(</span>ready<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">if</span><span class="token punctuation">(</span>job<span class="token operator">-&gt;</span>next<span class="token operator">==</span><span class="token constant">NULL</span><span class="token operator">&amp;&amp;</span>ready<span class="token operator">==</span><span class="token constant">NULL</span><span class="token operator">&amp;&amp;</span>run<span class="token operator">==</span><span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token comment">//没有进程,结束循环   </span>
     <span class="token keyword">if</span><span class="token punctuation">(</span>ready<span class="token operator">!=</span><span class="token constant">NULL</span><span class="token operator">||</span>run<span class="token operator">!=</span><span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token comment">//有进程处于就绪或者运行状态</span>
     <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>run<span class="token operator">==</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token comment">//若CPU空闲</span>
		<span class="token punctuation">{<!-- --></span>        
		 run<span class="token operator">=</span>ready<span class="token punctuation">;</span>      <span class="token comment">//将CPU分配给ready队列的第一个进程</span>
     	 ready<span class="token operator">=</span>ready<span class="token operator">-&gt;</span>next<span class="token punctuation">;</span> 
     	 run<span class="token operator">-&gt;</span>next<span class="token operator">=</span><span class="token constant">NULL</span><span class="token punctuation">;</span>
         <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nP%d被调度程序分派CPU!\n"</span><span class="token punctuation">,</span>run<span class="token operator">-&gt;</span>pid<span class="token punctuation">)</span><span class="token punctuation">;</span>        
        <span class="token punctuation">}</span>
     	run<span class="token operator">-&gt;</span>rest<span class="token operator">--</span><span class="token punctuation">;</span>    <span class="token comment">//修改进程PCB</span>
     	run<span class="token operator">-&gt;</span>state<span class="token operator">=</span><span class="token char">'R'</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nP%d正在运行.......\n"</span><span class="token punctuation">,</span>run<span class="token operator">-&gt;</span>pid<span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"运行进程:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     	<span class="token function">DisplayPCB</span><span class="token punctuation">(</span>run<span class="token punctuation">)</span><span class="token punctuation">;</span>
        gantt<span class="token punctuation">[</span>timenow<span class="token punctuation">]</span><span class="token operator">=</span>run<span class="token operator">-&gt;</span>pid<span class="token punctuation">;</span> <span class="token comment">//记录当前时刻调度进程的ID号</span>
     	<span class="token keyword">if</span><span class="token punctuation">(</span>run<span class="token operator">-&gt;</span>rest<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>
     	<span class="token punctuation">{<!-- --></span>   <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nP%d结束!\n"</span><span class="token punctuation">,</span>run<span class="token operator">-&gt;</span>pid<span class="token punctuation">)</span><span class="token punctuation">;</span>
            run<span class="token operator">-&gt;</span>state<span class="token operator">=</span><span class="token char">'T'</span><span class="token punctuation">;</span>   
       		run<span class="token operator">-&gt;</span>next<span class="token operator">=</span>finish<span class="token punctuation">;</span>   <span class="token comment">//新完成的节点插入到finish的头结点,简单一点</span>
       		finish<span class="token operator">=</span>run<span class="token punctuation">;</span>
       		run<span class="token operator">=</span><span class="token constant">NULL</span><span class="token punctuation">;</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"结束进程队列:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      		<span class="token function">DisplayPCB</span><span class="token punctuation">(</span>finish<span class="token punctuation">)</span><span class="token punctuation">;</span>           
      	<span class="token punctuation">}</span>           	
      <span class="token punctuation">}</span>
      timenow<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">//下一时刻继续扫描作业队列  </span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">Priority</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//抢占式优先级</span>
<span class="token punctuation">{<!-- --></span>
    timenow<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    PCB <span class="token operator">*</span>rcur<span class="token punctuation">;</span><span class="token comment">//用于发生抢占时,遍历就绪队列,将被抢占的进程插入到就绪队列中合适的地方</span>
   <span class="token keyword">while</span><span class="token punctuation">(</span>true<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n当前时刻:%d\n"</span><span class="token punctuation">,</span>timenow<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">ReadyQueue</span><span class="token punctuation">(</span><span class="token string">"Priority"</span><span class="token punctuation">,</span>timenow<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//刷新就绪队列</span>
     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"就绪队列:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">DisplayPCB</span><span class="token punctuation">(</span>ready<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">if</span><span class="token punctuation">(</span>job<span class="token operator">-&gt;</span>next<span class="token operator">==</span><span class="token constant">NULL</span><span class="token operator">&amp;&amp;</span>ready<span class="token operator">==</span><span class="token constant">NULL</span><span class="token operator">&amp;&amp;</span>run<span class="token operator">==</span><span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token comment">//没有进程,结束循环   </span>
     <span class="token keyword">if</span><span class="token punctuation">(</span>ready<span class="token operator">!=</span><span class="token constant">NULL</span><span class="token operator">||</span>run<span class="token operator">!=</span><span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token comment">//有进程处于就绪或者运行状态</span>
     <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>run<span class="token operator">==</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token comment">//若CPU空闲</span>
		<span class="token punctuation">{<!-- --></span>        
		 run<span class="token operator">=</span>ready<span class="token punctuation">;</span>      <span class="token comment">//将CPU分配给ready队列的第一个进程</span>
     	 ready<span class="token operator">=</span>ready<span class="token operator">-&gt;</span>next<span class="token punctuation">;</span> 
     	 run<span class="token operator">-&gt;</span>next<span class="token operator">=</span><span class="token constant">NULL</span><span class="token punctuation">;</span>
         <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nP%d被调度程序分派CPU!\n"</span><span class="token punctuation">,</span>run<span class="token operator">-&gt;</span>pid<span class="token punctuation">)</span><span class="token punctuation">;</span>        
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>ready<span class="token operator">!=</span><span class="token constant">NULL</span> <span class="token operator">&amp;&amp;</span> run<span class="token operator">-&gt;</span>priority <span class="token operator">&gt;</span> ready<span class="token operator">-&gt;</span>priority<span class="token punctuation">)</span> <span class="token comment">//run的优先级低于ready首进程的优先级</span>
        <span class="token punctuation">{<!-- --></span>   <span class="token comment">//run被就绪队列的首进程抢占)</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nP%d抢占P%d的CPU!\n"</span><span class="token punctuation">,</span>ready<span class="token operator">-&gt;</span>pid<span class="token punctuation">,</span>run<span class="token operator">-&gt;</span>pid<span class="token punctuation">)</span><span class="token punctuation">;</span>            
            rcur<span class="token operator">=</span>ready<span class="token punctuation">;</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span>rcur<span class="token operator">-&gt;</span>next<span class="token operator">!=</span><span class="token constant">NULL</span><span class="token operator">&amp;&amp;</span>rcur<span class="token operator">-&gt;</span>next<span class="token operator">-&gt;</span>priority <span class="token operator">&lt;=</span> run<span class="token operator">-&gt;</span>priority<span class="token punctuation">)</span> rcur<span class="token operator">=</span>rcur<span class="token operator">-&gt;</span>next<span class="token punctuation">;</span> 
            run<span class="token operator">-&gt;</span>state<span class="token operator">=</span><span class="token char">'W'</span><span class="token punctuation">;</span>
            run<span class="token operator">-&gt;</span>next<span class="token operator">=</span>rcur<span class="token operator">-&gt;</span>next<span class="token punctuation">;</span>  <span class="token comment">//将run插入到就绪队列中rcur的后面</span>
            rcur<span class="token operator">-&gt;</span>next<span class="token operator">=</span>run<span class="token punctuation">;</span>
         <span class="token comment">//if(run-&gt;next==NULL) tail=run; //如果run被插入到队尾,修改ready的尾指针;Priority可以不维护tail</span>
            run<span class="token operator">=</span>ready<span class="token punctuation">;</span>      <span class="token comment">//将CPU分配给ready队列的第一个进程</span>
     	    ready<span class="token operator">=</span>ready<span class="token operator">-&gt;</span>next<span class="token punctuation">;</span> 
     	 	run<span class="token operator">-&gt;</span>next<span class="token operator">=</span><span class="token constant">NULL</span><span class="token punctuation">;</span>            
         <span class="token punctuation">}</span>
     	run<span class="token operator">-&gt;</span>rest<span class="token operator">--</span><span class="token punctuation">;</span>    <span class="token comment">//修改进程PCB</span>
     	run<span class="token operator">-&gt;</span>state<span class="token operator">=</span><span class="token char">'R'</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nP%d正在运行.......\n"</span><span class="token punctuation">,</span>run<span class="token operator">-&gt;</span>pid<span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"运行进程:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     	<span class="token function">DisplayPCB</span><span class="token punctuation">(</span>run<span class="token punctuation">)</span><span class="token punctuation">;</span>
        gantt<span class="token punctuation">[</span>timenow<span class="token punctuation">]</span><span class="token operator">=</span>run<span class="token operator">-&gt;</span>pid<span class="token punctuation">;</span> <span class="token comment">//记录当前时刻调度进程的ID号</span>
     	<span class="token keyword">if</span><span class="token punctuation">(</span>run<span class="token operator">-&gt;</span>rest<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>
     	<span class="token punctuation">{<!-- --></span>   <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nP%d结束!\n"</span><span class="token punctuation">,</span>run<span class="token operator">-&gt;</span>pid<span class="token punctuation">)</span><span class="token punctuation">;</span>
            run<span class="token operator">-&gt;</span>state<span class="token operator">=</span><span class="token char">'T'</span><span class="token punctuation">;</span>   
       		run<span class="token operator">-&gt;</span>next<span class="token operator">=</span>finish<span class="token punctuation">;</span>   <span class="token comment">//新完成的节点插入到finish的头结点,简单一点</span>
       		finish<span class="token operator">=</span>run<span class="token punctuation">;</span>
       		run<span class="token operator">=</span><span class="token constant">NULL</span><span class="token punctuation">;</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"结束进程队列:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      		<span class="token function">DisplayPCB</span><span class="token punctuation">(</span>finish<span class="token punctuation">)</span><span class="token punctuation">;</span>           
      	<span class="token punctuation">}</span>           	
      <span class="token punctuation">}</span>
      timenow<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">//下一时刻继续扫描作业队列  </span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>    <span class="token function">srand</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//随机数种子</span>
     <span class="token comment">//srand(0); </span>
     <span class="token function">InitialJob</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">DisplayPCB</span><span class="token punctuation">(</span>job<span class="token operator">-&gt;</span>next<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token comment">//RR(SLICE);</span>
    <span class="token comment">//  FCFS();</span>
     <span class="token comment">//SJF();</span>
     <span class="token comment">//SRTF();</span>
     <span class="token comment">//NonPriority();</span>
     <span class="token function">Priority</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      
     <span class="token function">DisplayGantt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">DisplayTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">return</span> EXIT_SUCCESS<span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3ce88229eb35960378d8d83e36d54893/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Hive合并小文件详解(参数介绍)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a3f52e69ea5e086f1d24b8022b5c095d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">E5 调用API续订程序：Microsoft 365 E5 Renew Plus</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>