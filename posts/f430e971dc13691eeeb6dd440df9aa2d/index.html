<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>jsvmp逆向(补环境篇) - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="jsvmp逆向(补环境篇)" />
<meta property="og:description" content="书接上回 上篇文章写到tx的jsxmp的算法逆向，文章链接在这里。初试jsvmp加密
。但是可能有伙伴觉得不够详细。
这里放一个大佬的文章链接。
https://www.52pojie.cn/thread-1521480-1-1.html 。其实就是一个变形的xtea加密。
大佬的文章已经讲了很清楚了，我这里就不狗尾续貂了。
查看node环境参数 在逆向算法的时候，我们简单补了一下环境，让jsvmp能再node环境里面跑起来。但是生成结果肯定是不对的。直接拿来用是不行的。
我们上次在jsvmp里面插桩。拿到输出结果。
我们可以找到四个类似的字符串，我们逆向出算法可以知道，就是collect就是由这四个的字符串加密出来的。
我们拿到这个四个字符串和浏览器生成的进行对比。
查看浏览器生成的参数 我们在浏览器进行覆盖js，把我们本地js拿到浏览器里面运行，查看浏览器输出的环境，看看有啥不一样。
最后对比浏览器环境和node环境生成参数 这里拿别人大佬分析的参数，我自己再补充几个
data = { &#34;0&#34;: 1, &#34;1&#34;: &#34;Mozilla/5.0 不给看 Edg/100.0.1185.44&#34;, &#34;2&#34;: 12, &#34;3&#34;: 0, &#34;4&#34;: 1, &#34;5&#34;: &#34;2560-1440-1392-24-*-*-|-*&#34;, &#34;6&#34;: &#34;**0.***.***.*46&#34;, &#34;7&#34;: &#34;GgoAAAANSUhEUgAA 不给看 iPegAAAABJRU5ErkJggg==&#34;, &#34;8&#34;: [], &#34;9&#34;: 1440, &#34;10&#34;: 0, &#34;11&#34;: 0, &#34;12&#34;: &#34;ANGLE 不给看 vs_5_0 ps_5_0, D3D11)&#34;, &#34;13&#34;: &#34;https://captcha.gtimg.com/1/template/drag_ele.html?rand=1519713624347&#34;, &#34;14&#34;: [&#34;zh-CN&#34;, &#34;en&#34;, &#34;en-GB&#34;, &#34;en-US&#34;], &#34;15&#34;: 1689646445, &#34;16&#34;: 396149498, &#34;17&#34;: 1689155967, &#34;18&#34;: 1689646443, &#34;19&#34;: &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/f430e971dc13691eeeb6dd440df9aa2d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-09-06T19:42:29+08:00" />
<meta property="article:modified_time" content="2023-09-06T19:42:29+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">jsvmp逆向(补环境篇)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h6>书接上回</h6> 
<p>上篇文章写到tx的jsxmp的算法逆向，文章链接在这里。<a href="http://mp.weixin.qq.com/s?__biz=MzkzMDI3NDUyNQ==&amp;mid=2247484234&amp;idx=1&amp;sn=11ceb4d69ba766dc36a286da96e12750&amp;chksm=c27d8ef8f50a07eeb4d9eea1fa4977ccfc89a8911fe6d7aebd5fd6189d058c242a747b13cbef&amp;scene=21#wechat_redirect" rel="nofollow" title="初试jsvmp加密">初试jsvmp加密</a></p> 
<p>。但是可能有伙伴觉得不够详细。</p> 
<p>这里放一个大佬的文章链接。</p> 
<pre><code>https://www.52pojie.cn/thread-1521480-1-1.html</code></pre> 
<p>。其实就是一个变形的xtea加密。</p> 
<p>大佬的文章已经讲了很清楚了，我这里就不狗尾续貂了。</p> 
<h6>查看node环境参数</h6> 
<p>在逆向算法的时候，我们简单补了一下环境，让jsvmp能再node环境里面跑起来。但是生成结果肯定是不对的。直接拿来用是不行的。</p> 
<p>我们上次在jsvmp里面插桩。拿到输出结果。</p> 
<p></p> 
<p class="img-center"><img alt="图片" height="96" src="https://images2.imgbox.com/a1/98/zAz8zC9l_o.png" width="1080"></p> 
<p>我们可以找到四个类似的字符串，我们逆向出算法可以知道，就是collect就是由这四个的字符串加密出来的。</p> 
<p>我们拿到这个四个字符串和浏览器生成的进行对比。</p> 
<h6>查看浏览器生成的参数</h6> 
<p>我们在浏览器进行覆盖js，把我们本地js拿到浏览器里面运行，查看浏览器输出的环境，看看有啥不一样。</p> 
<p></p> 
<p class="img-center"><img alt="图片" height="69" src="https://images2.imgbox.com/ce/04/Fts224pS_o.png" width="1080"></p> 
<h6>最后对比浏览器环境和node环境生成参数</h6> 
<p>这里拿别人大佬分析的参数，我自己再补充几个</p> 
<pre>data = {
  "0": 1,
  "1": "Mozilla/5.0 不给看 Edg/100.0.1185.44",
  "2": 12,
  "3": 0,
  "4": 1,
  "5": "2560-1440-1392-24-*-*-|-*",
  "6": "**0.***.***.*46",
  "7": "GgoAAAANSUhEUgAA 不给看 iPegAAAABJRU5ErkJggg==",
  "8": [],
  "9": 1440,
  "10": 0,
  "11": 0,
  "12": "ANGLE 不给看 vs_5_0 ps_5_0, D3D11)",
  "13": "https://captcha.gtimg.com/1/template/drag_ele.html?rand=1519713624347",
  "14": ["zh-CN", "en", "en-GB", "en-US"],
  "15": 1689646445,
  "16": 396149498,
  "17": 1689155967,
  "18": 1689646443,
  "19": "Google 不给看 ",
  "20": 1520994948,
  "21": [300, 230],
  "22": 2560,
  "23": "iframe",
  "24": "",
  "25": 24,
  "26": "+08",
  "27": 0,
  "28": 2,
  "29": 0,
  "30": "https://y.qq.com/portal/close.html",
  "31": "UTF-8",
  "32": 1023,
  "33": "98k",
  "34": "",
  "35": "Win32",
  "36": 0
}</pre> 
<p>按照索引进行解释</p> 
<ul><li> <p>1 userAgent</p> </li><li> <p>2 Navigator.hardwareConcurrency</p> </li><li> <p>3 dom检测自动化检测,相当残暴,正确为0,否则为其他的数字, 创建节点,设置属性, 追加节点, 删除节点, innertHTML 正则匹配, (createElement, cloneNode,appendChild, insertBefore...)</p> </li><li> <p>5-22-25 Screen width, height,availHeight, colorDepth, pixelDepth 拼接而成</p> </li><li> <p>6 RTC sdp 正则匹配出来的ip地址 （我这边没有看到这个参数）</p> </li><li> <p>7 canvas指纹</p> </li><li> <p>8 deviceorientation事件 , 不调用就对了</p> </li><li> <p>9 Screen.height</p> </li><li> <p>12-19 webgl指纹</p> </li><li> <p>13 location.href</p> </li><li> <p>14 languages</p> </li><li> <p>16 -17 TDC_itoken</p> </li><li> <p>20 这个参数应该是每个js不一样的。js字节码里面有</p> </li><li> <p>21 window innerHeight, innerWidth;</p> </li><li> <p>23 正确创建 iframe节点 contentWindow, contentDocument</p> </li><li> <p>28 会检测div的touchstart属性</p> </li><li> <p>27-29 dom检测</p> </li><li> <p>30 window.TCaptchaReferrer</p> </li><li> <p>32 样式检测,正确为1023(可能不同浏览器不一样), 包括(getPropertyValue, matchMedia), 初始化默认全为false(0)</p> <p>这里还是拿的y小白的笔记的csdn的文章。链接在这里</p> </li><li> <pre><code>https://blog.csdn.net/weixin_44437016/article/details/131785557</code></pre> </li></ul> 
<h6>总结</h6> 
<p>接下来就是自己慢慢补了，上次我有分享一个qxvm补环境框架，但是里面没有实现动态dom。</p> 
<p>要自己实现。但是这个tx的jsvmp对dom补环境比较严格，自己实现动态dom比较麻烦。</p> 
<p>我这边魔改的jsodom。里面已经实现了动态dom了，是一个非常完美的补环境框架。然后就是缺啥补啥。最后测试没啥问题。</p> 
<p></p> 
<p class="img-center"><img alt="图片" height="149" src="https://images2.imgbox.com/3c/ba/QBjNIjbB_o.png" width="1080"></p> 
<p><strong>交流群:835342318</strong></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/cc815e40e7c40f40297952a113ab9432/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Studio 3T for MongoDB的介绍及语法简单介绍</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/315cd285b70054548f3842da1ff8d2b3/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">部署Gitlab服务-推送、拉取代码</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>