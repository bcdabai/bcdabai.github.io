<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>SSM框架项目实战-CRM(客户关系管理1) - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="SSM框架项目实战-CRM(客户关系管理1)" />
<meta property="og:description" content="目录​​​​​​​ 1 项目介绍
1.1 crm简介
1.2 业务流程
1.3 crm的技术架构
2 物理模型设计
2.1 crm表的结构
2.2 主键字段
2.2 外键字段
2.3 关于日期和时间的字段
3 搭建项目环境
3.1 添加maven依赖
3.2 添加配置文件
3.3 添加页面和静态资源
​编辑
4 首页index
5 登录功能
5.1 登录页面
5.2 登录功能
5.2.1 添加mybatis逆向工程
5.2.2 编写service层和mapper层
5.2.3 实现controller层
5.2.4 实现页面层
5.2.5 优化登录功能
5.3 登录后显示名称
5.4 实现回车登录
5.5 记住密码功能
5.6 安全退出
5.7 登录验证功能
注意：本次项目是观看的是动力节点的视频：CRM-首页功能分析与设计_哔哩哔哩_bilibili
1 项目介绍 1.1 crm简介 CRM(Customer Relationship Management)客户关系管理是管理企业与客户之间关系的新型管理机制。终极目标是吸引新客户、保留老客户以及将已有客户转变为忠诚客户，以增加市场份额。它是一个完整的客户关系管理系统，包括市场、销售、服务3大环节，产品成熟，操作简单，功能强大。帮您从客户全生命周期的各个阶段获取价值。
1.2 业务流程 市场活动:市场部人员。
线索：销售部人员。(线索购买意愿非常强烈的时候，可以转换)
客户：线索中的公司信息" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/c54ea4ebbfc88f840a5ede60c4f78d8a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-12-21T19:00:11+08:00" />
<meta property="article:modified_time" content="2022-12-21T19:00:11+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">SSM框架项目实战-CRM(客户关系管理1)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong>​​​​​​​ </p> 
<p id="1%20%E9%A1%B9%E7%9B%AE%E4%BB%8B%E7%BB%8D-toc" style="margin-left:0px;"><a href="#1%20%E9%A1%B9%E7%9B%AE%E4%BB%8B%E7%BB%8D" rel="nofollow">1 项目介绍</a></p> 
<p id="1.1%20crm%E7%AE%80%E4%BB%8B-toc" style="margin-left:40px;"><a href="#1.1%20crm%E7%AE%80%E4%BB%8B" rel="nofollow">1.1 crm简介</a></p> 
<p id="1.2%20%E4%B8%9A%E5%8A%A1%E6%B5%81%E7%A8%8B-toc" style="margin-left:40px;"><a href="#1.2%20%E4%B8%9A%E5%8A%A1%E6%B5%81%E7%A8%8B" rel="nofollow">1.2 业务流程</a></p> 
<p id="1.3%20crm%E7%9A%84%E6%8A%80%E6%9C%AF%E6%9E%B6%E6%9E%84-toc" style="margin-left:40px;"><a href="#1.3%20crm%E7%9A%84%E6%8A%80%E6%9C%AF%E6%9E%B6%E6%9E%84" rel="nofollow">1.3 crm的技术架构</a></p> 
<p id="2%20%E7%89%A9%E7%90%86%E6%A8%A1%E5%9E%8B%E8%AE%BE%E8%AE%A1-toc" style="margin-left:0px;"><a href="#2%20%E7%89%A9%E7%90%86%E6%A8%A1%E5%9E%8B%E8%AE%BE%E8%AE%A1" rel="nofollow">2 物理模型设计</a></p> 
<p id="2.1%20crm%E8%A1%A8%E7%9A%84%E7%BB%93%E6%9E%84-toc" style="margin-left:40px;"><a href="#2.1%20crm%E8%A1%A8%E7%9A%84%E7%BB%93%E6%9E%84" rel="nofollow">2.1 crm表的结构</a></p> 
<p id="2.2%20%E4%B8%BB%E9%94%AE%E5%AD%97%E6%AE%B5-toc" style="margin-left:40px;"><a href="#2.2%20%E4%B8%BB%E9%94%AE%E5%AD%97%E6%AE%B5" rel="nofollow">2.2 主键字段</a></p> 
<p id="2.2%20%E5%A4%96%E9%94%AE%E5%AD%97%E6%AE%B5-toc" style="margin-left:40px;"><a href="#2.2%20%E5%A4%96%E9%94%AE%E5%AD%97%E6%AE%B5" rel="nofollow">2.2 外键字段</a></p> 
<p id="2.3%20%E5%85%B3%E4%BA%8E%E6%97%A5%E6%9C%9F%E5%92%8C%E6%97%B6%E9%97%B4%E7%9A%84%E5%AD%97%E6%AE%B5-toc" style="margin-left:40px;"><a href="#2.3%20%E5%85%B3%E4%BA%8E%E6%97%A5%E6%9C%9F%E5%92%8C%E6%97%B6%E9%97%B4%E7%9A%84%E5%AD%97%E6%AE%B5" rel="nofollow">2.3 关于日期和时间的字段</a></p> 
<p id="3%20%E6%90%AD%E5%BB%BA%E9%A1%B9%E7%9B%AE%E7%8E%AF%E5%A2%83-toc" style="margin-left:0px;"><a href="#3%20%E6%90%AD%E5%BB%BA%E9%A1%B9%E7%9B%AE%E7%8E%AF%E5%A2%83" rel="nofollow">3 搭建项目环境</a></p> 
<p id="3.1%20%E6%B7%BB%E5%8A%A0maven%E4%BE%9D%E8%B5%96-toc" style="margin-left:40px;"><a href="#3.1%20%E6%B7%BB%E5%8A%A0maven%E4%BE%9D%E8%B5%96" rel="nofollow">3.1 添加maven依赖</a></p> 
<p id="3.2%20%E6%B7%BB%E5%8A%A0%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-toc" style="margin-left:40px;"><a href="#3.2%20%E6%B7%BB%E5%8A%A0%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6" rel="nofollow">3.2 添加配置文件</a></p> 
<p id="3.3%20%E6%B7%BB%E5%8A%A0%E9%A1%B5%E9%9D%A2%E5%92%8C%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90-toc" style="margin-left:40px;"><a href="#3.3%20%E6%B7%BB%E5%8A%A0%E9%A1%B5%E9%9D%A2%E5%92%8C%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90" rel="nofollow">3.3 添加页面和静态资源</a></p> 
<p id="%E2%80%8B%E7%BC%96%E8%BE%91-toc" style="margin-left:40px;"><a href="#%E2%80%8B%E7%BC%96%E8%BE%91" rel="nofollow">​编辑</a></p> 
<p id="4%C2%A0%E9%A6%96%E9%A1%B5index-toc" style="margin-left:0px;"><a href="#4%C2%A0%E9%A6%96%E9%A1%B5index" rel="nofollow">4 首页index</a></p> 
<p id="5%20%E7%99%BB%E5%BD%95%E5%8A%9F%E8%83%BD-toc" style="margin-left:0px;"><a href="#5%20%E7%99%BB%E5%BD%95%E5%8A%9F%E8%83%BD" rel="nofollow">5 登录功能</a></p> 
<p id="5.1%20%E7%99%BB%E5%BD%95%E9%A1%B5%E9%9D%A2-toc" style="margin-left:40px;"><a href="#5.1%20%E7%99%BB%E5%BD%95%E9%A1%B5%E9%9D%A2" rel="nofollow">5.1 登录页面</a></p> 
<p id="5.2%20%E7%99%BB%E5%BD%95%E5%8A%9F%E8%83%BD-toc" style="margin-left:40px;"><a href="#5.2%20%E7%99%BB%E5%BD%95%E5%8A%9F%E8%83%BD" rel="nofollow">5.2 登录功能</a></p> 
<p id="5.2.1%20%E6%B7%BB%E5%8A%A0mybatis%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B-toc" style="margin-left:80px;"><a href="#5.2.1%20%E6%B7%BB%E5%8A%A0mybatis%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B" rel="nofollow">5.2.1 添加mybatis逆向工程</a></p> 
<p id="5.2.2%20%E7%BC%96%E5%86%99service%E5%B1%82%E5%92%8Cmapper%E5%B1%82-toc" style="margin-left:80px;"><a href="#5.2.2%20%E7%BC%96%E5%86%99service%E5%B1%82%E5%92%8Cmapper%E5%B1%82" rel="nofollow">5.2.2 编写service层和mapper层</a></p> 
<p id="5.2.3%20%E5%AE%9E%E7%8E%B0controller%E5%B1%82-toc" style="margin-left:80px;"><a href="#5.2.3%20%E5%AE%9E%E7%8E%B0controller%E5%B1%82" rel="nofollow">5.2.3 实现controller层</a></p> 
<p id="5.2.4%20%E5%AE%9E%E7%8E%B0%E9%A1%B5%E9%9D%A2%E5%B1%82-toc" style="margin-left:80px;"><a href="#5.2.4%20%E5%AE%9E%E7%8E%B0%E9%A1%B5%E9%9D%A2%E5%B1%82" rel="nofollow">5.2.4 实现页面层</a></p> 
<p id="5.2.5%20%E4%BC%98%E5%8C%96%E7%99%BB%E5%BD%95%E5%8A%9F%E8%83%BD-toc" style="margin-left:80px;"><a href="#5.2.5%20%E4%BC%98%E5%8C%96%E7%99%BB%E5%BD%95%E5%8A%9F%E8%83%BD" rel="nofollow">5.2.5 优化登录功能</a></p> 
<p id="5.3%20%E7%99%BB%E5%BD%95%E5%90%8E%E6%98%BE%E7%A4%BA%E5%90%8D%E7%A7%B0-toc" style="margin-left:40px;"><a href="#5.3%20%E7%99%BB%E5%BD%95%E5%90%8E%E6%98%BE%E7%A4%BA%E5%90%8D%E7%A7%B0" rel="nofollow">5.3 登录后显示名称</a></p> 
<p id="5.4%20%E5%AE%9E%E7%8E%B0%E5%9B%9E%E8%BD%A6%E7%99%BB%E5%BD%95-toc" style="margin-left:40px;"><a href="#5.4%20%E5%AE%9E%E7%8E%B0%E5%9B%9E%E8%BD%A6%E7%99%BB%E5%BD%95" rel="nofollow">5.4 实现回车登录</a></p> 
<p id="5.5%20%E8%AE%B0%E4%BD%8F%E5%AF%86%E7%A0%81%E5%8A%9F%E8%83%BD-toc" style="margin-left:40px;"><a href="#5.5%20%E8%AE%B0%E4%BD%8F%E5%AF%86%E7%A0%81%E5%8A%9F%E8%83%BD" rel="nofollow">5.5 记住密码功能</a></p> 
<p id="5.6%20%E5%AE%89%E5%85%A8%E9%80%80%E5%87%BA-toc" style="margin-left:40px;"><a href="#5.6%20%E5%AE%89%E5%85%A8%E9%80%80%E5%87%BA" rel="nofollow">5.6 安全退出</a></p> 
<p id="5.7%20%E7%99%BB%E5%BD%95%E9%AA%8C%E8%AF%81%E5%8A%9F%E8%83%BD-toc" style="margin-left:40px;"><a href="#5.7%20%E7%99%BB%E5%BD%95%E9%AA%8C%E8%AF%81%E5%8A%9F%E8%83%BD" rel="nofollow">5.7 登录验证功能</a></p> 
<hr id="hr-toc"> 
<p></p> 
<p>注意：本次项目是观看的是动力节点的视频：<a href="https://www.bilibili.com/video/BV1tZ4y1d7kg?p=20&amp;vd_source=aa8128f8483414c1e311183533fbf31c" rel="nofollow" title="CRM-首页功能分析与设计_哔哩哔哩_bilibili">CRM-首页功能分析与设计_哔哩哔哩_bilibili</a></p> 
<h2 id="1%20%E9%A1%B9%E7%9B%AE%E4%BB%8B%E7%BB%8D">1 项目介绍</h2> 
<h3 id="1.1%20crm%E7%AE%80%E4%BB%8B">1.1 crm简介</h3> 
<p style="margin-left:.0001pt;text-align:justify;">CRM(Customer Relationship Management)客户关系管理是管理<strong>企业与客户之间关系</strong>的新型管理机制。终极目标是吸引新客户、保留老客户以及将已有客户转变为忠诚客户，以增加市场份额。它是一个完整的客户关系管理系统，包括市场、销售、服务3大环节，产品成熟，操作简单，功能强大。帮您从客户全生命周期的各个阶段获取价值。</p> 
<h3 id="1.2%20%E4%B8%9A%E5%8A%A1%E6%B5%81%E7%A8%8B" style="margin-left:.0001pt;text-align:justify;">1.2 业务流程</h3> 
<p style="margin-left:.0001pt;text-align:justify;">市场活动:市场部人员。</p> 
<p style="margin-left:.0001pt;text-align:justify;">线索：销售部人员。(线索购买意愿非常强烈的时候，可以转换)</p> 
<p style="margin-left:.0001pt;text-align:justify;">客户：线索中的公司信息</p> 
<p style="margin-left:.0001pt;text-align:justify;">联系人：线索中的联系人信息</p> 
<p style="margin-left:.0001pt;text-align:justify;">交易：已经促成的交易。促成的交易不一定就肯定成交，只有那些已经有交易意向的客户才创建交易记录。交易中有一些阶段，总共九个阶段，越是往下越是成交的可能性越大，当然也可能最后成交失败。</p> 
<p style="margin-left:.0001pt;text-align:justify;">售后回访：客服人员。成交之后的。</p> 
<p style="margin-left:.0001pt;text-align:justify;">统计报表：销售漏斗。主要体现交易数据各个阶段的数据变化。</p> 
<h3 id="1.3%20crm%E7%9A%84%E6%8A%80%E6%9C%AF%E6%9E%B6%E6%9E%84" style="margin-left:.0001pt;text-align:justify;">1.3 crm的技术架构</h3> 
<p>共分为以下几层：</p> 
<p><strong>视图层（view）</strong>：展示数据，跟用户交互。用到的技术有：html；css；jQuery；bootstrap；jsp等</p> 
<p><strong>控制层（Controller）</strong>：控制业务处理流程（接收请求，接收参数，封装参数，根据不用的请求调用业务层处理业务；根据处理结果响应信息）。用到的技术：servlet；SpringMVC</p> 
<p><strong>业务层（Service）</strong>：处理业务逻辑 。用到的技术：javaSE</p> 
<p><strong>持久层（Dao/Mapper）</strong>：操作数据库。用到的技术：jdbc；mybatis</p> 
<p><strong>整合层</strong>：维护类资源,维护数据库资源。用到的技术：spring(IOC,AOP)(,ejb,corba)</p> 
<p></p> 
<h2 id="2%20%E7%89%A9%E7%90%86%E6%A8%A1%E5%9E%8B%E8%AE%BE%E8%AE%A1">2 物理模型设计</h2> 
<h3 id="2.1%20crm%E8%A1%A8%E7%9A%84%E7%BB%93%E6%9E%84">2.1 crm表的结构</h3> 
<p><strong>根据业务需求我们需要创建以下数据库表：</strong></p> 
<p>  tbl_user   用户表</p> 
<p>  tbl_dic_type   数据字典类型表<br>   tbl_dic_value  数据字典值</p> 
<p>  tbl_activity   市场活动表<br>   tbl_activity_remark  市场活动备注表</p> 
<p>  tbl_clue       线索表<br>   tbl_clue_remark   线索备注表</p> 
<p>  tbl_clue_activity_relation  线索和市场活动的关联关系表</p> 
<p>  tbl_customer   客户表<br>   tbl_customer_remark  客户备注表</p> 
<p>  tbl_contacts   联系人表<br>   tbl_contacts_remark 联系人备注表</p> 
<p>  tbl_contacts_activity_relation 联系人和市场活动的关联关系表</p> 
<p>  tbl_tran       交易表<br>   tbl_tran_remark  交易备注表<br>   tbl_tran_history  交易历史表</p> 
<p>  tbl_task   任务表</p> 
<h3 id="2.2%20%E4%B8%BB%E9%94%AE%E5%AD%97%E6%AE%B5">2.2 主键字段</h3> 
<p>在数据库表中，如果有一组字段能够唯一确定一条记录，则可以把它们设计成表的主键字段。推荐使用一个字段做主键，而且推荐使用没有业务含义的字段做主键,比如：id等。</p> 
<p>主键字段的类型和长度由主键值的生成方式来决定，主键值的生成方式：</p> 
<p>（1）自增：借助数据库自身主键生成机制，数值型、长度由数据量来决定。它运行效率低但是开发效率高<br><strong>（2）assighed</strong>：程序员手动值生成主键,唯一非空,使用算法，比如常见的方式：hi/low：数值型，长度由数据量决定；UUID：字符串，长度是32位。手动生成主键是我们常用的方式。<br> （3）共享主键：由另一张表的类型和长度决定，这种方式用的很少<br> （4）联合主键：由多个字段的类型和长度决定，这种方式几乎不用</p> 
<h3 id="2.2%20%E5%A4%96%E9%94%AE%E5%AD%97%E6%AE%B5">2.2 外键字段</h3> 
<p>外键用来确定表和表之间的关系。<br> （1）<strong>一对多</strong>：一张表(A)中的一条记录可以对应另一张表(B)中的多条记录;另一张表(B)中的一条记录只能对应一张表(A)中的一条记录。</p> 
<p>添加数据时,先添加父表记录，再添加子表记录；删除数据时,先删除子表记录，再删除父表记录；查询数据时,可能会进行关联查询：比如：查询所有姓张的学生的id,name和所在班级name<br><strong>select </strong>s.id,s.name,c.name as className <strong>from</strong> tbl_student s <strong>join </strong>tbl_class c <strong>on </strong>s.class_id=c.id  <br><strong>where </strong>s.name <strong>like </strong>'z%'。</p> 
<p>我们再回顾一下关联查询的几种方式：</p> 
<p>内连接：查询所有符合条件的数据，并且要求结果在两张表中都有相对应的记录<br> 左外连接：查询左侧表中所有符合条件的数据，即使在右侧表中没有相对应的记录                       右外连接：查询右侧条件的数表中所有符合据，即使在左侧表中没有相对应的记录<br><span style="color:#ff9900;">如果外键不能为空，优先使用内连接</span>；如果外键可以为空：<br> --假如只需要查询那些在另一张表中有相对应的记录，使用内连接<br> --假如需要查询左侧表中所有符合条件的记录，使用左外连接.<br> （2）<strong>一对一</strong>：一张表(A)中的一条记录只能对应另一张表(B)中的一条记录;另一张表(B)中的一条记录也只能对应一张表(A)中的一条记录。</p> 
<p>一对一这种方式用的不是很多，比如有个人类表和一个身份证表，这样就是一对一了。</p> 
<p> a)共享主键：(不推荐)<br> 添加数据：先添加先产生的表，再后产生的表记录<br> 删除数据：先删除后产生的表记录，再删除先产生的表记录<br> 查询数据：无需进行连接查询<br> b)唯一外键：一对一就是一种特殊的一对多。操作跟一对多完全一样。</p> 
<p>（3）<strong>多对多</strong>：一张表(A)中的一条记录可以对应另一张表(B)中的多条记录;另一张表(B)中的一条记录也可以对应一张表(A)中的多条记录。多对多通常有三个表才能实现。比如下面三个表：</p> 
<p><strong>tbl_student        tbl_course                          tbl_student_course_relation</strong><br> id     name           id     name                            student_id     course_id<br> 1001   zs             111    java                             1001              111<br> 1002   ls              222    mysql                          1001              222 <span style="color:#f3f3f4;"><span style="background-color:#f3f3f4;">222   </span>     </span>                                                           1002              111  <span style="color:#f3f3f4;"><span style="background-color:#f3f3f4;">111</span>     </span>                                                              1002               222               </p> 
<p>添加数据时，先添加父表记录(tbl_student,tbl_course),再添加子表(tbl_student_course_relation)记录;删除数据时，先删除子表记录(tbl_student_course_relation),再删除父表记录(tbl_student,tbl_course)；查询数据时，可能会进行关联查询，如下：//查询所有姓张的学生的id,name,和所选课程的name<br><strong>select </strong>s.id,s.name,c.name <strong>as </strong>courseName <strong>from </strong>tbl_student <strong>s join </strong>tbl_student_course_relation scr <strong>on </strong>s.id=scr.student_id <strong>join </strong>tbl_course c <strong>on </strong>scr.course_id=c.id <strong>where </strong>s.name like 'z%'</p> 
<h3 id="2.3%20%E5%85%B3%E4%BA%8E%E6%97%A5%E6%9C%9F%E5%92%8C%E6%97%B6%E9%97%B4%E7%9A%84%E5%AD%97%E6%AE%B5">2.3 关于日期和时间的字段</h3> 
<p>都按照字符串处理：char(10)   yyyy-MM-dd        char(19)   yyyy-MM-dd HH:mm:ss</p> 
<p>我们已经有以上的表的SQL语句，我们直接导入即可：         </p> 
<p><img alt="" height="538" src="https://images2.imgbox.com/3e/a7/bXkU202N_o.png" width="1184">其中有个表的id为varchar(255)  ，提示太长了，报错。我们改小一点，改成100就对了，暂时不知道为啥。</p> 
<p></p> 
<h2 id="3%20%E6%90%AD%E5%BB%BA%E9%A1%B9%E7%9B%AE%E7%8E%AF%E5%A2%83">3 搭建项目环境</h2> 
<p>创建项目：crm-project<br> 设置JDK.<br> 创建工程：crm<br> 补全目录结构：</p> 
<p><img alt="" height="426" src="https://images2.imgbox.com/3d/b6/B2tUDhRt_o.png" width="831"></p> 
<p>最好先设置一下编码为utf-8</p> 
<p><img alt="" height="1009" src="https://images2.imgbox.com/4d/d8/HtLXr4Ju_o.png" width="1200"></p> 
<h3 id="3.1%20%E6%B7%BB%E5%8A%A0maven%E4%BE%9D%E8%B5%96">3.1 添加maven依赖</h3> 
<p><strong>mysql驱动</strong></p> 
<pre><code class="language-XML">&lt;!-- MySQL数据库连接驱动 --&gt;
&lt;dependency&gt;
&lt;groupId&gt;mysql&lt;/groupId&gt;
&lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
&lt;version&gt;5.1.43&lt;/version&gt;
&lt;/dependency&gt;</code></pre> 
<p><strong>jdbc数据库连接池：druid</strong></p> 
<pre><code class="language-XML">&lt;!-- JDBC数据源连接池 --&gt;
&lt;dependency&gt;
&lt;groupId&gt;com.alibaba&lt;/groupId&gt;
&lt;artifactId&gt;druid&lt;/artifactId&gt;
&lt;version&gt;1.1.1&lt;/version&gt;
&lt;/dependency&gt;</code></pre> 
<p><strong>mybatis框架依赖：</strong></p> 
<pre><code class="language-XML">&lt;!-- MyBatis框架依赖 --&gt;
&lt;dependency&gt;
&lt;groupId&gt;org.mybatis&lt;/groupId&gt;
&lt;artifactId&gt;mybatis&lt;/artifactId&gt;
&lt;version&gt;3.4.1&lt;/version&gt;
&lt;/dependency&gt;</code></pre> 
<p><strong>Spring相关配置依赖：</strong></p> 
<pre><code class="language-XML">    &lt;!-- Spring框架依赖的JAR配置 --&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.springframework&lt;/groupId&gt;
      &lt;artifactId&gt;spring-context&lt;/artifactId&gt;
      &lt;version&gt;4.3.9.RELEASE&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.springframework&lt;/groupId&gt;
      &lt;artifactId&gt;spring-aop&lt;/artifactId&gt;
      &lt;version&gt;4.3.9.RELEASE&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.springframework&lt;/groupId&gt;
      &lt;artifactId&gt;spring-core&lt;/artifactId&gt;
      &lt;version&gt;4.3.9.RELEASE&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.springframework&lt;/groupId&gt;
      &lt;artifactId&gt;spring-beans&lt;/artifactId&gt;
      &lt;version&gt;4.3.9.RELEASE&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.springframework&lt;/groupId&gt;
      &lt;artifactId&gt;spring-jdbc&lt;/artifactId&gt;
      &lt;version&gt;4.3.9.RELEASE&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.springframework&lt;/groupId&gt;
      &lt;artifactId&gt;spring-tx&lt;/artifactId&gt;
      &lt;version&gt;4.3.9.RELEASE&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.springframework&lt;/groupId&gt;
      &lt;artifactId&gt;spring-web&lt;/artifactId&gt;
      &lt;version&gt;4.3.9.RELEASE&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.springframework&lt;/groupId&gt;
      &lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt;
      &lt;version&gt;4.3.9.RELEASE&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.springframework&lt;/groupId&gt;
      &lt;artifactId&gt;spring-oxm&lt;/artifactId&gt;
      &lt;version&gt;4.3.9.RELEASE&lt;/version&gt;
    &lt;/dependency&gt;</code></pre> 
<p><strong>SpringAOP的依赖：</strong></p> 
<pre><code class="language-XML">&lt;!-- Spring AOP支持--&gt;
&lt;dependency&gt;
&lt;groupId&gt;org.aspectj&lt;/groupId&gt;
&lt;artifactId&gt;aspectjweaver&lt;/artifactId&gt;
&lt;version&gt;1.8.9&lt;/version&gt;
&lt;/dependency&gt;</code></pre> 
<p><strong>mybatis和Spring整合依赖：</strong></p> 
<pre><code class="language-XML">&lt;!-- MyBatis与Spring整合依赖 --&gt;
&lt;dependency&gt;
&lt;groupId&gt;org.mybatis&lt;/groupId&gt;
&lt;artifactId&gt;mybatis-spring&lt;/artifactId&gt;
&lt;version&gt;1.3.0&lt;/version&gt;
&lt;/dependency&gt;</code></pre> 
<p><strong>添加项目对jsp的支持：</strong></p> 
<pre><code class="language-XML">&lt;!-- servlet及jstl标签库依赖的JAR配置 --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;javax.servlet&lt;/groupId&gt;
  &lt;artifactId&gt;javax.servlet-api&lt;/artifactId&gt;
  &lt;version&gt;3.1.0&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
  &lt;groupId&gt;javax.servlet.jsp.jstl&lt;/groupId&gt;
  &lt;artifactId&gt;jstl-api&lt;/artifactId&gt;
  &lt;version&gt;1.2&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.apache.taglibs&lt;/groupId&gt;
  &lt;artifactId&gt;taglibs-standard-spec&lt;/artifactId&gt;
  &lt;version&gt;1.2.1&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.apache.taglibs&lt;/groupId&gt;
  &lt;artifactId&gt;taglibs-standard-impl&lt;/artifactId&gt;
  &lt;version&gt;1.2.1&lt;/version&gt;
&lt;/dependency&gt;
</code></pre> 
<p><strong>Jackson插件依赖：</strong></p> 
<pre><code class="language-XML">&lt;!-- 加载jackson插件依赖 --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;
  &lt;artifactId&gt;jackson-core&lt;/artifactId&gt;
  &lt;version&gt;2.7.3&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
  &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;
  &lt;artifactId&gt;jackson-databind&lt;/artifactId&gt;
  &lt;version&gt;2.7.3&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
  &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;
  &lt;artifactId&gt;jackson-annotations&lt;/artifactId&gt;
  &lt;version&gt;2.7.3&lt;/version&gt;
&lt;/dependency&gt;
</code></pre> 
<p><strong>POI依赖：</strong></p> 
<pre><code class="language-XML">&lt;!--poi依赖--&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.apache.poi&lt;/groupId&gt;
  &lt;artifactId&gt;poi&lt;/artifactId&gt;
  &lt;version&gt;3.15&lt;/version&gt;
&lt;/dependency&gt;
</code></pre> 
<p><strong>fileupload依赖：</strong></p> 
<pre><code class="language-XML">&lt;!-- 文件上传 --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;commons-fileupload&lt;/groupId&gt;
  &lt;artifactId&gt;commons-fileupload&lt;/artifactId&gt;
  &lt;version&gt;1.3.1&lt;/version&gt;
&lt;/dependency&gt;
</code></pre> 
<p><strong>log4j依赖：</strong></p> 
<pre><code class="language-XML">&lt;!-- Log4j2依赖的JAR配置 --&gt;
&lt;dependency&gt;
&lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt;
&lt;artifactId&gt;log4j-api&lt;/artifactId&gt;
&lt;version&gt;2.3&lt;/version&gt;
&lt;/dependency&gt;</code></pre> 
<h3 id="3.2%20%E6%B7%BB%E5%8A%A0%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">3.2 添加配置文件</h3> 
<p><strong>mybatis核心配置文件：</strong>mybatis-config.xml</p> 
<pre><code class="language-XML">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;!DOCTYPE configuration
        PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-config.dtd"&gt;
&lt;configuration&gt;
&lt;settings&gt;
    &lt;setting name="logImpl" value="STDOUT_LOGGING"/&gt;
&lt;/settings&gt;
    &lt;typeAliases&gt;
        &lt;package name="com.bjpowernode.crm.model"/&gt;
    &lt;/typeAliases&gt;
    &lt;mappers&gt;
        &lt;package name="com.bjpowernode.crm.mapper"/&gt;
    &lt;/mappers&gt;
&lt;/configuration&gt;</code></pre> 
<p>配置数据库连接和事务：applicationContext-datasource.xml</p> 
<pre><code class="language-XML">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
   xmlns:aop="http://www.springframework.org/schema/aop"
   xmlns:context="http://www.springframework.org/schema/context"
   xmlns:tx="http://www.springframework.org/schema/tx"
   xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
      http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.3.xsd
      http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-4.3.xsd
      http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-4.3.xsd"&gt;
   &lt;!-- 配置数据源 --&gt;
    &lt;bean id="dataSource" class="org.springframework.jdbc.datasource.DriverManagerDataSource"&gt;
      &lt;property name="driverClassName" value="com.mysql.jdbc.Driver"/&gt;
      &lt;property name="username" value="root"/&gt;
      &lt;property name="password" value="123456"/&gt;
      &lt;property name="url" value="jdbc:mysql://192.168.223.133:3306/crm_db?useSSL=false&amp;amp;useUnicode=true&amp;amp;characterEncoding=UTF-8"/&gt;
   &lt;/bean&gt;
   &lt;!-- 配置SqlSessionFactory --&gt;
   &lt;bean id="sqlSessionFactory" class="org.mybatis.spring.SqlSessionFactoryBean"&gt;
      &lt;!-- 必须注入属性dataSource --&gt;
      &lt;property name="dataSource" ref="dataSource"/&gt;
      &lt;!-- 如果mybatis没有特殊的配置(比如别名等)，configLocation可以省去 ;否则，不能省略--&gt;
      &lt;property name="configLocation" value="classpath:mybatis-config.xml"/&gt;
   &lt;/bean&gt;
   &lt;!-- mapper注解扫描器配置,扫描@MapperScan注解,自动生成代码对象 --&gt;
    &lt;bean id="mapperScanner" class="org.mybatis.spring.mapper.MapperScannerConfigurer"&gt;
        &lt;property name="basePackage" value="com.bjpowernode.crm.mapper"/&gt;
        &lt;property name="sqlSessionFactoryBeanName" value="sqlSessionFactory"/&gt;
    &lt;/bean&gt;
   
   &lt;!-- 配置事务管理器 --&gt;
   &lt;bean id="transactionManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager"&gt;
      &lt;property name="dataSource" ref="dataSource"/&gt;
   &lt;/bean&gt;
   &lt;!-- 配置事务 --&gt;
   &lt;aop:config&gt;
      &lt;aop:pointcut expression="execution(* com.bjpowernode.crm..service.*.*(..))" id="allMethodPointcut"/&gt;
      &lt;aop:advisor advice-ref="txAdvice" pointcut-ref="allMethodPointcut"/&gt;
   &lt;/aop:config&gt;
   &lt;tx:advice id="txAdvice" transaction-manager="transactionManager"&gt;
      &lt;tx:attributes&gt;
         &lt;tx:method name="add*" propagation="REQUIRED" rollback-for="Exception"/&gt;
         &lt;tx:method name="save*" propagation="REQUIRED" rollback-for="Exception"/&gt;
         &lt;tx:method name="edit*" propagation="REQUIRED" rollback-for="Exception"/&gt;
         &lt;tx:method name="update*" propagation="REQUIRED" rollback-for="Exception"/&gt;
         &lt;tx:method name="delete*" propagation="REQUIRED" rollback-for="Exception"/&gt;
         &lt;tx:method name="do*" propagation="REQUIRED" rollback-for="Exception"/&gt;
         &lt;tx:method name="*" propagation="REQUIRED" read-only="true"/&gt;
      &lt;/tx:attributes&gt;
   &lt;/tx:advice&gt;
&lt;/beans&gt;
</code></pre> 
<p><strong>SpringMVC配置</strong>：applicationContext-mvc.xml</p> 
<pre><code class="language-XML">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xmlns:context="http://www.springframework.org/schema/context"
xmlns:p="http://www.springframework.org/schema/p"
xmlns:util="http://www.springframework.org/schema/util"
xmlns:aop="http://www.springframework.org/schema/aop"
xmlns:tx="http://www.springframework.org/schema/tx"
xmlns:mvc="http://www.springframework.org/schema/mvc"
xsi:schemaLocation="
http://www.springframework.org/schema/beans
http://www.springframework.org/schema/beans/spring-beans.xsd
http://www.springframework.org/schema/context
http://www.springframework.org/schema/context/spring-context.xsd
http://www.springframework.org/schema/tx
http://www.springframework.org/schema/tx/spring-tx.xsd
http://www.springframework.org/schema/aop
http://www.springframework.org/schema/aop/spring-aop.xsd
http://www.springframework.org/schema/mvc
http://www.springframework.org/schema/mvc/spring-mvc.xsd
http://www.springframework.org/schema/util
http://www.springframework.org/schema/util/spring-util.xsd"&gt;
&lt;!-- dispatcherServlet截获所有URL请求 --&gt;
&lt;mvc:default-servlet-handler /&gt;
&lt;!-- spring mvc 扫描包下的controller --&gt;
&lt;context:component-scan base-package="com.bjpowernode.crm.web.controller"/&gt;
&lt;!-- 配置注解驱动 --&gt;
&lt;mvc:annotation-driven/&gt;
&lt;!-- 配置视图解析器 --&gt;
&lt;bean id="viewResolver"
class="org.springframework.web.servlet.view.InternalResourceViewResolver"&gt;
&lt;property name="prefix" value="/WEB-INF/pages/"/&gt;
&lt;property name="suffix" value=".jsp"/&gt;
&lt;/bean&gt;
&lt;!-- 配置文件上传解析器 id:必须是multipartResolver--&gt;
&lt;!--&lt;bean id="multipartResolver" class="org.springframework.web.multipart.commons.CommonsMultipartResolver"&gt;
    &lt;property name="maxUploadSize" value="#{1024*1024*80}"/&gt;
    &lt;property name="defaultEncoding" value="utf-8"/&gt;
&lt;/bean&gt;--&gt;
&lt;/beans&gt;</code></pre> 
<p><strong>Spring总配置文件</strong>：applicationContext.xml</p> 
<pre><code class="language-XML">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xmlns:context="http://www.springframework.org/schema/context"
xmlns:p="http://www.springframework.org/schema/p"
xmlns:aop="http://www.springframework.org/schema/aop"
xmlns:tx="http://www.springframework.org/schema/tx"
xmlns:task="http://www.springframework.org/schema/task"
xsi:schemaLocation="
http://www.springframework.org/schema/beans
http://www.springframework.org/schema/beans/spring-beans.xsd
http://www.springframework.org/schema/context
http://www.springframework.org/schema/context/spring-context.xsd
http://www.springframework.org/schema/tx
http://www.springframework.org/schema/tx/spring-tx.xsd
http://www.springframework.org/schema/aop
http://www.springframework.org/schema/aop/spring-aop.xsd"&gt;
&lt;!-- 加载系统配置文件 
&lt;context:property-placeholder location="classpath:*.properties" /&gt;--&gt;
&lt;!-- 扫描注解 --&gt;
&lt;context:component-scan base-package="com.bjpowernode.crm.service" /&gt;
&lt;!-- 导入数据相关配置 --&gt;
&lt;import resource="applicationContext-datasource.xml" /&gt;
&lt;/beans&gt;</code></pre> 
<p><strong>web.xml配置</strong>：</p> 
<pre><code class="language-XML">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;web-app xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xmlns="http://java.sun.com/xml/ns/javaee"
         xsi:schemaLocation="http://java.sun.com/xml/ns/javaee
http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"
         id="dataservice" version="3.0"&gt;
  &lt;display-name&gt;dataservice application&lt;/display-name&gt;
  &lt;!-- spring监听器加载applicationContext.xml配置文件 --&gt;
  &lt;context-param&gt;
    &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
    &lt;param-value&gt;classpath:applicationContext.xml&lt;/param-value&gt;
  &lt;/context-param&gt;
  &lt;listener&gt;
    &lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt;
  &lt;/listener&gt;
  &lt;!-- spring字符过滤器 --&gt;
  &lt;filter&gt;
    &lt;filter-name&gt;encodingFilter&lt;/filter-name&gt;
    &lt;filter-class&gt;org.springframework.web.filter.CharacterEncodingFilter&lt;/filter-class&gt;
    &lt;init-param&gt;
      &lt;param-name&gt;encoding&lt;/param-name&gt;
      &lt;param-value&gt;UTF-8&lt;/param-value&gt;
    &lt;/init-param&gt;
  &lt;/filter&gt;
  &lt;filter-mapping&gt;
    &lt;filter-name&gt;encodingFilter&lt;/filter-name&gt;
    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
  &lt;/filter-mapping&gt;
  &lt;!-- Spring mvc分发servlet --&gt;
  &lt;servlet&gt;
    &lt;servlet-name&gt;dispatcher&lt;/servlet-name&gt;
    &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;
    &lt;init-param&gt;
      &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
      &lt;param-value&gt;classpath:applicationContext-mvc.xml&lt;/param-value&gt;
    &lt;/init-param&gt;
    &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
  &lt;/servlet&gt;
  &lt;servlet-mapping&gt;
    &lt;servlet-name&gt;dispatcher&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/&lt;/url-pattern&gt;
  &lt;/servlet-mapping&gt;
  &lt;servlet-mapping&gt;
    &lt;servlet-name&gt;dispatcher&lt;/servlet-name&gt;
    &lt;url-pattern&gt;*.do&lt;/url-pattern&gt;
  &lt;/servlet-mapping&gt;
  &lt;!-- 欢迎页，默认进入index controller --&gt;
  &lt;welcome-file-list&gt;
    &lt;welcome-file&gt;/&lt;/welcome-file&gt;
  &lt;/welcome-file-list&gt;
&lt;/web-app&gt;
</code></pre> 
<p><strong>设置maven对配置文件的编译选项：</strong>pom.xml</p> 
<p>maven默认只帮我们编译java文件，配置以下内容maven可以编译我们配置的xml文件</p> 
<pre><code class="language-XML">&lt;resources&gt;
            &lt;resource&gt;
                &lt;directory&gt;src/main/java&lt;/directory&gt;
                &lt;includes&gt;
                    &lt;include&gt;**/*.xml&lt;/include&gt;
                &lt;/includes&gt;
            &lt;/resource&gt;
            &lt;resource&gt;
                &lt;directory&gt;src/main/resources&lt;/directory&gt;
                &lt;includes&gt;
                    &lt;include&gt;**/*.*&lt;/include&gt;
                &lt;/includes&gt;
            &lt;/resource&gt;
&lt;/resources&gt;</code></pre> 
<p>需要注意的是以上配置文件还需要在修改，比如包名，可以把它当做一个模板，修改一点点就可以</p> 
<h3 id="3.3%20%E6%B7%BB%E5%8A%A0%E9%A1%B5%E9%9D%A2%E5%92%8C%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90">3.3 添加页面和静态资源</h3> 
<p>图片之类的资源放在webapp下，页面 放在WEB-INF下。为什么呢？ web应用根目录下的内容都是不安全的，外界可以通过url直接访问。所以，一般为了数据的安全，都会把页面放到WEB-INF下,因为WEB-INF目录下的资源是受保护的，外界不能直接访问。因为图片这种资源不需要保护，直接放到webapp下就行，而且如果图片也放在WEB-INF下的话，访问很麻烦，要先经过Controller层转发才行，没有那个必要。</p> 
<h3 id="%E2%80%8B%E7%BC%96%E8%BE%91"><img alt="" height="317" src="https://images2.imgbox.com/bc/4b/0lX4R8vI_o.png" width="1060"></h3> 
<p>接下来我们可以把项目部署到tomcat上：</p> 
<p><img alt="" height="1009" src="https://images2.imgbox.com/7f/fd/eDUE2WYa_o.png" width="1200"></p> 
<p></p> 
<h2 id="4%C2%A0%E9%A6%96%E9%A1%B5index">4 首页index</h2> 
<p>理论上说我们要画流程图，但是目前我们先不画，能理解就好。</p> 
<p>首先客户端发送请求：用户在浏览器输入url，跳转请求，我们需要一个controller接收这个请求然后跳转到首页（index），把这个网页的信息响应到浏览器，用户就可以看到了。我们写controller我们先创建包和类：</p> 
<p><img alt="" height="283" src="https://images2.imgbox.com/39/d6/FeVcWAFH_o.png" width="1187"></p> 
<p>根据这个包我们需要修改之前的SpringMVC的配置：</p> 
<p><img alt="" height="101" src="https://images2.imgbox.com/54/2a/pSJJ5G6L_o.png" width="1150"></p> 
<p>我们写方法用于接收请求和响应网页信息：</p> 
<pre><code class="language-java">    @RequestMapping("/")
    public String index(){
        return "index";
    }</code></pre> 
<p>我们启动服务器再次访问首页，发现它又去跳转登录页面。</p> 
<h2 id="5%20%E7%99%BB%E5%BD%95%E5%8A%9F%E8%83%BD">5 登录功能</h2> 
<h3 id="5.1%20%E7%99%BB%E5%BD%95%E9%A1%B5%E9%9D%A2">5.1 登录页面</h3> 
<p>通常来说一个资源目录对应一个controller，所以我们再创建一个controller类，而且我也不想把所有controller类放在一个包下。所以我们还可以创建一个包，这样方便我们查看也方便别人查看。那这里我们一个user路径就对应一个controller类</p> 
<p><img alt="" height="246" src="https://images2.imgbox.com/75/ba/NPos4nT3_o.png" width="895"></p> 
<p>我们写方法：</p> 
<pre><code class="language-java">    @RequestMapping("/settings/qx/user/toLogin.do")
    public String toLogin(){
        return "settings/qx/user/login";
    }</code></pre> 
<p>写登录页面：</p> 
<p><img alt="" height="97" src="https://images2.imgbox.com/2b/32/dGe2wiCm_o.png" width="1200"></p> 
<p>我们发现这个前端登录页面中的../非常的多，写起来麻烦，它的意思是上一层目录。我们可以写一个通用的方式来找到路径：</p> 
<pre><code class="language-html">&lt;%
	String basePath=request.getScheme()+"://"+request.getServerName()+":"+request.getServerPort()+request.getContextPath()+"/";
%&gt;</code></pre> 
<p>以上代码可以动态获取网页url，比如我们的url为：http://127.0.0.1:8080/crm/</p> 
<p>再使用以下标签，它表示在本页面所有路径前面加上这个url：</p> 
<pre><code class="language-html">&lt;base href="&lt;%=basePath%&gt;"&gt;</code></pre> 
<p>我们再次访问：访问成功</p> 
<p><img alt="" height="866" src="https://images2.imgbox.com/a6/d6/Kxoosohw_o.png" width="1200"></p> 
<h3 id="5.2%20%E7%99%BB%E5%BD%95%E5%8A%9F%E8%83%BD" style="margin-left:.0001pt;text-align:justify;">5.2 登录功能</h3> 
<p>我们成功访问到登录界面后就开始输入账号和密码进行登录了，这里我们要注意几点：</p> 
<ul><li style="margin-left:.0001pt;text-align:justify;">用户名和密码不能为空</li><li style="margin-left:.0001pt;text-align:justify;">用户名或者密码错误,用户已过期,用户状态被锁定,ip受限 都不能登录成功</li><li style="margin-left:.0001pt;text-align:justify;">登录成功之后,所有业务页面显示当前用户的名称</li><li style="margin-left:.0001pt;text-align:justify;">实现10天记住密码</li><li style="margin-left:.0001pt;text-align:justify;">登录成功之后,跳转到业务主页面</li><li style="margin-left:.0001pt;text-align:justify;">登录失败,页面不跳转,提示信息</li></ul> 
<p style="margin-left:.0001pt;text-align:justify;">所以当我们点击“登录”的时候就要判断是否符合上面的内容，不符合是不能成功登录的。所以我们想一下登录后要进行的流程：</p> 
<p style="margin-left:.0001pt;text-align:justify;">当用户点击“登录”或者回车后要跳转到一个controller判断是否符合条件，符合则跳转到新的页面，不符合要跳转到登录页面，总的来说就是要跳转到登录页面然后进行下一步。所以这里的controller还是用之前的那个（因为一个资源目录对应一个controller）。在controller中我们获取参数封装参数然后再向service层发送请求（因为我们要获取数据库内容来判断登录界面请求的内容是否合法），service层再向dao层发送请求执行SQL语句查询用户，结果返回给service层，再返回给controller层最后响应到前端。</p> 
<h4 id="5.2.1%20%E6%B7%BB%E5%8A%A0mybatis%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B" style="margin-left:.0001pt;text-align:justify;">5.2.1 添加mybatis逆向工程</h4> 
<p style="margin-left:.0001pt;text-align:justify;">在实现登录功能前，我们需要准备逆向工程，逆向工程是干什么的？</p> 
<p style="margin-left:.0001pt;text-align:justify;">mybatis的逆向工程进一步简化程序员的工作量，它会根据我们的数据库表，帮我们生成对应实体类<a href="https://so.csdn.net/so/search?q=pojo&amp;spm=1001.2101.3001.7020" title="pojo">pojo</a>类，还有mapper.xml和mapper.Java类。极大的减少了开发人员的工作量。</p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong>使用mybatis逆向工程：</strong><br> （1）创建工程:crm-mybatis-generator</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="158" src="https://images2.imgbox.com/5c/9e/eMhnkfbI_o.png" width="348"><br> （2）添加插件：</p> 
<pre><code class="language-XML">&lt;!--myBatis逆向工程插件--&gt;
    &lt;plugin&gt;
	&lt;groupId&gt;org.mybatis.generator&lt;/groupId&gt;
	&lt;artifactId&gt;mybatis-generator-maven-plugin&lt;/artifactId&gt;
	&lt;version&gt;1.3.2&lt;/version&gt;
	&lt;configuration&gt;
	    &lt;verbose&gt;true&lt;/verbose&gt;
	    &lt;overwrite&gt;true&lt;/overwrite&gt;
	&lt;/configuration&gt;
    &lt;/plugin&gt;</code></pre> 
<p>（3）添加配置文件：包括数据库连接信息、代码保存的目录、表的信息。我们直接复制配置文件，然后修改关键信息就好。</p> 
<p>生成的pojo类的位置</p> 
<p><img alt="" height="107" src="https://images2.imgbox.com/64/24/BgwvV4h0_o.png" width="1200"></p> 
<p>mapper映射文件</p> 
<p><img alt="" height="184" src="https://images2.imgbox.com/f2/b2/PCNZ0oB2_o.png" width="1132"></p> 
<p>mapper接口 <img alt="" height="165" src="https://images2.imgbox.com/39/f6/eToYEyeR_o.png" width="1104"></p> 
<p>（4）运行mybatis的逆向工程，根据指定表生成java代码，保存到指定的目录中。</p> 
<p><img alt="" height="289" src="https://images2.imgbox.com/df/28/6lix78l1_o.png" width="377"></p> 
<p>结果：</p> 
<p><img alt="" height="218" src="https://images2.imgbox.com/ea/cc/M66lybiC_o.png" width="406"></p> 
<h4 id="5.2.2%20%E7%BC%96%E5%86%99service%E5%B1%82%E5%92%8Cmapper%E5%B1%82">5.2.2 编写service层和mapper层</h4> 
<p>因为mybatis逆向工程只能生成部分信息，有些还需要我们自己写，比如这里我们需要查询用户名和密码信息：</p> 
<p>mapper层</p> 
<pre><code class="language-java">    /**
     * 根据用户名和密码查询用户信息
     * @param map
     * @return
     */
    User selectUserByLoginActAndPwd(Map&lt;String,Object&gt; map);</code></pre> 
<pre><code class="language-XML">  &lt;select id="selectUserByLoginActAndPwd" resultMap="BaseResultMap" parameterType="map"&gt;
    select &lt;include refid="Base_Column_List"/&gt;
    from tbl_user
    where login_act=#{loginAct} and login_pwd=#{loginPwd}
  &lt;/select&gt;</code></pre> 
<p>service层：</p> 
<pre><code class="language-java">public interface UserService {
    User queryUserByLoginActAndPwd(Map&lt;String,Object&gt; map);
}</code></pre> 
<pre><code class="language-java">@Service
public class UserServiceImpl implements UserService {

    @Autowired
    private UserMapper userMapper;

    @Override
    public User queryUserByLoginActAndPwd(Map&lt;String, Object&gt; map) {
        return userMapper.selectUserByLoginActAndPwd(map);
    }
}</code></pre> 
<p>注意把service类交给spring容器管理，service层交给spring管理</p> 
<p><img alt="" height="81" src="https://images2.imgbox.com/c4/b5/7e17dOv6_o.png" width="989"></p> 
<h4 id="5.2.3%20%E5%AE%9E%E7%8E%B0controller%E5%B1%82">5.2.3 实现controller层</h4> 
<pre><code class="language-java">    @RequestMapping("/setting/qx/user/login.do")
    @ResponseBody
    public Object login(String loginAct, String loginPwd, String isRemPwd, HttpServletRequest request){
        //封装参数
        Map&lt;String,Object&gt; map = new HashMap&lt;&gt;();
        map.put("loginAct",loginAct);
        map.put("loginPwd",loginPwd);
        //调用Service层方法，查询用户
        User user = userService.queryUserByLoginActAndPwd(map);
        //根据查询结果，生成响应信息
        ReturnObject returnObject = new ReturnObject();
        if (user == null){
            //登录失败，用户名或密码错误

        }else{
            //进一步判断账户是否合法
            SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
            String nowStr = sdf.format(new Date());
            if (nowStr.compareTo(user.getExpireTime())&gt;0){
                //登陆失败，账号已过期
                //需要响应的信息
                returnObject.setCode("0");
                returnObject.setMessage("登陆失败，账号已过期");
            }else if ("0".equals(user.getLockState())){
                //登陆失败，状态被锁定
                returnObject.setCode("0");
                returnObject.setMessage("登陆失败，状态被锁定");
            }else if (!user.getAllowIps().contains(request.getRemoteAddr())){
                //登陆失败，ip受限
                returnObject.setCode("0");
                returnObject.setMessage("登陆失败，ip受限");
            }else {
                //登录成功
                returnObject.setCode("1");
            }
        }
        return returnObject;
    }</code></pre> 
<p>在这一层我们接收信息然后封装到map集合，调用service层查询用户，拿得到的用户判断是否合法，其中是否合法我们要响应前端，我们写一个类封装响应的信息如下：</p> 
<pre><code class="language-java">package com.itzw.crm.commons.domain;

public class ReturnObject {
    private String code;//处理成功获取失败的标记：1---成功,0---失败
    private String message;//提示信息
    private Object retData;//其它数据

    public String getCode() {
        return code;
    }

    public void setCode(String code) {
        this.code = code;
    }

    public String getMessage() {
        return message;
    }

    public void setMessage(String message) {
        this.message = message;
    }

    public Object getRetData() {
        return retData;
    }

    public void setRetData(Object retData) {
        this.retData = retData;
    }
}
</code></pre> 
<p>其中code为0表示不合法，1为合法，message表示不合法响应的信息。</p> 
<h4 id="5.2.4%20%E5%AE%9E%E7%8E%B0%E9%A1%B5%E9%9D%A2%E5%B1%82">5.2.4 实现页面层</h4> 
<p>前端我们进行表单验证，然后收集输入的信息发送给之前写的controller请求，然后controller请求会得到一个结果，我们再根据结果判断下一步怎么做，是跳转到新页面（成功）还是跳转到登录页面（失败）并给出提示信息</p> 
<p><img alt="" height="597" src="https://images2.imgbox.com/83/95/8PtnlvsQ_o.png" width="1200"></p> 
<pre><code class="language-java">@Controller
public class WorkbenchIndexController {
    @RequestMapping("/workbench/index.do")
    public String index(){
        //跳转到业务主页面
        return "workbench/index";
    }
}</code></pre> 
<p>可以访问到页面了</p> 
<p><img alt="" height="866" src="https://images2.imgbox.com/c1/2b/wEbgU3e8_o.png" width="1200"></p> 
<p>到这登录功能就基本完成了</p> 
<h4 id="5.2.5%20%E4%BC%98%E5%8C%96%E7%99%BB%E5%BD%95%E5%8A%9F%E8%83%BD">5.2.5 优化登录功能</h4> 
<p>这里的值，是我们自己规定的，0表示失败，1表示成功，如果以后换表达方式呢，我们只能一个一个改，这里我们可以设置一个常量，今后修改只需要修改一处就好</p> 
<p></p> 
<p><img alt="" height="351" src="https://images2.imgbox.com/f0/bd/1aq0dW5K_o.png" width="1007"></p> 
<p>修改如下：</p> 
<pre><code class="language-java">public class Constants {
    //保存ReturnObject类中的Code值
    public static final String RETURN_OBJECT_CODE_SUCCESS="1";//成功
    public static final String RETURN_OBJECT_CODE_FAIL="0";//失败</code></pre> 
<p><img alt="" height="211" src="https://images2.imgbox.com/92/e5/VhnZvi9r_o.png" width="506"></p> 
<p>同样的下面格式化日期，可能我不想这样格式化，那又要全部修改一遍</p> 
<p><img alt="" height="227" src="https://images2.imgbox.com/5f/16/Je5R94Oo_o.png" width="1143"></p> 
<p>我们可以写个工具类，后续修改更方便</p> 
<pre><code class="language-java">package com.itzw.crm.commons.utils;

import java.text.SimpleDateFormat;
import java.util.Date;

/**
 * 对Date类型数据进行处理的工具类
 */
public class DateUtil {
    /**
     * 对指定的date对象进行格式化: yyyy-MM-dd HH:mm:ss
     * @param date
     * @return
     */
    public static String formateDateTime(Date date){
        SimpleDateFormat sdf=new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
        String dateStr=sdf.format(date);
        return dateStr;
    }

    /**
     * 对指定的date对象进行格式化: yyyy-MM-dd
     * @param date
     * @return
     */
    public static String formateDate(Date date){
        SimpleDateFormat sdf=new SimpleDateFormat("yyyy-MM-dd");
        String dateStr=sdf.format(date);
        return dateStr;
    }

    /**
     * 对指定的date对象进行格式化: HH:mm:ss
     * @param date
     * @return
     */
    public static String formateTime(Date date){
        SimpleDateFormat sdf=new SimpleDateFormat("HH:mm:ss");
        String dateStr=sdf.format(date);
        return dateStr;
    }
}
</code></pre> 
<p><img alt="" height="120" src="https://images2.imgbox.com/4e/93/nrKWyU6f_o.png" width="809"></p> 
<p>继续优化：在点击登录的时候，实际情况下可能验证很慢，和网络服务器等等都有关系，那么我们最好在验证过程中给用户提示“正在努力验证...”提升用户体验。</p> 
<pre><code class="language-html">beforeSend:function () {//当ajax向后台发送请求之前，会自动执行本函数；
                        //该函数的返回值能够决定ajax是否真正向后台发送请求：
                        //如果该函数返回true,则ajax会真正向后台发送请求；否则，如果该函数返回false，则ajax放弃向后台发送请求。
    $("#msg").text("正在努力验证....");
    return true;
}</code></pre> 
<p>我们考虑需求，需要在点击验证之后并且在验证结束之前给出提示信息。在前端登录页面加上上面信息，它会在ajax发送请求之前自动执行本函数。</p> 
<p></p> 
<p><img alt="" height="213" src="https://images2.imgbox.com/d4/2a/fOGtu0IK_o.png" width="617"></p> 
<h3 id="5.3%20%E7%99%BB%E5%BD%95%E5%90%8E%E6%98%BE%E7%A4%BA%E5%90%8D%E7%A7%B0">5.3 登录后显示名称</h3> 
<p>把控制层(controller)代码中处理好的数据传递到视图层(jsp),使用作用域传递：</p> 
<ul><li>pageContext:用来在同一个页面的不同标签之间传递数据。</li><li>request：在同一个请求过程中间传递数据。</li><li>session: 同一个浏览器窗口的不同请求之间传递数据。</li><li>application:所有用户共享的数据，并且长久频繁使用的数据。</li></ul> 
<p>所以在这里我们使用session域，因为当我们登录后，只要是在这个网页上，不管什么请求我们都要看到我们的登录名称在右上角挂着。</p> 
<p><img alt="" height="74" src="https://images2.imgbox.com/d0/81/SumrGbZ1_o.png" width="711"></p> 
<p>如上，这样我们就可以在前端接收，但是就像之前说的，这里的sessionUser是我们自己设置的，后期不方便修改，我们再写一个常量：</p> 
<pre><code class="language-java">    //保存当前用户的key
    public static final String SESSION_USER="sessionUser";</code></pre> 
<p><img alt="" height="96" src="https://images2.imgbox.com/9b/7b/LPN1JHJf_o.png" width="1025"></p> 
<p>在前端接收</p> 
<p><img alt="" height="104" src="https://images2.imgbox.com/93/14/1vt1l3Yd_o.png" width="922"></p> 
<h3 id="5.4%20%E5%AE%9E%E7%8E%B0%E5%9B%9E%E8%BD%A6%E7%99%BB%E5%BD%95">5.4 实现回车登录</h3> 
<p>jquery事件函数的用法：<br>    选择器.click(function(){//给指定的元素添加事件<br>       //js代码<br>    });</p> 
<p>选择器.click();//在指定的元素上模拟发生一次事件</p> 
<pre><code class="language-javascript">            //给整个浏览器窗口添加键盘按下事件
            $(window).keydown(function (e) {
                //如果按的是回车键，则提交登录请求
                if(e.keyCode==13){
                    //也就是执行“登录”按钮单击事件
                    $("#loginBtn").click();
                }
            });</code></pre> 
<p>给整个窗口都设置回车登录功能</p> 
<h3 id="5.5%20%E8%AE%B0%E4%BD%8F%E5%AF%86%E7%A0%81%E5%8A%9F%E8%83%BD">5.5 记住密码功能</h3> 
<p>访问：login.jsp----&gt;后台：.html：如果上次记住密码，自动填上账号和密码;否则，不填。<br> 如何判断上次是否记住密码？`<br> 上次登录成功，判断是否需要记住密码：如果需要记住密码，则往浏览器写cookie；否则，删除cookie。而且cookie的值必须是该用户的loginAct和loginPwd<br> 下次登录时，判断该用户有没有cookie：如果有，则自动填写账号和密码；否则，不写。而且填写的是cookie的值。</p> 
<pre><code class="language-java">                //如果需要记住密码，则往外写cookie
                if ("true".equals(isRemPwd)){
                    Cookie c1 = new Cookie("loginAct", loginAct);
                    c1.setMaxAge(10*24*60*60);
                    response.addCookie(c1);
                    Cookie c2 = new Cookie("loginPwd", loginPwd);
                    c1.setMaxAge(10*24*60*60);
                    response.addCookie(c2);
                }else {
                    //把没有过期的cookie删除，也就是把存在时间设置为0
                    Cookie c1 = new Cookie("loginAct", loginAct);
                    c1.setMaxAge(0);
                    response.addCookie(c1);
                    Cookie c2 = new Cookie("loginPwd", loginPwd);
                    c1.setMaxAge(0);
                    response.addCookie(c2);
                }</code></pre> 
<p></p> 
<p>前端：要在登录界面的文本框中显示账号和密码，获取cookie</p> 
<p><strong>获取cookie有两种方式：</strong><br> 1、使用java代码获取cookie：<br>     Cookie[] cs=request.getCookies();<br>     for(Cookie c:cs){<!-- --><br>     if(c.getName().equals("loginAct")){<!-- --><br>         String loginAct=c.getValue();<br>     }else if(c.getName().equals("loginPwd")){<!-- --><br>         String loginPwd=c.getValue();<br>     }<br> }</p> 
<p>2、使用EL表达式获取cookie：<br>     ${cookie.loginAct.value}<br>     ${cookie.loginPwd.value}</p> 
<p>这里我们直接在前端使用EL表达式：</p> 
<p><img alt="" height="212" src="https://images2.imgbox.com/89/ea/9g7281z4_o.png" width="1200"></p> 
<p>优化一下：如果选中记住密码，那么下一次访问界面不仅账户和密码已经输好，同时“十天内免登陆”的复选框也是被选中的。这里使用JSTL表达式。也就是说如果cookie中的账户和密码都是存在的，那么就选中复选框，如果有一个是空就不选中 </p> 
<p><img alt="" height="277" src="https://images2.imgbox.com/33/bd/k0AlOWwA_o.png" width="1129"></p> 
<h3 id="5.6%20%E5%AE%89%E5%85%A8%E9%80%80%E5%87%BA">5.6 安全退出</h3> 
<p>需求：</p> 
<p style="margin-left:.0001pt;text-align:justify;">用户在任意的业务页面,点击"退出"按钮,弹出确认退出的模态窗口;用户在确认退出的模态窗口,点击"确定"按钮,完成安全退出的功能.</p> 
<p style="margin-left:.0001pt;text-align:justify;">*安全退出,清空cookie,销毁session</p> 
<p style="margin-left:.0001pt;text-align:justify;">*退出完成之后,跳转到首页</p> 
<p style="margin-left:.0001pt;text-align:justify;">分析：</p> 
<p style="margin-left:.0001pt;text-align:justify;">客户端用户点击退出按钮，提示是否退出，点击“确认”，发出退出请求给UserController，controller层开始清空cookie和销毁session，再跳转到首页。</p> 
<pre><code class="language-java">    @RequestMapping("/settings/qx/user/logout.do")
    public String logout(HttpSession session,HttpServletResponse response){
        //清空cookie
        Cookie c1=new Cookie("loginAct","1");
        c1.setMaxAge(0);
        response.addCookie(c1);
        Cookie c2=new Cookie("loginPwd","1");
        c2.setMaxAge(0);
        response.addCookie(c2);
        //销毁session
        session.invalidate();
        //跳转到首页
        return "redirect:/";
    }</code></pre> 
<pre><code class="language-javascript">		//给“确定”按钮添加单击事件
		$("#logoutBtn").click(function () {
			//发送同步请求
			window.location.href="settings/qx/user/logout.do";
		});</code></pre> 
<h3 id="5.7%20%E7%99%BB%E5%BD%95%E9%AA%8C%E8%AF%81%E5%8A%9F%E8%83%BD">5.7 登录验证功能</h3> 
<p>因为目前，我们即使不登录，只要访问网页就可以访问成功，并且可以进行增删改查等操作。我们在进入网页的时候除了在登录的时候都要进行判断，判断是否登录过，如果登录过可以直接访问，如果没有登录跳转到登录界面：</p> 
<p>登录验证有两种方式：</p> 
<p>（1）过滤器：<br>      a)implements Filter{<!-- --><br>          --init<br>      --doFilter<br>      --destroy<br>        }<br>      b)配置过滤器:web.xml<br> （2）拦截器：<br>      a)提供拦截器类：implements HandlerInterceptor{<!-- --><br>               --pre<br>               --post<br>               --after<br>                      }<br>      b)配置拦截器：springmvc.xml</p> 
<p>这里我们使用拦截器，更方便</p> 
<p>还记得我们之前把登录信息封装到User中，并且保存在session域中，所以我们只要访问session域查找是否存在登录信息即可</p> 
<pre><code class="language-java">public class LoginInterceptor implements HandlerInterceptor {
    @Override
    public boolean preHandle(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Object o) throws Exception {
        //如果用户没有登录则跳转到登录界面
        HttpSession session = httpServletRequest.getSession();
        User user = (User) session.getAttribute(Constants.SESSION_USER);
        if (user == null){
            //没有登录过
            httpServletResponse.sendRedirect(httpServletRequest.getContextPath());
            return false;//表示不继续进行下面的访问
        }
        return true;//表示可以继续访问
    }</code></pre> 
<p>需要注意拦截器的三个方法的作用分别如下：</p> 
<p><img alt="" height="283" src="https://images2.imgbox.com/a9/ab/mwOZaIHe_o.png" width="1038"></p> 
<p>我们配置springmvc：</p> 
<pre><code class="language-XML">    &lt;mvc:interceptors&gt;
        &lt;mvc:interceptor&gt;
            &lt;!--拦截哪些内容--&gt;
            &lt;mvc:mapping path="/settings/**"/&gt;
            &lt;mvc:mapping path="/workbench/**"/&gt;
            &lt;!--排除哪些内容，不拦截--&gt;
            &lt;mvc:exclude-mapping path="/settings/qx/user/toLogin.do"/&gt;
            &lt;mvc:exclude-mapping path="/settings/qx/user/login.do"/&gt;
            &lt;!--使用那个拦截器--&gt;
            &lt;bean class="com.itzw.crm.settings.web.interceptor.LoginInterceptor"/&gt;
        &lt;/mvc:interceptor&gt;
    &lt;/mvc:interceptors&gt;</code></pre> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ef401c12b7572dd581c9c3e62cc16812/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">从0开发一个Django博客系统</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9bc33ead0722cc53d968eeaeac8f3bc5/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">网络编程套接字Socket(通过两个用例,逐行注释,详细理解)干活满满建议收藏</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>