<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>smali 语法 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="smali 语法" />
<meta property="og:description" content="1.smali
apk文件通过apktool反编译出来的都有一个smali文件夹，里面都是以.smali结尾的文件。
smali语言是Davlik的寄存器语言，语法上和汇编语言相似，Dalvik VM与JVM的最大的区别之一就是Dalvik VM是基于寄存器的。基于寄存器的意思是，在smali里的所有操作都必须经过寄存器来进行。
2.基本数据类型 B—byte
C—char
D—double
F—float
I—int
S—short
V—void
J—long
Z—boolean
注意J、Z两个不是对应类型的首字母；
在dalvik字节码中，寄存器都是32位的，能够支持任何类型，Long和Double类型是64位的，需要2个寄存器；
V 只能用于返回值类型；
3.数组和对象是引用类型 数组的表示方式是在基本类型前加上前中括号“[”，例如int数组和float数组分别表示为：[I、[F；
对象类型以L作为开头来表示，格式是Lpackage/ClassName;（用分号表示对象结束是必须的），示例：
String对象在smali中为：Ljava/lang/String;
Class1对象的一个boolean成员表示为：Lcom/disney/Class1;-&gt;isRunning:Z
Class1对象的一个String对象成员表示为：Lcom/disney/Class1;-&gt;name:Ljava/lang/String;
可以总结为格式为对象类型-&gt;成员名:成员类型，-&gt;表示所属关系，类型尾部必须包括一个分号。
内部类表示为：Lpackage/ClassName$innerObjectName;，也就是在内部类前加“$”符号。
4.函数 格式：Func-Name (Para-Type1Para-Type2Para-Type3…)Return-Type
返回类型在最后，参数之间没有任何分隔符，示例：
void fun() fun()V boolean fun(int, int, int) fun(III)Z String fun(boolean, int[], int[], String, long) fun(Z[I[ILjava/lang/String;J)Ljava/lang/String; 5.语法 #标记，构造函数的返回类型为V，名字为&lt;init&gt;
# static fields 定义静态变量的标记 # instance fields 定义实例变量的标记 # direct methods 定义静态方法的标记？？ # virtual methods 定义非静态方法的标记？？ .class public Lcom/disney/WMW/WMWActivity; .super Lcom/disney/common/BaseActivity; ." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/864cfd3a09620801151bc5c4d43150d3/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-06-19T14:38:38+08:00" />
<meta property="article:modified_time" content="2018-06-19T14:38:38+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">smali 语法</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);"><span style="color:rgb(0,0,0);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:28px;"><strong>1.smali</strong></span></p> 
<p style="margin:10px auto;color:rgb(0,0,0);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">apk文件通过apktool反编译出来的都有一个smali文件夹，里面都是以.smali结尾的文件。<br>smali语言是Davlik的寄存器语言，语法上和汇编语言相似，Dalvik VM与JVM的最大的区别之一就是Dalvik VM是基于寄存器的。基于寄存器的意思是，在smali里的所有操作都必须经过寄存器来进行。</p> 
<h2 style="margin-top:10px;margin-bottom:10px;padding-top:5px;line-height:1.5;color:rgb(0,0,0);font-family:Verdana, Arial, Helvetica, sans-serif;background-color:rgb(255,255,255);">2.基本数据类型</h2> 
<p style="margin:10px auto;color:rgb(0,0,0);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">B—byte<br>C—char<br>D—double<br>F—float<br>I—int<br>S—short<br>V—void<br>J—long<br>Z—boolean</p> 
<p style="margin:10px auto;color:rgb(0,0,0);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">注意J、Z两个不是对应类型的首字母；<br>在dalvik字节码中，寄存器都是32位的，能够支持任何类型，Long和Double类型是64位的，需要2个寄存器；<br>V 只能用于返回值类型；</p> 
<h2 style="margin-top:10px;margin-bottom:10px;padding-top:5px;line-height:1.5;color:rgb(0,0,0);font-family:Verdana, Arial, Helvetica, sans-serif;background-color:rgb(255,255,255);">3.数组和对象是引用类型</h2> 
<p style="margin:10px auto;color:rgb(0,0,0);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);"><span style="color:rgb(255,102,0);">数组</span>的表示方式是在基本类型前加上前中括号<span style="color:rgb(255,102,0);">“[”</span>，例如int数组和float数组分别表示为：[I、[F；<br>对象类型以L作为开头来表示，格式是Lpackage/ClassName;（用分号表示对象结束是必须的），示例：<br>String对象在smali中为：Ljava/lang/String;<br>Class1对象的一个boolean成员表示为：Lcom/disney/Class1;-&gt;isRunning:Z<br>Class1对象的一个String对象成员表示为：Lcom/disney/Class1;-&gt;name:Ljava/lang/String;<br>可以总结为格式为对象类型-&gt;成员名:成员类型，-&gt;表示所属关系，类型尾部必须包括一个分号。<br>内部类表示为：Lpackage/ClassName$innerObjectName;，也就是在<span style="color:rgb(255,102,0);">内部类前加“$”符号</span>。</p> 
<h2 style="margin-top:10px;margin-bottom:10px;padding-top:5px;line-height:1.5;color:rgb(0,0,0);font-family:Verdana, Arial, Helvetica, sans-serif;background-color:rgb(255,255,255);">4.函数</h2> 
<p style="margin:10px auto;color:rgb(0,0,0);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">格式：Func-Name (Para-Type1Para-Type2Para-Type3…)Return-Type</p> 
<p style="margin:10px auto;color:rgb(0,0,0);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">返回类型在最后，参数之间没有任何分隔符，示例：</p> 
<pre style="margin-bottom:0px;margin-left:22px;white-space:pre-wrap;font-size:14px;background-color:rgb(255,255,255);">void fun()
fun()V

boolean fun(int, int, int)
fun(III)Z

<span style="color:rgb(255,102,0);">String fun(boolean, int[], int[], String, long)
fun(Z[I[ILjava/lang/String;J)Ljava/lang/String;</span></pre> 
<h2 style="margin-top:10px;margin-bottom:10px;padding-top:5px;line-height:1.5;color:rgb(0,0,0);font-family:Verdana, Arial, Helvetica, sans-serif;background-color:rgb(255,255,255);">5.语法</h2> 
<p style="margin:10px auto;color:rgb(0,0,0);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">#标记，构造函数的返回类型为V，名字为&lt;init&gt;</p> 
<pre style="margin-bottom:0px;margin-left:22px;white-space:pre-wrap;font-size:14px;background-color:rgb(255,255,255);"># static fields        定义静态变量的标记
# instance fields      定义实例变量的标记
# direct methods       定义静态方法的标记？？
# virtual methods      定义非静态方法的标记？？</pre> 
<pre style="margin-bottom:0px;margin-left:22px;white-space:pre-wrap;font-size:14px;background-color:rgb(255,255,255);"> .class public Lcom/disney/WMW/WMWActivity;
 .super Lcom/disney/common/BaseActivity;
 .source "WMWActivity.java"
 .implements Lcom/burstly/lib/ui/IBurstlyAdListener;</pre> 
<p style="margin:10px auto;color:rgb(0,0,0);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">上面这几行代码表示类名，父类名，源文件名，实现了接口。</p> 
<pre style="margin-bottom:0px;margin-left:22px;white-space:pre-wrap;font-size:14px;background-color:rgb(255,255,255);">.annotation
 内部类
.end annotation</pre> 
<h2 style="margin-top:10px;margin-bottom:10px;padding-top:5px;line-height:1.5;color:rgb(0,0,0);font-family:Verdana, Arial, Helvetica, sans-serif;background-color:rgb(255,255,255);">6.局部变量</h2> 
<p style="margin:10px auto;color:rgb(0,0,0);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">本地寄存器（local register，非参寄存器）用v开头数字结尾的符号来表示，如v0、v1、v2、…，<br>参数寄存器(parameter register)用p开头数字结尾的符号来表示，如p0、p1、p2、…，<br>.registers 用来标明方法中寄存器的总数，即参数寄存器和非参寄存器的总数。<br>.local 0，标明在这个函数中最少要用到的本地寄存器的个数，出现在方法中的第一行。在这里，由于只需要调用一个父类的onDestroy()处理，所以只需要用到p0，所以使用到的本地寄存器数为0，在植入代码后不要忘记可能要修改.local的值。<br>如 .local 4，则可以使用的寄存器是v0-v3。<br>当一个方法被调用的时候，方法的参数被置于最后N个寄存器中。<br>在实例函数中，p0代指“this”，p1表示函数的第一个参数，p2代表函数中的第二个参数…，<br>在static函数中，p1表示函数的第一个参数，p2代表函数中的第二个参数…，因为Java的static方法中没有this方法。<br>示例：</p> 
<pre style="margin-bottom:0px;margin-left:22px;white-space:pre-wrap;font-size:14px;background-color:rgb(255,255,255);">const/4 v0, 0x0
iput-boolean v0, p0, Lcom/disney/Class1;-&gt;isRunning:Z</pre> 
<p style="margin:10px auto;color:rgb(0,0,0);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">上面第一句中把值0x0存到v0本地寄存器中，<br>第二句用iput-boolean指令把v0中的值存放到this.isRunning这个成员变量中，即this.isRunning = false; 因为在实例函数中p0代表的是“this”，Lcom/disney/Class1;是类名，对应实例是p0。</p> 
<h2 style="margin-top:10px;margin-bottom:10px;padding-top:5px;line-height:1.5;color:rgb(0,0,0);font-family:Verdana, Arial, Helvetica, sans-serif;background-color:rgb(255,255,255);">7.成员变量和指令</h2> 
<pre style="margin-bottom:0px;margin-left:22px;white-space:pre-wrap;font-size:14px;background-color:rgb(255,255,255);"># static fields
.field private static final PREFS_INSTALLATION_ID java/lang/String; = "installationId"
# instance fields
.field private _activityPackageName java/lang/String;</pre> 
<p style="margin:10px auto;color:rgb(0,0,0);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">获取和操作静态成员变量和实例成员变量有不同的指令。<br>读取的指令有：iget、sget、iget-boolean、sget-boolean、iget-object、sget-object等，<br>赋值的指令有：iput、sput、iput-boolean、sput-boolean、iput-object、sput-object等。<br>带“-object”表示操作的成员变量是对象类型，没有“-object”后缀的表示操作的成员变量对象是基本数据类型，特别地boolean类型则使用带“-boolean”的指令操作。</p> 
<p style="margin:10px auto;color:rgb(0,0,0);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">获取static fields的指令示例：</p> 
<pre style="margin-bottom:0px;margin-left:22px;white-space:pre-wrap;font-size:14px;background-color:rgb(255,255,255);">sget-object v0, Lcom/disney/Class1;-&gt;PREFS_INSTALLATION_ID:Ljava/lang/String;</pre> 
<p style="margin:10px auto;color:rgb(0,0,0);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">上句中sget-object指令把PREFS_INSTALLATION_ID这个String成员变量获取并放到v0寄存器中。</p> 
<p style="margin:10px auto;color:rgb(0,0,0);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">获取instance fields的指令与static fields的类似，需要指明对象所属的实例。示例：</p> 
<pre style="margin-bottom:0px;margin-left:22px;white-space:pre-wrap;font-size:14px;background-color:rgb(255,255,255);">iget-object v0, p0, Lcom/disney/Class1;-&gt;_view:Lcom/disney/Class2;</pre> 
<p style="margin:10px auto;color:rgb(0,0,0);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">上句iget-object指令比sget-object多了一个参数p0，就是该变量所在类的实例，在这里就是p0即“this”。</p> 
<p style="margin:10px auto;color:rgb(0,0,0);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">put指令的使用和get指令是统一的，示例：</p> 
<pre style="margin-bottom:0px;margin-left:22px;white-space:pre-wrap;font-size:14px;background-color:rgb(255,255,255);">const/4 v3, 0x0
sput-object v3, Lcom/disney/Class1;-&gt;globalIapHandler:Lcom/disney/config/GlobalPurchaseHandler;</pre> 
<p style="margin:10px auto;color:rgb(0,0,0);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">上句相当于Class1.globalIapHandler = null;</p> 
<h2 style="margin-top:10px;margin-bottom:10px;padding-top:5px;line-height:1.5;color:rgb(0,0,0);font-family:Verdana, Arial, Helvetica, sans-serif;background-color:rgb(255,255,255);">8.函数调用</h2> 
<p style="margin:10px auto;color:rgb(0,0,0);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">smali中的函数调用也分为direct和virtual两种类型，direct method就是private函数，public和protected函数都属于virtual method。在调用函数时，有invoke-direct，invoke-virtual，invoke-static、invoke-super以及invoke-interface等几种不同的指令。还有invoke-XXX/range 指令的，这是参数多于4个的时候调用的指令，比较少见。</p> 
<p style="margin:10px auto;color:rgb(0,0,0);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">invoke-static：就是调用static函数的，示例：</p> 
<pre style="margin-bottom:0px;margin-left:22px;white-space:pre-wrap;font-size:14px;background-color:rgb(255,255,255);">invoke-static {}, Lcom/disney/Class1;-&gt;fun()Z</pre> 
<p style="margin:10px auto;color:rgb(0,0,0);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">上句invoke-static后面有一对大括号“{}”，内部是调用该方法的实例和参数列表，由于这是static方法也不需要参数，所以{}内为空。</p> 
<p style="margin:10px auto;color:rgb(0,0,0);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">invoke-super：调用父类方法，在onCreate、onDestroy等方法都能看到。<br>invoke-direct：调用private函数，示例：</p> 
<pre style="margin-bottom:0px;margin-left:22px;white-space:pre-wrap;font-size:14px;background-color:rgb(255,255,255);">invoke-direct {p0}, Lcom/disney/Class1;-&gt;getGlobalIapHandler()Lcom/disney/config/GlobalPurchaseHandler;</pre> 
<p style="margin:10px auto;color:rgb(0,0,0);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">上句即this-&gt;getGlobalIapHandler()，函数GlobalPurchaseHandler getGlobalIapHandler()是定义在Class1中的一个private函数。</p> 
<p style="margin:10px auto;color:rgb(0,0,0);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">invoke-virtual：用于调用protected或public函数，示例：</p> 
<pre style="margin-bottom:0px;margin-left:22px;white-space:pre-wrap;font-size:14px;background-color:rgb(255,255,255);">sget-object v0, Lcom/disney/Class1;-&gt;shareHandler:Landroid/os/Handler;
invoke-virtual {v0, v3}, Landroid/os/Handler;-&gt;removeCallbacksAndMessages(Ljava/lang/Object;)V</pre> 
<p style="margin:10px auto;color:rgb(0,0,0);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">上句v0是shareHandler android/os/Handler，v3是传递给removeCallbackAndMessage方法的Ljava/lang/Object参数。</p> 
<h2 style="margin-top:10px;margin-bottom:10px;padding-top:5px;line-height:1.5;color:rgb(0,0,0);font-family:Verdana, Arial, Helvetica, sans-serif;background-color:rgb(255,255,255);">9.获取函数调用结果</h2> 
<p style="margin:10px auto;color:rgb(0,0,0);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">在smali里调用函数和返回函数结果需要分开来完成，在调用的函数返回非void后，用move-result（返回基本数据类型）和move-result-object（返回对象）指令获取返回结果。</p> 
<p style="margin:10px auto;color:rgb(0,0,0);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">示例：</p> 
<pre style="margin-bottom:0px;margin-left:22px;white-space:pre-wrap;font-size:14px;background-color:rgb(255,255,255);">const/4 v2, 0x0
invoke-virtual {p0, v2}, Lcom/disney/Class1;-&gt;getPreferences(I)Landroid/content/SharedPreferences;
move-result-object v1</pre> 
<p style="margin:10px auto;color:rgb(0,0,0);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">上句v1保存的就是调用this.getPreferences(int)方法返回的SharedPreferences实例。</p> 
<h2 style="margin-top:10px;margin-bottom:10px;padding-top:5px;line-height:1.5;color:rgb(0,0,0);font-family:Verdana, Arial, Helvetica, sans-serif;background-color:rgb(255,255,255);">10.函数体</h2> 
<p style="margin:10px auto;color:rgb(0,0,0);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">.method   和  .end method之间。</p> 
<p style="margin:10px auto;color:rgb(0,0,0);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">示例：</p> 
<pre style="margin-bottom:0px;margin-left:22px;white-space:pre-wrap;font-size:14px;background-color:rgb(255,255,255);">.method protected onDestroy()V
.locals 0

.prologue
.line 277
invoke-super {p0}, Lcom/disney/common/BaseActivity;-&gt;onDestroy()V

.line 279
return-void
.end method</pre> 
<p style="margin:10px auto;color:rgb(0,0,0);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">上段是onDestroy()函数。<br>.line 277，标注了该代码在原Java文件中的行数，它不是必须的，去掉没有编译问题。它在出错时可以指出错误位置，jd-gui工具即是通过分析这些信息将smali代码还原成Java代码的。</p> 
<h2 style="margin-top:10px;margin-bottom:10px;padding-top:5px;line-height:1.5;color:rgb(0,0,0);font-family:Verdana, Arial, Helvetica, sans-serif;background-color:rgb(255,255,255);">11.条件语法</h2> 
<pre style="margin-bottom:0px;margin-left:22px;white-space:pre-wrap;font-size:14px;background-color:rgb(255,255,255);">if-eq p1, v0, :cond_8 
    :cond_8
    invoke-direct {p0}, Lcom/paul/test/a;-&gt;d()V</pre> 
<p style="margin:10px auto;color:rgb(0,0,0);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">上段表示如果p1和v0相等，则执行cond_8的流程：调用com.paul.test.a的d()方法</p> 
<pre style="margin-bottom:0px;margin-left:22px;white-space:pre-wrap;font-size:14px;background-color:rgb(255,255,255);">if-ne p1, v0, :cond_b 
    :cond_b
    const/4 v0, 0x0
    invoke-virtual {p0, v0}, Lcom/paul/test/a;-&gt;setPressed(Z)V
    invoke-super {p0, p1, p2}, Landroid/view/View;-&gt;onKeyUp(ILandroid/view/KeyEvent;)Z
    move-result v0</pre> 
<p style="margin:10px auto;color:rgb(0,0,0);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">上段表示不相等则执行cond_b的流程。</p> 
<p style="margin:10px auto;color:rgb(0,0,0);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);"><br></p> 
<p style="margin:10px auto;color:rgb(0,0,0);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);"></p> 
<p style="margin:10px auto;color:rgb(0,0,0);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);"></p> 
<p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">一、头信息——类的主体信息</p> 
<p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">在打开smali文件的时候，它的头三行描述了当前类的一些信息。</p> 
<pre class="prettyprint" style="font-size:14px;line-height:22px;"><code class="hljs xml has-numbering">.class <span class="hljs-tag">&lt;<span class="hljs-title">访问权限</span>&gt;</span> [关键修饰字] <span class="hljs-tag">&lt;<span class="hljs-title">类名</span>&gt;</span>;
.super <span class="hljs-tag">&lt;<span class="hljs-title">父类名</span>&gt;</span>;
.source <span class="hljs-tag">&lt;<span class="hljs-title">源文件名</span>&gt;</span></code></pre> 
<p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">例如：</p> 
<pre class="prettyprint" style="font-size:14px;line-height:22px;"><code class="hljs java has-numbering"><span class="hljs-comment">//===================================================================</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AppCompatActivity</span> {<!-- --></span>
    <span class="hljs-comment">// ......</span>
}
<span class="hljs-comment">//===================================================================</span>
.class <span class="hljs-keyword">public</span> Ltestdemo/hpp/cn/test/MainActivity;
.<span class="hljs-keyword">super</span> Landroid/support/v7/app/AppCompatActivity;
.source <span class="hljs-string">"MainActivity.java"</span>
<span class="hljs-comment">//===================================================================</span></code></pre> 
<p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">.class指令表示当前的类名，类的访问权限是public，类名为Ltestdemo/hpp/cn/test/MainActivity，类开头的L是遵循Dalvik字节码的相关约定，表示后面跟随的字符串是一个类。</p> 
<p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">.super指定了当前类所继承的父类，后面指的就是这个父类的类名，L表示后面跟的字符串是一个类</p> 
<p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">.source指定了当前类的源文件名</p> 
<p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">注意：经过混淆的dex文件，反编译出来的smali代码可能没有源文件信息，因此source行的代码可能为空。</p> 
<p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">这三行就是类的主体部分了，另外一个类是由多个字段或者方法组成。</p> 
<p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">二、接口 <br>如果一个类实现了一个接口，那么会在smali文件中使用.implements指令指出。</p> 
<pre class="prettyprint" style="font-size:14px;line-height:22px;"><code class="hljs vala has-numbering"><span class="hljs-preprocessor">#interfaces</span>
.implements &lt;接口名&gt;</code></pre> 
<p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">同样，#interfaces是注释，.implements是接口关键字。</p> 
<p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">例如：</p> 
<pre class="prettyprint" style="font-size:14px;line-height:22px;"><code class="hljs php has-numbering"><span class="hljs-comment">//===================================================================</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AppCompatActivity</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">View</span>.<span class="hljs-title">OnClickListener</span> {<!-- --></span>
    <span class="hljs-comment">// ......</span>
}
<span class="hljs-comment">//===================================================================</span>
<span class="hljs-comment"># interfaces</span>
.implements Landroid/view/View<span class="hljs-variable">$OnClickListener</span>;
<span class="hljs-comment">//===================================================================</span></code></pre> 
<ul class="pre-numbering"><li style="color:rgb(153,153,153);">三、smali基本语法 </li></ul> 
<p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">Davlik字节码中，寄存器都是32位的，能够支持任何类型，64位类型（Long/Double）用2个寄存器表示； <br>Dalvik字节码有两种类型：原始类型；引用类型（包括对象和数组）</p> 
<p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">1、原始类型</p> 
<pre class="prettyprint" style="font-size:14px;line-height:22px;"><code class="hljs java has-numbering">V <span class="hljs-keyword">void</span> (只能用于返回值类型) 
Z <span class="hljs-keyword">boolean</span>
B <span class="hljs-keyword">byte</span>
S <span class="hljs-keyword">short</span>
C <span class="hljs-keyword">char</span>
I <span class="hljs-keyword">int</span>
J <span class="hljs-keyword">long</span>（<span class="hljs-number">64</span>位）
F <span class="hljs-keyword">float</span>
D <span class="hljs-keyword">double</span>（<span class="hljs-number">64</span>位）</code></pre> 
<p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">2、对象类型 <br>Lpackage/name/ObjectName; 相当于java中的package.name.ObjectName; <br>L 表示这是一个对象类型 <br>package/name 该对象所在的包 <br>ObjectName 对象名称 <br>; 标识对象名称的结束</p> 
<p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">3、数组类型 <br>[I :表示一个整形的一维数组，相当于java的int[]; <br>对于多维数组，只要增加[ 就行了，[[I = int[][];注：每一维最多255个；</p> 
<p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">对象数组的表示形式： <br>[Ljava/lang/String 表示一个String的对象数组；</p> 
<p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">4、寄存器与变量 <br>android变量都是存放在寄存器中的，寄存器为32位，可以支持任何类型，其中long和double是64为的，需要使用两个寄存器保存。 <br>寄存器采用v和p来命名，v表示本地寄存器，p表示参数寄存器。</p> 
<p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">例如：</p> 
<pre class="prettyprint" style="font-size:14px;line-height:22px;"><code class="hljs cs has-numbering"><span class="hljs-comment">//===================================================================</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">print</span>(String <span class="hljs-keyword">string</span>) {
    Log.d(TAG, <span class="hljs-keyword">string</span>);
}
<span class="hljs-comment">//===================================================================</span>
.method <span class="hljs-keyword">private</span> <span class="hljs-title">print</span>(Ljava/lang/String;)V
    .registers <span class="hljs-number">3</span>
    .param p1, <span class="hljs-string">"string"</span>    <span class="hljs-preprocessor"># Ljava/lang/String;</span>

    .prologue
    .line <span class="hljs-number">29</span>
    <span class="hljs-keyword">const</span>-<span class="hljs-keyword">string</span> v0, <span class="hljs-string">"MainActivity"</span>

    invoke-<span class="hljs-keyword">static</span> {v0, p1}, Landroid/util/Log;-&gt;d(Ljava/lang/String;Ljava/lang/String;)I

    .line <span class="hljs-number">30</span>
    <span class="hljs-keyword">return</span>-<span class="hljs-keyword">void</span>
.end method
<span class="hljs-comment">//===================================================================</span></code></pre> 
<ul class="pre-numbering"><li style="color:rgb(153,153,153);">.registers 3 说明该方法有三个寄存器，其中一个本地寄存器v0，两个参数寄存器p0,p1，细心的人可能会注意到没有看到p0，原因是p0存放的是this。如果是静态方法的话就只有2个寄存器了，不需要存this了。</li></ul> 
<p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">5、基本指令 <br>smali字节码是类似于汇编的，如果你有汇编基础，理解起来是非常容易的。 <br>move v0, v3 把v3寄存器的值移动到寄存器v0上 <br>const-string v0, “MainActivity” 把字符串”MainActivity”赋值给v0寄存器 <br>invoke-super　　调用父函数 <br>return-void　　函数返回void <br>new-instance　　创建实例 <br>iput-object　　对象赋值 <br>iget-object　　调用对象 <br>invoke-static　　调用静态函数 <br>invoke-direct　　调用函数</p> 
<p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">例如：</p> 
<pre class="prettyprint" style="font-size:14px;line-height:22px;"><code class="hljs cs has-numbering"><span class="hljs-comment">//===================================================================</span>
@Override
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onClick</span>(View view) {
    String str = <span class="hljs-string">"Hello World!"</span>;
    print(str);
}
<span class="hljs-comment">//===================================================================</span>
<span class="hljs-preprocessor"># virtual methods</span>
<span class="hljs-preprocessor"># 参数类型为Landroid/view/View，返回类型为V</span>
.method <span class="hljs-keyword">public</span> <span class="hljs-title">onClick</span>(Landroid/view/View;)V
    <span class="hljs-preprocessor"># 表示有三个寄存器</span>
    .registers <span class="hljs-number">3</span>
    <span class="hljs-preprocessor"># 参数View类型的view变量对应的是寄存器p1</span>
    .param p1, <span class="hljs-string">"view"</span>    <span class="hljs-preprocessor"># Landroid/view/View;</span>

    .prologue
    .line <span class="hljs-number">24</span>
    <span class="hljs-preprocessor">#将"Hello World!"字符串放到寄存器v0中</span>
    <span class="hljs-keyword">const</span>-<span class="hljs-keyword">string</span> v0, <span class="hljs-string">"Hello World!"</span>

    .line <span class="hljs-number">25</span>
    <span class="hljs-preprocessor"># 定义一个Ljava/lang/String类型的str变量对应本地寄存器v0</span>
    .local v0, <span class="hljs-string">"str"</span>:Ljava/lang/String;
    <span class="hljs-preprocessor"># 调用该类的print方法，该方法的参数类型为Ljava/lang/String，返回值为V</span>
    <span class="hljs-preprocessor"># 调用print方法传入的参数为{p0, v0}，及print(p0, v0)，p0为this，v0为"Hello World!"字符串</span>
    invoke-direct {p0, v0}, Ltestdemo/hpp/cn/annotationtest/MainActivity;-&gt;print(Ljava/lang/String;)V

    .line <span class="hljs-number">26</span>
    <span class="hljs-keyword">return</span>-<span class="hljs-keyword">void</span>
.end method
<span class="hljs-comment">//===================================================================</span></code></pre> 
<p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">6、if判断语句</p> 
<p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">if判断一共有12条指令：</p> 
<pre class="prettyprint" style="font-size:14px;line-height:22px;"><code class="hljs ruby has-numbering"><span class="hljs-keyword">if</span>-eq vA, <span class="hljs-constant">VB</span>, cond<span class="hljs-number">_</span>** 如果vA等于vB则跳转到cond<span class="hljs-number">_</span>**。相当于<span class="hljs-keyword">if</span> (vA==vB)
<span class="hljs-keyword">if</span>-ne vA, <span class="hljs-constant">VB</span>, cond<span class="hljs-number">_</span>** 如果vA不等于vB则跳转到cond<span class="hljs-number">_</span>**。相当于<span class="hljs-keyword">if</span> (vA!=vB)
<span class="hljs-keyword">if</span>-lt vA, <span class="hljs-constant">VB</span>, cond<span class="hljs-number">_</span>** 如果vA小于vB则跳转到cond<span class="hljs-number">_</span>**。相当于<span class="hljs-keyword">if</span> (vA&lt;vB)
<span class="hljs-keyword">if</span>-le vA, <span class="hljs-constant">VB</span>, cond<span class="hljs-number">_</span>** 如果vA小于等于vB则跳转到cond<span class="hljs-number">_</span>**。相当于<span class="hljs-keyword">if</span> (vA&lt;=vB)
<span class="hljs-keyword">if</span>-gt vA, <span class="hljs-constant">VB</span>, cond<span class="hljs-number">_</span>** 如果vA大于vB则跳转到cond<span class="hljs-number">_</span>**。相当于<span class="hljs-keyword">if</span> (vA&gt;vB)
<span class="hljs-keyword">if</span>-ge vA, <span class="hljs-constant">VB</span>, cond<span class="hljs-number">_</span>** 如果vA大于等于vB则跳转到cond<span class="hljs-number">_</span>**。相当于<span class="hljs-keyword">if</span> (vA&gt;=vB)

<span class="hljs-keyword">if</span>-eqz vA, <span class="hljs-symbol">:cond_**</span> 如果vA等于<span class="hljs-number">0</span>则跳转到<span class="hljs-symbol">:cond_**</span> 相当于<span class="hljs-keyword">if</span> (<span class="hljs-constant">VA</span>==<span class="hljs-number">0</span>)
<span class="hljs-keyword">if</span>-nez vA, <span class="hljs-symbol">:cond_**</span> 如果vA不等于<span class="hljs-number">0</span>则跳转到<span class="hljs-symbol">:cond_**</span>相当于<span class="hljs-keyword">if</span> (<span class="hljs-constant">VA</span>!=<span class="hljs-number">0</span>)
<span class="hljs-keyword">if</span>-ltz vA, <span class="hljs-symbol">:cond_**</span> 如果vA小于<span class="hljs-number">0</span>则跳转到<span class="hljs-symbol">:cond_**</span>相当于<span class="hljs-keyword">if</span> (<span class="hljs-constant">VA</span>&lt;<span class="hljs-number">0</span>)
<span class="hljs-keyword">if</span>-lez vA, <span class="hljs-symbol">:cond_**</span> 如果vA小于等于<span class="hljs-number">0</span>则跳转到<span class="hljs-symbol">:cond_**</span>相当于<span class="hljs-keyword">if</span> (<span class="hljs-constant">VA</span>&lt;=<span class="hljs-number">0</span>)
<span class="hljs-keyword">if</span>-gtz vA, <span class="hljs-symbol">:cond_**</span> 如果vA大于<span class="hljs-number">0</span>则跳转到<span class="hljs-symbol">:cond_**</span>相当于<span class="hljs-keyword">if</span> (<span class="hljs-constant">VA</span>&gt;<span class="hljs-number">0</span>)
<span class="hljs-keyword">if</span>-gez vA, <span class="hljs-symbol">:cond_**</span> 如果vA大于等于<span class="hljs-number">0</span>则跳转到<span class="hljs-symbol">:cond_**</span>相当于<span class="hljs-keyword">if</span> (<span class="hljs-constant">VA</span>&gt;=<span class="hljs-number">0</span>)</code></pre> 
<p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">7、循环语句 <br>常用的循环结构有：迭代器循环，for循环，do while循环。</p> 
<p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">8、switch分支语句</p> 
<p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">9、try/catch语句</p> 
<p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">四、字段</p> 
<p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">smali文件中，字段的声明使用.field指令，字段分为静态字段和实例字段。</p> 
<p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">1、静态字段</p> 
<pre class="prettyprint" style="font-size:14px;line-height:22px;"><code class="hljs xml has-numbering">#static fields
.field <span class="hljs-tag">&lt;<span class="hljs-title">访问权限</span>&gt;</span> static [修饰关键字] <span class="hljs-tag">&lt;<span class="hljs-title">字段名</span>&gt;</span>:<span class="hljs-tag">&lt;<span class="hljs-title">字段类型</span>&gt;</span></code></pre> 
<p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">可以看到，baksmali在生成smali文件时，会在静态字段声明的起始处添加注释”static fields”，注释是以#开头。</p> 
<p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">访问权限包括：private、protected、public（三者之一） <br>修饰关键字为字段的其他属性，例如，final <br>字段名和类型就不用解释了</p> 
<p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">例如：</p> 
<pre class="prettyprint" style="font-size:14px;line-height:22px;"><code class="hljs java has-numbering"><span class="hljs-comment">//===================================================================</span>
<span class="hljs-keyword">private</span>  <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String TAG = <span class="hljs-string">"MainActivity"</span>;
<span class="hljs-comment">//===================================================================</span>
# <span class="hljs-keyword">static</span> fields
.field <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> TAG:Ljava/lang/String; = <span class="hljs-string">"MainActivity"</span>
<span class="hljs-comment">//===================================================================</span></code></pre> 
<p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">2、实例字段 <br>相比于静态自动就少了一个static的静态声明而已，其他都一样。</p> 
<pre class="prettyprint" style="font-size:14px;line-height:22px;"><code class="hljs xml has-numbering">#instance fields
.field <span class="hljs-tag">&lt;<span class="hljs-title">访问权限</span>&gt;</span> [修饰关键字] <span class="hljs-tag">&lt;<span class="hljs-title">字段名</span>&gt;</span>:<span class="hljs-tag">&lt;<span class="hljs-title">字段类型</span>&gt;</span></code></pre> 
<p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">例如：</p> 
<pre class="prettyprint" style="font-size:14px;line-height:22px;"><code class="hljs cs has-numbering"><span class="hljs-comment">//===================================================================</span>
<span class="hljs-keyword">private</span> Button mButton;
<span class="hljs-comment">//===================================================================</span>
<span class="hljs-preprocessor"># instance fields</span>
.field <span class="hljs-keyword">private</span> mButton:Landroid/widget/Button;
<span class="hljs-comment">//===================================================================</span></code></pre> 
<p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">五、方法 <br>smali的方法声明使用的.method指令，方法分为直接方法和虚方法两种。</p> 
<p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">1、直接方法 <br>直接方法指的是该类中定义的方法。</p> 
<pre class="prettyprint" style="font-size:14px;line-height:22px;"><code class="hljs oxygene has-numbering">#direct methods
.<span class="hljs-keyword">method</span> &lt;访问权限&gt; [修饰关键字] &lt;方法原型&gt;
    &lt;.registers&gt;
    [.param]
    [.prologue]
    [.line]
    &lt;.local&gt;
    &lt;代码体&gt;
.<span class="hljs-keyword">end</span> <span class="hljs-function"><span class="hljs-keyword">method</span></span></code></pre> 
<pre class="prettyprint" style="font-size:14px;line-height:22px;"><code class="hljs avrasm has-numbering"><span class="hljs-preprocessor">#direct methods是注释，是baksmali添加的，访问权限和修饰关键字跟字段是一样的。</span>
方法原型描述了方法的名称、参数与返回值。
<span class="hljs-preprocessor">.registers</span> 指令指定了方法中寄存器的总数,这个数量是参数和本地变量总和。
<span class="hljs-preprocessor">.param</span>表明了方法的参数，每个<span class="hljs-preprocessor">.param</span>指令表示一个参数，方法使用了几个参数就有几个<span class="hljs-preprocessor">.parameter</span>指令。
<span class="hljs-preprocessor">.prologue</span>指定了代码的开始处，混淆过的代码可能去掉了该指令。
<span class="hljs-preprocessor">.line</span>指明了该处代码在源代码中的行号，同样，混淆后的代码可能去掉了行号。
<span class="hljs-preprocessor">.local</span> 使用这个指定表明方法中非参寄存器</code></pre> 
<pre class="prettyprint" style="font-size:14px;line-height:22px;"><code class="hljs cs has-numbering"><span class="hljs-comment">//===================================================================</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">print</span>(String <span class="hljs-keyword">string</span>) {
    Log.d(TAG, <span class="hljs-keyword">string</span>);
}
<span class="hljs-comment">//===================================================================</span>
.method <span class="hljs-keyword">private</span> <span class="hljs-title">print</span>(Ljava/lang/String;)V
    .registers <span class="hljs-number">3</span>
    .param p1, <span class="hljs-string">"string"</span>    <span class="hljs-preprocessor"># Ljava/lang/String;</span>

    .prologue
    .line <span class="hljs-number">29</span>
    <span class="hljs-keyword">const</span>-<span class="hljs-keyword">string</span> v0, <span class="hljs-string">"MainActivity"</span>

    invoke-<span class="hljs-keyword">static</span> {v0, p1}, Landroid/util/Log;-&gt;d(Ljava/lang/String;Ljava/lang/String;)I

    .line <span class="hljs-number">30</span>
    <span class="hljs-keyword">return</span>-<span class="hljs-keyword">void</span>
.end method
<span class="hljs-comment">//===================================================================</span></code></pre> 
<p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">2、虚方法 <br>虚方法指的是从父类中继承的方法或者实现的接口的方法，它的声明跟直接方法相同，只是起始的初始为virtual methods</p> 
<pre class="prettyprint" style="font-size:14px;line-height:22px;"><code class="hljs cs has-numbering"><span class="hljs-comment">//===================================================================</span>
@Override
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onClick</span>(View view) {
    String str = <span class="hljs-string">"Hello World!"</span>;
    print(str);
}
<span class="hljs-comment">//===================================================================</span>
<span class="hljs-preprocessor"># virtual methods</span>
.method <span class="hljs-keyword">public</span> <span class="hljs-title">onClick</span>(Landroid/view/View;)V
    .registers <span class="hljs-number">3</span>
    .param p1, <span class="hljs-string">"view"</span>    <span class="hljs-preprocessor"># Landroid/view/View;</span>

    .prologue
    .line <span class="hljs-number">24</span>
    <span class="hljs-keyword">const</span>-<span class="hljs-keyword">string</span> v0, <span class="hljs-string">"Hello World!"</span>

    .line <span class="hljs-number">25</span>
    .local v0, <span class="hljs-string">"str"</span>:Ljava/lang/String;
    invoke-direct {p0, v0}, Ltestdemo/hpp/cn/annotationtest/MainActivity;-&gt;print(Ljava/lang/String;)V

    .line <span class="hljs-number">26</span>
    <span class="hljs-keyword">return</span>-<span class="hljs-keyword">void</span>
.end method
<span class="hljs-comment">//===================================================================</span></code></pre> 
<p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">3、静态方法</p> 
<pre class="prettyprint" style="font-size:14px;line-height:22px;"><code class="hljs cs has-numbering"><span class="hljs-comment">//===================================================================</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setTag</span>(String str) {
    TAG = str;
}
<span class="hljs-comment">//===================================================================</span>
.method <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title">setTag</span>(Ljava/lang/String;)V
    .registers <span class="hljs-number">1</span>
    .param p0, <span class="hljs-string">"str"</span>    <span class="hljs-preprocessor"># Ljava/lang/String;</span>

    .prologue
    .line <span class="hljs-number">64</span>
    sput-<span class="hljs-keyword">object</span> p0, Ltestdemo/hpp/cn/annotationtest/MainActivity;-&gt;TAG:Ljava/lang/String;

    .line <span class="hljs-number">65</span>
    <span class="hljs-keyword">return</span>-<span class="hljs-keyword">void</span>
.end method
<span class="hljs-comment">//===================================================================</span></code></pre> 
<p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">六、注解</p> 
<p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">如果一个类使用了注解，那么smali中会使用.annotation指令。</p> 
<pre class="prettyprint" style="font-size:14px;line-height:22px;"><code class="hljs css has-numbering"><span class="hljs-id">#annotations</span>
<span class="hljs-class">.annotation</span> <span class="hljs-attr_selector">[注解属性]</span> &lt;注解类名&gt;
    <span class="hljs-attr_selector">[注解字段 = 值]</span>
<span class="hljs-class">.end</span> <span class="hljs-tag">annotation</span></code></pre> 
<p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">注解的作用范围可以是类、方法或者字段。如果注解的作用范围是类，.annotation指令会直接定义在smali文件中，如果是方法或者字段，.annotation指令则会包含在方法或者字段的定义中。</p> 
<p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">1、注解类</p> 
<pre class="prettyprint" style="font-size:14px;line-height:22px;"><code class="hljs java has-numbering"><span class="hljs-comment">//===================================================================</span>
<span class="hljs-annotation">@BindInt</span>(<span class="hljs-number">100</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AppCompatActivity</span> {<!-- --></span>

}
<span class="hljs-comment">//===================================================================</span>
# annotations
.annotation build Ltestdemo/hpp/cn/annotationtest/BindInt;
    value = <span class="hljs-number">0x64</span>
.end annotation
<span class="hljs-comment">//===================================================================</span></code></pre> 
<p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">2、注解字段</p> 
<pre class="prettyprint" style="font-size:14px;line-height:22px;"><code class="hljs cs has-numbering"><span class="hljs-comment">//===================================================================</span>
@BindView(R.id.button)
<span class="hljs-keyword">public</span> Button mButton;
<span class="hljs-comment">//===================================================================</span>
<span class="hljs-preprocessor"># instance fields</span>
.field <span class="hljs-keyword">public</span> mButton:Landroid/widget/Button;
    .annotation build Lbutterknife/BindView;
        <span class="hljs-keyword">value</span> = <span class="hljs-number">0x7f0c0050</span>
    .end annotation
.end field
<span class="hljs-comment">//===================================================================</span></code></pre> 
<p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">3、注解方法</p> 
<pre class="prettyprint" style="font-size:14px;line-height:22px;"><code class="hljs cs has-numbering"><span class="hljs-comment">//===================================================================</span>
@OnClick(R.id.button)
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">click</span>() {
    String str = <span class="hljs-string">"Hello World!"</span>;
    print(str);
}
<span class="hljs-comment">//===================================================================</span>
<span class="hljs-preprocessor"># virtual methods</span>
.method <span class="hljs-keyword">public</span> <span class="hljs-title">click</span>()V
    .registers 2
    .annotation build Lbutterknife/OnClick;
        <span class="hljs-keyword">value</span> = {
            <span class="hljs-number">0x7f0c0050</span>
        }
    .end annotation

    .prologue
    .line <span class="hljs-number">29</span>
    <span class="hljs-keyword">const</span>-<span class="hljs-keyword">string</span> v0, <span class="hljs-string">"Hello World!"</span>

    .line <span class="hljs-number">30</span>
    .local v0, <span class="hljs-string">"str"</span>:Ljava/lang/String;
    invoke-direct {p0, v0}, Ltestdemo/hpp/cn/annotationtest/MainActivity;-&gt;print(Ljava/lang/String;)V

    .line <span class="hljs-number">31</span>
    <span class="hljs-keyword">return</span>-<span class="hljs-keyword">void</span>
.end method
<span class="hljs-comment">//===================================================================</span></code></pre> 
<p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);"><br></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/056f56d836d7dac7077b8a79b3999856/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">arcgis for android 100.2去掉水印和logo</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2cdb7cb507a6dbf5f4f6d9cc08feb517/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">ToList()所带来的性能影响</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>