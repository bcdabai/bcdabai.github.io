<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>7.图像验证码与cookie操作 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="7.图像验证码与cookie操作" />
<meta property="og:description" content="有很多第三方的公司可以解决图像验证码问题，但是人家都需要费用，比如 云码 验证码识别价格_验证码识别费用多少钱-云码 超级鹰 超级鹰验证码识别-专业的验证码云端识别服务,让验证码识别更快速、更准确、更强大
如果不需要搞定太专业的验证码，我们可以自己搞定一下比如 paddleocr的基本使用-CSDN博客
我们后面都是通过这个服务来识别验证码
验证码可能与很多的因素相关，比如请求验证码的时候发送查询字符串或是与cookie、session相关或是与时间戳相关，都有可能
我们下面做个古诗文网的例子
参考 实现古诗文网站的模拟登录_古诗文网模拟登录-CSDN博客 古诗文网 登录古诗文网
目录
1 验证码
2 登录请求
3 处理cookie
3.1 手动添加cookie
3.2 寻找cookie来源
3.3 requests.Session()
1 验证码 首先看一下这个验证码的图像地址，可以看出这个验证码的url是拼接出来的，直接请求url就行
能拿到图像之后我们可以使用paddleocr搞定验证码，可以参考 paddleocr的基本使用-CSDN博客
验证码在发起登录请求之前请求就行，浏览器其实也是这么做的，浏览器先请求页面，请求页面就相当于请求页面中的资源，资源中包含验证码
之后等用户点击按钮之后，相当于发起第二次请求，这时候你再用代码模拟第二次请求就行了
我们目前的代码是这样的
运行后可以解决验证码问题(存在识别不准确的情况)
2 登录请求 为了拿到登录按钮的请求，我们先登录一次
这样我们拿到了登录的请求地址以及需要携带的参数
再代码中加入如下内容
运行后会得到webpage.html
打开之后是这样的，网站说我们的验证码有问题，但我们查看之后发现验证码是正确的
写前后端的时候我们经常使用cookie判断用户之前是否登录过，所以登录出现这种问题的时候，我们可以考虑cookie的问题。
3 处理cookie cookie在请求头中，我们先看一眼正常的请求头内容
我们可以给这些请求头直接携带上，比如
3.1 手动添加cookie 这种方法叫手动添加cookie，一般我们不用这种方法，一是比较麻烦，二是cookie有可能是动态变化的，这么写不一定对。在我们的例子中发起请求后依然出现没加cookie的结果，也就是说手动添加cookie的方法走不通
3.2 寻找cookie来源 cookie的来源一般为提交登录的时候相应的内容，我们通过抓登录成功的包看这里的cookie，发现有请求cookie与相应cookie，说明这个cookie确实是在变化的
也可以从response Headers中到Set-Cookie这个键
3.3 requests.Session() requests.Session()可以自动存储cookie的内容，你可以拿requests.Session()当作一个增强版的requests
我们对代码做如下修改
当验证码识别正确后，我们进行请求就可以请求到登录成功的页面了" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/b6fe46768793fa5a9a5bb649d8daef7b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-18T13:44:10+08:00" />
<meta property="article:modified_time" content="2024-01-18T13:44:10+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">7.图像验证码与cookie操作</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>有很多第三方的公司可以解决图像验证码问题，但是人家都需要费用，比如 云码 <a href="https://zhuce.jfbym.com/price.html" rel="nofollow" title="验证码识别价格_验证码识别费用多少钱-云码">验证码识别价格_验证码识别费用多少钱-云码</a> 超级鹰 <a href="http://www.chaojiying.com/" rel="nofollow" title="超级鹰验证码识别-专业的验证码云端识别服务,让验证码识别更快速、更准确、更强大">超级鹰验证码识别-专业的验证码云端识别服务,让验证码识别更快速、更准确、更强大</a></p> 
<p>如果不需要搞定太专业的验证码，我们可以自己搞定一下比如 <a href="https://blog.csdn.net/potato123232/article/details/135528095" title="paddleocr的基本使用-CSDN博客">paddleocr的基本使用-CSDN博客</a></p> 
<p>我们后面都是通过这个服务来识别验证码</p> 
<p>验证码可能与很多的因素相关，比如请求验证码的时候发送查询字符串或是与cookie、session相关或是与时间戳相关，都有可能</p> 
<p>我们下面做个古诗文网的例子</p> 
<ul><li>参考 <a href="https://blog.csdn.net/ZK504390402/article/details/131776366" title="实现古诗文网站的模拟登录_古诗文网模拟登录-CSDN博客">实现古诗文网站的模拟登录_古诗文网模拟登录-CSDN博客</a></li></ul> 
<p>古诗文网 <a href="https://so.gushiwen.cn/user/login.aspx?from=http://so.gushiwen.cn/user/collect.aspx" rel="nofollow" title="登录古诗文网">登录古诗文网</a></p> 
<p class="img-center"><img alt="" height="512" src="https://images2.imgbox.com/40/63/bUEMBdyS_o.png" width="725"></p> 
<p id="main-toc"><strong>目录</strong></p> 
<p id="验证码-toc" style="margin-left:0px;"><a href="#%E9%AA%8C%E8%AF%81%E7%A0%81" rel="nofollow">1  验证码</a></p> 
<p id="登录请求-toc" style="margin-left:0px;"><a href="#%E7%99%BB%E5%BD%95%E8%AF%B7%E6%B1%82" rel="nofollow">2  登录请求</a></p> 
<p id="处理cookie-toc" style="margin-left:0px;"><a href="#%E5%A4%84%E7%90%86cookie" rel="nofollow">3  处理cookie</a></p> 
<p id="手动添加cookie-toc" style="margin-left:40px;"><a href="#%E6%89%8B%E5%8A%A8%E6%B7%BB%E5%8A%A0cookie" rel="nofollow">3.1  手动添加cookie</a></p> 
<p id="寻找cookie来源-toc" style="margin-left:40px;"><a href="#%E5%AF%BB%E6%89%BEcookie%E6%9D%A5%E6%BA%90" rel="nofollow">3.2  寻找cookie来源</a></p> 
<p id="requests.Session()-toc" style="margin-left:40px;"><a href="#requests.Session%28%29" rel="nofollow">3.3  requests.Session()</a></p> 
<hr id="hr-toc"> 
<p></p> 
<p> </p> 
<h2 id="验证码">1  验证码</h2> 
<p>首先看一下这个验证码的图像地址，可以看出这个验证码的url是拼接出来的，直接请求url就行</p> 
<p class="img-center"><img alt="" height="736" src="https://images2.imgbox.com/fc/1d/y5EGCbrw_o.png" width="1200"></p> 
<p>能拿到图像之后我们可以使用paddleocr搞定验证码，可以参考 <a href="https://blog.csdn.net/potato123232/article/details/135528095" title="paddleocr的基本使用-CSDN博客">paddleocr的基本使用-CSDN博客</a></p> 
<p>验证码在发起登录请求之前请求就行，浏览器其实也是这么做的，浏览器先请求页面，请求页面就相当于请求页面中的资源，资源中包含验证码</p> 
<p>之后等用户点击按钮之后，相当于发起第二次请求，这时候你再用代码模拟第二次请求就行了</p> 
<p>我们目前的代码是这样的</p> 
<p class="img-center"><img alt="" height="374" src="https://images2.imgbox.com/a8/5c/z0lHNlAl_o.png" width="839"></p> 
<p>运行后可以解决验证码问题(存在识别不准确的情况)</p> 
<p class="img-center"><img alt="" height="386" src="https://images2.imgbox.com/f5/6b/TYUyKHTD_o.png" width="1087"></p> 
<h2 id="登录请求">2  登录请求</h2> 
<p>为了拿到登录按钮的请求，我们先登录一次</p> 
<p class="img-center"><img alt="" height="252" src="https://images2.imgbox.com/8c/aa/cUU8DJBF_o.png" width="414"></p> 
<p>这样我们拿到了登录的请求地址以及需要携带的参数</p> 
<p class="img-center"><img alt="" height="784" src="https://images2.imgbox.com/a3/62/8txVzN6m_o.png" width="1200"></p> 
<p>再代码中加入如下内容</p> 
<p class="img-center"><img alt="" height="590" src="https://images2.imgbox.com/e2/04/oZRqTcMi_o.png" width="1200"></p> 
<p>运行后会得到webpage.html</p> 
<p class="img-center"><img alt="" height="286" src="https://images2.imgbox.com/57/6a/yJwlKj9S_o.png" width="265"></p> 
<p>打开之后是这样的，网站说我们的验证码有问题，但我们查看之后发现验证码是正确的</p> 
<p class="img-center"><img alt="" height="380" src="https://images2.imgbox.com/2d/ad/ZdJ14vjt_o.png" width="1200"></p> 
<p>写前后端的时候我们经常使用cookie判断用户之前是否登录过，所以登录出现这种问题的时候，我们可以考虑cookie的问题。</p> 
<h2 id="处理cookie"><a id="处理cookie-3"></a>3  处理cookie</h2> 
<p>cookie在请求头中，我们先看一眼正常的请求头内容</p> 
<p class="img-center"><img alt="" height="521" src="https://images2.imgbox.com/ca/0d/9JSVfqUE_o.png" width="1200"></p> 
<p>我们可以给这些请求头直接携带上，比如</p> 
<h3 id="手动添加cookie"><a id="手动添加cookie-3.1"></a>3.1  手动添加cookie</h3> 
<p class="img-center"><img alt="" height="735" src="https://images2.imgbox.com/9c/ad/stjmRpSK_o.png" width="1200"></p> 
<p>这种方法叫手动添加cookie，一般我们不用这种方法，一是比较麻烦，二是cookie有可能是动态变化的，这么写不一定对。在我们的例子中发起请求后依然出现没加cookie的结果，也就是说手动添加cookie的方法走不通</p> 
<p class="img-center"><img alt="" height="371" src="https://images2.imgbox.com/08/4c/fGiejVRU_o.png" width="1200"></p> 
<h3 id="寻找cookie来源">3.2  寻找cookie来源</h3> 
<p>cookie的来源一般为提交登录的时候相应的内容，我们通过抓登录成功的包看这里的cookie，发现有请求cookie与相应cookie，说明这个cookie确实是在变化的</p> 
<p class="img-center"><img alt="" height="763" src="https://images2.imgbox.com/60/ef/U6EfiwXG_o.png" width="1200"></p> 
<p>也可以从response Headers中到Set-Cookie这个键</p> 
<p class="img-center"><img alt="" height="561" src="https://images2.imgbox.com/56/46/DYp9fAS3_o.png" width="1200"></p> 
<h3 id="requests.Session()">3.3  requests.Session()</h3> 
<p>requests.Session()可以自动存储cookie的内容，你可以拿requests.Session()当作一个增强版的requests</p> 
<p>我们对代码做如下修改</p> 
<p class="img-center"><img alt="" height="455" src="https://images2.imgbox.com/45/fe/JrYIDnnA_o.png" width="849"></p> 
<p class="img-center"><img alt="" height="435" src="https://images2.imgbox.com/48/92/2P8zStfq_o.png" width="750"></p> 
<p>当验证码识别正确后，我们进行请求就可以请求到登录成功的页面了</p> 
<p class="img-center"><img alt="" height="777" src="https://images2.imgbox.com/49/f1/rVyX6sT7_o.png" width="1200"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1a84cda535aed25a11733fbb91da8239/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">通用导出模板</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/045704ca5262fc5ca6161293ac6801dd/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">sonarqube扫描代码</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>