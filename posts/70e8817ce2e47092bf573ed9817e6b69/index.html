<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>版本号隐藏 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="版本号隐藏" />
<meta property="og:description" content="一般情况下，软件的漏洞信息和特定版本是相关的，因此，软件的版本号对攻击者来说是很有价值的。
在默认情况下，Apache Httpd 系统会把Apache版本模块都显示出来（http返回头信息）。如果列举目录的话，会显示域名信息，服务器版本号，操作系统类型等。
隐藏Apache版本号的方法是修改Apache的配置文件：
vim /etc/httpd/conf/httpd.conf
返回客户端头信息：
[root@ithomer conf]# curl –head 127.0.0.1
HTTP/1.1 200 OK
Date: Thu, 22 Jan 2015 15:39:00 GMT
Server: Apache/2.2.26 (CentOS)
X-Powered-By: PHP/5.5.9
Vary: Cookie,Accept-Encoding,User-Agent
X-Pingback: http://blog.mimvp.com/xmlrpc.php
Cache-Control: max-age=600
Expires: Thu, 22 Jan 2015 15:49:00 GMT
Content-Type: text/html; charset=UTF-8
上面头信息中，会显示服务器类型和版本(Apache/2.2.26)，以及操作系统(CentOS)
修改 ServerTokens
修改 ServerTokens OS 为 ServerTokens productonly
重启 Apache ： /etc/init.d/httpd restart
再次返回头信息如下：
[root@ithomer conf]# curl –head 127.0.0.1
HTTP/1.1 200 OK
Date: Thu, 22 Jan 2015 15:40:53 GMT" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/70e8817ce2e47092bf573ed9817e6b69/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-04-01T14:45:15+08:00" />
<meta property="article:modified_time" content="2019-04-01T14:45:15+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">版本号隐藏</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>一般情况下，软件的漏洞信息和特定版本是相关的，因此，软件的版本号对攻击者来说是很有价值的。</p> 
<p>在默认情况下，Apache Httpd 系统会把Apache版本模块都显示出来（http返回头信息）。如果列举目录的话，会显示域名信息，服务器版本号，操作系统类型等。</p> 
<p>隐藏Apache版本号的方法是修改Apache的配置文件：</p> 
<p><strong>vim /etc/httpd/conf/httpd.conf</strong></p> 
<p> </p> 
<p><strong>返回客户端头信息：</strong></p> 
<p>[root@ithomer conf]# curl –head 127.0.0.1<br> HTTP/1.1 200 OK<br> Date: Thu, 22 Jan 2015 15:39:00 GMT<br><strong>Server: Apache/2.2.26 (CentOS)</strong><br> X-Powered-By: PHP/5.5.9<br> Vary: Cookie,Accept-Encoding,User-Agent<br> X-Pingback: http://blog.mimvp.com/xmlrpc.php<br> Cache-Control: max-age=600<br> Expires: Thu, 22 Jan 2015 15:49:00 GMT<br> Content-Type: text/html; charset=UTF-8</p> 
<p>上面头信息中，会显示服务器类型和版本(<strong>Apache/2.2.26</strong>)，以及操作系统(<strong>CentOS</strong>)</p> 
<p> </p> 
<p><strong>修改 ServerTokens</strong></p> 
<p>修改 <strong>ServerTokens OS</strong> 为 ServerTokens productonly</p> 
<p>重启 Apache ： /etc/init.d/httpd restart</p> 
<p>再次返回头信息如下：</p> 
<p>[root@ithomer conf]# curl –head 127.0.0.1<br> HTTP/1.1 200 OK<br> Date: Thu, 22 Jan 2015 15:40:53 GMT<br><strong>Server: Apache</strong><br> X-Powered-By: PHP/5.5.9<br> Vary: Cookie,Accept-Encoding,User-Agent<br> X-Pingback: http://blog.mimvp.com/xmlrpc.php<br> Cache-Control: max-age=600<br> Expires: Thu, 22 Jan 2015 15:50:53 GMT<br> Content-Type: text/html; charset=UTF-8</p> 
<p> </p> 
<p>同时修改 <strong>ServerTokens</strong><strong> </strong><strong>为</strong><strong> </strong>Prod<strong> </strong>和 <strong>ServerSignature</strong> 为off 返回结果</p> 
<p>[root@ithomer conf]# curl –head 127.0.0.1<br> HTTP/1.1 200 OK<br> Date: Thu, 22 Jan 2015 16:23:07 GMT<br><strong>Server: Apache</strong><br> Vary: Cookie,Accept-Encoding,User-Agent<br> X-Pingback: http://blog.mimvp.com/xmlrpc.php<br> Cache-Control: max-age=600<br> Expires: Thu, 22 Jan 2015 16:33:07 GMT<br> Content-Type: text/html; charset=UTF-8</p> 
<p> </p> 
<p>到这里，我们还可以改变apache的版本，这就要修改apache的源代码了</p> 
<p>在apache的源码包中找到ap_release.h将<br> #define AP_SERVER_BASEPRODUCT “Apache”<br> 修改为<br> #define AP_SERVER_BASEPRODUCT “Microsoft-IIS/5.0”<br> 或者<br> #define AP_SERVER_BASEPRODUCT “Microsoft-IIS/6.0”</p> 
<p>然后找到os/unix下的os.h文件，将其<br> #define PLATFORM “Unix”<br> 修改为<br> #define PLATFORM “Win32“<br> 然后重新编译，安装apache</p> 
<p><br> 最后修改 <strong>vim /etc/httpd/conf/httpd.conf</strong> 配置文件，添加两行<br> ServerTokens Prod               // Prod 同 ProductOnly<br> ServerSignature Off<br> 在发送头请求，头信息就都被偷天换日了<br> 从这点来说，php也是一样，同样可以通过这种方式改变一些系统信息。</p> 
<p>附：</p> 
<p>ServerSignature 三个选项，分别是 On | Off | EMail<br> ServerTokens 的取值如下，其分别隐藏信息依次增加</p> 
<p>ProductOnly  ：  Server: Apache</p> 
<p>Major             ：  Server: Apache/2</p> 
<p>Minor             ：  Server: Apache/2.2</p> 
<p>Minimal         ：  Server: Apache/2.2.26</p> 
<p>OS                 ：  Server: Apache/2.2.26 (CentOS)</p> 
<p>Full                ：  Server: Apache/2.2.26 (CentOS) DAV/2 PHP/5.5.9 SVN/1.6.11 mod_perl/2.0.4 Perl/v5.10.1</p> 
<p>推荐： ServerTokens ProductOnly</p> 
<p> </p> 
<p>下面对php的配置文件php.ini进行配置，默认情况下 expose_php = On</p> 
<p><strong>修改步骤：</strong></p> 
<p><strong>vim /etc/php.ini</strong></p> 
<p>expose_php = On<br> 将其改为<br> expose_php = Off</p> 
<p><strong>重启Apache</strong>： /etc/init.d/httpd restart</p> 
<p><strong>获取头信息：</strong></p> 
<p>[root@ithomer conf]# curl –head 127.0.0.1<br> HTTP/1.1 200 OK<br> Date: Thu, 22 Jan 2015 16:15:48 GMT<br> Server: Apache<br> Vary: Cookie,Accept-Encoding,User-Agent<br> X-Pingback: http://blog.mimvp.com/xmlrpc.php<br> Cache-Control: max-age=600<br> Expires: Thu, 22 Jan 2015 16:25:48 GMT<br> Content-Type: text/html; charset=UTF-8</p> 
<p>发现上面php版本信息（X-Powered-By: PHP/5.5.9）已经隐藏了</p> 
<p> </p> 
<p><strong>附上</strong></p> 
<p><strong>修改Tomcat 服务器名称的头信息</strong></p> 
<p>修改Tomcat配置文件：</p> 
<p>vim /opt/apache-tomcat-7.0.54/conf/server.xml</p> 
<p><strong>添加下面红色一行：</strong></p> 
<p>    &lt;Connector port=”8280″ protocol=”HTTP/1.1″<br>                connectionTimeout=”20000″<br>                redirectPort=”8443″ <br>                server=”MIServer” /&gt;</p> 
<p><strong>查看Tomcat头信息：</strong></p> 
<p>[root@ithomer conf]# curl –head 127.0.0.1:8280<br> HTTP/1.1 200 OK<br> Content-Type: text/html;charset=ISO-8859-1<br> Transfer-Encoding: chunked<br> Date: Thu, 22 Jan 2015 16:30:20 GMT<br><strong>Server: MIServer</strong></p> 
<p>发现上面Tomcat服务器名称已经修改为了 <strong>Server: MIServer</strong></p> 
<p> </p> 
<p><strong>隐藏 Nexus 服务器的头信息</strong></p> 
<p>Nexus 默认运行在Jetty下，并且在头信息中曝露了版本号，如下：<br> [root@ithomer apache-tomcat-7.0.54]# curl –head 127.0.0.1:8081<br> HTTP/1.1 404 Not Found<br> Date: Fri, 23 Jan 2015 01:51:06 GMT<br> Cache-Control: must-revalidate,no-cache,no-store<br> Content-Type: text/html;charset=ISO-8859-1<br> Content-Length: 1267<br><strong>Server: Jetty(8.1.11.v20130520)</strong></p> 
<p> </p> 
<p>由于Ｎexus服务运行在Jetty框架内，因此需要修改Jetty服务配置文件</p> 
<p>修改jetty.xml配置文件 ：</p> 
<p>vim /opt/nexus-2.11.0/nexus-2.11.0-02/conf/jetty.xml</p> 
<p><strong>修改</strong> sendServerVersion 值由 true 为 false（不发送服务器版本信息），如下：</p> 
<p>  &lt;Set name=”stopAtShutdown”&gt;true&lt;/Set&gt;<br>   &lt;Set name=”sendServerVersion”&gt;false&lt;/Set&gt;<br>   &lt;Set name=”sendDateHeader”&gt;true&lt;/Set&gt;<br>   &lt;Set name=”gracefulShutdown”&gt;1000&lt;/Set&gt;</p> 
<p> </p> 
<p><strong>重启Nexus服务:</strong></p> 
<p>/opt/nexus-2.11.0/nexus-2.11.0-02/bin/nexus restart</p> 
<p><strong>查看Nexus头信息：</strong></p> 
<p>[root@ithomer apache-tomcat-7.0.54]# curl –head 127.0.0.1:8081<br> HTTP/1.1 404 Not Found<br> Date: Fri, 23 Jan 2015 02:13:53 GMT<br> Cache-Control: must-revalidate,no-cache,no-store<br> Content-Type: text/html;charset=ISO-8859-1<br> Content-Length: 1267</p> 
<p>修改完重启Nexus后，发现服务器版本信息 <strong>Server: Jetty(8.1.11.v20130520)</strong>，已被隐藏了<br> 原文：http://blog.mimvp.com/2015/02/hide-the-apache-server-version-number-and-system/</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/28bcec2941d8affb3f5322d223bbfd8e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">整合QT、VTK、ITK联合开发的简单Demo</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7d037b543ce5b1ec68da7353d7d41cd5/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">iOS  用内置浏览器Safari 打开网页</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>