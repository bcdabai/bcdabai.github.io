<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>æ‰‹æ‘¸æ‰‹ç³»åˆ—ä¹‹SpringBoot&#43;Vueæ•´åˆsnakeflowå·¥ä½œæµå®æˆ˜ - ç¼–ç¨‹å¤§ç™½çš„åšå®¢</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="æ‰‹æ‘¸æ‰‹ç³»åˆ—ä¹‹SpringBoot&#43;Vueæ•´åˆsnakeflowå·¥ä½œæµå®æˆ˜" />
<meta property="og:description" content="å‰è¨€ æŠ€æœ¯æ ˆï¼š
SpringBoot: 2.3.5.RELEASE
Vue: 2.6.10
snakerflow: 2.5.1
æœ€è¿‘åšé›†å›¢å†…éƒ¨çš„æ‚¦é€šå…³å¹³å°é¡¹ç›®ï¼Œå°è´¦ç®¡ç†çš„ä»˜æ¬¾ç”³è¯·æ¨¡å—éœ€è¦ç”¨åˆ°å·¥ä½œæµå®¡æ‰¹åŠŸèƒ½ï¼Œæœ¬ç€è½»é‡çš„ç›®çš„ï¼Œç‰¹é€‰å®šäº†å›½å†…å¼€å‘è€…å¼€æºçš„ä¸€æ¬¾è½»é‡çº§å·¥ä½œæµå¼•æ“-snakeflowã€‚å®˜ç½‘äº†è§£åˆ°Snakeræ˜¯ä¸€ä¸ªåŸºäºJavaçš„è½»é‡çº§å·¥ä½œæµå¼•æ“ï¼Œé€‚ç”¨äºä¼ä¸šåº”ç”¨ä¸­å¸¸è§çš„ä¸šåŠ¡æµç¨‹ã€‚æœ¬ç€è½»é‡ã€ç®€å•ã€çµå·§ç†å¿µè®¾è®¡ï¼Œå®šä½äºç®€å•é›†æˆã€å¤šç¯å¢ƒæ”¯æŒï¼ŒåŸºäºApache License Version 2.0å¼€æºåè®®å‘å¸ƒã€‚æ–‡æ¡£æŒ‡å—ğŸ‘‰[ç‚¹æˆ‘ç›´è¾¾]
snakeflowæ ¸å¿ƒç®€ä»‹ 7å¼ æ ¸å¿ƒè¡¨å®šä¹‰ï¼š
WF_PROCESSï¼šæµç¨‹å®šä¹‰ï¼Œä¾‹å¦‚è¯·å‡ç”³è¯·ï¼Œç”¨è½¦ç”³è¯·ç­‰æµç¨‹å®šä¹‰ã€‚
WF_ORDERï¼šæµç¨‹å®ä¾‹ï¼Œå½“å‰è¿è¡Œä¸­çš„æµç¨‹å®ä¾‹çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ï¼Œæˆ‘ç”³è¯·äº†ä¸€æ¡è¯·å‡æµç¨‹ï¼Œæµç¨‹ç¼–å·â€œè¯·å‡-001â€ï¼Œè¿™ä¸ªè¯·å‡æµç¨‹â€œè¯·å‡-001â€å°±æ˜¯ä¸€ä¸ªæµç¨‹å®ä¾‹ã€‚
WF_HIST_ORDERï¼šå†å²æµç¨‹å®ä¾‹ï¼Œåªè¦å¯åŠ¨è¿‡çš„æµç¨‹ï¼Œå†å²æµç¨‹å®ä¾‹è¡¨ä¸­å°±ä¼šå­˜å‚¨æµç¨‹çš„å®ä¾‹ä¿¡æ¯ï¼Œæ¯”å¦‚è¿™æ¡æµç¨‹æ˜¯å¦ç»“æŸã€‚
WF_TASKï¼šä»»åŠ¡ï¼ŒæŸä¸ªæµç¨‹ä¸­æŸä¸ªèŠ‚ç‚¹ï¼Œå«åšä»»åŠ¡å®ä¾‹ã€‚æ¯”å¦‚â€œè¯·å‡-001â€ä¸­éœ€è¦ä¸Šçº§å®¡æ‰¹ï¼Œâ€œä¸Šçº§å®¡æ‰¹â€è¿™ä¸ªèŠ‚ç‚¹å°±æ˜¯ä¸€ä¸ªä»»åŠ¡å®ä¾‹ã€‚
WF_HIST_TASKï¼šå†å²ä»»åŠ¡(å°±æ˜¯æ‰§è¡Œå®Œäº†çš„ä»»åŠ¡)ï¼Œæ‰€æœ‰ä»»åŠ¡ç»“æŸä»¥åéƒ½ä¼šåœ¨å†å²ä»»åŠ¡ä¿¡æ¯è¡¨é‡Œå­˜ä¸€æ¡è®°å½•ã€‚
WF_TASK_ACTORï¼šæ¯ä¸ªä»»åŠ¡å¯¹åº”çš„å‚ä¸è€…(è®°ä½è°å¯ä»¥ç­¾æ”¶æˆ–å¤„ç†)ï¼Œå¯èƒ½ä¼šæœ‰å¤šä¸ªäººæˆ–è€…ç”¨æˆ·ç»„ã€‚
WF_HIST_TASK_ACTORï¼šå†å²çš„å‚ä¸è€…è¡¨ï¼Œä»»åŠ¡å¤„ç†å®Œä»¥åï¼Œå¯¹åº”å¤„ç†äººçš„ä¿¡æ¯ä¼šå­˜åˆ°è¿™ä¸ªè¡¨é‡Œé¢ã€‚
å„æ ¸å¿ƒè¡¨åŠæµç¨‹è¯¦è§£:
WF_PROCESSï¼šå­˜æ”¾æµç¨‹å®šä¹‰ï¼Œé€šè¿‡ç¼–è¾‘ä¸€ä¸ªåç¼€ä¸º.snakerçš„xmlæ–‡æ¡£æ¥å®šä¹‰æµç¨‹çš„èµ°å‘ï¼›åœ¨å‰ç«¯æµç¨‹å®šä¹‰ç®¡ç†é‡Œæœ‰ä¸ªéƒ¨ç½²æµç¨‹çš„æŒ‰é’®ï¼Œå¯ä»¥å°†ç¼–è¾‘å¥½çš„xmlæ–‡æ¡£ä¿å­˜åˆ°WF_PROCESSè¡¨ä¸­ï¼Œå¹¶äº§ç”Ÿä¸€æ¡è®°å½•ã€‚xmlæ–‡æ¡£é‡Œæœ‰æµç¨‹çš„åå­—ï¼Œå¦‚æœè¿™ä¸ªåå­—åœ¨WF_PROCESSå·²ç»å­˜åœ¨äº†ï¼Œåˆ™ä¿å­˜æ—¶äº§ç”Ÿçš„æ–°çš„è®°å½•çš„versionå­—æ®µå€¼ä¼šè‡ªåŠ¨åŠ 1ã€‚processIdæ˜¯å”¯ä¸€çš„ï¼Œä¸é‡å¤ã€‚
WF_ORDERï¼šå­˜æ”¾æµç¨‹å®ä¾‹çš„ã€‚å¼€å¯ä¸€ä¸ªæµç¨‹å®ä¾‹æ—¶ï¼ŒWF_ORDERè¡¨æœ‰ä¸ªå­—æ®µPROCESS_IDå’Œæµç¨‹å®šä¹‰çš„process_idç›¸å…³è”ï¼Œä»–ä»¬æ˜¯ä¸€å¯¹å¤šçš„å…³ç³»ã€‚å½“å¼€å¯ä¸€ä¸ªæµç¨‹å®ä¾‹WF_ORDERæ—¶ï¼Œåœ¨WF_ORDERå’ŒWF_HIST_ORDERéƒ½æ–°å¢ä¸€æ¡è®°å½•ï¼Œå¹¶ä¸”åŒæ—¶äº§ç”Ÿçš„é‚£ä¸¤æ¡è®°å½•çš„ä¸»é”®idæ˜¯ä¸€æ ·çš„ã€‚ï¼Œå…¶ä¸­WF_HIST_ORDERæ¯”WF_ORDERå¤šä¸€ä¸ªå­—æ®µORDER_STATUS æµç¨‹å®ä¾‹çŠ¶æ€(0ï¼šç»“æŸï¼›1ï¼šæ´»åŠ¨)ã€‚å½“æµç¨‹æ²¡è·‘å®Œæ—¶ï¼ŒORDER_STATUSçš„å€¼æ˜¯1ï¼›å½“æ•´ä¸ªäº‹ä»¶æµç¨‹è·‘å®Œäº†ï¼ŒWF_ORDERè¡¨çš„é‚£æ¡è®°å½•ä¼šè¢«åˆ é™¤ï¼ŒWF_HIST_ORDERè¡¨å¯¹åº”çš„é‚£æ¡è®°å½•çš„ORDER_STATUSçš„å€¼å˜æˆ0ï¼Œè¡¨ç¤ºæµç¨‹å®ä¾‹è·‘å®Œäº†ã€‚
WF_TASKï¼šå­˜å½“å‰ä»»åŠ¡çš„ï¼›å½“æµç¨‹æ‰§è¡Œå®Œå½“å‰ä»»åŠ¡èŠ‚ç‚¹æ—¶ï¼ŒWF_TASKçš„è¿™æ¡è®°å½•ä¼šè¢«å‰ªåˆ‡åˆ°WF_HIST_TASKè¡¨ä¸­ï¼Œç„¶ååœ¨WF_TASKè¡¨ä¸­æ–°å¢ä¸‹ä¸€ä¸ªä»»åŠ¡èŠ‚ç‚¹çš„ä¿¡æ¯è®°å½•ã€‚æ–°å¢çš„ä¸‹ä¸€ä»»åŠ¡èŠ‚ç‚¹çš„taskæœ‰ä¸ªå­—æ®µparent_task_idè®°ä½ä¸Šä¸€ä¸ªä»»åŠ¡èŠ‚ç‚¹åœ¨WF_HIST_TASKè¡¨é‡Œçš„WF_HIST_TASK_ID(ä¸Šä¸€ä¸ªä»»åŠ¡èŠ‚ç‚¹ä»WF_TASKè¡¨å‰ªåˆ‡åˆ°WF_HIST_TASKäº†)ï¼›è¿™æ ·å°±å¯ä»¥å®ç°å›é€€ç­‰åŠŸèƒ½ã€‚
WF_TASK_ACTORï¼šå­˜å“ªä¸ªä»»åŠ¡å…³è”äº†é‚£äº›å‚ä¸è€…çš„ï¼Œå°±æ˜¯å“ªäº›äººå¯ä»¥ç­¾æ”¶æˆ–è€…å¤„ç†ã€‚å¦‚æœå½“å‰ä»»åŠ¡èŠ‚ç‚¹è¢«æ‰§è¡Œäº†ï¼Œåˆ™ç›¸å…³çš„å‚ä¸è€…ä¼šè¢«å‰ªåˆ‡åˆ°WF_HIST_TASK_ACTORè¡¨é‡Œï¼Œå’ŒWF_TASKã€WF_HIST_TASKç±»ä¼¼ï¼Œè¿™æ ·å›é€€æ—¶ï¼Œå°±çŸ¥é“ä»¥å‰è¿™ä¸€æ­¥æ˜¯è°å¤„ç†çš„ã€‚
å‡å¦‚ç°åœ¨æ‰§è¡ŒèŠ‚ç‚¹çš„ä»»åŠ¡æ˜¯A2ï¼Œä¸Šè¿°ä¸­wf_taskå­˜çš„æ˜¯æ‰§è¡Œä¸­çš„è®°å½•ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨æ‰§è¡ŒA2å‰ï¼Œwf_taskä¸­è‚¯å®šä¼šæœ‰ä¸€æ¡æ‰§è¡Œä¸­çš„ä»»åŠ¡è®°å½•ï¼Œå‡è®¾ä¸ºA1ï¼Œé‚£ä¹ˆæ‰§è¡ŒA2æ—¶çš„å¢åˆ æ”¹ä¸ºå…ˆå°†wf_taskå’Œwf_task_actorè¡¨ä¸­A1çš„è®°å½•æ’å…¥wf_hist_taskå’Œwf_hist_task_actorä¸­ï¼›å…¶æ¬¡æ˜¯åˆ é™¤wf_taskå’Œwf_task_actorä¸­A1è®°å½•ï¼Œç„¶åå°†A2çš„ä¿¡æ¯æ’å…¥åˆ°wf_taskå’Œwf_task_actorä¸­ã€‚æ­¤æ—¶wf_taskè¡¨çš„parent_task_idæ˜¯å†å²è¡¨A1è®°å½•çš„Idï¼Œé€šè¿‡æ­¤å¯å°†æ‰€æœ‰ä»»åŠ¡ä¸²è”èµ·æ¥ã€‚taskè¡¨çš„variableä¸­çš„å€¼ä¸ºå±€éƒ¨å˜é‡åªèƒ½åœ¨å½“å‰taskä¸­ä½¿ç”¨ã€‚æœ‰äººä¼šæœ‰ç–‘é—®ï¼Œå‡è®¾æœ‰å¦‚ä¸‹æµç¨‹å›¾ï¼Œæ‰§è¡Œtask1æ—¶ä¼šæ€ä¹ˆæ ·ï¼Ÿ
å› ä¸ºå¼€å§‹èŠ‚ç‚¹æ˜¯ä¸€ä¸ªæ¯”è¾ƒç‰¹æ®Šçš„nodemodelï¼Œç§°ä¹‹ä¸ºæµè½¬é€»è¾‘å…ƒç´ ï¼Œå®ƒåªè´Ÿè´£æµè½¬åˆ°ä¸‹ä¸€èŠ‚ç‚¹ä¸è´Ÿè´£æ‰§è¡Œï¼Œä¹Ÿå°±æ²¡æœ‰æ•°æ®åº“çš„å¢åˆ æ”¹ã€‚è¿™æ ·ç›´æ¥æµè½¬åˆ°task1ï¼Œæ’å…¥wf_hist_taskå’Œwf_hist_task_actorï¼Œå¹¶ä¸”åˆç›´æ¥æµè½¬åˆ°endèŠ‚ç‚¹ï¼ŒendèŠ‚ç‚¹ä¹Ÿæ˜¯ä¸€ä¸ªæµè½¬å…ƒç´ ï¼Œå®ƒä¼šç›´æ¥åˆ é™¤wf_orderè¡¨çš„è®°å½•å¹¶æ›´æ”¹è¯¥æµç¨‹å®ä¾‹wf_hist_orderè¡¨çš„order_stateçš„çŠ¶æ€ã€‚
è‡³æ­¤ä¸€ä¸ªæµç¨‹çš„æ‰€æœ‰å¢åˆ æ”¹æŸ¥ç»“æŸã€‚
é¡¹ç›®æ•´åˆ pomå¼•å…¥snakeflowä¾èµ– &lt;dependency&gt; &lt;groupId&gt;com.github.snakerflow&lt;/groupId&gt; &lt;artifactId&gt;snaker-spring&lt;/artifactId&gt; &lt;version&gt;2.5.1&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.github.snakerflow&lt;/groupId&gt; &lt;artifactId&gt;snaker-mybatis&lt;/artifactId&gt; &lt;version&gt;2.4.0&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.github.snakerflow&lt;/groupId&gt; &lt;artifactId&gt;snaker-core&lt;/artifactId&gt; &lt;version&gt;2.5.1&lt;/version&gt; &lt;/dependency&gt; æ ¹æ®ä¸šåŠ¡è®¾è®¡æµç¨‹å®šä¹‰ å®˜æ–¹çš„æµç¨‹è®¾è®¡å™¨æ¯”è¾ƒè€æ—§æ¯”è¾ƒä¸‘ï¼Œæ¨èä¸€ä¸ªç¬¬ä¸‰æ–¹å›¾å½¢åŒ–çš„æµç¨‹è®¾è®¡å™¨ï¼šæ¨¡å‹è®¾è®¡ - mldongå¿«é€Ÿå¼€å‘å¹³å°
ç•Œé¢å¦‚ä¸Šå›¾ï¼Œæ ¹æ®è‡ªå·±çš„ä¸šåŠ¡éœ€æ±‚ï¼Œè®¾è®¡å‡ºç›¸åº”çš„æµç¨‹å›¾ï¼Œç„¶åç‚¹å‡»æŸ¥çœ‹æŒ‰é’®å¯¼å‡ºxmlä»£ç ï¼š
åœ¨é¡¹ç›®çš„resourcesç›®å½•ä¸‹æ–°å»º.snakeråç¼€çš„æµç¨‹å®šä¹‰æ–‡ä»¶ï¼Œå°†xmlä»£ç å¤åˆ¶è¿›å»ï¼Œæ­¤æ–‡ä»¶å³ä¸ºæµç¨‹å®šä¹‰æ¨¡å‹æ–‡ä»¶ï¼Œå·¥ä½œæµå¼•æ“ä¼šè‡ªåŠ¨ç”Ÿæˆå¯¹åº”çš„æµç¨‹å®šä¹‰æ¨¡å‹ã€‚
å…·ä½“xmlä»£ç ï¼š
&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; standalone=&#34;no&#34;?&gt; &lt;process name=&#34;payreq&#34; displayName=&#34;ä»˜æ¬¾ç”³è¯·æµç¨‹&#34; instanceUrl=&#34;/snaker/flow/all&#34;&gt; &lt;start name=&#34;start&#34; displayName=&#34;å¼€å§‹&#34; layout=&#34;780,-180,120,80&#34;&gt; &lt;transition name=&#34;b288a53d-e54e-473d-8ed1-fc4fa21f0210&#34; to=&#34;apply&#34; g=&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/cff7c1aa31c6ad8da884ca515d927295/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-08-01T16:39:29+08:00" />
<meta property="article:modified_time" content="2022-08-01T16:39:29+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="ç¼–ç¨‹å¤§ç™½çš„åšå®¢" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">ç¼–ç¨‹å¤§ç™½çš„åšå®¢</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">æ‰‹æ‘¸æ‰‹ç³»åˆ—ä¹‹SpringBoot&#43;Vueæ•´åˆsnakeflowå·¥ä½œæµå®æˆ˜</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atelier-sulphurpool-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h5><a id="_0"></a>å‰è¨€</h5> 
<blockquote> 
 <p>æŠ€æœ¯æ ˆï¼š<br> SpringBoot: 2.3.5.RELEASE<br> Vue: 2.6.10<br> snakerflow: 2.5.1</p> 
</blockquote> 
<p>æœ€è¿‘åšé›†å›¢å†…éƒ¨çš„æ‚¦é€šå…³å¹³å°é¡¹ç›®ï¼Œå°è´¦ç®¡ç†çš„ä»˜æ¬¾ç”³è¯·æ¨¡å—éœ€è¦ç”¨åˆ°å·¥ä½œæµå®¡æ‰¹åŠŸèƒ½ï¼Œæœ¬ç€è½»é‡çš„ç›®çš„ï¼Œç‰¹é€‰å®šäº†å›½å†…å¼€å‘è€…å¼€æºçš„ä¸€æ¬¾è½»é‡çº§å·¥ä½œæµå¼•æ“-snakeflowã€‚å®˜ç½‘äº†è§£åˆ°Snakeræ˜¯ä¸€ä¸ªåŸºäºJavaçš„è½»é‡çº§å·¥ä½œæµå¼•æ“ï¼Œé€‚ç”¨äºä¼ä¸šåº”ç”¨ä¸­å¸¸è§çš„ä¸šåŠ¡æµç¨‹ã€‚æœ¬ç€è½»é‡ã€ç®€å•ã€çµå·§ç†å¿µè®¾è®¡ï¼Œå®šä½äºç®€å•é›†æˆã€å¤šç¯å¢ƒæ”¯æŒï¼ŒåŸºäºApache License Version 2.0å¼€æºåè®®å‘å¸ƒã€‚æ–‡æ¡£æŒ‡å—ğŸ‘‰[<a href="https://yunmel.gitbooks.io/snakerflow/content/" rel="nofollow" title="ç‚¹æˆ‘ç›´è¾¾">ç‚¹æˆ‘ç›´è¾¾</a>]</p> 
<h4><a id="snakeflow_9"></a>snakeflowæ ¸å¿ƒç®€ä»‹</h4> 
<ol><li> <p><strong>7å¼ æ ¸å¿ƒè¡¨å®šä¹‰</strong>ï¼š</p> 
  <ul><li> <p><code>WF_PROCESS</code>ï¼šæµç¨‹å®šä¹‰ï¼Œä¾‹å¦‚è¯·å‡ç”³è¯·ï¼Œç”¨è½¦ç”³è¯·ç­‰æµç¨‹å®šä¹‰ã€‚</p> </li><li> <p><code>WF_ORDER</code>ï¼šæµç¨‹å®ä¾‹ï¼Œå½“å‰è¿è¡Œä¸­çš„æµç¨‹å®ä¾‹çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ï¼Œæˆ‘ç”³è¯·äº†ä¸€æ¡è¯·å‡æµç¨‹ï¼Œæµç¨‹ç¼–å·â€œè¯·å‡-001â€ï¼Œè¿™ä¸ªè¯·å‡æµç¨‹â€œè¯·å‡-001â€å°±æ˜¯ä¸€ä¸ªæµç¨‹å®ä¾‹ã€‚</p> </li><li> <p><code>WF_HIST_ORDER</code>ï¼šå†å²æµç¨‹å®ä¾‹ï¼Œåªè¦å¯åŠ¨è¿‡çš„æµç¨‹ï¼Œå†å²æµç¨‹å®ä¾‹è¡¨ä¸­å°±ä¼šå­˜å‚¨æµç¨‹çš„å®ä¾‹ä¿¡æ¯ï¼Œæ¯”å¦‚è¿™æ¡æµç¨‹æ˜¯å¦ç»“æŸã€‚</p> </li><li> <p><code>WF_TASK</code>ï¼šä»»åŠ¡ï¼ŒæŸä¸ªæµç¨‹ä¸­æŸä¸ªèŠ‚ç‚¹ï¼Œå«åšä»»åŠ¡å®ä¾‹ã€‚æ¯”å¦‚â€œè¯·å‡-001â€ä¸­éœ€è¦ä¸Šçº§å®¡æ‰¹ï¼Œâ€œä¸Šçº§å®¡æ‰¹â€è¿™ä¸ªèŠ‚ç‚¹å°±æ˜¯ä¸€ä¸ªä»»åŠ¡å®ä¾‹ã€‚</p> </li><li> <p><code>WF_HIST_TASK</code>ï¼šå†å²ä»»åŠ¡(å°±æ˜¯æ‰§è¡Œå®Œäº†çš„ä»»åŠ¡)ï¼Œæ‰€æœ‰ä»»åŠ¡ç»“æŸä»¥åéƒ½ä¼šåœ¨å†å²ä»»åŠ¡ä¿¡æ¯è¡¨é‡Œå­˜ä¸€æ¡è®°å½•ã€‚</p> </li><li> <p><code>WF_TASK_ACTOR</code>ï¼šæ¯ä¸ªä»»åŠ¡å¯¹åº”çš„å‚ä¸è€…(è®°ä½è°å¯ä»¥ç­¾æ”¶æˆ–å¤„ç†)ï¼Œå¯èƒ½ä¼šæœ‰å¤šä¸ªäººæˆ–è€…ç”¨æˆ·ç»„ã€‚</p> </li><li> <p><code>WF_HIST_TASK_ACTOR</code>ï¼šå†å²çš„å‚ä¸è€…è¡¨ï¼Œä»»åŠ¡å¤„ç†å®Œä»¥åï¼Œå¯¹åº”å¤„ç†äººçš„ä¿¡æ¯ä¼šå­˜åˆ°è¿™ä¸ªè¡¨é‡Œé¢ã€‚</p> </li></ul> </li><li> <p><strong>å„æ ¸å¿ƒè¡¨åŠæµç¨‹è¯¦è§£:</strong></p> <p><code>WF_PROCESS</code>ï¼šå­˜æ”¾æµç¨‹å®šä¹‰ï¼Œé€šè¿‡ç¼–è¾‘ä¸€ä¸ªåç¼€ä¸º.snakerçš„xmlæ–‡æ¡£æ¥å®šä¹‰æµç¨‹çš„èµ°å‘ï¼›åœ¨å‰ç«¯æµç¨‹å®šä¹‰ç®¡ç†é‡Œæœ‰ä¸ªéƒ¨ç½²æµç¨‹çš„æŒ‰é’®ï¼Œå¯ä»¥å°†ç¼–è¾‘å¥½çš„xmlæ–‡æ¡£ä¿å­˜åˆ°WF_PROCESSè¡¨ä¸­ï¼Œå¹¶äº§ç”Ÿä¸€æ¡è®°å½•ã€‚xmlæ–‡æ¡£é‡Œæœ‰æµç¨‹çš„åå­—ï¼Œå¦‚æœè¿™ä¸ªåå­—åœ¨WF_PROCESSå·²ç»å­˜åœ¨äº†ï¼Œåˆ™ä¿å­˜æ—¶äº§ç”Ÿçš„æ–°çš„è®°å½•çš„versionå­—æ®µå€¼ä¼šè‡ªåŠ¨åŠ 1ã€‚processIdæ˜¯å”¯ä¸€çš„ï¼Œä¸é‡å¤ã€‚</p> <p><code>WF_ORDER</code>ï¼šå­˜æ”¾æµç¨‹å®ä¾‹çš„ã€‚å¼€å¯ä¸€ä¸ªæµç¨‹å®ä¾‹æ—¶ï¼ŒWF_ORDERè¡¨æœ‰ä¸ªå­—æ®µPROCESS_IDå’Œæµç¨‹å®šä¹‰çš„process_idç›¸å…³è”ï¼Œä»–ä»¬æ˜¯ä¸€å¯¹å¤šçš„å…³ç³»ã€‚å½“å¼€å¯ä¸€ä¸ªæµç¨‹å®ä¾‹WF_ORDERæ—¶ï¼Œåœ¨WF_ORDERå’ŒWF_HIST_ORDERéƒ½æ–°å¢ä¸€æ¡è®°å½•ï¼Œå¹¶ä¸”åŒæ—¶äº§ç”Ÿçš„é‚£ä¸¤æ¡è®°å½•çš„ä¸»é”®idæ˜¯ä¸€æ ·çš„ã€‚ï¼Œå…¶ä¸­WF_HIST_ORDERæ¯”WF_ORDERå¤šä¸€ä¸ªå­—æ®µORDER_STATUS æµç¨‹å®ä¾‹çŠ¶æ€(0ï¼šç»“æŸï¼›1ï¼šæ´»åŠ¨)ã€‚å½“æµç¨‹æ²¡è·‘å®Œæ—¶ï¼ŒORDER_STATUSçš„å€¼æ˜¯1ï¼›å½“æ•´ä¸ªäº‹ä»¶æµç¨‹è·‘å®Œäº†ï¼ŒWF_ORDERè¡¨çš„é‚£æ¡è®°å½•ä¼šè¢«åˆ é™¤ï¼ŒWF_HIST_ORDERè¡¨å¯¹åº”çš„é‚£æ¡è®°å½•çš„ORDER_STATUSçš„å€¼å˜æˆ0ï¼Œè¡¨ç¤ºæµç¨‹å®ä¾‹è·‘å®Œäº†ã€‚</p> <p><code>WF_TASK</code>ï¼šå­˜å½“å‰ä»»åŠ¡çš„ï¼›å½“æµç¨‹æ‰§è¡Œå®Œå½“å‰ä»»åŠ¡èŠ‚ç‚¹æ—¶ï¼ŒWF_TASKçš„è¿™æ¡è®°å½•ä¼šè¢«å‰ªåˆ‡åˆ°WF_HIST_TASKè¡¨ä¸­ï¼Œç„¶ååœ¨WF_TASKè¡¨ä¸­æ–°å¢ä¸‹ä¸€ä¸ªä»»åŠ¡èŠ‚ç‚¹çš„ä¿¡æ¯è®°å½•ã€‚æ–°å¢çš„ä¸‹ä¸€ä»»åŠ¡èŠ‚ç‚¹çš„taskæœ‰ä¸ªå­—æ®µparent_task_idè®°ä½ä¸Šä¸€ä¸ªä»»åŠ¡èŠ‚ç‚¹åœ¨WF_HIST_TASKè¡¨é‡Œçš„WF_HIST_TASK_ID(ä¸Šä¸€ä¸ªä»»åŠ¡èŠ‚ç‚¹ä»WF_TASKè¡¨å‰ªåˆ‡åˆ°WF_HIST_TASKäº†)ï¼›è¿™æ ·å°±å¯ä»¥å®ç°å›é€€ç­‰åŠŸèƒ½ã€‚</p> <p><code>WF_TASK_ACTOR</code>ï¼šå­˜å“ªä¸ªä»»åŠ¡å…³è”äº†é‚£äº›å‚ä¸è€…çš„ï¼Œå°±æ˜¯å“ªäº›äººå¯ä»¥ç­¾æ”¶æˆ–è€…å¤„ç†ã€‚å¦‚æœå½“å‰ä»»åŠ¡èŠ‚ç‚¹è¢«æ‰§è¡Œäº†ï¼Œåˆ™ç›¸å…³çš„å‚ä¸è€…ä¼šè¢«å‰ªåˆ‡åˆ°WF_HIST_TASK_ACTORè¡¨é‡Œï¼Œå’ŒWF_TASKã€WF_HIST_TASKç±»ä¼¼ï¼Œè¿™æ ·å›é€€æ—¶ï¼Œå°±çŸ¥é“ä»¥å‰è¿™ä¸€æ­¥æ˜¯è°å¤„ç†çš„ã€‚</p> <p>å‡å¦‚ç°åœ¨æ‰§è¡ŒèŠ‚ç‚¹çš„ä»»åŠ¡æ˜¯A2ï¼Œä¸Šè¿°ä¸­wf_taskå­˜çš„æ˜¯æ‰§è¡Œä¸­çš„è®°å½•ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨æ‰§è¡ŒA2å‰ï¼Œwf_taskä¸­è‚¯å®šä¼šæœ‰ä¸€æ¡æ‰§è¡Œä¸­çš„ä»»åŠ¡è®°å½•ï¼Œå‡è®¾ä¸ºA1ï¼Œé‚£ä¹ˆæ‰§è¡ŒA2æ—¶çš„å¢åˆ æ”¹ä¸ºå…ˆå°†wf_taskå’Œwf_task_actorè¡¨ä¸­A1çš„è®°å½•æ’å…¥wf_hist_taskå’Œwf_hist_task_actorä¸­ï¼›å…¶æ¬¡æ˜¯åˆ é™¤wf_taskå’Œwf_task_actorä¸­A1è®°å½•ï¼Œç„¶åå°†A2çš„ä¿¡æ¯æ’å…¥åˆ°wf_taskå’Œwf_task_actorä¸­ã€‚æ­¤æ—¶wf_taskè¡¨çš„parent_task_idæ˜¯å†å²è¡¨A1è®°å½•çš„Idï¼Œé€šè¿‡æ­¤å¯å°†æ‰€æœ‰ä»»åŠ¡ä¸²è”èµ·æ¥ã€‚taskè¡¨çš„variableä¸­çš„å€¼ä¸ºå±€éƒ¨å˜é‡åªèƒ½åœ¨å½“å‰taskä¸­ä½¿ç”¨ã€‚æœ‰äººä¼šæœ‰ç–‘é—®ï¼Œå‡è®¾æœ‰å¦‚ä¸‹æµç¨‹å›¾ï¼Œæ‰§è¡Œtask1æ—¶ä¼šæ€ä¹ˆæ ·ï¼Ÿ</p> <p>å› ä¸ºå¼€å§‹èŠ‚ç‚¹æ˜¯ä¸€ä¸ªæ¯”è¾ƒç‰¹æ®Šçš„nodemodelï¼Œç§°ä¹‹ä¸ºæµè½¬é€»è¾‘å…ƒç´ ï¼Œå®ƒåªè´Ÿè´£æµè½¬åˆ°ä¸‹ä¸€èŠ‚ç‚¹ä¸è´Ÿè´£æ‰§è¡Œï¼Œä¹Ÿå°±æ²¡æœ‰æ•°æ®åº“çš„å¢åˆ æ”¹ã€‚è¿™æ ·ç›´æ¥æµè½¬åˆ°task1ï¼Œæ’å…¥wf_hist_taskå’Œwf_hist_task_actorï¼Œå¹¶ä¸”åˆç›´æ¥æµè½¬åˆ°endèŠ‚ç‚¹ï¼ŒendèŠ‚ç‚¹ä¹Ÿæ˜¯ä¸€ä¸ªæµè½¬å…ƒç´ ï¼Œå®ƒä¼šç›´æ¥åˆ é™¤wf_orderè¡¨çš„è®°å½•å¹¶æ›´æ”¹è¯¥æµç¨‹å®ä¾‹wf_hist_orderè¡¨çš„order_stateçš„çŠ¶æ€ã€‚</p> <p>è‡³æ­¤ä¸€ä¸ªæµç¨‹çš„æ‰€æœ‰å¢åˆ æ”¹æŸ¥ç»“æŸã€‚</p> </li></ol> 
<h4><a id="_43"></a>é¡¹ç›®æ•´åˆ</h4> 
<h5><a id="pomsnakeflow_45"></a>pomå¼•å…¥snakeflowä¾èµ–</h5> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.github.snakerflow<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>snaker-spring<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.5.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.github.snakerflow<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>snaker-mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.4.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.github.snakerflow<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>snaker-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.5.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h5><a id="_65"></a>æ ¹æ®ä¸šåŠ¡è®¾è®¡æµç¨‹å®šä¹‰</h5> 
<p>å®˜æ–¹çš„æµç¨‹è®¾è®¡å™¨æ¯”è¾ƒè€æ—§æ¯”è¾ƒä¸‘ï¼Œæ¨èä¸€ä¸ªç¬¬ä¸‰æ–¹å›¾å½¢åŒ–çš„æµç¨‹è®¾è®¡å™¨ï¼š<a href="https://vueadmin.mldong.com/wf/modelDesigner/index" rel="nofollow" title="æ¨¡å‹è®¾è®¡ - mldongå¿«é€Ÿå¼€å‘å¹³å°">æ¨¡å‹è®¾è®¡ - mldongå¿«é€Ÿå¼€å‘å¹³å°</a></p> 
<p><img src="https://images2.imgbox.com/5a/49/4AQcHgnE_o.png" alt="è¯·æ·»åŠ å›¾ç‰‡æè¿°"></p> 
<p>ç•Œé¢å¦‚ä¸Šå›¾ï¼Œæ ¹æ®è‡ªå·±çš„ä¸šåŠ¡éœ€æ±‚ï¼Œè®¾è®¡å‡ºç›¸åº”çš„æµç¨‹å›¾ï¼Œç„¶åç‚¹å‡»<strong>æŸ¥çœ‹</strong>æŒ‰é’®å¯¼å‡ºxmlä»£ç ï¼š</p> 
<p><img src="https://images2.imgbox.com/b6/98/Z5929jMC_o.png" alt="è¯·æ·»åŠ å›¾ç‰‡æè¿°"></p> 
<p>åœ¨é¡¹ç›®çš„resourcesç›®å½•ä¸‹æ–°å»º.snakeråç¼€çš„æµç¨‹å®šä¹‰æ–‡ä»¶ï¼Œå°†xmlä»£ç å¤åˆ¶è¿›å»ï¼Œæ­¤æ–‡ä»¶å³ä¸ºæµç¨‹å®šä¹‰æ¨¡å‹æ–‡ä»¶ï¼Œå·¥ä½œæµå¼•æ“ä¼šè‡ªåŠ¨ç”Ÿæˆå¯¹åº”çš„æµç¨‹å®šä¹‰æ¨¡å‹ã€‚</p> 
<p><img src="https://images2.imgbox.com/97/43/ue5nbU7x_o.png" alt="è¯·æ·»åŠ å›¾ç‰‡æè¿°"></p> 
<p>å…·ä½“xmlä»£ç ï¼š</p> 
<pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>process</span>  <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>payreq<span class="token punctuation">"</span></span> <span class="token attr-name">displayName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ä»˜æ¬¾ç”³è¯·æµç¨‹<span class="token punctuation">"</span></span> <span class="token attr-name">instanceUrl</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/snaker/flow/all<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>start</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>start<span class="token punctuation">"</span></span> <span class="token attr-name">displayName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>å¼€å§‹<span class="token punctuation">"</span></span> <span class="token attr-name">layout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>780,-180,120,80<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>b288a53d-e54e-473d-8ed1-fc4fa21f0210<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>apply<span class="token punctuation">"</span></span> <span class="token attr-name">g</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>780,-162;780,-132;780,-132;780,-130;780,-130;780,-100<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>start</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>task</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>apply<span class="token punctuation">"</span></span> <span class="token attr-name">displayName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ä»˜æ¬¾ç”³è¯·<span class="token punctuation">"</span></span> <span class="token attr-name">layout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>780,-60,120,80<span class="token punctuation">"</span></span> <span class="token attr-name">assignee</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>apply.operator<span class="token punctuation">"</span></span> <span class="token attr-name">performType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ANY<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0796e532-f9fd-414d-81a8-04415bae48f2<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>gbmjl<span class="token punctuation">"</span></span> <span class="token attr-name">g</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>780,-20;780,10;780,10;780,-10;780,-10;780,20<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>task</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>task</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>gbmjl<span class="token punctuation">"</span></span> <span class="token attr-name">displayName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>å„éƒ¨é—¨ç»ç†<span class="token punctuation">"</span></span> <span class="token attr-name">layout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>780,60,120,80<span class="token punctuation">"</span></span> <span class="token attr-name">assignmentHandler</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.yorma.flow.handle.GBMJLHandler<span class="token punctuation">"</span></span> <span class="token attr-name">performType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ANY<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>de03eafd-5a16-41d1-94b1-eb72864be456<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>30e3c5fe-aa7d-4cdf-98e5-85613d61e2c1<span class="token punctuation">"</span></span> <span class="token attr-name">g</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>780,100;780,130;780,130;780,125;780,125;780,155<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>task</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>decision</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>30e3c5fe-aa7d-4cdf-98e5-85613d61e2c1<span class="token punctuation">"</span></span> <span class="token attr-name">layout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>780,180,120,80<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>59bdf184-7a83-4bcd-9ad8-19ce53d47f2c<span class="token punctuation">"</span></span> <span class="token attr-name">displayName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ä»£å«å·²æ”¶æ¬¾<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cwjl<span class="token punctuation">"</span></span> <span class="token attr-name">expr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#isddysk == 1<span class="token punctuation">"</span></span> <span class="token attr-name">g</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>805,180;1090,180;1090,700;840,700<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>70239222-b35d-46ef-a8f8-c4e62c27a46e<span class="token punctuation">"</span></span> <span class="token attr-name">displayName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>éä»£å«å·²æ”¶æ¬¾<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>fgbmld<span class="token punctuation">"</span></span> <span class="token attr-name">expr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#isddysk == 0<span class="token punctuation">"</span></span> <span class="token attr-name">g</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>780,205;780,235;780,235;780,250;780,250;780,280<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>decision</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>task</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cwjl<span class="token punctuation">"</span></span> <span class="token attr-name">displayName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>è´¢åŠ¡ç»ç†<span class="token punctuation">"</span></span> <span class="token attr-name">layout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>780,700,120,80<span class="token punctuation">"</span></span> <span class="token attr-name">assignee</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cwjl.operator<span class="token punctuation">"</span></span> <span class="token attr-name">performType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ANY<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cd789408-b162-4918-9a5b-62f91c6fa266<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cnfk<span class="token punctuation">"</span></span> <span class="token attr-name">g</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>780,740;780,800<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>task</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>task</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cnfk<span class="token punctuation">"</span></span> <span class="token attr-name">displayName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>å‡ºçº³ä»˜æ¬¾<span class="token punctuation">"</span></span> <span class="token attr-name">layout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>780,840,120,80<span class="token punctuation">"</span></span> <span class="token attr-name">assignee</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cnfk.operator<span class="token punctuation">"</span></span> <span class="token attr-name">performType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ANY<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>e2d934c5-a656-4870-a984-3874cfc24d0e<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1cb24741-9c96-4624-a9b9-311b4327b007<span class="token punctuation">"</span></span> <span class="token attr-name">g</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>780,880;780,962<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>task</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>end</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1cb24741-9c96-4624-a9b9-311b4327b007<span class="token punctuation">"</span></span> <span class="token attr-name">displayName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ç»“æŸ<span class="token punctuation">"</span></span> <span class="token attr-name">layout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>780,980,120,80<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>end</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>task</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>fgbmld<span class="token punctuation">"</span></span> <span class="token attr-name">displayName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>åˆ†ç®¡éƒ¨é—¨é¢†å¯¼<span class="token punctuation">"</span></span> <span class="token attr-name">layout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>780,320,120,80<span class="token punctuation">"</span></span> <span class="token attr-name">assignee</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>fgbmld.operator<span class="token punctuation">"</span></span> <span class="token attr-name">performType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ANY<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1eec0e66-d27c-4968-a1bc-0af8369faad0<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>8d46ec89-91d2-4ab3-b4e0-03d603beb2a1<span class="token punctuation">"</span></span> <span class="token attr-name">g</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>780,360;780,390;780,390;780,365;780,365;780,395<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>task</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>decision</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>8d46ec89-91d2-4ab3-b4e0-03d603beb2a1<span class="token punctuation">"</span></span> <span class="token attr-name">layout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>780,420,120,80<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>b4210332-ea95-4b5c-9a4f-9b7efa71fab1<span class="token punctuation">"</span></span> <span class="token attr-name">displayName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ä»£å«æœªæ”¶æ¬¾<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>3a5427a1-fd3b-4638-9f3e-cf0960b30a76<span class="token punctuation">"</span></span> <span class="token attr-name">expr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#moneyType == 3<span class="token punctuation">"</span></span> <span class="token attr-name">g</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>805,420;980,420;980,535<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cd19027f-df5e-4c88-bc22-f3645fd4774e<span class="token punctuation">"</span></span> <span class="token attr-name">displayName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ä¸šåŠ¡æ¬¾é¡¹<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0715456f-f696-4d28-b4fc-ae1380349278<span class="token punctuation">"</span></span> <span class="token attr-name">expr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#moneyType == 1<span class="token punctuation">"</span></span> <span class="token attr-name">g</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>755,420;300,420;300,535<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>decision</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>decision</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>3a5427a1-fd3b-4638-9f3e-cf0960b30a76<span class="token punctuation">"</span></span> <span class="token attr-name">layout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>980,560,120,80<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>e24c7368-b555-4ff5-af2b-eabc8e4e3f0d<span class="token punctuation">"</span></span> <span class="token attr-name">displayName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>5Wä»¥ä¸Š<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>zjldsz<span class="token punctuation">"</span></span> <span class="token attr-name">expr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#wskMoney <span class="token entity named-entity" title="&gt;">&amp;gt;</span>= 50000<span class="token punctuation">"</span></span> <span class="token attr-name">g</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>955,560;840,560<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>5cf86118-b12e-4378-8b55-987ad6310ea7<span class="token punctuation">"</span></span> <span class="token attr-name">displayName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>5Wä»¥ä¸‹<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cwjl<span class="token punctuation">"</span></span> <span class="token attr-name">expr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#wskMoney <span class="token entity named-entity" title="&lt;">&amp;lt;</span> 50000<span class="token punctuation">"</span></span> <span class="token attr-name">g</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>980,585;980,700;840,700<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>decision</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>task</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>zjldsz<span class="token punctuation">"</span></span> <span class="token attr-name">displayName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>æ€»ç»ç†è‘£äº‹é•¿<span class="token punctuation">"</span></span> <span class="token attr-name">layout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>780,560,120,80<span class="token punctuation">"</span></span> <span class="token attr-name">assignee</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>zjldsz.operator<span class="token punctuation">"</span></span> <span class="token attr-name">performType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ANY<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>f30af5a8-f9f0-4fe8-acb3-6f7f0b46e219<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cwjl<span class="token punctuation">"</span></span> <span class="token attr-name">g</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>780,600;780,660<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>task</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>decision</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0715456f-f696-4d28-b4fc-ae1380349278<span class="token punctuation">"</span></span> <span class="token attr-name">layout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>300,560,120,80<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cb99aefa-c5da-4492-baef-166b60607851<span class="token punctuation">"</span></span> <span class="token attr-name">displayName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>äººæ°‘å¸<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>c72c188c-6ad3-49f6-abf9-e501fb68e315<span class="token punctuation">"</span></span> <span class="token attr-name">expr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#currtype == 1<span class="token punctuation">"</span></span> <span class="token attr-name">g</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>325,560;475,560<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>776eaba1-1ef1-4ef7-982e-67c141e6141a<span class="token punctuation">"</span></span> <span class="token attr-name">displayName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ç¾å…ƒ<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>a32c6d94-d4a2-402e-aa29-f4938c01bdb9<span class="token punctuation">"</span></span> <span class="token attr-name">expr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#currtype == 2<span class="token punctuation">"</span></span> <span class="token attr-name">g</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>300,585;300,780;475,780<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>decision</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>decision</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>c72c188c-6ad3-49f6-abf9-e501fb68e315<span class="token punctuation">"</span></span> <span class="token attr-name">layout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>500,560,120,80<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>99d8103a-f619-4631-a26e-4a9574cc5023<span class="token punctuation">"</span></span> <span class="token attr-name">displayName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>äººæ°‘å¸20Wä»¥ä¸‹<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cwjl<span class="token punctuation">"</span></span> <span class="token attr-name">expr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#ywMoney <span class="token entity named-entity" title="&lt;">&amp;lt;</span> 200000<span class="token punctuation">"</span></span> <span class="token attr-name">g</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>500,585;500,700;720,700<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0bb52a5e-357c-4bd3-a653-4275692f9173<span class="token punctuation">"</span></span> <span class="token attr-name">displayName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>äººæ°‘å¸20Wä»¥ä¸Š<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>zjldsz<span class="token punctuation">"</span></span> <span class="token attr-name">expr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#ywMoney <span class="token entity named-entity" title="&gt;">&amp;gt;</span>= 200000<span class="token punctuation">"</span></span> <span class="token attr-name">g</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>500,535;500,499;780,499;780,520<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>decision</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>decision</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>a32c6d94-d4a2-402e-aa29-f4938c01bdb9<span class="token punctuation">"</span></span> <span class="token attr-name">layout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>500,780,120,80<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>b9850dba-8b59-4c28-97f7-c9f07ebb5515<span class="token punctuation">"</span></span> <span class="token attr-name">displayName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ç¾å…ƒ3Wä»¥ä¸Š<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>zjldsz<span class="token punctuation">"</span></span> <span class="token attr-name">expr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#ywMoney <span class="token entity named-entity" title="&gt;">&amp;gt;</span>= 30000<span class="token punctuation">"</span></span> <span class="token attr-name">g</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>525,780;555,780;555,559;720,559<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>7eb1d054-ae82-4972-921b-aede3a7e27e6<span class="token punctuation">"</span></span> <span class="token attr-name">displayName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ç¾å…ƒ3Wä»¥ä¸‹<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cwjl<span class="token punctuation">"</span></span> <span class="token attr-name">expr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#ywMoney <span class="token entity named-entity" title="&lt;">&amp;lt;</span> 30000<span class="token punctuation">"</span></span> <span class="token attr-name">g</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>500,805;500,835;690,835;690,700;720,700<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>decision</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>process</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>å½“ç„¶ï¼Œæµç¨‹è®¾è®¡å™¨ä¹Ÿæ”¯æŒæ ¹æ®xmlç”Ÿæˆæµç¨‹å›¾ï¼Œæ–¹ä¾¿ä¿®æ”¹æµç¨‹å›¾ï¼Œç‚¹å‡»å¯¼å…¥æŒ‰é’®ç²˜è´´xmlå³å¯ï¼š</p> 
<p><img src="https://images2.imgbox.com/3c/91/XJzQ1D00_o.png" alt="è¯·æ·»åŠ å›¾ç‰‡æè¿°"></p> 
<h4><a id="_141"></a>åˆ›å»ºæµç¨‹å®šä¹‰ï¼ŒåŒæ—¶å¯åŠ¨ä¸€ä¸ªæµç¨‹å®ä¾‹æ‰§è¡Œä»»åŠ¡</h4> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>yorma<span class="token punctuation">.</span>flow<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>extension<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl<span class="token punctuation">.</span></span><span class="token class-name">ServiceImpl</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>yorma<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">YmMsg</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>yorma<span class="token punctuation">.</span>flow<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">WfProcess</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>yorma<span class="token punctuation">.</span>flow<span class="token punctuation">.</span>entity<span class="token punctuation">.</span>dto<span class="token punctuation">.</span></span><span class="token class-name">WfProcessParam</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>yorma<span class="token punctuation">.</span>flow<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">WfProcessMapper</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>yorma<span class="token punctuation">.</span>flow<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">ISysUserService</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>yorma<span class="token punctuation">.</span>flow<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">IWfProcessService</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>yorma<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">RedisUtil</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>yorma<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">RequestKit</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>snaker<span class="token punctuation">.</span>engine<span class="token punctuation">.</span></span><span class="token class-name">SnakerEngine</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>snaker<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>access<span class="token punctuation">.</span></span><span class="token class-name">QueryFilter</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>snaker<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">Order</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>snaker<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">Process</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>snaker<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">Task</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">InputStream</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>core<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ObjectUtil</span><span class="token punctuation">.</span>isEmpty<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>core<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">StrUtil</span><span class="token punctuation">.</span>isBlank<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">com<span class="token punctuation">.</span>yorma<span class="token punctuation">.</span>flow<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span><span class="token class-name">Const</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token comment">/**
 * &lt;p&gt;
 * æµç¨‹å®šä¹‰è¡¨ æœåŠ¡å®ç°ç±»
 * &lt;/p&gt;
 *
 * @author ZHANGCHAO
 * @since 2022-06-22
 */</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WfProcessServiceImpl</span> <span class="token keyword">extends</span> <span class="token class-name">ServiceImpl</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">WfProcessMapper</span><span class="token punctuation">,</span> <span class="token class-name">WfProcess</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">IWfProcessService</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">SnakerEngine</span> engine<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">ISysUserService</span> userService<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RedisUtil</span> redisUtil<span class="token punctuation">;</span>

    <span class="token comment">/**
     * è·å–æˆ–åˆ›å»ºæµç¨‹å®šä¹‰å¹¶å¯åŠ¨æµç¨‹å®ä¾‹æ‰§è¡Œä»»åŠ¡
     *
     * @param processParam
     * @return com.yorma.entity.YmMsg&lt;org.snaker.engine.entity.Process&gt;
     * @apiNote &lt;pre&gt;
     *   è·å–æˆ–åˆ›å»ºæµç¨‹å®šä¹‰å¹¶å¯åŠ¨æµç¨‹å®ä¾‹æ‰§è¡Œä»»åŠ¡
     * &lt;/pre&gt;
     * @author ZHANGCHAO 2022/6/22 16:51
     * @version 1.0
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">YmMsg</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Order</span><span class="token punctuation">&gt;</span></span> <span class="token function">initAndStartProcess</span><span class="token punctuation">(</span><span class="token class-name">WfProcessParam</span> processParam<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isBlank</span><span class="token punctuation">(</span>processParam<span class="token punctuation">.</span><span class="token function">getFlowFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token class-name">YmMsg</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"æœªçŸ¥çš„æµç¨‹å®šä¹‰ï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">String</span> tenantId <span class="token operator">=</span> <span class="token class-name">RequestKit</span><span class="token punctuation">.</span><span class="token function">getRequestIn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span>TENANT_ID<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> token <span class="token operator">=</span> <span class="token class-name">RequestKit</span><span class="token punctuation">.</span><span class="token function">getRequestIn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span>HEADER_TOKEN<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ä»redisè·å–å½“å‰ç™»å½•ç”¨æˆ·å</span>
        <span class="token class-name">String</span> username <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> redisUtil<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>PREFIX_USER_TOKEN_INFO <span class="token operator">+</span> token<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>USERNAME<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> userId <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">getUserId</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> tenantId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> args <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        args<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"apply.operator"</span><span class="token punctuation">,</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Process</span> process<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>processParam<span class="token punctuation">.</span><span class="token function">isNewProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">String</span> deploy <span class="token operator">=</span> <span class="token function">initFlows</span><span class="token punctuation">(</span>processParam<span class="token punctuation">.</span><span class="token function">getFlowFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
            process <span class="token operator">=</span> engine<span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getProcessById</span><span class="token punctuation">(</span>deploy<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">QueryFilter</span> filter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span>processParam<span class="token punctuation">.</span><span class="token function">getFlowFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orderBy</span><span class="token punctuation">(</span><span class="token string">"version"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">order</span><span class="token punctuation">(</span><span class="token string">"DESC"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Process</span><span class="token punctuation">&gt;</span></span> processList <span class="token operator">=</span> engine<span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getProcesss</span><span class="token punctuation">(</span>filter<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>processList<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">String</span> deploy <span class="token operator">=</span> <span class="token function">initFlows</span><span class="token punctuation">(</span>processParam<span class="token punctuation">.</span><span class="token function">getFlowFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
                process <span class="token operator">=</span> engine<span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getProcessById</span><span class="token punctuation">(</span>deploy<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                process <span class="token operator">=</span> processList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>process<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token class-name">YmMsg</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"æœªè·å–åˆ°æµç¨‹å®šä¹‰ï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"[initAndStartProcess]è·å–åˆ°çš„æµç¨‹å®šä¹‰processï¼š"</span> <span class="token operator">+</span> process<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// å¯åŠ¨å®ä¾‹</span>
        <span class="token class-name">Order</span> order <span class="token operator">=</span> engine<span class="token punctuation">.</span><span class="token function">startInstanceById</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> userId<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"[initAndStartProcess]è·å–åˆ°çš„æµç¨‹å®ä¾‹orderï¼š"</span> <span class="token operator">+</span> order<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Task</span><span class="token punctuation">&gt;</span></span> tasks <span class="token operator">=</span> engine<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getActiveTasks</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span>order<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>tasks<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token class-name">YmMsg</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"æµç¨‹å®ä¾‹Order["</span> <span class="token operator">+</span> order<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"]ä¸‹æ— æ´»åŠ¨çš„ä»»åŠ¡åˆ—è¡¨ï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Task</span><span class="token punctuation">&gt;</span></span> newTasks <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>tasks <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> tasks<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">Task</span> task <span class="token operator">=</span> tasks<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            newTasks<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>engine<span class="token punctuation">.</span><span class="token function">executeTask</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> userId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token class-name">YmMsg</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * åˆå§‹åŒ–çŠ¶æ€æœºæµç¨‹
     *
     * @return æµç¨‹ä¸»é”®
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">initFlows</span><span class="token punctuation">(</span><span class="token class-name">String</span> flowFile<span class="token punctuation">,</span> <span class="token class-name">String</span> creator<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">ClassLoader</span> classLoader <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getContextClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">InputStream</span> stream <span class="token operator">=</span> classLoader<span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span><span class="token string">"flows/flowFile.snaker"</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"flowFile"</span><span class="token punctuation">,</span> flowFile<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> engine<span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">deploy</span><span class="token punctuation">(</span>stream<span class="token punctuation">,</span> creator<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>è°ƒç”¨æ­¤æ–¹æ³•åï¼Œä¼šæ ¹æ®ä¼ è¿›æ¥çš„æµç¨‹å®šä¹‰åç§°å»ç”Ÿæˆç›¸åº”çš„æµç¨‹å®šä¹‰å¹¶å¯åŠ¨ä¸€ä¸ªå®ä¾‹ï¼Œè€Œä¸”æ­¤å¤„è®©å…¶è‡ªåŠ¨æ‰§è¡Œäº†ä¸‹ä¸€èŠ‚ç‚¹ï¼Œå› ä¸ºä¸‹ä¸€èŠ‚ç‚¹çš„æ“ä½œäººä¹Ÿæ˜¯æµç¨‹å‘èµ·äººã€‚æ‰§è¡Œå®Œåï¼Œåˆ°è¾¾äº†2èŠ‚ç‚¹ï¼š</p> 
<p><img src="https://images2.imgbox.com/1f/0b/E76sKCpj_o.png" alt="è¯·æ·»åŠ å›¾ç‰‡æè¿°"></p> 
<h4><a id="_269"></a>ä»»åŠ¡æ‰§è¡Œæ–¹æ³•ï¼Œå³èŠ‚ç‚¹çš„ç§»åŠ¨é€»è¾‘</h4> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>yorma<span class="token punctuation">.</span>flow<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>extension<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl<span class="token punctuation">.</span></span><span class="token class-name">ServiceImpl</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>yorma<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">YmMsg</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>yorma<span class="token punctuation">.</span>flow<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">WfTask</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>yorma<span class="token punctuation">.</span>flow<span class="token punctuation">.</span>entity<span class="token punctuation">.</span>dto<span class="token punctuation">.</span></span><span class="token class-name">WfConstants</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>yorma<span class="token punctuation">.</span>flow<span class="token punctuation">.</span>entity<span class="token punctuation">.</span>dto<span class="token punctuation">.</span></span><span class="token class-name">WfTaskParam</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>yorma<span class="token punctuation">.</span>flow<span class="token punctuation">.</span>entity<span class="token punctuation">.</span>dto<span class="token punctuation">.</span></span><span class="token class-name">WfWorkItemParam</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>yorma<span class="token punctuation">.</span>flow<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">WfTaskMapper</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>yorma<span class="token punctuation">.</span>flow<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">ISysUserService</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>yorma<span class="token punctuation">.</span>flow<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">IWfTaskService</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>yorma<span class="token punctuation">.</span>flow<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>exception<span class="token punctuation">.</span></span><span class="token class-name">ExceptionUtil</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>yorma<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">RedisUtil</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>yorma<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">RequestKit</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>snaker<span class="token punctuation">.</span>engine<span class="token punctuation">.</span></span><span class="token class-name">SnakerEngine</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>snaker<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>access<span class="token punctuation">.</span></span><span class="token class-name">Page</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>snaker<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>access<span class="token punctuation">.</span></span><span class="token class-name">QueryFilter</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>snaker<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">Order</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>snaker<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">Task</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>snaker<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">WorkItem</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>snaker<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">EndModel</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>snaker<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">ProcessModel</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>snaker<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">TaskModel</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>core<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ObjectUtil</span><span class="token punctuation">.</span>isEmpty<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>core<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ObjectUtil</span><span class="token punctuation">.</span>isNotEmpty<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>core<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">StrUtil</span><span class="token punctuation">.</span>isNotBlank<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">com<span class="token punctuation">.</span>yorma<span class="token punctuation">.</span>flow<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span><span class="token class-name">Const</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token comment">/**
 * &lt;p&gt;
 * ä»»åŠ¡è¡¨ æœåŠ¡å®ç°ç±»
 * &lt;/p&gt;
 *
 * @author ZHANGCHAO
 * @since 2022-06-24
 */</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WfTaskServiceImpl</span> <span class="token keyword">extends</span> <span class="token class-name">ServiceImpl</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">WfTaskMapper</span><span class="token punctuation">,</span> <span class="token class-name">WfTask</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">IWfTaskService</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">SnakerEngine</span> engine<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">ISysUserService</span> userService<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RedisUtil</span> redisUtil<span class="token punctuation">;</span>

    <span class="token comment">/**
     * æ‰§è¡Œæµç¨‹ä»»åŠ¡task
     *
     * @param taskParam
     * @return com.yorma.entity.YmMsg&lt;java.lang.String&gt;
     * @apiNote &lt;pre&gt;
     *   æ‰§è¡Œæµç¨‹ä»»åŠ¡task
     * &lt;/pre&gt;
     * @author ZHANGCHAO 2022/6/24 14:34
     * @version 1.0
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">YmMsg</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">Task</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">executeTask</span><span class="token punctuation">(</span><span class="token class-name">WfTaskParam</span> taskParam<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>taskParam<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token class-name">YmMsg</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"å‚æ•°[taskParam]ä¸èƒ½ä¸ºç©ºï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Task</span><span class="token punctuation">&gt;</span></span> newTasks<span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">String</span> tenantId <span class="token operator">=</span> <span class="token class-name">RequestKit</span><span class="token punctuation">.</span><span class="token function">getRequestIn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span>TENANT_ID<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> token <span class="token operator">=</span> <span class="token class-name">RequestKit</span><span class="token punctuation">.</span><span class="token function">getRequestIn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span>HEADER_TOKEN<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// ä»redisè·å–å½“å‰ç™»å½•ç”¨æˆ·å</span>
            <span class="token class-name">String</span> username <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> redisUtil<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>PREFIX_USER_TOKEN_INFO <span class="token operator">+</span> token<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>USERNAME<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> userId <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">getUserId</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> tenantId<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// åŒæ„</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>taskParam<span class="token punctuation">.</span><span class="token function">getArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">WfConstants</span><span class="token punctuation">.</span>APPROVAL_TYPE<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token operator">||</span> <span class="token string">"1"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>taskParam<span class="token punctuation">.</span><span class="token function">getArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">WfConstants</span><span class="token punctuation">.</span>APPROVAL_TYPE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isNotBlank</span><span class="token punctuation">(</span>taskParam<span class="token punctuation">.</span><span class="token function">getTaskId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Task</span><span class="token punctuation">&gt;</span></span> tasks <span class="token operator">=</span> engine<span class="token punctuation">.</span><span class="token function">executeTask</span><span class="token punctuation">(</span>taskParam<span class="token punctuation">.</span><span class="token function">getTaskId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> userId<span class="token punctuation">,</span> taskParam<span class="token punctuation">.</span><span class="token function">getArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>tasks<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Task</span> task <span class="token operator">:</span> tasks<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                            task<span class="token punctuation">.</span><span class="token function">setModel</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">return</span> <span class="token class-name">YmMsg</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>tasks<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Task</span><span class="token punctuation">&gt;</span></span> tasks <span class="token operator">=</span> engine<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getActiveTasks</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span>taskParam<span class="token punctuation">.</span><span class="token function">getOrderId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setOperator</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>tasks<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    tasks <span class="token operator">=</span> engine<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getActiveTasks</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span>taskParam<span class="token punctuation">.</span><span class="token function">getOrderId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>tasks<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">return</span> <span class="token class-name">YmMsg</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"æµç¨‹å®ä¾‹Order["</span> <span class="token operator">+</span> taskParam<span class="token punctuation">.</span><span class="token function">getOrderId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"]ä¸‹æ— æ´»åŠ¨çš„ä»»åŠ¡åˆ—è¡¨ï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                newTasks <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>tasks <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> tasks<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token class-name">Task</span> task <span class="token operator">=</span> tasks<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    newTasks<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>engine<span class="token punctuation">.</span><span class="token function">executeTask</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> userId<span class="token punctuation">,</span> taskParam<span class="token punctuation">.</span><span class="token function">getArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token comment">// æ’¤å›æ“ä½œï¼Œç›´æ¥ç»“æŸæµç¨‹</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>taskParam<span class="token punctuation">.</span><span class="token function">getArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">WfConstants</span><span class="token punctuation">.</span>APPROVAL_TYPE<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token operator">||</span> <span class="token string">"3"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>taskParam<span class="token punctuation">.</span><span class="token function">getArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">WfConstants</span><span class="token punctuation">.</span>APPROVAL_TYPE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">Task</span> task<span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isNotBlank</span><span class="token punctuation">(</span>taskParam<span class="token punctuation">.</span><span class="token function">getTaskId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    task <span class="token operator">=</span> engine<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTask</span><span class="token punctuation">(</span>taskParam<span class="token punctuation">.</span><span class="token function">getTaskId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Task</span><span class="token punctuation">&gt;</span></span> tasks <span class="token operator">=</span> engine<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getActiveTasks</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span>taskParam<span class="token punctuation">.</span><span class="token function">getOrderId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    task <span class="token operator">=</span> <span class="token function">isNotEmpty</span><span class="token punctuation">(</span>tasks<span class="token punctuation">)</span> <span class="token operator">?</span> tasks<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Task</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token class-name">Order</span> order <span class="token operator">=</span> engine<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getOrder</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getOrderId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 1.2 ç›´æ¥è·³åˆ°ç»“æŸèŠ‚ç‚¹</span>
                <span class="token class-name">ProcessModel</span> processModel <span class="token operator">=</span> engine<span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getProcessById</span><span class="token punctuation">(</span>order<span class="token punctuation">.</span><span class="token function">getProcessId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                engine<span class="token punctuation">.</span><span class="token function">executeAndJumpTask</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> userId<span class="token punctuation">,</span> taskParam<span class="token punctuation">.</span><span class="token function">getArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> processModel<span class="token punctuation">.</span><span class="token function">getModels</span><span class="token punctuation">(</span><span class="token class-name">EndModel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                newTasks <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// ä¸åŒæ„</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 1.1 ç»™æµç¨‹å®ä¾‹è¿½åŠ é¢å¤–å‚æ•°</span>
                <span class="token class-name">Task</span> task<span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isNotBlank</span><span class="token punctuation">(</span>taskParam<span class="token punctuation">.</span><span class="token function">getTaskId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    task <span class="token operator">=</span> engine<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTask</span><span class="token punctuation">(</span>taskParam<span class="token punctuation">.</span><span class="token function">getTaskId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Task</span><span class="token punctuation">&gt;</span></span> tasks <span class="token operator">=</span> engine<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getActiveTasks</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span>taskParam<span class="token punctuation">.</span><span class="token function">getOrderId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    task <span class="token operator">=</span> <span class="token function">isNotEmpty</span><span class="token punctuation">(</span>tasks<span class="token punctuation">)</span> <span class="token operator">?</span> tasks<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Task</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token class-name">Order</span> order <span class="token operator">=</span> engine<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getOrder</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getOrderId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//                Map&lt;String, Object&gt; addArgs = new HashMap&lt;&gt;(taskParam.getArgs());</span>
<span class="token comment">//                addArgs.put(WfConstants.ORDER_STATE_KEY, WfOrderStateEnum.DISAGREE.getValue());</span>
<span class="token comment">//                engine.order().addVariable(taskParam.getOrderId(), addArgs);</span>
                <span class="token comment">// 1.2 ç›´æ¥è·³åˆ°ç»“æŸèŠ‚ç‚¹</span>
                <span class="token class-name">ProcessModel</span> processModel <span class="token operator">=</span> engine<span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getProcessById</span><span class="token punctuation">(</span>order<span class="token punctuation">.</span><span class="token function">getProcessId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//                engine.executeAndJumpTask(task.getId(), userId, taskParam.getArgs(), processModel.getModels(EndModel.class).get(0).getName());</span>
                <span class="token comment">// è·³åˆ°æµç¨‹å‘èµ·ç‚¹</span>
                engine<span class="token punctuation">.</span><span class="token function">executeAndJumpTask</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> userId<span class="token punctuation">,</span> taskParam<span class="token punctuation">.</span><span class="token function">getArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> processModel<span class="token punctuation">.</span><span class="token function">getModels</span><span class="token punctuation">(</span><span class="token class-name">TaskModel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                newTasks <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>newTasks<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Task</span> task <span class="token operator">:</span> newTasks<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    task<span class="token punctuation">.</span><span class="token function">setModel</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">ExceptionUtil</span><span class="token punctuation">.</span><span class="token function">getFullStackTrace</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token class-name">YmMsg</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token class-name">YmMsg</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>newTasks<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>æ¯æ¬¡æ‰§è¡Œæ­¤æ–¹æ³•ï¼Œéƒ½ä¼šæ‰§è¡Œå½“å‰èŠ‚ç‚¹çš„ä»»åŠ¡ï¼Œç„¶åç§»åŠ¨åˆ°ä¸‹ä¸€èŠ‚ç‚¹ã€‚</p> 
<blockquote> 
 <p>ğŸ“Œæ³¨æ„ï¼šæ¯æ¬¡æ‰§è¡Œä»»åŠ¡æ—¶ï¼Œéƒ½éœ€è¦æŠŠä¸‹ä¸€èŠ‚ç‚¹çš„æ“ä½œäººå³ä»»åŠ¡å†³ç­–è€…æ ‡è¯†ä¼ å…¥è¿›å»ï¼Œä¸ç„¶å¼•æ“æ— æ³•çŸ¥æ™“ä¸‹ä¸€èŠ‚ç‚¹å†³ç­–è€…æ˜¯è°ï¼Œä¹Ÿå°±æ— æ³•éªŒè¯æƒé™ï¼</p> 
</blockquote> 
<p>snakeflowçš„ä»»åŠ¡å‚ä¸è€…æ”¯æŒä¸‰ç§æ–¹å¼ï¼š</p> 
<ul><li> <p>ç›´æ¥è®¾ç½®é™æ€å‚ä¸è€…ï¼Œå³assigneeå€¼ä¸ºç”¨æˆ·ã€éƒ¨é—¨æˆ–è§’è‰²çš„æ ‡è¯†ç¬¦</p> </li><li> <p>é€šè¿‡è¿è¡Œæ—¶åŠ¨æ€ä¼ é€’ï¼Œå³assigneeå€¼ä¸ºå˜é‡åç§°ï¼Œåœ¨è°ƒç”¨æµç¨‹å¼•æ“çš„apiæ—¶ï¼Œé€šè¿‡mapå‚æ•°ä¼ é€’è¿™ä¸ªå˜é‡å€¼</p> </li><li> <p>é€šè¿‡è‡ªå®šä¹‰ç±»[ç»§æ‰¿Assignmentç±»]ï¼Œè®¾ç½®assignmentHandlerå±æ€§ï¼Œassignæ–¹æ³•è¿”å›å€¼å°±æ˜¯å‚ä¸è€…</p> </li></ul> 
<h4><a id="_439"></a>ä»»åŠ¡æ‰§è¡Œé¢„å¤„ç†</h4> 
<p>é¡¹ç›®é‡‡ç”¨çš„RPCè°ƒç”¨æ–¹å¼ï¼šå‰ç«¯è°ƒç”¨ä¸­é—´æœåŠ¡ï¼Œä¸­é—´æœåŠ¡å†é€šè¿‡RPCè°ƒç”¨æµç¨‹çš„ä»»åŠ¡æ‰§è¡Œæ¥å£ã€‚ä¸­é—´æœåŠ¡çš„é¢„å¤„ç†æ–¹æ³•å¯ä»¥è®¾ç½®å‚æ•°ï¼Œè®¾ç½®æµç¨‹å‚ä¸è€…ï¼š</p> 
<pre><code class="prism language-java"> <span class="token comment">/**
     * æ‰§è¡Œä»»åŠ¡å‰çš„é¢„å¤„ç†
     *
     * @param approvalDTO
     * @return com.yorma.entity.YmMsg&lt;java.lang.String&gt;
     * @apiNote &lt;pre&gt;
     *   æ‰§è¡Œä»»åŠ¡å‰çš„é¢„å¤„ç†
     * &lt;/pre&gt;
     * @author ZHANGCHAO 2022/6/28 16:18
     * @version 1.0
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">YmMsg</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">dealAndExecuteTask</span><span class="token punctuation">(</span><span class="token class-name">ApprovalDTO</span> approvalDTO<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>approvalDTO<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token class-name">YmMsg</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"å‚æ•°[å®¡æ‰¹æ„è§å¯¹è±¡DTO]ä¸èƒ½ä¸ºç©ºï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isBlank</span><span class="token punctuation">(</span>approvalDTO<span class="token punctuation">.</span><span class="token function">getApprovalType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token class-name">YmMsg</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"æœªçŸ¥çš„å¤„ç†æ„è§ç±»å‹ï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isBlank</span><span class="token punctuation">(</span>approvalDTO<span class="token punctuation">.</span><span class="token function">getTaskName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token class-name">YmMsg</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"æœªçŸ¥çš„ä»»åŠ¡åç§°ï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">String</span> tenantId <span class="token operator">=</span> <span class="token class-name">RequestKit</span><span class="token punctuation">.</span><span class="token function">getRequestIn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span>TENANT_ID<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">WfTaskParam</span> wfTaskParam <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WfTaskParam</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> args <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">TaskNodePaymentEnum</span> nodePaymentEnum <span class="token operator">=</span> <span class="token class-name">TaskNodePaymentEnum</span><span class="token punctuation">.</span><span class="token function">getEnum</span><span class="token punctuation">(</span>approvalDTO<span class="token punctuation">.</span><span class="token function">getTaskName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"[dealAndExecuteTask]ä»»åŠ¡åç§°ï¼š"</span> <span class="token operator">+</span> approvalDTO<span class="token punctuation">.</span><span class="token function">getTaskName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>nodePaymentEnum<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token class-name">YmMsg</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"æœªçŸ¥çš„ä»»åŠ¡èŠ‚ç‚¹ï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">/*
         * æ‰§è¡Œä»»åŠ¡æ—¶ï¼Œéœ€ä¼ é€’ä¸‹ä¸€èŠ‚ç‚¹å¤„ç†äººï¼ï¼
         * 2022/6/28 17:36@ZHANGCHAO
         */</span>
        <span class="token class-name">AccountPutPayment</span> payment <span class="token operator">=</span> baseMapper<span class="token punctuation">.</span><span class="token function">selectById</span><span class="token punctuation">(</span>approvalDTO<span class="token punctuation">.</span><span class="token function">getPaymentId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>payment<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token class-name">YmMsg</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"æœªè·å–åˆ°æµæ°´å·["</span> <span class="token operator">+</span> approvalDTO<span class="token punctuation">.</span><span class="token function">getPaymentId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"]çš„ä»˜æ¬¾ç”³è¯·æ•°æ®ï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">requireNonNull</span><span class="token punctuation">(</span>nodePaymentEnum<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">case</span> GBMJL_NODE<span class="token operator">:</span> <span class="token comment">// æ‰§è¡Œ[å„éƒ¨é—¨ç»ç†]èŠ‚ç‚¹ï¼Œä»£å«å·²æ”¶æ¬¾ç±»å‹ï¼Œå‰ç«¯è‡ªåŠ¨ä¼ ä¸‹ä¸€èŠ‚ç‚¹[åˆ†ç®¡éƒ¨é—¨é¢†]çš„æµç¨‹å¤„ç†äºº</span>
                <span class="token comment">// ä»£å«å·²æ”¶æ¬¾ï¼Œç›´æ¥èµ°è´¢åŠ¡ç»ç†</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>payment<span class="token punctuation">.</span><span class="token function">getIsDd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isNotEmpty</span><span class="token punctuation">(</span>payment<span class="token punctuation">.</span><span class="token function">getIsPut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> payment<span class="token punctuation">.</span><span class="token function">getIsDd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> payment<span class="token punctuation">.</span><span class="token function">getIsPut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    args<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"isddysk"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    args<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"cwjl.operator"</span><span class="token punctuation">,</span> <span class="token function">getUserIdsByCond</span><span class="token punctuation">(</span><span class="token string">"è´¢åŠ¡éƒ¨"</span><span class="token punctuation">,</span> tenantId<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä¸‹ä¸€èŠ‚ç‚¹è´¢åŠ¡ç»ç†å¤„ç†äºº</span>
                    <span class="token comment">// éä»£å«å·²æ”¶æ¬¾</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                    args<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"isddysk"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token string">"2"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>approvalDTO<span class="token punctuation">.</span><span class="token function">getApprovalType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isBlank</span><span class="token punctuation">(</span>approvalDTO<span class="token punctuation">.</span><span class="token function">getFgbmldUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                            <span class="token keyword">return</span> <span class="token class-name">YmMsg</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"æ— æ³•è·å–ä¸‹ä¸€èŠ‚ç‚¹[åˆ†ç®¡éƒ¨é—¨é¢†å¯¼]çš„æµç¨‹å¤„ç†äººï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                    args<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"fgbmld.operator"</span><span class="token punctuation">,</span> <span class="token function">isNotBlank</span><span class="token punctuation">(</span>approvalDTO<span class="token punctuation">.</span><span class="token function">getFgbmldUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">?</span> approvalDTO<span class="token punctuation">.</span><span class="token function">getFgbmldUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä¸‹ä¸€èŠ‚ç‚¹å¤„ç†äºº</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> FGBMLD_NODE<span class="token operator">:</span> <span class="token comment">// æ‰§è¡Œ[åˆ†ç®¡éƒ¨é—¨é¢†å¯¼]èŠ‚ç‚¹</span>
                <span class="token comment">// ä»˜æ¬¾ç”³è¯·å¸åˆ¶</span>
                <span class="token class-name">String</span> curr <span class="token operator">=</span> <span class="token function">isNotBlank</span><span class="token punctuation">(</span>payment<span class="token punctuation">.</span><span class="token function">getCurr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">?</span> payment<span class="token punctuation">.</span><span class="token function">getCurr</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">"CNY"</span><span class="token punctuation">;</span>
                <span class="token comment">// è´¹ç”¨</span>
                <span class="token class-name">BigDecimal</span> payAmount <span class="token operator">=</span> <span class="token function">isEmpty</span><span class="token punctuation">(</span>payment<span class="token punctuation">.</span><span class="token function">getAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">.</span>ZERO <span class="token operator">:</span> payment<span class="token punctuation">.</span><span class="token function">getAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// ä»£å«å·²æ”¶æ¬¾ï¼Œç›´æ¥èµ°è´¢åŠ¡ç»ç†</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>payment<span class="token punctuation">.</span><span class="token function">getIsDd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isNotEmpty</span><span class="token punctuation">(</span>payment<span class="token punctuation">.</span><span class="token function">getIsPut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> payment<span class="token punctuation">.</span><span class="token function">getIsDd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> payment<span class="token punctuation">.</span><span class="token function">getIsPut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">return</span> <span class="token class-name">YmMsg</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"æ‰§è¡Œ[åˆ†ç®¡éƒ¨é—¨é¢†å¯¼]èŠ‚ç‚¹ï¼Œè´¹ç”¨ç±»å‹ä¸º[ä»£å«å·²æ”¶æ¬¾]æ— æ³•ç»§ç»­æ‰§è¡Œå·¥ä½œæµï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token comment">// ä»£å«æœªä»˜æ¬¾</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>payment<span class="token punctuation">.</span><span class="token function">getIsDd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> payment<span class="token punctuation">.</span><span class="token function">getIsDd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>payment<span class="token punctuation">.</span><span class="token function">getIsPut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span>payment<span class="token punctuation">.</span><span class="token function">getIsPut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">// ä»£å«å·²æ”¶æ¬¾ï¼Œtoè´¢åŠ¡ç»ç†</span>
<span class="token comment">//                    if (isNotEmpty(putPayment.getIsPut()) &amp;&amp; putPayment.getIsPut()) {<!-- --></span>
<span class="token comment">//                        args.put("moneyType", 2);</span>
<span class="token comment">//                        args.put("cwjl.operator", getUserIdsByCond("è´¢åŠ¡éƒ¨", tenantId, 2)); // ä¸‹ä¸€èŠ‚ç‚¹è´¢åŠ¡ç»ç†å¤„ç†äºº</span>
<span class="token comment">//                        // ä»£å«æœªæ”¶æ¬¾</span>
<span class="token comment">//                    } else {<!-- --></span>
                        args<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"moneyType"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        args<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"wskMoney"</span><span class="token punctuation">,</span> payAmount<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token comment">// å°äº5Wï¼Œtoè´¢åŠ¡ç»ç†</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>payAmount<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">"50000"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                            args<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"cwjl.operator"</span><span class="token punctuation">,</span> <span class="token function">getUserIdsByCond</span><span class="token punctuation">(</span><span class="token string">"è´¢åŠ¡éƒ¨"</span><span class="token punctuation">,</span> tenantId<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä¸‹ä¸€èŠ‚ç‚¹è´¢åŠ¡ç»ç†å¤„ç†äºº</span>
                            <span class="token comment">// å¤§äº5Wï¼Œtoæ€»ç»ç†è‘£äº‹é•¿</span>
                        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                            args<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"zjldsz.operator"</span><span class="token punctuation">,</span> <span class="token function">getUserIdsByCond</span><span class="token punctuation">(</span><span class="token string">"æ€»ç»åŠ"</span><span class="token punctuation">,</span> tenantId<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä¸‹ä¸€èŠ‚ç‚¹æ€»ç»ç†è‘£äº‹é•¿å¤„ç†äºº</span>
                        <span class="token punctuation">}</span>
<span class="token comment">//                    }</span>
                    <span class="token comment">// ä¸šåŠ¡æ¬¾é¡¹</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                    args<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"moneyType"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    args<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"ywMoney"</span><span class="token punctuation">,</span> payAmount<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"CNY"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>curr<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        args<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"currtype"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token comment">// å°äº20Wï¼Œtoè´¢åŠ¡ç»ç†</span>
                        <span class="token comment">// 2022/7/27 16:14@ZHANGCHAO è¿½åŠ /å˜æ›´/å®Œå–„ï¼šäººæ°‘å¸20Wæˆ–è€…ç¾å…ƒ3Wä»¥ä¸‹çš„ä¸ºè´¢åŠ¡ç»ç†</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>payAmount<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">"200000"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                            args<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"cwjl.operator"</span><span class="token punctuation">,</span> <span class="token function">getUserIdsByCond</span><span class="token punctuation">(</span><span class="token string">"è´¢åŠ¡éƒ¨"</span><span class="token punctuation">,</span> tenantId<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä¸‹ä¸€èŠ‚ç‚¹è´¢åŠ¡ç»ç†å¤„ç†äºº</span>
                            <span class="token comment">// å¤§äº20Wï¼Œtoæ€»ç»ç†è‘£äº‹é•¿</span>
                            <span class="token comment">// 2022/7/27 16:14@ZHANGCHAO è¿½åŠ /å˜æ›´/å®Œå–„ï¼šäººæ°‘å¸20Wæˆ–è€…ç¾å…ƒ3Wä»¥ä¸Šçš„ï¼ˆåŒ…å«ï¼‰</span>
                        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                            args<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"zjldsz.operator"</span><span class="token punctuation">,</span> <span class="token function">getUserIdsByCond</span><span class="token punctuation">(</span><span class="token string">"æ€»ç»åŠ"</span><span class="token punctuation">,</span> tenantId<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä¸‹ä¸€èŠ‚ç‚¹æ€»ç»ç†è‘£äº‹é•¿å¤„ç†äºº</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"USD"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>curr<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        args<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"currtype"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token comment">// å°äº20Wï¼Œtoè´¢åŠ¡ç»ç†</span>
                        <span class="token comment">// 2022/7/27 16:14@ZHANGCHAO è¿½åŠ /å˜æ›´/å®Œå–„ï¼šäººæ°‘å¸20Wæˆ–è€…ç¾å…ƒ3Wä»¥ä¸‹çš„ä¸ºè´¢åŠ¡ç»ç†</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>payAmount<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">"30000"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                            args<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"cwjl.operator"</span><span class="token punctuation">,</span> <span class="token function">getUserIdsByCond</span><span class="token punctuation">(</span><span class="token string">"è´¢åŠ¡éƒ¨"</span><span class="token punctuation">,</span> tenantId<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä¸‹ä¸€èŠ‚ç‚¹è´¢åŠ¡ç»ç†å¤„ç†äºº</span>
                            <span class="token comment">// å¤§äº20Wï¼Œtoæ€»ç»ç†è‘£äº‹é•¿</span>
                            <span class="token comment">// 2022/7/27 16:14@ZHANGCHAO è¿½åŠ /å˜æ›´/å®Œå–„ï¼šäººæ°‘å¸20Wæˆ–è€…ç¾å…ƒ3Wä»¥ä¸Šçš„ï¼ˆåŒ…å«ï¼‰</span>
                        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                            args<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"zjldsz.operator"</span><span class="token punctuation">,</span> <span class="token function">getUserIdsByCond</span><span class="token punctuation">(</span><span class="token string">"æ€»ç»åŠ"</span><span class="token punctuation">,</span> tenantId<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä¸‹ä¸€èŠ‚ç‚¹æ€»ç»ç†è‘£äº‹é•¿å¤„ç†äºº</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                        args<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"currtype"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token comment">// å°äº20Wï¼Œtoè´¢åŠ¡ç»ç†</span>
                        <span class="token comment">// 2022/7/27 16:14@ZHANGCHAO è¿½åŠ /å˜æ›´/å®Œå–„ï¼šäººæ°‘å¸20Wæˆ–è€…ç¾å…ƒ3Wä»¥ä¸‹çš„ä¸ºè´¢åŠ¡ç»ç†</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>payAmount<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">"200000"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                            args<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"cwjl.operator"</span><span class="token punctuation">,</span> <span class="token function">getUserIdsByCond</span><span class="token punctuation">(</span><span class="token string">"è´¢åŠ¡éƒ¨"</span><span class="token punctuation">,</span> tenantId<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä¸‹ä¸€èŠ‚ç‚¹è´¢åŠ¡ç»ç†å¤„ç†äºº</span>
                            <span class="token comment">// å¤§äº20Wï¼Œtoæ€»ç»ç†è‘£äº‹é•¿</span>
                            <span class="token comment">// 2022/7/27 16:14@ZHANGCHAO è¿½åŠ /å˜æ›´/å®Œå–„ï¼šäººæ°‘å¸20Wæˆ–è€…ç¾å…ƒ3Wä»¥ä¸Šçš„ï¼ˆåŒ…å«ï¼‰</span>
                        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                            args<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"zjldsz.operator"</span><span class="token punctuation">,</span> <span class="token function">getUserIdsByCond</span><span class="token punctuation">(</span><span class="token string">"æ€»ç»åŠ"</span><span class="token punctuation">,</span> tenantId<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä¸‹ä¸€èŠ‚ç‚¹æ€»ç»ç†è‘£äº‹é•¿å¤„ç†äºº</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> ZJLDSZ_NODE<span class="token operator">:</span> <span class="token comment">// æ‰§è¡Œ[æ€»ç»ç†è‘£äº‹é•¿]èŠ‚ç‚¹</span>
                args<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"cwjl.operator"</span><span class="token punctuation">,</span> <span class="token function">getUserIdsByCond</span><span class="token punctuation">(</span><span class="token string">"è´¢åŠ¡éƒ¨"</span><span class="token punctuation">,</span> tenantId<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä¸‹ä¸€èŠ‚ç‚¹è´¢åŠ¡ç»ç†å¤„ç†äºº</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> CWJL_NODE<span class="token operator">:</span> <span class="token comment">// æ‰§è¡Œ[è´¢åŠ¡ç»ç†]èŠ‚ç‚¹</span>
                args<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"cnfk.operator"</span><span class="token punctuation">,</span> <span class="token function">getUserIdsByCond</span><span class="token punctuation">(</span><span class="token string">"è´¢åŠ¡éƒ¨"</span><span class="token punctuation">,</span> tenantId<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä¸‹ä¸€èŠ‚ç‚¹å‡ºçº³ä»˜æ¬¾å¤„ç†äºº</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> CNFK_NODE<span class="token operator">:</span> <span class="token comment">// å‡ºçº³ä»˜æ¬¾ï¼Œç›´æ¥ç»“æŸä»»åŠ¡</span>
                <span class="token comment">// TODO: ...</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> APPLY_NODE<span class="token operator">:</span> <span class="token comment">// é‡æ–°è·³è½¬åˆ°æµç¨‹å‘èµ·ç‚¹</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">default</span><span class="token operator">:</span>
        <span class="token punctuation">}</span>
        args<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>APPROVAL_TYPE<span class="token punctuation">,</span> approvalDTO<span class="token punctuation">.</span><span class="token function">getApprovalType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ„è§ç±»å‹</span>
        args<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>OPINION<span class="token punctuation">,</span> approvalDTO<span class="token punctuation">.</span><span class="token function">getOpinion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å¤„ç†æ„è§</span>
        wfTaskParam<span class="token punctuation">.</span><span class="token function">setTaskId</span><span class="token punctuation">(</span>approvalDTO<span class="token punctuation">.</span><span class="token function">getTaskId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä»»åŠ¡ID</span>
        wfTaskParam<span class="token punctuation">.</span><span class="token function">setArgs</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">YmMsg</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">Task</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> taskYmMsg <span class="token operator">=</span> <span class="token class-name">RpcKit</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>flowApi<span class="token punctuation">,</span> <span class="token class-name">FlowApi</span><span class="token operator">::</span><span class="token function">executeTask</span><span class="token punctuation">,</span> wfTaskParam<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>taskYmMsg<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> users <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 2022/6/29 14:37@ZHANGCHAO è¿½åŠ /å˜æ›´/å®Œå–„ï¼šæ‰§è¡ŒæˆåŠŸå‘é€æ¶ˆæ¯ï¼</span>
            wfTaskParam<span class="token punctuation">.</span><span class="token function">getArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>k<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"operator"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token function">sendMessageForExcute</span><span class="token punctuation">(</span>payment<span class="token punctuation">.</span><span class="token function">getPutNo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> userId <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> v<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                                    <span class="token class-name">SysUser</span> user <span class="token operator">=</span> baseMapper<span class="token punctuation">.</span><span class="token function">getUserByUserId</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                                        users<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getRealname</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                    <span class="token punctuation">}</span>
                                <span class="token punctuation">}</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token class-name">ExceptionUtil</span><span class="token punctuation">.</span><span class="token function">getFullStackTrace</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"è·å–ç”¨æˆ·çœŸå®å§“åå‡ºç°å¼‚å¸¸ï¼š"</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>users <span class="token operator">+</span> <span class="token string">"ä»»åŠ¡æ‰§è¡ŒæˆåŠŸï¼"</span> <span class="token operator">+</span> taskYmMsg<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> returnMsg <span class="token operator">=</span> <span class="token function">isEmpty</span><span class="token punctuation">(</span>users<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">"æ“ä½œæˆåŠŸï¼"</span> <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token string">"æ“ä½œæˆåŠŸï¼ä¸‹ä¸€æ­¥çš„æµç¨‹å¤„ç†äºº["</span> <span class="token operator">+</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">,</span> users<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>approvalDTO<span class="token punctuation">.</span><span class="token function">getApprovalType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                returnMsg <span class="token operator">=</span> <span class="token string">"æ“ä½œæˆåŠŸï¼å·²é€€å›åˆ°æµç¨‹å‘èµ·ç‚¹ï¼"</span><span class="token punctuation">;</span>
                <span class="token comment">/*
                 * ä»˜æ¬¾å®¡æ‰¹å¦‚æœå®¡æ‰¹äººä¸åŒæ„éœ€è¦å¡«å†™ç†ç”±ï¼Œå¹¶ç»™åˆ°ç”³è¯·äººæé†’
                 * 2022/7/25 14:19@ZHANGCHAO
                 */</span>
                <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token class-name">WfHistTask</span> task <span class="token operator">=</span> wfHistTaskService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>wfTaskParam<span class="token punctuation">.</span><span class="token function">getTaskId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token class-name">WfHistTask</span> wfHistTask <span class="token operator">=</span> wfHistTaskService<span class="token punctuation">.</span><span class="token function">getOne</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">WfHistTask</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lambda</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                <span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">WfHistTask</span><span class="token operator">::</span><span class="token function">getOrderId</span><span class="token punctuation">,</span> task<span class="token punctuation">.</span><span class="token function">getOrderId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                                <span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">WfHistTask</span><span class="token operator">::</span><span class="token function">getTaskName</span><span class="token punctuation">,</span> <span class="token string">"apply"</span><span class="token punctuation">)</span>
                                <span class="token punctuation">.</span><span class="token function">orderByDesc</span><span class="token punctuation">(</span><span class="token class-name">WfHistTask</span><span class="token operator">::</span><span class="token function">getCreateTime</span><span class="token punctuation">)</span>
                                <span class="token punctuation">.</span><span class="token function">last</span><span class="token punctuation">(</span><span class="token string">"LIMIT 1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>wfHistTask<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                            <span class="token function">sendMessageRollback</span><span class="token punctuation">(</span>payment<span class="token punctuation">.</span><span class="token function">getPutNo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> wfHistTask<span class="token punctuation">.</span><span class="token function">getOperator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">ExceptionUtil</span><span class="token punctuation">.</span><span class="token function">getFullStackTrace</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"[dealAndExecuteTask]==&gt;ï¼šé€€å›æ“ä½œå‘é€æ¶ˆæ¯ç»™æµç¨‹å‘èµ·äººå‡ºç°å¼‚å¸¸ï¼ï¼ï¼"</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"3"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>approvalDTO<span class="token punctuation">.</span><span class="token function">getApprovalType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 2022/7/1 9:08@ZHANGCHAO è¿½åŠ /å˜æ›´/å®Œå–„ï¼šåˆ é™¤æ“ä½œï¼Œç›´æ¥åˆ é™¤æ­¤ä»˜æ¬¾ç”³è¯·ï¼Œè´¹ç”¨æ˜ç»†å–æ¶ˆæ ‡è®°å·²ç”³è¯·ï¼</span>
                <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AccountPutRel</span><span class="token punctuation">&gt;</span></span> accountPutRelList <span class="token operator">=</span> accountPutRelService<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AccountPutRel</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lambda</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">AccountPutRel</span><span class="token operator">::</span><span class="token function">getClaId</span><span class="token punctuation">,</span> payment<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>accountPutRelList<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> expIds <span class="token operator">=</span> accountPutRelList<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">AccountPutRel</span><span class="token operator">::</span><span class="token function">getExpId</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AccountExpense</span><span class="token punctuation">&gt;</span></span> accountExpenseList <span class="token operator">=</span> accountExpenseMapper<span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AccountExpense</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lambda</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">in</span><span class="token punctuation">(</span><span class="token class-name">AccountExpense</span><span class="token operator">::</span><span class="token function">getId</span><span class="token punctuation">,</span> expIds<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>accountExpenseList<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> accountNos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">AccountExpense</span> accountExpense <span class="token operator">:</span> accountExpenseList<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                            <span class="token comment">// è´¹ç”¨æ˜ç»†æ ‡è®° æ˜¯å¦æ ¸é”€æ”¹ä¸º0ï¼Œæ ¸é”€é‡‘é¢æ¸…0ï¼Œæ ¸é”€æ—¥æœŸæ¸…ç©ºã€æ˜¯å¦å·²ç”³è¯·æ”¹ä¸º0</span>
                            accountExpenseMapper<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">UpdateWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AccountExpense</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lambda</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                    <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">AccountExpense</span><span class="token operator">::</span><span class="token function">getIsSq</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
                                    <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">AccountExpense</span><span class="token operator">::</span><span class="token function">getIsHx</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
                                    <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">AccountExpense</span><span class="token operator">::</span><span class="token function">getVerificationAmount</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                                    <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">AccountExpense</span><span class="token operator">::</span><span class="token function">getVerificationData</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                                    <span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">AccountExpense</span><span class="token operator">::</span><span class="token function">getId</span><span class="token punctuation">,</span> accountExpense<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            accountNos<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>accountExpense<span class="token punctuation">.</span><span class="token function">getAccountNo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                        <span class="token function">changeAccountPutStatus</span><span class="token punctuation">(</span>accountNos<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    accountPutRelService<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AccountPutRel</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lambda</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">AccountPutRel</span><span class="token operator">::</span><span class="token function">getClaId</span><span class="token punctuation">,</span> payment<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                baseMapper<span class="token punctuation">.</span><span class="token function">deleteById</span><span class="token punctuation">(</span>approvalDTO<span class="token punctuation">.</span><span class="token function">getPaymentId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                returnMsg <span class="token operator">=</span> <span class="token string">"æ“ä½œæˆåŠŸï¼æµç¨‹å·²å…³é—­ï¼"</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">/*
             * ä¸šåŠ¡ç”³è¯·çŠ¶æ€ï¼šPUT_STATUSï¼š1å·²ç”³è¯·ï¼Œ2å®¡æ‰¹ä¸­ï¼Œ3å®¡æ‰¹é€šè¿‡
             * å·¥ä½œæµå¼€å§‹ï¼Œå…³è”ä»˜æ¬¾ç”³è¯·æ•°æ®çŠ¶æ€æ”¹æˆ2å®¡æ‰¹ä¸­ã€‚
             * å·¥ä½œæµç»“æŸï¼Œå…³è”ä»˜æ¬¾ç”³è¯·æ•°æ®çŠ¶æ€æ”¹æˆ3å®¡æ‰¹é€šè¿‡ã€‚
             * 2022/7/1 15:14@ZHANGCHAO
             */</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> orderStates <span class="token operator">=</span> baseMapper<span class="token punctuation">.</span><span class="token function">getOrderStatesByPaymentId</span><span class="token punctuation">(</span>approvalDTO<span class="token punctuation">.</span><span class="token function">getPaymentId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>orderStates<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">boolean</span> isFinish <span class="token operator">=</span> orderStates<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">allMatch</span><span class="token punctuation">(</span><span class="token string">"0"</span><span class="token operator">::</span><span class="token function">equals</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>isFinish<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    baseMapper<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">UpdateWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AccountPutPayment</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lambda</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">AccountPutPayment</span><span class="token operator">::</span><span class="token function">getPutStatus</span><span class="token punctuation">,</span> <span class="token string">"3"</span><span class="token punctuation">)</span> <span class="token comment">// 3å®¡æ‰¹é€šè¿‡</span>
                            <span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">AccountPutPayment</span><span class="token operator">::</span><span class="token function">getId</span><span class="token punctuation">,</span> approvalDTO<span class="token punctuation">.</span><span class="token function">getPaymentId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">// å®¡æ‰¹æœ€ç»ˆç»“æŸåï¼Œæé†’ä¸€ä¸‹ç”³è¯·äººï¼Œå“ªä¸€ç¥¨å®¡æ‰¹å·²é€šè¿‡ã€‚</span>
                    <span class="token class-name">WfRelBusiness</span> wfRelBusiness <span class="token operator">=</span> wfRelBusinessService<span class="token punctuation">.</span><span class="token function">getOne</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">WfRelBusiness</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lambda</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">WfRelBusiness</span><span class="token operator">::</span><span class="token function">getBusinessId</span><span class="token punctuation">,</span> approvalDTO<span class="token punctuation">.</span><span class="token function">getPaymentId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">WfHistTask</span> wfHistTask <span class="token operator">=</span> wfHistTaskService<span class="token punctuation">.</span><span class="token function">getOne</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">WfHistTask</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lambda</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">WfHistTask</span><span class="token operator">::</span><span class="token function">getOrderId</span><span class="token punctuation">,</span> wfRelBusiness<span class="token punctuation">.</span><span class="token function">getOrderId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">WfHistTask</span><span class="token operator">::</span><span class="token function">getTaskName</span><span class="token punctuation">,</span> <span class="token string">"apply"</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">orderByDesc</span><span class="token punctuation">(</span><span class="token class-name">WfHistTask</span><span class="token operator">::</span><span class="token function">getCreateTime</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">last</span><span class="token punctuation">(</span><span class="token string">"LIMIT 1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>wfHistTask<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token function">sendMessageFinished</span><span class="token punctuation">(</span>payment<span class="token punctuation">.</span><span class="token function">getPutNo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> wfHistTask<span class="token punctuation">.</span><span class="token function">getOperator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token class-name">YmMsg</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>returnMsg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"ä»»åŠ¡æ‰§è¡Œå¤±è´¥ï¼ŒåŸå› ï¼š"</span> <span class="token operator">+</span> taskYmMsg<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token class-name">YmMsg</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"ä»»åŠ¡æ‰§è¡Œå¤±è´¥ï¼ŒåŸå› ï¼š"</span> <span class="token operator">+</span> taskYmMsg<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>æ­¤æ–¹æ³•æ ¹æ®æ¯ä¸€æ­¥æ‰§è¡Œçš„ä»»åŠ¡èŠ‚ç‚¹æ ‡è¯†ï¼Œè‡ªåŠ¨è·å–ä¸‹ä¸€èŠ‚ç‚¹çš„æµç¨‹å‚ä¸è€…æ ‡è¯†ä¼ é€’è¿‡å»ã€‚æ ¹æ®å®¡æ‰¹ç±»å‹å¯ä»¥é€‰æ‹©å›é€€åˆ°æµç¨‹å‘èµ·äººæˆ–è€…ç›´æ¥è·³è½¬åˆ°æµç¨‹ç»ˆç‚¹ã€‚</p> 
<h4><a id="_699"></a>å‰ç«¯é¡µé¢å±•ç¤º</h4> 
<p>ä»»åŠ¡å‚ä¸è€…å¯ä»¥æŸ¥çœ‹åˆ°å½“å‰åˆ†é…ç»™ä»–çš„ä»»åŠ¡ï¼Œå¯ä»¥è¿›è¡ŒåŠç†</p> 
<p><img src="https://images2.imgbox.com/fe/a6/TgmVkQhe_o.png" alt="è¯·æ·»åŠ å›¾ç‰‡æè¿°"><br> <img src="https://images2.imgbox.com/b6/7e/eAtIF2rH_o.png" alt="è¯·æ·»åŠ å›¾ç‰‡æè¿°"><br> <img src="https://images2.imgbox.com/0f/4f/f26R7WGx_o.png" alt="è¯·æ·»åŠ å›¾ç‰‡æè¿°"></p> 
<h4><a id="_708"></a>æ€»ç»“</h4> 
<p>æœ¬æ–‡åªæ˜¯ç®€å•å±•ç¤ºäº†å‰åç«¯åˆ†ç¦»é¡¹ç›®æ•´åˆsnakeflowçš„ç®€å•ç”¨æ³•ï¼Œæš‚æœªæ¶‰åŠåˆ°å­æµç¨‹ã€æ—¶é™æ§åˆ¶ã€å®ä¾‹æŠ„é€ã€Fork/Joinã€è‡ªå®šä¹‰èŠ‚ç‚¹ç­‰åŠŸèƒ½ï¼Œå¯ä»¥è‡ªè¡Œæ ¹æ®å®˜æ–¹æ–‡æ¡£ä½“éªŒæ­¤å·¥ä½œæµå¼•æ“çš„å¼ºå¤§ä¹‹å¤„ã€‚</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/cd1e9e4e50a555dd399a2145cb382e46/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">è§£å†³ç¬”è®°æœ¬å±å¹•æ˜¾ç¤ºç¼©æ”¾æ¯”ä¾‹125% 150%å¯¹é¡µé¢å¸ƒå±€çš„å½±å“</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/bcc38368671abeca56f2fab069a0d641/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">Vue é¡¹ç›® js æ–‡ä»¶ä¸­ä½¿ç”¨ vue-i18n</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 ç¼–ç¨‹å¤§ç™½çš„åšå®¢.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>