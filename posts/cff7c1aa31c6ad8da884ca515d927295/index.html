<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>手摸手系列之SpringBoot&#43;Vue整合snakeflow工作流实战 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="手摸手系列之SpringBoot&#43;Vue整合snakeflow工作流实战" />
<meta property="og:description" content="前言 技术栈：
SpringBoot: 2.3.5.RELEASE
Vue: 2.6.10
snakerflow: 2.5.1
最近做集团内部的悦通关平台项目，台账管理的付款申请模块需要用到工作流审批功能，本着轻量的目的，特选定了国内开发者开源的一款轻量级工作流引擎-snakeflow。官网了解到Snaker是一个基于Java的轻量级工作流引擎，适用于企业应用中常见的业务流程。本着轻量、简单、灵巧理念设计，定位于简单集成、多环境支持，基于Apache License Version 2.0开源协议发布。文档指南👉[点我直达]
snakeflow核心简介 7张核心表定义：
WF_PROCESS：流程定义，例如请假申请，用车申请等流程定义。
WF_ORDER：流程实例，当前运行中的流程实例的信息，比如，我申请了一条请假流程，流程编号“请假-001”，这个请假流程“请假-001”就是一个流程实例。
WF_HIST_ORDER：历史流程实例，只要启动过的流程，历史流程实例表中就会存储流程的实例信息，比如这条流程是否结束。
WF_TASK：任务，某个流程中某个节点，叫做任务实例。比如“请假-001”中需要上级审批，“上级审批”这个节点就是一个任务实例。
WF_HIST_TASK：历史任务(就是执行完了的任务)，所有任务结束以后都会在历史任务信息表里存一条记录。
WF_TASK_ACTOR：每个任务对应的参与者(记住谁可以签收或处理)，可能会有多个人或者用户组。
WF_HIST_TASK_ACTOR：历史的参与者表，任务处理完以后，对应处理人的信息会存到这个表里面。
各核心表及流程详解:
WF_PROCESS：存放流程定义，通过编辑一个后缀为.snaker的xml文档来定义流程的走向；在前端流程定义管理里有个部署流程的按钮，可以将编辑好的xml文档保存到WF_PROCESS表中，并产生一条记录。xml文档里有流程的名字，如果这个名字在WF_PROCESS已经存在了，则保存时产生的新的记录的version字段值会自动加1。processId是唯一的，不重复。
WF_ORDER：存放流程实例的。开启一个流程实例时，WF_ORDER表有个字段PROCESS_ID和流程定义的process_id相关联，他们是一对多的关系。当开启一个流程实例WF_ORDER时，在WF_ORDER和WF_HIST_ORDER都新增一条记录，并且同时产生的那两条记录的主键id是一样的。，其中WF_HIST_ORDER比WF_ORDER多一个字段ORDER_STATUS 流程实例状态(0：结束；1：活动)。当流程没跑完时，ORDER_STATUS的值是1；当整个事件流程跑完了，WF_ORDER表的那条记录会被删除，WF_HIST_ORDER表对应的那条记录的ORDER_STATUS的值变成0，表示流程实例跑完了。
WF_TASK：存当前任务的；当流程执行完当前任务节点时，WF_TASK的这条记录会被剪切到WF_HIST_TASK表中，然后在WF_TASK表中新增下一个任务节点的信息记录。新增的下一任务节点的task有个字段parent_task_id记住上一个任务节点在WF_HIST_TASK表里的WF_HIST_TASK_ID(上一个任务节点从WF_TASK表剪切到WF_HIST_TASK了)；这样就可以实现回退等功能。
WF_TASK_ACTOR：存哪个任务关联了那些参与者的，就是哪些人可以签收或者处理。如果当前任务节点被执行了，则相关的参与者会被剪切到WF_HIST_TASK_ACTOR表里，和WF_TASK、WF_HIST_TASK类似，这样回退时，就知道以前这一步是谁处理的。
假如现在执行节点的任务是A2，上述中wf_task存的是执行中的记录，也就是说在执行A2前，wf_task中肯定会有一条执行中的任务记录，假设为A1，那么执行A2时的增删改为先将wf_task和wf_task_actor表中A1的记录插入wf_hist_task和wf_hist_task_actor中；其次是删除wf_task和wf_task_actor中A1记录，然后将A2的信息插入到wf_task和wf_task_actor中。此时wf_task表的parent_task_id是历史表A1记录的Id，通过此可将所有任务串联起来。task表的variable中的值为局部变量只能在当前task中使用。有人会有疑问，假设有如下流程图，执行task1时会怎么样？
因为开始节点是一个比较特殊的nodemodel，称之为流转逻辑元素，它只负责流转到下一节点不负责执行，也就没有数据库的增删改。这样直接流转到task1，插入wf_hist_task和wf_hist_task_actor，并且又直接流转到end节点，end节点也是一个流转元素，它会直接删除wf_order表的记录并更改该流程实例wf_hist_order表的order_state的状态。
至此一个流程的所有增删改查结束。
项目整合 pom引入snakeflow依赖 &lt;dependency&gt; &lt;groupId&gt;com.github.snakerflow&lt;/groupId&gt; &lt;artifactId&gt;snaker-spring&lt;/artifactId&gt; &lt;version&gt;2.5.1&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.github.snakerflow&lt;/groupId&gt; &lt;artifactId&gt;snaker-mybatis&lt;/artifactId&gt; &lt;version&gt;2.4.0&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.github.snakerflow&lt;/groupId&gt; &lt;artifactId&gt;snaker-core&lt;/artifactId&gt; &lt;version&gt;2.5.1&lt;/version&gt; &lt;/dependency&gt; 根据业务设计流程定义 官方的流程设计器比较老旧比较丑，推荐一个第三方图形化的流程设计器：模型设计 - mldong快速开发平台
界面如上图，根据自己的业务需求，设计出相应的流程图，然后点击查看按钮导出xml代码：
在项目的resources目录下新建.snaker后缀的流程定义文件，将xml代码复制进去，此文件即为流程定义模型文件，工作流引擎会自动生成对应的流程定义模型。
具体xml代码：
&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; standalone=&#34;no&#34;?&gt; &lt;process name=&#34;payreq&#34; displayName=&#34;付款申请流程&#34; instanceUrl=&#34;/snaker/flow/all&#34;&gt; &lt;start name=&#34;start&#34; displayName=&#34;开始&#34; layout=&#34;780,-180,120,80&#34;&gt; &lt;transition name=&#34;b288a53d-e54e-473d-8ed1-fc4fa21f0210&#34; to=&#34;apply&#34; g=&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/cff7c1aa31c6ad8da884ca515d927295/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-08-01T16:39:29+08:00" />
<meta property="article:modified_time" content="2022-08-01T16:39:29+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">手摸手系列之SpringBoot&#43;Vue整合snakeflow工作流实战</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atelier-sulphurpool-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h5><a id="_0"></a>前言</h5> 
<blockquote> 
 <p>技术栈：<br> SpringBoot: 2.3.5.RELEASE<br> Vue: 2.6.10<br> snakerflow: 2.5.1</p> 
</blockquote> 
<p>最近做集团内部的悦通关平台项目，台账管理的付款申请模块需要用到工作流审批功能，本着轻量的目的，特选定了国内开发者开源的一款轻量级工作流引擎-snakeflow。官网了解到Snaker是一个基于Java的轻量级工作流引擎，适用于企业应用中常见的业务流程。本着轻量、简单、灵巧理念设计，定位于简单集成、多环境支持，基于Apache License Version 2.0开源协议发布。文档指南👉[<a href="https://yunmel.gitbooks.io/snakerflow/content/" rel="nofollow" title="点我直达">点我直达</a>]</p> 
<h4><a id="snakeflow_9"></a>snakeflow核心简介</h4> 
<ol><li> <p><strong>7张核心表定义</strong>：</p> 
  <ul><li> <p><code>WF_PROCESS</code>：流程定义，例如请假申请，用车申请等流程定义。</p> </li><li> <p><code>WF_ORDER</code>：流程实例，当前运行中的流程实例的信息，比如，我申请了一条请假流程，流程编号“请假-001”，这个请假流程“请假-001”就是一个流程实例。</p> </li><li> <p><code>WF_HIST_ORDER</code>：历史流程实例，只要启动过的流程，历史流程实例表中就会存储流程的实例信息，比如这条流程是否结束。</p> </li><li> <p><code>WF_TASK</code>：任务，某个流程中某个节点，叫做任务实例。比如“请假-001”中需要上级审批，“上级审批”这个节点就是一个任务实例。</p> </li><li> <p><code>WF_HIST_TASK</code>：历史任务(就是执行完了的任务)，所有任务结束以后都会在历史任务信息表里存一条记录。</p> </li><li> <p><code>WF_TASK_ACTOR</code>：每个任务对应的参与者(记住谁可以签收或处理)，可能会有多个人或者用户组。</p> </li><li> <p><code>WF_HIST_TASK_ACTOR</code>：历史的参与者表，任务处理完以后，对应处理人的信息会存到这个表里面。</p> </li></ul> </li><li> <p><strong>各核心表及流程详解:</strong></p> <p><code>WF_PROCESS</code>：存放流程定义，通过编辑一个后缀为.snaker的xml文档来定义流程的走向；在前端流程定义管理里有个部署流程的按钮，可以将编辑好的xml文档保存到WF_PROCESS表中，并产生一条记录。xml文档里有流程的名字，如果这个名字在WF_PROCESS已经存在了，则保存时产生的新的记录的version字段值会自动加1。processId是唯一的，不重复。</p> <p><code>WF_ORDER</code>：存放流程实例的。开启一个流程实例时，WF_ORDER表有个字段PROCESS_ID和流程定义的process_id相关联，他们是一对多的关系。当开启一个流程实例WF_ORDER时，在WF_ORDER和WF_HIST_ORDER都新增一条记录，并且同时产生的那两条记录的主键id是一样的。，其中WF_HIST_ORDER比WF_ORDER多一个字段ORDER_STATUS 流程实例状态(0：结束；1：活动)。当流程没跑完时，ORDER_STATUS的值是1；当整个事件流程跑完了，WF_ORDER表的那条记录会被删除，WF_HIST_ORDER表对应的那条记录的ORDER_STATUS的值变成0，表示流程实例跑完了。</p> <p><code>WF_TASK</code>：存当前任务的；当流程执行完当前任务节点时，WF_TASK的这条记录会被剪切到WF_HIST_TASK表中，然后在WF_TASK表中新增下一个任务节点的信息记录。新增的下一任务节点的task有个字段parent_task_id记住上一个任务节点在WF_HIST_TASK表里的WF_HIST_TASK_ID(上一个任务节点从WF_TASK表剪切到WF_HIST_TASK了)；这样就可以实现回退等功能。</p> <p><code>WF_TASK_ACTOR</code>：存哪个任务关联了那些参与者的，就是哪些人可以签收或者处理。如果当前任务节点被执行了，则相关的参与者会被剪切到WF_HIST_TASK_ACTOR表里，和WF_TASK、WF_HIST_TASK类似，这样回退时，就知道以前这一步是谁处理的。</p> <p>假如现在执行节点的任务是A2，上述中wf_task存的是执行中的记录，也就是说在执行A2前，wf_task中肯定会有一条执行中的任务记录，假设为A1，那么执行A2时的增删改为先将wf_task和wf_task_actor表中A1的记录插入wf_hist_task和wf_hist_task_actor中；其次是删除wf_task和wf_task_actor中A1记录，然后将A2的信息插入到wf_task和wf_task_actor中。此时wf_task表的parent_task_id是历史表A1记录的Id，通过此可将所有任务串联起来。task表的variable中的值为局部变量只能在当前task中使用。有人会有疑问，假设有如下流程图，执行task1时会怎么样？</p> <p>因为开始节点是一个比较特殊的nodemodel，称之为流转逻辑元素，它只负责流转到下一节点不负责执行，也就没有数据库的增删改。这样直接流转到task1，插入wf_hist_task和wf_hist_task_actor，并且又直接流转到end节点，end节点也是一个流转元素，它会直接删除wf_order表的记录并更改该流程实例wf_hist_order表的order_state的状态。</p> <p>至此一个流程的所有增删改查结束。</p> </li></ol> 
<h4><a id="_43"></a>项目整合</h4> 
<h5><a id="pomsnakeflow_45"></a>pom引入snakeflow依赖</h5> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.github.snakerflow<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>snaker-spring<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.5.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.github.snakerflow<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>snaker-mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.4.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.github.snakerflow<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>snaker-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.5.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h5><a id="_65"></a>根据业务设计流程定义</h5> 
<p>官方的流程设计器比较老旧比较丑，推荐一个第三方图形化的流程设计器：<a href="https://vueadmin.mldong.com/wf/modelDesigner/index" rel="nofollow" title="模型设计 - mldong快速开发平台">模型设计 - mldong快速开发平台</a></p> 
<p><img src="https://images2.imgbox.com/5a/49/4AQcHgnE_o.png" alt="请添加图片描述"></p> 
<p>界面如上图，根据自己的业务需求，设计出相应的流程图，然后点击<strong>查看</strong>按钮导出xml代码：</p> 
<p><img src="https://images2.imgbox.com/b6/98/Z5929jMC_o.png" alt="请添加图片描述"></p> 
<p>在项目的resources目录下新建.snaker后缀的流程定义文件，将xml代码复制进去，此文件即为流程定义模型文件，工作流引擎会自动生成对应的流程定义模型。</p> 
<p><img src="https://images2.imgbox.com/97/43/ue5nbU7x_o.png" alt="请添加图片描述"></p> 
<p>具体xml代码：</p> 
<pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>process</span>  <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>payreq<span class="token punctuation">"</span></span> <span class="token attr-name">displayName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>付款申请流程<span class="token punctuation">"</span></span> <span class="token attr-name">instanceUrl</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/snaker/flow/all<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>start</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>start<span class="token punctuation">"</span></span> <span class="token attr-name">displayName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>开始<span class="token punctuation">"</span></span> <span class="token attr-name">layout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>780,-180,120,80<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>b288a53d-e54e-473d-8ed1-fc4fa21f0210<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>apply<span class="token punctuation">"</span></span> <span class="token attr-name">g</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>780,-162;780,-132;780,-132;780,-130;780,-130;780,-100<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>start</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>task</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>apply<span class="token punctuation">"</span></span> <span class="token attr-name">displayName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>付款申请<span class="token punctuation">"</span></span> <span class="token attr-name">layout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>780,-60,120,80<span class="token punctuation">"</span></span> <span class="token attr-name">assignee</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>apply.operator<span class="token punctuation">"</span></span> <span class="token attr-name">performType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ANY<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0796e532-f9fd-414d-81a8-04415bae48f2<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>gbmjl<span class="token punctuation">"</span></span> <span class="token attr-name">g</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>780,-20;780,10;780,10;780,-10;780,-10;780,20<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>task</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>task</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>gbmjl<span class="token punctuation">"</span></span> <span class="token attr-name">displayName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>各部门经理<span class="token punctuation">"</span></span> <span class="token attr-name">layout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>780,60,120,80<span class="token punctuation">"</span></span> <span class="token attr-name">assignmentHandler</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.yorma.flow.handle.GBMJLHandler<span class="token punctuation">"</span></span> <span class="token attr-name">performType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ANY<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>de03eafd-5a16-41d1-94b1-eb72864be456<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>30e3c5fe-aa7d-4cdf-98e5-85613d61e2c1<span class="token punctuation">"</span></span> <span class="token attr-name">g</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>780,100;780,130;780,130;780,125;780,125;780,155<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>task</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>decision</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>30e3c5fe-aa7d-4cdf-98e5-85613d61e2c1<span class="token punctuation">"</span></span> <span class="token attr-name">layout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>780,180,120,80<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>59bdf184-7a83-4bcd-9ad8-19ce53d47f2c<span class="token punctuation">"</span></span> <span class="token attr-name">displayName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>代垫已收款<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cwjl<span class="token punctuation">"</span></span> <span class="token attr-name">expr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#isddysk == 1<span class="token punctuation">"</span></span> <span class="token attr-name">g</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>805,180;1090,180;1090,700;840,700<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>70239222-b35d-46ef-a8f8-c4e62c27a46e<span class="token punctuation">"</span></span> <span class="token attr-name">displayName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>非代垫已收款<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>fgbmld<span class="token punctuation">"</span></span> <span class="token attr-name">expr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#isddysk == 0<span class="token punctuation">"</span></span> <span class="token attr-name">g</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>780,205;780,235;780,235;780,250;780,250;780,280<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>decision</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>task</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cwjl<span class="token punctuation">"</span></span> <span class="token attr-name">displayName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>财务经理<span class="token punctuation">"</span></span> <span class="token attr-name">layout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>780,700,120,80<span class="token punctuation">"</span></span> <span class="token attr-name">assignee</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cwjl.operator<span class="token punctuation">"</span></span> <span class="token attr-name">performType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ANY<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cd789408-b162-4918-9a5b-62f91c6fa266<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cnfk<span class="token punctuation">"</span></span> <span class="token attr-name">g</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>780,740;780,800<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>task</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>task</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cnfk<span class="token punctuation">"</span></span> <span class="token attr-name">displayName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>出纳付款<span class="token punctuation">"</span></span> <span class="token attr-name">layout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>780,840,120,80<span class="token punctuation">"</span></span> <span class="token attr-name">assignee</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cnfk.operator<span class="token punctuation">"</span></span> <span class="token attr-name">performType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ANY<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>e2d934c5-a656-4870-a984-3874cfc24d0e<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1cb24741-9c96-4624-a9b9-311b4327b007<span class="token punctuation">"</span></span> <span class="token attr-name">g</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>780,880;780,962<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>task</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>end</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1cb24741-9c96-4624-a9b9-311b4327b007<span class="token punctuation">"</span></span> <span class="token attr-name">displayName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>结束<span class="token punctuation">"</span></span> <span class="token attr-name">layout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>780,980,120,80<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>end</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>task</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>fgbmld<span class="token punctuation">"</span></span> <span class="token attr-name">displayName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>分管部门领导<span class="token punctuation">"</span></span> <span class="token attr-name">layout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>780,320,120,80<span class="token punctuation">"</span></span> <span class="token attr-name">assignee</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>fgbmld.operator<span class="token punctuation">"</span></span> <span class="token attr-name">performType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ANY<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1eec0e66-d27c-4968-a1bc-0af8369faad0<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>8d46ec89-91d2-4ab3-b4e0-03d603beb2a1<span class="token punctuation">"</span></span> <span class="token attr-name">g</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>780,360;780,390;780,390;780,365;780,365;780,395<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>task</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>decision</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>8d46ec89-91d2-4ab3-b4e0-03d603beb2a1<span class="token punctuation">"</span></span> <span class="token attr-name">layout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>780,420,120,80<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>b4210332-ea95-4b5c-9a4f-9b7efa71fab1<span class="token punctuation">"</span></span> <span class="token attr-name">displayName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>代垫未收款<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>3a5427a1-fd3b-4638-9f3e-cf0960b30a76<span class="token punctuation">"</span></span> <span class="token attr-name">expr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#moneyType == 3<span class="token punctuation">"</span></span> <span class="token attr-name">g</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>805,420;980,420;980,535<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cd19027f-df5e-4c88-bc22-f3645fd4774e<span class="token punctuation">"</span></span> <span class="token attr-name">displayName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>业务款项<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0715456f-f696-4d28-b4fc-ae1380349278<span class="token punctuation">"</span></span> <span class="token attr-name">expr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#moneyType == 1<span class="token punctuation">"</span></span> <span class="token attr-name">g</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>755,420;300,420;300,535<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>decision</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>decision</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>3a5427a1-fd3b-4638-9f3e-cf0960b30a76<span class="token punctuation">"</span></span> <span class="token attr-name">layout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>980,560,120,80<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>e24c7368-b555-4ff5-af2b-eabc8e4e3f0d<span class="token punctuation">"</span></span> <span class="token attr-name">displayName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>5W以上<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>zjldsz<span class="token punctuation">"</span></span> <span class="token attr-name">expr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#wskMoney <span class="token entity named-entity" title="&gt;">&amp;gt;</span>= 50000<span class="token punctuation">"</span></span> <span class="token attr-name">g</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>955,560;840,560<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>5cf86118-b12e-4378-8b55-987ad6310ea7<span class="token punctuation">"</span></span> <span class="token attr-name">displayName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>5W以下<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cwjl<span class="token punctuation">"</span></span> <span class="token attr-name">expr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#wskMoney <span class="token entity named-entity" title="&lt;">&amp;lt;</span> 50000<span class="token punctuation">"</span></span> <span class="token attr-name">g</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>980,585;980,700;840,700<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>decision</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>task</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>zjldsz<span class="token punctuation">"</span></span> <span class="token attr-name">displayName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>总经理董事长<span class="token punctuation">"</span></span> <span class="token attr-name">layout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>780,560,120,80<span class="token punctuation">"</span></span> <span class="token attr-name">assignee</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>zjldsz.operator<span class="token punctuation">"</span></span> <span class="token attr-name">performType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ANY<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>f30af5a8-f9f0-4fe8-acb3-6f7f0b46e219<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cwjl<span class="token punctuation">"</span></span> <span class="token attr-name">g</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>780,600;780,660<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>task</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>decision</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0715456f-f696-4d28-b4fc-ae1380349278<span class="token punctuation">"</span></span> <span class="token attr-name">layout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>300,560,120,80<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cb99aefa-c5da-4492-baef-166b60607851<span class="token punctuation">"</span></span> <span class="token attr-name">displayName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>人民币<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>c72c188c-6ad3-49f6-abf9-e501fb68e315<span class="token punctuation">"</span></span> <span class="token attr-name">expr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#currtype == 1<span class="token punctuation">"</span></span> <span class="token attr-name">g</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>325,560;475,560<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>776eaba1-1ef1-4ef7-982e-67c141e6141a<span class="token punctuation">"</span></span> <span class="token attr-name">displayName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>美元<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>a32c6d94-d4a2-402e-aa29-f4938c01bdb9<span class="token punctuation">"</span></span> <span class="token attr-name">expr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#currtype == 2<span class="token punctuation">"</span></span> <span class="token attr-name">g</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>300,585;300,780;475,780<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>decision</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>decision</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>c72c188c-6ad3-49f6-abf9-e501fb68e315<span class="token punctuation">"</span></span> <span class="token attr-name">layout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>500,560,120,80<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>99d8103a-f619-4631-a26e-4a9574cc5023<span class="token punctuation">"</span></span> <span class="token attr-name">displayName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>人民币20W以下<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cwjl<span class="token punctuation">"</span></span> <span class="token attr-name">expr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#ywMoney <span class="token entity named-entity" title="&lt;">&amp;lt;</span> 200000<span class="token punctuation">"</span></span> <span class="token attr-name">g</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>500,585;500,700;720,700<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0bb52a5e-357c-4bd3-a653-4275692f9173<span class="token punctuation">"</span></span> <span class="token attr-name">displayName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>人民币20W以上<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>zjldsz<span class="token punctuation">"</span></span> <span class="token attr-name">expr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#ywMoney <span class="token entity named-entity" title="&gt;">&amp;gt;</span>= 200000<span class="token punctuation">"</span></span> <span class="token attr-name">g</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>500,535;500,499;780,499;780,520<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>decision</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>decision</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>a32c6d94-d4a2-402e-aa29-f4938c01bdb9<span class="token punctuation">"</span></span> <span class="token attr-name">layout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>500,780,120,80<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>b9850dba-8b59-4c28-97f7-c9f07ebb5515<span class="token punctuation">"</span></span> <span class="token attr-name">displayName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>美元3W以上<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>zjldsz<span class="token punctuation">"</span></span> <span class="token attr-name">expr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#ywMoney <span class="token entity named-entity" title="&gt;">&amp;gt;</span>= 30000<span class="token punctuation">"</span></span> <span class="token attr-name">g</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>525,780;555,780;555,559;720,559<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>7eb1d054-ae82-4972-921b-aede3a7e27e6<span class="token punctuation">"</span></span> <span class="token attr-name">displayName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>美元3W以下<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cwjl<span class="token punctuation">"</span></span> <span class="token attr-name">expr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#ywMoney <span class="token entity named-entity" title="&lt;">&amp;lt;</span> 30000<span class="token punctuation">"</span></span> <span class="token attr-name">g</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>500,805;500,835;690,835;690,700;720,700<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>decision</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>process</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>当然，流程设计器也支持根据xml生成流程图，方便修改流程图，点击导入按钮粘贴xml即可：</p> 
<p><img src="https://images2.imgbox.com/3c/91/XJzQ1D00_o.png" alt="请添加图片描述"></p> 
<h4><a id="_141"></a>创建流程定义，同时启动一个流程实例执行任务</h4> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>yorma<span class="token punctuation">.</span>flow<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>extension<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl<span class="token punctuation">.</span></span><span class="token class-name">ServiceImpl</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>yorma<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">YmMsg</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>yorma<span class="token punctuation">.</span>flow<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">WfProcess</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>yorma<span class="token punctuation">.</span>flow<span class="token punctuation">.</span>entity<span class="token punctuation">.</span>dto<span class="token punctuation">.</span></span><span class="token class-name">WfProcessParam</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>yorma<span class="token punctuation">.</span>flow<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">WfProcessMapper</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>yorma<span class="token punctuation">.</span>flow<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">ISysUserService</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>yorma<span class="token punctuation">.</span>flow<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">IWfProcessService</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>yorma<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">RedisUtil</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>yorma<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">RequestKit</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>snaker<span class="token punctuation">.</span>engine<span class="token punctuation">.</span></span><span class="token class-name">SnakerEngine</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>snaker<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>access<span class="token punctuation">.</span></span><span class="token class-name">QueryFilter</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>snaker<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">Order</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>snaker<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">Process</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>snaker<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">Task</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">InputStream</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>core<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ObjectUtil</span><span class="token punctuation">.</span>isEmpty<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>core<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">StrUtil</span><span class="token punctuation">.</span>isBlank<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">com<span class="token punctuation">.</span>yorma<span class="token punctuation">.</span>flow<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span><span class="token class-name">Const</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token comment">/**
 * &lt;p&gt;
 * 流程定义表 服务实现类
 * &lt;/p&gt;
 *
 * @author ZHANGCHAO
 * @since 2022-06-22
 */</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WfProcessServiceImpl</span> <span class="token keyword">extends</span> <span class="token class-name">ServiceImpl</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">WfProcessMapper</span><span class="token punctuation">,</span> <span class="token class-name">WfProcess</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">IWfProcessService</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">SnakerEngine</span> engine<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">ISysUserService</span> userService<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RedisUtil</span> redisUtil<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 获取或创建流程定义并启动流程实例执行任务
     *
     * @param processParam
     * @return com.yorma.entity.YmMsg&lt;org.snaker.engine.entity.Process&gt;
     * @apiNote &lt;pre&gt;
     *   获取或创建流程定义并启动流程实例执行任务
     * &lt;/pre&gt;
     * @author ZHANGCHAO 2022/6/22 16:51
     * @version 1.0
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">YmMsg</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Order</span><span class="token punctuation">&gt;</span></span> <span class="token function">initAndStartProcess</span><span class="token punctuation">(</span><span class="token class-name">WfProcessParam</span> processParam<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isBlank</span><span class="token punctuation">(</span>processParam<span class="token punctuation">.</span><span class="token function">getFlowFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token class-name">YmMsg</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"未知的流程定义！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">String</span> tenantId <span class="token operator">=</span> <span class="token class-name">RequestKit</span><span class="token punctuation">.</span><span class="token function">getRequestIn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span>TENANT_ID<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> token <span class="token operator">=</span> <span class="token class-name">RequestKit</span><span class="token punctuation">.</span><span class="token function">getRequestIn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span>HEADER_TOKEN<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 从redis获取当前登录用户名</span>
        <span class="token class-name">String</span> username <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> redisUtil<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>PREFIX_USER_TOKEN_INFO <span class="token operator">+</span> token<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>USERNAME<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> userId <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">getUserId</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> tenantId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> args <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        args<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"apply.operator"</span><span class="token punctuation">,</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Process</span> process<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>processParam<span class="token punctuation">.</span><span class="token function">isNewProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">String</span> deploy <span class="token operator">=</span> <span class="token function">initFlows</span><span class="token punctuation">(</span>processParam<span class="token punctuation">.</span><span class="token function">getFlowFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
            process <span class="token operator">=</span> engine<span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getProcessById</span><span class="token punctuation">(</span>deploy<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">QueryFilter</span> filter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span>processParam<span class="token punctuation">.</span><span class="token function">getFlowFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orderBy</span><span class="token punctuation">(</span><span class="token string">"version"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">order</span><span class="token punctuation">(</span><span class="token string">"DESC"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Process</span><span class="token punctuation">&gt;</span></span> processList <span class="token operator">=</span> engine<span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getProcesss</span><span class="token punctuation">(</span>filter<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>processList<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">String</span> deploy <span class="token operator">=</span> <span class="token function">initFlows</span><span class="token punctuation">(</span>processParam<span class="token punctuation">.</span><span class="token function">getFlowFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
                process <span class="token operator">=</span> engine<span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getProcessById</span><span class="token punctuation">(</span>deploy<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                process <span class="token operator">=</span> processList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>process<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token class-name">YmMsg</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"未获取到流程定义！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"[initAndStartProcess]获取到的流程定义process："</span> <span class="token operator">+</span> process<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 启动实例</span>
        <span class="token class-name">Order</span> order <span class="token operator">=</span> engine<span class="token punctuation">.</span><span class="token function">startInstanceById</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> userId<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"[initAndStartProcess]获取到的流程实例order："</span> <span class="token operator">+</span> order<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Task</span><span class="token punctuation">&gt;</span></span> tasks <span class="token operator">=</span> engine<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getActiveTasks</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span>order<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>tasks<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token class-name">YmMsg</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"流程实例Order["</span> <span class="token operator">+</span> order<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"]下无活动的任务列表！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Task</span><span class="token punctuation">&gt;</span></span> newTasks <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>tasks <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> tasks<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">Task</span> task <span class="token operator">=</span> tasks<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            newTasks<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>engine<span class="token punctuation">.</span><span class="token function">executeTask</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> userId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token class-name">YmMsg</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 初始化状态机流程
     *
     * @return 流程主键
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">initFlows</span><span class="token punctuation">(</span><span class="token class-name">String</span> flowFile<span class="token punctuation">,</span> <span class="token class-name">String</span> creator<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">ClassLoader</span> classLoader <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getContextClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">InputStream</span> stream <span class="token operator">=</span> classLoader<span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span><span class="token string">"flows/flowFile.snaker"</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"flowFile"</span><span class="token punctuation">,</span> flowFile<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> engine<span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">deploy</span><span class="token punctuation">(</span>stream<span class="token punctuation">,</span> creator<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>调用此方法后，会根据传进来的流程定义名称去生成相应的流程定义并启动一个实例，而且此处让其自动执行了下一节点，因为下一节点的操作人也是流程发起人。执行完后，到达了2节点：</p> 
<p><img src="https://images2.imgbox.com/1f/0b/E76sKCpj_o.png" alt="请添加图片描述"></p> 
<h4><a id="_269"></a>任务执行方法，即节点的移动逻辑</h4> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>yorma<span class="token punctuation">.</span>flow<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>extension<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl<span class="token punctuation">.</span></span><span class="token class-name">ServiceImpl</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>yorma<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">YmMsg</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>yorma<span class="token punctuation">.</span>flow<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">WfTask</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>yorma<span class="token punctuation">.</span>flow<span class="token punctuation">.</span>entity<span class="token punctuation">.</span>dto<span class="token punctuation">.</span></span><span class="token class-name">WfConstants</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>yorma<span class="token punctuation">.</span>flow<span class="token punctuation">.</span>entity<span class="token punctuation">.</span>dto<span class="token punctuation">.</span></span><span class="token class-name">WfTaskParam</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>yorma<span class="token punctuation">.</span>flow<span class="token punctuation">.</span>entity<span class="token punctuation">.</span>dto<span class="token punctuation">.</span></span><span class="token class-name">WfWorkItemParam</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>yorma<span class="token punctuation">.</span>flow<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">WfTaskMapper</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>yorma<span class="token punctuation">.</span>flow<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">ISysUserService</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>yorma<span class="token punctuation">.</span>flow<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">IWfTaskService</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>yorma<span class="token punctuation">.</span>flow<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>exception<span class="token punctuation">.</span></span><span class="token class-name">ExceptionUtil</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>yorma<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">RedisUtil</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>yorma<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">RequestKit</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>snaker<span class="token punctuation">.</span>engine<span class="token punctuation">.</span></span><span class="token class-name">SnakerEngine</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>snaker<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>access<span class="token punctuation">.</span></span><span class="token class-name">Page</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>snaker<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>access<span class="token punctuation">.</span></span><span class="token class-name">QueryFilter</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>snaker<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">Order</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>snaker<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">Task</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>snaker<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">WorkItem</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>snaker<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">EndModel</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>snaker<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">ProcessModel</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>snaker<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">TaskModel</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>core<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ObjectUtil</span><span class="token punctuation">.</span>isEmpty<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>core<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ObjectUtil</span><span class="token punctuation">.</span>isNotEmpty<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>core<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">StrUtil</span><span class="token punctuation">.</span>isNotBlank<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">com<span class="token punctuation">.</span>yorma<span class="token punctuation">.</span>flow<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span><span class="token class-name">Const</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token comment">/**
 * &lt;p&gt;
 * 任务表 服务实现类
 * &lt;/p&gt;
 *
 * @author ZHANGCHAO
 * @since 2022-06-24
 */</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WfTaskServiceImpl</span> <span class="token keyword">extends</span> <span class="token class-name">ServiceImpl</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">WfTaskMapper</span><span class="token punctuation">,</span> <span class="token class-name">WfTask</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">IWfTaskService</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">SnakerEngine</span> engine<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">ISysUserService</span> userService<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RedisUtil</span> redisUtil<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 执行流程任务task
     *
     * @param taskParam
     * @return com.yorma.entity.YmMsg&lt;java.lang.String&gt;
     * @apiNote &lt;pre&gt;
     *   执行流程任务task
     * &lt;/pre&gt;
     * @author ZHANGCHAO 2022/6/24 14:34
     * @version 1.0
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">YmMsg</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">Task</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">executeTask</span><span class="token punctuation">(</span><span class="token class-name">WfTaskParam</span> taskParam<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>taskParam<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token class-name">YmMsg</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"参数[taskParam]不能为空！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Task</span><span class="token punctuation">&gt;</span></span> newTasks<span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">String</span> tenantId <span class="token operator">=</span> <span class="token class-name">RequestKit</span><span class="token punctuation">.</span><span class="token function">getRequestIn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span>TENANT_ID<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> token <span class="token operator">=</span> <span class="token class-name">RequestKit</span><span class="token punctuation">.</span><span class="token function">getRequestIn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span>HEADER_TOKEN<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 从redis获取当前登录用户名</span>
            <span class="token class-name">String</span> username <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> redisUtil<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>PREFIX_USER_TOKEN_INFO <span class="token operator">+</span> token<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>USERNAME<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> userId <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">getUserId</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> tenantId<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 同意</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>taskParam<span class="token punctuation">.</span><span class="token function">getArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">WfConstants</span><span class="token punctuation">.</span>APPROVAL_TYPE<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token operator">||</span> <span class="token string">"1"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>taskParam<span class="token punctuation">.</span><span class="token function">getArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">WfConstants</span><span class="token punctuation">.</span>APPROVAL_TYPE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isNotBlank</span><span class="token punctuation">(</span>taskParam<span class="token punctuation">.</span><span class="token function">getTaskId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Task</span><span class="token punctuation">&gt;</span></span> tasks <span class="token operator">=</span> engine<span class="token punctuation">.</span><span class="token function">executeTask</span><span class="token punctuation">(</span>taskParam<span class="token punctuation">.</span><span class="token function">getTaskId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> userId<span class="token punctuation">,</span> taskParam<span class="token punctuation">.</span><span class="token function">getArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>tasks<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Task</span> task <span class="token operator">:</span> tasks<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                            task<span class="token punctuation">.</span><span class="token function">setModel</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">return</span> <span class="token class-name">YmMsg</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>tasks<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Task</span><span class="token punctuation">&gt;</span></span> tasks <span class="token operator">=</span> engine<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getActiveTasks</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span>taskParam<span class="token punctuation">.</span><span class="token function">getOrderId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setOperator</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>tasks<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    tasks <span class="token operator">=</span> engine<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getActiveTasks</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span>taskParam<span class="token punctuation">.</span><span class="token function">getOrderId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>tasks<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">return</span> <span class="token class-name">YmMsg</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"流程实例Order["</span> <span class="token operator">+</span> taskParam<span class="token punctuation">.</span><span class="token function">getOrderId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"]下无活动的任务列表！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                newTasks <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>tasks <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> tasks<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token class-name">Task</span> task <span class="token operator">=</span> tasks<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    newTasks<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>engine<span class="token punctuation">.</span><span class="token function">executeTask</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> userId<span class="token punctuation">,</span> taskParam<span class="token punctuation">.</span><span class="token function">getArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token comment">// 撤回操作，直接结束流程</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>taskParam<span class="token punctuation">.</span><span class="token function">getArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">WfConstants</span><span class="token punctuation">.</span>APPROVAL_TYPE<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token operator">||</span> <span class="token string">"3"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>taskParam<span class="token punctuation">.</span><span class="token function">getArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">WfConstants</span><span class="token punctuation">.</span>APPROVAL_TYPE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">Task</span> task<span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isNotBlank</span><span class="token punctuation">(</span>taskParam<span class="token punctuation">.</span><span class="token function">getTaskId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    task <span class="token operator">=</span> engine<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTask</span><span class="token punctuation">(</span>taskParam<span class="token punctuation">.</span><span class="token function">getTaskId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Task</span><span class="token punctuation">&gt;</span></span> tasks <span class="token operator">=</span> engine<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getActiveTasks</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span>taskParam<span class="token punctuation">.</span><span class="token function">getOrderId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    task <span class="token operator">=</span> <span class="token function">isNotEmpty</span><span class="token punctuation">(</span>tasks<span class="token punctuation">)</span> <span class="token operator">?</span> tasks<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Task</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token class-name">Order</span> order <span class="token operator">=</span> engine<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getOrder</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getOrderId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 1.2 直接跳到结束节点</span>
                <span class="token class-name">ProcessModel</span> processModel <span class="token operator">=</span> engine<span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getProcessById</span><span class="token punctuation">(</span>order<span class="token punctuation">.</span><span class="token function">getProcessId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                engine<span class="token punctuation">.</span><span class="token function">executeAndJumpTask</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> userId<span class="token punctuation">,</span> taskParam<span class="token punctuation">.</span><span class="token function">getArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> processModel<span class="token punctuation">.</span><span class="token function">getModels</span><span class="token punctuation">(</span><span class="token class-name">EndModel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                newTasks <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 不同意</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 1.1 给流程实例追加额外参数</span>
                <span class="token class-name">Task</span> task<span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isNotBlank</span><span class="token punctuation">(</span>taskParam<span class="token punctuation">.</span><span class="token function">getTaskId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    task <span class="token operator">=</span> engine<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTask</span><span class="token punctuation">(</span>taskParam<span class="token punctuation">.</span><span class="token function">getTaskId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Task</span><span class="token punctuation">&gt;</span></span> tasks <span class="token operator">=</span> engine<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getActiveTasks</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span>taskParam<span class="token punctuation">.</span><span class="token function">getOrderId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    task <span class="token operator">=</span> <span class="token function">isNotEmpty</span><span class="token punctuation">(</span>tasks<span class="token punctuation">)</span> <span class="token operator">?</span> tasks<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Task</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token class-name">Order</span> order <span class="token operator">=</span> engine<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getOrder</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getOrderId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//                Map&lt;String, Object&gt; addArgs = new HashMap&lt;&gt;(taskParam.getArgs());</span>
<span class="token comment">//                addArgs.put(WfConstants.ORDER_STATE_KEY, WfOrderStateEnum.DISAGREE.getValue());</span>
<span class="token comment">//                engine.order().addVariable(taskParam.getOrderId(), addArgs);</span>
                <span class="token comment">// 1.2 直接跳到结束节点</span>
                <span class="token class-name">ProcessModel</span> processModel <span class="token operator">=</span> engine<span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getProcessById</span><span class="token punctuation">(</span>order<span class="token punctuation">.</span><span class="token function">getProcessId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//                engine.executeAndJumpTask(task.getId(), userId, taskParam.getArgs(), processModel.getModels(EndModel.class).get(0).getName());</span>
                <span class="token comment">// 跳到流程发起点</span>
                engine<span class="token punctuation">.</span><span class="token function">executeAndJumpTask</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> userId<span class="token punctuation">,</span> taskParam<span class="token punctuation">.</span><span class="token function">getArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> processModel<span class="token punctuation">.</span><span class="token function">getModels</span><span class="token punctuation">(</span><span class="token class-name">TaskModel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                newTasks <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>newTasks<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Task</span> task <span class="token operator">:</span> newTasks<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    task<span class="token punctuation">.</span><span class="token function">setModel</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">ExceptionUtil</span><span class="token punctuation">.</span><span class="token function">getFullStackTrace</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token class-name">YmMsg</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token class-name">YmMsg</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>newTasks<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>每次执行此方法，都会执行当前节点的任务，然后移动到下一节点。</p> 
<blockquote> 
 <p>📌注意：每次执行任务时，都需要把下一节点的操作人即任务决策者标识传入进去，不然引擎无法知晓下一节点决策者是谁，也就无法验证权限！</p> 
</blockquote> 
<p>snakeflow的任务参与者支持三种方式：</p> 
<ul><li> <p>直接设置静态参与者，即assignee值为用户、部门或角色的标识符</p> </li><li> <p>通过运行时动态传递，即assignee值为变量名称，在调用流程引擎的api时，通过map参数传递这个变量值</p> </li><li> <p>通过自定义类[继承Assignment类]，设置assignmentHandler属性，assign方法返回值就是参与者</p> </li></ul> 
<h4><a id="_439"></a>任务执行预处理</h4> 
<p>项目采用的RPC调用方式：前端调用中间服务，中间服务再通过RPC调用流程的任务执行接口。中间服务的预处理方法可以设置参数，设置流程参与者：</p> 
<pre><code class="prism language-java"> <span class="token comment">/**
     * 执行任务前的预处理
     *
     * @param approvalDTO
     * @return com.yorma.entity.YmMsg&lt;java.lang.String&gt;
     * @apiNote &lt;pre&gt;
     *   执行任务前的预处理
     * &lt;/pre&gt;
     * @author ZHANGCHAO 2022/6/28 16:18
     * @version 1.0
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">YmMsg</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">dealAndExecuteTask</span><span class="token punctuation">(</span><span class="token class-name">ApprovalDTO</span> approvalDTO<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>approvalDTO<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token class-name">YmMsg</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"参数[审批意见对象DTO]不能为空！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isBlank</span><span class="token punctuation">(</span>approvalDTO<span class="token punctuation">.</span><span class="token function">getApprovalType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token class-name">YmMsg</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"未知的处理意见类型！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isBlank</span><span class="token punctuation">(</span>approvalDTO<span class="token punctuation">.</span><span class="token function">getTaskName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token class-name">YmMsg</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"未知的任务名称！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">String</span> tenantId <span class="token operator">=</span> <span class="token class-name">RequestKit</span><span class="token punctuation">.</span><span class="token function">getRequestIn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span>TENANT_ID<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">WfTaskParam</span> wfTaskParam <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WfTaskParam</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> args <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">TaskNodePaymentEnum</span> nodePaymentEnum <span class="token operator">=</span> <span class="token class-name">TaskNodePaymentEnum</span><span class="token punctuation">.</span><span class="token function">getEnum</span><span class="token punctuation">(</span>approvalDTO<span class="token punctuation">.</span><span class="token function">getTaskName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"[dealAndExecuteTask]任务名称："</span> <span class="token operator">+</span> approvalDTO<span class="token punctuation">.</span><span class="token function">getTaskName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>nodePaymentEnum<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token class-name">YmMsg</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"未知的任务节点！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">/*
         * 执行任务时，需传递下一节点处理人！！
         * 2022/6/28 17:36@ZHANGCHAO
         */</span>
        <span class="token class-name">AccountPutPayment</span> payment <span class="token operator">=</span> baseMapper<span class="token punctuation">.</span><span class="token function">selectById</span><span class="token punctuation">(</span>approvalDTO<span class="token punctuation">.</span><span class="token function">getPaymentId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>payment<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token class-name">YmMsg</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"未获取到流水号["</span> <span class="token operator">+</span> approvalDTO<span class="token punctuation">.</span><span class="token function">getPaymentId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"]的付款申请数据！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">requireNonNull</span><span class="token punctuation">(</span>nodePaymentEnum<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">case</span> GBMJL_NODE<span class="token operator">:</span> <span class="token comment">// 执行[各部门经理]节点，代垫已收款类型，前端自动传下一节点[分管部门领]的流程处理人</span>
                <span class="token comment">// 代垫已收款，直接走财务经理</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>payment<span class="token punctuation">.</span><span class="token function">getIsDd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isNotEmpty</span><span class="token punctuation">(</span>payment<span class="token punctuation">.</span><span class="token function">getIsPut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> payment<span class="token punctuation">.</span><span class="token function">getIsDd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> payment<span class="token punctuation">.</span><span class="token function">getIsPut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    args<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"isddysk"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    args<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"cwjl.operator"</span><span class="token punctuation">,</span> <span class="token function">getUserIdsByCond</span><span class="token punctuation">(</span><span class="token string">"财务部"</span><span class="token punctuation">,</span> tenantId<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 下一节点财务经理处理人</span>
                    <span class="token comment">// 非代垫已收款</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                    args<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"isddysk"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token string">"2"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>approvalDTO<span class="token punctuation">.</span><span class="token function">getApprovalType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isBlank</span><span class="token punctuation">(</span>approvalDTO<span class="token punctuation">.</span><span class="token function">getFgbmldUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                            <span class="token keyword">return</span> <span class="token class-name">YmMsg</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"无法获取下一节点[分管部门领导]的流程处理人！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                    args<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"fgbmld.operator"</span><span class="token punctuation">,</span> <span class="token function">isNotBlank</span><span class="token punctuation">(</span>approvalDTO<span class="token punctuation">.</span><span class="token function">getFgbmldUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">?</span> approvalDTO<span class="token punctuation">.</span><span class="token function">getFgbmldUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 下一节点处理人</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> FGBMLD_NODE<span class="token operator">:</span> <span class="token comment">// 执行[分管部门领导]节点</span>
                <span class="token comment">// 付款申请币制</span>
                <span class="token class-name">String</span> curr <span class="token operator">=</span> <span class="token function">isNotBlank</span><span class="token punctuation">(</span>payment<span class="token punctuation">.</span><span class="token function">getCurr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">?</span> payment<span class="token punctuation">.</span><span class="token function">getCurr</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">"CNY"</span><span class="token punctuation">;</span>
                <span class="token comment">// 费用</span>
                <span class="token class-name">BigDecimal</span> payAmount <span class="token operator">=</span> <span class="token function">isEmpty</span><span class="token punctuation">(</span>payment<span class="token punctuation">.</span><span class="token function">getAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">.</span>ZERO <span class="token operator">:</span> payment<span class="token punctuation">.</span><span class="token function">getAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 代垫已收款，直接走财务经理</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>payment<span class="token punctuation">.</span><span class="token function">getIsDd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isNotEmpty</span><span class="token punctuation">(</span>payment<span class="token punctuation">.</span><span class="token function">getIsPut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> payment<span class="token punctuation">.</span><span class="token function">getIsDd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> payment<span class="token punctuation">.</span><span class="token function">getIsPut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">return</span> <span class="token class-name">YmMsg</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"执行[分管部门领导]节点，费用类型为[代垫已收款]无法继续执行工作流！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token comment">// 代垫未付款</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>payment<span class="token punctuation">.</span><span class="token function">getIsDd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> payment<span class="token punctuation">.</span><span class="token function">getIsDd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>payment<span class="token punctuation">.</span><span class="token function">getIsPut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span>payment<span class="token punctuation">.</span><span class="token function">getIsPut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">// 代垫已收款，to财务经理</span>
<span class="token comment">//                    if (isNotEmpty(putPayment.getIsPut()) &amp;&amp; putPayment.getIsPut()) {<!-- --></span>
<span class="token comment">//                        args.put("moneyType", 2);</span>
<span class="token comment">//                        args.put("cwjl.operator", getUserIdsByCond("财务部", tenantId, 2)); // 下一节点财务经理处理人</span>
<span class="token comment">//                        // 代垫未收款</span>
<span class="token comment">//                    } else {<!-- --></span>
                        args<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"moneyType"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        args<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"wskMoney"</span><span class="token punctuation">,</span> payAmount<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token comment">// 小于5W，to财务经理</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>payAmount<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">"50000"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                            args<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"cwjl.operator"</span><span class="token punctuation">,</span> <span class="token function">getUserIdsByCond</span><span class="token punctuation">(</span><span class="token string">"财务部"</span><span class="token punctuation">,</span> tenantId<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 下一节点财务经理处理人</span>
                            <span class="token comment">// 大于5W，to总经理董事长</span>
                        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                            args<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"zjldsz.operator"</span><span class="token punctuation">,</span> <span class="token function">getUserIdsByCond</span><span class="token punctuation">(</span><span class="token string">"总经办"</span><span class="token punctuation">,</span> tenantId<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 下一节点总经理董事长处理人</span>
                        <span class="token punctuation">}</span>
<span class="token comment">//                    }</span>
                    <span class="token comment">// 业务款项</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                    args<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"moneyType"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    args<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"ywMoney"</span><span class="token punctuation">,</span> payAmount<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"CNY"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>curr<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        args<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"currtype"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token comment">// 小于20W，to财务经理</span>
                        <span class="token comment">// 2022/7/27 16:14@ZHANGCHAO 追加/变更/完善：人民币20W或者美元3W以下的为财务经理</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>payAmount<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">"200000"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                            args<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"cwjl.operator"</span><span class="token punctuation">,</span> <span class="token function">getUserIdsByCond</span><span class="token punctuation">(</span><span class="token string">"财务部"</span><span class="token punctuation">,</span> tenantId<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 下一节点财务经理处理人</span>
                            <span class="token comment">// 大于20W，to总经理董事长</span>
                            <span class="token comment">// 2022/7/27 16:14@ZHANGCHAO 追加/变更/完善：人民币20W或者美元3W以上的（包含）</span>
                        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                            args<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"zjldsz.operator"</span><span class="token punctuation">,</span> <span class="token function">getUserIdsByCond</span><span class="token punctuation">(</span><span class="token string">"总经办"</span><span class="token punctuation">,</span> tenantId<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 下一节点总经理董事长处理人</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"USD"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>curr<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        args<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"currtype"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token comment">// 小于20W，to财务经理</span>
                        <span class="token comment">// 2022/7/27 16:14@ZHANGCHAO 追加/变更/完善：人民币20W或者美元3W以下的为财务经理</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>payAmount<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">"30000"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                            args<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"cwjl.operator"</span><span class="token punctuation">,</span> <span class="token function">getUserIdsByCond</span><span class="token punctuation">(</span><span class="token string">"财务部"</span><span class="token punctuation">,</span> tenantId<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 下一节点财务经理处理人</span>
                            <span class="token comment">// 大于20W，to总经理董事长</span>
                            <span class="token comment">// 2022/7/27 16:14@ZHANGCHAO 追加/变更/完善：人民币20W或者美元3W以上的（包含）</span>
                        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                            args<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"zjldsz.operator"</span><span class="token punctuation">,</span> <span class="token function">getUserIdsByCond</span><span class="token punctuation">(</span><span class="token string">"总经办"</span><span class="token punctuation">,</span> tenantId<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 下一节点总经理董事长处理人</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                        args<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"currtype"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token comment">// 小于20W，to财务经理</span>
                        <span class="token comment">// 2022/7/27 16:14@ZHANGCHAO 追加/变更/完善：人民币20W或者美元3W以下的为财务经理</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>payAmount<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">"200000"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                            args<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"cwjl.operator"</span><span class="token punctuation">,</span> <span class="token function">getUserIdsByCond</span><span class="token punctuation">(</span><span class="token string">"财务部"</span><span class="token punctuation">,</span> tenantId<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 下一节点财务经理处理人</span>
                            <span class="token comment">// 大于20W，to总经理董事长</span>
                            <span class="token comment">// 2022/7/27 16:14@ZHANGCHAO 追加/变更/完善：人民币20W或者美元3W以上的（包含）</span>
                        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                            args<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"zjldsz.operator"</span><span class="token punctuation">,</span> <span class="token function">getUserIdsByCond</span><span class="token punctuation">(</span><span class="token string">"总经办"</span><span class="token punctuation">,</span> tenantId<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 下一节点总经理董事长处理人</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> ZJLDSZ_NODE<span class="token operator">:</span> <span class="token comment">// 执行[总经理董事长]节点</span>
                args<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"cwjl.operator"</span><span class="token punctuation">,</span> <span class="token function">getUserIdsByCond</span><span class="token punctuation">(</span><span class="token string">"财务部"</span><span class="token punctuation">,</span> tenantId<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 下一节点财务经理处理人</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> CWJL_NODE<span class="token operator">:</span> <span class="token comment">// 执行[财务经理]节点</span>
                args<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"cnfk.operator"</span><span class="token punctuation">,</span> <span class="token function">getUserIdsByCond</span><span class="token punctuation">(</span><span class="token string">"财务部"</span><span class="token punctuation">,</span> tenantId<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 下一节点出纳付款处理人</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> CNFK_NODE<span class="token operator">:</span> <span class="token comment">// 出纳付款，直接结束任务</span>
                <span class="token comment">// TODO: ...</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> APPLY_NODE<span class="token operator">:</span> <span class="token comment">// 重新跳转到流程发起点</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">default</span><span class="token operator">:</span>
        <span class="token punctuation">}</span>
        args<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>APPROVAL_TYPE<span class="token punctuation">,</span> approvalDTO<span class="token punctuation">.</span><span class="token function">getApprovalType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 意见类型</span>
        args<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>OPINION<span class="token punctuation">,</span> approvalDTO<span class="token punctuation">.</span><span class="token function">getOpinion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 处理意见</span>
        wfTaskParam<span class="token punctuation">.</span><span class="token function">setTaskId</span><span class="token punctuation">(</span>approvalDTO<span class="token punctuation">.</span><span class="token function">getTaskId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 任务ID</span>
        wfTaskParam<span class="token punctuation">.</span><span class="token function">setArgs</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">YmMsg</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">Task</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> taskYmMsg <span class="token operator">=</span> <span class="token class-name">RpcKit</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>flowApi<span class="token punctuation">,</span> <span class="token class-name">FlowApi</span><span class="token operator">::</span><span class="token function">executeTask</span><span class="token punctuation">,</span> wfTaskParam<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>taskYmMsg<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> users <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 2022/6/29 14:37@ZHANGCHAO 追加/变更/完善：执行成功发送消息！</span>
            wfTaskParam<span class="token punctuation">.</span><span class="token function">getArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>k<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"operator"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token function">sendMessageForExcute</span><span class="token punctuation">(</span>payment<span class="token punctuation">.</span><span class="token function">getPutNo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> userId <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> v<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                                    <span class="token class-name">SysUser</span> user <span class="token operator">=</span> baseMapper<span class="token punctuation">.</span><span class="token function">getUserByUserId</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                                        users<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getRealname</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                    <span class="token punctuation">}</span>
                                <span class="token punctuation">}</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token class-name">ExceptionUtil</span><span class="token punctuation">.</span><span class="token function">getFullStackTrace</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"获取用户真实姓名出现异常："</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>users <span class="token operator">+</span> <span class="token string">"任务执行成功！"</span> <span class="token operator">+</span> taskYmMsg<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> returnMsg <span class="token operator">=</span> <span class="token function">isEmpty</span><span class="token punctuation">(</span>users<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">"操作成功！"</span> <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token string">"操作成功！下一步的流程处理人["</span> <span class="token operator">+</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">,</span> users<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>approvalDTO<span class="token punctuation">.</span><span class="token function">getApprovalType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                returnMsg <span class="token operator">=</span> <span class="token string">"操作成功！已退回到流程发起点！"</span><span class="token punctuation">;</span>
                <span class="token comment">/*
                 * 付款审批如果审批人不同意需要填写理由，并给到申请人提醒
                 * 2022/7/25 14:19@ZHANGCHAO
                 */</span>
                <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token class-name">WfHistTask</span> task <span class="token operator">=</span> wfHistTaskService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>wfTaskParam<span class="token punctuation">.</span><span class="token function">getTaskId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token class-name">WfHistTask</span> wfHistTask <span class="token operator">=</span> wfHistTaskService<span class="token punctuation">.</span><span class="token function">getOne</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">WfHistTask</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lambda</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                <span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">WfHistTask</span><span class="token operator">::</span><span class="token function">getOrderId</span><span class="token punctuation">,</span> task<span class="token punctuation">.</span><span class="token function">getOrderId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                                <span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">WfHistTask</span><span class="token operator">::</span><span class="token function">getTaskName</span><span class="token punctuation">,</span> <span class="token string">"apply"</span><span class="token punctuation">)</span>
                                <span class="token punctuation">.</span><span class="token function">orderByDesc</span><span class="token punctuation">(</span><span class="token class-name">WfHistTask</span><span class="token operator">::</span><span class="token function">getCreateTime</span><span class="token punctuation">)</span>
                                <span class="token punctuation">.</span><span class="token function">last</span><span class="token punctuation">(</span><span class="token string">"LIMIT 1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>wfHistTask<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                            <span class="token function">sendMessageRollback</span><span class="token punctuation">(</span>payment<span class="token punctuation">.</span><span class="token function">getPutNo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> wfHistTask<span class="token punctuation">.</span><span class="token function">getOperator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">ExceptionUtil</span><span class="token punctuation">.</span><span class="token function">getFullStackTrace</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"[dealAndExecuteTask]==&gt;：退回操作发送消息给流程发起人出现异常！！！"</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"3"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>approvalDTO<span class="token punctuation">.</span><span class="token function">getApprovalType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 2022/7/1 9:08@ZHANGCHAO 追加/变更/完善：删除操作，直接删除此付款申请，费用明细取消标记已申请！</span>
                <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AccountPutRel</span><span class="token punctuation">&gt;</span></span> accountPutRelList <span class="token operator">=</span> accountPutRelService<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AccountPutRel</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lambda</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">AccountPutRel</span><span class="token operator">::</span><span class="token function">getClaId</span><span class="token punctuation">,</span> payment<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>accountPutRelList<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> expIds <span class="token operator">=</span> accountPutRelList<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">AccountPutRel</span><span class="token operator">::</span><span class="token function">getExpId</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AccountExpense</span><span class="token punctuation">&gt;</span></span> accountExpenseList <span class="token operator">=</span> accountExpenseMapper<span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AccountExpense</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lambda</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">in</span><span class="token punctuation">(</span><span class="token class-name">AccountExpense</span><span class="token operator">::</span><span class="token function">getId</span><span class="token punctuation">,</span> expIds<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>accountExpenseList<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> accountNos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">AccountExpense</span> accountExpense <span class="token operator">:</span> accountExpenseList<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                            <span class="token comment">// 费用明细标记 是否核销改为0，核销金额清0，核销日期清空、是否已申请改为0</span>
                            accountExpenseMapper<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">UpdateWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AccountExpense</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lambda</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                    <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">AccountExpense</span><span class="token operator">::</span><span class="token function">getIsSq</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
                                    <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">AccountExpense</span><span class="token operator">::</span><span class="token function">getIsHx</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
                                    <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">AccountExpense</span><span class="token operator">::</span><span class="token function">getVerificationAmount</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                                    <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">AccountExpense</span><span class="token operator">::</span><span class="token function">getVerificationData</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                                    <span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">AccountExpense</span><span class="token operator">::</span><span class="token function">getId</span><span class="token punctuation">,</span> accountExpense<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            accountNos<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>accountExpense<span class="token punctuation">.</span><span class="token function">getAccountNo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                        <span class="token function">changeAccountPutStatus</span><span class="token punctuation">(</span>accountNos<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    accountPutRelService<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AccountPutRel</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lambda</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">AccountPutRel</span><span class="token operator">::</span><span class="token function">getClaId</span><span class="token punctuation">,</span> payment<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                baseMapper<span class="token punctuation">.</span><span class="token function">deleteById</span><span class="token punctuation">(</span>approvalDTO<span class="token punctuation">.</span><span class="token function">getPaymentId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                returnMsg <span class="token operator">=</span> <span class="token string">"操作成功！流程已关闭！"</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">/*
             * 业务申请状态：PUT_STATUS：1已申请，2审批中，3审批通过
             * 工作流开始，关联付款申请数据状态改成2审批中。
             * 工作流结束，关联付款申请数据状态改成3审批通过。
             * 2022/7/1 15:14@ZHANGCHAO
             */</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> orderStates <span class="token operator">=</span> baseMapper<span class="token punctuation">.</span><span class="token function">getOrderStatesByPaymentId</span><span class="token punctuation">(</span>approvalDTO<span class="token punctuation">.</span><span class="token function">getPaymentId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>orderStates<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">boolean</span> isFinish <span class="token operator">=</span> orderStates<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">allMatch</span><span class="token punctuation">(</span><span class="token string">"0"</span><span class="token operator">::</span><span class="token function">equals</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>isFinish<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    baseMapper<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">UpdateWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AccountPutPayment</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lambda</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">AccountPutPayment</span><span class="token operator">::</span><span class="token function">getPutStatus</span><span class="token punctuation">,</span> <span class="token string">"3"</span><span class="token punctuation">)</span> <span class="token comment">// 3审批通过</span>
                            <span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">AccountPutPayment</span><span class="token operator">::</span><span class="token function">getId</span><span class="token punctuation">,</span> approvalDTO<span class="token punctuation">.</span><span class="token function">getPaymentId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">// 审批最终结束后，提醒一下申请人，哪一票审批已通过。</span>
                    <span class="token class-name">WfRelBusiness</span> wfRelBusiness <span class="token operator">=</span> wfRelBusinessService<span class="token punctuation">.</span><span class="token function">getOne</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">WfRelBusiness</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lambda</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">WfRelBusiness</span><span class="token operator">::</span><span class="token function">getBusinessId</span><span class="token punctuation">,</span> approvalDTO<span class="token punctuation">.</span><span class="token function">getPaymentId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">WfHistTask</span> wfHistTask <span class="token operator">=</span> wfHistTaskService<span class="token punctuation">.</span><span class="token function">getOne</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">WfHistTask</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lambda</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">WfHistTask</span><span class="token operator">::</span><span class="token function">getOrderId</span><span class="token punctuation">,</span> wfRelBusiness<span class="token punctuation">.</span><span class="token function">getOrderId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">WfHistTask</span><span class="token operator">::</span><span class="token function">getTaskName</span><span class="token punctuation">,</span> <span class="token string">"apply"</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">orderByDesc</span><span class="token punctuation">(</span><span class="token class-name">WfHistTask</span><span class="token operator">::</span><span class="token function">getCreateTime</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">last</span><span class="token punctuation">(</span><span class="token string">"LIMIT 1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>wfHistTask<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token function">sendMessageFinished</span><span class="token punctuation">(</span>payment<span class="token punctuation">.</span><span class="token function">getPutNo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> wfHistTask<span class="token punctuation">.</span><span class="token function">getOperator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token class-name">YmMsg</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>returnMsg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"任务执行失败，原因："</span> <span class="token operator">+</span> taskYmMsg<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token class-name">YmMsg</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"任务执行失败，原因："</span> <span class="token operator">+</span> taskYmMsg<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>此方法根据每一步执行的任务节点标识，自动获取下一节点的流程参与者标识传递过去。根据审批类型可以选择回退到流程发起人或者直接跳转到流程终点。</p> 
<h4><a id="_699"></a>前端页面展示</h4> 
<p>任务参与者可以查看到当前分配给他的任务，可以进行办理</p> 
<p><img src="https://images2.imgbox.com/fe/a6/TgmVkQhe_o.png" alt="请添加图片描述"><br> <img src="https://images2.imgbox.com/b6/7e/eAtIF2rH_o.png" alt="请添加图片描述"><br> <img src="https://images2.imgbox.com/0f/4f/f26R7WGx_o.png" alt="请添加图片描述"></p> 
<h4><a id="_708"></a>总结</h4> 
<p>本文只是简单展示了前后端分离项目整合snakeflow的简单用法，暂未涉及到子流程、时限控制、实例抄送、Fork/Join、自定义节点等功能，可以自行根据官方文档体验此工作流引擎的强大之处。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/cd1e9e4e50a555dd399a2145cb382e46/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">解决笔记本屏幕显示缩放比例125% 150%对页面布局的影响</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/bcc38368671abeca56f2fab069a0d641/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Vue 项目 js 文件中使用 vue-i18n</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>