<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ElasticSearch &#43; Kibana - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="ElasticSearch &#43; Kibana" />
<meta property="og:description" content="Kibana 运维 ElasticSearch 与之对应的Java Api
基础使用 Insert 创建索引库, 并设定 分片数量 和 副本数量 // 格式: PUT /索引库名称 PUT /xinmeng { &#34;settings&#34;: { # 设定分片数量 &#34;number_of_shards&#34;: 3, # 设定副本数量 &#34;number_of_replicas&#34;: 3 } } 给指定的索引库创建映射 // 给指定索引库的映射树添加映射字段 PUT /xinmeng/_mapping { &#34;properties&#34;:{ &#34;color&#34;: { &#34;type&#34;: &#34;keyword&#34; } } } Delete 删除指定的索引库(普通删除) // 格式: DELETE /索引库名称 DELETE /xinmeng Search 查看指定索引库的映射树 // 格式: GET /索引库名称/_mapping GET /xinmeng/_mapping Close / Open 索引库 // 格式: POST /索引库名称/_close POST /xinmeng/_close // 格式: POST /索引库名称/_close POST /xinmeng/_open 文档相关操作 Insert 添加文档, 指定文档id /* 新增索引库数据: POST /索引库名称/文档名称 { &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/18d36c1a4bfb8b9db90928f74a2db7d5/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-08-05T17:15:14+08:00" />
<meta property="article:modified_time" content="2023-08-05T17:15:14+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ElasticSearch &#43; Kibana</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="Kibana__ElasticSearch_0"></a>Kibana 运维 ElasticSearch</h2> 
<p><a href="https://blog.csdn.net/qq_18947093/article/details/127937261">与之对应的Java Api</a></p> 
<h3><a id="_2"></a><strong>基础使用</strong></h3> 
<h4><a id="Insert_3"></a><strong>Insert</strong></h4> 
<h5><a id="_____4"></a>创建索引库, 并设定 分片数量 和 副本数量</h5> 
<pre><code class="prism language-java"><span class="token comment">// 格式: PUT /索引库名称</span>
<span class="token constant">PUT</span> <span class="token operator">/</span>xinmeng
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"settings"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    # 设定分片数量
    <span class="token string">"number_of_shards"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
    # 设定副本数量
    <span class="token string">"number_of_replicas"</span><span class="token operator">:</span> <span class="token number">3</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="_17"></a>给指定的索引库创建映射</h5> 
<pre><code class="prism language-java"><span class="token comment">// 给指定索引库的映射树添加映射字段</span>
<span class="token constant">PUT</span> <span class="token operator">/</span>xinmeng<span class="token operator">/</span>_mapping
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"properties"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
    <span class="token string">"color"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"keyword"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="Delete_30"></a><strong>Delete</strong></h4> 
<h5><a id="_31"></a>删除指定的索引库(普通删除)</h5> 
<pre><code class="prism language-java"><span class="token comment">// 格式: DELETE /索引库名称</span>
<span class="token constant">DELETE</span> <span class="token operator">/</span>xinmeng
</code></pre> 
<h4><a id="Search_37"></a><strong>Search</strong></h4> 
<h5><a id="_38"></a>查看指定索引库的映射树</h5> 
<pre><code class="prism language-java"><span class="token comment">// 格式: GET /索引库名称/_mapping</span>
<span class="token constant">GET</span> <span class="token operator">/</span>xinmeng<span class="token operator">/</span>_mapping
</code></pre> 
<h4><a id="Close__Open__44"></a>Close / Open 索引库</h4> 
<pre><code class="prism language-java"><span class="token comment">// 格式: POST /索引库名称/_close</span>
<span class="token constant">POST</span> <span class="token operator">/</span>xinmeng<span class="token operator">/</span>_close
</code></pre> 
<pre><code class="prism language-java"><span class="token comment">// 格式: POST /索引库名称/_close</span>
<span class="token constant">POST</span> <span class="token operator">/</span>xinmeng<span class="token operator">/</span>_open
</code></pre> 
<h3><a id="_54"></a><strong>文档相关操作</strong></h3> 
<h4><a id="Insert_55"></a><strong>Insert</strong></h4> 
<h5><a id="_id_56"></a>添加文档, 指定文档id</h5> 
<pre><code class="prism language-java"><span class="token comment">/* 新增索引库数据: 
POST /索引库名称/文档名称
{
	"字段名称": "字段值",
	"字段名称": "字段值",
	"字段名称": 字段值(数字不需要双引号)
}
*/</span>
<span class="token comment">// 若创建文档时, 不指定文档id, 则自动生成文档id, 以保证文档的唯一性</span>
<span class="token constant">POST</span> <span class="token operator">/</span>xinmeng<span class="token operator">/</span>_doc<span class="token operator">/</span><span class="token number">7</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token string">"name"</span><span class="token operator">:</span> <span class="token string">"XinMeng"</span><span class="token punctuation">,</span>
	<span class="token string">"age"</span><span class="token operator">:</span> <span class="token number">11</span><span class="token punctuation">,</span>
	<span class="token string">"sex"</span><span class="token operator">:</span> <span class="token string">"gril"</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="Search_75"></a><strong>Search</strong></h4> 
<h5><a id="id_76"></a>查询指定索引库指定文档id数据</h5> 
<pre><code class="prism language-java"><span class="token comment">// 格式: GET /索引库名称/文档名称/文档id</span>
<span class="token constant">GET</span> <span class="token operator">/</span>xinmeng<span class="token operator">/</span>_doc<span class="token operator">/</span><span class="token number">3</span>
</code></pre> 
<h5><a id="_81"></a>查询指定索引库所有数据(普通查询)</h5> 
<pre><code class="prism language-java"><span class="token comment">// 格式: GET /索引库名称/_search</span>
<span class="token constant">GET</span> <span class="token operator">/</span>xinmeng<span class="token operator">/</span>_search
</code></pre> 
<h5><a id="_86"></a>条件查询</h5> 
<pre><code class="prism language-java"><span class="token comment">/* 格式
GET /索引库名/_search
{
    "query":{
        "查询类型":{
            "查询条件":"查询条件值"
        }
    }
}
*/</span>
</code></pre> 
<h4><a id="Update_100"></a><strong>Update</strong></h4> 
<h5><a id="id_101"></a>修改指定文档id的字段值</h5> 
<pre><code class="prism language-java"><span class="token comment">// ElasticSearch 对于修改字段值, 是以覆盖方式修改, 不可以单独修改某一字段的值</span>
<span class="token constant">POST</span> <span class="token operator">/</span>xinmeng<span class="token operator">/</span>_doc<span class="token operator">/</span><span class="token number">7</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token string">"name"</span><span class="token operator">:</span> <span class="token string">"MengXin"</span><span class="token punctuation">,</span>
	<span class="token string">"age"</span><span class="token operator">:</span> <span class="token number">9</span><span class="token punctuation">,</span>
	<span class="token string">"sex"</span><span class="token operator">:</span> <span class="token string">"gril"</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="Delete_112"></a><strong>Delete</strong></h4> 
<pre><code class="prism language-java"><span class="token comment">// 格式: DELETE /索引库名称/文档名称/文档id</span>
<span class="token constant">DELETE</span> <span class="token operator">/</span>xinmeng<span class="token operator">/</span>_doc<span class="token operator">/</span><span class="token number">3</span>
</code></pre> 
<h4><a id="Create_Maping_118"></a><strong>Create Maping</strong></h4> 
<h5><a id="__119"></a>创建指定的索引, 并创建映射树</h5> 
<pre><code class="prism language-java"><span class="token comment">// 创建hotel索引库, 并创建映射树</span>
<span class="token constant">PUT</span> <span class="token operator">/</span>hotel
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"mappings"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"properties"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"id"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"keyword"</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">"name"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
        <span class="token string">"analyzer"</span><span class="token operator">:</span> <span class="token string">"ik_max_word"</span><span class="token punctuation">,</span>
        <span class="token string">"copy_to"</span><span class="token operator">:</span> <span class="token string">"all"</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">"address"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
        <span class="token string">"analyzer"</span><span class="token operator">:</span> <span class="token string">"ik_max_word"</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">"price"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"integer"</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">"score"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"integer"</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">"brand"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
        <span class="token string">"analyzer"</span><span class="token operator">:</span> <span class="token string">"ik_max_word"</span><span class="token punctuation">,</span>
        <span class="token string">"copy_to"</span><span class="token operator">:</span> <span class="token string">"all"</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">"city"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"keyword"</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">"starName"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"keyword"</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">"business"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"keyword"</span><span class="token punctuation">,</span>
        <span class="token string">"copy_to"</span><span class="token operator">:</span> <span class="token string">"all"</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">"location"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"geo_point"</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">"pic"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"keyword"</span><span class="token punctuation">,</span>
        <span class="token string">"index"</span><span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> 
      <span class="token string">"isAD"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"boolean"</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">"all"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
        <span class="token string">"analyzer"</span><span class="token operator">:</span> <span class="token string">"ik_max_word"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="_178"></a>条件检索</h3> 
<h4><a id="_179"></a>全文检索</h4> 
<h5><a id="_180"></a>查询全部</h5> 
<pre><code class="prism language-java"><span class="token constant">GET</span> <span class="token operator">/</span>hotel<span class="token operator">/</span>_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"match_all"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">"size"</span><span class="token operator">:</span> <span class="token number">1000</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="_190"></a>单字段查询</h5> 
<pre><code class="prism language-java"><span class="token constant">GET</span> <span class="token operator">/</span>hotel<span class="token operator">/</span>_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"match"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"name"</span><span class="token operator">:</span> <span class="token string">"如家"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">"size"</span><span class="token operator">:</span> <span class="token number">1000</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="_202"></a>多字段查询</h5> 
<pre><code class="prism language-java"><span class="token constant">GET</span> <span class="token operator">/</span>hotel<span class="token operator">/</span>_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"multi_match"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"query"</span><span class="token operator">:</span> <span class="token string">"如家"</span><span class="token punctuation">,</span>
      <span class="token string">"fields"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"brand"</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">"size"</span><span class="token operator">:</span> <span class="token number">1000</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="__216"></a>精准查询 (不会对查询条件分词)</h4> 
<h6><a id="Term__217"></a>Term (精确值查询)</h6> 
<pre><code class="prism language-java"><span class="token constant">GET</span> <span class="token operator">/</span>hotel<span class="token operator">/</span>_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"term"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"name"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"value"</span><span class="token operator">:</span> <span class="token string">"如家"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h6><a id="Range__231"></a>Range (范围查询)</h6> 
<pre><code class="prism language-java"><span class="token comment">// gte: 大于等于</span>
<span class="token comment">// lte: 小于等于</span>
<span class="token constant">GET</span> <span class="token operator">/</span>hotel<span class="token operator">/</span>_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"range"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"price"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"gte"</span><span class="token operator">:</span> <span class="token number">99</span><span class="token punctuation">,</span>
        <span class="token string">"lte"</span><span class="token operator">:</span> <span class="token number">399</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="_248"></a>地理位置查询</h4> 
<h5><a id="_249"></a>圆形</h5> 
<pre><code class="prism language-java"><span class="token constant">GET</span> <span class="token operator">/</span>hotel<span class="token operator">/</span>_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"geo_distance"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"location"</span><span class="token operator">:</span> <span class="token string">"31.21, 121.5"</span><span class="token punctuation">,</span>
      <span class="token string">"distance"</span><span class="token operator">:</span> <span class="token string">"15km"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="_262"></a>矩形</h5> 
<pre><code class="prism language-java"><span class="token constant">GET</span> <span class="token operator">/</span>hotel<span class="token operator">/</span>_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"geo_bounding_box"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"location"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"top_left"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
          <span class="token string">"lat"</span><span class="token operator">:</span> <span class="token string">"31.1"</span><span class="token punctuation">,</span>
          <span class="token string">"lon"</span><span class="token operator">:</span> <span class="token string">"121.5"</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">"bottom_right"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string">"lat"</span><span class="token operator">:</span> <span class="token string">"30.9"</span><span class="token punctuation">,</span>
          <span class="token string">"lon"</span><span class="token operator">:</span> <span class="token string">"121.7"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="_283"></a>组合条件查询</h4> 
<blockquote> 
 <p>查询全国的酒店名称不为七天 的上海的所有酒店, 价格范围大于等于99, 小于等于199, 而且查询的地址位置是31,21, 121.5, 范围半径20km</p> 
</blockquote> 
<pre><code class="prism language-java"><span class="token constant">GET</span> <span class="token operator">/</span>hotel<span class="token operator">/</span>_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"bool"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"must_not"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{<!-- --></span>
          <span class="token string">"term"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"name"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
              <span class="token string">"value"</span><span class="token operator">:</span> <span class="token string">"七天"</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token string">"must"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{<!-- --></span>
          <span class="token string">"range"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"price"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
              <span class="token string">"gte"</span><span class="token operator">:</span> <span class="token number">99</span><span class="token punctuation">,</span>
              <span class="token string">"lte"</span><span class="token operator">:</span> <span class="token number">199</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token string">"filter"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"geo_distance"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string">"distance"</span><span class="token operator">:</span> <span class="token string">"20km"</span><span class="token punctuation">,</span>
          <span class="token string">"location"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"lat"</span><span class="token operator">:</span> <span class="token number">31.21</span><span class="token punctuation">,</span>
            <span class="token string">"lon"</span><span class="token operator">:</span> <span class="token number">121.5</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">"should"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{<!-- --></span>
          <span class="token string">"term"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"city"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
              <span class="token string">"value"</span><span class="token operator">:</span> <span class="token string">"上海"</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <ul><li>must：必须匹配每个子查询，类似“与” (and)，must的条件参与算法的</li><li>should：选择性匹配子查询，类似“或”(or)</li><li>must_not：必须不匹配，<strong>不参与算分</strong>，类似“非” (not)</li><li>filter：效果和must一样的，都是and。必须匹配，filter的条件<strong>不参与算分</strong></li></ul> 
</blockquote> 
<blockquote> 
 <p>搜索时，参与<strong>打分的字段越多，查询的性能也越差</strong>。因此这种多条件查询时，建议：</p> 
 <ul><li>搜索框的关键字搜索，是全文检索查询，使用must查询，参与算分</li><li>其它过滤条件，采用filter查询。不参与算分</li></ul> 
</blockquote> 
<h4><a id="_340"></a>算分查询</h4> 
<blockquote> 
 <p>需求： 查询如家酒店， 对于深圳的如家进行+10分</p> 
</blockquote> 
<pre><code class="prism language-java"><span class="token constant">GET</span> <span class="token operator">/</span>hotel<span class="token operator">/</span>_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"function_score"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"query"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"match"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string">"all"</span><span class="token operator">:</span> <span class="token string">"如家"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">"functions"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{<!-- --></span>
          <span class="token string">"filter"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"term"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
              <span class="token string">"city"</span><span class="token operator">:</span> <span class="token string">"深圳"</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token string">"weight"</span><span class="token operator">:</span> <span class="token number">10</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token string">"boost_mode"</span><span class="token operator">:</span> <span class="token string">"sum"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">"size"</span><span class="token operator">:</span> <span class="token number">30</span>
<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p>function score 查询中包含四部分内容：</p> 
 <ul><li><strong>原始查询</strong>条件：query部分，基于这个条件搜索文档，并且基于BM25算法给文档打分，<strong>原始算分</strong>（query score)</li><li><strong>过滤条件</strong>：filter部分，符合该条件的文档才会重新算分</li><li><strong>算分函数</strong>：符合filter条件的文档要根据这个函数做运算，得到的<strong>函数算分</strong>（function score），有四种函数</li><li>weight：函数结果是常量</li><li>field_value_factor：以文档中的某个字段值作为函数结果</li><li>random_score：以随机数作为函数结果</li><li>script_score：自定义算分函数算法</li><li><strong>运算模式</strong>：算分函数的结果、原始查询的相关性算分，两者之间的运算方式，包括：</li><li>multiply：相乘</li><li>replace：用function score替换query score</li><li>其它，例如：sum、avg、max、min</li></ul> 
</blockquote> 
<h4><a id="_381"></a>排序查询</h4> 
<blockquote> 
 <p>查找离设定经纬度坐标最近的如家酒店</p> 
</blockquote> 
<pre><code class="prism language-java"><span class="token constant">GET</span> <span class="token operator">/</span>hotel<span class="token operator">/</span>_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"match"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"all"</span><span class="token operator">:</span> <span class="token string">"如家"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">"sort"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span>
      <span class="token string">"_geo_distance"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"location"</span><span class="token operator">:</span> <span class="token string">"39.76,116.33"</span><span class="token punctuation">,</span>
        <span class="token string">"order"</span><span class="token operator">:</span> <span class="token string">"asc"</span><span class="token punctuation">,</span>
        <span class="token string">"unit"</span><span class="token operator">:</span> <span class="token string">"km"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">"from"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token string">"size"</span><span class="token operator">:</span> <span class="token number">7</span>
<span class="token punctuation">}</span>

# 或
<span class="token constant">GET</span> <span class="token operator">/</span>hotel<span class="token operator">/</span>_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"match"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"all"</span><span class="token operator">:</span> <span class="token string">"如家"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">"sort"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span>
      <span class="token string">"_geo_distance"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"location"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string">"lat"</span><span class="token operator">:</span> <span class="token number">39.76</span><span class="token punctuation">,</span>
          <span class="token string">"lon"</span><span class="token operator">:</span> <span class="token number">116.33</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">"order"</span><span class="token operator">:</span> <span class="token string">"asc"</span><span class="token punctuation">,</span>
        <span class="token string">"unit"</span><span class="token operator">:</span> <span class="token string">"km"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="_426"></a>高亮显示</h4> 
<blockquote> 
 <p>查询如家酒店, 并高亮显示为粉色</p> 
</blockquote> 
<pre><code class="prism language-java"><span class="token constant">GET</span> <span class="token operator">/</span>hotel<span class="token operator">/</span>_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"match"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"all"</span><span class="token operator">:</span> <span class="token string">"如家"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">"highlight"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"fields"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"name"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"require_field_match"</span><span class="token operator">:</span> <span class="token string">"false"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">"pre_tags"</span><span class="token operator">:</span> <span class="token string">"&lt;font color='pink'&gt;"</span><span class="token punctuation">,</span>
    <span class="token string">"post_tags"</span><span class="token operator">:</span> <span class="token string">"&lt;/font&gt;"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="_447"></a>聚合查询</h4> 
<h5><a id="Bucket__448"></a>Bucket (桶聚合)</h5> 
<blockquote> 
 <p>聚合查询: 桶聚合, 查询全国每个城市的酒店数量</p> 
</blockquote> 
<pre><code class="prism language-java"><span class="token constant">GET</span> <span class="token operator">/</span>hotel<span class="token operator">/</span>_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"size"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token string">"aggs"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"cityAgg"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"terms"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"field"</span><span class="token operator">:</span> <span class="token string">"city"</span><span class="token punctuation">,</span>
        <span class="token string">"order"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string">"_count"</span><span class="token operator">:</span> <span class="token string">"asc"</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> 
        <span class="token string">"size"</span><span class="token operator">:</span> <span class="token number">7</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p>查询上海的酒店，按照酒店品牌统计每一个品牌的酒店数量。 比如： 如家酒店</p> 
</blockquote> 
<pre><code class="prism language-java"><span class="token constant">GET</span> <span class="token operator">/</span>hotel<span class="token operator">/</span>_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"term"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"city"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"value"</span><span class="token operator">:</span> <span class="token string">"上海"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">"size"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token string">"aggs"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"brandAggs"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"terms"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"field"</span><span class="token operator">:</span> <span class="token string">"brand"</span><span class="token punctuation">,</span>
        <span class="token string">"size"</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
        <span class="token string">"order"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string">"_count"</span><span class="token operator">:</span> <span class="token string">"asc"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="_493"></a>度量聚合</h5> 
<blockquote> 
 <p>统计每个品牌酒店的用户评分的min、max、avg等值</p> 
</blockquote> 
<pre><code class="prism language-java"># 需求：统计酒店的用户评分的平均分

<span class="token constant">GET</span> hotel<span class="token operator">/</span>_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"size"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token string">"aggs"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"avgAggs"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
       <span class="token string">"avg"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
         <span class="token string">"field"</span><span class="token operator">:</span> <span class="token string">"score"</span>
       <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p>酒店的最高分</p> 
</blockquote> 
<pre><code class="prism language-java"><span class="token constant">GET</span> hotel<span class="token operator">/</span>_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"size"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token string">"aggs"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"maxAggs"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
       <span class="token string">"max"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
         <span class="token string">"field"</span><span class="token operator">:</span> <span class="token string">"score"</span>
       <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p>酒店的最高分</p> 
</blockquote> 
<pre><code class="prism language-java"><span class="token constant">GET</span> hotel<span class="token operator">/</span>_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"size"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token string">"aggs"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"minAggs"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
       <span class="token string">"min"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
         <span class="token string">"field"</span><span class="token operator">:</span> <span class="token string">"score"</span>
       <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p>stats 求出最大值、最小值、平均值…</p> 
</blockquote> 
<pre><code class="prism language-java"><span class="token constant">GET</span> hotel<span class="token operator">/</span>_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"size"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token string">"aggs"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"statsAggs"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
       <span class="token string">"stats"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
         <span class="token string">"field"</span><span class="token operator">:</span> <span class="token string">"score"</span>
       <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h6><a id="_query_552"></a>在聚合的之前加入限制条件 query</h6> 
<blockquote> 
 <p>统计北京的酒店的品牌多少家？(限制条件用在桶聚合)</p> 
</blockquote> 
<pre><code class="prism language-java"><span class="token constant">GET</span> hotel<span class="token operator">/</span>_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"term"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"city"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"value"</span><span class="token operator">:</span> <span class="token string">"北京"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">"size"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> 
  <span class="token string">"aggs"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"brandAgg"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"terms"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"field"</span><span class="token operator">:</span> <span class="token string">"brand"</span><span class="token punctuation">,</span>
        <span class="token string">"size"</span><span class="token operator">:</span> <span class="token number">30</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p>统计上海的酒店的用户评分的平均分？(限制条件用在度量聚合)</p> 
</blockquote> 
<pre><code class="prism language-java"><span class="token constant">GET</span> hotel<span class="token operator">/</span>_search
<span class="token punctuation">{<!-- --></span>
   <span class="token string">"query"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"term"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"city"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"value"</span><span class="token operator">:</span> <span class="token string">"上海"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">"size"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token string">"aggs"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"scoreAvg"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"avg"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"field"</span><span class="token operator">:</span> <span class="token string">"score"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="pipline_598"></a>管道聚合（pipline聚合）一个聚合的结果作为另一个聚合的条件</h5> 
<blockquote> 
 <p>需求：统计上海的酒店的每个品牌的平均分？</p> 
 <ul><li>默认排序（根据第一个聚合的总数倒序显示）</li></ul> 
</blockquote> 
<pre><code class="prism language-java"><span class="token constant">GET</span> hotel<span class="token operator">/</span>_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"term"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"city"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"value"</span><span class="token operator">:</span> <span class="token string">"上海"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">"size"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token string">"aggs"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"brandAggs"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"terms"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"field"</span><span class="token operator">:</span> <span class="token string">"brand"</span><span class="token punctuation">,</span>
        <span class="token string">"size"</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
        <span class="token string">"order"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string">"avgAggs"</span><span class="token operator">:</span> <span class="token string">"desc"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">"aggs"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"avgAggs"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string">"avg"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"field"</span><span class="token operator">:</span> <span class="token string">"score"</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="_633"></a>自动补全查询</h4> 
<pre><code class="prism language-java"><span class="token constant">GET</span> hotel<span class="token operator">/</span>_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"suggest"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"hotelSuggestion"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"text"</span><span class="token operator">:</span> <span class="token string">"北"</span><span class="token punctuation">,</span>	<span class="token comment">// 查询内容</span>
      <span class="token string">"completion"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
        <span class="token string">"field"</span><span class="token operator">:</span><span class="token string">"suggestion"</span><span class="token punctuation">,</span>	<span class="token comment">//自动补全字段, 对应JavaBean中定义的自动补全属性</span>
        <span class="token string">"skip_duplicates"</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token string">"size"</span><span class="token operator">:</span><span class="token number">10</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="_651"></a>自定义分词器</h2> 
<pre><code class="prism language-java"><span class="token comment">// analyzer: 默认情况下，构建和搜索索引库时都使用该分词器，但如果存在search_analyzer属性后，只在构建时使用</span>
<span class="token comment">// search_analyzer：只用在搜索索引库时</span>
<span class="token constant">PUT</span> <span class="token operator">/</span>test
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"settings"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"analysis"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"analyzer"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> 
        <span class="token string">"my_analyzer"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> 
          <span class="token string">"tokenizer"</span><span class="token operator">:</span> <span class="token string">"ik_smart"</span><span class="token punctuation">,</span>
          <span class="token string">"filter"</span><span class="token operator">:</span> <span class="token string">"py"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">"filter"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"py"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> 
          <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"pinyin"</span><span class="token punctuation">,</span>
          <span class="token string">"keep_full_pinyin"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
          <span class="token string">"keep_joined_full_pinyin"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token string">"keep_original"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token string">"limit_first_letter_length"</span><span class="token operator">:</span> <span class="token number">16</span><span class="token punctuation">,</span>
          <span class="token string">"remove_duplicated_term"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token string">"none_chinese_pinyin_tokenize"</span><span class="token operator">:</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">"mappings"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"properties"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"name"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
        <span class="token string">"analyzer"</span><span class="token operator">:</span> <span class="token string">"my_analyzer"</span><span class="token punctuation">,</span>
        <span class="token string">"search_analyzer"</span><span class="token operator">:</span> <span class="token string">"ik_max_word"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="_689"></a>完整示例</h4> 
<pre><code class="prism language-java"># 构建拼音分词器索引库
<span class="token constant">PUT</span> <span class="token operator">/</span>maomao_index
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"settings"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"analysis"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"analyzer"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"maomao_pinyin_analyzer"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string">"tokenizer"</span><span class="token operator">:</span> <span class="token string">"ik_max_word"</span><span class="token punctuation">,</span>
          <span class="token string">"filter"</span><span class="token operator">:</span> <span class="token string">"pinyin"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">"filter"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"pinyin"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"pinyin"</span><span class="token punctuation">,</span> # 设定分词器类型为拼音
          <span class="token string">"keep_first_leeter"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> # 文字的拼音首字母
          <span class="token string">"keep_separate_first_letter"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> # 不单独保留首字母
          <span class="token string">"keep_full_pinyin"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> # 每个文字全拼
          <span class="token string">"limit_first_letter_length"</span><span class="token operator">:</span> <span class="token number">16</span><span class="token punctuation">,</span> # 设置first_letter结果的最大长度为<span class="token number">16</span>
          <span class="token string">"keep_joined_full_pinyin"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> # 开启连拼<span class="token punctuation">(</span>全部<span class="token punctuation">)</span>
          <span class="token string">"keep_none_chinese"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> # 在结果中保留非中文字母或数字
          <span class="token string">"keep_none_chinese_together"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> # 将非中文字母放在一起
          <span class="token string">"keep_none_chinese_in_first_letter"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> # 将非中文字母保留在首字母中
          <span class="token string">"keep_none_chinese_in_joined_full_pinyin"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> # 将非中文字母保留在连接的完整拼音中
          <span class="token string">"none_chinese_pinyin_tokenize"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> # 将非中文字母分解为单独的拼音术语（如果是拼音）
          <span class="token string">"keep_original"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> # 启用此选项后，也将保留原始输入
          <span class="token string">"lowercase"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> # 小写非中文字母
          <span class="token string">"trim_whitespace"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token string">"remove_duplicated_term"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> # 将删除重复的术语以保存索引
          <span class="token string">"ignore_pinyin_offset"</span><span class="token operator">:</span> <span class="token boolean">true</span> # 重叠令牌将允许忽略偏移量
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">"mappings"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"properties"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"id"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"keyword"</span><span class="token punctuation">,</span>
        <span class="token string">"index"</span><span class="token operator">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">"name"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
        <span class="token string">"analyzer"</span><span class="token operator">:</span> <span class="token string">"maomao_pinyin_analyzer"</span><span class="token punctuation">,</span>
        <span class="token string">"search_analyzer"</span><span class="token operator">:</span> <span class="token string">"ik_max_word"</span><span class="token punctuation">,</span>
        <span class="token string">"copy_to"</span><span class="token operator">:</span> <span class="token string">"maomaoAll"</span><span class="token punctuation">,</span>
        <span class="token string">"index"</span><span class="token operator">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">"address"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
        <span class="token string">"analyzer"</span><span class="token operator">:</span> <span class="token string">"maomao_pinyin_analyzer"</span><span class="token punctuation">,</span>
        <span class="token string">"search_analyzer"</span><span class="token operator">:</span> <span class="token string">"ik_max_word"</span><span class="token punctuation">,</span>
        <span class="token string">"copy_to"</span><span class="token operator">:</span> <span class="token string">"maomaoAll"</span><span class="token punctuation">,</span>
        <span class="token string">"index"</span><span class="token operator">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">"price"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"integer"</span><span class="token punctuation">,</span>
        <span class="token string">"index"</span><span class="token operator">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">"score"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"integer"</span><span class="token punctuation">,</span>
        <span class="token string">"index"</span><span class="token operator">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">"brand"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"keyword"</span><span class="token punctuation">,</span>
        <span class="token string">"copy_to"</span><span class="token operator">:</span> <span class="token string">"maomaoAll"</span><span class="token punctuation">,</span>
        <span class="token string">"index"</span><span class="token operator">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">"city"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"keyword"</span><span class="token punctuation">,</span>
        <span class="token string">"index"</span><span class="token operator">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">"starName"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"keyword"</span><span class="token punctuation">,</span>
        <span class="token string">"index"</span><span class="token operator">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">"business"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
        <span class="token string">"analyzer"</span><span class="token operator">:</span> <span class="token string">"maomao_pinyin_analyzer"</span><span class="token punctuation">,</span>
        <span class="token string">"search_analyzer"</span><span class="token operator">:</span> <span class="token string">"ik_max_word"</span><span class="token punctuation">,</span>
        <span class="token string">"copy_to"</span><span class="token operator">:</span> <span class="token string">"maomaoAll"</span><span class="token punctuation">,</span>
        <span class="token string">"index"</span><span class="token operator">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">"pic"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"keyword"</span><span class="token punctuation">,</span>
        <span class="token string">"index"</span><span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">"isAD"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"keyword"</span><span class="token punctuation">,</span>
        <span class="token string">"index"</span><span class="token operator">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">"location"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"geo_point"</span><span class="token punctuation">,</span>
        <span class="token string">"index"</span><span class="token operator">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">"maomaoAll"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
        <span class="token string">"analyzer"</span><span class="token operator">:</span> <span class="token string">"maomao_pinyin_analyzer"</span><span class="token punctuation">,</span>
        <span class="token string">"search_analyzer"</span><span class="token operator">:</span> <span class="token string">"ik_max_word"</span><span class="token punctuation">,</span>
        <span class="token string">"index"</span><span class="token operator">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p><a href="https://github.com/medcl/elasticsearch-analysis-pinyin">自定义分词器官方地址(GitHub)</a></p> 
 <ul><li>可选参数<br> – keep_first_letter启用此选项时，默认值：true, 例如：&gt; 刘德华ldh<br> – keep_separate_first_letter启用此选项时，将分别保留首字母，默认值：false<br> – limit_first_letter_length设置first_letter结果的最大长度，默认值：16<br> – keep_full_pinyin当启用此选项时，例如：&gt; [，，]，默认值：true刘德华liudehua<br> – keep_joined_full_pinyin当启用此选项时，例如：&gt; []，默认值：false刘德华liudehua<br> – keep_none_chinese在结果中保留非中文字母或数字，默认值：true<br> – keep_none_chinese_together将非中文字母放在一起，默认值：true<br> – keep_none_chinese_in_first_letter在第一个字母中保留非中文字母<br> – keep_none_chinese_in_joined_full_pinyin将非中文字母保留在连接的完整拼音中<br> – none_chinese_pinyin_tokenize如果非中文字母是拼音，则将其拆分为单独的拼音术语，默认值：true<br> – keep_original启用此选项时，也会保留原始输入，默认值：false, 使用此属性时, 因该设置为true, 要保留原始值<br> – lowercase小写非中文字母，默认值：true<br> – trim_whitespace默认值：true<br> – remove_duplicated_term启用此选项时，将删除重复的术语以保存索引，默认值：false<br> – ignore_pinyin_offset6.0之后，偏移量受到严格约束，不允许重叠标记，使用此参数，重叠标记将允许忽略偏移量，请注意，所有与位置相关的查询或突出显示都会变得不正确，您应该使用多个字段并指定不同的设置，用于不同的查询目的。如果您需要偏移量，请将其设置为 false。默认值：true。</li></ul> 
</blockquote> 
<h2><a id="_812"></a>整合示例</h2> 
<blockquote> 
 <p>DSL</p> 
</blockquote> 
<pre><code class="prism language-java"><span class="token constant">PUT</span> <span class="token operator">/</span>hotel
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"settings"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"analysis"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"analyzer"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"text_anlyzer"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string">"tokenizer"</span><span class="token operator">:</span> <span class="token string">"ik_max_word"</span><span class="token punctuation">,</span>
          <span class="token string">"filter"</span><span class="token operator">:</span> <span class="token string">"py"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">"filter"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"py"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"pinyin"</span><span class="token punctuation">,</span>
          <span class="token string">"keep_full_pinyin"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
          <span class="token string">"keep_joined_full_pinyin"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token string">"keep_original"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token string">"limit_first_letter_length"</span><span class="token operator">:</span> <span class="token number">16</span><span class="token punctuation">,</span>
          <span class="token string">"remove_duplicated_term"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token string">"none_chinese_pinyin_tokenize"</span><span class="token operator">:</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">"mappings"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"properties"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"id"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"keyword"</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">"name"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
        <span class="token string">"analyzer"</span><span class="token operator">:</span> <span class="token string">"text_anlyzer"</span><span class="token punctuation">,</span>
        <span class="token string">"search_analyzer"</span><span class="token operator">:</span> <span class="token string">"ik_max_word"</span><span class="token punctuation">,</span>
        <span class="token string">"copy_to"</span><span class="token operator">:</span> <span class="token string">"all"</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">"address"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"keyword"</span><span class="token punctuation">,</span>
        <span class="token string">"index"</span><span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">"price"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"integer"</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">"score"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"integer"</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">"brand"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"keyword"</span><span class="token punctuation">,</span>
        <span class="token string">"copy_to"</span><span class="token operator">:</span> <span class="token string">"all"</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">"city"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"keyword"</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">"starName"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"keyword"</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">"business"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"keyword"</span><span class="token punctuation">,</span>
        <span class="token string">"copy_to"</span><span class="token operator">:</span> <span class="token string">"all"</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">"location"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"geo_point"</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">"pic"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"keyword"</span><span class="token punctuation">,</span>
        <span class="token string">"index"</span><span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">"all"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
        <span class="token string">"analyzer"</span><span class="token operator">:</span> <span class="token string">"text_anlyzer"</span><span class="token punctuation">,</span>
        <span class="token string">"search_analyzer"</span><span class="token operator">:</span> <span class="token string">"ik_max_word"</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
	  <span class="token string">"suggestion"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"completion"</span><span class="token punctuation">,</span>
        <span class="token string">"analyzer"</span><span class="token operator">:</span> <span class="token string">"text_anlyzer"</span><span class="token punctuation">,</span>
		<span class="token string">"search_analyzer"</span><span class="token operator">:</span> <span class="token string">"ik_max_word"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p>Java Bean</p> 
</blockquote> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HotelDoc</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> address<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">Integer</span> price<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">Integer</span> score<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> brand<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> city<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> starName<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> business<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> pic<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> all<span class="token punctuation">;</span>

	<span class="token keyword">private</span> <span class="token class-name">String</span> location<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">Boolean</span> isAD<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">Object</span> distance<span class="token punctuation">;</span><span class="token comment">//距离值</span>

    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> suggestion<span class="token punctuation">;</span><span class="token comment">//用于自动补全字段</span>

    <span class="token keyword">public</span> <span class="token class-name">HotelDoc</span><span class="token punctuation">(</span><span class="token class-name">Hotel</span> hotel<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> hotel<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> hotel<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>address <span class="token operator">=</span> hotel<span class="token punctuation">.</span><span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>price <span class="token operator">=</span> hotel<span class="token punctuation">.</span><span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>score <span class="token operator">=</span> hotel<span class="token punctuation">.</span><span class="token function">getScore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>brand <span class="token operator">=</span> hotel<span class="token punctuation">.</span><span class="token function">getBrand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>city <span class="token operator">=</span> hotel<span class="token punctuation">.</span><span class="token function">getCity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>starName <span class="token operator">=</span> hotel<span class="token punctuation">.</span><span class="token function">getStarName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>business <span class="token operator">=</span> hotel<span class="token punctuation">.</span><span class="token function">getBusiness</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>pic <span class="token operator">=</span> hotel<span class="token punctuation">.</span><span class="token function">getPic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>isAD <span class="token operator">=</span> hotel<span class="token punctuation">.</span><span class="token function">getIsAD</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>location <span class="token operator">=</span> hotel<span class="token punctuation">.</span><span class="token function">getLatitude</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">", "</span> <span class="token operator">+</span> hotel<span class="token punctuation">.</span><span class="token function">getLongitude</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">//填充suggestion字段: brand  city business</span>
        suggestion <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        suggestion<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>hotel<span class="token punctuation">.</span><span class="token function">getBrand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        suggestion<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>hotel<span class="token punctuation">.</span><span class="token function">getCity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        suggestion<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>hotel<span class="token punctuation">.</span><span class="token function">getBusiness</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p>测试分词器</p> 
</blockquote> 
<pre><code class="prism language-java"><span class="token constant">GET</span> _analyze
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"text"</span><span class="token operator">:</span> <span class="token string">"我有我的快乐和自由"</span><span class="token punctuation">,</span>
  <span class="token string">"analyzer"</span><span class="token operator">:</span> <span class="token string">"ik_max_word"</span>
<span class="token punctuation">}</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f76f26aaff6cd1e2330144a2aaecd87a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">C语言——变参函数</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f97efba3fc11ac25bfb2bef1a89a9ce8/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">2023华数杯数学建模C题完整论文，包括每个问题的代码</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>