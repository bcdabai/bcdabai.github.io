<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>nginx负载均衡前端项目 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="nginx负载均衡前端项目" />
<meta property="og:description" content="nginx负载均衡前端项目 服务器主机名说明10.4.237.123nodea负载主机，负责分发给下面俩服务器10.4.237.124nodeb分发服务1192.168.18.47nodec分发服务2 一、nginx安装（全部服务器执行） 1.1 安装依赖包 yum install gcc yum install -y pcre pcre-devel yum install -y zlib zlib-devel yum install -y openssl openssl-devel yum install wget 1.2 下载nginx安装包 [root@node1 quartz]# cd /usr/local/ [root@node1 quartz]# wget https://nginx.org/download/nginx-1.15.3.tar.gz [root@node1 quartz]# tar -zxvf nginx-1.15.3.tar.gz 1.3 安装nginx //进入nginx目录 [root@node1 quartz]# cd /usr/local/nginx-1.15.3 //执行命令 [root@node1 quartz]# ./configure [root@node1 quartz]# make [root@node1 quartz]# make install [root@node1 quartz]# /usr/local/nginx/sbin/nginx -s reload [root@node1 quartz]# ps -ef | grep nginx //查看nginx进程是否启动： 1." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/84ed2ba0e2c0af2c3c43e914f5e7d395/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-08-01T18:12:28+08:00" />
<meta property="article:modified_time" content="2019-08-01T18:12:28+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">nginx负载均衡前端项目</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="nginx_0"></a>nginx负载均衡前端项目</h2> 
<table><thead><tr><th>服务器</th><th>主机名</th><th>说明</th></tr></thead><tbody><tr><td>10.4.237.123</td><td>nodea</td><td>负载主机，负责分发给下面俩服务器</td></tr><tr><td>10.4.237.124</td><td>nodeb</td><td>分发服务1</td></tr><tr><td>192.168.18.47</td><td>nodec</td><td>分发服务2</td></tr></tbody></table> 
<h3><a id="nginx_7"></a>一、nginx安装（全部服务器执行）</h3> 
<h4><a id="11___8"></a>1.1 安装依赖包</h4> 
<pre><code class="prism language-javascript">yum install gcc
yum install <span class="token operator">-</span>y pcre pcre<span class="token operator">-</span>devel
yum install <span class="token operator">-</span>y zlib zlib<span class="token operator">-</span>devel
yum install <span class="token operator">-</span>y openssl openssl<span class="token operator">-</span>devel
yum install wget
</code></pre> 
<h4><a id="12__nginx_16"></a>1.2 下载nginx安装包</h4> 
<pre><code class="prism language-javascript"><span class="token punctuation">[</span>root@node1 quartz<span class="token punctuation">]</span># cd <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>
<span class="token punctuation">[</span>root@node1 quartz<span class="token punctuation">]</span># wget https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>nginx<span class="token punctuation">.</span>org<span class="token operator">/</span>download<span class="token operator">/</span>nginx<span class="token operator">-</span><span class="token number">1.15</span><span class="token number">.3</span><span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz
<span class="token punctuation">[</span>root@node1 quartz<span class="token punctuation">]</span># tar <span class="token operator">-</span>zxvf nginx<span class="token operator">-</span><span class="token number">1.15</span><span class="token number">.3</span><span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz
</code></pre> 
<h4><a id="13__nginx_23"></a>1.3 安装nginx</h4> 
<pre><code class="prism language-javascript">
<span class="token comment">//进入nginx目录</span>
<span class="token punctuation">[</span>root@node1 quartz<span class="token punctuation">]</span># cd <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>nginx<span class="token operator">-</span><span class="token number">1.15</span><span class="token number">.3</span>
<span class="token comment">//执行命令</span>
<span class="token punctuation">[</span>root@node1 quartz<span class="token punctuation">]</span># <span class="token punctuation">.</span><span class="token operator">/</span>configure
<span class="token punctuation">[</span>root@node1 quartz<span class="token punctuation">]</span>#  make
<span class="token punctuation">[</span>root@node1 quartz<span class="token punctuation">]</span># make install
<span class="token punctuation">[</span>root@node1 quartz<span class="token punctuation">]</span># <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>nginx<span class="token operator">/</span>sbin<span class="token operator">/</span>nginx <span class="token operator">-</span>s reload
<span class="token punctuation">[</span>root@node1 quartz<span class="token punctuation">]</span># ps <span class="token operator">-</span>ef <span class="token operator">|</span> grep nginx  <span class="token comment">//查看nginx进程是否启动：</span>

</code></pre> 
<p><img src="https://images2.imgbox.com/c0/73/v1wO5b4l_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="14__nginx_38"></a>1.4 nginx命令</h4> 
<pre><code class="prism language-javascript"><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>nginx<span class="token operator">/</span>sbin<span class="token operator">/</span>nginx <span class="token operator">-</span>s reload		# 重新载入配置文件
<span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>nginx<span class="token operator">/</span>sbin<span class="token operator">/</span>nginx <span class="token operator">-</span>s reopen		# 重启 Nginx
<span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>nginx<span class="token operator">/</span>sbin<span class="token operator">/</span>nginx <span class="token operator">-</span>s stop          # 停止 Nginx                
</code></pre> 
<h3><a id="nginx_45"></a>二、nginx配置</h3> 
<p><em>首先将前端文件放到三台服务器/usr/local/nginx/html/meeting目录下</em></p> 
<h4><a id="21__nodea_47"></a>2.1 nodea配置</h4> 
<pre><code class="prism language-javascript"><span class="token punctuation">[</span>root@node1 nodea<span class="token punctuation">]</span># vi <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>nginx<span class="token operator">/</span>conf<span class="token operator">/</span>nginx<span class="token punctuation">.</span>conf
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
http <span class="token punctuation">{<!-- --></span>
    include       mime<span class="token punctuation">.</span>types<span class="token punctuation">;</span>
    default_type  application<span class="token operator">/</span>octet<span class="token operator">-</span>stream<span class="token punctuation">;</span>

    #log_format  main  <span class="token string">'$remote_addr - $remote_user [$time_local] "$request" '</span>
    #                  <span class="token string">'$status $body_bytes_sent "$http_referer" '</span>
    #                  <span class="token string">'"$http_user_agent" "$http_x_forwarded_for"'</span><span class="token punctuation">;</span>

    #access_log  logs<span class="token operator">/</span>access<span class="token punctuation">.</span>log  main<span class="token punctuation">;</span>

    sendfile        on<span class="token punctuation">;</span>
    #tcp_nopush     on<span class="token punctuation">;</span>

    #keepalive_timeout  <span class="token number">0</span><span class="token punctuation">;</span>
    keepalive_timeout  <span class="token number">65</span><span class="token punctuation">;</span>

    #gzip  on<span class="token punctuation">;</span>

   #配置nginx反向代理组
   upstream meeting_server <span class="token punctuation">{<!-- --></span>			#转发配置
        #ip_hash解决session问题
        #ip_hash<span class="token punctuation">;</span>
        server <span class="token number">10.4</span><span class="token number">.237</span><span class="token number">.124</span><span class="token punctuation">:</span><span class="token number">80</span><span class="token punctuation">;</span>
        server <span class="token number">192.168</span><span class="token number">.18</span><span class="token number">.47</span><span class="token punctuation">:</span><span class="token number">80</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   
    server <span class="token punctuation">{<!-- --></span>
        listen       <span class="token number">80</span><span class="token punctuation">;</span>
        server_name  localhost<span class="token punctuation">;</span>

        #charset koi8<span class="token operator">-</span>r<span class="token punctuation">;</span>

        #access_log  logs<span class="token operator">/</span>host<span class="token punctuation">.</span>access<span class="token punctuation">.</span>log  main<span class="token punctuation">;</span>

        location <span class="token operator">/</span> <span class="token punctuation">{<!-- --></span>
            root   html<span class="token punctuation">;</span>
            index  index<span class="token punctuation">.</span>html index<span class="token punctuation">.</span>htm<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
		# <span class="token operator">/</span>meeting请求拦截，进行负载转发
        location <span class="token operator">~</span><span class="token operator">*</span> <span class="token operator">/</span>meeting <span class="token punctuation">{<!-- --></span>		#拦截配置
          root html<span class="token punctuation">;</span>
          index index<span class="token punctuation">.</span>html index<span class="token punctuation">.</span>htm<span class="token punctuation">;</span>
          proxy_pass http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>meeting_server<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        #error_page  <span class="token number">404</span>              <span class="token operator">/</span><span class="token number">404.</span>html<span class="token punctuation">;</span>

        # redirect server error pages to the <span class="token keyword">static</span> page <span class="token operator">/</span><span class="token number">50</span>x<span class="token punctuation">.</span>html
        #
        error_page   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  <span class="token operator">/</span><span class="token number">50</span>x<span class="token punctuation">.</span>html<span class="token punctuation">;</span>
        location <span class="token operator">=</span> <span class="token operator">/</span><span class="token number">50</span>x<span class="token punctuation">.</span>html <span class="token punctuation">{<!-- --></span>
            root   html<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>


<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
</code></pre> 
<h4><a id="22__nodebnodec_109"></a>2.2 nodeb、nodec配置</h4> 
<pre><code class="prism language-javascript">	# server<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span> 里面配置拦截
        location <span class="token operator">~</span><span class="token operator">*</span> <span class="token operator">/</span>meeting <span class="token punctuation">{<!-- --></span>
            root html<span class="token punctuation">;</span>
            index index<span class="token punctuation">.</span>html index<span class="token punctuation">.</span>htm<span class="token punctuation">;</span>
##          try_files $uri<span class="token operator">/</span>meeting<span class="token operator">/</span> <span class="token operator">/</span>meeting<span class="token operator">/</span>index<span class="token punctuation">.</span>html<span class="token punctuation">;</span>
            try_files $uri $uri<span class="token operator">/</span>meeting<span class="token operator">/</span> <span class="token operator">/</span>meeting<span class="token operator">/</span>index<span class="token punctuation">.</span>html <span class="token operator">=</span><span class="token number">404</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre> 
<h4><a id="23___120"></a>2.3 测试</h4> 
<p>前端访问路径是：<a href="http://10.4.237.123/meeting/oa-order" rel="nofollow">http://10.4.237.123/meeting/oa-order</a></p> 
<pre><code class="prism language-javascript">tail <span class="token operator">-</span>f <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>nginx<span class="token operator">/</span>logs<span class="token operator">/</span>access<span class="token punctuation">.</span>log 查看三台机器的日志
</code></pre> 
<p>测试发现每次请求http://10.4.237.123/meeting/oa-order，nodea增加一个日志，然后转发给nodeb或者nodec，对应服务器会增加一条日志，配置成功</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b6925c0cbdf0cd1062ba17eb722d9aa9/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">WGS-84 ，GCJ-02与BD-09的坐标进行转换</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f058864a6237fc2642cf8c2224f5a662/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">tushare接口get_realtime_quotes报错：AssertionError: 33 columns passed, passed data had 34 columns</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>