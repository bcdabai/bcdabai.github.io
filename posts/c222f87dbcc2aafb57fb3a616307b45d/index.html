<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Python 自动化办公- openpyxl 创建一个 Excel 写入数据自动存储 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Python 自动化办公- openpyxl 创建一个 Excel 写入数据自动存储" />
<meta property="og:description" content="上一篇 自动化办公文章中介绍了 openpyxl 模块处理 Excel 文件的一些基本命令，但文章中涉及的操作命令并不是很全，因此就有了本篇文章；引入一个例子从 创建 Workbook 到存储到本地磁盘，涉及的操作命令会更全面一些，内容概括如下：
新建 Workbook，并保存；新建 sheet ，修改标题、tabColor；对 sheet 中的单元格进行赋值；删除 sheet 中指定行、列(可多行、多列)；插入 sheet 中指定行、列(可多行、多列)；sheet 中指定列添加筛选机制；合并单元行；设置单元格字体样式、填充样式、对齐样式；应用 Excel 表格中函数命令； 本文下面Python构建的办公自动化项目都有详细的配套教程以及源码，都已经打包好上传到百度云了，链接在文章结尾处！
扫码此处领取大家自行获取即可~~~
1，创建一个新的 Excel 文件(Workbook)
from openpyxl import Workbook from openpyxl.utils import get_column_letter wb = Workbook() dest_filename = &#34;Empty_book.xlsx&#34; wb.save(dest_filename) 2，更改 sheet 标题
ws1 = wb.active ws1.title = &#39;range names&#39; **3，在第一个 sheet 40*600 个单元格中填充数据 **
for row in range(1,40): ws1.append(range(600)) 4，应用求和函数公式
openpyxl 还有一个强大的功能，可以使用 Excel 表格内置函数；函数语法与 Excel 中的基本相同，使用之前需要在 导入模块加入一行代码导入 FORMULAE 模块" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/c222f87dbcc2aafb57fb3a616307b45d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-05T21:38:00+08:00" />
<meta property="article:modified_time" content="2024-01-05T21:38:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Python 自动化办公- openpyxl 创建一个 Excel 写入数据自动存储</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>上一篇 自动化办公文章中介绍了 openpyxl 模块处理 Excel 文件的一些基本命令，但文章中涉及的操作命令并不是很全，因此就有了本篇文章；引入一个例子从 创建 Workbook 到存储到本地磁盘，涉及的操作命令会更全面一些，内容概括如下：</p> 
<ul><li>新建 Workbook，并保存；</li><li>新建 sheet ，修改标题、tabColor；</li><li>对 sheet 中的单元格进行赋值；</li><li>删除 sheet 中指定行、列(可多行、多列)；</li><li>插入 sheet 中指定行、列(可多行、多列)；</li><li>sheet 中指定列添加筛选机制；</li><li>合并单元行；</li><li>设置单元格字体样式、填充样式、对齐样式；</li><li>应用 Excel 表格中函数命令；</li><li></ul> 
<p>本文下面Python构建的办公自动化项目都有详细的配套教程以及源码，都已经打包好上传到百度云了，链接在文章结尾处！</p> 
<p>扫码此处领取大家自行获取即可~~~</p> 
<center> 
 <img src="https://images2.imgbox.com/60/93/wLwjy8X8_o.png"> 
 <center> 
 </center> 
</center> 
<p><strong>1，创建一个新的 Excel 文件(Workbook)</strong></p> 
<pre><code>from openpyxl import Workbook
from openpyxl.utils import get_column_letter

wb = Workbook()
dest_filename = "Empty_book.xlsx"
wb.save(dest_filename)
</code></pre> 
<p><img src="https://images2.imgbox.com/74/ab/JytQ2y1a_o.png" alt="在这里插入图片描述"></p> 
<p><strong>2，更改 sheet 标题</strong></p> 
<pre><code>ws1 = wb.active
ws1.title = 'range names'
</code></pre> 
<p><img src="https://images2.imgbox.com/f0/b1/waANEdaN_o.png" alt="在这里插入图片描述"></p> 
<p>**3，在第一个 sheet 40*600 个单元格中填充数据 **</p> 
<pre><code>for row in range(1,40):
    ws1.append(range(600))
</code></pre> 
<p><img src="https://images2.imgbox.com/b8/ec/ADidR41C_o.png" alt="在这里插入图片描述"></p> 
<p><strong>4，应用求和函数公式</strong></p> 
<p>openpyxl 还有一个强大的功能，可以使用 Excel 表格内置函数；函数语法与 Excel 中的基本相同，使用之前需要在 导入模块加入一行代码导入 FORMULAE 模块</p> 
<pre><code>from openpyxl.utils import FORMULAE
</code></pre> 
<p>利用 SUM 函数求取每行各列值之和，并创建新的一列进行存储</p> 
<pre><code>for row in range(1,40):
    ws1["WC{}".format(row)] = '=SUM(A{}:WB{})'.format(row,row)
</code></pre> 
<p><strong>5，表格首行加入筛选机制</strong></p> 
<p>在加入筛选机制之前，需要特别注意下先指定单元格范围，用到 auto_filter 模块中的 ref 参数</p> 
<pre><code>ws1.auto_filter.ref = "A1:WC39"
</code></pre> 
<p>再对指定要添加筛选的列进行修改，这里我对表格中每一个列都加入了 筛选模块；</p> 
<pre><code>for row in range(600):
    ws1.auto_filter.add_filter_column(row,vals = ['1','25'])#对每一列加入过滤机制
</code></pre> 
<p><img src="https://images2.imgbox.com/f2/c1/kylmcPYN_o.png" alt="在这里插入图片描述"><br> add_filter_column()函数中 row 用于指定要添加的列索引，例如 0就是第一列，后面 vals 暂时还没发现有用处，</p> 
<p>另外这里吐槽一下，似乎 openpyxl 包中的 add_sort_condition 模块似乎没有什么用，暂不清楚自己是代码写错了还是什么原因，觉得就是个鸡肋，这里我加入了 排序功能，但代码运行完表格处理完之后还是处于无序状态</p> 
<pre><code>ws1.auto_filter.ref = "A1:WC39"

for row in range(600):
    ws1.auto_filter.add_filter_column(row,vals = ['1','25'])#对每一列加入过滤机制

for i in range(2,40):
    ws1['A{}'.format(i)] = random.choice(range(50))# 更改第一列数据

ws1.auto_filter.add_sort_condition("WC2:WC35") # 对Excel 第一列进行排序
</code></pre> 
<p><img src="https://images2.imgbox.com/32/76/1YxHwARv_o.png" alt="在这里插入图片描述"></p> 
<p><strong>6，中插入行、列</strong></p> 
<p>插入行方法</p> 
<ul><li>insert_rows(idx，amount),</li></ul> 
<p>在指定行 idx 前面插入，amount 表示要插入 的行数，默认为1；</p> 
<p>插入列方法</p> 
<ul><li>insert_cols(idx，amount)</li></ul> 
<p>在指定列前面插入，amount 表示要插入的列数，默认为1；</p> 
<pre><code># 插入行和列

ws1.insert_rows(2,amount = 2) #在第二行前面加入两空行
ws1.insert_cols(2,amount = 3) # 在第二列前面加入三个空列
</code></pre> 
<p><img src="https://images2.imgbox.com/e8/43/YktttFnj_o.png" alt="在这里插入图片描述"></p> 
<p><strong>7，删除行、列(可多行、可单行)</strong></p> 
<p>删除列方法</p> 
<ul><li>delete_cols(idx,amount)</li></ul> 
<p>删除以列索引为 idx 为起始，amount 指示删除列的数量；</p> 
<ul><li>delete_rows(idx,amount)</li></ul> 
<p>删除以行索引为 idx 为起始，amount 表示删除行的数量；</p> 
<pre><code># 删除行与列

ws1.delete_cols(2,amount = 3) # 删除 第 2 列为起始索引，共3列
ws1.delete_rows(4,amount = 5) # 删除 第 4 行为起始索引，共5行
</code></pre> 
<p><img src="https://images2.imgbox.com/1e/b5/McepbuZx_o.png" alt="在这里插入图片描述"></p> 
<p><strong>8，合并行</strong></p> 
<ul><li>merge_cells(range_string,start_row,start_column,end_row,end_column)</li></ul> 
<p>range_string，表示单元格合并单元格范围，例如 “A2:F3”，合并时只需设置这个参数即可；<br> start_row，起始行，例如 start_row = 2;<br> end_row，中止行，例end_row = 3;<br> start_column ，起始列，start_column = 1;<br> end_column，终止列，end_column = 5;<br> ws1.merge_cells(range_string = “A2:F3”) # 合并多个单元格，A2-F3</p> 
<pre><code># ws1.merge_cells(start_row=2, start_column=1, end_row=3, end_column=5) # 与上面效果等价;
</code></pre> 
<p><img src="https://images2.imgbox.com/30/fb/Ev9Cnuz7_o.png" alt="在这里插入图片描述"></p> 
<p><strong>9，设置单元格样式</strong></p> 
<p>字体样式设置，这里需用到 openpyxl.styles.fonts 模块中的 Font 函数，</p> 
<p><strong>9.1，字体样式设置，用到 Font()函数模块</strong></p> 
<p>应用字体样式时，把设置好的 Font() 样式赋值为 单元格.font 属性即可，如下</p> 
<pre><code>from openpyxl.styles import colors, Font, Fill, NamedStyle
from openpyxl.styles import PatternFill, Border, Side, Alignment

ws1['A2'].font = Font(bold = True,color ='FFB6C1',sz = 15.0,i = True,outline = True)
</code></pre> 
<p><img src="https://images2.imgbox.com/56/a7/cJByoKtN_o.png" alt="在这里插入图片描述"></p> 
<p>9.2， 设置对齐方式，需用到 openpyxl.styles.alignment 模块中的 Alignment 函数</p> 
<p>应用时与字体方式相似，创建 Alignment 方法之后，赋值给 单元格.alignment 即可，格式如下</p> 
<pre><code>ws1['A2'].alignment = Alignment(horizontal = 'centerContinuous',shrinkToFit = True,textRotation = 20,vertical = 'bottom',wrapText = True)
</code></pre> 
<p><img src="https://images2.imgbox.com/0a/d0/gRf95aiG_o.png" alt="在这里插入图片描述"></p> 
<p>9.3，设置填充样式 ，用到 openpyxl.styles.fills 模块提供两种常用的填充方法， GrdaientFill -&gt; 渐变填充 和 PatternFill -&gt; 模式填充；</p> 
<p>应用时，创建一个 GradientFill() 或 PatternFill() 方法，参数设置完之后，赋值给 单元格.fill 即可</p> 
<pre><code>ws1['A2'].fill = PatternFill(bgColor ='DC143C',fill_type = 'solid')
</code></pre> 
<p><img src="https://images2.imgbox.com/df/db/TuOFR96J_o.png" alt="在这里插入图片描述"></p> 
<p>**10，创建新的 sheet **</p> 
<p>**10.1，**新建一个 sheet，修改标题 、指定单元格、 tabColor；</p> 
<pre><code>ws2 = wb.create_sheet(title = "Pi")
ws2['F5'] = 3.14 # 
ws2.sheet_properties.tabColor = "FF0000" # 修改颜色
</code></pre> 
<p><img src="https://images2.imgbox.com/c1/9a/svZhd418_o.png" alt="在这里插入图片描述"></p> 
<p>10.2， 新建 sheet ，对 10-20行，27-54列区域的单元格赋值(列名即可)，</p> 
<pre><code>ws3 = wb.create_sheet(title = "Data")
for row in range(10,20):
    for col in range(27,54):
        _ = ws3.cell(column = col,row =row,value = "{0}".format(get_column_letter(col)))
</code></pre> 
<p><img src="https://images2.imgbox.com/05/77/lGJaNbHu_o.png" alt="在这里插入图片描述"></p> 
<p><strong>11，Excel 保存</strong></p> 
<p>最后移部，把修改之后的 Excel 表格存储在指定位置</p> 
<pre><code>wb.save(filename = dest_filename)
</code></pre> 
<p>案例中的完整代码贴在下方，需要的小伙伴们自取</p> 
<pre><code>from openpyxl import Workbook
from openpyxl.utils import get_column_letter
from openpyxl.utils import FORMULAE
import random

wb =  Workbook()
dest_filename = "Empty_book.xlsx"
ws1 = wb.active
ws1.title = 'range names'


# 对第一个 sheet 操作
for row in range(1,40):
    ws1.append(range(600))
for row in range(1,40):
    ws1["WC{}".format(row)] = '=SUM(A{}:WB{})'.format(row,row)
    
ws1.auto_filter.ref = "A1:WC39"

for row in range(600):
    ws1.auto_filter.add_filter_column(row,vals = ['1','25'])#对每一列加入过滤机制

for i in range(2,40):
    ws1['A{}'.format(i)] = random.choice(range(50))# 更改第一列数据

ws1.auto_filter.add_sort_condition("WC2:WC35") # 对Excel 第一列进行排序


# 插入行和列
ws1.insert_rows(2,amount = 2) #在第二行前面加入两空行
ws1.insert_cols(2,amount = 3) # 在第二列前面加入三个空列


# 删除行与列
ws1.delete_cols(2,amount = 3) # 删除 第 2 列，3列
ws1.delete_rows(4,amount = 5) # 删除 第 4 行，5行


# 合并单元格
ws1.merge_cells(range_string = "A2:F3") # 合并多个单元格，A2-F3
# ws1.merge_cells(start_row=2, start_column=1, end_row=3, end_column=5) # 与上面效果等价;

from openpyxl.styles import colors, Font, Fill, NamedStyle
from openpyxl.styles import PatternFill, Border, Side, Alignment

ws1['A2'] = '合并后标题'
ws1['A2'].font = Font(bold = True,color ='FFB6C1',sz = 15.0,i = True,outline = True)

# 单元格对其设置
ws1['A2'].alignment = Alignment(horizontal = 'centerContinuous',shrinkToFit = True,textRotation = 20,vertical = 'bottom',wrapText = True)


# 单元格填充颜色设置
ws1['A2'].fill = PatternFill(bgColor ='DC143C',fill_type = 'solid')

# 对第二个 sheet 操作
ws2 = wb.create_sheet(title = "Pi")
ws2['F5'] = 3.14 # 
ws2.sheet_properties.tabColor = "FF0000" # 修改颜色

# 对第三个 sheet 操作
ws3 = wb.create_sheet(title = "Data")
for row in range(10,20):
    for col in range(27,54):
        _ = ws3.cell(column = col,row =row,value = "{0}".format(get_column_letter(col)))
        
# 保存Excel 表格
wb.save(dest_filename)
</code></pre> 
<h4><a id="_295"></a>后续会陆陆续续补上一些其它有趣的办公自动化技巧</h4> 
<p><strong>在学习python中有任何困难不懂的可以微信扫描下方CSDN官方认证二维码加入python交流学习，多多交流问题，互帮互助，这里有不错的学习教程和开发工具。</strong><br> （这里每天都会不定时更新python不同题型和教程，希望大家一起学习，一起进步）</p> 
<blockquote> 
 <p>👉<a href="https://mp.weixin.qq.com/s/ZxS5RO3rb59V5z2G4hLRUA" rel="nofollow">[[<font color="red">CSDN大礼包：</font>《python安装包&amp;全套学习资料》免费分享]]</a><font color="green">（<strong>安全链接，放心点击</strong>）</font></p> 
</blockquote> 
<center> 
 <img src="https://images2.imgbox.com/c7/63/j4t9eGDj_o.png"> 
 <center> 
 </center> 
</center> 
<h4><a id="Python_306"></a>Python学习大纲</h4> 
<p>Python所有方向的技术点做的整理，形成各个领域的知识点汇总，它的用处就在于，你可以按照上面的知识点去找对应的学习资源，保证自己学得较为全面。<br> <img src="https://images2.imgbox.com/8a/bb/iDsNO0IM_o.jpg" alt="在这里插入图片描述"></p> 
<h4><a id="_309"></a>入门学习视频</h4> 
<p><img src="https://images2.imgbox.com/8d/04/haCn5lmx_o.png" alt=""></p> 
<h4><a id="Python_311"></a>Python实战案例</h4> 
<p>光学理论是没用的，要学会跟着一起敲，要动手实操，才能将自己的所学运用到实际当中去，这时候可以搞点实战案例来学习。<br> <img src="https://images2.imgbox.com/d5/3c/qyCRv9gQ_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/6e/78/QM7y16IT_o.png" alt="在这里插入图片描述"><br> <strong>最后，千万别辜负自己当时开始的一腔热血，一起变强大变优秀。</strong></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/34fd421a0eccc5f2f0eecd9222c69bed/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">面试经典题---6.Z字形变换</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/159e5adb3abf7f993d628b4e671dcca1/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">新手如何下载并安装Tableau？</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>