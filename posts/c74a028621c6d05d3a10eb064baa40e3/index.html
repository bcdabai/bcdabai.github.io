<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>zabbix 5.0 离线安装 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="zabbix 5.0 离线安装" />
<meta property="og:description" content="zabbix 5.0 离线安装 思路：首先在本地虚拟机安装一个与离线服务器版本一致的系统，然后再本地虚拟机下载需要的rpm包到一个目录下但不安装，之后吧这些rpm包配置成一个yum仓库，打包放到离线服务器中，配置yum源就好。
依赖包下载方式如下：
1、关闭防火墙和selinux。
systemctl stop firewalld
systemctl disable firewalld
setenforce 0 # 设置临时关闭selinux
sed -i ‘s/SELINUX=enforcing/SELINUX=disabled/’ /etc/selinux/config #设置永久关闭selinux
reboot #重启
2、安装 zabbix rpm 源,鉴于国内网络情况，使用阿里云 zabbix 源
rpm -Uvh https://mirrors.aliyun.com/zabbix/zabbix/5.0/rhel/7/x86_64/zabbix-release-5.0-1.el7.noarch.rpm
sed -i ‘s#http://repo.zabbix.com#https://mirrors.aliyun.com/zabbix#’ /etc/yum.repos.d/zabbix.repo
yum clean all
3、下载zabbix server 和 agent软件包
yum install zabbix-server-mysql zabbix-agent --downloadonly --downloaddir=/tmp/offline_rpm
4、下载 Software Collections软件包，便于后续安装高版本的 php。
yum install centos-release-scl --downloadonly --downloaddir=/tmp/offline_rpm
5、安装 Software Collections(该步骤是因为下面的 web界面需要依赖此包，不安装无法下载软件包)
yum install centos-release-scl -y
6、启用 zabbix 前端源，修改vi /etc/yum." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/c74a028621c6d05d3a10eb064baa40e3/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-08-11T16:26:42+08:00" />
<meta property="article:modified_time" content="2022-08-11T16:26:42+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">zabbix 5.0 离线安装</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="zabbix_50__0"></a>zabbix 5.0 离线安装</h3> 
<blockquote> 
 <p>思路：首先在本地虚拟机安装一个与离线服务器版本一致的系统，然后再本地虚拟机下载需要的rpm包到一个目录下但不安装，之后吧这些rpm包配置成一个yum仓库，打包放到离线服务器中，配置yum源就好。</p> 
</blockquote> 
<p>依赖包下载方式如下：<br> 1、关闭防火墙和selinux。</p> 
<p>systemctl stop firewalld</p> 
<p>systemctl disable firewalld</p> 
<p>setenforce 0 # 设置临时关闭selinux</p> 
<p>sed -i ‘s/SELINUX=enforcing/SELINUX=disabled/’ /etc/selinux/config #设置永久关闭selinux</p> 
<p>reboot #重启</p> 
<p>2、安装 zabbix rpm 源,鉴于国内网络情况，使用阿里云 zabbix 源</p> 
<p>rpm -Uvh https://mirrors.aliyun.com/zabbix/zabbix/5.0/rhel/7/x86_64/zabbix-release-5.0-1.el7.noarch.rpm</p> 
<p>sed -i ‘s#http://repo.zabbix.com#https://mirrors.aliyun.com/zabbix#’ /etc/yum.repos.d/zabbix.repo</p> 
<p>yum clean all</p> 
<p>3、下载zabbix server 和 agent软件包</p> 
<p>yum install zabbix-server-mysql zabbix-agent --downloadonly --downloaddir=/tmp/offline_rpm</p> 
<p>4、下载 Software Collections软件包，便于后续安装高版本的 php。</p> 
<p>yum install centos-release-scl --downloadonly --downloaddir=/tmp/offline_rpm</p> 
<p>5、安装 Software Collections(该步骤是因为下面的 web界面需要依赖此包，不安装无法下载软件包)</p> 
<p>yum install centos-release-scl -y</p> 
<p>6、启用 zabbix 前端源，修改vi /etc/yum.repos.d/zabbix.repo，将[zabbix-frontend]下的 enabled 改为 1</p> 
<p>enabled=1</p> 
<p>7、下载zabbix 前端和相关环境软件包</p> 
<p>yum install zabbix-web-mysql-scl zabbix-apache-conf-scl --downloadonly --downloaddir=/tmp/offline_rpm</p> 
<p>8、下载mariadb数据库</p> 
<p>yum install mariadb-server --downloadonly --downloaddir=/tmp/offline_rpm</p> 
<p>9、创建本地yum仓库，使用createrepo来创建repository仓库，如果系统里没有该命令的话需要先进行createrepo的安装</p> 
<p>yum install createrepo</p> 
<p>createrepo /tmp/offline_rpm</p> 
<p>创建好的仓库目录会出现 repodata子目录<br> 　　<img src="https://images2.imgbox.com/ae/f6/NmlPMOxq_o.png" alt="在这里插入图片描述"><br> 10、将 /tmp/offline_rpm/下面全目录 使用SSH等文件传输工具如WinSCP拷贝出来至内网CentOS服务器上面进行安装。</p> 
<p>11、离线服务器yum仓库配置</p> 
<p>a.将 offline_rpm 文件夹传输至 内网主机 /tmp 下<br> b.将/etc/yum.repos.d 下面所有repo文件进行转移至bak文件夹下。(如果没有就自己新建一个bak目录)</p> 
<p>c.新建一个repo文件</p> 
<pre><code class="prism language-php">vi <span class="token operator">/</span>etc<span class="token operator">/</span>yum<span class="token operator">.</span>repos<span class="token operator">.</span>d<span class="token operator">/</span><span class="token keyword">new</span><span class="token operator">.</span>repo
写入如下内容并保存

<span class="token punctuation">[</span><span class="token keyword">New</span><span class="token punctuation">]</span>
name<span class="token operator">=</span><span class="token keyword">New</span>
<span class="token class-name">baseurl</span><span class="token operator">=</span>file<span class="token punctuation">:</span><span class="token comment">///tmp/offline_rpm</span>
gpgcheck<span class="token operator">=</span><span class="token number">0</span>
enabled<span class="token operator">=</span><span class="token number">1</span>
</code></pre> 
<p>e.清理yum，之后开始安装zabbix程序<br> yum clean all</p> 
<p>12、重复第一步的操作关闭防火墙以及selinux.</p> 
<p>13、安装 zabbix server 和 agent</p> 
<p>yum install zabbix-server-mysql zabbix-agent -y</p> 
<p>14、安装 Software Collections，便于后续安装高版本的 php</p> 
<p>yum install centos-release-scl -y</p> 
<p>安装完成后在 /etc/yum.repos.d 目录下又会生成两个新的repo文件，也移动到bak目录下。</p> 
<p><img src="https://images2.imgbox.com/35/36/eYx5wZrL_o.png" alt="
"><br> 15、安装 zabbix 前端和相关环境。</p> 
<p>yum install zabbix-web-mysql-scl zabbix-apache-conf-scl -y</p> 
<p>16、安装mariadb数据库，并设置开机自启动</p> 
<p>yum install mariadb-server -y</p> 
<p>systemctl enable --now mariadb</p> 
<p>17、使用以下命令初始化 mariadb 并配置 root 密码</p> 
<p>mysql_secure_installation</p> 
<p>18、使用 root 用户进入 mysql，并建立 zabbix 数据库，注意数据库编码</p> 
<p>mysql -u root -p （输入数据库root密码进入数据库）</p> 
<p>create database zabbix character set utf8 collate utf8_bin; #创建数据库</p> 
<p>create user zabbix@localhost identified by ‘password’; #创建用户</p> 
<p>grant all privileges on zabbix.* to zabbix@localhost; #授权</p> 
<p>(grant all privileges on * .* to zabbix@‘%’ identified by ‘password’; #赋予任何主机访问数据的权限)</p> 
<p>FLUSH PRIVILEGES;#修改生效</p> 
<p>quit;</p> 
<p>19、导入 zabbix 数据库，zabbix 数据库用户为 zabbix，密码为 password。</p> 
<p>zcat /usr/share/doc/zabbix-server-mysql*/create.sql.gz | mysql -uzabbix -p zabbix</p> 
<p>20、修改 zabbix server 配置文件zabbix_server.conf 里的数据库密码</p> 
<p>vi /etc/zabbix/zabbix_server.conf</p> 
<p>找到 # DBPassword= ，将数据库密码改为zabbix数据库的密码(DBPassword=password)，保存退出。</p> 
<p>21、修改 zabbix 的 php 配置文件，vi /etc/opt/rh/rh-php72/php-fpm.d/zabbix.conf 里的时区，改成 Asia/Shanghai</p> 
<p>php_value[date.timezone] = Asia/Shanghai</p> 
<p>22、启动相关服务，并配置开机自动启动</p> 
<p>systemctl restart zabbix-server zabbix-agent httpd rh-php72-php-fpm</p> 
<p>systemctl enable zabbix-server zabbix-agent httpd rh-php72-php-fpm</p> 
<p>二、界面配置</p> 
<p>1、使用浏览器访问http://ip/zabbix 即可访问 zabbix 的 web 页面。<br> <img src="https://images2.imgbox.com/94/bb/OzEqyqjS_o.png" alt="在这里插入图片描述"><br> 2、点击“Next step”检查组件是否OK<br> <img src="https://images2.imgbox.com/ea/e9/U5tP4Hzt_o.png" alt="在这里插入图片描述"><br> 3、配置连接数据库 ， 输入zabbix帐户的密码，点击“Next step”，<br> <img src="https://images2.imgbox.com/a0/0a/liXsPzsQ_o.png" alt="在这里插入图片描述"><br> 4、点击“Next step”<br> <img src="https://images2.imgbox.com/47/ba/jD4PMPzS_o.png" alt="在这里插入图片描述"><br> 5、点击“Next step”<br> <img src="https://images2.imgbox.com/89/b8/TAjwwAwe_o.png" alt="在这里插入图片描述"><br> 6、看到以上提示，说明安装成功，点"Finish"<br> <img src="https://images2.imgbox.com/4c/b9/ewwaNrup_o.png" alt="在这里插入图片描述"><br> 7、进入登录界面， 用户名：Admin，密码：zabbix<br> <img src="https://images2.imgbox.com/73/87/BNbmEHGy_o.png" alt="在这里插入图片描述"><br> 8、主界面<br> <img src="https://images2.imgbox.com/4e/d1/DIDHioJM_o.png" alt="在这里插入图片描述"><br> 9、设置中文<br> <img src="https://images2.imgbox.com/50/6f/oYbVgKw8_o.png" alt="在这里插入图片描述"><br> 三、安装过程中遇到的问题。</p> 
<p>1、web界面验证时区false</p> 
<p>vi /etc/opt/rh/rh-php72/php-fpm.d/zabbix.conf 里的时区，改成 Asia/Shanghai</p> 
<p>php_value[date.timezone] = Asia/Shanghai</p> 
<p>重启php</p> 
<p>systemctl restart rh-php72-php-fpm<br> 　　<img src="https://images2.imgbox.com/a5/7e/y0skp7Ec_o.png" alt="在这里插入图片描述"><br> zabbix agent安装</p> 
<p>一、agent安装</p> 
<p>1、同样的根据上面的准备将offline_rpm文件夹传到 离线的agent服务器上。配置好yum仓库(参考上述的安装配置中的1~11步骤)。</p> 
<p>2、安装zabbix-agent</p> 
<p>yum install zabbix-agent -y</p> 
<p>3、修改 vi /etc/zabbix/zabbix_agentd.conf 文件。主要配置如下所示，根据自己的配置选择主动模式或被动模式修改。本次我这里使用的是被动模式(IP端口请根据自己实际情况修改)。</p> 
<pre><code class="prism language-php"><span class="token comment">############ GENERAL PARAMETERS #################</span>
<span class="token comment">##### Passive checks related  被动模式</span>
<span class="token comment">### Option: Server</span>
Server<span class="token operator">=</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>     <span class="token comment"># 被动模式下 zabbix server 的地址,也就是允许哪些主机给我发指令</span>
<span class="token comment">### Option: ListenPort</span>
<span class="token comment"># ListenPort=10050   # Agent 自己的监听端口</span>
<span class="token comment">### Option: ListenIP</span>
<span class="token comment"># ListenIP=0.0.0.0   # Agent 自己的监听地址</span>
 
<span class="token comment">##### Active checks related   主动模式</span>
<span class="token comment">### Option: ServerActive</span>
ServerActive<span class="token operator">=</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>    <span class="token comment"># 主动模式下，向这些服务器主动汇报监控数据</span>
<span class="token comment">### Option: Hostname</span>
<span class="token comment"># Hostname=</span>
Hostname<span class="token operator">=</span>Zabbix server    <span class="token comment"># 我在 Server 端的识别码</span>
</code></pre> 
<p>4、配置好后重启zabbix agent.</p> 
<p>systemctl restart zabbix-agent</p> 
<p>二、界面配置添加agent.</p> 
<p>1、界面选择“配置&gt;主机&gt;创建主机”。</p> 
<p><img src="https://images2.imgbox.com/ae/5d/izRaxV4I_o.png" alt="在这里插入图片描述"><br> 2、填写agent服务器信息后选择模板。<br> <img src="https://images2.imgbox.com/3b/2e/DL5HreHc_o.png" alt="在这里插入图片描述"><br> 3、选择agent模板信息后点击添加即可，本步骤只是作为样例，请根据实际需求选择对应模板。<br> <img src="https://images2.imgbox.com/04/50/TAV5qxD3_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/a0/ba/ODAXStAM_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/3c/db/toELQ0xj_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/85/89/fIvOgT4z_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/eb/5d/QP7zpIbv_o.png" alt="在这里插入图片描述"><br> 4、之后便可以在主机界面看到已配置成功的zabbix agent服务器，并且zbx可用性显示正常。<br> <img src="https://images2.imgbox.com/06/a2/o4uBidM9_o.png" alt="在这里插入图片描述"><br> 【摘自】https://www.cnblogs.com/ghl86/p/15657472.html</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0fa1d37233f20c4a318b724c9259aa15/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">linux监视某一进程并自动重启</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/33768afec5259c8c49f4afbd628c4ca6/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">微信小程序监听路由变化</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>