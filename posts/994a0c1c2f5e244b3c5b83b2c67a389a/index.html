<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>vtp技术 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="vtp技术" />
<meta property="og:description" content="文章目录 前言1.vtp1.1 vtp的工作原理1.2 vtp 域1.3 vtp模式1.4 vtp通告1.4.1 vlan通告概述1.4.2 vtp通告类型 1.5 vtp修剪1.6 vtp 配置实例 总结 前言 在大型的企业网中，交换机的数量非常多，而各个交换机的VLAN配置基本相同，因此，在企业交换网络的配置和管理过程中存在很多重复劳动，而且会由此产生一些配置错误，使网络出现故障。为了方便配置与管理，在单个控制点上管理整个网络,Cisco 公司开发了VTP (VLAN Tunking Protocol.虚拟局域网中继协议)，通过使用VTP协议，交换机之间能够互相传递VLAN信息，从而实现了VLAN的统一配置和统一管理。
1.vtp 1.1 vtp的工作原理 VTP是-种消息协议，它使用第二层帧，在交换机之间传递VLAN信息，被称为VTP通告。有了VTP.就可以在一台交换机上集中修改VLAN配置，所做的修改会被自动传播到网络中的其他交换机上，从而实现VLAN配置的一致性。
且实现此功能的前提是这些交换机属于同一个VTP域。
1.2 vtp 域 VTP域也称为VLAN管理域，由一一个以上共享VTP域名的相互连接的交换机组成。也就是说，VTP域是一组VTP域名相同并通过中继链路相互连接的交换机。
要使用VTP.首先必须建立-一个VTP域，在同一管理域中的交换机共享它们的VLAN信息，并且一个交换机只能参加一个VTP域。不同域中的交换机不能共享VTP信息。
下面是VTP域的要求。
➢域内的每台 交换机都必须使用相同的VTP域名，无论是通过配置实现，还是由交换机自动学到。
➢Catalyst交换机必须是相邻的，即相邻的交换机需要具有相同的域名。
➢在所有的Catalyst交换机之间，必须配置为中继链路。
如果上述条件中的任何一项不满足，则VTP域不能连通，信息也就无法跨越分离部分进行传送
1.3 vtp模式 vtp模式决定了交换机处理和通告vtp信息的方式。vtp模式有三种，分别是服务器模式，客户机模式和透明模式。
（1）服务器模式（server）
充当vtp服务器的交换机负责它所在域中vlan信息的管理工作。vtp服务器可以创建，删除或修改vlan，并向外发送vtp通告，同时，vtp服务器也会学习域名相同的vtp通告信息。默认情况下，交换机处于vtp服务器模式。
每个vtp域至少有一个服务器，以便创建，删除或修改vlan及提供vlan信息。
（2）客户机模式（client）
处于此模式的交换机不允许管理员创建，删除或修改vlan。它们监听本域中其他交换机的vtp通告，并相应修改自己的vtp配置
（3）透光模式（transparent）
vtp透光模式中的交换机不参与vtp。当交换机处于透明模式是，它可以创建，删除或修改本地的vlan，但它不向外通告自己的vlan配置信息，对收到的vtp通告只转发而不会学习与更改自己的vlan信息
1.4 vtp通告 1.4.1 vlan通告概述 使用vtp时，加入vtp域的每台交换机在其中继口上通告如下信息
（1)管理域
（2）版本号
（3）配置修改编号
（4）它所知道的vlan
（5）每个已知vlan的某些参数
1.4.2 vtp通告类型 （1）汇总通告：当交换机收到汇总通告时，会进行如下操作
1.如果域名不同，就忽略此通告
2.如果域名相同，则进一步对比配置修改编号
3.如果交换机自身的配置修改编号更高或与之前相等，就忽略此通告。如果更小，就发送通告请求
（2）子集通告
如果在vtp服务器上增加，删除或修改vlan，配置修改编号就会增加，交换机会首先发送汇总通告，然后发送一个或多个子集通告。
子集通告中包括vlan列表和相应的vlan信息。如果有多个vlan，为了通告所有的信息，可能需要发送多个子集通告。
（3）通告请求
交换机在下列情况会发出vtp通告请求
1 交换机重启后" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/994a0c1c2f5e244b3c5b83b2c67a389a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-11-05T16:06:30+08:00" />
<meta property="article:modified_time" content="2021-11-05T16:06:30+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">vtp技术</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_1" rel="nofollow">前言</a></li><li><a href="#1vtp_3" rel="nofollow">1.vtp</a></li><li><ul><li><a href="#11_vtp_4" rel="nofollow">1.1 vtp的工作原理</a></li><li><a href="#12_vtp__7" rel="nofollow">1.2 vtp 域</a></li><li><a href="#13_vtp_17" rel="nofollow">1.3 vtp模式</a></li><li><a href="#14_vtp_26" rel="nofollow">1.4 vtp通告</a></li><li><ul><li><a href="#141_vlan_27" rel="nofollow">1.4.1 vlan通告概述</a></li><li><a href="#142_vtp_34" rel="nofollow">1.4.2 vtp通告类型</a></li></ul> 
   </li><li><a href="#15_vtp_47" rel="nofollow">1.5 vtp修剪</a></li><li><a href="#16_vtp__49" rel="nofollow">1.6 vtp 配置实例</a></li></ul> 
  </li><li><a href="#_185" rel="nofollow">总结</a></li></ul> 
</div> 
<p></p> 
<h2><a id="_1"></a>前言</h2> 
<p>在大型的企业网中，交换机的数量非常多，而各个交换机的VLAN配置基本相同，因此，在企业交换网络的配置和管理过程中存在很多重复劳动，而且会由此产生一些配置错误，使网络出现故障。为了方便配置与管理，在单个控制点上管理整个网络,Cisco 公司开发了VTP (VLAN Tunking Protocol.虚拟局域网中继协议)，通过使用VTP协议，交换机之间能够互相传递VLAN信息，从而实现了VLAN的统一配置和统一管理。</p> 
<h2><a id="1vtp_3"></a>1.vtp</h2> 
<h3><a id="11_vtp_4"></a>1.1 vtp的工作原理</h3> 
<p>VTP是-种消息协议，它使用第二层帧，在交换机之间传递VLAN信息，被称为VTP通告。有了VTP.就可以在一台交换机上集中修改VLAN配置，所做的修改会被自动传播到网络中的其他交换机上，从而实现VLAN配置的一致性。<br> 且实现此功能的前提是这些交换机属于同一个VTP域。</p> 
<h3><a id="12_vtp__7"></a>1.2 vtp 域</h3> 
<p>VTP域也称为VLAN管理域，由一一个以上共享VTP域名的相互连接的交换机组成。也就是说，VTP域是一组VTP域名相同并通过中继链路相互连接的交换机。<br> 要使用VTP.首先必须建立-一个VTP域，在同一管理域中的交换机共享它们的VLAN信息，并且一个交换机只能参加一个VTP域。不同域中的交换机不能共享VTP信息。</p> 
<p>下面是VTP域的要求。<br> ➢域内的每台 交换机都必须使用相同的VTP域名，无论是通过配置实现，还是由交换机自动学到。<br> ➢Catalyst交换机必须是相邻的，即相邻的交换机需要具有相同的域名。<br> ➢在所有的Catalyst交换机之间，必须配置为中继链路。</p> 
<p>如果上述条件中的任何一项不满足，则VTP域不能连通，信息也就无法跨越分离部分进行传送</p> 
<h3><a id="13_vtp_17"></a>1.3 vtp模式</h3> 
<p>vtp模式决定了交换机处理和通告vtp信息的方式。vtp模式有三种，分别是服务器模式，客户机模式和透明模式。<br> （1）服务器模式（server）<br> 充当vtp服务器的交换机负责它所在域中vlan信息的管理工作。vtp服务器可以创建，删除或修改vlan，并向外发送vtp通告，同时，vtp服务器也会学习域名相同的vtp通告信息。默认情况下，交换机处于vtp服务器模式。<br> 每个vtp域至少有一个服务器，以便创建，删除或修改vlan及提供vlan信息。<br> （2）客户机模式（client）<br> 处于此模式的交换机不允许管理员创建，删除或修改vlan。它们监听本域中其他交换机的vtp通告，并相应修改自己的vtp配置<br> （3）透光模式（transparent）<br> vtp透光模式中的交换机不参与vtp。当交换机处于透明模式是，它可以创建，删除或修改本地的vlan，但它不向外通告自己的vlan配置信息，对收到的vtp通告只转发而不会学习与更改自己的vlan信息</p> 
<h3><a id="14_vtp_26"></a>1.4 vtp通告</h3> 
<h4><a id="141_vlan_27"></a>1.4.1 vlan通告概述</h4> 
<p>使用vtp时，加入vtp域的每台交换机在其中继口上通告如下信息<br> （1)管理域<br> （2）版本号<br> （3）配置修改编号<br> （4）它所知道的vlan<br> （5）每个已知vlan的某些参数</p> 
<h4><a id="142_vtp_34"></a>1.4.2 vtp通告类型</h4> 
<p>（1）汇总通告：当交换机收到汇总通告时，会进行如下操作<br> 1.如果域名不同，就忽略此通告<br> 2.如果域名相同，则进一步对比配置修改编号<br> 3.如果交换机自身的配置修改编号更高或与之前相等，就忽略此通告。如果更小，就发送通告请求<br> （2）子集通告<br> 如果在vtp服务器上增加，删除或修改vlan，配置修改编号就会增加，交换机会首先发送汇总通告，然后发送一个或多个子集通告。<br> 子集通告中包括vlan列表和相应的vlan信息。如果有多个vlan，为了通告所有的信息，可能需要发送多个子集通告。<br> （3）通告请求<br> 交换机在下列情况会发出vtp通告请求<br> 1 交换机重启后<br> 2.vtp域名变更后<br> 3 交换机收到了配置编号比自己高的vtp汇总通告后。</p> 
<h3><a id="15_vtp_47"></a>1.5 vtp修剪</h3> 
<p>vtp修建时vtp的一个功能，它能减少中继链路上不必要的广播流量。默认情况下，某个vlan的广播会从中继链路发送到每一个中继接口承载该vlan的交换机上，即使交换机上没有哪个vlan端口也如此。这就意味着，中继链路可能会传送最终该交换机丢弃的广播流量</p> 
<h3><a id="16_vtp__49"></a>1.6 vtp 配置实例</h3> 
<p>（一）设置三台交换机，分别为A,B,C三台，B,C为客户机模式学习到交换机A的vlan信息<br> （1）拓扑图<br> <img src="https://images2.imgbox.com/81/a2/NnvzAKN4_o.png" alt="在这里插入图片描述"><br> （2）首先配置交换机A。Switch&gt;ENable 进入特权模式<br> <img src="https://images2.imgbox.com/cd/59/mgDneiRu_o.png" alt="在这里插入图片描述"><br> （3）Switch#conf t 进入全局模式<br> <img src="https://images2.imgbox.com/ed/ba/rA5hpUSA_o.png" alt="在这里插入图片描述"><br> （4）Switch(config)#int f0/24进入接口模式<br> <img src="https://images2.imgbox.com/e9/66/pY12QbWV_o.png" alt="在这里插入图片描述"><br> （5）Switch(config-if)#switchport mode trunk 强制起trunk<br> <img src="https://images2.imgbox.com/76/ea/BARjZI0P_o.png" alt="在这里插入图片描述"><br> （6）exit退回到全局模式，Switch(config)#vtp domain cisco配置vtp域名为Cisco。<br> <img src="https://images2.imgbox.com/76/24/c8F9lq2M_o.png" alt="在这里插入图片描述"><br> （7）此时直接配置交换机B，Switch&gt;enable进入特权模式<br> <img src="https://images2.imgbox.com/b9/37/OPR7nvEQ_o.png" alt="在这里插入图片描述"></p> 
<p>（8）Switch#conf t进入全局模式<br> <img src="https://images2.imgbox.com/d2/c9/OusqdZ9r_o.png" alt="在这里插入图片描述"></p> 
<p>（9）Switch(config)#int range f0/24 - 23选中24和23号端口<br> <img src="https://images2.imgbox.com/ad/83/rica9FjC_o.png" alt="在这里插入图片描述"></p> 
<p>（10）Switch(config-if-range)#switchport mode trunk 强制起trunk<br> <img src="https://images2.imgbox.com/85/ed/ope6txVM_o.png" alt="在这里插入图片描述"></p> 
<p>（11）Switch(config)#vtp domain cisco，配置交换机vtp域名为Cisco<br> <img src="https://images2.imgbox.com/2a/22/wmLvUPHm_o.png" alt="在这里插入图片描述"></p> 
<p>（12）Switch(config)#vtp mode client ，将交换机B设置为客户机模式<br> <img src="https://images2.imgbox.com/52/ba/nnEQ1Eos_o.png" alt="在这里插入图片描述"></p> 
<p>（13）Switch(config)#vtp password cisco，将交换机vtp配置密码为Cisco<br> <img src="https://images2.imgbox.com/c7/e1/sooF1Ywg_o.png" alt="在这里插入图片描述"></p> 
<p>（14）配置交换机C，Switch&gt;enable进入特权模式<br> <img src="https://images2.imgbox.com/af/43/oPhOJs9K_o.png" alt="在这里插入图片描述"></p> 
<p>（15）Switch(config)#int f0/23选中23号端口<br> <img src="https://images2.imgbox.com/41/d7/D6RRc19f_o.png" alt="在这里插入图片描述"></p> 
<p>（16）Switch(config-if-range)#switchport mode trunk 强制起trunk<br> <img src="https://images2.imgbox.com/3e/3c/ArEPIq0Q_o.png" alt="在这里插入图片描述"></p> 
<p>（17）Switch(config)#vtp domain cisco，配置交换机vtp域名为Cisco<br> <img src="https://images2.imgbox.com/56/5d/WYbkzDvY_o.png" alt="在这里插入图片描述"></p> 
<p>（18）Switch(config)#vtp mode client ，将交换机C设置为客户机模式<br> <img src="https://images2.imgbox.com/2f/5f/ftAaFcAt_o.png" alt="在这里插入图片描述"></p> 
<p>（19）Switch(config)#vtp password cisco，将交换机vtp配置密码为Cisco<br> <img src="https://images2.imgbox.com/3a/54/Pxivt1aF_o.png" alt="在这里插入图片描述"></p> 
<p>（20）回到交换机A，Switch(config)#vtp password cisco，将交换机vtp配置密码为Cisco<br> <img src="https://images2.imgbox.com/f6/24/DXKq3Bwp_o.png" alt="在这里插入图片描述"></p> 
<p>（21）在交换机A中创建vlan2和vlan3<br> <img src="https://images2.imgbox.com/1f/5a/O7L2ctq6_o.png" alt="在这里插入图片描述"></p> 
<p>（22）在特权模式中输入show vtp status查看vtp状态<br> <img src="https://images2.imgbox.com/99/be/i5QNhewB_o.png" alt="在这里插入图片描述"></p> 
<p>（23）在登录交换机B，和C发现，交换机所更改的配置已被学习<br> <img src="https://images2.imgbox.com/82/a6/JCI7Upom_o.png" alt="在这里插入图片描述"><br> （二）建立三台交换机，分别为A,B,C三台，A为服务器模式，B为透明模式，C为客户机模式，透明模式与服务器模式的域名及密码一致，验证后将透明模式交换机改为独立的域名和密码实验<br> （1）配置交换机A，Switch&gt;enable进入特权模式<br> <img src="https://images2.imgbox.com/38/81/NQcMUrCK_o.png" alt="在这里插入图片描述"></p> 
<p>（2）Switch#conf t进入全局模式<br> <img src="https://images2.imgbox.com/1a/7c/odFKnqDG_o.png" alt="在这里插入图片描述"></p> 
<p>（3）Switch(config)#int range f0/24选中24号端口<br> <img src="https://images2.imgbox.com/d3/1d/zpE2yCji_o.png" alt="在这里插入图片描述"></p> 
<p>（4）Switch(config-if-range)#switchport mode trunk 强制起trunk<br> <img src="https://images2.imgbox.com/28/04/IWM1VE3R_o.png" alt="在这里插入图片描述"></p> 
<p>（5）Switch(config)#vtp domain cisco，配置交换机vtp域名为Cisco<br> <img src="https://images2.imgbox.com/41/88/SMYmSg6E_o.png" alt="在这里插入图片描述"></p> 
<p>（6）Switch(config)#vtp password cisco，将交换机vtp配置密码为Cisco<br> <img src="https://images2.imgbox.com/d5/e2/OXVpjrGG_o.png" alt="在这里插入图片描述"><br> （7）配置交换机 B，Switch&gt;enable进入特权模式<br> <img src="https://images2.imgbox.com/f9/ee/x7xZeb8i_o.png" alt="在这里插入图片描述"></p> 
<p>（8）Switch#conf t进入全局模式<br> <img src="https://images2.imgbox.com/68/01/2x0kiioF_o.png" alt="在这里插入图片描述"></p> 
<p>（9）Switch(config)#int range f0/1 - 2，选中一口和二口<br> <img src="https://images2.imgbox.com/8e/50/TGOQ5D8h_o.png" alt="在这里插入图片描述"></p> 
<p>（10）Switch(config-if-range)#switchport mode trunk 强制起trunk<br> <img src="https://images2.imgbox.com/d0/bd/fAI3TOmw_o.png" alt="在这里插入图片描述"></p> 
<p>（11）Switch(config)#vtp domain cisco，配置交换机vtp域名为Cisco<br> <img src="https://images2.imgbox.com/53/cf/1XOlAuk6_o.png" alt="在这里插入图片描述"></p> 
<p>（12）Switch(config)#vtp password cisco，将交换机vtp配置密码为Cisco<br> <img src="https://images2.imgbox.com/f0/80/cAAV1iny_o.png" alt="在这里插入图片描述"><br> （13）Switch(config)#vtp mode transparent 改为透明模式<br> <img src="https://images2.imgbox.com/10/3d/fhuvyCmx_o.png" alt="在这里插入图片描述"><br> （14）配置交换机C，Switch&gt;enable进入特权模式<br> <img src="https://images2.imgbox.com/ba/b4/NgFZM8Ym_o.png" alt="在这里插入图片描述"></p> 
<p>（15）Switch(config)#int f0/选中号端口<br> <img src="https://images2.imgbox.com/82/79/wtxeCRJu_o.png" alt="在这里插入图片描述"></p> 
<p>（16）Switch(config-if-range)#switchport mode trunk 强制起trunk<br> <img src="https://images2.imgbox.com/db/1c/0LEUK841_o.png" alt="在这里插入图片描述"></p> 
<p>（17）Switch(config)#vtp domain cisco，配置交换机vtp域名为Cisco<br> <img src="https://images2.imgbox.com/6a/86/ri9QHIe1_o.png" alt="在这里插入图片描述"></p> 
<p>（18）Switch(config)#vtp mode client ，将交换机C设置为客户机模式<br> <img src="https://images2.imgbox.com/10/2c/7pqHbI1J_o.png" alt="在这里插入图片描述"></p> 
<p>（19）Switch(config)#vtp password cisco，将交换机vtp配置密码为Cisco<br> <img src="https://images2.imgbox.com/16/40/7FGyehKK_o.png" alt="在这里插入图片描述"><br> （20）回到交换机A，创建vlan2和vlan3<br> <img src="https://images2.imgbox.com/3b/81/bJ8zriAx_o.png" alt="在这里插入图片描述"><br> （21）输入show vtp status 查看vtp配置<br> <img src="https://images2.imgbox.com/e8/f9/HkMulwc1_o.png" alt="在这里插入图片描述"><br> （22）打开交换机C，输入show vtp status 查看vtp配置，交换机A所做的vlan配置已被学习<br> <img src="https://images2.imgbox.com/4a/1c/4bIcRFps_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/00/6b/FlF6k0Rq_o.png" alt="在这里插入图片描述"></p> 
<p>（23）更改交换机B的域名和密码<br> <img src="https://images2.imgbox.com/9a/bd/cs4XKzKA_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/6f/23/s3K0oWdj_o.png" alt="在这里插入图片描述"><br> （24）回到交换机A，创建vlan4和vlan5<br> <img src="https://images2.imgbox.com/05/9b/VdUdgxRR_o.png" alt="在这里插入图片描述"><br> （25）打开交换机C，输入show vtp status 查看vtp配置，交换机A所做的vlan配置已被学习<br> <img src="https://images2.imgbox.com/2a/38/qVp2RqwN_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/9b/a6/FnjGY7jk_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_185"></a>总结</h2> 
<p>在交换机vtp模式中 配置版本最高的为被学习方<br> 透明模式只进行转发vtp消息，本身的配置只在本地有效，且不同透明模式为不同域名不同密码时也同样可以转发vtp信息</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ba60ca7991180f187f0e359f82ac5e4c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Mybatis学习笔记总结</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9fc37f76a19a614552490949bb8f60f4/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">python中的dict与json、yaml相互转换</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>