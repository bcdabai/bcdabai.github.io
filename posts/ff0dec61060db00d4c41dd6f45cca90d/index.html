<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Python爬虫笔记——多线程（threading）传参 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Python爬虫笔记——多线程（threading）传参" />
<meta property="og:description" content="参考文章：
Python多线程3 多线程的传参与返回值
BBJG_001的博客——多线程
threading库知识点补充
学习网站：
莫烦Python
学习别人的经验： 在主线程用一个变量或者直接输出就能获取或使用函数中return的值。但是在多线程中，可以这么理解，多线程之间的变量空间是互相隔绝的，所以return是不能把值返回到主进程的，只能在所在的线程使用，线程结束，值所在空间也就被释放了。所以，多线程之间需要一个更加全局性的存储器来保存所有线程之间的值，这里使用queue（队列）来完成这项工作。
什么是队列？
简单介绍一下队列，队列是一种存储结构，就像一个水管一样，给这根水管规定一个方向，只能从一头写入（进水），只能从另一头读出（出水）。
存满了怎么办？
采用动态机制，每存一项，我找一块空间，标记好上一次存储的队列头部；然后把新存入的这项声明为整个队列新的头部。从逻辑上讲，这还是那个队列，动态的增加了一节长度（通过地址指向连接的方式），所以，它是不会满的。（不考虑物理存储空间不够的情况）
读出来在队列中就没了。
下面程序中从队列中读出的命令是q.get()，这个函数不用传参，不像列表那样通过索引取值。上面也提到了，队列只能从一端取值，每次只能取尾部的一个值，这里的取值动作相当于 拿出来，之后尾部会向前移动一个单位，这样也就再能取下一个值了，通过这样的机制，使队列成为了一种先进先出的数据结构。
示例程序：
import threading import time from queue import Queue # def job(l, q): # for i in range(len(l)): # l[i] = l[i]**2 # return l # 在普通的函数定义时，使用return来返回值 def job(l, q): for i in range(len(l)): l[i] = l[i]**2 q.put(l) # 在多线程中，即使return了，也只能return到当前线程，无法给主线程调用，因此这里用一个更加全局性的存储器——queue（队列）——来存储多个线程的结果 # time.sleep(1) def multithreading(): q = Queue() threads = [] data = [[1,2,3],[3,4,5],[4,4,4],[5,5,5]] for i in range(4): # for1 t = threading." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/ff0dec61060db00d4c41dd6f45cca90d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-08-21T19:49:16+08:00" />
<meta property="article:modified_time" content="2020-08-21T19:49:16+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Python爬虫笔记——多线程（threading）传参</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>参考文章：<br> <a href="http://itdarcy.wang/index.php/20200112/424" rel="nofollow">Python多线程3 多线程的传参与返回值</a><br> <a href="https://blog.csdn.net/bbjg_001/category_9659643.html">BBJG_001的博客——多线程</a><br> <a href="https://www.cnblogs.com/kaibindirver/p/12717924.html" rel="nofollow">threading库知识点补充</a><br> 学习网站：<br> <a href="https://mofanpy.com/" rel="nofollow">莫烦Python</a></p> 
<h3><a id="_7"></a>学习别人的经验：</h3> 
<p>在主线程用一个变量或者直接输出就能获取或使用函数中return的值。但是在多线程中，可以这么理解，多线程之间的变量空间是互相隔绝的，所以return是不能把值返回到主进程的，只能在所在的线程使用，线程结束，值所在空间也就被释放了。所以，多线程之间需要一个更加全局性的存储器来保存所有线程之间的值，这里使用queue（队列）来完成这项工作。</p> 
<p><strong>什么是队列？</strong><br> 简单介绍一下队列，队列是一种存储结构，就像一个水管一样，给这根水管规定一个方向，只能从一头写入（进水），只能从另一头读出（出水）。<br> <strong>存满了怎么办？</strong><br> 采用动态机制，每存一项，我找一块空间，标记好上一次存储的队列头部；然后把新存入的这项声明为整个队列新的头部。从逻辑上讲，这还是那个队列，动态的增加了一节长度（通过地址指向连接的方式），所以，它是不会满的。（不考虑物理存储空间不够的情况）<br> 读出来在队列中就没了。<br> 下面程序中从队列中读出的命令是q.get()，这个函数不用传参，不像列表那样通过索引取值。上面也提到了，队列只能从一端取值，每次只能取尾部的一个值，这里的取值动作相当于 拿出来，之后尾部会向前移动一个单位，这样也就再能取下一个值了，通过这样的机制，使队列成为了一种先进先出的数据结构。</p> 
<p><strong>示例程序：</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> threading
<span class="token keyword">import</span> time
<span class="token keyword">from</span> queue <span class="token keyword">import</span> Queue
 
<span class="token comment"># def job(l, q):</span>
<span class="token comment">#     for i in range(len(l)):</span>
<span class="token comment">#         l[i] = l[i]**2</span>
<span class="token comment">#     return l      # 在普通的函数定义时，使用return来返回值</span>
 
<span class="token keyword">def</span> <span class="token function">job</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span> q<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        l<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> l<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">**</span><span class="token number">2</span>
    q<span class="token punctuation">.</span>put<span class="token punctuation">(</span>l<span class="token punctuation">)</span>        <span class="token comment"># 在多线程中，即使return了，也只能return到当前线程，无法给主线程调用，因此这里用一个更加全局性的存储器——queue（队列）——来存储多个线程的结果</span>
    <span class="token comment"># time.sleep(1)</span>
 
<span class="token keyword">def</span> <span class="token function">multithreading</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    q <span class="token operator">=</span> Queue<span class="token punctuation">(</span><span class="token punctuation">)</span>
    threads <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># for1</span>
        t <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>job<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> q<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment"># 注意这里target属性只用来指定调用的函数的名称，没有后面的括号</span>
        <span class="token comment"># args属性用来传递参数</span>
        t<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
        threads<span class="token punctuation">.</span>append<span class="token punctuation">(</span>t<span class="token punctuation">)</span>
 
    <span class="token comment"># 至于下面的两个循环，实践证明是可以合并的</span>
    <span class="token keyword">for</span> thread <span class="token keyword">in</span> threads<span class="token punctuation">:</span>  <span class="token comment"># for2</span>
        thread<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>
    results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span>      <span class="token comment"># for3</span>
        results<span class="token punctuation">.</span>append<span class="token punctuation">(</span>q<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>     <span class="token comment"># 这里为什么不能写入上面的循环，如果单个线程执行的慢，q.get()是无法取到值的</span>
 
    <span class="token comment"># 合并写法</span>
    <span class="token comment"># results = []</span>
    <span class="token comment"># for thread in threads:</span>
    <span class="token comment">#     thread.join()</span>
    <span class="token comment">#     results.append(q.get())</span>
 
    <span class="token keyword">print</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span>
 
 
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    multithreading<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>直接return是不行滴，用一个全局queue（队列）来实现值传递</p> 
<p>导入支持包from queue import Queue</p> 
<p>声明一个queueq = Queue()</p> 
<p>向队列中存值q.put(值)</p> 
<p>从队列中取值q.get()</p> 
<p>上面的程序就是每个线程处理一段数据，将处理结果存入队列，所有线程都结束之后，从队列中依次取出各线程的操作结果，并print出来。</p> 
<p>会发现上面的程序中写了三个for循环，其循环结构都是一样的，都是针对4个线程，每轮循环处理一个线程，但是它们确实是不能合在一块的，至少for2和for3是不能放在for1中的。</p> 
<p>如果把for2中的.join()加到for1中，第一轮第一个线程.join之后，后面的会等第一个线程结束之后才会执行，则在第一个线程完成之前不会去生成第二个线程的，同理，后面的线程都会等待前面的线程完成之后才会生成。这样程序就变成了串行的（为了看到效果可以在job()函数中做一段时间延迟（time.sleep()），就会发现把.join()加到for1中，执行时间变成了原来的4倍（因为有4个线程串行）），多线程也就没有了意义。</p> 
<p>如果把for3的代码加到for1中，results.append(q.get())是主线程的操作，它不会等待非主线程（上面刚提到for1中不能.join()），如果非主线程耗时比较长，则会发生队列还没有被写入（q.put(值)）就已经开始读（q.get()）的错误。</p> 
<p>测试了for2和for3合并起来是不会影响效率的，但是也只局限于这个程序，实际上这样搞也是不科学的。在这个程序中，results.append()每次append的都是这一轮线程的，如果要操作到之后线程的结果，因为之后的线程没有.join()，就有可能发生取不到值的情况。</p> 
<p>综上，写成三个for还是很有必要的。也就是如果要操作多个线程的结果，严格分成 线程声明执行、进程.join()、操作多个进程结果三步才是安全且有必要的。</p> 
<h3><a id="_88"></a>以下是我自己的摸索：</h3> 
<pre><code class="prism language-python"><span class="token keyword">import</span> threading
<span class="token keyword">import</span> math
<span class="token keyword">import</span> time


<span class="token keyword">def</span> <span class="token function">one_list_to_more</span><span class="token punctuation">(</span>items<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">return</span> <span class="token punctuation">[</span>items<span class="token punctuation">[</span>i<span class="token punctuation">:</span>i <span class="token operator">+</span> n<span class="token punctuation">]</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>items<span class="token punctuation">)</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token comment">#多线程进入不同的药品详情页拿低价商品</span>
<span class="token keyword">def</span> <span class="token function">multi_threading</span><span class="token punctuation">(</span>new_goods_id_list<span class="token punctuation">)</span><span class="token punctuation">:</span>
	number <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>new_goods_id_list<span class="token punctuation">)</span>
	n <span class="token operator">=</span>  math<span class="token punctuation">.</span>ceil<span class="token punctuation">(</span>number<span class="token operator">/</span><span class="token number">5</span><span class="token punctuation">)</span>    <span class="token comment">#5,是为了分为5组</span>
	<span class="token comment"># 将商品集合转为二维列表，用于控制并发循环</span>
	_get_goods_info_list <span class="token operator">=</span> one_list_to_more<span class="token punctuation">(</span>new_goods_id_list<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
	thread_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
	<span class="token comment"># 取每个小列表的商品获取详情</span>
	<span class="token keyword">for</span> items_list <span class="token keyword">in</span> _get_goods_info_list<span class="token punctuation">:</span>
		t <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>run_main<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>items_list<span class="token punctuation">)</span><span class="token punctuation">)</span>
		thread_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>t<span class="token punctuation">)</span>
	<span class="token keyword">for</span> t <span class="token keyword">in</span> thread_list<span class="token punctuation">:</span>
		t<span class="token punctuation">.</span>setDaemon<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>  <span class="token comment"># 设置为守护线程，不会因主线程结束而中断</span>
		t<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">for</span> t <span class="token keyword">in</span> thread_list<span class="token punctuation">:</span>
		t<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 子线程全部加入，主线程等所有子线程运行完毕</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'主线程结束\n'</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">run_main</span><span class="token punctuation">(</span><span class="token operator">*</span>arg<span class="token punctuation">)</span><span class="token punctuation">:</span>
	threadname <span class="token operator">=</span> threading<span class="token punctuation">.</span>currentThread<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>getName<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'开始线程：'</span><span class="token punctuation">,</span> threadname <span class="token operator">+</span> <span class="token string">'//'</span> <span class="token operator">+</span> <span class="token string">'%s'</span> <span class="token operator">%</span> time<span class="token punctuation">.</span>ctime<span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token operator">*</span>arg<span class="token punctuation">)</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'线程结束：'</span><span class="token punctuation">,</span> threadname <span class="token operator">+</span> <span class="token string">'//'</span> <span class="token operator">+</span> <span class="token string">'%s'</span> <span class="token operator">%</span> time<span class="token punctuation">.</span>ctime<span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

new_goods_id_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">17</span><span class="token punctuation">,</span><span class="token number">18</span><span class="token punctuation">,</span><span class="token number">19</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">]</span>
multi_threading<span class="token punctuation">(</span>new_goods_id_list<span class="token punctuation">)</span>
</code></pre> 
<p>运行结果：</p> 
<pre><code class="prism language-python">开始线程： Thread<span class="token operator">-</span><span class="token number">1</span><span class="token operator">//</span>Fri Aug <span class="token number">21</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">23</span><span class="token punctuation">:</span><span class="token number">07</span> <span class="token number">2020</span>
<span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span> <span class="token number">4</span>
<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span>
开始线程：线程结束：  Thread<span class="token operator">-</span><span class="token number">1</span><span class="token operator">//</span>Fri Aug <span class="token number">21</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">23</span><span class="token punctuation">:</span><span class="token number">07</span> <span class="token number">2020</span>
Thread<span class="token operator">-</span><span class="token number">2</span><span class="token operator">//</span>Fri Aug <span class="token number">21</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">23</span><span class="token punctuation">:</span><span class="token number">07</span> <span class="token number">2020</span>
<span class="token number">5</span> <span class="token number">6</span> <span class="token number">7</span> <span class="token number">8</span>
<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span>
线程结束： Thread<span class="token operator">-</span><span class="token number">2</span><span class="token operator">//</span>Fri Aug <span class="token number">21</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">23</span><span class="token punctuation">:</span><span class="token number">07</span> <span class="token number">2020</span>
开始线程： Thread<span class="token operator">-</span><span class="token number">3</span><span class="token operator">//</span>Fri Aug <span class="token number">21</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">23</span><span class="token punctuation">:</span><span class="token number">07</span> <span class="token number">2020</span>
<span class="token number">9</span> <span class="token number">10</span> <span class="token number">11</span> <span class="token number">12</span>
<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">]</span>
线程结束： Thread<span class="token operator">-</span><span class="token number">3</span><span class="token operator">//</span>Fri Aug <span class="token number">21</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">23</span><span class="token punctuation">:</span><span class="token number">07</span> <span class="token number">2020</span>开始线程：
 Thread<span class="token operator">-</span><span class="token number">4</span><span class="token operator">//</span>Fri Aug <span class="token number">21</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">23</span><span class="token punctuation">:</span><span class="token number">07</span> <span class="token number">2020</span>
<span class="token number">13</span> <span class="token number">14</span> <span class="token number">15</span> <span class="token number">16</span>
<span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">]</span>
线程结束： Thread<span class="token operator">-</span><span class="token number">4</span><span class="token operator">//</span>Fri Aug <span class="token number">21</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">23</span><span class="token punctuation">:</span><span class="token number">07</span> <span class="token number">2020</span>
开始线程： Thread<span class="token operator">-</span><span class="token number">5</span><span class="token operator">//</span>Fri Aug <span class="token number">21</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">23</span><span class="token punctuation">:</span><span class="token number">07</span> <span class="token number">2020</span>
<span class="token number">17</span> <span class="token number">18</span> <span class="token number">19</span> <span class="token number">20</span>
<span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">]</span>
线程结束： Thread<span class="token operator">-</span><span class="token number">5</span><span class="token operator">//</span>Fri Aug <span class="token number">21</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">23</span><span class="token punctuation">:</span><span class="token number">07</span> <span class="token number">2020</span>
主线程结束
</code></pre> 
<h3><a id="_158"></a><strong>注意观察多线程传参：</strong></h3> 
<h3><a id="_160"></a>一</h3> 
<p><strong>代码：</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> threading
<span class="token keyword">import</span> math
<span class="token keyword">import</span> time
<span class="token keyword">from</span> queue <span class="token keyword">import</span> Queue


<span class="token keyword">def</span> <span class="token function">one_list_to_more</span><span class="token punctuation">(</span>items<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">return</span> <span class="token punctuation">[</span>items<span class="token punctuation">[</span>i<span class="token punctuation">:</span>i <span class="token operator">+</span> n<span class="token punctuation">]</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>items<span class="token punctuation">)</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token comment">#多线程进入不同的药品详情页拿低价商品</span>
<span class="token keyword">def</span> <span class="token function">multi_threading</span><span class="token punctuation">(</span>new_goods_id_list<span class="token punctuation">)</span><span class="token punctuation">:</span>
	number <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>new_goods_id_list<span class="token punctuation">)</span>
	n <span class="token operator">=</span>  math<span class="token punctuation">.</span>ceil<span class="token punctuation">(</span>number<span class="token operator">/</span><span class="token number">5</span><span class="token punctuation">)</span>    <span class="token comment">#5,是为了分为5组</span>
	<span class="token comment"># 将商品集合转为二维列表，用于控制并发循环</span>
	_get_goods_info_list <span class="token operator">=</span> one_list_to_more<span class="token punctuation">(</span>new_goods_id_list<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
	thread_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
	q <span class="token operator">=</span> Queue<span class="token punctuation">(</span><span class="token punctuation">)</span>
	m <span class="token operator">=</span> <span class="token number">2</span>
	<span class="token comment"># 取每个小列表的商品获取详情</span>
	<span class="token keyword">for</span> items_list <span class="token keyword">in</span> _get_goods_info_list<span class="token punctuation">:</span>
		t <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>run_main<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>items_list<span class="token punctuation">)</span><span class="token punctuation">)</span>
		thread_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>t<span class="token punctuation">)</span>
	<span class="token keyword">for</span> t <span class="token keyword">in</span> thread_list<span class="token punctuation">:</span>
		t<span class="token punctuation">.</span>setDaemon<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>  <span class="token comment"># 设置为守护线程，不会因主线程结束而中断</span>
		t<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">for</span> t <span class="token keyword">in</span> thread_list<span class="token punctuation">:</span>
		t<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 子线程全部加入，主线程等所有子线程运行完毕</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'主线程结束\n'</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">run_main</span><span class="token punctuation">(</span>items_list<span class="token punctuation">)</span><span class="token punctuation">:</span>
	threadname <span class="token operator">=</span> threading<span class="token punctuation">.</span>currentThread<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>getName<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'开始线程：'</span><span class="token punctuation">,</span> threadname <span class="token operator">+</span> <span class="token string">'//'</span> <span class="token operator">+</span> <span class="token string">'%s'</span> <span class="token operator">%</span> time<span class="token punctuation">.</span>ctime<span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token comment"># print(*arg)</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span>items_list<span class="token punctuation">)</span>
	<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>items_list<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
		items_list<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> items_list<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">**</span><span class="token number">2</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span>items_list<span class="token punctuation">)</span>
	<span class="token comment">#print(m)  # 在</span>

	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'线程结束：'</span><span class="token punctuation">,</span> threadname <span class="token operator">+</span> <span class="token string">'//'</span> <span class="token operator">+</span> <span class="token string">'%s'</span> <span class="token operator">%</span> time<span class="token punctuation">.</span>ctime<span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

new_goods_id_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">17</span><span class="token punctuation">,</span><span class="token number">18</span><span class="token punctuation">,</span><span class="token number">19</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">]</span>
multi_threading<span class="token punctuation">(</span>new_goods_id_list<span class="token punctuation">)</span>
</code></pre> 
<p><strong><strong>运行错误</strong>：</strong></p> 
<pre><code class="prism language-python">Exception <span class="token keyword">in</span> thread Thread<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">:</span>
Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>
  File <span class="token string">"C:\Python\lib\threading.py"</span><span class="token punctuation">,</span> line <span class="token number">926</span><span class="token punctuation">,</span> <span class="token keyword">in</span> _bootstrap_inner
    self<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>
  File <span class="token string">"C:\Python\lib\threading.py"</span><span class="token punctuation">,</span> line <span class="token number">870</span><span class="token punctuation">,</span> <span class="token keyword">in</span> run
    self<span class="token punctuation">.</span>_target<span class="token punctuation">(</span><span class="token operator">*</span>self<span class="token punctuation">.</span>_args<span class="token punctuation">,</span> <span class="token operator">**</span>self<span class="token punctuation">.</span>_kwargs<span class="token punctuation">)</span>
TypeError<span class="token punctuation">:</span> run_main<span class="token punctuation">(</span><span class="token punctuation">)</span> takes <span class="token number">1</span> positional argument but <span class="token number">4</span> were given
Exception <span class="token keyword">in</span> thread Thread<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>
Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>
  File <span class="token string">"C:\Python\lib\threading.py"</span><span class="token punctuation">,</span> line <span class="token number">926</span><span class="token punctuation">,</span> <span class="token keyword">in</span> _bootstrap_inner
    self<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>
  File <span class="token string">"C:\Python\lib\threading.py"</span><span class="token punctuation">,</span> line <span class="token number">870</span><span class="token punctuation">,</span> <span class="token keyword">in</span> run
    self<span class="token punctuation">.</span>_target<span class="token punctuation">(</span><span class="token operator">*</span>self<span class="token punctuation">.</span>_args<span class="token punctuation">,</span> <span class="token operator">**</span>self<span class="token punctuation">.</span>_kwargs<span class="token punctuation">)</span>
TypeError<span class="token punctuation">:</span> run_main<span class="token punctuation">(</span><span class="token punctuation">)</span> takes <span class="token number">1</span> positional argument but <span class="token number">4</span> were given
Exception <span class="token keyword">in</span> thread Thread<span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">:</span>
Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>
  File <span class="token string">"C:\Python\lib\threading.py"</span><span class="token punctuation">,</span> line <span class="token number">926</span><span class="token punctuation">,</span> <span class="token keyword">in</span> _bootstrap_inner
    self<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>
  File <span class="token string">"C:\Python\lib\threading.py"</span><span class="token punctuation">,</span> line <span class="token number">870</span><span class="token punctuation">,</span> <span class="token keyword">in</span> run
    self<span class="token punctuation">.</span>_target<span class="token punctuation">(</span><span class="token operator">*</span>self<span class="token punctuation">.</span>_args<span class="token punctuation">,</span> <span class="token operator">**</span>self<span class="token punctuation">.</span>_kwargs<span class="token punctuation">)</span>
TypeError<span class="token punctuation">:</span> run_main<span class="token punctuation">(</span><span class="token punctuation">)</span> takes <span class="token number">1</span> positional argument but <span class="token number">4</span> were given


Exception <span class="token keyword">in</span> thread Thread<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">:</span>
Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>
  File <span class="token string">"C:\Python\lib\threading.py"</span><span class="token punctuation">,</span> line <span class="token number">926</span><span class="token punctuation">,</span> <span class="token keyword">in</span> _bootstrap_inner
    self<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>
  File <span class="token string">"C:\Python\lib\threading.py"</span><span class="token punctuation">,</span> line <span class="token number">870</span><span class="token punctuation">,</span> <span class="token keyword">in</span> run
    self<span class="token punctuation">.</span>_target<span class="token punctuation">(</span><span class="token operator">*</span>self<span class="token punctuation">.</span>_args<span class="token punctuation">,</span> <span class="token operator">**</span>self<span class="token punctuation">.</span>_kwargs<span class="token punctuation">)</span>
TypeError<span class="token punctuation">:</span> run_main<span class="token punctuation">(</span><span class="token punctuation">)</span> takes <span class="token number">1</span> positional argument but <span class="token number">4</span> were given

Exception <span class="token keyword">in</span> thread Thread<span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">:</span>
Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>
  File <span class="token string">"C:\Python\lib\threading.py"</span><span class="token punctuation">,</span> line <span class="token number">926</span><span class="token punctuation">,</span> <span class="token keyword">in</span> _bootstrap_inner
    self<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>
  File <span class="token string">"C:\Python\lib\threading.py"</span><span class="token punctuation">,</span> line <span class="token number">870</span><span class="token punctuation">,</span> <span class="token keyword">in</span> run
    self<span class="token punctuation">.</span>_target<span class="token punctuation">(</span><span class="token operator">*</span>self<span class="token punctuation">.</span>_args<span class="token punctuation">,</span> <span class="token operator">**</span>self<span class="token punctuation">.</span>_kwargs<span class="token punctuation">)</span>
TypeError<span class="token punctuation">:</span> run_main<span class="token punctuation">(</span><span class="token punctuation">)</span> takes <span class="token number">1</span> positional argument but <span class="token number">4</span> were given

主线程结束
</code></pre> 
<h3><a id="_251"></a>二</h3> 
<p><strong>对其中传参进行改动：</strong><br> <strong>代码：</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> threading
<span class="token keyword">import</span> math
<span class="token keyword">import</span> time
<span class="token keyword">from</span> queue <span class="token keyword">import</span> Queue


<span class="token keyword">def</span> <span class="token function">one_list_to_more</span><span class="token punctuation">(</span>items<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">return</span> <span class="token punctuation">[</span>items<span class="token punctuation">[</span>i<span class="token punctuation">:</span>i <span class="token operator">+</span> n<span class="token punctuation">]</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>items<span class="token punctuation">)</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token comment">#多线程进入不同的药品详情页拿低价商品</span>
<span class="token keyword">def</span> <span class="token function">multi_threading</span><span class="token punctuation">(</span>new_goods_id_list<span class="token punctuation">)</span><span class="token punctuation">:</span>
	number <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>new_goods_id_list<span class="token punctuation">)</span>
	n <span class="token operator">=</span>  math<span class="token punctuation">.</span>ceil<span class="token punctuation">(</span>number<span class="token operator">/</span><span class="token number">5</span><span class="token punctuation">)</span>    <span class="token comment">#5,是为了分为5组</span>
	<span class="token comment"># 将商品集合转为二维列表，用于控制并发循环</span>
	_get_goods_info_list <span class="token operator">=</span> one_list_to_more<span class="token punctuation">(</span>new_goods_id_list<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
	thread_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
	q <span class="token operator">=</span> Queue<span class="token punctuation">(</span><span class="token punctuation">)</span>
	m <span class="token operator">=</span> <span class="token number">2</span>
	<span class="token comment"># 取每个小列表的商品获取详情</span>
	<span class="token keyword">for</span> items_list <span class="token keyword">in</span> _get_goods_info_list<span class="token punctuation">:</span>
		t <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>run_main<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>items_list<span class="token punctuation">,</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span>
		thread_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>t<span class="token punctuation">)</span>
	<span class="token keyword">for</span> t <span class="token keyword">in</span> thread_list<span class="token punctuation">:</span>
		t<span class="token punctuation">.</span>setDaemon<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>  <span class="token comment"># 设置为守护线程，不会因主线程结束而中断</span>
		t<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">for</span> t <span class="token keyword">in</span> thread_list<span class="token punctuation">:</span>
		t<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 子线程全部加入，主线程等所有子线程运行完毕</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'主线程结束\n'</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">run_main</span><span class="token punctuation">(</span>items_list<span class="token punctuation">,</span>m<span class="token punctuation">)</span><span class="token punctuation">:</span>
	threadname <span class="token operator">=</span> threading<span class="token punctuation">.</span>currentThread<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>getName<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'开始线程：'</span><span class="token punctuation">,</span> threadname <span class="token operator">+</span> <span class="token string">'//'</span> <span class="token operator">+</span> <span class="token string">'%s'</span> <span class="token operator">%</span> time<span class="token punctuation">.</span>ctime<span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token comment"># print(*arg)</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span>items_list<span class="token punctuation">)</span>
	<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>items_list<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
		items_list<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> items_list<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">**</span><span class="token number">2</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span>items_list<span class="token punctuation">)</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span>  <span class="token comment"># 在</span>

	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'线程结束：'</span><span class="token punctuation">,</span> threadname <span class="token operator">+</span> <span class="token string">'//'</span> <span class="token operator">+</span> <span class="token string">'%s'</span> <span class="token operator">%</span> time<span class="token punctuation">.</span>ctime<span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

new_goods_id_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">17</span><span class="token punctuation">,</span><span class="token number">18</span><span class="token punctuation">,</span><span class="token number">19</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">]</span>
multi_threading<span class="token punctuation">(</span>new_goods_id_list<span class="token punctuation">)</span>
</code></pre> 
<p>运行结果：</p> 
<pre><code class="prism language-python">开始线程： Thread<span class="token operator">-</span><span class="token number">1</span><span class="token operator">//</span>Fri Aug <span class="token number">21</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">39</span><span class="token punctuation">:</span><span class="token number">19</span> <span class="token number">2020</span>
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">]</span>
<span class="token number">2</span>
线程结束： Thread<span class="token operator">-</span><span class="token number">1</span><span class="token operator">//</span>Fri Aug <span class="token number">21</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">39</span><span class="token punctuation">:</span><span class="token number">19</span> <span class="token number">2020</span>
开始线程： Thread<span class="token operator">-</span><span class="token number">2</span><span class="token operator">//</span>Fri Aug <span class="token number">21</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">39</span><span class="token punctuation">:</span><span class="token number">19</span> <span class="token number">2020</span>
<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">]</span>
<span class="token number">2</span>
线程结束： Thread<span class="token operator">-</span><span class="token number">2</span><span class="token operator">//</span>Fri Aug <span class="token number">21</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">39</span><span class="token punctuation">:</span><span class="token number">19</span> <span class="token number">2020</span>
开始线程： Thread<span class="token operator">-</span><span class="token number">3</span><span class="token operator">//</span>Fri Aug <span class="token number">21</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">39</span><span class="token punctuation">:</span><span class="token number">19</span> <span class="token number">2020</span>
<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token number">81</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">121</span><span class="token punctuation">,</span> <span class="token number">144</span><span class="token punctuation">]</span>
<span class="token number">2</span>
线程结束： Thread<span class="token operator">-</span><span class="token number">3</span><span class="token operator">//</span>Fri Aug <span class="token number">21</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">39</span><span class="token punctuation">:</span><span class="token number">19</span> <span class="token number">2020</span>
开始线程： Thread<span class="token operator">-</span><span class="token number">4</span><span class="token operator">//</span>Fri Aug <span class="token number">21</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">39</span><span class="token punctuation">:</span><span class="token number">19</span> <span class="token number">2020</span>
<span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token number">169</span><span class="token punctuation">,</span> <span class="token number">196</span><span class="token punctuation">,</span> <span class="token number">225</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">]</span>
<span class="token number">2</span>
线程结束： Thread<span class="token operator">-</span><span class="token number">4</span><span class="token operator">//</span>Fri Aug <span class="token number">21</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">39</span><span class="token punctuation">:</span><span class="token number">19</span> <span class="token number">2020</span>
开始线程： Thread<span class="token operator">-</span><span class="token number">5</span><span class="token operator">//</span>Fri Aug <span class="token number">21</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">39</span><span class="token punctuation">:</span><span class="token number">19</span> <span class="token number">2020</span>
<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token number">289</span><span class="token punctuation">,</span> <span class="token number">324</span><span class="token punctuation">,</span> <span class="token number">361</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">]</span>
<span class="token number">2</span>
线程结束： Thread<span class="token operator">-</span><span class="token number">5</span><span class="token operator">//</span>Fri Aug <span class="token number">21</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">39</span><span class="token punctuation">:</span><span class="token number">19</span> <span class="token number">2020</span>
主线程结束
</code></pre> 
<h3><a id="_329"></a>三</h3> 
<p><strong>再次改动代码：</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> threading
<span class="token keyword">import</span> math
<span class="token keyword">import</span> time


<span class="token keyword">def</span> <span class="token function">one_list_to_more</span><span class="token punctuation">(</span>items<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">return</span> <span class="token punctuation">[</span>items<span class="token punctuation">[</span>i<span class="token punctuation">:</span>i <span class="token operator">+</span> n<span class="token punctuation">]</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>items<span class="token punctuation">)</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token comment">#多线程进入不同的药品详情页拿低价商品</span>
<span class="token keyword">def</span> <span class="token function">multi_threading</span><span class="token punctuation">(</span>new_goods_id_list<span class="token punctuation">)</span><span class="token punctuation">:</span>
	number <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>new_goods_id_list<span class="token punctuation">)</span>
	n <span class="token operator">=</span>  math<span class="token punctuation">.</span>ceil<span class="token punctuation">(</span>number<span class="token operator">/</span><span class="token number">5</span><span class="token punctuation">)</span>    <span class="token comment">#5,是为了分为5组</span>
	<span class="token comment"># 将商品集合转为二维列表，用于控制并发循环</span>
	_get_goods_info_list <span class="token operator">=</span> one_list_to_more<span class="token punctuation">(</span>new_goods_id_list<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
	thread_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
	m <span class="token operator">=</span> <span class="token number">2</span>
	<span class="token comment"># 取每个小列表的商品获取详情</span>
	<span class="token keyword">for</span> items_list <span class="token keyword">in</span> _get_goods_info_list<span class="token punctuation">:</span>
		t <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>run_main<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>items_list<span class="token punctuation">)</span><span class="token punctuation">)</span>
		thread_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>t<span class="token punctuation">)</span>
	<span class="token keyword">for</span> t <span class="token keyword">in</span> thread_list<span class="token punctuation">:</span>
		t<span class="token punctuation">.</span>setDaemon<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>  <span class="token comment"># 设置为守护线程，不会因主线程结束而中断</span>
		t<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">for</span> t <span class="token keyword">in</span> thread_list<span class="token punctuation">:</span>
		t<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 子线程全部加入，主线程等所有子线程运行完毕</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'主线程结束\n'</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">run_main</span><span class="token punctuation">(</span><span class="token operator">*</span>items_list<span class="token punctuation">)</span><span class="token punctuation">:</span>
	threadname <span class="token operator">=</span> threading<span class="token punctuation">.</span>currentThread<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>getName<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'开始线程：'</span><span class="token punctuation">,</span> threadname <span class="token operator">+</span> <span class="token string">'//'</span> <span class="token operator">+</span> <span class="token string">'%s'</span> <span class="token operator">%</span> time<span class="token punctuation">.</span>ctime<span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token operator">*</span>items_list<span class="token punctuation">)</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span>items_list<span class="token punctuation">)</span>
	items_list <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>items_list<span class="token punctuation">)</span>
	<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>items_list<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
		items_list<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> items_list<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">**</span><span class="token number">2</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span>items_list<span class="token punctuation">)</span>

	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'线程结束：'</span><span class="token punctuation">,</span> threadname <span class="token operator">+</span> <span class="token string">'//'</span> <span class="token operator">+</span> <span class="token string">'%s'</span> <span class="token operator">%</span> time<span class="token punctuation">.</span>ctime<span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

new_goods_id_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">17</span><span class="token punctuation">,</span><span class="token number">18</span><span class="token punctuation">,</span><span class="token number">19</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">]</span>
multi_threading<span class="token punctuation">(</span>new_goods_id_list<span class="token punctuation">)</span>
</code></pre> 
<p><strong>运行结果：</strong></p> 
<pre><code class="prism language-python">开始线程： Thread<span class="token operator">-</span><span class="token number">1</span><span class="token operator">//</span>Fri Aug <span class="token number">21</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">47</span><span class="token punctuation">:</span><span class="token number">04</span> <span class="token number">2020</span>
<span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span> <span class="token number">4</span>
<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">]</span>
线程结束： 开始线程：Thread<span class="token operator">-</span><span class="token number">1</span><span class="token operator">//</span>Fri Aug <span class="token number">21</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">47</span><span class="token punctuation">:</span><span class="token number">04</span> <span class="token number">2020</span> 
Thread<span class="token operator">-</span><span class="token number">2</span><span class="token operator">//</span>Fri Aug <span class="token number">21</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">47</span><span class="token punctuation">:</span><span class="token number">04</span> <span class="token number">2020</span>
<span class="token number">5</span> <span class="token number">6</span> <span class="token number">7</span> <span class="token number">8</span>
<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">]</span>
线程结束： Thread<span class="token operator">-</span><span class="token number">2</span><span class="token operator">//</span>Fri Aug <span class="token number">21</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">47</span><span class="token punctuation">:</span><span class="token number">04</span> <span class="token number">2020</span>
开始线程： Thread<span class="token operator">-</span><span class="token number">3</span><span class="token operator">//</span>Fri Aug <span class="token number">21</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">47</span><span class="token punctuation">:</span><span class="token number">04</span> <span class="token number">2020</span>
<span class="token number">9</span> <span class="token number">10</span> <span class="token number">11</span> <span class="token number">12</span>
<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token number">81</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">121</span><span class="token punctuation">,</span> <span class="token number">144</span><span class="token punctuation">]</span>
线程结束： 开始线程：Thread<span class="token operator">-</span><span class="token number">3</span><span class="token operator">//</span>Fri Aug <span class="token number">21</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">47</span><span class="token punctuation">:</span><span class="token number">04</span> <span class="token number">2020</span> 
Thread<span class="token operator">-</span><span class="token number">4</span><span class="token operator">//</span>Fri Aug <span class="token number">21</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">47</span><span class="token punctuation">:</span><span class="token number">04</span> <span class="token number">2020</span>
<span class="token number">13</span> <span class="token number">14</span> <span class="token number">15</span> <span class="token number">16</span>
<span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token number">169</span><span class="token punctuation">,</span> <span class="token number">196</span><span class="token punctuation">,</span> <span class="token number">225</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">]</span>
线程结束： Thread<span class="token operator">-</span><span class="token number">4</span><span class="token operator">//</span>Fri Aug <span class="token number">21</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">47</span><span class="token punctuation">:</span><span class="token number">04</span> <span class="token number">2020</span>
开始线程： Thread<span class="token operator">-</span><span class="token number">5</span><span class="token operator">//</span>Fri Aug <span class="token number">21</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">47</span><span class="token punctuation">:</span><span class="token number">04</span> <span class="token number">2020</span>
<span class="token number">17</span> <span class="token number">18</span> <span class="token number">19</span> <span class="token number">20</span>
<span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token number">289</span><span class="token punctuation">,</span> <span class="token number">324</span><span class="token punctuation">,</span> <span class="token number">361</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">]</span>
线程结束： Thread<span class="token operator">-</span><span class="token number">5</span><span class="token operator">//</span>Fri Aug <span class="token number">21</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">47</span><span class="token punctuation">:</span><span class="token number">04</span> <span class="token number">2020</span>
主线程结束
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ac3864dbfaff2bc1e6b35bcdfa21c01b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">vue修改th表头高度,宽度等问题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/03cdc1be5efe6a8f4a855714b397bf4b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Windows10系统下使用VS code远程连接集群（在有跳板机的情况下）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>