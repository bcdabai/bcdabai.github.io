<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Linux 下编译opencv4 及使用CLion运行demo - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Linux 下编译opencv4 及使用CLion运行demo" />
<meta property="og:description" content="编译安装 1. 官网下载最新版opencv源码。当前最新版为4.5.3
2.解压
3.在解压后的代码目录下创建build目录（也可以在其它地方），作为编译目录
4.cmake生成Makefile
cmake -D OPENCV_GENERATE_PKGCONFIG=ON -D CMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=/usr/local .. -D OPENCV_GENERATE_PKGCONFIG=ON，为生成opencv.pc文件的配置(注意，opencv4生成的文件叫做opencv4.pc),另外 CMAKE_INSTALL_PREFIX=/usr/local 指定安装路径是在/usr/local下，这也是opencv的默认配置。
5.编译
make -j8 可能出现多个错误。其中一个是gen_java.py中出错，将 assert path[-3:] != &#39;.in&#39;, path 中的3改成4即可（网络搜索可知）。笔者的另一些错误是安装了anaconda3导致。编译opencv会链接一些系统的库文件，而由于anaconda安装时，将其路径设置在 PATH 环境变量靠前的位置，导致会优先链接anaconda下lib子目录下的库文件（不肯定），而该目录下的库文件和对应的系统文件版本不同，导致有些函数在旧版本的库文件上找不到。解决方法是将anaconda下lib子目录下的库文件（一般为软连接，指向当前目录下的名字带有版本号的真实库文件）改为指向系统库目录下同名文件。
6.
sudo make install 会将编译好的opencv安装至 /usr/local 目录下。由于打开了 OPENCV_GENERATE_PKGCONFIG，将会在 /usr/local/lib/pkgconfig/ 下生成 opencv4.pc 文件，于是可以用 pkg-config --cflags --libs opencv4 得到include目录和链接目录
在CLion中写opencv程序 参考 OpenCV: Using OpenCV with gcc and CMake
将CMakeLists.txt改为：
cmake_minimum_required(VERSION 2.8) project( DisplayImage ) find_package( OpenCV REQUIRED ) include_directories( ${OpenCV_INCLUDE_DIRS} ) add_executable( DisplayImage DisplayImage." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/208a8acc75048a502fb081ec0c11ee42/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-07-11T17:16:09+08:00" />
<meta property="article:modified_time" content="2022-07-11T17:16:09+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Linux 下编译opencv4 及使用CLion运行demo</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>编译安装</h2> 
<p>1. <a class="link-info" href="https://opencv.org/releases/" rel="nofollow" title="官网">官网</a>下载最新版opencv源码。当前最新版为4.5.3</p> 
<p>2.解压</p> 
<p>3.在解压后的代码目录下创建build目录（也可以在其它地方），作为编译目录</p> 
<p>4.cmake生成Makefile</p> 
<pre><code class="language-bash">cmake -D OPENCV_GENERATE_PKGCONFIG=ON -D CMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=/usr/local ..</code></pre> 
<p>-D OPENCV_GENERATE_PKGCONFIG=ON，为生成opencv.pc文件的配置(注意，opencv4生成的文件叫做opencv4.pc),另外 CMAKE_INSTALL_PREFIX=/usr/local 指定安装路径是在/usr/local下，这也是opencv的默认配置。</p> 
<p>5.编译</p> 
<pre><code class="language-bash">make -j8</code></pre> 
<p>可能出现多个错误。其中一个是gen_java.py中出错，将 assert path[-3:] != '.in', path 中的3改成4即可（网络搜索可知）。笔者的另一些错误是安装了anaconda3导致。编译opencv会链接一些系统的库文件，而由于anaconda安装时，将其路径设置在 PATH 环境变量靠前的位置，导致会优先链接anaconda下lib子目录下的库文件（不肯定），而该目录下的库文件和对应的系统文件版本不同，导致有些函数在旧版本的库文件上找不到。解决方法是将anaconda下lib子目录下的库文件（一般为软连接，指向当前目录下的名字带有版本号的真实库文件）改为指向系统库目录下同名文件。</p> 
<p>6.</p> 
<pre><code class="language-bash">sudo make install</code></pre> 
<p>会将编译好的opencv安装至 /usr/local 目录下。由于打开了 OPENCV_GENERATE_PKGCONFIG，将会在 /usr/local/lib/pkgconfig/ 下生成 opencv4.pc 文件，于是可以用 pkg-config --cflags --libs opencv4 得到include目录和链接目录</p> 
<h2>在CLion中写opencv程序</h2> 
<p>参考 <a href="https://docs.opencv.org/3.4/db/df5/tutorial_linux_gcc_cmake.html" rel="nofollow" title="OpenCV: Using OpenCV with gcc and CMake">OpenCV: Using OpenCV with gcc and CMake</a></p> 
<p>将CMakeLists.txt改为：</p> 
<pre><code>cmake_minimum_required(VERSION 2.8)
project( DisplayImage )
find_package( OpenCV REQUIRED )
include_directories( ${OpenCV_INCLUDE_DIRS} )
add_executable( DisplayImage DisplayImage.cpp )
target_link_libraries( DisplayImage ${OpenCV_LIBS} )</code></pre> 
<p>即可运行</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ef447bf90e08eb4a5e1bf6a61662fdbe/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">from ui_mainwindow import Ui_MainWindow 报错 ValueError: source code string cannot contain null bytes</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d9477f2413ddaa137b853846e31438db/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">容器技术之Docker&amp;K8S</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>