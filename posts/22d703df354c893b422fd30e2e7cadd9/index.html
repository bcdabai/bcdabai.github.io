<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>C#通过Http发送Soap请求 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="C#通过Http发送Soap请求" />
<meta property="og:description" content="/// &lt;summary&gt;
/// 发送SOAP请求，并返回响应xml /// &lt;/summary&gt; /// &lt;param name=&#34;url&#34;&gt;请求地址&lt;/param&gt; /// &lt;param name=&#34;datastr&#34;&gt;SOAP请求信息&lt;/param&gt; /// &lt;returns&gt;返回响应信息&lt;/returns&gt; public static string GetSOAPReSource(string url, string datastr) { //发起请求 Uri uri = new Uri(url); WebRequest webRequest = WebRequest.Create(uri); webRequest.ContentType = &#34;text/xml; charset=utf-8&#34;; webRequest.Method = &#34;POST&#34;; using (Stream requestStream = webRequest.GetRequestStream()) { byte[] paramBytes = Encoding.UTF8.GetBytes(datastr.ToString()); requestStream.Write(paramBytes, 0, paramBytes.Length); } //响应 WebResponse webResponse = webRequest.GetResponse(); using (StreamReader myStreamReader = new StreamReader(webResponse.GetResponseStream(), Encoding.UTF8)) { string result = &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/22d703df354c893b422fd30e2e7cadd9/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2012-07-27T12:59:54+08:00" />
<meta property="article:modified_time" content="2012-07-27T12:59:54+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">C#通过Http发送Soap请求</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <span style="color:#52a3cc"><span style="font-size:18px">/// &lt;summary&gt;<br> </span><span style="font-size:18px; color:#52a3cc">        /// 发送SOAP请求，并返回响应xml</span></span> 
<br> 
<span style="font-size:18px; color:#52a3cc">        /// &lt;/summary&gt;</span> 
<br> 
<span style="font-size:18px; color:#52a3cc">        /// &lt;param name="url"&gt;请求地址&lt;/param&gt;</span> 
<br> 
<span style="font-size:18px; color:#52a3cc">        /// &lt;param name="datastr"&gt;SOAP请求信息&lt;/param&gt;</span> 
<br> 
<span style="font-size:18px; color:#52a3cc">        /// &lt;returns&gt;返回响应信息&lt;/returns&gt;</span> 
<br> 
<span style="font-size:18px; color:#52a3cc">        public static string GetSOAPReSource(string url, string datastr)</span> 
<br> 
<span style="font-size:18px; color:#52a3cc">        {<!-- --></span> 
<br> 
<br> 
<span style="font-size:18px; color:#52a3cc">            //发起请求</span> 
<br> 
<span style="font-size:18px; color:#52a3cc">            Uri uri = new Uri(url);</span> 
<br> 
<span style="font-size:18px; color:#52a3cc">            WebRequest webRequest = WebRequest.Create(uri);</span> 
<br> 
<span style="font-size:18px; color:#52a3cc">            webRequest.ContentType = "text/xml; charset=utf-8";</span> 
<br> 
<span style="font-size:18px; color:#52a3cc">            webRequest.Method = "POST";</span> 
<br> 
<span style="font-size:18px; color:#52a3cc">            using (Stream requestStream = webRequest.GetRequestStream())</span> 
<br> 
<span style="font-size:18px; color:#52a3cc">            {<!-- --></span> 
<br> 
<span style="font-size:18px; color:#52a3cc">                byte[] paramBytes = Encoding.UTF8.GetBytes(datastr.ToString());</span> 
<br> 
<span style="font-size:18px; color:#52a3cc">                requestStream.Write(paramBytes, 0, paramBytes.Length);</span> 
<br> 
<span style="font-size:18px; color:#52a3cc">            }</span> 
<br> 
<br> 
<span style="font-size:18px; color:#52a3cc">            //响应</span> 
<br> 
<span style="font-size:18px; color:#52a3cc">            WebResponse webResponse = webRequest.GetResponse();</span> 
<br> 
<span style="font-size:18px; color:#52a3cc">            using (StreamReader myStreamReader = new StreamReader(webResponse.GetResponseStream(), Encoding.UTF8))</span> 
<br> 
<span style="font-size:18px; color:#52a3cc">            {<!-- --></span> 
<br> 
<span style="font-size:18px; color:#52a3cc">                string result = "";</span> 
<br> 
<span style="font-size:18px; color:#52a3cc">                return result=myStreamReader.ReadToEnd();</span> 
<br> 
<span style="font-size:18px; color:#52a3cc">            }</span> 
<br> 
<span style="font-size:18px; color:#52a3cc">        }</span> 
<p><span style="font-size:18px; color:#52a3cc">示例：调用webservice查询IP地址信息<br> </span></p> 
<p>webservice地址：http://www.wjg121.cn/Service/IPAddress.asmx?op=GetIPCountryAndLocal</p> 
<p> </p> 
<p><span style="color:#0055ff">      static void Main(string[] args)</span><br> <span style="color:#0055ff">        {<!-- --></span><br> <br> <span style="color:#0055ff">             </span><br> <span style="color:#0055ff">            //构造soap请求信息</span><br> <span style="color:#0055ff">            StringBuilder soap = new StringBuilder();</span><br> <span style="color:#0055ff">            soap.Append("&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;");</span><br> <span style="color:#0055ff">            soap.Append("&lt;soap:Envelope xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:soap=\"http://schemas.xmlsoap.org/soap/envelope/\"&gt;");</span><br> <span style="color:#0055ff">            soap.Append("&lt;soap:Body&gt;");</span><br> <span style="color:#0055ff">            soap.Append("&lt;GetIPCountryAndLocal xmlns=\"http://tempuri.org/\"&gt;");</span><br> <span style="color:#0055ff">            soap.Append("&lt;RequestIP&gt;183.39.119.90&lt;/RequestIP&gt;");</span><br> <span style="color:#0055ff">            soap.Append("&lt;/GetIPCountryAndLocal&gt;");</span><br> <span style="color:#0055ff">            soap.Append("&lt;/soap:Body&gt;");</span><br> <span style="color:#0055ff">            soap.Append("&lt;/soap:Envelope&gt;");</span><br> <br> <span style="color:#0055ff">            string url = "http://www.wjg121.cn/Service/IPAddress.asmx";</span><br> <span style="color:#0055ff">            Console.WriteLine(WebServiceUtility.GetSOAPReSource(url,soap.ToString()));           </span><br> <span style="color:#0055ff">            Console.ReadKey();</span><br> <br> <span style="color:#0055ff">        }</span></p> 
<p>//返回结果：</p> 
<p><span style="color:#57ce6d">&lt;?xml version="1.0" encoding="utf-8"?&gt;&lt;soap:Envelope xmlns:soap="http://schemas.</span><br> <span style="color:#57ce6d">xmlsoap.org/soap/envelope/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance</span><br> <span style="color:#57ce6d">" xmlns:xsd="http://www.w3.org/2001/XMLSchema"&gt;&lt;soap:Body&gt;&lt;GetIPCountryAndLocalR</span><br> <span style="color:#57ce6d">esponse xmlns="http://tempuri.org/"&gt;&lt;GetIPCountryAndLocalResult&gt;广东省电信&lt;/GetI</span><br> <span style="color:#57ce6d">PCountryAndLocalResult&gt;&lt;/GetIPCountryAndLocalResponse&gt;&lt;/soap:Body&gt;&lt;/soap:Envelop</span><br> <span style="color:#57ce6d">e&gt;</span><br> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4ba499660fe6e1e0ee16c5fd6bcff4ac/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">错误—系统—Kernel-Power—41—（63）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b2b6a40270ad20b7314a154c2981ad3f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">修改sql server 数据库字段报错:将截断字符串或二进制数据</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>