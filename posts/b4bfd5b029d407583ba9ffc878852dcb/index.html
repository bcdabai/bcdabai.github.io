<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>C语言中signal函数简介及使用 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="C语言中signal函数简介及使用" />
<meta property="og:description" content="signal.h是C标准函数库中的信号处理部分，定义了程序执行时如何处理不同的信号。信号用作进程间通信，报告异常行为(如除零)、用户的一些按键组合(如同时按下Ctrl与C键，产生信号SIGINT)。C&#43;&#43;中的对应头文件是csignal。
C语言标准定义了6个信号，都定义在signal.h头文件中：
(1). SIGABRT：程序异常中止，如调用abort函数。
(2). SIGFPE：算术运算出错，如除数为0或溢出。
(3). SIGILL：非法函数映像，如非法指令。
(4). SIGINT：交互的用户按键请求，如同时按下Ctrl&#43;C键。
(5). SIGSEGV：无效内存访问，段错误。
(6). SIGTERM：程序的中止请求。
signal.h可能还定义了其它信号，这依赖于具体实现。例如，类Unix系统还定义了15个以上的信号。Visual C&#43;&#43;的C标准库只支持C语言标准规定的6个信号，即对信号处理只提供最小的支持。
signal函数：该函数设置一个函数(回调函数)来处理捕获到异常信号时需要执行的操作，其函数声明方式如下：
// Type of a signal handler typedef void (*__sighandler_t)(int); __sighandler_t signal(int __sig, __sighandler_t __handler); 下面是测试代码：
#include &#34;signal.hpp&#34; #include &lt;signal.h&gt; #include &lt;string&gt; #include &lt;thread&gt; #include &lt;chrono&gt; namespace signal_ { namespace { bool flag = true; void process_exit(int sig) { switch (sig) { case SIGINT: fprintf(stderr, &#34;process exit: SIGINT: value: %d\n&#34;, sig); break; case SIGFPE: fprintf(stderr, &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/b4bfd5b029d407583ba9ffc878852dcb/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-06-15T11:50:41+08:00" />
<meta property="article:modified_time" content="2019-06-15T11:50:41+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">C语言中signal函数简介及使用</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="text-indent:50px;"><strong>signal.h</strong><strong>是C</strong><strong>标准函数库中的信号处理部分，定义了程序执行时如何处理不同的信号。信号用作进程间通信，报告异常行为</strong>(如除零)、用户的一些按键组合(如同时按下Ctrl与C键，产生信号SIGINT)。C++中的对应头文件是csignal。</p> 
<p style="text-indent:50px;">C语言标准定义了6个信号，都定义在signal.h头文件中：</p> 
<p style="text-indent:50px;">(1). SIGABRT：程序异常中止，如调用abort函数。</p> 
<p style="text-indent:50px;">(2). SIGFPE：算术运算出错，如除数为0或溢出。</p> 
<p style="text-indent:50px;">(3). SIGILL：非法函数映像，如非法指令。</p> 
<p style="text-indent:50px;">(4). SIGINT：交互的用户按键请求，如同时按下Ctrl+C键。</p> 
<p style="text-indent:50px;">(5). SIGSEGV：无效内存访问，段错误。</p> 
<p style="text-indent:50px;">(6). SIGTERM：程序的中止请求。</p> 
<p style="text-indent:50px;">signal.h可能还定义了其它信号，这依赖于具体实现。例如，类Unix系统还定义了15个以上的信号。Visual C++的C标准库只支持C语言标准规定的6个信号，即对信号处理只提供最小的支持。</p> 
<p style="text-indent:50px;">signal函数：<strong>该函数设置一个函数(回调函数)来处理捕获到异常信号时需要执行的操作</strong>，其函数声明方式如下：</p> 
<pre class="has"><code class="language-cpp">// Type of a signal handler
typedef void (*__sighandler_t)(int);
__sighandler_t signal(int __sig, __sighandler_t __handler);</code></pre> 
<p style="text-indent:50px;">下面是测试代码：</p> 
<pre class="has"><code class="language-cpp">#include "signal.hpp"
#include &lt;signal.h&gt;
#include &lt;string&gt;
#include &lt;thread&gt;
#include &lt;chrono&gt;

namespace signal_ {

namespace {

bool flag = true;

void process_exit(int sig)
{
	switch (sig) {
		case SIGINT:
			fprintf(stderr, "process exit: SIGINT: value: %d\n", sig);
			break;
		case SIGFPE:
			fprintf(stderr, "process exit: SIGFPE: value: %d\n", sig);
			break;
		case SIGABRT:
			fprintf(stderr, "process exit: SIGABRT: value: %d\n", sig);
			break;
		case SIGILL:
			fprintf(stderr, "process exit: SIGILL: value: %d\n", sig);
			break;
		case SIGSEGV:
			fprintf(stderr, "process exit: SIGSEGV: value: %d\n", sig);
			break;
		case SIGTERM:
			fprintf(stderr, "process exit: SIGTERM: value: %d\n", sig);
			break;
		default:
			fprintf(stderr, "process exit: value: %d\n", sig);
			break;
	}

	flag = false;
}

void wait_ctrl_c()
{
	while (flag) {
		std::this_thread::sleep_for(std::chrono::seconds(2));
		fprintf(stdout, "please press to exit: Ctrl + c ... \n");
	}
}

void signal_type()
{
	signal(SIGINT, process_exit);
	signal(SIGFPE, process_exit);
	signal(SIGILL, process_exit);
	signal(SIGABRT, process_exit);
	signal(SIGSEGV, process_exit);
	signal(SIGTERM, process_exit);
}

void signal_sigill(int)
{
	fprintf(stdout, "caught SIGILL signal\n");
}

void signal_sigterm(int)
{
	fprintf(stdout, "caught SIGTERM signal\n");
}

} // namespace

int test_signal_SIGINT()
{
	signal_type();

	std::thread th(wait_ctrl_c);
	th.join();

	return 0;
}

int test_signal_SIGILL()
{
	//signal_type();

	if (signal(SIGILL, signal_sigill) == SIG_ERR) {
		fprintf(stdout, "cannot handle SIGILL\n");
	} else {
		fprintf(stdout, "yyyyy\n");
	}

	return 0;
}

int test_signal_SIGFPE()
{
	signal_type();

	int a = 1, b = 0, c;
	c = a / b;
	fprintf(stdout, "c = %d\n", c);

	return 0;
}

int test_signal_SIGSEGV()
{
	signal_type();
	
	int a[3] = {0};
	fprintf(stdout, "a[3] = %d\n", a[-1111111]);
	
	return 0;
}

int test_signal_SIGTERM()
{
	//signal_type();

	if (signal(SIGTERM, signal_sigterm) == SIG_ERR) {
		fprintf(stdout, "cannot handle SIGTERM\n");
	} else {
		fprintf(stdout, "xxxxx\n");
	}

	return 0;
}

int test_signal_SIGABRT()
{
	signal_type();

	abort();

	return 0;
}

} // namespace signal_
</code></pre> 
<p style="text-indent:50px;">测试test_signal_SIGINT时的输出结果如下：</p> 
<p style="text-align:center;"><img alt="" class="has" height="107" src="https://images2.imgbox.com/ef/d5/nQXPjQWh_o.png" width="676"></p> 
<p style="text-indent:50px;"><strong>GitHub</strong>： <a href="https://github.com/fengbingchun/Messy_Test">https://github.com/fengbingchun/Messy_Test</a> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5faf53f1a4f1dee135b8b1eaf112c206/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">c&#43;&#43;截取部分字符串(类似python的切片)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c488cefb54adee9b4af9c32b35333dca/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">SpringMvc 最新jar包下载</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>