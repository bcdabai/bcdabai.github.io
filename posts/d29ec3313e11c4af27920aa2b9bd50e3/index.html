<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>几行命令完成docker多网站的部署（wordpress和dedecms) - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="几行命令完成docker多网站的部署（wordpress和dedecms)" />
<meta property="og:description" content="建设目标，利用docker技术快速搭建wordpress和dedecms，完成多域名的部署工作。
操作时间评估：20分钟。
主要部署内容，php7,nginx,myssql,wordpress,dedecms。
主要操作过程，几个命令行。
安装环境，安装有docker的服务主机（国外主机），本文略过安装过程。
项目要求，有三个网站，如下要求。
www.a.com,使用dedecmswww.b.com，使用wordpresswww.c.com，静态网站 主要思想，分别安装dedecms和wordprss,再利用nginx转发思想，分别建立转发机制。
操作过程：
第一步：准备工作,
根目录： /opt/docker
网站根目录：/opt/docker/www
nginx相关目录：/opt/docker/nginx/conf.d 第二步：安装php7,nginx,mysql
//取得nginx镜像 docker pull nginx //取得php镜像 docker pull php:7.1.0-fpm //取得mysql镜像 docker pull mysql 第三步：启动基础环境
//启动php docker run -p 9000:9000 --name myphp \ -v /docker/www/:/var/www/html/ \ --privileged=true \ -d php:7.1.0-fpm //启动nginx docker run -p 80:80 --name mynginx \ -v /docker/www:/usr/share/nginx/html \ -v /docker/nginx/conf.d:/etc/nginx/conf.d \ --privileged=true \ -d nginx //启动mysql docker run -d -e MYSQL_ROOT_PASSWORD=yaya --name wp-mysql -v /opt/docker/mysql/data:/var/lib/mysql -p 3306:3306 mysql 第四步：安装dedecms" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/d29ec3313e11c4af27920aa2b9bd50e3/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-04-17T14:06:04+08:00" />
<meta property="article:modified_time" content="2018-04-17T14:06:04+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">几行命令完成docker多网站的部署（wordpress和dedecms)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div class="iteye-blog-content-contain" style="font-size:14px;"> 
 <p>     建设目标，利用docker技术快速搭建wordpress和dedecms，完成多域名的部署工作。<br>     操作时间评估：20分钟。<br>     主要部署内容，php7,nginx,myssql,wordpress,dedecms。</p> 
 <p>     主要操作过程，几个命令行。<br><br>     安装环境，安装有docker的服务主机（国外主机），本文略过安装过程。<br>     项目要求，有三个网站，如下要求。</p> 
 <ul><li>www.a.com,使用dedecms</li><li>www.b.com，使用wordpress</li><li>www.c.com，静态网站</li></ul> 
 <p>     主要思想，分别安装dedecms和wordprss,再利用nginx转发思想，分别建立转发机制。<br><br>    操作过程：<br>   <strong>第一步：准备工作,</strong><br>                  <span style="font-family:Tahoma;color:#222222;">根目录： /opt/docker<br></span><span style="font-family:Tahoma;color:#222222;">                网站根目录：/opt/docker/www</span></p> 
 <div> 
  <span style="font-family:Tahoma;color:#222222;"> nginx相关目录：/opt/docker/nginx/conf.d</span> 
 </div> 
 <p>  <strong> 第二步：安装php7,nginx,mysql</strong></p> 
 <pre><code class="language-java">//取得nginx镜像
docker pull nginx
//取得php镜像
docker pull php:7.1.0-fpm
//取得mysql镜像
docker pull mysql</code></pre> 
 <p>   <strong> 第三步：启动基础环境</strong></p> 
 <pre><code class="language-java">//启动php
docker run -p 9000:9000 --name myphp \
-v /docker/www/:/var/www/html/ \
--privileged=true \
-d php:7.1.0-fpm
//启动nginx
docker run -p 80:80 --name mynginx \
-v /docker/www:/usr/share/nginx/html \
-v /docker/nginx/conf.d:/etc/nginx/conf.d \
--privileged=true \
-d nginx
//启动mysql
docker run -d -e MYSQL_ROOT_PASSWORD=yaya --name wp-mysql -v /opt/docker/mysql/data:/var/lib/mysql -p 3306:3306 mysql</code></pre> 
 <p><strong>   第四步：安装dedecms</strong><br>   </p> 
 <pre><code class="language-java">//取得deducts镜像
docker pull chengxulvtu/dedecms:utf8_full_5.7
或
docker pull chengxulvtu/dedecms:gbk_full_5.7
//运行dedecms
docker run -d --name dede-lantinghe -p 8081:80 -v /opt/docker/www/dedecms/:/var/www/html chengxulvtu/dedecms:utf8_full_5.7
</code></pre> 
 <p>     <strong>第五步，安装wordpress</strong></p> 
 <pre><code class="language-java">#取得wordpress镜像
docker pull wordpress
#运行wordpress镜像
docker run -d --name wp-lantinghe --link wp-mysql:mysql  -v /opt/docker/www/wordpress/:/var/www/html/ -p 8080:80 wordpress</code></pre> 
 <p>   <strong> 第六步，分别配置各域名</strong></p> 
 <p>    文件/opt/docker/nginx/conf.d/a.com.conf<br>  </p> 
 <pre><code class="language-java">server {
  listen  80;
  server_name www.a.com;
  root   /usr/share/nginx/html/dedecms/;
  location / {
   index index.html index.htm index.php;
   autoindex off;
   proxy_redirect off;  
   proxy_set_header Host $host;  
   proxy_set_header X-Real-IP $remote_addr;  
   proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; 
   proxy_pass http://x.x.x.x:8081;
  }
  location ~ \.php(.*)$ {   
   fastcgi_pass 172.17.0.2:9000;
   fastcgi_index index.php;
   fastcgi_split_path_info ^((?U).+\.php)(/?.+)$;
   fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
   fastcgi_param PATH_INFO $fastcgi_path_info;
   fastcgi_param PATH_TRANSLATED $document_root$fastcgi_path_info;
   include  fastcgi_params;
  }
}</code></pre> 
 <p>  文件/opt/docker/nginx/conf.d/b.com.conf</p> 
 <pre><code class="language-java">server {
  listen  80;
  server_name www.b.com;
  root   /usr/share/nginx/html/wordpress/;
  location / {
   index index.html index.htm index.php;
   autoindex off;
   proxy_redirect off;  
   proxy_set_header Host $host;  
   proxy_set_header X-Real-IP $remote_addr;  
   proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; 
   proxy_pass http://x.x.x.x:8080;
  }
  location ~ \.php(.*)$ {   
   fastcgi_pass 172.17.0.2:9000;
   fastcgi_index index.php;
   fastcgi_split_path_info ^((?U).+\.php)(/?.+)$;
   fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
   fastcgi_param PATH_INFO $fastcgi_path_info;
   fastcgi_param PATH_TRANSLATED $document_root$fastcgi_path_info;
   include  fastcgi_params;
  }
}</code></pre> 
 <p> 文件/opt/docker/nginx/conf.d/c.com.conf</p> 
 <pre><code class="language-java">server {
  listen  80;
  server_name www.c.com;
  root   /usr/share/nginx/html/c.com/;
  location / {
   index index.html index.htm index.php;
   autoindex off;   
  }
}</code></pre> 
 <p> <strong>  最后重启nginx</strong></p> 
 <pre><code class="language-java">docker restart mynginx</code></pre> 
 <p> <br><br>    上面所有功能完成，三个网站均可以正常访问。</p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ae27f1982d5e1c435e6a8c7f59c56025/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">如何消除div之间的空隙</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/cfb6a552339937c01ebecc60714891e5/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">git 删除文件 、只删除远程仓库文件、更换远程仓库</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>