<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>吃透modbus协议 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="吃透modbus协议" />
<meta property="og:description" content="转载自b站
这节课带你吃透Modbus通信协议_哔哩哔哩_bilibili
理论 Modbus是一种应用层的报文传输协议，Modbus协议不是唯一的，有三种形式：RTU、ASCLL、TCP，他们之间既有共同点，又有不同点。
一、Modbus RTU通信协议为例： 01.存储区（数据存储区、文件存储区） 有四种：
输出线圈： 代号是0
输入线圈： 代号是1
输出（写）寄存器： 代号是4
输入（读）寄存器： 代号是3
线圈：最小单位bool，要么存的是1，要么是0。
寄存器：16位，2个字节
总结：如果用bool，就用线圈；如果要存数据，就用寄存器。
02.存储区范围 5位和6位 标准地址（5位）和扩展地址
标准地址（5位）：
YXXXX
Y表示哪个存储区，取值范围0、1、3、4
X取值范围0-9
输出线圈： 代号是0，存储范围：00001-09999
输入线圈： 代号是1，存储范围：10001-19999
输出（写）寄存器： 代号是4，存储范围：40001-49999
输入（读）寄存器： 代号是3，存储范围：30001-39999
扩展地址（6位）：
YXXXXX
输出线圈：存储范围：000001-065536
输入线圈： 代号是1，存储范围：100001-165536
输出（写）寄存器： 代号是4，存储范围：400001-465536
输入（读）寄存器： 代号是3，存储范围：300001-365536
03.通讯协议 八种动作：四个读、四个写
读输出线圈：功能码：01（十六进制）
读输入线圈：功能码：02
读输出寄存器：功能码：03
读输入寄存器：功能码：04
写单个输出线圈：功能码：05
写单个输出寄存器：功能码：06
写多个输出线圈：功能码：0f
写多个输出寄存器：功能码：10
报文格式：
从站地址（设备编号1byte）&#43;功能码（1byte）&#43;数据（N个byte）&#43;校验（2个byte）
对于读取来说：
从站地址（设备编号）：为了区分是哪个设备。
功能码：是为了确定干什么。
数据：具体干嘛的细节。
校验：验证
对于写入来说
从站地址（设备编号）：为了区分是哪个设备。
功能码：是为了确定干什么。
数据：具体干嘛的细节（更多，多了个写入的具体数值）。
校验：验证
以下是一个例子：
监听com24端口：采集湿度和温度
上位机发送：01 03 00 00 00 02 C4 0B" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/b4d76cc7f1dc4909a5ec3c564f1cf9bb/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-24T16:52:43+08:00" />
<meta property="article:modified_time" content="2023-12-24T16:52:43+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">吃透modbus协议</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>转载自b站</p> 
<p><a href="https://www.bilibili.com/video/BV1AQ4y1a7mb/?spm_id_from=333.337.search-card.all.click&amp;vd_source=bcaa27d53cb841ad057f4835465e4641" rel="nofollow" title="这节课带你吃透Modbus通信协议_哔哩哔哩_bilibili">这节课带你吃透Modbus通信协议_哔哩哔哩_bilibili</a></p> 
<h2 style="background-color:transparent;">理论</h2> 
<p><a href="https://so.csdn.net/so/search?q=Modbus&amp;spm=1001.2101.3001.7020" title="Modbus">Modbus</a>是一种应用层的报文传输协议，Modbus协议不是唯一的，有三种形式：RTU、ASCLL、TCP，他们之间既有共同点，又有不同点。</p> 
<hr> 
<h3 style="background-color:transparent;"><a name="t2"></a><a id="Modbus_RTU_17"></a>一、Modbus <a href="https://so.csdn.net/so/search?q=RTU&amp;spm=1001.2101.3001.7020" title="RTU">RTU</a>通信协议为例：</h3> 
<h4 style="background-color:transparent;"><a name="t3"></a><a id="1_18"></a>01.存储区（数据存储区、文件存储区）</h4> 
<p><strong>有四种：</strong><br><strong>输出线圈</strong>： 代号是0<br><strong>输入线圈</strong>： 代号是1<br><strong>输出（写）寄存器</strong>： 代号是4<br><strong>输入（读）寄存器</strong>： 代号是3<br> 线圈：最小单位bool，要么存的是1，要么是0。<br> 寄存器：16位，2个字节<br> 总结：如果用bool，就用线圈；如果要存数据，就用寄存器。</p> 
<hr> 
<h4><a name="t4"></a><a id="2_31"></a>02.存储区范围</h4> 
<p><strong>5位和6位 标准地址（5位）和扩展地址</strong><br><strong>标准地址（5位）</strong>：<br> YXXXX<br> Y表示哪个存储区，取值范围0、1、3、4<br> X取值范围0-9<br> 输出线圈： 代号是0，存储范围：00001-09999<br> 输入线圈： 代号是1，存储范围：10001-19999<br> 输出（写）寄存器： 代号是4，存储范围：40001-49999<br> 输入（读）寄存器： 代号是3，存储范围：30001-39999<br><strong>扩展地址（6位）</strong>：<br> YXXXXX<br> 输出线圈：存储范围：000001-065536<br> 输入线圈： 代号是1，存储范围：100001-165536<br> 输出（写）寄存器： 代号是4，存储范围：400001-465536<br> 输入（读）寄存器： 代号是3，存储范围：300001-365536</p> 
<hr> 
<h4 style="background-color:transparent;"><a name="t5"></a><a id="3_51"></a>03.通讯协议</h4> 
<p><strong>八种动作：四个读、四个写</strong><br> 读输出线圈：功能码：01（十六进制）<br> 读输入线圈：功能码：02<br> 读输出寄存器：功能码：03<br> 读输入寄存器：功能码：04<br> 写单个输出线圈：功能码：05<br> 写单个输出寄存器：功能码：06<br> 写多个输出线圈：功能码：0f<br> 写多个输出寄存器：功能码：10</p> 
<p><strong>报文格式：</strong><br> 从站地址（设备编号1byte）+功能码（1byte）+数据（N个byte）+校验（2个byte）</p> 
<p><strong>对于读取来说：</strong><br> 从站地址（设备编号）：为了区分是哪个设备。<br> 功能码：是为了确定干什么。<br> 数据：具体干嘛的细节。<br> 校验：验证</p> 
<p><strong>对于写入来说</strong><br> 从站地址（设备编号）：为了区分是哪个设备。<br> 功能码：是为了确定干什么。<br> 数据：具体干嘛的细节（更多，多了个写入的具体数值）。<br> 校验：验证</p> 
<p><strong>以下是一个例子：</strong><br><strong>监听com24端口：采集湿度和温度</strong><br><strong>上位机发送</strong>：01 03 00 00 00 02 C4 0B<br> 01 站地址<br> 03 功能码：读输出寄存器<br> 00 00 起始寄存器<br> 00 02 寄存器长度<br> C4 0B CRC校验<br><strong>设备返回</strong>：01 03 04 01 46 01 3B 5A 59<br> 01 站地址<br> 03 功能码：读输出寄存器<br> 04 字节计数（字节总数）<br> 01 46 01 3B 具体数据4个字节<br> 5A 59 CRC校验</p> 
<p><strong>其中</strong>：<br> 01 46 表示湿度，十六进制，对应的十进制为326，326/10=32.6<br> 01 3B表示温度，十六进制，对应的十进制为315，315/10=31.5<br> ModbusCRC校验码由算法算出，不用深究怎么算，能算出来就行</p> 
<p>温度的Modbus地址是多少？40001-&gt;绝对地址<br> 湿度的Modbus地址是多少？40002-&gt;绝对地址<br> 协议上不会使用绝对地址，因为03已经说明了是读输出寄存器。<br> 通讯协议当中用的全是相对地址，相对地址是从0开始的。</p> 
<p></p> 
<h3 style="background-color:transparent;">二、常用功能码</h3> 
<p>Modbus中常用的功能码有8个，可以分为<a href="https://so.csdn.net/so/search?q=%E4%BD%8D%E6%93%8D%E4%BD%9C&amp;spm=1001.2101.3001.7020" title="位操作">位操作</a>和字操作两类，如下表所示：<br><img alt="在这里插入图片描述" src="https://images2.imgbox.com/f1/a9/wgeJk6zs_o.png"></p> 
<p></p> 
<h4>03. 读线圈寄存器(01H)</h4> 
<p>功能码01H读取Modbus从机中线圈寄存器的状态，可以是单个寄存器，或者多个连续的寄存器。</p> 
<p><strong>发送</strong></p> 
<p>假设从机地址为01H，读取的线圈寄存器的起始地址为0017H，读取38个寄存器，指令如下所示：</p> 
<p>读线圈寄存器指令<br><img alt="在这里插入图片描述" src="https://images2.imgbox.com/d8/0e/JVmmBKhx_o.png"></p> 
<p><br><strong>响应</strong></p> 
<p>各线圈的状态与数据内容的每个bit对应，1代表ON，0代表OFF。如果查询的线圈数量不是8的倍数，则在最后一个字节的高位补0。</p> 
<p>读线圈状态的返回结果<br><img alt="在这里插入图片描述" src="https://images2.imgbox.com/06/30/G3B44An4_o.png"></p> 
<p><strong> 解读：</strong>其中，第一个字节<a href="https://so.csdn.net/so/search?q=CDH&amp;spm=1001.2101.3001.7020" title="CDH">CDH</a>对应线圈0017H到001E的状态，转为二进制是11001101，其中bit0对应0017H，bit7对应001E，如下表所示：</p> 
<p>线圈0017H到001EH的状态<br><img alt="在这里插入图片描述" src="https://images2.imgbox.com/99/e1/GaxUYqM0_o.png"></p> 
<p></p> 
<p>最后一个字节为1BH，对应线圈0037H到003CH的状态，转为二进制是00011011，其中bit0对应0037H，bit5对应003CH，其余两位用0填充：</p> 
<p>线圈0037H到003CH的状态<br><img alt="在这里插入图片描述" src="https://images2.imgbox.com/64/00/wEaMxe8s_o.png"></p> 
<h5><strong>读线圈寄存器——01H</strong></h5> 
<p>从站发送读取格式：</p> 
<table><thead><tr><th>从站地址</th><th>功能码</th><th>起始地址高位</th><th>起始地址低位</th><th>读取数量高位</th><th>读取数量低位</th><th>CRC高位</th><th>CRC低位</th></tr></thead><tbody><tr><td>0x01</td><td>0x01</td><td>0x00</td><td>0x00</td><td>0x00</td><td>0x02</td><td>BD</td><td>CB</td></tr></tbody></table> 
<p>主站返回读取格式：</p> 
<table><thead><tr><th>从站地址</th><th>功能码</th><th>返回字节数</th><th>data1</th><th>CRC高位</th><th>CRC低位</th></tr></thead><tbody><tr><td>0x01</td><td>0x01</td><td>0x01</td><td>0x00</td><td>51</td><td>88</td></tr></tbody></table> 
<p></p> 
<p>解读：<br> 发送格式：<br> 从站地址：01<br> 功能码：01<br> 起始地址： 00 00<br> 读取数量： 00 02<br> CRC校验：BD CB<br> 接收格式：<br> 从站地址：01<br> 功能码：01<br> 返回字节数： 01<br> Data数据： 00（一个byte有8个bit，读取两个bit返回会补成字节用一个byte返回读取两个bit就行）<br> CRC校验：BD CB<br>  </p> 
<p>例如：01 01 01 00 51 88 </p> 
<p>            01 01 01 01 90 48</p> 
<p></p> 
<h4>04. 读离散输入寄存器(02H)</h4> 
<p>功能码02H读取Modbus从机中离散输入寄存器的状态，可以是单个寄存器，或者多个连续的寄存器。</p> 
<p><strong>发送</strong></p> 
<p>假设从机地址为01H，读取的离散输入寄存器的起始地址为00C4H，读取22个寄存器，指令如下所示：</p> 
<p>读离散输入寄存器指令：<br><img alt="在这里插入图片描述" src="https://images2.imgbox.com/47/f0/JB1W3Fpx_o.png"></p> 
<p></p> 
<p><strong>响应</strong></p> 
<p>各个离散输入寄存器的状态与数据内容的每个bit对应，1代表ON，0代表OFF。如果查询的线圈数量不是8的倍数，则在最后一个字节的高位补0。</p> 
<p>读离散输入寄存器的返回结果<br><img alt="在这里插入图片描述" src="https://images2.imgbox.com/a3/e3/J2MZ0Qk3_o.png"></p> 
<p></p> 
<p>其中，第一个字节ACH对应00C4H到00CBH寄存器的状态，转为二进制是10101100，其中bit0对应00C4H，bit7对应00CB，如下所示：</p> 
<p>寄存器00C4H到00CBH的状态<br><img alt="在这里插入图片描述" src="https://images2.imgbox.com/a9/42/Fuhv2TQ1_o.png"></p> 
<p></p> 
<p>最后一个字节为35H，对应寄存器00D4H到00D9H的状态，转为二进制是00110101，其中bit0对应00D4H，bit5对应00D9H，其余两位用0填充，</p> 
<p>寄存器00D4H到00D9H的状态<img alt="在这里插入图片描述" src="https://images2.imgbox.com/d7/3a/azUBDrGa_o.png"></p> 
<p></p> 
<h4>05. 读保持寄存器(03H)</h4> 
<p>功能码03H读取Modbus从机中保持寄存器的数据，可以是单个寄存器，或者多个连续的寄存器。</p> 
<p><strong>发送</strong></p> 
<p>假设从机地址为01H，读取的保持寄存器的起始地址为006BH，读取3个寄存器，指令如表5.1所示：</p> 
<p>读保持寄存器指令：<br><img alt="在这里插入图片描述" src="https://images2.imgbox.com/50/a4/JXzLh49I_o.png"></p> 
<p></p> 
<p><strong>响应</strong></p> 
<p>每个保持寄存器的长度为2个字节。保持寄存器之间，低地址寄存器先传输，高地址寄存器后传输。单个保持寄存器，高字节数据先传输，低字节数据后传输。</p> 
<p>读保持寄存器的返回结果<br><img alt="在这里插入图片描述" src="https://images2.imgbox.com/64/1e/P9yJMnUC_o.png"></p> 
<p></p> 
<p></p> 
<p></p> 
<h4><a name="t6"></a>06. 读输入寄存器(04H)</h4> 
<p>功能码04H读取Modbus从机中输入寄存器的数据，可以是单个寄存器，或者多个连续的寄存器。</p> 
<p><strong>发送</strong></p> 
<p>假设从机地址为01H，读取的保持寄存器的起始地址为006BH，读取2个寄存器，指令如下所示：</p> 
<p>读输入寄存器指令：<br><img alt="在这里插入图片描述" src="https://images2.imgbox.com/3d/d5/mr7v9KzA_o.png"></p> 
<p></p> 
<p><strong>响应</strong></p> 
<p>每个输入寄存器的长度为2个字节。输入寄存器之间，低地址寄存器先传输，高地址寄存器后传输。单个输入寄存器，高字节数据先传输，低字节数据后传输。</p> 
<p>读输入寄存器的返回结果<br><img alt="在这里插入图片描述" src="https://images2.imgbox.com/9e/9f/SPFnf3C3_o.png"></p> 
<p></p> 
<h4><a name="t7"></a>07. 写单个线圈寄存器(05H)</h4> 
<p>功能码05H写单个线圈寄存器，FF00H请求线圈处于ON状态，0000H请求线圈处于OFF状态。</p> 
<p><strong>发送</strong></p> 
<p>假设从机地址为01H，线圈寄存器的地址为00ACH，使其处于ON状态的指令如下所示：</p> 
<p>写单个线圈指令：<br><img alt="在这里插入图片描述" src="https://images2.imgbox.com/74/5f/jwBMAnZV_o.png"></p> 
<p></p> 
<p><strong>响应</strong></p> 
<p>如果写入成功，返回发送的指令，即010500ACFF004C1B。</p> 
<p>写入：01 05 00 00 FF 00 8C 3A  </p> 
<p>返回：01 05 00 00 FF 00 8C 3A </p> 
<h4><a name="t8"></a>08. 写单个保持寄存器(06H)</h4> 
<p>功能码06H写单个保持寄存器。</p> 
<p><strong>发送</strong></p> 
<p>假设从机地址为01H，保持寄存器的地址为0001H，数据位0003H，指令如下所示：</p> 
<p>写单个保持寄存器指令：<br><img alt="在这里插入图片描述" src="https://images2.imgbox.com/b2/2c/yNQv4oFk_o.png"></p> 
<p><strong>响应</strong></p> 
<p>如果写入成功，返回发送的指令，即010600010003980B。</p> 
<p>09. 写多个线圈寄存器(0FH)<br> 功能码0FH写多个线圈寄存器。如果对应的数据位为1，表示线圈状态为ON；如果对应的数据位为0，表示线圈状态为OFF。线圈寄存器之间，低地址寄存器先传输，高地址寄存器后传输。单个线圈寄存器，高字节数据先传输，低字节数据后传输。如果写入的线圈寄存器的个数不是8的倍数，则在最后一个字节的高位补0。</p> 
<p>发送</p> 
<p>假设从机地址为01H，线圈寄存器的起始地址为0013H，写入10个寄存器，指令如下所示：</p> 
<p>写入多个线圈寄存器指令</p> 
<p><img alt="在这里插入图片描述" src="https://images2.imgbox.com/8e/7a/R5sQY0wj_o.png"></p> 
<p>其中，CDH对应线圈0013H到001AH的内容，01H对应线圈001B到001CH的内容，未使用位用0填充。</p> 
<p>此时，线圈寄存器的内容如下所示：</p> 
<p>线圈寄存器0013H到001CH的内容<br><img alt="在这里插入图片描述" src="https://images2.imgbox.com/e5/dd/OWo7FxpQ_o.png"></p> 
<p></p> 
<p><strong>响应</strong></p> 
<p>如果写入成功，返回写入的寄存器数量</p> 
<p>写多个线圈寄存器的返回结果<br><img alt="在这里插入图片描述" src="https://images2.imgbox.com/8b/2e/C96QPVsB_o.png"></p> 
<p></p> 
<h4><a name="t9"></a>10. 写多个保持寄存器(10H)</h4> 
<p>功能码10H写多个保持寄存器，其中每个保持寄存器的长度为两个字节。</p> 
<p><strong>发送</strong></p> 
<p>假设从机地址为01H，保持寄存器的起始地址为0001H，写入2个寄存器，指令如下所示：</p> 
<p>写入多个保持寄存器指令<br><img alt="在这里插入图片描述" src="https://images2.imgbox.com/77/d2/SPblstTS_o.png"></p> 
<p>返回数据格式不返回Data数据</p> 
<blockquote> 
 <p>详情：写入数量为2的线圈，其中data1,data2，data3，data4数据两个代表一个单精度数据<br> 0C 02表示一个3074 ，12 45代表一个4677</p> 
</blockquote> 
<p><strong>响应</strong></p> 
<p>如果写入成功，返回写入的寄存器数量，</p> 
<p>写多个保持寄存器的返回结果<br><img alt="在这里插入图片描述" src="https://images2.imgbox.com/2b/4b/k7Y2kCSp_o.png"></p> 
<h5><a name="t10"></a><strong>写多个线圈——0FH</strong></h5> 
<table><thead><tr><th>从站地址</th><th>功能码</th><th>起始地址高位</th><th>起始地址低位</th><th>写入数量高位</th><th>写入数据低位</th><th>字节长度</th><th>data1</th><th>CRC高位</th><th>CRC低位</th></tr></thead><tbody><tr><td>0x01</td><td>0x0F</td><td>0x00</td><td>0x00</td><td>0x00</td><td>0x02</td><td>0x01</td><td>0x03</td><td>9E</td><td>96</td></tr></tbody></table> 
<p>主站返回读取格式：<br> 响应：</p> 
<table><thead><tr><th>从站地址</th><th>功能码</th><th>起始地址高位</th><th>起始地址低位</th><th>写入数量高位</th><th>写入数据低位</th><th>CRC高位</th><th>CRC低位</th></tr></thead><tbody><tr><td>0x01</td><td>0x0F</td><td>0x00</td><td>0x00</td><td>0x00</td><td>0x02</td><td>9E</td><td>96</td></tr></tbody></table> 
<p>返回数据格式不返回Data数据</p> 
<blockquote> 
 <p>详情：写入数量为2的线圈，其中data1数据0x03代表0000 0011 将连续两个线圈置为ON</p> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4ef67c140e8bbf159626595b0acb03fd/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">深入探讨DNS数据包注入与DNS中毒攻击检测 (C/C&#43;&#43;代码实现)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/cc12e0e65a911c04c2163e02ffa2c8aa/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">软件研发中技术主R的职责</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>