<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>STM32_F4_ADC - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="STM32_F4_ADC" />
<meta property="og:description" content="声明：本篇博客的主要目的是对STM32F4系列单片机ADC外设的要点和疑难点进行总结整理（因为手册内容太多，容易眼花缭乱，抓不住重点），并且尽量避免成为手册的搬运工（否则还不如直接去看手册）。同时在博客的最后，会附上一些ADC常用功能的示例Demo （会随着时间不断完善添加）。
1 概述 （概述内容摘自手册）
1.1 ADC简介 12 位 ADC 是逐次趋近型模数转换器。它具有多达 19 个复用通道，可测量来自 16 个外部源、两个内部源和 VBAT 通道的信号。这些通道的 A/D 转换可在单次、连续、扫描或不连续采样模式下进行。ADC 的结果存储在一个左对齐或右对齐的 16 位数据寄存器中。ADC 具有模拟看门狗特性，允许应用检测输入电压是否超过了用户自定义的阈值上限或下限。
1.2 ADC主要特性 可配置 12 位、10 位、8 位或 6 位分辨率 在转换结束、注入转换结束以及发生模拟看门狗或溢出事件时产生中断 单次和连续转换模式 用于自动将通道 0 转换为通道“n”的扫描模式 数据对齐以保持内置数据一致性 可独立设置各通道采样时间 外部触发器选项，可为规则转换和注入转换配置极性 不连续采样模式 双重/三重模式（具有 2 个或更多 ADC 的器件提供） 双重/三重 ADC 模式下可配置的 DMA 数据存储 双重/三重交替模式下可配置的转换间延迟 ADC 电源要求：全速运行时为 2.4 V 到 3.6 V，慢速运行时为 1.8 V ADC 输入范围：规则通道转换期间可产生 DMA 请求 2 ADC框图 框图说明：
①处，是 ADC 的供电电源（）和参考电源()。为了提高转换的精确度，ADC使用一个独立的电源供电，过滤和屏蔽来自印刷电路板上的毛刺干扰；ADC的电源引脚为VDDA，电源地为VSSA，如果有VREF- 引脚(根据封装而定)，它必须连接到VSSA，确保共地。ADC的参考电压都是通过Vref&#43;提供的。100脚以上的型号，Vref&#43;引到了片外，引脚名称为Vref&#43;；64脚和小于64脚的型号，Vref&#43;在芯片内部与VCC信号线相连，没有引到片外，这样AD的参考电压就是VCC上的电压。VDDA和VREF的电压范围请查阅手册。②处，ADC的输入通道，F4系列单片机ADC共有19个通道，其中外部的16个通道就是框图中的ADCx_IN0到ADCx_IN15，这16个通道对应着不同的IO口，具体对应关系可以在手册或者CUBEMX配置界面获得。另外三个内部通道连接温度传感器、内部电压和电池电压。F4系列的不同型号略有差异，需要查阅手册确定。③处，STM32F4将ADC的转换分为2类通道：规则通道和注入通道。规则通道相当于正常运行的程序，而注入通道，就相当于中断。注入通道的转换可以打断规则通道的转换，在注入通道被转换完成之后，规则通道才得以继续转换。规则通道组最多包含16个通道，而注入通道组最多包含4个通道。④处，是 ADC 的触发源，ADC转换可以由控制寄存器ADC_CR2的位ADON来启动，也可以由外部事件的触发来启动转换。使用控制寄存器启动时，很简单，写1开始转换；写0停止转换。使用外部事件来触发转换，这个触发包括内部定时器触发和外部IO触发。触发源的选择由ADC_CR2的EXTSEL[2:0]和JEXTSEL[2:0]位来控制，EXTSEL[2:0]用于规则通道的触发源，JEXTSEL[2:0]用于选择注入通道的触发源。如果使能了外部触发事件，我们还可以通过设置ADC控制寄存器2：ADC_CR2的EXTEN[1:0]和JEXTEN[1:0]来控制触发极性，可以有4种状态：禁止触发检测、上升沿检测、下降沿检测以及上升沿和下降沿均检测。⑤处，ADC的时钟源来源于ADC预分频器，是由PCLK2经过ADC Prescaler 得到。最大为36MHz，通常设置为21MHz。分频因子由ADC通用寄存器ADC_CCR的ADCPRE[1:0]设置，可设置的分频系数有2、4、6和8。⑥处，当ADC转换完成后，根据转换组的不同，规则组的数据放在ADC_DR寄存器，注入组的数据放在JDRx寄存器。如果使用双重或者三重模式那规则组数据是存放在通用寄存器ADC_CDR内的。规则通道有16个，规则寄存器只有一个，如果使用多通道转换，那转换的数据就全都挤在了DR里面，前一个时间点转换的通道数据，就会被下一个时间点的另外一个通道转换的数据覆盖掉，所以当通道转换完成后就应该吧数据取走。或者开启DMA模式，将数据传输到内存里面，常用的方法是开启DMA传输。注入组有4个通道，相应的寄存器也有4个，这个不会有数据覆盖问题。⑦处，数据转换结束后，可以产生中断，中断分为四种：规则通道转换结束中断、注入转换通道转换结束中断、模拟看门狗和溢出中断。模拟看门狗中断：当ADC转换的模拟电压低于阈值或者高于阈值时，就会产生中断，前提是我们开启了模拟看门狗中断。溢出中断：如果DMA传输数据丢失，会置位ADC状态寄存器ADC_SR和OVR位，如果同时使能了溢出中断，那在转换结束后会产生一个溢出中断。规则和注入通道转换结束后，除了产生中断，还可以产生DMA请求，将转换好的数据直接存储在内存里面。 3 功能说明 3." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/7c75d0c778abf78d776dabe47e918f07/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-03-23T18:13:12+08:00" />
<meta property="article:modified_time" content="2022-03-23T18:13:12+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">STM32_F4_ADC</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>声明：本篇博客的主要目的是对STM32F4系列单片机ADC外设的<strong>要点</strong>和<strong>疑难点</strong>进行总结整理（因为手册内容太多，容易眼花缭乱，抓不住重点），并且尽量避免成为手册的搬运工（否则还不如直接去看手册）。同时在博客的最后，会附上一些ADC常用功能的示例Demo （会随着时间不断完善添加）。</p> 
<p></p> 
<h2>1 概述</h2> 
<hr> 
<p>（概述内容摘自手册）</p> 
<h3>1.1 ADC简介</h3> 
<p><span style="color:#000000;">12 位 ADC 是逐次趋近型模数转换器。它具有多达 19 </span><span style="color:#000000;">个复用通道，可测量来自</span><span style="color:#000000;"> 16 </span><span style="color:#000000;">个外部源、两个内部源和 V</span><span style="color:#000000;">BAT </span><span style="color:#000000;">通道的信号。这些通道的</span><span style="color:#000000;"> A/D </span><span style="color:#000000;">转换可在<strong>单次</strong>、<strong>连续</strong>、<strong>扫描</strong>或<strong>不连续</strong>采样模式下进行。ADC </span><span style="color:#000000;">的结果存储在一个左对齐或右对齐的</span><span style="color:#000000;"> 16 </span><span style="color:#000000;">位数据寄存器中。ADC 具有模拟看门狗特性，允许应用检测输入电压是否超过了用户自定义的阈值上限或下限。</span></p> 
<p></p> 
<h3>1.2 ADC主要特性</h3> 
<ul><li><span style="color:#000000;">可配置 12 位、</span><span style="color:#000000;">10 </span><span style="color:#000000;">位、</span><span style="color:#000000;">8 </span><span style="color:#000000;">位或</span><span style="color:#000000;"> 6 </span><span style="color:#000000;">位分辨率 </span></li><li><span style="color:#000000;">在<strong>转换结束</strong>、<strong>注入转换结束</strong>以及发生<strong>模拟看门狗</strong>或<strong>溢出事件</strong>时产生中断 </span></li><li><span style="color:#000000;"><strong>单次</strong>和<strong>连续转换</strong>模式 </span></li><li><span style="color:#000000;">用于自动将通道 0 </span><span style="color:#000000;">转换为通道“</span><span style="color:#000000;">n</span><span style="color:#000000;">”的扫描模式 </span></li><li><span style="color:#000000;">数据对齐以保持内置数据一致性 </span></li><li><span style="color:#000000;">可独立设置各通道采样时间 </span></li><li><span style="color:#000000;">外部触发器选项，可为<strong>规则转换</strong>和<strong>注入转换</strong>配置极性 </span></li><li><span style="color:#000000;">不连续采样模式 </span></li><li><strong><span style="color:#000000;">双重/</span></strong><span style="color:#000000;"><strong>三重模式</strong>（具有</span><span style="color:#000000;"> 2 </span><span style="color:#000000;">个或更多</span><span style="color:#000000;"> ADC </span><span style="color:#000000;">的器件提供） </span></li><li><span style="color:#000000;">双重/</span><span style="color:#000000;">三重</span><span style="color:#000000;"> ADC </span><span style="color:#000000;">模式下可配置的</span><span style="color:#000000;"> DMA </span><span style="color:#000000;">数据存储 </span></li><li><span style="color:#000000;">双重/</span><span style="color:#000000;">三重交替模式下可配置的转换间延迟 </span></li><li><span style="color:#000000;">ADC 电源要求：全速运行时为</span><span style="color:#000000;"> 2.4 V </span><span style="color:#000000;">到</span><span style="color:#000000;"> 3.6 V</span><span style="color:#000000;">，慢速运行时为</span><span style="color:#000000;"> 1.8 V </span></li><li><span style="color:#000000;">ADC 输入范围：</span><img alt="V_{REF-}\leq V_{IN}\leq V_{REF+}" class="mathcode" src="https://images2.imgbox.com/02/c1/YePPNRYW_o.gif"></li><li><span style="color:#000000;">规则通道转换期间可产生 DMA </span><span style="color:#000000;">请求</span></li></ul> 
<p></p> 
<h2><strong>2 ADC框图</strong></h2> 
<hr> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/a7/01/3hmV48lf_o.png"></p> 
<blockquote> 
 <p><strong>框图说明</strong>：</p> 
 <ul><li>①处，是 ADC 的供电电源（<img alt="V_{DDA},V_{SSA}" class="mathcode" src="https://images2.imgbox.com/e0/34/fe2Lt7fn_o.gif">）和参考电源(<img alt="V_{REF+},V_{REF-}" class="mathcode" src="https://images2.imgbox.com/91/46/dGTpWBAE_o.gif">)。<strong>为了提高转换的精确度，ADC使用一个独立的电源供电，过滤和屏蔽来自印刷电路板上的毛刺干扰</strong>；ADC的电源引脚为VDDA，电源地为VSSA，<strong>如果有VREF- 引脚(根据封装而定)，它必须连接到VSSA，确保共地</strong>。ADC的参考电压都是通过Vref+提供的。100脚以上的型号，Vref+引到了片外，引脚名称为Vref+；64脚和小于64脚的型号，Vref+在芯片内部与VCC信号线相连，没有引到片外，这样AD的参考电压就是VCC上的电压。<strong>VDDA和VREF的电压范围请查阅手册</strong>。</li><li>②处，ADC的输入通道，F4系列单片机ADC共有19个通道，其中外部的16个通道就是框图中的ADCx_IN0到ADCx_IN15，这16个通道对应着不同的IO口，<strong>具体对应关系可以在手册或者CUBEMX配置界面获得</strong>。另外三个内部通道连接温度传感器、内部电压和电池电压。<strong>F4系列的不同型号略有差异，需要查阅手册确定</strong>。</li><li>③处，STM32F4将ADC的转换分为2类通道：<strong>规则通道</strong>和<strong>注入通道</strong>。规则通道相当于正常运行的程序，而注入通道，就相当于中断。注入通道的转换可以打断规则通道的转换，在注入通道被转换完成之后，规则通道才得以继续转换。规则通道组最多包含16个通道，而注入通道组最多包含4个通道。</li><li>④处，是 ADC 的触发源，ADC转换可以由控制寄存器ADC_CR2的位ADON来启动，也可以由外部事件的触发来启动转换。使用控制寄存器启动时，很简单，写1开始转换；写0停止转换。<strong>使用外部事件来触发转换，这个触发包括内部定时器触发和外部IO触发</strong>。触发源的选择由ADC_CR2的EXTSEL[2:0]和JEXTSEL[2:0]位来控制，EXTSEL[2:0]用于规则通道的触发源，JEXTSEL[2:0]用于选择注入通道的触发源。<strong>如果使能了外部触发事件，我们还可以通过设置ADC控制寄存器2：ADC_CR2的EXTEN[1:0]和JEXTEN[1:0]来控制触发极性</strong>，可以有4种状态：禁止触发检测、上升沿检测、下降沿检测以及上升沿和下降沿均检测。</li><li>⑤处，ADC的时钟源来源于ADC预分频器，是由PCLK2经过ADC Prescaler 得到。<strong>最大为36MHz，通常设置为21MHz</strong>。分频因子由ADC通用寄存器ADC_CCR的ADCPRE[1:0]设置，可设置的分频系数有2、4、6和8。</li><li>⑥处，当ADC转换完成后，根据转换组的不同，<strong>规则组的数据放在ADC_DR寄存器，注入组的数据放在JDRx寄存器。如果使用双重或者三重模式那规则组数据是存放在通用寄存器ADC_CDR内的</strong>。规则通道有16个，规则寄存器只有一个，如果使用多通道转换，那转换的数据就全都挤在了DR里面，前一个时间点转换的通道数据，就会被下一个时间点的另外一个通道转换的数据覆盖掉，所以当通道转换完成后就应该吧数据取走。或者开启DMA模式，将数据传输到内存里面，常用的方法是开启DMA传输。注入组有4个通道，相应的寄存器也有4个，这个不会有数据覆盖问题。</li><li>⑦处，数据转换结束后，可以产生中断，中断分为四种：<strong>规则通道转换结束中断</strong>、<strong>注入转换通道转换结束中断</strong>、<strong>模拟看门狗</strong>和<strong>溢出中断</strong>。模拟看门狗中断：当ADC转换的模拟电压低于阈值或者高于阈值时，就会产生中断，前提是我们开启了模拟看门狗中断。溢出中断：如果DMA传输数据丢失，会置位ADC状态寄存器ADC_SR和OVR位，如果同时使能了溢出中断，那在转换结束后会产生一个溢出中断。规则和注入通道转换结束后，除了产生中断，还可以产生DMA请求，将转换好的数据直接存储在内存里面。</li></ul> 
</blockquote> 
<p></p> 
<h2>3 功能说明</h2> 
<hr> 
<p></p> 
<h3>3.1 单次转换、连续转换与扫描模式的关系</h3> 
<p>举例说明如下：用ADC1 规则通道的顺序为CH0,CH1,CH2,CH3</p> 
<table align="center" border="1" cellpadding="1" cellspacing="1"><tbody><tr><td colspan="1" rowspan="2" style="width:137px;">不启动SCAN模式</td><td style="width:114px;">单次转换模式</td><td style="width:543px;"> <p>启动ADC1，则：</p> <p>1，开始转换CH0（ADC_SQR的第一通道）</p> <p>2，转换完成后停止，<strong>等待ADC的下一次启动</strong>，继续从第一步开始转换</p> </td></tr><tr><td style="width:114px;">连续转换模式</td><td style="width:543px;"> <p>启动ADC1，则：</p> <p>1，开始转换CH0（ADC_SQR的第一通道）</p> <p>2，转换完成后回到第一步，<strong>继续转换</strong></p> </td></tr><tr><td colspan="1" rowspan="2" style="width:137px;">启动SCAN模式</td><td style="width:114px;">单次转换模式</td><td style="width:543px;"> <p>启动ADC1，则：</p> <p>1，开始转换CH0</p> <p>2，转换完成后自动开始转换CH1</p> <p>3，转换完成后自动开始转换CH2</p> <p>4，转换完成后自动开始转换CH3</p> <p>5，转换完成后停止，<strong>等待ADC的下一次启动</strong>。下一次ADC启动后从第一步开始转换</p> </td></tr><tr><td style="width:114px;">连续转换模式</td><td style="width:543px;"> <p>启动ADC1，则</p> <p>1，开始转换CH0</p> <p>2，转换完成后自动开始转换CH1</p> <p>3，转换完成后自动开始转换CH2</p> <p>4，转换完成后自动开始转换CH3</p> <p>5，转换完成后返回第一步，<strong>继续转换</strong></p> </td></tr></tbody></table> 
<blockquote> 
 <ul><li><strong>开启扫描模式后 必须搭配DMA功能才能实现ADC的数据处理</strong></li></ul> 
</blockquote> 
<p></p> 
<h3>3.2 注入通道管理</h3> 
<p>注入通道分为<strong>触发注入</strong>和<strong>自动注入</strong>两种方式，关于这两种方式的功能、特性和注意事项，手册上写的很清晰且没有歧义，这里不再多余描述，请直接查阅手册。</p> 
<div style="text-align:center;"> 
 <figure class="image"> 
  <img alt="" src="https://images2.imgbox.com/c6/a6/KiPO1Epu_o.png"> 
  <figcaption>
    图1 STM32F4系列单片机ADC注入通道和规则通道的整体框图 
  </figcaption> 
 </figure> 
</div> 
<p></p> 
<h3>3.3 不连续采样模式（间断模式）</h3> 
<p>如果需要对多个ADC通道进行分组转换，组与组之间希望有可调的时间间隔。采样间断模式可能会比较方便。这块手册上也写的比较详细其且没有歧义。这里就不再过多描述。如果想详细了解，可以参阅手册或者点击这一篇<a href="https://www.sohu.com/a/330452748_807475" rel="nofollow" title="博客">博客</a>。</p> 
<p></p> 
<h3>3.4 采样时间计算</h3> 
<blockquote> 
 <p>（这里直接摘自手册）</p> 
 <p><img alt="" src="https://images2.imgbox.com/3f/9d/97x75q6X_o.png"></p> 
</blockquote> 
<p></p> 
<h3>3.5 使用DMA时一些注意事项</h3> 
<blockquote> 
 <ol><li>开启ADC的DMA功能，建议在ADC校准之后进行。换句话说校准ADC前不要使能其ADC的DMA功能。尤其涉及到多通道ADC  DMA传输时要注意这个次序。</li><li>如果使用ADC的DMA传输，在启动AD转换时，DMA需配置好且被使能待命。</li><li>在多通道ADC DMA传输时，经常出现因为缓冲区数据类型、源数据类型不一致导致的异常状况。这里主要是因为数据宽度不一致所导致的问题。</li></ol> 
</blockquote> 
<p></p> 
<h3>3.6 多重ADC模式</h3> 
<p><span style="color:#000000;">在具有两个或更多</span><span style="color:#000000;"> ADC </span><span style="color:#000000;">的器件中，可使用双重（具有两个</span><span style="color:#000000;"> ADC</span><span style="color:#000000;">）和三重（具有三个</span><span style="color:#000000;"> ADC</span><span style="color:#000000;">）ADC 模式。</span>在多重 ADC 模式下，通过 ADC1 主器件到 ADC2 和 ADC3 从器件的<strong>交替触发</strong>或<strong>同时触发</strong>来启动转换，具体取决于 ADC_CCR 寄存器中的 MULTI[4:0] 位所选的模式。</p> 
<p>注意：</p> 
<blockquote> 
 <ul><li>在多重 ADC 模式下，配置外部事件触发转换时，应用必须设置为仅主器件触发而禁止从器件触发，以防止出现意外触发而启动不需要的从转换。</li><li><span style="color:#000000;">不要在两个/</span><span style="color:#000000;">三个</span><span style="color:#000000;"> ADC </span><span style="color:#000000;">上转换同一通道（转换同一通道时，不允许两个</span><span style="color:#000000;">/</span><span style="color:#000000;">三个</span><span style="color:#000000;"> ADC </span><span style="color:#000000;">采样时间 </span><span style="color:#000000;">重叠）。</span></li></ul> 
</blockquote> 
<p><span style="color:#000000;">可实现以下四种模式： </span></p> 
<blockquote> 
 <ul><li><span style="color:#000000;">注入同时模式 </span></li><li><span style="color:#000000;">规则同时模式 </span></li><li><span style="color:#000000;">交替模式 </span></li><li><span style="color:#000000;">交替触发模式 </span></li></ul> 
</blockquote> 
<p><span style="color:#000000;">也可按以下方式组合使用上述模式： </span></p> 
<blockquote> 
 <ul><li><span style="color:#000000;">注入同时模式 + </span><span style="color:#000000;">规则同时模式 </span></li><li><span style="color:#000000;">规则同时模式 + </span><span style="color:#000000;">交替触发模式</span></li></ul> 
</blockquote> 
<p>因为该部分内容手册描述清晰，没有歧义。所以下面对各种模式的功能、作用只做简要描述，具体配置、执行细节请查阅手册。</p> 
<p></p> 
<h4>3.6.1 <span style="color:#000000;">注入同时模式</span></h4> 
<p><span style="color:#000000;">此模式可转换注入通道组。外部触发源来自</span><span style="color:#000000;"> ADC1 </span><span style="color:#000000;">的注入组多路复用器（通过</span><span style="color:#000000;"> ADC1_CR2 寄存器中的</span><span style="color:#000000;"> JEXTSEL[3:0] </span><span style="color:#000000;">位进行选择）。同时触发可用于</span><span style="color:#000000;"> ADC2 </span><span style="color:#000000;">和</span><span style="color:#000000;"> ADC3</span><span style="color:#000000;">。</span></p> 
<p><span style="color:#000000;">下图为4通道的注入同时模式下双重、三重ADC模式的功能示意图</span></p> 
<p style="text-align:center;"><img alt="" height="507" src="https://images2.imgbox.com/ac/d4/CZhIf6yn_o.png" width="751"></p> 
<p></p> 
<h4>3.6.2 <span style="color:#000000;">规则同时模式</span></h4> 
<p><span style="color:#000000;">此模式式可用于规则通道组。外部触发源来自</span><span style="color:#000000;"> ADC1 </span><span style="color:#000000;">的规则组多路复用器（通过 ADC1_CR2 寄存器中的</span><span style="color:#000000;"> EXTSEL[3:0] </span><span style="color:#000000;">位进行选择）。同时触发可用于</span><span style="color:#000000;"> ADC2 </span><span style="color:#000000;">和</span><span style="color:#000000;"> ADC3</span><span style="color:#000000;">。</span></p> 
<p><span style="color:#000000;">下图为4通道的规则同时模式下双重、三重ADC模式的功能示意图</span></p> 
<p style="text-align:center;"><img alt="" height="507" src="https://images2.imgbox.com/e6/f9/Kk69VCju_o.png" width="751"></p> 
<p></p> 
<h4>3.6.3 <span style="color:#000000;">交替模式</span></h4> 
<p><span style="color:#000000;">此模式只能用于规则组（通常为一个通道）。外部触发源来自</span><span style="color:#000000;"> ADC1 </span><span style="color:#000000;">的规则通道多路复用器。</span></p> 
<p><span style="color:#000000;">下图为一个通道的交替模式下双重、三重ADC模式的功能示意图</span></p> 
<p style="text-align:center;"><img alt="" height="636" src="https://images2.imgbox.com/a7/7f/AIzWrbJt_o.png" width="764"></p> 
<p></p> 
<h4>3.6.4 <span style="color:#000000;">交替触发模式</span></h4> 
<p><span style="color:#000000;">此模式只能用于注入组。外部触发源来自 ADC1 </span><span style="color:#000000;">的规则通道多路复用器。</span></p> 
<p><span style="color:#000000;">下图为一个通道的交替触发模式下双重、三重ADC模式的功能示意图</span></p> 
<p style="text-align:center;"><img alt="" height="752" src="https://images2.imgbox.com/da/bb/SLANPj4k_o.png" width="764"></p> 
<p></p> 
<h4>3.6.5 <span style="color:#000000;">其他复合模式</span></h4> 
<ul><li><span style="color:#000000;">混合型规则</span><span style="color:#000000;">/</span><span style="color:#000000;">注入同时模式 （描述略，有需求可直接查阅手册）</span></li><li><span style="color:#000000;">规则同时</span><span style="color:#000000;"> + </span><span style="color:#000000;">交替触发组合模式</span><span style="color:#000000;">（描述略，有需求可直接查阅手册）</span></li></ul> 
<p><span style="color:#000000;"> </span></p> 
<h3>3.7 温度传感器</h3> 
<p><strong>主要特性</strong></p> 
<ul><li><span style="color:#000000;">支持的温度范围：—40 °C </span><span style="color:#000000;">到</span><span style="color:#000000;"> 125 °C </span></li><li><span style="color:#000000;">精度：±1.5 °C  </span></li></ul> 
<p><strong>逻辑框图</strong></p> 
<p style="text-align:center;"><img alt="" height="471" src="https://images2.imgbox.com/9f/a0/JHbIf0fp_o.png" width="720"></p> 
<p><strong>读取过程</strong></p> 
<ul><li>略，请查阅手册。</li></ul> 
<p></p> 
<h3>3.8 关于中断的说明</h3> 
<p>STM32F4系列单片机ADC共有四个中断事件：</p> 
<table align="center" border="1" cellpadding="1" cellspacing="1" style="width:500px;"><thead><tr><th style="width:201px;"> 
    <div> 
     <span style="color:#000000;">中断事件</span> 
    </div> </th><th style="width:120px;"> 
    <div> 
     <span style="color:#000000;">事件标志</span> 
    </div> </th><th style="width:125px;"> 
    <div> 
     <span style="color:#000000;">使能控制位</span> 
    </div> </th></tr></thead><tbody><tr><td style="width:201px;"> 
    <div> 
     <span style="color:#000000;">结束规则组的转换</span> 
    </div> </td><td style="width:120px;"> 
    <div> 
     <span style="color:#000000;">EOC</span> 
    </div> </td><td style="width:125px;"> <p> <span style="color:#000000;">EOCIE</span></p> </td></tr><tr><td style="width:201px;"> 
    <div> 
     <span style="color:#000000;">结束注入组的转换</span> 
    </div> </td><td style="width:120px;"> 
    <div> 
     <span style="color:#000000;">JEOC</span> 
    </div> </td><td style="width:125px;"> 
    <div> 
     <span style="color:#000000;">JEOCIE</span> 
    </div> </td></tr><tr><td style="width:201px;"> 
    <div> 
     <span style="color:#000000;">模拟看门狗状态位置</span> 
     <span style="color:#000000;"> 1</span> 
    </div> </td><td style="width:120px;"> 
    <div> 
     <span style="color:#000000;">AWD</span> 
    </div> </td><td style="width:125px;"> 
    <div> 
     <span style="color:#000000;">AWDIE</span> 
    </div> </td></tr><tr><td style="width:201px;"> 
    <div> 
     <span style="color:#000000;">溢出</span> 
     <span style="color:#000000;"> (Overrun)</span> 
    </div> </td><td style="width:120px;"> 
    <div> 
     <span style="color:#000000;">OVR</span> 
    </div> </td><td style="width:125px;"> 
    <div> 
     <span style="color:#000000;">OVRIE</span> 
    </div> </td></tr></tbody></table> 
<blockquote> 
 <p><strong>特别注意:</strong></p> 
 <p>不少人可能对EOC中断有所困惑，EOC中断如果工作在多通道扫描模式下，究竟是每转换完一个通道就触发一次中断，还是转换完一整个序列才触发一次中断？这个是由<span style="color:#000000;"><strong>ADC_CR2</strong>寄存器的<strong>EOCS</strong>位决定的，该EOCS位手册描述如下：</span></p> 
 <p style="text-align:center;"><img alt="" height="92" src="https://images2.imgbox.com/86/fa/BOniQkn5_o.png" width="600"></p> 
 <p>手册在对<span style="color:#000000;"><strong>ADC_CR1</strong>寄存器的SCAN位（扫描模式）进行描述时，也提到了这一点：</span></p> 
 <p style="text-align:center;"><img alt="" height="172" src="https://images2.imgbox.com/79/79/NDmIta2n_o.png" width="591"></p> 
 <p>同时，手册里指出，<strong><span style="color:#000000;">JEOC </span><span style="color:#000000;">中断仅在最后一个通道转换结束时生成。</span></strong></p> 
</blockquote> 
<p></p> 
<h3>3.9 寄存器</h3> 
<ul><li>寄存器的一些特殊说明，后续会不定期进行补充。</li></ul> 
<h3>3.10 勘误</h3> 
<ul><li>这里会不定期补充一些勘误说明。</li></ul> 
<p></p> 
<h2>4 CubeMX界面</h2> 
<hr> 
<p></p> 
<p>CubeMX关于ADC的配置界面如下面两图所示（这里使用的是STM32F405），基本上手册中的每一处描述都能在CubeMX上找到相应的配置选项，可以理解成图形化的芯片手册。</p> 
<div style="text-align:center;"> 
 <figure class="image"> 
  <img alt="" src="https://images2.imgbox.com/15/db/Xvzilzpt_o.png"> 
  <figcaption>
    图2 主界面介绍 
  </figcaption> 
 </figure> 
</div> 
<p></p> 
<div style="text-align:center;"> 
 <figure class="image"> 
  <img alt="" src="https://images2.imgbox.com/3d/59/hd2TvcsP_o.png"> 
  <figcaption>
    图3 STM32F4系列单片机ADC外设在CubeMX上的参数配置界面 
  </figcaption> 
 </figure> 
</div> 
<p></p> 
<h2>5 Hal库函数说明</h2> 
<hr> 
<p></p> 
<p>对涉及ADC的Hal库函数逐个描述没有太大的意义，因为源码中的注释已经很详细了。也可以去查阅库文件夹下的.chm帮助文件（其实就是由源码注释直接生成的，内容一模一样）。这里主要对一些使用上的注意事项及常见问题进行补充说明。</p> 
<p>（待补充）</p> 
<p></p> 
<h2>6 DEMO地址</h2> 
<hr> 
<p></p> 
<p>待补充</p> 
<p></p> 
<h2>7 参考链接</h2> 
<hr> 
<blockquote> 
 <p>-<strong>ADC电源相关</strong></p> 
 <ol><li>https://blog.csdn.net/m0_38106923/article/details/103488569</li><li>https://www.cnblogs.com/jieruishu/p/9023811.html</li></ol> 
 <p>-<strong>ADC单次转换模式 连续转换模式 扫描模式</strong></p> 
 <ol><li>https://blog.csdn.net/more_thinking/article/details/88788151?utm_medium=distribute.pc_aggpage_search_result.none-task-blog-2~all~first_rank_v2~rank_v25-1-88788151.nonecase&amp;utm_term=adc%E8%BF%9E%E7%BB%AD%E6%A8%A1%E5%BC%8F%20%E4%B8%8E%E6%89%AB%E6%8F%8F%E6%A8%A1%E5%BC%8F</li><li>https://www.cnblogs.com/smilingfrog/p/5192324.html</li><li>https://www.sohu.com/a/330452748_807475</li></ol> 
 <p>-<strong>勘误及注意事项</strong></p> 
 <ol><li>https://www.stmcu.org.cn/article/id-327948</li></ol> 
 <p>-<strong>其他</strong></p> 
 <ol><li>硬石YS-F4Pro开发板开发手册_20190606</li><li>STM32F4开发指南-HAL库版本_V1.2</li></ol> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d2b91ba671b9bd6d2a6711491fd8d309/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">hive select * 语法中去掉部分列</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/71ebc70e67cb81cd4b9f27326fc1a3e1/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【JTT1078视频服务器】之音视频的拆解</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>