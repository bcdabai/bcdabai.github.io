<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>laravel 添加sql日志 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="laravel 添加sql日志" />
<meta property="og:description" content=" laravel 打印sql语句非常的麻烦而且不方便，所以就想弄一个sql日志来方便调试排除
首先到 EventServiceProvider.php （监听文件） 里 赋值日志开关常数 define(&#39;SQL_LOG&#39;, env(&#39;SQL_LOG&#39;, false)); 然后到 $listen 里增加 SQL_LOG ? \Illuminate\Database\Events\QueryExecuted::class : &#39;&#39; =&gt; [ \App\Listeners\ExampleListener::class // 这个类就是要我们自己写的监听方法 ], 然后到 ExampleListener里写写入sql 的方法 public function handle(QueryExecuted $event) { $sql = str_replace(&#34;?&#34;, &#34;&#39;%s&#39;&#34;, $event-&gt;sql); $log = vsprintf($sql, $event-&gt;bindings); $log = &#39;[&#39; . date(&#39;Y-m-d H:i:s&#39;) . &#39;] &#39; . $log . &#34;\r\n&#34;; $filepath = storage_path(&#39;logs\sql.log&#39;); file_put_contents($filepath, $log, FILE_APPEND); } " />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/ae242f8527128cf815fc72e95e519632/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-06-29T16:19:44+08:00" />
<meta property="article:modified_time" content="2021-06-29T16:19:44+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">laravel 添加sql日志</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>laravel 打印sql语句非常的麻烦而且不方便，所以就想弄一个sql日志来方便调试排除</p> 
<p>首先到 </p> 
<pre>EventServiceProvider.php （监听文件）
里 赋值日志开关常数</pre> 
<pre>define('SQL_LOG', env('SQL_LOG', false));
然后到</pre> 
<pre>$listen 里增加</pre> 
<pre>SQL_LOG ? \Illuminate\Database\Events\QueryExecuted::class : '' =&gt; [
     \App\Listeners\ExampleListener::class         // 这个类就是要我们自己写的监听方法
],

然后到</pre> 
<pre>ExampleListener里写写入sql 的方法</pre> 
<pre>public function handle(QueryExecuted $event)
{
    $sql = str_replace("?", "'%s'", $event-&gt;sql);
    $log = vsprintf($sql, $event-&gt;bindings);
    $log = '[' . date('Y-m-d H:i:s') . '] ' . $log . "\r\n";
    $filepath = storage_path('logs\sql.log');
    file_put_contents($filepath, $log, FILE_APPEND);
}</pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9b6a2acc7f6b8375dd91129f80cfd84b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">保证多线程顺序执行，四种方案，你知道几种？</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f57f653517b8639a9394144f86ca6e42/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">C&#43;&#43;工程项目中常见的写法与解释——多种状态值的混合（按位处理）篇</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>