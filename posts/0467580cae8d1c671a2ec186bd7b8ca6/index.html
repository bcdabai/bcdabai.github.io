<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Kettle实现Oracle到Mysql数据复制 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Kettle实现Oracle到Mysql数据复制" />
<meta property="og:description" content="目录
1.背景
2.安装java 环境
3.部署kettle
3.1. 数据库连接驱动 3.2. 配置kettle转换
3.3.配置oracle和mysql连接
3.4 配置字符集
4. 配置迁移步骤
4.1.配置输入
4.2.配置表输出
4.3.检查
4.4 运行转换
4.5.执行结果 1.背景 工作上遇到个问题：客户本地服务器损坏，本地备份文件全部丢失，基于客户数据库做了个数据中心，实时同步客户数据，数据丢失只能从中心恢复。摆在面前的有几个问题：数据中心数据库是oracle，且数据中心数据量大，本身作为数据仓库存在，不止一个客户数据，数量级别以亿为单位；客户数据库为mysql，传统做法是由dba将数据仓库客户数据剔除生成csv文件，一个表一个文件，提供相关导出数据表结构，使用navicat导入csv文件，一个一个字段确认，过程麻烦不说，效率不高还容易出错；第二个场景，如果客户服务器一旦出问题，没有备份文件，需要立马恢复生产，这个时候只能干看着。这种情况很多，但是dba就是不会，多说一句，dba是真的拖后腿。
决定用kettle，是因为csv文件还原到客户数据库就是我来做，其中艰辛不多说。直接用kettle从数据中心直接还原到客户数据库，一次配置，永久有效，不同客户出问题直接换个ip就行。
Kettle是一款国外开源的ETL工具，纯java编写，可以在Window、Linux、Unix上运行，绿色无需安装，数据抽取高效稳定。kettle的数据抽取主要在于抽取数据，而没有考虑数据库的函数、存储过程、视图、表结构以及索引、约束等等，如果想对这些内容进行迁移，就需要通过写脚本或者更改kettle源码的方式实现了。
2.安装java 环境 参考：https://www.cnblogs.com/nothingonyou/p/11936850.html 3.部署kettle 官网下载较慢，这里选择国内镜像下载，使用的是pdi-ce-7.1.0.0-12.zip 版本。
官网地址：Home - Hitachi Vantara
下载地址：http://mirror.bit.edu.cn/pentaho/Data%20Integration/7.1/
浏览器下载真的很慢，还是用迅雷吧
解压后进入到Kettle目录，双击运行spoon.bat文件，出现如下界面及说明kettle成功部署。
3.1. 数据库连接驱动 在运行之前，我们需要下载对应数据库的jar包导入到Kettle的lib目录下，比如我们需要把oracle迁移到mysql，那就需要oracle和mysql两个jar包
3.2. 配置kettle转换 双击打开spoon.bat，在左侧主对象菜单栏，新建一个转换，命名为【数据同步】，如下图
3.3.配置oracle和mysql连接 输入对应连接信息
点击测试，显示成功即为配置完成 3.4 配置字符集 迁移时要确认两边数据库使用的是哪种字符集，不然可能会出现迁移后出现乱码的问题，我这里oracle是utf8，mysql是utf8：characterEncoding
4. 配置迁移步骤 4.1.配置输入 左侧菜单栏【转换】里面，选择【核心对象】，双击【表输入】，或者选中将【表输入】拖拽到右侧空白区域
双击【表输入】，修改“步骤名称”，选择源数据，点击获取【获取SQL查询语句】，选择你想同步的表，点击确定后就可以了。当然也可以自己写sql语句，我这里是自己写的sql，点击【预览】可以查看要迁移的数据。
4.2.配置表输出 配置表输出，在左侧菜单栏【转换】里面，选择【核心对象】，【输出】一栏接着双击【表输出】，或者选中将【表输出】拖拽到右侧空白区域。双击【表输出】，配置要迁移的目标表，我这里两边数据库字段一样，如图
有一点需要主要的地方，提交记录数量是批量写入数量条数；如果没得分区，表数据分区就取消选中，否则报错：The tablename is not defined (empty)
如果源表和目标表结构不一致，需要自己建立对应关系，可以通过右键单击输出，选择【根据目标步骤生成映射】，配置映射关系，点击【猜一猜】会自动匹配。如图
4.3.检查 在执行之前，检查整个过程是否存在问题：
4.4 运行转换 手工运行作业，点击下图红色圈圈里面的开始按钮，选择日志级别，如果没有红色报错基本无碍。
4.5.执行结果 另外一个方式比较简单，能实现单表或多表复制：工具 — 向导 — 复制多表向导，这种的使用场景适合于批量数据复制，源表目标表数据结构一致。快准狠" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/0467580cae8d1c671a2ec186bd7b8ca6/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-18T19:04:44+08:00" />
<meta property="article:modified_time" content="2023-02-18T19:04:44+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Kettle实现Oracle到Mysql数据复制</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="1.%E8%83%8C%E6%99%AF-toc" style="margin-left:0px;"><a href="#1.%E8%83%8C%E6%99%AF" rel="nofollow">1.背景</a></p> 
<p id="2.%E5%AE%89%E8%A3%85java%20%E7%8E%AF%E5%A2%83-toc" style="margin-left:0px;"><a href="#2.%E5%AE%89%E8%A3%85java%20%E7%8E%AF%E5%A2%83" rel="nofollow">2.安装java 环境</a></p> 
<p id="3.%E9%83%A8%E7%BD%B2kettle-toc" style="margin-left:0px;"><a href="#3.%E9%83%A8%E7%BD%B2kettle" rel="nofollow">3.部署kettle</a></p> 
<p id="3.1.%20%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E9%A9%B1%E5%8A%A8%C2%A0-toc" style="margin-left:40px;"><a href="#3.1.%20%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E9%A9%B1%E5%8A%A8%C2%A0" rel="nofollow">3.1. 数据库连接驱动 </a></p> 
<p id="3.2.%20%E9%85%8D%E7%BD%AEkettle%E8%BD%AC%E6%8D%A2-toc" style="margin-left:40px;"><a href="#3.2.%20%E9%85%8D%E7%BD%AEkettle%E8%BD%AC%E6%8D%A2" rel="nofollow">3.2. 配置kettle转换</a></p> 
<p id="%C2%A03.3.%E9%85%8D%E7%BD%AEoracle%E5%92%8Cmysql%E8%BF%9E%E6%8E%A5-toc" style="margin-left:40px;"><a href="#%C2%A03.3.%E9%85%8D%E7%BD%AEoracle%E5%92%8Cmysql%E8%BF%9E%E6%8E%A5" rel="nofollow">3.3.配置oracle和mysql连接</a></p> 
<p id="3.4%20%E9%85%8D%E7%BD%AE%E5%AD%97%E7%AC%A6%E9%9B%86-toc" style="margin-left:40px;"><a href="#3.4%20%E9%85%8D%E7%BD%AE%E5%AD%97%E7%AC%A6%E9%9B%86" rel="nofollow">3.4 配置字符集</a></p> 
<p id="4.%20%E9%85%8D%E7%BD%AE%E8%BF%81%E7%A7%BB%E6%AD%A5%E9%AA%A4-toc" style="margin-left:0px;"><a href="#4.%20%E9%85%8D%E7%BD%AE%E8%BF%81%E7%A7%BB%E6%AD%A5%E9%AA%A4" rel="nofollow">4. 配置迁移步骤</a></p> 
<p id="%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%204.1.%E9%85%8D%E7%BD%AE%E8%BE%93%E5%85%A5-toc" style="margin-left:40px;"><a href="#%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%204.1.%E9%85%8D%E7%BD%AE%E8%BE%93%E5%85%A5" rel="nofollow">4.1.配置输入</a></p> 
<p id="4.2.%E9%85%8D%E7%BD%AE%E8%A1%A8%E8%BE%93%E5%87%BA-toc" style="margin-left:40px;"><a href="#4.2.%E9%85%8D%E7%BD%AE%E8%A1%A8%E8%BE%93%E5%87%BA" rel="nofollow">4.2.配置表输出</a></p> 
<p id="%C2%A04.3.%E6%A3%80%E6%9F%A5-toc" style="margin-left:40px;"><a href="#%C2%A04.3.%E6%A3%80%E6%9F%A5" rel="nofollow">4.3.检查</a></p> 
<p id="4.4%20%E8%BF%90%E8%A1%8C%E8%BD%AC%E6%8D%A2-toc" style="margin-left:40px;"><a href="#4.4%20%E8%BF%90%E8%A1%8C%E8%BD%AC%E6%8D%A2" rel="nofollow">4.4 运行转换</a></p> 
<p id="4.5.%E6%89%A7%E8%A1%8C%E7%BB%93%E6%9E%9C%C2%A0-toc" style="margin-left:40px;"><a href="#4.5.%E6%89%A7%E8%A1%8C%E7%BB%93%E6%9E%9C%C2%A0" rel="nofollow">4.5.执行结果 </a></p> 
<hr id="hr-toc"> 
<h2>1.背景</h2> 
<p>        工作上遇到个问题：客户本地服务器损坏，本地备份文件全部丢失，基于客户数据库做了个数据中心，实时同步客户数据，数据丢失只能从中心恢复。摆在面前的有几个问题：数据中心数据库是oracle，且数据中心数据量大，本身作为数据仓库存在，不止一个客户数据，数量级别以亿为单位；客户数据库为mysql，传统做法是由dba将数据仓库客户数据剔除生成csv文件，一个表一个文件，提供相关导出数据表结构，使用navicat导入csv文件，一个一个字段确认，过程麻烦不说，效率不高还容易出错；第二个场景，如果客户服务器一旦出问题，没有备份文件，需要立马恢复生产，这个时候只能干看着。这种情况很多，但是dba就是不会，多说一句，dba是真的拖后腿。</p> 
<p>        决定用kettle，是因为csv文件还原到客户数据库就是我来做，其中艰辛不多说。直接用kettle从数据中心直接还原到客户数据库，一次配置，永久有效，不同客户出问题直接换个ip就行。</p> 
<p>      Kettle是一款国外开源的ETL工具，纯java编写，可以在Window、Linux、Unix上运行，绿色无需安装，数据抽取高效稳定。kettle的数据抽取主要在于抽取数据，而没有考虑数据库的函数、存储过程、视图、表结构以及索引、约束等等，如果想对这些内容进行迁移，就需要通过写脚本或者更改kettle源码的方式实现了。</p> 
<h2 id="2.%E5%AE%89%E8%A3%85java%20%E7%8E%AF%E5%A2%83">2.安装java 环境</h2> 
<p>参考：<a href="https://www.cnblogs.com/nothingonyou/p/11936850.html" rel="nofollow" title="https://www.cnblogs.com/nothingonyou/p/11936850.html ">https://www.cnblogs.com/nothingonyou/p/11936850.html </a></p> 
<h2 id="3.%E9%83%A8%E7%BD%B2kettle">3.部署kettle</h2> 
<p>官网下载较慢，这里选择国内镜像下载，使用的是pdi-ce-7.1.0.0-12.zip 版本。</p> 
<p>官网地址：<a href="https://community.hitachivantara.com/s/article/data-integration-kettle" rel="nofollow" title="Home - Hitachi Vantara">Home - Hitachi Vantara</a></p> 
<p>下载地址：<a href="http://mirror.bit.edu.cn/pentaho/Data%20Integration/7.1/" rel="nofollow" title="http://mirror.bit.edu.cn/pentaho/Data%20Integration/7.1/">http://mirror.bit.edu.cn/pentaho/Data%20Integration/7.1/</a></p> 
<p>浏览器下载真的很慢，还是用迅雷吧</p> 
<p>解压后进入到Kettle目录，双击运行spoon.bat文件，出现如下界面及说明kettle成功部署。</p> 
<p><img alt="" height="500" src="https://images2.imgbox.com/96/ed/LCaVCc0e_o.png" width="700"></p> 
<h3 id="3.1.%20%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E9%A9%B1%E5%8A%A8%C2%A0"><strong>3.1. 数据库连接驱动 </strong></h3> 
<p>在运行之前，我们需要下载对应数据库的jar包导入到Kettle的lib目录下，比如我们需要把oracle迁移到mysql，那就需要oracle和mysql两个jar包</p> 
<p> <img alt="" height="719" src="https://images2.imgbox.com/a7/27/QLIEiYlw_o.png" width="839"></p> 
<h3 id="3.2.%20%E9%85%8D%E7%BD%AEkettle%E8%BD%AC%E6%8D%A2"><strong>3.2. 配置kettle转换</strong></h3> 
<p>双击打开spoon.bat，在左侧<strong>主对象</strong>菜单栏，新建一个转换，命名为【数据同步】，如下图</p> 
<p></p> 
<p> <img alt="" height="393" src="https://images2.imgbox.com/f5/f0/CPi45znG_o.png" width="344"></p> 
<h3 id="%C2%A03.3.%E9%85%8D%E7%BD%AEoracle%E5%92%8Cmysql%E8%BF%9E%E6%8E%A5"><strong>3.3.配置oracle和mysql连接</strong></h3> 
<p>        输入对应连接信息</p> 
<p><img alt="" height="741" src="https://images2.imgbox.com/86/3a/D2iXdw0P_o.png" width="1200"></p> 
<p>点击测试，显示成功即为配置完成 </p> 
<p><img alt="" height="198" src="https://images2.imgbox.com/ac/43/v7CMXHqd_o.png" width="246"></p> 
<p></p> 
<h3 id="3.4%20%E9%85%8D%E7%BD%AE%E5%AD%97%E7%AC%A6%E9%9B%86"><strong>3.4 配置字符集</strong></h3> 
<p>        迁移时要确认两边数据库使用的是哪种字符集，不然可能会出现迁移后出现乱码的问题，我这里oracle是utf8，mysql是utf8：characterEncoding</p> 
<p><img alt="" height="743" src="https://images2.imgbox.com/c2/e6/AApE1QpT_o.png" width="1200"></p> 
<h2 id="4.%20%E9%85%8D%E7%BD%AE%E8%BF%81%E7%A7%BB%E6%AD%A5%E9%AA%A4"><strong>4. 配置迁移步骤</strong></h2> 
<h3 id="%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%204.1.%E9%85%8D%E7%BD%AE%E8%BE%93%E5%85%A5">4.1.配置输入</h3> 
<p>        左侧菜单栏【转换】里面，选择【核心对象】，双击【表输入】，或者选中将【表输入】拖拽到右侧空白区域</p> 
<p> <img alt="" height="436" src="https://images2.imgbox.com/cf/5c/YKJst9Xa_o.png" width="351"></p> 
<p> <img alt="" height="471" src="https://images2.imgbox.com/85/bc/DFmZslOV_o.png" width="352"></p> 
<p>        双击【表输入】，修改“步骤名称”，选择源数据，点击获取【获取SQL查询语句】，选择你想同步的表，点击确定后就可以了。当然也可以自己写sql语句，我这里是自己写的sql，点击【预览】可以查看要迁移的数据。</p> 
<p><img alt="" height="631" src="https://images2.imgbox.com/56/5f/cUG8kklS_o.png" width="1200"></p> 
<p></p> 
<h3 id="4.2.%E9%85%8D%E7%BD%AE%E8%A1%A8%E8%BE%93%E5%87%BA">4.2.配置表输出</h3> 
<p>        配置<strong>表输出</strong>，在左侧菜单栏【转换】里面，选择【核心对象】，【输出】一栏接着双击【表输出】，或者选中将【表输出】拖拽到右侧空白区域。双击【表输出】，配置要迁移的目标表，我这里两边数据库字段一样，如图</p> 
<p><img alt="" height="464" src="https://images2.imgbox.com/c3/21/AzPn8LTn_o.png" width="479"></p> 
<p>        有一点需要主要的地方，提交记录数量是批量写入数量条数；如果没得分区，表数据分区就取消选中，否则报错：The tablename is not defined (empty)</p> 
<p><img alt="" height="628" src="https://images2.imgbox.com/a4/c9/jNhx2VcY_o.png" width="469"></p> 
<p>         如果源表和目标表结构不一致，需要自己建立对应关系，可以通过右键单击输出，选择【根据目标步骤生成映射】，配置映射关系，点击【猜一猜】会自动匹配。如图</p> 
<p><img alt="" height="759" src="https://images2.imgbox.com/2e/f2/n0YDx2M9_o.png" width="772"></p> 
<p></p> 
<p><img alt="" height="437" src="https://images2.imgbox.com/e2/23/FIsFfjZz_o.png" width="1032"></p> 
<h3 id="%C2%A04.3.%E6%A3%80%E6%9F%A5">4.3.检查</h3> 
<p>        在执行之前，检查整个过程是否存在问题：</p> 
<p><img alt="" height="341" src="https://images2.imgbox.com/ad/4c/EXR4wuUP_o.png" width="639"></p> 
<p><img alt="" height="379" src="https://images2.imgbox.com/77/fc/LFpxhSup_o.png" width="883"></p> 
<h3 id="4.4%20%E8%BF%90%E8%A1%8C%E8%BD%AC%E6%8D%A2"><strong>4.4 运行转换</strong></h3> 
<p>手工运行作业，点击下图红色圈圈里面的开始按钮，选择日志级别，如果没有红色报错基本无碍。</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/c5/45/XQV2tRSB_o.png"></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/72/8a/zLMFH7Ys_o.png"></p> 
<h3 id="4.5.%E6%89%A7%E8%A1%8C%E7%BB%93%E6%9E%9C%C2%A0">4.5.执行结果 </h3> 
<p> <img alt="" height="286" src="https://images2.imgbox.com/77/d8/WATeIn1Z_o.png" width="553"></p> 
<p></p> 
<p>另外一个方式比较简单，能实现单表或多表复制：工具 — 向导 — 复制多表向导，这种的使用场景适合于批量数据复制，源表目标表数据结构一致。快准狠</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5268b54c048059c44147f7948e83a5ab/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【C语言学习笔记】int和long的范围</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d88362acc3b7f73c2ac92f6f5712c7b7/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Kettle连接Oracle(Oracle19c&amp;Oracle11g)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>