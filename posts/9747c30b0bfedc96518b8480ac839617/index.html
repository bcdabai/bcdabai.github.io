<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>SQL Server高级编程 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="SQL Server高级编程" />
<meta property="og:description" content="SQLserver高级编程
1、数据库设计
数据库设计的重要性：
减少冗余，提高性能、易维护
数据库设计的步骤：
1、收集信息、标识对象、标识属性、标识关系（一对一、一对多、多对一、多对多）
E-R图：
属性：定义实体的性质、实体的特征
实体：数据项（属性）的集合
关联：实体之间相互连接的方式
简单理解一下就可以了
数据库规范化：
第一范式（1NF）：
每列都应该是原子性的，五重复的域
第二范式（2NF）：
在第一范式的基础上属性完全依赖于主键
第三范式（3NF）：
第三范式要求各列与主键列直接相关
T-SQL语句创建和管理数据库和表：
T-SQL创建数据库：
if DB_ID(&#39;数据库名&#39;) is not null drop database 数据库名 go create database 数据库名 on ( name=&#39;数据库名&#39;, filename=&#39;物理数据库储存路径数据库文件&#39; ) 案例:
if DB_ID(&#39;Student&#39;)is not null drop databese Student go create databese Student on ( name=&#39;Student&#39;, finema=&#39;E:\第二学期\SQL\stuDB\Student.mdf&#39; ) 数据文件参数 描述
name 数据库逻辑名称
filename 数据库物理文件名
size 数据文件初始化大小，单位默认为M
maxsize 数据文件可增长到最大值，单位默认阿M，不指定即无限大
filegrowth 数据库每次增长率，可以是百分比，默认单位M，0不增长
T-SQL语句创建表：
if object_ID(&#39;表名&#39;)is not null drop table 表名 go create table 表名 ( 字段1 数据类型 列的特性， 字段2 数据类型 列的特性 ) 案例：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/9747c30b0bfedc96518b8480ac839617/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-07-04T10:29:37+08:00" />
<meta property="article:modified_time" content="2022-07-04T10:29:37+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">SQL Server高级编程</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>SQLserver高级编程<br> 1、数据库设计<br> 数据库设计的重要性：<br> 减少冗余，提高性能、易维护</p> 
<p>数据库设计的步骤：<br> 1、收集信息、标识对象、标识属性、标识关系（一对一、一对多、多对一、多对多）</p> 
<p>E-R图：<br> 属性：定义实体的性质、实体的特征</p> 
<p>实体：数据项（属性）的集合</p> 
<p>关联：实体之间相互连接的方式</p> 
<p>简单理解一下就可以了</p> 
<p>数据库规范化：<br> 第一范式（1NF）：<br> 每列都应该是原子性的，五重复的域</p> 
<p>第二范式（2NF）：<br> 在第一范式的基础上属性完全依赖于主键</p> 
<p>第三范式（3NF）：<br> 第三范式要求各列与主键列直接相关</p> 
<p>T-SQL语句创建和管理数据库和表：<br> T-SQL创建数据库：</p> 
<pre><code class="prism language-sql"><span class="token keyword">if</span> DB_ID<span class="token punctuation">(</span><span class="token string">'数据库名'</span><span class="token punctuation">)</span> <span class="token operator">is</span> <span class="token operator">not</span> <span class="token boolean">null</span>
<span class="token keyword">drop</span> <span class="token keyword">database</span> 数据库名
go
<span class="token keyword">create</span> <span class="token keyword">database</span> 数据库名
<span class="token keyword">on</span>
<span class="token punctuation">(</span>
name<span class="token operator">=</span><span class="token string">'数据库名'</span><span class="token punctuation">,</span>
filename<span class="token operator">=</span><span class="token string">'物理数据库储存路径数据库文件'</span>
<span class="token punctuation">)</span>
</code></pre> 
<p>案例:</p> 
<pre><code class="prism language-sql"><span class="token keyword">if</span> DB_ID<span class="token punctuation">(</span><span class="token string">'Student'</span><span class="token punctuation">)</span><span class="token operator">is</span> <span class="token operator">not</span> <span class="token boolean">null</span>
<span class="token keyword">drop</span> databese Student
go
<span class="token keyword">create</span> databese Student
<span class="token keyword">on</span>
<span class="token punctuation">(</span>
name<span class="token operator">=</span><span class="token string">'Student'</span><span class="token punctuation">,</span>
finema<span class="token operator">=</span><span class="token string">'E:\第二学期\SQL\stuDB\Student.mdf'</span>
<span class="token punctuation">)</span>
</code></pre> 
<p>数据文件参数 描述<br> name 数据库逻辑名称<br> filename 数据库物理文件名<br> size 数据文件初始化大小，单位默认为M<br> maxsize 数据文件可增长到最大值，单位默认阿M，不指定即无限大<br> filegrowth 数据库每次增长率，可以是百分比，默认单位M，0不增长<br> T-SQL语句创建表：</p> 
<pre><code class="prism language-sql"><span class="token keyword">if</span> object_ID<span class="token punctuation">(</span><span class="token string">'表名'</span><span class="token punctuation">)</span><span class="token operator">is</span> <span class="token operator">not</span> <span class="token boolean">null</span>
<span class="token keyword">drop</span> <span class="token keyword">table</span> 表名
go
<span class="token keyword">create</span> <span class="token keyword">table</span> 表名
<span class="token punctuation">(</span>
字段<span class="token number">1</span> 数据类型 列的特性，
字段<span class="token number">2</span> 数据类型 列的特性
<span class="token punctuation">)</span>
</code></pre> 
<p>案例：</p> 
<pre><code class="prism language-sql"><span class="token keyword">if</span> object_ID<span class="token punctuation">(</span><span class="token string">'StuInfo'</span><span class="token punctuation">)</span><span class="token operator">is</span> <span class="token operator">not</span> <span class="token boolean">null</span>
<span class="token keyword">drop</span> <span class="token keyword">table</span> StuInfo
go
<span class="token keyword">create</span> <span class="token keyword">table</span> StuInfo
<span class="token punctuation">(</span>
StuId <span class="token keyword">int</span> <span class="token keyword">identity</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>
StuName <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
StuSex <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
StuAge <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span>
<span class="token punctuation">)</span>
</code></pre> 
<p>T-SQL创建约束：<br> 主键约束：（primary key constraint）：主键列数据唯一，并不为空，简称：PK</p> 
<p>唯一约束：（unique constraint）：保证该列不允许除夕重复值，简称：UQ</p> 
<p>检查约束：（check constraint）：限制列中允许的取值以及多个列直接的关系，简称：CK</p> 
<p>默认约束：（default constraint）：设置某列的默认值，简称：DF</p> 
<p>外键约束：（foreign key constraint）：用于在两个表之间建立关系，需要指定主从表，简称：FK</p> 
<p>T-SQL添加约束的语法格式：<br> alter table 表名</p> 
<p>add constraint 约束名 约束类型 具体的约束说明</p> 
<p>T-SQL删除约束：<br> alter table 表名</p> 
<p>drop constraint 约束名</p> 
<p>案例：<br> 复制代码<br> –添加主键约束（将StuNo设为主键）<br> alter table StuInfo add constraint PK_StuNO primary key (StuNo)<br> go<br> –添加默认约束（性别默认为男）<br> alter table StuInfo Add constraint DF_StuSex DEFAULT (‘男’)for StuSex<br> go<br> –添加检查约束（年龄必须为40之间）<br> alter table StuInfo Add constraint CK_StuAge check(StuAge&gt;=18 and StuAge&lt;=40)<br> go<br> –添加外键约束<br> alter table Exam Add constraint FK_StuNo FORELGN KEY (StuNo)references StuInfo(StuNo)<br> go<br> 复制代码<br> （1）对表结构的操作<br> 1、在表中添加一列</p> 
<p>语法：alter table 表名</p> 
<p>add 添加的列名 数据类型</p> 
<p>例子：在Student表中添加列Hobbies,类型为varchar,宽度：20</p> 
<pre><code>    alter  table  Student  
</code></pre> 
<p>add Hobbies varchar(20)<br> 2、删除表中的一列</p> 
<p>语法：alter table 表名</p> 
<p>drop column 列名</p> 
<p>例子：删除Student表中的Hobbies列</p> 
<p>alter table Student</p> 
<p>drop column Hobbies</p> 
<p>3、修改表中列的数据类型</p> 
<p>语法：alter table 表名</p> 
<p>alter column 列名 修改后的数据类型 not null</p> 
<p>例子：修改Student中的Sex列为char型，宽度为2</p> 
<p>alter table Student</p> 
<p>alter column Sex char(2) nou null</p> 
<p>(2)添加约束<br> 1、添加主键约束<br> 语法：alter table 表名<br> add constraint 约束名 primary key(要设置主键的列名)<br> 例子：<br> 给Class表添加主键约束<br> if OBJECT_ID(‘PK_ClassId’) is not null<br> alter table Class<br> drop constraint PK_ClassId<br> go<br> alter table Class<br> add constraint PK_ClassId primary key(ClassId)</p> 
<p>2、添加唯一约束<br> 语法：alter table 表名<br> add constraint 约束名 unique(要添加唯一约束的列名)<br> 例子：<br> 给信息表stuInfo中的姓名添加唯一约束<br> if OBJECT_ID(‘UQ_StuName’) is not null<br> alter table StuInfo<br> drop constraint UQ_StuName<br> go<br> alter table StuInfo<br> add constraint UQ_StuName<br> unique(StuName)</p> 
<p>3、添加默认约束<br> 语法：alter table 表名<br> add constraint 约束名 Default(默认值) for 要添加默认值的列名<br> 例子：<br> 给stuInfo表中的Age列添加默认值为18<br> if OBJECT_ID(‘DF_Age’) is not null<br> alter table StuInfo<br> drop constraint DF_Age<br> go<br> alter table stuInfo<br> add constraint DF_Age Default(18) for Age</p> 
<p>4、添加检查约束<br> 语法：alter table 表名<br> drop constraint 约束名<br> check(列名&gt;=0)<br> 例子：<br> 给笔试成绩添加一个约束，要求成绩必须在0-100之间<br> if OBJECT_ID(‘CK_WriteExam’) is not null<br> alter table Exam<br> drop constraint CK_WriteExam<br> go<br> alter table Exam<br> add constraint CK_WriteExam<br> check(WriteExam&gt;=0 and WriteExam&lt;=100)</p> 
<p>5、外键约束<br> 语法：alter table 表名1<br> add constraint 约束名<br> foreign key(外键约束名)<br> references 表名2(外键约束名)<br> 例子：<br> 给班级表与学员信息表创建关系（外键约束）<br> if OBJECT_ID(‘FK_Class_StuInfo’) is not null<br> alter table stuInfo<br> drop constraint Fk_Class_StuInfo<br> go<br> alter table stuInfo<br> add constraint Fk_Class_StuInfo<br> foreign key(ClassId)<br> references Class(ClassId)</p> 
<p>–删除约束<br> Alter table 表名<br> Drop ConStraint 约束名</p> 
<p>–删除表<br> Drop table 表名</p> 
<p>(3)高级查询语法格式<br> –内连接<br> 语法：<br> select 要查询的属性<br> from 表1 inner join 表2<br> on 表1.Id=表2.Id<br> where 要限制的条件（可以不要）</p> 
<p>–左外连接<br> 语法:<br> select 要查询的属性<br> from 表1 left outer join 表2<br> on 表1.id=表2.id</p> 
<p>–右外连接<br> 语法：<br> select 要查询的属性<br> from 表1 right outer join 表2<br> on 表1.id=表2.id</p> 
<p>–全外连接<br> 语法：<br> select 要查询的属性<br> from 表1 full outer join 表2<br> on 表1.id=表2.id</p> 
<p>–交叉连接<br> 语法：<br> select 要查询的属性<br> from 表1 Cross join 表2<br> where 条件</p> 
<p>–自连接<br> select 要查询的属性<br> from 表1 , 表2<br> where 表1.id=表2.id</p> 
<p>(4)高级查询实例<br> if DB_ID(‘GoodSystem’) is not null<br> drop database GoodSystem<br> go<br> create database GoodSystem on --创建一个商品数据库<br> (<br> name=‘GoodSystem’,<br> filename=‘E:\SQL\第二章上机任务\GoodSystem.mdf’<br> )<br> –打开数据库<br> use GoodSystem<br> –创建商品类型表GoodsType<br> if OBJECT_ID(‘GoodType’) is not null<br> drop table GoodType<br> go<br> create table GoodType<br> (<br> Tid int primary key,<br> Type varchar(20)<br> )<br> –创建商品信息表Goods<br> if OBJECT_ID(‘Goods’) is not null<br> drop table Goods<br> go<br> create table Goods<br> (<br> id int primary key,<br> Tid int ,<br> Name varchar(50),<br> Price money,<br> ProductionDate datetime,<br> Amount int<br> )<br> –给商品类型表GoodsType添加测试数据<br> insert GoodType select ‘1’,‘家电’ union<br> select ‘2’,‘电子’ union<br> select ‘3’,‘食品’ union<br> select ‘4’,‘生活用品’</p> 
<p>–给商品信息表Goods添加测试数据<br> insert Goods select ‘1’,‘1’,‘冰箱’,‘3344’,‘2017-6-3’,‘100’ union<br> select ‘2’,‘1’,‘电视’,‘1777’,‘2016-10-4’,‘100’ union<br> select ‘3’,‘1’,‘微波炉’,‘333’,‘2017-2-26’,‘100’ union<br> select ‘4’,‘2’,‘手机’,‘4500’,‘2017-5-7’,‘100’ union<br> select ‘5’,‘2’,‘显示器’,‘1777’,‘2016-12-4’,‘100’ union<br> select ‘6’,‘2’,‘主机’,‘1500’,‘2017-3-9’,‘100’ union<br> select ‘7’,‘3’,‘老干妈’,‘9’,‘2017-7-6’,‘100’ union<br> select ‘8’,‘3’,‘爽口榨菜’,‘3.6’,‘2017-6-8’,‘100’</p> 
<p>–查询商信息表中的商品名称，价钱，生产日期。<br> select Name 商品名称,Price 价钱,ProductionDate 生产日期<br> from Goods<br> –查询商品类型、商品名称、价钱、生产日期<br> select gt.Type 商品类型,gs.Name 商品名称 , gs.Price 商品价钱,gs.ProductionDate 生产日期<br> from GoodType gt inner join Goods gs<br> on gt.Tid=gs.Tid<br> –查询生产日期为2017的商品类型、商品名称、价钱、生产日期<br> select gt.Type 商品类型,gs.Name 商品名称 , gs.Price 价钱,gs.ProductionDate 生产日期<br> from GoodType gt inner join Goods gs<br> on gt.Tid=gs.Tid and year(gs.ProductionDate) like ‘2017%’<br> –查询商品类型为“电子”的商品类型、商品名称、价钱、生产日期，数据按价钱降序排列<br> select gt.Type 商品类型,gs.Name 商品名称,gs.Price 价钱 ,gs.ProductionDate 生产日期<br> from GoodType gt inner join GoodS gs<br> on gt.Tid=gs.Tid and gt.Type=‘电子’<br> order by Price desc</p> 
<p>–统计每种商品类型的商品数量<br> select gt.Type 商品类型, COUNT(gs.Amount) 商品数量<br> from GoodType gt inner join Goods gs<br> on gt.Tid=gs.Tid<br> group by gt.Type</p> 
<p>–查询所有商品类型对应的所有商品信息<br> select gt.Type 商品类型,gs.Name 商品名称 , gs.Price 商品价钱,gs.ProductionDate 生产日期<br> from GoodType gt left join Goods gs<br> on gt.Tid=gs.Tid</p> 
<p>–查询价钱是333、1500、4500的商品信息<br> select Type 商品类型,Name 商品名称,Price 商品价钱,ProductionDate 生产日期<br> from GoodType gt ,Goods gs<br> where Price in(333,1500,4500)<br> and (gs.Tid=gt.Tid)</p> 
<p>–查询没有对应商品信息的商品类型信息（类型编号，类型名称）<br> select Tid 编号,Type 类型 from GoodType<br> where Tid not in<br> (select Tid from Goods)</p> 
<p>–查询所有商品的平均价钱<br> select AVG(Price) 平均价钱 from Goods</p> 
<p>–查询价钱大于平均价钱的商品信息<br> select Type 商品类型,Name 商品名称,Price 商品价钱,ProductionDate 生产日期<br> from GoodType gt , Goods gs<br> where gs.Tid=gt.Tid<br> and Price&gt;<br> (select AVG(Price) 平均价钱 from Goods)</p> 
<p>–查询每种商品类型平均价钱超出总平均价钱的类型名称、平均价钱<br> select gt.Type 类型名称,AVG(Price) 价钱<br> from Goods gs,GoodType gt<br> where gs.Tid=gt.Tid<br> and<br> gs.Tid in<br> (select gs.Tid<br> from Goods<br> group by Tid<br> having AVG(Price)&gt;<br> (select AVG(Price) 平均价钱 from Goods))<br> group by gt.Type<br> –查询所有商品总金额超20万的商品类型、名称、总金额<br> select Type 商品类型 ,Name 名称 ,PriceAmount 总金额<br> from GoodS gs , GoodType gt<br> where gs.Tid=gt.Tid<br> and PriceAmount&gt;200000<br> –库存报警（低10）</p> 
<p>–延迟到14:03:00 执行查询<br> waitfor time ‘14:03:00’<br> select*from Goods<br> –延迟两秒执行操作<br> waitfor delay ‘00:00:02’<br> select *from Goods</p> 
<p>(5)变量函数<br> –常用的数学函数<br> –1、ABS 求绝对值 交易之前-交易之后<br> –2、POWER 求次方<br> select POWER(2,10),POWER(2.0000,0.5) --1kb 1024<br> select POWER(2.0000000,1.000000/3)<br> –3、求圆周率<br> select PI()<br> –4、Rount() --四舍五入函数<br> select ROUND(315.4567,2),Round(315.4567,0),Round(345.4567,-2)<br> –5、ceiling --取比原数大的整数<br> –6、floor --取比原数小的整数<br> select CEILING(3.00000000001),FLOOR(3.99999999)<br> –7、ASCII 返回一个字符的ASCII码值<br> select ASCII(‘A’)<br> –8、Rand() 返回一个0-1之间的随机数<br> –select nCHAR(214)+nCHAR(208)<br> select RAND()<br> select RAND(DATEPART(ss,GetDate())*2)–这样打变化频率小<br> go</p> 
<p>–产生一个银行卡号，前8位为’6225 3800’ 后8位为随机数字，<br> –请用T-SQL编码完成<br> –select RAND()<br> declare @rand numeric(20,8)<br> select @rand=RAND()<br> print @rand<br> declare @s varchar(16)<br> set @s=SUBSTRING(STR(@rand,10,8),3,8)<br> print @s<br> set @s=‘62253800’+@s<br> print ‘你的新银行卡号为：’+@s</p> 
<p>–日期函数<br> –1、getdate()：返回服务器上的当前时间<br> select GETDATE()<br> –2、datepart：返回一个日期的一部分值（整形）<br> –3、datename：返回一个日期的一部分值（字符串）<br> –返回一周的第几天（星期天是第一天）<br> select DATEPART(DW,GETDATE()),DATENAME(DW,GETDATE())<br> –返回一年的第几周<br> select DATEPART(WEEK,GETDATE()),DATENAME(WEEK,GETDATE())<br> –4、datediff 日期比较函数<br> –返回每个交易已经发生了多少天<br> select DATEDIFF(DD,transdate,GETDATE()) from TransInfo</p> 
<p>–字符串函数<br> –1、LEN：返回一个字符串的字符数<br> select LEN(‘中国’),LEN(‘abc123!’)<br> select LEN(‘abc ‘),LEN(’ abc’)–数据类型为varchar类型，会自动消除没字符连接的空格</p> 
<p>–2、dataLength：返回一个字符串的字节数<br> select dataLength(‘中国’),dataLength(‘abc123!’)<br> select RIGHT(‘abcdef’,3),LEFT(‘abcdef’,3)<br> –4、substring：字符串截取函数<br> select SUBSTRING(‘abcdef’,2,3)–和C#不一样，下标从一开始<br> –5、charIndex：字符串查找函数<br> select charIndex(‘a’,‘bcad’,1)<br> –6、upper：字母大写转换函数<br> –7、lower：字母小写转换函数<br> select UPPER(‘abc123’),LOWER(‘abCCC123中！’)<br> –8、space：产生空格函数<br> select len(‘abc’+SPACE(10) +‘123’) ,‘abc’+SPACE(10) +‘123’ --len是测定总长度<br> –9、replicate：字符串重复函数<br> select REPLICATE(‘abc’,3)<br> –10、replace:字符替换函数<br> select REPLACE(‘11111111’,‘1’,‘o’)–将1替换为o<br> select REPLACE(‘o0o0o0o0000oo’,‘0’,‘o’),‘00000000’–将0替换为o<br> select REPLACE( REPLACE(‘0o0oil0oillil10ol1’,‘l’,‘1’),‘0’,‘o’)<br> –11、stuff：字符替换函数<br> select STUFF(‘湖南武汉’,2,1,‘北’)<br> select STUFF(‘中国长沙’,3,0,‘湖南’)–输出中国湖南长沙<br> –12、ltrim和rtrim：去掉字符串左边或右边的全部空格<br> select len(ltrim(’ a bc’))<br> –13、str：将数值转换为字符串函数<br> select STR(12345.65,8,2)<br> –14、char：将一个ASCII码值转换为一个字符<br> select CHAR(97),ASCII(‘a’)</p> 
<p>(6)数据库变量格式<br> use StuDB<br> selectfrom StuInfo<br> selectfrom Exam<br> –总学生人数 参考人数 及格人数 未及格人数 及格率<br> declare @total int,@sum int,@pass int<br> select @total=COUNT() from StuInfo --统计总人数<br> select @sum=COUNT() from Exam --统计参考人数<br> select @pass=COUNT(*) from Exam<br> where WriteExam&gt;=60 and LadExam&gt;=60 --统计及格人数</p> 
<p>select @total 总人数,@sum 参考人数,@pass 及格人数 ,<br> @total-@pass 未及格人数,CONVERT(varchar(20),<br> ceiling( @pass1.0/@total10000)/100)+‘%’ 及格率</p> 
<p>select*from StuInfo<br> –查看上一个错误的编号<br> select @@ERROR</p> 
<p>selectfrom StuInfo<br> selectfrom Class<br> select @@IDENTITY<br> insert Class values(‘s149’)</p> 
<p>–获取上一次SQL指令影响的命令行数<br> select @@ROWCOUNT</p> 
<p>–判断删除是否成功<br> –1、直接删除<br> –2、先查询，然后再删除，再查询</p> 
<p>–当前SQL服务器名称，当前服务名称<br> select @@SERVERNAME ,@@SERVICENAME</p> 
<p>–显示当前打开的事务数<br> select @@TRANCOUNT</p> 
<p>–显示当前服务器允许的最大连接数<br> select @@MAX_CONNECTIONS</p> 
<p>–显示当前使用的语言<br> select @@LANGUAGE</p> 
<p>print ‘当前服务器名称:’ +@@servername<br> print ‘当前服务名称:’ +@@servicename<br> print ‘错误编号：’ +convert(varchar(6), @@error)</p> 
<p>–显示笔试平均成绩，再根据平均成绩显示相应信息<br> declare @avg float<br> select @avg=AVG(writeExam) from Exam<br> print ’ ------成绩信息如下：--------’<br> print’全校平均成绩：‘+convert(varchar(20),@avg)<br> if @avg&gt;=70<br> begin<br> print’成绩优秀！’<br> –显示前三名的学员信息<br> select top 3 StuName,si.StuId,WriteExam,LadExam<br> from StuInfo si,Exam e<br> where si.StuId=e.StuId<br> order by WriteExam desc --笔试降序<br> end<br> else<br> begin<br> print’成绩比较差！’<br> –显示后三名的学员信息<br> select top 3 StuName,si.StuId,WriteExam,LadExam<br> from StuInfo si,Exam e<br> where si.StuId=e.StuId<br> order by WriteExam asc --笔试降序<br> end</p> 
<p>–对全班学员进行提分，保证每位同学的笔试成绩全部通过<br> while(1=1) --永真循环<br> begin<br> declare @count int --保存未通过的人数<br> –统计为通过的人数<br> select @count=Count(*) from Exam where writeExam&lt;60<br> if (@count=0)<br> begin<br> break --终止循环<br> end<br> –进行加分<br> update Exam set WriteExam=100 where writeExam&gt;=98<br> update Exam set WriteExam=WriteExam+2 where WriteExam&lt;98</p> 
<p>end<br> print’----------加分后的学员成绩如下：--------------’<br> select*from Exam</p> 
<p>–显示学员笔试成绩的等级制<br> –90以上：优秀，80-90：良好，70-80：中等，60-69 ：一般<br> –60以下：不及格<br> select ExamNo 考号,StuId 学号,WriteExam 笔试成绩 ,LadExam 机试成绩,<br> 等级=<br> case<br> when writeExam&gt;=90 then ‘优秀’<br> when writeExam&gt;=80 then ‘良好’<br> when writeExam&gt;=70 then ‘中等’<br> when writeExam&gt;=60 then ‘一般’<br> else ‘不及格’<br> end<br> from Exam</p> 
<p>–显示所有学员打的姓名，性别，年龄，笔试成绩，机试成绩<br> –没有成绩的学员显示缺考<br> select stuName,sex,Age,WriteExam=<br> case<br> when WriteExam IS null then ‘缺考’<br> else CONVERT(varchar(20),writeExam)<br> end,<br> LadExam=<br> case<br> when LadExam IS null then ‘缺考’<br> else CONVERT(varchar(20),ladexam)<br> end<br> from StuInfo si left join Exam e<br> on si.StuId=e.StuId</p> 
<p>–未参加考试的学员成绩为0<br> select stuName ,sex ,ISNULL(age,18),<br> ISNULL(WriteExam,0),<br> ladexam=<br> case<br> when ladexam IS null then 0<br> else ladexam<br> end<br> from StuInfo si left join Exam e<br> on si.StuId=e.StuId</p> 
<p>(7)索引、视图、事务</p> 
<p>–创建索引<br> 语法：<br> if exists(select*from sys.indexes<br> where name=‘IX_stuinfo_AgeName’)<br> drop index stuinfo.IX_stuinfo_AgeName<br> go<br> create nonclustered index 索引名<br> on 表名（按某列升序或降序）<br> 例子：<br> create nonclustered index IX_stuinfo_AgeName<br> on stuinfo(age,stuname desc)<br> 备注：列名后加 desc 是降序的意思，不加默认升序<br> 备注2：nonclustered表示创建非聚集索引 还有如：unique表示创建唯一性索引，clustered 表示创建聚集索引</p> 
<p>–使用索引<br> 语法：<br> selectfrom 有该索引的表名<br> with (index=索引名)<br> 例子：<br> 使用索引IX_stuinfo_AgeName 查询学员信息<br> selectFrom StuInfo<br> with(index=IX_Stuinfo_AgeName)</p> 
<p>–索引的优点和缺点<br> 优点：<br> 1、加快访问速度<br> 2、加强行的唯一性<br> 缺点：<br> 1、带索引的表在数据库中需要更多的存储空间<br> 2、更新数据的命令需要更长的处理时间，因为它们需要对索引进行更新</p> 
<p>–创建视图<br> 语法：<br> create view 视图名<br> as<br> select 列名 from 表1，表2<br> where 表1.id =表2.id order by 条件<br> 例子：<br> 创建一个视图：获取学员的姓名、性别、年龄、笔试成绩、机试成绩、并且按笔试成绩降序排序<br> if exists(select*from sys.views<br> where name=‘VW_Stu’)<br> drop view VW_Stu --有相同视图则删除原视图<br> go<br> create view VW_Stu<br> as<br> select top 100 stuName,Sex,Age,WriteExam,LadExam<br> from StuInfo si,Exam e<br> where si.StuId=e.StuId<br> order by WriteExam Desc<br> go<br> –视图的使用<br> select *from VW_Stu</p> 
<p>–事务<br> 事务的ACID属性<br> 1、原子性<br> 一个事务对数据库的所有操作，是一个不可分割的工作单元。这些操作要么全部执行，要么什么也不做。保证原子性是数据库系统本身的职责，由DBMS的事务管理子系统来实现。</p> 
<p>2、一致性<br> 一个事务独立执行的结果应保持数据库的一致性，即数据不会因为事务的执行而遭受破坏。确保单个事务的一致性是编写事务的应用程序员的职责。在系统运行时，由DBMS的完整性子系统执行任务。</p> 
<p>3、隔离性<br> 在多个事务并发执行时，系统应保证这些事务先后单独执行时的结果一样，此时称事务达到了隔离性的要求，也就是在多个并发事务执行时，保证执行结果是正确的，如同单用户环境一样。隔离性是由DBMS的并发控制子系统实现的。<br> 4、持久性</p> 
<p>语法：<br> –开启事务<br> begin transaction<br> declare @error int --定义变量，记录错误<br> set @error=0 --默认无错<br> Update bank set Blance=Blance+5000 where Bname=‘join’<br> set @error=@errror+@@ERROR<br> Update bank set Blance=Blance-5000 where Bname=‘jack’<br> set @error=@errror+@@ERROR<br> if(@error&lt;&gt;0) --如果错误号不为零，说明有操作出错<br> begin<br> raiserror(‘转账过程出错’,10,1)<br> rollback --回滚全部操作<br> end</p> 
<p>else<br> begin<br> print ‘恭喜你，转账成功！’<br> commit --提交所有操作<br> end</p> 
<p>实例：<br> –转账事务，转账900<br> begin tran<br> declare @err int=0 --声明一个变量，初值为0<br> update Bank set Cmoney=Cmoney-900 where Cname=‘张三’<br> set @err=@err+@@ERROR<br> update Bank set Cmoney=Cmoney+900 where Cname=‘李四’<br> set @err=@err+@@ERROR<br> if @err&gt;0 --条件<br> begin<br> print’交易失败，事务回滚！’<br> rollback<br> end<br> else<br> begin<br> print’交易成功，事务提交’<br> commit tran<br> end</p> 
<p>(8)存储过程<br> –执行dos命令的存储过程CMDShell<br> –在d盘根目录下创建一个文件夹<br> execute xp_cmdshell ‘md D:\DB’<br> –查看D盘下的所有信息<br> exec xp_cmdshell ‘dir d:’<br> –查看视图VW_Stu的源代码<br> exec sp_helptext ‘VW_Stu’<br> –查看一个表的索引<br> exec sp_helpindex ‘stuInfo’<br> –查看一个数据库中的存储过程<br> exec sp_stored_procedures<br> –进行数据库的逻辑名称改名（显示名称）<br> exec sp_renamedb BankDBs,BankDB–主文件名是不会变的<br> –查看当前数据库中的表和视图情况<br> exec sp_tables</p> 
<p>–将网格显示改为文本格式显示</p> 
<p>use StuDB<br> –创建一个存储过程<br> –显示机试和笔试的平均成绩，并且显示本次考试的成绩情况<br> –还要显示未通过的学员信息<br> if exists(select*from sys.procedures<br> where name=‘ScoreCountl’)<br> drop procedure ScoreCountl<br> go<br> create procedure ScoreCountl<br> as<br> declare @write decimal,@lab decimal<br> select @write=AVG(writeExam),@lab=AVG(LadExam)<br> from Exam<br> print ‘笔试成绩:’+convert(varchar(20),@write)<br> print ‘机试成绩:’+convert(varchar(20),@lab)<br> if @write&gt;=70 and @lab&gt;=70<br> print’本班考试成绩优秀！’<br> else<br> print’本班考试成绩一般！’</p> 
<p>print’-------------------------------------------------’<br> print’----------参加本次考试没有通过的学员名单-----------’<br> select stuname 姓名,si.StuId 学号,WriteExam 笔试成绩,LadExam 机试成绩<br> from StuInfo si,Exam e<br> where si.StuId=e.StuId and ( WriteExam&lt;60 or LadExam&lt;60)</p> 
<p>go<br> exec ScoreCountl</p> 
<p>–自由调控及格线<br> if exists(select*from sys.procedures<br> where name=‘ScoreCount2’)<br> drop procedure ScoreCount2<br> go<br> create procedure ScoreCount2<br> @w decimal=60,–笔试及格线<br> @l decimal=60 --机试及格线，加了默认值60<br> as<br> declare @write decimal,@lab decimal<br> select @write=AVG(writeExam),@lab=AVG(LadExam)<br> from Exam<br> print ‘笔试成绩:’+convert(varchar(20),@write)<br> print ‘机试成绩:’+convert(varchar(20),@lab)<br> if @write&gt;=70 and @lab&gt;=70<br> print’本班考试成绩优秀！’<br> else<br> print’本班考试成绩一般！’</p> 
<p>print’-------------------------------------------------’<br> print’----------本次笔试及格线：‘+convert(varchar(20),@w)<br> +’----------本次机试及格线：‘+convert(varchar(20),@l)<br> print’----------参加本次考试没有通过的学员名单-----------’<br> select stuname 姓名,si.StuId 学号,WriteExam 笔试成绩,LadExam 机试成绩<br> from StuInfo si,Exam e<br> where si.StuId=e.StuId and ( WriteExam&lt;@w or LadExam&lt;@l)<br> go<br> exec ScoreCount2 @l=40,@w=60 --分别为机试和笔试的及格线<br> exec ScoreCount2 --有默认值的情况下</p> 
<p>use GoodSystem<br> –创建一个存储过程：查询生产日期为某年的<br> –商品名称，类型，生产日期，库存<br> if exists(select*from sys.procedures<br> where name=‘ScoreCount3’)<br> drop procedure ScoreCount3<br> go<br> create procedure ScoreCount3<br> @d decimal<br> as<br> select Name 商品名称,gt.Type 类型,ProductionDate 生产日期,Amount 库存<br> from GoodS gs,GoodType gt<br> where gs.Tid=gt.Tid and year(ProductionDate)=@d<br> –查询2017年的商品信息<br> go<br> exec ScoreCount3 2017</p> 
<p>–创建一个存储过程：查询类型为‘食品’的商品信息<br> if exists(select*from sys.procedures<br> where name=‘ScoreCount4’)<br> drop procedure ScoreCount4<br> go<br> create procedure ScoreCount4<br> @s varchar(20)<br> as<br> select Name 商品名称,gt.Type 类型,ProductionDate 生产日期,Amount 库存<br> from GoodS gs,GoodType gt<br> where gs.Tid=gt.Tid and gt.Type=@s</p> 
<p>go<br> exec ScoreCount4 ‘食品’</p> 
<p>(9)带输出参数的存储过程<br> –创建一个存储过程：添加一个学员成绩信息<br> if OBJECT_ID(‘InsertExam’) is not null<br> drop proc InsertExam<br> go<br> create proc InsertExam<br> @ExamNo int,<br> @stuid varchar(50),<br> @writeExam decimal(10,2),<br> @ladExam decimal(10,2),<br> @n int output<br> as<br> insert Exam(ExamNo,StuId,WriteExam,LadExam)<br> values(@ExamNo,@stuid,@writeExam,@ladExam)<br> select @n=@@ROWCOUNT</p> 
<p>go<br> select*from Exam<br> –调用添加存储过程<br> declare @n int<br> exec InsertExam ‘8’,‘1006’,70,80,@n output<br> if @n&gt;0<br> print’添加成功’<br> else<br> print’添加失败’</p> 
<p>use MySchool<br> select*from Teacher<br> –引用到C#案例MySchool_Proc<br> –添加教员<br> if OBJECT_ID(‘InsertTeacher’) is not null<br> drop proc InsertTeacher<br> go<br> create proc InsertTeacher<br> @LoginId varchar(50),<br> @LoginPwd varchar(50),<br> @TeacherName varchar(50),<br> @Sex varchar(50),<br> @UserStateId int,<br> @Birthday dateTime,<br> @n int output<br> as<br> insert Teacher(LoginId,LoginPwd,TeacherName,Sex,UserStateId,Birthday)<br> values(@LoginId,@LoginPwd,@TeacherName,@Sex,@UserStateId,@Birthday)<br> select @n=@@ROWCOUNT<br> go</p> 
<p>–修改教员<br> if OBJECT_ID(‘UpdateTeacher’) is not null<br> drop proc UpdateTeacher<br> go<br> create proc UpdateTeacher<br> @LoginId varchar(50),<br> @LoginPwd varchar(50),<br> @TeacherName varchar(50),<br> @Sex varchar(50),<br> @UserStateId int,<br> @Birthday dateTime,<br> @n int output<br> as<br> update Teacher set LoginPwd=@LoginPwd, TeacherName=@TeacherName,<br> Sex=@Sex,UserStateId=@UserStateId,Birthday=@Birthday<br> where LoginId=@LoginId<br> select @n=@@ROWCOUNT<br> go<br> –删除教员<br> if OBJECT_ID(‘DeleteTeacher’) is not null<br> drop proc DeleteTeacher<br> go<br> create proc DeleteTeacher<br> @LoginId varchar(50),<br> @n int output<br> as<br> delete from Teacher where LoginId=@LoginId<br> select @n=@@ROWCOUNT<br> –自我理解<br> –添加、修改、删除存储过程都是为了应用到C#程序中可以更快的执行，且占系统运行内存不多。<br> –C#中的调用其实就是一个三层架构</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ad5b4fc9905b088dd7a8f3270126d27c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">树莓派4B监控CPU占用率、内存使用率、磁盘使用量以及CPU温度</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4abc82a98620dfd1aeb5c64912d4d93c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">UIPATH 机器人SAP客户端登录</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>