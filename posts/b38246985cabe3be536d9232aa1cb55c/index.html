<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>嵌入式linux开发环境搭建（Docker版，基于iTop 4412开发板） - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="嵌入式linux开发环境搭建（Docker版，基于iTop 4412开发板）" />
<meta property="og:description" content="嵌入式linux开发环境搭建（Docker版，基于iTop 4412开发板） 文章目录 嵌入式linux开发环境搭建（Docker版，基于iTop 4412开发板）-1. 前言0. 环境1. 需求分析2. 基本服务搭建2.1 获取镜像2.2 创建volume2.3 创建并打开容器2.4 软件源更新2.5 vim安装2.6 net-tools安装2.7 ssh-server搭建2.8 nfs-server搭建2.9 创建服务开启脚本 3. 嵌入式编译环境搭建（基于iTop 4412）3.1 Filezilla拷贝文件3.1 交叉编译工具链3.2 uboot编译3.3 Linux Kernel编译 4. 常用docker操作4.1 启动docker容器4.2 进入docker容器4.3 退出docker容器4.4 停止docker容器4.5 重启docker容器 -1. 前言 为啥要用docker？
据说docker挺火，尝试一下“新”技术（好多年了…）相对于VMware虚拟机，docker容器占用空间少，启动/关闭速度特别快，一秒搞定。闲的… docker的安装步骤就不介绍了，可以去官网查查。
0. 环境 宿主机：win10专业版，64位宿主机IP地址：192.168.100.186docker：19.03.8docker image：ubuntu 18.04 1. 需求分析 基于ubuntussh支持，端口22（默认）nfs支持，端口2049（默认），9999（9999端口需要配置进行强行指定）vimnet-tools交叉编译工具链、源码 2. 基本服务搭建 2.1 获取镜像 docker pull ubuntu:18.04 2.2 创建volume docker volume create dataVolume 2.3 创建并打开容器 //创建容器 docker run -itd --name u1804 --privileged=true -p 9022:22 -p 9049:2049 -p 9999:9999 -v dataVolume:/work ubuntu:18." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/b38246985cabe3be536d9232aa1cb55c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-07-14T19:09:46+08:00" />
<meta property="article:modified_time" content="2020-07-14T19:09:46+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">嵌入式linux开发环境搭建（Docker版，基于iTop 4412开发板）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="linuxDockeriTop_4412_0"></a>嵌入式linux开发环境搭建（Docker版，基于iTop 4412开发板）</h2> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#linuxDockeriTop_4412_0" rel="nofollow">嵌入式linux开发环境搭建（Docker版，基于iTop 4412开发板）</a></li><li><ul><li><a href="#1__4" rel="nofollow">-1. 前言</a></li><li><a href="#0__14" rel="nofollow">0. 环境</a></li><li><a href="#1__21" rel="nofollow">1. 需求分析</a></li><li><a href="#2__30" rel="nofollow">2. 基本服务搭建</a></li><li><ul><li><a href="#21__32" rel="nofollow">2.1 获取镜像</a></li><li><a href="#22_volume_38" rel="nofollow">2.2 创建volume</a></li><li><a href="#23__44" rel="nofollow">2.3 创建并打开容器</a></li><li><a href="#24__59" rel="nofollow">2.4 软件源更新</a></li><li><a href="#25_vim_67" rel="nofollow">2.5 vim安装</a></li><li><a href="#26_nettools_74" rel="nofollow">2.6 net-tools安装</a></li><li><a href="#27_sshserver_81" rel="nofollow">2.7 ssh-server搭建</a></li><li><a href="#28_nfsserver_114" rel="nofollow">2.8 nfs-server搭建</a></li><li><a href="#29__147" rel="nofollow">2.9 创建服务开启脚本</a></li></ul> 
   </li><li><a href="#3_iTop_4412_164" rel="nofollow">3. 嵌入式编译环境搭建（基于iTop 4412）</a></li><li><ul><li><a href="#31_Filezilla_166" rel="nofollow">3.1 Filezilla拷贝文件</a></li><li><a href="#31__194" rel="nofollow">3.1 交叉编译工具链</a></li><li><a href="#32_uboot_219" rel="nofollow">3.2 uboot编译</a></li><li><a href="#33_Linux_Kernel_233" rel="nofollow">3.3 Linux Kernel编译</a></li></ul> 
   </li><li><a href="#4_docker_243" rel="nofollow">4. 常用docker操作</a></li><li><ul><li><a href="#41_docker_245" rel="nofollow">4.1 启动docker容器</a></li><li><a href="#42_docker_251" rel="nofollow">4.2 进入docker容器</a></li><li><a href="#43_docker_257" rel="nofollow">4.3 退出docker容器</a></li><li><a href="#44_docker_264" rel="nofollow">4.4 停止docker容器</a></li><li><a href="#45_docker_270" rel="nofollow">4.5 重启docker容器</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="1__4"></a>-1. 前言</h3> 
<p>为啥要用docker？</p> 
<ul><li>据说docker挺火，尝试一下“新”技术（好多年了…）</li><li>相对于VMware虚拟机，docker容器占用空间少，启动/关闭速度特别快，一秒搞定。</li><li>闲的…</li></ul> 
<p>docker的安装步骤就不介绍了，可以去官网查查。</p> 
<h3><a id="0__14"></a>0. 环境</h3> 
<ul><li>宿主机：win10专业版，64位</li><li>宿主机IP地址：192.168.100.186</li><li>docker：19.03.8</li><li>docker image：ubuntu 18.04</li></ul> 
<h3><a id="1__21"></a>1. 需求分析</h3> 
<ul><li>基于ubuntu</li><li>ssh支持，端口22（默认）</li><li>nfs支持，端口2049（默认），9999（9999端口需要配置进行强行指定）</li><li>vim</li><li>net-tools</li><li>交叉编译工具链、源码</li></ul> 
<h3><a id="2__30"></a>2. 基本服务搭建</h3> 
<h4><a id="21__32"></a>2.1 获取镜像</h4> 
<pre><code>docker pull ubuntu:18.04
</code></pre> 
<h4><a id="22_volume_38"></a>2.2 创建volume</h4> 
<pre><code>docker volume create dataVolume
</code></pre> 
<h4><a id="23__44"></a>2.3 创建并打开容器</h4> 
<pre><code>//创建容器
docker run -itd --name u1804 --privileged=true -p 9022:22 -p 9049:2049 -p 9999:9999 -v dataVolume:/work ubuntu:18.04

//进入容器
docker exec -it u1804 /bin/bash

</code></pre> 
<blockquote> 
 <p>创建容器时，容器内部的ssh端口22映射到宿主机的9022，nfs端口2049映射到宿主机的9049，mountd端口9999映射到宿主机的9999，因此在使用ssh和nfs服务时，需要注意指定对应端口。</p> 
</blockquote> 
<blockquote> 
 <p>在容器内部，想要退出容器时，可以直接执行<code>exit</code>命令。</p> 
</blockquote> 
<h4><a id="24__59"></a>2.4 软件源更新</h4> 
<pre><code>//该命令在容器内部运行
apt-get update
apt-get upgrade
</code></pre> 
<h4><a id="25_vim_67"></a>2.5 vim安装</h4> 
<pre><code>//该命令在容器内部运行
apt-get install -y vim
</code></pre> 
<h4><a id="26_nettools_74"></a>2.6 net-tools安装</h4> 
<pre><code>//该命令在容器内部运行
apt-get install -y net-tools
</code></pre> 
<h4><a id="27_sshserver_81"></a>2.7 ssh-server搭建</h4> 
<pre><code>//以下命令在容器内部运行

//安装server服务
apt-get install -y openssh-server

//开启服务
/etc/init.d/ssh start

//查看是否正常启动
ps -e | grep ssh
</code></pre> 
<p>编辑<code>/etc/ssh/sshd_config</code>文件，将<code>PermitRootLogin prohibit-password</code>前面的注释符<code>#</code>去掉，并改为<code>PermitRootLogin yes</code>。</p> 
<pre><code>//以下命令在容器内部运行
//重启服务
service ssh restart
</code></pre> 
<pre><code>//以下命令在容器内部运行
//设置ssh密码
passwd root
</code></pre> 
<p>使用<code>secureCRT</code>或其他工具连接<code>192.168.100.186:9022</code>验证ssh功能是否正常。</p> 
<p>注意：<code>192.168.100.186</code>是docker所在的宿主机的IP地址。</p> 
<h4><a id="28_nfsserver_114"></a>2.8 nfs-server搭建</h4> 
<pre><code>//以下命令在容器内部运行
//安装nfs server服务
apt-get install -y nfs-kernel-server
</code></pre> 
<p>修改<code>/etc/exports</code>文件，在文件末尾添加<code>/work *(rw,nohide,insecure,no_subtree_check,async,no_root_squash)</code></p> 
<p>修改<code>/etc/default/nfs-kernel-server</code>文件，将<code>RPCMOUNTDOPTS="--manage-gids"</code>修改为<code>RPCMOUNTDOPTS="--manage-gids --port 9999"</code>。</p> 
<pre><code>//以下命令在容器内部运行
//使配置文件的修改生效
exportfs -r

//启动rpcbind服务
service rpcbind start

//重启nfs服务
service nfs-kernel-server start

</code></pre> 
<p>在客户端使用如下命令挂载验证：</p> 
<pre><code>mount -t nfs -o nolock,vers=3,port=9049,mountport=9999 192.168.100.186:/work /mnt
</code></pre> 
<p>注意：<code>192.168.100.186</code>是docker所在的宿主机的IP地址。</p> 
<h4><a id="29__147"></a>2.9 创建服务开启脚本</h4> 
<p>docker容器在重启之后，ssh和nfs等服务并不会自动开启，为了操作方便，我就写了个脚本。执行<code>vim /bin/start_server</code>创建脚本，并添加如下内容：</p> 
<pre><code>#!/bin/bash

/etc/init.d/ssh restart
service rpcbind restart
service nfs-kernel-server restart
</code></pre> 
<p>为脚本添加可执行属性：<code>chmod +x /bin/start_server</code>。</p> 
<p>以后重启容器后，直接执行<code>start_server</code>即可开启服务。</p> 
<h3><a id="3_iTop_4412_164"></a>3. 嵌入式编译环境搭建（基于iTop 4412）</h3> 
<h4><a id="31_Filezilla_166"></a>3.1 Filezilla拷贝文件</h4> 
<p>iTop 4412需要的文件如下：</p> 
<ul><li><code>arm-2009q3.tar.bz2</code></li><li><code>CodeSign4SecureBoot_POP</code></li><li><code>CodeSign4SecureBoot_SCP</code></li><li><code>iTop4412_uboot_20180320.tar.gz</code></li><li><code>iTop4412_Kernel_3.0_20180604.tar.gz</code></li></ul> 
<p>这里，我们使用Filezilla软件将以上软件拷贝到之前创建的docker容器中。</p> 
<ul><li>打开Filezilla软件后，使用<code>ctrl+s</code>快捷键打开站点管理器。</li></ul> 
<p><img src="https://images2.imgbox.com/1f/71/bPLSSUiA_o.png" alt="在这里插入图片描述"></p> 
<ul><li>点击<code>新站点</code>，主机配置为宿主机IP<code>192.168.100.186</code>，端口配置为<code>9022</code>，协议选择<code>SFTP</code>，登陆类型选择<code>正常</code>，用户名<code>root</code>，输入<code>root</code>账户密码。</li></ul> 
<p><img src="https://images2.imgbox.com/d3/8b/3PnYepQ5_o.png" alt="在这里插入图片描述"></p> 
<ul><li>点击<code>连接</code>，即可连接到之前建立的容器（如果弹出对话框，直接点击<code>确定</code>）</li></ul> 
<p><img src="https://images2.imgbox.com/47/28/2T1VxSU9_o.png" alt="在这里插入图片描述"></p> 
<ul><li>将iTop 4412需要使用的文件全部拷贝到容器的<code>/work/itop</code>目录下。(<code>/work</code>下面没有<code>itop</code>文件夹，需要自己创建一个)</li></ul> 
<p>此时，docker容器中就包含了我们所需要的所有资源，接下来就需要到docker容器下<code>/work/itop/</code>目录进行操作了。</p> 
<h4><a id="31__194"></a>3.1 交叉编译工具链</h4> 
<ul><li>执行<code>tar -xvf arm-2009q3.tar.bz2</code>解压。</li><li>修改<code>/root/.bashrc</code>，在文件的最后添加如下代码：</li></ul> 
<pre><code>export ARCH=arm
export CROSS_COMPILE=arm-none-linux-gnueabi-
export PATH=$PATH:/work/itop/arm-2009q3/bin
</code></pre> 
<ul><li>执行<code>source /root/.bashrc</code>命令使配置生效。</li><li>分别执行<code>echo $ARCH</code>, <code>echo $CROSS_COMPILE</code>, <code>echo $PATH</code>验证配置是否正确。正常执行结果如下：</li></ul> 
<p><img src="https://images2.imgbox.com/97/9c/bIkWbnV8_o.png" alt="在这里插入图片描述"></p> 
<p><strong>这个时候，就会遇到一个坑了。</strong> 咱们安装的是64位ubuntu系统，而交叉编译工具链式32位的，所以这个时候执行<code>arm-none-linux-gnueabi-gcc -v</code>总是会出错，就像这样：</p> 
<p><img src="https://images2.imgbox.com/9b/a3/sAMYMFnN_o.png" alt="在这里插入图片描述"></p> 
<p>明明PATH变量啥的都正确，就是提示找不到文件！！！</p> 
<p>解决方案在这：https://blog.csdn.net/bryanwang_3099/article/details/105701328</p> 
<p>按照上面的方案搞定之后，执行<code>arm-none-linux-gnueabi-gcc -v</code>，结果就变成了这样：</p> 
<p><img src="https://images2.imgbox.com/39/97/lA9ZF7Iz_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="32_uboot_219"></a>3.2 uboot编译</h4> 
<ul><li>执行<code>tar -xvf iTop4412_uboot_20180320.tar.gz</code>解压</li><li>切换到uboot源码目录：<code>cd /work/itop/iTop4412_uboot</code></li><li>执行<code>apt-get install -y make</code>安装make工具</li><li>打开<code>Makefile</code>文件，搜索<code>ifeq ($(ARCH),arm)</code>，注释掉紧邻着的<code>CROSS_COMPILE</code>定义语句，改成<code>CROSS_COMPILE = arm-none-linux-gnueabi-</code>，修改后，代码如下：</li></ul> 
<pre><code>ifeq ($(ARCH),arm)
CROSS_COMPILE = arm-none-linux-gnueabi-
endif
</code></pre> 
<ul><li>执行<code>./build_uboot.sh SCP_1GDDR</code>编译uboot</li></ul> 
<h4><a id="33_Linux_Kernel_233"></a>3.3 Linux Kernel编译</h4> 
<ul><li>执行<code>tar -xf iTop4412_Kernel_3.0_20180604.tar.gz</code>解压源码</li><li>切换到源码目录：<code>cd /work/itop/iTop4412_Kernel_3.0</code></li><li>创建配置文件：<code>cp config_for_linux_scp_elite .config</code></li><li>修改Makefile，将<code>CROSS_COMPILE ?= /usr/local/arm/arm-2009q3/bin/arm-none-linux-gnueabi-</code>改为<code>CROSS_COMPILE ?= arm-none-linux-gnueabi-</code></li><li>修改<code>kernel/timeconst.pl</code>文件第373行，将<code>if (!defined(@val)) {<!-- --></code>改为<code>if (!(@val)) {<!-- --></code></li><li>编译内核：<code>make zImage</code></li></ul> 
<h3><a id="4_docker_243"></a>4. 常用docker操作</h3> 
<h4><a id="41_docker_245"></a>4.1 启动docker容器</h4> 
<pre><code>docker start u1804
</code></pre> 
<h4><a id="42_docker_251"></a>4.2 进入docker容器</h4> 
<pre><code>docker exec -it u1804 /bin/bash
</code></pre> 
<h4><a id="43_docker_257"></a>4.3 退出docker容器</h4> 
<pre><code>//在容器内部，执行exit命令
exit
</code></pre> 
<h4><a id="44_docker_264"></a>4.4 停止docker容器</h4> 
<pre><code>docker stop u1804
</code></pre> 
<h4><a id="45_docker_270"></a>4.5 重启docker容器</h4> 
<pre><code>docker restart u1804
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a8cf7ae14f1536b875b5e1e5cb9123e5/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Win 7中excel 2016未响应</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8b463d9f92c45acc9be59f1b71317e58/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">电磁学中一些基础知识3</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>