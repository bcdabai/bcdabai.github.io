<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ZZ： grub管理器介绍 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="ZZ： grub管理器介绍" />
<meta property="og:description" content="什么是启动管理器？ 启动管理器是存储在磁盘开始扇区中的一段程序，例如，硬盘的MBR(Master Boot Record)，在系统完成启动测试后，如果系统是从MBR启动，则BIOS(Basic Input/Output System)将控制传送给MBR。然后存储在MBR中的这段程序将运行。这段程序被称为启动管理器。它的任务就是将控制传送给操作系统，完成启动过程。 有许多可用的启动管理器，包括GNU GRUB (Grand Unified Boot Loader), Bootmanager, LILO (LInux LOader), NTLDR (boot loader for Windows NT systems)，等等。下面我将讨论GNU GRUB以及它的使用方法。 什么是GRUB? GRUB是一款功能强大的启动管理器，它能加载多种操作系统，例如Windows, DOS, Linux, GNU Hurd, *BSD,等等。 目前，LILO是最流行的启动管理器，被用来管理多个系统的引导。但是，如果使用了LILO，你必须记住，当你每次改变了它的配置或安装了新的内核，都要重新运行一下LILO。而且，LILO的灵活性也逊色于GRUB。 GRUB使用灵活。它的最新版本，0.5.96.1,支持的文件系统包括ext2(Linux使用的一种文件系统)，FFS(Fast File System used by *BSD UNIX)，ReiserFS(一种为Linux开发的新型日志文件系统，以被融入2.4.1内核中，minix(一种为MINIX系统开发的老式文件系统，在早期的Linux中也使用)。使用GRUB，你甚至不用引导操作系统，就能“看”到这些文件系统。例如，假如你想查看一下存放在文本文件中的日期和时间，而又不想引导整个操作系统，你可以使用GRUB shell（提示“grub&gt;”），键入如下命令： grub&gt; cat (partition number)/home/god/2003106110531.htm.txt. 你可以看到与文件有关的所有信息，包括日期和时间。 GRUB最好的应用是，你可以方便的引导不在列表中的任何分区上的任何内核。例如，如果你没有将新编译的内核加在启动列表中，而你又需要引导它，你可以将它先加在列表中，重新启动后使用。但是使用GRUB后，可以简单到只使用GRUB shell就可以加载所需要的内核映象。 现在我将解释使用GRUB的三个基本步骤：编译、安装和配置。 第一步：编译和安装GRUB 可以从ftp://alpha.gnu.org/pub/gnu/grub 下载GRUB的源代码。 可以用命令“tar -xvzf 2003106110531.htm.tar.gz”解开压缩文档。我得到的文件是grub-0.5.96.1.tar.gz，所以我这样做： # tar -xvzf grub-0.5.96.1.tar.gz 这个命令将解开的文件和目录放在一个名为grub-0.5.96.1的目录中。现在运行如下命令： [root@heaven ~/grub-0.5.96.1 ]# ./configure 如果你想定制GRUB，使之包含流行的文件系统和对网卡的支持，或者删除你不需要的网卡，可以运行如下命令： [root@heaven ~/grub-0.5.96.1 ]# ./configure --help 这个命令将输出所有的命令选项。现在可以使用―enable和―disable选项增加或删除对特定网卡的支持。（注意：GRUB支持网络启动） 为了开始编译过程，键入如下命令： [root@heaven ~/grub-0." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/6b1eb678b58d9fa7ad65b6b9d822a5bf/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2005-03-21T08:12:00+08:00" />
<meta property="article:modified_time" content="2005-03-21T08:12:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ZZ： grub管理器介绍</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    什么是启动管理器？ 
<br>    启动管理器是存储在磁盘开始扇区中的一段程序，例如，硬盘的MBR(Master Boot Record)，在系统完成启动测试后，如果系统是从MBR启动，则BIOS(Basic Input/Output System)将控制传送给MBR。然后存储在MBR中的这段程序将运行。这段程序被称为启动管理器。它的任务就是将控制传送给操作系统，完成启动过程。 
<br>有许多可用的启动管理器，包括GNU GRUB (Grand Unified Boot Loader), Bootmanager, LILO (LInux LOader), NTLDR (boot loader for Windows NT systems)，等等。下面我将讨论GNU GRUB以及它的使用方法。 
<br>  
<br>什么是GRUB? 
<br>    GRUB是一款功能强大的启动管理器，它能加载多种操作系统，例如Windows, DOS, Linux, GNU Hurd, *BSD,等等。 
<br>    目前，LILO是最流行的启动管理器，被用来管理多个系统的引导。但是，如果使用了LILO，你必须记住，当你每次改变了它的配置或安装了新的内核，都要重新运行一下LILO。而且，LILO的灵活性也逊色于GRUB。 
<br>    GRUB使用灵活。它的最新版本，0.5.96.1,支持的文件系统包括ext2(Linux使用的一种文件系统)，FFS(Fast File System used by *BSD UNIX)，ReiserFS(一种为Linux开发的新型日志文件系统，以被融入2.4.1内核中，minix(一种为MINIX系统开发的老式文件系统，在早期的Linux中也使用)。使用GRUB，你甚至不用引导操作系统，就能“看”到这些文件系统。例如，假如你想查看一下存放在文本文件中的日期和时间，而又不想引导整个操作系统，你可以使用GRUB shell（提示“grub&gt;”），键入如下命令： 
<br>  
<br>grub&gt; cat (partition number)/home/god/2003106110531.htm.txt.   
<br>  
<br>    你可以看到与文件有关的所有信息，包括日期和时间。 
<br>    GRUB最好的应用是，你可以方便的引导不在列表中的任何分区上的任何内核。例如，如果你没有将新编译的内核加在启动列表中，而你又需要引导它，你可以将它先加在列表中，重新启动后使用。但是使用GRUB后，可以简单到只使用GRUB shell就可以加载所需要的内核映象。 
<br>    现在我将解释使用GRUB的三个基本步骤：编译、安装和配置。 
<br>  
<br>第一步：编译和安装GRUB 
<br>    可以从ftp://alpha.gnu.org/pub/gnu/grub 下载GRUB的源代码。 
<br>    可以用命令“tar -xvzf 2003106110531.htm.tar.gz”解开压缩文档。我得到的文件是grub-0.5.96.1.tar.gz，所以我这样做： 
<br>  
<br># tar -xvzf grub-0.5.96.1.tar.gz 
<br>  
<br>    这个命令将解开的文件和目录放在一个名为grub-0.5.96.1的目录中。现在运行如下命令： 
<br>  
<br>[root@heaven ~/grub-0.5.96.1 ]# ./configure 
<br>  
<br>    如果你想定制GRUB，使之包含流行的文件系统和对网卡的支持，或者删除你不需要的网卡，可以运行如下命令： 
<br>  
<br>[root@heaven ~/grub-0.5.96.1 ]# ./configure --help 
<br>  
<br>    这个命令将输出所有的命令选项。现在可以使用―enable和―disable选项增加或删除对特定网卡的支持。（注意：GRUB支持网络启动） 
<br>    为了开始编译过程，键入如下命令： 
<br>  
<br>[root@heaven ~/grub-0.5.96.1 ]# make 
<br>  
<br>    为了将所有文件进行正确的安装，键入命令： 
<br>  
<br>[root@heaven ~/grub-0.5.96.1 ]# make install 
<br>  
<br>    至此你已经为安装GRUB真正做好了准备。 
<br>    将GRUB的相关文件保存在诸如/boot/grub的目录中不失为一个好主意。为此，按如下步骤： 
<br>    1．默认状态下，GRUB所有文件将安装在/usr/share/grub/i386-pc或者/usr/local/share/grub/i386-pc目录下，这只取决于你的shell变量的设置。 
<br>    2．建立一个叫做/boot/grub的目录，然后拷贝下列文件到这个目录： 
<br>stage1 
<br>stage2 
<br>*_stage1_5 
<br>  
<br>    稍候我将解释这些文件。同时也要把GRUB(可能在/usr/sbin或者/usr/local/sbin目录下)拷贝到/boot/grub目录下。 
<br>    安装GRUB之前，你需要了解GRUB是怎样识别你的硬盘和分区信息的。首先，计数是从0开始的，而不是从1。在Linux中，你的连接到主控制器上的第一块硬盘被称为“had”。在GRUB中即为“hd0”。同样的，在GRUB中，你的第一个软驱是“fd0”。这样，第一块硬盘上的第一、二、三个分区分别为“hd0,0”、“hd0,1”、“hd0,2”。注意：逗号是GRUB分区命名法的必要组成部分。 
<br>    为了将逗号隔开的部分整合在一起，需要使用括号。例如：(hd0,0) (hd0,1) (hd0,2)等等。(hd0,0)是第一块硬盘上的第一个分区。类似的，(hd1,5)是第二快硬盘上的第六个分区，(hd2,0)是第三块硬盘上的第一个分区。 
<br>message. This may take a long time.   
<br>  
<br>第二步：安装GRUB 
<br>    安装GRUB可以分为三个单独的步骤： 
<br>    1．将“stage1”安装到MBR中。 
<br>    2．设置“stage2”的地址或者位置。 
<br>    3．设置一个菜单或选项，用来决定启动哪一个操作系统。 
<br>    使用下面的命令开始安装GRUB。 
<br>  
<br>[root@heaven /boot/grub ]# ./grub 
<br>  
<br>    这个命令根据BIOS的设置检测硬件设备，同时产生一些输出信息。这会花较长的时间。 
<br>    end_request: I/O error, dev 02:00 (floppy), sector 0 
<br>    GRUB version 0.5.96.1 (640K lower / 3072K upper memory) 
<br>    注意：虽然它让人感到非常惊奇，GRUB确实有简洁的界面―就象支持行编辑一样。TAB列出可能的命令列表。其它情况下TAB会列出设备或文件名。看到这些你会很惊奇吧。类似下面的提示会出现： 
<br>  
<br>grub&gt;   
<br>  
<br>sorry for forgetting where I got it, if you know, tell me, thanks 
<br>  
<br> 现在，我假设你将Linux安装在了第一块硬盘的第一个扩展分区中或者/dev/hda5中。记住GRUB的命名规则，将上面的名字改为(hd0,4)。键入下面的命令： 
<br>grub&gt; install (hd0,4)/boot/grub/stage1 (hd0) (hd0,4)/boot/grub/stage2 p (hd0,4)/boot/grub/menu.conf 
<br>    现在让我们分析一下这个命令的细节。 
<br>  
<br>    install 
<br>    一个内置的命令，它告诉GRUB将(hd0,4)/boot/grub/grub/stage1安装到hd0的主引导纪录中。 
<br>    (hd0,4)/boot/grub/stage2   
<br>    告诉GRUB stage2映象的位置。 
<br>    p with the the following options: (hd0,4)/boot/grub/menu.conf   
<br>    为菜单的显示设置配置文件。稍候我将讨论这个配置文件的结构。 
<br>    下面是对这个命令用法的总结： 
<br>    1．install   
<br>    2．source_of_stage1   
<br>    3．where_to_install   
<br>    4．source_of_stage2   
<br>    5．p source_of_configuration_file 
<br>    现在，你完成了硬盘上的基本安装工作。 
<br>  
<br>在软盘上的安装： 
<br>    为了在软盘上安装GRUB，你要会用“dd”命令，并且了解它是如何工作的。为了做一张GRUB启动盘，你要将stage1和stage2文件放到软盘的开始扇区中。 
<br>      
<br>    安装stage1到软盘上： 
<br>    插入一张已格式化的软盘，键入命令： 
<br>[root@heaven /boot/grub ]# dd if=stage1 of=/dev/fd0 bs=512 count=1 
<br>    命令的详细说明如下： 
<br>if=input file 
<br>i.e., stage1   
<br>of=output file   
<br>i.e., floppy drive (this may be different on your computer)   
<br>bs=bytes to read and write   
<br>Here it is 512 bytes.   
<br>count=how many times to perform this operation   
<br>    每次拷贝“bs”数目的块到目标地址。 
<br>    安装stage2到软盘 
<br>  
<br>[root@heaven /boot/grub ]# dd if=stage2 of=/dev/fd0 bs=512 seek=1 
<br>  
<br>    这里的步骤同stage1的相同，除了一个seek选项外。Seek选项将调过一个“bs”。例如，在上面的命令中bs的值是512,这样seek=1意味着将跳过软盘上前512个字节，从513字节开始。这将使得第一步操作不会覆盖stage1的前512字节。 
<br>现在你完成了基本的软盘驱动器安装。 
<br>  
<br>第三步：配置GRUB 
<br>    在这一节，我们来看一下如何在启动后进入各种操作系统，如何建立menu.conf文件。 
<br>    我们就从GRUB支持的启动过程开始。可以有两种方法来完成启动过程： 
<br>    ・A.通过调用内核本地启动 
<br>    ・B.连续启动或者将控制转给另一个引导器 
<br>      
<br>    A模式启动过程 
<br>    1．置跟设备或者告诉GRUB你的根文件系统。 
<br>    2．诉GRUB你的内核影像的位置，然后将参数传送给内核。 
<br>    3．重新启动，试一下。 
<br>    为了启动Linux，我将内核以bzImage的文件名放在/boot/目录中，跟文件系统是/dev/hda5，或者GRUB中的(hd0,4)。我的启动过程如下： 
<br>    1.root (hd0,4) [This sets the root partition]   
<br>    2.kernel /boot/bzImage root=/dev/hda5 [This sets the kernel]   
<br>  
<br>    B模式启动过程（这种模式假设当前的分区中安装了另一个启动管理器，例如LILO或者NTLDR）： 
<br>    1．设置根分区但不要安装它 
<br>    2．激活这个分区 
<br>    3．配置需要启动的分区的第一个扇区 
<br>    4．重新启动，看一下效果。 
<br>    我们在试试启动安装在/dev/hda1或者(hd0，0)的widows。启动windows的过程如下: 
<br>    1.rootnoverify (hd0,0)   
<br>    2.makeactive   
<br>    3.chainloader +1 [+1 sets the first sector of the current root partition]   
<br>    4.boot [transfers the control and quits GRUB]   
<br>    menu.conf文件：它用于建立启动多操作系统时的菜单。建立menu.conf并不难。它使用简单的英语，就象你在这一节看到的那样。 
<br>    所有的菜单项目都以没有逗号分隔的“title TITLENAME”开头。你可以随意设置TITLENAME。 
<br>    设置Linux启动菜单步骤如下： 
<br>    1．设置标题 
<br>    2．设置根分区 
<br>    3．设置内核的相应参数 
<br>    4．启动 
<br>  
<br>    一个菜单例子： 
<br>title Debian GNU/Linux 2.2 kernel 2.4.1 
<br>root (hd0,4) 
<br>kernel /boot/bzImage.2.4.1 
<br>boot 
<br>#---- 
<br>  
<br>    前面有#的行是一个注释。 
<br>  
<br>    建立启动Windows 或者 DOS的菜单： 
<br>title Windoze   
<br>rootnoverify (hd0,0) 
<br>makeactive 
<br>chainloader +1 
<br>boot 
<br>#---- 
<br>  
<br>    如果你安装了两个版本的Windows―一个是你自己用的，另一个给你的家人用的―这样第二个就无法安装，因为有提示说Windows已经安装了。 
<br>    有一种简单的方法可以安装两个版本的Windows，即在启动时隐藏一个分区而使用另一个。你甚至可以为你的分区设置密码保护，这样可以避免别人错误的加载你的分区。下面介绍如何完成两个Windows的安装，hda1和hda2 或者 (hd0,0) 和 (hd0,1)，用到的命令有lock, password, hide 和 unhide。 
<br>      
<br>    建立windows 项目"My Entry":   
<br>title My Entry 
<br>lock 
<br>unhide (hd0,0) 
<br>hide (hd0,1) 
<br>rootnoverify (hd0,0) 
<br>makeactive 
<br>chainloader +1 
<br>boot 
<br>#---- 
<br>  
<br>    为了更好的使用lock命令，你需要在配置文件开头使用password命令。Password命令的语法如下：password secret(“secret”就是密码)。任何时候你都可以通过按p键儿输入密码。 
<br>  
<br>    建立Windows 项目"Family Entry"   
<br>title Family Entry 
<br>unhide (hd0,1) 
<br>hide (hd0,0) 
<br>rootnoverify (hd0,1) 
<br>makeactive 
<br>chainloader +1 
<br>boot 
<br>---- 
<br>  
<br>    任何人都可以启动这个项目，而无须输入密码。 
<br>    这有一个使用password命令的有趣的窍门。为了在缺省菜单列表或配置文件中隐藏某些项目，你可以使用下面的命令加载一个定制的列表： 
<br>  
<br>password secret 
<br>  
<br>    在这个命令中，“secret”是密码，而/boot/grub/secret-list.conf是密码文件。这样做之前，你要先进入到根目录或者给出全路径名。例如： 
<br>  
<br>password secret (hd0,4)/boot/grub/secret-list.conf 
<br>  
<br>    还有一个更重要的命令是“map”。当你有两块硬盘，一个无法从第二块硬盘启动的操作系统，例如Windows，就可以使用map命令。例如，你能够将hd0映射为hd1，将hd1映射为hd0。换句话说，你可以虚拟的交换两个硬盘而启动所需要的操作系统。命令形式如下： 
<br>grub&gt; map (hd0) (hd1) 
<br>grub&gt; map (hd1) (hd0) 
<br>     
<br>    启动FreeBSD： 
<br>title FreeBSD 4.0 
<br>root (hd0,4,a) 
<br>kernel /boot/loader 
<br>boot 
<br>#----   
<br>  
<br>    这里我们调用了FreeBSD的启动管理器。Root (hd0,4,a)由四个参数，是因为FreeBSD对一个单独分区进行了虚拟分割。我们称根分区为“a”。如果FreeBSD占据了整个第二块硬盘，这里就应该是root (hd0,a)。这样，就不是调用内核而是调用FreeBSD的启动管理器，它要比调用内核更易使用。 
<br>    （注意：我推荐在使用OpenBSD和GNU/Hurd之前，要先试一下链式加载。） 
<br>    现在你已经完成了基本的GRUB编译、安装和配置。你对GRUB了解的越多，就越会发现GRUB是一种控制启动的易用和高效的方法。 
<br>  
<br>各种GRUB命令： 
<br>    default xx   
<br>    表明xx是缺省的启动项目 
<br>    timeout yy   
<br>    表明在yy秒后缺省启动项目将启动 
<br>    fallback zz   
<br>    在第一个启动项目失败后，过了timeout时间后，就将启动zz项目。 
<br>    color   
<br>    这个命令将生成彩色菜单。它的语法是：color normal current_selection。这两个域都可以有两个值，形如foreground/background。例如： 
<br>  
<br>color green/black or light-gray/blue 
<br>  
<br>    你也可以使用相关的数字。 
<br>    记住：所有的值都是从0开始，所以0是第一个。 
<br>    在我的下一篇文章中，我将会讲到对GNU/Hurd and OpenBSD的测试，也许还有一些网络启动的内容。但是你必须要等至少三个月或更多的时间，到是我会谈一下我的测试结果。等着看吧。 
<br>  
<br> 
<br type="_moz">
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/22663496190e3e1065511c76582f31b3/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">make xine play movie with Chinese subtitle</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ba14289e2bb608cc5e816998308fc287/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">ZZ: 从硬盘安装linux</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>