<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【ASP.NET Core 基础知识】--路由和请求处理--Attribute路由 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【ASP.NET Core 基础知识】--路由和请求处理--Attribute路由" />
<meta property="og:description" content="一、介绍 在ASP.NET Core中，路由是将传入的URL请求映射到正确的控制器和操作的方法。Attribute路由是一种基于属性，用于定义路由规则的方式，通过在控制器类和操作方法上应用特定的属性，来定义URL模板。
基本概念：
**路由：**在ASP.NET Core中，路由是将URL请求映射到正确的控制器和操作的过程。路由中间件会按照定义的路由规则，将传入的HTTP请求匹配到正确的路由路径，进而执行对应的控制器和操作方法。**控制器：**控制器是处理HTTP请求的类，其中包含处理请求的操作方法。在ASP.NET Core中，控制器类必须继承自Controller或ControllerBase类。**操作方法：**操作方法是控制器中用于处理HTTP请求的具体实现。通过在控制器类或操作方法上应用特定的属性，可以定义URL模板，从而实现路由匹配。 重要性：
可读性更强：使用属性路由，可以定义更加清晰和易读的路由路径，使得URL更加友好和易于理解。**灵活性更高：**属性路由可以更加灵活地定义路由规则，支持多种路由匹配方式，如默认路由、自定义路由、参数路由等。**可维护性更高：**属性路由的路由规则定义更加集中和清晰，易于维护和管理。同时，由于路由规则定义在控制器类和操作方法上，可以更好地与代码分离，提高代码的可读性和可维护性。**性能更优：**属性路由在路由匹配时，可以利用编译时静态分析，提前解析路由模板，从而提高路由匹配的性能。 二、传统路由和属性路由的比较和选择 传统路由和属性路由（Attribute Routing）是ASP.NET Core中的两种主要路由（Routing）方式。下面是它们的比较和选择：
传统路由（Convention-based Routing）：
传统路由是一种基于约定的路由方式。在传统路由中，我们定义路由规则时，需要指定路由的URL模板以及相应的控制器和操作方法。传统路由是一种静态路由方式，它的路由规则是在应用程序启动时静态定义的。
优点：
简单易用：传统路由的路由规则定义简单明了，易于理解和使用。性能较高：传统路由的路由规则定义是在应用程序启动时静态定义的，因此在路由匹配时具有较高的性能。 缺点：
不够灵活：传统路由的路由规则定义是基于约定的，不够灵活，无法满足一些复杂的路由需求。可读性较差：传统路由的路由规则定义在代码中分散开来，可读性较差。 属性路由（Attribute Routing）：
属性路由是一种基于属性的路由方式。在属性路由中，我们可以在控制器类和操作方法上应用特定的属性来定义路由规则。属性路由是一种动态路由方式，它的路由规则是在运行时动态定义的。
优点：
更加灵活：属性路由的路由规则定义更加灵活，可以满足一些复杂的路由需求。可读性更好：属性路由的路由规则定义在代码中集中起来，可读性更好。可维护性更高：属性路由的路由规则定义更加集中和清晰，易于维护和管理。 缺点：
相对复杂：属性路由的路由规则定义相对复杂，需要一定的学习成本。性能较低：属性路由的路由规则定义是在运行时动态定义的，因此在路由匹配时性能相对较低。 选择：
在选择传统路由和属性路由时，需要根据具体的应用场景和需求来选择。如果应用程序的路由规则比较简单，且性能要求较高，可以选择传统路由；如果应用程序的路由规则比较复杂，且需要更高的可读性和可维护性，可以选择属性路由。同时，在实际开发中，也可以结合使用传统路由和属性路由，以满足不同的路由需求。
三、Attribute路由的基本使用 3.1 在Controller上使用Attribute路由 在ASP.NET Core中，我们可以在控制器类上使用[Route]属性来定义控制器级别的路由规则。以下是一个示例：
[Route(&#34;api/[controller]&#34;)] public class UsersController : Controller { [HttpGet] public IActionResult Get() { return Ok(); } [HttpGet(&#34;{id}&#34;)] public IActionResult Get(int id) { return Ok(); } // ... } 在上面的示例中，我们在UsersController类上使用了[Route(&#34;api/[controller]&#34;)]属性，这表示所有该控制器的操作方法都可以通过“api/users”路径访问。
Tip：这里的[controller]是一个占位符，它会被实际的控制器名称替换。例如，如果你访问api/users路径，[controller]将被替换为Users。
此外，我们还分别在Get和Get(int id)方法上使用了[HttpGet]和[HttpGet(&#34;{id}&#34;)]属性来定义它们的路由。其中，[HttpGet]表示该方法可以通过HTTP GET请求访问，而[HttpGet(&#34;{id}&#34;)]表示该方法可以通过具有id参数的HTTP GET请求访问。
通过这种方式，我们可以方便地定义控制器级别的路由规则，从而更好地组织我们的代码和URL。
3.2 在Action上使用Attribute路由 在ASP." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/ed9c9ac0a219d1cfc7f61ad857810fa8/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-20T18:59:56+08:00" />
<meta property="article:modified_time" content="2024-01-20T18:59:56+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【ASP.NET Core 基础知识】--路由和请求处理--Attribute路由</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h4><a id="_0"></a>一、介绍</h4> 
<p>在ASP.NET Core中，路由是将传入的URL请求映射到正确的控制器和操作的方法。Attribute路由是一种基于属性，用于定义路由规则的方式，通过在控制器类和操作方法上应用特定的属性，来定义URL模板。</p> 
<ol><li> <p><strong>基本概念：</strong></p> 
  <ul><li>**路由：**在ASP.NET Core中，路由是将URL请求映射到正确的控制器和操作的过程。路由中间件会按照定义的路由规则，将传入的HTTP请求匹配到正确的路由路径，进而执行对应的控制器和操作方法。</li><li>**控制器：**控制器是处理HTTP请求的类，其中包含处理请求的操作方法。在ASP.NET Core中，控制器类必须继承自Controller或ControllerBase类。</li><li>**操作方法：**操作方法是控制器中用于处理HTTP请求的具体实现。通过在控制器类或操作方法上应用特定的属性，可以定义URL模板，从而实现路由匹配。</li></ul> </li><li> <p><strong>重要性：</strong></p> 
  <ul><li><strong>可读性更强</strong>：使用属性路由，可以定义更加清晰和易读的路由路径，使得URL更加友好和易于理解。</li><li>**灵活性更高：**属性路由可以更加灵活地定义路由规则，支持多种路由匹配方式，如默认路由、自定义路由、参数路由等。</li><li>**可维护性更高：**属性路由的路由规则定义更加集中和清晰，易于维护和管理。同时，由于路由规则定义在控制器类和操作方法上，可以更好地与代码分离，提高代码的可读性和可维护性。</li><li>**性能更优：**属性路由在路由匹配时，可以利用编译时静态分析，提前解析路由模板，从而提高路由匹配的性能。</li></ul> </li></ol> 
<h4><a id="_14"></a>二、传统路由和属性路由的比较和选择</h4> 
<p>传统路由和属性路由（Attribute Routing）是ASP.NET Core中的两种主要路由（Routing）方式。下面是它们的比较和选择：</p> 
<ol><li> <p><strong>传统路由（Convention-based Routing）：</strong><br> 传统路由是一种基于约定的路由方式。在传统路由中，我们定义路由规则时，需要指定路由的URL模板以及相应的控制器和操作方法。传统路由是一种静态路由方式，它的路由规则是在应用程序启动时静态定义的。</p> 
  <ul><li> <p>优点：</p> 
    <ul><li>简单易用：传统路由的路由规则定义简单明了，易于理解和使用。</li><li>性能较高：传统路由的路由规则定义是在应用程序启动时静态定义的，因此在路由匹配时具有较高的性能。</li></ul> </li><li> <p>缺点：</p> 
    <ul><li>不够灵活：传统路由的路由规则定义是基于约定的，不够灵活，无法满足一些复杂的路由需求。</li><li>可读性较差：传统路由的路由规则定义在代码中分散开来，可读性较差。</li></ul> </li></ul> </li><li> <p><strong>属性路由（Attribute Routing）：</strong><br> 属性路由是一种基于属性的路由方式。在属性路由中，我们可以在控制器类和操作方法上应用特定的属性来定义路由规则。属性路由是一种动态路由方式，它的路由规则是在运行时动态定义的。</p> 
  <ul><li> <p>优点：</p> 
    <ul><li>更加灵活：属性路由的路由规则定义更加灵活，可以满足一些复杂的路由需求。</li><li>可读性更好：属性路由的路由规则定义在代码中集中起来，可读性更好。</li><li>可维护性更高：属性路由的路由规则定义更加集中和清晰，易于维护和管理。</li></ul> </li><li> <p>缺点：</p> 
    <ul><li>相对复杂：属性路由的路由规则定义相对复杂，需要一定的学习成本。</li><li>性能较低：属性路由的路由规则定义是在运行时动态定义的，因此在路由匹配时性能相对较低。</li></ul> </li></ul> </li><li> <p><strong>选择：</strong><br> 在选择传统路由和属性路由时，需要根据具体的应用场景和需求来选择。如果应用程序的路由规则比较简单，且性能要求较高，可以选择传统路由；如果应用程序的路由规则比较复杂，且需要更高的可读性和可维护性，可以选择属性路由。同时，在实际开发中，也可以结合使用传统路由和属性路由，以满足不同的路由需求。</p> </li></ol> 
<h4><a id="Attribute_41"></a>三、Attribute路由的基本使用</h4> 
<h6><a id="31_ControllerAttribute_42"></a>3.1 在Controller上使用Attribute路由</h6> 
<p>在ASP.NET Core中，我们可以在控制器类上使用<code>[Route]</code>属性来定义控制器级别的路由规则。以下是一个示例：</p> 
<pre><code class="prism language-csharp"><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"api/[controller]"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UsersController</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Controller</span></span>
<span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpGet</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">IActionResult</span> <span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token function">Ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpGet</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"{id}"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">IActionResult</span> <span class="token function">Get</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> id<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token function">Ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>在上面的示例中，我们在<code>UsersController</code>类上使用了<code>[Route("api/[controller]")]</code>属性，这表示所有该控制器的操作方法都可以通过“api/users”路径访问。</p> 
<blockquote> 
 <p>Tip：这里的<code>[controller]</code>是一个占位符，它会被实际的控制器名称替换。例如，如果你访问<code>api/users</code>路径，<code>[controller]</code>将被替换为<code>Users</code>。</p> 
</blockquote> 
<p>此外，我们还分别在<code>Get</code>和<code>Get(int id)</code>方法上使用了<code>[HttpGet]</code>和<code>[HttpGet("{id}")]</code>属性来定义它们的路由。其中，<code>[HttpGet]</code>表示该方法可以通过HTTP GET请求访问，而<code>[HttpGet("{id}")]</code>表示该方法可以通过具有<code>id</code>参数的HTTP GET请求访问。</p> 
<p>通过这种方式，我们可以方便地定义控制器级别的路由规则，从而更好地组织我们的代码和URL。</p> 
<h6><a id="32_ActionAttribute_70"></a>3.2 在Action上使用Attribute路由</h6> 
<p>在ASP.NET Core中，我们可以在操作方法上使用<code>[Route]</code>属性来定义操作方法级别的路由规则。以下是一个示例：</p> 
<pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UsersController</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Controller</span></span>
<span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpGet</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"{id:int}"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">IActionResult</span> <span class="token function">GetUser</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> id<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>

    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpPost</span></span><span class="token punctuation">]</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"users/create"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">IActionResult</span> <span class="token function">CreateUser</span><span class="token punctuation">(</span><span class="token class-name">UserViewModel</span> model<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>在上面的示例中，我们在<code>GetUser</code>方法上使用了<code>[HttpGet("{id:int}")]</code>属性，这表示该方法可以通过具有<code>id</code>参数的HTTP GET请求访问，并且<code>id</code>必须是整数类型。而在<code>CreateUser</code>方法上，我们使用了<code>[HttpPost]</code>和<code>[Route("users/create")]</code>属性。这表示该方法可以通过HTTP POST请求访问，并且可以通过“users/create”路径访问。<br> 通过这种方式，我们可以更加精细地定义操作方法级别的路由规则，从而更好地满足我们的需求。注意，操作方法级别的路由规则会覆盖控制器级别的路由规则。如果一个操作方法上定义了路由规则，它将优先于控制器级别的路由规则。</p> 
<h6><a id="33__93"></a>3.3 使用自定义路由</h6> 
<p>在ASP.NET Core中，我们可以使用自定义路由来实现更加灵活的路由规则。以下是一个示例：</p> 
<pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomRouteAttribute</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Attribute</span><span class="token punctuation">,</span> <span class="token class-name">IConfigureRoute</span></span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> RouteName <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> RouteNames <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Template <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">object</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> Constraints <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> Order <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Configure</span><span class="token punctuation">(</span><span class="token class-name">RouteCollection</span> routes<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> routeName<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name"><span class="token keyword">var</span></span> route <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Route</span><span class="token punctuation">(</span>Template<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CustomRouteHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>Constraints <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> constraint <span class="token keyword">in</span> Constraints<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                route<span class="token punctuation">.</span>Constraints<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>constraint<span class="token punctuation">.</span><span class="token function">GetType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Name<span class="token punctuation">,</span> constraint<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>Order <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token class-name"><span class="token keyword">var</span></span> routeList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span>Route<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> name <span class="token keyword">in</span> RouteNames<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token class-name"><span class="token keyword">var</span></span> r <span class="token operator">=</span> routes<span class="token punctuation">.</span><span class="token function">GetRouteData</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">MvcContext</span><span class="token punctuation">(</span>HttpContext<span class="token punctuation">.</span>Current<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">while</span> <span class="token punctuation">(</span>r <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>r<span class="token punctuation">.</span>Route<span class="token punctuation">.</span>RouteName<span class="token punctuation">.</span><span class="token function">Equals</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> StringComparison<span class="token punctuation">.</span>OrdinalIgnoreCase<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">{<!-- --></span>
                        routeList<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>Route<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    r <span class="token operator">=</span> r<span class="token punctuation">.</span>Route<span class="token punctuation">.</span>Parent<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>routeList<span class="token punctuation">.</span>Count <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token class-name"><span class="token keyword">var</span></span> index <span class="token operator">=</span> routeList<span class="token punctuation">.</span><span class="token function">IndexOf</span><span class="token punctuation">(</span>route<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    routeList<span class="token punctuation">.</span><span class="token function">RemoveAt</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    routeList<span class="token punctuation">.</span><span class="token function">Insert</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> route<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span>
            <span class="token punctuation">{<!-- --></span>
                routes<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>route<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">{<!-- --></span>
            routes<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>route<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">CustomRoute</span><span class="token attribute-arguments"><span class="token punctuation">(</span>RouteName <span class="token operator">=</span> <span class="token string">"custom"</span><span class="token punctuation">,</span> Template <span class="token operator">=</span> <span class="token string">"custom/{id}"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomController</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Controller</span></span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token return-type class-name">IActionResult</span> <span class="token function">Index</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token function">View</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>在上面的示例中，我们自定义了一个<code>CustomRouteAttribute</code>属性，并在<code>CustomController</code>上使用它来定义路由规则。该属性的<code>Template</code>属性定义了路由模板，<code>RouteName</code>属性定义了路由名称，还可以定义其他的路由约束和路由顺序等。在<code>Configure</code>方法中，我们通过<code>RouteCollection</code>和<code>RouteName</code>来添加路由规则，并且可以根据需要对路由规则进行排序。<br> 通过这种方式，我们可以更加灵活地定义路由规则，从而更好地满足我们的需求。注意，在使用自定义路由时，需要将<code>UseMvc</code>替换为<code>UseMvcWithDefaultRoute</code>，并且需要在<code>Startup.cs</code>文件的<code>ConfigureServices</code>方法中注册自定义路由。</p> 
<h4><a id="Attribute_165"></a>四、Attribute路由的高级使用</h4> 
<h6><a id="41__166"></a>4.1 路由参数</h6> 
<p>在 ASP.NET Core 中，我们可以使用 Attribute 路由来定义路由参数。这可以让我们更精确地控制路由的生成。<br> 下面是一个基本的例子：</p> 
<pre><code class="prism language-csharp"><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"api/[controller]"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UsersController</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Controller</span></span>
<span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpGet</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"{id:int}"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">IActionResult</span> <span class="token function">GetUser</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> id<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>在这个例子中，<code>[Route("api/[controller]")]</code>是控制器级别的路由，表示所有 UsersController 的操作都会被路由到 “api/users” 路径。<code>[HttpGet("{id:int}")]</code>是操作级别的路由，表示 GetUser 方法可以被通过 GET 请求访问，并且需要一个整数参数 “id”。<br> 你可以使用不同的 HTTP 方法来定义路由，例如：</p> 
<pre><code class="prism language-csharp"><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpGet</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"{id:int}"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token return-type class-name">IActionResult</span> <span class="token function">GetUser</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> id<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpPost</span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token return-type class-name">IActionResult</span> <span class="token function">CreateUser</span><span class="token punctuation">(</span><span class="token class-name">UserModel</span> model<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>在上面的例子中，<code>[HttpPost]</code>表示 CreateUser 方法只能通过 POST 请求访问。<br> 你还可以使用自定义的路由约束来限制路由参数的取值范围，例如：</p> 
<pre><code class="prism language-csharp"><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AttributeUsage</span><span class="token attribute-arguments"><span class="token punctuation">(</span>AttributeTargets<span class="token punctuation">.</span>Method <span class="token operator">|</span> AttributeTargets<span class="token punctuation">.</span>Class<span class="token punctuation">,</span> AllowMultiple <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PositiveIntConstraint</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Attribute</span><span class="token punctuation">,</span> <span class="token class-name">IHttpRouteConstraint</span></span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">Match</span><span class="token punctuation">(</span><span class="token class-name">HttpContext</span> context<span class="token punctuation">,</span> <span class="token class-name">RouteData</span> data<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> parameterName<span class="token punctuation">,</span> <span class="token keyword">out</span> <span class="token class-name">RouteValueDictionary</span> values<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name"><span class="token keyword">var</span></span> <span class="token keyword">value</span> <span class="token operator">=</span> data<span class="token punctuation">.</span>Values<span class="token punctuation">[</span>parameterName<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">value</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">value</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">IsInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> Convert<span class="token punctuation">.</span><span class="token function">ToInt32</span><span class="token punctuation">(</span><span class="token keyword">value</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            values <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">RouteValueDictionary</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token punctuation">{<!-- --></span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UsersController</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Controller</span></span>
<span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpGet</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"{id}"</span><span class="token punctuation">,</span> Name <span class="token operator">=</span> <span class="token string">"GetUserById"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">PositiveIntConstraint</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">IActionResult</span> <span class="token function">GetUser</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> id<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>在上面的例子中，<code>PositiveIntConstraint</code>是一个自定义的路由约束，它限制了路由参数 “id” 必须是一个大于 0 的整数。如果不符合这个条件，路由请求将会失败。</p> 
<h6><a id="42__225"></a>4.2 其他高级功能</h6> 
<p>除了上述的路由参数，Attribute 路由还有其他一些高级功能，包括：</p> 
<ol><li><strong>路由模板</strong>：你可以使用和传统路由一样的模板语法来定义 Attribute 路由。比如，<code>[Route("{controller}/{action}/{id}")]</code>。</li><li><strong>可选参数</strong>：你可以定义可选的路由参数。比如，<code>[Route("products/{id:int?}")]</code>，这里 id 是可选的。</li><li><strong>默认值</strong>：你可以给路由参数设置默认值。比如，<code>[Route("{controller=Home}/{action=Index}/{id=0}")]</code>，这里 controller 的默认值是 Home，action 的默认值是 Index，id 的默认值是 0。</li><li><strong>约束类型</strong>：除了整数，你还可以对其他类型的参数进行约束。比如，<code>[HttpGet("{id:guid}")]</code> 可以约束 id 必须是 GUID 类型。</li><li><strong>自定义约束</strong>：你可以定义自己的约束。比如，你可以定义一个约束来检查一个字符串是否是一个有效的 email 地址。</li><li><strong>嵌套路由</strong>：你可以在一个路由中嵌套另一个路由。比如，<code>[Route("{category}/{product}")]</code>，这里 category 和 product 都是路由参数。</li><li><strong>静态和动态路由</strong>：你可以结合使用静态和动态路由。比如，<code>[Route("/about")]</code> 和 <code>[Route("{id}")]</code> 可以同时存在。</li></ol> 
<h4><a id="_236"></a>五、示例</h4> 
<p>好的，以下是一个综合了前面所有内容的示例：</p> 
<pre><code class="prism language-csharp"><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AttributeUsage</span><span class="token attribute-arguments"><span class="token punctuation">(</span>AttributeTargets<span class="token punctuation">.</span>Method <span class="token operator">|</span> AttributeTargets<span class="token punctuation">.</span>Class<span class="token punctuation">,</span> AllowMultiple <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PositiveIntConstraint</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Attribute</span><span class="token punctuation">,</span> <span class="token class-name">IHttpRouteConstraint</span></span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">Match</span><span class="token punctuation">(</span><span class="token class-name">HttpContext</span> context<span class="token punctuation">,</span> <span class="token class-name">RouteData</span> data<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> parameterName<span class="token punctuation">,</span> <span class="token keyword">out</span> <span class="token class-name">RouteValueDictionary</span> values<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name"><span class="token keyword">var</span></span> <span class="token keyword">value</span> <span class="token operator">=</span> data<span class="token punctuation">.</span>Values<span class="token punctuation">[</span>parameterName<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">value</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">value</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">IsInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> Convert<span class="token punctuation">.</span><span class="token function">ToInt32</span><span class="token punctuation">(</span><span class="token keyword">value</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            values <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">RouteValueDictionary</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token punctuation">{<!-- --></span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UsersController</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Controller</span></span>
<span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpGet</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"{id}"</span><span class="token punctuation">,</span> Name <span class="token operator">=</span> <span class="token string">"GetUserById"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">PositiveIntConstraint</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">IActionResult</span> <span class="token function">GetUser</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> id<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>

    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpGet</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"users/edit/{id:guid}"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">IActionResult</span> <span class="token function">EditUser</span><span class="token punctuation">(</span><span class="token class-name">Guid</span> id<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>

    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpPost</span></span><span class="token punctuation">]</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"users/create"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">IActionResult</span> <span class="token function">CreateUser</span><span class="token punctuation">(</span><span class="token class-name">UserModel</span> model<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>

    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"users/deleted/{id}"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">IActionResult</span> <span class="token function">DeleteUser</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> id<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>

    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"users/restore/{id}"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">IActionResult</span> <span class="token function">RestoreUser</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> id<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>

    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"{*url}"</span><span class="token punctuation">,</span> Name <span class="token operator">=</span> <span class="token string">"PageNotFound"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">IActionResult</span> <span class="token function">PageNotFound</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>在上面的例子中，我们定义了一个 <code>PositiveIntConstraint</code> 约束来限制路由参数必须是一个大于 0 的整数。我们定义了 5 个不同的路由：</p> 
<ul><li><code>GetUser</code> 方法可以通过 <code>/users/123</code> 这样的 URL 访问，其中 123 是一个大于 0 的整数。</li><li><code>EditUser</code> 方法可以通过 <code>/users/edit/456</code> 这样的 URL 访问，其中 456 是一个 GUID 类型的参数。</li><li><code>CreateUser</code> 方法可以通过 <code>/users/create</code> 这样的 URL 访问，不需要任何参数。</li><li><code>DeleteUser</code> 方法可以通过 <code>/users/deleted/789</code> 这样的 URL 访问，其中 789 是一个大于 0 的整数。</li><li><code>RestoreUser</code> 方法可以通过 <code>/users/restore/1000</code> 这样的 URL 访问，其中 1000 是一个大于 0 的整数。</li><li>如果请求的 URL 不符合上面的任何一个路由，那么就会返回 <code>PageNotFound</code> 方法的结果，这个方法会返回一个 404 页面。</li></ul> 
<h4><a id="_303"></a>六、总结</h4> 
<p>Attribute路由是一种强大的路由机制，允许我们在 ASP.NET Core 中灵活地定义路由。通过使用各种属性和约束，我们可以精确控制 URL 的生成和解析。Attribute 路由提供了路由参数、可选参数、默认值、约束类型、自定义约束、嵌套路由、静态和动态路由等高级功能。这使得我们能够构建复杂而强大的 Web 应用程序，同时也提高了代码的可读性和可维护性。通过合理地使用 Attribute 路由，我们可以提升 Web 应用程序的性能和用户体验。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/80db39455663060b9719015e477bc429/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">交叉编译bluez-5.66</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3527985d48fedf234dfb94c1e501c0fd/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">竞赛保研 机器视觉人体跌倒检测系统 - opencv python</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>