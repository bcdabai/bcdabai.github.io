<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>企业微信开发——企业内部自建应用开发（第四篇）---自定义工具栏开发 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="企业微信开发——企业内部自建应用开发（第四篇）---自定义工具栏开发" />
<meta property="og:description" content="一、问题说明：企业微信中私聊微信客户，在聊天输入框上面有一行快捷工具，这边怎么自定义开发？如下图，我们可以点击快捷发送，然后弹出一个页面，页面中有我们需要发送给当前会话的各种资源，点击发送，就可以像图中这样把资源发送出来。
二、下面介绍下具体步骤
2.1 配置应用
在企业微信管理后台添加一个应用，如下图，输入相关名字、地址链接即可添加完成。
2.2 应用创建完成，点击应用，进入应用配置页，将应用配置到快捷聊天栏，如下图。配置到聊天工具栏后，在企业微信已微信客户聊天的窗口中，就会多出来一个快捷方式，点击这个快捷方式，可以进入到我们配置的页面。
2.3 页面发送资源给当前微信客户联系人的自定义开发，有以下几个步骤，代码都在下面：
2.3.1 首先获取页面进入的环境，调用wx.invoke(&#34;getContext&#34;），就是判断下是否是从“与客户聊天的界面”中进入的当前页面，如果时，则页面上附带发送按钮。因为这个页面也是应用的一个页面，从其他入口进入时不需要发送按钮，相当于给你做个判断。
2.3.2 完成上述操作后，可以调用wx.invoke(&#34;getCurExternalContact&#34;）接口获得外部联系人的userid，这边主要是为了记录给那些客户发送了什么资源消息，如果项目中无这种要求就不需要。
2.3.3然后配置wx.agentConfig ，具体的配置方法在上篇文章中已经说明了，不清楚的可以参考上面的文字，或者私信问我，微信：1057359832。这边给出前端代码：
2.3.4 最后就可以把项目发布到测试环境，点击聊天的快捷栏目，就可以实现打开页面，发送相关资源。
用的是vue脚手架:
created() { //初始化时先进行配置 this.initQyConfig(); }, methods: { initQyConfig() { let that = this; var postData = { url: window.location.href, }; xapi.ajax({ url: &#34;/api/WxComHandle/Common/AccessAgentConfigBaseMessage&#34;, type: &#34;POST&#34;, contentType: &#34;application/json&#34;, data: postData, success: function (data, status, xhr) { that.configQy(data.Data); }, error: function (XMLHttpRequest, textStatus, errorThrown) { xapi.alert( &#34;错误:&#34; &#43; textStatus &#43; &#34;:&#34; &#43; errorThrown &#43; &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/cea013c170f609bfe7b8c847c9c0d860/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-08T20:00:16+08:00" />
<meta property="article:modified_time" content="2023-11-08T20:00:16+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">企业微信开发——企业内部自建应用开发（第四篇）---自定义工具栏开发</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div> 
 <p>一、问题说明：企业微信中私聊微信客户，在聊天输入框上面有一行快捷工具，这边怎么自定义开发？如下图，我们可以点击快捷发送，然后弹出一个页面，页面中有我们需要发送给当前会话的各种资源，点击发送，就可以像图中这样把资源发送出来。</p> 
 <div> 
  <div> 
   <div> 
    <img alt="579369c4dc095b363f6b26fc336f3d8f.png" src="https://images2.imgbox.com/0b/4f/5RRlX9kh_o.png"> 
   </div> 
  </div> 
 </div> 
 <p>二、下面介绍下具体步骤</p> 
 <p>2.1 配置应用</p> 
 <p>在企业微信管理后台添加一个应用，如下图，输入相关名字、地址链接即可添加完成。</p> 
 <div> 
  <div> 
   <div> 
    <img alt="cf21cd47abfca5f9ce71783d075910cb.png" src="https://images2.imgbox.com/08/fc/pDYBVTk8_o.png"> 
   </div> 
  </div> 
 </div> 
 <p>2.2 应用创建完成，点击应用，进入应用配置页，将应用配置到快捷聊天栏，如下图。配置到聊天工具栏后，在企业微信已微信客户聊天的窗口中，就会多出来一个快捷方式，点击这个快捷方式，可以进入到我们配置的页面。</p> 
 <div> 
  <div> 
   <div> 
    <img alt="d7415c3d7be344c472481b721e8e2dd8.png" src="https://images2.imgbox.com/50/6b/EIiWYPYj_o.png"> 
   </div> 
  </div> 
 </div> 
 <div> 
  <div> 
   <div> 
    <img alt="87b24f434414ea638c519523578d8756.png" src="https://images2.imgbox.com/5b/e0/Hm6Fq6ab_o.png"> 
   </div> 
  </div> 
 </div> 
 <p>2.3 页面发送资源给当前微信客户联系人的自定义开发，有以下几个步骤，代码都在下面：</p> 
 <p>2.3.1 首先获取页面进入的环境，调用wx.invoke("getContext"），就是判断下是否是从“与客户聊天的界面”中进入的当前页面，如果时，则页面上附带发送按钮。因为这个页面也是应用的一个页面，从其他入口进入时不需要发送按钮，相当于给你做个判断。</p> 
 <p>2.3.2 完成上述操作后，可以调用wx.invoke("getCurExternalContact"）接口获得外部联系人的userid，这边主要是为了记录给那些客户发送了什么资源消息，如果项目中无这种要求就不需要。</p> 
 <p>2.3.3然后配置wx.agentConfig ，具体的配置方法在上篇文章中已经说明了，不清楚的可以参考上面的文字，或者私信问我，微信：1057359832。这边给出前端代码：</p> 
 <p>2.3.4 最后就可以把项目发布到测试环境，点击聊天的快捷栏目，就可以实现打开页面，发送相关资源。</p> 
 <p>用的是vue脚手架:</p> 
 <pre><code class="language-javascript">
<code class="language-javascript">  created() {
    //初始化时先进行配置
    this.initQyConfig();
  },
  methods: {
     initQyConfig() {
      let that = this;
      var postData = {
        url: window.location.href,
      };
      xapi.ajax({
        url: "/api/WxComHandle/Common/AccessAgentConfigBaseMessage",
        type: "POST",
        contentType: "application/json",
        data: postData,
        success: function (data, status, xhr) {
          that.configQy(data.Data);
        },
        error: function (XMLHttpRequest, textStatus, errorThrown) {
          xapi.alert(
            "错误:" +
              textStatus +
              ":" +
              errorThrown +
              ":" +
              XMLHttpRequest.status
          );
        },
        complete: function (xhr, status) {
          $.hideLoading();
        },
      });
    },
    configQy(data) {
      var that = this;
      wx.agentConfig({
        corpid: data.corpid, // 必填，企业微信的corpid，必须与当前登录的企业一致
        agentid: data.agentid, // 必填，企业微信的应用id （e.g. 1000247）
        timestamp: data.timestamp, // 必填，生成签名的时间戳
        nonceStr: data.nonceStr, // 必填，生成签名的随机串
        signature: data.signature, // 必填，签名，见附录-JS-SDK使用权限签名算法
        jsApiList: ["getContext", "getCurExternalContact", "sendChatMessage"], //必填，传入需要使用的接口名称
        success: function (res) {
          console.log("configQy调用成功");
          console.log(JSON.stringify(res));
          wx.invoke("getContext", {}, function (res) {
            if (res.err_msg == "getContext:ok") {
              var entry = res.entry; //返回进入H5页面的入口类型，目前有normal、contact_profile、single_chat_tools、group_chat_tools、chat_attachment
              that.shareTicket = res.shareTicket; //可用于调用getShareInfo接口
              if (entry == "single_chat_tools" || entry == "group_chat_tools") {
                wx.invoke("getCurExternalContact", {}, function (res) {
                  if (res.err_msg == "getCurExternalContact:ok") {
                    var userId = res.userId; //返回当前外部联系人userId
                  } else {
                    //错误处理
                  }
                });
              }
            } else {
              //错误处理
            }
          });
        },
        fail: function (res) {
          if (res.errMsg.indexOf("function not exist") &gt; -1) {
            alert("版本过低请升级");
          }
        },
      });
    },
   //此处为测试demo
    sentTest() {
      wx.invoke(
        "sendChatMessage",
        {
          msgtype: "news", //消息类型，必填
          enterChat: true, //为true时表示发送完成之后顺便进入会话，仅移动端3.1.10及以上版本支持该字段
          news: {
            link: "https://www.xxxxx.com/TestApi/dist/index.html#/poster?type=poster&amp;wxid=5442&amp;id=102&amp;wxwork_userid=qy0141041114bf99042a5b***71", //H5消息页面url 必填
            title: "测试快捷转发", //H5消息标题
            desc: "测试快捷转发", //H5消息摘要
            imgUrl: "", //H5消息封面图片URL
          },
        },
        function (res) {
          if (res.err_msg == "sendChatMessage:ok") {
            //发送成功
          }
        }
      );
    },
}
  </code></code></pre> 
 <p>三、写在最后：腾讯的文档真的是晦涩难懂，全是文字，图片说明都没有。</p> 
 <p></p> 
</div> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/dd138607f7b05ba6e082023a1a1f8391/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【AI编程】ai编程插件汇总iFlyCode、codegeex</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8fc5140becd32c1412af8fc533c22059/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">企业微信开发——企业内部自建应用开发（第二篇）---JS_SDK配置</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>