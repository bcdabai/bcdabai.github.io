<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Centos7.6&#43;Hadoop 3.1.2(HA)&#43;Zookeeper3.4.13&#43;Hbase1.4.9(HA)&#43;Hive2.3.4&#43;Spark2.4.0(HA)高可用集群搭建 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Centos7.6&#43;Hadoop 3.1.2(HA)&#43;Zookeeper3.4.13&#43;Hbase1.4.9(HA)&#43;Hive2.3.4&#43;Spark2.4.0(HA)高可用集群搭建" />
<meta property="og:description" content="本文转自https://mshk.top/2019/03/centos-hadoop-zookeeper-hbase-hive-spark-high-availability/，因为原链接打不开，故在此做一个记录。
1、前言
1.1、什么是 Hadoop?
1.1.1、什么是 YARN?
1.2、什么是 Zookeeper?
1.3、什么是 Hbase?
1.4、什么是 Hive
1.5、什么是 Spark?
2、环境准备
2.1、网络配置
2.2、更改 HOSTNAME
2.3、配置 SSH 免密码登录登录
2.4、关闭防火墙
2.7、安装 NTP
3. 下载应用程序及配置环境变量
3.1、创建安装目录
3.2、下载本文中用到的程序
3.3、设置环境变量
4. 安装 Oracle JDK 1.8.0
4.1 下载 Oracle JDK 1.8.0
4.2、配置 Oracle JDK 1.8.0
5、安装 Zookeeper3.4.13
5.1、修改配置文件 zoo.cfg
5.2、为每台服务器创建身份标识
5.3、在所有节点中启动 zookeeper
5.4、查看zookeeper 运行状态
5.5、测试 Zookeeper 是否启动成功
6、安装 Hadoop3.1.2
6.1、修改 Hadoop 配置文件
6.1.1、修改配置文件 core-site.xml
6.1.2、修改配置文件 hdfs-site.xml
6.1.3、修改配置文件 mapred-site.xml
6.1.4、修改配置文件 capacity-scheduler.xml
6.1.5、修改配置文件 yarn-site." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/e96d1db75fbf2cdf7f697dc6cc6987ea/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-10-11T11:12:43+08:00" />
<meta property="article:modified_time" content="2019-10-11T11:12:43+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Centos7.6&#43;Hadoop 3.1.2(HA)&#43;Zookeeper3.4.13&#43;Hbase1.4.9(HA)&#43;Hive2.3.4&#43;Spark2.4.0(HA)高可用集群搭建</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>本文转自https://mshk.top/2019/03/centos-hadoop-zookeeper-hbase-hive-spark-high-availability/，因为原链接打不开，故在此做一个记录。</p> 
<p>1、前言<br> 1.1、什么是 Hadoop?<br> 1.1.1、什么是 YARN?<br> 1.2、什么是 Zookeeper?<br> 1.3、什么是 Hbase?<br> 1.4、什么是 Hive<br> 1.5、什么是 Spark?<br> 2、环境准备<br> 2.1、网络配置<br> 2.2、更改 HOSTNAME<br> 2.3、配置 SSH 免密码登录登录<br> 2.4、关闭防火墙<br> 2.7、安装 NTP<br> 3. 下载应用程序及配置环境变量<br> 3.1、创建安装目录<br> 3.2、下载本文中用到的程序<br> 3.3、设置环境变量<br> 4. 安装 Oracle JDK 1.8.0<br> 4.1 下载 Oracle JDK 1.8.0<br> 4.2、配置 Oracle JDK 1.8.0<br> 5、安装 Zookeeper3.4.13<br> 5.1、修改配置文件 zoo.cfg<br> 5.2、为每台服务器创建身份标识<br> 5.3、在所有节点中启动 zookeeper<br> 5.4、查看zookeeper 运行状态<br> 5.5、测试 Zookeeper 是否启动成功<br> 6、安装 Hadoop3.1.2<br> 6.1、修改 Hadoop 配置文件<br> 6.1.1、修改配置文件 core-site.xml<br> 6.1.2、修改配置文件 hdfs-site.xml<br> 6.1.3、修改配置文件 mapred-site.xml<br> 6.1.4、修改配置文件 capacity-scheduler.xml<br> 6.1.5、修改配置文件 yarn-site.xml<br> 6.1.6、编辑 start-dfs.sh，stop-dfs.sh 脚本<br> 6.1.7、编辑 start-yarn.sh，stop-yarn.sh 脚本<br> 6.1.8、修改配置文件 works 文件<br> 6.2、启动 Hadoop<br> 6.2.1、启动JournalNode集群<br> 6.2.2、格式化 NameNode<br> 6.2.3、启动 zookeeper 故障转移控制器<br> 6.2.4、格式化 zookeeper<br> 6.2.5、启动 NameNode<br> 6.2.6、将 NameNode 数据复制到备用 NameNode<br> 6.2.7、启动 HDFS 进程<br> 6.2.8、测试 HDFS 是否可用<br> 6.2.9、启动 YARN<br> 6.2.10、测试 YARN 的可用性<br> 6.2.11、查看 MapReduce 运行的历史记录<br> 6.2.12、验证 Hadoop HA 高可用性<br> 7、安装 Hbase 1.4.9<br> 7.1、修改 Hbase 配置文件<br> 7.1.1、编辑配置文件 hbase-env.sh<br> 7.1.2、编辑配置文件 hbase-site.xml<br> 7.1.3、配置 Slaver<br> 7.1.4、将 Hbase 复制到其他机器<br> 7.2、启动 Hbase<br> 7.2.1、用 Shell 测试连接 Hbase<br> 7.2.2、测试 Hbase 故障转移<br> 8、安装 Mysql 5.7<br> 8.1、启动 Mysql<br> 8.2、授权可以远程访问 Mysql<br> 8.3、修改 Mysql 授权远程访问<br> 9、安装 Hive2.3.4<br> 9.1、修改 Hive配置文件<br> 9.1.1、编辑配置文件 hive-env.sh<br> 9.1.2、编辑配置文件 hive-site.xml<br> 9.1.3、下载 Mysql 驱动<br> 9.2、启动 Hive<br> 9.2.1、初始化 MySql 数据库<br> 9.2.2、创建测试数据，以及在hadoop上创建数据仓库目录<br> 9.2.3、用 Shell 测试连接 Hive<br> 9.2.4、Hive to Hbase<br> 9.2.5、Hbase to Hive<br> 10、安装 Spark 2.4.0<br> 10.1、修改 Spark 配置文件<br> 10.1.1、编辑配置文件 spark-env.sh<br> 10.1.2、编辑配置文件 Slaves<br> 10.2、启动spark集群<br> 10.2.1、将 Spark 和 Scala 复制到其他机器<br> 10.2.2、启动 Spark<br> 10.2.3、测试 Spark 集群<br> 10.2.4、运行 Spark on YARN<br> 11、常见问题<br> 11.1、Hbase<br> 11.1.1、You have version null and I want version 8. Is your hbase.rootdir valid? If so, you may need to run ‘hbase hbck -fixVersionFile’<br> 12. 参考资料</p> 
<p>1、前言<br> 1.1、什么是 Hadoop?<br>   Hadoop 是一个由 Apache 基金会所开发的分布式系统基础架构。<br>   用户可以在不了解分布式底层细节的情况下，开发分布式程序。充分利用集群的威力进行高速运算和存储。Hadoop 实现了一个分布式文件系统（Hadoop Distributed File System），简称HDFS。HDFS有高容错性的特点，并且设计用来部署在低廉的（low-cost）硬件上；而且它提供高吞吐量（high throughput）来访问应用程序的数据，适合那些有着超大数据集（large data set）的应用程序。HDFS放宽了（relax）POSIX的要求，可以以流的形式访问（streaming access）文件系统中的数据。<br>   Hadoop的框架最核心的设计就是：HDFS 和 MapReduce。HDFS 为海量的数据提供了存储，而 MapReduce 则为海量的数据提供了计算。<br>   （以上介绍来自百度百科）<br>   Hadoop3.1.2 是 Apache Hadoop 3.1 系列的第二个稳定版本。<br> 它包含自 3.1.1 以来的 325 个错误修复、改进和增强功能。<br>   <br> 1.1.1、什么是 YARN?<br>   Apache Hadoop YARN （Yet Another Resource Negotiator，另一种资源协调者）是一种新的 Hadoop 资源管理器，它是一个通用资源管理系统。<br>   新版本的 YARN 的基本思想是将 JobTracker 的两个主要功能（资源管理和作业调度/监控）分离，主要方法是创建一个全局的ResourceManager（RM）和若干个针对应用程序的ApplicationMaster（AM）。每一个应用的 ApplicationMaster 是一个详细的框架库，它结合从 ResourceManager 获得的资源和 NodeManager 协同工作来运行和监控任务。<br> ResourceManager–是全局的，负责对于系统中的所有资源有最高的支配权。<br> ApplicationMaster–每一个job有一个ApplicationMaster 。<br> NodeManager–是基本的计算框架。</p> 
<p>1.2、什么是 Zookeeper?<br>   ZooKeeper 是一个分布式的，开放源码的分布式应用程序协调服务，是Google 的 Chubby 一个开源的实现，是 Hadoop 和 Hbase 的重要组件。它是一个为分布式应用提供一致性服务的软件，提供的功能包括：配置维护、域名服务、分布式同步、组服务等。<br>   ZooKeeper 的目标就是封装好复杂易出错的关键服务，将简单易用的接口和性能高效、功能稳定的系统提供给用户。<br>   （以上介绍来自百度百科）<br>   <br> 1.3、什么是 Hbase?<br>   HBase 是一个分布式的、面向列的开源数据库，该技术来源于 Fay Chang 所撰写的 Google 论文“Bigtable：一个结构化数据的分布式存储系统”。就像 Bigtable 利用了 Google 文件系统（File System）所提供的分布式数据存储一样，HBase 在 Hadoop 之上提供了类似于 Bigtable 的能力。HBase 是 Apache 的 Hadoop项目的子项目。HBase 不同于一般的关系数据库，它是一个适合于非结构化数据存储的数据库。另一个不同的是 HBase 基于列的而不是基于行的模式。<br>   （以上介绍来自百度百科）<br> 1.3、什么是 Hbase?<br>   HBase 是一个分布式的、面向列的开源数据库，该技术来源于 Fay Chang 所撰写的 Google 论文“Bigtable：一个结构化数据的分布式存储系统”。就像 Bigtable 利用了 Google 文件系统（File System）所提供的分布式数据存储一样，HBase 在 Hadoop 之上提供了类似于 Bigtable 的能力。HBase 是 Apache 的 Hadoop项目的子项目。HBase 不同于一般的关系数据库，它是一个适合于非结构化数据存储的数据库。另一个不同的是 HBase 基于列的而不是基于行的模式。<br>   （以上介绍来自百度百科）<br>   <br> 1.4、什么是 Hive<br>   Hive 是基于 Hadoop 的一个数据仓库工具，可以将结构化的数据文件映射为一张数据库表，并提供简单的sql查询功能，可以将sql语句转换为 MapReduce 任务进行运行。 其优点是学习成本低，可以通过类SQL语句快速实现简单 的 MapReduce 统计，不必开发专门的 MapReduce 应用，十分适合数据仓库的统计分析。<br>   Hive是建立在 Hadoop 上的数据仓库基础构架。它提供了一系列的工具，可以用来进行数据提取转化加载（ETL），这是一种可以存储、查询和分析存储在 Hadoop 中的大规模数据的机制。Hive 定义了简单的类 SQL 查询语言，称为 HQL，它允许熟悉 SQL 的用户查询数据。同时，这个语言也允许熟悉 MapReduce 开发者的开发自定义的 mapper 和 reducer 来处理内建的 mapper 和 reducer 无法完成的复杂的分析工作。<br>   Hive 没有专门的数据格式。 Hive 可以很好的工作在 Thrift 之上，控制分隔符，也允许用户指定数据格式。<br>   （以上介绍来自百度百科）<br>   <br> 1.5、什么是 Spark?<br>   Apache Spark 是专为大规模数据处理而设计的快速通用的计算引擎。Spark是UC Berkeley AMP lab (加州大学伯克利分校的AMP实验室)所开源的类 Hadoop MapReduce 的通用并行框架，Spark 拥有Hadoop MapReduce 所具有的优点；但不同于 MapReduce 的是——Job中间输出结果可以保存在内存中，从而不再需要读写 HDFS ，因此 Spark 能更好地适用于数据挖掘与机器学习等需要迭代的 MapReduce 的算法。<br>   Spark 是一种与 Hadoop 相似的开源集群计算环境，但是两者之间还存在一些不同之处，这些有用的不同之处使 Spark 在某些工作负载方面表现得更加优越，换句话说，Spark 启用了内存分布数据集，除了能够提供交互式查询外，它还可以优化迭代工作负载。<br>   Spark 是在 Scala 语言中实现的，它将 Scala 用作其应用程序框架。与 Hadoop 不同，Spark 和 Scala 能够紧密集成，其中的 Scala 可以像操作本地集合对象一样轻松地操作分布式数据集。<br>   尽管创建 Spark 是为了支持分布式数据集上的迭代作业，但是实际上它是对 Hadoop 的补充，可以在 Hadoop 文件系统中并行运行。通过名为 Mesos 的第三方集群框架可以支持此行为。Spark 由加州大学伯克利分校 AMP 实验室 (Algorithms, Machines, and People Lab) 开发，可用来构建大型的、低延迟的数据分析应用程序。<br>   （以上介绍来自百度百科）</p> 
<p>2、环境准备<br> 本文中的案例会有4台机器，他们的 Host 和 IP 地址如下<br> <img src="https://images2.imgbox.com/96/99/xiUrflhu_o.png" alt="在这里插入图片描述"><br> 四台机器的 host 以 c0 为例：</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># cat <span class="token operator">/</span>etc<span class="token operator">/</span>hosts
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>   localhost localhost<span class="token punctuation">.</span>localdomain localhost4 localhost4<span class="token punctuation">.</span>localdomain4
<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token number">1</span>         localhost localhost<span class="token punctuation">.</span>localdomain localhost6 localhost6<span class="token punctuation">.</span>localdomain6
<span class="token number">10.0</span><span class="token number">.0</span><span class="token number">.100</span> c0
<span class="token number">10.0</span><span class="token number">.0</span><span class="token number">.101</span> c1
<span class="token number">10.0</span><span class="token number">.0</span><span class="token number">.102</span> c2
<span class="token number">10.0</span><span class="token number">.0</span><span class="token number">.103</span> c3
</code></pre> 
<p>2.1、网络配置<br>   以下以 c0 为例</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># cat <span class="token operator">/</span>etc<span class="token operator">/</span>sysconfig<span class="token operator">/</span>network<span class="token operator">-</span>scripts<span class="token operator">/</span>ifcfg<span class="token operator">-</span>eth33
TYPE<span class="token operator">=</span>Ethernet
BOOTPROTO<span class="token operator">=</span><span class="token keyword">static</span>
DEFROUTE<span class="token operator">=</span>yes
PEERDNS<span class="token operator">=</span>yes
PEERROUTES<span class="token operator">=</span>yes
IPV4_FAILURE_FATAL<span class="token operator">=</span>no
IPV6INIT<span class="token operator">=</span>yes
IPV6_AUTOCONF<span class="token operator">=</span>yes
IPV6_DEFROUTE<span class="token operator">=</span>yes
IPV6_PEERDNS<span class="token operator">=</span>yes
IPV6_PEERROUTES<span class="token operator">=</span>yes
IPV6_FAILURE_FATAL<span class="token operator">=</span>no
IPV6_ADDR_GEN_MODE<span class="token operator">=</span>stable<span class="token operator">-</span>privacy
NAME<span class="token operator">=</span>ens33
UUID<span class="token operator">=</span>fa3a4df3<span class="token operator">-</span>e833<span class="token operator">-</span><span class="token number">410</span>a<span class="token operator">-</span><span class="token number">9</span>c95<span class="token operator">-</span><span class="token number">94e3</span>ee645d12
DEVICE<span class="token operator">=</span>ens33
ONBOOT<span class="token operator">=</span>yes

IPADDR<span class="token operator">=</span><span class="token number">192.168</span><span class="token number">.133</span><span class="token number">.20</span>
PREFIXO<span class="token operator">=</span><span class="token number">24</span>
NTSMASK<span class="token operator">=</span><span class="token number">255.255</span><span class="token number">.0</span><span class="token number">.0</span>
GATEWAY<span class="token operator">=</span><span class="token number">192.168</span><span class="token number">.133</span><span class="token number">.2</span>
DNS1<span class="token operator">=</span><span class="token number">114.114</span><span class="token number">.114</span><span class="token number">.114</span>
DNS2<span class="token operator">=</span><span class="token number">8.8</span><span class="token number">.8</span><span class="token number">.8</span>
</code></pre> 
<p>重启网络：</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># service network restart
</code></pre> 
<p>更改源为阿里云</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># yum install <span class="token operator">-</span>y wget
<span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># cd <span class="token operator">/</span>etc<span class="token operator">/</span>yum<span class="token punctuation">.</span>repos<span class="token punctuation">.</span>d<span class="token operator">/</span>
<span class="token punctuation">[</span>root@c0 yum<span class="token punctuation">.</span>repos<span class="token punctuation">.</span>d<span class="token punctuation">]</span># mv CentOS<span class="token operator">-</span>Base<span class="token punctuation">.</span>repo CentOS<span class="token operator">-</span>Base<span class="token punctuation">.</span>repo<span class="token punctuation">.</span>bak
<span class="token punctuation">[</span>root@c0 yum<span class="token punctuation">.</span>repos<span class="token punctuation">.</span>d<span class="token punctuation">]</span># wget http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>mirrors<span class="token punctuation">.</span>aliyun<span class="token punctuation">.</span>com<span class="token operator">/</span>repo<span class="token operator">/</span>Centos<span class="token operator">-</span><span class="token number">7.</span>repo
<span class="token punctuation">[</span>root@c0 yum<span class="token punctuation">.</span>repos<span class="token punctuation">.</span>d<span class="token punctuation">]</span># wget http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>mirrors<span class="token punctuation">.</span><span class="token number">163.</span>com<span class="token operator">/</span><span class="token punctuation">.</span>help<span class="token operator">/</span>CentOS7<span class="token operator">-</span>Base<span class="token operator">-</span><span class="token number">163.</span>repo
<span class="token punctuation">[</span>root@c0 yum<span class="token punctuation">.</span>repos<span class="token punctuation">.</span>d<span class="token punctuation">]</span># yum clean all
<span class="token punctuation">[</span>root@c0 yum<span class="token punctuation">.</span>repos<span class="token punctuation">.</span>d<span class="token punctuation">]</span># yum makecache
</code></pre> 
<p>安装网络工具包和基础工具包</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># yum install net<span class="token operator">-</span>tools checkpolicy gcc dkms foomatic openssh<span class="token operator">-</span>server bash<span class="token operator">-</span>completion psmisc <span class="token operator">-</span>y
</code></pre> 
<p>2.2、更改 HOSTNAME<br>   在四台机器上依次设置 hostname，以下以c0为例</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># hostnamectl <span class="token operator">--</span><span class="token keyword">static</span> set<span class="token operator">-</span>hostname c0
<span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># hostnamectl status
   Static hostname<span class="token punctuation">:</span> c0
         Icon name<span class="token punctuation">:</span> computer<span class="token operator">-</span>vm
           Chassis<span class="token punctuation">:</span> vm
        Machine ID<span class="token punctuation">:</span> <span class="token number">04</span>c3f6d56e788345859875d9f49bd4bd
           Boot ID<span class="token punctuation">:</span> ba02919abe4245aba673aaf5f778ad10
    Virtualization<span class="token punctuation">:</span> kvm
  Operating System<span class="token punctuation">:</span> CentOS Linux <span class="token number">7</span> <span class="token punctuation">(</span>Core<span class="token punctuation">)</span>
       CPE OS Name<span class="token punctuation">:</span> cpe<span class="token punctuation">:</span><span class="token operator">/</span>o<span class="token punctuation">:</span>centos<span class="token punctuation">:</span>centos<span class="token punctuation">:</span><span class="token number">7</span>
            Kernel<span class="token punctuation">:</span> Linux <span class="token number">3.10</span><span class="token number">.0</span><span class="token operator">-</span><span class="token number">957.</span>el7<span class="token punctuation">.</span>x86_64
      Architecture<span class="token punctuation">:</span> x86<span class="token operator">-</span><span class="token number">64</span>
</code></pre> 
<p>2.3、配置 SSH 免密码登录登录<br>   每一台机器都单独生成</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># ssh<span class="token operator">-</span>keygen
#一路按回车到最后
</code></pre> 
<p>将 ssh-keygen 生成的密钥，分别复制到其他三台机器，以下以 c0 为例</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># ssh<span class="token operator">-</span>copy<span class="token operator">-</span>id c0
<span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>ssh<span class="token operator">-</span>copy<span class="token operator">-</span>id<span class="token punctuation">:</span> INFO<span class="token punctuation">:</span> Source of <span class="token function">key</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> to be installed<span class="token punctuation">:</span> <span class="token string">"/root/.ssh/id_rsa.pub"</span>
The authenticity of host <span class="token string">'c0 (10.0.0.100)'</span> can't be established<span class="token punctuation">.</span>
ECDSA key fingerprint is SHA256<span class="token punctuation">:</span>O8y8TBSZfBYiHPvJPPuAd058zkfsOfnBjvnf<span class="token operator">/</span><span class="token number">3</span>cvOCQ<span class="token punctuation">.</span>
ECDSA key fingerprint is MD5<span class="token punctuation">:</span>da<span class="token punctuation">:</span><span class="token number">3</span>c<span class="token punctuation">:</span><span class="token number">29</span><span class="token punctuation">:</span><span class="token number">65</span><span class="token punctuation">:</span>f2<span class="token punctuation">:</span><span class="token number">86</span><span class="token punctuation">:</span>e9<span class="token punctuation">:</span><span class="token number">61</span><span class="token punctuation">:</span>cb<span class="token punctuation">:</span><span class="token number">39</span><span class="token punctuation">:</span><span class="token number">57</span><span class="token punctuation">:</span><span class="token number">5</span>b<span class="token punctuation">:</span><span class="token number">5</span>e<span class="token punctuation">:</span>e2<span class="token punctuation">:</span><span class="token number">77</span><span class="token punctuation">:</span><span class="token number">7</span>c<span class="token punctuation">.</span>
Are you sure you want to <span class="token keyword">continue</span> connecting <span class="token punctuation">(</span>yes<span class="token operator">/</span>no<span class="token punctuation">)</span><span class="token operator">?</span> yes
<span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>ssh<span class="token operator">-</span>copy<span class="token operator">-</span>id<span class="token punctuation">:</span> INFO<span class="token punctuation">:</span> attempting to log in with the new <span class="token function">key</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">,</span> to filter out any that are already installed
<span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>ssh<span class="token operator">-</span>copy<span class="token operator">-</span>id<span class="token punctuation">:</span> INFO<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token function">key</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> remain to be installed <span class="token operator">--</span> <span class="token keyword">if</span> you are prompted now it is to install the new keys
root@c0's password<span class="token punctuation">:</span>
<span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># rm <span class="token operator">-</span>rf <span class="token operator">~</span><span class="token operator">/</span><span class="token punctuation">.</span>ssh<span class="token operator">/</span>known_hosts
<span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># clear
<span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># ssh<span class="token operator">-</span>copy<span class="token operator">-</span>id c0
<span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>ssh<span class="token operator">-</span>copy<span class="token operator">-</span>id<span class="token punctuation">:</span> INFO<span class="token punctuation">:</span> Source of <span class="token function">key</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> to be installed<span class="token punctuation">:</span> <span class="token string">"/root/.ssh/id_rsa.pub"</span>
The authenticity of host <span class="token string">'c0 (10.0.0.100)'</span> can't be established<span class="token punctuation">.</span>
ECDSA key fingerprint is SHA256<span class="token punctuation">:</span>O8y8TBSZfBYiHPvJPPuAd058zkfsOfnBjvnf<span class="token operator">/</span><span class="token number">3</span>cvOCQ<span class="token punctuation">.</span>
ECDSA key fingerprint is MD5<span class="token punctuation">:</span>da<span class="token punctuation">:</span><span class="token number">3</span>c<span class="token punctuation">:</span><span class="token number">29</span><span class="token punctuation">:</span><span class="token number">65</span><span class="token punctuation">:</span>f2<span class="token punctuation">:</span><span class="token number">86</span><span class="token punctuation">:</span>e9<span class="token punctuation">:</span><span class="token number">61</span><span class="token punctuation">:</span>cb<span class="token punctuation">:</span><span class="token number">39</span><span class="token punctuation">:</span><span class="token number">57</span><span class="token punctuation">:</span><span class="token number">5</span>b<span class="token punctuation">:</span><span class="token number">5</span>e<span class="token punctuation">:</span>e2<span class="token punctuation">:</span><span class="token number">77</span><span class="token punctuation">:</span><span class="token number">7</span>c<span class="token punctuation">.</span>
Are you sure you want to <span class="token keyword">continue</span> connecting <span class="token punctuation">(</span>yes<span class="token operator">/</span>no<span class="token punctuation">)</span><span class="token operator">?</span> yes
<span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>ssh<span class="token operator">-</span>copy<span class="token operator">-</span>id<span class="token punctuation">:</span> INFO<span class="token punctuation">:</span> attempting to log in with the new <span class="token function">key</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">,</span> to filter out any that are already installed
<span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>ssh<span class="token operator">-</span>copy<span class="token operator">-</span>id<span class="token punctuation">:</span> INFO<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token function">key</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> remain to be installed <span class="token operator">--</span> <span class="token keyword">if</span> you are prompted now it is to install the new keys
root@c0's password<span class="token punctuation">:</span>

Number of <span class="token function">key</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> added<span class="token punctuation">:</span> <span class="token number">1</span>

Now try logging into the machine<span class="token punctuation">,</span> with<span class="token punctuation">:</span>   <span class="token string">"ssh 'c0'"</span>
and check to make sure that only the <span class="token function">key</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> you wanted were added<span class="token punctuation">.</span>

<span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># ssh<span class="token operator">-</span>copy<span class="token operator">-</span>id c1
<span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>ssh<span class="token operator">-</span>copy<span class="token operator">-</span>id<span class="token punctuation">:</span> INFO<span class="token punctuation">:</span> Source of <span class="token function">key</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> to be installed<span class="token punctuation">:</span> <span class="token string">"/root/.ssh/id_rsa.pub"</span>
The authenticity of host <span class="token string">'c1 (10.0.0.101)'</span> can't be established<span class="token punctuation">.</span>
ECDSA key fingerprint is SHA256<span class="token punctuation">:</span>O8y8TBSZfBYiHPvJPPuAd058zkfsOfnBjvnf<span class="token operator">/</span><span class="token number">3</span>cvOCQ<span class="token punctuation">.</span>
ECDSA key fingerprint is MD5<span class="token punctuation">:</span>da<span class="token punctuation">:</span><span class="token number">3</span>c<span class="token punctuation">:</span><span class="token number">29</span><span class="token punctuation">:</span><span class="token number">65</span><span class="token punctuation">:</span>f2<span class="token punctuation">:</span><span class="token number">86</span><span class="token punctuation">:</span>e9<span class="token punctuation">:</span><span class="token number">61</span><span class="token punctuation">:</span>cb<span class="token punctuation">:</span><span class="token number">39</span><span class="token punctuation">:</span><span class="token number">57</span><span class="token punctuation">:</span><span class="token number">5</span>b<span class="token punctuation">:</span><span class="token number">5</span>e<span class="token punctuation">:</span>e2<span class="token punctuation">:</span><span class="token number">77</span><span class="token punctuation">:</span><span class="token number">7</span>c<span class="token punctuation">.</span>
Are you sure you want to <span class="token keyword">continue</span> connecting <span class="token punctuation">(</span>yes<span class="token operator">/</span>no<span class="token punctuation">)</span><span class="token operator">?</span> yes
<span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>ssh<span class="token operator">-</span>copy<span class="token operator">-</span>id<span class="token punctuation">:</span> INFO<span class="token punctuation">:</span> attempting to log in with the new <span class="token function">key</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">,</span> to filter out any that are already installed
<span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>ssh<span class="token operator">-</span>copy<span class="token operator">-</span>id<span class="token punctuation">:</span> INFO<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token function">key</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> remain to be installed <span class="token operator">--</span> <span class="token keyword">if</span> you are prompted now it is to install the new keys
root@c1's password<span class="token punctuation">:</span>

Number of <span class="token function">key</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> added<span class="token punctuation">:</span> <span class="token number">1</span>

Now try logging into the machine<span class="token punctuation">,</span> with<span class="token punctuation">:</span>   <span class="token string">"ssh 'c1'"</span>
and check to make sure that only the <span class="token function">key</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> you wanted were added<span class="token punctuation">.</span>

<span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># ssh<span class="token operator">-</span>copy<span class="token operator">-</span>id c2
<span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>ssh<span class="token operator">-</span>copy<span class="token operator">-</span>id<span class="token punctuation">:</span> INFO<span class="token punctuation">:</span> Source of <span class="token function">key</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> to be installed<span class="token punctuation">:</span> <span class="token string">"/root/.ssh/id_rsa.pub"</span>
The authenticity of host <span class="token string">'c2 (10.0.0.102)'</span> can't be established<span class="token punctuation">.</span>
ECDSA key fingerprint is SHA256<span class="token punctuation">:</span>O8y8TBSZfBYiHPvJPPuAd058zkfsOfnBjvnf<span class="token operator">/</span><span class="token number">3</span>cvOCQ<span class="token punctuation">.</span>
ECDSA key fingerprint is MD5<span class="token punctuation">:</span>da<span class="token punctuation">:</span><span class="token number">3</span>c<span class="token punctuation">:</span><span class="token number">29</span><span class="token punctuation">:</span><span class="token number">65</span><span class="token punctuation">:</span>f2<span class="token punctuation">:</span><span class="token number">86</span><span class="token punctuation">:</span>e9<span class="token punctuation">:</span><span class="token number">61</span><span class="token punctuation">:</span>cb<span class="token punctuation">:</span><span class="token number">39</span><span class="token punctuation">:</span><span class="token number">57</span><span class="token punctuation">:</span><span class="token number">5</span>b<span class="token punctuation">:</span><span class="token number">5</span>e<span class="token punctuation">:</span>e2<span class="token punctuation">:</span><span class="token number">77</span><span class="token punctuation">:</span><span class="token number">7</span>c<span class="token punctuation">.</span>
Are you sure you want to <span class="token keyword">continue</span> connecting <span class="token punctuation">(</span>yes<span class="token operator">/</span>no<span class="token punctuation">)</span><span class="token operator">?</span> yes
<span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>ssh<span class="token operator">-</span>copy<span class="token operator">-</span>id<span class="token punctuation">:</span> INFO<span class="token punctuation">:</span> attempting to log in with the new <span class="token function">key</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">,</span> to filter out any that are already installed
<span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>ssh<span class="token operator">-</span>copy<span class="token operator">-</span>id<span class="token punctuation">:</span> INFO<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token function">key</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> remain to be installed <span class="token operator">--</span> <span class="token keyword">if</span> you are prompted now it is to install the new keys
root@c2's password<span class="token punctuation">:</span>

Number of <span class="token function">key</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> added<span class="token punctuation">:</span> <span class="token number">1</span>

Now try logging into the machine<span class="token punctuation">,</span> with<span class="token punctuation">:</span>   <span class="token string">"ssh 'c2'"</span>
and check to make sure that only the <span class="token function">key</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> you wanted were added<span class="token punctuation">.</span>

<span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># ssh<span class="token operator">-</span>copy<span class="token operator">-</span>id c3
<span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>ssh<span class="token operator">-</span>copy<span class="token operator">-</span>id<span class="token punctuation">:</span> INFO<span class="token punctuation">:</span> Source of <span class="token function">key</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> to be installed<span class="token punctuation">:</span> <span class="token string">"/root/.ssh/id_rsa.pub"</span>
The authenticity of host <span class="token string">'c3 (10.0.0.103)'</span> can't be established<span class="token punctuation">.</span>
ECDSA key fingerprint is SHA256<span class="token punctuation">:</span>O8y8TBSZfBYiHPvJPPuAd058zkfsOfnBjvnf<span class="token operator">/</span><span class="token number">3</span>cvOCQ<span class="token punctuation">.</span>
ECDSA key fingerprint is MD5<span class="token punctuation">:</span>da<span class="token punctuation">:</span><span class="token number">3</span>c<span class="token punctuation">:</span><span class="token number">29</span><span class="token punctuation">:</span><span class="token number">65</span><span class="token punctuation">:</span>f2<span class="token punctuation">:</span><span class="token number">86</span><span class="token punctuation">:</span>e9<span class="token punctuation">:</span><span class="token number">61</span><span class="token punctuation">:</span>cb<span class="token punctuation">:</span><span class="token number">39</span><span class="token punctuation">:</span><span class="token number">57</span><span class="token punctuation">:</span><span class="token number">5</span>b<span class="token punctuation">:</span><span class="token number">5</span>e<span class="token punctuation">:</span>e2<span class="token punctuation">:</span><span class="token number">77</span><span class="token punctuation">:</span><span class="token number">7</span>c<span class="token punctuation">.</span>
Are you sure you want to <span class="token keyword">continue</span> connecting <span class="token punctuation">(</span>yes<span class="token operator">/</span>no<span class="token punctuation">)</span><span class="token operator">?</span> yes
<span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>ssh<span class="token operator">-</span>copy<span class="token operator">-</span>id<span class="token punctuation">:</span> INFO<span class="token punctuation">:</span> attempting to log in with the new <span class="token function">key</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">,</span> to filter out any that are already installed
<span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>ssh<span class="token operator">-</span>copy<span class="token operator">-</span>id<span class="token punctuation">:</span> INFO<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token function">key</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> remain to be installed <span class="token operator">--</span> <span class="token keyword">if</span> you are prompted now it is to install the new keys
root@c3's password<span class="token punctuation">:</span>

Number of <span class="token function">key</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> added<span class="token punctuation">:</span> <span class="token number">1</span>

Now try logging into the machine<span class="token punctuation">,</span> with<span class="token punctuation">:</span>   <span class="token string">"ssh 'c3'"</span>
and check to make sure that only the <span class="token function">key</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> you wanted were added<span class="token punctuation">.</span>
</code></pre> 
<p>测试密钥是否配置成功，可以在任意机器上执行以下命令：</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># <span class="token keyword">for</span> N in $<span class="token punctuation">(</span>seq <span class="token number">0</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">do</span> ssh c$N hostname<span class="token punctuation">;</span> done<span class="token punctuation">;</span>
c0
c1
c2
c3
</code></pre> 
<p>2.4、关闭防火墙<br>   在每一台机器上运行以下命令：</p> 
<pre><code class="prism language-c"><span class="token macro property"># c0</span>
<span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># systemctl stop firewalld <span class="token operator">&amp;&amp;</span> systemctl disable firewalld
Removed symlink <span class="token operator">/</span>etc<span class="token operator">/</span>systemd<span class="token operator">/</span>system<span class="token operator">/</span>multi<span class="token operator">-</span>user<span class="token punctuation">.</span>target<span class="token punctuation">.</span>wants<span class="token operator">/</span>firewalld<span class="token punctuation">.</span>service<span class="token punctuation">.</span>
Removed symlink <span class="token operator">/</span>etc<span class="token operator">/</span>systemd<span class="token operator">/</span>system<span class="token operator">/</span>dbus<span class="token operator">-</span>org<span class="token punctuation">.</span>fedoraproject<span class="token punctuation">.</span>FirewallD1<span class="token punctuation">.</span>service<span class="token punctuation">.</span>

<span class="token macro property"># c1</span>
<span class="token punctuation">[</span>root@c1 <span class="token operator">~</span><span class="token punctuation">]</span># systemctl stop firewalld <span class="token operator">&amp;&amp;</span> systemctl disable firewalld
Removed symlink <span class="token operator">/</span>etc<span class="token operator">/</span>systemd<span class="token operator">/</span>system<span class="token operator">/</span>multi<span class="token operator">-</span>user<span class="token punctuation">.</span>target<span class="token punctuation">.</span>wants<span class="token operator">/</span>firewalld<span class="token punctuation">.</span>service<span class="token punctuation">.</span>
Removed symlink <span class="token operator">/</span>etc<span class="token operator">/</span>systemd<span class="token operator">/</span>system<span class="token operator">/</span>dbus<span class="token operator">-</span>org<span class="token punctuation">.</span>fedoraproject<span class="token punctuation">.</span>FirewallD1<span class="token punctuation">.</span>service<span class="token punctuation">.</span>

<span class="token macro property"># c2</span>
<span class="token punctuation">[</span>root@c2 <span class="token operator">~</span><span class="token punctuation">]</span># systemctl stop firewalld <span class="token operator">&amp;&amp;</span> systemctl disable firewalld
Removed symlink <span class="token operator">/</span>etc<span class="token operator">/</span>systemd<span class="token operator">/</span>system<span class="token operator">/</span>multi<span class="token operator">-</span>user<span class="token punctuation">.</span>target<span class="token punctuation">.</span>wants<span class="token operator">/</span>firewalld<span class="token punctuation">.</span>service<span class="token punctuation">.</span>
Removed symlink <span class="token operator">/</span>etc<span class="token operator">/</span>systemd<span class="token operator">/</span>system<span class="token operator">/</span>dbus<span class="token operator">-</span>org<span class="token punctuation">.</span>fedoraproject<span class="token punctuation">.</span>FirewallD1<span class="token punctuation">.</span>service<span class="token punctuation">.</span>

<span class="token macro property"># c3</span>
<span class="token punctuation">[</span>root@c3 <span class="token operator">~</span><span class="token punctuation">]</span># systemctl stop firewalld <span class="token operator">&amp;&amp;</span> systemctl disable firewalld
Removed symlink <span class="token operator">/</span>etc<span class="token operator">/</span>systemd<span class="token operator">/</span>system<span class="token operator">/</span>multi<span class="token operator">-</span>user<span class="token punctuation">.</span>target<span class="token punctuation">.</span>wants<span class="token operator">/</span>firewalld<span class="token punctuation">.</span>service<span class="token punctuation">.</span>
Removed symlink <span class="token operator">/</span>etc<span class="token operator">/</span>systemd<span class="token operator">/</span>system<span class="token operator">/</span>dbus<span class="token operator">-</span>org<span class="token punctuation">.</span>fedoraproject<span class="token punctuation">.</span>FirewallD1<span class="token punctuation">.</span>service<span class="token punctuation">.</span>
</code></pre> 
<p>2.7、安装 NTP<br>   安装 NTP 时间同步工具，并启动 NTP</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># <span class="token keyword">for</span> N in $<span class="token punctuation">(</span>seq <span class="token number">0</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">do</span> ssh c$N yum install ntp <span class="token operator">-</span>y<span class="token punctuation">;</span> done<span class="token punctuation">;</span>
</code></pre> 
<p>在每一台机器上，设置 NTP 开机启动</p> 
<pre><code class="prism language-c"><span class="token macro property"># c0</span>
<span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># systemctl enable ntpd <span class="token operator">&amp;&amp;</span> systemctl start ntpd

<span class="token macro property"># c1</span>
<span class="token punctuation">[</span>root@c1 <span class="token operator">~</span><span class="token punctuation">]</span># systemctl enable ntpd <span class="token operator">&amp;&amp;</span> systemctl start ntpd

<span class="token macro property"># c2</span>
<span class="token punctuation">[</span>root@c2 <span class="token operator">~</span><span class="token punctuation">]</span># systemctl enable ntpd <span class="token operator">&amp;&amp;</span> systemctl start ntpd

<span class="token macro property"># c3</span>
<span class="token punctuation">[</span>root@c3 <span class="token operator">~</span><span class="token punctuation">]</span># systemctl enable ntpd <span class="token operator">&amp;&amp;</span> systemctl start ntpd
</code></pre> 
<p>依次查看每台机器上的时间：</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># <span class="token keyword">for</span> N in $<span class="token punctuation">(</span>seq <span class="token number">0</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">do</span> ssh c$N date<span class="token punctuation">;</span> done<span class="token punctuation">;</span>
Sat Feb  <span class="token number">9</span> <span class="token number">18</span><span class="token punctuation">:</span><span class="token number">11</span><span class="token punctuation">:</span><span class="token number">48</span> CST <span class="token number">2019</span>
Sat Feb  <span class="token number">9</span> <span class="token number">18</span><span class="token punctuation">:</span><span class="token number">11</span><span class="token punctuation">:</span><span class="token number">48</span> CST <span class="token number">2019</span>
Sat Feb  <span class="token number">9</span> <span class="token number">18</span><span class="token punctuation">:</span><span class="token number">11</span><span class="token punctuation">:</span><span class="token number">49</span> CST <span class="token number">2019</span>
Sat Feb  <span class="token number">9</span> <span class="token number">18</span><span class="token punctuation">:</span><span class="token number">11</span><span class="token punctuation">:</span><span class="token number">49</span> CST <span class="token number">2019</span>
</code></pre> 
<p>如果时间不一致，国内的同学也可以使用下面的命令，同步阿里云时间服务器的时间，然后再用上面的命令，查看所有服务器的最新时间。</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># <span class="token keyword">for</span> N in $<span class="token punctuation">(</span>seq <span class="token number">0</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">do</span> ssh c$N ntpdate <span class="token operator">-</span>u time<span class="token punctuation">.</span>pool<span class="token punctuation">.</span>aliyun<span class="token punctuation">.</span>com<span class="token punctuation">;</span> done<span class="token punctuation">;</span>
<span class="token number">10</span> Mar <span class="token number">18</span><span class="token punctuation">:</span><span class="token number">34</span><span class="token punctuation">:</span><span class="token number">23</span> ntpdate<span class="token punctuation">[</span><span class="token number">7151</span><span class="token punctuation">]</span><span class="token punctuation">:</span> adjust time server <span class="token number">182.92</span><span class="token number">.12</span><span class="token number">.11</span> offset <span class="token number">0.001423</span> sec
<span class="token number">10</span> Mar <span class="token number">18</span><span class="token punctuation">:</span><span class="token number">34</span><span class="token punctuation">:</span><span class="token number">31</span> ntpdate<span class="token punctuation">[</span><span class="token number">17459</span><span class="token punctuation">]</span><span class="token punctuation">:</span> adjust time server <span class="token number">182.92</span><span class="token number">.12</span><span class="token number">.11</span> offset <span class="token number">0.003916</span> sec
<span class="token number">10</span> Mar <span class="token number">18</span><span class="token punctuation">:</span><span class="token number">34</span><span class="token punctuation">:</span><span class="token number">40</span> ntpdate<span class="token punctuation">[</span><span class="token number">17147</span><span class="token punctuation">]</span><span class="token punctuation">:</span> adjust time server <span class="token number">182.92</span><span class="token number">.12</span><span class="token number">.11</span> offset <span class="token number">0.008576</span> sec
<span class="token number">10</span> Mar <span class="token number">18</span><span class="token punctuation">:</span><span class="token number">34</span><span class="token punctuation">:</span><span class="token number">48</span> ntpdate<span class="token punctuation">[</span><span class="token number">17423</span><span class="token punctuation">]</span><span class="token punctuation">:</span> adjust time server <span class="token number">182.92</span><span class="token number">.12</span><span class="token number">.11</span> offset <span class="token operator">-</span><span class="token number">0.004648</span> sec
</code></pre> 
<ol start="3"><li>下载应用程序及配置环境变量<br> 3.1、创建安装目录<br>   创建要用到的目录结构，所有的程序都统一在/home/work/_app 目录，所有下载的源码在 /home/work/_src目录 ，所有的数据在 /home/work/_data 目录，所有的日志在 /home/work/_logs 目录。</li></ol> 
<pre><code class="prism language-c"># 创建 Hadoop3<span class="token punctuation">.</span><span class="token number">1.2</span> 和 Zookeeper3<span class="token punctuation">.</span><span class="token number">4.13</span> 需要的目录
<span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># <span class="token keyword">for</span> N in $<span class="token punctuation">(</span>seq <span class="token number">0</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">do</span> ssh c$N mkdir <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span><span class="token punctuation">{<!-- --></span>_src<span class="token punctuation">,</span>_app<span class="token punctuation">,</span>_logs<span class="token punctuation">,</span>_data<span class="token punctuation">}</span> <span class="token operator">-</span>p<span class="token punctuation">;</span> done<span class="token punctuation">;</span>
<span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># <span class="token keyword">for</span> N in $<span class="token punctuation">(</span>seq <span class="token number">0</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">do</span> ssh c$N mkdir <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_data<span class="token operator">/</span><span class="token punctuation">{<!-- --></span>hadoop<span class="token operator">-</span><span class="token number">3.1</span><span class="token number">.2</span><span class="token punctuation">,</span>zookeeper<span class="token operator">-</span><span class="token number">3.4</span><span class="token number">.13</span><span class="token punctuation">}</span> <span class="token operator">-</span>p<span class="token punctuation">;</span> done<span class="token punctuation">;</span>
<span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># <span class="token keyword">for</span> N in $<span class="token punctuation">(</span>seq <span class="token number">0</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">do</span> ssh c$N mkdir <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_logs<span class="token operator">/</span><span class="token punctuation">{<!-- --></span>hadoop<span class="token operator">-</span><span class="token number">3.1</span><span class="token number">.2</span><span class="token punctuation">,</span>zookeeper<span class="token operator">-</span><span class="token number">3.4</span><span class="token number">.13</span><span class="token punctuation">}</span> <span class="token operator">-</span>p<span class="token punctuation">;</span> done<span class="token punctuation">;</span>

## 在 Hadoop3<span class="token punctuation">.</span><span class="token number">1.2</span> 的 NameNode 上创建 HA 共享目录
<span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># <span class="token keyword">for</span> N in $<span class="token punctuation">(</span>seq <span class="token number">0</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">do</span> ssh c$N mkdir <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_data<span class="token operator">/</span>hadoop<span class="token operator">-</span><span class="token number">3.1</span><span class="token number">.2</span><span class="token operator">/</span><span class="token punctuation">{<!-- --></span>journalnode<span class="token punctuation">,</span>ha<span class="token operator">-</span>name<span class="token operator">-</span>dir<span class="token operator">-</span>shared<span class="token punctuation">}</span> <span class="token operator">-</span>p<span class="token punctuation">;</span> done<span class="token punctuation">;</span>

# 创建 Hbase1<span class="token punctuation">.</span><span class="token number">4.9</span> 需要的目录
<span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># <span class="token keyword">for</span> N in $<span class="token punctuation">(</span>seq <span class="token number">0</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">do</span> ssh c$N mkdir <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_logs<span class="token operator">/</span>hbase<span class="token operator">-</span><span class="token number">1.4</span><span class="token number">.9</span> <span class="token operator">-</span>p<span class="token punctuation">;</span> done<span class="token punctuation">;</span>
<span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># <span class="token keyword">for</span> N in $<span class="token punctuation">(</span>seq <span class="token number">0</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">do</span> ssh c$N mkdir <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_data<span class="token operator">/</span>hbase<span class="token operator">-</span><span class="token number">1.4</span><span class="token number">.9</span> <span class="token operator">-</span>p<span class="token punctuation">;</span> done<span class="token punctuation">;</span>

# 创建 Hive2<span class="token punctuation">.</span><span class="token number">3.4</span> 需要的目录
<span class="token punctuation">[</span>root@c0 _src<span class="token punctuation">]</span># <span class="token keyword">for</span> N in $<span class="token punctuation">(</span>seq <span class="token number">0</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">do</span> ssh c$N mkdir <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_data<span class="token operator">/</span>hive<span class="token operator">-</span><span class="token number">2.3</span><span class="token number">.4</span><span class="token operator">/</span><span class="token punctuation">{<!-- --></span>scratchdir<span class="token punctuation">,</span>tmpdir<span class="token punctuation">}</span> <span class="token operator">-</span>p<span class="token punctuation">;</span> done<span class="token punctuation">;</span>
<span class="token punctuation">[</span>root@c0 _src<span class="token punctuation">]</span># <span class="token keyword">for</span> N in $<span class="token punctuation">(</span>seq <span class="token number">0</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">do</span> ssh c$N mkdir <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_logs<span class="token operator">/</span>hive<span class="token operator">-</span><span class="token number">2.3</span><span class="token number">.4</span> <span class="token operator">-</span>p<span class="token punctuation">;</span> done<span class="token punctuation">;</span>

# 创建 Spark2<span class="token punctuation">.</span><span class="token number">4.0</span> 需要的目录
<span class="token punctuation">[</span>root@c0 _src<span class="token punctuation">]</span># <span class="token keyword">for</span> N in $<span class="token punctuation">(</span>seq <span class="token number">0</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">do</span> ssh c$N mkdir <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_data<span class="token operator">/</span>spark<span class="token operator">-</span><span class="token number">2.4</span><span class="token number">.0</span><span class="token operator">-</span>bin<span class="token operator">-</span>hadoop2<span class="token punctuation">.</span><span class="token number">7</span> <span class="token operator">-</span>p<span class="token punctuation">;</span> done<span class="token punctuation">;</span>
<span class="token punctuation">[</span>root@c0 _src<span class="token punctuation">]</span># <span class="token keyword">for</span> N in $<span class="token punctuation">(</span>seq <span class="token number">0</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">do</span> ssh c$N mkdir <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_logs<span class="token operator">/</span>spark<span class="token operator">-</span><span class="token number">2.4</span><span class="token number">.0</span><span class="token operator">-</span>bin<span class="token operator">-</span>hadoop2<span class="token punctuation">.</span><span class="token number">7</span> <span class="token operator">-</span>p<span class="token punctuation">;</span> done<span class="token punctuation">;</span>
</code></pre> 
<p>3.2、下载本文中用到的程序<br>   安装 alex 多线程下载工具，可以提高下载速度</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># cd <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_src<span class="token operator">/</span>
<span class="token punctuation">[</span>root@c0 _src<span class="token punctuation">]</span># wget https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>download<span class="token operator">-</span>ib01<span class="token punctuation">.</span>fedoraproject<span class="token punctuation">.</span>org<span class="token operator">/</span>pub<span class="token operator">/</span>epel<span class="token operator">/</span><span class="token number">7</span><span class="token operator">/</span>x86_64<span class="token operator">/</span>Packages<span class="token operator">/</span>e<span class="token operator">/</span>epel<span class="token operator">-</span>release<span class="token operator">-</span><span class="token number">7</span><span class="token operator">-</span><span class="token number">11.</span>noarch<span class="token punctuation">.</span>rpm
<span class="token punctuation">[</span>root@c0 _src<span class="token punctuation">]</span># rpm <span class="token operator">-</span>Uvh epel<span class="token operator">-</span>release<span class="token operator">*</span>rpm
<span class="token punctuation">[</span>root@c0 _src<span class="token punctuation">]</span># yum install axel <span class="token operator">-</span>y
</code></pre> 
<p>本文中用到的软件都是编译好的，所以不需要安装，解压以后,mv 到相应的目录，可以直接运行命令启动。</p> 
<p>Hadoop3.1.2：</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 _src<span class="token punctuation">]</span># axel <span class="token operator">-</span>n <span class="token number">10</span> <span class="token operator">-</span>o <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_src<span class="token operator">/</span>hadoop<span class="token operator">-</span><span class="token number">3.1</span><span class="token number">.2</span><span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>mirrors<span class="token punctuation">.</span>tuna<span class="token punctuation">.</span>tsinghua<span class="token punctuation">.</span>edu<span class="token punctuation">.</span>cn<span class="token operator">/</span>apache<span class="token operator">/</span>hadoop<span class="token operator">/</span>common<span class="token operator">/</span>hadoop<span class="token operator">-</span><span class="token number">3.1</span><span class="token number">.2</span><span class="token operator">/</span>hadoop<span class="token operator">-</span><span class="token number">3.1</span><span class="token number">.2</span><span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz
<span class="token punctuation">[</span>root@c0 _src<span class="token punctuation">]</span># tar <span class="token operator">-</span>xzvf hadoop<span class="token operator">-</span><span class="token number">3.1</span><span class="token number">.2</span><span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz
<span class="token punctuation">[</span>root@c0 _src<span class="token punctuation">]</span># mv hadoop<span class="token operator">-</span><span class="token number">3.1</span><span class="token number">.2</span> <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_app<span class="token operator">/</span>
</code></pre> 
<p>Zookeeper3.4.13：</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 _src<span class="token punctuation">]</span># axel <span class="token operator">-</span>n <span class="token number">10</span> <span class="token operator">-</span>o <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_src<span class="token operator">/</span>zookeeper<span class="token operator">-</span><span class="token number">3.4</span><span class="token number">.13</span><span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>mirror<span class="token punctuation">.</span>bit<span class="token punctuation">.</span>edu<span class="token punctuation">.</span>cn<span class="token operator">/</span>apache<span class="token operator">/</span>zookeeper<span class="token operator">/</span>zookeeper<span class="token operator">-</span><span class="token number">3.4</span><span class="token number">.13</span><span class="token operator">/</span>zookeeper<span class="token operator">-</span><span class="token number">3.4</span><span class="token number">.13</span><span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz
<span class="token punctuation">[</span>root@c0 _src<span class="token punctuation">]</span># tar <span class="token operator">-</span>xzvf zookeeper<span class="token operator">-</span><span class="token number">3.4</span><span class="token number">.13</span><span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz
<span class="token punctuation">[</span>root@c0 _src<span class="token punctuation">]</span># mv zookeeper<span class="token operator">-</span><span class="token number">3.4</span><span class="token number">.13</span> <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_app<span class="token operator">/</span>
</code></pre> 
<p>Hbase1.4.9：</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 _src<span class="token punctuation">]</span># axel <span class="token operator">-</span>n <span class="token number">10</span> <span class="token operator">-</span>o <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_src<span class="token operator">/</span>hbase<span class="token operator">-</span><span class="token number">1.4</span><span class="token number">.9</span><span class="token operator">-</span>bin<span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>archive<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>org<span class="token operator">/</span>dist<span class="token operator">/</span>hbase<span class="token operator">/</span>stable<span class="token operator">/</span>hbase<span class="token operator">-</span><span class="token number">1.4</span><span class="token number">.9</span><span class="token operator">-</span>bin<span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz
<span class="token punctuation">[</span>root@c0 _src<span class="token punctuation">]</span># tar <span class="token operator">-</span>xzvf hbase<span class="token operator">-</span><span class="token number">1.4</span><span class="token number">.9</span><span class="token operator">-</span>bin<span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz
<span class="token punctuation">[</span>root@c0 _src<span class="token punctuation">]</span># mv hbase<span class="token operator">-</span><span class="token number">1.4</span><span class="token number">.9</span> <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_app<span class="token operator">/</span>
</code></pre> 
<p>Hive2.3.4：</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 _src<span class="token punctuation">]</span># axel <span class="token operator">-</span>n <span class="token number">10</span> <span class="token operator">-</span>o <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_src<span class="token operator">/</span>hive<span class="token operator">-</span><span class="token number">2.3</span><span class="token number">.4</span><span class="token operator">-</span>bin<span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>mirrors<span class="token punctuation">.</span>hust<span class="token punctuation">.</span>edu<span class="token punctuation">.</span>cn<span class="token operator">/</span>apache<span class="token operator">/</span>hive<span class="token operator">/</span>hive<span class="token operator">-</span><span class="token number">2.3</span><span class="token number">.4</span><span class="token operator">/</span>apache<span class="token operator">-</span>hive<span class="token operator">-</span><span class="token number">2.3</span><span class="token number">.4</span><span class="token operator">-</span>bin<span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz
<span class="token punctuation">[</span>root@c0 _src<span class="token punctuation">]</span># tar <span class="token operator">-</span>xzvf hive<span class="token operator">-</span><span class="token number">2.3</span><span class="token number">.4</span><span class="token operator">-</span>bin<span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz
<span class="token punctuation">[</span>root@c0 _src<span class="token punctuation">]</span># mv apache<span class="token operator">-</span>hive<span class="token operator">-</span><span class="token number">2.3</span><span class="token number">.4</span><span class="token operator">-</span>bin <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_app<span class="token operator">/</span>hive<span class="token operator">-</span><span class="token number">2.3</span><span class="token number">.4</span>
</code></pre> 
<p>Scala-sbt2.12.8:</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 _src<span class="token punctuation">]</span># axel <span class="token operator">-</span>n <span class="token number">10</span> <span class="token operator">-</span>o <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_src<span class="token operator">/</span>scala<span class="token operator">-</span><span class="token number">2.12</span><span class="token number">.8</span><span class="token punctuation">.</span>tgz https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>downloads<span class="token punctuation">.</span>lightbend<span class="token punctuation">.</span>com<span class="token operator">/</span>scala<span class="token operator">/</span><span class="token number">2.12</span><span class="token number">.8</span><span class="token operator">/</span>scala<span class="token operator">-</span><span class="token number">2.12</span><span class="token number">.8</span><span class="token punctuation">.</span>tgz
<span class="token punctuation">[</span>root@c0 _src<span class="token punctuation">]</span># tar <span class="token operator">-</span>xzvf scala<span class="token operator">-</span><span class="token number">2.12</span><span class="token number">.8</span><span class="token punctuation">.</span>tgz
<span class="token punctuation">[</span>root@c0 _src<span class="token punctuation">]</span># mv scala<span class="token operator">-</span><span class="token number">2.12</span><span class="token number">.8</span> <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_app<span class="token operator">/</span>scala<span class="token operator">-</span><span class="token number">2.12</span><span class="token number">.8</span>
</code></pre> 
<p>Spark2.4.0:</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 _src<span class="token punctuation">]</span># axel <span class="token operator">-</span>n <span class="token number">10</span> <span class="token operator">-</span>o <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_src<span class="token operator">/</span>spark<span class="token operator">-</span><span class="token number">2.4</span><span class="token number">.0</span><span class="token operator">-</span>bin<span class="token operator">-</span>hadoop2<span class="token punctuation">.</span><span class="token number">7.</span>tgz https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>archive<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>org<span class="token operator">/</span>dist<span class="token operator">/</span>spark<span class="token operator">/</span>spark<span class="token operator">-</span><span class="token number">2.4</span><span class="token number">.0</span><span class="token operator">/</span>spark<span class="token operator">-</span><span class="token number">2.4</span><span class="token number">.0</span><span class="token operator">-</span>bin<span class="token operator">-</span>hadoop2<span class="token punctuation">.</span><span class="token number">7.</span>tgz
<span class="token punctuation">[</span>root@c0 _src<span class="token punctuation">]</span># tar <span class="token operator">-</span>xzvf spark<span class="token operator">-</span><span class="token number">2.4</span><span class="token number">.0</span><span class="token operator">-</span>bin<span class="token operator">-</span>hadoop2<span class="token punctuation">.</span><span class="token number">7.</span>tgz
<span class="token punctuation">[</span>root@c0 _src<span class="token punctuation">]</span># mv spark<span class="token operator">-</span><span class="token number">2.4</span><span class="token number">.0</span><span class="token operator">-</span>bin<span class="token operator">-</span>hadoop2<span class="token punctuation">.</span><span class="token number">7</span> <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_app<span class="token operator">/</span>spark<span class="token operator">-</span><span class="token number">2.4</span><span class="token number">.0</span><span class="token operator">-</span>bin<span class="token operator">-</span>hadoop2<span class="token punctuation">.</span><span class="token number">7</span>
</code></pre> 
<p>3.3、设置环境变量<br>   在每一台机器上设置环境变量，运行以下命令</p> 
<pre><code class="prism language-c"><span class="token macro property"># Hadoop 3.1.2</span>
echo <span class="token string">"export HADOOP_HOME=/home/work/_app/hadoop-3.1.2"</span> <span class="token operator">&gt;&gt;</span> <span class="token operator">/</span>etc<span class="token operator">/</span>bashrc
echo <span class="token string">"export HADOOP_LOG_DIR=/home/work/_logs/hadoop-3.1.2"</span> <span class="token operator">&gt;&gt;</span> <span class="token operator">/</span>etc<span class="token operator">/</span>bashrc
echo <span class="token string">"export HADOOP_MAPRED_HOME=\$HADOOP_HOME"</span> <span class="token operator">&gt;&gt;</span> <span class="token operator">/</span>etc<span class="token operator">/</span>bashrc
echo <span class="token string">"export HADOOP_COMMON_HOME=\$HADOOP_HOME"</span> <span class="token operator">&gt;&gt;</span> <span class="token operator">/</span>etc<span class="token operator">/</span>bashrc
echo <span class="token string">"export HADOOP_HDFS_HOME=\$HADOOP_HOME"</span> <span class="token operator">&gt;&gt;</span> <span class="token operator">/</span>etc<span class="token operator">/</span>bashrc
echo <span class="token string">"export HADOOP_CONF_DIR=\$HADOOP_HOME/etc/hadoop"</span> <span class="token operator">&gt;&gt;</span> <span class="token operator">/</span>etc<span class="token operator">/</span>bashrc

<span class="token macro property"># Zookeeper 3.4.13</span>
echo <span class="token string">"export ZOOKEEPER_HOME=/home/work/_app/zookeeper-3.4.13"</span> <span class="token operator">&gt;&gt;</span> <span class="token operator">/</span>etc<span class="token operator">/</span>bashrc

<span class="token macro property"># JAVA </span>
echo <span class="token string">"export JAVA_HOME=/opt/jdk1.8.0_201"</span> <span class="token operator">&gt;&gt;</span> <span class="token operator">/</span>etc<span class="token operator">/</span>bashrc
echo <span class="token string">"export JRE_HOME=/opt/jdk1.8.0_201/jre"</span> <span class="token operator">&gt;&gt;</span> <span class="token operator">/</span>etc<span class="token operator">/</span>bashrc

<span class="token macro property"># HBase 1.4.9</span>
echo <span class="token string">"export HBASE_HOME=/home/work/_app/hbase-1.4.9"</span> <span class="token operator">&gt;&gt;</span> <span class="token operator">/</span>etc<span class="token operator">/</span>bashrc

<span class="token macro property"># Hive 2.3.4</span>
echo <span class="token string">"export HIVE_HOME=/home/work/_app/hive-2.3.4"</span> <span class="token operator">&gt;&gt;</span> <span class="token operator">/</span>etc<span class="token operator">/</span>bashrc
echo <span class="token string">"export HIVE_CONF_DIR=\$HIVE_HOME/conf"</span> <span class="token operator">&gt;&gt;</span> <span class="token operator">/</span>etc<span class="token operator">/</span>bashrc

<span class="token macro property"># Scala 2.12.8</span>
echo <span class="token string">"export SCALA_HOME=/home/work/_app/scala-2.12.8"</span> <span class="token operator">&gt;&gt;</span> <span class="token operator">/</span>etc<span class="token operator">/</span>bashrc

<span class="token macro property"># Spark 2.4</span>
echo <span class="token string">"export SPARK_HOME=/home/work/_app/spark-2.4.0-bin-hadoop2.7"</span> <span class="token operator">&gt;&gt;</span> <span class="token operator">/</span>etc<span class="token operator">/</span>bashrc

<span class="token macro property"># Path</span>
echo <span class="token string">"export PATH=\$PATH:\$JAVA_HOME/bin:\$JRE_HOME/bin:\$HADOOP_HOME/bin:\$HADOOP_HOME/sbin:\$ZOOKEEPER_HOME/bin:\$HBASE_HOME/bin:\$HIVE_HOME/bin:\$SCALA_HOME/bin:\$SPARK_HOME/bin:\$SPARK_HOME/sbin"</span> <span class="token operator">&gt;&gt;</span> <span class="token operator">/</span>etc<span class="token operator">/</span>bashrc
source <span class="token operator">/</span>etc<span class="token operator">/</span>bashrc
</code></pre> 
<ol start="4"><li>安装 Oracle JDK 1.8.0<br> 4.1 下载 Oracle JDK 1.8.0<br>   以下操作在每一台机器上都要安装</li></ol> 
<pre><code class="prism language-c">cd <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_src
wget <span class="token operator">--</span>no<span class="token operator">-</span>cookies <span class="token operator">--</span>no<span class="token operator">-</span>check<span class="token operator">-</span>certificate <span class="token operator">--</span>header <span class="token string">"Cookie: gpw_e24=http%3A%2F%2Fwww.oracle.com%2F; oraclelicense=accept-securebackup-cookie"</span> <span class="token string">"https://download.oracle.com/otn-pub/java/jdk/8u201-b09/42970487e3af4f5aa5bca3f542482c60/jdk-8u201-linux-x64.tar.gz"</span>
tar <span class="token operator">-</span>xzvf jdk<span class="token operator">-</span><span class="token number">8u</span><span class="token number">201</span><span class="token operator">-</span>linux<span class="token operator">-</span>x64<span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz
mv jdk1<span class="token punctuation">.</span><span class="token number">8.0</span>_201 <span class="token operator">/</span>opt<span class="token operator">/</span>
</code></pre> 
<p>4.2、配置 Oracle JDK 1.8.0<br>   alternatives 命令用于维护符号链接。此命令用于创建、删除、维护和显示有关包含备选系统的符号链接的信息。<br>   接下来让我们使用 alternatives 命令在您的系统上配置 Java。</p> 
<pre><code class="prism language-c">alternatives <span class="token operator">--</span>install <span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>java java <span class="token operator">/</span>opt<span class="token operator">/</span>jdk1<span class="token punctuation">.</span><span class="token number">8.0</span>_201<span class="token operator">/</span>bin<span class="token operator">/</span>java <span class="token number">2</span>
alternatives <span class="token operator">--</span>config java
</code></pre> 
<p>新安装的 Java 版本列在第1位，因此输入1并按 Enter 键</p> 
<pre><code class="prism language-c">There is <span class="token number">1</span> program that provides <span class="token string">'java'</span><span class="token punctuation">.</span>

  Selection    Command
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
<span class="token operator">*</span><span class="token operator">+</span> <span class="token number">1</span>           <span class="token operator">/</span>opt<span class="token operator">/</span>jdk1<span class="token punctuation">.</span><span class="token number">8.0</span>_201<span class="token operator">/</span>bin<span class="token operator">/</span>java

Enter to keep the current selection<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span><span class="token punctuation">,</span> or type selection number<span class="token punctuation">:</span> <span class="token number">1</span>
</code></pre> 
<p>JAVA 8已成功安装在您的系统上。我们还建议使用替代方法设置javac 和 jar 命令路径</p> 
<pre><code class="prism language-c">alternatives <span class="token operator">--</span>install <span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>jar jar <span class="token operator">/</span>opt<span class="token operator">/</span>jdk1<span class="token punctuation">.</span><span class="token number">8.0</span>_201<span class="token operator">/</span>bin<span class="token operator">/</span>jar <span class="token number">2</span>
alternatives <span class="token operator">--</span>install <span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>jar jar <span class="token operator">/</span>opt<span class="token operator">/</span>jdk1<span class="token punctuation">.</span><span class="token number">8.0</span>_201<span class="token operator">/</span>bin<span class="token operator">/</span>jar <span class="token number">2</span>
alternatives <span class="token operator">--</span>set jar <span class="token operator">/</span>opt<span class="token operator">/</span>jdk1<span class="token punctuation">.</span><span class="token number">8.0</span>_201<span class="token operator">/</span>bin<span class="token operator">/</span>jar
alternatives <span class="token operator">--</span>set javac <span class="token operator">/</span>opt<span class="token operator">/</span>jdk1<span class="token punctuation">.</span><span class="token number">8.0</span>_201<span class="token operator">/</span>bin<span class="token operator">/</span>javac
</code></pre> 
<p>java 和 javac 二进制文件在 PATH 环境变量下可用。您可以在系统中的任何位置使用它们。<br> 让我们通过执行以下命令检查系统上安装的 Java 运行时环境（JRE）版本。</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 _src<span class="token punctuation">]</span># java <span class="token operator">-</span>version
java version <span class="token string">"1.8.0_201"</span>
<span class="token function">Java</span><span class="token punctuation">(</span>TM<span class="token punctuation">)</span> SE Runtime Environment <span class="token punctuation">(</span>build <span class="token number">1.8</span><span class="token number">.0</span>_201<span class="token operator">-</span>b09<span class="token punctuation">)</span>
Java <span class="token function">HotSpot</span><span class="token punctuation">(</span>TM<span class="token punctuation">)</span> <span class="token number">64</span><span class="token operator">-</span>Bit Server VM <span class="token punctuation">(</span>build <span class="token number">25.201</span><span class="token operator">-</span>b09<span class="token punctuation">,</span> mixed mode<span class="token punctuation">)</span>
</code></pre> 
<p>5、安装 Zookeeper3.4.13<br> 5.1、修改配置文件 zoo.cfg<br>   创建 /home/work/_app/zookeeper-3.4.13/conf/zoo.cfg 文件编辑并保存，内容如下：</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># cat <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_app<span class="token operator">/</span>zookeeper<span class="token operator">-</span><span class="token number">3.4</span><span class="token number">.13</span><span class="token operator">/</span>conf<span class="token operator">/</span>zoo<span class="token punctuation">.</span>cfg
<span class="token macro property"># ZooKeeper使用的基本时间单位（以毫秒为单位）。它用于做心跳，最小会话超时将是tickTime的两倍。</span>
tickTime<span class="token operator">=</span><span class="token number">200</span>

# 存储内存数据库快照的位置，除非另有说明，否则指向数据库更新的事务日志。
dataDir<span class="token operator">=</span><span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_data<span class="token operator">/</span>zookeeper<span class="token operator">-</span><span class="token number">3.4</span><span class="token number">.13</span>

# 用于事务日志的不同目录。
dataLogDir<span class="token operator">=</span><span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_logs<span class="token operator">/</span>zookeeper<span class="token operator">-</span><span class="token number">3.4</span><span class="token number">.13</span>

# 侦听客户端连接的端口
clientPort<span class="token operator">=</span><span class="token number">2181</span>

# 表示在leader选举结束后，followers与leader同步需要的时间，如果followers比较多或者说leader的数据灰常多时，同步时间相应可能会增加，那么这个值也需要相应增加。当然，这个值也是follower和observer在开始同步leader的数据时的最大等待时间<span class="token punctuation">(</span>setSoTimeout<span class="token punctuation">)</span>
initLimit<span class="token operator">=</span><span class="token number">5</span>

# 表示follower和observer与leader交互时的最大等待时间，只不过是在与leader同步完毕之后，进入正常请求转发或ping等消息交互时的超时时间。
syncLimit<span class="token operator">=</span><span class="token number">2</span>

<span class="token macro property"># server.serverid=host:tickpot:electionport</span>
<span class="token macro property"># server：固定写法</span>
<span class="token macro property"># serverid：每个服务器的指定ID（必须处于1-255之间，必须每一台机器不能重复）</span>
<span class="token macro property"># host：主机名</span>
<span class="token macro property"># tickpot：心跳通信端口</span>
<span class="token macro property"># electionport：选举端口</span>
server<span class="token punctuation">.</span><span class="token number">1</span><span class="token operator">=</span>c0<span class="token punctuation">:</span><span class="token number">2888</span><span class="token punctuation">:</span><span class="token number">3888</span>
server<span class="token punctuation">.</span><span class="token number">2</span><span class="token operator">=</span>c1<span class="token punctuation">:</span><span class="token number">2888</span><span class="token punctuation">:</span><span class="token number">3888</span>
server<span class="token punctuation">.</span><span class="token number">3</span><span class="token operator">=</span>c2<span class="token punctuation">:</span><span class="token number">2888</span><span class="token punctuation">:</span><span class="token number">3888</span>
server<span class="token punctuation">.</span><span class="token number">4</span><span class="token operator">=</span>c3<span class="token punctuation">:</span><span class="token number">2888</span><span class="token punctuation">:</span><span class="token number">3888</span>
</code></pre> 
<p>将 zookeeper 复制到其他机器上</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 _src<span class="token punctuation">]</span># <span class="token keyword">for</span> N in $<span class="token punctuation">(</span>seq <span class="token number">1</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">do</span> scp <span class="token operator">-</span>r <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_app<span class="token operator">/</span>zookeeper<span class="token operator">-</span><span class="token number">3.4</span><span class="token number">.13</span> c$N<span class="token punctuation">:</span><span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_app<span class="token operator">/</span><span class="token punctuation">;</span> done<span class="token punctuation">;</span>
</code></pre> 
<p>5.2、为每台服务器创建身份标识<br>   通过创建名为 myid 的文件将每台服务器标识身份，每个服务器对应一个文件，用于服务器快速选举，该文件位于配置文件 /home/work/_app/zookeeper-3.4.13/conf/zoo.cfg 中的 dataDir 配置项中。<br>   接下来，我们在配置文件 /home/work/_app/zookeeper-3.4.13/conf/zoo.cfg 中配置的 dataDir 目录，创建 myid 文件，内容为 server. 后面的数字，记住只能是数字：</p> 
<pre><code class="prism language-c"><span class="token macro property"># c0</span>
<span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># echo <span class="token number">1</span> <span class="token operator">&gt;</span> <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_data<span class="token operator">/</span>zookeeper<span class="token operator">-</span><span class="token number">3.4</span><span class="token number">.13</span><span class="token operator">/</span>myid

<span class="token macro property"># c1</span>
<span class="token punctuation">[</span>root@c1 <span class="token operator">~</span><span class="token punctuation">]</span># echo <span class="token number">2</span> <span class="token operator">&gt;</span> <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_data<span class="token operator">/</span>zookeeper<span class="token operator">-</span><span class="token number">3.4</span><span class="token number">.13</span><span class="token operator">/</span>myid

<span class="token macro property"># c2</span>
<span class="token punctuation">[</span>root@c2 <span class="token operator">~</span><span class="token punctuation">]</span># echo <span class="token number">3</span> <span class="token operator">&gt;</span> <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_data<span class="token operator">/</span>zookeeper<span class="token operator">-</span><span class="token number">3.4</span><span class="token number">.13</span><span class="token operator">/</span>myid

<span class="token macro property"># c3</span>
<span class="token punctuation">[</span>root@c3 <span class="token operator">~</span><span class="token punctuation">]</span># echo <span class="token number">4</span> <span class="token operator">&gt;</span> <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_data<span class="token operator">/</span>zookeeper<span class="token operator">-</span><span class="token number">3.4</span><span class="token number">.13</span><span class="token operator">/</span>myid
  
</code></pre> 
<p>5.3、在所有节点中启动 zookeeper<br>   在典型部署中，ZooKeeper 守护程序配置为在三个或五个节点上运行。由于 ZooKeeper 本身具有轻量级资源要求，因此可以在与 HDFS NameNode 和备用节点相同的硬件上配置 ZooKeeper 节点。<br>   许多运营商选择在与 YARN ResourceManager 相同的节点上部署第三个 ZooKeeper 进程。建议将ZooKeeper 节点配置为将数据存储在与 HDFS 元数据不同的磁盘驱动器上，以获得最佳性能和隔离。<br>   接下来我们在所有机器上运行 zkServer.sh start 命令启动服务，然后输入 JPS 命令，在所有节点中，您将看到 QuorumPeerMain 服务。</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># <span class="token keyword">for</span> N in $<span class="token punctuation">(</span>seq <span class="token number">0</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">do</span> ssh c$N zkServer<span class="token punctuation">.</span>sh start<span class="token punctuation">;</span> done<span class="token punctuation">;</span>
ZooKeeper JMX enabled by <span class="token keyword">default</span>
Using config<span class="token punctuation">:</span> <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_app<span class="token operator">/</span>zookeeper<span class="token operator">-</span><span class="token number">3.4</span><span class="token number">.13</span><span class="token operator">/</span>bin<span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>conf<span class="token operator">/</span>zoo<span class="token punctuation">.</span>cfg
Starting zookeeper <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> STARTED
ZooKeeper JMX enabled by <span class="token keyword">default</span>
Using config<span class="token punctuation">:</span> <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_app<span class="token operator">/</span>zookeeper<span class="token operator">-</span><span class="token number">3.4</span><span class="token number">.13</span><span class="token operator">/</span>bin<span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>conf<span class="token operator">/</span>zoo<span class="token punctuation">.</span>cfg
Starting zookeeper <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> STARTED
ZooKeeper JMX enabled by <span class="token keyword">default</span>
Using config<span class="token punctuation">:</span> <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_app<span class="token operator">/</span>zookeeper<span class="token operator">-</span><span class="token number">3.4</span><span class="token number">.13</span><span class="token operator">/</span>bin<span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>conf<span class="token operator">/</span>zoo<span class="token punctuation">.</span>cfg
Starting zookeeper <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> STARTED
ZooKeeper JMX enabled by <span class="token keyword">default</span>
Using config<span class="token punctuation">:</span> <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_app<span class="token operator">/</span>zookeeper<span class="token operator">-</span><span class="token number">3.4</span><span class="token number">.13</span><span class="token operator">/</span>bin<span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>conf<span class="token operator">/</span>zoo<span class="token punctuation">.</span>cfg
Starting zookeeper <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> STARTED
<span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># <span class="token keyword">for</span> N in $<span class="token punctuation">(</span>seq <span class="token number">0</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">do</span> ssh c$N jps<span class="token punctuation">;</span> done<span class="token punctuation">;</span>
<span class="token number">14020</span> Jps
<span class="token number">13980</span> QuorumPeerMain
<span class="token number">13922</span> QuorumPeerMain
<span class="token number">13957</span> Jps
<span class="token number">13681</span> Jps
<span class="token number">13639</span> QuorumPeerMain
<span class="token number">4541</span> QuorumPeerMain
<span class="token number">4575</span> Jps
</code></pre> 
<p>Zookeeper 的停止命令为:zkServer.sh stop</p> 
<p>5.4、查看zookeeper 运行状态<br>   通过 zkServer.sh status 命令，可以看到在 c2 上是 leader，其他机器是 follower</p> 
<pre><code class="prism language-c"><span class="token macro property"># c0</span>
<span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># zkServer<span class="token punctuation">.</span>sh status
ZooKeeper JMX enabled by <span class="token keyword">default</span>
Using config<span class="token punctuation">:</span> <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_app<span class="token operator">/</span>zookeeper<span class="token operator">-</span><span class="token number">3.4</span><span class="token number">.13</span><span class="token operator">/</span>bin<span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>conf<span class="token operator">/</span>zoo<span class="token punctuation">.</span>cfg
Mode<span class="token punctuation">:</span> follower

<span class="token macro property"># c1</span>
<span class="token punctuation">[</span>root@c1 <span class="token operator">~</span><span class="token punctuation">]</span># <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_app<span class="token operator">/</span>zookeeper<span class="token operator">-</span><span class="token number">3.4</span><span class="token number">.13</span><span class="token operator">/</span>bin<span class="token operator">/</span>zkServer<span class="token punctuation">.</span>sh status
ZooKeeper JMX enabled by <span class="token keyword">default</span>
Using config<span class="token punctuation">:</span> <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_app<span class="token operator">/</span>zookeeper<span class="token operator">-</span><span class="token number">3.4</span><span class="token number">.13</span><span class="token operator">/</span>bin<span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>conf<span class="token operator">/</span>zoo<span class="token punctuation">.</span>cfg
Mode<span class="token punctuation">:</span> follower

<span class="token macro property"># c2</span>
<span class="token punctuation">[</span>root@c2 <span class="token operator">~</span><span class="token punctuation">]</span># <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_app<span class="token operator">/</span>zookeeper<span class="token operator">-</span><span class="token number">3.4</span><span class="token number">.13</span><span class="token operator">/</span>bin<span class="token operator">/</span>zkServer<span class="token punctuation">.</span>sh status
ZooKeeper JMX enabled by <span class="token keyword">default</span>
Using config<span class="token punctuation">:</span> <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_app<span class="token operator">/</span>zookeeper<span class="token operator">-</span><span class="token number">3.4</span><span class="token number">.13</span><span class="token operator">/</span>bin<span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>conf<span class="token operator">/</span>zoo<span class="token punctuation">.</span>cfg
Mode<span class="token punctuation">:</span> leader

<span class="token macro property"># c3</span>
<span class="token punctuation">[</span>root@c3 <span class="token operator">~</span><span class="token punctuation">]</span># <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_app<span class="token operator">/</span>zookeeper<span class="token operator">-</span><span class="token number">3.4</span><span class="token number">.13</span><span class="token operator">/</span>bin<span class="token operator">/</span>zkServer<span class="token punctuation">.</span>sh status
ZooKeeper JMX enabled by <span class="token keyword">default</span>
Using config<span class="token punctuation">:</span> <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_app<span class="token operator">/</span>zookeeper<span class="token operator">-</span><span class="token number">3.4</span><span class="token number">.13</span><span class="token operator">/</span>bin<span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>conf<span class="token operator">/</span>zoo<span class="token punctuation">.</span>cfg
Error contacting service<span class="token punctuation">.</span> It is probably not running<span class="token punctuation">.</span>
</code></pre> 
<p>5.5、测试 Zookeeper 是否启动成功<br>   使用ZK CLI进行连接来验证，是否安装成功</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># zkCli<span class="token punctuation">.</span>sh
Connecting to localhost<span class="token punctuation">:</span><span class="token number">2181</span>
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">12</span> <span class="token number">01</span><span class="token punctuation">:</span><span class="token number">25</span><span class="token punctuation">:</span><span class="token number">21</span><span class="token punctuation">,</span><span class="token number">986</span> <span class="token punctuation">[</span>myid<span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">-</span> INFO  <span class="token punctuation">[</span>main<span class="token punctuation">:</span>Environment@<span class="token number">100</span><span class="token punctuation">]</span> <span class="token operator">-</span> Client environment<span class="token punctuation">:</span>zookeeper<span class="token punctuation">.</span>version<span class="token operator">=</span><span class="token number">3.4</span><span class="token number">.13</span><span class="token operator">-</span><span class="token number">2</span>d71af4dbe22557fda74f9a9b4309b15a7487f03<span class="token punctuation">,</span> built on <span class="token number">06</span><span class="token operator">/</span><span class="token number">29</span><span class="token operator">/</span><span class="token number">2018</span> <span class="token number">04</span><span class="token punctuation">:</span><span class="token number">05</span> GMT
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">12</span> <span class="token number">01</span><span class="token punctuation">:</span><span class="token number">25</span><span class="token punctuation">:</span><span class="token number">21</span><span class="token punctuation">,</span><span class="token number">991</span> <span class="token punctuation">[</span>myid<span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">-</span> INFO  <span class="token punctuation">[</span>main<span class="token punctuation">:</span>Environment@<span class="token number">100</span><span class="token punctuation">]</span> <span class="token operator">-</span> Client environment<span class="token punctuation">:</span>host<span class="token punctuation">.</span>name<span class="token operator">=</span>c0
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">12</span> <span class="token number">01</span><span class="token punctuation">:</span><span class="token number">25</span><span class="token punctuation">:</span><span class="token number">21</span><span class="token punctuation">,</span><span class="token number">991</span> <span class="token punctuation">[</span>myid<span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">-</span> INFO  <span class="token punctuation">[</span>main<span class="token punctuation">:</span>Environment@<span class="token number">100</span><span class="token punctuation">]</span> <span class="token operator">-</span> Client environment<span class="token punctuation">:</span>java<span class="token punctuation">.</span>version<span class="token operator">=</span><span class="token number">1.8</span><span class="token number">.0</span>_201
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">12</span> <span class="token number">01</span><span class="token punctuation">:</span><span class="token number">25</span><span class="token punctuation">:</span><span class="token number">21</span><span class="token punctuation">,</span><span class="token number">994</span> <span class="token punctuation">[</span>myid<span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">-</span> INFO  <span class="token punctuation">[</span>main<span class="token punctuation">:</span>Environment@<span class="token number">100</span><span class="token punctuation">]</span> <span class="token operator">-</span> Client environment<span class="token punctuation">:</span>java<span class="token punctuation">.</span>vendor<span class="token operator">=</span>Oracle Corporation
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">12</span> <span class="token number">01</span><span class="token punctuation">:</span><span class="token number">25</span><span class="token punctuation">:</span><span class="token number">21</span><span class="token punctuation">,</span><span class="token number">994</span> <span class="token punctuation">[</span>myid<span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">-</span> INFO  <span class="token punctuation">[</span>main<span class="token punctuation">:</span>Environment@<span class="token number">100</span><span class="token punctuation">]</span> <span class="token operator">-</span> Client environment<span class="token punctuation">:</span>java<span class="token punctuation">.</span>home<span class="token operator">=</span><span class="token operator">/</span>opt<span class="token operator">/</span>jdk1<span class="token punctuation">.</span><span class="token number">8.0</span>_201<span class="token operator">/</span>jre
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">12</span> <span class="token number">01</span><span class="token punctuation">:</span><span class="token number">25</span><span class="token punctuation">:</span><span class="token number">21</span><span class="token punctuation">,</span><span class="token number">994</span> <span class="token punctuation">[</span>myid<span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">-</span> INFO  <span class="token punctuation">[</span>main<span class="token punctuation">:</span>Environment@<span class="token number">100</span><span class="token punctuation">]</span> <span class="token operator">-</span> Client environment<span class="token punctuation">:</span>java<span class="token punctuation">.</span>class<span class="token punctuation">.</span>path<span class="token operator">=</span><span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_app<span class="token operator">/</span>zookeeper<span class="token operator">-</span><span class="token number">3.4</span><span class="token number">.13</span><span class="token operator">/</span>bin<span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>build<span class="token operator">/</span>classes<span class="token punctuation">:</span><span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_app<span class="token operator">/</span>zookeeper<span class="token operator">-</span><span class="token number">3.4</span><span class="token number">.13</span><span class="token operator">/</span>bin<span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>build<span class="token operator">/</span>lib<span class="token comment">/*.jar:/home/work/_app/zookeeper-3.4.13/bin/../lib/slf4j-log4j12-1.7.25.jar:/home/work/_app/zookeeper-3.4.13/bin/../lib/slf4j-api-1.7.25.jar:/home/work/_app/zookeeper-3.4.13/bin/../lib/netty-3.10.6.Final.jar:/home/work/_app/zookeeper-3.4.13/bin/../lib/log4j-1.2.17.jar:/home/work/_app/zookeeper-3.4.13/bin/../lib/jline-0.9.94.jar:/home/work/_app/zookeeper-3.4.13/bin/../lib/audience-annotations-0.5.0.jar:/home/work/_app/zookeeper-3.4.13/bin/../zookeeper-3.4.13.jar:/home/work/_app/zookeeper-3.4.13/bin/../src/java/lib/*.jar:/home/work/_app/zookeeper-3.4.13/bin/../conf:
2019-02-12 01:25:21,994 [myid:] - INFO  [main:Environment@100] - Client environment:java.library.path=/usr/java/packages/lib/amd64:/usr/lib64:/lib64:/lib:/usr/lib
2019-02-12 01:25:21,994 [myid:] - INFO  [main:Environment@100] - Client environment:java.io.tmpdir=/tmp
2019-02-12 01:25:21,994 [myid:] - INFO  [main:Environment@100] - Client environment:java.compiler=&lt;NA&gt;
2019-02-12 01:25:21,994 [myid:] - INFO  [main:Environment@100] - Client environment:os.name=Linux
2019-02-12 01:25:21,994 [myid:] - INFO  [main:Environment@100] - Client environment:os.arch=amd64
2019-02-12 01:25:21,995 [myid:] - INFO  [main:Environment@100] - Client environment:os.version=4.20.7-1.el7.elrepo.x86_64
2019-02-12 01:25:21,995 [myid:] - INFO  [main:Environment@100] - Client environment:user.name=root
2019-02-12 01:25:21,995 [myid:] - INFO  [main:Environment@100] - Client environment:user.home=/root
2019-02-12 01:25:21,995 [myid:] - INFO  [main:Environment@100] - Client environment:user.dir=/root
2019-02-12 01:25:21,996 [myid:] - INFO  [main:ZooKeeper@442] - Initiating client connection, connectString=localhost:2181 sessionTimeout=30000 watcher=org.apache.zookeeper.ZooKeeperMain$MyWatcher@5ce65a89
Welcome to ZooKeeper!
2019-02-12 01:25:22,024 [myid:] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@1029] - Opening socket connection to server localhost/0:0:0:0:0:0:0:1:2181. Will not attempt to authenticate using SASL (unknown error)
JLine support is enabled
2019-02-12 01:25:22,089 [myid:] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@879] - Socket connection established to localhost/0:0:0:0:0:0:0:1:2181, initiating session
2019-02-12 01:25:22,103 [myid:] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@1303] - Session establishment complete on server localhost/0:0:0:0:0:0:0:1:2181, sessionid = 0x100008909040002, negotiated timeout = 30000

WATCHER::

WatchedEvent state:SyncConnected type:None path:null
[zk: localhost:2181(CONNECTED) 0] ls /
[zookeeper]
[zk: localhost:2181(CONNECTED) 1] quit
Quitting...
2019-02-12 01:25:24,897 [myid:] - INFO  [main:ZooKeeper@693] - Session: 0x100008909040002 closed
2019-02-12 01:25:24,899 [myid:] - INFO  [main-EventThread:ClientCnxn$EventThread@522] - EventThread shut down for session: 0x100008909040002
  
</span></code></pre> 
<p>6、安装 Hadoop3.1.2<br> 6.1、修改 Hadoop 配置文件<br> 6.1.1、修改配置文件 core-site.xml<br>   编译 /home/work/_app/hadoop-3.1.2/etc/hadoop/core-site.xml 文件，内容如下：</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># cat <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_app<span class="token operator">/</span>hadoop<span class="token operator">-</span><span class="token number">3.1</span><span class="token number">.2</span><span class="token operator">/</span>etc<span class="token operator">/</span>hadoop<span class="token operator">/</span>core<span class="token operator">-</span>site<span class="token punctuation">.</span>xml
<span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">"1.0"</span> encoding<span class="token operator">=</span><span class="token string">"UTF-8"</span><span class="token operator">?</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">?</span>xml<span class="token operator">-</span>stylesheet type<span class="token operator">=</span><span class="token string">"text/xsl"</span> href<span class="token operator">=</span><span class="token string">"configuration.xsl"</span><span class="token operator">?</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>
  Licensed under the Apache License<span class="token punctuation">,</span> Version <span class="token number">2.0</span> <span class="token punctuation">(</span>the <span class="token string">"License"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  you may not use this file except in compliance with the License<span class="token punctuation">.</span>
  You may obtain a copy of the License at

    http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>org<span class="token operator">/</span>licenses<span class="token operator">/</span>LICENSE<span class="token operator">-</span><span class="token number">2.0</span>

  Unless required by applicable law or agreed to in writing<span class="token punctuation">,</span> software
  distributed under the License is distributed on an <span class="token string">"AS IS"</span> BASIS<span class="token punctuation">,</span>
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND<span class="token punctuation">,</span> either express or implied<span class="token punctuation">.</span>
  See the License <span class="token keyword">for</span> the specific language governing permissions and
  limitations under the License<span class="token punctuation">.</span> See accompanying LICENSE file<span class="token punctuation">.</span>
<span class="token operator">--</span><span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> Put site<span class="token operator">-</span>specific property overrides in this file<span class="token punctuation">.</span> <span class="token operator">--</span><span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>configuration<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>fs<span class="token punctuation">.</span>defaultFS<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>hdfs<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>mshkcluster<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>默认文件系统的名称。一个URI，其方案和权限决定了FileSystem的实现。<span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>ha<span class="token punctuation">.</span>zookeeper<span class="token punctuation">.</span>quorum<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>c0<span class="token punctuation">:</span><span class="token number">2181</span><span class="token punctuation">,</span>c1<span class="token punctuation">:</span><span class="token number">2181</span><span class="token punctuation">,</span>c2<span class="token punctuation">:</span><span class="token number">2181</span><span class="token punctuation">,</span>c3<span class="token punctuation">:</span><span class="token number">2181</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>由逗号分隔的ZooKeeper服务器地址列表，由ZKFailoverController在自动故障转移中使用。<span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>hadoop<span class="token punctuation">.</span>tmp<span class="token punctuation">.</span>dir<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_data<span class="token operator">/</span>hadoop<span class="token operator">-</span><span class="token number">3.1</span><span class="token number">.2</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>数据目录目录<span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>dfs<span class="token punctuation">.</span>ha<span class="token punctuation">.</span>fencing<span class="token punctuation">.</span>methods<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>sshfence<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>用于服务防护的防护方法列表。可能包含内置方法（例如shell和sshfence）或用户定义的方法。<span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>dfs<span class="token punctuation">.</span>ha<span class="token punctuation">.</span>fencing<span class="token punctuation">.</span>ssh<span class="token punctuation">.</span>private<span class="token operator">-</span>key<span class="token operator">-</span>files<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token operator">/</span>root<span class="token operator">/</span><span class="token punctuation">.</span>ssh<span class="token operator">/</span>id_rsa<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>用于内置sshfence fencer的SSH私钥文件。<span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>io<span class="token punctuation">.</span>file<span class="token punctuation">.</span>buffer<span class="token punctuation">.</span>size<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token number">131072</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>SequenceFiles中使用的读<span class="token operator">/</span>写缓冲区的大小。<span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>ipc<span class="token punctuation">.</span>client<span class="token punctuation">.</span>connect<span class="token punctuation">.</span>max<span class="token punctuation">.</span>retries<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token number">100</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>客户端为建立服务器连接而重试的次数。<span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>ipc<span class="token punctuation">.</span>client<span class="token punctuation">.</span>connect<span class="token punctuation">.</span>retry<span class="token punctuation">.</span>interval<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token number">10000</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>客户端在重试建立服务器连接之前将等待的毫秒数。<span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>configuration<span class="token operator">&gt;</span>
  
</code></pre> 
<p>6.1.2、修改配置文件 hdfs-site.xml<br>   编辑 /home/work/_app/hadoop-3.1.2/etc/hadoop/hdfs-site.xml 文件并保存，内容如下：</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># cat <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_app<span class="token operator">/</span>hadoop<span class="token operator">-</span><span class="token number">3.1</span><span class="token number">.2</span><span class="token operator">/</span>etc<span class="token operator">/</span>hadoop<span class="token operator">/</span>hdfs<span class="token operator">-</span>site<span class="token punctuation">.</span>xml
<span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">"1.0"</span> encoding<span class="token operator">=</span><span class="token string">"UTF-8"</span><span class="token operator">?</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">?</span>xml<span class="token operator">-</span>stylesheet type<span class="token operator">=</span><span class="token string">"text/xsl"</span> href<span class="token operator">=</span><span class="token string">"configuration.xsl"</span><span class="token operator">?</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>
  Licensed under the Apache License<span class="token punctuation">,</span> Version <span class="token number">2.0</span> <span class="token punctuation">(</span>the <span class="token string">"License"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  you may not use this file except in compliance with the License<span class="token punctuation">.</span>
  You may obtain a copy of the License at

    http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>org<span class="token operator">/</span>licenses<span class="token operator">/</span>LICENSE<span class="token operator">-</span><span class="token number">2.0</span>

  Unless required by applicable law or agreed to in writing<span class="token punctuation">,</span> software
  distributed under the License is distributed on an <span class="token string">"AS IS"</span> BASIS<span class="token punctuation">,</span>
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND<span class="token punctuation">,</span> either express or implied<span class="token punctuation">.</span>
  See the License <span class="token keyword">for</span> the specific language governing permissions and
  limitations under the License<span class="token punctuation">.</span> See accompanying LICENSE file<span class="token punctuation">.</span>
<span class="token operator">--</span><span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> Put site<span class="token operator">-</span>specific property overrides in this file<span class="token punctuation">.</span> <span class="token operator">--</span><span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>configuration<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>dfs<span class="token punctuation">.</span>nameservices<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>mshkcluster<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>dfs<span class="token punctuation">.</span>ha<span class="token punctuation">.</span>namenodes<span class="token punctuation">.</span>mshkcluster<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>c0<span class="token punctuation">,</span>c1<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>给定名称服务的前缀包含给定名称服务的逗号分隔的名称节点列表。<span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>dfs<span class="token punctuation">.</span>namenode<span class="token punctuation">.</span>rpc<span class="token operator">-</span>address<span class="token punctuation">.</span>mshkcluster<span class="token punctuation">.</span>c0<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>c0<span class="token punctuation">:</span><span class="token number">8020</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>dfs<span class="token punctuation">.</span>namenode<span class="token punctuation">.</span>rpc<span class="token operator">-</span>address<span class="token punctuation">.</span>mshkcluster<span class="token punctuation">.</span>c1<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>c1<span class="token punctuation">:</span><span class="token number">8020</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>dfs<span class="token punctuation">.</span>namenode<span class="token punctuation">.</span>http<span class="token operator">-</span>address<span class="token punctuation">.</span>mshkcluster<span class="token punctuation">.</span>c0<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>c0<span class="token punctuation">:</span><span class="token number">50070</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>dfs<span class="token punctuation">.</span>namenode<span class="token punctuation">.</span>http<span class="token operator">-</span>address<span class="token punctuation">.</span>mshkcluster<span class="token punctuation">.</span>c1<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>c1<span class="token punctuation">:</span><span class="token number">50070</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>dfs<span class="token punctuation">.</span>namenode<span class="token punctuation">.</span>shared<span class="token punctuation">.</span>edits<span class="token punctuation">.</span>dir<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>qjournal<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>c0<span class="token punctuation">:</span><span class="token number">8485</span><span class="token punctuation">;</span>c1<span class="token punctuation">:</span><span class="token number">8485</span><span class="token operator">/</span>mshkcluster<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>HA群集中多个名称节点之间的共享存储上的目录。此目录将由活动写入并由备用数据库读取，以保持命名空间同步。<span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>dfs<span class="token punctuation">.</span>client<span class="token punctuation">.</span>failover<span class="token punctuation">.</span>proxy<span class="token punctuation">.</span>provider<span class="token punctuation">.</span>mshkcluster<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hdfs<span class="token punctuation">.</span>server<span class="token punctuation">.</span>namenode<span class="token punctuation">.</span>ha<span class="token punctuation">.</span>ConfiguredFailoverProxyProvider<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>配置Java类的名称，DFS客户端将使用该名称来确定哪个NameNode是当前的Active，以及哪个NameNode当前正在为客户端请求提供服务。<span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>dfs<span class="token punctuation">.</span>ha<span class="token punctuation">.</span>automatic<span class="token operator">-</span>failover<span class="token punctuation">.</span>enabled<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>true<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>是否启用自动故障转移。<span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>dfs<span class="token punctuation">.</span>replication<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token number">3</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>dfs<span class="token punctuation">.</span>permissions<span class="token punctuation">.</span>enabled<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>false<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>如果为“true”，则启用HDFS中的权限检查。如果为“false”，则关闭权限检查，但所有其他行为都保持不变。<span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>dfs<span class="token punctuation">.</span>journalnode<span class="token punctuation">.</span>edits<span class="token punctuation">.</span>dir<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>$<span class="token punctuation">{<!-- --></span>hadoop<span class="token punctuation">.</span>tmp<span class="token punctuation">.</span>dir<span class="token punctuation">}</span><span class="token operator">/</span>journalnode<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>指定JournalNode在本地磁盘存放数据的位置<span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>dfs<span class="token punctuation">.</span>namenode<span class="token punctuation">.</span>name<span class="token punctuation">.</span>dir<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>file<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>$<span class="token punctuation">{<!-- --></span>hadoop<span class="token punctuation">.</span>tmp<span class="token punctuation">.</span>dir<span class="token punctuation">}</span><span class="token operator">/</span>namenode<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>设置namenode存放路径<span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>dfs<span class="token punctuation">.</span>datanode<span class="token punctuation">.</span>data<span class="token punctuation">.</span>dir<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>file<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>$<span class="token punctuation">{<!-- --></span>hadoop<span class="token punctuation">.</span>tmp<span class="token punctuation">.</span>dir<span class="token punctuation">}</span><span class="token operator">/</span>datanode<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>设置datanode存放径路<span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>dfs<span class="token punctuation">.</span>blocksize<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token number">268435456</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>大型文件系统的HDFS块大小为<span class="token number">256</span>MB。<span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>dfs<span class="token punctuation">.</span>namenode<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>count<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token number">100</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>namenode的服务器线程数<span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>configuration<span class="token operator">&gt;</span>
</code></pre> 
<p>6.1.3、修改配置文件 mapred-site.xml<br>   编辑 /home/work/_app/hadoop-3.1.2/etc/hadoop/mapred-site.xml 文件并保存，内容如下：</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 _src<span class="token punctuation">]</span># cat <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_app<span class="token operator">/</span>hadoop<span class="token operator">-</span><span class="token number">3.1</span><span class="token number">.2</span><span class="token operator">/</span>etc<span class="token operator">/</span>hadoop<span class="token operator">/</span>mapred<span class="token operator">-</span>site<span class="token punctuation">.</span>xml
<span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">"1.0"</span><span class="token operator">?</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">?</span>xml<span class="token operator">-</span>stylesheet type<span class="token operator">=</span><span class="token string">"text/xsl"</span> href<span class="token operator">=</span><span class="token string">"configuration.xsl"</span><span class="token operator">?</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>
  Licensed under the Apache License<span class="token punctuation">,</span> Version <span class="token number">2.0</span> <span class="token punctuation">(</span>the <span class="token string">"License"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  you may not use this file except in compliance with the License<span class="token punctuation">.</span>
  You may obtain a copy of the License at

    http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>org<span class="token operator">/</span>licenses<span class="token operator">/</span>LICENSE<span class="token operator">-</span><span class="token number">2.0</span>

  Unless required by applicable law or agreed to in writing<span class="token punctuation">,</span> software
  distributed under the License is distributed on an <span class="token string">"AS IS"</span> BASIS<span class="token punctuation">,</span>
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND<span class="token punctuation">,</span> either express or implied<span class="token punctuation">.</span>
  See the License <span class="token keyword">for</span> the specific language governing permissions and
  limitations under the License<span class="token punctuation">.</span> See accompanying LICENSE file<span class="token punctuation">.</span>
<span class="token operator">--</span><span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> Put site<span class="token operator">-</span>specific property overrides in this file<span class="token punctuation">.</span> <span class="token operator">--</span><span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>configuration<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>mapreduce<span class="token punctuation">.</span>framework<span class="token punctuation">.</span>name<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>yarn<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>指定mr框架为yarn方式<span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span> 
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>mapreduce<span class="token punctuation">.</span>map<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>mb<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span> 
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token number">512</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span> 
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>每个Map任务的物理内存限制<span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span> 
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span> 
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>mapreduce<span class="token punctuation">.</span>reduce<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>mb<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span> 
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token number">512</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span> 
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>每个Reduce任务的物理内存限制<span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span> 
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span> 
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>mapreduce<span class="token punctuation">.</span>jobhistory<span class="token punctuation">.</span>address<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token number">0.0</span><span class="token number">.0</span><span class="token number">.0</span><span class="token punctuation">:</span><span class="token number">10020</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>MapReduce JobHistory服务器IPC主机：端口<span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>mapreduce<span class="token punctuation">.</span>jobhistory<span class="token punctuation">.</span>webapp<span class="token punctuation">.</span>address<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token number">0.0</span><span class="token number">.0</span><span class="token number">.0</span><span class="token punctuation">:</span><span class="token number">19888</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>MapReduce JobHistory服务器Web浏览时的主机：端口<span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>mapreduce<span class="token punctuation">.</span>application<span class="token punctuation">.</span>classpath<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>
          <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_app<span class="token operator">/</span>hadoop<span class="token operator">-</span><span class="token number">3.1</span><span class="token number">.2</span><span class="token operator">/</span>etc<span class="token operator">/</span>hadoop<span class="token punctuation">,</span>
          <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_app<span class="token operator">/</span>hadoop<span class="token operator">-</span><span class="token number">3.1</span><span class="token number">.2</span><span class="token operator">/</span>share<span class="token operator">/</span>hadoop<span class="token operator">/</span>common<span class="token comment">/*,
          /home/work/_app/hadoop-3.1.2/share/hadoop/common/lib/*,
          /home/work/_app/hadoop-3.1.2/share/hadoop/hdfs/*,
          /home/work/_app/hadoop-3.1.2/share/hadoop/hdfs/lib/*,
          /home/work/_app/hadoop-3.1.2/share/hadoop/mapreduce/*,
          /home/work/_app/hadoop-3.1.2/share/hadoop/mapreduce/lib/*,
          /home/work/_app/hadoop-3.1.2/share/hadoop/yarn/*,
          /home/work/_app/hadoop-3.1.2/share/hadoop/yarn/lib/*        
        &lt;/value&gt;
    &lt;/property&gt;
&lt;/configuration&gt;
</span></code></pre> 
<p>6.1.4、修改配置文件 capacity-scheduler.xml<br>   capacity-scheduler.xml主要对 hadoop 的队列进行管理，在这里我们分test、dev、prod三个队列。<br>   编辑 /home/work/_app/hadoop-3.1.2/etc/hadoop/capacity-scheduler.xml 文件并保存，内容如下：</p> 
<pre><code class="prism language-c"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>
  Licensed under the Apache License<span class="token punctuation">,</span> Version <span class="token number">2.0</span> <span class="token punctuation">(</span>the <span class="token string">"License"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  you may not use this file except in compliance with the License<span class="token punctuation">.</span>
  You may obtain a copy of the License at

    http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>org<span class="token operator">/</span>licenses<span class="token operator">/</span>LICENSE<span class="token operator">-</span><span class="token number">2.0</span>

  Unless required by applicable law or agreed to in writing<span class="token punctuation">,</span> software
  distributed under the License is distributed on an <span class="token string">"AS IS"</span> BASIS<span class="token punctuation">,</span>
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND<span class="token punctuation">,</span> either express or implied<span class="token punctuation">.</span>
  See the License <span class="token keyword">for</span> the specific language governing permissions and
  limitations under the License<span class="token punctuation">.</span> See accompanying LICENSE file<span class="token punctuation">.</span>
<span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>configuration<span class="token operator">&gt;</span>

  <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn<span class="token punctuation">.</span>scheduler<span class="token punctuation">.</span>capacity<span class="token punctuation">.</span>maximum<span class="token operator">-</span>applications<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token number">10000</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>
      系统中可以同时处于运行和挂起状态的最大应用程序数。
    <span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>

  <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn<span class="token punctuation">.</span>scheduler<span class="token punctuation">.</span>capacity<span class="token punctuation">.</span>maximum<span class="token operator">-</span>am<span class="token operator">-</span>resource<span class="token operator">-</span>percent<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token number">0.5</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>
      群集中可用于运行应用程序主机的最大资源百分比 <span class="token operator">-</span> 控制并发活动应用程序的数量。
每个队列的限制与其队列容量和用户限制成正比。
    <span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>

  <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn<span class="token punctuation">.</span>scheduler<span class="token punctuation">.</span>capacity<span class="token punctuation">.</span>resource<span class="token operator">-</span>calculator<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>yarn<span class="token punctuation">.</span>util<span class="token punctuation">.</span>resource<span class="token punctuation">.</span>DefaultResourceCalculator<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>
      The ResourceCalculator implementation to be used to compare
      Resources in the scheduler<span class="token punctuation">.</span>
      The <span class="token keyword">default</span> i<span class="token punctuation">.</span>e<span class="token punctuation">.</span> DefaultResourceCalculator only uses Memory <span class="token keyword">while</span>
      DominantResourceCalculator uses dominant<span class="token operator">-</span>resource to compare
      multi<span class="token operator">-</span>dimensional resources such as Memory<span class="token punctuation">,</span> CPU etc<span class="token punctuation">.</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>

  <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn<span class="token punctuation">.</span>scheduler<span class="token punctuation">.</span>capacity<span class="token punctuation">.</span>root<span class="token punctuation">.</span>queues<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>dev<span class="token punctuation">,</span>test<span class="token punctuation">,</span>prod<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>
      CapacityScheduler有一个名为root的预定义队列。系统中的所有队列都是根队列的子节点。可以通过使用逗号分隔的子队列列表配置yarn<span class="token punctuation">.</span>scheduler<span class="token punctuation">.</span>capacity<span class="token punctuation">.</span>root<span class="token punctuation">.</span>queues来设置更多队列。
    <span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>

  <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn<span class="token punctuation">.</span>scheduler<span class="token punctuation">.</span>capacity<span class="token punctuation">.</span>root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>capacity<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token number">10</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>每个级别的所有队列的容量总和必须等于<span class="token number">100.</span>如果有空闲资源，则队列中的应用程序可能比队列容量消耗更多资源，从而提供弹性。<span class="token punctuation">.</span><span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>

  <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn<span class="token punctuation">.</span>scheduler<span class="token punctuation">.</span>capacity<span class="token punctuation">.</span>root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>user<span class="token operator">-</span>limit<span class="token operator">-</span>factor<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>
      队列容量的倍数，可配置为允许单个用户获取更多资源。默认情况下，此值设置为<span class="token number">1</span>可确保单个用户永远不会超过队列配置的容量，无论群集的空闲程度如何。
    <span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>

  <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn<span class="token punctuation">.</span>scheduler<span class="token punctuation">.</span>capacity<span class="token punctuation">.</span>root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>maximum<span class="token operator">-</span>capacity<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token number">20</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>
      最大队列容量，以百分比（％）表示为浮点数。这限制了队列中应用程序的弹性。默认为<span class="token operator">-</span><span class="token number">1</span>，禁用它。
    <span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>

  <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn<span class="token punctuation">.</span>scheduler<span class="token punctuation">.</span>capacity<span class="token punctuation">.</span>root<span class="token punctuation">.</span>prod<span class="token punctuation">.</span>capacity<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token number">60</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>每个级别的所有队列的容量总和必须等于<span class="token number">100.</span>如果有空闲资源，则队列中的应用程序可能比队列容量消耗更多资源，从而提供弹性。<span class="token punctuation">.</span><span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>

  <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn<span class="token punctuation">.</span>scheduler<span class="token punctuation">.</span>capacity<span class="token punctuation">.</span>root<span class="token punctuation">.</span>prod<span class="token punctuation">.</span>user<span class="token operator">-</span>limit<span class="token operator">-</span>factor<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>
      队列容量的倍数，可配置为允许单个用户获取更多资源。默认情况下，此值设置为<span class="token number">1</span>可确保单个用户永远不会超过队列配置的容量，无论群集的空闲程度如何。
    <span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>

  <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn<span class="token punctuation">.</span>scheduler<span class="token punctuation">.</span>capacity<span class="token punctuation">.</span>root<span class="token punctuation">.</span>prod<span class="token punctuation">.</span>maximum<span class="token operator">-</span>capacity<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token number">70</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>
      最大队列容量，以百分比（％）表示为浮点数。这限制了队列中应用程序的弹性。默认为<span class="token operator">-</span><span class="token number">1</span>，禁用它。
    <span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>

  <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn<span class="token punctuation">.</span>scheduler<span class="token punctuation">.</span>capacity<span class="token punctuation">.</span>root<span class="token punctuation">.</span>prod<span class="token punctuation">.</span>state<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>RUNNING<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>
      队列的状态。可以是RUNNING或STOPPED之一。如果队列处于STOPPED状态，则无法将新应用程序提交给自身或其任何子队列。因此，如果根队列是STOPPED，则不能将任何应用程序提交给整个群集。
    <span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>



  <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn<span class="token punctuation">.</span>scheduler<span class="token punctuation">.</span>capacity<span class="token punctuation">.</span>root<span class="token punctuation">.</span>dev<span class="token punctuation">.</span>capacity<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token number">30</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>每个级别的所有队列的容量总和必须等于<span class="token number">100.</span>如果有空闲资源，则队列中的应用程序可能比队列容量消耗更多资源，从而提供弹性。<span class="token punctuation">.</span><span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>

  <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn<span class="token punctuation">.</span>scheduler<span class="token punctuation">.</span>capacity<span class="token punctuation">.</span>root<span class="token punctuation">.</span>dev<span class="token punctuation">.</span>user<span class="token operator">-</span>limit<span class="token operator">-</span>factor<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>
      队列容量的倍数，可配置为允许单个用户获取更多资源。默认情况下，此值设置为<span class="token number">1</span>可确保单个用户永远不会超过队列配置的容量，无论群集的空闲程度如何。
    <span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>

  <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn<span class="token punctuation">.</span>scheduler<span class="token punctuation">.</span>capacity<span class="token punctuation">.</span>root<span class="token punctuation">.</span>dev<span class="token punctuation">.</span>maximum<span class="token operator">-</span>capacity<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token number">40</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>
      最大队列容量，以百分比（％）表示为浮点数。这限制了队列中应用程序的弹性。默认为<span class="token operator">-</span><span class="token number">1</span>，禁用它。
    <span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>

  <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn<span class="token punctuation">.</span>scheduler<span class="token punctuation">.</span>capacity<span class="token punctuation">.</span>root<span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">.</span>acl_submit_applications<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token operator">*</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>
      The ACL of who can submit jobs to the <span class="token keyword">default</span> queue<span class="token punctuation">.</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>

  <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn<span class="token punctuation">.</span>scheduler<span class="token punctuation">.</span>capacity<span class="token punctuation">.</span>root<span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">.</span>acl_administer_queue<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token operator">*</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>
      The ACL of who can administer jobs on the <span class="token keyword">default</span> queue<span class="token punctuation">.</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>

  <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn<span class="token punctuation">.</span>scheduler<span class="token punctuation">.</span>capacity<span class="token punctuation">.</span>root<span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">.</span>acl_application_max_priority<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token operator">*</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>
      The ACL of who can submit applications with configured priority<span class="token punctuation">.</span>
      For e<span class="token punctuation">.</span>g<span class="token punctuation">,</span> <span class="token punctuation">[</span>user<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>name<span class="token punctuation">}</span> group<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>name<span class="token punctuation">}</span> max_priority<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>priority<span class="token punctuation">}</span> default_priority<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>priority<span class="token punctuation">}</span><span class="token punctuation">]</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
   <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
     <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn<span class="token punctuation">.</span>scheduler<span class="token punctuation">.</span>capacity<span class="token punctuation">.</span>root<span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">.</span>maximum<span class="token operator">-</span>application<span class="token operator">-</span>lifetime
     <span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
     <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
     <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>
        在几秒钟内提交到队列的应用程序的最长生命周期。任何小于或等于零的值都将被视为已禁用。对于此队列中的所有应用程序，这将是一个艰难的时间限制。如果配置了正值，那么提交到此队列的任何应用程序将在超过配置的生存期后被终止。用户还可以在应用程序提交上下文中指定每个应用程<span class="token punctuation">.</span>但如果超过队列最长生命周期，则会覆盖用户生命周期。
     <span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
   <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
   <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
     <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn<span class="token punctuation">.</span>scheduler<span class="token punctuation">.</span>capacity<span class="token punctuation">.</span>root<span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">.</span><span class="token keyword">default</span><span class="token operator">-</span>application<span class="token operator">-</span>lifetime
     <span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
     <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
     <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>
        在几秒钟内提交到队列的应用程序的默认生存期。任何小于或等于零的值都将被视为已禁用。如果用户尚未提交具有生命周期值的应用程序，则将采用此值。
     <span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
   <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn<span class="token punctuation">.</span>scheduler<span class="token punctuation">.</span>capacity<span class="token punctuation">.</span>node<span class="token operator">-</span>locality<span class="token operator">-</span>delay<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token number">40</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>
      Number of missed scheduling opportunities after which the CapacityScheduler
      attempts to schedule rack<span class="token operator">-</span>local containers<span class="token punctuation">.</span>
      When setting this parameter<span class="token punctuation">,</span> the size of the cluster should be taken into account<span class="token punctuation">.</span>
      We use <span class="token number">40</span> as the <span class="token keyword">default</span> value<span class="token punctuation">,</span> which is approximately the number of nodes in one rack<span class="token punctuation">.</span>
      Note<span class="token punctuation">,</span> <span class="token keyword">if</span> this value is <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> the locality constraint in the container request
      will be ignored<span class="token punctuation">,</span> which disables the delay scheduling<span class="token punctuation">.</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn<span class="token punctuation">.</span>scheduler<span class="token punctuation">.</span>capacity<span class="token punctuation">.</span>rack<span class="token operator">-</span>locality<span class="token operator">-</span>additional<span class="token operator">-</span>delay<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>
      Number of additional missed scheduling opportunities over the node<span class="token operator">-</span>locality<span class="token operator">-</span>delay
      ones<span class="token punctuation">,</span> after which the CapacityScheduler attempts to schedule off<span class="token operator">-</span><span class="token keyword">switch</span> containers<span class="token punctuation">,</span>
      instead of rack<span class="token operator">-</span>local ones<span class="token punctuation">.</span>
      Example<span class="token punctuation">:</span> with node<span class="token operator">-</span>locality<span class="token operator">-</span>delay<span class="token operator">=</span><span class="token number">40</span> and rack<span class="token operator">-</span>locality<span class="token operator">-</span>delay<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span> the scheduler will
      attempt rack<span class="token operator">-</span>local assignments after <span class="token number">40</span> missed opportunities<span class="token punctuation">,</span> and off<span class="token operator">-</span><span class="token keyword">switch</span> assignments
      after <span class="token number">40</span><span class="token operator">+</span><span class="token number">20</span><span class="token operator">=</span><span class="token number">60</span> missed opportunities<span class="token punctuation">.</span>
      When setting this parameter<span class="token punctuation">,</span> the size of the cluster should be taken into account<span class="token punctuation">.</span>
      We use <span class="token operator">-</span><span class="token number">1</span> as the <span class="token keyword">default</span> value<span class="token punctuation">,</span> which disables this feature<span class="token punctuation">.</span> In this <span class="token keyword">case</span><span class="token punctuation">,</span> the number
      of missed opportunities <span class="token keyword">for</span> assigning off<span class="token operator">-</span><span class="token keyword">switch</span> containers is calculated based on
      the number of containers and unique locations specified in the resource request<span class="token punctuation">,</span>
      as well as the size of the cluster<span class="token punctuation">.</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn<span class="token punctuation">.</span>scheduler<span class="token punctuation">.</span>capacity<span class="token punctuation">.</span>queue<span class="token operator">-</span>mappings<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>
      A list of mappings that will be used to assign jobs to queues
      The syntax <span class="token keyword">for</span> this list is <span class="token punctuation">[</span>u<span class="token operator">|</span>g<span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token punctuation">[</span>queue_name<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">,</span>next mapping<span class="token punctuation">]</span><span class="token operator">*</span>
      Typically this list will be used to map users to queues<span class="token punctuation">,</span>
      <span class="token keyword">for</span> example<span class="token punctuation">,</span> u<span class="token punctuation">:</span><span class="token operator">%</span>user<span class="token punctuation">:</span><span class="token operator">%</span>user maps all users to queues with the same name
      as the user<span class="token punctuation">.</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn<span class="token punctuation">.</span>scheduler<span class="token punctuation">.</span>capacity<span class="token punctuation">.</span>queue<span class="token operator">-</span>mappings<span class="token operator">-</span>override<span class="token punctuation">.</span>enable<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>false<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>
      If a queue mapping is present<span class="token punctuation">,</span> will it override the value specified
      by the user<span class="token operator">?</span> This can be used by administrators to place jobs in queues
      that are different than the one specified by the user<span class="token punctuation">.</span>
      The <span class="token keyword">default</span> is false<span class="token punctuation">.</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn<span class="token punctuation">.</span>scheduler<span class="token punctuation">.</span>capacity<span class="token punctuation">.</span>per<span class="token operator">-</span>node<span class="token operator">-</span>heartbeat<span class="token punctuation">.</span>maximum<span class="token operator">-</span>offswitch<span class="token operator">-</span>assignments<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>
      Controls the number of OFF_SWITCH assignments allowed
      during a node's heartbeat<span class="token punctuation">.</span> Increasing this value can improve
      scheduling rate <span class="token keyword">for</span> OFF_SWITCH containers<span class="token punctuation">.</span> Lower values reduce
      <span class="token string">"clumping"</span> of applications on particular nodes<span class="token punctuation">.</span> The <span class="token keyword">default</span> is <span class="token number">1.</span>
      Legal values are <span class="token number">1</span><span class="token operator">-</span>MAX_INT<span class="token punctuation">.</span> This config is refreshable<span class="token punctuation">.</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn<span class="token punctuation">.</span>scheduler<span class="token punctuation">.</span>capacity<span class="token punctuation">.</span>application<span class="token punctuation">.</span>fail<span class="token operator">-</span>fast<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>false<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>
      Whether RM should fail during recovery <span class="token keyword">if</span> previous applications'
      queue is no longer valid<span class="token punctuation">.</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>configuration<span class="token operator">&gt;</span>
</code></pre> 
<p>6.1.5、修改配置文件 yarn-site.xml<br>   编辑 /home/work/_app/hadoop-3.1.2/etc/hadoop/yarn-site.xml 文件并保存，内容如下：</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 sbin<span class="token punctuation">]</span># cat <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_app<span class="token operator">/</span>hadoop<span class="token operator">-</span><span class="token number">3.1</span><span class="token number">.2</span><span class="token operator">/</span>etc<span class="token operator">/</span>hadoop<span class="token operator">/</span>yarn<span class="token operator">-</span>site<span class="token punctuation">.</span>xml
<span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">"1.0"</span><span class="token operator">?</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>
  Licensed under the Apache License<span class="token punctuation">,</span> Version <span class="token number">2.0</span> <span class="token punctuation">(</span>the <span class="token string">"License"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  you may not use this file except in compliance with the License<span class="token punctuation">.</span>
  You may obtain a copy of the License at

    http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>org<span class="token operator">/</span>licenses<span class="token operator">/</span>LICENSE<span class="token operator">-</span><span class="token number">2.0</span>

  Unless required by applicable law or agreed to in writing<span class="token punctuation">,</span> software
  distributed under the License is distributed on an <span class="token string">"AS IS"</span> BASIS<span class="token punctuation">,</span>
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND<span class="token punctuation">,</span> either express or implied<span class="token punctuation">.</span>
  See the License <span class="token keyword">for</span> the specific language governing permissions and
  limitations under the License<span class="token punctuation">.</span> See accompanying LICENSE file<span class="token punctuation">.</span>
<span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>configuration<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> Site specific YARN configuration properties<span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn<span class="token punctuation">.</span>resourcemanager<span class="token punctuation">.</span>recovery<span class="token punctuation">.</span>enabled<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>true<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>启动后启用RM以恢复状态。如果为true，则必须指定yarn<span class="token punctuation">.</span>resourcemanager<span class="token punctuation">.</span>store<span class="token punctuation">.</span>class。<span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn<span class="token punctuation">.</span>resourcemanager<span class="token punctuation">.</span>store<span class="token punctuation">.</span>class<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>yarn<span class="token punctuation">.</span>server<span class="token punctuation">.</span>resourcemanager<span class="token punctuation">.</span>recovery<span class="token punctuation">.</span>ZKRMStateStore<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>用作持久存储的类。<span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn<span class="token punctuation">.</span>resourcemanager<span class="token punctuation">.</span>zk<span class="token operator">-</span>address<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>c0<span class="token punctuation">:</span><span class="token number">2181</span><span class="token punctuation">,</span>c1<span class="token punctuation">:</span><span class="token number">2181</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>ZooKeeper服务的地址，多个地址使用逗号隔开<span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn<span class="token punctuation">.</span>resourcemanager<span class="token punctuation">.</span>ha<span class="token punctuation">.</span>enabled<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>true<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>启用RM高可用性。启用时，（<span class="token number">1</span>）默认情况下，RM以待机模式启动，并在提示时转换为活动模式。（<span class="token number">2</span>）RM集合中的节点列在yarn<span class="token punctuation">.</span>resourcemanager<span class="token punctuation">.</span>ha<span class="token punctuation">.</span>rm<span class="token operator">-</span>ids中（<span class="token number">3</span>）如果明确指定了yarn<span class="token punctuation">.</span>resourcemanager<span class="token punctuation">.</span>ha<span class="token punctuation">.</span>id，则每个RM的id来自yarn<span class="token punctuation">.</span>resourcemanager<span class="token punctuation">.</span>ha<span class="token punctuation">.</span>id或者可以通过匹配yarn<span class="token punctuation">.</span>resourcemanager<span class="token punctuation">.</span>address。<span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn<span class="token punctuation">.</span>resourcemanager<span class="token punctuation">.</span>ha<span class="token punctuation">.</span>rm<span class="token operator">-</span>ids<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>rm1<span class="token punctuation">,</span>rm2<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>启用HA时群集中的RM节点列表。最少<span class="token number">2</span>个<span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn<span class="token punctuation">.</span>resourcemanager<span class="token punctuation">.</span>webapp<span class="token punctuation">.</span>address<span class="token punctuation">.</span>rm1<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>c0<span class="token punctuation">:</span><span class="token number">8088</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn<span class="token punctuation">.</span>resourcemanager<span class="token punctuation">.</span>webapp<span class="token punctuation">.</span>address<span class="token punctuation">.</span>rm2<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>c1<span class="token punctuation">:</span><span class="token number">8088</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn<span class="token punctuation">.</span>resourcemanager<span class="token punctuation">.</span>cluster<span class="token operator">-</span>id<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>mshk<span class="token operator">-</span>yarn<span class="token operator">-</span>ha<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>集群HA的id，用于在ZooKeeper上创建节点，区分使用同一个ZooKeeper集群的不同Hadoop集群<span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn<span class="token punctuation">.</span>resourcemanager<span class="token punctuation">.</span>hostname<span class="token punctuation">.</span>rm1<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>c0<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>主机名<span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn<span class="token punctuation">.</span>resourcemanager<span class="token punctuation">.</span>hostname<span class="token punctuation">.</span>rm2<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>c1<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>主机名<span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn<span class="token punctuation">.</span>nodemanager<span class="token punctuation">.</span>aux<span class="token operator">-</span>services<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>mapreduce_shuffle<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>reducer取数据的方式是mapreduce_shuffle<span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>  
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn<span class="token punctuation">.</span>nodemanager<span class="token punctuation">.</span>resource<span class="token punctuation">.</span>memory<span class="token operator">-</span>mb<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>  
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token number">2048</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>  
        <span class="token operator">&lt;</span>discription<span class="token operator">&gt;</span>每个节点可用内存<span class="token punctuation">,</span>单位MB<span class="token operator">&lt;</span><span class="token operator">/</span>discription<span class="token operator">&gt;</span>  
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span> 
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>  
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn<span class="token punctuation">.</span>nodemanager<span class="token punctuation">.</span>resource<span class="token punctuation">.</span>cpu<span class="token operator">-</span>vcores<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>  
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token number">2</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>  
        <span class="token operator">&lt;</span>discription<span class="token operator">&gt;</span>每个节点可用cpu<span class="token operator">&lt;</span><span class="token operator">/</span>discription<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>   
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>  
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn<span class="token punctuation">.</span>scheduler<span class="token punctuation">.</span>minimum<span class="token operator">-</span>allocation<span class="token operator">-</span>mb<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>  
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token number">512</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>  
        <span class="token operator">&lt;</span>discription<span class="token operator">&gt;</span>单个任务可申请最少内存，默认<span class="token number">1024</span>MB<span class="token operator">&lt;</span><span class="token operator">/</span>discription<span class="token operator">&gt;</span>  
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>  
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>  
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn<span class="token punctuation">.</span>scheduler<span class="token punctuation">.</span>maximum<span class="token operator">-</span>allocation<span class="token operator">-</span>mb<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>  
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token number">1024</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>  
        <span class="token operator">&lt;</span>discription<span class="token operator">&gt;</span>单个任务可申请最大内存，默认<span class="token number">8192</span>MB<span class="token operator">&lt;</span><span class="token operator">/</span>discription<span class="token operator">&gt;</span>  
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span> 
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>  
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn<span class="token punctuation">.</span>scheduler<span class="token punctuation">.</span>minimum<span class="token operator">-</span>allocation<span class="token operator">-</span>vcores<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>  
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>  
        <span class="token operator">&lt;</span>discription<span class="token operator">&gt;</span>最小的cores <span class="token number">1</span> 个，默认的就是一个<span class="token operator">&lt;</span><span class="token operator">/</span>discription<span class="token operator">&gt;</span>  
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span> 
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>  
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn<span class="token punctuation">.</span>scheduler<span class="token punctuation">.</span>minimum<span class="token operator">-</span>allocation<span class="token operator">-</span>vcores<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>  
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token number">2</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>  
        <span class="token operator">&lt;</span>discription<span class="token operator">&gt;</span>最多可分配的cores <span class="token number">2</span> 个<span class="token operator">&lt;</span><span class="token operator">/</span>discription<span class="token operator">&gt;</span>  
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span> 
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn<span class="token punctuation">.</span>nodemanager<span class="token punctuation">.</span>pmem<span class="token operator">-</span>check<span class="token operator">-</span>enabled<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>false<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn<span class="token punctuation">.</span>nodemanager<span class="token punctuation">.</span>vmem<span class="token operator">-</span>check<span class="token operator">-</span>enabled<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>false<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn<span class="token punctuation">.</span>log<span class="token operator">-</span>aggregation<span class="token operator">-</span>enable<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>true<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>discription<span class="token operator">&gt;</span>是否开启聚合日志<span class="token operator">&lt;</span><span class="token operator">/</span>discription<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn<span class="token punctuation">.</span>nodemanager<span class="token punctuation">.</span>log<span class="token operator">-</span>aggregation<span class="token punctuation">.</span>roll<span class="token operator">-</span>monitoring<span class="token operator">-</span>interval<span class="token operator">-</span>seconds<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>discription<span class="token operator">&gt;</span>定义NM唤醒上载日志文件的频率。默认值为<span class="token operator">-</span><span class="token number">1</span>。默认情况下，应用程序完成后将上载日志。通过设置此配置，可以在应用程序运行时定期上载日志。可设置的最小滚动间隔秒数为<span class="token number">3600</span>。<span class="token operator">&lt;</span><span class="token operator">/</span>discription<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn<span class="token punctuation">.</span>log<span class="token punctuation">.</span>server<span class="token punctuation">.</span>url<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>c0<span class="token punctuation">:</span><span class="token number">19888</span><span class="token operator">/</span>jobhistory<span class="token operator">/</span>logs<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>discription<span class="token operator">&gt;</span> 配置日志服务器的地址<span class="token operator">&lt;</span><span class="token operator">/</span>discription<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn<span class="token punctuation">.</span>log<span class="token operator">-</span>aggregation<span class="token punctuation">.</span>retain<span class="token operator">-</span>seconds<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>discription<span class="token operator">&gt;</span> 在删除聚合日志之前保留多长时间。<span class="token operator">-</span><span class="token number">1</span>禁用。单位是秒<span class="token operator">&lt;</span><span class="token operator">/</span>discription<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn<span class="token punctuation">.</span>nodemanager<span class="token punctuation">.</span>log<span class="token operator">-</span>dirs<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_data<span class="token operator">/</span>hadoop<span class="token operator">-</span><span class="token number">3.1</span><span class="token number">.2</span><span class="token operator">/</span>yarn<span class="token operator">/</span>container<span class="token operator">-</span>logs<span class="token operator">/</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>discription<span class="token operator">&gt;</span>nodemanager存放container日志的本地路径<span class="token operator">&lt;</span><span class="token operator">/</span>discription<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn<span class="token punctuation">.</span>nodemanager<span class="token punctuation">.</span>remote<span class="token operator">-</span>app<span class="token operator">-</span>log<span class="token operator">-</span>dir<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token operator">/</span>tmp<span class="token operator">/</span>logs<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>discription<span class="token operator">&gt;</span>nodemanager存放container日志的本地路径<span class="token operator">&lt;</span><span class="token operator">/</span>discription<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>configuration<span class="token operator">&gt;</span>
</code></pre> 
<p>6.1.6、编辑 start-dfs.sh，stop-dfs.sh 脚本<br>   编辑 /home/work/_app/hadoop-3.1.2/sbin/start-dfs.sh 和 /home/work/_app/hadoop-3.1.2/sbin/stop-dfs.sh文件，在开始处 #!/usr/bin/env bash 的下面，增加以下内容：</p> 
<pre><code class="prism language-c">HDFS_DATANODE_USER<span class="token operator">=</span>root
HDFS_DATANODE_SECURE_USER<span class="token operator">=</span>hdfs
HDFS_ZKFC_USER<span class="token operator">=</span>root
HDFS_JOURNALNODE_USER<span class="token operator">=</span>root
HDFS_NAMENODE_USER<span class="token operator">=</span>root
HDFS_SECONDARYNAMENODE_USER<span class="token operator">=</span>root
</code></pre> 
<p>6.1.7、编辑 start-yarn.sh，stop-yarn.sh 脚本<br>   编辑 /home/work/_app/hadoop-3.1.2/sbin/start-yarn.sh 和 /home/work/_app/hadoop-3.1.2/sbin/stop-yarn.sh文件，在开始处 #!/usr/bin/env bash 的下面增加以下内容：</p> 
<pre><code class="prism language-c">YARN_RESOURCEMANAGER_USER<span class="token operator">=</span>root
HADOOP_SECURE_DN_USER<span class="token operator">=</span>yarn 
YARN_NODEMANAGER_USER<span class="token operator">=</span>root
</code></pre> 
<p>6.1.8、修改配置文件 works 文件<br>   设置主从配置，如果不设置，集群将不知道主从配置。编辑 /home/work/_app/hadoop-3.1.2/etc/hadoop/workers 文件并保存，内容如下：</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 _src<span class="token punctuation">]</span># cat <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_app<span class="token operator">/</span>hadoop<span class="token operator">-</span><span class="token number">3.1</span><span class="token number">.2</span><span class="token operator">/</span>etc<span class="token operator">/</span>hadoop<span class="token operator">/</span>workers
c2
c3
</code></pre> 
<p>6.2、启动 Hadoop<br> 6.2.1、启动JournalNode集群<br>   在启动前，我们先将配置好的 hadoop 复制到其他机器</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># <span class="token keyword">for</span> N in $<span class="token punctuation">(</span>seq <span class="token number">1</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">do</span> scp <span class="token operator">-</span>r <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_app<span class="token operator">/</span>hadoop<span class="token operator">-</span><span class="token number">3.1</span><span class="token number">.2</span> c$N<span class="token punctuation">:</span><span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_app<span class="token operator">/</span><span class="token punctuation">;</span> done<span class="token punctuation">;</span>
  
</code></pre> 
<p>备用 NameNode 和活动 NameNode 通过一组独立的节点或守护进程（称为JournalNode）保持同步。JournalNodes 遵循环形拓扑，其中节点彼此连接以形成环。JournalNode 服务于它的请求并将信息复制到环中的其他节点。这在 JournalNode 失败的情况下提供容错。<br>   在所有机器上使用 hdfs --daemon start journalnode 命令来启动Journalnode。输入 JPS 命令后，您将在所有节点中看到 JournalNode 守护程序。</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># <span class="token keyword">for</span> N in $<span class="token punctuation">(</span>seq <span class="token number">0</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">do</span> ssh c$N hdfs <span class="token operator">--</span>daemon start journalnode<span class="token punctuation">;</span>jps<span class="token punctuation">;</span> done<span class="token punctuation">;</span>
<span class="token number">14450</span> JournalNode
<span class="token number">13980</span> QuorumPeerMain
<span class="token number">14494</span> Jps
<span class="token number">14450</span> JournalNode
<span class="token number">13980</span> QuorumPeerMain
<span class="token number">14510</span> Jps
<span class="token number">14450</span> JournalNode
<span class="token number">13980</span> QuorumPeerMain
<span class="token number">14526</span> Jps
<span class="token number">14450</span> JournalNode
<span class="token number">13980</span> QuorumPeerMain
<span class="token number">14542</span> Jps
</code></pre> 
<p>关闭命令为:hdfs --daemon stop journalnode</p> 
<p>6.2.2、格式化 NameNode<br>   一旦启动了 JournalNodes，就必须首先同步两个HA NameNodes的磁盘元数据。<br>   在新版本的 HDFS 集群中，应首先在其中一个 NameNode 上运行 format 命令格式化。格式化一个 NameNode 有两种方法，任意方法都可以，本文中的示例，在 c0 上使用方法一</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># hdfs namenode <span class="token operator">-</span>format
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">09</span><span class="token punctuation">:</span><span class="token number">01</span><span class="token punctuation">,</span><span class="token number">704</span> INFO namenode<span class="token punctuation">.</span>NameNode<span class="token punctuation">:</span> STARTUP_MSG<span class="token punctuation">:</span>
<span class="token comment">/************************************************************
STARTUP_MSG: Starting NameNode
STARTUP_MSG:   host = c0/10.0.0.100
STARTUP_MSG:   args = [-format]
STARTUP_MSG:   version = 3.1.2
...
2019-03-10 19:09:02,399 INFO util.GSet: VM type       = 64-bit
2019-03-10 19:09:02,399 INFO util.GSet: 0.029999999329447746% max memory 546 MB = 167.7 KB
2019-03-10 19:09:02,399 INFO util.GSet: capacity      = 2^14 = 16384 entries
2019-03-10 19:09:02,419 INFO namenode.FSImage: Allocated new BlockPoolId: BP-1652020860-10.0.0.100-1552216142413
2019-03-10 19:09:02,432 INFO common.Storage: Storage directory /home/work/_data/hadoop-3.1.2/namenode has been successfully formatted.
2019-03-10 19:09:02,435 INFO common.Storage: Storage directory /home/work/_data/hadoop-3.1.2/ha-name-dir-shared has been successfully formatted.
2019-03-10 19:09:02,442 INFO namenode.FSImageFormatProtobuf: Saving image file /home/work/_data/hadoop-3.1.2/namenode/current/fsimage.ckpt_0000000000000000000 using no compression
2019-03-10 19:09:02,511 INFO namenode.FSImageFormatProtobuf: Image file /home/work/_data/hadoop-3.1.2/namenode/current/fsimage.ckpt_0000000000000000000 of size 391 bytes saved in 0 seconds .
2019-03-10 19:09:02,520 INFO namenode.NNStorageRetentionManager: Going to retain 1 images with txid &gt;= 0
2019-03-10 19:09:02,526 INFO namenode.NameNode: SHUTDOWN_MSG:
/************************************************************
SHUTDOWN_MSG: Shutting down NameNode at c0/10.0.0.100
************************************************************/</span>
  
</code></pre> 
<p>方法二：</p> 
<pre><code class="prism language-c">hdfs namenode <span class="token operator">-</span>format <span class="token operator">-</span>clusterId c1
</code></pre> 
<p>6.2.3、启动 zookeeper 故障转移控制器<br>   Apache ZooKeeper 是一种高可用性服务，用于维护少量协调数据，通知客户端该数据的更改以及监视客户端是否存在故障。自动 HDFS 故障转移的实现依赖于 ZooKeeper 来实现以下功能：<br> 故障检测 – 集群中的每个 NameNode 计算机都在 ZooKeeper 中维护一个持久会话。如果计算机崩溃，ZooKeeper 会话将过期，通知其他 NameNode 应该触发故障转移。<br> Active NameNode选举 – ZooKeeper 提供了一种简单的机制，可以将节点专门选为活动节点。如果当前活动的 NameNode 崩溃，则另一个节点可能在 ZooKeeper 中采用特殊的独占锁，指示它应该成为下一个活动的。<br>   <br>   ZKFailoverController（ZKFC）是一个新组件，它是一个 ZooKeeper 客户端，它还监视和管理 NameNode 的状态。每台运行 NameNode 机器也运行 ZKFC，ZKFC 主要做以下工作：<br> 运行状况监视 – ZKFC定期使用运行状况检查命令对其本地 NameNode 进行 ping 操作。只要 NameNode 及时响应健康状态，ZKFC 就认为该节点是健康的。如果节点已崩溃，冻结或以其他方式进入不健康状态，则运行状况监视器会将其标记为运行状况不佳。<br> ZooKeeper会话管理 – 当本地 NameNode 运行正常时，ZKFC 在 ZooKeeper 中保持会话打开。如果本地 NameNode 处于活动状态，它还拥有一个特殊的“锁定”znode。此锁使用 ZooKeeper 对“短暂”节点的支持; 如果会话过期，将自动删除锁定节点。<br> 基于ZooKeeper的选举 – 如果本地 NameNode 是健康的，并且 ZKFC 发现没有其他节点当前持有锁 znode ，它将自己尝试获取锁。如果成功，那么它“赢得了选举”，并负责运行故障转移以使其本地 NameNode 处于活动状态。故障转移过程类似于上述手动故障转移：首先，必要时对先前的活动进行隔离，然后本地 NameNode 转换为活动状态。<br>   <br> 6.2.4、格式化 zookeeper<br>   在一台 NameNode 机器 c0 上执行 hdfs zkfc -formatZK 命令，格式化 zookeeper 故障转移控制器</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># hdfs zkfc <span class="token operator">-</span>formatZK
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">16</span><span class="token punctuation">:</span><span class="token number">17</span><span class="token punctuation">,</span><span class="token number">737</span> INFO tools<span class="token punctuation">.</span>DFSZKFailoverController<span class="token punctuation">:</span> STARTUP_MSG<span class="token punctuation">:</span>
<span class="token comment">/************************************************************
STARTUP_MSG: Starting DFSZKFailoverController
STARTUP_MSG:   host = c0/10.0.0.100
STARTUP_MSG:   args = [-formatZK]
STARTUP_MSG:   version = 3.1.2
...
2019-03-10 19:16:18,088 INFO zookeeper.ClientCnxn: Opening socket connection to server c2/10.0.0.102:2181. Will not attempt to authenticate using SASL (unknown error)
2019-03-10 19:16:18,092 INFO zookeeper.ClientCnxn: Socket connection established to c2/10.0.0.102:2181, initiating session
2019-03-10 19:16:18,105 INFO zookeeper.ClientCnxn: Session establishment complete on server c2/10.0.0.102:2181, sessionid = 0x30000397e480000, negotiated timeout = 4000
2019-03-10 19:16:18,106 INFO ha.ActiveStandbyElector: Session connected.
2019-03-10 19:16:18,134 INFO ha.ActiveStandbyElector: Successfully created /hadoop-ha/mshkcluster in ZK.
2019-03-10 19:16:18,137 INFO zookeeper.ZooKeeper: Session: 0x30000397e480000 closed
2019-03-10 19:16:18,141 INFO zookeeper.ClientCnxn: EventThread shut down for session: 0x30000397e480000
2019-03-10 19:16:18,142 INFO tools.DFSZKFailoverController: SHUTDOWN_MSG:
/************************************************************
SHUTDOWN_MSG: Shutting down DFSZKFailoverController at c0/10.0.0.100
************************************************************/</span>
 
</code></pre> 
<p>验证 zkfc 是否格式化成功，如果多了一个 hadoop-ha 包就是成功了</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># zkCli<span class="token punctuation">.</span>sh
Connecting to localhost<span class="token punctuation">:</span><span class="token number">2181</span>
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">16</span><span class="token punctuation">:</span><span class="token number">45</span><span class="token punctuation">,</span><span class="token number">026</span> <span class="token punctuation">[</span>myid<span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">-</span> INFO  <span class="token punctuation">[</span>main<span class="token punctuation">:</span>Environment@<span class="token number">100</span><span class="token punctuation">]</span> <span class="token operator">-</span> Client environment<span class="token punctuation">:</span>zookeeper<span class="token punctuation">.</span>version<span class="token operator">=</span><span class="token number">3.4</span><span class="token number">.13</span><span class="token operator">-</span><span class="token number">2</span>d71af4dbe22557fda74f9a9b4309b15a7487f03<span class="token punctuation">,</span> built on <span class="token number">06</span><span class="token operator">/</span><span class="token number">29</span><span class="token operator">/</span><span class="token number">2018</span> <span class="token number">04</span><span class="token punctuation">:</span><span class="token number">05</span> GMT
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">16</span><span class="token punctuation">:</span><span class="token number">45</span><span class="token punctuation">,</span><span class="token number">028</span> <span class="token punctuation">[</span>myid<span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">-</span> INFO  <span class="token punctuation">[</span>main<span class="token punctuation">:</span>Environment@<span class="token number">100</span><span class="token punctuation">]</span> <span class="token operator">-</span> Client environment<span class="token punctuation">:</span>host<span class="token punctuation">.</span>name<span class="token operator">=</span>c0
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">16</span><span class="token punctuation">:</span><span class="token number">45</span><span class="token punctuation">,</span><span class="token number">028</span> <span class="token punctuation">[</span>myid<span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">-</span> INFO  <span class="token punctuation">[</span>main<span class="token punctuation">:</span>Environment@<span class="token number">100</span><span class="token punctuation">]</span> <span class="token operator">-</span> Client environment<span class="token punctuation">:</span>java<span class="token punctuation">.</span>version<span class="token operator">=</span><span class="token number">1.8</span><span class="token number">.0</span>_201
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">16</span><span class="token punctuation">:</span><span class="token number">45</span><span class="token punctuation">,</span><span class="token number">030</span> <span class="token punctuation">[</span>myid<span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">-</span> INFO  <span class="token punctuation">[</span>main<span class="token punctuation">:</span>Environment@<span class="token number">100</span><span class="token punctuation">]</span> <span class="token operator">-</span> Client environment<span class="token punctuation">:</span>java<span class="token punctuation">.</span>vendor<span class="token operator">=</span>Oracle Corporation
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">16</span><span class="token punctuation">:</span><span class="token number">45</span><span class="token punctuation">,</span><span class="token number">030</span> <span class="token punctuation">[</span>myid<span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">-</span> INFO  <span class="token punctuation">[</span>main<span class="token punctuation">:</span>Environment@<span class="token number">100</span><span class="token punctuation">]</span> <span class="token operator">-</span> Client environment<span class="token punctuation">:</span>java<span class="token punctuation">.</span>home<span class="token operator">=</span><span class="token operator">/</span>opt<span class="token operator">/</span>jdk1<span class="token punctuation">.</span><span class="token number">8.0</span>_201<span class="token operator">/</span>jre
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">16</span><span class="token punctuation">:</span><span class="token number">45</span><span class="token punctuation">,</span><span class="token number">031</span> <span class="token punctuation">[</span>myid<span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">-</span> INFO  <span class="token punctuation">[</span>main<span class="token punctuation">:</span>Environment@<span class="token number">100</span><span class="token punctuation">]</span> <span class="token operator">-</span> Client environment<span class="token punctuation">:</span>java<span class="token punctuation">.</span>class<span class="token punctuation">.</span>path<span class="token operator">=</span><span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_app<span class="token operator">/</span>zookeeper<span class="token operator">-</span><span class="token number">3.4</span><span class="token number">.13</span><span class="token operator">/</span>bin<span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>build<span class="token operator">/</span>classes<span class="token punctuation">:</span><span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_app<span class="token operator">/</span>zookeeper<span class="token operator">-</span><span class="token number">3.4</span><span class="token number">.13</span><span class="token operator">/</span>bin<span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>build<span class="token operator">/</span>lib<span class="token comment">/*.jar:/home/work/_app/zookeeper-3.4.13/bin/../lib/slf4j-log4j12-1.7.25.jar:/home/work/_app/zookeeper-3.4.13/bin/../lib/slf4j-api-1.7.25.jar:/home/work/_app/zookeeper-3.4.13/bin/../lib/netty-3.10.6.Final.jar:/home/work/_app/zookeeper-3.4.13/bin/../lib/log4j-1.2.17.jar:/home/work/_app/zookeeper-3.4.13/bin/../lib/jline-0.9.94.jar:/home/work/_app/zookeeper-3.4.13/bin/../lib/audience-annotations-0.5.0.jar:/home/work/_app/zookeeper-3.4.13/bin/../zookeeper-3.4.13.jar:/home/work/_app/zookeeper-3.4.13/bin/../src/java/lib/*.jar:/home/work/_app/zookeeper-3.4.13/bin/../conf:
2019-03-10 19:16:45,031 [myid:] - INFO  [main:Environment@100] - Client environment:java.library.path=/usr/java/packages/lib/amd64:/usr/lib64:/lib64:/lib:/usr/lib
2019-03-10 19:16:45,031 [myid:] - INFO  [main:Environment@100] - Client environment:java.io.tmpdir=/tmp
2019-03-10 19:16:45,031 [myid:] - INFO  [main:Environment@100] - Client environment:java.compiler=&lt;NA&gt;
2019-03-10 19:16:45,031 [myid:] - INFO  [main:Environment@100] - Client environment:os.name=Linux
2019-03-10 19:16:45,031 [myid:] - INFO  [main:Environment@100] - Client environment:os.arch=amd64
2019-03-10 19:16:45,031 [myid:] - INFO  [main:Environment@100] - Client environment:os.version=4.20.7-1.el7.elrepo.x86_64
2019-03-10 19:16:45,031 [myid:] - INFO  [main:Environment@100] - Client environment:user.name=root
2019-03-10 19:16:45,031 [myid:] - INFO  [main:Environment@100] - Client environment:user.home=/root
2019-03-10 19:16:45,032 [myid:] - INFO  [main:Environment@100] - Client environment:user.dir=/home/work/_src
2019-03-10 19:16:45,033 [myid:] - INFO  [main:ZooKeeper@442] - Initiating client connection, connectString=localhost:2181 sessionTimeout=30000 watcher=org.apache.zookeeper.ZooKeeperMain$MyWatcher@5ce65a89
Welcome to ZooKeeper!
2019-03-10 19:16:45,047 [myid:] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@1029] - Opening socket connection to server localhost/127.0.0.1:2181. Will not attempt to authenticate using SASL (unknown error)
JLine support is enabled
2019-03-10 19:16:45,102 [myid:] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@879] - Socket connection established to localhost/127.0.0.1:2181, initiating session
2019-03-10 19:16:45,110 [myid:] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@1303] - Session establishment complete on server localhost/127.0.0.1:2181, sessionid = 0x100004e77950001, negotiated timeout = 4000

WATCHER::

WatchedEvent state:SyncConnected type:None path:null
[zk: localhost:2181(CONNECTED) 0] ls /
[zookeeper, hadoop-ha]
[zk: localhost:2181(CONNECTED) 1] quit
Quitting...
2019-03-10 19:16:59,687 [myid:] - INFO  [main:ZooKeeper@693] - Session: 0x100004e77950001 closed
2019-03-10 19:16:59,688 [myid:] - INFO  [main-EventThread:ClientCnxn$EventThread@522] - EventThread shut down for session: 0x100004e77950001
</span></code></pre> 
<p>6.2.5、启动 NameNode<br>   指定 c0 节点上使用 hdfs --daemon start namenode 命令启动 HDFS NameNode</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># hdfs <span class="token operator">--</span>daemon start namenode
<span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># jps
<span class="token number">7393</span> QuorumPeerMain
<span class="token number">7541</span> JournalNode
<span class="token number">7768</span> NameNode
<span class="token number">7919</span> Jps
</code></pre> 
<p>关闭 NameNode 的命令为：hdfs --daemon stop namenode<br> 浏览 http://c0:50070/ 能够看到以下效果：<br> <img src="https://images2.imgbox.com/ff/79/j4bEEVZm_o.png" alt="在这里插入图片描述"><br> 6.2.6、将 NameNode 数据复制到备用 NameNode<br>   在另一台 NameNode 机器 c1 上执行 hdfs namenode -bootstrapStandby 命令，将 Meta 数据从 Active NameNode 复制到 Standby NameNode。</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c1 <span class="token operator">~</span><span class="token punctuation">]</span># hdfs namenode <span class="token operator">-</span>bootstrapStandby
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">25</span><span class="token punctuation">:</span><span class="token number">07</span><span class="token punctuation">,</span><span class="token number">903</span> INFO namenode<span class="token punctuation">.</span>NameNode<span class="token punctuation">:</span> STARTUP_MSG<span class="token punctuation">:</span>
<span class="token comment">/************************************************************
STARTUP_MSG: Starting NameNode
STARTUP_MSG:   host = c1/10.0.0.101
STARTUP_MSG:   args = [-bootstrapStandby]
STARTUP_MSG:   version = 3.1.2
...
=====================================================
About to bootstrap Standby ID c1 from:
           Nameservice ID: mshkcluster
        Other Namenode ID: c0
  Other NN's HTTP address: http://c0:50070
  Other NN's IPC  address: c0/10.0.0.100:8020
             Namespace ID: 1312946599
            Block pool ID: BP-1652020860-10.0.0.100-1552216142413
               Cluster ID: CID-0da1c4b1-00cc-4da7-b381-0c29fca87ebf
           Layout version: -64
       isUpgradeFinalized: true
=====================================================
2019-03-10 19:25:08,971 INFO common.Storage: Storage directory /home/work/_data/hadoop-3.1.2/namenode has been successfully formatted.
2019-03-10 19:25:09,015 INFO namenode.FSEditLog: Edit logging is async:true
2019-03-10 19:25:09,054 INFO namenode.TransferFsImage: Opening connection to http://c0:50070/imagetransfer?getimage=1&amp;txid=0&amp;storageInfo=-64:1312946599:1552216142413:CID-0da1c4b1-00cc-4da7-b381-0c29fca87ebf&amp;bootstrapstandby=true
2019-03-10 19:25:09,096 INFO common.Util: Combined time for file download and fsync to all disks took 0.00s. The file download took 0.00s at 0.00 KB/s. Synchronous (fsync) write to disk of /home/work/_data/hadoop-3.1.2/namenode/current/fsimage.ckpt_0000000000000000000 took 0.00s.
2019-03-10 19:25:09,097 INFO namenode.TransferFsImage: Downloaded file fsimage.ckpt_0000000000000000000 size 391 bytes.
2019-03-10 19:25:09,112 INFO namenode.NameNode: SHUTDOWN_MSG:
/************************************************************
SHUTDOWN_MSG: Shutting down NameNode at c1/10.0.0.101
************************************************************/</span>
  
</code></pre> 
<p>然后在 c1 使用 hdfs --daemon start namenode 命令启动 HDFS NameNode</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c1 <span class="token operator">~</span><span class="token punctuation">]</span># hdfs <span class="token operator">--</span>daemon start namenode
<span class="token punctuation">[</span>root@c1 <span class="token operator">~</span><span class="token punctuation">]</span># jps
<span class="token number">17568</span> QuorumPeerMain
<span class="token number">17984</span> NameNode
<span class="token number">17685</span> JournalNode
<span class="token number">18138</span> Jps
</code></pre> 
<p>浏览 c1 的 50070 端口，http://10.0.0.101:50070/ 能够看到以下效果：<br> <img src="https://images2.imgbox.com/44/14/k1UnFIvX_o.png" alt="在这里插入图片描述"><br> 这个时候在网址上可以看到 c0 和 c1 的状态都是 standby<br>   <br> 通过下面的命令，也可以查看 NameNode 的状态</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># hdfs haadmin <span class="token operator">-</span>getServiceState c0
standby
<span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># hdfs haadmin <span class="token operator">-</span>getServiceState c1
standby
</code></pre> 
<p>也可以通过 hdfs haadmin -getAllServiceState 命令，查看所有 NameNode 的状态</p> 
<p>6.2.7、启动 HDFS 进程<br>   由于在配置中启用了自动故障转移，start-dfs.sh 脚本现在将在任何运行 NameNode 的计算机上自动启动 zkfc 守护程序和 datanodes 。当 zkfc 启动时，它们将自动选择一个要激活的名称节点。<br>   在 c0 上使用 start-dfs.sh 启动所有 HDFS 进程。</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># start<span class="token operator">-</span>dfs<span class="token punctuation">.</span>sh
Starting namenodes on <span class="token punctuation">[</span>c0 c1<span class="token punctuation">]</span>
Last login<span class="token punctuation">:</span> Mon Mar  <span class="token number">4</span> <span class="token number">22</span><span class="token punctuation">:</span><span class="token number">14</span><span class="token punctuation">:</span><span class="token number">22</span> CST <span class="token number">2019</span> from lionde17nianmbp on pts<span class="token operator">/</span><span class="token number">3</span>
c0<span class="token punctuation">:</span> namenode is running as process <span class="token number">7768.</span>  Stop it first<span class="token punctuation">.</span>
c1<span class="token punctuation">:</span> namenode is running as process <span class="token number">17984.</span>  Stop it first<span class="token punctuation">.</span>
Starting datanodes
Last login<span class="token punctuation">:</span> Sun Mar <span class="token number">10</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">40</span><span class="token punctuation">:</span><span class="token number">52</span> CST <span class="token number">2019</span> on pts<span class="token operator">/</span><span class="token number">3</span>
Starting ZK Failover Controllers on NN hosts <span class="token punctuation">[</span>c0 c1<span class="token punctuation">]</span>
Last login<span class="token punctuation">:</span> Sun Mar <span class="token number">10</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">40</span><span class="token punctuation">:</span><span class="token number">52</span> CST <span class="token number">2019</span> on pts<span class="token operator">/</span><span class="token number">3</span>
</code></pre> 
<p>关闭命令为:stop-dfs.sh</p> 
<p>您通过 hdfs haadmin -getAllServiceState 命令，也可以查看 NameNode 的状态,可以发现 c0 是 standby，c1 是active</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># hdfs haadmin <span class="token operator">-</span>getAllServiceState
c0<span class="token punctuation">:</span><span class="token number">8020</span>                                            standby
c1<span class="token punctuation">:</span><span class="token number">8020</span>                                            active
</code></pre> 
<p>6.2.8、测试 HDFS 是否可用<br>   创建 /home/work/_data/test.mshk.top.txt 测试文件，输入以下内容并保存：</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># cat <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_data<span class="token operator">/</span>test<span class="token punctuation">.</span>mshk<span class="token punctuation">.</span>top<span class="token punctuation">.</span>txt
hello hadoop
hello mshk<span class="token punctuation">.</span>top
welcome mshk<span class="token punctuation">.</span>top
hello world
</code></pre> 
<p>我们在 HDFS 上创建一个 mshk.top 的文件夹，并将 /home/work/_data/test.mshk.top.txt 文件放入到 HDFS 的 mshk.top 目录</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># hdfs dfs <span class="token operator">-</span>ls <span class="token operator">/</span>
<span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># hdfs dfs <span class="token operator">-</span>mkdir <span class="token operator">/</span>mshk<span class="token punctuation">.</span>top
<span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># hdfs dfs <span class="token operator">-</span>ls <span class="token operator">/</span>
Found <span class="token number">1</span> items
drwxr<span class="token operator">-</span>xr<span class="token operator">-</span>x   <span class="token operator">-</span> root supergroup          <span class="token number">0</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">44</span> <span class="token operator">/</span>mshk<span class="token punctuation">.</span>top
<span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># hdfs dfs <span class="token operator">-</span>put <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_data<span class="token operator">/</span>test<span class="token punctuation">.</span>mshk<span class="token punctuation">.</span>top<span class="token punctuation">.</span>txt <span class="token operator">/</span>mshk<span class="token punctuation">.</span>top
<span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># hdfs dfs <span class="token operator">-</span>ls <span class="token operator">/</span>mshk<span class="token punctuation">.</span>top
Found <span class="token number">1</span> items
<span class="token operator">-</span>rw<span class="token operator">-</span>r<span class="token operator">--</span>r<span class="token operator">--</span>   <span class="token number">3</span> root supergroup         <span class="token number">57</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">44</span> <span class="token operator">/</span>mshk<span class="token punctuation">.</span>top<span class="token operator">/</span>test<span class="token punctuation">.</span>mshk<span class="token punctuation">.</span>top<span class="token punctuation">.</span>txt
</code></pre> 
<p>打开 http://c1:50070 的管理界面，能够看到我们添加的文件<br> <img src="https://images2.imgbox.com/c6/77/EZlc5juI_o.png" alt="在这里插入图片描述"></p> 
<p>6.2.9、启动 YARN<br>   运行 start-yarn.sh 脚本来启动 YARN， start-yarn.sh 会根据配置文件，自动在所配置的所有 Master 上启动 ResourceManager 守护进程，在其他节点上启动 NodeManager 守护进程</p> 
<pre><code class="prism language-c"><span class="token macro property"># c0</span>
<span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># start<span class="token operator">-</span>yarn<span class="token punctuation">.</span>sh
Starting resourcemanagers on <span class="token punctuation">[</span> c0 c1<span class="token punctuation">]</span>
Last login<span class="token punctuation">:</span> Sun Mar <span class="token number">10</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">40</span><span class="token punctuation">:</span><span class="token number">58</span> CST <span class="token number">2019</span> on pts<span class="token operator">/</span><span class="token number">3</span>
Starting nodemanagers
Last login<span class="token punctuation">:</span> Sun Mar <span class="token number">10</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">48</span><span class="token punctuation">:</span><span class="token number">25</span> CST <span class="token number">2019</span> on pts<span class="token operator">/</span><span class="token number">3</span>
<span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># jps
<span class="token number">7393</span> QuorumPeerMain
<span class="token number">9460</span> DFSZKFailoverController
<span class="token number">7541</span> JournalNode
<span class="token number">10437</span> Jps
<span class="token number">7768</span> NameNode
<span class="token number">10109</span> ResourceManager

<span class="token macro property"># c1</span>
<span class="token punctuation">[</span>root@c1 <span class="token operator">~</span><span class="token punctuation">]</span># jps
<span class="token number">17568</span> QuorumPeerMain
<span class="token number">17984</span> NameNode
<span class="token number">18256</span> DFSZKFailoverController
<span class="token number">18368</span> ResourceManager
<span class="token number">17685</span> JournalNode
<span class="token number">18423</span> Jps

<span class="token macro property"># c2</span>
<span class="token punctuation">[</span>root@c2 <span class="token operator">~</span><span class="token punctuation">]</span># jps
<span class="token number">17378</span> JournalNode
<span class="token number">17603</span> NodeManager
<span class="token number">17732</span> Jps
<span class="token number">17256</span> QuorumPeerMain
<span class="token number">17484</span> DataNode

<span class="token macro property"># c3</span>
<span class="token punctuation">[</span>root@c3 <span class="token operator">~</span><span class="token punctuation">]</span># jps
<span class="token number">18024</span> Jps
<span class="token number">17530</span> QuorumPeerMain
<span class="token number">17786</span> DataNode
<span class="token number">17916</span> NodeManager
<span class="token number">17647</span> JournalNode
</code></pre> 
<p>关闭 YARN 的命令为:stop-yarn.sh</p> 
<p>在 c0 上，通过 http://c0:8088 能够看到资源管理界面<br> <img src="https://images2.imgbox.com/12/8d/OVKs1ulk_o.png" alt="在这里插入图片描述"><br> 6.2.10、测试 YARN 的可用性<br>   测试 YARN 是否可用,我们来做一个经典的例子，统计刚才放入 HDFS 中 mshk.top 目录下面的 /home/work/_data/test.mshk.top.txt 的单词频率</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># yarn jar <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_app<span class="token operator">/</span>hadoop<span class="token operator">-</span><span class="token number">3.1</span><span class="token number">.2</span><span class="token operator">/</span>share<span class="token operator">/</span>hadoop<span class="token operator">/</span>mapreduce<span class="token operator">/</span>hadoop<span class="token operator">-</span>mapreduce<span class="token operator">-</span>examples<span class="token operator">-</span><span class="token number">3.1</span><span class="token number">.2</span><span class="token punctuation">.</span>jar wordcount <span class="token operator">/</span>mshk<span class="token punctuation">.</span>top<span class="token operator">/</span>test<span class="token punctuation">.</span>mshk<span class="token punctuation">.</span>top<span class="token punctuation">.</span>txt <span class="token operator">/</span>output
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">54</span><span class="token punctuation">:</span><span class="token number">57</span><span class="token punctuation">,</span><span class="token number">588</span> INFO mapreduce<span class="token punctuation">.</span>JobResourceUploader<span class="token punctuation">:</span> Disabling Erasure Coding <span class="token keyword">for</span> path<span class="token punctuation">:</span> <span class="token operator">/</span>tmp<span class="token operator">/</span>hadoop<span class="token operator">-</span>yarn<span class="token operator">/</span>staging<span class="token operator">/</span>root<span class="token operator">/</span><span class="token punctuation">.</span>staging<span class="token operator">/</span>job_1552218514522_0001
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">54</span><span class="token punctuation">:</span><span class="token number">57</span><span class="token punctuation">,</span><span class="token number">947</span> INFO input<span class="token punctuation">.</span>FileInputFormat<span class="token punctuation">:</span> Total input files to process <span class="token punctuation">:</span> <span class="token number">1</span>
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">54</span><span class="token punctuation">:</span><span class="token number">58</span><span class="token punctuation">,</span><span class="token number">085</span> INFO mapreduce<span class="token punctuation">.</span>JobSubmitter<span class="token punctuation">:</span> number of splits<span class="token punctuation">:</span><span class="token number">1</span>
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">54</span><span class="token punctuation">:</span><span class="token number">58</span><span class="token punctuation">,</span><span class="token number">377</span> INFO mapreduce<span class="token punctuation">.</span>JobSubmitter<span class="token punctuation">:</span> Submitting tokens <span class="token keyword">for</span> job<span class="token punctuation">:</span> job_1552218514522_0001
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">54</span><span class="token punctuation">:</span><span class="token number">58</span><span class="token punctuation">,</span><span class="token number">378</span> INFO mapreduce<span class="token punctuation">.</span>JobSubmitter<span class="token punctuation">:</span> Executing with tokens<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">54</span><span class="token punctuation">:</span><span class="token number">58</span><span class="token punctuation">,</span><span class="token number">729</span> INFO conf<span class="token punctuation">.</span>Configuration<span class="token punctuation">:</span> resource<span class="token operator">-</span>types<span class="token punctuation">.</span>xml not found
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">54</span><span class="token punctuation">:</span><span class="token number">58</span><span class="token punctuation">,</span><span class="token number">729</span> INFO resource<span class="token punctuation">.</span>ResourceUtils<span class="token punctuation">:</span> Unable to find <span class="token string">'resource-types.xml'</span><span class="token punctuation">.</span>
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">54</span><span class="token punctuation">:</span><span class="token number">59</span><span class="token punctuation">,</span><span class="token number">150</span> INFO impl<span class="token punctuation">.</span>YarnClientImpl<span class="token punctuation">:</span> Submitted application application_1552218514522_0001
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">54</span><span class="token punctuation">:</span><span class="token number">59</span><span class="token punctuation">,</span><span class="token number">229</span> INFO mapreduce<span class="token punctuation">.</span>Job<span class="token punctuation">:</span> The url to track the job<span class="token punctuation">:</span> http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>c0<span class="token punctuation">:</span><span class="token number">8088</span><span class="token operator">/</span>proxy<span class="token operator">/</span>application_1552218514522_0001<span class="token operator">/</span>
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">54</span><span class="token punctuation">:</span><span class="token number">59</span><span class="token punctuation">,</span><span class="token number">230</span> INFO mapreduce<span class="token punctuation">.</span>Job<span class="token punctuation">:</span> Running job<span class="token punctuation">:</span> job_1552218514522_0001
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">55</span><span class="token punctuation">:</span><span class="token number">09</span><span class="token punctuation">,</span><span class="token number">368</span> INFO mapreduce<span class="token punctuation">.</span>Job<span class="token punctuation">:</span> Job job_1552218514522_0001 running in uber mode <span class="token punctuation">:</span> false
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">55</span><span class="token punctuation">:</span><span class="token number">09</span><span class="token punctuation">,</span><span class="token number">369</span> INFO mapreduce<span class="token punctuation">.</span>Job<span class="token punctuation">:</span>  map <span class="token number">0</span><span class="token operator">%</span> reduce <span class="token number">0</span><span class="token operator">%</span>
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">55</span><span class="token punctuation">:</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">477</span> INFO mapreduce<span class="token punctuation">.</span>Job<span class="token punctuation">:</span>  map <span class="token number">100</span><span class="token operator">%</span> reduce <span class="token number">0</span><span class="token operator">%</span>
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">55</span><span class="token punctuation">:</span><span class="token number">21</span><span class="token punctuation">,</span><span class="token number">517</span> INFO mapreduce<span class="token punctuation">.</span>Job<span class="token punctuation">:</span>  map <span class="token number">100</span><span class="token operator">%</span> reduce <span class="token number">100</span><span class="token operator">%</span>
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">55</span><span class="token punctuation">:</span><span class="token number">22</span><span class="token punctuation">,</span><span class="token number">533</span> INFO mapreduce<span class="token punctuation">.</span>Job<span class="token punctuation">:</span> Job job_1552218514522_0001 completed successfully
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">55</span><span class="token punctuation">:</span><span class="token number">22</span><span class="token punctuation">,</span><span class="token number">718</span> INFO mapreduce<span class="token punctuation">.</span>Job<span class="token punctuation">:</span> Counters<span class="token punctuation">:</span> <span class="token number">53</span>
    File System Counters
        FILE<span class="token punctuation">:</span> Number of bytes read<span class="token operator">=</span><span class="token number">72</span>
        FILE<span class="token punctuation">:</span> Number of bytes written<span class="token operator">=</span><span class="token number">438627</span>
        FILE<span class="token punctuation">:</span> Number of read operations<span class="token operator">=</span><span class="token number">0</span>
        FILE<span class="token punctuation">:</span> Number of large read operations<span class="token operator">=</span><span class="token number">0</span>
        FILE<span class="token punctuation">:</span> Number of write operations<span class="token operator">=</span><span class="token number">0</span>
        HDFS<span class="token punctuation">:</span> Number of bytes read<span class="token operator">=</span><span class="token number">167</span>
        HDFS<span class="token punctuation">:</span> Number of bytes written<span class="token operator">=</span><span class="token number">46</span>
        HDFS<span class="token punctuation">:</span> Number of read operations<span class="token operator">=</span><span class="token number">8</span>
        HDFS<span class="token punctuation">:</span> Number of large read operations<span class="token operator">=</span><span class="token number">0</span>
        HDFS<span class="token punctuation">:</span> Number of write operations<span class="token operator">=</span><span class="token number">2</span>
    Job Counters
        Launched map tasks<span class="token operator">=</span><span class="token number">1</span>
        Launched reduce tasks<span class="token operator">=</span><span class="token number">1</span>
        Data<span class="token operator">-</span>local map tasks<span class="token operator">=</span><span class="token number">1</span>
        Total time spent by all maps in occupied slots <span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">5083</span>
        Total time spent by all reduces in occupied slots <span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">2448</span>
        Total time spent by all map tasks <span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">5083</span>
        Total time spent by all reduce tasks <span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">2448</span>
        Total vcore<span class="token operator">-</span>milliseconds taken by all map tasks<span class="token operator">=</span><span class="token number">5083</span>
        Total vcore<span class="token operator">-</span>milliseconds taken by all reduce tasks<span class="token operator">=</span><span class="token number">2448</span>
        Total megabyte<span class="token operator">-</span>milliseconds taken by all map tasks<span class="token operator">=</span><span class="token number">5204992</span>
        Total megabyte<span class="token operator">-</span>milliseconds taken by all reduce tasks<span class="token operator">=</span><span class="token number">2506752</span>
    Map<span class="token operator">-</span>Reduce Framework
        Map input records<span class="token operator">=</span><span class="token number">4</span>
        Map output records<span class="token operator">=</span><span class="token number">8</span>
        Map output bytes<span class="token operator">=</span><span class="token number">89</span>
        Map output materialized bytes<span class="token operator">=</span><span class="token number">72</span>
        Input split bytes<span class="token operator">=</span><span class="token number">110</span>
        Combine input records<span class="token operator">=</span><span class="token number">8</span>
        Combine output records<span class="token operator">=</span><span class="token number">5</span>
        Reduce input groups<span class="token operator">=</span><span class="token number">5</span>
        Reduce shuffle bytes<span class="token operator">=</span><span class="token number">72</span>
        Reduce input records<span class="token operator">=</span><span class="token number">5</span>
        Reduce output records<span class="token operator">=</span><span class="token number">5</span>
        Spilled Records<span class="token operator">=</span><span class="token number">10</span>
        Shuffled Maps <span class="token operator">=</span><span class="token number">1</span>
        Failed Shuffles<span class="token operator">=</span><span class="token number">0</span>
        Merged Map outputs<span class="token operator">=</span><span class="token number">1</span>
        GC time elapsed <span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">141</span>
        CPU time spent <span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">1360</span>
        Physical memory <span class="token punctuation">(</span>bytes<span class="token punctuation">)</span> snapshot<span class="token operator">=</span><span class="token number">524554240</span>
        Virtual memory <span class="token punctuation">(</span>bytes<span class="token punctuation">)</span> snapshot<span class="token operator">=</span><span class="token number">5584596992</span>
        Total committed heap usage <span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">337117184</span>
        Peak Map Physical memory <span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">311808000</span>
        Peak Map Virtual memory <span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">2788454400</span>
        Peak Reduce Physical memory <span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">212746240</span>
        Peak Reduce Virtual memory <span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">2796142592</span>
    Shuffle Errors
        BAD_ID<span class="token operator">=</span><span class="token number">0</span>
        CONNECTION<span class="token operator">=</span><span class="token number">0</span>
        IO_ERROR<span class="token operator">=</span><span class="token number">0</span>
        WRONG_LENGTH<span class="token operator">=</span><span class="token number">0</span>
        WRONG_MAP<span class="token operator">=</span><span class="token number">0</span>
        WRONG_REDUCE<span class="token operator">=</span><span class="token number">0</span>
    File Input Format Counters
        Bytes Read<span class="token operator">=</span><span class="token number">57</span>
    File Output Format Counters
        Bytes Written<span class="token operator">=</span><span class="token number">46</span>
</code></pre> 
<p>查看统计结果：</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># hadoop fs <span class="token operator">-</span>cat <span class="token operator">/</span>output<span class="token operator">/</span>part<span class="token operator">-</span><span class="token operator">*</span>
hadoop  <span class="token number">1</span>
hello   <span class="token number">3</span>
mshk<span class="token punctuation">.</span>top    <span class="token number">2</span>
welcome <span class="token number">1</span>
world   <span class="token number">1</span>
</code></pre> 
<p>6.2.11、查看 MapReduce 运行的历史记录<br>   运行 mapred --daemon start historyserver 命令启动 JobHistory Server可以查看 MapReduce 运行的历史记录：</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># mapred <span class="token operator">--</span>daemon start historyserver
</code></pre> 
<p>关闭 JobHistory Server 的命令为：mapred --daemon stop historyserver</p> 
<p>运行以后，通过 http://c0:19888 端口查看，能够看到我们刚才运行的 word count 统计<br>  <img src="https://images2.imgbox.com/d1/c7/OVOWiXMT_o.png" alt="在这里插入图片描述"><br>  6.2.12、验证 Hadoop HA 高可用性<br>   故障转移，通过 hdfs haadmin -getAllServiceState 命令，已经看到 c0 的状态是 standby，c1 的状态是 active</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># hdfs haadmin <span class="token operator">-</span>getAllServiceState
c0<span class="token punctuation">:</span><span class="token number">8020</span>                                            standby
c1<span class="token punctuation">:</span><span class="token number">8020</span>                                            active
</code></pre> 
<p>我们在 c1 上 kill 掉 namenode 进程</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c1 <span class="token operator">~</span><span class="token punctuation">]</span># jps
<span class="token number">17568</span> QuorumPeerMain
<span class="token number">17984</span> NameNode
<span class="token number">18256</span> DFSZKFailoverController
<span class="token number">18368</span> ResourceManager
<span class="token number">17685</span> JournalNode
<span class="token number">18477</span> Jps
<span class="token punctuation">[</span>root@c1 <span class="token operator">~</span><span class="token punctuation">]</span># kill <span class="token operator">-</span><span class="token number">9</span> <span class="token number">17984</span>
<span class="token punctuation">[</span>root@c1 <span class="token operator">~</span><span class="token punctuation">]</span># jps
<span class="token number">17568</span> QuorumPeerMain
<span class="token number">18256</span> DFSZKFailoverController
<span class="token number">18368</span> ResourceManager
<span class="token number">17685</span> JournalNode
<span class="token number">18492</span> Jps
</code></pre> 
<p>再次通过 hdfs haadmin -getAllServiceState 命令，已经看到 c0 的状态是 active，c1 连接不上</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># hdfs haadmin <span class="token operator">-</span>getAllServiceState
c0<span class="token punctuation">:</span><span class="token number">8020</span>                                            active
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">20</span><span class="token punctuation">:</span><span class="token number">22</span><span class="token punctuation">:</span><span class="token number">41</span><span class="token punctuation">,</span><span class="token number">388</span> INFO ipc<span class="token punctuation">.</span>Client<span class="token punctuation">:</span> Retrying connect to server<span class="token punctuation">:</span> c1<span class="token operator">/</span><span class="token number">10.0</span><span class="token number">.0</span><span class="token number">.101</span><span class="token punctuation">:</span><span class="token number">8020.</span> Already tried <span class="token number">0</span> <span class="token function">time</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span> retry policy is <span class="token function">RetryUpToMaximumCountWithFixedSleep</span><span class="token punctuation">(</span>maxRetries<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> sleepTime<span class="token operator">=</span><span class="token number">1000</span> MILLISECONDS<span class="token punctuation">)</span>
c1<span class="token punctuation">:</span><span class="token number">8020</span>                                            Failed to connect<span class="token punctuation">:</span> Call From c0<span class="token operator">/</span><span class="token number">10.0</span><span class="token number">.0</span><span class="token number">.100</span> to c1<span class="token punctuation">:</span><span class="token number">8020</span> failed on connection exception<span class="token punctuation">:</span> java<span class="token punctuation">.</span>net<span class="token punctuation">.</span>ConnectException<span class="token punctuation">:</span> Connection refused<span class="token punctuation">;</span> For more details see<span class="token punctuation">:</span>  http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>wiki<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>org<span class="token operator">/</span>hadoop<span class="token operator">/</span>ConnectionRefused
  
</code></pre> 
<p>这时我们通过 http://c0:50070 端口查看，可以看到，在前面 c1 是 Active NameNode 的时候，我们上传和测试的数据，已经通过 JournalNode 同步了元数据，同样当现在 c0 是 Active NameNode 时，也可以看到 HDFS 操作过的文件。自此，我们实现了 Hadoop HA 高可用集群的方案。<br> <img src="https://images2.imgbox.com/a5/27/Coz6j6wR_o.png" alt="在这里插入图片描述"><br> 7、安装 Hbase 1.4.9<br> 7.1、修改 Hbase 配置文件<br> 7.1.1、编辑配置文件 hbase-env.sh<br>   编辑 /home/work/_app/hbase-1.4.9/conf/hbase-env.sh 文件并保存，内容如下：</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 _src<span class="token punctuation">]</span># cat <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_app<span class="token operator">/</span>hbase<span class="token operator">-</span><span class="token number">1.4</span><span class="token number">.9</span><span class="token operator">/</span>conf<span class="token operator">/</span>hbase<span class="token operator">-</span>env<span class="token punctuation">.</span>sh
#<span class="token operator">!</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env bash
#
#<span class="token comment">/**
# * Licensed to the Apache Software Foundation (ASF) under one
# * or more contributor license agreements.  See the NOTICE file
# * distributed with this work for additional information
# * regarding copyright ownership.  The ASF licenses this file
# * to you under the Apache License, Version 2.0 (the
# * "License"); you may not use this file except in compliance
# * with the License.  You may obtain a copy of the License at
# *
# *     http://www.apache.org/licenses/LICENSE-2.0
# *
# * Unless required by applicable law or agreed to in writing, software
# * distributed under the License is distributed on an "AS IS" BASIS,
# * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# * See the License for the specific language governing permissions and
# * limitations under the License.
# */</span>

<span class="token macro property"># Set environment variables here.</span>

<span class="token macro property"># This script sets variables multiple times over the course of starting an hbase process,</span>
<span class="token macro property"># so try to keep things idempotent unless you want to take an even deeper look</span>
<span class="token macro property"># into the startup scripts (bin/hbase, etc.)</span>

<span class="token macro property"># The java implementation to use.  Java 1.8+ required.</span>
<span class="token macro property"># export JAVA_HOME=/usr/java/jdk1.8.0/</span>

<span class="token macro property"># Extra Java CLASSPATH elements.  Optional.</span>
<span class="token macro property"># export HBASE_CLASSPATH=</span>

<span class="token macro property"># The maximum amount of heap to use. Default is left to JVM default.</span>
<span class="token macro property"># export HBASE_HEAPSIZE=1G</span>

<span class="token macro property"># Uncomment below if you intend to use off heap cache. For example, to allocate 8G of</span>
<span class="token macro property"># offheap, set the value to "8G".</span>
<span class="token macro property"># export HBASE_OFFHEAPSIZE=1G</span>

<span class="token macro property"># Extra Java runtime options.</span>
<span class="token macro property"># Below are what we set by default.  May only work with SUN JVM.</span>
<span class="token macro property"># For more on why as well as other possible settings,</span>
<span class="token macro property"># see http://hbase.apache.org/book.html#performance</span>
export HBASE_OPTS<span class="token operator">=</span><span class="token string">"$HBASE_OPTS -XX:+UseConcMarkSweepGC"</span>

<span class="token macro property"># Uncomment one of the below three options to enable java garbage collection logging for the server-side processes.</span>

<span class="token macro property"># This enables basic gc logging to the .out file.</span>
<span class="token macro property"># export SERVER_GC_OPTS="-verbose:gc -XX:+PrintGCDetails -XX:+PrintGCDateStamps"</span>

<span class="token macro property"># This enables basic gc logging to its own file.</span>
<span class="token macro property"># If FILE-PATH is not replaced, the log file(.gc) would still be generated in the HBASE_LOG_DIR .</span>
<span class="token macro property"># export SERVER_GC_OPTS="-verbose:gc -XX:+PrintGCDetails -XX:+PrintGCDateStamps -Xloggc:&lt;FILE-PATH&gt;"</span>

<span class="token macro property"># This enables basic GC logging to its own file with automatic log rolling. Only applies to jdk 1.6.0_34+ and 1.7.0_2+.</span>
<span class="token macro property"># If FILE-PATH is not replaced, the log file(.gc) would still be generated in the HBASE_LOG_DIR .</span>
<span class="token macro property"># export SERVER_GC_OPTS="-verbose:gc -XX:+PrintGCDetails -XX:+PrintGCDateStamps -Xloggc:&lt;FILE-PATH&gt; -XX:+UseGCLogFileRotation -XX:NumberOfGCLogFiles=1 -XX:GCLogFileSize=512M"</span>

<span class="token macro property"># Uncomment one of the below three options to enable java garbage collection logging for the client processes.</span>

<span class="token macro property"># This enables basic gc logging to the .out file.</span>
<span class="token macro property"># export CLIENT_GC_OPTS="-verbose:gc -XX:+PrintGCDetails -XX:+PrintGCDateStamps"</span>

<span class="token macro property"># This enables basic gc logging to its own file.</span>
<span class="token macro property"># If FILE-PATH is not replaced, the log file(.gc) would still be generated in the HBASE_LOG_DIR .</span>
<span class="token macro property"># export CLIENT_GC_OPTS="-verbose:gc -XX:+PrintGCDetails -XX:+PrintGCDateStamps -Xloggc:&lt;FILE-PATH&gt;"</span>

<span class="token macro property"># This enables basic GC logging to its own file with automatic log rolling. Only applies to jdk 1.6.0_34+ and 1.7.0_2+.</span>
<span class="token macro property"># If FILE-PATH is not replaced, the log file(.gc) would still be generated in the HBASE_LOG_DIR .</span>
<span class="token macro property"># export CLIENT_GC_OPTS="-verbose:gc -XX:+PrintGCDetails -XX:+PrintGCDateStamps -Xloggc:&lt;FILE-PATH&gt; -XX:+UseGCLogFileRotation -XX:NumberOfGCLogFiles=1 -XX:GCLogFileSize=512M"</span>

<span class="token macro property"># See the package documentation for org.apache.hadoop.hbase.io.hfile for other configurations</span>
<span class="token macro property"># needed setting up off-heap block caching.</span>

<span class="token macro property"># Uncomment and adjust to enable JMX exporting</span>
<span class="token macro property"># See jmxremote.password and jmxremote.access in $JRE_HOME/lib/management to configure remote password access.</span>
<span class="token macro property"># More details at: http://java.sun.com/javase/6/docs/technotes/guides/management/agent.html</span>
<span class="token macro property"># NOTE: HBase provides an alternative JMX implementation to fix the random ports issue, please see JMX</span>
<span class="token macro property"># section in HBase Reference Guide for instructions.</span>

<span class="token macro property"># export HBASE_JMX_BASE="-Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.authenticate=false"</span>
<span class="token macro property"># export HBASE_MASTER_OPTS="$HBASE_MASTER_OPTS $HBASE_JMX_BASE -Dcom.sun.management.jmxremote.port=10101"</span>
<span class="token macro property"># export HBASE_REGIONSERVER_OPTS="$HBASE_REGIONSERVER_OPTS $HBASE_JMX_BASE -Dcom.sun.management.jmxremote.port=10102"</span>
<span class="token macro property"># export HBASE_THRIFT_OPTS="$HBASE_THRIFT_OPTS $HBASE_JMX_BASE -Dcom.sun.management.jmxremote.port=10103"</span>
<span class="token macro property"># export HBASE_ZOOKEEPER_OPTS="$HBASE_ZOOKEEPER_OPTS $HBASE_JMX_BASE -Dcom.sun.management.jmxremote.port=10104"</span>
<span class="token macro property"># export HBASE_REST_OPTS="$HBASE_REST_OPTS $HBASE_JMX_BASE -Dcom.sun.management.jmxremote.port=10105"</span>

<span class="token macro property"># File naming hosts on which HRegionServers will run.  $HBASE_HOME/conf/regionservers by default.</span>
<span class="token macro property"># export HBASE_REGIONSERVERS=${HBASE_HOME}/conf/regionservers</span>

<span class="token macro property"># Uncomment and adjust to keep all the Region Server pages mapped to be memory resident</span>
<span class="token macro property">#HBASE_REGIONSERVER_MLOCK=true</span>
<span class="token macro property">#HBASE_REGIONSERVER_UID="hbase"</span>

<span class="token macro property"># File naming hosts on which backup HMaster will run.  $HBASE_HOME/conf/backup-masters by default.</span>
<span class="token macro property"># export HBASE_BACKUP_MASTERS=${HBASE_HOME}/conf/backup-masters</span>

<span class="token macro property"># Extra ssh options.  Empty by default.</span>
<span class="token macro property"># export HBASE_SSH_OPTS="-o ConnectTimeout=1 -o SendEnv=HBASE_CONF_DIR"</span>

<span class="token macro property"># Where log files are stored.  $HBASE_HOME/logs by default.</span>
export HBASE_LOG_DIR<span class="token operator">=</span><span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_logs<span class="token operator">/</span>hbase<span class="token operator">-</span><span class="token number">1.4</span><span class="token number">.9</span>

<span class="token macro property"># Enable remote JDWP debugging of major HBase processes. Meant for Core Developers</span>
<span class="token macro property"># export HBASE_MASTER_OPTS="$HBASE_MASTER_OPTS -Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=8070"</span>
<span class="token macro property"># export HBASE_REGIONSERVER_OPTS="$HBASE_REGIONSERVER_OPTS -Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=8071"</span>
<span class="token macro property"># export HBASE_THRIFT_OPTS="$HBASE_THRIFT_OPTS -Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=8072"</span>
<span class="token macro property"># export HBASE_ZOOKEEPER_OPTS="$HBASE_ZOOKEEPER_OPTS -Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=8073"</span>
<span class="token macro property"># export HBASE_REST_OPTS="$HBASE_REST_OPTS -Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=8074"</span>

<span class="token macro property"># A string representing this instance of hbase. $USER by default.</span>
<span class="token macro property"># export HBASE_IDENT_STRING=$USER</span>

<span class="token macro property"># The scheduling priority for daemon processes.  See 'man nice'.</span>
<span class="token macro property"># export HBASE_NICENESS=10</span>

<span class="token macro property"># The directory where pid files are stored. /tmp by default.</span>
<span class="token macro property"># export HBASE_PID_DIR=/var/hadoop/pids</span>
export HBASE_PID_DIR<span class="token operator">=</span><span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_data<span class="token operator">/</span>hbase<span class="token operator">-</span><span class="token number">1.4</span><span class="token number">.9</span>

<span class="token macro property"># Seconds to sleep between slave commands.  Unset by default.  This</span>
<span class="token macro property"># can be useful in large clusters, where, e.g., slave rsyncs can</span>
<span class="token macro property"># otherwise arrive faster than the master can service them.</span>
<span class="token macro property"># export HBASE_SLAVE_SLEEP=0.1</span>

<span class="token macro property"># Tell HBase whether it should manage it's own instance of ZooKeeper or not.</span>
# 使用hbase自带的zookeeper
export HBASE_MANAGES_ZK<span class="token operator">=</span>true

<span class="token macro property"># The default log rolling policy is RFA, where the log file is rolled as per the size defined for the</span>
<span class="token macro property"># RFA appender. Please refer to the log4j.properties file to see more details on this appender.</span>
<span class="token macro property"># In case one needs to do log rolling on a date change, one should set the environment property</span>
<span class="token macro property"># HBASE_ROOT_LOGGER to "&lt;DESIRED_LOG LEVEL&gt;,DRFA".</span>
<span class="token macro property"># For example:</span>
<span class="token macro property"># HBASE_ROOT_LOGGER=INFO,DRFA</span>
<span class="token macro property"># The reason for changing default to RFA is to avoid the boundary case of filling out disk space as</span>
<span class="token macro property"># DRFA doesn't put any cap on the log size. Please refer to HBase-5655 for more context.</span>
  
</code></pre> 
<p>7.1.2、编辑配置文件 hbase-site.xml<br>   编辑 /home/work/_app/hbase-1.4.9/conf/hbase-site.xml 文件并保存，内容如下：</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># cat <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_app<span class="token operator">/</span>hbase<span class="token operator">-</span><span class="token number">1.4</span><span class="token number">.9</span><span class="token operator">/</span>conf<span class="token operator">/</span>hbase<span class="token operator">-</span>site<span class="token punctuation">.</span>xml
<span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">"1.0"</span><span class="token operator">?</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">?</span>xml<span class="token operator">-</span>stylesheet type<span class="token operator">=</span><span class="token string">"text/xsl"</span> href<span class="token operator">=</span><span class="token string">"configuration.xsl"</span><span class="token operator">?</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>
<span class="token comment">/**
 *
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * "License"); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */</span>
<span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>configuration<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>hbase<span class="token punctuation">.</span>rootdir<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span> <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> hbase存放数据目录 <span class="token operator">--</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>hdfs<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>mshkcluster<span class="token punctuation">:</span><span class="token number">8020</span><span class="token operator">/</span>hbase<span class="token operator">/</span>hbase_db<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>端口要和Hadoop的fs<span class="token punctuation">.</span>defaultFS端口一致<span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
　　<span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
　　<span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
　　　　<span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>hbase<span class="token punctuation">.</span>cluster<span class="token punctuation">.</span>distributed<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
　　　　<span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>true<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>集群将处于的模式。可能的值是对于独立模式为false，对于分布式模式为true<span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
　　<span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
　　<span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
　　　　<span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>hbase<span class="token punctuation">.</span>zookeeper<span class="token punctuation">.</span>quorum<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span> 
　　　　<span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>c0<span class="token punctuation">,</span>c1<span class="token punctuation">,</span>c2<span class="token punctuation">,</span>c3<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>逗号分隔的ZooKeeper集合中的服务器列表个<span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
　　<span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span> 　　　
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>hbase<span class="token punctuation">.</span>zookeeper<span class="token punctuation">.</span>property<span class="token punctuation">.</span>dataDir<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_data<span class="token operator">/</span>hbase<span class="token operator">-</span><span class="token number">1.4</span><span class="token number">.9</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>zookooper配置、日志等的存储位置，必须为以存在<span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>hbase<span class="token punctuation">.</span>master<span class="token punctuation">.</span>port<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token number">16000</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>HBase Master应绑定的端口<span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>hbase<span class="token punctuation">.</span>master<span class="token punctuation">.</span>info<span class="token punctuation">.</span>port<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token number">16010</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>hbase web 端口<span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
　　<span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
　　<span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>hbase<span class="token punctuation">.</span>unsafe<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>capability<span class="token punctuation">.</span>enforce<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>false<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>configuration<span class="token operator">&gt;</span>
</code></pre> 
<p>7.1.3、配置 Slaver<br>   编辑 /home/work/_app/hbase-1.4.9/conf/regionservers 文件并保存，内容如下:</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># cat <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_app<span class="token operator">/</span>hbase<span class="token operator">-</span><span class="token number">1.4</span><span class="token number">.9</span><span class="token operator">/</span>conf<span class="token operator">/</span>regionservers
c2
c3
</code></pre> 
<p>删除掉与 Hadoop 重复的 jar 包</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># rm <span class="token operator">-</span>rf <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_app<span class="token operator">/</span>hbase<span class="token operator">-</span><span class="token number">1.4</span><span class="token number">.9</span><span class="token operator">/</span>lib<span class="token operator">/</span>slf4j<span class="token operator">-</span>log4j12<span class="token operator">-</span><span class="token number">1.7</span><span class="token number">.10</span><span class="token punctuation">.</span>jar
</code></pre> 
<p>7.1.4、将 Hbase 复制到其他机器<br>   将 Hbase 复制到其他机器上</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># <span class="token keyword">for</span> N in $<span class="token punctuation">(</span>seq <span class="token number">1</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">do</span> scp <span class="token operator">-</span>r <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_app<span class="token operator">/</span>hbase<span class="token operator">-</span><span class="token number">1.4</span><span class="token number">.9</span> c$N<span class="token punctuation">:</span><span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_app<span class="token operator">/</span><span class="token punctuation">;</span> done<span class="token punctuation">;</span>
</code></pre> 
<p>7.2、启动 Hbase<br>   在 NameNode 的 c0和c1 上分别通过 start-hbase.sh 启动 Hbase，会看到在 Master 上有 HMaster 的守护进程，同时会自动启动其他节点的 HRegionServer 服务</p> 
<pre><code class="prism language-c"><span class="token macro property"># c0</span>
<span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># start<span class="token operator">-</span>hbase<span class="token punctuation">.</span>sh
c3<span class="token punctuation">:</span> starting zookeeper<span class="token punctuation">,</span> logging to <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_logs<span class="token operator">/</span>hbase<span class="token operator">-</span><span class="token number">1.4</span><span class="token number">.9</span><span class="token operator">/</span>hbase<span class="token operator">-</span>root<span class="token operator">-</span>zookeeper<span class="token operator">-</span>c3<span class="token punctuation">.</span>out
c2<span class="token punctuation">:</span> starting zookeeper<span class="token punctuation">,</span> logging to <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_logs<span class="token operator">/</span>hbase<span class="token operator">-</span><span class="token number">1.4</span><span class="token number">.9</span><span class="token operator">/</span>hbase<span class="token operator">-</span>root<span class="token operator">-</span>zookeeper<span class="token operator">-</span>c2<span class="token punctuation">.</span>out
c0<span class="token punctuation">:</span> starting zookeeper<span class="token punctuation">,</span> logging to <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_logs<span class="token operator">/</span>hbase<span class="token operator">-</span><span class="token number">1.4</span><span class="token number">.9</span><span class="token operator">/</span>hbase<span class="token operator">-</span>root<span class="token operator">-</span>zookeeper<span class="token operator">-</span>c0<span class="token punctuation">.</span>out
c1<span class="token punctuation">:</span> starting zookeeper<span class="token punctuation">,</span> logging to <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_logs<span class="token operator">/</span>hbase<span class="token operator">-</span><span class="token number">1.4</span><span class="token number">.9</span><span class="token operator">/</span>hbase<span class="token operator">-</span>root<span class="token operator">-</span>zookeeper<span class="token operator">-</span>c1<span class="token punctuation">.</span>out
starting master<span class="token punctuation">,</span> logging to <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_logs<span class="token operator">/</span>hbase<span class="token operator">-</span><span class="token number">1.4</span><span class="token number">.9</span><span class="token operator">/</span>hbase<span class="token operator">-</span>root<span class="token operator">-</span>master<span class="token operator">-</span>c0<span class="token punctuation">.</span>out
c3<span class="token punctuation">:</span> starting regionserver<span class="token punctuation">,</span> logging to <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_logs<span class="token operator">/</span>hbase<span class="token operator">-</span><span class="token number">1.4</span><span class="token number">.9</span><span class="token operator">/</span>hbase<span class="token operator">-</span>root<span class="token operator">-</span>regionserver<span class="token operator">-</span>c3<span class="token punctuation">.</span>out
c2<span class="token punctuation">:</span> starting regionserver<span class="token punctuation">,</span> logging to <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_logs<span class="token operator">/</span>hbase<span class="token operator">-</span><span class="token number">1.4</span><span class="token number">.9</span><span class="token operator">/</span>hbase<span class="token operator">-</span>root<span class="token operator">-</span>regionserver<span class="token operator">-</span>c2<span class="token punctuation">.</span>out
<span class="token punctuation">[</span>root@c0 _src<span class="token punctuation">]</span># jps
<span class="token number">7617</span> Jps
<span class="token number">13459</span> JournalNode
<span class="token number">14404</span> DFSZKFailoverController
<span class="token number">15974</span> JobHistoryServer
<span class="token number">15191</span> ResourceManager
<span class="token number">9900</span> QuorumPeerMain
<span class="token number">13677</span> NameNode
<span class="token number">7327</span> HMaster

<span class="token macro property"># c1</span>
<span class="token punctuation">[</span>root@c1 <span class="token operator">~</span><span class="token punctuation">]</span># start<span class="token operator">-</span>hbase<span class="token punctuation">.</span>sh
c2<span class="token punctuation">:</span> starting zookeeper<span class="token punctuation">,</span> logging to <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_logs<span class="token operator">/</span>hbase<span class="token operator">-</span><span class="token number">1.4</span><span class="token number">.9</span><span class="token operator">/</span>hbase<span class="token operator">-</span>root<span class="token operator">-</span>zookeeper<span class="token operator">-</span>c2<span class="token punctuation">.</span>out
c3<span class="token punctuation">:</span> starting zookeeper<span class="token punctuation">,</span> logging to <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_logs<span class="token operator">/</span>hbase<span class="token operator">-</span><span class="token number">1.4</span><span class="token number">.9</span><span class="token operator">/</span>hbase<span class="token operator">-</span>root<span class="token operator">-</span>zookeeper<span class="token operator">-</span>c3<span class="token punctuation">.</span>out
c1<span class="token punctuation">:</span> starting zookeeper<span class="token punctuation">,</span> logging to <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_logs<span class="token operator">/</span>hbase<span class="token operator">-</span><span class="token number">1.4</span><span class="token number">.9</span><span class="token operator">/</span>hbase<span class="token operator">-</span>root<span class="token operator">-</span>zookeeper<span class="token operator">-</span>c1<span class="token punctuation">.</span>out
c0<span class="token punctuation">:</span> starting zookeeper<span class="token punctuation">,</span> logging to <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_logs<span class="token operator">/</span>hbase<span class="token operator">-</span><span class="token number">1.4</span><span class="token number">.9</span><span class="token operator">/</span>hbase<span class="token operator">-</span>root<span class="token operator">-</span>zookeeper<span class="token operator">-</span>c0<span class="token punctuation">.</span>out
starting master<span class="token punctuation">,</span> logging to <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_logs<span class="token operator">/</span>hbase<span class="token operator">-</span><span class="token number">1.4</span><span class="token number">.9</span><span class="token operator">/</span>hbase<span class="token operator">-</span>root<span class="token operator">-</span>master<span class="token operator">-</span>c1<span class="token punctuation">.</span>out
c3<span class="token punctuation">:</span> regionserver running as process <span class="token number">26117.</span> Stop it first<span class="token punctuation">.</span>
c2<span class="token punctuation">:</span> regionserver running as process <span class="token number">26915.</span> Stop it first<span class="token punctuation">.</span>
<span class="token punctuation">[</span>root@c1 <span class="token operator">~</span><span class="token punctuation">]</span># jps
<span class="token number">22640</span> HQuorumPeer
<span class="token number">11315</span> NameNode
<span class="token number">10613</span> DFSZKFailoverController
<span class="token number">22775</span> HMaster
<span class="token number">10074</span> JournalNode
<span class="token number">10700</span> ResourceManager
<span class="token number">8141</span> QuorumPeerMain
<span class="token number">23007</span> Jps
</code></pre> 
<p>关闭的命令为：stop-hbase.sh</p> 
<p>启动后浏览 http://c0:16010 ,可以看到 c0 是 Master 而 c1 是 Backup Master<br> <img src="https://images2.imgbox.com/7a/e5/BOHzyHp6_o.png" alt="在这里插入图片描述"><br> 7.2.1、用 Shell 测试连接 Hbase<br>   在 c0 上用 shell 测试连接 Hbase</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># hbase shell
HBase Shell
Use <span class="token string">"help"</span> to get list of supported commands<span class="token punctuation">.</span>
Use <span class="token string">"exit"</span> to quit this interactive shell<span class="token punctuation">.</span>
Version <span class="token number">1.4</span><span class="token number">.9</span><span class="token punctuation">,</span> rd625b212e46d01cb17db9ac2e9e927fdb201afa1<span class="token punctuation">,</span> Wed Dec  <span class="token number">5</span> <span class="token number">11</span><span class="token punctuation">:</span><span class="token number">54</span><span class="token punctuation">:</span><span class="token number">10</span> PST <span class="token number">2018</span>

<span class="token function">hbase</span><span class="token punctuation">(</span>main<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token number">001</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token operator">&gt;</span> list
TABLE
<span class="token number">0</span> <span class="token function">row</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> in <span class="token number">0.2440</span> seconds

<span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token function">hbase</span><span class="token punctuation">(</span>main<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token number">002</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token operator">&gt;</span> version
<span class="token number">1.4</span><span class="token number">.9</span><span class="token punctuation">,</span> rd625b212e46d01cb17db9ac2e9e927fdb201afa1<span class="token punctuation">,</span> Wed Dec  <span class="token number">5</span> <span class="token number">11</span><span class="token punctuation">:</span><span class="token number">54</span><span class="token punctuation">:</span><span class="token number">10</span> PST <span class="token number">2018</span>

<span class="token function">hbase</span><span class="token punctuation">(</span>main<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token number">003</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token operator">&gt;</span> create <span class="token string">'mshk_top'</span><span class="token punctuation">,</span><span class="token string">'uid'</span><span class="token punctuation">,</span><span class="token string">'name'</span>
<span class="token number">0</span> <span class="token function">row</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> in <span class="token number">1.4720</span> seconds

<span class="token operator">=</span><span class="token operator">&gt;</span> Hbase<span class="token punctuation">:</span><span class="token punctuation">:</span>Table <span class="token operator">-</span> mshk_top
<span class="token function">hbase</span><span class="token punctuation">(</span>main<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token number">004</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token operator">&gt;</span> list
TABLE
mshk_top
<span class="token number">1</span> <span class="token function">row</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> in <span class="token number">0.0090</span> seconds

<span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token string">"mshk_top"</span><span class="token punctuation">]</span>
<span class="token function">hbase</span><span class="token punctuation">(</span>main<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token number">005</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token operator">&gt;</span> put <span class="token string">'mshk_top'</span><span class="token punctuation">,</span><span class="token string">'10086'</span><span class="token punctuation">,</span><span class="token string">'name:mshk.top-name'</span><span class="token punctuation">,</span><span class="token string">'mshk.top-value'</span>
<span class="token number">0</span> <span class="token function">row</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> in <span class="token number">0.2150</span> seconds

<span class="token function">hbase</span><span class="token punctuation">(</span>main<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token number">006</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token operator">&gt;</span> get <span class="token string">'mshk_top'</span><span class="token punctuation">,</span><span class="token string">'10086'</span>
COLUMN                                                     CELL
 name<span class="token punctuation">:</span>mshk<span class="token punctuation">.</span>top<span class="token operator">-</span>name                                        timestamp<span class="token operator">=</span><span class="token number">1552229501956</span><span class="token punctuation">,</span> value<span class="token operator">=</span>mshk<span class="token punctuation">.</span>top<span class="token operator">-</span>value
<span class="token number">1</span> <span class="token function">row</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> in <span class="token number">0.0350</span> seconds

<span class="token function">hbase</span><span class="token punctuation">(</span>main<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token number">007</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token operator">&gt;</span> scan <span class="token string">'mshk_top'</span>
ROW                                                        COLUMN<span class="token operator">+</span>CELL
 <span class="token number">10086</span>                                                     column<span class="token operator">=</span>name<span class="token punctuation">:</span>mshk<span class="token punctuation">.</span>top<span class="token operator">-</span>name<span class="token punctuation">,</span> timestamp<span class="token operator">=</span><span class="token number">1552229501956</span><span class="token punctuation">,</span> value<span class="token operator">=</span>mshk<span class="token punctuation">.</span>top<span class="token operator">-</span>value
<span class="token number">1</span> <span class="token function">row</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> in <span class="token number">0.0250</span> seconds

<span class="token function">hbase</span><span class="token punctuation">(</span>main<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token number">008</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token operator">&gt;</span> quit
</code></pre> 
<p>7.2.2、测试 Hbase 故障转移<br>   我们在 c0 上停止掉 Hbase 的进程</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># jps
<span class="token number">13459</span> JournalNode
<span class="token number">14404</span> DFSZKFailoverController
<span class="token number">15974</span> JobHistoryServer
<span class="token number">19270</span> Jps
<span class="token number">15191</span> ResourceManager
<span class="token number">18185</span> HMaster
<span class="token number">9900</span> QuorumPeerMain
<span class="token number">13677</span> NameNode
<span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># kill <span class="token number">18185</span>
<span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># jps
<span class="token number">13459</span> JournalNode
<span class="token number">14404</span> DFSZKFailoverController
<span class="token number">15974</span> JobHistoryServer
<span class="token number">15191</span> ResourceManager
<span class="token number">19291</span> HMaster
<span class="token number">9900</span> QuorumPeerMain
<span class="token number">19404</span> Jps
<span class="token number">13677</span> NameNode
</code></pre> 
<p>这时再浏览 http://c0:16010 已经无法访问，浏览 http://c1:16010 已经切换到了 master<br> <img src="https://images2.imgbox.com/fa/89/xyOL4FhO_o.png" alt="在这里插入图片描述"><br> 8、安装 Mysql 5.7<br>   CentOS 的 yum 源中没有 Mysql，需要到 Mysql 的官网下载 yum repo 配置文件</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># cd <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_src
<span class="token punctuation">[</span>root@c0 _src<span class="token punctuation">]</span># wget https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>dev<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span>com<span class="token operator">/</span>get<span class="token operator">/</span>mysql57<span class="token operator">-</span>community<span class="token operator">-</span>release<span class="token operator">-</span>el7<span class="token operator">-</span><span class="token number">9.</span>noarch<span class="token punctuation">.</span>rpm
<span class="token punctuation">[</span>root@c0 _src<span class="token punctuation">]</span># rpm <span class="token operator">-</span>ivh mysql57<span class="token operator">-</span>community<span class="token operator">-</span>release<span class="token operator">-</span>el7<span class="token operator">-</span><span class="token number">9.</span>noarch<span class="token punctuation">.</span>rpm
<span class="token punctuation">[</span>root@c0 _src<span class="token punctuation">]</span># yum install mysql<span class="token operator">-</span>server <span class="token operator">-</span>y
</code></pre> 
<p>8.1、启动 Mysql<br>   通过以下命令，启动Mysql</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 _src<span class="token punctuation">]</span># systemctl start mysqld
</code></pre> 
<p>8.2、授权可以远程访问 Mysql<br>   查看安装时的临时密码</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 _src<span class="token punctuation">]</span># grep <span class="token string">'temporary password'</span> <span class="token operator">/</span>var<span class="token operator">/</span>log<span class="token operator">/</span>mysqld<span class="token punctuation">.</span>log
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">10</span>T14<span class="token punctuation">:</span><span class="token number">55</span><span class="token punctuation">:</span><span class="token number">05.727483</span>Z <span class="token number">1</span> <span class="token punctuation">[</span>Note<span class="token punctuation">]</span> A temporary password is generated <span class="token keyword">for</span> root@localhost<span class="token punctuation">:</span> B#ZJGyK<span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token operator">/</span><span class="token punctuation">)</span>
</code></pre> 
<p>上面的B#ZJGyK,1/)是密码，密码中带)，要使用\进行转义<br> 修改 Mysql5.7 默认密码为 123456</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 _src<span class="token punctuation">]</span># mysql <span class="token operator">-</span>uroot <span class="token operator">-</span>pB#ZJGyK<span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token operator">/</span>\<span class="token punctuation">)</span>
mysql<span class="token punctuation">:</span> <span class="token punctuation">[</span>Warning<span class="token punctuation">]</span> Using a password on the command line interface can be insecure<span class="token punctuation">.</span>
Welcome to the MySQL monitor<span class="token punctuation">.</span>  Commands end with <span class="token punctuation">;</span> or \g<span class="token punctuation">.</span>
Your MySQL connection id is <span class="token number">2</span>
Server version<span class="token punctuation">:</span> <span class="token number">5.7</span><span class="token number">.25</span>

Copyright <span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">2000</span><span class="token punctuation">,</span> <span class="token number">2019</span><span class="token punctuation">,</span> Oracle and<span class="token operator">/</span>or its affiliates<span class="token punctuation">.</span> All rights reserved<span class="token punctuation">.</span>

Oracle is a registered trademark of Oracle Corporation and<span class="token operator">/</span>or its
affiliates<span class="token punctuation">.</span> Other names may be trademarks of their respective
owners<span class="token punctuation">.</span>

Type <span class="token string">'help;'</span> or <span class="token string">'\h'</span> <span class="token keyword">for</span> help<span class="token punctuation">.</span> Type <span class="token string">'\c'</span> to clear the current input statement<span class="token punctuation">.</span>

mysql<span class="token operator">&gt;</span> set global validate_password_policy<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> rows affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> set global validate_password_length<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> rows affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> ALTER USER <span class="token string">'root'</span>@<span class="token string">'localhost'</span> IDENTIFIED BY <span class="token string">'123456'</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> rows affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span>
</code></pre> 
<p>8.3、修改 Mysql 授权远程访问<br>   执行下面的命令，让 Mysql 授权远程访问</p> 
<pre><code class="prism language-c">mysql<span class="token operator">&gt;</span> grant all on <span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span> to <span class="token string">'root'</span>@<span class="token string">'%'</span>  identified by <span class="token string">'123456'</span> WITH GRANT OPTION<span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> rows affected<span class="token punctuation">,</span> <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> flush privileges<span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> rows affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> quit
Bye
</code></pre> 
<p>9、安装 Hive2.3.4<br> 9.1、修改 Hive配置文件<br> 9.1.1、编辑配置文件 hive-env.sh<br>   将 /home/work/_app/hive-2.3.4/conf/hive-env.sh.template 复制为 /home/work/_app/hive-2.3.4/conf/hive-env.sh 文件</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># cp <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_app<span class="token operator">/</span>hive<span class="token operator">-</span><span class="token number">2.3</span><span class="token number">.4</span><span class="token operator">/</span>conf<span class="token operator">/</span>hive<span class="token operator">-</span>env<span class="token punctuation">.</span>sh<span class="token punctuation">.</span>template <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_app<span class="token operator">/</span>hive<span class="token operator">-</span><span class="token number">2.3</span><span class="token number">.4</span><span class="token operator">/</span>conf<span class="token operator">/</span>hive<span class="token operator">-</span>env<span class="token punctuation">.</span>sh
  
</code></pre> 
<p>在本文上面，我们对系统的环境变量已经做了统一设置，这里就不再编辑 /home/work/_app/hive-2.3.4/conf/hive-env.sh 文件</p> 
<p>9.1.2、编辑配置文件 hive-site.xml<br>   创建并编辑 /home/work/_app/hive-2.3.4/conf/hive-site.xml 文件，内容如下：</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># cat <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_app<span class="token operator">/</span>hive<span class="token operator">-</span><span class="token number">2.3</span><span class="token number">.4</span><span class="token operator">/</span>conf<span class="token operator">/</span>hive<span class="token operator">-</span>site<span class="token punctuation">.</span>xml
<span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">"1.0"</span> encoding<span class="token operator">=</span><span class="token string">"UTF-8"</span> standalone<span class="token operator">=</span><span class="token string">"no"</span><span class="token operator">?</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">?</span>xml<span class="token operator">-</span>stylesheet type<span class="token operator">=</span><span class="token string">"text/xsl"</span> href<span class="token operator">=</span><span class="token string">"configuration.xsl"</span><span class="token operator">?</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>
   Licensed to the Apache Software Foundation <span class="token punctuation">(</span>ASF<span class="token punctuation">)</span> under one or more
   contributor license agreements<span class="token punctuation">.</span>  See the NOTICE file distributed with
   this work <span class="token keyword">for</span> additional information regarding copyright ownership<span class="token punctuation">.</span>
   The ASF licenses this file to You under the Apache License<span class="token punctuation">,</span> Version <span class="token number">2.0</span>
   <span class="token punctuation">(</span>the <span class="token string">"License"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> you may not use this file except in compliance with
   the License<span class="token punctuation">.</span>  You may obtain a copy of the License at

       http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>org<span class="token operator">/</span>licenses<span class="token operator">/</span>LICENSE<span class="token operator">-</span><span class="token number">2.0</span>

   Unless required by applicable law or agreed to in writing<span class="token punctuation">,</span> software
   distributed under the License is distributed on an <span class="token string">"AS IS"</span> BASIS<span class="token punctuation">,</span>
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND<span class="token punctuation">,</span> either express or implied<span class="token punctuation">.</span>
   See the License <span class="token keyword">for</span> the specific language governing permissions and
   limitations under the License<span class="token punctuation">.</span>
<span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>configuration<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>system<span class="token punctuation">:</span>java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>tmpdir<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_data<span class="token operator">/</span>hive<span class="token operator">-</span><span class="token number">2.3</span><span class="token number">.4</span><span class="token operator">/</span>tmpdir<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>system<span class="token punctuation">:</span>user<span class="token punctuation">.</span>name<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>root<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>指定HDFS中的hive仓库地址<span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span> 
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>  
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>hive<span class="token punctuation">.</span>metastore<span class="token punctuation">.</span>warehouse<span class="token punctuation">.</span>dir<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>  
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token operator">/</span>hive<span class="token operator">/</span>warehouse<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>  
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>指定HDFS中的hive仓库地址<span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span> 
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>hive<span class="token punctuation">.</span>exec<span class="token punctuation">.</span>scratchdir<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_data<span class="token operator">/</span>hive<span class="token operator">-</span><span class="token number">2.3</span><span class="token number">.4</span><span class="token operator">/</span>scratchdir<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>Hive作业的划痕空间<span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>  
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>hive<span class="token punctuation">.</span>metastore<span class="token punctuation">.</span>uris<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>  
        <span class="token operator">&lt;</span>value <span class="token operator">/</span><span class="token operator">&gt;</span>  
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>远程元存储的节俭URI。该属性为空表示嵌入模式或本地模式，否则为远程模式 <span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>  
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>javax<span class="token punctuation">.</span>jdo<span class="token punctuation">.</span>option<span class="token punctuation">.</span>ConnectionURL<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>c0<span class="token punctuation">:</span><span class="token number">3306</span><span class="token operator">/</span>hive<span class="token operator">?</span>createDatabaseIfNotExist<span class="token operator">=</span>true<span class="token operator">&amp;</span>amp<span class="token punctuation">;</span>useSSL<span class="token operator">=</span>false<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>jdbc连接字符串<span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>javax<span class="token punctuation">.</span>jdo<span class="token punctuation">.</span>option<span class="token punctuation">.</span>ConnectionDriverName<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>com<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span>Driver<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>jdbc的连接驱动<span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>javax<span class="token punctuation">.</span>jdo<span class="token punctuation">.</span>option<span class="token punctuation">.</span>ConnectionUserName<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>root<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>用户名<span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>javax<span class="token punctuation">.</span>jdo<span class="token punctuation">.</span>option<span class="token punctuation">.</span>ConnectionPassword<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token number">123456</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>指定密码<span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>hive<span class="token punctuation">.</span>metastore<span class="token punctuation">.</span>schema<span class="token punctuation">.</span>verification<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>false<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>强制元存储架构版本一致性。<span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>hive<span class="token punctuation">.</span>aux<span class="token punctuation">.</span>jars<span class="token punctuation">.</span>path<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_app<span class="token operator">/</span>hive<span class="token operator">-</span><span class="token number">2.3</span><span class="token number">.4</span><span class="token operator">/</span>lib<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>包含用户定义函数和serde实现的插件jar的位置<span class="token punctuation">.</span><span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>configuration<span class="token operator">&gt;</span>
</code></pre> 
<p>9.1.3、下载 Mysql 驱动<br>   Hive 默认是没有带 Mysql 驱动程序的，我们需要下载并上传到 /home/work/_app/hive-2.3.4/lib</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># curl <span class="token operator">-</span>Ls https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>dev<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span>com<span class="token operator">/</span>get<span class="token operator">/</span>Downloads<span class="token operator">/</span>Connector<span class="token operator">-</span>J<span class="token operator">/</span>mysql<span class="token operator">-</span>connector<span class="token operator">-</span>java<span class="token operator">-</span><span class="token number">5.1</span><span class="token number">.47</span><span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz <span class="token operator">|</span> tar <span class="token operator">-</span>xz <span class="token operator">--</span>directory <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_src<span class="token operator">/</span> <span class="token operator">--</span>strip<span class="token operator">-</span>components<span class="token operator">=</span><span class="token number">1</span> <span class="token operator">--</span>no<span class="token operator">-</span>same<span class="token operator">-</span>owner
<span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># cp <span class="token operator">-</span>r <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_src<span class="token operator">/</span>mysql<span class="token operator">-</span>connector<span class="token operator">-</span>java<span class="token operator">-</span><span class="token number">5.1</span><span class="token number">.47</span><span class="token operator">-</span>bin<span class="token punctuation">.</span>jar <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_app<span class="token operator">/</span>hive<span class="token operator">-</span><span class="token number">2.3</span><span class="token number">.4</span><span class="token operator">/</span>lib<span class="token operator">/</span>
<span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># ll <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_app<span class="token operator">/</span>hive<span class="token operator">-</span><span class="token number">2.3</span><span class="token number">.4</span><span class="token operator">/</span>lib <span class="token operator">|</span> grep mysql
<span class="token operator">-</span>rw<span class="token operator">-</span>r<span class="token operator">--</span>r<span class="token operator">--</span><span class="token punctuation">.</span> <span class="token number">1</span> root root  <span class="token number">1007505</span> Mar <span class="token number">10</span> <span class="token number">22</span><span class="token punctuation">:</span><span class="token number">59</span> mysql<span class="token operator">-</span>connector<span class="token operator">-</span>java<span class="token operator">-</span><span class="token number">5.1</span><span class="token number">.47</span><span class="token operator">-</span>bin<span class="token punctuation">.</span>jar
<span class="token operator">-</span>rw<span class="token operator">-</span>r<span class="token operator">--</span>r<span class="token operator">--</span><span class="token punctuation">.</span> <span class="token number">1</span> root root     <span class="token number">7954</span> Oct <span class="token number">25</span> <span class="token number">14</span><span class="token punctuation">:</span><span class="token number">51</span> mysql<span class="token operator">-</span>metadata<span class="token operator">-</span>storage<span class="token operator">-</span><span class="token number">0.9</span><span class="token number">.2</span><span class="token punctuation">.</span>jar
</code></pre> 
<p>删除掉与 Hadoop 重复的 jar 包</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># rm <span class="token operator">-</span>rf <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_app<span class="token operator">/</span>hive<span class="token operator">-</span><span class="token number">2.3</span><span class="token number">.4</span><span class="token operator">/</span>lib<span class="token operator">/</span>log4j<span class="token operator">-</span>slf4j<span class="token operator">-</span>impl<span class="token operator">-</span><span class="token number">2.6</span><span class="token number">.2</span><span class="token punctuation">.</span>jar
  
</code></pre> 
<p>9.2、启动 Hive<br> 9.2.1、初始化 MySql 数据库<br>   使用 Hive schematool 初始化当前 Hive 版本的 Metastore 架构。该工具尝试从 Metastore 中找到当前架构（如果它在那里可用）。<br>   schematool 确定初始化或升级架构所需的SQL脚本，然后针对后端数据库执行这些脚本。从 Hive 配置中提取 Metastore 数据库连接信息，例如 JDBC URL，JDBC driver 和数据库凭据。</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># schematool <span class="token operator">-</span>dbType mysql <span class="token operator">-</span>initSchema
Metastore connection URL<span class="token punctuation">:</span>    jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>c0<span class="token punctuation">:</span><span class="token number">3306</span><span class="token operator">/</span>hive<span class="token operator">?</span>createDatabaseIfNotExist<span class="token operator">=</span>true<span class="token operator">&amp;</span>useSSL<span class="token operator">=</span>false
Metastore Connection Driver <span class="token punctuation">:</span>    com<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span>Driver
Metastore connection User<span class="token punctuation">:</span>   root
Starting metastore schema initialization to <span class="token number">2.3</span><span class="token number">.0</span>
Initialization script hive<span class="token operator">-</span>schema<span class="token operator">-</span><span class="token number">2.3</span><span class="token number">.0</span><span class="token punctuation">.</span>mysql<span class="token punctuation">.</span>sql
Initialization script completed
schemaTool completed
</code></pre> 
<p>9.2.2、创建测试数据，以及在hadoop上创建数据仓库目录<br>   创建 /home/work/_app/hive-2.3.4/testdata001.dat 文件编辑并保存，内容如下：</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># cat <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_app<span class="token operator">/</span>hive<span class="token operator">-</span><span class="token number">2.3</span><span class="token number">.4</span><span class="token operator">/</span>testdata001<span class="token punctuation">.</span>dat
<span class="token number">12306</span><span class="token punctuation">,</span>mname<span class="token punctuation">,</span>yname
<span class="token number">10086</span><span class="token punctuation">,</span>my<span class="token punctuation">.</span>mshk<span class="token punctuation">.</span>top<span class="token punctuation">,</span>you<span class="token punctuation">.</span>mshk<span class="token punctuation">.</span>top
</code></pre> 
<p>在 Hadoop 上创建数据仓库目录</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 _src<span class="token punctuation">]</span># hadoop fs <span class="token operator">-</span>mkdir <span class="token operator">-</span>p <span class="token operator">/</span>hive<span class="token operator">/</span>warehouse
</code></pre> 
<p>9.2.3、用 Shell 测试连接 Hive</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 _src<span class="token punctuation">]</span># hive

Logging initialized using configuration in jar<span class="token punctuation">:</span>file<span class="token punctuation">:</span><span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_app<span class="token operator">/</span>hive<span class="token operator">-</span><span class="token number">2.3</span><span class="token number">.4</span><span class="token operator">/</span>lib<span class="token operator">/</span>hive<span class="token operator">-</span>common<span class="token operator">-</span><span class="token number">2.3</span><span class="token number">.4</span><span class="token punctuation">.</span>jar<span class="token operator">!</span><span class="token operator">/</span>hive<span class="token operator">-</span>log4j2<span class="token punctuation">.</span>properties Async<span class="token punctuation">:</span> true
Hive<span class="token operator">-</span>on<span class="token operator">-</span>MR is deprecated in Hive <span class="token number">2</span> and may not be available in the future versions<span class="token punctuation">.</span> Consider using a different execution engine <span class="token punctuation">(</span>i<span class="token punctuation">.</span>e<span class="token punctuation">.</span> spark<span class="token punctuation">,</span> tez<span class="token punctuation">)</span> or using Hive <span class="token number">1.</span>X releases<span class="token punctuation">.</span>
hive<span class="token operator">&gt;</span> show databases<span class="token punctuation">;</span>
OK
<span class="token keyword">default</span>
Time taken<span class="token punctuation">:</span> <span class="token number">4.071</span> seconds<span class="token punctuation">,</span> Fetched<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token function">row</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
hive<span class="token operator">&gt;</span> create database testmshk<span class="token punctuation">;</span>
OK
Time taken<span class="token punctuation">:</span> <span class="token number">0.261</span> seconds
hive<span class="token operator">&gt;</span> show databases<span class="token punctuation">;</span>
OK
<span class="token keyword">default</span>
testmshk
Time taken<span class="token punctuation">:</span> <span class="token number">0.031</span> seconds<span class="token punctuation">,</span> Fetched<span class="token punctuation">:</span> <span class="token number">2</span> <span class="token function">row</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
hive<span class="token operator">&gt;</span> use testmshk<span class="token punctuation">;</span>
OK
Time taken<span class="token punctuation">:</span> <span class="token number">0.1</span> seconds
hive<span class="token operator">&gt;</span> create external table <span class="token function">testtable</span><span class="token punctuation">(</span>uid <span class="token keyword">int</span><span class="token punctuation">,</span>myname string<span class="token punctuation">,</span>youname string<span class="token punctuation">)</span> row format delimited fields terminated by <span class="token string">','</span> location <span class="token string">'/hive/warehouse/testtable'</span><span class="token punctuation">;</span>
OK
Time taken<span class="token punctuation">:</span> <span class="token number">0.247</span> seconds
hive<span class="token operator">&gt;</span> LOAD DATA LOCAL INPATH <span class="token string">'/home/work/_app/hive-2.3.4/testdata001.dat'</span> OVERWRITE INTO TABLE testtable<span class="token punctuation">;</span>
Loading data to table testmshk<span class="token punctuation">.</span>testtable
OK
Time taken<span class="token punctuation">:</span> <span class="token number">1.017</span> seconds
hive<span class="token operator">&gt;</span> select <span class="token operator">*</span> from testtable<span class="token punctuation">;</span>
OK
<span class="token number">12306</span>   mname   yname
<span class="token number">10086</span>   my<span class="token punctuation">.</span>mshk<span class="token punctuation">.</span>top you<span class="token punctuation">.</span>mshk<span class="token punctuation">.</span>top
Time taken<span class="token punctuation">:</span> <span class="token number">1.377</span> seconds<span class="token punctuation">,</span> Fetched<span class="token punctuation">:</span> <span class="token number">2</span> <span class="token function">row</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
hive<span class="token operator">&gt;</span> quit<span class="token punctuation">;</span>
</code></pre> 
<p>9.2.4、Hive to Hbase<br>   Hive 中的表数据导入到 Hbase 中去，先创建 Hbase 可以识别的表</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 _src<span class="token punctuation">]</span># hive

Logging initialized using configuration in jar<span class="token punctuation">:</span>file<span class="token punctuation">:</span><span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_app<span class="token operator">/</span>hive<span class="token operator">-</span><span class="token number">2.3</span><span class="token number">.4</span><span class="token operator">/</span>lib<span class="token operator">/</span>hive<span class="token operator">-</span>common<span class="token operator">-</span><span class="token number">2.3</span><span class="token number">.4</span><span class="token punctuation">.</span>jar<span class="token operator">!</span><span class="token operator">/</span>hive<span class="token operator">-</span>log4j2<span class="token punctuation">.</span>properties Async<span class="token punctuation">:</span> true
Hive<span class="token operator">-</span>on<span class="token operator">-</span>MR is deprecated in Hive <span class="token number">2</span> and may not be available in the future versions<span class="token punctuation">.</span> Consider using a different execution engine <span class="token punctuation">(</span>i<span class="token punctuation">.</span>e<span class="token punctuation">.</span> spark<span class="token punctuation">,</span> tez<span class="token punctuation">)</span> or using Hive <span class="token number">1.</span>X releases<span class="token punctuation">.</span>
hive<span class="token operator">&gt;</span>  show databases<span class="token punctuation">;</span>
OK
<span class="token keyword">default</span>
testmshk
Time taken<span class="token punctuation">:</span> <span class="token number">3.614</span> seconds<span class="token punctuation">,</span> Fetched<span class="token punctuation">:</span> <span class="token number">2</span> <span class="token function">row</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
hive<span class="token operator">&gt;</span> CREATE TABLE <span class="token function">hive2hbase_mshk</span><span class="token punctuation">(</span>key <span class="token keyword">int</span><span class="token punctuation">,</span> value string<span class="token punctuation">)</span> STORED BY <span class="token string">'org.apache.hadoop.hive.hbase.HBaseStorageHandler'</span> WITH SERDEPROPERTIES <span class="token punctuation">(</span><span class="token string">"hbase.columns.mapping"</span> <span class="token operator">=</span> <span class="token string">":key,cf1:val"</span><span class="token punctuation">)</span> TBLPROPERTIES <span class="token punctuation">(</span><span class="token string">"hbase.table.name"</span> <span class="token operator">=</span> <span class="token string">"hive2hbase_mshk"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
OK
Time taken<span class="token punctuation">:</span> <span class="token number">2.71</span> seconds
hive<span class="token operator">&gt;</span> show tables<span class="token punctuation">;</span>
OK
hive2hbase_mshk
Time taken<span class="token punctuation">:</span> <span class="token number">0.056</span> seconds<span class="token punctuation">,</span> Fetched<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token function">row</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
hive<span class="token operator">&gt;</span>
</code></pre> 
<p>创建本地表，用来存储数据，然后插入到 Hbase 用的，相当于一张中间表了。同时将之前的测试数据导入到这张中间表。</p> 
<pre><code class="prism language-c">hive<span class="token operator">&gt;</span> create table <span class="token function">hive2hbase_mshk_middle</span><span class="token punctuation">(</span>foo <span class="token keyword">int</span><span class="token punctuation">,</span>bar string<span class="token punctuation">)</span>row format delimited fields terminated by <span class="token string">','</span><span class="token punctuation">;</span>
OK
Time taken<span class="token punctuation">:</span> <span class="token number">0.139</span> seconds
hive<span class="token operator">&gt;</span> load data local inpath <span class="token string">'/home/work/_app/hive-2.3.4/testdata001.dat'</span> overwrite into table hive2hbase_mshk_middle<span class="token punctuation">;</span>
Loading data to table <span class="token keyword">default</span><span class="token punctuation">.</span>hive2hbase_mshk_middle
OK
Time taken<span class="token punctuation">:</span> <span class="token number">0.733</span> seconds
hive<span class="token operator">&gt;</span>
</code></pre> 
<p>将本地中间表 hive2hbase_mshk_middle 导入到表 hive2hbase_mshk 中，会自动同步到 Hbase。</p> 
<pre><code class="prism language-c">hive<span class="token operator">&gt;</span> insert overwrite table hive2hbase_mshk select <span class="token operator">*</span> from hive2hbase_mshk_middle<span class="token punctuation">;</span>
WARNING<span class="token punctuation">:</span> Hive<span class="token operator">-</span>on<span class="token operator">-</span>MR is deprecated in Hive <span class="token number">2</span> and may not be available in the future versions<span class="token punctuation">.</span> Consider using a different execution engine <span class="token punctuation">(</span>i<span class="token punctuation">.</span>e<span class="token punctuation">.</span> spark<span class="token punctuation">,</span> tez<span class="token punctuation">)</span> or using Hive <span class="token number">1.</span>X releases<span class="token punctuation">.</span>
Query ID <span class="token operator">=</span> root_20190310230625_a285d829<span class="token operator">-</span><span class="token number">93</span>a3<span class="token operator">-</span><span class="token number">47</span>c1<span class="token operator">-</span><span class="token number">8</span>aa6<span class="token operator">-</span><span class="token number">6430</span>a792c10c
Total jobs <span class="token operator">=</span> <span class="token number">1</span>
Launching Job <span class="token number">1</span> out of <span class="token number">1</span>
Number of reduce tasks is set to <span class="token number">0</span> since there's no reduce operator
Starting Job <span class="token operator">=</span> job_1552228449632_0002<span class="token punctuation">,</span> Tracking URL <span class="token operator">=</span> http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>c1<span class="token punctuation">:</span><span class="token number">8088</span><span class="token operator">/</span>proxy<span class="token operator">/</span>application_1552228449632_0002<span class="token operator">/</span>
Kill Command <span class="token operator">=</span> <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_app<span class="token operator">/</span>hadoop<span class="token operator">-</span><span class="token number">3.1</span><span class="token number">.2</span><span class="token operator">/</span>bin<span class="token operator">/</span>hadoop job  <span class="token operator">-</span>kill job_1552228449632_0002
Hadoop job information <span class="token keyword">for</span> Stage<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">:</span> number of mappers<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">;</span> number of reducers<span class="token punctuation">:</span> <span class="token number">0</span>
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">23</span><span class="token punctuation">:</span><span class="token number">06</span><span class="token punctuation">:</span><span class="token number">53</span><span class="token punctuation">,</span><span class="token number">294</span> Stage<span class="token operator">-</span><span class="token number">3</span> map <span class="token operator">=</span> <span class="token number">0</span><span class="token operator">%</span><span class="token punctuation">,</span>  reduce <span class="token operator">=</span> <span class="token number">0</span><span class="token operator">%</span>
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">23</span><span class="token punctuation">:</span><span class="token number">07</span><span class="token punctuation">:</span><span class="token number">04</span><span class="token punctuation">,</span><span class="token number">258</span> Stage<span class="token operator">-</span><span class="token number">3</span> map <span class="token operator">=</span> <span class="token number">100</span><span class="token operator">%</span><span class="token punctuation">,</span>  reduce <span class="token operator">=</span> <span class="token number">0</span><span class="token operator">%</span><span class="token punctuation">,</span> Cumulative CPU <span class="token number">4.35</span> sec
MapReduce Total cumulative CPU time<span class="token punctuation">:</span> <span class="token number">4</span> seconds <span class="token number">350</span> msec
Ended Job <span class="token operator">=</span> job_1552228449632_0002
MapReduce Jobs Launched<span class="token punctuation">:</span>
Stage<span class="token operator">-</span>Stage<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">:</span> Map<span class="token punctuation">:</span> <span class="token number">1</span>   Cumulative CPU<span class="token punctuation">:</span> <span class="token number">4.35</span> sec   HDFS Read<span class="token punctuation">:</span> <span class="token number">10643</span> HDFS Write<span class="token punctuation">:</span> <span class="token number">0</span> SUCCESS
Total MapReduce CPU Time Spent<span class="token punctuation">:</span> <span class="token number">4</span> seconds <span class="token number">350</span> msec
OK
Time taken<span class="token punctuation">:</span> <span class="token number">40.76</span> seconds
hive<span class="token operator">&gt;</span> select <span class="token operator">*</span> from hive2hbase_mshk<span class="token punctuation">;</span>
OK
<span class="token number">10086</span>   my<span class="token punctuation">.</span>mshk<span class="token punctuation">.</span>top
<span class="token number">12306</span>   mname
Time taken<span class="token punctuation">:</span> <span class="token number">0.315</span> seconds<span class="token punctuation">,</span> Fetched<span class="token punctuation">:</span> <span class="token number">2</span> <span class="token function">row</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
hive<span class="token operator">&gt;</span>
</code></pre> 
<p>用 Shell 连接 Hbase，查看 Hive 过来的数据是否已经存在</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 _src<span class="token punctuation">]</span># hbase shell
HBase Shell
Use <span class="token string">"help"</span> to get list of supported commands<span class="token punctuation">.</span>
Use <span class="token string">"exit"</span> to quit this interactive shell<span class="token punctuation">.</span>
Version <span class="token number">1.4</span><span class="token number">.9</span><span class="token punctuation">,</span> rd625b212e46d01cb17db9ac2e9e927fdb201afa1<span class="token punctuation">,</span> Wed Dec  <span class="token number">5</span> <span class="token number">11</span><span class="token punctuation">:</span><span class="token number">54</span><span class="token punctuation">:</span><span class="token number">10</span> PST <span class="token number">2018</span>

<span class="token function">hbase</span><span class="token punctuation">(</span>main<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token number">001</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token operator">&gt;</span> list
TABLE
hive2hbase_mshk
mshk_top
<span class="token number">2</span> <span class="token function">row</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> in <span class="token number">0.2150</span> seconds

<span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token string">"hive2hbase_mshk"</span><span class="token punctuation">,</span> <span class="token string">"mshk_top"</span><span class="token punctuation">]</span>
<span class="token function">hbase</span><span class="token punctuation">(</span>main<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token number">002</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token operator">&gt;</span> scan <span class="token string">"hive2hbase_mshk"</span>
ROW                                                        COLUMN<span class="token operator">+</span>CELL
 <span class="token number">10086</span>                                                     column<span class="token operator">=</span>cf1<span class="token punctuation">:</span>val<span class="token punctuation">,</span> timestamp<span class="token operator">=</span><span class="token number">1551874886611</span><span class="token punctuation">,</span> value<span class="token operator">=</span>my<span class="token punctuation">.</span>mshk<span class="token punctuation">.</span>top
 <span class="token number">12306</span>                                                     column<span class="token operator">=</span>cf1<span class="token punctuation">:</span>val<span class="token punctuation">,</span> timestamp<span class="token operator">=</span><span class="token number">1551874886611</span><span class="token punctuation">,</span> value<span class="token operator">=</span>mname
<span class="token number">2</span> <span class="token function">row</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> in <span class="token number">0.1280</span> seconds

<span class="token function">hbase</span><span class="token punctuation">(</span>main<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token number">003</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token operator">&gt;</span> get <span class="token string">"hive2hbase_mshk"</span><span class="token punctuation">,</span><span class="token string">'10086'</span>
COLUMN                                                     CELL
 cf1<span class="token punctuation">:</span>val                                                   timestamp<span class="token operator">=</span><span class="token number">1551874886611</span><span class="token punctuation">,</span> value<span class="token operator">=</span>my<span class="token punctuation">.</span>mshk<span class="token punctuation">.</span>top
<span class="token number">1</span> <span class="token function">row</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> in <span class="token number">0.0310</span> seconds

<span class="token function">hbase</span><span class="token punctuation">(</span>main<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token number">004</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token operator">&gt;</span>
</code></pre> 
<p>9.2.5、Hbase to Hive<br>   在 Hbase 下创建表 hbase2hive_mshk</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 _src<span class="token punctuation">]</span># hbase shell
HBase Shell
Use <span class="token string">"help"</span> to get list of supported commands<span class="token punctuation">.</span>
Use <span class="token string">"exit"</span> to quit this interactive shell<span class="token punctuation">.</span>
Version <span class="token number">1.4</span><span class="token number">.9</span><span class="token punctuation">,</span> rd625b212e46d01cb17db9ac2e9e927fdb201afa1<span class="token punctuation">,</span> Wed Dec  <span class="token number">5</span> <span class="token number">11</span><span class="token punctuation">:</span><span class="token number">54</span><span class="token punctuation">:</span><span class="token number">10</span> PST <span class="token number">2018</span>

<span class="token function">hbase</span><span class="token punctuation">(</span>main<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token number">001</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token operator">&gt;</span> create <span class="token string">'hbase2hive_mshk'</span><span class="token punctuation">,</span><span class="token punctuation">{<!-- --></span> NAME <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'cf'</span><span class="token punctuation">,</span> COMPRESSION <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'SNAPPY'</span> <span class="token punctuation">}</span>
<span class="token number">0</span> <span class="token function">row</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> in <span class="token number">1.3120</span> seconds

<span class="token operator">=</span><span class="token operator">&gt;</span> Hbase<span class="token punctuation">:</span><span class="token punctuation">:</span>Table <span class="token operator">-</span> hbase2hive_mshk
<span class="token function">hbase</span><span class="token punctuation">(</span>main<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token number">002</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token operator">&gt;</span> put <span class="token string">'hbase2hive_mshk'</span><span class="token punctuation">,</span><span class="token string">'1'</span><span class="token punctuation">,</span><span class="token string">'cf:name'</span><span class="token punctuation">,</span><span class="token string">'mshk.top 1'</span>
<span class="token number">0</span> <span class="token function">row</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> in <span class="token number">0.5320</span> seconds

<span class="token function">hbase</span><span class="token punctuation">(</span>main<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token number">003</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token operator">&gt;</span> put <span class="token string">'hbase2hive_mshk'</span><span class="token punctuation">,</span><span class="token string">'2'</span><span class="token punctuation">,</span><span class="token string">'cf:name'</span><span class="token punctuation">,</span><span class="token string">'mshk.top 2'</span>
<span class="token number">0</span> <span class="token function">row</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> in <span class="token number">0.0250</span> seconds

<span class="token function">hbase</span><span class="token punctuation">(</span>main<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token number">004</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token operator">&gt;</span> put <span class="token string">'hbase2hive_mshk'</span><span class="token punctuation">,</span><span class="token string">'3'</span><span class="token punctuation">,</span><span class="token string">'cf:name'</span><span class="token punctuation">,</span><span class="token string">'mshk.top 3'</span>
<span class="token number">0</span> <span class="token function">row</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> in <span class="token number">0.0080</span> seconds

<span class="token function">hbase</span><span class="token punctuation">(</span>main<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token number">005</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token operator">&gt;</span> scan <span class="token string">'hbase2hive_mshk'</span>
ROW                                                        COLUMN<span class="token operator">+</span>CELL
 <span class="token number">1</span>                                                         column<span class="token operator">=</span>cf<span class="token punctuation">:</span>name<span class="token punctuation">,</span> timestamp<span class="token operator">=</span><span class="token number">1551877176349</span><span class="token punctuation">,</span> value<span class="token operator">=</span>mshk<span class="token punctuation">.</span>top <span class="token number">1</span>
 <span class="token number">2</span>                                                         column<span class="token operator">=</span>cf<span class="token punctuation">:</span>name<span class="token punctuation">,</span> timestamp<span class="token operator">=</span><span class="token number">1551877186366</span><span class="token punctuation">,</span> value<span class="token operator">=</span>mshk<span class="token punctuation">.</span>top <span class="token number">2</span>
 <span class="token number">3</span>                                                         column<span class="token operator">=</span>cf<span class="token punctuation">:</span>name<span class="token punctuation">,</span> timestamp<span class="token operator">=</span><span class="token number">1551877191913</span><span class="token punctuation">,</span> value<span class="token operator">=</span>mshk<span class="token punctuation">.</span>top <span class="token number">3</span>
<span class="token number">3</span> <span class="token function">row</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> in <span class="token number">0.0500</span> seconds

<span class="token function">hbase</span><span class="token punctuation">(</span>main<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token number">006</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token operator">&gt;</span>
</code></pre> 
<p>Hive 下创建表连接 Hbase 中的表</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 _src<span class="token punctuation">]</span># hive

Logging initialized using configuration in jar<span class="token punctuation">:</span>file<span class="token punctuation">:</span><span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_app<span class="token operator">/</span>hive<span class="token operator">-</span><span class="token number">2.3</span><span class="token number">.4</span><span class="token operator">/</span>lib<span class="token operator">/</span>hive<span class="token operator">-</span>common<span class="token operator">-</span><span class="token number">2.3</span><span class="token number">.4</span><span class="token punctuation">.</span>jar<span class="token operator">!</span><span class="token operator">/</span>hive<span class="token operator">-</span>log4j2<span class="token punctuation">.</span>properties Async<span class="token punctuation">:</span> true
Hive<span class="token operator">-</span>on<span class="token operator">-</span>MR is deprecated in Hive <span class="token number">2</span> and may not be available in the future versions<span class="token punctuation">.</span> Consider using a different execution engine <span class="token punctuation">(</span>i<span class="token punctuation">.</span>e<span class="token punctuation">.</span> spark<span class="token punctuation">,</span> tez<span class="token punctuation">)</span> or using Hive <span class="token number">1.</span>X releases<span class="token punctuation">.</span>

hive<span class="token operator">&gt;</span> create external table <span class="token keyword">default</span><span class="token punctuation">.</span><span class="token function">hbase2hive_mshk</span><span class="token punctuation">(</span>id <span class="token keyword">int</span><span class="token punctuation">,</span> name string<span class="token punctuation">)</span> STORED BY <span class="token string">'org.apache.hadoop.hive.hbase.HBaseStorageHandler'</span> WITH SERDEPROPERTIES  <span class="token punctuation">(</span><span class="token string">"hbase.columns.mapping"</span><span class="token operator">=</span><span class="token string">":key,cf:name"</span><span class="token punctuation">)</span> TBLPROPERTIES <span class="token punctuation">(</span><span class="token string">"hbase.table.name"</span><span class="token operator">=</span><span class="token string">"hbase2hive_mshk"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
OK
Time taken<span class="token punctuation">:</span> <span class="token number">22.888</span> seconds
hive<span class="token operator">&gt;</span> use <span class="token keyword">default</span><span class="token punctuation">;</span>
OK
Time taken<span class="token punctuation">:</span> <span class="token number">3.592</span> seconds
hive<span class="token operator">&gt;</span> show tables<span class="token punctuation">;</span>
OK
hbase2hive_mshk
hive2hbase_mshk
hive2hbase_mshk_middle
Time taken<span class="token punctuation">:</span> <span class="token number">16.7</span> seconds<span class="token punctuation">,</span> Fetched<span class="token punctuation">:</span> <span class="token number">3</span> <span class="token function">row</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
hive<span class="token operator">&gt;</span> select <span class="token operator">*</span> from hbase2hive_mshk<span class="token punctuation">;</span>
OK
<span class="token number">1</span>   mshk<span class="token punctuation">.</span>top <span class="token number">1</span>
<span class="token number">2</span>   mshk<span class="token punctuation">.</span>top <span class="token number">2</span>
<span class="token number">3</span>   mshk<span class="token punctuation">.</span>top <span class="token number">3</span>
Time taken<span class="token punctuation">:</span> <span class="token number">250.526</span> seconds<span class="token punctuation">,</span> Fetched<span class="token punctuation">:</span> <span class="token number">3</span> <span class="token function">row</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
hive<span class="token operator">&gt;</span>
</code></pre> 
<p>10、安装 Spark 2.4.0<br> 10.1、修改 Spark 配置文件<br> 10.1.1、编辑配置文件 spark-env.sh<br>   创建 /home/work/_app/spark-2.4.0-bin-hadoop2.7/conf/spark-env.sh 文件编辑并保存，内容如下：</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># cat <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_app<span class="token operator">/</span>spark<span class="token operator">-</span><span class="token number">2.4</span><span class="token number">.0</span><span class="token operator">-</span>bin<span class="token operator">-</span>hadoop2<span class="token punctuation">.</span><span class="token number">7</span><span class="token operator">/</span>conf<span class="token operator">/</span>spark<span class="token operator">-</span>env<span class="token punctuation">.</span>sh
#<span class="token operator">!</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env bash


export SPARK_DAEMON_JAVA_OPTS<span class="token operator">=</span><span class="token string">"-Dspark.deploy.recoveryMode=ZOOKEEPER -Dspark.deploy.zookeeper.url=c0:2181,c1:2181,c2:2181,c3:2181 -Dspark.deploy.zookeeper.dir=/spark-2.4.0-bin-hadoop2.7"</span>
export SPARK_LOG_DIR<span class="token operator">=</span><span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_logs<span class="token operator">/</span>spark<span class="token operator">-</span><span class="token number">2.4</span><span class="token number">.0</span><span class="token operator">-</span>bin<span class="token operator">-</span>hadoop2<span class="token punctuation">.</span><span class="token number">7</span>

<span class="token macro property"># Spark Work内存使用量</span>
export SPARK_WORKER_MEMORY<span class="token operator">=</span><span class="token number">512</span>M

# 该参数决定了yarn集群中，最多能够同时启动的EXECUTOR的实例个数。
export SPARK_EXECUTOR_INSTANCES<span class="token operator">=</span><span class="token number">3</span>

# 设置每个EXECUTOR能够使用的CPU core的数量。
export SPARK_EXECUTOR_CORES<span class="token operator">=</span><span class="token number">3</span>

# 该参数设置的是每个EXECUTOR分配的内存的数量
export SPARK_EXECUTOR_MEMORY<span class="token operator">=</span><span class="token number">512</span>M

#该参数设置的是DRIVER分配的内存的大小
export SPARK_DRIVER_MEMORY<span class="token operator">=</span><span class="token number">1</span>G

<span class="token macro property"># Spark Application在Yarn中的名字</span>
export SPARK_YARN_APP_NAME<span class="token operator">=</span><span class="token string">"lion.Spark-2.4.0"</span>

# 指定在yarn中执行，提交方式为client
<span class="token macro property">#MASTER=yarn-cluster</span>

#
<span class="token macro property"># Licensed to the Apache Software Foundation (ASF) under one or more</span>
<span class="token macro property"># contributor license agreements.  See the NOTICE file distributed with</span>
<span class="token macro property"># this work for additional information regarding copyright ownership.</span>
<span class="token macro property"># The ASF licenses this file to You under the Apache License, Version 2.0</span>
# <span class="token punctuation">(</span>the <span class="token string">"License"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> you may not use this file except in compliance with
<span class="token macro property"># the License.  You may obtain a copy of the License at</span>
#
<span class="token macro property">#    http://www.apache.org/licenses/LICENSE-2.0</span>
#
<span class="token macro property"># Unless required by applicable law or agreed to in writing, software</span>
<span class="token macro property"># distributed under the License is distributed on an "AS IS" BASIS,</span>
<span class="token macro property"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="token macro property"># See the License for the specific language governing permissions and</span>
<span class="token macro property"># limitations under the License.</span>
#

<span class="token macro property"># This file is sourced when running various Spark programs.</span>
<span class="token macro property"># Copy it as spark-env.sh and edit that to configure Spark for your site.</span>

<span class="token macro property"># Options read when launching programs locally with</span>
# <span class="token punctuation">.</span><span class="token operator">/</span>bin<span class="token operator">/</span>run<span class="token operator">-</span>example or <span class="token punctuation">.</span><span class="token operator">/</span>bin<span class="token operator">/</span>spark<span class="token operator">-</span>submit
# <span class="token operator">-</span> HADOOP_CONF_DIR<span class="token punctuation">,</span> to point Spark towards Hadoop configuration files
# <span class="token operator">-</span> SPARK_LOCAL_IP<span class="token punctuation">,</span> to set the IP address Spark binds to on this node
# <span class="token operator">-</span> SPARK_PUBLIC_DNS<span class="token punctuation">,</span> to set the public dns name of the driver program

<span class="token macro property"># Options read by executors and drivers running inside the cluster</span>
# <span class="token operator">-</span> SPARK_LOCAL_IP<span class="token punctuation">,</span> to set the IP address Spark binds to on this node
# <span class="token operator">-</span> SPARK_PUBLIC_DNS<span class="token punctuation">,</span> to set the public DNS name of the driver program
# <span class="token operator">-</span> SPARK_LOCAL_DIRS<span class="token punctuation">,</span> storage directories to use on this node <span class="token keyword">for</span> shuffle and RDD data
# <span class="token operator">-</span> MESOS_NATIVE_JAVA_LIBRARY<span class="token punctuation">,</span> to point to your libmesos<span class="token punctuation">.</span>so <span class="token keyword">if</span> you use Mesos

<span class="token macro property"># Options read in YARN client/cluster mode</span>
# <span class="token operator">-</span> SPARK_CONF_DIR<span class="token punctuation">,</span> Alternate conf dir<span class="token punctuation">.</span> <span class="token punctuation">(</span>Default<span class="token punctuation">:</span> $<span class="token punctuation">{<!-- --></span>SPARK_HOME<span class="token punctuation">}</span><span class="token operator">/</span>conf<span class="token punctuation">)</span>
# <span class="token operator">-</span> HADOOP_CONF_DIR<span class="token punctuation">,</span> to point Spark towards Hadoop configuration files
# <span class="token operator">-</span> YARN_CONF_DIR<span class="token punctuation">,</span> to point Spark towards YARN configuration files when you use YARN
# <span class="token operator">-</span> SPARK_EXECUTOR_CORES<span class="token punctuation">,</span> Number of cores <span class="token keyword">for</span> the executors <span class="token punctuation">(</span>Default<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
# <span class="token operator">-</span> SPARK_EXECUTOR_MEMORY<span class="token punctuation">,</span> Memory per Executor <span class="token punctuation">(</span>e<span class="token punctuation">.</span>g<span class="token punctuation">.</span> <span class="token number">1000</span>M<span class="token punctuation">,</span> <span class="token number">2</span>G<span class="token punctuation">)</span> <span class="token punctuation">(</span>Default<span class="token punctuation">:</span> <span class="token number">1</span>G<span class="token punctuation">)</span>
# <span class="token operator">-</span> SPARK_DRIVER_MEMORY<span class="token punctuation">,</span> Memory <span class="token keyword">for</span> Driver <span class="token punctuation">(</span>e<span class="token punctuation">.</span>g<span class="token punctuation">.</span> <span class="token number">1000</span>M<span class="token punctuation">,</span> <span class="token number">2</span>G<span class="token punctuation">)</span> <span class="token punctuation">(</span>Default<span class="token punctuation">:</span> <span class="token number">1</span>G<span class="token punctuation">)</span>

<span class="token macro property"># Options for the daemons used in the standalone deploy mode</span>
# <span class="token operator">-</span> SPARK_MASTER_HOST<span class="token punctuation">,</span> to bind the master to a different IP address or hostname
# <span class="token operator">-</span> SPARK_MASTER_PORT <span class="token operator">/</span> SPARK_MASTER_WEBUI_PORT<span class="token punctuation">,</span> to use non<span class="token operator">-</span><span class="token keyword">default</span> ports <span class="token keyword">for</span> the master
# <span class="token operator">-</span> SPARK_MASTER_OPTS<span class="token punctuation">,</span> to set config properties only <span class="token keyword">for</span> the master <span class="token punctuation">(</span>e<span class="token punctuation">.</span>g<span class="token punctuation">.</span> <span class="token string">"-Dx=y"</span><span class="token punctuation">)</span>
# <span class="token operator">-</span> SPARK_WORKER_CORES<span class="token punctuation">,</span> to set the number of cores to use on this machine
# <span class="token operator">-</span> SPARK_WORKER_MEMORY<span class="token punctuation">,</span> to set how much total memory workers have to give executors <span class="token punctuation">(</span>e<span class="token punctuation">.</span>g<span class="token punctuation">.</span> <span class="token number">1000</span>m<span class="token punctuation">,</span> <span class="token number">2</span>g<span class="token punctuation">)</span>
# <span class="token operator">-</span> SPARK_WORKER_PORT <span class="token operator">/</span> SPARK_WORKER_WEBUI_PORT<span class="token punctuation">,</span> to use non<span class="token operator">-</span><span class="token keyword">default</span> ports <span class="token keyword">for</span> the worker
# <span class="token operator">-</span> SPARK_WORKER_DIR<span class="token punctuation">,</span> to set the working directory of worker processes
# <span class="token operator">-</span> SPARK_WORKER_OPTS<span class="token punctuation">,</span> to set config properties only <span class="token keyword">for</span> the worker <span class="token punctuation">(</span>e<span class="token punctuation">.</span>g<span class="token punctuation">.</span> <span class="token string">"-Dx=y"</span><span class="token punctuation">)</span>
# <span class="token operator">-</span> SPARK_DAEMON_MEMORY<span class="token punctuation">,</span> to allocate to the master<span class="token punctuation">,</span> worker and history server themselves <span class="token punctuation">(</span><span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token number">1</span>g<span class="token punctuation">)</span><span class="token punctuation">.</span>
# <span class="token operator">-</span> SPARK_HISTORY_OPTS<span class="token punctuation">,</span> to set config properties only <span class="token keyword">for</span> the history server <span class="token punctuation">(</span>e<span class="token punctuation">.</span>g<span class="token punctuation">.</span> <span class="token string">"-Dx=y"</span><span class="token punctuation">)</span>
# <span class="token operator">-</span> SPARK_SHUFFLE_OPTS<span class="token punctuation">,</span> to set config properties only <span class="token keyword">for</span> the external shuffle service <span class="token punctuation">(</span>e<span class="token punctuation">.</span>g<span class="token punctuation">.</span> <span class="token string">"-Dx=y"</span><span class="token punctuation">)</span>
# <span class="token operator">-</span> SPARK_DAEMON_JAVA_OPTS<span class="token punctuation">,</span> to set config properties <span class="token keyword">for</span> all daemons <span class="token punctuation">(</span>e<span class="token punctuation">.</span>g<span class="token punctuation">.</span> <span class="token string">"-Dx=y"</span><span class="token punctuation">)</span>
# <span class="token operator">-</span> SPARK_DAEMON_CLASSPATH<span class="token punctuation">,</span> to set the classpath <span class="token keyword">for</span> all daemons
# <span class="token operator">-</span> SPARK_PUBLIC_DNS<span class="token punctuation">,</span> to set the public dns name of the master or workers

<span class="token macro property"># Generic options for the daemons used in the standalone deploy mode</span>
# <span class="token operator">-</span> SPARK_CONF_DIR      Alternate conf dir<span class="token punctuation">.</span> <span class="token punctuation">(</span>Default<span class="token punctuation">:</span> $<span class="token punctuation">{<!-- --></span>SPARK_HOME<span class="token punctuation">}</span><span class="token operator">/</span>conf<span class="token punctuation">)</span>
# <span class="token operator">-</span> SPARK_LOG_DIR       Where log files are stored<span class="token punctuation">.</span>  <span class="token punctuation">(</span>Default<span class="token punctuation">:</span> $<span class="token punctuation">{<!-- --></span>SPARK_HOME<span class="token punctuation">}</span><span class="token operator">/</span>logs<span class="token punctuation">)</span>
# <span class="token operator">-</span> SPARK_PID_DIR       Where the pid file is stored<span class="token punctuation">.</span> <span class="token punctuation">(</span>Default<span class="token punctuation">:</span> <span class="token operator">/</span>tmp<span class="token punctuation">)</span>
# <span class="token operator">-</span> SPARK_IDENT_STRING  A string representing this instance of spark<span class="token punctuation">.</span> <span class="token punctuation">(</span>Default<span class="token punctuation">:</span> $USER<span class="token punctuation">)</span>
# <span class="token operator">-</span> SPARK_NICENESS      The scheduling priority <span class="token keyword">for</span> daemons<span class="token punctuation">.</span> <span class="token punctuation">(</span>Default<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">)</span>
# <span class="token operator">-</span> SPARK_NO_DAEMONIZE  Run the proposed command in the foreground<span class="token punctuation">.</span> It will not output a PID file<span class="token punctuation">.</span>
<span class="token macro property"># Options for native BLAS, like Intel MKL, OpenBLAS, and so on.</span>
<span class="token macro property"># You might get better performance to enable these options if using native BLAS (see SPARK-21305).</span>
# <span class="token operator">-</span> MKL_NUM_THREADS<span class="token operator">=</span><span class="token number">1</span>        Disable multi<span class="token operator">-</span>threading of Intel MKL
# <span class="token operator">-</span> OPENBLAS_NUM_THREADS<span class="token operator">=</span><span class="token number">1</span>   Disable multi<span class="token operator">-</span>threading of OpenBLAS
</code></pre> 
<p>-Dspark.deploy.recoveryMode #说明整个集群状态是通过zookeeper来维护的，整个集群状态的恢复也是通过zookeeper来维护的。<br> -Dspark.deploy.zookeeper.url 有可能做master(Active)的机器都配置进来<br> -Dspark.deploy.zookeeper.dir 保存spark的元数据，保存了spark的作业运行状态</p> 
<p>10.1.2、编辑配置文件 Slaves<br>   创建 /home/work/_app/spark-2.4.0-bin-hadoop2.7/conf/slaves 文件编辑并保存，内容如下：</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># cat <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_app<span class="token operator">/</span>spark<span class="token operator">-</span><span class="token number">2.4</span><span class="token number">.0</span><span class="token operator">-</span>bin<span class="token operator">-</span>hadoop2<span class="token punctuation">.</span><span class="token number">7</span><span class="token operator">/</span>conf<span class="token operator">/</span>slaves
c2
c3
</code></pre> 
<p>10.1.3、编辑配置文件 spark-defaults.conf<br>   创建 /home/work/_app/spark-2.4.0-bin-hadoop2.7/conf/spark-defaults.conf 文件编辑并保存，内容如下：</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># cat <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_app<span class="token operator">/</span>spark<span class="token operator">-</span><span class="token number">2.4</span><span class="token number">.0</span><span class="token operator">-</span>bin<span class="token operator">-</span>hadoop2<span class="token punctuation">.</span><span class="token number">7</span><span class="token operator">/</span>conf<span class="token operator">/</span>spark<span class="token operator">-</span>defaults<span class="token punctuation">.</span>conf
# 如果没有适合当前本地性要求的任务可供运行，将跑得慢的任务在空闲计算资源上再度调度的行为<span class="token punctuation">,</span>这个参数会引发一些tmp文件被删除的问题，一般设置为false
spark<span class="token punctuation">.</span>speculation        false

# 如果设置为true<span class="token punctuation">,</span>前台用jdbc方式连接，显示的会是乱码
spark<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>hive<span class="token punctuation">.</span>convertMetastoreParquet  false

# 应用程序上载到HDFS的复制份数
spark<span class="token punctuation">.</span>yarn<span class="token punctuation">.</span>submit<span class="token punctuation">.</span>file<span class="token punctuation">.</span>replication <span class="token number">3</span>

<span class="token macro property"># Spark application master给YARN ResourceManager 发送心跳的时间间隔（ms）</span>
spark<span class="token punctuation">.</span>yarn<span class="token punctuation">.</span>scheduler<span class="token punctuation">.</span>heartbeat<span class="token punctuation">.</span>interal<span class="token operator">-</span>ms  <span class="token number">5000</span>

# 仅适用于HashShuffleMananger的实现，同样是为了解决生成过多文件的问题，采用的方式是在不同批次运行的Map任务之间重用Shuffle输出文件，也就是说合并的是不同批次的Map任务的输出数据，但是每个Map任务所需要的文件还是取决于Reduce分区的数量，因此，它并不减少同时打开的输出文件的数量，因此对内存使用量的减少并没有帮助。只是HashShuffleManager里的一个折中的解决方案。
spark<span class="token punctuation">.</span>shuffle<span class="token punctuation">.</span>consolidateFiles  true

# 一个partition对应着一个task<span class="token punctuation">,</span>如果数据量过大，可以调整次参数来减少每个task所需消耗的内存<span class="token punctuation">.</span>
spark<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>shuffle<span class="token punctuation">.</span>partitions <span class="token number">100</span>

<span class="token macro property"># Spark SQL在每次执行次，先把SQL查询编译JAVA字节码。针对执行时间长的SQL查询或频繁执行的SQL查询，此配置能加快查询速度，因为它产生特殊的字节码去执行。但是针对很短的查询，可能会增加开销，因为它必须先编译每一个查询</span>
spark<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>codegen true

# 我们都知道shuffle默认情况下的文件数据为map tasks <span class="token operator">*</span> reduce tasks<span class="token punctuation">,</span>通过设置其为true<span class="token punctuation">,</span>可以使spark合并shuffle的中间文件为reduce的tasks数目。
spark<span class="token punctuation">.</span>shuffle<span class="token punctuation">.</span>consolidateFiles true

# 是否记录Spark事件，对于在应用程序完成后重建Web UI非常有用。
spark<span class="token punctuation">.</span>eventLog<span class="token punctuation">.</span>enabled true

# 是否压缩已记录的事件，如果spark<span class="token punctuation">.</span>eventLog<span class="token punctuation">.</span>enabled为true。压缩将使用spark<span class="token punctuation">.</span>io<span class="token punctuation">.</span>compression<span class="token punctuation">.</span>codec。
spark<span class="token punctuation">.</span>eventLog<span class="token punctuation">.</span>compress true

# 如果spark<span class="token punctuation">.</span>eventLog<span class="token punctuation">.</span>enabled为true，则记录Spark事件的基目录。在此基本目录中，Spark为每个应用程序创建一个子目录，并将特定于该应用程序的事件记录在此目录中。用户可能希望将其设置为统一位置（如HDFS目录），以便历史记录服务器可以读取历史记录文件。
spark<span class="token punctuation">.</span>eventLog<span class="token punctuation">.</span>dir hdfs<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>mshkcluster<span class="token punctuation">:</span><span class="token number">8020</span><span class="token operator">/</span>tmp<span class="token operator">/</span>logs<span class="token operator">/</span>spark_logs
</code></pre> 
<p>10.2、启动spark集群<br> 10.2.1、将 Spark 和 Scala 复制到其他机器</p> 
<pre><code class="prism language-c"># 复制 Spark
<span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># <span class="token keyword">for</span> N in $<span class="token punctuation">(</span>seq <span class="token number">1</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">do</span> scp <span class="token operator">-</span>r <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_app<span class="token operator">/</span>spark<span class="token operator">-</span><span class="token number">2.4</span><span class="token number">.0</span><span class="token operator">-</span>bin<span class="token operator">-</span>hadoop2<span class="token punctuation">.</span><span class="token number">7</span> c$N<span class="token punctuation">:</span><span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_app<span class="token operator">/</span><span class="token punctuation">;</span> done<span class="token punctuation">;</span>

# 复制 Scala
<span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># <span class="token keyword">for</span> N in $<span class="token punctuation">(</span>seq <span class="token number">1</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">do</span> scp <span class="token operator">-</span>r <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_app<span class="token operator">/</span>scala<span class="token operator">-</span><span class="token number">2.12</span><span class="token number">.8</span> c$N<span class="token punctuation">:</span><span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_app<span class="token operator">/</span><span class="token punctuation">;</span> done<span class="token punctuation">;</span>
</code></pre> 
<p>10.2.2、启动 Spark<br>   在 c0 输入 $SPARK_HOME/sbin/start-all.sh 来启动 Spark Master，同时会自动启动在 c2、c3 的 Spark Worker<br>   然后 c1 输入 $SPARK_HOME/sbin/start-master.sh 来单独启动 Spark Master</p> 
<pre><code class="prism language-c"><span class="token macro property"># c0</span>
<span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># $SPARK_HOME<span class="token operator">/</span>sbin<span class="token operator">/</span>start<span class="token operator">-</span>all<span class="token punctuation">.</span>sh
starting org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>deploy<span class="token punctuation">.</span>master<span class="token punctuation">.</span>Master<span class="token punctuation">,</span> logging to <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_logs<span class="token operator">/</span>spark<span class="token operator">-</span><span class="token number">2.4</span><span class="token number">.0</span><span class="token operator">-</span>bin<span class="token operator">-</span>hadoop2<span class="token punctuation">.</span><span class="token number">7</span><span class="token operator">/</span>spark<span class="token operator">-</span>root<span class="token operator">-</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>deploy<span class="token punctuation">.</span>master<span class="token punctuation">.</span>Master<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>c0<span class="token punctuation">.</span>out
c3<span class="token punctuation">:</span> starting org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>deploy<span class="token punctuation">.</span>worker<span class="token punctuation">.</span>Worker<span class="token punctuation">,</span> logging to <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_logs<span class="token operator">/</span>spark<span class="token operator">-</span><span class="token number">2.4</span><span class="token number">.0</span><span class="token operator">-</span>bin<span class="token operator">-</span>hadoop2<span class="token punctuation">.</span><span class="token number">7</span><span class="token operator">/</span>spark<span class="token operator">-</span>root<span class="token operator">-</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>deploy<span class="token punctuation">.</span>worker<span class="token punctuation">.</span>Worker<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>c3<span class="token punctuation">.</span>out
c2<span class="token punctuation">:</span> starting org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>deploy<span class="token punctuation">.</span>worker<span class="token punctuation">.</span>Worker<span class="token punctuation">,</span> logging to <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_logs<span class="token operator">/</span>spark<span class="token operator">-</span><span class="token number">2.4</span><span class="token number">.0</span><span class="token operator">-</span>bin<span class="token operator">-</span>hadoop2<span class="token punctuation">.</span><span class="token number">7</span><span class="token operator">/</span>spark<span class="token operator">-</span>root<span class="token operator">-</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>deploy<span class="token punctuation">.</span>worker<span class="token punctuation">.</span>Worker<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>c2<span class="token punctuation">.</span>out
<span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># jps
<span class="token number">7296</span> DFSZKFailoverController
<span class="token number">7106</span> JournalNode
<span class="token number">12467</span> ResourceManager
<span class="token number">6820</span> NameNode
<span class="token number">6615</span> QuorumPeerMain
<span class="token number">13000</span> Jps
<span class="token number">12906</span> Master

<span class="token macro property"># c1</span>
<span class="token punctuation">[</span>root@c1 <span class="token operator">~</span><span class="token punctuation">]</span># $SPARK_HOME<span class="token operator">/</span>sbin<span class="token operator">/</span>start<span class="token operator">-</span>master<span class="token punctuation">.</span>sh
starting org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>deploy<span class="token punctuation">.</span>master<span class="token punctuation">.</span>Master<span class="token punctuation">,</span> logging to <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_logs<span class="token operator">/</span>spark<span class="token operator">-</span><span class="token number">2.4</span><span class="token number">.0</span><span class="token operator">-</span>bin<span class="token operator">-</span>hadoop2<span class="token punctuation">.</span><span class="token number">7</span><span class="token operator">/</span>spark<span class="token operator">-</span>root<span class="token operator">-</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>deploy<span class="token punctuation">.</span>master<span class="token punctuation">.</span>Master<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>c1<span class="token punctuation">.</span>out
<span class="token punctuation">[</span>root@c1 <span class="token operator">~</span><span class="token punctuation">]</span># jps
<span class="token number">5568</span> DFSZKFailoverController
<span class="token number">7667</span> ResourceManager
<span class="token number">5397</span> NameNode
<span class="token number">8165</span> Jps
<span class="token number">8102</span> Master
<span class="token number">5480</span> JournalNode
<span class="token number">5306</span> QuorumPeerMain

<span class="token macro property"># c2</span>
<span class="token punctuation">[</span>root@c2 <span class="token operator">~</span><span class="token punctuation">]</span># jps
<span class="token number">6342</span> Worker
<span class="token number">6090</span> NodeManager
<span class="token number">4748</span> QuorumPeerMain
<span class="token number">4847</span> DataNode
<span class="token number">6399</span> Jps

<span class="token macro property"># c3</span>
<span class="token punctuation">[</span>root@c3 <span class="token operator">~</span><span class="token punctuation">]</span># jps
<span class="token number">13937</span> QuorumPeerMain
<span class="token number">15555</span> Jps
<span class="token number">15253</span> NodeManager
<span class="token number">15498</span> Worker
<span class="token number">14013</span> DataNode
</code></pre> 
<p>关闭所有节点的 Spark 命令为：$SPARK_HOME/sbin/stop-all.sh</p> 
<p>查看Web界面 端口是 http://c0:8080 能够看到，只有 c0 的 Status: ALIVE，而其他机器则是 Status: STANDBY<br>  <br>  10.2.3、测试 Spark 集群<br>   在 Spark Shell 中用 Scala 语言编写 Spark 程序</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># spark<span class="token operator">-</span>shell
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">07</span> <span class="token number">16</span><span class="token punctuation">:</span><span class="token number">28</span><span class="token punctuation">:</span><span class="token number">34</span> WARN  NativeCodeLoader<span class="token punctuation">:</span><span class="token number">62</span> <span class="token operator">-</span> Unable to load native<span class="token operator">-</span>hadoop library <span class="token keyword">for</span> your platform<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> using builtin<span class="token operator">-</span>java classes where applicable
Setting <span class="token keyword">default</span> log level to <span class="token string">"WARN"</span><span class="token punctuation">.</span>
To adjust logging level use sc<span class="token punctuation">.</span><span class="token function">setLogLevel</span><span class="token punctuation">(</span>newLevel<span class="token punctuation">)</span><span class="token punctuation">.</span> For SparkR<span class="token punctuation">,</span> use <span class="token function">setLogLevel</span><span class="token punctuation">(</span>newLevel<span class="token punctuation">)</span><span class="token punctuation">.</span>
Spark context Web UI available at http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>c0<span class="token punctuation">:</span><span class="token number">4040</span>
Spark context available as <span class="token string">'sc'</span> <span class="token punctuation">(</span>master <span class="token operator">=</span> local<span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span><span class="token punctuation">,</span> app id <span class="token operator">=</span> local<span class="token operator">-</span><span class="token number">1551947322590</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
Spark session available as <span class="token string">'spark'</span><span class="token punctuation">.</span>
Welcome to
      ____              __
     <span class="token operator">/</span> __<span class="token operator">/</span>__  ___ _____<span class="token operator">/</span> <span class="token operator">/</span>__
    _\ \<span class="token operator">/</span> _ \<span class="token operator">/</span> _ `<span class="token operator">/</span> __<span class="token operator">/</span>  '_<span class="token operator">/</span>
   <span class="token operator">/</span>___<span class="token operator">/</span> <span class="token punctuation">.</span>__<span class="token operator">/</span>\_<span class="token punctuation">,</span>_<span class="token operator">/</span>_<span class="token operator">/</span> <span class="token operator">/</span>_<span class="token operator">/</span>\_\   version <span class="token number">2.4</span><span class="token number">.0</span>
      <span class="token operator">/</span>_<span class="token operator">/</span>

Using Scala version <span class="token number">2.11</span><span class="token number">.12</span> <span class="token punctuation">(</span>Java <span class="token function">HotSpot</span><span class="token punctuation">(</span>TM<span class="token punctuation">)</span> <span class="token number">64</span><span class="token operator">-</span>Bit Server VM<span class="token punctuation">,</span> Java <span class="token number">1.8</span><span class="token number">.0</span>_201<span class="token punctuation">)</span>
Type in expressions to have them evaluated<span class="token punctuation">.</span>
Type <span class="token punctuation">:</span>help <span class="token keyword">for</span> more information<span class="token punctuation">.</span>

scala<span class="token operator">&gt;</span> sc<span class="token punctuation">.</span><span class="token function">textFile</span><span class="token punctuation">(</span><span class="token string">"/mshk.top/test.mshk.top.txt"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span>_<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>_<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduceByKey</span><span class="token punctuation">(</span>_<span class="token operator">+</span>_<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">saveAsTextFile</span><span class="token punctuation">(</span><span class="token string">"/spark/out"</span><span class="token punctuation">)</span>
</code></pre> 
<p>sc是 SparkContext 对象，该对象是提交 Spark 程序的入口<br> textFile(“/spark/hello.txt”)是在 HDFS 中读取数据<br> .split(” “)).map((,1) 是用空格做间隔符，将结果 和数字1，应用到集合中的每个元素，并产生一个结果集合<br> flatMap(.split(” “))把生成的多个集合“拍扁”成为一个集合<br> reduceByKey(+_) 合并具有相同键的值，按照key进行reduce，并将value累加<br> saveAsTextFile(“/spark/out”) 将结果写入到 HDFS 中</p> 
<p>在 HDFS 中查看结果</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># hadoop fs <span class="token operator">-</span>cat <span class="token operator">/</span>spark<span class="token operator">/</span>out<span class="token operator">/</span>p<span class="token operator">*</span>
<span class="token punctuation">(</span>mshk<span class="token punctuation">.</span>top<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span>hello<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span>welcome<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span>world<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span>hadoop<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
</code></pre> 
<p>10.2.4、运行 Spark on YARN<br>   Spark on YARN的原理就是依靠 yarn 来调度 Spark，比默认的 Spark 运行模式性能要好的多</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># spark<span class="token operator">-</span>shell <span class="token operator">--</span>master yarn <span class="token operator">--</span>deploy<span class="token operator">-</span>mode client
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">07</span> <span class="token number">16</span><span class="token punctuation">:</span><span class="token number">38</span><span class="token punctuation">:</span><span class="token number">08</span> WARN  NativeCodeLoader<span class="token punctuation">:</span><span class="token number">62</span> <span class="token operator">-</span> Unable to load native<span class="token operator">-</span>hadoop library <span class="token keyword">for</span> your platform<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> using builtin<span class="token operator">-</span>java classes where applicable
Setting <span class="token keyword">default</span> log level to <span class="token string">"WARN"</span><span class="token punctuation">.</span>
To adjust logging level use sc<span class="token punctuation">.</span><span class="token function">setLogLevel</span><span class="token punctuation">(</span>newLevel<span class="token punctuation">)</span><span class="token punctuation">.</span> For SparkR<span class="token punctuation">,</span> use <span class="token function">setLogLevel</span><span class="token punctuation">(</span>newLevel<span class="token punctuation">)</span><span class="token punctuation">.</span>
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">07</span> <span class="token number">16</span><span class="token punctuation">:</span><span class="token number">38</span><span class="token punctuation">:</span><span class="token number">16</span> WARN  Client<span class="token punctuation">:</span><span class="token number">66</span> <span class="token operator">-</span> Neither spark<span class="token punctuation">.</span>yarn<span class="token punctuation">.</span>jars nor spark<span class="token punctuation">.</span>yarn<span class="token punctuation">.</span>archive is set<span class="token punctuation">,</span> falling back to uploading libraries under SPARK_HOME<span class="token punctuation">.</span>
Spark context Web UI available at http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>c0<span class="token punctuation">:</span><span class="token number">4040</span>
Spark context available as <span class="token string">'sc'</span> <span class="token punctuation">(</span>master <span class="token operator">=</span> yarn<span class="token punctuation">,</span> app id <span class="token operator">=</span> application_1551946215357_0002<span class="token punctuation">)</span><span class="token punctuation">.</span>
Spark session available as <span class="token string">'spark'</span><span class="token punctuation">.</span>
Welcome to
      ____              __
     <span class="token operator">/</span> __<span class="token operator">/</span>__  ___ _____<span class="token operator">/</span> <span class="token operator">/</span>__
    _\ \<span class="token operator">/</span> _ \<span class="token operator">/</span> _ `<span class="token operator">/</span> __<span class="token operator">/</span>  '_<span class="token operator">/</span>
   <span class="token operator">/</span>___<span class="token operator">/</span> <span class="token punctuation">.</span>__<span class="token operator">/</span>\_<span class="token punctuation">,</span>_<span class="token operator">/</span>_<span class="token operator">/</span> <span class="token operator">/</span>_<span class="token operator">/</span>\_\   version <span class="token number">2.4</span><span class="token number">.0</span>
      <span class="token operator">/</span>_<span class="token operator">/</span>

Using Scala version <span class="token number">2.11</span><span class="token number">.12</span> <span class="token punctuation">(</span>Java <span class="token function">HotSpot</span><span class="token punctuation">(</span>TM<span class="token punctuation">)</span> <span class="token number">64</span><span class="token operator">-</span>Bit Server VM<span class="token punctuation">,</span> Java <span class="token number">1.8</span><span class="token number">.0</span>_201<span class="token punctuation">)</span>
Type in expressions to have them evaluated<span class="token punctuation">.</span>
Type <span class="token punctuation">:</span>help <span class="token keyword">for</span> more information<span class="token punctuation">.</span>

scala<span class="token operator">&gt;</span> var array<span class="token operator">=</span><span class="token function">Array</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">)</span>
array<span class="token punctuation">:</span> Array<span class="token punctuation">[</span>Int<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">Array</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span>

scala<span class="token operator">&gt;</span> var i<span class="token operator">=</span>sc<span class="token punctuation">.</span><span class="token function">makeRDD</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span>
i<span class="token punctuation">:</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>rdd<span class="token punctuation">.</span>RDD<span class="token punctuation">[</span>Int<span class="token punctuation">]</span> <span class="token operator">=</span> ParallelCollectionRDD<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> at makeRDD at <span class="token operator">&lt;</span>console<span class="token operator">&gt;</span><span class="token punctuation">:</span><span class="token number">26</span>

scala<span class="token operator">&gt;</span> i<span class="token punctuation">.</span>count
res0<span class="token punctuation">:</span> Long <span class="token operator">=</span> <span class="token number">9</span>

scala<span class="token operator">&gt;</span>
</code></pre> 
<p>打开 YARN WEB 页面：http://c0:8088 点击左侧的 RUNNING 可以看到 Spark Shell 应用程序正在运行，然后点击右侧 ID，再点击 ApplicationMaster ，能够看到我们刚才运行的<br> <img src="https://images2.imgbox.com/6f/b7/ZfOhjnrz_o.png" alt="在这里插入图片描述"><br> 11、常见问题<br> 11.1、Hbase<br> 11.1.1、You have version null and I want version 8. Is your hbase.rootdir valid? If so, you may need to run ‘hbase hbck -fixVersionFile’<br>   重建一下 HBase 文件，执行以下命令，先删除，然后再启动 Hbase 即可解决</p> 
<pre><code class="prism language-c">hadoop fs <span class="token operator">-</span>rm <span class="token operator">-</span>r <span class="token operator">/</span>hbase
</code></pre> 
<p>11.1.2、如何为 Yarn 的 Web 界面增加权限访问限制？<br>   在本文中 Hadoop 的 /home/work/_app/hadoop-3.1.2/etc/hadoop/core-site.xml 文件最后面增加内容，完整的文件内容如下：</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># cat <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_app<span class="token operator">/</span>hadoop<span class="token operator">-</span><span class="token number">3.1</span><span class="token number">.2</span><span class="token operator">/</span>etc<span class="token operator">/</span>hadoop<span class="token operator">/</span>core<span class="token operator">-</span>site<span class="token punctuation">.</span>xml
<span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">"1.0"</span> encoding<span class="token operator">=</span><span class="token string">"UTF-8"</span><span class="token operator">?</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">?</span>xml<span class="token operator">-</span>stylesheet type<span class="token operator">=</span><span class="token string">"text/xsl"</span> href<span class="token operator">=</span><span class="token string">"configuration.xsl"</span><span class="token operator">?</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>
  Licensed under the Apache License<span class="token punctuation">,</span> Version <span class="token number">2.0</span> <span class="token punctuation">(</span>the <span class="token string">"License"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  you may not use this file except in compliance with the License<span class="token punctuation">.</span>
  You may obtain a copy of the License at

    http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>org<span class="token operator">/</span>licenses<span class="token operator">/</span>LICENSE<span class="token operator">-</span><span class="token number">2.0</span>

  Unless required by applicable law or agreed to in writing<span class="token punctuation">,</span> software
  distributed under the License is distributed on an <span class="token string">"AS IS"</span> BASIS<span class="token punctuation">,</span>
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND<span class="token punctuation">,</span> either express or implied<span class="token punctuation">.</span>
  See the License <span class="token keyword">for</span> the specific language governing permissions and
  limitations under the License<span class="token punctuation">.</span> See accompanying LICENSE file<span class="token punctuation">.</span>
<span class="token operator">--</span><span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> Put site<span class="token operator">-</span>specific property overrides in this file<span class="token punctuation">.</span> <span class="token operator">--</span><span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>configuration<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>fs<span class="token punctuation">.</span>defaultFS<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>hdfs<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>mshkcluster<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>默认文件系统的名称。一个URI，其方案和权限决定了FileSystem的实现。<span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>ha<span class="token punctuation">.</span>zookeeper<span class="token punctuation">.</span>quorum<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>c0<span class="token punctuation">:</span><span class="token number">2181</span><span class="token punctuation">,</span>c1<span class="token punctuation">:</span><span class="token number">2181</span><span class="token punctuation">,</span>c2<span class="token punctuation">:</span><span class="token number">2181</span><span class="token punctuation">,</span>c3<span class="token punctuation">:</span><span class="token number">2181</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>由逗号分隔的ZooKeeper服务器地址列表，由ZKFailoverController在自动故障转移中使用。<span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>hadoop<span class="token punctuation">.</span>tmp<span class="token punctuation">.</span>dir<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_data<span class="token operator">/</span>hadoop<span class="token operator">-</span><span class="token number">3.1</span><span class="token number">.2</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>数据目录目录<span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>dfs<span class="token punctuation">.</span>ha<span class="token punctuation">.</span>fencing<span class="token punctuation">.</span>methods<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>sshfence<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>用于服务防护的防护方法列表。可能包含内置方法（例如shell和sshfence）或用户定义的方法。<span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>dfs<span class="token punctuation">.</span>ha<span class="token punctuation">.</span>fencing<span class="token punctuation">.</span>ssh<span class="token punctuation">.</span>private<span class="token operator">-</span>key<span class="token operator">-</span>files<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token operator">/</span>root<span class="token operator">/</span><span class="token punctuation">.</span>ssh<span class="token operator">/</span>id_rsa<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>用于内置sshfence fencer的SSH私钥文件。<span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>io<span class="token punctuation">.</span>file<span class="token punctuation">.</span>buffer<span class="token punctuation">.</span>size<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token number">131072</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>SequenceFiles中使用的读<span class="token operator">/</span>写缓冲区的大小。<span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>ipc<span class="token punctuation">.</span>client<span class="token punctuation">.</span>connect<span class="token punctuation">.</span>max<span class="token punctuation">.</span>retries<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token number">100</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>客户端为建立服务器连接而重试的次数。<span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>ipc<span class="token punctuation">.</span>client<span class="token punctuation">.</span>connect<span class="token punctuation">.</span>retry<span class="token punctuation">.</span>interval<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token number">10000</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>客户端在重试建立服务器连接之前将等待的毫秒数。<span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>hadoop<span class="token punctuation">.</span>http<span class="token punctuation">.</span>filter<span class="token punctuation">.</span>initializers<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>http<span class="token punctuation">.</span>lib<span class="token punctuation">.</span>StaticUserWebFilter<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>逗号分隔的类名列表。列表中的每个类都必须扩展org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>http<span class="token punctuation">.</span>FilterInitializer。将初始化相应的过滤器。然后，Filter将应用于所有面向用户的jsp和servlet Web页面。<span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>hadoop<span class="token punctuation">.</span>http<span class="token punctuation">.</span>authentication<span class="token punctuation">.</span>type<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>simple<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>定义用于Oozie HTTP端点的身份验证。支持的值是：simple <span class="token operator">|</span>kerberos <span class="token operator">|</span>＃AUTHENTICATION_HANDLER_CLASSNAME＃<span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>hadoop<span class="token punctuation">.</span>http<span class="token punctuation">.</span>authentication<span class="token punctuation">.</span>token<span class="token punctuation">.</span>validity<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token number">12000</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>指示身份验证令牌在必须续订之前的有效时间（以秒为单位）。<span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>hadoop<span class="token punctuation">.</span>http<span class="token punctuation">.</span>authentication<span class="token punctuation">.</span>token<span class="token punctuation">.</span>validity<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token number">12000</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>指示身份验证令牌在必须续订之前的有效时间（以秒为单位）。<span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>hadoop<span class="token punctuation">.</span>http<span class="token punctuation">.</span>authentication<span class="token punctuation">.</span>simple<span class="token punctuation">.</span>anonymous<span class="token punctuation">.</span>allowed<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>false<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>指示使用“简单”身份验证时是否允许匿名请求。<span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>hadoop<span class="token punctuation">.</span>http<span class="token punctuation">.</span>authentication<span class="token punctuation">.</span>signature<span class="token punctuation">.</span>secret<span class="token punctuation">.</span>file<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_app<span class="token operator">/</span>hadoop<span class="token operator">-</span><span class="token number">3.1</span><span class="token number">.2</span><span class="token operator">/</span>etc<span class="token operator">/</span>hadoop<span class="token operator">/</span>hadoop<span class="token operator">-</span>http<span class="token operator">-</span>auth<span class="token operator">-</span>signature<span class="token operator">-</span>secret<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>用于签署身份验证令牌的路径。<span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>hadoop<span class="token punctuation">.</span>http<span class="token punctuation">.</span>staticuser<span class="token punctuation">.</span>user<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>dr<span class="token punctuation">.</span>who<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>要在呈现内容时在静态Web过滤器上过滤的用户名。示例用途是HDFS Web UI（用于浏览文件的用户）。<span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>hadoop<span class="token punctuation">.</span>http<span class="token punctuation">.</span>authentication<span class="token punctuation">.</span>cookie<span class="token punctuation">.</span>domain<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>用于存储身份验证令牌的HTTP cookie的域。为了使身份验证在所有Hadoop节点Web控制台上正常工作，必须正确设置域。重要提示：使用IP地址时，浏览器会忽略具有域设置的cookie。
要使此设置正常工作，必须将群集中的所有节点配置为生成具有hostname<span class="token punctuation">.</span>domain名称的URL。<span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>configuration<span class="token operator">&gt;</span>
</code></pre> 
<p>其中 hadoop.http.authentication.signature.secret.file 配置项，是要登录的用户名，向文件中添加用户名hadoop:</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># echo <span class="token string">"hadoop"</span> <span class="token operator">&gt;</span> <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_app<span class="token operator">/</span>hadoop<span class="token operator">-</span><span class="token number">3.1</span><span class="token number">.2</span><span class="token operator">/</span>etc<span class="token operator">/</span>hadoop<span class="token operator">/</span>hadoop<span class="token operator">-</span>http<span class="token operator">-</span>auth<span class="token operator">-</span>signature<span class="token operator">-</span>secret
<span class="token punctuation">[</span>root@c0 <span class="token operator">~</span><span class="token punctuation">]</span># cat <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>_app<span class="token operator">/</span>hadoop<span class="token operator">-</span><span class="token number">3.1</span><span class="token number">.2</span><span class="token operator">/</span>etc<span class="token operator">/</span>hadoop<span class="token operator">/</span>hadoop<span class="token operator">-</span>http<span class="token operator">-</span>auth<span class="token operator">-</span>signature<span class="token operator">-</span>secret
hadoop
</code></pre> 
<p>将配置项，重新复制到全部机器上面，然后重启 Yarn，运行后，在浏览器 http://c0:8080 后面加上 user.name=hadoop ,合并后的网址为：http://c0:8088/cluster?user.name=hadoop<br> 12. 参考资料<br>   how-to-set-up-hadoop-cluster-with-hdfs-high-availability<br>   HDFS High Availability Using the Quorum Journal Manager<br>   HDFS High Availability</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/26f9fd04c0e8d6c299cbed3c0f0f3b10/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">在华为跟苹果的重压下，谷歌的5G手机会有新出路？</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/48b5cca0ee97aafb5313209b09c00fdf/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">通过 Sqoop1.4.7 将 Mysql5.7、Hive2.3.4、Hbase1.4.9 之间的数据导入导出</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>