<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>看书笔记【R语言数据分析项目精解：理论、方法、实战 8】 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="看书笔记【R语言数据分析项目精解：理论、方法、实战 8】" />
<meta property="og:description" content="看书笔记——R语言 Chapter 8 从数据中寻找优质用户8.1项目背景、目标和方案8.1.1项目背景8.1.2项目目标8.1.3项目方案 8.2项目技术理论简介8.2.1逻辑回归的基本概念8.2.2建模流程1.模型开发2.模型验证阶段3.模型测试阶段4.模型实施阶段 8.2.3模型开发阶段1.数据采样2.数据探索3.数据填缺4.离散型变量压缩5.连续型变量压缩6.变量筛选（用到的时候再细看一下，主要是权重那一套）7.变量调整——logit图8.线性假设9.模型开发 8.2.4模型验证阶段8.2.5模型测试阶段8.2.6商业应用流程8.2.7R语言实例代码 8.3项目实践8.3.1数据探索8.3.3建立模型8.3.4模型验证 【R语言数据分析项目精解：理论、方法、实战 8】 Chapter 8 从数据中寻找优质用户 8.1项目背景、目标和方案 8.1.1项目背景 由于活动规模有限，对邀请用户的数量有一定的限制，市场部希望邀请到一些高质量的有潜在购买力的用户，希望在用户画像系统中加入一个能够反映用户是否具有潜在购买力的标签。
8.1.2项目目标 在用户画像的标签制作上加一个标签衡量“潜在购买力”，该标签的目标是一个离散型且分值在10以内的等距量化指标，利用统计模型将用户信息映射到一个离散化的数值范围。
8.1.3项目方案 用近6个月的用户的基本信息和历史行为记录作为训练集建立逻辑回归模型对进行拟合建模，对近一个月内下单的用户购买可能性打标签，市场人员可以就这个指标值挑选。
8.2项目技术理论简介 主要是关于逻辑回归模型的知识。
8.2.1逻辑回归的基本概念 1.引理
对于分类变量，逻辑回归曲线到线性曲线的距离会小于每个点到线性回归的距离。
2.逻辑回归模型
l o g i t ( p ) = l n ( p 1 − p ) = β 0 &#43; β 1 x 1 &#43; . . . &#43; β n x n , x 1 , . . . , x n logit(p)=ln(\frac{p}{1-p})=\beta_0&#43;\beta_1x_1&#43;." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/7100608f44faf9c1cb70fbcc953ec009/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-21T21:06:38+08:00" />
<meta property="article:modified_time" content="2024-01-21T21:06:38+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">看书笔记【R语言数据分析项目精解：理论、方法、实战 8】</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>看书笔记——R语言</h4> 
 <ul><li><a href="#Chapter__8__2" rel="nofollow">Chapter 8 从数据中寻找优质用户</a></li><li><ul><li><ul><li><a href="#81_3" rel="nofollow">8.1项目背景、目标和方案</a></li><li><ul><li><a href="#811_4" rel="nofollow">8.1.1项目背景</a></li><li><a href="#812_6" rel="nofollow">8.1.2项目目标</a></li><li><a href="#813_8" rel="nofollow">8.1.3项目方案</a></li></ul> 
    </li><li><a href="#82_10" rel="nofollow">8.2项目技术理论简介</a></li><li><ul><li><a href="#821_12" rel="nofollow">8.2.1逻辑回归的基本概念</a></li><li><a href="#822_41" rel="nofollow">8.2.2建模流程</a></li><li><ul><li><a href="#1_42" rel="nofollow">1.模型开发</a></li><li><a href="#2_50" rel="nofollow">2.模型验证阶段</a></li><li><a href="#3_57" rel="nofollow">3.模型测试阶段</a></li><li><a href="#4_60" rel="nofollow">4.模型实施阶段</a></li></ul> 
     </li><li><a href="#823_62" rel="nofollow">8.2.3模型开发阶段</a></li><li><ul><li><a href="#1_63" rel="nofollow">1.数据采样</a></li><li><a href="#2_68" rel="nofollow">2.数据探索</a></li><li><a href="#3_71" rel="nofollow">3.数据填缺</a></li><li><a href="#4_77" rel="nofollow">4.离散型变量压缩</a></li><li><a href="#5_79" rel="nofollow">5.连续型变量压缩</a></li><li><a href="#6_81" rel="nofollow">6.变量筛选（用到的时候再细看一下，主要是权重那一套）</a></li><li><a href="#7logit_86" rel="nofollow">7.变量调整——logit图</a></li><li><a href="#8_88" rel="nofollow">8.线性假设</a></li><li><a href="#9_90" rel="nofollow">9.模型开发</a></li></ul> 
     </li><li><a href="#824_92" rel="nofollow">8.2.4模型验证阶段</a></li><li><a href="#825_95" rel="nofollow">8.2.5模型测试阶段</a></li><li><a href="#826_104" rel="nofollow">8.2.6商业应用流程</a></li><li><a href="#827R_106" rel="nofollow">8.2.7R语言实例代码</a></li></ul> 
    </li><li><a href="#83_259" rel="nofollow">8.3项目实践</a></li><li><ul><li><a href="#831_261" rel="nofollow">8.3.1数据探索</a></li><li><a href="#833_374" rel="nofollow">8.3.3建立模型</a></li><li><a href="#834_403" rel="nofollow">8.3.4模型验证</a></li></ul> 
   </li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<br> 【R语言数据分析项目精解：理论、方法、实战 8】 
<p></p> 
<h2><a id="Chapter__8__2"></a>Chapter 8 从数据中寻找优质用户</h2> 
<h4><a id="81_3"></a>8.1项目背景、目标和方案</h4> 
<h5><a id="811_4"></a>8.1.1项目背景</h5> 
<p>由于活动规模有限，对邀请用户的数量有一定的限制，市场部希望邀请到一些高质量的有潜在购买力的用户，希望在用户画像系统中加入一个能够反映用户是否具有潜在购买力的标签。</p> 
<h5><a id="812_6"></a>8.1.2项目目标</h5> 
<p>在用户画像的标签制作上加一个标签衡量“潜在购买力”，该标签的目标是一个离散型且分值在10以内的等距量化指标，利用统计模型将用户信息映射到一个离散化的数值范围。</p> 
<h5><a id="813_8"></a>8.1.3项目方案</h5> 
<p>用近6个月的用户的基本信息和历史行为记录作为训练集建立逻辑回归模型对进行拟合建模，对近一个月内下单的用户购买可能性打标签，市场人员可以就这个指标值挑选。</p> 
<h4><a id="82_10"></a>8.2项目技术理论简介</h4> 
<p>主要是关于逻辑回归模型的知识。</p> 
<h5><a id="821_12"></a>8.2.1逻辑回归的基本概念</h5> 
<p><strong>1.引理</strong><br> <img src="https://images2.imgbox.com/64/e6/5pcx9AVw_o.png" alt="是否响应的散点图"><br> 对于分类变量，逻辑回归曲线到线性曲线的距离会小于每个点到线性回归的距离。<br> <strong>2.逻辑回归模型</strong><br> <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         l 
        
       
         o 
        
       
         g 
        
       
         i 
        
       
         t 
        
       
         ( 
        
       
         p 
        
       
         ) 
        
       
         = 
        
       
         l 
        
       
         n 
        
       
         ( 
        
        
        
          p 
         
         
         
           1 
          
         
           − 
          
         
           p 
          
         
        
       
         ) 
        
       
         = 
        
        
        
          β 
         
        
          0 
         
        
       
         + 
        
        
        
          β 
         
        
          1 
         
        
        
        
          x 
         
        
          1 
         
        
       
         + 
        
       
         . 
        
       
         . 
        
       
         . 
        
       
         + 
        
        
        
          β 
         
        
          n 
         
        
        
        
          x 
         
        
          n 
         
        
       
         , 
        
        
        
          x 
         
        
          1 
         
        
       
         , 
        
       
         . 
        
       
         . 
        
       
         . 
        
       
         , 
        
        
        
          x 
         
        
          n 
         
        
       
      
        logit(p)=ln(\frac{p}{1-p})=\beta_0+\beta_1x_1+...+\beta_nx_n,x_1,...,x_n 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.0197em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right: 0.0359em;">g</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1.2311em; vertical-align: -0.4811em;"></span><span class="mord mathnormal" style="margin-right: 0.0197em;">l</span><span class="mord mathnormal">n</span><span class="mopen">(</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.7475em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mbin mtight">−</span><span class="mord mathnormal mtight">p</span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.4461em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.4811em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0528em;">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: -0.0528em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0528em;">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: -0.0528em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.6667em; vertical-align: -0.0833em;"></span><span class="mord">...</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0528em;">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.0528em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord">...</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>为n个变量<br> <strong>3.Odds（优势）</strong><br> <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         O 
        
       
         d 
        
       
         d 
        
       
         s 
        
       
         = 
        
        
        
          p 
         
         
         
           1 
          
         
           − 
          
         
           p 
          
         
        
       
      
        Odds=\frac{p}{1-p} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6944em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">O</span><span class="mord mathnormal">dd</span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1.2286em; vertical-align: -0.4811em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.7475em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mbin mtight">−</span><span class="mord mathnormal mtight">p</span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.4461em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.4811em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span>，表示的是事件发生的概率与事件不发生的概率之比。<br> <strong>4.logit变换</strong><br> <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         l 
        
       
         o 
        
       
         g 
        
       
         i 
        
       
         t 
        
       
         ( 
        
       
         p 
        
       
         ) 
        
       
         = 
        
       
         l 
        
       
         n 
        
       
         ( 
        
       
         o 
        
       
         d 
        
       
         d 
        
       
         s 
        
       
         ) 
        
       
         = 
        
       
         l 
        
       
         n 
        
       
         ( 
        
        
        
          p 
         
         
         
           1 
          
         
           − 
          
         
           p 
          
         
        
       
         ) 
        
       
      
        logit(p)=ln(odds)=ln(\frac{p}{1-p}) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.0197em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right: 0.0359em;">g</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.0197em;">l</span><span class="mord mathnormal">n</span><span class="mopen">(</span><span class="mord mathnormal">o</span><span class="mord mathnormal">dd</span><span class="mord mathnormal">s</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1.2311em; vertical-align: -0.4811em;"></span><span class="mord mathnormal" style="margin-right: 0.0197em;">l</span><span class="mord mathnormal">n</span><span class="mopen">(</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.7475em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mbin mtight">−</span><span class="mord mathnormal mtight">p</span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.4461em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.4811em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">)</span></span></span></span></span><br> 可知<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         l 
        
       
         n 
        
       
         ( 
        
        
        
          p 
         
         
         
           1 
          
         
           − 
          
         
           p 
          
         
        
       
         ) 
        
       
         = 
        
       
         η 
        
       
         , 
        
       
         p 
        
       
         = 
        
        
        
          1 
         
         
         
           1 
          
         
           + 
          
          
          
            e 
           
           
           
             − 
            
           
             η 
            
           
          
         
        
       
      
        ln(\frac{p}{1-p})=\eta,p=\frac{1}{1+e^{-\eta}} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.2311em; vertical-align: -0.4811em;"></span><span class="mord mathnormal" style="margin-right: 0.0197em;">l</span><span class="mord mathnormal">n</span><span class="mopen">(</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.7475em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mbin mtight">−</span><span class="mord mathnormal mtight">p</span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.4461em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.4811em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.1944em;"></span><span class="mord mathnormal" style="margin-right: 0.0359em;">η</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1.2484em; vertical-align: -0.4033em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.8451em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.7027em;"><span class="" style="top: -2.786em; margin-right: 0.0714em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mathnormal mtight" style="margin-right: 0.0359em;">η</span></span></span></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.394em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.4033em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span><br> 式中，<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         η 
        
       
         = 
        
        
        
          β 
         
        
          0 
         
        
       
         + 
        
        
        
          β 
         
        
          1 
         
        
        
        
          x 
         
        
          1 
         
        
       
         + 
        
       
         . 
        
       
         . 
        
       
         . 
        
       
         + 
        
        
        
          β 
         
        
          n 
         
        
        
        
          x 
         
        
          n 
         
        
       
      
        \eta=\beta_0+\beta_1x_1+...+\beta_nx_n 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.1944em;"></span><span class="mord mathnormal" style="margin-right: 0.0359em;">η</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0528em;">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: -0.0528em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0528em;">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: -0.0528em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.6667em; vertical-align: -0.0833em;"></span><span class="mord">...</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0528em;">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.0528em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span><br> 得<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         y 
        
       
         = 
        
       
         p 
        
       
         + 
        
       
         ε 
        
       
         , 
        
       
         ε 
        
       
         ∼ 
        
       
         B 
        
       
         ( 
        
       
         n 
        
       
         , 
        
       
         p 
        
       
         ) 
        
       
         , 
        
       
         V 
        
       
         a 
        
       
         r 
        
       
         ( 
        
       
         ε 
        
       
         ) 
        
       
         = 
        
       
         p 
        
       
         ( 
        
       
         1 
        
       
         − 
        
       
         p 
        
       
         ) 
        
       
      
        y=p+\varepsilon,\varepsilon \sim B(n,p),Var(\varepsilon)=p(1-p) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.1944em;"></span><span class="mord mathnormal" style="margin-right: 0.0359em;">y</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.7778em; vertical-align: -0.1944em;"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.1944em;"></span><span class="mord mathnormal">ε</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal">ε</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">∼</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.0502em;">B</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal">p</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal">Va</span><span class="mord mathnormal" style="margin-right: 0.0278em;">r</span><span class="mopen">(</span><span class="mord mathnormal">ε</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">p</span><span class="mclose">)</span></span></span></span></span><br> 所以<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         y 
        
       
         ∼ 
        
       
         B 
        
       
         ( 
        
       
         n 
        
       
         , 
        
       
         p 
        
       
         ) 
        
       
      
        y\sim B(n,p) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.1944em;"></span><span class="mord mathnormal" style="margin-right: 0.0359em;">y</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">∼</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.0502em;">B</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal">p</span><span class="mclose">)</span></span></span></span></span><br> <strong>5.极大似然估计</strong><br> 想得到闭合形式解，就必须使用极大似然估计，似然函数公式：<br> <img src="https://images2.imgbox.com/a2/ef/9hkDbdG7_o.png" alt="逻辑回归的似然函数"><br> <strong>6.离散变量处理</strong><br> 逻辑回归的自变量都要是连续型变量，“哑变量”可以将离散型变量转变为连续型变量，生成的哑变量个数为水平数-1（这样可以减少变量间的共线性）。<br> <strong>7.优势比 Odds Rations</strong><br> <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         O 
        
       
         R 
        
       
         = 
        
        
         
          
          
            P 
           
          
            1 
           
          
         
           / 
          
         
           ( 
          
         
           1 
          
         
           − 
          
          
          
            P 
           
          
            1 
           
          
         
           ) 
          
         
         
          
          
            P 
           
          
            2 
           
          
         
           / 
          
         
           ( 
          
         
           1 
          
         
           − 
          
          
          
            P 
           
          
            2 
           
          
         
           ) 
          
         
        
       
      
        OR=\frac{P_1/(1-P_1)}{P_2/(1-P_2)} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal" style="margin-right: 0.0077em;">OR</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1.53em; vertical-align: -0.52em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.01em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.1389em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3173em;"><span class="" style="top: -2.357em; margin-left: -0.1389em; margin-right: 0.0714em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span><span class="mord mtight">/</span><span class="mopen mtight">(</span><span class="mord mtight">1</span><span class="mbin mtight">−</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.1389em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3173em;"><span class="" style="top: -2.357em; margin-left: -0.1389em; margin-right: 0.0714em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span><span class="mclose mtight">)</span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.485em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.1389em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3173em;"><span class="" style="top: -2.357em; margin-left: -0.1389em; margin-right: 0.0714em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span><span class="mord mtight">/</span><span class="mopen mtight">(</span><span class="mord mtight">1</span><span class="mbin mtight">−</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.1389em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3173em;"><span class="" style="top: -2.357em; margin-left: -0.1389em; margin-right: 0.0714em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.52em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span><br> （1）离散变量<br> <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         l 
        
       
         o 
        
       
         g 
        
       
         i 
        
       
         t 
        
       
         ( 
        
       
         p 
        
       
         ) 
        
       
         = 
        
       
         l 
        
       
         n 
        
        
        
          p 
         
         
         
           1 
          
         
           − 
          
         
           p 
          
         
        
       
         = 
        
        
        
          β 
         
        
          0 
         
        
       
         + 
        
        
        
          β 
         
        
          1 
         
        
       
         D 
        
       
      
        logit(p)=ln\frac{p}{1-p}=\beta_0+\beta_1D 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.0197em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right: 0.0359em;">g</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1.2286em; vertical-align: -0.4811em;"></span><span class="mord mathnormal" style="margin-right: 0.0197em;">l</span><span class="mord mathnormal">n</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.7475em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mbin mtight">−</span><span class="mord mathnormal mtight">p</span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.4461em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.4811em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0528em;">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: -0.0528em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0528em;">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: -0.0528em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right: 0.0278em;">D</span></span></span></span></span><br> D=0代表男性，D=1代表女性，所以女性的Odds为<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          e 
         
         
          
          
            β 
           
          
            0 
           
          
         
           + 
          
          
          
            β 
           
          
            1 
           
          
         
        
       
      
        e^{\beta_0+\beta_1} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8491em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.8491em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0528em;">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3173em;"><span class="" style="top: -2.357em; margin-left: -0.0528em; margin-right: 0.0714em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0528em;">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3173em;"><span class="" style="top: -2.357em; margin-left: -0.0528em; margin-right: 0.0714em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>，男性的Odds为<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          e 
         
         
         
           β 
          
         
           0 
          
         
        
       
      
        e^{\beta_0} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8491em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.8491em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0528em;">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3173em;"><span class="" style="top: -2.357em; margin-left: -0.0528em; margin-right: 0.0714em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>.<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          O 
         
        
          R 
         
        
          ( 
         
        
          女性 
         
        
          V 
         
        
          S 
         
        
          男性 
         
        
          ) 
         
        
          = 
         
         
          
          
            e 
           
           
            
            
              β 
             
            
              0 
             
            
           
             + 
            
            
            
              β 
             
            
              1 
             
            
           
          
          
          
            e 
           
           
           
             β 
            
           
             0 
            
           
          
         
        
          = 
         
         
         
           e 
          
          
          
            β 
           
          
            1 
           
          
         
        
       
         OR(女性VS男性)=\frac{e^{\beta_0+\beta_1}}{e^{\beta_0}}=e^{\beta_1} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.0077em;">OR</span><span class="mopen">(</span><span class="mord cjk_fallback">女性</span><span class="mord mathnormal" style="margin-right: 0.2222em;">V</span><span class="mord mathnormal" style="margin-right: 0.0576em;">S</span><span class="mord cjk_fallback">男性</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 2.2121em; vertical-align: -0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.5261em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.7751em;"><span class="" style="top: -2.989em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0528em;">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3173em;"><span class="" style="top: -2.357em; margin-left: -0.0528em; margin-right: 0.0714em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.8491em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0528em;">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3173em;"><span class="" style="top: -2.357em; margin-left: -0.0528em; margin-right: 0.0714em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0528em;">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3173em;"><span class="" style="top: -2.357em; margin-left: -0.0528em; margin-right: 0.0714em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.8991em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.8991em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0528em;">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3173em;"><span class="" style="top: -2.357em; margin-left: -0.0528em; margin-right: 0.0714em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br> （2）连续型变量<br> <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         l 
        
       
         o 
        
       
         g 
        
       
         i 
        
       
         t 
        
       
         ( 
        
       
         p 
        
       
         ) 
        
       
         = 
        
       
         l 
        
       
         n 
        
        
        
          p 
         
         
         
           1 
          
         
           − 
          
         
           p 
          
         
        
       
         = 
        
        
        
          β 
         
        
          0 
         
        
       
         + 
        
        
        
          β 
         
        
          1 
         
        
        
        
          x 
         
        
          1 
         
        
       
      
        logit(p)=ln\frac{p}{1-p}=\beta_0+\beta_1x_1 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.0197em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right: 0.0359em;">g</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1.2286em; vertical-align: -0.4811em;"></span><span class="mord mathnormal" style="margin-right: 0.0197em;">l</span><span class="mord mathnormal">n</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.7475em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mbin mtight">−</span><span class="mord mathnormal mtight">p</span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.4461em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.4811em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0528em;">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: -0.0528em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0528em;">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: -0.0528em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span><br> <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         O 
        
       
         R 
        
       
         ( 
        
        
        
          x 
         
        
          1 
         
        
       
         ) 
        
       
         = 
        
        
         
         
           e 
          
          
           
           
             β 
            
           
             0 
            
           
          
            + 
           
           
           
             β 
            
           
             1 
            
           
          
            ( 
           
          
            x 
           
          
            + 
           
          
            1 
           
          
            ) 
           
          
         
         
         
           e 
          
          
           
           
             β 
            
           
             0 
            
           
          
            + 
           
           
           
             β 
            
           
             1 
            
           
          
            x 
           
          
         
        
       
         = 
        
        
        
          e 
         
         
         
           β 
          
         
           1 
          
         
        
       
      
        OR(x_1)=\frac{e^{\beta_0+\beta_1(x+1)}}{e^{\beta_0+\beta_1x}}=e^{\beta_1} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.0077em;">OR</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1.4532em; vertical-align: -0.3825em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.0707em;"><span class="" style="top: -2.6175em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.8178em;"><span class="" style="top: -2.8218em; margin-right: 0.0714em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0528em;">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3448em;"><span class="" style="top: -2.3448em; margin-left: -0.0528em; margin-right: 0.1em;"><span class="pstrut" style="height: 2.6444em;"></span><span class="mord mtight">0</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2996em;"><span class=""></span></span></span></span></span></span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0528em;">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3448em;"><span class="" style="top: -2.3448em; margin-left: -0.0528em; margin-right: 0.1em;"><span class="pstrut" style="height: 2.6444em;"></span><span class="mord mtight">1</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2996em;"><span class=""></span></span></span></span></span></span><span class="mord mathnormal mtight">x</span></span></span></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.394em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.9667em;"><span class="" style="top: -2.9667em; margin-right: 0.0714em;"><span class="pstrut" style="height: 2.5357em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0528em;">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3448em;"><span class="" style="top: -2.3448em; margin-left: -0.0528em; margin-right: 0.1em;"><span class="pstrut" style="height: 2.6444em;"></span><span class="mord mtight">0</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2996em;"><span class=""></span></span></span></span></span></span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0528em;">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3448em;"><span class="" style="top: -2.3448em; margin-left: -0.0528em; margin-right: 0.1em;"><span class="pstrut" style="height: 2.6444em;"></span><span class="mord mtight">1</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2996em;"><span class=""></span></span></span></span></span></span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">x</span><span class="mbin mtight">+</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.3825em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.8491em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.8491em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0528em;">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3173em;"><span class="" style="top: -2.357em; margin-left: -0.0528em; margin-right: 0.0714em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
<h5><a id="822_41"></a>8.2.2建模流程</h5> 
<h6><a id="1_42"></a>1.模型开发</h6> 
<p>数据采样：需要得到训练样本、验证集、测试集，主要与需求方商讨后提供材料。<br> 数据探索：描述性统计分析，对数据的基本特征进行了解。<br> 数据填缺：单一填补、多重填补等，缺失值比例大小对今后模型的稳定性影响较大。<br> 变量压缩：多个变量具有共线性，需要进行变量压缩。<br> 变量筛选：剔除预测力不够的变量，否则会影响模型的稳定性，减少复杂度同时提高稳定性。<br> 变量调整：x和logit§应该近似线性，否则还需对数据进行变换。<br> 模型开发：建立逻辑回归模型，进行参数估计。</p> 
<h6><a id="2_50"></a>2.模型验证阶段</h6> 
<p>用测试集对模型的参数进行调优。<br> 数据处理：与测试集的数据保持一致<br> 误分类矩阵：训练集得到的模型用到验证集的预测比情况<br> ROC图：训练集得到的模型用到验证集的预测，得到的ROC图或LIFT图<br> 模型比较：根据ROC图、AUC图、误分矩阵、精准率和召回率等比较模型的预测性能<br> 模型确认：综合全部指标的比较得到结果</p> 
<h6><a id="3_57"></a>3.模型测试阶段</h6> 
<p>参数3调优后，仍然会有备选模型（影子模型）<br> 数据处理》收益矩阵》模型打分》决策》决策》价值判断</p> 
<h6><a id="4_60"></a>4.模型实施阶段</h6> 
<p>模型上线》周期评估》模型检测》新模型开发</p> 
<h5><a id="823_62"></a>8.2.3模型开发阶段</h5> 
<h6><a id="1_63"></a>1.数据采样</h6> 
<p>跟业务和需求方充分沟通，得到更靠谱、更贴近实际的数据类。<br> (1）<strong>已知总体</strong>，但是总体中响应样本的数据过少。这时候通过数据采样，保留所有响应样本，使得响应样本在采样后的数据集中占有一定的比例，这样有利于后续建模。一般响应样本与非响应样本之比为1∶4较好。<br> (2）<strong>总体未知</strong>，但是根据历史经验，知道响应的先验概率，此时获得的数据就是采样数据而不是总体数据，故在使用采样数据建模的过程中需要对采样数据的概率做调整。在最终的模型预测值上需要根据原先的比例对预测概率做调整，降低预测概率以符合实际情况。一般情况下，可以用下面的公式进行调整:<br> <img src="https://images2.imgbox.com/32/94/sXwNXgph_o.png" alt="样本调整公式"></p> 
<h6><a id="2_68"></a>2.数据探索</h6> 
<p>（1）连续型：均值、方差、偏度、峰度、正态性、分位数点、相关性和缺失值比例。<br> （2）离散型：频度分析、缺失值比例。若水平相应概率为零，则需要合并响应概率接近的组，尽可能消除为零的水平。</p> 
<h6><a id="3_71"></a>3.数据填缺</h6> 
<p>缺失达到80%的可以剔除，其他的可以填充：<br> （1）均值替换：连续型用均值填充，离散型用众数填充。完全随机缺失的假设<br> （2）热卡填充：用相关系数找到相似对象<br> （3）回归替换：建立回归方程，用缺失值期望替换缺失值<br> （4）多重插补：产生缺失值的一个随机样本，对统计结果进行综合</p> 
<h6><a id="4_77"></a>4.离散型变量压缩</h6> 
<p>哑变量、WOE（weight of evidence，证据权重，可以通过WOE变化使ROC达到最优，且极大化因变量的辨识度）、聚类分析</p> 
<h6><a id="5_79"></a>5.连续型变量压缩</h6> 
<p>见chapter6</p> 
<h6><a id="6_81"></a>6.变量筛选（用到的时候再细看一下，主要是权重那一套）</h6> 
<p>剔除与因变量关系较弱的变量，精简模型<br> （1）spearman等级相关系数是一种非参数统计相关方法，pearson相关系数必须假设数据成对地从正态分布取得且数据在逻辑范围内是等距的。spearman只需要两个变量是单调的，而pearson需要两个变量是线性关系。<br> （2）IV（Information Value,信息量）<br> 以WOE为基础并且在逻辑回归中的重要指标IV，衡量一个指标对因变量的重要程度，值越高，预测能力越强，为变量筛选提供了理论依据。</p> 
<h6><a id="7logit_86"></a>7.变量调整——logit图</h6> 
<p>观察各变量的logit图折线图需要为近似直线，即可加入模型，若不为线性，则需要对原始变量进行编码或转换（<strong>Bin编码</strong>、取对数、开根号等），直到折线图为直线。</p> 
<h6><a id="8_88"></a>8.线性假设</h6> 
<p>让步比（Odds Ratio）应该恒定不变，若不恒定，还需对变量进行变换。</p> 
<h6><a id="9_90"></a>9.模型开发</h6> 
<p>开发的方法有：全模型、向前法、向后法、向前向后逐步法</p> 
<h5><a id="824_92"></a>8.2.4模型验证阶段</h5> 
<p>1.验证集数据处理：缺失值的填补，均值、中位数等<br> 2.评价模型标准：混淆矩阵、ROC曲线、Lift和Gain图<a href="http://cos.name/2009/02/measure-classification-model-performance-lift-gain/" rel="nofollow">Gain图</a></p> 
<h5><a id="825_95"></a>8.2.5模型测试阶段</h5> 
<p>1.模型打分<br> 适用于在原始数据集中响应概率偏低或者总体未知的情形，见8.2.3.<br> 2.确定阈值（cutoff）<br> 阈值的主要作用是预测概率达到多大时判断其为响应，常用收益矩阵确定阈值。<br> 3.计算总收益<br> 计算一下模型的收益大概是多少，便于后期模型评估的分析。<br> 4.判断是否有必要建模<br> 主要考虑开发成本和模型效能的评估</p> 
<h5><a id="826_104"></a>8.2.6商业应用流程</h5> 
<p><img src="https://images2.imgbox.com/7a/aa/qjPmHwgM_o.png" alt="流程图"></p> 
<h5><a id="827R_106"></a>8.2.7R语言实例代码</h5> 
<p>1.生成哑变量</p> 
<pre><code class="prism language-r"><span class="token comment">#生成测试数据</span>
a1<span class="token operator">&lt;-</span>c<span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">,</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token string">'e'</span><span class="token punctuation">,</span><span class="token string">'e'</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">,</span><span class="token string">'a'</span><span class="token punctuation">)</span>
b1<span class="token operator">&lt;-</span>c<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">)</span>
df<span class="token operator">&lt;-</span>data.frame<span class="token punctuation">(</span>a1<span class="token punctuation">,</span>b1<span class="token punctuation">)</span>

<span class="token comment">#生成哑变量</span>
dummyvar<span class="token operator">&lt;-</span>model.matrix<span class="token punctuation">(</span><span class="token operator">~</span>df<span class="token operator">$</span>a1<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
<span class="token comment">#加到原始数据中</span>
df_adj<span class="token operator">&lt;-</span>cbind<span class="token punctuation">(</span>df<span class="token punctuation">,</span>dummyvar<span class="token punctuation">)</span>
df_adj
</code></pre> 
<p>三个水平数对应两个哑变量</p> 
<p>2.计算WOE和IV</p> 
<pre><code class="prism language-r"><span class="token comment">#####################################################################</span>
<span class="token comment">#函数功能：计算变量woe和iv值</span>
<span class="token comment">#参数说明： df：数据框（需要建模的训练数据）、flag_loc：因变量所在位置、var_loc：需要转变为woe和计算iv的变量所在位置</span>
woe_fun<span class="token operator">&lt;-</span><span class="token keyword">function</span><span class="token punctuation">(</span>df<span class="token punctuation">,</span>flag_loc<span class="token punctuation">,</span>var_loc<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    n_1t<span class="token operator">&lt;-</span>table<span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token punctuation">,</span>flag_loc<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
    n_0t<span class="token operator">&lt;-</span>table<span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token punctuation">,</span>flag_loc<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    varname<span class="token operator">&lt;-</span>names<span class="token punctuation">(</span>df<span class="token punctuation">)</span><span class="token punctuation">[</span>var_loc<span class="token punctuation">]</span>
    fact_n<span class="token operator">&lt;-</span>as.vector<span class="token punctuation">(</span>unique<span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token punctuation">,</span>var_loc<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    fact<span class="token operator">&lt;-</span>c<span class="token punctuation">(</span><span class="token punctuation">)</span>
    woe<span class="token operator">&lt;-</span>c<span class="token punctuation">(</span><span class="token punctuation">)</span>
    iv<span class="token operator">&lt;-</span>c<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">in</span> fact_n<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
      subsetdf<span class="token operator">&lt;-</span>paste<span class="token punctuation">(</span><span class="token string">"subset(df,"</span><span class="token punctuation">,</span>varname<span class="token punctuation">,</span><span class="token string">"=='"</span><span class="token punctuation">,</span>i<span class="token punctuation">,</span><span class="token string">"')"</span><span class="token punctuation">,</span>sep<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span>
      df_i<span class="token operator">&lt;-</span>eval<span class="token punctuation">(</span>parse<span class="token punctuation">(</span>text<span class="token operator">=</span>subsetdf<span class="token punctuation">)</span><span class="token punctuation">)</span>
      n_1i<span class="token operator">&lt;-</span>table<span class="token punctuation">(</span>df_i<span class="token punctuation">[</span><span class="token punctuation">,</span>flag_loc<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
      n_0i<span class="token operator">&lt;-</span>table<span class="token punctuation">(</span>df_i<span class="token punctuation">[</span><span class="token punctuation">,</span>flag_loc<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    
      p_1i<span class="token operator">&lt;-</span>n_1i<span class="token operator">/</span>n_1t
      p_0i<span class="token operator">&lt;-</span>n_0i<span class="token operator">/</span>n_0t
    
      woe_i<span class="token operator">&lt;-</span>log<span class="token punctuation">(</span>p_1i<span class="token operator">/</span>p_0i<span class="token punctuation">)</span>
      iv_i<span class="token operator">&lt;-</span><span class="token punctuation">(</span>p_1i<span class="token operator">-</span>p_0i<span class="token punctuation">)</span><span class="token operator">*</span>woe_i
      
      fact<span class="token operator">&lt;-</span>c<span class="token punctuation">(</span>fact<span class="token punctuation">,</span>i<span class="token punctuation">)</span>
      woe<span class="token operator">&lt;-</span>c<span class="token punctuation">(</span>woe<span class="token punctuation">,</span>woe_i<span class="token punctuation">)</span>
      iv<span class="token operator">&lt;-</span>c<span class="token punctuation">(</span>iv<span class="token punctuation">,</span>iv_i<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    woeres<span class="token operator">&lt;-</span>paste<span class="token punctuation">(</span><span class="token string">"woeres&lt;-data.frame("</span><span class="token punctuation">,</span>varname<span class="token punctuation">,</span><span class="token string">"=fact,woe_"</span><span class="token punctuation">,</span>varname<span class="token punctuation">,</span><span class="token string">"=woe)"</span><span class="token punctuation">,</span>sep<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span>
    eval<span class="token punctuation">(</span>parse<span class="token punctuation">(</span>text<span class="token operator">=</span>woeres<span class="token punctuation">)</span><span class="token punctuation">)</span>

    ivres<span class="token operator">&lt;-</span>sum<span class="token punctuation">(</span>iv<span class="token punctuation">)</span>
    return<span class="token punctuation">(</span>list<span class="token punctuation">(</span>woe<span class="token operator">=</span>woeres<span class="token punctuation">,</span>iv<span class="token operator">=</span>ivres<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>


setwd<span class="token punctuation">(</span><span class="token string">"C:\\Users\\用户路径"</span><span class="token punctuation">)</span>
testdf<span class="token operator">&lt;-</span>read.csv<span class="token punctuation">(</span><span class="token string">"data_chap9.csv"</span><span class="token punctuation">,</span>header<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">,</span>stringsAsFactors<span class="token operator">=</span><span class="token boolean">FALSE</span><span class="token punctuation">)</span>

woe_fun<span class="token punctuation">(</span>testdf<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span>which<span class="token punctuation">(</span>names<span class="token punctuation">(</span>testdf<span class="token punctuation">)</span><span class="token operator">==</span><span class="token string">"v18"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>自定义函数的list对象为离散变量每个水平下的WOE值、IV值<br> 3.计算spearman相关系数</p> 
<pre><code class="prism language-r"><span class="token comment">#####################################################################</span>
<span class="token comment">#函数功能：计算变量与因变量的相关系数</span>
<span class="token comment">#参数说明：df：数据框（需要建模的训练数据）\flag_loc：因变量所在位置、method：计算相关系数的方法，默认为spearman相关系数</span>

spearman_var<span class="token operator">&lt;-</span><span class="token keyword">function</span><span class="token punctuation">(</span>df<span class="token punctuation">,</span>flag_loc<span class="token punctuation">,</span>method<span class="token operator">=</span><span class="token string">'spearman'</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    depend_var<span class="token operator">&lt;-</span>df<span class="token punctuation">[</span>flag_loc<span class="token punctuation">]</span>
    varname<span class="token operator">&lt;-</span>names<span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token operator">-</span>flag_loc<span class="token punctuation">]</span><span class="token punctuation">)</span>

    spearman_cor<span class="token operator">&lt;-</span>c<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">in</span> varname<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        vari<span class="token operator">&lt;-</span>as.numeric<span class="token punctuation">(</span>as.vector<span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token punctuation">,</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        spearman_i<span class="token operator">&lt;-</span>cor<span class="token punctuation">(</span>depend_var<span class="token punctuation">,</span>vari<span class="token punctuation">,</span>method<span class="token operator">=</span>method<span class="token punctuation">)</span>
        spearman_cor<span class="token operator">&lt;-</span>c<span class="token punctuation">(</span>spearman_cor<span class="token punctuation">,</span>spearman_i<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    
    spearmandf<span class="token operator">&lt;-</span>data.frame<span class="token punctuation">(</span>varname<span class="token operator">=</span>varname<span class="token punctuation">,</span>spearman<span class="token operator">=</span>spearman_cor<span class="token punctuation">)</span>
    return<span class="token punctuation">(</span>spearmandf<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

spearman_var<span class="token punctuation">(</span>testdf<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token operator">-</span>c<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
</code></pre> 
<p>输出的是所有变量与因变量的spearman相关系数<br> 4.计算各变量的IV值</p> 
<pre><code class="prism language-r"><span class="token comment">#选择计算iv的变量位置（一定要是离散型变量，维度不能过多）</span>
var_loc<span class="token operator">&lt;-</span>c<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span>  <span class="token comment">##选离散型变量</span>
varnames<span class="token operator">&lt;-</span>names<span class="token punctuation">(</span>testdf<span class="token punctuation">)</span><span class="token punctuation">[</span>var_loc<span class="token punctuation">]</span>
iv<span class="token operator">&lt;-</span>c<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">#计算各个变量的iv值</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">in</span> var_loc<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    ivi<span class="token operator">&lt;-</span>woe_fun<span class="token punctuation">(</span>testdf<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token operator">$</span>iv  <span class="token comment">##整合用woe函数计算每个离散型变量的IV值，并给出判断结果</span>
    iv<span class="token operator">&lt;-</span>c<span class="token punctuation">(</span>iv<span class="token punctuation">,</span>ivi<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">#根据iv判断变量有无预测力</span>
var_iv<span class="token operator">&lt;-</span>data.frame<span class="token punctuation">(</span>varname<span class="token operator">=</span>varnames<span class="token punctuation">,</span>iv<span class="token operator">=</span>iv<span class="token punctuation">)</span>
var_iv<span class="token operator">$</span>iv_desc<span class="token operator">&lt;-</span>c<span class="token punctuation">(</span><span class="token string">"无"</span><span class="token punctuation">)</span>

attach<span class="token punctuation">(</span>var_iv<span class="token punctuation">)</span>
var_iv<span class="token punctuation">[</span>which<span class="token punctuation">(</span>iv<span class="token operator">&lt;</span><span class="token number">0.02</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>iv_desc<span class="token operator">&lt;-</span><span class="token string">"无预测力"</span>
var_iv<span class="token punctuation">[</span>which<span class="token punctuation">(</span>iv<span class="token operator">&gt;=</span><span class="token number">0.02</span> <span class="token operator">&amp;</span> iv<span class="token operator">&lt;</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>iv_desc<span class="token operator">&lt;-</span><span class="token string">"预测力弱"</span>
var_iv<span class="token punctuation">[</span>which<span class="token punctuation">(</span>iv<span class="token operator">&gt;=</span><span class="token number">0.1</span> <span class="token operator">&amp;</span> iv<span class="token operator">&lt;</span><span class="token number">0.3</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>iv_desc<span class="token operator">&lt;-</span><span class="token string">"预测力中"</span>
var_iv<span class="token punctuation">[</span>which<span class="token punctuation">(</span>iv<span class="token operator">&gt;=</span><span class="token number">0.3</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>iv_desc<span class="token operator">&lt;-</span><span class="token string">"预测力强"</span>
detach<span class="token punctuation">(</span>var_iv<span class="token punctuation">)</span>
var_iv
</code></pre> 
<p>5.logit图</p> 
<pre><code class="prism language-r"><span class="token comment">#####################################################################</span>
<span class="token comment">#函数功能：计算连续性变量的logit值以及画出logit图</span>
<span class="token comment">#参数说明：df：数据框（需要建模的训练数据）、flag_loc：因变量所在位置、var_loc：连续型自变量所在的位置、groups：分成的组类别数</span>

logitfun<span class="token operator">&lt;-</span><span class="token keyword">function</span><span class="token punctuation">(</span>df<span class="token punctuation">,</span>flag_loc<span class="token punctuation">,</span>var_loc<span class="token punctuation">,</span>groups<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    opar<span class="token operator">&lt;-</span>par<span class="token punctuation">(</span>no.readonly<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span>
    par<span class="token punctuation">(</span>mfrow<span class="token operator">=</span>c<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    df_logit<span class="token operator">&lt;-</span>df<span class="token punctuation">[</span><span class="token punctuation">,</span>c<span class="token punctuation">(</span>flag_loc<span class="token punctuation">,</span>var_loc<span class="token punctuation">)</span><span class="token punctuation">]</span>
    names<span class="token punctuation">(</span>df_logit<span class="token punctuation">)</span><span class="token operator">&lt;-</span>c<span class="token punctuation">(</span><span class="token string">"flag"</span><span class="token punctuation">,</span><span class="token string">"var"</span><span class="token punctuation">)</span>
    group<span class="token operator">&lt;-</span>floor<span class="token punctuation">(</span>rank<span class="token punctuation">(</span>df_logit<span class="token operator">$</span>var<span class="token punctuation">)</span><span class="token operator">*</span>groups<span class="token operator">/</span><span class="token punctuation">(</span>length<span class="token punctuation">(</span>df_logit<span class="token operator">$</span>var<span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    df_logit<span class="token operator">$</span>group<span class="token operator">&lt;-</span>group
    
    ntot<span class="token operator">&lt;-</span>as.data.frame<span class="token punctuation">(</span>table<span class="token punctuation">(</span>df_logit<span class="token operator">$</span>group<span class="token punctuation">)</span><span class="token punctuation">)</span>
    names<span class="token punctuation">(</span>ntot<span class="token punctuation">)</span><span class="token operator">&lt;-</span>c<span class="token punctuation">(</span><span class="token string">"group"</span><span class="token punctuation">,</span><span class="token string">"ntot"</span><span class="token punctuation">)</span>
    ntot<span class="token operator">$</span>group<span class="token operator">&lt;-</span>as.numeric<span class="token punctuation">(</span>as.vector<span class="token punctuation">(</span>ntot<span class="token operator">$</span>group<span class="token punctuation">)</span><span class="token punctuation">)</span>

    npos<span class="token operator">&lt;-</span>as.data.frame<span class="token punctuation">(</span>table<span class="token punctuation">(</span>subset<span class="token punctuation">(</span>df_logit<span class="token punctuation">,</span>flag<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">$</span>group<span class="token punctuation">)</span><span class="token punctuation">)</span>
    names<span class="token punctuation">(</span>npos<span class="token punctuation">)</span><span class="token operator">&lt;-</span>c<span class="token punctuation">(</span><span class="token string">"group"</span><span class="token punctuation">,</span><span class="token string">"npos"</span><span class="token punctuation">)</span>
    npos<span class="token operator">$</span>group<span class="token operator">&lt;-</span>as.numeric<span class="token punctuation">(</span>as.vector<span class="token punctuation">(</span>npos<span class="token operator">$</span>group<span class="token punctuation">)</span><span class="token punctuation">)</span>
    varlogit<span class="token operator">&lt;-</span>join<span class="token punctuation">(</span>ntot<span class="token punctuation">,</span>npos<span class="token punctuation">)</span>

    varlogit<span class="token operator">$</span>logit<span class="token operator">&lt;-</span>log<span class="token punctuation">(</span><span class="token punctuation">(</span>varlogit<span class="token operator">$</span>npos<span class="token operator">+</span>sqrt<span class="token punctuation">(</span>varlogit<span class="token operator">$</span>ntot<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span>
                       <span class="token operator">/</span><span class="token punctuation">(</span>varlogit<span class="token operator">$</span>ntot<span class="token operator">-</span>varlogit<span class="token operator">$</span>npos<span class="token operator">+</span>sqrt<span class="token punctuation">(</span>varlogit<span class="token operator">$</span>ntot<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    varavg<span class="token operator">&lt;-</span>aggregate<span class="token punctuation">(</span>df_logit<span class="token punctuation">,</span>by<span class="token operator">=</span>list<span class="token punctuation">(</span>group<span class="token punctuation">)</span><span class="token punctuation">,</span>FUN<span class="token operator">=</span>mean<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">,</span>c<span class="token punctuation">(</span><span class="token string">"Group.1"</span><span class="token punctuation">,</span><span class="token string">"var"</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    names<span class="token punctuation">(</span>varavg<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&lt;-</span><span class="token string">'group'</span>

    logit_res<span class="token operator">&lt;-</span>join<span class="token punctuation">(</span>varavg<span class="token punctuation">,</span>varlogit<span class="token punctuation">,</span>by<span class="token operator">=</span><span class="token string">"group"</span><span class="token punctuation">)</span>
    logit_res<span class="token operator">$</span>bin<span class="token operator">&lt;-</span>c<span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span>nrow<span class="token punctuation">(</span>logit_res<span class="token punctuation">)</span><span class="token punctuation">)</span>

    plot<span class="token punctuation">(</span>logit_res<span class="token operator">$</span>var<span class="token punctuation">,</span>logit_res<span class="token operator">$</span>logit<span class="token punctuation">,</span>type<span class="token operator">=</span><span class="token string">'o'</span><span class="token punctuation">,</span>main<span class="token operator">=</span><span class="token string">"均值-logit"</span><span class="token punctuation">)</span>
    plot<span class="token punctuation">(</span>logit_res<span class="token operator">$</span>bin<span class="token punctuation">,</span>logit_res<span class="token operator">$</span>logit<span class="token punctuation">,</span>type<span class="token operator">=</span><span class="token string">'o'</span><span class="token punctuation">,</span>main<span class="token operator">=</span><span class="token string">"bin-logit"</span><span class="token punctuation">)</span>
    par<span class="token punctuation">(</span>opar<span class="token punctuation">)</span>
    return<span class="token punctuation">(</span>logit_res<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

logitfun<span class="token punctuation">(</span>testdf<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>
</code></pre> 
<p>自定义函数输出logit值、对应的组均值及bin值及均值-logit图和bin-logit图，bin-logit改善了均值-logit的线性情况。</p> 
<h4><a id="83_259"></a>8.3项目实践</h4> 
<p>10000个样本，18个自变量，flag这一个因变量</p> 
<h5><a id="831_261"></a>8.3.1数据探索</h5> 
<p>1.因变量分布</p> 
<pre><code class="prism language-r"><span class="token comment">#---------取数</span>
setwd<span class="token punctuation">(</span><span class="token string">"C:\\Users\\用户路径"</span><span class="token punctuation">)</span>
testdf<span class="token operator">&lt;-</span>read.csv<span class="token punctuation">(</span><span class="token string">"data_chap9.csv"</span><span class="token punctuation">,</span>header<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">,</span>stringsAsFactors<span class="token operator">=</span><span class="token boolean">FALSE</span><span class="token punctuation">)</span>
testdf<span class="token operator">$</span>rnd<span class="token operator">&lt;-</span>runif<span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token comment">#--------分训练集和测试集</span>
train_set<span class="token operator">&lt;-</span>subset<span class="token punctuation">(</span>testdf<span class="token punctuation">,</span>rnd<span class="token operator">&lt;=</span><span class="token number">0.6</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">21</span><span class="token punctuation">]</span>
test_set<span class="token operator">&lt;-</span>subset<span class="token punctuation">(</span>testdf<span class="token punctuation">,</span>rnd<span class="token operator">&gt;</span><span class="token number">0.6</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">21</span><span class="token punctuation">]</span>
table<span class="token punctuation">(</span>testdf<span class="token operator">$</span>flag<span class="token punctuation">)</span>
table<span class="token punctuation">(</span>train_set<span class="token operator">$</span>flag<span class="token punctuation">)</span>
table<span class="token punctuation">(</span>test_set<span class="token operator">$</span>flag<span class="token punctuation">)</span>
</code></pre> 
<p>响应变量约为30%，顾不需要调整结果的概率值。60%训练集，40%测试集，对应的响应也近似30%。</p> 
<p>2.自变量探索</p> 
<pre><code class="prism language-r">table<span class="token punctuation">(</span>train_set<span class="token operator">$</span>v6<span class="token punctuation">)</span>  <span class="token comment">##3水平</span>
table<span class="token punctuation">(</span>train_set<span class="token operator">$</span>v18<span class="token punctuation">)</span>  <span class="token comment">##10个水平，其余为2水平</span>

summary<span class="token punctuation">(</span>train_set<span class="token operator">$</span>v3<span class="token punctuation">)</span>
summary<span class="token punctuation">(</span>train_set<span class="token operator">$</span>v11<span class="token punctuation">)</span>
summary<span class="token punctuation">(</span>train_set<span class="token operator">$</span>v12<span class="token punctuation">)</span>
summary<span class="token punctuation">(</span>train_set<span class="token operator">$</span>v13<span class="token punctuation">)</span>  <span class="token comment">##连续型变量，无缺失值，且范围跨度有大有小。</span>
<span class="token comment">#### 8.3.2数据处理</span>
<span class="token number">1.</span>生成哑变量（模型开发）
```r
train_set<span class="token operator">$</span>v6<span class="token operator">&lt;-</span>as.factor<span class="token punctuation">(</span>train_set<span class="token operator">$</span>v6<span class="token punctuation">)</span>
dummyvar<span class="token operator">&lt;-</span>model.matrix<span class="token punctuation">(</span><span class="token operator">~</span>train_set<span class="token operator">$</span>v6<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
train_set<span class="token operator">&lt;-</span>cbind<span class="token punctuation">(</span>train_set<span class="token punctuation">,</span>dummyvar<span class="token punctuation">)</span>  <span class="token comment">#将变量生成n-1个哑变量加到原始数据中</span>
train_set<span class="token operator">&lt;-</span>train_set<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token punctuation">(</span>which<span class="token punctuation">(</span>names<span class="token punctuation">(</span>train_set<span class="token punctuation">)</span><span class="token operator">==</span><span class="token string">"v6"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>  <span class="token comment">##删除原始离散变量</span>
names<span class="token punctuation">(</span>train_set<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token operator">&lt;-</span><span class="token string">"v6_1"</span>
names<span class="token punctuation">(</span>train_set<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">21</span><span class="token punctuation">]</span><span class="token operator">&lt;-</span><span class="token string">"v6_2"</span>
<span class="token comment">#查看前几行数据</span>
head<span class="token punctuation">(</span>train_set<span class="token punctuation">)</span>
</code></pre> 
<p>2.计算WOE</p> 
<pre><code class="prism language-r"><span class="token comment">##合并五个类别，用VAC代替</span>
train_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>train_set<span class="token operator">$</span>v18<span class="token operator">==</span><span class="token string">'CRP'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v18<span class="token operator">&lt;-</span><span class="token string">'VAC'</span>
train_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>train_set<span class="token operator">$</span>v18<span class="token operator">==</span><span class="token string">'VIS'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v18<span class="token operator">&lt;-</span><span class="token string">'VAC'</span>
train_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>train_set<span class="token operator">$</span>v18<span class="token operator">==</span><span class="token string">'DIY'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v18<span class="token operator">&lt;-</span><span class="token string">'VAC'</span>
train_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>train_set<span class="token operator">$</span>v18<span class="token operator">==</span><span class="token string">'PKG'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v18<span class="token operator">&lt;-</span><span class="token string">'VAC'</span>
train_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>train_set<span class="token operator">$</span>v18<span class="token operator">==</span><span class="token string">'TRM'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v18<span class="token operator">&lt;-</span><span class="token string">'VAC'</span>

woe_train<span class="token operator">&lt;-</span>woe_fun<span class="token punctuation">(</span>train_set<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span>which<span class="token punctuation">(</span>names<span class="token punctuation">(</span>train_set<span class="token punctuation">)</span><span class="token operator">==</span><span class="token string">"v18"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>   <span class="token comment">##自定义函数计算WOE替换变量</span>
woe_train<span class="token operator">$</span>v18<span class="token operator">&lt;-</span>as.character<span class="token punctuation">(</span>as.vector<span class="token punctuation">(</span>woe_train<span class="token operator">$</span>v18<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment">#将变量类型转换成与原始变量一致（根据具体情况删减）</span>
train_set<span class="token operator">&lt;-</span>join<span class="token punctuation">(</span>train_set<span class="token punctuation">,</span>woe_train<span class="token punctuation">)</span>   <span class="token comment">#将原始变量用WOE值替换</span>
train_set<span class="token operator">&lt;-</span>train_set<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token operator">-</span>which<span class="token punctuation">(</span>names<span class="token punctuation">(</span>train_set<span class="token punctuation">)</span><span class="token operator">==</span><span class="token string">'v18'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>  
head<span class="token punctuation">(</span>train_set<span class="token punctuation">)</span>
</code></pre> 
<p>3.计算spearman等级相关系数</p> 
<pre><code class="prism language-r">spearman_var<span class="token punctuation">(</span>train_set<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token comment">#去除第一行（id为行号，无特殊意义）2\3\5\8\10对变量相关性较高</span>
</code></pre> 
<p>4.计算各离散型变量的IV值</p> 
<pre><code class="prism language-r"><span class="token comment">#选择计算iv的变量位置（一定要是离散型变量，维度不能过多）</span>
var_loc<span class="token operator">&lt;-</span>c<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token operator">:</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token operator">:</span><span class="token number">20</span><span class="token punctuation">)</span>  
varnames<span class="token operator">&lt;-</span>names<span class="token punctuation">(</span>train_set<span class="token punctuation">)</span><span class="token punctuation">[</span>var_loc<span class="token punctuation">]</span>
iv<span class="token operator">&lt;-</span>c<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">#计算各个变量的iv值</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">in</span> var_loc<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    ivi<span class="token operator">&lt;-</span>woe_fun<span class="token punctuation">(</span>train_set<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token operator">$</span>iv    <span class="token comment">##woe_fun函数求IV	值</span>
	iv<span class="token operator">&lt;-</span>c<span class="token punctuation">(</span>iv<span class="token punctuation">,</span>ivi<span class="token punctuation">)</span>
	print<span class="token punctuation">(</span>paste<span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token string">"is finished!"</span><span class="token punctuation">,</span>sep<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">#根据iv判断变量有无预测力</span>
var_iv<span class="token operator">&lt;-</span>data.frame<span class="token punctuation">(</span>varname<span class="token operator">=</span>varnames<span class="token punctuation">,</span>iv<span class="token operator">=</span>iv<span class="token punctuation">)</span>
var_iv<span class="token operator">$</span>iv_desc<span class="token operator">&lt;-</span>c<span class="token punctuation">(</span><span class="token string">"无"</span><span class="token punctuation">)</span>

attach<span class="token punctuation">(</span>var_iv<span class="token punctuation">)</span>
var_iv<span class="token punctuation">[</span>which<span class="token punctuation">(</span>iv<span class="token operator">&lt;</span><span class="token number">0.02</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>iv_desc<span class="token operator">&lt;-</span><span class="token string">"无预测力"</span>
var_iv<span class="token punctuation">[</span>which<span class="token punctuation">(</span>iv<span class="token operator">&gt;=</span><span class="token number">0.02</span> <span class="token operator">&amp;</span> iv<span class="token operator">&lt;</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>iv_desc<span class="token operator">&lt;-</span><span class="token string">"预测力弱"</span>
var_iv<span class="token punctuation">[</span>which<span class="token punctuation">(</span>iv<span class="token operator">&gt;=</span><span class="token number">0.1</span> <span class="token operator">&amp;</span> iv<span class="token operator">&lt;</span><span class="token number">0.3</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>iv_desc<span class="token operator">&lt;-</span><span class="token string">"预测力中"</span>
var_iv<span class="token punctuation">[</span>which<span class="token punctuation">(</span>iv<span class="token operator">&gt;=</span><span class="token number">0.3</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>iv_desc<span class="token operator">&lt;-</span><span class="token string">"预测力强"</span>
detach<span class="token punctuation">(</span>var_iv<span class="token punctuation">)</span>
var_iv   
<span class="token comment">#####5、8、10、15的预测能力较好</span>
</code></pre> 
<p>5.连续型变量logit图<br> v3和v13两个变量的logit图未呈线性，需要进行Bin变换，其连续变量不用处理。</p> 
<pre><code class="prism language-r"><span class="token comment">#v3、v13连续型变量logit图</span>
var_loc<span class="token operator">&lt;-</span>which<span class="token punctuation">(</span>names<span class="token punctuation">(</span>train_set<span class="token punctuation">)</span><span class="token operator">==</span><span class="token string">"v3"</span><span class="token punctuation">)</span>
logitfun<span class="token punctuation">(</span>train_set<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span>var_loc<span class="token punctuation">,</span>groups<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>
<span class="token comment">#用bin去替代</span>
groups<span class="token operator">&lt;-</span><span class="token number">100</span>
df_logit<span class="token operator">&lt;-</span>train_set<span class="token punctuation">[</span><span class="token punctuation">,</span>c<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>var_loc<span class="token punctuation">)</span><span class="token punctuation">]</span>
group<span class="token operator">&lt;-</span>floor<span class="token punctuation">(</span>rank<span class="token punctuation">(</span>df_logit<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">*</span>groups<span class="token operator">/</span><span class="token punctuation">(</span>length<span class="token punctuation">(</span>df_logit<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
df_logit<span class="token operator">$</span>group<span class="token operator">&lt;-</span>group
df_logit<span class="token operator">&lt;-</span>df_logit<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span>
train_set<span class="token operator">&lt;-</span>join<span class="token punctuation">(</span>train_set<span class="token punctuation">,</span>df_logit<span class="token punctuation">)</span>
names<span class="token punctuation">(</span>train_set<span class="token punctuation">)</span><span class="token punctuation">[</span>which<span class="token punctuation">(</span>names<span class="token punctuation">(</span>train_set<span class="token punctuation">)</span><span class="token operator">==</span><span class="token string">"group"</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">&lt;-</span><span class="token string">"v3_bin"</span>
train_set<span class="token operator">&lt;-</span>train_set<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token operator">-</span>var_loc<span class="token punctuation">]</span>

var_loc<span class="token operator">&lt;-</span>which<span class="token punctuation">(</span>names<span class="token punctuation">(</span>train_set<span class="token punctuation">)</span><span class="token operator">==</span><span class="token string">"v13"</span><span class="token punctuation">)</span>
logitfun<span class="token punctuation">(</span>train_set<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span>var_loc<span class="token punctuation">,</span>groups<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>
<span class="token comment">#用bin去替代</span>
groups<span class="token operator">&lt;-</span><span class="token number">100</span>
df_logit<span class="token operator">&lt;-</span>train_set<span class="token punctuation">[</span><span class="token punctuation">,</span>c<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>var_loc<span class="token punctuation">)</span><span class="token punctuation">]</span>
group<span class="token operator">&lt;-</span>floor<span class="token punctuation">(</span>rank<span class="token punctuation">(</span>df_logit<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">*</span>groups<span class="token operator">/</span><span class="token punctuation">(</span>length<span class="token punctuation">(</span>df_logit<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
df_logit<span class="token operator">$</span>group<span class="token operator">&lt;-</span>group
df_logit<span class="token operator">&lt;-</span>df_logit<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span>
train_set<span class="token operator">&lt;-</span>join<span class="token punctuation">(</span>train_set<span class="token punctuation">,</span>df_logit<span class="token punctuation">)</span>
names<span class="token punctuation">(</span>train_set<span class="token punctuation">)</span><span class="token punctuation">[</span>which<span class="token punctuation">(</span>names<span class="token punctuation">(</span>train_set<span class="token punctuation">)</span><span class="token operator">==</span><span class="token string">"group"</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">&lt;-</span><span class="token string">"v13_bin"</span>
train_set<span class="token operator">&lt;-</span>train_set<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token operator">-</span>var_loc<span class="token punctuation">]</span>

head<span class="token punctuation">(</span>train_set<span class="token punctuation">)</span>
</code></pre> 
<h5><a id="833_374"></a>8.3.3建立模型</h5> 
<pre><code class="prism language-r"><span class="token comment">#设定自变量、因变量和数据集   训练集上建模</span>
vars<span class="token operator">&lt;-</span><span class="token string">"v1+v2+v4+v5+v7+v8+v9+v10+v11+v12+v14+v15+v16+v17+v6_1+v6_2+woe_v18+v3_bin+v13_bin"</span>
trainset<span class="token operator">&lt;-</span><span class="token string">"train_set"</span>
depend_var<span class="token operator">&lt;-</span><span class="token string">"flag"</span>

glm_fit_fuc<span class="token operator">&lt;-</span>paste<span class="token punctuation">(</span><span class="token string">"glm_fit=glm("</span><span class="token punctuation">,</span>depend_var<span class="token punctuation">,</span><span class="token string">"~"</span><span class="token punctuation">,</span>vars<span class="token punctuation">,</span><span class="token string">",data="</span><span class="token punctuation">,</span>trainset<span class="token punctuation">,</span><span class="token string">",family=binomial(link='logit'))"</span>
             <span class="token punctuation">,</span>sep<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span>

eval<span class="token punctuation">(</span>parse<span class="token punctuation">(</span>text<span class="token operator">=</span>glm_fit_fuc<span class="token punctuation">)</span><span class="token punctuation">)</span>
summary<span class="token punctuation">(</span>glm_fit<span class="token punctuation">)</span>

glm_step<span class="token operator">&lt;-</span>step<span class="token punctuation">(</span>glm_fit<span class="token punctuation">)</span>
summary<span class="token punctuation">(</span>glm_step<span class="token punctuation">)</span>

<span class="token comment">#最终模型</span>
<span class="token comment">#模型1：</span>
vars<span class="token operator">&lt;-</span><span class="token string">"v1+v2+v4+v5+v7+v8+v10+v11+v14+v15+v17+v6_2+v3_bin+v13_bin"</span>
trainset<span class="token operator">&lt;-</span><span class="token string">"train_set"</span>
depend_var<span class="token operator">&lt;-</span><span class="token string">"flag"</span>

glm_fit_fuc<span class="token operator">&lt;-</span>paste<span class="token punctuation">(</span><span class="token string">"glm_fit=glm("</span><span class="token punctuation">,</span>depend_var<span class="token punctuation">,</span><span class="token string">"~"</span><span class="token punctuation">,</span>vars<span class="token punctuation">,</span><span class="token string">",data="</span><span class="token punctuation">,</span>trainset<span class="token punctuation">,</span><span class="token string">",family=binomial(link='logit'))"</span>
             <span class="token punctuation">,</span>sep<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span>

eval<span class="token punctuation">(</span>parse<span class="token punctuation">(</span>text<span class="token operator">=</span>glm_fit_fuc<span class="token punctuation">)</span><span class="token punctuation">)</span>
summary<span class="token punctuation">(</span>glm_fit<span class="token punctuation">)</span>
</code></pre> 
<p>全部变量放入模型，后用step函数进行调优，选择显著的系数</p> 
<h5><a id="834_403"></a>8.3.4模型验证</h5> 
<p>模型在测试集上建立后，需要在测试集上验证，验证集的处理需要和测试集的处理一致</p> 
<p>1、数据调整和变换</p> 
<pre><code class="prism language-r">test_set<span class="token operator">&lt;-</span>subset<span class="token punctuation">(</span>testdf<span class="token punctuation">,</span>rnd<span class="token operator">&gt;</span><span class="token number">0.6</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">21</span><span class="token punctuation">]</span>
<span class="token comment">#---------生成哑变量</span>
test_set<span class="token operator">$</span>v6<span class="token operator">&lt;-</span>as.factor<span class="token punctuation">(</span>test_set<span class="token operator">$</span>v6<span class="token punctuation">)</span>
dummyvar<span class="token operator">&lt;-</span>model.matrix<span class="token punctuation">(</span><span class="token operator">~</span>test_set<span class="token operator">$</span>v6<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
test_set<span class="token operator">&lt;-</span>cbind<span class="token punctuation">(</span>test_set<span class="token punctuation">,</span>dummyvar<span class="token punctuation">)</span>    <span class="token comment">#加到原始数据中</span>
test_set<span class="token operator">&lt;-</span>test_set<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token punctuation">(</span>which<span class="token punctuation">(</span>names<span class="token punctuation">(</span>test_set<span class="token punctuation">)</span><span class="token operator">==</span><span class="token string">"v6"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
names<span class="token punctuation">(</span>test_set<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token operator">&lt;-</span><span class="token string">"v6_1"</span>
names<span class="token punctuation">(</span>test_set<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">21</span><span class="token punctuation">]</span><span class="token operator">&lt;-</span><span class="token string">"v6_2"</span>
<span class="token comment">#----------将v18中的trm和vis合并   生成WOE</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>test_set<span class="token operator">$</span>v18<span class="token operator">==</span><span class="token string">'CRP'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v18<span class="token operator">&lt;-</span><span class="token string">'VAC'</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>test_set<span class="token operator">$</span>v18<span class="token operator">==</span><span class="token string">'VIS'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v18<span class="token operator">&lt;-</span><span class="token string">'VAC'</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>test_set<span class="token operator">$</span>v18<span class="token operator">==</span><span class="token string">'DIY'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v18<span class="token operator">&lt;-</span><span class="token string">'VAC'</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>test_set<span class="token operator">$</span>v18<span class="token operator">==</span><span class="token string">'PKG'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v18<span class="token operator">&lt;-</span><span class="token string">'VAC'</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>test_set<span class="token operator">$</span>v18<span class="token operator">==</span><span class="token string">'TRM'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v18<span class="token operator">&lt;-</span><span class="token string">'VAC'</span>

<span class="token comment">#将原始变量用训练集上WOE值替换</span>
test_set<span class="token operator">&lt;-</span>join<span class="token punctuation">(</span>test_set<span class="token punctuation">,</span>woe_train<span class="token punctuation">)</span>
test_set<span class="token operator">&lt;-</span>test_set<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token operator">-</span>which<span class="token punctuation">(</span>names<span class="token punctuation">(</span>test_set<span class="token punctuation">)</span><span class="token operator">==</span><span class="token string">'v18'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token comment">#-------------------------#</span>
<span class="token comment">##实现了测试集的哑变量和WOE变换，对v3和v13的分组都要按照训练集上的区间进行 </span>
<span class="token comment">#-------------------------#</span>

<span class="token comment">#----------连续型变量调整--------------</span>
<span class="token comment">#对v3和v13进行bin调整</span>
test_set<span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span>c<span class="token punctuation">(</span>rep<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>nrow<span class="token punctuation">(</span>test_set<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
attach<span class="token punctuation">(</span>test_set<span class="token punctuation">)</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&lt;=</span><span class="token number">440</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">0</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">440</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">463</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">1</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">463</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">479</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">2</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">479</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">492</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">3</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">492</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">502</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">4</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">502</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">513</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">5</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">513</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">528</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">6</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">528</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">540</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">7</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">540</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">550</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">8</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">550</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">560</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">9</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">560</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">571</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">10</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">571</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">583</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">11</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">583</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">595</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">12</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">595</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">602</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">13</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">602</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">610</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">14</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">610</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">617</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">15</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">617</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">624</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">16</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">624</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">631</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">17</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">631</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">638</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">18</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">638</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">646</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">19</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">646</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">653</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">20</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">653</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">661</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">21</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">661</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">668</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">22</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">668</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">674</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">23</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">674</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">680</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">24</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">680</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">689</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">25</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">689</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">697</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">26</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">697</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">705</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">27</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">705</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">712</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">28</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">712</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">717</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">29</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">717</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">724</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">30</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">724</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">732</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">31</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">732</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">749</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">32</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">749</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">770</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">33</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">770</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">798</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">34</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">798</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">828</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">35</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">828</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">841</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">36</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">841</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">852</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">37</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">852</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">867</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">38</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">867</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">881</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">39</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">881</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">900</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">40</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">900</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">919</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">41</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">919</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">939</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">42</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">939</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">953</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">43</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">953</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">973</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">44</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">973</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">996</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">45</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">996</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">1020</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">46</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">1020</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">1066</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">47</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">1066</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">1107</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">48</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">1107</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">1140</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">49</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">1140</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">1182</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">50</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">1182</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">1213</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">51</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">1213</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">1240</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">52</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">1240</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">1276</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">53</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">1276</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">1314</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">54</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">1314</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">1353</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">55</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">1353</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">1389</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">56</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">1389</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">1427</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">57</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">1427</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">1468</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">58</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">1468</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">1501</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">59</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">1501</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">1549</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">60</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">1549</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">1598</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">61</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">1598</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">1635</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">62</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">1635</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">1678</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">63</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">1678</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">1712</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">64</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">1712</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">1763</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">65</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">1763</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">1806</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">66</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">1806</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">1843</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">67</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">1843</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">1887</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">68</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">1887</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">1927</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">69</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">1927</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">1958</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">70</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">1958</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">1993</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">71</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">1993</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">2025</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">72</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">2025</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">2055</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">73</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">2055</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">2078</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">74</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">2078</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">2119</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">75</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">2119</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">2156</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">76</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">2156</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">2183</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">77</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">2183</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">2216</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">78</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">2216</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">2265</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">79</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">2265</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">2316</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">80</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">2316</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">2358</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">81</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">2358</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">2399</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">82</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">2399</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">2452</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">83</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">2452</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">2503</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">84</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">2503</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">2550</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">85</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">2550</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">2600</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">86</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">2600</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">2675</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">87</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">2675</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">2736</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">88</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">2736</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">2806</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">89</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">2806</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">2869</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">90</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">2869</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">2966</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">91</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">2966</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">3071</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">92</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">3071</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">3177</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">93</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">3177</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">3292</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">94</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">3292</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">3431</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">95</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">3431</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">3594</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">96</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">3594</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">3774</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">97</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">3774</span> <span class="token operator">&amp;</span> v3<span class="token operator">&lt;=</span><span class="token number">4571</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">98</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v3<span class="token operator">&gt;</span><span class="token number">4571</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v3_bin<span class="token operator">&lt;-</span><span class="token number">99</span>
detach<span class="token punctuation">(</span>test_set<span class="token punctuation">)</span>

test_set<span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span>c<span class="token punctuation">(</span>rep<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>nrow<span class="token punctuation">(</span>test_set<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
attach<span class="token punctuation">(</span>test_set<span class="token punctuation">)</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&lt;=</span><span class="token number">1022.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">0</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">779</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">1022.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">1</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">1022.5</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">1209</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">2</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">1209</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">1374.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">3</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">1374.5</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">1544</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">4</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">1544</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">1662</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">5</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">1662</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">1833</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">6</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">1833</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">1988.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">7</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">1988.5</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">2147</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">8</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">2147</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">2296</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">9</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">2296</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">2477</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">10</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">2477</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">2640</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">11</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">2640</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">2778</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">12</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">2778</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">2900</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">13</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">2900</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">3043</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">14</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">3043</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">3200</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">15</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">3200</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">3345</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">16</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">3345</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">3457</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">17</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">3457</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">3640</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">18</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">3640</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">3775</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">19</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">3775</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">3920</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">20</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">3920</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">4051</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">21</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">4051</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">4150</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">22</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">4150</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">4287</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">23</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">4287</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">4438</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">24</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">4438</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">4584</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">25</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">4584</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">4720</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">26</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">4720</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">4831</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">27</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">4831</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">5005</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">28</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">5005</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">5132</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">29</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">5132</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">5245</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">30</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">5245</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">5360</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">31</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">5360</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">5500</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">32</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">5500</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">5646</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">33</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">5646</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">5781</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">34</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">5781</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">5890</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">35</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">5890</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">6011</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">36</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">6011</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">6128</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">37</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">6128</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">6289.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">38</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">6289.5</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">6428</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">39</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">6428</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">6570</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">40</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">6570</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">6715</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">41</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">6715</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">6865</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">42</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">6865</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">7027</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">43</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">7027</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">7200</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">44</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">7200</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">7362</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">45</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">7362</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">7495</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">46</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">7495</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">7671</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">47</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">7671</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">7842</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">48</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">7842</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">7999</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">49</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">7999</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">8165</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">50</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">8165</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">8371</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">51</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">8371</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">8545</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">52</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">8545</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">8760</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">53</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">8760</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">8960</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">54</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">8960</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">9164.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">55</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">9164.5</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">9378</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">56</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">9378</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">9570</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">57</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">9570</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">9766</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">58</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">9766</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">9973</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">59</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">9973</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">10160</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">60</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">10160</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">10363</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">61</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">10363</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">10609</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">62</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">10609</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">10921</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">63</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">10921</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">11228</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">64</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">11228</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">11530</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">65</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">11530</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">11836</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">66</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">11836</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">12120</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">67</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">12120</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">12382</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">68</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">12382</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">12690</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">69</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">12690</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">12992</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">70</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">12992</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">13304</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">71</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">13304</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">13730</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">72</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">13730</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">14150</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">73</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">14150</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">14703</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">74</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">14703</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">15220</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">75</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">15220</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">15730</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">76</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">15730</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">16286</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">77</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">16286</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">16873</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">78</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">16873</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">17370</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">79</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">17370</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">17985</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">80</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">17985</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">18564</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">81</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">18564</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">19229</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">82</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">19229</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">20162</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">83</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">20162</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">21154</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">84</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">21154</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">21875</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">85</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">21875</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">22882</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">86</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">22882</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">23912</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">87</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">23912</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">25067</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">88</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">25067</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">26631</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">89</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">26631</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">28411</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">90</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">28411</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">30741</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">91</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">30741</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">33084</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">92</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">33084</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">36639</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">93</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">36639</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">41240</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">94</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">41240</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">46406</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">95</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">46406</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">54879</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">96</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">54879</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">67686</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">97</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">67686</span> <span class="token operator">&amp;</span> v13<span class="token operator">&lt;=</span><span class="token number">98286</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">98</span>
test_set<span class="token punctuation">[</span>which<span class="token punctuation">(</span>v13<span class="token operator">&gt;</span><span class="token number">98286</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">$</span>v13_bin<span class="token operator">&lt;-</span><span class="token number">99</span>
detach<span class="token punctuation">(</span>test_set<span class="token punctuation">)</span>
<span class="token comment">#将原始变量用训练集上WOE值替换</span>
test_set<span class="token operator">&lt;-</span>test_set<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token operator">-</span>which<span class="token punctuation">(</span>names<span class="token punctuation">(</span>test_set<span class="token punctuation">)</span><span class="token operator">==</span><span class="token string">"v3"</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
test_set<span class="token operator">&lt;-</span>test_set<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token operator">-</span>which<span class="token punctuation">(</span>names<span class="token punctuation">(</span>test_set<span class="token punctuation">)</span><span class="token operator">==</span><span class="token string">"v13"</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
</code></pre> 
<p>2、验证数据集Lift图</p> 
<pre><code class="prism language-r">pre<span class="token operator">=</span>predict<span class="token punctuation">(</span>glm_fit<span class="token punctuation">,</span>test_set<span class="token punctuation">,</span>type<span class="token operator">=</span><span class="token string">"response"</span><span class="token punctuation">)</span>  <span class="token comment">#用模型对测试数据进行预测</span>
<span class="token comment">#测试集真实值</span>
true_value<span class="token operator">&lt;-</span>test_set<span class="token operator">$</span>flag

<span class="token comment">#lift曲线</span>
<span class="token comment">######################################################################</span>
<span class="token comment">#函数功能：画出lift图</span>
<span class="token comment">#参数说明：pre.p：预测值（概率）、true_value：真实值</span>
lift_fun<span class="token operator">&lt;-</span><span class="token keyword">function</span><span class="token punctuation">(</span>pre.p<span class="token punctuation">,</span>true_value<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	ntot<span class="token operator">&lt;-</span>length<span class="token punctuation">(</span>true_value<span class="token punctuation">)</span>
	apr<span class="token operator">&lt;-</span>sum<span class="token punctuation">(</span>true_value<span class="token punctuation">)</span><span class="token operator">/</span>ntot
    min_pre<span class="token operator">&lt;-</span>min<span class="token punctuation">(</span>pre.p<span class="token punctuation">)</span>
    max_pre<span class="token operator">&lt;-</span>max<span class="token punctuation">(</span>pre.p<span class="token punctuation">)</span>
    plevel<span class="token operator">&lt;-</span>seq<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>max_pre<span class="token punctuation">,</span>by<span class="token operator">=</span><span class="token number">0.001</span><span class="token punctuation">)</span>
	  depth<span class="token operator">&lt;-</span>c<span class="token punctuation">(</span><span class="token punctuation">)</span>
	  lift<span class="token operator">&lt;-</span>c<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">in</span> plevel<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	     predicted<span class="token operator">=</span><span class="token number">1</span><span class="token operator">*</span><span class="token punctuation">(</span>pre.p<span class="token operator">&gt;</span>i<span class="token punctuation">)</span> 
       depthi<span class="token operator">&lt;-</span>sum<span class="token punctuation">(</span>predicted<span class="token punctuation">)</span><span class="token operator">/</span>ntot
       <span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    	  lifti<span class="token operator">=</span><span class="token number">0</span>
       <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
    	  lifti<span class="token operator">&lt;-</span><span class="token punctuation">(</span>sum<span class="token punctuation">(</span>true_value <span class="token operator">&amp;</span> predicted<span class="token punctuation">)</span><span class="token operator">/</span>sum<span class="token punctuation">(</span>predicted<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span>apr
       <span class="token punctuation">}</span>
    
      depth<span class="token operator">&lt;-</span>c<span class="token punctuation">(</span>depth<span class="token punctuation">,</span>depthi<span class="token punctuation">)</span>
      lift<span class="token operator">&lt;-</span>c<span class="token punctuation">(</span>lift<span class="token punctuation">,</span>lifti<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    plot<span class="token punctuation">(</span>depth<span class="token punctuation">,</span>lift<span class="token punctuation">,</span>type<span class="token operator">=</span><span class="token string">'l'</span><span class="token punctuation">,</span>main<span class="token operator">=</span><span class="token string">'lift曲线'</span><span class="token punctuation">)</span>
    return<span class="token punctuation">(</span>list<span class="token punctuation">(</span>depth<span class="token punctuation">,</span>lift<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

lift_fun<span class="token punctuation">(</span>pre<span class="token punctuation">,</span>true_value<span class="token punctuation">)</span>   <span class="token comment">##画出Lift图</span>
</code></pre> 
<p>营销策略类模型重点关注Lift<br> 3、验证集混淆矩阵、精准度等指标</p> 
<pre><code class="prism language-r"><span class="token comment">######################################################################</span>
<span class="token comment">#函数功能：计算准确率、精准率、召回率、F1值</span>
<span class="token comment">#参数说明：pre.p：预测值（概率）、true_value：真实值、plevel：预测概率的阀值</span>
conf_index<span class="token operator">&lt;-</span><span class="token keyword">function</span><span class="token punctuation">(</span>pre.d<span class="token punctuation">,</span>true_value<span class="token punctuation">,</span>plevel<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	predicted<span class="token operator">&lt;-</span><span class="token number">1</span><span class="token operator">*</span><span class="token punctuation">(</span>pre.d<span class="token operator">&gt;</span>plevel<span class="token punctuation">)</span>
    conf_matrix<span class="token operator">&lt;-</span>table<span class="token punctuation">(</span>true_value<span class="token punctuation">,</span>predicted<span class="token punctuation">)</span> 	<span class="token comment">#混淆矩阵</span>
    tp<span class="token operator">&lt;-</span>sum<span class="token punctuation">(</span>true_value <span class="token operator">&amp;</span> predicted<span class="token punctuation">)</span>      <span class="token comment">#正确预测到的响应的数量</span>
    pp<span class="token operator">&lt;-</span>sum<span class="token punctuation">(</span>predicted<span class="token punctuation">)</span>      <span class="token comment">#预测的响应个数</span>
    ap<span class="token operator">&lt;-</span>sum<span class="token punctuation">(</span>true_value<span class="token punctuation">)</span>    <span class="token comment">#实际上响应的个数</span>
    totn<span class="token operator">&lt;-</span>length<span class="token punctuation">(</span>true_value<span class="token punctuation">)</span>      <span class="token comment">#总数n</span>
    precision<span class="token operator">&lt;-</span>tp<span class="token operator">/</span>pp         <span class="token comment">#命中率precision</span>
    recall<span class="token operator">&lt;-</span>tp<span class="token operator">/</span>ap        <span class="token comment">#覆盖率（召回率）recall</span>
    accuracy<span class="token operator">&lt;-</span>sum<span class="token punctuation">(</span>true_value<span class="token operator">==</span>predicted<span class="token punctuation">)</span><span class="token operator">/</span>totn        <span class="token comment">#准确率</span>
    F_measure<span class="token operator">=</span><span class="token number">2</span><span class="token operator">*</span>precision<span class="token operator">*</span>recall<span class="token operator">/</span><span class="token punctuation">(</span>precision<span class="token operator">+</span>recall<span class="token punctuation">)</span>        <span class="token comment">#F值</span>
    return<span class="token punctuation">(</span>list<span class="token punctuation">(</span>conf_matrix<span class="token operator">=</span>conf_matrix<span class="token punctuation">,</span>accuracy<span class="token operator">=</span>accuracy<span class="token punctuation">,</span>precision<span class="token operator">=</span>precision<span class="token punctuation">,</span>recall<span class="token operator">=</span>recall<span class="token punctuation">,</span>F1_score<span class="token operator">=</span>F_measure<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
conf_index<span class="token punctuation">(</span>pre<span class="token punctuation">,</span>true_value<span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">)</span>    <span class="token comment">##plevel取0.5（若p&gt;0.5，则预测其响应）</span>
</code></pre> 
<p>分析结果表明，该模型在验证集上的准确率为87.86%、精确率82.64%，F1值为80.93%，整体效果较好。<br> 通过建立统计模型，用未来用户可能购买的概率给用户打上标签，进行等级分类，营销人员可以以此作为分群营销的依据。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e7d72d936b1907c75f6000d751c5a726/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Kotlin协程的JVM实现源码分析（下）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/78871b3f242bbdb5e0c500d0691c7afe/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">看书标记【R语言数据分析项目精解：理论、方法、实战 9】</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>