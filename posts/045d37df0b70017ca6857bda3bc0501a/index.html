<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Flink窗口函数 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Flink窗口函数" />
<meta property="og:description" content="1.什么是窗口函数 Flink窗口函数是指对数据流中的数据进行分组和聚合操作的函数。
FlinkSQL支持对一个特定的窗口的聚合。例如有用户想统计在过去的1分钟内有多少用户点击了某个的网页。在这种情况下，我们可以定义一个窗口，用来收集最近一分钟内的数据，并对这个窗口内的数据进行计算。
在Flink中，窗口函数可以分为两种类型：时间窗口和计数窗口。时间窗口是指按照时间对数据流进行分组和聚合操作。计数窗口是指按照数据条数对数据流进行分组和聚合操作。
FlinkSQL支持的窗口聚合主要是两种：window aggregate和over aggregate。他们最核心的区别是over aggregate从语义上保障了对每个输入都有一个输出，因此over agregate常被用于ranking，moving average等场景。
Window aggregate支持两种时间类型做窗口：Event Time和Processing Time。每种类型下，又分别支持三种窗口类型：滚动窗口（TUMBLE），滑动窗口（HOP）和会话窗口（SESSION）。
2.时间类型 BlinkSQL支持两种时间：
Event Time：用户提供的事件时间(通常是数据的最原始的创建时间)，event time一定是用户提供在表的schema里的数据Processing Time：表示系统对事件进行处理的本地系统时间 具体见上篇文章。Flink时间属性_土豆马铃薯的博客-CSDN博客
3.实时计算中的窗口类型 3.1滚动窗口（Tumble Window） 滚动窗口将每个元素分配到一个指定窗口大小的窗口中，滚动窗口有一个固定的大小，并且不会出现重叠。例如：如果指定了一个5分钟大小的滚动窗口，那么无限流的数据会根据时间划分成[0:00 - 0:05), [0:05, 0:10),[0:10, 0:15)... 等窗口。如下图展示了一个 30秒大小的滚动窗口划分。
函数语法：用在GROUP BY子句中，定义window。
TUMBLE(time_attr, size_interval)
说明：
1. time_attr：参数必须是流中的一个合法的时间属性字段，即指定了 processing time 或是 event time；
2. size_interval：窗口时间间隔； 使用案例：
INSERT INTO dts_ds_merchant_target SELECT SUM(buy_amount) AS totalsale, TUMBLE_START(ROWTIME, INTERVAL &#39;10&#39; SECOND) AS tms, TUMBLE_END(ROWTIME, INTERVAL &#39;1&#39; SECOND) AS tme FROM dts_ds_merchant_source GROUP BY tumble(ROWTIME, INTERVAL &#39;1&#39; SECOND) 3." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/045d37df0b70017ca6857bda3bc0501a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-06-01T16:37:50+08:00" />
<meta property="article:modified_time" content="2023-06-01T16:37:50+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Flink窗口函数</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>1.什么是窗口函数</h2> 
<p>Flink窗口函数是指对数据流中的数据进行分组和聚合操作的函数。</p> 
<p>FlinkSQL支持对一个特定的窗口的聚合。例如有用户想统计在过去的1分钟内有多少用户点击了某个的网页。在这种情况下，我们可以定义一个窗口，用来收集最近一分钟内的数据，并对这个窗口内的数据进行计算。</p> 
<p>在Flink中，窗口函数可以分为两种类型：时间窗口和计数窗口。时间窗口是指按照时间对数据流进行分组和聚合操作。计数窗口是指按照数据条数对数据流进行分组和聚合操作。</p> 
<p>FlinkSQL支持的窗口聚合主要是两种：window aggregate和over aggregate。他们最核心的区别是over aggregate从语义上保障了对每个输入都有一个输出，因此over agregate常被用于ranking，moving average等场景。</p> 
<p>Window aggregate支持两种时间类型做窗口：Event Time和Processing Time。每种类型下，又分别支持三种窗口类型：滚动窗口（TUMBLE），滑动窗口（HOP）和会话窗口（SESSION）。</p> 
<h2>2.时间类型</h2> 
<p>BlinkSQL支持两种时间：</p> 
<ul><li>Event Time：用户提供的事件时间(通常是数据的最原始的创建时间)，event time一定是用户提供在表的schema里的数据</li><li>Processing Time：表示系统对事件进行处理的本地系统时间</li></ul> 
<p>具体见上篇文章。<a href="https://blog.csdn.net/marui156/article/details/130151804" title="Flink时间属性_土豆马铃薯的博客-CSDN博客">Flink时间属性_土豆马铃薯的博客-CSDN博客</a></p> 
<h2>3.实时计算中的窗口类型</h2> 
<h3>3.1滚动窗口（Tumble Window）</h3> 
<p>滚动窗口将每个元素分配到一个指定窗口大小的窗口中，滚动窗口有一个固定的大小，并且不会出现重叠。例如：如果指定了一个5分钟大小的滚动窗口，那么无限流的数据会根据时间划分成[0:00 - 0:05), [0:05, 0:10),[0:10, 0:15)... 等窗口。如下图展示了一个 30秒大小的滚动窗口划分。</p> 
<p><img alt="" height="1008" src="https://images2.imgbox.com/4a/97/EBSV28AE_o.png" width="1200"></p> 
<p><strong>函数语法：</strong>用在GROUP BY子句中，定义window。<br>         TUMBLE(time_attr, size_interval)</p> 
<p>说明：</p> 
<p>1. time_attr：参数必须是流中的一个合法的时间属性字段，即指定了 processing time 或是 event time；<br> 2. size_interval：窗口时间间隔； </p> 
<p><strong>使用案例：</strong></p> 
<pre><code class="language-sql">INSERT INTO dts_ds_merchant_target
SELECT 
    SUM(buy_amount) AS totalsale,
    TUMBLE_START(ROWTIME, INTERVAL '10' SECOND) AS tms,
    TUMBLE_END(ROWTIME, INTERVAL '1' SECOND) AS tme
FROM dts_ds_merchant_source
GROUP BY tumble(ROWTIME, INTERVAL '1' SECOND)</code></pre> 
<h3>3.2滑动窗口（Slide Window）</h3> 
<p>定义一个跳跃的时间窗口（在 Table API 中称为滑动窗口）。滑动窗口有一个固定的持续时间（ 第二个interval 参数 ）以及一个滑动的间隔（第一个 interval 参数 ）。若滑动间隔小于窗口的持续时间，滑动窗口则会出现重叠；因此，行将会被分配到多个窗口中。比如，一个大小为 15 分组的滑动窗口，其滑动间隔为 5 分钟，将会把每一行数据分配到 3 个 15 分钟的窗口中。滑动窗口可以定义在事件时间（批处理、流处理）或处理时间（流处理）上。</p> 
<p><img alt="" height="1153" src="https://images2.imgbox.com/67/db/hfHvyvVT_o.png" width="1200"></p> 
<p><strong>函数语法：</strong>用在GROUP BY子句中，定义window。<br>         HOP(time_attr, slide_interval, size_interval)</p> 
<p></p> 
<p>说明：</p> 
<p>1. time_attr：参数必须是流中的一个合法的时间属性字段，即指定了 processing time 或是 event time；<br> 2. slide_interval：滑动窗口的滑动时间间隔；<br> 3. size_interval：滑动窗口的固定时间间隔； </p> 
<p><strong>使用案例：</strong></p> 
<pre><code class="language-sql">INSERT INTO dts_ds_slide_target
SELECT 
    SUM(buy_amount) AS totalsale,
    HOP_START(ROWTIME, INTERVAL '30' SECOND ,INTERVAL '5' MINUTE ) as hops,
    HOP_END(ROWTIME, INTERVAL '30' SECOND ,INTERVAL '5'MINUTE ) as hope
FROM dts_ds_merchant_source
GROUP BY HOP(ROWTIME, INTERVAL '30' SECOND ,INTERVAL '5' MINUTE )</code></pre> 
<h3>3.3会话窗口（Session Window）</h3> 
<p>定义一个会话时间窗口。会话时间窗口没有一个固定的持续时间，但是它们的边界会根据 interval 所定义的不活跃时间所确定；即一个会话时间窗口在定义的间隔时间内没有时间出现，该窗口会被关闭。例如时间窗口的间隔时间是 30 分钟，当其不活跃的时间达到30分钟后，若观测到新的记录，则会启动一个新的会话时间窗口（否则该行数据会被添加到当前的窗口），且若在 30 分钟内没有观测到新纪录，这个窗口将会被关闭。会话时间窗口可以使用事件时间（批处理、流处理）或处理时间（流处理）。</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/56/eb/Z2Kq5pMZ_o.png" width="1200"></p> 
<p></p> 
<p><strong>函数语法：</strong>用在GROUP BY子句中，定义window。<br>         SESSION(time_attr, interval)</p> 
<p>说明：</p> 
<p>1. time_attr：参数必须是流中的一个合法的时间属性字段，即指定了 processing time 或是 event time；<br> 2. interval：会话窗口的gap时间间隔； </p> 
<p><strong>使用案例：</strong></p> 
<pre><code class="language-sql">NSERT INTO dts_ds_session_target
SELECT 
    id as id,
    SUM(buy_amount) AS totalsale,
    SESSION_START(ROWTIME, INTERVAL '10' SECOND ) as sws,
    SESSION_END(ROWTIME, INTERVAL '10' SECOND ) as swe
FROM dts_ds_merchant_source
GROUP BY id,SESSION(ROWTIME, INTERVAL '10' SECOND )</code></pre> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0a9aa04b3c2f8808f032e5cfe454bbbf/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">ArgoWorkflow Lifecycle-Hook</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/57ac43325126b59d8d49e619fe23eb29/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【SVN】银河麒麟（Kylin V10）操作系统下使用SVN</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>