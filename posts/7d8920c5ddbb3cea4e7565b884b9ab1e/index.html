<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Docker本地搭建Hadoop高可用,Hbase,Spark,Flink,Zookeeper集群 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Docker本地搭建Hadoop高可用,Hbase,Spark,Flink,Zookeeper集群" />
<meta property="og:description" content="欢迎关注微信公众号：小满锅 前期准备 安装docker yum安装 #安装 Docker $ yum -y install docker #启动 Docker 后台服务 $ service docker start 脚本安装 $ sudo yum update $ curl -fsSL https://get.docker.com -o get-docker.sh # 执行这个脚本会添加 docker.repo 源并安装 Docker。 $ sudo sh get-docker.sh 安装docker-compose # 获取脚本 $ curl -L https://github.com/docker/compose/releases/download/1.25.0-rc2/docker-compose-`uname -s`-`uname -m` -o /usr/local/bin/docker-compose # 赋予执行权限 $chmod &#43;x /usr/local/bin/docker-compose 镜像加速 打开/创建 /etc/docker/daemon.json 文件，添加以下内容：
{ &#34;registry-mirrors&#34;: [&#34;http://hub-mirror.c.163.com&#34;] } 搭建基本容器镜像 #镜像拉取 docker pull centos7 #创建一个容器，作为基础容器，后期制作为镜像 docker run -it --name hadoopimages centos /bin/bash #将scala和jdk的包拷贝到容器里 docker cp scala-2." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/7d8920c5ddbb3cea4e7565b884b9ab1e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-05-15T20:09:29+08:00" />
<meta property="article:modified_time" content="2022-05-15T20:09:29+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Docker本地搭建Hadoop高可用,Hbase,Spark,Flink,Zookeeper集群</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-dracula">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><img src="https://images2.imgbox.com/41/7e/gSxnbtBt_o.jpg" alt="在这里插入图片描述"></p> 
<h2><a id="httpsmpweixinqqcomsGeCEuy6oEoQ9RfxVDBntA_3"></a>欢迎关注微信公众号：<a href="https://mp.weixin.qq.com/s/GeCEuy-6oEoQ9RfxVDBntA" rel="nofollow">小满锅</a></h2> 
<h2><a id="_5"></a>前期准备</h2> 
<hr> 
<h4><a id="docker_7"></a>安装docker</h4> 
<h6><a id="yum_8"></a>yum安装</h6> 
<pre><code class="prism language-bash"><span class="token comment">#安装 Docker</span>
$ yum -y <span class="token function">install</span> <span class="token function">docker</span>
<span class="token comment">#启动 Docker 后台服务</span>
$ <span class="token function">service</span> <span class="token function">docker</span> start
</code></pre> 
<h6><a id="_15"></a>脚本安装</h6> 
<pre><code class="prism language-bash">$ <span class="token function">sudo</span> yum update
$ <span class="token function">curl</span> -fsSL https://get.docker.com -o get-docker.sh
<span class="token comment"># 执行这个脚本会添加 docker.repo 源并安装 Docker。</span>
$ <span class="token function">sudo</span> <span class="token function">sh</span> get-docker.sh
</code></pre> 
<hr> 
<h4><a id="dockercompose_23"></a>安装docker-compose</h4> 
<pre><code class="prism language-bash"><span class="token comment"># 获取脚本</span>
$ <span class="token function">curl</span> -L https://github.com/docker/compose/releases/download/1.25.0-rc2/docker-compose-<span class="token variable"><span class="token variable">`</span><span class="token function">uname</span> -s<span class="token variable">`</span></span>-<span class="token variable"><span class="token variable">`</span><span class="token function">uname</span> -m<span class="token variable">`</span></span> -o /usr/local/bin/docker-compose
<span class="token comment"># 赋予执行权限</span>
<span class="token variable">$chmod</span> +x /usr/local/bin/docker-compose
</code></pre> 
<hr> 
<h4><a id="_32"></a>镜像加速</h4> 
<p>打开/创建 /etc/docker/daemon.json 文件，添加以下内容：</p> 
<pre><code class="prism language-bash"><span class="token punctuation">{<!-- --></span>
  <span class="token string">"registry-mirrors"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">"http://hub-mirror.c.163.com"</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> 
<hr> 
<h4><a id="_41"></a>搭建基本容器镜像</h4> 
<pre><code class="prism language-bash"><span class="token comment">#镜像拉取</span>
<span class="token function">docker</span> pull centos7
<span class="token comment">#创建一个容器，作为基础容器，后期制作为镜像</span>
<span class="token function">docker</span> run -it --name hadoopimages centos /bin/bash
<span class="token comment">#将scala和jdk的包拷贝到容器里</span>
<span class="token function">docker</span> <span class="token function">cp</span> scala-2.11.12.tgz hadoopimages:/
<span class="token function">docker</span> <span class="token function">cp</span> jdk-8u201-linux-x64.tar.gz hadoopimages:/
<span class="token comment">#进入容器</span>
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> -it hadoopimages /bin/bash

</code></pre> 
<p><strong>然后将jdk和scala上传到docker</strong><br> <img src="https://images2.imgbox.com/e2/4c/23PcX0DA_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="JAVA_57"></a>配置JAVA环境变量</h6> 
<p><img src="https://images2.imgbox.com/c6/91/E7g8PQ0P_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/97/cc/3NXXr875_o.png" alt="在这里插入图片描述"><br> <strong>小问题：这里可能会有退出容器后环境变量失效的问题，可以将环境变量配置在～/.bashrc文件或者使用DockerFile方式</strong></p> 
<pre><code class="prism language-bash">yum <span class="token function">install</span> net-tools
yum <span class="token function">install</span> openssh-server
yum -y <span class="token function">install</span> openssh-clients
</code></pre> 
<pre><code class="prism language-bash"><span class="token comment">#提交容器为镜像</span>
<span class="token comment">#docker commit 容器名字或者id 自己要定义的镜像名</span>
<span class="token function">docker</span> commit hadoopimages hadoop
<span class="token comment">#查看一下镜像</span>
<span class="token function">docker</span> images
</code></pre> 
<p><img src="https://images2.imgbox.com/08/49/GNcyBD8k_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="bigdata_77"></a>创建网络bigdata，供各种大数据应用共同一个网络</h4> 
<p><strong>这里指定的是172.25.0.0/16子网，注意不要和自己的其他子网相冲突，以免一些不必要的麻烦</strong></p> 
<pre><code class="prism language-bash"><span class="token function">docker</span> network create --driver bridge --subnet <span class="token number">172.25</span>.0.0/16 --gateway <span class="token number">172.25</span>.0.1 bigdata
</code></pre> 
<hr> 
<h2><a id="Zookeeper_85"></a>Zookeeper搭建</h2> 
<hr> 
<h6><a id="zookeeper_87"></a>拉取zookeeper镜像</h6> 
<pre><code class="prism language-bash"><span class="token comment">#选取自己合适的镜像即可</span>
<span class="token function">docker</span> pull zookeeper:3.4.13
</code></pre> 
<h5><a id="dockercomposezookeeper_93"></a>使用docker-compose创建三个zookeeper容器</h5> 
<pre><code class="prism language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'2'</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">zoo1</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> zookeeper<span class="token punctuation">:</span>3.4.13 <span class="token comment"># 镜像名称</span>
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always <span class="token comment"># 当发生错误时自动重启</span>
    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> zoo1
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> zoo1
    <span class="token key atrule">privileged</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">ports</span><span class="token punctuation">:</span> <span class="token comment"># 端口</span>
      <span class="token punctuation">-</span> 2181<span class="token punctuation">:</span><span class="token number">2181</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span> <span class="token comment"># 挂载数据卷</span>
      <span class="token punctuation">-</span> ./zoo1/data<span class="token punctuation">:</span>/data
      <span class="token punctuation">-</span> ./zoo1/datalog<span class="token punctuation">:</span>/datalog
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token key atrule">TZ</span><span class="token punctuation">:</span> Asia/Shanghai
      <span class="token key atrule">ZOO_MY_ID</span><span class="token punctuation">:</span> <span class="token number">1</span> <span class="token comment"># 节点ID</span>
      <span class="token key atrule">ZOO_PORT</span><span class="token punctuation">:</span> <span class="token number">2181</span> <span class="token comment"># zookeeper端口号</span>
      <span class="token key atrule">ZOO_SERVERS</span><span class="token punctuation">:</span> server.1=zoo1<span class="token punctuation">:</span>2888<span class="token punctuation">:</span>3888 server.2=zoo2<span class="token punctuation">:</span>2888<span class="token punctuation">:</span>3888 server.3=zoo3<span class="token punctuation">:</span>2888<span class="token punctuation">:</span><span class="token number">3888</span> <span class="token comment"># zookeeper节点列表</span>
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token key atrule">default</span><span class="token punctuation">:</span>
        <span class="token key atrule">ipv4_address</span><span class="token punctuation">:</span> 172.25.0.11


  <span class="token key atrule">zoo2</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> zookeeper<span class="token punctuation">:</span>3.4.13
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> zoo2
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> zoo2
    <span class="token key atrule">privileged</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> 2182<span class="token punctuation">:</span><span class="token number">2181</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ./zoo2/data<span class="token punctuation">:</span>/data
      <span class="token punctuation">-</span> ./zoo2/datalog<span class="token punctuation">:</span>/datalog
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token key atrule">TZ</span><span class="token punctuation">:</span> Asia/Shanghai
      <span class="token key atrule">ZOO_MY_ID</span><span class="token punctuation">:</span> <span class="token number">2</span>
      <span class="token key atrule">ZOO_PORT</span><span class="token punctuation">:</span> <span class="token number">2181</span>
      <span class="token key atrule">ZOO_SERVERS</span><span class="token punctuation">:</span> server.1=zoo1<span class="token punctuation">:</span>2888<span class="token punctuation">:</span>3888 server.2=zoo2<span class="token punctuation">:</span>2888<span class="token punctuation">:</span>3888 server.3=zoo3<span class="token punctuation">:</span>2888<span class="token punctuation">:</span><span class="token number">3888</span>
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token key atrule">default</span><span class="token punctuation">:</span>
        <span class="token key atrule">ipv4_address</span><span class="token punctuation">:</span> 172.25.0.12

  <span class="token key atrule">zoo3</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> zookeeper<span class="token punctuation">:</span>3.4.13
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> zoo3
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> zoo3
    <span class="token key atrule">privileged</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
   	 <span class="token punctuation">-</span> 2183<span class="token punctuation">:</span><span class="token number">2181</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ./zoo3/data<span class="token punctuation">:</span>/data
      <span class="token punctuation">-</span> ./zoo3/datalog<span class="token punctuation">:</span>/datalog
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token key atrule">TZ</span><span class="token punctuation">:</span> Asia/Shanghai
      <span class="token key atrule">ZOO_MY_ID</span><span class="token punctuation">:</span> <span class="token number">3</span>
      <span class="token key atrule">ZOO_PORT</span><span class="token punctuation">:</span> <span class="token number">2181</span>
      <span class="token key atrule">ZOO_SERVERS</span><span class="token punctuation">:</span> server.1=zoo1<span class="token punctuation">:</span>2888<span class="token punctuation">:</span>3888 server.2=zoo2<span class="token punctuation">:</span>2888<span class="token punctuation">:</span>3888 server.3=zoo3<span class="token punctuation">:</span>2888<span class="token punctuation">:</span><span class="token number">3888</span>
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token key atrule">default</span><span class="token punctuation">:</span>
        <span class="token key atrule">ipv4_address</span><span class="token punctuation">:</span> 172.25.0.13

<span class="token key atrule">networks</span><span class="token punctuation">:</span>
  <span class="token key atrule">default</span><span class="token punctuation">:</span>
    <span class="token key atrule">external</span><span class="token punctuation">:</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> bigdata
</code></pre> 
<pre><code class="prism language-bash"><span class="token comment">#运行命令</span>
<span class="token function">docker-compose</span> up -d
➜  zookeeper <span class="token function">docker-compose</span> up -d
Recreating 44dad6cddccd_zoo1 <span class="token punctuation">..</span>. <span class="token keyword">done</span>
Recreating 9b0f2cfe666f_zoo3 <span class="token punctuation">..</span>. <span class="token keyword">done</span>
Creating zoo2                <span class="token punctuation">..</span>. <span class="token keyword">done</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/0d/7c/pLRfojFJ_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/3d/42/HEvrKmF2_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<h2><a id="Kafka_178"></a>Kafka集群搭建</h2> 
<hr> 
<pre><code class="prism language-bash"><span class="token comment">#拉取Kafka镜像和kafka-manager镜像</span>
<span class="token function">docker</span> pull wurstmeister/kafka:2.12-2.3.1
<span class="token function">docker</span> pull sheepkiller/kafka-manager

</code></pre> 
<h6><a id="dockercomposeyml_188"></a>编辑docker-compose.yml文件</h6> 
<pre><code class="prism language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'2'</span>

<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">broker1</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> wurstmeister/kafka<span class="token punctuation">:</span>2.12<span class="token punctuation">-</span>2.3.1
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always  <span class="token comment"># 出现错误时自动重启</span>
    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> broker1<span class="token comment"># 节点主机</span>
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> broker1 <span class="token comment"># 节点名称</span>
    <span class="token key atrule">privileged</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token comment"># 可以在容器里面使用一些权限</span>
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"9091:9092"</span>   <span class="token comment"># 将容器的9092端口映射到宿主机的9091端口上</span>
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token key atrule">KAFKA_BROKER_ID</span><span class="token punctuation">:</span> <span class="token number">1</span>
      <span class="token key atrule">KAFKA_LISTENERS</span><span class="token punctuation">:</span> PLAINTEXT<span class="token punctuation">:</span>//broker1<span class="token punctuation">:</span><span class="token number">9092</span>
      <span class="token key atrule">KAFKA_ADVERTISED_LISTENERS</span><span class="token punctuation">:</span> PLAINTEXT<span class="token punctuation">:</span>//broker1<span class="token punctuation">:</span><span class="token number">9092</span>
      <span class="token key atrule">KAFKA_ADVERTISED_HOST_NAME</span><span class="token punctuation">:</span> broker1
      <span class="token key atrule">KAFKA_ADVERTISED_PORT</span><span class="token punctuation">:</span> <span class="token number">9092</span>
      <span class="token key atrule">KAFKA_ZOOKEEPER_CONNECT</span><span class="token punctuation">:</span> zoo1<span class="token punctuation">:</span>2181/kafka1<span class="token punctuation">,</span>zoo2<span class="token punctuation">:</span>2181/kafka1<span class="token punctuation">,</span>zoo3<span class="token punctuation">:</span>2181/kafka1
      <span class="token key atrule">JMX_PORT</span><span class="token punctuation">:</span> <span class="token number">9988</span>   <span class="token comment"># 负责kafkaManager的端口JMX通信</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> /var/run/docker.sock<span class="token punctuation">:</span>/var/run/docker.sock
      <span class="token punctuation">-</span> ./broker1<span class="token punctuation">:</span>/kafka/kafka\<span class="token punctuation">-</span>logs\<span class="token punctuation">-</span>broker1
    <span class="token key atrule">external_links</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> zoo1
    <span class="token punctuation">-</span> zoo2
    <span class="token punctuation">-</span> zoo3
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token key atrule">default</span><span class="token punctuation">:</span>
        <span class="token key atrule">ipv4_address</span><span class="token punctuation">:</span> 172.25.0.14
  
  <span class="token key atrule">broker2</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> wurstmeister/kafka<span class="token punctuation">:</span>2.12<span class="token punctuation">-</span>2.3.1
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> broker2
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> broker2
    <span class="token key atrule">privileged</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"9092:9092"</span>
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token key atrule">KAFKA_BROKER_ID</span><span class="token punctuation">:</span> <span class="token number">2</span>
      <span class="token key atrule">KAFKA_LISTENERS</span><span class="token punctuation">:</span> PLAINTEXT<span class="token punctuation">:</span>//broker2<span class="token punctuation">:</span><span class="token number">9092</span>
      <span class="token key atrule">KAFKA_ADVERTISED_LISTENERS</span><span class="token punctuation">:</span> PLAINTEXT<span class="token punctuation">:</span>//broker2<span class="token punctuation">:</span><span class="token number">9092</span>
      <span class="token key atrule">KAFKA_ADVERTISED_HOST_NAME</span><span class="token punctuation">:</span> broker2
      <span class="token key atrule">KAFKA_ADVERTISED_PORT</span><span class="token punctuation">:</span> <span class="token number">9092</span>
      <span class="token key atrule">KAFKA_ZOOKEEPER_CONNECT</span><span class="token punctuation">:</span> zoo1<span class="token punctuation">:</span>2181/kafka1<span class="token punctuation">,</span>zoo2<span class="token punctuation">:</span>2181/kafka1<span class="token punctuation">,</span>zoo3<span class="token punctuation">:</span>2181/kafka1
      <span class="token key atrule">JMX_PORT</span><span class="token punctuation">:</span> <span class="token number">9988</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> /var/run/docker.sock<span class="token punctuation">:</span>/var/run/docker.sock
      <span class="token punctuation">-</span> ./broker2<span class="token punctuation">:</span>/kafka/kafka\<span class="token punctuation">-</span>logs\<span class="token punctuation">-</span>broker2
    <span class="token key atrule">external_links</span><span class="token punctuation">:</span>  <span class="token comment"># 连接本compose文件以外的container</span>
    <span class="token punctuation">-</span> zoo1
    <span class="token punctuation">-</span> zoo2
    <span class="token punctuation">-</span> zoo3
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token key atrule">default</span><span class="token punctuation">:</span>
        <span class="token key atrule">ipv4_address</span><span class="token punctuation">:</span> 172.25.0.15
<span class="token key atrule">broker3</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> wurstmeister/kafka<span class="token punctuation">:</span>2.12<span class="token punctuation">-</span>2.3.1
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> broker3
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> broker3
    <span class="token key atrule">privileged</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"9093:9092"</span>
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token key atrule">KAFKA_BROKER_ID</span><span class="token punctuation">:</span> <span class="token number">3</span>
      <span class="token key atrule">KAFKA_LISTENERS</span><span class="token punctuation">:</span> PLAINTEXT<span class="token punctuation">:</span>//broker3<span class="token punctuation">:</span><span class="token number">9092</span>
      <span class="token key atrule">KAFKA_ADVERTISED_LISTENERS</span><span class="token punctuation">:</span> PLAINTEXT<span class="token punctuation">:</span>//broker3<span class="token punctuation">:</span><span class="token number">9092</span>
      <span class="token key atrule">KAFKA_ADVERTISED_HOST_NAME</span><span class="token punctuation">:</span> broker3
      <span class="token key atrule">KAFKA_ADVERTISED_PORT</span><span class="token punctuation">:</span> <span class="token number">9092</span>
      <span class="token key atrule">KAFKA_ZOOKEEPER_CONNECT</span><span class="token punctuation">:</span> zoo1<span class="token punctuation">:</span>2181/kafka1<span class="token punctuation">,</span>zoo2<span class="token punctuation">:</span>2181/kafka1<span class="token punctuation">,</span>zoo3<span class="token punctuation">:</span>2181/kafka1
      <span class="token key atrule">JMX_PORT</span><span class="token punctuation">:</span> <span class="token number">9988</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> /var/run/docker.sock<span class="token punctuation">:</span>/var/run/docker.sock
      <span class="token punctuation">-</span> ./broker3<span class="token punctuation">:</span>/kafka/kafka\<span class="token punctuation">-</span>logs\<span class="token punctuation">-</span>broker3
    <span class="token key atrule">external_links</span><span class="token punctuation">:</span>  <span class="token comment"># 连接本compose文件以外的container</span>
    <span class="token punctuation">-</span> zoo1
    <span class="token punctuation">-</span> zoo2
    <span class="token punctuation">-</span> zoo3
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token key atrule">default</span><span class="token punctuation">:</span>
        <span class="token key atrule">ipv4_address</span><span class="token punctuation">:</span> 172.25.0.16
<span class="token key atrule">kafka-manager</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> sheepkiller/kafka<span class="token punctuation">-</span>manager<span class="token punctuation">:</span>latest
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> kafka<span class="token punctuation">-</span>manager
    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> kafka<span class="token punctuation">-</span>manager
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"9000:9000"</span>
    <span class="token key atrule">links</span><span class="token punctuation">:</span>            <span class="token comment"># 连接本compose文件创建的container</span>
      <span class="token punctuation">-</span> broker1
      <span class="token punctuation">-</span> broker2
      <span class="token punctuation">-</span> broker3
    <span class="token key atrule">external_links</span><span class="token punctuation">:</span>   <span class="token comment"># 连接本compose文件以外的container</span>
      <span class="token punctuation">-</span> zoo1
      <span class="token punctuation">-</span> zoo2
      <span class="token punctuation">-</span> zoo3
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token key atrule">ZK_HOSTS</span><span class="token punctuation">:</span> zoo1<span class="token punctuation">:</span>2181/kafka1<span class="token punctuation">,</span>zoo2<span class="token punctuation">:</span>2181/kafka1<span class="token punctuation">,</span>zoo3<span class="token punctuation">:</span>2181/kafka1
      <span class="token key atrule">KAFKA_BROKERS</span><span class="token punctuation">:</span> broker1<span class="token punctuation">:</span><span class="token number">9092</span><span class="token punctuation">,</span>broker2<span class="token punctuation">:</span><span class="token number">9092</span><span class="token punctuation">,</span>broker3<span class="token punctuation">:</span><span class="token number">9092</span>
      <span class="token key atrule">APPLICATION_SECRET</span><span class="token punctuation">:</span> letmein
      <span class="token key atrule">KM_ARGS</span><span class="token punctuation">:</span> <span class="token punctuation">-</span>Djava.net.preferIPv4Stack=true
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token key atrule">default</span><span class="token punctuation">:</span>
        <span class="token key atrule">ipv4_address</span><span class="token punctuation">:</span> 172.25.0.10

<span class="token key atrule">networks</span><span class="token punctuation">:</span>
  <span class="token key atrule">default</span><span class="token punctuation">:</span>
    <span class="token key atrule">external</span><span class="token punctuation">:</span>   <span class="token comment"># 使用已创建的网络</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> bigdata
</code></pre> 
<pre><code class="prism language-bash"><span class="token comment">#运行命令</span>
<span class="token function">docker-compose</span> up -d

</code></pre> 
<p><img src="https://images2.imgbox.com/9a/a4/Aesrwx7D_o.png" alt="在这里插入图片描述"><br> **看看本地端口9000也确实起来了<br> <img src="https://images2.imgbox.com/71/2c/bIqV0tIf_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/65/08/DG3O2hrN_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<h2><a id="Hadoop_315"></a>Hadoop高可用集群搭建</h2> 
<hr> 
<h4><a id="dockercompose_317"></a>docker-compose创建集群</h4> 
<pre><code class="prism language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'2'</span>

<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">master</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> hadoop<span class="token punctuation">:</span>latest
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always  <span class="token comment"># 出现错误时自动重启</span>
    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> master<span class="token comment"># 节点主机</span>
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> master <span class="token comment"># 节点名称</span>
    <span class="token key atrule">privileged</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token comment"># 可以在容器里面使用一些权限</span>
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token key atrule">default</span><span class="token punctuation">:</span>
        <span class="token key atrule">ipv4_address</span><span class="token punctuation">:</span> 172.25.0.3

  <span class="token key atrule">master_standby</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> hadoop<span class="token punctuation">:</span>latest
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> master_standby
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> master_standby
    <span class="token key atrule">privileged</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token key atrule">default</span><span class="token punctuation">:</span>
        <span class="token key atrule">ipv4_address</span><span class="token punctuation">:</span> 172.25.0.4

  <span class="token key atrule">slave01</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> hadoop<span class="token punctuation">:</span>latest
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> slave01
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> slave01
    <span class="token key atrule">privileged</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token key atrule">default</span><span class="token punctuation">:</span>
        <span class="token key atrule">ipv4_address</span><span class="token punctuation">:</span> 172.25.0.5

  <span class="token key atrule">slave02</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> hadoop<span class="token punctuation">:</span>latest
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> slave02
    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> slave02
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token key atrule">default</span><span class="token punctuation">:</span>
        <span class="token key atrule">ipv4_address</span><span class="token punctuation">:</span> 172.25.0.6
  <span class="token key atrule">slave03</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> hadoop<span class="token punctuation">:</span>latest
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> slave03
    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> slave03
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token key atrule">default</span><span class="token punctuation">:</span>
        <span class="token key atrule">ipv4_address</span><span class="token punctuation">:</span> 172.25.0.7
</code></pre> 
<h4><a id="_370"></a>命令行方式创建</h4> 
<pre><code class="prism language-bash"><span class="token comment">#创建一个master节点</span>
<span class="token function">docker</span> run -tid --name master --privileged<span class="token operator">=</span>true hadoop:latest /usr/sbin/init
<span class="token comment">#创建热备master_standby节点</span>
<span class="token function">docker</span> run -tid --name master_standby --privileged<span class="token operator">=</span>true hadoop:latest /usr/sbin/init
<span class="token comment">#创建三个slave</span>
<span class="token function">docker</span> run -tid --name slave01 --privileged<span class="token operator">=</span>true hadoop:latest /usr/sbin/init
<span class="token function">docker</span> run -tid --name slave02 --privileged<span class="token operator">=</span>true hadoop:latest /usr/sbin/init
<span class="token function">docker</span> run -tid --name slave03 --privileged<span class="token operator">=</span>true hadoop:latest /usr/sbin/init
</code></pre> 
<h4><a id="_382"></a>给每台节点配置免密码登陆</h4> 
<pre><code class="prism language-bash">ssh-keygen -t rsa
<span class="token comment">#然后不断会车，最终如下图所示</span>
<span class="token comment">#每台机器都是如此</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/f6/a8/KC4suh7I_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="authorized_keys_391"></a>将各自的公钥传到每台机器authorized_keys里面</h6> 
<p><strong>这里有个小问题：先检查安装了passwd没有，如果没有执行以下命令：</strong></p> 
<pre><code class="prism language-bash">yum <span class="token function">install</span> <span class="token function">passwd</span>
<span class="token comment">#然后设置密码</span>
<span class="token function">passwd</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/9f/a7/7MEnxyOP_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-bash"><span class="token comment">#一台机器的公钥都要弄到自己和其他机器的authorized_keys</span>
<span class="token comment">#以免以后安装其他东西减少不必要的麻烦</span>
<span class="token function">cat</span> id_rsa.pub <span class="token operator">&gt;&gt;</span> .ssh/authorized_keys
</code></pre> 
<h6><a id="etchosts_406"></a>编辑/etc/hosts</h6> 
<p><strong>注意：这里的master_standby可能不允许带下划线，有的机器在hdfs格式化的时候会不合法，所以你配置最后不要带特殊字符</strong><br> <img src="https://images2.imgbox.com/23/a0/fOVmE1uK_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-bash"><span class="token comment">#将/etc/hosts复制到每台节点</span>
<span class="token function">scp</span> /etc/hosts master_standby:/etc/
<span class="token function">scp</span> /etc/hosts slave01:/etc/
<span class="token function">scp</span> /etc/hosts slave02:/etc/
<span class="token function">scp</span> /etc/hosts slave03:/etc/
</code></pre> 
<h4><a id="Hadoop_417"></a>配置Hadoop</h4> 
<pre><code class="prism language-bash"><span class="token comment">#解压hadoop包</span>
<span class="token function">tar</span> -zxvf hadoop-2.8.5.tar.gz

</code></pre> 
<h6><a id="_424"></a>配置环境变量</h6> 
<pre><code class="prism language-bash"><span class="token comment">#配置环境变量</span>
<span class="token function">vim</span> ~/.bashrc
<span class="token comment">#添加以下内容</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">HADOOP_HOME</span><span class="token operator">=</span>/usr/local/hadoop-2.8.5
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CLASSPATH</span><span class="token operator">=</span>.:<span class="token variable">$HADOOP_HOME</span>/lib:<span class="token variable">$CLASSPATH</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$HADOOP_HOME</span>/bin
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$HADOOP_HOME</span>/sbin
<span class="token builtin class-name">export</span> <span class="token assign-left variable">HADOOP_MAPRED_HOME</span><span class="token operator">=</span><span class="token variable">$HADOOP_HOME</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">HADOOP_COMMON_HOME</span><span class="token operator">=</span><span class="token variable">$HADOOP_HOME</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">HADOOP_HDFS_HOME</span><span class="token operator">=</span><span class="token variable">$HADOOP_HOME</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">YARN_HOME</span><span class="token operator">=</span><span class="token variable">$HADOOP_HOME</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">HADOOP_ROOT_LOGGER</span><span class="token operator">=</span>INFO,console
<span class="token builtin class-name">export</span> <span class="token assign-left variable">HADOOP_COMMON_LIB_NATIVE_DIR</span><span class="token operator">=</span><span class="token variable">$HADOOP_HOME</span>/lib/native
<span class="token builtin class-name">export</span> <span class="token assign-left variable">HADOOP_OPTS</span><span class="token operator">=</span><span class="token string">"-Djava.library.path=<span class="token variable">$HADOOP_HOME</span>/lib"</span>
<span class="token comment">#将这个文件拷到其他机器的下面</span>
<span class="token function">scp</span> ~/.bashrc 机器名字:~/
<span class="token comment">#hadoop命令验证一下</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/aa/a3/HDEeIrkB_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="_446"></a>配置文件</h6> 
<p><strong>hdfs-site.xml</strong></p> 
<pre><code class="prism language-yaml">&lt;configuration<span class="token punctuation">&gt;</span>

&lt;<span class="token tag">!--</span> same with core<span class="token punctuation">-</span>site.xml<span class="token punctuation">:</span>defaultFS<span class="token punctuation">-</span><span class="token punctuation">-</span><span class="token punctuation">&gt;</span>
&lt;property<span class="token punctuation">&gt;</span>
        &lt;name<span class="token punctuation">&gt;</span>dfs.nameservices&lt;/name<span class="token punctuation">&gt;</span>
        &lt;value<span class="token punctuation">&gt;</span>mycluster&lt;/value<span class="token punctuation">&gt;</span>
&lt;/property<span class="token punctuation">&gt;</span>
&lt;<span class="token tag">!--</span> two NameNode<span class="token punctuation">,</span>nn1 and nn2<span class="token punctuation">-</span><span class="token punctuation">-</span><span class="token punctuation">&gt;</span>
&lt;property<span class="token punctuation">&gt;</span>
        &lt;name<span class="token punctuation">&gt;</span>dfs.ha.namenodes.mycluster&lt;/name<span class="token punctuation">&gt;</span>
        &lt;value<span class="token punctuation">&gt;</span>nn1<span class="token punctuation">,</span>nn2&lt;/value<span class="token punctuation">&gt;</span>
&lt;/property<span class="token punctuation">&gt;</span>

&lt;<span class="token tag">!--</span> mycluster.nn1 Namenode's RPC Address<span class="token punctuation">-</span><span class="token punctuation">-</span><span class="token punctuation">&gt;</span>
&lt;property<span class="token punctuation">&gt;</span>
&lt;name<span class="token punctuation">&gt;</span>dfs.namenode.rpc<span class="token punctuation">-</span>address.mycluster.nn1&lt;/name<span class="token punctuation">&gt;</span>
&lt;value<span class="token punctuation">&gt;</span>master<span class="token punctuation">:</span>9000&lt;/value<span class="token punctuation">&gt;</span>
&lt;/property<span class="token punctuation">&gt;</span>
&lt;<span class="token tag">!--</span> mycluster.nn1 Namenode's Http Address<span class="token punctuation">-</span><span class="token punctuation">-</span><span class="token punctuation">&gt;</span>
&lt;property<span class="token punctuation">&gt;</span>
&lt;name<span class="token punctuation">&gt;</span>dfs.namenode.http<span class="token punctuation">-</span>address.mycluster.nn1&lt;/name<span class="token punctuation">&gt;</span>
&lt;value<span class="token punctuation">&gt;</span>master<span class="token punctuation">:</span>50070&lt;/value<span class="token punctuation">&gt;</span>
&lt;/property<span class="token punctuation">&gt;</span>
&lt;<span class="token tag">!--</span> mycluster.nn2 Namenode's RPC Address<span class="token punctuation">-</span><span class="token punctuation">-</span><span class="token punctuation">&gt;</span>
&lt;property<span class="token punctuation">&gt;</span>
&lt;name<span class="token punctuation">&gt;</span>dfs.namenode.rpc<span class="token punctuation">-</span>address.mycluster.nn2&lt;/name<span class="token punctuation">&gt;</span>
&lt;value<span class="token punctuation">&gt;</span>master_standby<span class="token punctuation">:</span>9000&lt;/value<span class="token punctuation">&gt;</span>
&lt;/property<span class="token punctuation">&gt;</span>
&lt;<span class="token tag">!--</span> mycluster.nn2 Namenode's Http Address<span class="token punctuation">-</span><span class="token punctuation">-</span><span class="token punctuation">&gt;</span>
&lt;property<span class="token punctuation">&gt;</span>
&lt;name<span class="token punctuation">&gt;</span>dfs.namenode.http<span class="token punctuation">-</span>address.mycluster.nn2&lt;/name<span class="token punctuation">&gt;</span>
&lt;value<span class="token punctuation">&gt;</span>master_standby<span class="token punctuation">:</span>50070&lt;/value<span class="token punctuation">&gt;</span>
&lt;/property<span class="token punctuation">&gt;</span>

&lt;<span class="token tag">!--</span> where the NameNode's metadata store in JournalNodes <span class="token punctuation">-</span><span class="token punctuation">-</span><span class="token punctuation">&gt;</span>
&lt;property<span class="token punctuation">&gt;</span>
&lt;name<span class="token punctuation">&gt;</span>dfs.namenode.shared.edits.dir&lt;/name<span class="token punctuation">&gt;</span>
&lt;value<span class="token punctuation">&gt;</span>qjournal<span class="token punctuation">:</span>//slave01<span class="token punctuation">:</span>8485;slave02<span class="token punctuation">:</span>8485;slave03<span class="token punctuation">:</span>8485/mycluster&lt;/value<span class="token punctuation">&gt;</span>
&lt;/property<span class="token punctuation">&gt;</span>

&lt;<span class="token tag">!--</span> where Journaldata store in its disk<span class="token punctuation">-</span><span class="token punctuation">-</span><span class="token punctuation">&gt;</span>
&lt;property<span class="token punctuation">&gt;</span>
&lt;name<span class="token punctuation">&gt;</span>dfs.journalnode.edits.dir&lt;/name<span class="token punctuation">&gt;</span>
&lt;value<span class="token punctuation">&gt;</span>/usr/local/hadoop<span class="token punctuation">-</span>2.8.5/journaldata&lt;/value<span class="token punctuation">&gt;</span>
&lt;/property<span class="token punctuation">&gt;</span>

&lt;<span class="token tag">!--</span> open automatic<span class="token punctuation">-</span>failover when fail<span class="token punctuation">-</span><span class="token punctuation">-</span><span class="token punctuation">&gt;</span>
&lt;property<span class="token punctuation">&gt;</span>
&lt;name<span class="token punctuation">&gt;</span>dfs.ha.automatic<span class="token punctuation">-</span>failover.enabled&lt;/name<span class="token punctuation">&gt;</span>
&lt;value<span class="token punctuation">&gt;</span>true&lt;/value<span class="token punctuation">&gt;</span>
&lt;/property<span class="token punctuation">&gt;</span>

&lt;<span class="token tag">!--</span> the way when fail  <span class="token punctuation">-</span><span class="token punctuation">-</span><span class="token punctuation">&gt;</span>
&lt;property<span class="token punctuation">&gt;</span>
&lt;name<span class="token punctuation">&gt;</span>dfs.client.failover.proxy.provider.mycluster&lt;/name<span class="token punctuation">&gt;</span>
&lt;value<span class="token punctuation">&gt;</span>org.apache.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProvider&lt;/value<span class="token punctuation">&gt;</span>
&lt;/property<span class="token punctuation">&gt;</span>
&lt;<span class="token tag">!--</span> set the methods which disdancy<span class="token punctuation">-</span><span class="token punctuation">-</span><span class="token punctuation">&gt;</span>
&lt;property<span class="token punctuation">&gt;</span>
&lt;name<span class="token punctuation">&gt;</span>dfs.ha.fencing.methods&lt;/name<span class="token punctuation">&gt;</span>
&lt;value<span class="token punctuation">&gt;</span>sshfence&lt;/value<span class="token punctuation">&gt;</span>
&lt;/property<span class="token punctuation">&gt;</span>
&lt;<span class="token tag">!--</span> <span class="token punctuation">-</span><span class="token punctuation">-</span><span class="token punctuation">&gt;</span>
&lt;property<span class="token punctuation">&gt;</span>
&lt;name<span class="token punctuation">&gt;</span>dfs.ha.fencing.ssh.private<span class="token punctuation">-</span>key<span class="token punctuation">-</span>files&lt;/name<span class="token punctuation">&gt;</span>
&lt;value<span class="token punctuation">&gt;</span>/root/.ssh/id_rsa&lt;/value<span class="token punctuation">&gt;</span>
&lt;/property<span class="token punctuation">&gt;</span>

&lt;property<span class="token punctuation">&gt;</span>
&lt;name<span class="token punctuation">&gt;</span>dfs.ha.fencing.ssh.connect<span class="token punctuation">-</span>timeout&lt;/name<span class="token punctuation">&gt;</span>
&lt;value<span class="token punctuation">&gt;</span>30000&lt;/value<span class="token punctuation">&gt;</span>
&lt;/property<span class="token punctuation">&gt;</span>
&lt;/configuration<span class="token punctuation">&gt;</span>
</code></pre> 
<p><strong>core-site.xml</strong></p> 
<pre><code class="prism language-yaml">&lt;configuration<span class="token punctuation">&gt;</span>
&lt;property<span class="token punctuation">&gt;</span>
&lt;name<span class="token punctuation">&gt;</span>fs.defaultFS&lt;/name<span class="token punctuation">&gt;</span>
&lt;value<span class="token punctuation">&gt;</span>hdfs<span class="token punctuation">:</span>//mycluster&lt;/value<span class="token punctuation">&gt;</span>
&lt;/property<span class="token punctuation">&gt;</span>
&lt;property<span class="token punctuation">&gt;</span>
&lt;name<span class="token punctuation">&gt;</span>hadoop.tmp.dir&lt;/name<span class="token punctuation">&gt;</span>
&lt;value<span class="token punctuation">&gt;</span>/usr/local/hadoop<span class="token punctuation">-</span>2.8.5/tmp&lt;/value<span class="token punctuation">&gt;</span>
&lt;/property<span class="token punctuation">&gt;</span>

&lt;property<span class="token punctuation">&gt;</span>
&lt;name<span class="token punctuation">&gt;</span>ha.zookeeper.quorum&lt;/name<span class="token punctuation">&gt;</span>
&lt;value<span class="token punctuation">&gt;</span>zoo1<span class="token punctuation">:</span><span class="token number">2181</span><span class="token punctuation">,</span>zoo2<span class="token punctuation">:</span><span class="token number">2181</span><span class="token punctuation">,</span>zoo3<span class="token punctuation">:</span>2181&lt;/value<span class="token punctuation">&gt;</span>
&lt;/property<span class="token punctuation">&gt;</span>
&lt;/configuration<span class="token punctuation">&gt;</span>
</code></pre> 
<p><strong>yarn-site.xml</strong></p> 
<pre><code class="prism language-yaml">&lt;configuration<span class="token punctuation">&gt;</span>

&lt;<span class="token tag">!--</span> Site specific YARN configuration properties <span class="token punctuation">-</span><span class="token punctuation">-</span><span class="token punctuation">&gt;</span><span class="token scalar string">
   &lt;!--  open the yarn HA--&gt;
    &lt;property&gt;
        &lt;name&gt;yarn.resourcemanager.ha.enabled&lt;/name&gt;
        &lt;value&gt;true&lt;/value&gt;
    &lt;/property&gt;</span>
&lt;<span class="token tag">!--</span> RM's cluster id<span class="token punctuation">-</span><span class="token punctuation">-</span><span class="token punctuation">&gt;</span><span class="token scalar string">
    &lt;property&gt;
        &lt;name&gt;yarn.resourcemanager.cluster-id&lt;/name&gt;
        &lt;value&gt;mycluster&lt;/value&gt;
    &lt;/property&gt;</span>

    &lt;<span class="token tag">!--</span> Rm's name<span class="token punctuation">-</span><span class="token punctuation">-</span><span class="token punctuation">&gt;</span><span class="token scalar string">
    &lt;property&gt;
        &lt;name&gt;yarn.resourcemanager.ha.rm-ids&lt;/name&gt;
        &lt;value&gt;rm1,rm2&lt;/value&gt;
    &lt;/property&gt;</span>

    &lt;<span class="token tag">!--</span> RM1's address<span class="token punctuation">-</span><span class="token punctuation">-</span><span class="token punctuation">&gt;</span><span class="token scalar string">
    &lt;property&gt;
        &lt;name&gt;yarn.resourcemanager.hostname.rm1&lt;/name&gt;
        &lt;value&gt;master&lt;/value&gt;
    &lt;/property&gt;
    &lt;!-- RM2's address--&gt;
    &lt;property&gt;
        &lt;name&gt;yarn.resourcemanager.hostname.rm2&lt;/name&gt;
        &lt;value&gt;master_standby&lt;/value&gt;
    &lt;/property&gt;</span>

    &lt;<span class="token tag">!--</span> zookeeper cluster address<span class="token punctuation">-</span><span class="token punctuation">-</span><span class="token punctuation">&gt;</span><span class="token scalar string">
    &lt;property&gt;
        &lt;name&gt;yarn.resourcemanager.zk-address&lt;/name&gt;
        &lt;value&gt;zoo1:2181,zoo2:2181,zoo3:2181&lt;/value&gt;
    &lt;/property&gt;</span>

    &lt;<span class="token tag">!--</span> mapreduce<span class="token punctuation">-</span><span class="token punctuation">-</span><span class="token punctuation">&gt;</span><span class="token scalar string">
    &lt;property&gt;
        &lt;name&gt;yarn.nodemanager.aux-services&lt;/name&gt;
        &lt;value&gt;mapreduce_shuffle&lt;/value&gt;
    &lt;/property&gt;</span>

    &lt;property<span class="token punctuation">&gt;</span>
        &lt;name<span class="token punctuation">&gt;</span>yarn.log<span class="token punctuation">-</span>aggregation<span class="token punctuation">-</span>enable&lt;/name<span class="token punctuation">&gt;</span>
        &lt;value<span class="token punctuation">&gt;</span>true&lt;/value<span class="token punctuation">&gt;</span>
    &lt;/property<span class="token punctuation">&gt;</span>
&lt;<span class="token tag">!--</span> open RM restart<span class="token punctuation">-</span><span class="token punctuation">-</span><span class="token punctuation">&gt;</span>

    &lt;property<span class="token punctuation">&gt;</span>
            &lt;name<span class="token punctuation">&gt;</span>yarn.resourcemanager.webapp.address.rm1&lt;/name<span class="token punctuation">&gt;</span>
            &lt;value<span class="token punctuation">&gt;</span>master<span class="token punctuation">:</span>8001&lt;/value<span class="token punctuation">&gt;</span>
    &lt;/property<span class="token punctuation">&gt;</span>
    &lt;property<span class="token punctuation">&gt;</span>
            &lt;name<span class="token punctuation">&gt;</span>yarn.resourcemanager.webapp.address.rm2&lt;/name<span class="token punctuation">&gt;</span>
            &lt;value<span class="token punctuation">&gt;</span>master_standby<span class="token punctuation">:</span>8001&lt;/value<span class="token punctuation">&gt;</span>
    &lt;/property<span class="token punctuation">&gt;</span>
    &lt;<span class="token tag">!--</span> RM1 <span class="token punctuation">-</span><span class="token punctuation">-</span><span class="token punctuation">&gt;</span><span class="token scalar string">
    &lt;property&gt;
            &lt;name&gt;yarn.resourcemanager.scheduler.address.rm1&lt;/name&gt;
            &lt;value&gt;master:8030&lt;/value&gt;
    &lt;/property&gt;
    &lt;property&gt;
            &lt;name&gt;yarn.resourcemanager.resource-tracker.address.rm1&lt;/name&gt;
            &lt;value&gt;master:8031&lt;/value&gt;
    &lt;/property&gt;
    &lt;property&gt;
            &lt;name&gt;yarn.resourcemanager.address.rm1&lt;/name&gt;
            &lt;value&gt;master:8032&lt;/value&gt;
    &lt;/property&gt;
    &lt;property&gt;
            &lt;name&gt;yarn.resourcemanager.admin.address.rm1&lt;/name&gt;
            &lt;value&gt;master:8033&lt;/value&gt;
    &lt;/property&gt;
    &lt;!-- RM2 --&gt;
    &lt;property&gt;
            &lt;name&gt;yarn.resourcemanager.scheduler.address.rm2&lt;/name&gt;
            &lt;value&gt;master_standby:8030&lt;/value&gt;
    &lt;/property&gt;
    &lt;property&gt;
            &lt;name&gt;yarn.resourcemanager.resource-tracker.address.rm2&lt;/name&gt;
            &lt;value&gt;master_standby:8031&lt;/value&gt;
    &lt;/property&gt;
    &lt;property&gt;
            &lt;name&gt;yarn.resourcemanager.address.rm2&lt;/name&gt;
            &lt;value&gt;master_standby:8032&lt;/value&gt;
    &lt;/property&gt;
    &lt;property&gt;
            &lt;name&gt;yarn.resourcemanager.admin.address.rm2&lt;/name&gt;
            &lt;value&gt;master_standby:8033&lt;/value&gt;
    &lt;/property&gt;
    &lt;!-- YARN ?~[~F群?~Z~D?~A~Z?~P~H?~W??~W?~\~@?~U??~]?~U~Y?~W??~U? --&gt;
    &lt;property&gt;
        &lt;name&gt;yarn.log-aggregation.retain-seconds&lt;/name&gt;
        &lt;!--1天--&gt;
        &lt;value&gt;86400&lt;/value&gt;
    &lt;/property&gt;</span>


    &lt;property<span class="token punctuation">&gt;</span>
        &lt;name<span class="token punctuation">&gt;</span>yarn.resourcemanager.recovery.enabled&lt;/name<span class="token punctuation">&gt;</span>
    &lt;value<span class="token punctuation">&gt;</span>true&lt;/value<span class="token punctuation">&gt;</span>
    &lt;/property<span class="token punctuation">&gt;</span>

    &lt;property<span class="token punctuation">&gt;</span>
        &lt;name<span class="token punctuation">&gt;</span>yarn.resourcemanager.store.class&lt;/name<span class="token punctuation">&gt;</span>
        &lt;value<span class="token punctuation">&gt;</span>org.apache.hadoop.yarn.server.resourcemanager.recovery.ZKRMStateStore&lt;/value<span class="token punctuation">&gt;</span>
    &lt;/property<span class="token punctuation">&gt;</span>
&lt;/configuration<span class="token punctuation">&gt;</span>

</code></pre> 
<p><strong>mapred-site.xml</strong></p> 
<pre><code class="prism language-yaml">&lt;configuration<span class="token punctuation">&gt;</span>
        &lt;property<span class="token punctuation">&gt;</span>
                &lt;name<span class="token punctuation">&gt;</span>mapreduce.framework.name&lt;/name<span class="token punctuation">&gt;</span>
                &lt;value<span class="token punctuation">&gt;</span>yarn&lt;/value<span class="token punctuation">&gt;</span>
        &lt;/property<span class="token punctuation">&gt;</span>
        &lt;property<span class="token punctuation">&gt;</span>
                &lt;name<span class="token punctuation">&gt;</span>mapreduce.jobhistory.address&lt;/name<span class="token punctuation">&gt;</span>
                &lt;value<span class="token punctuation">&gt;</span>master<span class="token punctuation">:</span>10020&lt;/value<span class="token punctuation">&gt;</span>
        &lt;/property<span class="token punctuation">&gt;</span>
        &lt;property<span class="token punctuation">&gt;</span>
                 &lt;name<span class="token punctuation">&gt;</span>mapreduce.jobhistory.webapp.address&lt;/name<span class="token punctuation">&gt;</span>
                 &lt;value<span class="token punctuation">&gt;</span>master<span class="token punctuation">:</span>19888&lt;/value<span class="token punctuation">&gt;</span>
        &lt;/property<span class="token punctuation">&gt;</span>
&lt;/configuration<span class="token punctuation">&gt;</span>
</code></pre> 
<p><strong>slaves</strong></p> 
<pre><code class="prism language-bash">
slave01
slave02
slave03
~      
</code></pre> 
<p><strong>将配置文件分发到其他的每个节点</strong></p> 
<h4><a id="_686"></a>启动</h4> 
<pre><code class="prism language-bash"><span class="token comment">#在三台slave上执行</span>
sbin/hadoop-daemon.sh start journalnode
<span class="token comment">#在master执行hdfs格式化</span>
bin/hdfs namenode -format
<span class="token comment">#在masterstandby上执行来同步元数据</span>
<span class="token comment">#或者直接拷贝过去scp -r /usr/local/hadoop-2.8.5/tmp masterstandby:/usr/local/hadoop-2.8.5</span>
hdfs namenode -bootstrapStandby
<span class="token comment">#格式化zk</span>
bin/hdfs zkfc -formatZK
<span class="token comment">#之后启动hdfs</span>
sbin/start-hdfs.sh
<span class="token comment">#启动yarn</span>
sbin/start-yarn.sh
</code></pre> 
<p><strong>master进程</strong><br> <img src="https://images2.imgbox.com/d7/f2/DgNfOwwZ_o.png" alt="在这里插入图片描述"><br> <strong>masterstandby进程</strong><br> <img src="https://images2.imgbox.com/b8/7a/vdsHf0HB_o.png" alt="在这里插入图片描述"><br> <strong>slave进程</strong><br> <img src="https://images2.imgbox.com/12/92/Eb36iAZE_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="Spark_714"></a>Spark集群搭建</h3> 
<h3><a id="Flink_715"></a>Flink集群搭建</h3> 
<h3><a id="Flink_716"></a>Flink集群搭建</h3>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f34a3da2faceb0420532a52cce8eb34d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Excel文件的导出操作</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/67c60278275dfdaefc8f273e824a4ec0/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">微信小程序真机调试regeneratorRuntime is not defined错误</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>