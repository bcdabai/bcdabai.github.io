<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Flowable工作流入门 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Flowable工作流入门" />
<meta property="og:description" content="课程来源B站大佬波哥的课程
本文仅做笔记，课件需要的联系B站大佬获取
0.前置 相关话术 流程定义（Process Definition）： 描述业务流程的定义，通常使用BPMN（Business Process Model and Notation）进行建模。流程定义包括流程中的任务、网关、事件等元素，以及它们之间的顺序和关系。
流程实例（Process Instance）： 在运行时由流程定义创建的具体流程执行实例。每个流程实例代表了一个特定的业务流程执行过程。
任务（Task）： 流程中需要执行的工作单元，可以是用户任务、服务任务等。任务需要被分配给具体的角色或用户来执行。
用户任务（User Task）： 需要人类参与的任务，通常与特定用户或用户组相关联，需要用户手动完成。
服务任务（Service Task）： 由系统或服务执行的任务，通常是自动化的，不需要人工干预。
网关（Gateway）： 用于控制流程中的分支和合并，决定流程的走向。Flowable支持各种类型的网关，如排他网关、并行网关等。
流程变量（Process Variable）： 在流程实例中传递和存储数据的机制。流程变量可以在不同的任务之间传递信息，用于控制流程的行为。
部署（Deployment）： 将流程定义部署到Flowable引擎中，使其可以被实例化和执行。一个部署可以包含一个或多个流程定义。
执行（Execution）： 表示流程实例中的一个执行状态，包含当前执行到的节点、流程变量等信息。
历史数据（Historic Data）： 记录流程实例的历史信息，包括已完成的任务、执行时间等。Flowable提供了历史数据查询的功能。
流程引擎（Process Engine）： 是flowable的核心，或者说是flowable本身，它提供了执行、控制和管理流程实例的功能。
工作过程 流程建模： 首先，业务分析师或流程设计者使用流程建模工具，如Flowable提供的图形化建模工具，创建业务流程模型。这个模型包括流程定义、任务、网关、事件等元素，以及它们之间的流程顺序和条件。
部署流程定义： 将创建好的流程模型进行部署。部署是将流程定义加载到流程引擎中的一个过程，使其可以被实例化和执行。部署可以包括一个或多个流程定义，并在流程引擎中分配唯一的标识符。
流程实例化： 当需要执行业务流程时，流程引擎根据已部署的流程定义创建流程实例。每个流程实例都是特定业务流程的一个具体执行过程。
流程执行： 流程引擎根据流程定义中的逻辑，按照事先定义的流程顺序和条件执行各个任务和活动。这可能涉及到用户任务（等待人工处理）、服务任务（自动化任务）、网关（流程控制）等。
任务分配和处理： 当流程中涉及到用户任务时，流程引擎将任务分配给具体的用户或用户组。这个过程可以包括通知相关人员，提醒他们有任务需要处理。
流程控制： 流程引擎根据流程中的网关来控制流程的走向，例如，并行网关允许多个路径同时执行，排他网关根据条件选择一个路径。
流程变量： 在流程实例执行过程中，流程引擎可以使用和传递流程变量，这些变量可以在不同的任务之间传递数据，影响流程的行为。
历史记录： 流程引擎记录流程实例的历史数据，包括已完成的任务、执行时间、流程变量等。这些历史数据对于监控和报告业务流程的执行情况非常重要。
流程结束： 当流程中的所有任务和活动都完成时，流程实例结束。此时，可以进行一些收尾工作，如记录最终状态、生成报告等。
引入flowable时pom所需依赖 &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.flowable&lt;/groupId&gt; &lt;artifactId&gt;flowable-engine&lt;/artifactId&gt; &lt;version&gt;6.3.0&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.flowable&lt;/groupId&gt; &lt;artifactId&gt;flowable-json-converter&lt;/artifactId&gt; &lt;version&gt;6.3.0&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;version&gt;8." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/cf7d00d68ad0bcf104ca0edf4007bfa9/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-11T10:19:15+08:00" />
<meta property="article:modified_time" content="2024-01-11T10:19:15+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Flowable工作流入门</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <p><a href="https://www.bilibili.com/video/BV1oQ4y1J76o/" rel="nofollow">课程来源B站大佬波哥的课程</a><br> 本文仅做笔记，课件需要的联系B站大佬获取</p> 
</blockquote> 
<h3><a id="0_4"></a>0.前置</h3> 
<h4><a id="_5"></a>相关话术</h4> 
<ol><li> <p><strong>流程定义（Process Definition）：</strong> 描述业务流程的定义，通常使用BPMN（Business Process Model and Notation）进行建模。流程定义包括流程中的任务、网关、事件等元素，以及它们之间的顺序和关系。</p> </li><li> <p><strong>流程实例（Process Instance）：</strong> 在运行时由流程定义创建的具体流程执行实例。每个流程实例代表了一个特定的业务流程执行过程。</p> </li><li> <p><strong>任务（Task）：</strong> 流程中需要执行的工作单元，可以是用户任务、服务任务等。任务需要被分配给具体的角色或用户来执行。</p> </li><li> <p><strong>用户任务（User Task）：</strong> 需要人类参与的任务，通常与特定用户或用户组相关联，需要用户手动完成。</p> </li><li> <p><strong>服务任务（Service Task）：</strong> 由系统或服务执行的任务，通常是自动化的，不需要人工干预。</p> </li><li> <p><strong>网关（Gateway）：</strong> 用于控制流程中的分支和合并，决定流程的走向。Flowable支持各种类型的网关，如排他网关、并行网关等。</p> </li><li> <p><strong>流程变量（Process Variable）：</strong> 在流程实例中传递和存储数据的机制。流程变量可以在不同的任务之间传递信息，用于控制流程的行为。</p> </li><li> <p><strong>部署（Deployment）：</strong> 将流程定义部署到Flowable引擎中，使其可以被实例化和执行。一个部署可以包含一个或多个流程定义。</p> </li><li> <p><strong>执行（Execution）：</strong> 表示流程实例中的一个执行状态，包含当前执行到的节点、流程变量等信息。</p> </li><li> <p><strong>历史数据（Historic Data）：</strong> 记录流程实例的历史信息，包括已完成的任务、执行时间等。Flowable提供了历史数据查询的功能。</p> </li><li> <p><strong>流程引擎（Process Engine）：</strong> 是flowable的核心，或者说是flowable本身，它提供了执行、控制和管理流程实例的功能。</p> </li></ol> 
<h4><a id="_27"></a>工作过程</h4> 
<ol><li> <p><strong>流程建模：</strong> 首先，业务分析师或流程设计者使用流程建模工具，如Flowable提供的图形化建模工具，创建业务流程模型。这个模型包括流程定义、任务、网关、事件等元素，以及它们之间的流程顺序和条件。</p> </li><li> <p><strong>部署流程定义：</strong> 将创建好的流程模型进行部署。部署是将流程定义加载到流程引擎中的一个过程，使其可以被实例化和执行。部署可以包括一个或多个流程定义，并在流程引擎中分配唯一的标识符。</p> </li><li> <p><strong>流程实例化：</strong> 当需要执行业务流程时，流程引擎根据已部署的流程定义创建流程实例。每个流程实例都是特定业务流程的一个具体执行过程。</p> </li><li> <p><strong>流程执行：</strong> 流程引擎根据流程定义中的逻辑，按照事先定义的流程顺序和条件执行各个任务和活动。这可能涉及到用户任务（等待人工处理）、服务任务（自动化任务）、网关（流程控制）等。</p> </li><li> <p><strong>任务分配和处理：</strong> 当流程中涉及到用户任务时，流程引擎将任务分配给具体的用户或用户组。这个过程可以包括通知相关人员，提醒他们有任务需要处理。</p> </li><li> <p><strong>流程控制：</strong> 流程引擎根据流程中的网关来控制流程的走向，例如，并行网关允许多个路径同时执行，排他网关根据条件选择一个路径。</p> </li><li> <p><strong>流程变量：</strong> 在流程实例执行过程中，流程引擎可以使用和传递流程变量，这些变量可以在不同的任务之间传递数据，影响流程的行为。</p> </li><li> <p><strong>历史记录：</strong> 流程引擎记录流程实例的历史数据，包括已完成的任务、执行时间、流程变量等。这些历史数据对于监控和报告业务流程的执行情况非常重要。</p> </li><li> <p><strong>流程结束：</strong> 当流程中的所有任务和活动都完成时，流程实例结束。此时，可以进行一些收尾工作，如记录最终状态、生成报告等。</p> </li></ol> 
<h4><a id="flowablepom_47"></a>引入flowable时pom所需依赖</h4> 
<pre><code class="prism language-xml">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.flowable<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>flowable-engine<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>6.3.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.flowable<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>flowable-json-converter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>6.3.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>8.0.21<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.13.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.slf4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>slf4j-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.7.21<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.slf4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>slf4j-log4j12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.7.21<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>

</code></pre> 
<h4><a id="log4j_84"></a>log4j配置文件</h4> 
<p>在resource目录下创建log4j.properties文件</p> 
<pre><code class="prism language-properties">log4j.rootLogger=DEBUG, CA
log4j.appender.CA=org.apache.log4j.ConsoleAppender
log4j.appender.CA.layout=org.apache.log4j.PatternLayout
log4j.appender.CA.layout.ConversionPattern= %d{hh:mm:ss,SSS} [%t] %-5p %c %x - %m%n
</code></pre> 
<h5><a id="mysqlflowablelearn_92"></a>准备一个空mysql数据库，库名：flowable-learn</h5> 
<h3><a id="1ProcessEngine_93"></a>1.创建ProcessEngine</h3> 
<p><code>ProcessEngine</code>是<code>Flowable</code>的核心组件之一，主要功能如下</p> 
<ul><li>流程执行</li><li>任务分配和处理</li><li>流程监控和报告</li><li>流程建模</li><li>自动化</li></ul> 
<p>创建<code>ProcessEngine</code>代码如下:</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">ProcessEngineConfiguration</span> cfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StandaloneProcessEngineConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setJdbcUrl</span><span class="token punctuation">(</span><span class="token string">"jdbc:mysql://localhost:3306/flowable-learn?serverTimezone=UTC"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setJdbcUsername</span><span class="token punctuation">(</span><span class="token string">"root"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setJdbcPassword</span><span class="token punctuation">(</span><span class="token string">"123456"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setJdbcDriver</span><span class="token punctuation">(</span><span class="token string">"com.mysql.cj.jdbc.Driver"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setDatabaseSchemaUpdate</span><span class="token punctuation">(</span><span class="token class-name">ProcessEngineConfiguration</span><span class="token punctuation">.</span><span class="token constant">DB_SCHEMA_UPDATE_TRUE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> cfg<span class="token punctuation">.</span><span class="token function">buildProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li><code>setDatabaseSchemaUpdate(ProcessEngineConfiguration.DB_SCHEMA_UPDATE_TRUE)</code>:<br> 这行代码会为数据库初始化flowable的表。</li></ul> 
<h4><a id="flowable_115"></a>flowable表说明</h4> 
<h5><a id="_116"></a>相关表</h5> 
<ol><li> <p><strong>ACT_RE_*：</strong> 这些表存储着流程引擎的元数据，包括流程定义、用户任务、服务任务等。常见的表包括：</p> 
  <ul><li><code>ACT_RE_PROCDEF</code>: 存储流程定义信息。</li><li><code>ACT_RE_DEPLOYMENT</code>: 存储流程部署信息。</li><li><code>ACT_RE_MODEL</code>: 存储模型信息。</li></ul> </li><li> <p><strong>ACT_RU_*：</strong> 这些表存储流程引擎的运行时数据，包括运行时的流程实例、任务实例等。常见的表包括：</p> 
  <ul><li><code>ACT_RU_EXECUTION</code>: 存储流程实例的执行信息。</li><li><code>ACT_RU_TASK</code>: 存储任务实例信息。</li><li><code>ACT_RU_VARIABLE</code>: 存储运行时的流程变量。</li></ul> </li><li> <p><strong>ACT_HI_*：</strong> 这些表存储流程引擎的历史数据，包括已完成的流程实例、任务实例等。常见的表包括：</p> 
  <ul><li><code>ACT_HI_PROCINST</code>: 存储已完成的流程实例信息。</li><li><code>ACT_HI_TASKINST</code>: 存储已完成的任务实例信息。</li><li><code>ACT_HI_ACTINST</code>: 存储流程实例中已执行的活动信息。</li></ul> </li><li> <p><strong>ACT_ID_*：</strong> 这些表存储身份和权限相关的数据，用于用户、用户组、成员关系等。常见的表包括：</p> 
  <ul><li><code>ACT_ID_USER</code>: 存储用户信息。</li><li><code>ACT_ID_GROUP</code>: 存储用户组信息。</li><li><code>ACT_ID_MEMBERSHIP</code>: 存储用户与用户组的关系。</li></ul> </li></ol> 
<h5><a id="_138"></a>所有表</h5> 
<p>这是 Flowable 数据库中的一组表，每个表都有特定的用途，用于存储流程引擎的不同方面的信息。以下是这些表的简要说明：</p> 
<ol><li> <p><strong>act_evt_log:</strong> 存储引擎的事件日志，记录流程引擎执行过程中的事件。</p> </li><li> <p><strong>act_ge_bytearray:</strong> 存储字节数组，通常用于存储流程定义文件（如 BPMN 文件）和流程图。</p> </li><li> <p><strong>act_ge_property:</strong> 存储全局引擎属性，用于存储引擎的一些全局配置信息。</p> </li><li> <p><strong>act_hi_actinst:</strong> 存储历史活动实例数据，包括已完成的活动（节点）的详细信息。</p> </li><li> <p><strong>act_hi_attachment:</strong> 存储历史附件数据，记录与流程实例、任务实例相关的附件信息。</p> </li><li> <p><strong>act_hi_comment:</strong> 存储历史评论/备注数据，记录用户对流程实例或任务实例的评论。</p> </li><li> <p><strong>act_hi_detail:</strong> 存储历史详情数据，用于存储与历史流程实例和任务实例相关的详细信息。</p> </li><li> <p><strong>act_hi_identitylink:</strong> 存储历史身份链接数据，记录与历史流程实例和任务实例相关的身份链接信息。</p> </li><li> <p><strong>act_hi_procinst:</strong> 存储已完成的流程实例的详细信息。</p> </li><li> <p><strong>act_hi_taskinst:</strong> 存储已完成的任务实例的详细信息。</p> </li><li> <p><strong>act_hi_varinst:</strong> 存储历史变量实例数据，记录历史流程变量的信息。</p> </li><li> <p><strong>act_id_bytearray:</strong> 存储字节数组，通常用于存储用户头像等信息。</p> </li><li> <p><strong>act_id_group:</strong> 存储用户组信息。</p> </li><li> <p><strong>act_id_info:</strong> 存储用户附加信息。</p> </li><li> <p><strong>act_id_membership:</strong> 存储用户与用户组的关系。</p> </li><li> <p><strong>act_id_priv:</strong> 存储用户特权信息。</p> </li><li> <p><strong>act_id_priv_mapping:</strong> 存储用户特权映射关系。</p> </li><li> <p><strong>act_id_property:</strong> 存储用户属性信息。</p> </li><li> <p><strong>act_id_token:</strong> 存储用户身份验证令牌信息。</p> </li><li> <p><strong>act_id_user:</strong> 存储用户信息。</p> </li><li> <p><strong>act_procdef_info:</strong> 存储流程定义的信息。</p> </li><li> <p><strong>act_re_deployment:</strong> 存储流程部署信息。</p> </li><li> <p><strong>act_re_model:</strong> 存储模型信息。</p> </li><li> <p><strong>act_re_procdef:</strong> 存储流程定义信息。</p> </li><li> <p><strong>act_ru_deadletter_job:</strong> 存储运行时死信作业（失败的异步任务）信息。</p> </li><li> <p><strong>act_ru_event_subscr:</strong> 存储运行时事件订阅信息。</p> </li><li> <p><strong>act_ru_execution:</strong> 存储运行时流程执行实例信息。</p> </li><li> <p><strong>act_ru_history_job:</strong> 存储运行时历史作业信息。</p> </li><li> <p><strong>act_ru_identitylink:</strong> 存储运行时身份链接信息，与运行时流程实例和任务实例相关。</p> </li><li> <p><strong>act_ru_job:</strong> 存储运行时作业信息，用于异步任务等。</p> </li><li> <p><strong>act_ru_suspended_job:</strong> 存储运行时挂起的作业信息。</p> </li><li> <p><strong>act_ru_task:</strong> 存储运行时任务实例信息。</p> </li><li> <p><strong>act_ru_timer_job:</strong> 存储运行时定时作业信息。</p> </li><li> <p><strong>act_ru_variable:</strong> 存储运行时变量信息。</p> </li></ol> 
<h3><a id="2_210"></a>2.部署流程定义</h3> 
<ul><li>流程引擎会将XML文件存储在数据库中，这样可以在需要的时候获取它</li><li>流程定义转换为内部的、可执行的对象模型，这样使用它就可以启动<em>流程实例</em>。</li></ul> 
<h4><a id="21bpmn20_213"></a>2.1.创建流程定义bpmn2.0文件</h4> 
<p>将下面的XML保存在<em>src/main/resources</em>文件夹下名为<em>holiday-request.bpmn20.xml</em>的文件中。<br> <img src="https://images2.imgbox.com/9e/73/F87DtRPW_o.png" alt="流程定义的内容"></p> 
<pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>definitions</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.omg.org/spec/BPMN/20100524/MODEL<span class="token punctuation">"</span></span>
             <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>
             <span class="token attr-name"><span class="token namespace">xmlns:</span>xsd</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema<span class="token punctuation">"</span></span>
             <span class="token attr-name"><span class="token namespace">xmlns:</span>bpmndi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.omg.org/spec/BPMN/20100524/DI<span class="token punctuation">"</span></span>
             <span class="token attr-name"><span class="token namespace">xmlns:</span>omgdc</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.omg.org/spec/DD/20100524/DC<span class="token punctuation">"</span></span>
             <span class="token attr-name"><span class="token namespace">xmlns:</span>omgdi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.omg.org/spec/DD/20100524/DI<span class="token punctuation">"</span></span>
             <span class="token attr-name"><span class="token namespace">xmlns:</span>flowable</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://flowable.org/bpmn<span class="token punctuation">"</span></span>
             <span class="token attr-name">typeLanguage</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema<span class="token punctuation">"</span></span>
             <span class="token attr-name">expressionLanguage</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/1999/XPath<span class="token punctuation">"</span></span>
             <span class="token attr-name">targetNamespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.flowable.org/processdef<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>process</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>holidayRequest<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Holiday Request<span class="token punctuation">"</span></span> <span class="token attr-name">isExecutable</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>startEvent</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>startEvent<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sequenceFlow</span> <span class="token attr-name">sourceRef</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>startEvent<span class="token punctuation">"</span></span> <span class="token attr-name">targetRef</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>approveTask<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>userTask</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>approveTask<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Approve or reject request<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sequenceFlow</span> <span class="token attr-name">sourceRef</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>approveTask<span class="token punctuation">"</span></span> <span class="token attr-name">targetRef</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>decision<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusiveGateway</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>decision<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sequenceFlow</span> <span class="token attr-name">sourceRef</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>decision<span class="token punctuation">"</span></span> <span class="token attr-name">targetRef</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>externalSystemCall<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>conditionExpression</span> <span class="token attr-name"><span class="token namespace">xsi:</span>type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tFormalExpression<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token cdata">&lt;![CDATA[
          ${approved}
        ]]&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>conditionExpression</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>sequenceFlow</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sequenceFlow</span> <span class="token attr-name">sourceRef</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>decision<span class="token punctuation">"</span></span> <span class="token attr-name">targetRef</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sendRejectionMail<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>conditionExpression</span> <span class="token attr-name"><span class="token namespace">xsi:</span>type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tFormalExpression<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token cdata">&lt;![CDATA[
          ${!approved}
        ]]&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>conditionExpression</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>sequenceFlow</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>serviceTask</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>externalSystemCall<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Enter holidays in external system<span class="token punctuation">"</span></span>
                     <span class="token attr-name"><span class="token namespace">flowable:</span>class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.flowable.CallExternalSystemDelegate<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sequenceFlow</span> <span class="token attr-name">sourceRef</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>externalSystemCall<span class="token punctuation">"</span></span> <span class="token attr-name">targetRef</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>holidayApprovedTask<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>userTask</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>holidayApprovedTask<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Holiday approved<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sequenceFlow</span> <span class="token attr-name">sourceRef</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>holidayApprovedTask<span class="token punctuation">"</span></span> <span class="token attr-name">targetRef</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>approveEnd<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>serviceTask</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sendRejectionMail<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Send out rejection email<span class="token punctuation">"</span></span>
                     <span class="token attr-name"><span class="token namespace">flowable:</span>class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.mushfish.flowable.SendRejectionMail<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sequenceFlow</span> <span class="token attr-name">sourceRef</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sendRejectionMail<span class="token punctuation">"</span></span> <span class="token attr-name">targetRef</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>rejectEnd<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>endEvent</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>approveEnd<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>endEvent</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>rejectEnd<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>process</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>definitions</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h4><a id="22Flowable_272"></a>2.2.将流程定义部署至Flowable引擎</h4> 
<h5><a id="220Flowableservice_273"></a>2.2.0.前置知识-Flowable提供的service</h5> 
<ol><li> <p><strong>RepositoryService：</strong> 用于管理流程定义的服务。可以通过该服务进行流程定义的部署、查询和删除等操作。</p> </li><li> <p><strong>RuntimeService：</strong> 提供对运行时流程实例和执行流程任务的访问。可以用于启动、查询、操作流程实例，以及处理流程任务。</p> </li><li> <p><strong>TaskService：</strong> 用于管理流程任务的服务。可以通过该服务进行任务的查询、领取、完成等操作。</p> </li><li> <p><strong>HistoryService：</strong> 提供对历史数据的访问，包括已完成的流程实例、任务、变量等的查询。</p> </li><li> <p><strong>IdentityService：</strong> 提供对流程引擎中的用户和组的管理。可以用于查询和管理用户、组、用户组关系等。</p> </li><li> <p><strong>ManagementService：</strong> 提供对引擎的管理和监控功能，例如获取引擎信息、执行数据库操作等。</p> </li><li> <p><strong>FormService：</strong> 提供对表单数据的访问和处理，用于处理用户任务表单的提交和查询。</p> </li><li> <p><strong>DynamicBpmnService：</strong> 提供对动态BPMN（Business Process Model and Notation）的支持，允许在运行时对流程进行动态修改。</p> </li></ol> 
<h5><a id="221_289"></a>2.2.1.部署流程定义</h5> 
<p>将流程定义<em>部署</em>至Flowable引擎，需要使用<em>RepositoryService</em>，其可以从<em>ProcessEngine</em>对象获取。使用<em>RepositoryService</em>，可以通过XML文件的路径创建一个新的<em>部署(Deployment)</em>，并调用*deploy()*方法实际执行：</p> 
<pre><code class="prism language-java">    <span class="token comment">/**
     * 部署流程
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testDeploy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 配置数据库相关信息 获取 ProcessEngineConfiguration</span>
        <span class="token class-name">ProcessEngineConfiguration</span> cfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StandaloneProcessEngineConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setJdbcUrl</span><span class="token punctuation">(</span><span class="token string">"jdbc:mysql://localhost:3306/flowable-learn?serverTimezone=UTC&amp;nullCatalogMeansCurrent=true"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setJdbcUsername</span><span class="token punctuation">(</span><span class="token string">"root"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setJdbcPassword</span><span class="token punctuation">(</span><span class="token string">"123456"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setJdbcDriver</span><span class="token punctuation">(</span><span class="token string">"com.mysql.cj.jdbc.Driver"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setDatabaseSchemaUpdate</span><span class="token punctuation">(</span><span class="token class-name">ProcessEngineConfiguration</span><span class="token punctuation">.</span><span class="token constant">DB_SCHEMA_UPDATE_TRUE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取流程引擎对象</span>
        <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> cfg<span class="token punctuation">.</span><span class="token function">buildProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 部署流程 获取RepositoryService对象</span>
        <span class="token class-name">RepositoryService</span> repositoryService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getRepositoryService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Deployment</span> deployment <span class="token operator">=</span> repositoryService<span class="token punctuation">.</span><span class="token function">createDeployment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// 创建Deployment对象</span>
                <span class="token punctuation">.</span><span class="token function">addClasspathResource</span><span class="token punctuation">(</span><span class="token string">"holiday-request.bpmn20.xml"</span><span class="token punctuation">)</span> <span class="token comment">// 添加流程部署文件</span>
                <span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">"请求流程"</span><span class="token punctuation">)</span> <span class="token comment">// 设置部署流程的名称</span>
                <span class="token punctuation">.</span><span class="token function">deploy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 执行部署操作</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"deployment.getId() = "</span> <span class="token operator">+</span> deployment<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"deployment.getName() = "</span> <span class="token operator">+</span> deployment<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p>执行成功后，数据库相关表会发生变化<br> act_re_deployment: 流程定义部署表，每部署一次就增加一条记录<br> act_re_procdef ：流程定义表，部署每个新的流程定义都会在这张表中增加一条记录<br> act_ge_bytearray ：流程资源表，流程部署的 bpmn文件和png图片会保存在该表中</p> 
</blockquote> 
<h5><a id="222_321"></a>2.2.2.查看流程定义</h5> 
<p>通过API查询并验证流程定义已经部署在引擎中。通过<em>RepositoryService</em>创建的<em>ProcessDefinitionQuery</em>对象实现。</p> 
<pre><code class="prism language-java"><span class="token comment">/**
     * 查看流程定义
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testDeployQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 配置数据库相关信息 获取 ProcessEngineConfiguration</span>
        <span class="token class-name">ProcessEngineConfiguration</span> cfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StandaloneProcessEngineConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setJdbcUrl</span><span class="token punctuation">(</span><span class="token string">"jdbc:mysql://localhost:3306/flowable-learn?serverTimezone=UTC&amp;nullCatalogMeansCurrent=true"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setJdbcUsername</span><span class="token punctuation">(</span><span class="token string">"root"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setJdbcPassword</span><span class="token punctuation">(</span><span class="token string">"123456"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setJdbcDriver</span><span class="token punctuation">(</span><span class="token string">"com.mysql.cj.jdbc.Driver"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setDatabaseSchemaUpdate</span><span class="token punctuation">(</span><span class="token class-name">ProcessEngineConfiguration</span><span class="token punctuation">.</span><span class="token constant">DB_SCHEMA_UPDATE_TRUE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取流程引擎对象</span>
        <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> cfg<span class="token punctuation">.</span><span class="token function">buildProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 部署流程 获取RepositoryService对象</span>
        <span class="token class-name">RepositoryService</span> repositoryService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getRepositoryService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取流程定义对象</span>
        <span class="token class-name">ProcessDefinition</span> processDefinition <span class="token operator">=</span> repositoryService<span class="token punctuation">.</span><span class="token function">createProcessDefinitionQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">deploymentId</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span> <span class="token comment">//查看表中该值是多少</span>
                <span class="token punctuation">.</span><span class="token function">singleResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"processDefinition.getId() = "</span> <span class="token operator">+</span> processDefinition<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"processDefinition.getName() = "</span> <span class="token operator">+</span> processDefinition<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"processDefinition.getDeploymentId() = "</span> <span class="token operator">+</span> processDefinition<span class="token punctuation">.</span><span class="token function">getDeploymentId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"processDefinition.getDescription() = "</span> <span class="token operator">+</span> processDefinition<span class="token punctuation">.</span><span class="token function">getDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
</code></pre> 
<h3><a id="3_351"></a>3.启动流程实例</h3> 
<blockquote> 
 <p>现在已经在流程引擎中<em>部署</em>了流程定义，因此可以使用这个<em>流程定义</em>作为“模板”启动<em>流程实例</em>。</p> 
</blockquote> 
<p>要启动流程实例，需要提供一些初始化<em>流程变量</em>。一般来说，可以通过呈现给用户的表单，或者在流程由其他系统自动触发时通过REST API，来获取这些变量。在这个例子里，我们简化直接在代码中定义了，我们使用<em>RuntimeService</em>启动一个<em>流程实例</em>。</p> 
<pre><code class="prism language-java">    <span class="token comment">/**
     * 启动流程实例
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testRunProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 配置数据库相关信息 获取 ProcessEngineConfiguration</span>
        <span class="token class-name">ProcessEngineConfiguration</span> cfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StandaloneProcessEngineConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setJdbcUrl</span><span class="token punctuation">(</span><span class="token string">"jdbc:mysql://localhost:3306/flowable-learn?serverTimezone=UTC&amp;nullCatalogMeansCurrent=true"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setJdbcUsername</span><span class="token punctuation">(</span><span class="token string">"root"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setJdbcPassword</span><span class="token punctuation">(</span><span class="token string">"123456"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setJdbcDriver</span><span class="token punctuation">(</span><span class="token string">"com.mysql.cj.jdbc.Driver"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setDatabaseSchemaUpdate</span><span class="token punctuation">(</span><span class="token class-name">ProcessEngineConfiguration</span><span class="token punctuation">.</span><span class="token constant">DB_SCHEMA_UPDATE_TRUE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取流程引擎对象</span>
        <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> cfg<span class="token punctuation">.</span><span class="token function">buildProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 启动流程实例通过 RuntimeService 对象</span>
        <span class="token class-name">RuntimeService</span> runtimeService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getRuntimeService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 构建流程变量</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> variables <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        variables<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"employee"</span><span class="token punctuation">,</span><span class="token string">"张三"</span><span class="token punctuation">)</span> <span class="token punctuation">;</span><span class="token comment">// 谁申请请假</span>
        variables<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"nrOfHolidays"</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 请几天假</span>
        variables<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"description"</span><span class="token punctuation">,</span><span class="token string">"工作累了，想出去玩玩"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 请假的原因</span>
        <span class="token comment">// 启动流程实例，第一个参数是流程定义的id</span>
        <span class="token class-name">ProcessInstance</span> processInstance <span class="token operator">=</span> runtimeService
                <span class="token punctuation">.</span><span class="token function">startProcessInstanceByKey</span><span class="token punctuation">(</span><span class="token string">"holidayRequest"</span><span class="token punctuation">,</span> variables<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 启动流程实例</span>
        <span class="token comment">// 输出相关的流程实例信息</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"流程定义的ID："</span> <span class="token operator">+</span> processInstance<span class="token punctuation">.</span><span class="token function">getProcessDefinitionId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"流程实例的ID："</span> <span class="token operator">+</span> processInstance<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"当前活动的ID："</span> <span class="token operator">+</span> processInstance<span class="token punctuation">.</span><span class="token function">getActivityId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p>启动流程实例涉及到的表结构：</p> 
 <ul><li>act_hi_actinst 流程实例执行历史</li><li>act_hi_identitylink 流程的参与用户的历史信息</li><li>act_hi_procinst 流程实例历史信息</li><li>act_hi_taskinst 流程任务历史信息</li><li>act_ru_execution 流程执行信息</li><li>act_ru_identitylink 流程的参与用户信息</li><li>act_ru_task 任务信息</li></ul> 
</blockquote> 
<h3><a id="4_395"></a>4.查看任务</h3> 
<blockquote> 
 <p>上面员工发起了一个请假流程，接下来就会流转到总经理这儿来处理，之前我们没有指定经理这的处理人，我们可以加一个</p> 
</blockquote> 
<ol><li>添加任务执行人<br> 修改holiday-request.bpmn20.xml文件，增加任务执行人<code>flowable:assignee="lisi"</code><pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>userTask</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>approveTask<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Approve or reject request<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">flowable:</span>assignee</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>lisi<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre> </li><li>查看任务<br> <strong>因修改了流程定义，需先依次执行<code>部署流程</code>和<code>启动流程实例</code></strong>，才能查看到lisi的任务<pre><code class="prism language-java">    <span class="token comment">/**
* 查看任务
*/</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testQueryTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
   <span class="token comment">// 配置数据库相关信息 获取 ProcessEngineConfiguration</span>
   <span class="token class-name">ProcessEngineConfiguration</span> cfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StandaloneProcessEngineConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
           <span class="token punctuation">.</span><span class="token function">setJdbcUrl</span><span class="token punctuation">(</span><span class="token string">"jdbc:mysql://localhost:3306/flowable-learn?serverTimezone=UTC&amp;nullCatalogMeansCurrent=true"</span><span class="token punctuation">)</span>
           <span class="token punctuation">.</span><span class="token function">setJdbcUsername</span><span class="token punctuation">(</span><span class="token string">"root"</span><span class="token punctuation">)</span>
           <span class="token punctuation">.</span><span class="token function">setJdbcPassword</span><span class="token punctuation">(</span><span class="token string">"123456"</span><span class="token punctuation">)</span>
           <span class="token punctuation">.</span><span class="token function">setJdbcDriver</span><span class="token punctuation">(</span><span class="token string">"com.mysql.cj.jdbc.Driver"</span><span class="token punctuation">)</span>
           <span class="token punctuation">.</span><span class="token function">setDatabaseSchemaUpdate</span><span class="token punctuation">(</span><span class="token class-name">ProcessEngineConfiguration</span><span class="token punctuation">.</span><span class="token constant">DB_SCHEMA_UPDATE_TRUE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">// 获取流程引擎对象</span>
   <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> cfg<span class="token punctuation">.</span><span class="token function">buildProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token class-name">TaskService</span> taskService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getTaskService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Task</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> taskService<span class="token punctuation">.</span><span class="token function">createTaskQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
           <span class="token punctuation">.</span><span class="token function">processDefinitionKey</span><span class="token punctuation">(</span><span class="token string">"holidayRequest"</span><span class="token punctuation">)</span>
           <span class="token punctuation">.</span><span class="token function">taskAssignee</span><span class="token punctuation">(</span><span class="token string">"lisi"</span><span class="token punctuation">)</span>
           <span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Task</span> task <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
       <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"task.getProcessDefinitionId() = "</span> <span class="token operator">+</span> task<span class="token punctuation">.</span><span class="token function">getProcessDefinitionId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"task.getId() = "</span> <span class="token operator">+</span> task<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"task.getAssignee() = "</span> <span class="token operator">+</span> task<span class="token punctuation">.</span><span class="token function">getAssignee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"task.getName() = "</span> <span class="token operator">+</span> task<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> </li></ol> 
<p>输出结果</p> 
<blockquote> 
 <p>task.getProcessDefinitionId() = holidayRequest:4:15003<br> task.getId() = 17508<br> task.getAssignee() = lisi<br> task.getName() = Approve or reject request<br> task.getProcessDefinitionId() = holidayRequest:4:15003<br> task.getId() = 20008<br> task.getAssignee() = lisi<br> task.getName() = Approve or reject request<br> task.getProcessDefinitionId() = holidayRequest:7:30003<br> task.getId() = 32508<br> task.getAssignee() = lisi<br> task.getName() = Approve or reject request<br> task.getProcessDefinitionId() = holidayRequest:8:35003<br> task.getId() = 37508<br> task.getAssignee() = lisi<br> task.getName() = Approve or reject request<br> task.getProcessDefinitionId() = holidayRequest:9:40003<br> task.getId() = 42508<br> task.getAssignee() = lisi<br> task.getName() = Approve or reject request<br> task.getProcessDefinitionId() = holidayRequest:9:40003<br> task.getId() = 45008<br> task.getAssignee() = lisi<br> task.getName() = Approve or reject request</p> 
</blockquote> 
<p>解释结果：<br> <code>task.getProcessDefinitionId()</code> 是 Flowable 任务对象中的一个方法，用于获取与当前任务相关的流程定义的标识符（ID）。在上述例子中，<code>holidayRequest:4:15003</code> 是一个具体的流程定义的标识符。</p> 
<p>具体解释如下：</p> 
<ul><li> <p><strong>holidayRequest:</strong> 这部分是流程定义的 Key，通常表示该流程的业务标识。在 BPMN 模型中，Key 是流程定义的一个属性，用于唯一标识一个流程。</p> </li><li> <p><strong>4:</strong> 这部分是流程定义的版本号。在 Flowable 中，每次对流程定义进行修改并重新部署时，版本号会递增。</p> </li><li> <p><strong>15003:</strong> 这部分是流程定义的数据库主键（ID）。每个流程定义在数据库中都有一个唯一的主键。</p> </li><li> <p><strong><code>holidayRequest:4:15003</code></strong> 为act_re_procdef表主键值</p> </li><li> <p>执行一次<code>部署流程</code>会增加版本号，执行一次<code>启动流程实例</code>会增加task</p> </li></ul> 
<h3><a id="5_472"></a>5.完成任务</h3> 
<blockquote> 
 <p>现在lisi这个角色可以来完成当前的任务了</p> 
</blockquote> 
<h4><a id="JavaDelegate_474"></a>前置知识-接口JavaDelegate</h4> 
<blockquote> 
 <p>org.flowable.engine.delegate.JavaDelegate<br> <code>org.flowable.engine.delegate.JavaDelegate</code> 是 Flowable 中的一个接口，用于在流程执行过程中执行自定义的 Java 代码。这个接口是 Flowable 中的一个任务监听器类型，通常被用于在流程的特定节点或任务中执行业务逻辑。</p> 
</blockquote> 
<p>具体来说，<code>JavaDelegate</code> 接口定义了一个方法：</p> 
<pre><code class="prism language-java"><span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">DelegateExecution</span> execution<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>在这个方法中，你可以编写自己的 Java 代码，用于处理与特定任务或节点相关的业务逻辑。<code>DelegateExecution</code> 对象提供了访问流程执行上下文的方法，允许你获取和设置流程变量、操作任务等。</p> 
<p>一个典型的使用场景是将 <code>JavaDelegate</code> 用作用户任务节点的任务监听器。当流程引擎到达一个用户任务时，<code>JavaDelegate</code> 可以被触发，执行与该用户任务相关的自定义逻辑，例如发送通知、调用其他系统、更新数据等。</p> 
<p>以下是一个简单的示例，演示如何实现 <code>JavaDelegate</code>：</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>flowable<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>delegate<span class="token punctuation">.</span></span><span class="token class-name">DelegateExecution</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>flowable<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>delegate<span class="token punctuation">.</span></span><span class="token class-name">JavaDelegate</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyJavaDelegate</span> <span class="token keyword">implements</span> <span class="token class-name">JavaDelegate</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">DelegateExecution</span> execution<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 从流程执行上下文中获取信息</span>
        <span class="token class-name">String</span> processInstanceId <span class="token operator">=</span> execution<span class="token punctuation">.</span><span class="token function">getProcessInstanceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> currentActivityId <span class="token operator">=</span> execution<span class="token punctuation">.</span><span class="token function">getCurrentActivityId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 执行自定义的业务逻辑</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Executing JavaDelegate for process instance "</span> <span class="token operator">+</span> processInstanceId <span class="token operator">+</span>
                <span class="token string">", current activity: "</span> <span class="token operator">+</span> currentActivityId<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 可以进行更复杂的业务逻辑处理</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>在 BPMN 文件中，你可以将这个 <code>JavaDelegate</code> 配置为任务的监听器，如下所示：</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>serviceTask</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>myServiceTask<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>My Service Task<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">flowable:</span>class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.MyJavaDelegate<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre> 
<p>这样，当流程执行到这个任务时，<code>MyJavaDelegate</code> 中的 <code>execute</code> 方法将被调用，允许你执行自定义的业务逻辑。</p> 
<h5><a id="JavaDelegate_520"></a>自定义JavaDelegate</h5> 
<p>在<code>holiday-request.bpmn20.xml</code>中有</p> 
<pre><code class="prism language-xml">
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>serviceTask</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sendRejectionMail<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Send out rejection email<span class="token punctuation">"</span></span>
             <span class="token attr-name"><span class="token namespace">flowable:</span>class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.mushfish.flowable.SendRejectionMail<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre> 
<p>因此，在org.flowable包下创建<code>SendRejectionMail</code>类</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SendRejectionMail</span> <span class="token keyword">implements</span> <span class="token class-name">JavaDelegate</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">/**
     * 这个一个Flowable中的触发器
     * @param execution
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">DelegateExecution</span> execution<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 触发执行的逻辑  按照我们在流程中的定义应该给被拒绝的员工发送通知的邮件</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"不好意思，你的请假申请被拒绝了....安心工作"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="_542"></a>完成任务</h5> 
<pre><code class="prism language-java">    <span class="token comment">/**
     * 完成任务
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testCompleteTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 配置数据库相关信息 获取 ProcessEngineConfiguration</span>
        <span class="token class-name">ProcessEngineConfiguration</span> cfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StandaloneProcessEngineConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setJdbcUrl</span><span class="token punctuation">(</span><span class="token string">"jdbc:mysql://localhost:3306/flowable-learn?serverTimezone=UTC&amp;nullCatalogMeansCurrent=true"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setJdbcUsername</span><span class="token punctuation">(</span><span class="token string">"root"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setJdbcPassword</span><span class="token punctuation">(</span><span class="token string">"123456"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setJdbcDriver</span><span class="token punctuation">(</span><span class="token string">"com.mysql.cj.jdbc.Driver"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setDatabaseSchemaUpdate</span><span class="token punctuation">(</span><span class="token class-name">ProcessEngineConfiguration</span><span class="token punctuation">.</span><span class="token constant">DB_SCHEMA_UPDATE_TRUE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取流程引擎对象</span>
        <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> cfg<span class="token punctuation">.</span><span class="token function">buildProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">TaskService</span> taskService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getTaskService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Task</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> taskService<span class="token punctuation">.</span><span class="token function">createTaskQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">processDefinitionKey</span><span class="token punctuation">(</span><span class="token string">"holidayRequest"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">taskAssignee</span><span class="token punctuation">(</span><span class="token string">"lisi"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 添加流程变量</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> variables <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        variables<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"approved"</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 拒绝请假</span>
        <span class="token comment">// 完成任务</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Task</span> task <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            taskService<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>variables<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
</code></pre> 
<h3><a id="6_574"></a>6.流程删除</h3> 
<pre><code class="prism language-java">    <span class="token comment">/**
     * 删除流程
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testDeleteProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 配置数据库相关信息 获取 ProcessEngineConfiguration</span>
        <span class="token class-name">ProcessEngineConfiguration</span> cfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StandaloneProcessEngineConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setJdbcUrl</span><span class="token punctuation">(</span><span class="token string">"jdbc:mysql://localhost:3306/flowable-learn?serverTimezone=UTC&amp;nullCatalogMeansCurrent=true"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setJdbcUsername</span><span class="token punctuation">(</span><span class="token string">"root"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setJdbcPassword</span><span class="token punctuation">(</span><span class="token string">"123456"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setJdbcDriver</span><span class="token punctuation">(</span><span class="token string">"com.mysql.cj.jdbc.Driver"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setDatabaseSchemaUpdate</span><span class="token punctuation">(</span><span class="token class-name">ProcessEngineConfiguration</span><span class="token punctuation">.</span><span class="token constant">DB_SCHEMA_UPDATE_TRUE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取流程引擎对象</span>
        <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> cfg<span class="token punctuation">.</span><span class="token function">buildProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">RepositoryService</span> repositoryService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getRepositoryService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 删除流程定义，如果该流程定义已经有了流程实例启动则删除时报错</span>
        <span class="token comment">// repositoryService.deleteDeployment("1");</span>
        <span class="token comment">// 设置为true 级联删除流程定义，即使流程有实例启动，也可以删除;</span>
        <span class="token comment">// 设置为false 非级联删除操作。</span>
        repositoryService<span class="token punctuation">.</span><span class="token function">deleteDeployment</span><span class="token punctuation">(</span><span class="token string">"2501"</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//库中act_re_deployment表的主键值</span>

    <span class="token punctuation">}</span>
</code></pre> 
<h3><a id="7_600"></a>7.查看历史信息</h3> 
<pre><code class="prism language-java"><span class="token operator">-</span> 查看历史任务执行时间
<span class="token comment">/**
     * 查看历史
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testQueryHistory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 配置数据库相关信息 获取 ProcessEngineConfiguration</span>
        <span class="token class-name">ProcessEngineConfiguration</span> cfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StandaloneProcessEngineConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setJdbcUrl</span><span class="token punctuation">(</span><span class="token string">"jdbc:mysql://localhost:3306/flowable-learn?serverTimezone=UTC&amp;nullCatalogMeansCurrent=true"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setJdbcUsername</span><span class="token punctuation">(</span><span class="token string">"root"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setJdbcPassword</span><span class="token punctuation">(</span><span class="token string">"123456"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setJdbcDriver</span><span class="token punctuation">(</span><span class="token string">"com.mysql.cj.jdbc.Driver"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setDatabaseSchemaUpdate</span><span class="token punctuation">(</span><span class="token class-name">ProcessEngineConfiguration</span><span class="token punctuation">.</span><span class="token constant">DB_SCHEMA_UPDATE_TRUE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取流程引擎对象</span>
        <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> cfg<span class="token punctuation">.</span><span class="token function">buildProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">HistoryService</span> historyService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getHistoryService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HistoricActivityInstance</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> historyService<span class="token punctuation">.</span><span class="token function">createHistoricActivityInstanceQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">processDefinitionId</span><span class="token punctuation">(</span><span class="token string">"holidayRequest:3:5003"</span><span class="token punctuation">)</span> <span class="token comment">//act_re_procdef主键值</span>
                <span class="token punctuation">.</span><span class="token function">finished</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">orderByHistoricActivityInstanceEndTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">asc</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">HistoricActivityInstance</span> historicActivityInstance <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>historicActivityInstance<span class="token punctuation">.</span><span class="token function">getActivityId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" took "</span>
                    <span class="token operator">+</span> historicActivityInstance<span class="token punctuation">.</span><span class="token function">getDurationInMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" milliseconds"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p>学习打卡：Java学习笔记-day01-Flowable工作流入门</p> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c8337a631dc8057876da499edcec29f0/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">大模型训练踩坑记录</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7a9c4b0ef1ec8c8c931b04134b5a6c5c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">响应式编程Reactor优化Callback回调地狱</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>