<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Arduino IDE 开发ESP8266 上传DHT11温湿度数据至onenet - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Arduino IDE 开发ESP8266 上传DHT11温湿度数据至onenet" />
<meta property="og:description" content="#include &lt;ESP8266WiFi.h&gt; #include &lt;SimpleDHT.h&gt; //wifi配置 const char *ssid = &#34;9--202&#34;;//这里写入网络的ssid const char *password = &#34;*****&#34;;//wifi密码 const char *host = &#34;183.230.40.33&#34;;//修改为Server服务端的IP，即你电脑的IP，确保在同一网络之下。 WiFiClient client; const int tcpPort = 80;//修改为你建立的Server服务端的端口号，此端口号是创建服务器时指定的。 //DHT11配置 int pinDHT11 = 5; //IO5 SimpleDHT11 dht11(pinDHT11); byte temperature = 0; byte humidity = 0; void setup() { Serial.begin(115200); pinMode(LED_BUILTIN,OUTPUT); delay(10); Serial.println(); Serial.print(&#34;Connecting to &#34;);//会通过usb转tll模块发送到电脑，通过ide集成的串口监视器可以获取数据。 Serial.println(ssid); WiFi.begin(ssid, password);//启动 //在这里检测是否成功连接到目标网络，未连接则阻塞。 while (WiFi.status() != WL_CONNECTED) { delay(500); } //几句提示 Serial.println(&#34;&#34;); Serial.println(&#34;WiFi connected&#34;); Serial.println(&#34;IP address: &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/0f0c12c7f9f42dee976c1c0bc8ff7978/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-02-19T11:47:52+08:00" />
<meta property="article:modified_time" content="2022-02-19T11:47:52+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Arduino IDE 开发ESP8266 上传DHT11温湿度数据至onenet</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <pre><code class="language-python">#include &lt;ESP8266WiFi.h&gt;
#include &lt;SimpleDHT.h&gt;
//wifi配置
const char *ssid     = "9--202";//这里写入网络的ssid
const char *password = "*****";//wifi密码
const char *host = "183.230.40.33";//修改为Server服务端的IP，即你电脑的IP，确保在同一网络之下。
WiFiClient client;
const int tcpPort = 80;//修改为你建立的Server服务端的端口号，此端口号是创建服务器时指定的。

//DHT11配置
int pinDHT11 = 5;                  //IO5
SimpleDHT11 dht11(pinDHT11);
byte temperature = 0;
byte humidity = 0;

void setup()
{
    Serial.begin(115200);    
    pinMode(LED_BUILTIN,OUTPUT);
    delay(10);
    Serial.println();
    Serial.print("Connecting to ");//会通过usb转tll模块发送到电脑，通过ide集成的串口监视器可以获取数据。
    Serial.println(ssid);

    WiFi.begin(ssid, password);//启动

     //在这里检测是否成功连接到目标网络，未连接则阻塞。
    while (WiFi.status() != WL_CONNECTED)
    {
        delay(500);
    }

 //几句提示
    Serial.println("");
    Serial.println("WiFi connected");
    Serial.println("IP address: ");
    Serial.println(WiFi.localIP());
    
}


void loop()
{
    int err = SimpleDHTErrSuccess;
    if ((err = dht11.read(&amp;temperature, &amp;humidity, NULL)) != SimpleDHTErrSuccess) {
      Serial.print("Read DHT11 failed, err="); 
      Serial.println(err);
      delay(1000);
      return; }
      
    while (!client.connected())//若未连接到服务端，则客户端进行连接。
    {
        if (!client.connect(host, tcpPort))//实际上这一步就在连接服务端，如果连接上，该函数返回true
        {
            Serial.println("connection....");
            delay(500);

        }
    }
 
    if (client.connected()) {              //若连接成功，就发送POST 请求上报数据
    String url = "http://api.heclouds.com/devices/592465545/datapoints?type=3";  //参数type=3表示用 简洁数据格式,592465545是你在移动OneNET上创建的设备ID 不是产品的ID!!!! 一定要记住
    client.print(String("POST ")+url+" HTTP/1.1\r\n");                                                 //使用HTTP/1.1协议
    client.print(String("api-key: ")+"qr=zgFg5mVp8f9poMK5Wq0BtBKg=\r\n");             //一定要改为设备的API key，不是产品的API key!!!! 一定要记住
    client.print(String("Host: ")+"api.heclouds.com\r\n");
    client.print("Connection: close\r\n");

      uint8_t tem= temperature;
      uint8_t hum= humidity;
      String data = "{'SoilHUM':" + String(hum) + ",'TEM':"+  String(tem) + "}";
      client.print("Content-Length:"+ String(data.length()) + "\r\n\r\n");
      client.print(data);
  }
  client.stop();                     //关闭HTTP客户端
  delay(10000);   
    while (client.available())//available()表示是否可以获取到数据
    {
      //控制led
//        char val = client.read();//read()表示从网络中读取数据。
//        if(val=='a'){//pc端发送a和b来控制
//           digitalWrite(led, LOW);
//        }
//        if(val=='b')
//        {
//            digitalWrite(led, HIGH);
//        }

      //透传数据
      uint8_t c = client.read();
      Serial.write(c);

    }
 if (Serial.available())//串口读取到的转发到wifi，因为串口是一位一位的发送所以在这里缓存完再发送
  {
      delay(50);//加50ms延迟 保证串口字符接收完毕
      size_t counti = Serial.available();//串口缓冲器 返回的是缓冲区准确的可读字节数
      uint8_t sbuf[counti];
      Serial.readBytes(sbuf, counti);//从串口读取指定长度counti的字符到缓存数组sbuf。
      delay(50);//加50ms延迟 保证缓存完毕
      client.write(sbuf, counti);

  }



}

</code></pre> 
<p>实际效果：</p> 
<p><img alt="" height="474" src="https://images2.imgbox.com/d9/b6/4xm7DShV_o.png" width="1119"></p> 
<p>参考链接：</p> 
<p><a href="https://shop415608415.taobao.com/search.htm?spm=2013.1.w4023-22569760052.18.209b5dadzkMJ8Y&amp;orderType=hotsell_desc" rel="nofollow" title="https://shop415608415.taobao.com/search.htm?spm=2013.1.w4023-22569760052.18.209b5dadzkMJ8Y&amp;orderType=hotsell_desc">https://shop415608415.taobao.com/search.htm?spm=2013.1.w4023-22569760052.18.209b5dadzkMJ8Y&amp;orderType=hotsell_desc</a></p> 
<h3></h3>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/843400fd602f31efb3a87512d5e9e6fe/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">级联选择器el-cascader ——实现树形数据下的，选择任意一级和只展示选中的数据</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2d7c968b7eb43318abf1b6c765791939/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Unity基础学习六，网络同步</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>