<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>小程序利用camera组件自定义扫码功能 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="小程序利用camera组件自定义扫码功能" />
<meta property="og:description" content="最近有个需求，小程序的一个扫码页面，扫码界面一直开着，同时可以处理其他功能，如下：
由于直接调用微信的scanCode，无法自定义界面，所以只能使用原生组件camera，完成这个功能，关于扫描框的四个角的图片，就自己画一下吧，中间的移动横线，使用了小程序的动画功能，在原生camera组件上，覆盖需要用到cover-view和cover-image，同时加入了提示音
scan.wxss /**scan.wxss**/ .scan-view { width: 100%; height: 100%; display: flex; flex-direction: column; background-color: #B9BEC4; position: fixed; align-items: center; justify-content: space-around; } .scan-border { width: 94%; height: 94%; border: 6rpx solid #08FDFE; border-radius: 10rpx; display: flex; flex-direction: column; align-items: center; } .scan-camera { width: 500rpx; height: 500rpx; border-radius: 6rpx; margin: 30rpx; } .cover-corner { width: 80rpx; height: 80rpx; position: absolute; } .cover-left-top { left: 0; top: 0; } ." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/9d634c19063fb975f6eeb27b7d9ebdf9/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-05-18T20:09:24+08:00" />
<meta property="article:modified_time" content="2019-05-18T20:09:24+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">小程序利用camera组件自定义扫码功能</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-dracula">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>最近有个需求，小程序的一个扫码页面，扫码界面一直开着，同时可以处理其他功能，如下：<br> <img src="https://images2.imgbox.com/fa/df/0NU7UGZk_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/d7/36/RhpMEM4e_o.png" alt="在这里插入图片描述"> <img src="https://images2.imgbox.com/f1/6f/TcEcJ905_o.png" alt="在这里插入图片描述"> <img src="https://images2.imgbox.com/8d/bb/z85UzJag_o.png" alt="在这里插入图片描述"> <img src="https://images2.imgbox.com/82/12/t1IfPohI_o.png" alt="在这里插入图片描述"><br> 由于直接调用微信的scanCode，无法自定义界面，所以只能使用原生组件camera，完成这个功能，关于扫描框的四个角的图片，就自己画一下吧，中间的移动横线，使用了小程序的动画功能，在原生camera组件上，覆盖需要用到cover-view和cover-image，同时加入了提示音</p> 
<h3><a id="scanwxss_5"></a>scan.wxss</h3> 
<pre><code>/**scan.wxss**/
.scan-view {
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  background-color: #B9BEC4;
  position: fixed;
  align-items: center;
  justify-content: space-around;
}

.scan-border {
  width: 94%;
  height: 94%;
  border: 6rpx solid #08FDFE;
  border-radius: 10rpx;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.scan-camera {
  width: 500rpx;
  height: 500rpx;
  border-radius: 6rpx;
  margin: 30rpx;
}

.cover-corner {
  width: 80rpx;
  height: 80rpx;
  position: absolute;
}

.cover-left-top {
  left: 0;
  top: 0;
}

.cover-right-top {
  right: 0;
  top: 0;
}

.cover-left-bottom {
  left: 0;
  bottom: 0;
}

.cover-right-bottom {
  right: 0;
  bottom: 0;
}

.scan-animation {
  position: absolute;
  top: -10rpx;
  left: 10rpx;
  width: 480rpx;
  height: 8rpx;
  background-color: #08FDFE;
  border-radius: 50%;
}
</code></pre> 
<h3><a id="scanwxml_74"></a>scan.wxml</h3> 
<pre><code>&lt;!--scan.wxml--&gt;
&lt;view class="scan-view"&gt;
  &lt;view class='scan-border'&gt;
    
    &lt;camera class='scan-camera' mode="scanCode" binderror="cameraError" bindscancode='scancode' frame-size='large'&gt;
      &lt;cover-image class='cover-corner cover-left-top' src='/images/left-top.png'&gt;&lt;/cover-image&gt;
      &lt;cover-image class='cover-corner cover-right-top' src='/images/right-top.png'&gt;&lt;/cover-image&gt;
      &lt;cover-image class='cover-corner cover-left-bottom' src='/images/left-bottom.png'&gt;&lt;/cover-image&gt;
      &lt;cover-image class='cover-corner cover-right-bottom' src='/images/right-bottom.png'&gt;&lt;/cover-image&gt;
      
      &lt;cover-view class='scan-animation' animation="{<!-- -->{animation}}"&gt;&lt;/cover-view&gt;
    &lt;/camera&gt;
    &lt;!-- 这里可以处理其他内容 --&gt;
  &lt;/view&gt;
&lt;/view&gt;

</code></pre> 
<h3><a id="scanjs_95"></a>scan.js</h3> 
<pre><code>// scan.js
// 移动动画
let animation = wx.createAnimation({});
// 提示音
let innerAudioContext = wx.createInnerAudioContext()
innerAudioContext.src = '/images/beep.mp3'

Page({
  data: {
    
  },
  onLoad: function () {
    
  },
  onShow(){
    this.donghua()
  },
  donghua(){
    var that = this;
	// 控制向上还是向下移动
    let m = true
	
    setInterval(function () {
      if (m) {
        animation.translateY(250).step({ duration: 3000 })
        m = !m;
      } else {
        animation.translateY(-10).step({ duration: 3000 })
        m = !m;
      }

      that.setData({
        animation: animation.export()
      })
    }.bind(this), 3000)
  },
  scancode(e){
    // 提示音
    innerAudioContext.play()
    // 校验扫描结果，并处理
    let res = e.detail.result
  }
})

</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/56ab3749c64d5fda121879e7f7961d1e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">opkg 更新软件</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/fb3566ddc2a780e88f6cd14c15cbcf27/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">如何spingboot中简单的使用springcache缓存存取和查询数据</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>