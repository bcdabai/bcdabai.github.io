<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【SpringCloud】SpringCloud Gateway详解 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【SpringCloud】SpringCloud Gateway详解" />
<meta property="og:description" content="目录 前言SpringCloud Gatewy网关一.网关功能和工作原理二.网关的类型三.搭建网关四.路由断言工厂(Route Predicate Factory)五.路由过滤器(属于GatewayFilter)六.DefaultFilter过滤器(属于GatewayFilter)七.全局过滤器(GlobalFilter)八.过滤器执行顺序九.Gateway解决跨域问题 前言 微服务分为多个服务，有很多服务是内部人员要用的，但是现在谁都可以访问到，那我们该怎么办呢？
Spring Cloud最新面试题
Spring Cloud Nacos详解之注册中心
Spring Cloud Nacos详解之配置中心
Spring Cloud Nacos详解之集群配置
Spring Cloud Eureka详解
Spring Cloud Frign详解
Spring Cloud Ribbon详解
Spring Cloud Hystrix详解
SpringCloud Gatewy网关 一.网关功能和工作原理 二.网关的类型 Gateway
响应式编程，具有更好的性能。
Zuul
阻塞式编程。
三.搭建网关 1.创建一个新的服务
2.添加网关依赖和nacos服务发现依赖
&lt;!--nacos服务注册发现依赖--&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--网关gateway依赖--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-gateway&lt;/artifactId&gt; &lt;/dependency&gt; 3.编写yml配置文件
server: port: 10086 #端口号 spring: application: name: gateway #服务名称 cloud: nacos: server-addr: localhost:8848 # nacos地址 gateway: routes: - id: user-service # 路由id，必须唯一。 用户服务 uri: lb://userservice # 路由的目标地址,lb是负载均衡。 # uri: http://127." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/e2a119149847038fdec7970621ffff19/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-03-20T09:14:18+08:00" />
<meta property="article:modified_time" content="2023-03-20T09:14:18+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【SpringCloud】SpringCloud Gateway详解</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#_1" rel="nofollow">前言</a></li><li><a href="#SpringCloud_Gatewy_13" rel="nofollow">SpringCloud Gatewy网关</a></li><li><ul><li><a href="#_14" rel="nofollow">一.网关功能和工作原理</a></li><li><a href="#_18" rel="nofollow">二.网关的类型</a></li><li><a href="#_26" rel="nofollow">三.搭建网关</a></li><li><a href="#Route_Predicate_Factory_72" rel="nofollow">四.路由断言工厂(Route Predicate Factory)</a></li><li><a href="#GatewayFilter_88" rel="nofollow">五.路由过滤器(属于GatewayFilter)</a></li><li><a href="#DefaultFilterGatewayFilter_129" rel="nofollow">六.DefaultFilter过滤器(属于GatewayFilter)</a></li><li><a href="#GlobalFilter_149" rel="nofollow">七.全局过滤器(GlobalFilter)</a></li><li><a href="#_199" rel="nofollow">八.过滤器执行顺序</a></li><li><a href="#Gateway_220" rel="nofollow">九.Gateway解决跨域问题</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="_1"></a>前言</h2> 
<p>微服务分为多个服务，有很多服务是内部人员要用的，但是现在谁都可以访问到，那我们该怎么办呢？</p> 
<p><a href="https://blog.csdn.net/twotwo22222/article/details/129291109?spm=1001.2014.3001.5502">Spring Cloud最新面试题</a><br> <a href="https://blog.csdn.net/twotwo22222/article/details/129352031?spm=1001.2014.3001.5502">Spring Cloud Nacos详解之注册中心</a><br> <a href="https://blog.csdn.net/twotwo22222/article/details/129387370?spm=1001.2014.3001.5502">Spring Cloud Nacos详解之配置中心</a><br> <a href="https://blog.csdn.net/twotwo22222/article/details/129408652?spm=1001.2014.3001.5502">Spring Cloud Nacos详解之集群配置</a><br> <a href="https://blog.csdn.net/twotwo22222/article/details/129328431?spm=1001.2014.3001.5502">Spring Cloud Eureka详解</a><br> <a href="https://blog.csdn.net/twotwo22222/article/details/129319448?spm=1001.2014.3001.5502">Spring Cloud Frign详解</a><br> <a href="https://blog.csdn.net/twotwo22222/article/details/129337821?spm=1001.2014.3001.5502">Spring Cloud Ribbon详解</a><br> <a href="https://blog.csdn.net/twotwo22222/article/details/129430058?spm=1001.2014.3001.5501">Spring Cloud Hystrix详解</a></p> 
<h2><a id="SpringCloud_Gatewy_13"></a>SpringCloud Gatewy网关</h2> 
<h3><a id="_14"></a>一.网关功能和工作原理</h3> 
<p><img src="https://images2.imgbox.com/17/ea/K8oxdENZ_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_18"></a>二.网关的类型</h3> 
<ul><li> <p><strong>Gateway</strong><br> 响应式编程，具有更好的性能。</p> </li><li> <p><strong>Zuul</strong><br> 阻塞式编程。</p> </li></ul> 
<h3><a id="_26"></a>三.搭建网关</h3> 
<p><strong>1.创建一个新的服务</strong></p> 
<p><img src="https://images2.imgbox.com/97/55/xkzscWXl_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/b2/7b/TnnwMkp0_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/61/3a/hOMdd4X3_o.png" alt="在这里插入图片描述"></p> 
<p><strong>2.添加网关依赖和nacos服务发现依赖</strong></p> 
<pre><code class="prism language-yaml">		&lt;<span class="token tag">!--nacos</span>服务注册发现依赖<span class="token punctuation">-</span><span class="token punctuation">-</span><span class="token punctuation">&gt;</span><span class="token scalar string">
        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt;
        &lt;/dependency&gt;</span>
        
        &lt;<span class="token tag">!--</span>网关gateway依赖<span class="token punctuation">-</span><span class="token punctuation">-</span><span class="token punctuation">&gt;</span><span class="token scalar string">
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-gateway&lt;/artifactId&gt;
        &lt;/dependency&gt;</span>
</code></pre> 
<p>3.编写yml配置文件</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">10086</span>  <span class="token comment">#端口号</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> gateway <span class="token comment">#服务名称</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span> <span class="token comment"># nacos地址</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span> 
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> user<span class="token punctuation">-</span>service <span class="token comment"># 路由id，必须唯一。  用户服务</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//userservice <span class="token comment"># 路由的目标地址,lb是负载均衡。 </span>
          <span class="token comment"># uri: http://127.0.0.1/user/1   也可以使用这种，但是这种就固定了路由地址，就不能负载均衡了。</span>
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span> <span class="token comment"># 路由断言，判断请求是否符合规则，符合就转发到目的路由。可以配置多个规则</span>
            <span class="token punctuation">-</span> Path=/user/<span class="token important">**</span> <span class="token comment"># 路径断言，判断路径是否是以/user开头，如果是则符合。</span>
       <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> order<span class="token punctuation">-</span>service  <span class="token comment"># 订单服务</span>
         <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//orderservice
         <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
           <span class="token punctuation">-</span> Path=/order/<span class="token important">**</span>
</code></pre> 
<h3><a id="Route_Predicate_Factory_72"></a>四.路由断言工厂(Route Predicate Factory)</h3> 
<p><a href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#gateway-request-predicates-factories" rel="nofollow">官网示例</a></p> 
<table><thead><tr><th>属性</th><th>描述</th><th>示例</th></tr></thead><tbody><tr><td>After</td><td>是某个时间点之后的请求</td><td>-After=2023-01-01T17:42:47.789-07:00[America/Denver] <br>(必须在2023年1月1日17点42分47秒之后发的请求才能通过，根据美国丹佛[America/Denver]的时间算)</td></tr><tr><td>Before</td><td>是某个时间点之前的请求</td><td>-Before=2022-02-22T22:22:22.433+8:00[Asia/Shanghai] <br>(必须在2022年2月22日22时22分22秒之前发的请求才能通过，根据[Asia/Shanghai]上海时间算)</td></tr><tr><td>Between</td><td>是某两个时间点之前的请求</td><td>-Between=时间[时区]，时间[时区]</td></tr><tr><td>Cookie</td><td>请求必须包含某些cookie</td><td>- Cookie=ikun, rap</td></tr><tr><td>Header</td><td>请求必须包含某些header</td><td>- Header=X-Request-Id,\d+</td></tr><tr><td>Host</td><td>请求必须是访问某个host(域名)</td><td>- Host=**.kunkun,**com.cn</td></tr><tr><td>Method</td><td>请求方式必须是指定方式</td><td>-Method=GETPOST</td></tr><tr><td>Path</td><td>请求路径必须符合指定规则</td><td>-path=user/**</td></tr><tr><td>Query</td><td>请求参数必须包含指定参数</td><td>Query=ikun</td></tr><tr><td>RemoteAddr</td><td>请求者的ip必须是指定范围</td><td>- RemoteAddr=192.168.1.1/24</td></tr><tr><td>Weight</td><td>权重处理</td><td></td></tr></tbody></table> 
<h3><a id="GatewayFilter_88"></a>五.路由过滤器(属于GatewayFilter)</h3> 
<p><strong>对进入网关的请求和微服务返回的响应做处理。比如：添加请求头。</strong><br> <a href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#gatewayfilter-factories" rel="nofollow">官网示例</a></p> 
<p><strong>1.配置网关服务yml文件</strong></p> 
<pre><code class="prism language-yaml">路由过滤器：对当前路由生效。
<span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">10086</span>  <span class="token comment">#端口号</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> gateway <span class="token comment">#服务名称</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span> 
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> user<span class="token punctuation">-</span>service <span class="token comment"># 路由id，必须唯一。  用户服务</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//userservice <span class="token comment"># 路由的目标地址,lb是负载均衡。 </span>
          <span class="token comment"># uri: http://127.0.0.1/user/1   也可以使用这种，但是这种就固定了路由地址，就不能负载均衡了。</span>
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span> <span class="token comment"># 路由断言，判断请求是否符合规则，符合就转发到目的路由。可以配置多个规则</span>
            <span class="token punctuation">-</span> Path=/user/<span class="token important">**</span> <span class="token comment"># 路径断言，判断路径是否是以/user开头，如果是则符合。</span>
		  <span class="token key atrule">filters</span><span class="token punctuation">:</span>
        	<span class="token punctuation">-</span> AddRequestHeader=Ikun<span class="token punctuation">,</span>ji ni tai mei<span class="token tag">!</span>  <span class="token comment"># 添加请求头，针对某个服务生效。</span>
</code></pre> 
<p><strong>2.在添加请求头的服务编写代码</strong></p> 
<pre><code class="prism language-java">	在用户服务的controller里面写
	<span class="token comment">/**
     * @param id 用户id
     * @return 用户
     */</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/{id}"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">queryById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> id<span class="token punctuation">,</span>
                          <span class="token annotation punctuation">@RequestHeader</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"Ikun"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token class-name">String</span> ikun<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Ikun最喜欢的歌是什么："</span> <span class="token operator">+</span> ikun<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> userService<span class="token punctuation">.</span><span class="token function">queryById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>然后访问 <code>localhost:10086/user/1</code>,控制台就会打印 ikun 的值。<br> <img src="https://images2.imgbox.com/81/85/TxOLfCTw_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="DefaultFilterGatewayFilter_129"></a>六.DefaultFilter过滤器(属于GatewayFilter)</h3> 
<pre><code class="prism language-yaml">DefaultFilter：对所有路由都生效。
<span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">10086</span>  <span class="token comment">#端口号</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> gateway <span class="token comment">#服务名称</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span> 
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> user<span class="token punctuation">-</span>service <span class="token comment"># 路由id，必须唯一。  用户服务</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//userservice <span class="token comment"># 路由的目标地址,lb是负载均衡。 </span>
          <span class="token comment"># uri: http://127.0.0.1/user/1   也可以使用这种，但是这种就固定了路由地址，就不能负载均衡了。</span>
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span> <span class="token comment"># 路由断言，判断请求是否符合规则，符合就转发到目的路由。可以配置多个规则</span>
            <span class="token punctuation">-</span> Path=/user/<span class="token important">**</span> <span class="token comment"># 路径断言，判断路径是否是以/user开头，如果是则符合。</span>
	   <span class="token key atrule">default-filters</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> AddRequestHeader=Ikun<span class="token punctuation">,</span>ji ni tai mei<span class="token tag">!</span>  <span class="token comment">#添加请求头，全局生效</span>
</code></pre> 
<h3><a id="GlobalFilter_149"></a>七.全局过滤器(GlobalFilter)</h3> 
<p><strong>对进入网关的请求和微服务返回的响应做处理。和GatewayFilter作用一样</strong></p> 
<p>因为GatewayFilter是<strong>基于配置实现</strong>，处理的逻辑是固定的，GlobalFilte<strong>r基于代码逻辑实现</strong>，更加灵活一些，可以用于验证用户身份等功能。</p> 
<p><strong>1.实现GlobalFilter接口</strong></p> 
<pre><code class="prism language-java">验证身份信息，根据authorization的值是否是ikun
<span class="token comment">// @Order(-1) 注解方式实现，如果有多个过滤器，越小越早走。</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AuthorizeFilter</span> <span class="token keyword">implements</span> <span class="token class-name">GlobalFilter</span><span class="token punctuation">,</span> <span class="token class-name">Ordered</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">ServerWebExchange</span> exchange<span class="token punctuation">,</span> <span class="token class-name">GatewayFilterChain</span> chain<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 1.获取请求参数</span>
        <span class="token class-name">ServerHttpRequest</span> request <span class="token operator">=</span> exchange<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">MultiValueMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> params <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getQueryParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2.获取参数中的 authorization 参数</span>
        <span class="token class-name">String</span> auth <span class="token operator">=</span> params<span class="token punctuation">.</span><span class="token function">getFirst</span><span class="token punctuation">(</span><span class="token string">"authorization"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3.判断参数值是否等于 ikun</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"ikun"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>auth<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 4.是，放行</span>
            <span class="token keyword">return</span> chain<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>exchange<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 5.否，拦截</span>
        <span class="token comment">// 5.1.设置状态码，未登录</span>
        exchange<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setStatusCode</span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token punctuation">.</span>UNAUTHORIZED<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 5.2.拦截请求</span>
        <span class="token keyword">return</span> exchange<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

	<span class="token comment">/**
	* 代码方式实现，实现 Ordered 接口，多个过滤器，返回值越小，越早走。
	**/</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>2.验证身份</strong></p> 
<p><strong>(1) 如果authorization 参数不等于ikun或没有都会报错。</strong><br> <img src="https://images2.imgbox.com/cb/d2/T7A5RLno_o.png" alt="在这里插入图片描述"></p> 
<p><strong>(2) authorization 参数等于 ikun正常访问。</strong><br> <img src="https://images2.imgbox.com/99/ee/A93kJVI9_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_199"></a>八.过滤器执行顺序</h3> 
<p>请求路由后，会将当前路由过滤器和DefaultFilter、GlobalFilter，合并到一个过滤链(集合)中，排序后依次执行每个过滤器**(DefaultFilter -&gt; 路由过滤器 -&gt; GlobalFilter)**。</p> 
<p><strong>1.为什么不是同一个过滤器可以放在一个过滤链中呢？由下面可得这三个过滤器本质上都是<code>GatewayFilter</code></strong></p> 
<p>DefaultFilter 和 路由过滤器的实现都是 <code>AddRequestHeaderGatewayFilterFactory</code> 类，最后会生成一个真正的过滤器(<code>GatewayFilter</code>)。<br> <img src="https://images2.imgbox.com/0e/54/9as3wmFf_o.png" alt="在这里插入图片描述"></p> 
<p>GlobalFilter的实现是通过 <code>GatewayFilterAdapter</code> 适配器类实现了<code>GatewayFilter</code>，然后就可以把GlobalFilter适配成<code>GatewayFilter</code>。<br> <img src="https://images2.imgbox.com/40/dc/uebS6gI3_o.png" alt="在这里插入图片描述"></p> 
<p><strong>2.路由过滤器和DefaultFilter怎么设置@Order顺序呢？</strong></p> 
<p>由spring指定order，按声明顺序1开始递增。</p> 
<p><img src="https://images2.imgbox.com/e2/e1/uzu89ggE_o.png" alt="在这里插入图片描述"></p> 
<p><strong>扩展：</strong></p> 
<ul><li>org.springframework.cloud.gateway.route.RouteDefinitionRouteLocator#getFilters()方法是先加载defaultFilters，然后再加载某个route的filters，然后合并。</li><li>org.springframework.cloud.gateway.handler.FilteringlWebHandler#handle()方法会加载全局过滤器与前面的过滤器合并后根据order排序，组织过滤器链。</li></ul> 
<h3><a id="Gateway_220"></a>九.Gateway解决跨域问题</h3> 
<p><strong>跨域:</strong> 浏览器禁止请求的发起者与服务端发生跨域ajax请求，请求被浏览器拦截的问题。<br> <strong>解决：</strong> 采用CORS方案，网关处理跨域采用的同样是CORS方案。(简单来说就是浏览器询问服务端让不让这个请求跨域，如果让会返回结果)。</p> 
<pre><code class="prism language-yaml">在yml文件配置以下内容
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
	<span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">globalcors</span><span class="token punctuation">:</span> <span class="token comment"># 全局的跨域处理</span>
        <span class="token key atrule">add-to-simple-url-handler-mapping</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># 解决options请求被拦截问题(浏览器去询问服务端的请求就是options)</span>
        <span class="token key atrule">corsConfigurations</span><span class="token punctuation">:</span>
          <span class="token key atrule">'[/**]'</span><span class="token punctuation">:</span>
            <span class="token key atrule">allowedOrigins</span><span class="token punctuation">:</span>  <span class="token comment"># 允许哪些网站的跨域请求</span>
              <span class="token punctuation">-</span><span class="token string">"http://localhost:8888"</span>
              <span class="token punctuation">-</span><span class="token string">"http://www.ikun.com"</span>
            <span class="token key atrule">allowedMethods</span><span class="token punctuation">:</span> <span class="token comment"># 允许的跨域ajax的请求方式          </span>
              <span class="token punctuation">-</span><span class="token string">"GET"</span>
			  <span class="token punctuation">-</span><span class="token string">"POST"</span>
		      <span class="token punctuation">-</span><span class="token string">"DELETE"</span>
			  <span class="token punctuation">-</span><span class="token string">"PUT"</span>
			  <span class="token punctuation">-</span><span class="token string">"OPTIONS"</span>
			<span class="token key atrule">allowedHeaders</span><span class="token punctuation">:</span> <span class="token string">"*"</span> <span class="token comment"># 允许请求头跨域</span>
			<span class="token key atrule">allowCredentials</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># 是否允许携带cookie</span>
			<span class="token key atrule">maxAge</span><span class="token punctuation">:</span> <span class="token number">360000</span> <span class="token comment"># 这次跨域检测的有效期</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/03a596b48b995c6d67b461bd3bf2c66c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">计算机课程设计大全 十万套源码可选【Java、.Net、Python等】</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c59e4d30432d2543146247a0730e9db0/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Win10和Win11设置开机默认开启数字小键盘</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>