<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>HIVE函数讲解之单行函数、聚合函数、炸裂函数、窗口函数 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="HIVE函数讲解之单行函数、聚合函数、炸裂函数、窗口函数" />
<meta property="og:description" content="Hive是基于Hadoop的一个数据仓库工具，可以将结构化的数据文件映射为一张数据库表，并提供简单的SQL查询功能，可以将SQL语句转换为MapReduce任务进行运行。其优点是学习成本低，可以通过类SQL语句快速实现简单的MapReduce统计，不必开发专门的MapReduce应用，十分适合数据仓库的统计分析。
Hive会将常用的逻辑封装成函数给用户进行使用，类似于Java中的函数。好处在于可以避免用户反复写逻辑，可以直接拿来使用。重点在于用户需要知道函数叫什么，能做什么。
Hive函数大致分为五类：单行函数、聚合函数、炸裂函数、窗口函数、自定义函数，今天我们主要介绍一下除自定义函数外的函数部分案例使用。
自定义函数咱们之前已经细致的讲过了，可以根据连接查看：HIVE函数讲解之自定义函数
一、单行函数
单行函数的特点是一进一出，大致可以分为数学函数，日期函数，字符串函数，流程控制函数，集合函数。
1. 数学函数
数学函数针对于数值形式的计算，返回值均为数值类型。
示例：
select 1 &#43; 1; 2
select 1 - 1; 0
select 2 * 2; 4
select 3 / 2; 1.5
select 5 % 2; 1
select 1 &amp; 2; 0
select 1 | 2; 3
select 1 ^ 2; 3
select ~1; -2
2. 日期函数
① unix_timestamp(string time)：返回值为bigint类型。
select unix_timestamp(&#39;2023-04-06 15:31:26&#39;);
1680795086
② from_unixtime(bigint time [,string format])：返回值为
string类型。
select from_unixtime(1680795086);" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/171092146958d4390ac02ad946f2aeda/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-06-12T10:16:42+08:00" />
<meta property="article:modified_time" content="2023-06-12T10:16:42+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">HIVE函数讲解之单行函数、聚合函数、炸裂函数、窗口函数</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>Hive是基于Hadoop的一个数据仓库工具，可以将结构化的数据文件映射为一张数据库表，并提供简单的SQL查询功能，可以将SQL语句转换为MapReduce任务进行运行。其优点是学习成本低，可以通过类SQL语句快速实现简单的MapReduce统计，不必开发专门的MapReduce应用，十分适合数据仓库的统计分析。</p> 
<p>Hive会将常用的逻辑封装成函数给用户进行使用，类似于Java中的函数。好处在于可以避免用户反复写逻辑，可以直接拿来使用。重点在于用户需要知道函数叫什么，能做什么。</p> 
<p>Hive函数大致分为五类：单行函数、聚合函数、炸裂函数、窗口函数、自定义函数，今天我们主要介绍一下除自定义函数外的函数部分案例使用。</p> 
<p>自定义函数咱们之前已经细致的讲过了，可以根据连接查看：HIVE函数讲解之自定义函数</p> 
<p><strong>一、单行函数</strong></p> 
<p>单行函数的特点是一进一出，大致可以分为数学函数，日期函数，字符串函数，流程控制函数，集合函数。</p> 
<p><strong>1. 数学函数</strong></p> 
<p></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/24/86/wteeFOUQ_o.png"></p> 
<p> </p> 
<p>数学函数针对于数值形式的计算，返回值均为数值类型。</p> 
<p>示例：</p> 
<p>select 1 + 1; 2</p> 
<p>select 1 - 1; 0</p> 
<p>select 2 * 2; 4</p> 
<p>select 3 / 2; 1.5</p> 
<p>select 5 % 2; 1</p> 
<p>select 1 &amp; 2; 0</p> 
<p>select 1 | 2; 3</p> 
<p>select 1 ^ 2; 3</p> 
<p>select ~1; -2</p> 
<p><strong>2. 日期函数</strong></p> 
<p></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/8a/6a/gkI9psF2_o.png"></p> 
<p> </p> 
<p>① unix_timestamp(string time)：返回值为bigint类型。</p> 
<p>select unix_timestamp('2023-04-06 15:31:26');</p> 
<p>1680795086</p> 
<p>② from_unixtime(bigint time [,string format])：返回值为</p> 
<p>string类型。</p> 
<p>select from_unixtime(1680795086);</p> 
<p>2023-04-06 15:31:26</p> 
<p>③ year(string time)：返回值为int类型。</p> 
<p>select year('2023-04-06 15:31:26');</p> 
<p>2023</p> 
<p>④ month(string time)：返回值为int类型。</p> 
<p>select month('2023-04-06 15:31:26');</p> 
<p>4</p> 
<p>⑤ day(string time)：返回值为int类型。</p> 
<p>select day('2023-04-06 15:31:26');</p> 
<p>6</p> 
<p>⑥ datediff(string time,string time)：返回值类型为int类型。</p> 
<p>select datediff('2023-04-07','2023-04-06');</p> 
<p>1</p> 
<p>⑦ date_add(string date,int day)：返回值为date类型。</p> 
<p>select date_add('2023-04-06',1);</p> 
<p>2023-04-07</p> 
<p>⑧ date_sub(string date,int day)：返回值为date类型。</p> 
<p>select date_sub('2023-04-06',1);</p> 
<p>2023-04-05</p> 
<p>⑨ date_format(string date,string format)：返回值为string类型。</p> 
<p>select date_format('2023-04-06 15:45:25','yyyy-MM-dd');</p> 
<p>2023-04-06</p> 
<p><strong>3. 字符串函数</strong></p> 
<p></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/e5/57/fBUbBsm4_o.png"></p> 
<p> </p> 
<p>① upper(string str)：返回值为string类型。</p> 
<p>select upper('abc');</p> 
<p>ABC</p> 
<p>② lower(string str)：返回值为string类型。</p> 
<p>select lower('ABC');</p> 
<p>abc</p> 
<p>③ length(string str)：返回值为int类型。</p> 
<p>select length('atguigu');</p> 
<p>7</p> 
<p>④ trim(string str)：返回值为string类型。</p> 
<p>select trim(' abc ');</p> 
<p>abc</p> 
<p>⑤ substring(string str,int start[,int end])：返回值为string类型。</p> 
<p>select substring('atguigu',2,5);</p> 
<p>tguig</p> 
<p>⑥ replace(string str,string bef,string las)：返回值为string类型。</p> 
<p>select replace('atguigu','a','b');</p> 
<p>btguigu</p> 
<p>⑦ split(string str,string par)：返回值为array类型。</p> 
<p>select split('atguigu','g');</p> 
<p>["at","ui","u"]</p> 
<p>⑧concat_ws(string spl,string s1,string s2,...)：返回值为string类型。</p> 
<p>select concat_ws('-','a','b','c');</p> 
<p>a-b-c</p> 
<p>⑨ get_json_object(string json,string path)：返回值为string类型。</p> 
<p>select get_json_object('{"data1":1,"data2":2}','$.data2');</p> 
<p>2</p> 
<p><strong>4. 流程控制函数</strong></p> 
<p></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/26/42/IESQcFtV_o.png"></p> 
<p> </p> 
<p>示例：</p> 
<p>select case 100 when 50 then 'tom' when 100 then 'mary' else 'tim' end;</p> 
<p>mary</p> 
<p>select if(2&gt;3,2,3);</p> 
<p>3</p> 
<p><strong>5. 集合函数</strong></p> 
<p></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/f7/c6/VdzTSCGY_o.png"></p> 
<p> </p> 
<p>① size(array/map m)：返回值为int类型。</p> 
<p>select size(array('a','b','c'));</p> 
<p>3</p> 
<p>② map_keys(map m)：返回值为array类型。</p> 
<p>select map_keys(test) from test;</p> 
<p>[1,2,3]</p> 
<p>test字段值为{"1":"a","2":"b","3","c"}</p> 
<p>③ map_values(map m)：返回值为array类型。</p> 
<p>select map_values(test) from test;</p> 
<p>["a","b","c"]</p> 
<p>④ array_contains(array arr,string str)：返回值为boolean类型。</p> 
<p>select array_contains(array('1','2','3'),'4');</p> 
<p>false</p> 
<p>⑤ sort_array(array arr)：返回值为array类型。</p> 
<p>select sort_array(array(4,2,3,1));</p> 
<p>[1,2,3,4]</p> 
<p><strong>二、聚合函数</strong></p> 
<p>聚合函数对一组数据进行计算，并返回单个值。</p> 
<p>测试数据test表：</p> 
<p></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/f6/d3/2ZkaFOHT_o.png"></p> 
<p> </p> 
<p><strong>1. 普通聚合</strong></p> 
<p></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/f4/ad/qWDcfQ0O_o.png"></p> 
<p> </p> 
<p>示例：</p> 
<p>select count(*) from test;</p> 
<p>4</p> 
<p>select sum(score) from test;</p> 
<p>260</p> 
<p>select max(score) from test;</p> 
<p>80</p> 
<p>select min(score) from test;</p> 
<p>50</p> 
<p>select avg(score) from test;</p> 
<p>65</p> 
<p><strong>2. 高级聚合</strong></p> 
<p></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/f7/a4/wxlsrWcF_o.png"></p> 
<p> </p> 
<p>示例：</p> 
<p>select collect_list(name) from test;</p> 
<p>["atguigu1","atguigu2","atguigu3","atguigu3"]</p> 
<p>select collect_set(name) from test;</p> 
<p>["atguigu1","atguigu2","atguigu3"]</p> 
<p><strong>3. 分组</strong></p> 
<p>Group By语句通常会和聚合函数一起使用，按照一个或者多个列队结果进行分组，然后对每个组执行聚合操作，同时可以使用having进行过滤。</p> 
<p>示例：</p> 
<p>select</p> 
<p>id,</p> 
<p>avg(score) avg_s</p> 
<p>from test</p> 
<p>group by id</p> 
<p>having avg_s &gt; 60;</p> 
<p><strong>三、炸裂函数</strong></p> 
<p>Hive处理的数据字段是可再分的，不满足原子性，即DDL可以定义一个字段类型为数组，因此才有了explode()函数，用于给这个字段展开降维，把指定的数组字段拆分降维展开为多行。类似于UDTF函数，作用于单/多个数据行，并且产生多个数据行，以一个表作为输出。</p> 
<p><strong>1. explode 将数组或者map展开</strong></p> 
<p>例：</p> 
<p>select explode(array('a','b','c','d'));</p> 
<p>结果：</p> 
<p>a b c d</p> 
<p><strong>2. json_tuple 取出json字符串中的属性值</strong></p> 
<p>例：</p> 
<p>select json_tuple('{"name":"王二狗","sex":"男","age":"25"}','name','sex','age');</p> 
<p>结果：</p> 
<p>王二狗 男 25</p> 
<p><strong>3. lateral view 侧写</strong></p> 
<p>炸裂函数和聚合函数一样不支持和普通列一起查询，所以一般会配合侧写进行查询。</p> 
<p>用法：lateral view udtf(expression) tableAlias AS columnAlias</p> 
<p>解释：lateral view用于和split，explode等UDTF一起使用，它能够将一行数据拆分成多行数据，在此基础上可以对拆分后的数据进行聚合。</p> 
<p>lateral view首先为原始表的每行调用UDTF，UDTF会把每一行拆分成一行或者多行，lateral view再把结果组合，产生一个支持别名表的虚拟表。</p> 
<p>例：</p> 
<p>select movie, category_namefrom movie_infolateral viewexplode(split(category,",")) movie_info_tmp AS category_name;</p> 
<p><strong>四、窗口函数</strong></p> 
<p>窗口函数，也可以叫开窗函数，其从本质来看是将Hive 中一些复杂的查询封装成了窗口的形式，进行数据统计时使用并且操 作十分方便，窗口函数为统计时使用的聚合函数指定一个聚合的范围。</p> 
<p><strong>1. 语法</strong></p> 
<p>基本语法：函数 + over( [partition by ...] [order by ...] [窗口子句] )</p> 
<ul><li>over表示开窗，默认窗口大小会包含所有数据。</li></ul> 
<ul><li>partition by表示根据字段再划分一个细窗口，相同字段进入同一个细窗口里面，每个窗口之间相互独立，窗口子句对于每个细窗口独立生效。</li></ul> 
<ul><li>order by表示窗口内按什么排序，如果只有over表示直接最大窗口排序；如果有partition by每个细窗口单独排序。</li></ul> 
<ul><li>窗口子句，可以进一步限定范围</li></ul> 
<p>(rows | range) between (unbounded | [num]) preceding and ([num] preceding | current row | (unbounded | [num]) following</p> 
<p>(rows | range) between current row and (current row | (unbounded | [num]) following)</p> 
<p>(rows | range) between [num] following and (unbounded | [num]) following</p> 
<p>示例：</p> 
<p>rows between unbounded preceding and unbounded following</p> 
<p>行的范围为上无边界到下无边界（第一行到最后一行）。</p> 
<p>注：窗口函数是一行一行执行的。</p> 
<p><strong>2. 使用</strong></p> 
<p>① 窗口函数</p> 
<p>lag(col,n,default_val)：往前第n行数据。</p> 
<p>lead(col,n, default_val)：往后第n行数据。</p> 
<p>first_value (col,true/false)：当前窗口下的第一个值，第二个参数为true，跳过空值。</p> 
<p>last_value (col,true/false)：当前窗口下的最后一个值，第二个参数为true，跳过空值。</p> 
<p>② 聚合函数</p> 
<p>max：最大值。</p> 
<p>min：最小值。</p> 
<p>sum：求和。</p> 
<p>avg：平均值。</p> 
<p>count：计数。</p> 
<p>③ 排名分析函数</p> 
<p>rank：排名相同时会重复总数不会减少。</p> 
<p>dense_rank：排名相同时会重复总数会减少。</p> 
<p>row_number：行号。</p> 
<p>ntile：分组并给上组号。</p> 
<p><strong>3. 注意事项</strong></p> 
<ul><li>窗口函数的执行次序是在group by之后。</li><li>有时窗口子句加与不加结果是一致的，原因是窗口子句有默认值，当有order by 但是缺少窗口子句时，范围是上无边界到当前行，当order by和窗口子句都缺少时，范围为上无边界到下无边界。</li><li>不是所有函数都需要写窗口子句,rank、dense_rank、ntile、row_number、lag、lead 这些函数不支持窗口子句。</li><li>排名分析函数中不需要写参数，会将排好序数据进行标号。</li></ul> 
<p><strong>4. 使用示例</strong></p> 
<p>例如，表table，字段为id，sub，score，需求出表每门学科的成绩排名。</p> 
<p>select</p> 
<p>id,</p> 
<p>sub,</p> 
<p>score,</p> 
<p>rank() over(distribute by sub sort by score desc) rank</p> 
<p>from table;</p> 
<p><strong>五、总结</strong></p> 
<p>本文给大家介绍了Hive中一些常用的基本函数、炸裂函数和窗口函数的理论及使用，各位程序猿们需要多多练习函数的使用，体会函数的效果以及它们之间的联合使用！下期为大家介绍HIVE自定义函数的方法，实现我们自己想要的效果。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f07e9dbf5ebc6845d40e1058ac486676/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Vue中如何进行图片裁剪与上传？</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ed17b01e13baaa8c05d8c2f6665392a7/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">DCL单例及synchrosized问题</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>