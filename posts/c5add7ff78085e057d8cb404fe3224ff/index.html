<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>12、使用JDBC方式访问HIve，启动客户端时报错java.lang.NoClassDefFoundError: org/apache/tez/dag/api/TezConfiguration... - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="12、使用JDBC方式访问HIve，启动客户端时报错java.lang.NoClassDefFoundError: org/apache/tez/dag/api/TezConfiguration..." />
<meta property="og:description" content="背景
在启动完成hive服务：hive --service metastore后
启动hive2服务的过程中：hive --service hiveserver2时
报错：java.lang.NoClassDefFoundError: org/apache/tez/dag/api/TezConfiguration
分析
我的hive-site.xml配置文件：
&lt;?xml version=&#34;1.0&#34;?&gt; &lt;?xml-stylesheet type=&#34;text/xsl&#34; href=&#34;configuration.xsl&#34;?&gt; &lt;configuration&gt; &lt;!-- jdbc 连接的 URL --&gt; &lt;property&gt; &lt;name&gt;javax.jdo.option.ConnectionURL&lt;/name&gt; &lt;value&gt;jdbc:mysql://pc001:3306/metastore?allowPublicKeyRetrieval=true&amp;amp;useSSL=false&lt;/value&gt; &lt;/property&gt; &lt;!-- jdbc 连接的 Driver--&gt; &lt;property&gt; &lt;name&gt;javax.jdo.option.ConnectionDriverName&lt;/name&gt; &lt;value&gt;com.mysql.jdbc.Driver&lt;/value&gt; &lt;/property&gt; &lt;!-- jdbc 连接的 username--&gt; &lt;property&gt; &lt;name&gt;javax.jdo.option.ConnectionUserName&lt;/name&gt; &lt;value&gt;root&lt;/value&gt; &lt;/property&gt; &lt;!-- jdbc 连接的 password --&gt; &lt;property&gt; &lt;name&gt;javax.jdo.option.ConnectionPassword&lt;/name&gt; &lt;value&gt;root&lt;/value&gt; &lt;/property&gt; &lt;!-- Hive 元数据存储版本的验证 --&gt; &lt;property&gt; &lt;name&gt;hive.metastore.schema.verification&lt;/name&gt; &lt;value&gt;false&lt;/value&gt; &lt;/property&gt; &lt;!--元数据存储授权--&gt; &lt;property&gt; &lt;name&gt;hive.metastore.event.db.notification.api.auth&lt;/name&gt; &lt;value&gt;false&lt;/value&gt; &lt;/property&gt; &lt;!-- Hive 默认在 HDFS 的工作目录 --&gt; &lt;property&gt; &lt;name&gt;hive." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/c5add7ff78085e057d8cb404fe3224ff/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-09-27T15:32:00+08:00" />
<meta property="article:modified_time" content="2021-09-27T15:32:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">12、使用JDBC方式访问HIve，启动客户端时报错java.lang.NoClassDefFoundError: org/apache/tez/dag/api/TezConfiguration...</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown" style="font-size: 16px;"> 
 <ul><li> <p>背景</p> <p>在启动完成hive服务：<code>hive --service metastore</code>后</p> <p>启动hive2服务的过程中：<code>hive --service hiveserver2</code>时</p> <p>报错：java.lang.NoClassDefFoundError: org/apache/tez/dag/api/TezConfiguration</p> <p><img src="https://images2.imgbox.com/3e/e2/3LYehi0d_o.png" alt="" style="outline: none;"></p> </li><li> <p>分析</p> <p>我的hive-site.xml配置文件：</p> <pre class="has"><code class="language-xml">&lt;?xml version="1.0"?&gt;
&lt;?xml-stylesheet type="text/xsl" href="configuration.xsl"?&gt;
&lt;configuration&gt;
&lt;!-- jdbc 连接的 URL --&gt;
    &lt;property&gt;
        &lt;name&gt;javax.jdo.option.ConnectionURL&lt;/name&gt;
        &lt;value&gt;jdbc:mysql://pc001:3306/metastore?allowPublicKeyRetrieval=true&amp;amp;useSSL=false&lt;/value&gt;
    &lt;/property&gt;

&lt;!-- jdbc 连接的 Driver--&gt;
    &lt;property&gt;
        &lt;name&gt;javax.jdo.option.ConnectionDriverName&lt;/name&gt;
        &lt;value&gt;com.mysql.jdbc.Driver&lt;/value&gt;
    &lt;/property&gt;

&lt;!-- jdbc 连接的 username--&gt;
    &lt;property&gt;
        &lt;name&gt;javax.jdo.option.ConnectionUserName&lt;/name&gt;
        &lt;value&gt;root&lt;/value&gt;
    &lt;/property&gt;

&lt;!-- jdbc 连接的 password --&gt;
    &lt;property&gt;
        &lt;name&gt;javax.jdo.option.ConnectionPassword&lt;/name&gt;
        &lt;value&gt;root&lt;/value&gt;
    &lt;/property&gt;

&lt;!-- Hive 元数据存储版本的验证 --&gt;
    &lt;property&gt;
        &lt;name&gt;hive.metastore.schema.verification&lt;/name&gt;
        &lt;value&gt;false&lt;/value&gt;
    &lt;/property&gt;

&lt;!--元数据存储授权--&gt;
    &lt;property&gt;
        &lt;name&gt;hive.metastore.event.db.notification.api.auth&lt;/name&gt;
        &lt;value&gt;false&lt;/value&gt;
    &lt;/property&gt;

&lt;!-- Hive 默认在 HDFS 的工作目录 --&gt;
    &lt;property&gt;
        &lt;name&gt;hive.metastore.warehouse.dir&lt;/name&gt;
        &lt;value&gt;/user/hive/warehouse&lt;/value&gt;
    &lt;/property&gt;

&lt;!-- 指定存储元数据要连接的地址--&gt;
    &lt;property&gt;
        &lt;name&gt;hive.metastore.uris&lt;/name&gt;
        &lt;value&gt;thrift://pc001:9083&lt;/value&gt;
    &lt;/property&gt;

&lt;!-- 指定 hiveserver2 连接的 host --&gt;
    &lt;property&gt;
        &lt;name&gt;hive.server2.thrift.bind.host&lt;/name&gt;
        &lt;value&gt;pc001&lt;/value&gt;
    &lt;/property&gt;
&lt;!-- 指定 hiveserver2 连接的端口号 --&gt;
    &lt;property&gt;
        &lt;name&gt;hive.server2.thrift.port&lt;/name&gt;
        &lt;value&gt;10000&lt;/value&gt;
    &lt;/property&gt;

&lt;/configuration&gt;</code></pre> <p>按提示显示，没有集成Tez。而Hive默认使用的引擎是MR，其配置文件hive-site.xml中的hive.execution.engine属性值为mr，而不是tez。</p> <p><img src="https://images2.imgbox.com/80/e3/w14Eut8Q_o.png" alt="" style="outline: none;"></p> <p>该报错是一个WARN，60000ms后会自动重试启动(一般重试后会启动成功)，通过查看网络端口：<code>netstat -nltp</code>，可以发现自定义的端口是生效的</p> <p><img src="https://images2.imgbox.com/8c/ba/xLUw2z4s_o.png" alt="" style="outline: none;"></p> <p>但是将报错日志(/tmp/nuochengz/hive.log)往上面翻，发现：</p> <p>2021-09-27T02:25:57,354 INFO [main] server.HiveServer2: HS2 interactive HA not enabled. Starting tez sessions..<br> 2021-09-27T02:25:57,354 INFO [main] server.HiveServer2: Starting/Reconnecting tez sessions..</p> <p><img src="https://images2.imgbox.com/1e/3d/zPs0U72F_o.png" alt="" style="outline: none;"></p> <p>可以发现hive.server2.active.passive.ha.enable的默认值为</p> <pre class="has"><code class="language-shell">[1] vim $HIVE_HOME/conf/hive-default.xml.template 
[2] :/ hive.server2.active.passive.ha.enable</code></pre> <p><img src="https://images2.imgbox.com/5c/12/3dKV4m9e_o.png" alt="" style="outline: none;"></p> <p>所以可以将其值设置为true</p> <pre class="has"><code class="language-xml">&lt;!-- hiveserver2的高可用参数，开启此参数可以提高hiveserver2的启动速度 --&gt;
&lt;property&gt;
    &lt;name&gt;hive.server2.active.passive.ha.enable&lt;/name&gt;
    &lt;value&gt;true&lt;/value&gt;
&lt;/property&gt;</code></pre> </li><li> <p>结论</p> <p>报错解决</p> <p><img src="https://images2.imgbox.com/51/9e/S88HcUeT_o.png" alt="" style="outline: none;"></p> </li></ul> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4ef0cee2a94a5c4fc6d3e18633d8b8f4/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">WIN10键盘无法使用，什么按键都不管用</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d7e5ae277d5b36271abf241f46eda271/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">高精度乘法（高精度乘高精度）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>