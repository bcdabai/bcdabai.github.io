<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>内网信息收集常用的cmd命令 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="内网信息收集常用的cmd命令" />
<meta property="og:description" content="内网信息收集 工作组信息收集 用户信息 #查看本机用户列表 net user #获取本地管理员信息 net localgroup administrators #查看当前在线用户 quser query user query user || qwinsta #查当前用户在目标系统中的具体权限 whoami /all #查看当前权限 whoami &amp;&amp; whoami /priv #查当前机器中所有的组名,了解不同组的职能,如,IT,HR,ADMIN,FILE net localgroup 系统信息 #查询网络配置信息。进行IP地址段信息收集 ipconfig /all #查询操作系统及软件信息 systeminfo /fo list systeminfo | findstr &#34;主机名&#34; systeminfo | findstr /B /C:&#34;OS Name&#34; /C:&#34;OS Version&#34; systeminfo | findstr /B /C:&#34;OS 名称&#34; /C:&#34;OS 版本&#34; #查看当前系统版本 ver wmic os list brief wmic os get Caption,CSDVersion,OSArchitecture,Version #查看系统体系结构 echo %PROCESSOR_ARCHITECTURE% #查询本机服务信息 wmic service list brief #查看安装的软件的版本、路径等 wmic product get name, version powershell &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/8698cd7c2182d53ce7325866582e4c86/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-10-28T00:22:52+08:00" />
<meta property="article:modified_time" content="2023-10-28T00:22:52+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">内网信息收集常用的cmd命令</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_0"></a>内网信息收集</h3> 
<h4><a id="_2"></a>工作组信息收集</h4> 
<h5><a id="_4"></a>用户信息</h5> 
<pre><code>#查看本机用户列表 
net user

#获取本地管理员信息 
net localgroup administrators

#查看当前在线用户 
quser 
query user 
query user || qwinsta

#查当前用户在目标系统中的具体权限
whoami /all

#查看当前权限
whoami &amp;&amp; whoami /priv

#查当前机器中所有的组名,了解不同组的职能,如,IT,HR,ADMIN,FILE
net localgroup
</code></pre> 
<h5><a id="_28"></a>系统信息</h5> 
<pre><code>#查询网络配置信息。进行IP地址段信息收集 
ipconfig /all

#查询操作系统及软件信息 
systeminfo /fo list 
systeminfo | findstr "主机名" 
systeminfo | findstr /B /C:"OS Name" /C:"OS Version" 
systeminfo | findstr /B /C:"OS 名称" /C:"OS 版本"

#查看当前系统版本 
ver
wmic os list brief
wmic os get Caption,CSDVersion,OSArchitecture,Version

#查看系统体系结构 
echo %PROCESSOR_ARCHITECTURE%

#查询本机服务信息 
wmic service list brief

#查看安装的软件的版本、路径等 
wmic product get name, version 
powershell "Get-WmiObject -class Win32_Product |Select-Object -Property name, version"

#查询进程信息 
tasklist
wmic process list brief

#查看启动程序信息 
wmic startup get command,caption

#查看计划任务 
at（win10之前） 
schtasks /query /fo LIST /v（win10）
PS：如果遇到资源无法加载问题，则是由于当前活动页码所致：更改活动页码为437： chcp 437

#查看主机开机时间 
net statistics workstation

#列出或断开本地计算机与所连接的客户端的对话 
net session

#查看本地可用凭据 
cmdkey /l

#查看补丁列表 
wmic qfe get hotfixid 
systeminfo | findstr "KB"

#查看补丁的名称、描述、ID、安装时间等 
wmic qfe get Caption,Description,HotFixID,InstalledOn

#查看本地密码策略 
net accounts

#查看hosts文件 
type c:\Windows\system32\drivers\etc\hosts

#查看dns缓存
ipconfig /displaydns
</code></pre> 
<h5><a id="_93"></a>网络信息</h5> 
<pre><code>#查看本机所有的tcp,udp端口连接及其对应的pid 
netstat -ano

#查看本机所有的tcp,udp端口连接,pid及其对应的发起程序 
netstat -anob   #管理员权限

#查看路由表和arp缓存 
route print 
arp -a

#查看本机共享列表和可访问的域共享列表 （445端口） 
net share 
wmic share get name,path,status

#磁盘映射 
net use k: \\192.168.1.10\c$
</code></pre> 
<h5><a id="_114"></a>防火墙信息</h5> 
<pre><code>#查看防火墙配置(netsh命令也可以用作端口转发) 
netsh firewall show config

#关闭防火墙(Windows Server 2003 以前的版本) 
netsh firewall set opmode disable

#firewall命令已弃用，建议使用advfirewall命令 
#查看配置规则 
netsh advfirewall firewall show rule name=all

#关闭防火墙\开启防火墙(Windows Server 2003 以后的版本)
netsh advfirewall set allprofiles state off\on

#导出\导入配置文件 
netsh advfirewall export\import xx.pol

#新建规则阻止TCP协议139端口 
netsh advfirewall firewall add rule name="deny tcp 139" dir=in protocol=tcp localport=139 action=block

#新建规则允许3389通过防火墙 
netsh advfirewall firewall add rule name="Remote Desktop" protocol=TCP dir=in localport=3389 action=allow

#删除名为Remote Desktop的规则 
netsh advfirewall firewall delete rule name=Remote Desktop
</code></pre> 
<h5><a id="RDP_143"></a>RDP远程桌面</h5> 
<pre><code>#开启
wmic RDTOGGLE WHERE ServerName='%COMPUTERNAME%' call SetAllowTSConnections 1

#关闭 
wmic RDTOGGLE WHERE ServerName='%COMPUTERNAME%' call SetAllowTSConnections 0

#查询并开启RDP服务的端口，返回一个十六进制的端口
REG QUERY "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" /V PortNumber
</code></pre> 
<h5><a id="_156"></a>获取杀软信息</h5> 
<pre><code>#获取杀软名
WMIC /Namespace:\\root\SecurityCenter2 Path AntiVirusProduct Get displayName /Format:List

#获取杀软名和安装路径
WMIC /Namespace:\\root\SecurityCenter2 Path AntiVirusProduct Get displayName,productState,pathToSignedProductExe

#常见的杀毒软件进程
tasklist /v 
wmic process list brief
</code></pre> 
<h5><a id="Wifi_169"></a>Wifi密码</h5> 
<pre><code>netsh wlan show profile
netsh wlan show profile name="HUAWEI-MINGY" key=clear
</code></pre> 
<p>一条命令获取连接过的wifi密码，<strong>企业认证的获取不到</strong></p> 
<pre><code>for /f  "skip=9 tokens=1,2 delims=:" %i in ('netsh wlan show profiles')  do @echo %j | findstr -i -v echo |  netsh wlan show profiles %j key=clear
</code></pre> 
<h5><a id="_181"></a>回收站信息</h5> 
<pre><code>FOR /f "skip=1 tokens=1,2 delims= " %c in ('wmic useraccount get name^,sid') do dir /a /b C:\$Recycle.Bin\%d\ ^&gt;%c.txt

目录路径在 C:\$Recycle.Bin
</code></pre> 
<h4><a id="_190"></a>域内信息收集</h4> 
<h5><a id="Net_192"></a>Net组件</h5> 
<pre><code>#查询域
net view /domain 

#查询域内的所有计算机 
net view /domain:mingy 

#查询域内所有用户组（Enterprise Admins组权限最大） 
net group /domain

#查看域管理员的用户组 
net group "domain admins" /domain 

#查询所有域成员计算机列表 
net group "domain computers" /domain 

#查询域系统管理员用户组 
net group "Enterprise admins" /domain

#查看域控制器 
net group "domain controllers" /domain

#对比查看"工作站域DNS名称(域名)"和"登录域()域控制器"的信息是否相匹配 
net config workstation 

#查看域内所有账号
net user /domain

#查询指定用户的详情信息 
net user xxx /domain

#查看时间可以找到域控
net time /domain

#查看域密码策略 
net accounts /domain

#查看当前登录域
net config workstation 

#登录本机的域管理员 
net localgroup administrators /domain
</code></pre> 
<h5><a id="Dsquery_238"></a>Dsquery</h5> 
<p><strong>dsquery工具一般在域控上才有</strong></p> 
<pre><code>#查看当前域内的所有机器,dsquery工具一般在域控上才有,不过你可以上传一个 dsquery 
dsquery computer

#查看当前域中的所有账户名 
dsquery user

#查看当前域内的所有组名 
dsquery group

#查看到当前域所在的网段，结合nbtscan使用 
dsquery subnet

#查看域内所有的web站点 
dsquery site

#查看当前域中的服务器(一般结果只有域控的主机名) 
dsquery server

#查询前240个以admin开头的用户名 
dsquery user domainroot -name admin* -limit 240
</code></pre> 
<h5><a id="Other_264"></a>Other</h5> 
<pre><code>#查看域控制器的机器名 
nltest /DCLIST:MINGY

#查看域内的主域控，仅限win2008及之后的系统 
netdom query pdc

#查看域控主机名
nslookup -type=srv _ldap._tcp

#查看域内信任关系
nltest /domain_trusts

#查看域内邮件服务器 
nslookup -q=mx mingy.com

#查看域内DNS服务器
nslookup -q=ns mingy.com
</code></pre> 
<h5><a id="_286"></a>定位域控</h5> 
<pre><code>#ipconfig 
ipconfig /all

#查询dns解析记录
nslookup -type=all _ldap._tcp.dc._msdcs.mingy.com

#spn扫描 在SPN扫描结果中可以通过如下内容，来进行域控的定位。 
setspn -q */*
setspn -T mingy.com -q */*
CN=DC,OU=Domain Controllers,DC=mingy,DC=com

#net group 
net group "domain controllers" /domain

#端口识别 端口：389 服务：LDAP、ILS 说明：轻型目录访问协议和NetMeeting Internet Locator Server共用这一端 口。

端口：53 服务：Domain Name Server（DNS） 说明：53端口为DNS(Domain Name Server，域名服务器)服务器所开放，主要用于 域名解析，DNS服务在NT系统中使用的最为广泛。通过DNS服务器可以实现域名与IP地 址之间的转换，只要记住域名就可以快速访问网站。
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ae021aeb417a7e4013c7b182dda59c49/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">ARCSWAT报错error010240无法将栅格数据保存到指定位置解决以及error-2147467259方法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ec7e20fce174a8bca23b3d55153e0621/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">linux常用命令--思维导图（大纲）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>