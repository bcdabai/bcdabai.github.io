<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>腾讯云-OCR - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="腾讯云-OCR" />
<meta property="og:description" content="本软件使用腾讯OCR引擎，每月有1000次调用量，可以自动识别语言，后期会持续更新ocr引擎，提高调用量。
效果： 功能一：屏幕OCR。 在屏幕选择任意矩形区域后，按回车键确认，即可进行文字识别。
功能二：单图片或多图片OCR。 选择单个图片或按下ctrl键选择多个图片，即可进行文字识别。
功能三：多图片识别。 选择图片所在文件夹即可。软件会检索该文件夹下的jpg或png格式图片，并创建每个图片名称对应的txt文件，把识别结果保存在对应txt文件中。
附上 github 链接 https://github.com/aqqwvfbukn/TencentOcr 最后上代码 import sys from PyQt5.QtCore import qAbs, QRect from PyQt5.QtGui import QGuiApplication, QColor, QPen, QPainter from PyQt5.QtWidgets import QApplication import os from PyQt5.QtCore import pyqtSlot, pyqtSignal, QSize, Qt from PyQt5.QtGui import QMovie, QPixmap, QIcon from PyQt5.QtWidgets import QWidget, QFileDialog from PyQt5 import QtCore, QtWidgets from QCandyUi.CandyWindow import colorful import ctypes import json import base64 from tencentcloud.common import credential from tencentcloud." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/6e10c146888bf7ea53ed2d0d63e1bb86/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-12-01T15:53:27+08:00" />
<meta property="article:modified_time" content="2021-12-01T15:53:27+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">腾讯云-OCR</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>本软件使用腾讯OCR引擎，每月有1000次调用量，可以自动识别语言，后期会持续更新ocr引擎，提高调用量。<br> <img src="https://images2.imgbox.com/bb/2c/hFCKBjtp_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_4"></a>效果：</h3> 
<p><img src="https://images2.imgbox.com/22/d8/lyNuGUF4_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="OCR_7"></a>功能一：屏幕OCR。</h4> 
<p>在屏幕选择任意矩形区域后，按回车键确认，即可进行文字识别。</p> 
<h4><a id="OCR_10"></a>功能二：单图片或多图片OCR。</h4> 
<p>选择单个图片或按下ctrl键选择多个图片，即可进行文字识别。</p> 
<h4><a id="_13"></a>功能三：多图片识别。</h4> 
<p>选择图片所在文件夹即可。软件会检索该文件夹下的jpg或png格式图片，并创建每个图片名称对应的txt文件，把识别结果保存在对应txt文件中。</p> 
<h4><a id="_github__httpsgithubcomaqqwvfbuknTencentOcrhttpsgithubcomaqqwvfbuknTencentOcr_15"></a>附上 github 链接 <a href="https://github.com/aqqwvfbukn/TencentOcr">https://github.com/aqqwvfbukn/TencentOcr</a></h4> 
<h3><a id="_17"></a>最后上代码</h3> 
<pre><code class="prism language-python"><span class="token keyword">import</span> sys
<span class="token keyword">from</span> PyQt5<span class="token punctuation">.</span>QtCore <span class="token keyword">import</span> qAbs<span class="token punctuation">,</span> QRect
<span class="token keyword">from</span> PyQt5<span class="token punctuation">.</span>QtGui <span class="token keyword">import</span> QGuiApplication<span class="token punctuation">,</span> QColor<span class="token punctuation">,</span> QPen<span class="token punctuation">,</span> QPainter
<span class="token keyword">from</span> PyQt5<span class="token punctuation">.</span>QtWidgets <span class="token keyword">import</span> QApplication
<span class="token keyword">import</span> os
<span class="token keyword">from</span> PyQt5<span class="token punctuation">.</span>QtCore <span class="token keyword">import</span> pyqtSlot<span class="token punctuation">,</span> pyqtSignal<span class="token punctuation">,</span>  QSize<span class="token punctuation">,</span> Qt
<span class="token keyword">from</span> PyQt5<span class="token punctuation">.</span>QtGui <span class="token keyword">import</span> QMovie<span class="token punctuation">,</span> QPixmap<span class="token punctuation">,</span> QIcon
<span class="token keyword">from</span> PyQt5<span class="token punctuation">.</span>QtWidgets <span class="token keyword">import</span> QWidget<span class="token punctuation">,</span> QFileDialog
<span class="token keyword">from</span> PyQt5 <span class="token keyword">import</span> QtCore<span class="token punctuation">,</span> QtWidgets
<span class="token keyword">from</span> QCandyUi<span class="token punctuation">.</span>CandyWindow <span class="token keyword">import</span> colorful
<span class="token keyword">import</span> ctypes

<span class="token keyword">import</span> json
<span class="token keyword">import</span> base64
<span class="token keyword">from</span> tencentcloud<span class="token punctuation">.</span>common <span class="token keyword">import</span> credential
<span class="token keyword">from</span> tencentcloud<span class="token punctuation">.</span>common<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>client_profile <span class="token keyword">import</span> ClientProfile
<span class="token keyword">from</span> tencentcloud<span class="token punctuation">.</span>common<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>http_profile <span class="token keyword">import</span> HttpProfile
<span class="token keyword">from</span> tencentcloud<span class="token punctuation">.</span>ocr<span class="token punctuation">.</span>v20181119 <span class="token keyword">import</span> ocr_client<span class="token punctuation">,</span> models

ctypes<span class="token punctuation">.</span>windll<span class="token punctuation">.</span>shell32<span class="token punctuation">.</span>SetCurrentProcessExplicitAppUserModelID<span class="token punctuation">(</span><span class="token string">"myappid"</span><span class="token punctuation">)</span>

<span class="token comment"># 资源路径</span>
screen_shot_icon_url <span class="token operator">=</span> <span class="token string">'./asset/scissors.png'</span>
open_file_icon_url <span class="token operator">=</span> <span class="token string">'./asset/pic2.png'</span>
open_files_icon_url <span class="token operator">=</span> <span class="token string">'./asset/files.png'</span>
loading_gif_url <span class="token operator">=</span> <span class="token string">'./asset/loading.gif'</span>

<span class="token comment"># 设置</span>
min_after_shot <span class="token operator">=</span> <span class="token boolean">False</span>
window_title <span class="token operator">=</span> <span class="token string">'OCR-V1.0'</span>

app_icon_url <span class="token operator">=</span> <span class="token string">'./asset/com.ico'</span>

<span class="token triple-quoted-string string">"""
    ui_image2text.py
"""</span>
<span class="token keyword">class</span> <span class="token class-name">Ui_image2textWidget</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">setupUi</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> image2textWidget<span class="token punctuation">)</span><span class="token punctuation">:</span>
        image2textWidget<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"image2textWidget"</span><span class="token punctuation">)</span>
        image2textWidget<span class="token punctuation">.</span>resize<span class="token punctuation">(</span><span class="token number">611</span><span class="token punctuation">,</span> <span class="token number">330</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>verticalLayout <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QVBoxLayout<span class="token punctuation">(</span>image2textWidget<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>verticalLayout<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"verticalLayout"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>textEdit <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QTextEdit<span class="token punctuation">(</span>image2textWidget<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>textEdit<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"textEdit"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>verticalLayout<span class="token punctuation">.</span>addWidget<span class="token punctuation">(</span>self<span class="token punctuation">.</span>textEdit<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>horizontalLayout <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QHBoxLayout<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>horizontalLayout<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"horizontalLayout"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pushButtonCapture <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QPushButton<span class="token punctuation">(</span>image2textWidget<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pushButtonCapture<span class="token punctuation">.</span>setMinimumSize<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>QSize<span class="token punctuation">(</span><span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pushButtonCapture<span class="token punctuation">.</span>setMaximumSize<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>QSize<span class="token punctuation">(</span><span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pushButtonCapture<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"pushButtonCapture"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>horizontalLayout<span class="token punctuation">.</span>addWidget<span class="token punctuation">(</span>self<span class="token punctuation">.</span>pushButtonCapture<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pushButtonOpen <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QPushButton<span class="token punctuation">(</span>image2textWidget<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pushButtonOpen<span class="token punctuation">.</span>setMinimumSize<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>QSize<span class="token punctuation">(</span><span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pushButtonOpen<span class="token punctuation">.</span>setMaximumSize<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>QSize<span class="token punctuation">(</span><span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pushButtonOpen<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"pushButtonOpen"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>horizontalLayout<span class="token punctuation">.</span>addWidget<span class="token punctuation">(</span>self<span class="token punctuation">.</span>pushButtonOpen<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pushButtonOpenFile <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QPushButton<span class="token punctuation">(</span>image2textWidget<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pushButtonOpenFile<span class="token punctuation">.</span>setMinimumSize<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>QSize<span class="token punctuation">(</span><span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pushButtonOpenFile<span class="token punctuation">.</span>setMaximumSize<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>QSize<span class="token punctuation">(</span><span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pushButtonOpenFile<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"pushButtonOpenFile"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>horizontalLayout<span class="token punctuation">.</span>addWidget<span class="token punctuation">(</span>self<span class="token punctuation">.</span>pushButtonOpenFile<span class="token punctuation">)</span>
        spacerItem <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QSpacerItem<span class="token punctuation">(</span><span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> QtWidgets<span class="token punctuation">.</span>QSizePolicy<span class="token punctuation">.</span>Expanding<span class="token punctuation">,</span> QtWidgets<span class="token punctuation">.</span>QSizePolicy<span class="token punctuation">.</span>Minimum<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>horizontalLayout<span class="token punctuation">.</span>addItem<span class="token punctuation">(</span>spacerItem<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>verticalLayout<span class="token punctuation">.</span>addLayout<span class="token punctuation">(</span>self<span class="token punctuation">.</span>horizontalLayout<span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>retranslateUi<span class="token punctuation">(</span>image2textWidget<span class="token punctuation">)</span>
        QtCore<span class="token punctuation">.</span>QMetaObject<span class="token punctuation">.</span>connectSlotsByName<span class="token punctuation">(</span>image2textWidget<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">retranslateUi</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> image2textWidget<span class="token punctuation">)</span><span class="token punctuation">:</span>
        _translate <span class="token operator">=</span> QtCore<span class="token punctuation">.</span>QCoreApplication<span class="token punctuation">.</span>translate
        image2textWidget<span class="token punctuation">.</span>setWindowTitle<span class="token punctuation">(</span>_translate<span class="token punctuation">(</span><span class="token string">"image2textWidget"</span><span class="token punctuation">,</span> <span class="token string">"Form"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pushButtonCapture<span class="token punctuation">.</span>setText<span class="token punctuation">(</span>_translate<span class="token punctuation">(</span><span class="token string">"image2textWidget"</span><span class="token punctuation">,</span> <span class="token string">"cap"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pushButtonOpen<span class="token punctuation">.</span>setText<span class="token punctuation">(</span>_translate<span class="token punctuation">(</span><span class="token string">"image2textWidget"</span><span class="token punctuation">,</span> <span class="token string">"Open"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pushButtonOpenFile<span class="token punctuation">.</span>setText<span class="token punctuation">(</span>_translate<span class="token punctuation">(</span><span class="token string">"image2textWidget"</span><span class="token punctuation">,</span> <span class="token string">"Files"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token triple-quoted-string string">"""
    screen_capture.py
"""</span>
<span class="token keyword">class</span> <span class="token class-name">CaptureScreen</span><span class="token punctuation">(</span>QWidget<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    截屏：使用时仅需要new一个该实例即可出现全屏的截屏界面
    """</span>
    load_pixmap <span class="token operator">=</span> <span class="token boolean">None</span>
    screen_width <span class="token operator">=</span> <span class="token boolean">None</span>
    screen_height <span class="token operator">=</span> <span class="token boolean">None</span>
    is_mouse_pressed <span class="token operator">=</span> <span class="token boolean">None</span>
    begin_pos <span class="token operator">=</span> <span class="token boolean">None</span>
    end_pos <span class="token operator">=</span> <span class="token boolean">None</span>
    capture_pixmap <span class="token operator">=</span> <span class="token boolean">None</span>
    painter <span class="token operator">=</span> QPainter<span class="token punctuation">(</span><span class="token punctuation">)</span>
    signal_complete_capture <span class="token operator">=</span> pyqtSignal<span class="token punctuation">(</span>QPixmap<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        QWidget<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>init_window<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>load_background_pixmap<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>setCursor<span class="token punctuation">(</span>Qt<span class="token punctuation">.</span>CrossCursor<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">init_window</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>setMouseTracking<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>setWindowFlags<span class="token punctuation">(</span>Qt<span class="token punctuation">.</span>FramelessWindowHint<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>setWindowState<span class="token punctuation">(</span>Qt<span class="token punctuation">.</span>WindowActive <span class="token operator">|</span> Qt<span class="token punctuation">.</span>WindowFullScreen<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">load_background_pixmap</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 截下当前屏幕的图像</span>
        self<span class="token punctuation">.</span>load_pixmap <span class="token operator">=</span> QGuiApplication<span class="token punctuation">.</span>primaryScreen<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>grabWindow<span class="token punctuation">(</span>QApplication<span class="token punctuation">.</span>desktop<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>winId<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>screen_width <span class="token operator">=</span> self<span class="token punctuation">.</span>load_pixmap<span class="token punctuation">.</span>width<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>screen_height <span class="token operator">=</span> self<span class="token punctuation">.</span>load_pixmap<span class="token punctuation">.</span>height<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">mousePressEvent</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> event<span class="token punctuation">.</span>button<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> Qt<span class="token punctuation">.</span>LeftButton<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>is_mouse_pressed <span class="token operator">=</span> <span class="token boolean">True</span>
            self<span class="token punctuation">.</span>begin_pos <span class="token operator">=</span> event<span class="token punctuation">.</span>pos<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> event<span class="token punctuation">.</span>button<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> Qt<span class="token punctuation">.</span>RightButton<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> QWidget<span class="token punctuation">.</span>mousePressEvent<span class="token punctuation">(</span>self<span class="token punctuation">,</span> event<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">mouseMoveEvent</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>is_mouse_pressed <span class="token keyword">is</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>end_pos <span class="token operator">=</span> event<span class="token punctuation">.</span>pos<span class="token punctuation">(</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> QWidget<span class="token punctuation">.</span>mouseMoveEvent<span class="token punctuation">(</span>self<span class="token punctuation">,</span> event<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">mouseReleaseEvent</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>end_pos <span class="token operator">=</span> event<span class="token punctuation">.</span>pos<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>is_mouse_pressed <span class="token operator">=</span> <span class="token boolean">False</span>
        <span class="token keyword">return</span> QWidget<span class="token punctuation">.</span>mouseReleaseEvent<span class="token punctuation">(</span>self<span class="token punctuation">,</span> event<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">mouseDoubleClickEvent</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>capture_pixmap <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>signal_complete_capture<span class="token punctuation">.</span>emit<span class="token punctuation">(</span>self<span class="token punctuation">.</span>capture_pixmap<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">paintEvent</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>painter<span class="token punctuation">.</span>begin<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
        shadow_color <span class="token operator">=</span> QColor<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>  <span class="token comment"># 阴影颜色设置</span>
        self<span class="token punctuation">.</span>painter<span class="token punctuation">.</span>setPen<span class="token punctuation">(</span>QPen<span class="token punctuation">(</span>Qt<span class="token punctuation">.</span>blue<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Qt<span class="token punctuation">.</span>SolidLine<span class="token punctuation">,</span> Qt<span class="token punctuation">.</span>FlatCap<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 设置画笔</span>
        self<span class="token punctuation">.</span>painter<span class="token punctuation">.</span>drawPixmap<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>load_pixmap<span class="token punctuation">)</span>  <span class="token comment"># 将背景图片画到窗体上</span>
        self<span class="token punctuation">.</span>painter<span class="token punctuation">.</span>fillRect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>load_pixmap<span class="token punctuation">.</span>rect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> shadow_color<span class="token punctuation">)</span>  <span class="token comment"># 画影罩效果</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>is_mouse_pressed<span class="token punctuation">:</span>
            selected_rect <span class="token operator">=</span> self<span class="token punctuation">.</span>get_rect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>begin_pos<span class="token punctuation">,</span> self<span class="token punctuation">.</span>end_pos<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>capture_pixmap <span class="token operator">=</span> self<span class="token punctuation">.</span>load_pixmap<span class="token punctuation">.</span>copy<span class="token punctuation">(</span>selected_rect<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>painter<span class="token punctuation">.</span>drawPixmap<span class="token punctuation">(</span>selected_rect<span class="token punctuation">.</span>topLeft<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>capture_pixmap<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>painter<span class="token punctuation">.</span>drawRect<span class="token punctuation">(</span>selected_rect<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>painter<span class="token punctuation">.</span>end<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 重绘结束</span>

    <span class="token keyword">def</span> <span class="token function">keyPressEvent</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> event<span class="token punctuation">.</span>key<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> Qt<span class="token punctuation">.</span>Key_Escape<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> event<span class="token punctuation">.</span>key<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> Qt<span class="token punctuation">.</span>Key_Return <span class="token keyword">or</span> event<span class="token punctuation">.</span>key<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> Qt<span class="token punctuation">.</span>Key_Enter<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>signal_complete_capture<span class="token punctuation">.</span>emit<span class="token punctuation">(</span>self<span class="token punctuation">.</span>capture_pixmap<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">get_rect</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> beginPoint<span class="token punctuation">,</span> endPoint<span class="token punctuation">)</span><span class="token punctuation">:</span>
        width <span class="token operator">=</span> qAbs<span class="token punctuation">(</span>beginPoint<span class="token punctuation">.</span>x<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> endPoint<span class="token punctuation">.</span>x<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        height <span class="token operator">=</span> qAbs<span class="token punctuation">(</span>beginPoint<span class="token punctuation">.</span>y<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> endPoint<span class="token punctuation">.</span>y<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        x <span class="token operator">=</span> beginPoint<span class="token punctuation">.</span>x<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">if</span> beginPoint<span class="token punctuation">.</span>x<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> endPoint<span class="token punctuation">.</span>x<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">else</span> endPoint<span class="token punctuation">.</span>x<span class="token punctuation">(</span><span class="token punctuation">)</span>
        y <span class="token operator">=</span> beginPoint<span class="token punctuation">.</span>y<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">if</span> beginPoint<span class="token punctuation">.</span>y<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> endPoint<span class="token punctuation">.</span>y<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">else</span> endPoint<span class="token punctuation">.</span>y<span class="token punctuation">(</span><span class="token punctuation">)</span>
        selected_rect <span class="token operator">=</span> QRect<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span>
        <span class="token comment"># 避免宽或高为0时拷贝截图有误</span>
        <span class="token comment"># 当选取截图宽或高为0时默认为2</span>
        <span class="token keyword">if</span> selected_rect<span class="token punctuation">.</span>width<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            selected_rect<span class="token punctuation">.</span>setWidth<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> selected_rect<span class="token punctuation">.</span>height<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            selected_rect<span class="token punctuation">.</span>setHeight<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> selected_rect

<span class="token comment"># 对本地图片的base64加密</span>
<span class="token keyword">def</span> <span class="token function">ImageEncoder</span><span class="token punctuation">(</span>image_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>image_path<span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span><span class="token keyword">as</span> f<span class="token punctuation">:</span>
        byte_data <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        str_data <span class="token operator">=</span> <span class="token builtin">bytes</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span>byte_data<span class="token punctuation">,</span> encoding <span class="token operator">=</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> str_data
<span class="token keyword">def</span> <span class="token function">get_text</span><span class="token punctuation">(</span>image_full_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        cred <span class="token operator">=</span> credential<span class="token punctuation">.</span>Credential<span class="token punctuation">(</span><span class="token string">"SecretId"</span><span class="token punctuation">,</span> <span class="token string">"SecretKey"</span><span class="token punctuation">)</span>
        httpProfile <span class="token operator">=</span> HttpProfile<span class="token punctuation">(</span><span class="token punctuation">)</span>
        httpProfile<span class="token punctuation">.</span>endpoint <span class="token operator">=</span> <span class="token string">"ocr.tencentcloudapi.com"</span>
        clientProfile <span class="token operator">=</span> ClientProfile<span class="token punctuation">(</span><span class="token punctuation">)</span>
        clientProfile<span class="token punctuation">.</span>httpProfile <span class="token operator">=</span> httpProfile
        client <span class="token operator">=</span> ocr_client<span class="token punctuation">.</span>OcrClient<span class="token punctuation">(</span>cred<span class="token punctuation">,</span> <span class="token string">"ap-beijing"</span><span class="token punctuation">,</span> clientProfile<span class="token punctuation">)</span>
        req <span class="token operator">=</span> models<span class="token punctuation">.</span>GeneralBasicOCRRequest<span class="token punctuation">(</span><span class="token punctuation">)</span>
        params <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"ImageBase64"</span><span class="token punctuation">:</span> ImageEncoder<span class="token punctuation">(</span>image_full_path<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">"LanguageType"</span><span class="token punctuation">:</span> <span class="token string">"auto"</span>  <span class="token comment"># 自动识别语言</span>
        <span class="token punctuation">}</span>
        req<span class="token punctuation">.</span>from_json_string<span class="token punctuation">(</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">)</span>
        resp <span class="token operator">=</span> client<span class="token punctuation">.</span>GeneralBasicOCR<span class="token punctuation">(</span>req<span class="token punctuation">)</span>
        resp_data <span class="token operator">=</span> resp<span class="token punctuation">.</span>TextDetections
        <span class="token comment"># print(resp.to_json_string())</span>
    <span class="token comment">#         for data in resp_data:</span>
    <span class="token comment">#             Data.append(data.DetectedText)</span>
    <span class="token keyword">except</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>
    <span class="token keyword">return</span> resp_data


<span class="token decorator annotation punctuation">@colorful</span><span class="token punctuation">(</span><span class="token string">'blue'</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Image2Text</span><span class="token punctuation">(</span>QWidget<span class="token punctuation">)</span><span class="token punctuation">:</span>
    signal_response <span class="token operator">=</span> pyqtSignal<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        QWidget<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>ui <span class="token operator">=</span> Ui_image2textWidget<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>setupUi<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>textEdit<span class="token punctuation">.</span>setAcceptDrops<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>textEdit<span class="token punctuation">.</span>setPlaceholderText<span class="token punctuation">(</span><span class="token string">"Welcome here!!!"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>setAcceptDrops<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>m_start<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>beautify_button<span class="token punctuation">(</span>self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>pushButtonOpen<span class="token punctuation">,</span> open_file_icon_url<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>beautify_button<span class="token punctuation">(</span>self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>pushButtonCapture<span class="token punctuation">,</span> screen_shot_icon_url<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>beautify_button<span class="token punctuation">(</span>self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>pushButtonOpenFile<span class="token punctuation">,</span> open_files_icon_url<span class="token punctuation">)</span>

    <span class="token comment"># 美化按钮</span>
    <span class="token keyword">def</span> <span class="token function">beautify_button</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> button<span class="token punctuation">,</span> image_url<span class="token punctuation">)</span><span class="token punctuation">:</span>
        button<span class="token punctuation">.</span>setText<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
        button<span class="token punctuation">.</span>setIcon<span class="token punctuation">(</span>QIcon<span class="token punctuation">(</span>image_url<span class="token punctuation">)</span><span class="token punctuation">)</span>
        icon_width <span class="token operator">=</span> button<span class="token punctuation">.</span>height<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">1</span>
        button<span class="token punctuation">.</span>setIconSize<span class="token punctuation">(</span>QSize<span class="token punctuation">(</span>icon_width<span class="token punctuation">,</span> icon_width<span class="token punctuation">)</span><span class="token punctuation">)</span>
        button<span class="token punctuation">.</span>setFlat<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">m_start</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>label <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QLabel<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>label<span class="token punctuation">.</span>setGeometry<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>QRect<span class="token punctuation">(</span><span class="token number">250</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>label<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"label"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>gif <span class="token operator">=</span> QMovie<span class="token punctuation">(</span>loading_gif_url<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>label<span class="token punctuation">.</span>setMovie<span class="token punctuation">(</span>self<span class="token punctuation">.</span>gif<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>gif<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>label<span class="token punctuation">.</span>setVisible<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>

    <span class="token decorator annotation punctuation">@pyqtSlot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">on_pushButtonCapture_clicked</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>textEdit<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>capture <span class="token operator">=</span> CaptureScreen<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>capture<span class="token punctuation">.</span>signal_complete_capture<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>slot_screen_capture<span class="token punctuation">)</span>

    <span class="token decorator annotation punctuation">@pyqtSlot</span><span class="token punctuation">(</span>QPixmap<span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">slot_screen_capture</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> image<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>label<span class="token punctuation">.</span>setVisible<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        image<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string">'capture.jpg'</span><span class="token punctuation">)</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            result_data <span class="token operator">=</span> get_text<span class="token punctuation">(</span><span class="token string">'capture.jpg'</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> data <span class="token keyword">in</span> result_data<span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>textEdit<span class="token punctuation">.</span>append<span class="token punctuation">(</span>data<span class="token punctuation">.</span>DetectedText<span class="token punctuation">)</span>
            os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span><span class="token string">'capture.jpg'</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>label<span class="token punctuation">.</span>setVisible<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>textEdit<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"error!!!"</span><span class="token punctuation">)</span>

    <span class="token decorator annotation punctuation">@pyqtSlot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">on_pushButtonOpen_clicked</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        file_urls <span class="token operator">=</span> QFileDialog<span class="token punctuation">.</span>getOpenFileNames<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>label<span class="token punctuation">.</span>setVisible<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>file_urls<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>textEdit<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> img_full_path <span class="token keyword">in</span> file_urls<span class="token punctuation">:</span>
            <span class="token keyword">if</span> img_full_path <span class="token keyword">is</span> <span class="token boolean">None</span> <span class="token keyword">or</span> img_full_path <span class="token operator">==</span> <span class="token string">''</span><span class="token punctuation">:</span>
                <span class="token keyword">continue</span>
            self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>textEdit<span class="token punctuation">.</span>append<span class="token punctuation">(</span>img_full_path <span class="token operator">+</span> <span class="token string">':'</span><span class="token punctuation">)</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                result_data <span class="token operator">=</span> get_text<span class="token punctuation">(</span>img_full_path<span class="token punctuation">)</span>
                <span class="token keyword">for</span> data <span class="token keyword">in</span> result_data<span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>textEdit<span class="token punctuation">.</span>append<span class="token punctuation">(</span>data<span class="token punctuation">.</span>DetectedText<span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>textEdit<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">'----------------------------'</span><span class="token punctuation">)</span>
            <span class="token keyword">except</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>textEdit<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"error!!!"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>label<span class="token punctuation">.</span>setVisible<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>

    <span class="token decorator annotation punctuation">@pyqtSlot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">on_pushButtonOpenFile_clicked</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>textEdit<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>label<span class="token punctuation">.</span>setVisible<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        file_dir <span class="token operator">=</span> QFileDialog<span class="token punctuation">.</span>getExistingDirectory<span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token string">"选择图片文件夹"</span><span class="token punctuation">,</span> <span class="token string">"./"</span><span class="token punctuation">)</span> <span class="token comment"># 选择图片存放路径</span>
        file_dir <span class="token operator">=</span> file_dir <span class="token operator">+</span> <span class="token string">'/'</span>
        file_list <span class="token operator">=</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>file_dir<span class="token punctuation">)</span>
        <span class="token keyword">for</span> file_name <span class="token keyword">in</span> file_list<span class="token punctuation">:</span>
            <span class="token keyword">if</span> file_name<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">".jpg"</span><span class="token punctuation">)</span> <span class="token keyword">or</span> file_name<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">".png"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">try</span><span class="token punctuation">:</span>
                    result_data <span class="token operator">=</span> get_text<span class="token punctuation">(</span>file_dir<span class="token operator">+</span>file_name<span class="token punctuation">)</span>
                    <span class="token keyword">for</span> data <span class="token keyword">in</span> result_data<span class="token punctuation">:</span>
                        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>file_dir <span class="token operator">+</span> file_name<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">'.txt'</span><span class="token punctuation">,</span> <span class="token string">'a+'</span><span class="token punctuation">,</span> encoding <span class="token operator">=</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
                            f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>data<span class="token punctuation">.</span>DetectedText <span class="token operator">+</span> <span class="token string">'\n'</span><span class="token punctuation">)</span>
                <span class="token keyword">except</span><span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>textEdit<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"error!!!"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>textEdit<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"文字识别完成!!!"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>label<span class="token punctuation">.</span>setVisible<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">except_hook</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> exception<span class="token punctuation">,</span> traceback<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># pqyt5出错时，显示信息</span>
    sys<span class="token punctuation">.</span>__excepthook__<span class="token punctuation">(</span>cls<span class="token punctuation">,</span> exception<span class="token punctuation">,</span> traceback<span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    app <span class="token operator">=</span> QApplication<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">)</span>
    imageFrame <span class="token operator">=</span> Image2Text<span class="token punctuation">(</span><span class="token punctuation">)</span>
    imageFrame<span class="token punctuation">.</span>setWindowTitle<span class="token punctuation">(</span>window_title<span class="token punctuation">)</span>
    imageFrame<span class="token punctuation">.</span>setWindowIcon<span class="token punctuation">(</span>QIcon<span class="token punctuation">(</span>app_icon_url<span class="token punctuation">)</span><span class="token punctuation">)</span>
    imageFrame<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
    sys<span class="token punctuation">.</span>excepthook <span class="token operator">=</span> except_hook
    sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span>app<span class="token punctuation">.</span>exec_<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2c75ac091066b63f19979529a325f700/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">每天五分钟玩转K8S（五）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f3bcd308a48799d8457827587e00ce51/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">vue-cli 配置 vue.config.js 创建代理服务器 解决跨域问题</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>