<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>DBA常用SQL语句 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="DBA常用SQL语句" />
<meta property="og:description" content="达梦数据库更新统计信息 收集指定用户下所有表所有列的统计信息：
-- 进入达梦命令行 disql cd /data/dmdbms/tool ./disql disql V7.6.1.52-Build(2020.03.17-119193)ENT SQL&gt; conn ncc_0611_TW/nccloud001@192.168.xx.xx:5236 服务器[192.168.61.19:5236]:处于普通打开状态 登录使用时间: 2.411(毫秒) SQL&gt; DBMS_STATS.GATHER_SCHEMA_STATS(&#39;CQJ&#39;,100,TRUE,&#39;FOR ALL COLUMNS SIZE AUTO&#39;); 收集指定用户下所有索引的统计信息：
DBMS_STATS.GATHER_SCHEMA_STATS(&#39;CQJ&#39;,1.0,TRUE,&#39;FOR ALL INDEXED SIZE AUTO&#39;); Mysql导入dump文件 login Mysql using root
drop database cqj; Then cmd to sql dump file path:
mysql -uroot -pWelcome1 &lt; 20210407cqj.sql If not drop database , then
c:\Data\sas\Datadump_mysql&gt;mysql -u root -pWelcome1 --default-character-set=utf8 -D jeesite &lt; 20200101.sql mysql: [Warning] Using a password on the command line interface can be insecure." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/8bd6802eb1c4c959eed67926cc69a9a3/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-01-31T16:25:13+08:00" />
<meta property="article:modified_time" content="2023-01-31T16:25:13+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">DBA常用SQL语句</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h4><a id="_0"></a>达梦数据库更新统计信息</h4> 
<p>收集指定用户下所有表所有列的统计信息：</p> 
<pre><code class="prism language-bash">-- 进入达梦命令行 disql
<span class="token builtin class-name">cd</span> /data/dmdbms/tool
./disql
disql V7.6.1.52-Build<span class="token punctuation">(</span><span class="token number">2020.03</span>.17-119193<span class="token punctuation">)</span>ENT
SQL<span class="token operator">&gt;</span> conn ncc_0611_TW/nccloud001@192.168.xx.xx:5236

服务器<span class="token punctuation">[</span><span class="token number">192.168</span>.61.19:5236<span class="token punctuation">]</span>:处于普通打开状态
登录使用时间: <span class="token number">2.411</span><span class="token punctuation">(</span>毫秒<span class="token punctuation">)</span>
SQL<span class="token operator">&gt;</span> DBMS_STATS.GATHER_SCHEMA_STATS<span class="token punctuation">(</span><span class="token string">'CQJ'</span>,100,TRUE,<span class="token string">'FOR ALL COLUMNS SIZE AUTO'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>收集指定用户下所有索引的统计信息：</p> 
<pre><code class="prism language-bash">DBMS_STATS.GATHER_SCHEMA_STATS<span class="token punctuation">(</span><span class="token string">'CQJ'</span>,1.0,TRUE,<span class="token string">'FOR ALL INDEXED SIZE AUTO'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="Mysqldump_21"></a>Mysql导入dump文件</h4> 
<p>login Mysql using root</p> 
<pre><code class="prism language-bash">drop database cqj<span class="token punctuation">;</span>
</code></pre> 
<p>Then cmd to sql dump file path:</p> 
<pre><code class="prism language-sql">mysql <span class="token operator">-</span>uroot <span class="token operator">-</span>pWelcome1 <span class="token operator">&lt;</span> <span class="token number">20210407</span>cqj<span class="token punctuation">.</span><span class="token keyword">sql</span>
</code></pre> 
<p>If not drop database , then</p> 
<pre><code class="prism language-sql">c:\<span class="token keyword">Data</span>\sas\Datadump_mysql<span class="token operator">&gt;</span>mysql <span class="token operator">-</span>u root <span class="token operator">-</span>pWelcome1 <span class="token comment">--default-character-set=utf8 -D jeesite &lt; 20200101.sql</span>
mysql: <span class="token punctuation">[</span>Warning<span class="token punctuation">]</span> <span class="token keyword">Using</span> a password <span class="token keyword">on</span> the command line interface can be insecure<span class="token punctuation">.</span>
</code></pre> 
<p>Parameter:<br> Usage: mysql [OPTIONS] [database] //命令方式<br> -?, --help //显示帮助信息并退出<br> -I, --help //显示帮助信息并退出<br> –auto-rehash //自动补全功能，就像linux里面，按Tab键出提示差不多<br> -A, --no-auto-rehash //默认状态是没有自动补全功能的。-A就是不要自动补全功能<br> -B, --batch //ysql不使用历史文件，禁用交互<br> (Enables --silent)<br> –character-sets-dir=name //字体集的安装目录<br> –default-character-set=name //设置数据库的默认字符集<br> -C, --compress //在客户端和服务器端传递信息时使用压缩<br> -#, --debug[=#] //bug调用功能<br> -D, --database=name //使用哪个数据库<br> –delimiter=name //mysql默认命令结束符是分号，下面有例子<br> -e, --execute=name //执行mysql的sql语句<br> -E, --vertical //垂直打印查询输出<br> -f, --force //如果有错误跳过去，继续执行下面的<br> -G, --named-commands<br> -g, --no-named-commands<br> -i, --ignore-spaces //忽视函数名后面的空格.<br> –local-infile //启动/禁用 LOAD DATA LOCAL INFILE.<br> -b, --no-beep //sql错误时，禁止嘟的一声<br> -h, --host=name //设置连接的服务器名或者Ip<br> -H, --html //以html的方式输出<br> -X, --xml //以xml的方式输出<br> –line-numbers //显示错误的行号<br> -L, --skip-line-numbers //忽略错误的行号<br> -n, --unbuffered //每执行一次sql后，刷新缓存<br> –column-names //查寻时显示列信息，默认是加上的<br> -N, --skip-column-names //不显示列信息<br> -O, --set-variable=name //设置变量用法是–set-variable=var_name=var_value<br> –sigint-ignore //忽视SIGINT符号(登录退出时Control-C的结果)<br> -o, --one-database //忽视除了为命令行中命名的默认数据库的语句。可以帮跳过日志中的其它数据库的更新。<br> –pager[=name] //使用分页器来显示查询输出，这个要在linux可以用more,less等。<br> –no-pager //不使用分页器来显示查询输出。<br> -p, --password[=name] //输入密码<br> -P, --port=# //设置端口<br> –prompt=name //设置mysql提示符<br> –protocol=name //使用什么协议<br> -q, --quick //不缓存查询的结果，顺序打印每一行。如果输出被挂起，服务器会慢下来，mysql不使用历史文件。<br> -r, --raw //写列的值而不转义转换。通常结合–batch选项使用。<br> –reconnect //如果与服务器之间的连接断开，自动尝试重新连接。禁止重新连接，使用–disable-reconnect。<br> -s, --silent //一行一行输出，中间有tab分隔<br> -S, --socket=name //连接服务器的sockey文件<br> –ssl //激活ssl连接，不激活–skip-ssl<br> –ssl-ca=name //CA证书<br> –ssl-capath=name //CA路径<br> –ssl-cert=name //X509 证书<br> –ssl-cipher=name //SSL cipher to use (implies --ssl).<br> –ssl-key=name //X509 密钥名<br> –ssl-verify-server-cert //连接时审核服务器的证书<br> -t, --table //以表格的形势输出<br> –tee=name //将输出拷贝添加到给定的文件中，禁时用–disable-tee<br> –no-tee //根–disable-tee功能一样<br> -u, --user=name //用户名<br> -U, --safe-updates //Only allow UPDATE and DELETE that uses keys.<br> -U, --i-am-a-dummy //Synonym for option --safe-updates, -U.<br> -v, --verbose //输出mysql执行的语句<br> -V, --version //版本信息<br> -w, --wait //服务器down后，等待到重起的时间<br> –connect_timeout=# //连接前要等待的时间<br> –max_allowed_packet=# //服务器接收／发送包的最大长度<br> –net_buffer_length=# //TCP / IP和套接字通信缓冲区大小。<br> –select_limit=# //使用–safe-updates时SELECT语句的自动限制<br> –max_join_size=# //使用–safe-updates时联接中的行的自动限制<br> –secure-auth //拒绝用(pre-4.1.1)的方式连接到数据库<br> –server-arg=name //Send embedded server this as a parameter.<br> –show-warnings //显示警告</p> 
<h4><a id="MySQLbinlog_109"></a>清除MySQL的binlog</h4> 
<p>查看当前的binlog</p> 
<pre><code class="prism language-sql"><span class="token keyword">show</span> <span class="token keyword">binary</span> logs<span class="token punctuation">;</span>
</code></pre> 
<p>删除无用的binlog</p> 
<pre><code class="prism language-sql"><span class="token keyword">purge</span> <span class="token keyword">binary</span> logs <span class="token keyword">to</span> <span class="token string">'binlog.000281'</span><span class="token punctuation">;</span>
</code></pre> 
<p>MySQL查看表信息</p> 
<pre><code class="prism language-sql"><span class="token keyword">use</span> 库名<span class="token punctuation">;</span>
<span class="token keyword">show</span> <span class="token keyword">table</span> <span class="token keyword">status</span> <span class="token operator">like</span> <span class="token string">'表名'</span> <span class="token punctuation">;</span> 
<span class="token keyword">select</span>
table_schema <span class="token keyword">as</span> <span class="token string">'数据库'</span><span class="token punctuation">,</span>
table_name <span class="token keyword">as</span> <span class="token string">'表名'</span><span class="token punctuation">,</span>
table_rows <span class="token keyword">as</span> <span class="token string">'记录数'</span><span class="token punctuation">,</span>
<span class="token keyword">truncate</span><span class="token punctuation">(</span>data_length<span class="token operator">/</span><span class="token number">1024</span><span class="token operator">/</span><span class="token number">1024</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'数据容量(MB)'</span><span class="token punctuation">,</span>
<span class="token keyword">truncate</span><span class="token punctuation">(</span>index_length<span class="token operator">/</span><span class="token number">1024</span><span class="token operator">/</span><span class="token number">1024</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'索引容量(MB)'</span>
<span class="token keyword">from</span> information_schema<span class="token punctuation">.</span><span class="token keyword">tables</span>
<span class="token keyword">order</span> <span class="token keyword">by</span> data_length <span class="token keyword">desc</span><span class="token punctuation">,</span> index_length <span class="token keyword">desc</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="oracle_136"></a>oracle查看表空间占用情况</h4> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> D<span class="token punctuation">.</span>TABLESPACE_NAME<span class="token punctuation">,</span>SPACE <span class="token string">"SUM_SPACE(M)"</span><span class="token punctuation">,</span>BLOCKS SUM_BLOCKS<span class="token punctuation">,</span>SPACE<span class="token operator">-</span>NVL<span class="token punctuation">(</span>FREE_SPACE<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token string">"USED_SPACE(M)"</span><span class="token punctuation">,</span>
<span class="token function">ROUND</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">-</span>NVL<span class="token punctuation">(</span>FREE_SPACE<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">/</span>SPACE<span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"USED_RATE(%)"</span><span class="token punctuation">,</span>FREE_SPACE <span class="token string">"FREE_SPACE(M)"</span>
<span class="token keyword">FROM</span> 
<span class="token punctuation">(</span><span class="token keyword">SELECT</span> TABLESPACE_NAME<span class="token punctuation">,</span><span class="token function">ROUND</span><span class="token punctuation">(</span><span class="token function">SUM</span><span class="token punctuation">(</span>BYTES<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token operator">*</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> SPACE<span class="token punctuation">,</span><span class="token function">SUM</span><span class="token punctuation">(</span>BLOCKS<span class="token punctuation">)</span> BLOCKS
<span class="token keyword">FROM</span> DBA_DATA_FILES
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> TABLESPACE_NAME<span class="token punctuation">)</span> D<span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token keyword">SELECT</span> TABLESPACE_NAME<span class="token punctuation">,</span><span class="token function">ROUND</span><span class="token punctuation">(</span><span class="token function">SUM</span><span class="token punctuation">(</span>BYTES<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token operator">*</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> FREE_SPACE
<span class="token keyword">FROM</span> DBA_FREE_SPACE
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> TABLESPACE_NAME <span class="token keyword">order</span> <span class="token keyword">by</span> TABLESPACE_NAME<span class="token punctuation">)</span> F
<span class="token keyword">WHERE</span>  D<span class="token punctuation">.</span>TABLESPACE_NAME <span class="token operator">=</span> F<span class="token punctuation">.</span>TABLESPACE_NAME<span class="token punctuation">(</span><span class="token operator">+</span><span class="token punctuation">)</span>
<span class="token keyword">UNION</span> <span class="token keyword">ALL</span>  <span class="token comment">--if have tempfile </span>
<span class="token keyword">SELECT</span> D<span class="token punctuation">.</span>TABLESPACE_NAME<span class="token punctuation">,</span>SPACE <span class="token string">"SUM_SPACE(M)"</span><span class="token punctuation">,</span>BLOCKS SUM_BLOCKS<span class="token punctuation">,</span> 
USED_SPACE <span class="token string">"USED_SPACE(M)"</span><span class="token punctuation">,</span><span class="token function">ROUND</span><span class="token punctuation">(</span>NVL<span class="token punctuation">(</span>USED_SPACE<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">/</span>SPACE<span class="token operator">*</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"USED_RATE(%)"</span><span class="token punctuation">,</span>
NVL<span class="token punctuation">(</span>FREE_SPACE<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token string">"FREE_SPACE(M)"</span>
<span class="token keyword">FROM</span> 
<span class="token punctuation">(</span><span class="token keyword">SELECT</span> TABLESPACE_NAME<span class="token punctuation">,</span><span class="token function">ROUND</span><span class="token punctuation">(</span><span class="token function">SUM</span><span class="token punctuation">(</span>BYTES<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token operator">*</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> SPACE<span class="token punctuation">,</span><span class="token function">SUM</span><span class="token punctuation">(</span>BLOCKS<span class="token punctuation">)</span> BLOCKS
<span class="token keyword">FROM</span> DBA_TEMP_FILES
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> TABLESPACE_NAME<span class="token punctuation">)</span> D<span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token keyword">SELECT</span> TABLESPACE_NAME<span class="token punctuation">,</span><span class="token function">ROUND</span><span class="token punctuation">(</span><span class="token function">SUM</span><span class="token punctuation">(</span>BYTES_USED<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token operator">*</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> USED_SPACE<span class="token punctuation">,</span>
<span class="token function">ROUND</span><span class="token punctuation">(</span><span class="token function">SUM</span><span class="token punctuation">(</span>BYTES_FREE<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token operator">*</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> FREE_SPACE
<span class="token keyword">FROM</span> V$TEMP_SPACE_HEADER
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> TABLESPACE_NAME<span class="token punctuation">)</span> F
<span class="token keyword">WHERE</span>  D<span class="token punctuation">.</span>TABLESPACE_NAME <span class="token operator">=</span> F<span class="token punctuation">.</span>TABLESPACE_NAME<span class="token punctuation">(</span><span class="token operator">+</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre> 
<h4><a id="1_Oracle_164"></a>1 查看Oracle性能参数</h4> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> view_definition <span class="token keyword">from</span> v$fixed_view_definition <span class="token keyword">where</span> view_name <span class="token operator">=</span> <span class="token string">'V$PARAMETER'</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> view_definition <span class="token keyword">from</span> v$fixed_view_definition <span class="token keyword">where</span> view_name <span class="token operator">=</span> <span class="token string">'GV$PARAMETER'</span><span class="token punctuation">;</span>

<span class="token keyword">select</span>  NUM <span class="token punctuation">,</span> NAME <span class="token punctuation">,</span> <span class="token keyword">TYPE</span> <span class="token punctuation">,</span> <span class="token keyword">VALUE</span> <span class="token punctuation">,</span> DISPLAY_VALUE<span class="token punctuation">,</span> ISDEFAULT <span class="token punctuation">,</span> ISSES_MODIFIABLE <span class="token punctuation">,</span> ISSYS_MODIFIABLE <span class="token punctuation">,</span> 
ISINSTANCE_MODIFIABLE<span class="token punctuation">,</span> ISMODIFIED <span class="token punctuation">,</span> ISADJUSTED <span class="token punctuation">,</span> ISDEPRECATED<span class="token punctuation">,</span> ISBASIC<span class="token punctuation">,</span> DESCRIPTION<span class="token punctuation">,</span> UPDATE_COMMENT<span class="token punctuation">,</span> <span class="token keyword">HASH</span>  
<span class="token keyword">from</span> GV$PARAMETER <span class="token keyword">where</span> inst_id <span class="token operator">=</span> USERENV<span class="token punctuation">(</span><span class="token string">'Instance'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="2__SQL_175"></a>2 查看消耗资源最多的 SQL：</h4> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> hash_value<span class="token punctuation">,</span> executions<span class="token punctuation">,</span> buffer_gets<span class="token punctuation">,</span> disk_reads<span class="token punctuation">,</span> parse_calls <span class="token keyword">FROM</span> V$SQLAREA
<span class="token keyword">WHERE</span> buffer_gets <span class="token operator">&gt;</span> <span class="token number">10000000</span> <span class="token operator">OR</span> disk_reads <span class="token operator">&gt;</span> <span class="token number">1000000</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> buffer_gets <span class="token operator">+</span> <span class="token number">100</span> <span class="token operator">*</span> disk_reads <span class="token keyword">DESC</span> <span class="token punctuation">;</span>
</code></pre> 
<h4><a id="3__SQL__183"></a>3 查看某条 SQL 语句的资源消耗：</h4> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> hash_value<span class="token punctuation">,</span> buffer_gets<span class="token punctuation">,</span> disk_reads<span class="token punctuation">,</span> executions<span class="token punctuation">,</span> parse_calls
<span class="token keyword">FROM</span> V$SQLAREA
<span class="token keyword">WHERE</span> hash_Value <span class="token operator">=</span> <span class="token number">228801498</span> <span class="token operator">AND</span> address <span class="token operator">=</span> hextoraw<span class="token punctuation">(</span> <span class="token string">'CBD8E4B0'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="4_10sql_191"></a>4 查找前10条性能差的sql语句</h4> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token punctuation">(</span><span class="token keyword">select</span> PARSING_USER_ID<span class="token punctuation">,</span>EXECUTIONS<span class="token punctuation">,</span>SORTS<span class="token punctuation">,</span>COMMAND_TYPE<span class="token punctuation">,</span>DISK_READS<span class="token punctuation">,</span>sql_text <span class="token keyword">FROM</span> v$sqlarea <span class="token keyword">order</span> <span class="token keyword">BY</span> disk_reads <span class="token keyword">DESC</span> <span class="token punctuation">)</span><span class="token keyword">where</span> ROWNUM<span class="token operator">&lt;</span><span class="token number">10</span> <span class="token punctuation">;</span>
</code></pre> 
<p>说明:<br> EXECUTIONS表示同一条SQL语句一共执行了多少次，SORTS表示排序的次数，DISK_READS表示物理读的数量。</p> 
<h4><a id="5__200"></a>5 解锁用户</h4> 
<p>1 使用root登录系统， 然后 su - oracle 到oracle用户<br> 2 以管理员身份登录oracle (<strong>sqlplus / as sysdba)</strong></p> 
<pre><code class="prism language-bash">   <span class="token punctuation">[</span>oracle@db4 ~<span class="token punctuation">]</span> sqlplus / as sysdba  
     
    SQL*Plus: Release <span class="token number">11.2</span>.0.1.0 Production on Sun Sep <span class="token number">30</span> 09:54:23 <span class="token number">2018</span>    
    Copyright <span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">1982</span>, <span class="token number">2009</span>, Oracle.  All rights reserved.    
    Connected to:
    Oracle Database 11g Enterprise Edition Release <span class="token number">11.2</span>.0.1.0 - 64bit Production
    With the Partitioning, OLAP, Data Mining and Real Application Testing options    
    SQL<span class="token operator">&gt;</span>
</code></pre> 
<p>3 查看用户状态：</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> username<span class="token punctuation">,</span>account_status <span class="token keyword">from</span> dba_users；
</code></pre> 
<p>4 解锁用户</p> 
<pre><code class="prism language-sql"><span class="token keyword">alter</span> <span class="token keyword">user</span> SYSTEM ACCOUNT <span class="token keyword">UNLOCK</span>；
</code></pre> 
<p>5 修改用户密码</p> 
<pre><code class="prism language-sql"><span class="token keyword">alter</span> <span class="token keyword">user</span> sys identified <span class="token keyword">by</span> password<span class="token punctuation">;</span>
</code></pre> 
<h4><a id="_229"></a>修改日期格式</h4> 
<p>关于日期格式的 oracle 语法</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> nls_session_parameters <span class="token keyword">where</span> parameter <span class="token operator">=</span> <span class="token string">'NLS_TIMESTAMP_FORMAT'</span> <span class="token punctuation">;</span> <span class="token comment">--'NLS_DATE_FORMAT'; -- 'DD-MON-RR HH.MI.SSXFF AM' --原格式</span>
<span class="token keyword">ALTER</span> <span class="token keyword">SESSION</span> <span class="token keyword">SET</span> NLS_TIMESTAMP_FORMAT <span class="token operator">=</span> <span class="token string">'YYYY-MM-DD HH24:MI:SS:FF6'</span><span class="token punctuation">;</span> 
<span class="token keyword">ALTER</span> <span class="token keyword">SESSION</span> <span class="token keyword">SET</span> NLS_date_FORMAT <span class="token operator">=</span> <span class="token string">'YYYY-MM-DD'</span><span class="token punctuation">;</span> 
<span class="token keyword">select</span> systimestamp <span class="token keyword">from</span> dual<span class="token punctuation">;</span>  

<span class="token keyword">select</span> unitid <span class="token punctuation">,</span> zcrq<span class="token punctuation">,</span> months_between<span class="token punctuation">(</span>zcrq<span class="token punctuation">,</span>to_date<span class="token punctuation">(</span><span class="token string">'9999-12-01 00:00:00'</span><span class="token punctuation">,</span><span class="token string">'yyyy-mm-dd hh24:mi:ss'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token keyword">from</span> prr_enterprise
<span class="token keyword">where</span> months_between<span class="token punctuation">(</span>zcrq<span class="token punctuation">,</span>to_date<span class="token punctuation">(</span><span class="token string">'9999-12-01 00:00:00'</span><span class="token punctuation">,</span><span class="token string">'yyyy-mm-dd hh24:mi:ss'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token keyword">update</span> prr_enterprise <span class="token keyword">set</span> zcrq <span class="token operator">=</span> to_date<span class="token punctuation">(</span><span class="token string">'1900-12-01 00:00:00'</span><span class="token punctuation">,</span><span class="token string">'yyyy-mm-dd hh24:mi:ss'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
gsdjrq <span class="token operator">=</span> to_date<span class="token punctuation">(</span><span class="token string">'1900-12-01 00:00:00'</span><span class="token punctuation">,</span><span class="token string">'yyyy-mm-dd hh24:mi:ss'</span><span class="token punctuation">)</span>
<span class="token keyword">where</span> unitid <span class="token operator">in</span> 
<span class="token punctuation">(</span><span class="token keyword">select</span> unitid <span class="token keyword">from</span> prr_enterprise <span class="token keyword">where</span> months_between<span class="token punctuation">(</span>zcrq<span class="token punctuation">,</span>to_date<span class="token punctuation">(</span><span class="token string">'9999-12-01 00:00:00'</span><span class="token punctuation">,</span><span class="token string">'yyyy-mm-dd hh24:mi:ss'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="MySQL_246"></a>MySQL库表区分大小写</h4> 
<p>lower_case_table_names 是mysql设置大小写是否敏感的一个参数。<br> .参数说明：</p> 
<pre><code>lower_case_table_names=0 表名存储为给定的大小和比较是区分大小写的 
lower_case_table_names = 1 表名存储在磁盘是小写的，但是比较的时候是不区分大小写
lower_case_table_names=2 表名存储为给定的大小写但是比较的时候是小写的
unix,linux下lower_case_table_names默认值为 0 .Windows下默认值是 1 .Mac OS X下默认值是 2
</code></pre> 
<p>查看方法：</p> 
<pre><code class="prism language-sql"><span class="token comment">#进入mysql命令行 执行以下任一语句查看：</span>
<span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">'lower_case_table_names'</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> @<span class="token variable">@lower_case_table_names</span><span class="token punctuation">;</span>
</code></pre> 
<p>更改方法：</p> 
<pre><code>更改数据库参数文件my.cnf
在mysqld下 添加或修改 lower_case_table_names = 1
之后重启数据库
</code></pre> 
<p>现实情况修改 注意事项：</p> 
<p>因目前MySQL安装在Linux系统上较多 初始化时采取了默认的lower_case_table_names值 即区分大小写，后续可能会造成同一实例大小写库表都存在的情况，调用时还要注意大小写。<br> 这时 更改步骤如下：</p> 
<pre><code>1.核实实例中是否存在大写的库及表
2.将大写的库名及表名改为小写
更改库名可参考：https://www.cnblogs.com/gomysql/p/3584881.html
更改表名：rename table TEST_TB to test_tb;
3.设置lower_case_table_names = 1
4.重启数据库
</code></pre> 
<h4><a id="Oracle_280"></a>修改Oracle的用户密码</h4> 
<p>隔几个月Oracle会提醒你的用户密码要过期，需要这么修改：<br> 1 使用sqlplus方式本地登录oracle数据库</p> 
<pre><code class="prism language-sql">sqlplus <span class="token operator">/</span> <span class="token keyword">as</span> sysdba<span class="token punctuation">;</span>
</code></pre> 
<p>2 查看用户</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> username <span class="token keyword">from</span> dba_users<span class="token punctuation">;</span>
</code></pre> 
<p>3 修改用户</p> 
<pre><code class="prism language-sql"><span class="token keyword">alter</span> <span class="token keyword">user</span> cqj identified <span class="token keyword">by</span> xxxxxx<span class="token punctuation">;</span>
</code></pre> 
<h4><a id="_299"></a>综合查询</h4> 
<p>1 任意时点企业信息查询</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> dbs_enterprise <span class="token keyword">where</span> startdate<span class="token operator">&lt;</span> date_format<span class="token punctuation">(</span><span class="token string">'2017-1-1'</span><span class="token punctuation">,</span><span class="token string">'%Y-%m-%d %H:%i:%s'</span><span class="token punctuation">)</span> 
<span class="token operator">and</span> enddate <span class="token operator">&gt;</span> date_format<span class="token punctuation">(</span><span class="token string">'2017-1-1'</span><span class="token punctuation">,</span><span class="token string">'%Y-%m-%d %H:%i:%s'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> dbs_enterprise <span class="token keyword">where</span> startdate<span class="token operator">&lt;</span> date_format<span class="token punctuation">(</span><span class="token string">'2018-1-1'</span><span class="token punctuation">,</span><span class="token string">'%Y-%m-%d %H:%i:%s'</span><span class="token punctuation">)</span> 
<span class="token operator">and</span> enddate <span class="token operator">&gt;</span> date_format<span class="token punctuation">(</span><span class="token string">'2018-1-1'</span><span class="token punctuation">,</span><span class="token string">'%Y-%m-%d %H:%i:%s'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> dbs_enterprise <span class="token keyword">where</span> startdate<span class="token operator">&lt;</span> date_format<span class="token punctuation">(</span><span class="token string">'2019-1-1'</span><span class="token punctuation">,</span><span class="token string">'%Y-%m-%d %H:%i:%s'</span><span class="token punctuation">)</span> 
<span class="token operator">and</span> enddate <span class="token operator">&gt;</span> date_format<span class="token punctuation">(</span><span class="token string">'2019-1-1'</span><span class="token punctuation">,</span><span class="token string">'%Y-%m-%d %H:%i:%s'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> dbs_enterprise <span class="token keyword">where</span> startdate<span class="token operator">&lt;</span> date_format<span class="token punctuation">(</span><span class="token string">'2020-1-1'</span><span class="token punctuation">,</span><span class="token string">'%Y-%m-%d %H:%i:%s'</span><span class="token punctuation">)</span> 
<span class="token operator">and</span> enddate <span class="token operator">&gt;</span> date_format<span class="token punctuation">(</span><span class="token string">'2020-1-1'</span><span class="token punctuation">,</span><span class="token string">'%Y-%m-%d %H:%i:%s'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> dbs_enterprise <span class="token keyword">where</span> startdate<span class="token operator">&lt;</span> date_format<span class="token punctuation">(</span>sysdate<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'%Y-%m-%d %H:%i:%s'</span><span class="token punctuation">)</span> 
<span class="token operator">and</span> enddate <span class="token operator">&gt;</span> date_format<span class="token punctuation">(</span>sysdate<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'%Y-%m-%d %H:%i:%s'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="_Lock_wait_timeout_exceeded_try_restarting_transaction_314"></a>创建索引出错 Lock wait timeout exceeded; try restarting transaction</h4> 
<p>1 查看当前Mysql的进程, 分析是否有慢sql</p> 
<pre><code class="prism language-sql"><span class="token keyword">SHOW</span> PROCESSLIST<span class="token punctuation">;</span>   
</code></pre> 
<p>或者</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> INFORMATION_SCHEMA<span class="token punctuation">.</span>PROCESSLIST<span class="token punctuation">;</span> 
</code></pre> 
<p>2 查看当前的事务</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> INFORMATION_SCHEMA<span class="token punctuation">.</span>INNODB_TRX <span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> INFORMATION_SCHEMA<span class="token punctuation">.</span>INNODB_LOCKS <span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> INFORMATION_SCHEMA<span class="token punctuation">.</span>INNODB_LOCK_WAITS <span class="token punctuation">;</span>
</code></pre> 
<p>看事务表INNODB_TRX，里面是否有正在锁定的事务线程，看看ID是否在show processlist里面的sleep线程中，如果是，就证明这个sleep的线程事务一直没有commit或者rollback而是卡住了，我们需要手动kill掉.</p> 
<p>3 批量删除事务</p> 
<pre><code class="prism language-js">select <span class="token function">concat</span><span class="token punctuation">(</span><span class="token string">'KILL '</span><span class="token punctuation">,</span>id<span class="token punctuation">,</span><span class="token string">';'</span><span class="token punctuation">)</span> from information_schema<span class="token punctuation">.</span>processlist where user<span class="token operator">=</span><span class="token string">'root'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">+</span>
<span class="token operator">|</span> <span class="token function">concat</span><span class="token punctuation">(</span><span class="token string">'KILL '</span><span class="token punctuation">,</span>id<span class="token punctuation">,</span><span class="token string">';'</span><span class="token punctuation">)</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">+</span>
<span class="token operator">|</span> <span class="token constant">KILL</span> <span class="token number">10508</span><span class="token punctuation">;</span>            <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token constant">KILL</span> <span class="token number">10521</span><span class="token punctuation">;</span>            <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token constant">KILL</span> <span class="token number">10297</span><span class="token punctuation">;</span>            <span class="token operator">|</span>
<span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">+</span>
<span class="token number">18</span> rows <span class="token keyword">in</span> <span class="token function">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre> 
<p>然后 删掉进程：</p> 
<pre><code class="prism language-sql">mysql<span class="token operator">&gt;</span> <span class="token keyword">kill</span> xxxx <span class="token punctuation">;</span>  
</code></pre> 
<h4><a id="_360"></a>使用数据泵</h4> 
<ol><li>安装oracle数据库并配置</li><li>创建oracle数据库逻辑目录</li></ol> 
<pre><code class="prism language-sql"><span class="token keyword">SQL</span><span class="token operator">&gt;</span> <span class="token keyword">create</span> directory datadump <span class="token keyword">as</span> <span class="token string">'/home/oracle/datadump'</span><span class="token punctuation">;</span>
Directory created<span class="token punctuation">.</span>
</code></pre> 
<ol start="3"><li>创建cqj用户并授权。</li></ol> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLESPACE</span> data_space_cqj DATAFILE <span class="token string">'/oracle/oradata/cqj/spacecqj1.dbf'</span> SIZE <span class="token number">10240</span>M AUTOEXTEND <span class="token keyword">ON</span> <span class="token keyword">NEXT</span> <span class="token number">1024</span>M MAXSIZE <span class="token number">30720</span>M<span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-sql"><span class="token comment">// ALTER TABLESPACE data_space_cqj ADD DATAFILE '/oracle/oradata/cqj/spacecqj2.dbf' SIZE 10240M AUTOEXTEND ON NEXT 1024M MAXSIZE 30720M;</span>
<span class="token keyword">create</span> <span class="token keyword">user</span> cqj identified <span class="token keyword">by</span> cqj <span class="token keyword">default</span> <span class="token keyword">tablespace</span> data_space_cqj<span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-sql"><span class="token keyword">GRANT</span> <span class="token keyword">CREATE</span> <span class="token keyword">SESSION</span><span class="token punctuation">,</span><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span><span class="token punctuation">,</span><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span><span class="token punctuation">,</span><span class="token keyword">CREATE</span> SEQUENCE<span class="token punctuation">,</span>UNLIMITED <span class="token keyword">TABLESPACE</span> <span class="token keyword">TO</span> cqj<span class="token punctuation">;</span> 
<span class="token keyword">GRANT</span> <span class="token keyword">CONNECT</span> <span class="token keyword">TO</span> cqj<span class="token punctuation">;</span> 
<span class="token keyword">GRANT</span> RESOURCE <span class="token keyword">TO</span> cqj<span class="token punctuation">;</span> 
<span class="token keyword">GRANT</span> DBA <span class="token keyword">TO</span> cqj<span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-sql"><span class="token keyword">SQL</span><span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">user</span> cqj identified <span class="token keyword">by</span> cqj<span class="token punctuation">;</span>
<span class="token keyword">User</span> created<span class="token punctuation">.</span>
<span class="token keyword">SQL</span><span class="token operator">&gt;</span> <span class="token keyword">grant</span> dba <span class="token keyword">to</span> cqj<span class="token punctuation">;</span>
<span class="token keyword">Grant</span> succeeded<span class="token punctuation">.</span>
<span class="token keyword">SQL</span><span class="token operator">&gt;</span> <span class="token keyword">grant</span> <span class="token keyword">write</span><span class="token punctuation">,</span><span class="token keyword">read</span> <span class="token keyword">on</span> directory datapump <span class="token keyword">to</span> cqj<span class="token punctuation">;</span>
<span class="token keyword">Grant</span> succeeded<span class="token punctuation">.</span>
</code></pre> 
<ol start="4"><li>将备份文件（以cqj.dmp为例）上传至/home/oracle/datadump 目录下。</li></ol> 
<pre><code class="prism language-sql"><span class="token punctuation">[</span>oracle<span class="token variable">@db01</span> dpump<span class="token punctuation">]</span>$ ls
cqj<span class="token punctuation">.</span>dmp
</code></pre> 
<ol start="5"><li>执行expdp命令，导入数据库。</li></ol> 
<pre><code class="prism language-powershell"><span class="token namespace">[oracle@db01 dpump]</span>$ impdp cqj/cqj@localhost:1521/orcl directory=datadump dumpfile=cqj<span class="token punctuation">.</span>dmp transform=segment_attributes:n table_exists_action=replace logfile=cqj<span class="token punctuation">.</span>log
</code></pre> 
<pre><code>输出如下：

```powershell
Copyright (c) 1982, 2011, Oracle and/or its affiliates.  All rights reserved.

Connected to: Oracle Database 11g Enterprise Edition Release 11.2.0.4.0 - 64bit Production
With the Partitioning, OLAP, Data Mining and Real Application Testing options
Master table "CQJ"."SYS_IMPORT_FULL_01" successfully loaded/unloaded
Starting "CQJ"."SYS_IMPORT_FULL_01":  cqj/********@localhost:1521/orcl directory=datapump dumpfile=cqj.dmp transform=segment_attributes:n table_exists_action=replace logfile=cqj.log 
Processing object type SCHEMA_EXPORT/USER
ORA-31684: Object type USER:"CQJ" already exists
Processing object type SCHEMA_EXPORT/SYSTEM_GRANT
Processing object type SCHEMA_EXPORT/ROLE_GRANT
Processing object type SCHEMA_EXPORT/DEFAULT_ROLE
Processing object type SCHEMA_EXPORT/PRE_SCHEMA/PROCACT_SCHEMA
Processing object type SCHEMA_EXPORT/SEQUENCE/SEQUENCE
………
. . imported "CQJ"."LOGRECORD"                 206.3 MB    4072 rows
. . imported "CQJ"."PRR_DRAFT"69.50 MB   48246 rows
. . imported "CQJ"."ACT_GE_BYTEARRAY"69.15 MB  114656 rows
. . imported "CQJ"."PRR_ENTERPRISE"             45.25 KB      23 rows
. . imported "CQJ"."PRR_INVESTOR"               47.43 MB  291404 rows
………
Processing object type SCHEMA_EXPORT/TABLE/TRIGGER
Processing object type SCHEMA_EXPORT/TABLE/STATISTICS/TABLE_STATISTICS
Job "CQJ"."SYS_IMPORT_FULL_01" completed with 25 error(s) at Wed Sep 11 00:08:34 2019 elapsed 0 00:02:27
</code></pre> 
<p>参数说明：<br> ①　Directory：指定逻辑目录。<br> ②　Dumpfile：指定备份文件路径及文件名。<br> ③　Logfile：指定日志文件路径及文件名。<br> ④　Transform=segment_attributes:n：数据导入默认表空间之中，无 需新建表空间。<br> ⑤　Table_exists_action=replace：如表存在，则覆盖。</p> 
<ol start="6"><li>检查数据导入是否成功。（检查表的个数）</li></ol> 
<pre><code class="prism language-sql"><span class="token keyword">SQL</span><span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> user_tables<span class="token punctuation">;</span>

  <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span>
<span class="token comment">----------</span>
   <span class="token number">360</span>
</code></pre> 
<p>PS:<br> – 查看当前用户的缺省表空间</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> user_users<span class="token punctuation">;</span>
</code></pre> 
<p>查看数据库表空间使用情况：</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> D<span class="token punctuation">.</span>TABLESPACE_NAME<span class="token punctuation">,</span>SPACE <span class="token string">"SUM_SPACE(M)"</span><span class="token punctuation">,</span>BLOCKS SUM_BLOCKS<span class="token punctuation">,</span>SPACE<span class="token operator">-</span>NVL<span class="token punctuation">(</span>FREE_SPACE<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token string">"USED_SPACE(M)"</span><span class="token punctuation">,</span>
<span class="token function">ROUND</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">-</span>NVL<span class="token punctuation">(</span>FREE_SPACE<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">/</span>SPACE<span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"USED_RATE(%)"</span><span class="token punctuation">,</span>FREE_SPACE <span class="token string">"FREE_SPACE(M)"</span>
<span class="token keyword">FROM</span> 
<span class="token punctuation">(</span><span class="token keyword">SELECT</span> TABLESPACE_NAME<span class="token punctuation">,</span><span class="token function">ROUND</span><span class="token punctuation">(</span><span class="token function">SUM</span><span class="token punctuation">(</span>BYTES<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token operator">*</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> SPACE<span class="token punctuation">,</span><span class="token function">SUM</span><span class="token punctuation">(</span>BLOCKS<span class="token punctuation">)</span> BLOCKS
<span class="token keyword">FROM</span> DBA_DATA_FILES
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> TABLESPACE_NAME<span class="token punctuation">)</span> D<span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token keyword">SELECT</span> TABLESPACE_NAME<span class="token punctuation">,</span><span class="token function">ROUND</span><span class="token punctuation">(</span><span class="token function">SUM</span><span class="token punctuation">(</span>BYTES<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token operator">*</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> FREE_SPACE
<span class="token keyword">FROM</span> DBA_FREE_SPACE
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> TABLESPACE_NAME <span class="token keyword">order</span> <span class="token keyword">by</span> TABLESPACE_NAME<span class="token punctuation">)</span> F
<span class="token keyword">WHERE</span>  D<span class="token punctuation">.</span>TABLESPACE_NAME <span class="token operator">=</span> F<span class="token punctuation">.</span>TABLESPACE_NAME<span class="token punctuation">(</span><span class="token operator">+</span><span class="token punctuation">)</span>
<span class="token keyword">UNION</span> <span class="token keyword">ALL</span>  <span class="token comment">--if have tempfile </span>
<span class="token keyword">SELECT</span> D<span class="token punctuation">.</span>TABLESPACE_NAME<span class="token punctuation">,</span>SPACE <span class="token string">"SUM_SPACE(M)"</span><span class="token punctuation">,</span>BLOCKS SUM_BLOCKS<span class="token punctuation">,</span> 
USED_SPACE <span class="token string">"USED_SPACE(M)"</span><span class="token punctuation">,</span><span class="token function">ROUND</span><span class="token punctuation">(</span>NVL<span class="token punctuation">(</span>USED_SPACE<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">/</span>SPACE<span class="token operator">*</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"USED_RATE(%)"</span><span class="token punctuation">,</span>
NVL<span class="token punctuation">(</span>FREE_SPACE<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token string">"FREE_SPACE(M)"</span>
<span class="token keyword">FROM</span> 
<span class="token punctuation">(</span><span class="token keyword">SELECT</span> TABLESPACE_NAME<span class="token punctuation">,</span><span class="token function">ROUND</span><span class="token punctuation">(</span><span class="token function">SUM</span><span class="token punctuation">(</span>BYTES<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token operator">*</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> SPACE<span class="token punctuation">,</span><span class="token function">SUM</span><span class="token punctuation">(</span>BLOCKS<span class="token punctuation">)</span> BLOCKS
<span class="token keyword">FROM</span> DBA_TEMP_FILES
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> TABLESPACE_NAME<span class="token punctuation">)</span> D<span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token keyword">SELECT</span> TABLESPACE_NAME<span class="token punctuation">,</span><span class="token function">ROUND</span><span class="token punctuation">(</span><span class="token function">SUM</span><span class="token punctuation">(</span>BYTES_USED<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token operator">*</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> USED_SPACE<span class="token punctuation">,</span>
<span class="token function">ROUND</span><span class="token punctuation">(</span><span class="token function">SUM</span><span class="token punctuation">(</span>BYTES_FREE<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token operator">*</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> FREE_SPACE
<span class="token keyword">FROM</span> V$TEMP_SPACE_HEADER
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> TABLESPACE_NAME<span class="token punctuation">)</span> F
<span class="token keyword">WHERE</span>  D<span class="token punctuation">.</span>TABLESPACE_NAME <span class="token operator">=</span> F<span class="token punctuation">.</span>TABLESPACE_NAME<span class="token punctuation">(</span><span class="token operator">+</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre> 
<p>7,导出部分表</p> 
<pre><code class="prism language-sql">expdp cqj<span class="token operator">/</span>Welcome1<span class="token variable">@orcl</span> directory<span class="token operator">=</span>datadump <span class="token keyword">tables</span><span class="token operator">=</span>CQJ<span class="token punctuation">.</span>SYS_LOG<span class="token punctuation">,</span>CQJ<span class="token punctuation">.</span>ACT_HI_DETAIL<span class="token punctuation">,</span>CQJ<span class="token punctuation">.</span>ACT_HI_ACTINST<span class="token punctuation">,</span>CQJ<span class="token punctuation">.</span>ACT_HI_IDENTITYLINK<span class="token punctuation">,</span>CQJ<span class="token punctuation">.</span>ACT_HI_VARINST<span class="token punctuation">,</span>CQJ<span class="token punctuation">.</span>ACT_HI_TASKINST<span class="token punctuation">,</span>CQJ<span class="token punctuation">.</span>LOGRECORD<span class="token punctuation">,</span>CQJ<span class="token punctuation">.</span>PRR_ENTERPRISEHIS<span class="token punctuation">,</span>CQJ<span class="token punctuation">.</span>PRR_INVESTOR_HIS<span class="token punctuation">,</span>CQJ<span class="token punctuation">.</span>ACT_GE_BYTEARRAY<span class="token punctuation">,</span>CQJ<span class="token punctuation">.</span>PRR_DRAFT<span class="token punctuation">,</span>CQJ<span class="token punctuation">.</span>ACT_HI_COMMENT <span class="token keyword">dumpfile</span><span class="token operator">=</span>cqj_20200330<span class="token punctuation">.</span>dmp logfile<span class="token operator">=</span>cqj_20200330<span class="token punctuation">.</span>log
</code></pre> 
<p>2021/1/4 向本地oracle数据库导入备份文件</p> 
<pre><code class="prism language-powershell">c:\<span class="token keyword">Data</span>\sas\Datadump_mysql&gt;impdp cqj/cqj@JONIU-CN:1521/orcl directory=datadump dumpfile=cqj20201231<span class="token punctuation">.</span>dmp remap_schema=CQJ:CQJ remap_tablespace=CQJ:DATA_SPACE_CQJ transform=segment_attributes:n table_exists_action=replace logfile=cqj20210104<span class="token punctuation">.</span>log
</code></pre> 
<p>清理ORACLE数据库的temp表空间</p> 
<pre><code class="prism language-sql"><span class="token keyword">create</span> <span class="token keyword">temporary</span> <span class="token keyword">tablespace</span> TEMPA TEMPFILE <span class="token string">'C:\APP\JONIU\ORADATA\ORCL\TEMPA01.DBF'</span> SIZE <span class="token number">4096</span>M REUSE AUTOEXTEND <span class="token keyword">ON</span> <span class="token keyword">NEXT</span> <span class="token number">1024</span>K MAXSIZE <span class="token number">10240</span>M<span class="token punctuation">;</span>   <span class="token comment">--创建中转临时表空间 </span>
<span class="token keyword">alter</span> <span class="token keyword">database</span> <span class="token keyword">default</span> <span class="token keyword">temporary</span> <span class="token keyword">tablespace</span> tempa<span class="token punctuation">;</span>  <span class="token comment">--改变缺省临时表空间</span>
<span class="token keyword">drop</span> <span class="token keyword">tablespace</span> <span class="token keyword">temp</span> including contents <span class="token operator">and</span> datafiles<span class="token punctuation">;</span>  <span class="token comment">--删除原来临时表空间 </span>
此时windows系统里的TEMP01<span class="token punctuation">.</span>DBF文件并没有被删除，需要关闭数据库实例后手动删除
<span class="token keyword">shutdown</span> immediate<span class="token punctuation">;</span>
删除文件
startup<span class="token punctuation">;</span>
</code></pre> 
<p>查看数据库内表容量</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> segment_name<span class="token punctuation">,</span> bytes<span class="token operator">/</span><span class="token number">1024</span><span class="token operator">/</span><span class="token number">1024</span><span class="token operator">||</span><span class="token string">'MB'</span> <span class="token keyword">from</span> user_segments
<span class="token keyword">where</span> segment_type <span class="token operator">=</span> <span class="token string">'TABLE'</span> <span class="token keyword">order</span> <span class="token keyword">by</span> bytes <span class="token keyword">desc</span><span class="token punctuation">;</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c53fd0e6c65681f41410ae3b9fd675ad/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Kettle 实战教程</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8fded5fb5ba9240871e6bde250173229/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Ubuntu16.04 网络连接后很快断开</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>