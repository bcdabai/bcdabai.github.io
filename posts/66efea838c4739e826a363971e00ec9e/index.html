<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【Modbus通信实验一】查表法实现CRC16校验 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【Modbus通信实验一】查表法实现CRC16校验" />
<meta property="og:description" content="CRC：Cyclic Redundant Check（循环冗余校验） 在数据链路层中，对于通信传输的差错检测一般有两种：使用纠错码（error-correcting code，又称前向纠错/FEC(Forward Error Correction )）或检错码，前者可用来检测哪些比特位有误，而后者只能用来检测传输的整体上是否出错，若出错则需请求重传。
典型的纠错码包括汉明码、二进制卷积码、里德所罗门码以及低密度奇偶校验码（LDPC）等等。而检错码的代表则有奇偶校验码、校验和（checksum）以及循环冗余校验。
循环冗余校验（CRC）是奇偶校验码的改进，又称为多项式编码，其原理为：发送方与接收方约定一个相同的多项式（POLY），如多项式x6&#43;x4&#43;x2&#43;x&#43;1对应的二进制码为1010111，然后将发送报文对改二进制码进行异或运算（即做除法），得到的余数则为CRC校验码，并附带在发送报文之后。接收方再将收到的报文对该二进制数进行异或运算，若没有余数（即能整除）则说明传输无误，否则需要重传。
CRC的多项式可以自由选择或者使用国际通行标准，一般按照多项式的阶数m，将CRC算法称为CRC-m，比如CRC-16、CRC-32，其中CRC-16被用于Modbus RTU通信协议中。
http://www.ip33.com/crc.html中可以计算包括Modbus在内的不同规则下的CRC校验码结果：
查表法计算CRC校验码 1.生成CRC16表 对于较长的报文，连续进行异或运算会消耗太多计算资源，特别是在性能受限的下位机上，因此计算CRC码一般不用直接计算法而是采用查表法。CRC16的表为0x00到0xff的256个整数，与多项式0x8005通过上述计算方式提前算好并生成，以便计算机在后续环节可以直接调用算好的数据，节省时间。
生成好的表如下：
const UINT16 auchCRC[256] = { 0x0000,0xC0C1,0xC181,0x0140,0xC301,0x03C0,0x0280,0xC241,0xC601,0x06C0,0x0780,0xC741,0x0500,0xC5C1,0xC481,0x0440,0xCC01,0x0CC0,0x0D80,0xCD41,0x0F00,0xCFC1,0xCE81,0x0E40,0x0A00,0xCAC1,0xCB81,0x0B40,0xC901,0x09C0,0x0880,0xC841,0xD801,0x18C0,0x1980,0xD941,0x1B00,0xDBC1,0xDA81,0x1A40,0x1E00,0xDEC1,0xDF81,0x1F40,0xDD01,0x1DC0,0x1C80,0xDC41,0x1400,0xD4C1,0xD581,0x1540,0xD701,0x17C0,0x1680,0xD641,0xD201,0x12C0,0x1380,0xD341,0x1100,0xD1C1,0xD081,0x1040,0xF001,0x30C0,0x3180,0xF141,0x3300,0xF3C1,0xF281,0x3240,0x3600,0xF6C1,0xF781,0x3740,0xF501,0x35C0,0x3480,0xF441,0x3C00,0xFCC1,0xFD81,0x3D40,0xFF01,0x3FC0,0x3E80,0xFE41,0xFA01,0x3AC0,0x3B80,0xFB41,0x3900,0xF9C1,0xF881,0x3840,0x2800,0xE8C1,0xE981,0x2940,0xEB01,0x2BC0,0x2A80,0xEA41,0xEE01,0x2EC0,0x2F80,0xEF41,0x2D00,0xEDC1,0xEC81,0x2C40,0xE401,0x24C0,0x2580,0xE541,0x2700,0xE7C1,0xE681,0x2640,0x2200,0xE2C1,0xE381,0x2340,0xE101,0x21C0,0x2080,0xE041,0xA001,0x60C0,0x6180,0xA141,0x6300,0xA3C1,0xA281,0x6240,0x6600,0xA6C1,0xA781,0x6740,0xA501,0x65C0,0x6480,0xA441,0x6C00,0xACC1,0xAD81,0x6D40,0xAF01,0x6FC0,0x6E80,0xAE41,0xAA01,0x6AC0,0x6B80,0xAB41,0x6900,0xA9C1,0xA881,0x6840,0x7800,0xB8C1,0xB981,0x7940,0xBB01,0x7BC0,0x7A80,0xBA41,0xBE01,0x7EC0,0x7F80,0xBF41,0x7D00,0xBDC1,0xBC81,0x7C40,0xB401,0x74C0,0x7580,0xB541,0x7700,0xB7C1,0xB681,0x7640,0x7200,0xB2C1,0xB381,0x7340,0xB101,0x71C0,0x7080,0xB041,0x5000,0x90C1,0x9181,0x5140,0x9301,0x53C0,0x5280,0x9241,0x9601,0x56C0,0x5780,0x9741,0x5500,0x95C1,0x9481,0x5440,0x9C01,0x5CC0,0x5D80,0x9D41,0x5F00,0x9FC1,0x9E81,0x5E40,0x5A00,0x9AC1,0x9B81,0x5B40,0x9901,0x59C0,0x5880,0x9841,0x8801,0x48C0,0x4980,0x8941,0x4B00,0x8BC1,0x8A81,0x4A40,0x4E00,0x8EC1,0x8F81,0x4F40,0x8D01,0x4DC0,0x4C80,0x8C41,0x4400,0x84C1,0x8581,0x4540,0x8701,0x47C0,0x4680,0x8641,0x8201,0x42C0,0x4380,0x8341,0x4100,0x81C1,0x8081,0x4040 }; 表的生成算法可以参考：https://blog.csdn.net/m0_57585228/article/details/125088520
代码：
#define POLY 0xA001 // 生成多项式Ox8005的反序，即1000000000000101→1010000000000001，即A001 unsigned short auchCRC[256]; // CRC表 void make_crc_table(void) // 生成CRC表的函数 { unsigned short c; int i, j; for (i = 0; i &lt; 256; i&#43;&#43;) { c = i; for (j = 0; j &lt; 8; j&#43;&#43;) { if (c &amp; 0x1) // 如果最低位为1，则右移一位并与生成多项式异或（商1） c = (c &gt;&gt; 1) ^ POLY; else // 如果最低位为0，则只右移一位，无需异或（商0） c = c &gt;&gt; 1; } auchCRC[i] = c; // 将计算出的CRC校验码存入表中 } } 2." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/66efea838c4739e826a363971e00ec9e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-09-19T19:48:10+08:00" />
<meta property="article:modified_time" content="2023-09-19T19:48:10+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【Modbus通信实验一】查表法实现CRC16校验</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="CRCCyclic_Redundant_Check_3"></a>CRC：Cyclic Redundant Check（循环冗余校验）</h3> 
<p>在数据链路层中，对于通信传输的差错检测一般有两种：使用纠错码（error-correcting code，又称前向纠错/FEC(Forward Error Correction )）或检错码，前者可用来检测哪些比特位有误，而后者只能用来检测传输的整体上是否出错，若出错则需请求重传。<br> 典型的纠错码包括汉明码、二进制卷积码、里德所罗门码以及低密度奇偶校验码（LDPC）等等。而检错码的代表则有奇偶校验码、校验和（checksum）以及循环冗余校验。<br> 循环冗余校验（CRC）是奇偶校验码的改进，又称为多项式编码，其原理为：发送方与接收方约定一个相同的多项式（POLY），如多项式x6+x4+x2+x+1对应的二进制码为1010111，然后将发送报文对改二进制码进行异或运算（即做除法），得到的余数则为CRC校验码，并附带在发送报文之后。接收方再将收到的报文对该二进制数进行异或运算，若没有余数（即能整除）则说明传输无误，否则需要重传。<br> CRC的多项式可以自由选择或者使用国际通行标准，一般按照多项式的阶数m，将CRC算法称为CRC-m，比如CRC-16、CRC-32，其中CRC-16被用于Modbus RTU通信协议中。<br> <a href="http://www.ip33.com/crc.html" rel="nofollow">http://www.ip33.com/crc.html</a>中可以计算包括Modbus在内的不同规则下的CRC校验码结果：<br> <img src="https://images2.imgbox.com/7b/6d/xdZuEnBv_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="CRC_13"></a>查表法计算CRC校验码</h3> 
<h6><a id="1CRC16_14"></a>1.生成CRC16表</h6> 
<p>对于较长的报文，连续进行异或运算会消耗太多计算资源，特别是在性能受限的下位机上，因此计算CRC码一般不用直接计算法而是采用查表法。CRC16的表为0x00到0xff的256个整数，与多项式0x8005通过上述计算方式提前算好并生成，以便计算机在后续环节可以直接调用算好的数据，节省时间。<br> 生成好的表如下：</p> 
<pre><code class="prism language-c"><span class="token keyword">const</span> UINT16 auchCRC<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span> <span class="token operator">=</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token number">0x0000</span><span class="token punctuation">,</span><span class="token number">0xC0C1</span><span class="token punctuation">,</span><span class="token number">0xC181</span><span class="token punctuation">,</span><span class="token number">0x0140</span><span class="token punctuation">,</span><span class="token number">0xC301</span><span class="token punctuation">,</span><span class="token number">0x03C0</span><span class="token punctuation">,</span><span class="token number">0x0280</span><span class="token punctuation">,</span><span class="token number">0xC241</span><span class="token punctuation">,</span><span class="token number">0xC601</span><span class="token punctuation">,</span><span class="token number">0x06C0</span><span class="token punctuation">,</span><span class="token number">0x0780</span><span class="token punctuation">,</span><span class="token number">0xC741</span><span class="token punctuation">,</span><span class="token number">0x0500</span><span class="token punctuation">,</span><span class="token number">0xC5C1</span><span class="token punctuation">,</span><span class="token number">0xC481</span><span class="token punctuation">,</span><span class="token number">0x0440</span><span class="token punctuation">,</span><span class="token number">0xCC01</span><span class="token punctuation">,</span><span class="token number">0x0CC0</span><span class="token punctuation">,</span><span class="token number">0x0D80</span><span class="token punctuation">,</span><span class="token number">0xCD41</span><span class="token punctuation">,</span><span class="token number">0x0F00</span><span class="token punctuation">,</span><span class="token number">0xCFC1</span><span class="token punctuation">,</span><span class="token number">0xCE81</span><span class="token punctuation">,</span><span class="token number">0x0E40</span><span class="token punctuation">,</span><span class="token number">0x0A00</span><span class="token punctuation">,</span><span class="token number">0xCAC1</span><span class="token punctuation">,</span><span class="token number">0xCB81</span><span class="token punctuation">,</span><span class="token number">0x0B40</span><span class="token punctuation">,</span><span class="token number">0xC901</span><span class="token punctuation">,</span><span class="token number">0x09C0</span><span class="token punctuation">,</span><span class="token number">0x0880</span><span class="token punctuation">,</span><span class="token number">0xC841</span><span class="token punctuation">,</span><span class="token number">0xD801</span><span class="token punctuation">,</span><span class="token number">0x18C0</span><span class="token punctuation">,</span><span class="token number">0x1980</span><span class="token punctuation">,</span><span class="token number">0xD941</span><span class="token punctuation">,</span><span class="token number">0x1B00</span><span class="token punctuation">,</span><span class="token number">0xDBC1</span><span class="token punctuation">,</span><span class="token number">0xDA81</span><span class="token punctuation">,</span><span class="token number">0x1A40</span><span class="token punctuation">,</span><span class="token number">0x1E00</span><span class="token punctuation">,</span><span class="token number">0xDEC1</span><span class="token punctuation">,</span><span class="token number">0xDF81</span><span class="token punctuation">,</span><span class="token number">0x1F40</span><span class="token punctuation">,</span><span class="token number">0xDD01</span><span class="token punctuation">,</span><span class="token number">0x1DC0</span><span class="token punctuation">,</span><span class="token number">0x1C80</span><span class="token punctuation">,</span><span class="token number">0xDC41</span><span class="token punctuation">,</span><span class="token number">0x1400</span><span class="token punctuation">,</span><span class="token number">0xD4C1</span><span class="token punctuation">,</span><span class="token number">0xD581</span><span class="token punctuation">,</span><span class="token number">0x1540</span><span class="token punctuation">,</span><span class="token number">0xD701</span><span class="token punctuation">,</span><span class="token number">0x17C0</span><span class="token punctuation">,</span><span class="token number">0x1680</span><span class="token punctuation">,</span><span class="token number">0xD641</span><span class="token punctuation">,</span><span class="token number">0xD201</span><span class="token punctuation">,</span><span class="token number">0x12C0</span><span class="token punctuation">,</span><span class="token number">0x1380</span><span class="token punctuation">,</span><span class="token number">0xD341</span><span class="token punctuation">,</span><span class="token number">0x1100</span><span class="token punctuation">,</span><span class="token number">0xD1C1</span><span class="token punctuation">,</span><span class="token number">0xD081</span><span class="token punctuation">,</span><span class="token number">0x1040</span><span class="token punctuation">,</span><span class="token number">0xF001</span><span class="token punctuation">,</span><span class="token number">0x30C0</span><span class="token punctuation">,</span><span class="token number">0x3180</span><span class="token punctuation">,</span><span class="token number">0xF141</span><span class="token punctuation">,</span><span class="token number">0x3300</span><span class="token punctuation">,</span><span class="token number">0xF3C1</span><span class="token punctuation">,</span><span class="token number">0xF281</span><span class="token punctuation">,</span><span class="token number">0x3240</span><span class="token punctuation">,</span><span class="token number">0x3600</span><span class="token punctuation">,</span><span class="token number">0xF6C1</span><span class="token punctuation">,</span><span class="token number">0xF781</span><span class="token punctuation">,</span><span class="token number">0x3740</span><span class="token punctuation">,</span><span class="token number">0xF501</span><span class="token punctuation">,</span><span class="token number">0x35C0</span><span class="token punctuation">,</span><span class="token number">0x3480</span><span class="token punctuation">,</span><span class="token number">0xF441</span><span class="token punctuation">,</span><span class="token number">0x3C00</span><span class="token punctuation">,</span><span class="token number">0xFCC1</span><span class="token punctuation">,</span><span class="token number">0xFD81</span><span class="token punctuation">,</span><span class="token number">0x3D40</span><span class="token punctuation">,</span><span class="token number">0xFF01</span><span class="token punctuation">,</span><span class="token number">0x3FC0</span><span class="token punctuation">,</span><span class="token number">0x3E80</span><span class="token punctuation">,</span><span class="token number">0xFE41</span><span class="token punctuation">,</span><span class="token number">0xFA01</span><span class="token punctuation">,</span><span class="token number">0x3AC0</span><span class="token punctuation">,</span><span class="token number">0x3B80</span><span class="token punctuation">,</span><span class="token number">0xFB41</span><span class="token punctuation">,</span><span class="token number">0x3900</span><span class="token punctuation">,</span><span class="token number">0xF9C1</span><span class="token punctuation">,</span><span class="token number">0xF881</span><span class="token punctuation">,</span><span class="token number">0x3840</span><span class="token punctuation">,</span><span class="token number">0x2800</span><span class="token punctuation">,</span><span class="token number">0xE8C1</span><span class="token punctuation">,</span><span class="token number">0xE981</span><span class="token punctuation">,</span><span class="token number">0x2940</span><span class="token punctuation">,</span><span class="token number">0xEB01</span><span class="token punctuation">,</span><span class="token number">0x2BC0</span><span class="token punctuation">,</span><span class="token number">0x2A80</span><span class="token punctuation">,</span><span class="token number">0xEA41</span><span class="token punctuation">,</span><span class="token number">0xEE01</span><span class="token punctuation">,</span><span class="token number">0x2EC0</span><span class="token punctuation">,</span><span class="token number">0x2F80</span><span class="token punctuation">,</span><span class="token number">0xEF41</span><span class="token punctuation">,</span><span class="token number">0x2D00</span><span class="token punctuation">,</span><span class="token number">0xEDC1</span><span class="token punctuation">,</span><span class="token number">0xEC81</span><span class="token punctuation">,</span><span class="token number">0x2C40</span><span class="token punctuation">,</span><span class="token number">0xE401</span><span class="token punctuation">,</span><span class="token number">0x24C0</span><span class="token punctuation">,</span><span class="token number">0x2580</span><span class="token punctuation">,</span><span class="token number">0xE541</span><span class="token punctuation">,</span><span class="token number">0x2700</span><span class="token punctuation">,</span><span class="token number">0xE7C1</span><span class="token punctuation">,</span><span class="token number">0xE681</span><span class="token punctuation">,</span><span class="token number">0x2640</span><span class="token punctuation">,</span><span class="token number">0x2200</span><span class="token punctuation">,</span><span class="token number">0xE2C1</span><span class="token punctuation">,</span><span class="token number">0xE381</span><span class="token punctuation">,</span><span class="token number">0x2340</span><span class="token punctuation">,</span><span class="token number">0xE101</span><span class="token punctuation">,</span><span class="token number">0x21C0</span><span class="token punctuation">,</span><span class="token number">0x2080</span><span class="token punctuation">,</span><span class="token number">0xE041</span><span class="token punctuation">,</span><span class="token number">0xA001</span><span class="token punctuation">,</span><span class="token number">0x60C0</span><span class="token punctuation">,</span><span class="token number">0x6180</span><span class="token punctuation">,</span><span class="token number">0xA141</span><span class="token punctuation">,</span><span class="token number">0x6300</span><span class="token punctuation">,</span><span class="token number">0xA3C1</span><span class="token punctuation">,</span><span class="token number">0xA281</span><span class="token punctuation">,</span><span class="token number">0x6240</span><span class="token punctuation">,</span><span class="token number">0x6600</span><span class="token punctuation">,</span><span class="token number">0xA6C1</span><span class="token punctuation">,</span><span class="token number">0xA781</span><span class="token punctuation">,</span><span class="token number">0x6740</span><span class="token punctuation">,</span><span class="token number">0xA501</span><span class="token punctuation">,</span><span class="token number">0x65C0</span><span class="token punctuation">,</span><span class="token number">0x6480</span><span class="token punctuation">,</span><span class="token number">0xA441</span><span class="token punctuation">,</span><span class="token number">0x6C00</span><span class="token punctuation">,</span><span class="token number">0xACC1</span><span class="token punctuation">,</span><span class="token number">0xAD81</span><span class="token punctuation">,</span><span class="token number">0x6D40</span><span class="token punctuation">,</span><span class="token number">0xAF01</span><span class="token punctuation">,</span><span class="token number">0x6FC0</span><span class="token punctuation">,</span><span class="token number">0x6E80</span><span class="token punctuation">,</span><span class="token number">0xAE41</span><span class="token punctuation">,</span><span class="token number">0xAA01</span><span class="token punctuation">,</span><span class="token number">0x6AC0</span><span class="token punctuation">,</span><span class="token number">0x6B80</span><span class="token punctuation">,</span><span class="token number">0xAB41</span><span class="token punctuation">,</span><span class="token number">0x6900</span><span class="token punctuation">,</span><span class="token number">0xA9C1</span><span class="token punctuation">,</span><span class="token number">0xA881</span><span class="token punctuation">,</span><span class="token number">0x6840</span><span class="token punctuation">,</span><span class="token number">0x7800</span><span class="token punctuation">,</span><span class="token number">0xB8C1</span><span class="token punctuation">,</span><span class="token number">0xB981</span><span class="token punctuation">,</span><span class="token number">0x7940</span><span class="token punctuation">,</span><span class="token number">0xBB01</span><span class="token punctuation">,</span><span class="token number">0x7BC0</span><span class="token punctuation">,</span><span class="token number">0x7A80</span><span class="token punctuation">,</span><span class="token number">0xBA41</span><span class="token punctuation">,</span><span class="token number">0xBE01</span><span class="token punctuation">,</span><span class="token number">0x7EC0</span><span class="token punctuation">,</span><span class="token number">0x7F80</span><span class="token punctuation">,</span><span class="token number">0xBF41</span><span class="token punctuation">,</span><span class="token number">0x7D00</span><span class="token punctuation">,</span><span class="token number">0xBDC1</span><span class="token punctuation">,</span><span class="token number">0xBC81</span><span class="token punctuation">,</span><span class="token number">0x7C40</span><span class="token punctuation">,</span><span class="token number">0xB401</span><span class="token punctuation">,</span><span class="token number">0x74C0</span><span class="token punctuation">,</span><span class="token number">0x7580</span><span class="token punctuation">,</span><span class="token number">0xB541</span><span class="token punctuation">,</span><span class="token number">0x7700</span><span class="token punctuation">,</span><span class="token number">0xB7C1</span><span class="token punctuation">,</span><span class="token number">0xB681</span><span class="token punctuation">,</span><span class="token number">0x7640</span><span class="token punctuation">,</span><span class="token number">0x7200</span><span class="token punctuation">,</span><span class="token number">0xB2C1</span><span class="token punctuation">,</span><span class="token number">0xB381</span><span class="token punctuation">,</span><span class="token number">0x7340</span><span class="token punctuation">,</span><span class="token number">0xB101</span><span class="token punctuation">,</span><span class="token number">0x71C0</span><span class="token punctuation">,</span><span class="token number">0x7080</span><span class="token punctuation">,</span><span class="token number">0xB041</span><span class="token punctuation">,</span><span class="token number">0x5000</span><span class="token punctuation">,</span><span class="token number">0x90C1</span><span class="token punctuation">,</span><span class="token number">0x9181</span><span class="token punctuation">,</span><span class="token number">0x5140</span><span class="token punctuation">,</span><span class="token number">0x9301</span><span class="token punctuation">,</span><span class="token number">0x53C0</span><span class="token punctuation">,</span><span class="token number">0x5280</span><span class="token punctuation">,</span><span class="token number">0x9241</span><span class="token punctuation">,</span><span class="token number">0x9601</span><span class="token punctuation">,</span><span class="token number">0x56C0</span><span class="token punctuation">,</span><span class="token number">0x5780</span><span class="token punctuation">,</span><span class="token number">0x9741</span><span class="token punctuation">,</span><span class="token number">0x5500</span><span class="token punctuation">,</span><span class="token number">0x95C1</span><span class="token punctuation">,</span><span class="token number">0x9481</span><span class="token punctuation">,</span><span class="token number">0x5440</span><span class="token punctuation">,</span><span class="token number">0x9C01</span><span class="token punctuation">,</span><span class="token number">0x5CC0</span><span class="token punctuation">,</span><span class="token number">0x5D80</span><span class="token punctuation">,</span><span class="token number">0x9D41</span><span class="token punctuation">,</span><span class="token number">0x5F00</span><span class="token punctuation">,</span><span class="token number">0x9FC1</span><span class="token punctuation">,</span><span class="token number">0x9E81</span><span class="token punctuation">,</span><span class="token number">0x5E40</span><span class="token punctuation">,</span><span class="token number">0x5A00</span><span class="token punctuation">,</span><span class="token number">0x9AC1</span><span class="token punctuation">,</span><span class="token number">0x9B81</span><span class="token punctuation">,</span><span class="token number">0x5B40</span><span class="token punctuation">,</span><span class="token number">0x9901</span><span class="token punctuation">,</span><span class="token number">0x59C0</span><span class="token punctuation">,</span><span class="token number">0x5880</span><span class="token punctuation">,</span><span class="token number">0x9841</span><span class="token punctuation">,</span><span class="token number">0x8801</span><span class="token punctuation">,</span><span class="token number">0x48C0</span><span class="token punctuation">,</span><span class="token number">0x4980</span><span class="token punctuation">,</span><span class="token number">0x8941</span><span class="token punctuation">,</span><span class="token number">0x4B00</span><span class="token punctuation">,</span><span class="token number">0x8BC1</span><span class="token punctuation">,</span><span class="token number">0x8A81</span><span class="token punctuation">,</span><span class="token number">0x4A40</span><span class="token punctuation">,</span><span class="token number">0x4E00</span><span class="token punctuation">,</span><span class="token number">0x8EC1</span><span class="token punctuation">,</span><span class="token number">0x8F81</span><span class="token punctuation">,</span><span class="token number">0x4F40</span><span class="token punctuation">,</span><span class="token number">0x8D01</span><span class="token punctuation">,</span><span class="token number">0x4DC0</span><span class="token punctuation">,</span><span class="token number">0x4C80</span><span class="token punctuation">,</span><span class="token number">0x8C41</span><span class="token punctuation">,</span><span class="token number">0x4400</span><span class="token punctuation">,</span><span class="token number">0x84C1</span><span class="token punctuation">,</span><span class="token number">0x8581</span><span class="token punctuation">,</span><span class="token number">0x4540</span><span class="token punctuation">,</span><span class="token number">0x8701</span><span class="token punctuation">,</span><span class="token number">0x47C0</span><span class="token punctuation">,</span><span class="token number">0x4680</span><span class="token punctuation">,</span><span class="token number">0x8641</span><span class="token punctuation">,</span><span class="token number">0x8201</span><span class="token punctuation">,</span><span class="token number">0x42C0</span><span class="token punctuation">,</span><span class="token number">0x4380</span><span class="token punctuation">,</span><span class="token number">0x8341</span><span class="token punctuation">,</span><span class="token number">0x4100</span><span class="token punctuation">,</span><span class="token number">0x81C1</span><span class="token punctuation">,</span><span class="token number">0x8081</span><span class="token punctuation">,</span><span class="token number">0x4040</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p>表的生成算法可以参考：<a href="https://blog.csdn.net/m0_57585228/article/details/125088520">https://blog.csdn.net/m0_57585228/article/details/125088520</a><br> 代码：</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">POLY</span> <span class="token expression"><span class="token number">0xA001</span> </span><span class="token comment">// 生成多项式Ox8005的反序，即1000000000000101→1010000000000001，即A001</span></span>
<span class="token keyword">unsigned</span> <span class="token keyword">short</span> auchCRC<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// CRC表</span>
<span class="token keyword">void</span> <span class="token function">make_crc_table</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token comment">// 生成CRC表的函数</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">unsigned</span> <span class="token keyword">short</span> c<span class="token punctuation">;</span>
    <span class="token keyword">int</span> i<span class="token punctuation">,</span> j<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">256</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        c <span class="token operator">=</span> i<span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> 
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">&amp;</span> <span class="token number">0x1</span><span class="token punctuation">)</span> <span class="token comment">// 如果最低位为1，则右移一位并与生成多项式异或（商1）</span>
                c <span class="token operator">=</span> <span class="token punctuation">(</span>c <span class="token operator">&gt;&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">^</span> POLY<span class="token punctuation">;</span>
            <span class="token keyword">else</span> <span class="token comment">// 如果最低位为0，则只右移一位，无需异或（商0）</span>
                c <span class="token operator">=</span> c <span class="token operator">&gt;&gt;</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        auchCRC<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> c<span class="token punctuation">;</span> <span class="token comment">// 将计算出的CRC校验码存入表中</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h6><a id="2CRC16_49"></a>2.单字节计算CRC16</h6> 
<p>根据Modbus CRC-16协议，其寄存器的初始值不为0000而是FFFF，且输入数据与输出数据均要反转。<br> 单字节计算CRC16步骤（以0x01为例）：<br> 1.将字节取反后查表<br> 0x01→0xfe，即254→查表得到0x8081<br> 2.得到的结果的低八位取反，高八位不变<br> 0x8081低八位为81，取反为7e→0x807e<br> 3.得出CRC结果为0x807e</p> 
<h6><a id="3CRC16_58"></a>3.字节流计算CRC16</h6> 
<p>上述为一个字节即0x01的CRC码的计算，如果遇到要计算多个字节的字节流数据例如{0x01,0x02,0x03}该如何计算？<br> 这里涉及到一些数学推导，参考：<a href="https://blog.csdn.net/G1036583997/article/details/10328933">https://blog.csdn.net/G1036583997/article/details/10328933</a>，归纳如下：<br> 字节型算法的一般描述为：本字节的CRC码，等于上一字节CRC码的低8位左移8位，与上一字节CRC右移8位同本字节异或后所得的CRC码异或。其步骤可以简单展示为：<br> 1.取上字节的CRC码的低八位，与本字节进行异或，得到下标index<br> 2.拿index去查表，得到结果M<br> 3.取上字节的CRC码的高八位，与M进行异或，得到结果T，即新算得的CRC码值<br> 4.重复以上步骤，直到所有字节均已计算完成，则可以得到最后的CRC-16码</p> 
<p>代码：</p> 
<pre><code class="prism language-cpp"><span class="token comment">//计算CRC16码，使用查表法</span>
UINT16 <span class="token function">CRC16</span><span class="token punctuation">(</span>u8 <span class="token operator">*</span>data<span class="token punctuation">,</span> <span class="token keyword">int</span> len<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	UINT16 CRC <span class="token operator">=</span> <span class="token number">0xffff</span><span class="token punctuation">;</span><span class="token comment">//0xff与数据异或就相当于取反，故只需要一开始把CRC初始值设置为0xffff即可</span>
	UINT8 index<span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> Len <span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		index <span class="token operator">=</span> <span class="token punctuation">(</span>CRC <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token operator">^</span> data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//取上一字节的CRC低八位，与本字节异或</span>
		CRC <span class="token operator">&gt;&gt;=</span> <span class="token number">8</span><span class="token punctuation">;</span><span class="token comment">//取上一字节的高八位</span>
		CRC <span class="token operator">^=</span> auchCRC<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//与查表后的结果异或</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token punctuation">(</span>CRC<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a29048bce758e5970b16a5e414de6018/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">（Go语言）使用两个协程按顺序交替打印 1 - n ,一个协程打印偶数，一个协程打印奇数</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9e3b3bc251cbce422a30968087e83197/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">（附12306抢票脚本）国庆长假马上来啦，Python分析【去哪儿旅游攻略】数据，制作可视化图表</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>