<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>gitlab 设置邮件 SMTP - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="gitlab 设置邮件 SMTP" />
<meta property="og:description" content="安装gitlab的时候没有设置和STMP邮件，重新装的时候遇到点问题，记录一下。
553问题 Net::SMTPFatalError (553 Mail from must equal authorized user)
终端提示如下：
Date: Wed, 10 Apr 2019 10:09:22 &#43;0800 From: GitLab &lt;￥%……&amp;×（@163.com&gt; Reply-To: GitLab &lt;￥%……&amp;×（）@163.com&gt; To: #￥%……&amp;×@qq.com Message-ID: &lt;5cad50526f508_7f243f92aa4dc5fc816e5@example.com.mail&gt; Subject: test Mime-Version: 1.0 Content-Type: text/html; charset=UTF-8 Content-Transfer-Encoding: 7bit Auto-Submitted: auto-generated X-Auto-Response-Suppress: All &lt;!DOCTYPE html PUBLIC &#34;-//W3C//DTD HTML 4.0 Transitional//EN&#34; &#34;http://www.w3.org/TR/REC-html40/loose.dtd&#34;&gt; &lt;html&gt;&lt;body&gt;&lt;p&gt;test body&lt;/p&gt;&lt;/body&gt;&lt;/html&gt; Traceback (most recent call last): 16: from /opt/gitlab/embedded/lib/ruby/gems/2.5.0/gems/actionmailer-5.0.7.1/lib/action_mailer/base.rb:541:in `deliver_mail&#39; 15: from /opt/gitlab/embedded/lib/ruby/gems/2.5.0/gems/activesupport-5.0.7.1/lib/active_support/notifications.rb:164:in `instrument&#39; 14: from /opt/gitlab/embedded/lib/ruby/gems/2.5.0/gems/activesupport-5.0.7.1/lib/active_support/notifications/instrumenter.rb:21:in `instrument&#39; 13: from /opt/gitlab/embedded/lib/ruby/gems/2." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/fda762e86343c2d0ce2cb84359b40509/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-04-10T10:53:11+08:00" />
<meta property="article:modified_time" content="2019-04-10T10:53:11+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">gitlab 设置邮件 SMTP</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>安装gitlab的时候没有设置和STMP邮件，重新装的时候遇到点问题，记录一下。</p> 
<ol><li>553问题</li></ol> 
<p><strong>Net::SMTPFatalError (553 Mail from must equal authorized user)</strong><br> 终端提示如下：</p> 
<pre><code>Date: Wed, 10 Apr 2019 10:09:22 +0800
From: GitLab &lt;￥%……&amp;×（@163.com&gt;
Reply-To: GitLab &lt;￥%……&amp;×（）@163.com&gt;
To: #￥%……&amp;×@qq.com
Message-ID: &lt;5cad50526f508_7f243f92aa4dc5fc816e5@example.com.mail&gt;
Subject: test
Mime-Version: 1.0
Content-Type: text/html;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Auto-Submitted: auto-generated
X-Auto-Response-Suppress: All

&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd"&gt;
&lt;html&gt;&lt;body&gt;&lt;p&gt;test body&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;

Traceback (most recent call last):
       16: from /opt/gitlab/embedded/lib/ruby/gems/2.5.0/gems/actionmailer-5.0.7.1/lib/action_mailer/base.rb:541:in `deliver_mail'
       15: from /opt/gitlab/embedded/lib/ruby/gems/2.5.0/gems/activesupport-5.0.7.1/lib/active_support/notifications.rb:164:in `instrument'
       14: from /opt/gitlab/embedded/lib/ruby/gems/2.5.0/gems/activesupport-5.0.7.1/lib/active_support/notifications/instrumenter.rb:21:in `instrument'
       13: from /opt/gitlab/embedded/lib/ruby/gems/2.5.0/gems/activesupport-5.0.7.1/lib/active_support/notifications.rb:164:in `block in instrument'
       12: from /opt/gitlab/embedded/lib/ruby/gems/2.5.0/gems/actionmailer-5.0.7.1/lib/action_mailer/base.rb:543:in `block in deliver_mail'
       11: from /opt/gitlab/embedded/lib/ruby/gems/2.5.0/gems/mail-2.7.1/lib/mail/message.rb:260:in `block in deliver'
       10: from /opt/gitlab/embedded/lib/ruby/gems/2.5.0/gems/mail-2.7.1/lib/mail/message.rb:2159:in `do_delivery'
        9: from /opt/gitlab/embedded/lib/ruby/gems/2.5.0/gems/mail-2.7.1/lib/mail/network/delivery_methods/smtp.rb:100:in `deliver!'
        8: from /opt/gitlab/embedded/lib/ruby/gems/2.5.0/gems/mail-2.7.1/lib/mail/network/delivery_methods/smtp.rb:109:in `start_smtp_session'
        7: from /opt/gitlab/embedded/lib/ruby/2.5.0/net/smtp.rb:519:in `start'
        6: from /opt/gitlab/embedded/lib/ruby/gems/2.5.0/gems/mail-2.7.1/lib/mail/network/delivery_methods/smtp.rb:101:in `block in deliver!'
        5: from /opt/gitlab/embedded/lib/ruby/gems/2.5.0/gems/mail-2.7.1/lib/mail/network/delivery_methods/smtp_connection.rb:54:in `deliver!'
        4: from /opt/gitlab/embedded/lib/ruby/2.5.0/net/smtp.rb:658:in `send_message'
        3: from /opt/gitlab/embedded/lib/ruby/2.5.0/net/smtp.rb:837:in `mailfrom'
        2: from /opt/gitlab/embedded/lib/ruby/2.5.0/net/smtp.rb:937:in `getok'
        1: from /opt/gitlab/embedded/lib/ruby/2.5.0/net/smtp.rb:969:in `check_response'
Net::SMTPFatalError (553 Mail from must equal authorized user)
</code></pre> 
<p>原因是文件/etc/gitlab/gitlab.rb 里面的git_user_email和smtp_user_name不一致，解决办法是：</p> 
<pre><code>sudo gedit /etc/gitlab/gitlab.rb 
</code></pre> 
<p>将下面内容修改到文件里面，重复的就注释掉：</p> 
<pre><code>gitlab_rails['smtp_user_name'] = "(你自己的邮箱前缀)@163.com"
gitlab_rails['gitlab_email_from'] = "(你自己的邮箱前缀)@163.com"
gitlab_rails['gitlab_email_reply_to'] = "(你自己的邮箱前缀)@163.com"
user["git_user_email"] = "(你自己的邮箱前缀)@163.com"
</code></pre> 
<ol start="2"><li>SMTP配置</li></ol> 
<pre><code>1.修改gitlab.rb 
sudo gedit /etc/gitlab/gitlab.rb 
</code></pre> 
<p>将下面内容加到文件里面：</p> 
<pre><code>gitlab_rails['smtp_enable'] = true
gitlab_rails['smtp_address'] = "smtp.163.com"
gitlab_rails['smtp_port'] = 25
gitlab_rails['smtp_user_name'] = "(你自己的邮箱前缀)@163.com"
gitlab_rails['smtp_password'] = "(163邮箱设置的授权码！授权码！授权码！)"
gitlab_rails['smtp_domain'] = "163.com"
gitlab_rails['smtp_authentication'] = "login"
gitlab_rails['smtp_enable_starttls_auto'] = true
gitlab_rails['smtp_tls'] = false
gitlab_rails['gitlab_email_from'] = "(你自己的邮箱前缀)@163.com"
gitlab_rails['gitlab_email_reply_to'] = "(你自己的邮箱前缀)@163.com"
user["git_user_email"] = "(你自己的邮箱前缀)@163.com"
</code></pre> 
<p>这里一定要注意！！！注意！！！<br> smtp_user_name，gitlab_email_from，gitlab_email_reply_to和git_user_email建议一致，不然会出现：</p> 
<pre><code>SMTPFatalError (553 Mail from must equal authorized user)
和
SMTPAuthenticationError (535 Error: authentication failed)
</code></pre> 
<p>只要内容没错，基本就不会有问题。</p> 
<pre><code>2.重新配置gitlab
sudo gitlab-ctl reconfigure
</code></pre> 
<pre><code>3.重启服务
sudo gitlab-ctl restart
</code></pre> 
<ol start="3"><li>完成。</li></ol>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2c0182dc25c4fe057abd62c0cf77dc93/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">使用卷积神经网络（CNN）做人脸识别</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e052c65fde8eb67dd51d129cac3184c4/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">无法启动vs2017远程调试器(msvsmon.exe)，请通过控制面板中的“添加或删除程序”，修复visual studio 安装的错误</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>