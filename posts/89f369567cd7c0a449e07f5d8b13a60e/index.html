<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>rabbitmq-exporter部署方式 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="rabbitmq-exporter部署方式" />
<meta property="og:description" content="目录 rabbitmq-exporter部署方式来源说明部署方式docker部署：配置文件配置 扩展的 RabbitMQ 功能 rabbitmq-exporter部署方式 来源 https://github.com/kbudde/rabbitmq_exporter/
说明 RabbitMQ 指标的 Prometheus 导出器。数据由prometheus 抓取。
请注意这是一个非官方插件。还有一个来自RabbitMQ.com的官方插件。查看与官方出口商的比较
部署方式 docker部署： rabbitmq_exporter 与 rabbitmq 容器共享网络接口 -&gt; 可以使用 localhost 和默认用户/密码（guest）。
启动rabbitMQ docker run -d -e RABBITMQ_NODENAME=my-rabbit --name my-rabbit -p 9419:9419 rabbitmq:3-management 在容器中启动 rabbitmq_exporter docker run -d --net=container:my-rabbit kbudde/rabbitmq-exporter 现在您的指标通过http://host:9419/metrics公开
配置文件配置 文件下载：
https://github.com/kbudde/rabbitmq_exporter/releases/download/v1.0.0-RC8/rabbitmq_exporter-1.0.0-RC8.linux-amd64.tar.gz
解压后进入目录；
Rabbitmq_exporter 可以使用 json 配置文件或环境变量进行配置。
Rabbitmq_exporter 需要“conf/rabbitmq.conf”中的配置文件。如果您在容器 (docker/kubernetes) 中运行导出器，则配置必须在“/conf/rabbitmq.conf”中。文件名可以用标志覆盖：
./rabbitmq_exporter -config-file config.example.json 具体格式如下：
{ &#34;rabbit_url&#34;: &#34;http://127.0.0.1:15672&#34;, &#34;rabbit_user&#34;: &#34;guest&#34;, &#34;rabbit_pass&#34;: &#34;guest&#34;, &#34;publish_port&#34;: &#34;9419&#34;, &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/89f369567cd7c0a449e07f5d8b13a60e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-07-16T15:10:42+08:00" />
<meta property="article:modified_time" content="2021-07-16T15:10:42+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">rabbitmq-exporter部署方式</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#rabbitmqexporter_1" rel="nofollow">rabbitmq-exporter部署方式</a></li><li><ul><li><a href="#_2" rel="nofollow">来源</a></li><li><a href="#_4" rel="nofollow">说明</a></li><li><a href="#_9" rel="nofollow">部署方式</a></li><li><ul><li><a href="#docker_10" rel="nofollow">docker部署：</a></li><li><a href="#_22" rel="nofollow">配置文件配置</a></li></ul> 
   </li><li><a href="#_RabbitMQ__91" rel="nofollow">扩展的 RabbitMQ 功能</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="rabbitmqexporter_1"></a>rabbitmq-exporter部署方式</h2> 
<h3><a id="_2"></a>来源</h3> 
<p><a href="https://github.com/kbudde/rabbitmq_exporter/">https://github.com/kbudde/rabbitmq_exporter/</a></p> 
<h3><a id="_4"></a>说明</h3> 
<p>RabbitMQ 指标的 Prometheus 导出器。数据由prometheus 抓取。</p> 
<p>请注意这是一个非官方插件。还有一个来自RabbitMQ.com的官方插件。查看与<a href="https://github.com/kbudde/rabbitmq_exporter/#-Comparison-to-official-exporter">官方出口商</a>的比较</p> 
<h3><a id="_9"></a>部署方式</h3> 
<h4><a id="docker_10"></a>docker部署：</h4> 
<p>rabbitmq_exporter 与 rabbitmq 容器共享网络接口 -&gt; 可以使用 localhost 和默认用户/密码（guest）。</p> 
<ol><li>启动rabbitMQ</li></ol> 
<pre><code> docker run -d -e RABBITMQ_NODENAME=my-rabbit --name my-rabbit -p 9419:9419 rabbitmq:3-management
</code></pre> 
<ol start="2"><li>在容器中启动 rabbitmq_exporter</li></ol> 
<pre><code> docker run -d --net=container:my-rabbit kbudde/rabbitmq-exporter
</code></pre> 
<p>现在您的指标通过http://host:9419/metrics公开</p> 
<h4><a id="_22"></a>配置文件配置</h4> 
<p>文件下载：<br> <a href="https://github.com/kbudde/rabbitmq_exporter/releases/download/v1.0.0-RC8/rabbitmq_exporter-1.0.0-RC8.linux-amd64.tar.gz">https://github.com/kbudde/rabbitmq_exporter/releases/download/v1.0.0-RC8/rabbitmq_exporter-1.0.0-RC8.linux-amd64.tar.gz</a><br> 解压后进入目录；<br> Rabbitmq_exporter 可以使用 json 配置文件或环境变量进行配置。<br> Rabbitmq_exporter 需要“conf/rabbitmq.conf”中的配置文件。如果您在容器 (docker/kubernetes) 中运行导出器，则配置必须在“/conf/rabbitmq.conf”中。文件名可以用标志覆盖：</p> 
<pre><code>./rabbitmq_exporter -config-file config.example.json
</code></pre> 
<p>具体格式如下：</p> 
<pre><code>{
    "rabbit_url": "http://127.0.0.1:15672",
    "rabbit_user": "guest",
    "rabbit_pass": "guest",
    "publish_port": "9419",
    "publish_addr": "",
    "output_format": "TTY",
    "ca_file": "ca.pem",
    "cert_file": "client-cert.pem",
    "key_file": "client-key.pem",
    "insecure_skip_verify": false,
    "exlude_metrics": [],
    "include_queues": ".*",
    "skip_queues": "^$",
    "skip_vhost": "^$",
    "include_vhost": ".*",
    "rabbit_capabilities": "no_sort,bert",
    "enabled_exporters": [
            "exchange",
            "node",
            "overview",
            "queue"
    ],
    "timeout": 30,
    "max_queues": 0
}
</code></pre> 
<p><strong>注：</strong></p> 
<table><thead><tr><th>Environment</th><th>variable</th><th>default description</th></tr></thead><tbody><tr><td>RABBIT_URL</td><td>http://127.0.0.1:15672</td><td>url to rabbitMQ management plugin (must start with http(s)😕/)</td></tr><tr><td>RABBIT_USER</td><td>guest</td><td>username for rabbitMQ management plugin. User needs monitoring tag!</td></tr><tr><td>RABBIT_PASSWORD</td><td>guest</td><td>password for rabbitMQ management plugin</td></tr><tr><td>RABBIT_USER_FILE</td><td></td><td>location of file with username (useful for docker secrets)</td></tr><tr><td>RABBIT_PASSWORD_FILE</td><td></td><td>location of file with password (useful for docker secrets)</td></tr><tr><td>PUBLISH_PORT</td><td>9419</td><td>Listening port for the exporter</td></tr><tr><td>PUBLISH_ADDR</td><td>“”</td><td>Listening host/IP for the exporter</td></tr><tr><td>OUTPUT_FORMAT</td><td>TTY</td><td>Log ouput format. TTY and JSON are suported</td></tr><tr><td>LOG_LEVEL</td><td>info</td><td>log level. possible values: “debug”, “info”, “warning”, “error”, “fatal”, or “panic”</td></tr><tr><td>CAFILE</td><td>ca.pem</td><td>path to root certificate for access management plugin. Just needed if self signed certificate is used. Will be ignored if the file does not exist</td></tr><tr><td>CERTFILE</td><td>client-cert.pem</td><td>path to client certificate used to verify the exporter’s authenticity. Will be ignored if the file does not exist</td></tr><tr><td>KEYFILE</td><td>client-key.pem</td><td>path to private key used with certificate to verify the exporter’s authenticity. Will be ignored if the file does not exist</td></tr><tr><td>SKIPVERIFY</td><td>false</td><td>true/0 will ignore certificate errors of the management plugin</td></tr><tr><td>SKIP_VHOST</td><td>^$</td><td>regex, matching vhost names are not exported. First performs INCLUDE_VHOST, then SKIP_VHOST</td></tr><tr><td>INCLUDE_VHOST</td><td>.*</td><td>regex vhost filter. Only queues in matching vhosts are exported</td></tr><tr><td>INCLUDE_QUEUES</td><td>.*</td><td>regex queue filter. Just matching names are exported</td></tr><tr><td>SKIP_QUEUES</td><td>^$</td><td>regex, matching queue names are not exported (useful for short-lived rpc queues). First performed INCLUDE, after SKIP</td></tr><tr><td>RABBIT_CAPABILITIES</td><td>bert,no_sort</td><td>comma-separated list of extended scraping capabilities supported by the target RabbitMQ server</td></tr><tr><td>RABBIT_EXPORTERS</td><td>exchange,node,queue</td><td>List of enabled modules. Possible modules: connections,shovel,federation,exchange,node,queue,memory</td></tr><tr><td>RABBIT_TIMEOUT</td><td>30</td><td>timeout in seconds for retrieving data from management plugin.</td></tr><tr><td>MAX_QUEUES</td><td>0</td><td>max number of queues before we drop metrics (disabled if set to 0)</td></tr><tr><td>EXCLUDE_METRICS</td><td></td><td>Metric names to exclude from export. comma-seperated. e.g. “recv_oct, recv_cnt”. See exporter_*.go for names</td></tr></tbody></table> 
<p>示例和推荐设置：</p> 
<pre><code>SKIP_QUEUES="RPC_.*" MAX_QUEUES=5000 ./rabbitmq_exporter
</code></pre> 
<h3><a id="_RabbitMQ__91"></a>扩展的 RabbitMQ 功能</h3> 
<p>  较新版本的 RabbitMQ 可以提供一些功能，以减少因抓取此导出器所需的数据而造成的开销。RABBIT_CAPABILITIESenv var目前支持以下功能 ：</p> 
<ul><li>no_sort：默认情况下，RabbitMQ 管理插件使用 vhost/name 的默认排序顺序对结果进行排序。?sort=从版本 3.6.8 开始，可以通过将空排序参数 ( )传递给 RabbitMQ来避免这种排序开销。在早期的 3.6.X 版本上可以安全地启用此选项，但它不会提供任何性能改进。它与 3.4.X 和 3.5.X 不兼容。</li><li>bert：从 3.6.9（参见 https://github.com/rabbitmq/rabbitmq-management/pull/367）开始，RabbitMQ 支持 BERT 编码作为 JSON 替代方案。鉴于 BERT 编码是在 Erlang VM 中用 C 实现的，它比纯 Erlang JSON 编码更有效。所以当我们在 RabbitMQ 中有很多对象时，这大大减少了监控开销。<br> rabbmitmq &lt; 3.6 用户注意事项<br> 默认情况下启用 no_sort 和 bert。您必须使用以下内容覆盖默认设置：</li></ul> 
<pre><code>RABBIT_CAPABILITIES=nobert ./rabbitmq_exporter
</code></pre> 
<p>所有指标（golang/prometheus 指标除外）都以“rabbitmq_”为前缀。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d427671da50b8a86f81fc0a10142e457/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">postgres-exporter部署书册</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/219745279bd39a42243e0cf323ba42dc/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">解决word或wps删除空白页后页面布局变乱</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>