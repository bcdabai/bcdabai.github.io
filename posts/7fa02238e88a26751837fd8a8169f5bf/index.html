<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>FreeRTOSä»»åŠ¡åˆ›å»ºåŠç»†èŠ‚ - ç¼–ç¨‹å¤§ç™½çš„åšå®¢</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="FreeRTOSä»»åŠ¡åˆ›å»ºåŠç»†èŠ‚" />
<meta property="og:description" content="ç›®å½•
ä»»åŠ¡åˆ›å»ºÂ ç®€åŒ–çš„TCBç»“æ„ä½“
åˆ›å»ºä»»åŠ¡å †æ ˆå’Œä»»åŠ¡TCB
åˆå§‹åŒ–ä»»åŠ¡TCBçš„æˆå‘˜
åˆå§‹åŒ–ä»»åŠ¡å †æ ˆ
æŠŠæ–°ä»»åŠ¡æ·»åŠ åˆ°å°±ç»ªåˆ—è¡¨
ä»»åŠ¡åˆ é™¤
ä»»åŠ¡åˆ›å»ºÂ BaseType_t xTaskCreate(	TaskFunction_t pxTaskCode, const char * const pcName,	/*lint !e971 Unqualified char types are allowed for strings and single characters only. */ const configSTACK_DEPTH_TYPE usStackDepth, void * const pvParameters, UBaseType_t uxPriority, TaskHandle_t * const pxCreatedTask ) è¿™ä¸ªAPIå‡½æ•°çš„ä½œç”¨æ˜¯åˆ›å»ºæ–°çš„ä»»åŠ¡å¹¶å°†å®ƒåŠ å…¥åˆ°ä»»åŠ¡å°±ç»ªåˆ—è¡¨ï¼Œå‡½æ•°å‚æ•°å«ä¹‰ä¸ºï¼š
pvTaskCodeï¼šå‡½æ•°æŒ‡é’ˆï¼ŒæŒ‡å‘ä»»åŠ¡å‡½æ•°çš„å…¥å£ã€‚ä»»åŠ¡æ°¸è¿œä¸ä¼šè¿”å›ï¼ˆä½äºæ­»å¾ªç¯å†…ï¼‰ã€‚è¯¥å‚æ•°ç±»å‹TaskFunction_tå®šä¹‰åœ¨æ–‡ä»¶projdefs.hä¸­ï¼Œå®šä¹‰ä¸ºï¼štypedef void(*TaskFunction_t)( void * )ï¼Œå³å‚æ•°ä¸ºç©ºæŒ‡é’ˆç±»å‹å¹¶è¿”å›ç©ºç±»å‹ã€‚pcNameï¼šä»»åŠ¡æè¿°ã€‚ä¸»è¦ç”¨äºè°ƒè¯•ã€‚å­—ç¬¦ä¸²çš„æœ€å¤§é•¿åº¦ï¼ˆåŒ…æ‹¬å­—ç¬¦ä¸²ç»“æŸå­—ç¬¦ï¼‰ç”±å®configMAX_TASK_NAME_LENæŒ‡å®šï¼Œè¯¥å®ä½äºFreeRTOSConfig.hæ–‡ä»¶ä¸­ã€‚usStackDepthï¼šæŒ‡å®šä»»åŠ¡å †æ ˆå¤§å°ï¼Œèƒ½å¤Ÿæ”¯æŒçš„å †æ ˆå˜é‡æ•°é‡ï¼ˆå †æ ˆæ·±åº¦ï¼‰ï¼Œè€Œä¸æ˜¯å­—èŠ‚æ•°ã€‚æ¯”å¦‚ï¼Œåœ¨16ä½å®½åº¦çš„å †æ ˆä¸‹ï¼ŒusStackDepthå®šä¹‰ä¸º100ï¼Œåˆ™å®é™…ä½¿ç”¨200å­—èŠ‚å †æ ˆå­˜å‚¨ç©ºé—´ã€‚å †æ ˆçš„å®½åº¦ä¹˜ä»¥æ·±åº¦å¿…é¡»ä¸è¶…è¿‡size_tç±»å‹æ‰€èƒ½è¡¨ç¤ºçš„æœ€å¤§å€¼ã€‚æ¯”å¦‚ï¼Œsize_tä¸º16ä½ï¼Œåˆ™å¯ä»¥è¡¨ç¤ºå †æ ˆçš„æœ€å¤§å€¼æ˜¯65535å­—èŠ‚ã€‚è¿™æ˜¯å› ä¸ºå †æ ˆåœ¨ç”³è¯·æ—¶æ˜¯ä»¥å­—èŠ‚ä¸ºå•ä½çš„ï¼Œç”³è¯·çš„å­—èŠ‚æ•°å°±æ˜¯å †æ ˆå®½åº¦ä¹˜ä»¥æ·±åº¦ï¼Œå¦‚æœè¿™ä¸ªä¹˜ç§¯è¶…å‡ºsize_tæ‰€è¡¨ç¤ºçš„èŒƒå›´ï¼Œå°±ä¼šæº¢å‡ºï¼Œåˆ†é…çš„å †æ ˆç©ºé—´ä¹Ÿä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚pvParametersï¼šæŒ‡é’ˆï¼Œå½“ä»»åŠ¡åˆ›å»ºæ—¶ï¼Œä½œä¸ºä¸€ä¸ªå‚æ•°ä¼ é€’ç»™ä»»åŠ¡ã€‚uxPriorityï¼šä»»åŠ¡çš„ä¼˜å…ˆçº§ã€‚å…·æœ‰MPUæ”¯æŒçš„ç³»ç»Ÿï¼Œå¯ä»¥é€šè¿‡ç½®ä½ä¼˜å…ˆçº§å‚æ•°çš„portPRIVILEGE_BITä½ï¼Œéšæ„çš„åœ¨ç‰¹æƒï¼ˆç³»ç»Ÿï¼‰æ¨¡å¼ä¸‹åˆ›å»ºä»»åŠ¡ã€‚æ¯”å¦‚ï¼Œåˆ›å»ºä¸€ä¸ªä¼˜å…ˆçº§ä¸º2çš„ç‰¹æƒä»»åŠ¡ï¼Œå‚æ•°uxPriorityå¯ä»¥è®¾ç½®ä¸º ( 2 | portPRIVILEGE_BIT )ã€‚pvCreatedTaskï¼šç”¨äºå›ä¼ ä¸€ä¸ªå¥æŸ„ï¼ˆIDï¼‰ï¼Œåˆ›å»ºä»»åŠ¡åå¯ä»¥ä½¿ç”¨è¿™ä¸ªå¥æŸ„å¼•ç”¨ä»»åŠ¡ã€‚
è™½ç„¶xTaskCreate()çœ‹ä¸Šå»å¾ˆåƒå‡½æ•°ï¼Œä½†å…¶å®æ˜¯ä¸€ä¸ªå®ï¼ŒçœŸæ­£è¢«è°ƒç”¨çš„å‡½æ•°æ˜¯xTaskGenericCreate()ï¼ŒxTaskCreate()å®å®šä¹‰å¦‚ä¸‹æ‰€ç¤ºï¼š
#define xTaskCreate( pvTaskCode, pcName, usStackDepth,pvParameters, uxPriority, pxCreatedTask ) \ xTaskGenericCreate( ( pvTaskCode ),( pcName ), ( usStackDepth ), ( pvParameters ), ( uxPriority ), ( pxCreatedTask), ( NULL ), ( NULL ), ( NULL ) ) å¯ä»¥çœ‹åˆ°,xTaskCreateæ¯”xTaskGenericCreateå°‘äº†ä¸‰ä¸ªå‚æ•°ï¼Œåœ¨å®å®šä¹‰ä¸­ï¼Œè¿™ä¸‰ä¸ªå‚æ•°è¢«è®¾ç½®ä¸ºNULLã€‚è¿™ä¸‰ä¸ªå‚æ•°ç”¨äºä½¿ç”¨é™æ€å˜é‡çš„æ–¹æ³•åˆ†é…å †æ ˆã€ä»»åŠ¡TCBç©ºé—´ä»¥åŠè®¾ç½®MPUç›¸å…³çš„å‚æ•°ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè¿™ä¸‰ä¸ªå‚æ•°æ˜¯ä¸ä½¿ç”¨çš„ï¼Œæ‰€ä»¥ä»»åŠ¡åˆ›å»ºå®xTaskCreateå®šä¹‰çš„æ—¶å€™ï¼Œå°†è¿™ä¸‰ä¸ªå‚æ•°å¯¹ç”¨æˆ·éšè—äº†ã€‚æ¥ä¸‹æ¥çš„ç« èŠ‚ä¸­ï¼Œä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬è¿˜æ˜¯ç§°xTaskCreate()ä¸ºå‡½æ•°ï¼Œè™½ç„¶å®ƒæ˜¯ä¸€ä¸ªå®å®šä¹‰ã€‚" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/7fa02238e88a26751837fd8a8169f5bf/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-28T22:48:20+08:00" />
<meta property="article:modified_time" content="2023-11-28T22:48:20+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="ç¼–ç¨‹å¤§ç™½çš„åšå®¢" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">ç¼–ç¨‹å¤§ç™½çš„åšå®¢</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">FreeRTOSä»»åŠ¡åˆ›å»ºåŠç»†èŠ‚</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"></p> 
<p id="main-toc"><strong>ç›®å½•</strong></p> 
<p id="%E4%BB%BB%E5%8A%A1%E5%88%9B%E5%BB%BA%C2%A0-toc" style="margin-left:0px;"><a href="#%E4%BB%BB%E5%8A%A1%E5%88%9B%E5%BB%BA%C2%A0" rel="nofollow">ä»»åŠ¡åˆ›å»ºÂ </a></p> 
<p id="%E7%AE%80%E5%8C%96%E7%9A%84TCB%E7%BB%93%E6%9E%84%E4%BD%93-toc" style="margin-left:0px;"><a href="#%E7%AE%80%E5%8C%96%E7%9A%84TCB%E7%BB%93%E6%9E%84%E4%BD%93" rel="nofollow">ç®€åŒ–çš„TCBç»“æ„ä½“</a></p> 
<p id="%E5%88%9B%E5%BB%BA%E4%BB%BB%E5%8A%A1%E5%A0%86%E6%A0%88%E5%92%8C%E4%BB%BB%E5%8A%A1TCB-toc" style="margin-left:0px;"><a href="#%E5%88%9B%E5%BB%BA%E4%BB%BB%E5%8A%A1%E5%A0%86%E6%A0%88%E5%92%8C%E4%BB%BB%E5%8A%A1TCB" rel="nofollow">åˆ›å»ºä»»åŠ¡å †æ ˆå’Œä»»åŠ¡TCB</a></p> 
<p id="%E5%88%9D%E5%A7%8B%E5%8C%96%E4%BB%BB%E5%8A%A1TCB%E7%9A%84%E6%88%90%E5%91%98-toc" style="margin-left:0px;"><a href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E4%BB%BB%E5%8A%A1TCB%E7%9A%84%E6%88%90%E5%91%98" rel="nofollow">åˆå§‹åŒ–ä»»åŠ¡TCBçš„æˆå‘˜</a></p> 
<p id="%E5%88%9D%E5%A7%8B%E5%8C%96%E4%BB%BB%E5%8A%A1%E5%A0%86%E6%A0%88-toc" style="margin-left:0px;"><a href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E4%BB%BB%E5%8A%A1%E5%A0%86%E6%A0%88" rel="nofollow">åˆå§‹åŒ–ä»»åŠ¡å †æ ˆ</a></p> 
<p id="%E6%8A%8A%E6%96%B0%E4%BB%BB%E5%8A%A1%E6%B7%BB%E5%8A%A0%E5%88%B0%E5%B0%B1%E7%BB%AA%E5%88%97%E8%A1%A8-toc" style="margin-left:0px;"><a href="#%E6%8A%8A%E6%96%B0%E4%BB%BB%E5%8A%A1%E6%B7%BB%E5%8A%A0%E5%88%B0%E5%B0%B1%E7%BB%AA%E5%88%97%E8%A1%A8" rel="nofollow">æŠŠæ–°ä»»åŠ¡æ·»åŠ åˆ°å°±ç»ªåˆ—è¡¨</a></p> 
<p id="%C2%A0%E4%BB%BB%E5%8A%A1%E5%88%A0%E9%99%A4-toc" style="margin-left:0px;"><a href="#%C2%A0%E4%BB%BB%E5%8A%A1%E5%88%A0%E9%99%A4" rel="nofollow">Â ä»»åŠ¡åˆ é™¤</a></p> 
<h2 id="%E4%BB%BB%E5%8A%A1%E5%88%9B%E5%BB%BA%C2%A0">ä»»åŠ¡åˆ›å»ºÂ </h2> 
<pre><code>	BaseType_t xTaskCreate(	TaskFunction_t pxTaskCode,
							const char * const pcName,		/*lint !e971 Unqualified char types are allowed for strings and single characters only. */
							const configSTACK_DEPTH_TYPE usStackDepth,
							void * const pvParameters,
							UBaseType_t uxPriority,
							TaskHandle_t * const pxCreatedTask )</code></pre> 
<p>è¿™ä¸ªAPIå‡½æ•°çš„ä½œç”¨æ˜¯åˆ›å»ºæ–°çš„ä»»åŠ¡å¹¶å°†å®ƒåŠ å…¥åˆ°ä»»åŠ¡å°±ç»ªåˆ—è¡¨ï¼Œå‡½æ•°å‚æ•°å«ä¹‰ä¸ºï¼š</p> 
<ul><li>pvTaskCodeï¼šå‡½æ•°æŒ‡é’ˆï¼ŒæŒ‡å‘ä»»åŠ¡å‡½æ•°çš„å…¥å£ã€‚ä»»åŠ¡æ°¸è¿œä¸ä¼šè¿”å›ï¼ˆä½äºæ­»å¾ªç¯å†…ï¼‰ã€‚è¯¥å‚æ•°ç±»å‹TaskFunction_tå®šä¹‰åœ¨æ–‡ä»¶projdefs.hä¸­ï¼Œå®šä¹‰ä¸ºï¼štypedef void(*TaskFunction_t)( void * )ï¼Œå³å‚æ•°ä¸ºç©ºæŒ‡é’ˆç±»å‹å¹¶è¿”å›ç©ºç±»å‹ã€‚</li><li>pcNameï¼šä»»åŠ¡æè¿°ã€‚ä¸»è¦ç”¨äºè°ƒè¯•ã€‚å­—ç¬¦ä¸²çš„æœ€å¤§é•¿åº¦ï¼ˆåŒ…æ‹¬å­—ç¬¦ä¸²ç»“æŸå­—ç¬¦ï¼‰ç”±å®configMAX_TASK_NAME_LENæŒ‡å®šï¼Œè¯¥å®ä½äºFreeRTOSConfig.hæ–‡ä»¶ä¸­ã€‚</li><li>usStackDepthï¼šæŒ‡å®šä»»åŠ¡å †æ ˆå¤§å°ï¼Œèƒ½å¤Ÿæ”¯æŒçš„å †æ ˆå˜é‡æ•°é‡ï¼ˆå †æ ˆæ·±åº¦ï¼‰ï¼Œè€Œä¸æ˜¯å­—èŠ‚æ•°ã€‚æ¯”å¦‚ï¼Œåœ¨16ä½å®½åº¦çš„å †æ ˆä¸‹ï¼ŒusStackDepthå®šä¹‰ä¸º100ï¼Œåˆ™å®é™…ä½¿ç”¨200å­—èŠ‚å †æ ˆå­˜å‚¨ç©ºé—´ã€‚å †æ ˆçš„å®½åº¦ä¹˜ä»¥æ·±åº¦å¿…é¡»ä¸è¶…è¿‡size_tç±»å‹æ‰€èƒ½è¡¨ç¤ºçš„æœ€å¤§å€¼ã€‚æ¯”å¦‚ï¼Œsize_tä¸º16ä½ï¼Œåˆ™å¯ä»¥è¡¨ç¤ºå †æ ˆçš„æœ€å¤§å€¼æ˜¯65535å­—èŠ‚ã€‚è¿™æ˜¯å› ä¸ºå †æ ˆåœ¨ç”³è¯·æ—¶æ˜¯ä»¥å­—èŠ‚ä¸ºå•ä½çš„ï¼Œç”³è¯·çš„å­—èŠ‚æ•°å°±æ˜¯å †æ ˆå®½åº¦ä¹˜ä»¥æ·±åº¦ï¼Œå¦‚æœè¿™ä¸ªä¹˜ç§¯è¶…å‡ºsize_tæ‰€è¡¨ç¤ºçš„èŒƒå›´ï¼Œå°±ä¼šæº¢å‡ºï¼Œåˆ†é…çš„å †æ ˆç©ºé—´ä¹Ÿä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚</li><li>pvParametersï¼šæŒ‡é’ˆï¼Œå½“ä»»åŠ¡åˆ›å»ºæ—¶ï¼Œä½œä¸ºä¸€ä¸ªå‚æ•°ä¼ é€’ç»™ä»»åŠ¡ã€‚</li><li>uxPriorityï¼šä»»åŠ¡çš„ä¼˜å…ˆçº§ã€‚å…·æœ‰MPUæ”¯æŒçš„ç³»ç»Ÿï¼Œå¯ä»¥é€šè¿‡ç½®ä½ä¼˜å…ˆçº§å‚æ•°çš„portPRIVILEGE_BITä½ï¼Œéšæ„çš„åœ¨ç‰¹æƒï¼ˆç³»ç»Ÿï¼‰æ¨¡å¼ä¸‹åˆ›å»ºä»»åŠ¡ã€‚æ¯”å¦‚ï¼Œåˆ›å»ºä¸€ä¸ªä¼˜å…ˆçº§ä¸º2çš„ç‰¹æƒä»»åŠ¡ï¼Œå‚æ•°uxPriorityå¯ä»¥è®¾ç½®ä¸º ( 2 | portPRIVILEGE_BIT )ã€‚</li><li>pvCreatedTaskï¼šç”¨äºå›ä¼ ä¸€ä¸ªå¥æŸ„ï¼ˆIDï¼‰ï¼Œåˆ›å»ºä»»åŠ¡åå¯ä»¥ä½¿ç”¨è¿™ä¸ªå¥æŸ„å¼•ç”¨ä»»åŠ¡ã€‚<br> Â </li></ul> 
<p>Â è™½ç„¶xTaskCreate()çœ‹ä¸Šå»å¾ˆåƒå‡½æ•°ï¼Œä½†å…¶å®æ˜¯ä¸€ä¸ªå®ï¼ŒçœŸæ­£è¢«è°ƒç”¨çš„å‡½æ•°<a name="OLE_LINK8"></a><a name="OLE_LINK7">æ˜¯xTaskGenericCreate()</a>ï¼ŒxTaskCreate()å®å®šä¹‰å¦‚ä¸‹æ‰€ç¤ºï¼š</p> 
<pre><code>#define xTaskCreate( pvTaskCode, pcName, usStackDepth,pvParameters, uxPriority, pxCreatedTask )    \
      xTaskGenericCreate( ( pvTaskCode ),( pcName ), ( usStackDepth ), ( pvParameters ), ( uxPriority ), ( pxCreatedTask), ( NULL ), ( NULL ), ( NULL ) )</code></pre> 
<p>å¯ä»¥çœ‹åˆ°,xTaskCreateæ¯”xTaskGenericCreateå°‘äº†ä¸‰ä¸ªå‚æ•°ï¼Œåœ¨å®å®šä¹‰ä¸­ï¼Œè¿™ä¸‰ä¸ªå‚æ•°è¢«è®¾ç½®ä¸ºNULLã€‚è¿™ä¸‰ä¸ªå‚æ•°ç”¨äºä½¿ç”¨é™æ€å˜é‡çš„æ–¹æ³•åˆ†é…å †æ ˆã€ä»»åŠ¡TCBç©ºé—´ä»¥åŠè®¾ç½®MPUç›¸å…³çš„å‚æ•°ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè¿™ä¸‰ä¸ªå‚æ•°æ˜¯ä¸ä½¿ç”¨çš„ï¼Œæ‰€ä»¥ä»»åŠ¡åˆ›å»ºå®xTaskCreateå®šä¹‰çš„æ—¶å€™ï¼Œå°†è¿™ä¸‰ä¸ªå‚æ•°å¯¹ç”¨æˆ·éšè—äº†ã€‚æ¥ä¸‹æ¥çš„ç« èŠ‚ä¸­ï¼Œä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬è¿˜æ˜¯ç§°xTaskCreate()ä¸ºå‡½æ•°ï¼Œè™½ç„¶å®ƒæ˜¯ä¸€ä¸ªå®å®šä¹‰ã€‚</p> 
<p>ä¸Šé¢æˆ‘ä»¬æåˆ°äº†ä»»åŠ¡TCBï¼ˆä»»åŠ¡æ§åˆ¶å—ï¼‰ï¼Œè¿™æ˜¯ä¸€ä¸ªéœ€è¦é‡ç‚¹ä»‹ç»çš„å…³é”®ç‚¹ã€‚å®ƒç”¨äºå­˜å‚¨ä»»åŠ¡çš„çŠ¶æ€ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä»»åŠ¡è¿è¡Œæ—¶çš„ç¯å¢ƒã€‚æ¯ä¸ªä»»åŠ¡éƒ½æœ‰è‡ªå·±çš„ä»»åŠ¡TCBã€‚ä»»åŠ¡TCBæ˜¯ä¸€ä¸ªç›¸å¯¹æ¯”è¾ƒå¤§çš„æ•°æ®ç»“æ„ï¼Œè¿™ä¹Ÿæ˜¯æƒ…ç†ä¹‹ä¸­çš„ï¼Œå› ä¸ºä¸ä»»åŠ¡ç›¸å…³çš„ä»£ç å åˆ°æ•´ä¸ªFreeRTOSä»£ç é‡çš„ä¸€åŠå·¦å³ï¼Œè¿™äº›ä»£ç å¤§éƒ½ä¸ä»»åŠ¡TCBç›¸å…³ï¼Œæˆ‘ä»¬å…ˆæ¥ä»‹ç»ä¸€ä¸‹ä»»åŠ¡TCBæ•°æ®ç»“æ„çš„å®šä¹‰ï¼Œä»»åŠ¡æ§åˆ¶å—å°±ç›¸å½“äºæ¯ä¸ªä»»åŠ¡çš„â€œ<strong>èº«ä»½è¯</strong>â€ã€‚<br> Â </p> 
<h2 id="%E7%AE%80%E5%8C%96%E7%9A%84TCB%E7%BB%93%E6%9E%84%E4%BD%93">ç®€åŒ–çš„TCBç»“æ„ä½“</h2> 
<pre><code>
/*
 * Task control block.  A task control block (TCB) is allocated for each task,
 * and stores task state information, including a pointer to the task's context
 * (the task's run time environment, including register values)
 */
typedef struct tskTaskControlBlock 			/* The old naming convention is used to prevent breaking kernel aware debuggers. */
{
	volatile StackType_t	*pxTopOfStack;	/*&lt; Points to the location of the last item placed on the tasks stack.  THIS MUST BE THE FIRST MEMBER OF THE TCB STRUCT. */

	ListItem_t			xStateListItem;	/*&lt; The list that the state list item of a task is reference from denotes the state of that task (Ready, Blocked, Suspended ). */
	ListItem_t			xEventListItem;		/*&lt; Used to reference a task from an event list. */
	UBaseType_t			uxPriority;			/*&lt; The priority of the task.  0 is the lowest priority. */
	StackType_t			*pxStack;			/*&lt; Points to the start of the stack. */
	char				pcTaskName[ configMAX_TASK_NAME_LEN ];/*&lt; Descriptive name given to the task when created.  Facilitates debugging only. */ /*lint !e971 Unqualified char types are allowed for strings and single characters only. */


} tskTCB;
</code></pre> 
<p>Â æŒ‡é’ˆ<a name="OLE_LINK2"></a><a name="OLE_LINK1">pxTopOfStack</a>å¿…é¡»ä½äºç»“æ„ä½“çš„ç¬¬ä¸€é¡¹ï¼ŒæŒ‡å‘å½“å‰å †æ ˆçš„æ ˆé¡¶ï¼Œå¯¹äºå‘ä¸‹å¢é•¿çš„å †æ ˆï¼ŒpxTopOfStackæ€»æ˜¯æŒ‡å‘æœ€åä¸€ä¸ªå…¥æ ˆçš„é¡¹ç›®ã€‚</p> 
<p>ç„¶åæ˜¯çŠ¶æ€åˆ—è¡¨é¡¹xStateListItemå’Œäº‹ä»¶åˆ—è¡¨é¡¹xEventListItemï¼Œæœ‰å…³åˆ—è¡¨å’Œåˆ—è¡¨é¡¹å¯ä»¥çœ‹ä¹‹å‰æˆ‘å†™çš„åšå®¢ï¼šåˆ—è¡¨è¢«FreeRTOSè°ƒåº¦å™¨ä½¿ç”¨ï¼Œç”¨äºè·Ÿè¸ªä»»åŠ¡ï¼Œå¤„äºå°±ç»ªã€æŒ‚èµ·ã€å»¶æ—¶çš„ä»»åŠ¡ï¼Œéƒ½ä¼šè¢«æŒ‚æ¥åˆ°å„è‡ªçš„åˆ—è¡¨ä¸­ã€‚è°ƒåº¦å™¨å°±æ˜¯é€šè¿‡æŠŠä»»åŠ¡TCBä¸­çš„çŠ¶æ€åˆ—è¡¨é¡¹xStateListItemå’Œäº‹ä»¶åˆ—è¡¨é¡¹xEventListItemæŒ‚æ¥åˆ°ä¸åŒçš„åˆ—è¡¨ä¸­æ¥å®ç°ä¸Šè¿°è¿‡ç¨‹çš„ã€‚åœ¨task.cä¸­ï¼Œå®šä¹‰äº†ä¸€äº›é™æ€åˆ—è¡¨å˜é‡ï¼Œå…¶ä¸­æœ‰<strong>3ç±»åˆ—è¡¨</strong>å°±ç»ªã€é˜»å¡ã€æŒ‚èµ·åˆ—è¡¨ï¼Œä¾‹å¦‚å½“æŸä¸ªä»»åŠ¡å¤„äºå°±ç»ªæ€æ—¶ï¼Œè°ƒåº¦å™¨å°±å°†è¿™ä¸ªä»»åŠ¡TCBçš„xStateListItemåˆ—è¡¨é¡¹æŒ‚æ¥åˆ°å°±ç»ªåˆ—è¡¨ã€‚äº‹ä»¶åˆ—è¡¨é¡¹ä¹Ÿä¸ä¹‹ç±»ä¼¼ï¼Œå½“é˜Ÿåˆ—æ»¡çš„æƒ…å†µä¸‹ï¼Œä»»åŠ¡å› å…¥é˜Ÿæ“ä½œè€Œé˜»å¡æ—¶ï¼Œå°±ä¼šå°†äº‹ä»¶åˆ—è¡¨é¡¹æŒ‚æ¥åˆ°é˜Ÿåˆ—çš„ç­‰å¾…å…¥é˜Ÿåˆ—è¡¨ä¸Šã€‚</p> 
<p>uxPriorityç”¨äºä¿å­˜ä»»åŠ¡çš„ä¼˜å…ˆçº§ï¼Œ0ä¸ºæœ€ä½ä¼˜å…ˆçº§ã€‚ä»»åŠ¡åˆ›å»ºæ—¶ï¼ŒæŒ‡å®šçš„ä»»åŠ¡ä¼˜å…ˆçº§å°±è¢«ä¿å­˜åˆ°è¯¥å˜é‡ä¸­ã€‚</p> 
<p>æŒ‡é’ˆpxStackæŒ‡å‘å †æ ˆçš„èµ·å§‹ä½ç½®ï¼Œä»»åŠ¡åˆ›å»ºæ—¶ä¼šåˆ†é…æŒ‡å®šå¤§å°çš„ä»»åŠ¡å †æ ˆï¼Œç”³è¯·å †æ ˆå†…å­˜å‡½æ•°è¿”å›çš„æŒ‡é’ˆå°±è¢«èµ‹ç»™è¯¥å˜é‡ã€‚å¾ˆå¤šåˆšæ¥è§¦FreeRTOSçš„äººä¼šåˆ†ä¸æ¸…æŒ‡é’ˆpxTopOfStackå’ŒpxStackçš„åŒºåˆ«ï¼Œè¿™é‡Œç®€å•è¯´ä¸€ä¸‹ï¼špxTopOfStackæŒ‡å‘å½“å‰å †æ ˆæ ˆé¡¶ï¼Œéšç€è¿›æ ˆå‡ºæ ˆï¼ŒpxTopOfStackæŒ‡å‘çš„ä½ç½®æ˜¯ä¼šå˜åŒ–çš„ï¼›pxStackæŒ‡å‘å½“å‰å †æ ˆçš„èµ·å§‹ä½ç½®ï¼Œä¸€ç»åˆ†é…åï¼Œå †æ ˆèµ·å§‹ä½ç½®å°±å›ºå®šäº†ï¼Œä¸ä¼šè¢«æ”¹å˜äº†ã€‚é‚£ä¹ˆä¸ºä»€ä¹ˆéœ€è¦pxStackå˜é‡å‘¢ï¼Œè¿™æ˜¯å› ä¸ºéšç€ä»»åŠ¡çš„è¿è¡Œï¼Œå †æ ˆå¯èƒ½ä¼šæº¢å‡ºï¼Œåœ¨å †æ ˆå‘ä¸‹å¢é•¿çš„ç³»ç»Ÿä¸­ï¼Œè¿™ä¸ªå˜é‡å¯ç”¨äºæ£€æŸ¥å †æ ˆæ˜¯å¦æº¢å‡ºï¼›ï¼ˆåªéœ€è¦çŸ¥é“æ ˆä¸€èˆ¬æ˜¯å‘ä¸‹ç”Ÿé•¿çš„ï¼‰</p> 
<p>å­—ç¬¦æ•°ç»„pcTaskNameç”¨äºä¿å­˜ä»»åŠ¡çš„æè¿°æˆ–åå­—ï¼Œåœ¨ä»»åŠ¡åˆ›å»ºæ—¶ï¼Œç”±å‚æ•°æŒ‡å®šã€‚åå­—çš„é•¿åº¦ç”±å®configMAX_TASK_NAME_LENï¼ˆä½äºFreeRTOSConfig.hä¸­ï¼‰æŒ‡å®šï¼ŒåŒ…å«å­—ç¬¦ä¸²ç»“æŸæ ‡å¿—ã€‚</p> 
<p>è¿™é‡Œå°±å¯ä»¥ä»ä»»åŠ¡åˆ›å»ºçš„ä¸€ä¸ªä¾‹å­å¼•å‡ºæˆ‘ä»¬çš„æ€è€ƒï¼š</p> 
<pre><code>    TaskHandle_t xHandleï¼›
    xTaskCreate(vTask_A,â€Task Aâ€,120,NULL,1,&amp;xHandle);</code></pre> 
<p>Â <strong>ä¸ªäººæ€è€ƒ</strong>ï¼š<strong>ä¸Šé¢æ˜¯ä»¥åŠ¨æ€åˆ›å»ºä»»åŠ¡çš„æ–¹å¼åˆ›å»ºäº†ä¸€ä¸ªä»»åŠ¡"Task A"ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°åˆ›å»ºä»»åŠ¡æä¾›çš„å‚æ•°æœ‰ä»»åŠ¡çš„å…¥å£å‡½æ•°ï¼Œä»»åŠ¡åå­—ï¼Œå †æ ˆå¤§å°ï¼Œä»»åŠ¡å…¥å£å‡½æ•°å‚æ•°ï¼Œä¼˜å…ˆçº§ï¼Œä»»åŠ¡å¥æŸ„ã€‚å¯æ˜¯é€šè¿‡ä¸Šé¢çš„åˆ†æå¯ä»¥çŸ¥é“ï¼Œä»»åŠ¡æ§åˆ¶å—ä¸­å¥½åƒæ²¡æœ‰ä¿å­˜ä»»åŠ¡å…¥å£å‡½æ•°ï¼Œä»»åŠ¡å…¥å£å‡½æ•°å‚æ•°ã€‚è¿™ä¸¤ä¸ªå‚æ•°éƒ½æ²¡æœ‰åœ¨TCBä¸­å¾—åˆ°ä½“ç°ï¼Œé‚£ä¼ è¿›å»çš„ä»»åŠ¡å…¥å£å‡½æ•°ä»¥åŠå…¥å£å‡½æ•°å‚æ•°ä¼ è¿›æ¥åˆ°å“ªé‡Œå»äº†ï¼Œä»¥åŠä¼ è¿›æ¥çš„æ ˆçš„å¤§å°æ€ä¹ˆç”¨ï¼Ÿ</strong></p> 
<p>å­¦åˆ°è¿™é‡Œéƒ½çŸ¥é“æ ˆçš„ä½œç”¨ï¼Œä»¥åŠæ¯ä¸ªä»»åŠ¡éƒ½æœ‰è‡ªå·±çš„æ ˆï¼Œé‚£å¯ä»¥æ€è€ƒä¸¤ä¸ªé—®é¢˜ï¼Œæ ˆä»å“ªé‡Œåˆ†é…ï¼Œç«™çš„å¤§å°æ€ä¹ˆç¡®å®šï¼Ÿ</p> 
<p><strong>æ ˆçš„å¤§å°</strong>ï¼šç”±å±€éƒ¨å˜é‡çš„å¤§å°å’Œå‡½æ•°è°ƒç”¨çš„æ·±åº¦å†³å®š</p> 
<p><strong>æ ˆä»å“ªé‡Œåˆ†é…</strong></p> 
<pre><code class="language-cpp">static uint8_t ucHeap[ configTOTAL_HEAP_SIZE ];</code></pre> 
<p>å…¥å£å‡½æ•°åœ°å€ï¼šæ‰§è¡Œä»»åŠ¡çš„æ—¶å€™ï¼Œåªéœ€è¦æŠŠPCå¯„å­˜å™¨èµ‹å€¼ä¸ºä»»åŠ¡çš„å…¥å£å‡½æ•°åœ°å€å³å¯ï¼Œ æ‰€ä»¥å¯ä»¥å¾—åˆ°ç­”æ¡ˆï¼Œè€Œå¯¹äºå…¥å£å‡½æ•°çš„å‚æ•°ï¼Œç”±äºå‚æ•°åœ¨Cortex-Mä¸­æœ‰ä¸€å¥—è°ƒç”¨è§„åˆ™ï¼Œ æ‰€ä»¥å‚æ•°ä¹Ÿæ˜¯ä¿å­˜åœ¨å¯„å­˜å™¨é‡Œé¢ï¼ˆå°±æ¯”å¦‚R0é‡Œé¢ï¼‰.</p> 
<h2 id="%E5%88%9B%E5%BB%BA%E4%BB%BB%E5%8A%A1%E5%A0%86%E6%A0%88%E5%92%8C%E4%BB%BB%E5%8A%A1TCB">åˆ›å»ºä»»åŠ¡å †æ ˆå’Œä»»åŠ¡TCB</h2> 
<p>è°ƒç”¨å‡½æ•°prvAllocateTCBAndStack()åˆ›å»ºä»»åŠ¡å †æ ˆå’Œä»»åŠ¡TCBã€‚æœ‰ä¸¤ç§æ–¹å¼åˆ›å»ºä»»åŠ¡å †æ ˆå’Œä»»åŠ¡TCBï¼Œä¸€ç§æ˜¯ä½¿ç”¨åŠ¨æ€å†…å­˜åˆ†é…æ–¹æ³•ï¼Œè¿™æ ·å½“ä»»åŠ¡åˆ é™¤æ—¶ï¼Œä»»åŠ¡å †æ ˆå’Œä»»åŠ¡æ§åˆ¶å—ç©ºé—´ä¼šè¢«é‡Šæ”¾ï¼Œå¯ç”¨äºå…¶å®ƒä»»åŠ¡ï¼›å¦ä¸€ç§æ˜¯ä½¿ç”¨é™æ€å˜é‡æ¥å®ç°ï¼Œåœ¨åˆ›å»ºä»»åŠ¡å‰å®šä¹‰å¥½å…¨å±€æˆ–è€…é™æ€å †æ ˆæ•°ç»„å’Œä»»åŠ¡æ§åˆ¶å—å˜é‡ï¼Œåœ¨è°ƒç”¨åˆ›å»ºä»»åŠ¡APIå‡½æ•°æ—¶ï¼Œå°†è¿™ä¸¤ä¸ªå˜é‡ä»¥å‚æ•°çš„å½¢å¼ä¼ é€’ç»™ä»»åŠ¡åˆ›å»ºå‡½æ•°xTaskGenericCreate()ã€‚å¦‚æœä½¿ç”¨é»˜è®¤çš„xTaskCreate()åˆ›å»ºä»»åŠ¡å‡½æ•°ï¼Œåˆ™ä½¿ç”¨åŠ¨æ€å†…å­˜åˆ†é…ï¼Œå› ä¸ºä¸é™æ€å†…å­˜åˆ†é…æœ‰å…³çš„å‚æ•°ä¸å¯è§ï¼ˆåœ¨ä¸€å¼€å§‹æˆ‘ä»¬è¯´è¿‡xTaskCreate()å…¶å®æ˜¯ä¸€ä¸ªå¸¦å‚æ•°çš„å®å®šä¹‰ï¼ŒçœŸæ­£è¢«æ‰§è¡Œçš„å‡½æ•°æ˜¯xTaskGenericCreate()ï¼Œå‚è€ƒå®xTaskCreate()çš„å®šä¹‰å¯ä»¥çŸ¥é“ï¼ŒxTaskCreate()å¯¹å¤–éšè—äº†ä½¿ç”¨é™æ€å†…å­˜åˆ†é…çš„å‚æ•°ï¼Œåœ¨è°ƒç”¨xTaskGenericCreate()æ—¶ï¼Œè¿™äº›å‚æ•°è¢«è®¾ç½®ä¸ºNULLï¼‰ã€‚</p> 
<p>åˆ›å»ºä»»åŠ¡é¦–å…ˆç”³è¯·äº†ä»»åŠ¡æ§åˆ¶å—TCBå’Œä»»åŠ¡å †æ ˆçš„å†…å­˜ç©ºé—´ï¼Œç„¶åå°±æ˜¯åˆå§‹åŒ–å †æ ˆç©ºé—´çš„å†…å®¹ï¼Œå› ä¸ºï¼Œåˆ›å»ºä»»åŠ¡å…¶å®æˆ‘ä¸ªäººç†è§£å°±æ˜¯ä»»åŠ¡åˆ›å»ºå±äºä»»åŠ¡è¿è¡Œæ—¶çš„ä¸€ç§ç‰¹æ®ŠçŠ¶æ€ï¼Œæ‰€ä»¥åˆ›å»ºä»»åŠ¡çš„æ—¶å€™å®ƒçš„æ ˆè‚¯å®šä¹Ÿæ˜¯ä¸€ç§å½¢å¼ï¼Œæ‰€ä»¥å¿…é¡»è¦åˆå§‹åŒ–å®ƒçš„å †æ ˆï¼Œç„¶åä»»åŠ¡æ‰å¯ä»¥è¿è¡Œã€‚</p> 
<p><strong>ä¸ªäººç†è§£ï¼šç¨‹åºæ˜¯ä¸€ä¸ªçŠ¶æ€æœºï¼Œä»»åŠ¡å½’æ ¹ç»“åº•ä¹Ÿæ˜¯ç¨‹åºï¼Œæ‰€ä»¥åˆ›å»ºä»»åŠ¡æ— éå°±æ˜¯è®¾ç½®çŠ¶æ€æœºçš„åˆå§‹çŠ¶æ€ï¼Œå¦‚åŒLinuxä¸‹forkå°±æ˜¯å¤åˆ¶çŠ¶æ€æœºï¼Œæ‰€ä»¥å®ƒå¿…é¡»è¦æ„é€ å‡ºå±äºå®ƒè‡ªå·±çš„æ ˆï¼Œåˆ°å®ƒè¿è¡Œæ—¶ï¼Œç›´æ¥æ¢å¤å®ƒçš„æ ˆ</strong>ğŸ¤£<strong>ã€‚</strong></p> 
<h2 id="%E5%88%9D%E5%A7%8B%E5%8C%96%E4%BB%BB%E5%8A%A1TCB%E7%9A%84%E6%88%90%E5%91%98">åˆå§‹åŒ–ä»»åŠ¡TCBçš„æˆå‘˜</h2> 
<pre><code class="language-cpp">static void prvInitialiseNewTask( 	TaskFunction_t pxTaskCode,
									const char * const pcName,		/*lint !e971 Unqualified char types are allowed for strings and single characters only. */
									const uint32_t ulStackDepth,
									void * const pvParameters,
									UBaseType_t uxPriority,
									TaskHandle_t * const pxCreatedTask,
									TCB_t *pxNewTCB,
									const MemoryRegion_t * const xRegions )</code></pre> 
<p>Â åœ¨ä¸Šé¢çš„å‡½æ•°ä¸­</p> 
<p>è®¾ç½®äº†æ ˆé¡¶æŒ‡é’ˆï¼špxTopOfStack = &amp;( pxNewTCB-&gt;pxStack[ ulStackDepth - ( uint32_t ) 1 ] );</p> 
<p>è®¾ç½®äº†ä»»åŠ¡çš„åå­—ï¼špxNewTCB-&gt;pcTaskName[ x ] = pcName[ x ];</p> 
<p>è®¾ç½®äº†ä»»åŠ¡ä¼˜å…ˆçº§ï¼špxNewTCB-&gt;uxPriority = uxPriority;</p> 
<p>è¿™ä¸ªå‡½æ•°å°±æ˜¯æŠŠæˆ‘ä»¬åˆ›å»ºä»»åŠ¡æ—¶çš„ä¸€äº›ä¿¡æ¯ä¿å­˜åˆ°TCBæ§åˆ¶å—ä¸­ï¼Œè¿™ä¸ªå‡½æ•°æœ«å°¾ä¼šè°ƒç”¨ä¸‹é¢çš„è¿™ä¸ªpxPortInitialiseStackå‡½æ•°è¿›è¡Œå †æ ˆçš„åˆå§‹åŒ–ï¼Œæ¯•ç«Ÿè¿™ä¸ªå‡½æ•°ä¸€å¼€å§‹åªæ˜¯æŠŠæ ˆé¡¶è®¾ç½®æˆç”³è¯·å†…å­˜çš„æœ«å°¾ã€‚</p> 
<h2 id="%E5%88%9D%E5%A7%8B%E5%8C%96%E4%BB%BB%E5%8A%A1%E5%A0%86%E6%A0%88">åˆå§‹åŒ–ä»»åŠ¡å †æ ˆ</h2> 
<pre><code class="language-cpp">StackType_t *pxPortInitialiseStack( StackType_t *pxTopOfStack, TaskFunction_t pxCode, void *pvParameters )
{
	/* Simulate the stack frame as it would be created by a context switch
	interrupt. */

	/* Offset added to account for the way the MCU uses the stack on entry/exit
	of interrupts, and to ensure alignment. */
	pxTopOfStack--;

	*pxTopOfStack = portINITIAL_XPSR;	/* xPSR */
	pxTopOfStack--;
	*pxTopOfStack = ( ( StackType_t ) pxCode ) &amp; portSTART_ADDRESS_MASK;	/* PC */
	pxTopOfStack--;
	*pxTopOfStack = ( StackType_t ) prvTaskExitError;	/* LR */

	/* Save code space by skipping register initialisation. */
	pxTopOfStack -= 5;	/* R12, R3, R2 and R1. */
	*pxTopOfStack = ( StackType_t ) pvParameters;	/* R0 */

	/* A save method is being used that requires each task to maintain its
	own exec return value. */
	pxTopOfStack--;
	*pxTopOfStack = portINITIAL_EXC_RETURN;

	pxTopOfStack -= 8;	/* R11, R10, R9, R8, R7, R6, R5 and R4. */

	return pxTopOfStack;
}</code></pre> 
<p>ä¸Šé¢å‡½æ•°çš„ä½œç”¨æ— éå°±æ˜¯å¯¹æ ˆå¡«å……ä¸€äº›å¯„å­˜å™¨çš„å€¼ï¼Œå°±æ˜¯ä¿å­˜ç°åœºçš„æ„æ€ï¼Œç„¶åä»»åŠ¡æ‰§è¡Œï¼Œåªéœ€æ¢å¤ç°åœºå³å¯ã€‚å¯ä»¥çœ‹åˆ°ä»»åŠ¡å…¥å£å‡½æ•°åœ°å€ä»¥åŠå‚æ•°å°±è¢«è®¾ç½®åˆ°äº†æ ˆä¸­ï¼Œå…¶å®å®ƒå°±ä¿å­˜åœ¨æ ˆä¸­äº†ã€‚è¿™å°±å›ç­”äº†æˆ‘ä»¬ä¹‹å‰çš„ç–‘æƒ‘ï¼Œåˆ›å»ºä»»åŠ¡çš„å‚æ•°ï¼ŒTCBæ²¡æœ‰çš„ï¼Œè¢«ä¿å­˜åˆ°äº†æ ˆä¸­ã€‚</p> 
<p><img alt="" height="923" src="https://images2.imgbox.com/9c/d7/XCrQkZKu_o.png" width="1200"></p> 
<p>Â è¿™éƒ¨åˆ†å†…å®¹æ¶‰åŠåˆ°æ¯”è¾ƒå¤šCortex-Mæ¶æ„çš„å†…å®¹ï¼Œéœ€è¦é˜…è¯»Cortex-M3å’ŒM4æƒå¨æŒ‡å—å¯ä»¥æ¯”è¾ƒå¥½ç†è§£ä¸ºä»€ä¹ˆã€‚</p> 
<h2 id="%E6%8A%8A%E6%96%B0%E4%BB%BB%E5%8A%A1%E6%B7%BB%E5%8A%A0%E5%88%B0%E5%B0%B1%E7%BB%AA%E5%88%97%E8%A1%A8">æŠŠæ–°ä»»åŠ¡æ·»åŠ åˆ°å°±ç»ªåˆ—è¡¨</h2> 
<pre><code class="language-cpp">static void prvAddNewTaskToReadyList( TCB_t *pxNewTCB )</code></pre> 
<p><img alt="" height="265" src="https://images2.imgbox.com/f5/88/RW2nqKUM_o.png" width="1200"></p> 
<p>Â tasks.cä¸­å®šä¹‰äº†ä¸€ä¸ªä»»åŠ¡TCBæŒ‡é’ˆå‹å˜é‡ï¼š</p> 
<p>Â  Â  Â  PRIVILEGED_DATA TCB_t * volatile pxCurrentTCB= NULL;</p> 
<p>Â  Â  Â  è¿™æ˜¯ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œåœ¨tasks.cä¸­åªå®šä¹‰äº†è¿™ä¸€ä¸ªå…¨å±€å˜é‡ã€‚è¿™ä¸ªå˜é‡ç”¨æ¥æŒ‡å‘å½“å‰æ­£åœ¨è¿è¡Œçš„ä»»åŠ¡TCBï¼Œæˆ‘ä»¬éœ€è¦å¤šäº†è§£ä¸€ä¸‹è¿™ä¸ªå˜é‡ã€‚FreeRTOSçš„æ ¸å¿ƒæ˜¯ç¡®ä¿å¤„äºä¼˜å…ˆçº§æœ€é«˜çš„å°±ç»ªä»»åŠ¡è·å¾—CPUè¿è¡Œæƒã€‚</p> 
<p>Â  Â  Â  å¦‚æœè°ƒåº¦å™¨è¿˜æ²¡æœ‰å‡†å¤‡å¥½ï¼ˆç¨‹åºåˆšå¼€å§‹è¿è¡Œæ—¶ï¼Œå¯èƒ½ä¼šå…ˆåˆ›å»ºå‡ ä¸ªä»»åŠ¡ï¼Œä¹‹åæ‰ä¼šå¯åŠ¨è°ƒåº¦å™¨ï¼‰ï¼Œå¹¶ä¸”æ–°åˆ›å»ºçš„ä»»åŠ¡ä¼˜å…ˆçº§å¤§äºå˜é‡pxCurrentTCBæŒ‡å‘çš„ä»»åŠ¡ä¼˜å…ˆçº§ï¼Œåˆ™è®¾ç½®pxCurrentTCBæŒ‡å‘å½“å‰æ–°åˆ›å»ºçš„ä»»åŠ¡TCBï¼ˆç¡®ä¿pxCurrentTCBæŒ‡å‘ä¼˜å…ˆçº§æœ€é«˜çš„å°±ç»ªä»»åŠ¡ï¼‰ã€‚</p> 
<p>è°ƒç”¨prvAddTaskToReadyList(pxNewTCB)å°†åˆ›å»ºçš„ä»»åŠ¡TCBåŠ å…¥åˆ°å°±ç»ªåˆ—è¡¨æ•°ç»„ä¸­ï¼Œä»»åŠ¡çš„ä¼˜å…ˆçº§ç¡®å®šäº†åŠ å…¥åˆ°å°±ç»ªåˆ—è¡¨æ•°ç»„çš„å“ªä¸ªä¸‹æ ‡ã€‚æ¯”å¦‚æˆ‘ä»¬æ–°åˆ›å»ºçš„ä»»åŠ¡ä¼˜å…ˆçº§ä¸º1ï¼Œåˆ™è¿™ä¸ªä»»åŠ¡è¢«åŠ å…¥åˆ°åˆ—è¡¨pxReadyTasksLists[1]ä¸­ã€‚</p> 
<p>Â  Â  Â  Â prvAddTaskToReadyList()å…¶å®æ˜¯ä¸€ä¸ªå®ï¼Œç”±ä¸€ç³»åˆ—è¯­å¥ç»„æˆï¼Œå»é™¤å…¶ä¸­çš„è·Ÿè¸ªå®å¤–ï¼Œè¿™ä¸ªå®å®šä¹‰å¦‚ä¸‹æ‰€ç¤ºï¼š</p> 
<pre><code class="language-cpp">#defineprvAddTaskToReadyList( pxTCB )                        \
    taskRECORD_READY_PRIORITY( ( pxTCB)-&gt;uxPriority );       \
    vListInsertEnd( &amp;( pxReadyTasksLists[ (pxTCB )-&gt;uxPriority ] ), &amp;( ( pxTCB )-&gt;xStateListItem ) );</code></pre> 
<p>å¦‚æœä¸Šé¢çš„æ­¥éª¤éƒ½æ­£ç¡®æ‰§è¡Œï¼Œå¹¶ä¸”è°ƒåº¦å™¨ä¹Ÿå¼€å§‹å·¥ä½œï¼Œåˆ™åˆ¤æ–­å½“å‰ä»»åŠ¡çš„ä¼˜å…ˆçº§æ˜¯å¦å¤§äºæ–°åˆ›å»ºçš„ä»»åŠ¡ä¼˜å…ˆçº§ã€‚å¦‚æœæ–°åˆ›å»ºçš„ä»»åŠ¡ä¼˜å…ˆçº§æ›´é«˜ï¼Œåˆ™è°ƒç”¨taskYIELD_IF_USING_PREEMPTION()å¼ºåˆ¶è¿›è¡Œä¸€æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œåˆ‡æ¢åï¼Œæ–°åˆ›å»ºçš„ä»»åŠ¡å°†è·å¾—CPUæ§åˆ¶æƒï¼Œç²¾ç®€åçš„ä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚</p> 
<pre><code class="language-cpp"> if( xReturn == pdPASS )
    {
        if( xSchedulerRunning != pdFALSE )
        {
            /* å¦‚æœæ–°åˆ›å»ºçš„ä»»åŠ¡ä¼˜å…ˆçº§å¤§äºå½“å‰ä»»åŠ¡ä¼˜å…ˆçº§ï¼Œåˆ™æ–°åˆ›å»ºçš„ä»»åŠ¡åº”è¯¥è¢«ç«‹å³æ‰§è¡Œã€‚*/
            if(pxCurrentTCB-&gt;uxPriority &lt; uxPriority )
            {
                taskYIELD_IF_USING_PREEMPTION();
            }
        }
    }</code></pre> 
<h2 id="%C2%A0%E4%BB%BB%E5%8A%A1%E5%88%A0%E9%99%A4">Â ä»»åŠ¡åˆ é™¤</h2> 
<pre><code class="language-cpp">void vTaskDelete( TaskHandle_t xTaskToDelete )
	{
	TCB_t *pxTCB;

		taskENTER_CRITICAL();
		{
			/* If null is passed in here then it is the calling task that is
			being deleted. */
			pxTCB = prvGetTCBFromHandle( xTaskToDelete );

			/* Remove task from the ready/delayed list. */
			if( uxListRemove( &amp;( pxTCB-&gt;xStateListItem ) ) == ( UBaseType_t ) 0 )
			{
				taskRESET_READY_PRIORITY( pxTCB-&gt;uxPriority );
			}
			else
			{
				mtCOVERAGE_TEST_MARKER();
			}

			/* Is the task waiting on an event also? */
			if( listLIST_ITEM_CONTAINER( &amp;( pxTCB-&gt;xEventListItem ) ) != NULL )
			{
				( void ) uxListRemove( &amp;( pxTCB-&gt;xEventListItem ) );
			}
			else
			{
				mtCOVERAGE_TEST_MARKER();
			}

			/* Increment the uxTaskNumber also so kernel aware debuggers can
			detect that the task lists need re-generating.  This is done before
			portPRE_TASK_DELETE_HOOK() as in the Windows port that macro will
			not return. */
			uxTaskNumber++;

			if( pxTCB == pxCurrentTCB )
			{
				/* A task is deleting itself.  This cannot complete within the
				task itself, as a context switch to another task is required.
				Place the task in the termination list.  The idle task will
				check the termination list and free up any memory allocated by
				the scheduler for the TCB and stack of the deleted task. */
				vListInsertEnd( &amp;xTasksWaitingTermination, &amp;( pxTCB-&gt;xStateListItem ) );

				/* Increment the ucTasksDeleted variable so the idle task knows
				there is a task that has been deleted and that it should therefore
				check the xTasksWaitingTermination list. */
				++uxDeletedTasksWaitingCleanUp;

				/* Call the delete hook before portPRE_TASK_DELETE_HOOK() as
				portPRE_TASK_DELETE_HOOK() does not return in the Win32 port. */
				traceTASK_DELETE( pxTCB );

				/* The pre-delete hook is primarily for the Windows simulator,
				in which Windows specific clean up operations are performed,
				after which it is not possible to yield away from this task -
				hence xYieldPending is used to latch that a context switch is
				required. */
				portPRE_TASK_DELETE_HOOK( pxTCB, &amp;xYieldPending );
			}
			else
			{
				--uxCurrentNumberOfTasks;
				traceTASK_DELETE( pxTCB );
				prvDeleteTCB( pxTCB );

				/* Reset the next expected unblock time in case it referred to
				the task that has just been deleted. */
				prvResetNextTaskUnblockTime();
			}
		}
		taskEXIT_CRITICAL();

		/* Force a reschedule if it is the currently running task that has just
		been deleted. */
		if( xSchedulerRunning != pdFALSE )
		{
			if( pxTCB == pxCurrentTCB )
			{
				configASSERT( uxSchedulerSuspended == 0 );
				portYIELD_WITHIN_API();
			}
			else
			{
				mtCOVERAGE_TEST_MARKER();
			}
		}
	}
</code></pre> 
<p><img alt="" height="346" src="https://images2.imgbox.com/9a/55/wQFYwZWO_o.png" width="1200"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ac9683c6dbb540ee412cfdda881aec13/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">ä¸€æ–‡å¸¦ä½ è¯»æ‡‚PyQtï¼šç”¨Pythonåšå‡ºä¸C&#43;&#43;ä¸€æ ·çš„GUIç•Œé¢åº”ç”¨ç¨‹åº</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8d404ddceeca77c3f4b7c72739fa6b07/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">001-è°ƒç”¨å‡½æ•°è®¿é—®ç»“æ„ä½“æ•°ç»„æˆå‘˜ï¼Œå¹¶ä¿®æ”¹å…¶æ•°å€¼</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 ç¼–ç¨‹å¤§ç™½çš„åšå®¢.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>