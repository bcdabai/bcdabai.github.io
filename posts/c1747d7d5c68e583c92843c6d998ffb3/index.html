<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>破解某网课的m3u8文件的key加密 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="破解某网课的m3u8文件的key加密" />
<meta property="og:description" content="1.首先，找到m3u8文件 打开开发者工具，在搜索栏中搜索m3u8，可以看到两个链接
一个链接其中有三个清晰度不同多的m3u8的文件，下面的一个链接就是我们加载的m3u8的文件
这里可以看到，他是使用的AES-128加密，秘钥链接和iv值都给出了。但是事情真的那么简单吗？
2.进入key的链接 发现无法访问这个链接。看来key的链接是加密了。
搜索key，可以看到，key的链接确实是加密了，后面加了个token。我们请求一下这个链接看看
得到了一个32字节的文件，但是按照道理来说，这个文件应该是16字节的才对。看来这个key是加密过的。没办法，只能去看js了
。
3.在js里寻找解密 可以看到这个请求都是从poliy player里面发出来的，那我们进入js里面看看。因为是aes加密，所以搜索一下decrypt，找到了这个函数。
这个bt函数就是key的解密了。这个函数看起来很熟悉，这不正是某利威加密吗？那既然这样，就好解决了。
4.按照某利威的方式来解密 某利威加密就是会有个json文件，取其中的seed_const进行MD5加密，取前16位作为key，iv是固定的AQIDBQcLDRETFx0HBQMCAQ==（base64编码后的，自己去解码）。现在key有了，iv也有了，对加密的key文件进行解密，获取真的key。但是，前面还有一个问题就是这个json也是加密了的。
5.先解密json json解密的话就是一利用vid就行md5加密，取前16位为key，后16位为iv进行解密。vid就是
就是视频链接后面的参数。解密后的结果转为字符串再通过base64解码, 最后将字符串通过json转换为对象。其中的seed_const就是我们要的参数了。
6.进行解密 import os from Crypto.Cipher import AES import base64 filename = &#39;1.key.txt&#39; # 把文件内容以byte字节形式读写到缓冲区中。 def read_into_buffer(filename): buf = bytearray(os.path.getsize(filename)) with open(filename, &#39;rb&#39;) as f: f.readinto(buf) f.close() return buf print(list(read_into_buffer(filename))) password = &#39;b1d10e7bafa44212&#39;.encode() #秘钥，b就是表示为bytes类型 iv = base64.b64decode(&#39;AQIDBQcLDRETFx0HBQMCAQ==&#39;) # iv偏移量，bytes类型 text = read_into_buffer(filename) #需要加密的内容，bytes类型 # AES.MODE_CBC 表示模式是CBC模式 aes = AES.new(password,AES.MODE_CBC,iv) #CBC模式下解密需要重新创建一个aes对象 den_text = aes." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/c1747d7d5c68e583c92843c6d998ffb3/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-02-11T13:27:57+08:00" />
<meta property="article:modified_time" content="2022-02-11T13:27:57+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">破解某网课的m3u8文件的key加密</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h3>1.首先，找到m3u8文件</h3> 
<p>打开开发者工具，在搜索栏中搜索m3u8，可以看到两个链接</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/ae/47/VNQqboOf_o.png"></p> 
<p></p> 
<p>一个链接其中有三个清晰度不同多的m3u8的文件，下面的一个链接就是我们加载的m3u8的文件</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/ab/c8/AUwG9uQN_o.png"></p> 
<p></p> 
<p>这里可以看到，他是使用的AES-128加密，秘钥链接和iv值都给出了。但是事情真的那么简单吗？</p> 
<h3>2.进入key的链接</h3> 
<p></p> 
<p>发现无法访问这个链接。看来key的链接是加密了。</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/8f/e8/BdHb2u3R_o.png"></p> 
<p>搜索key，可以看到，key的链接确实是加密了，后面加了个token。我们请求一下这个链接看看</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/3a/ab/YrRpBjtt_o.png"></p> 
<p>得到了一个32字节的文件，但是按照道理来说，这个文件应该是16字节的才对。看来这个key是加密过的。没办法，只能去看js了</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/ff/8e/VfeVZPS4_o.png"></p> 
<p>。</p> 
<h3>3.在js里寻找解密</h3> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/1d/b3/sotmd8E5_o.png"></p> 
<p>可以看到这个请求都是从poliy player里面发出来的，那我们进入js里面看看。因为是aes加密，所以搜索一下decrypt，找到了这个函数。</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/f2/8b/PJCtYYm2_o.png"></p> 
<p>这个bt函数就是key的解密了。这个函数看起来很熟悉，这不正是某利威加密吗？那既然这样，就好解决了。</p> 
<h3>4.按照某利威的方式来解密</h3> 
<p>某利威加密就是会有个json文件，取<strong>其中的seed_const进行MD5加密</strong>，取<strong>前16位作为key</strong>，iv是固定的AQIDBQcLDRETFx0HBQMCAQ==（base64编码后的，自己去解码）。现在key有了，iv也有了，对加密的key文件进行解密，获取真的key。但是，前面还有一个问题就是这个json也是加密了的。</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/b3/b1/EWgb6sFu_o.png"></p> 
<h3>5.先解密json</h3> 
<p>json解密的话就是一利用vid就行md5加密，取前16位为key，后16位为iv进行解密。vid就是</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/cb/9d/pVPTR4gh_o.png"></p> 
<p>就是视频链接后面的参数。解密后的结果转为字符串再通过base64解码, 最后将字符串通过json转换为对象。其中的seed_const就是我们要的参数了。</p> 
<h3>6.进行解密</h3> 
<pre>import os
from Crypto.Cipher import AES
import base64
filename = '1.key.txt'
# 把文件内容以byte字节形式读写到缓冲区中。
def read_into_buffer(filename):
  buf = bytearray(os.path.getsize(filename))
  with open(filename, 'rb') as f:
      f.readinto(buf)
  f.close()
  return buf
print(list(read_into_buffer(filename)))
password = 'b1d10e7bafa44212'.encode() #秘钥，b就是表示为bytes类型
iv = base64.b64decode('AQIDBQcLDRETFx0HBQMCAQ==') # iv偏移量，bytes类型
text = read_into_buffer(filename) #需要加密的内容，bytes类型
# AES.MODE_CBC 表示模式是CBC模式
aes = AES.new(password,AES.MODE_CBC,iv) #CBC模式下解密需要重新创建一个aes对象
den_text = aes.decrypt(text)
print("明文：",list(den_text))
keys = list(den_text)
hex16 = []
for i in keys[:16]:
  hex16.append(i)
def print_bytes_hex(data):
  lin = ['%02X' % i for i in data]
  print(" ".join(lin))
print_bytes_hex(hex16)</pre> 
<p>获取到key，就拿着key和m3u8里面的iv偏移量进行解密下载。</p> 
<p>ok，就这样了。<strong>最后宣传一下交流群342096685</strong>。<strong>找不到合适的m3u8下载器。群里有，自取</strong>。</p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/85b8779d61863b09020255aac6b4edaf/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">vs2017_opencv340</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/977f1258dac6cb4a50732df9a3c8e34a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Hyper-V设置多个网口</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>