<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>使用 pubsub-js 进行消息发布订阅 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="使用 pubsub-js 进行消息发布订阅" />
<meta property="og:description" content="npm 包地址
github 包地址
pubsub-js 是一个轻量级的 JavaScript 基于主题的消息订阅发布库 ，压缩后小于1b。它具有使用简单、性能高效、支持多平台等优点，可以很好地满足各种需求。
功能特点： 无依赖同步解耦ES3 兼容。pubsub-js 能够在任何可以执行 JavaScript 的地方运行。AMD / CommonJS 模块支持不修改订阅者（jQuery 自定义事件修改订阅者）易于理解和使用（得益于同步解耦）小（ish），压缩后小于 1kb 获取 pubsub-js 你可以通过以下几种方式获取 pubsub-js。
使用 NPM 包 首先，你需要在项目根目录下使用以下命令安装 pubsub-js：
# 使用 pnpm 安装 pnpm add pubsub-js # 使用 npm 安装 npm install --save pubsub-js # 使用 yarn 安装 yarn add pubsub-js 使用 CDN 你还可以通过 CDN 获取构建好的 pubsub-js 文件。将以下代码添加到 HTML 文件的 &lt;script&gt; 标签中：
&lt;script src=&#34;https://unpkg.com/pubsub-js&#34;&gt;&lt;/script&gt; &lt;!-- or --&gt; &lt;script src=&#34;http://www.jsdelivr.com/#!pubsubjs&#34;&gt;&lt;/script&gt; &lt;!" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/d2ddf2226ebc379c1c62e0de166c3982/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-10T10:23:40+08:00" />
<meta property="article:modified_time" content="2023-11-10T10:23:40+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">使用 pubsub-js 进行消息发布订阅</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><a href="https://www.npmjs.com/package/pubsub-js" rel="nofollow">npm 包地址</a></p> 
<p><a href="https://github.com/mroderick/PubSubJS">github 包地址</a></p> 
<p><code>pubsub-js</code> 是一个轻量级的 <code>JavaScript</code> 基于主题的消息订阅发布库 ，压缩后小于1b。它具有使用简单、性能高效、支持多平台等优点，可以很好地满足各种需求。</p> 
<h3><a id="_6"></a>功能特点：</h3> 
<ul><li>无依赖</li><li>同步解耦</li><li>ES3 兼容。pubsub-js 能够在任何可以执行 JavaScript 的地方运行。</li><li>AMD / CommonJS 模块支持</li><li>不修改订阅者（jQuery 自定义事件修改订阅者）</li><li>易于理解和使用（得益于同步解耦）</li><li>小（ish），压缩后小于 1kb</li></ul> 
<h3><a id="_pubsubjs_16"></a>获取 pubsub-js</h3> 
<p>你可以通过以下几种方式获取 <code>pubsub-js</code>。</p> 
<ul><li>使用 NPM 包</li></ul> 
<p>首先，你需要在项目根目录下使用以下命令安装 <code>pubsub-js</code>：</p> 
<pre><code class="prism language-bash"><span class="token comment"># 使用 pnpm 安装</span>
<span class="token function">pnpm</span> <span class="token function">add</span> pubsub-js
<span class="token comment"># 使用 npm 安装</span>
<span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">--save</span> pubsub-js
<span class="token comment"># 使用 yarn 安装</span>
<span class="token function">yarn</span> <span class="token function">add</span> pubsub-js
</code></pre> 
<ul><li>使用 CDN</li></ul> 
<p>你还可以通过 <code>CDN</code> 获取构建好的 <code>pubsub-js</code> 文件。将以下代码添加到 <code>HTML</code> 文件的 <code>&lt;script&gt;</code> 标签中：</p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://unpkg.com/pubsub-js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- or --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.jsdelivr.com/#!pubsubjs<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- or --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://cdnjs.com/libraries/pubsub-js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<ul><li>从 GitHub下载</li></ul> 
<p><a href="https://github.com/mroderick/PubSubJS/tags">GitHub下载地址</a></p> 
<p>截止到目前，获取的最新版本是 <code>v1.9.4</code>，如图：</p> 
<p><img src="https://images2.imgbox.com/c6/d4/39VHUPUq_o.png" alt="pubsub"></p> 
<h3><a id="_pubsubjs_52"></a>引入 pubsub-js</h3> 
<ul><li>通过 NPM 包引入</li></ul> 
<p>在 <code>JavaScript</code> 文件顶部使用 <code>import</code> 引入 <code>pubsub-js</code>：</p> 
<pre><code class="prism language-js"><span class="token comment">// using ES6 modules</span>
<span class="token keyword">import</span> PubSub <span class="token keyword">from</span> <span class="token string">'pubsub-js'</span>

<span class="token comment">// using CommonJS modules</span>
<span class="token keyword">const</span> PubSub <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'pubsub-js'</span><span class="token punctuation">)</span>
</code></pre> 
<ul><li>使用 <code>script</code> 标签引入</li></ul> 
<p>通过直接在 <code>HTML</code> 文件中添加 <code>&lt;script&gt;</code> 标签，引入构建好的 <code>pubsub-js</code> 文件：</p> 
<pre><code class="prism language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!-- 引入 pubsub-js 文件 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://unpkg.com/pubsub-js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h3><a id="_81"></a>简单使用</h3> 
<p>以更新未读消息数量为例。</p> 
<ol><li>首先，新建一个 <code>pubsub.js</code> 文件</li></ol> 
<pre><code class="prism language-js"><span class="token keyword">import</span> PubSub <span class="token keyword">from</span> <span class="token string">'pubsub-js'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> PubSub
</code></pre> 
<ol start="2"><li>使用 <code>subscribe</code> 订阅事件/ <code>unsubscribe</code> 取消订阅</li></ol> 
<pre><code class="prism language-js"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> onMounted<span class="token punctuation">,</span> onUnmounted<span class="token punctuation">,</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> PubSub <span class="token keyword">from</span> <span class="token string">'@/utils/pubsub'</span>

<span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">readmessage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  count<span class="token punctuation">.</span>value <span class="token operator">=</span> count<span class="token punctuation">.</span>value <span class="token operator">-</span> <span class="token number">1</span>
<span class="token punctuation">}</span>
<span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  PubSub<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">'messageread'</span><span class="token punctuation">,</span> readmessage<span class="token punctuation">)</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token function">onUnmounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  PubSub<span class="token punctuation">.</span><span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token string">'messageread'</span><span class="token punctuation">,</span> readmessage<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<ol start="3"><li>使用 <code>publish</code> 发送消息</li></ol> 
<pre><code class="prism language-js"><span class="token keyword">import</span> PubSub <span class="token keyword">from</span> <span class="token string">'@/utils/pubsub'</span>

<span class="token operator">...</span>
PubSub<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token string">'messageread'</span><span class="token punctuation">)</span>
<span class="token operator">...</span>
</code></pre> 
<h4><a id="_subscribe_123"></a>订阅 subscribe</h4> 
<ul><li>获取订阅</li></ul> 
<pre><code class="prism language-js"><span class="token comment">// subscriptions by token from all topics</span>
PubSub<span class="token punctuation">.</span><span class="token function">getSubscriptions</span><span class="token punctuation">(</span><span class="token string">'token'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li>订阅计数</li></ul> 
<pre><code class="prism language-js"><span class="token comment">// count by token from all topics</span>
PubSub<span class="token punctuation">.</span><span class="token function">countSubscriptions</span><span class="token punctuation">(</span><span class="token string">'token'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="_unsubscribe_139"></a>取消/清除订阅 unsubscribe</h4> 
<p><strong>订阅之后，一定要取消订阅。</strong></p> 
<ul><li>取消特定订阅</li></ul> 
<pre><code class="prism language-js"><span class="token comment">// create a function to receive the topic</span>
<span class="token keyword">var</span> <span class="token function-variable function">mySubscriber</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">msg<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// add the function to the list of subscribers to a particular topic</span>
<span class="token comment">// we're keeping the returned token, in order to be able to unsubscribe</span>
<span class="token comment">// from the topic later on</span>
<span class="token keyword">var</span> token <span class="token operator">=</span> PubSub<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">'MY TOPIC'</span><span class="token punctuation">,</span> mySubscriber<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// unsubscribe this subscriber from this topic</span>
PubSub<span class="token punctuation">.</span><span class="token function">unsubscribe</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li>取消某个函数的所有订阅</li></ul> 
<pre><code class="prism language-js"><span class="token comment">// create a function to receive the topic</span>
<span class="token keyword">var</span> <span class="token function-variable function">mySubscriber</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">msg<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// unsubscribe mySubscriber from ALL topics</span>
PubSub<span class="token punctuation">.</span><span class="token function">unsubscribe</span><span class="token punctuation">(</span>mySubscriber<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li>清除某个主题的所有订阅</li></ul> 
<pre><code class="prism language-js"><span class="token comment">// no further notifications for 'a.b' and 'a.b.c' topics</span>
<span class="token comment">// notifications for 'a' will still get published</span>
PubSub<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> myFunc1<span class="token punctuation">)</span><span class="token punctuation">;</span>
PubSub<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">'a.b'</span><span class="token punctuation">,</span> myFunc2<span class="token punctuation">)</span><span class="token punctuation">;</span>
PubSub<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">'a.b.c'</span><span class="token punctuation">,</span> myFunc3<span class="token punctuation">)</span><span class="token punctuation">;</span>

PubSub<span class="token punctuation">.</span><span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token string">'a.b'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li>清除所有订阅</li></ul> 
<pre><code class="prism language-js"><span class="token comment">// all subscriptions are removed</span>
PubSub<span class="token punctuation">.</span><span class="token function">clearAllSubscriptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><code>pubsub-js</code> 通过发布/订阅模式实现实现组件间的解耦合，可以减少代码的复杂度和维护成本，使代码设计更人性化。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/21ac0e69845e7f95368ddf502d9e8801/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Yolov8模型训练报错：torch.cuda.OutOfMemoryError</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/70280765e933ba16b8845e7e1d84bfeb/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">HBuilderX使用代码托管功能，安装git插件</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>