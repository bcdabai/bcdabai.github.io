<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>深入学习vue-ssr - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="深入学习vue-ssr" />
<meta property="og:description" content="前面我们讲了如何创建一个最简单的vue-ssr案例，相当于vue-ssr的一个Hello World。参见：从0-1学习vue-ssr
接下来我们开始深入学习一下 vue-ssr…
一、html模板 服务端渲染主要是在服务端这一块，完成页面模板和动态数据的拼接，所以我们需要用到html模板，然后将从数据库查询到的数据动态的和html模板进行拼接，然后发送给客户端浏览器，这一块我们就先完成一个html模板的学习。
1、首先需要创建一个model.html模板文件，不然也是巧妇难为无米之炊
PS: 使用{{}} vue会将动态数据处理为字符串输出，使用{{{}}} vue 将不作处理直接输出
&lt;!DOCTYPE html&gt; &lt;html lang=&#34;en&#34;&gt; &lt;head&gt; &lt;meta charset=&#34;utf-8&#34;&gt; &lt;meta name=&#34;viewport&#34; content=&#34;width=device-width, initial-scale=1.0&#34;&gt; {{{ desc }}} &lt;title&gt;{{ title }}&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;!-- 下面这行注释，就是动态数据替换的地方 --&gt; &lt;!--vue-ssr-outlet--&gt; &lt;/body&gt; &lt;/html&gt; 2、然后将模板文件读入到server.js中
3、在加载 vue-server-renderer 中的 createRenderer 方法的时候，可以传入一个可选参数，这个参数可以用来指定 上面创建的 html文件为 模板文件
4、读入上面创建的html模板文件的前提是，需要加载 fs 模块
5、然后我们在 res.send(html) 发送的这个html就会替换html模板中的占位符 server.js中具体代码：
// 加载 vue const Vue = require(&#39;vue&#39;) // 导入 fs 模块 const fs = require(&#39;fs&#39;) // 加载 vue-server-renderer 中的 createRenderer 方法 // 这里可以传入可选的参数，用来导入外部html模板 const renderer = require(&#39;vue-server-renderer&#39;)." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/6f56437b177d9a011acae1ff85d75ccb/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-06-20T00:52:54+08:00" />
<meta property="article:modified_time" content="2021-06-20T00:52:54+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">深入学习vue-ssr</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>前面我们讲了如何创建一个最简单的vue-ssr案例，相当于vue-ssr的一个Hello World。参见：<a href="https://blog.csdn.net/gongye2019/article/details/118060439?spm=1001.2014.3001.5502">从0-1学习vue-ssr</a></p> 
<p>接下来我们开始深入学习一下 vue-ssr…</p> 
<h3><a id="html_4"></a>一、html模板</h3> 
<p>服务端渲染主要是在服务端这一块，完成页面模板和动态数据的拼接，所以我们需要用到html模板，然后将从数据库查询到的数据动态的和html模板进行拼接，然后发送给客户端浏览器，这一块我们就先完成一个html模板的学习。</p> 
<p>1、首先需要创建一个model.html模板文件，不然也是巧妇难为无米之炊</p> 
<p>PS: 使用{<!-- -->{}} vue会将动态数据处理为字符串输出，使用{<!-- -->{<!-- -->{}}} vue 将不作处理直接输出</p> 
<pre><code class="prism language-js"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token constant">DOCTYPE</span> html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html lang<span class="token operator">=</span><span class="token string">"en"</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>meta name<span class="token operator">=</span><span class="token string">"viewport"</span> content<span class="token operator">=</span><span class="token string">"width=device-width, initial-scale=1.0"</span><span class="token operator">&gt;</span>
	<span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span> desc <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
	<span class="token operator">&lt;</span>title<span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span> title <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 下面这行注释，就是动态数据替换的地方 <span class="token operator">--</span><span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>vue<span class="token operator">-</span>ssr<span class="token operator">-</span>outlet<span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span>
</code></pre> 
<p>2、然后将模板文件读入到server.js中</p> 
<p>3、在加载 vue-server-renderer 中的 createRenderer 方法的时候，可以传入一个可选参数，这个参数可以用来指定 上面创建的 html文件为 模板文件</p> 
<p>4、读入上面创建的html模板文件的前提是，需要加载 fs 模块</p> 
<p>5、然后我们在 res.send(html) 发送的这个html就会替换html模板中的占位符 
 </p> 
<p>server.js中具体代码：</p> 
<pre><code class="prism language-js"><span class="token comment">// 加载 vue</span>
<span class="token keyword">const</span> Vue <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'vue'</span><span class="token punctuation">)</span>
<span class="token comment">// 导入 fs 模块</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token comment">// 加载 vue-server-renderer 中的 createRenderer 方法</span>
<span class="token comment">// 这里可以传入可选的参数，用来导入外部html模板</span>
<span class="token keyword">const</span> renderer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'vue-server-renderer'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">createRenderer</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
	<span class="token comment">// fs 模块读取得到的 buffer 二进制流，需要转换为字符串</span>
	template<span class="token punctuation">:</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'./model.html'</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 创建 Vue 实例</span>
<span class="token comment">// 将 express 加载进来</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token comment">// 创建一个 server 实例</span>
<span class="token keyword">const</span> server <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 在请求根路径的时候，我们将渲染好的 vue-ssr 发送给客户端浏览器</span>
server<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
		template<span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`
			&lt;div id='app'&gt;
				&lt;h1&gt;{<!-- -->{ message }}&lt;/h1&gt;
			&lt;/div&gt;
		`</span></span><span class="token punctuation">,</span>
		data<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
			message<span class="token punctuation">:</span> <span class="token string">'hello vue-ssr'</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	renderer<span class="token punctuation">.</span><span class="token function">renderToString</span><span class="token punctuation">(</span>app<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 定义html模板中需要使用的数据</span>
		title<span class="token punctuation">:</span> <span class="token string">'spades-vue-ssr'</span><span class="token punctuation">,</span>
		desc<span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`&lt;meta name="description" content="这是一个服务端渲染案例"&gt;`</span></span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> html<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// 如果没有错误，我们这里就得到了渲染的Vue实例的字符串形式</span>
        <span class="token comment">// 发送渲染好的内容前，设置响应头当中的 Content-Type， 解决乱码问题</span>
        <span class="token comment">// res.setHeader('Content-Type', 'text/html; charset=utf8')</span>
		res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 开启端口监听</span>
server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'server running at port 3000.'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p>重新运行 <code>nodemon server.js</code> 可以看到页面上正确显示了 hello vue-ssr</p> 
<h3><a id="_90"></a>二、构建配置</h3> 
<p>接下来就是最重要的部分，服务端渲染好了然后发送给客户端，可是这个时候客户端浏览器渲染的内容都是静态的，没有点击事件，没有数据监听，没有任何的交互功能。所以，我们需要一个入口，让客户端js来实现交互能力，来看一下vue-ssr官网给出的一个介绍：（下面这张图片）</p> 
<p><img src="https://images2.imgbox.com/ec/e0/wpaCI6vH_o.png" alt="架构"></p> 
<p>分析这张图，大体想要说明的意思就是：在服务端有一个入口即Server entry，通过 Webpack build 打包为 Server Bundle，进行服务端渲染；在客户端有一个入口即 Client entry，通过 Webpack build 打包为 Client Bundle，进行客户端渲染，也就是通过一系列操作，将html静态内容激活为具有交互能力的动态页面。</p> 
<p>接下来就是要学习如何进行这一系列的操作，将页面赋予动态交互的能力…</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c106a01ccfb21c561117abda7b2edbad/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【雷达信号处理】---雷达分辨率</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4ebe79f19858e4b02583a38aafbe89e3/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">台式计算机无信号,台式机显示器没信号，不用大神自己就能解决</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>