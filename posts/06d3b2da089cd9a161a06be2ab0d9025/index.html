<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>DHCP服务与配置 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="DHCP服务与配置" />
<meta property="og:description" content="目录
一.DHCP服务
1.1什么是DHCP
1.2DHCP的好处
1.3DHCP分配方式
二.DHCP工作原理
2.1DHCP租约过程
2.2DHCP更新租约
2.3重新登录
三.DHCP配置
3.1DHCP服务安装
3.2DHCP全局配置
ensp配置
引言：在网络地址配置中，当主机比较多的时候，为每台机器配置静态IP时，工作量过于庞大，这个时候我们就需要设置一个动态的获取IP地址方式，也就是今天所说的DHCP。
一.DHCP服务 1.1什么是DHCP DHCP动态主机配置协议：是专门为TCP/IP网络中计算机自动分配TCP/IP参数的协议
DHCP采用C/S架构，C-client（客户机），S-server（服务器）
DHCP服务采用传输层UDP协议，因为是C/S架构，所以客户机端口号是67，服务器端口号是68
1.2DHCP的好处 使用动态主机配置协议。可以减少网络管理员的工作量；避免手动配置时的错位配置；避免IP地址冲突；当更改IP网段时，不需要重新分配每个用户的IP地址；可以提高IP地址使用率；方便客户端的配置。
优点：
减少管理员的工作量
避免输入错误的可能
避免IP地址冲突
当更改IP地址段时，不需要重新配置每个用户的IP地址
提高了IP地址的利用率
方便客户端的配置
1.3DHCP分配方式 1.自动分配：分配一个IP地址后永久使用
2.手动分配：由网络管理员指定IP地址
3.动态分配：使用完后释放该IP，供其它客户机使用
二.DHCP工作原理 2.1DHCP租约过程 DHCP客户端向DHCP服务端请求IP地址的过程，我们称为租约过程
（1）客户机请求IP地址，当一个DHCP客户机启动时，客户机还没有IP地址，所以客户机要通过DHCP获取一个合法IP地址，此时DHCP客户机就会以广播方式发送DHCP Discover发现信息来寻找DHCP服务器
（2）服务器响应当DHCP服务器接收到来自客户机请求IP地址信息时，它就在自己的IP地址池中，查找是否有合法的IP地址提供给客户机，如果有DHCP服务器就将此IP地址做上记号，加入到DHCP offer的消息中，然后DHCP就广播一则DHCP offer消息
（3）客户机选择IP地址，DHCP客户机从接收到的第一个DHCP offer消息中提取IP地址，发出IP的DHCP服务器将该地址保留,这样该地址就不能再分配给另一个DHCP用户，之后DHCP客户机会向服务器发送DHCP Request消息
（4）服务器确定租约DHCP服务器接收到DHCP Request消息后，以DHCP ACK消息的形式向客户机广播成功确认，该消息包含有IP地址的有效租约和其他可配置的信息，当客户机收到DHCP ACK消息时，它就配置 了IP地址，完成TCP/IP的初始化
2.2DHCP更新租约
当DHCP服务器向客户机出租的IP地址租期达到50%时，就需要更新租约； 客户机直接向提供租约的服务器发送DHCP Request包，要求更新现有的地址租约。
2.2DHCP更新租约 当DHCP服务器向客户机出租的IP地址租期达到50%时，就需要更新租约； 客户机直接向提供租约的服务器发送DHCP Request包，要求更新现有的地址租约。
2.3重新登录 DHCP客户机每次重新登录网络时，不需要再发送DHCP Discover信息,而是直接发送包含前一次所分配的IP地址的DHCP Request请求信息。如果次IP地址未被使用，则DHCP服务端发送DHCP ACK确认信息，让客户机继续使用该IP。
若该IP地址被其它客户机使用，DHCP服务端会发送DHCP Nack否认信息。让客户机重新发送DHCP Discover请求，进行新的租约请求。
三.DHCP配置 3.1DHCP服务安装 Linux系统默认是没有DHCP服务的，需要我们自行进行安装
安装DHCP服务：
1.检查并安装dhcp服务" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/06d3b2da089cd9a161a06be2ab0d9025/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-07-20T13:59:59+08:00" />
<meta property="article:modified_time" content="2022-07-20T13:59:59+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">DHCP服务与配置</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p></p> 
<p id="main-toc"><strong>目录</strong></p> 
<p id="%E4%B8%80.DHCP%E6%9C%8D%E5%8A%A1-toc" style="margin-left:0px;"><a href="#%E4%B8%80.DHCP%E6%9C%8D%E5%8A%A1" rel="nofollow">一.DHCP服务</a></p> 
<p id="1.1%E4%BB%80%E4%B9%88%E6%98%AFDHCP-toc" style="margin-left:80px;"><a href="#1.1%E4%BB%80%E4%B9%88%E6%98%AFDHCP" rel="nofollow">1.1什么是DHCP</a></p> 
<p id="1.2DHCP%E7%9A%84%E5%A5%BD%E5%A4%84-toc" style="margin-left:80px;"><a href="#1.2DHCP%E7%9A%84%E5%A5%BD%E5%A4%84" rel="nofollow">1.2DHCP的好处</a></p> 
<p id="1.3DHCP%E5%88%86%E9%85%8D%E6%96%B9%E5%BC%8F-toc" style="margin-left:80px;"><a href="#1.3DHCP%E5%88%86%E9%85%8D%E6%96%B9%E5%BC%8F" rel="nofollow">1.3DHCP分配方式</a></p> 
<p id="%E4%BA%8C.DHCP%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86-toc" style="margin-left:0px;"><a href="#%E4%BA%8C.DHCP%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86" rel="nofollow">二.DHCP工作原理</a></p> 
<p id="2.1DHCP%E7%A7%9F%E7%BA%A6%E8%BF%87%E7%A8%8B-toc" style="margin-left:80px;"><a href="#2.1DHCP%E7%A7%9F%E7%BA%A6%E8%BF%87%E7%A8%8B" rel="nofollow">2.1DHCP租约过程</a></p> 
<p id="2.2DHCP%E6%9B%B4%E6%96%B0%E7%A7%9F%E7%BA%A6-toc" style="margin-left:80px;"><a href="#2.2DHCP%E6%9B%B4%E6%96%B0%E7%A7%9F%E7%BA%A6" rel="nofollow">2.2DHCP更新租约</a></p> 
<p id="2.3%E9%87%8D%E6%96%B0%E7%99%BB%E5%BD%95-toc" style="margin-left:80px;"><a href="#2.3%E9%87%8D%E6%96%B0%E7%99%BB%E5%BD%95" rel="nofollow">2.3重新登录</a></p> 
<p id="%E4%B8%89.DHCP%E9%85%8D%E7%BD%AE-toc" style="margin-left:0px;"><a href="#%E4%B8%89.DHCP%E9%85%8D%E7%BD%AE" rel="nofollow">三.DHCP配置</a></p> 
<p id="3.1DHCP%E6%9C%8D%E5%8A%A1%E5%AE%89%E8%A3%85-toc" style="margin-left:80px;"><a href="#3.1DHCP%E6%9C%8D%E5%8A%A1%E5%AE%89%E8%A3%85" rel="nofollow">3.1DHCP服务安装</a></p> 
<p id="3.2DHCP%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE-toc" style="margin-left:80px;"><a href="#3.2DHCP%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE" rel="nofollow">3.2DHCP全局配置</a></p> 
<p id="%C2%A0ensp%E9%85%8D%E7%BD%AE-toc" style="margin-left:80px;"><a href="#%C2%A0ensp%E9%85%8D%E7%BD%AE" rel="nofollow"> ensp配置</a></p> 
<hr id="hr-toc"> 
<p></p> 
<p>引言：在网络地址配置中，当主机比较多的时候，为每台机器配置静态IP时，工作量过于庞大，这个时候我们就需要设置一个动态的获取IP地址方式，也就是今天所说的DHCP。</p> 
<h2 id="%E4%B8%80.DHCP%E6%9C%8D%E5%8A%A1">一.DHCP服务</h2> 
<h4 id="1.1%E4%BB%80%E4%B9%88%E6%98%AFDHCP">1.1什么是DHCP</h4> 
<p>DHCP动态主机配置协议：是专门为TCP/IP网络中计算机自动分配TCP/IP参数的协议<br> DHCP采用C/S架构，C-client（客户机），S-server（服务器）<br> DHCP服务采用传输层UDP协议，因为是C/S架构，所以客户机端口号是67，服务器端口号是68</p> 
<h4 id="1.2DHCP%E7%9A%84%E5%A5%BD%E5%A4%84">1.2DHCP的好处</h4> 
<p>使用动态主机配置协议。可以减少网络管理员的工作量；避免手动配置时的错位配置；避免IP地址冲突；当更改IP网段时，不需要重新分配每个用户的IP地址；可以提高IP地址使用率；方便客户端的配置。</p> 
<p>优点：</p> 
<p>减少管理员的工作量<br> 避免输入错误的可能<br> 避免IP地址冲突<br> 当更改IP地址段时，不需要重新配置每个用户的IP地址<br> 提高了IP地址的利用率<br> 方便客户端的配置</p> 
<h4 id="1.3DHCP%E5%88%86%E9%85%8D%E6%96%B9%E5%BC%8F">1.3DHCP分配方式</h4> 
<p>1.自动分配：分配一个IP地址后永久使用<br> 2.手动分配：由网络管理员指定IP地址<br> 3.动态分配：使用完后释放该IP，供其它客户机使用</p> 
<h2 id="%E4%BA%8C.DHCP%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86">二.DHCP工作原理</h2> 
<h4 id="2.1DHCP%E7%A7%9F%E7%BA%A6%E8%BF%87%E7%A8%8B">2.1DHCP租约过程</h4> 
<p>DHCP客户端向DHCP服务端请求IP地址的过程，我们称为租约过程</p> 
<p><img alt="" height="308" src="https://images2.imgbox.com/26/3d/IZorPpP9_o.png" width="689"></p> 
<p></p> 
<p>        （1）客户机请求IP地址，当一个DHCP客户机启动时，客户机还没有IP地址，所以客户机要通过DHCP获取一个合法IP地址，此时DHCP客户机就会以广播方式发送DHCP Discover发现信息来寻找DHCP服务器</p> 
<p>        （2）服务器响应当DHCP服务器接收到来自客户机请求IP地址信息时，它就在自己的IP地址池中，查找是否有合法的IP地址提供给客户机，如果有DHCP服务器就将此IP地址做上记号，加入到DHCP offer的消息中，然后DHCP就广播一则DHCP offer消息</p> 
<p>        （3）客户机选择IP地址，DHCP客户机从接收到的第一个DHCP offer消息中提取IP地址，发出IP的DHCP服务器将该地址保留,这样该地址就不能再分配给另一个DHCP用户，之后DHCP客户机会向服务器发送DHCP Request消息</p> 
<p>        （4）服务器确定租约DHCP服务器接收到DHCP Request消息后，以DHCP ACK消息的形式向客户机广播成功确认，该消息包含有IP地址的有效租约和其他可配置的信息，当客户机收到DHCP ACK消息时，它就配置 了IP地址，完成TCP/IP的初始化<br> 2.2DHCP更新租约<br> 当DHCP服务器向客户机出租的IP地址租期达到50%时，就需要更新租约； 客户机直接向提供租约的服务器发送DHCP Request包，要求更新现有的地址租约。</p> 
<h4 id="2.2DHCP%E6%9B%B4%E6%96%B0%E7%A7%9F%E7%BA%A6">2.2DHCP更新租约</h4> 
<p>当DHCP服务器向客户机出租的IP地址租期达到50%时，就需要更新租约； 客户机直接向提供租约的服务器发送DHCP Request包，要求更新现有的地址租约。</p> 
<h4 id="2.3%E9%87%8D%E6%96%B0%E7%99%BB%E5%BD%95">2.3重新登录</h4> 
<p>DHCP客户机每次重新登录网络时，不需要再发送DHCP Discover信息,而是直接发送包含前一次所分配的IP地址的DHCP Request请求信息。如果次IP地址未被使用，则DHCP服务端发送DHCP ACK确认信息，让客户机继续使用该IP。<br> 若该IP地址被其它客户机使用，DHCP服务端会发送DHCP Nack否认信息。让客户机重新发送DHCP Discover请求，进行新的租约请求。<br>  </p> 
<h2 id="%E4%B8%89.DHCP%E9%85%8D%E7%BD%AE">三.DHCP配置</h2> 
<h4 id="3.1DHCP%E6%9C%8D%E5%8A%A1%E5%AE%89%E8%A3%85"><a name="t10"></a><a id="31DHCP_32"></a>3.1DHCP服务安装</h4> 
<p>Linux系统默认是没有DHCP服务的，需要我们自行进行安装<br> 安装DHCP服务：<br> 1.检查并安装dhcp服务</p> 
<p><img alt="" height="408" src="https://images2.imgbox.com/6e/05/vpWizhud_o.png" width="1061"></p> 
<p>2.配置dhcp配置文件</p> 
<p><img alt="" height="208" src="https://images2.imgbox.com/4b/e6/KSHJyQIP_o.png" width="599"></p> 
<p></p> 
<h4 id="3.2DHCP%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE">3.2DHCP全局配置</h4> 
<p>vim /etc/dhcp/dhcpd.conf 编辑配置文件</p> 
<p><img alt="" height="134" src="https://images2.imgbox.com/ce/71/ooCEB2Nb_o.png" width="675"></p> 
<p>  这里面是空文件，但是会有一行注释，意思就是在/usr/share/doc/dhcp*/dhcpd.conf.example下有一个模板，可以复制模板来写配置</p> 
<p>我们直接复制模板覆盖到dhcpd.conf文件</p> 
<p>cp /usr/share/doc/dhcp*/dhcpd.conf.example /etc/dhcp/dhcpd.conf</p> 
<p>查看文件是否覆盖过来</p> 
<p>cat /etc/dhcp/dhcpd.conf</p> 
<p><img alt="" height="862" src="https://images2.imgbox.com/ee/9c/t9RoWvbE_o.png" width="1111"></p> 
<p></p> 
<h4 id="%C2%A0ensp%E9%85%8D%E7%BD%AE"> ensp配置</h4> 
<p><img alt="" height="801" src="https://images2.imgbox.com/63/97/WiRQaVOb_o.png" width="1187"></p> 
<p></p> 
<p>二层交换机</p> 
<p>vlan batch 10 20 100 #创建vlan10 20 100<br> int e0/0/2 #进入e2接口<br> p l a #设置接口模式<br> p d v 10 #把接口加入vlan10<br> int e0/0/3 #进入接口<br> p l a #设置接口模式<br> p d v 20 #把接口加入vlan20<br> int e0/0/4 #进入接口<br> p l a #设置接口模式<br> p d v 100 #把接口加入vlan100<br> int e0/0/5 #进入接口<br> p l a #设置接口模式<br> p d v 100 #把接口加入vlan100<br> int e0/0/1 #进入接口<br> p l t #设置接口模式<br> p t a v a #把所有vlan加入接口</p> 
<p>三层交换机</p> 
<p>vlan batch 10 20 100 #创建vlan10 20 100</p> 
<p>nt Vlanif 10 #进入虚拟接口10</p> 
<p>ip address 192.168.1.1 24 #设置IP地址</p> 
<p>nt Vlanif 20 #进入虚拟接口20</p> 
<p>ip address 192.168.2.1 24 #设置ip地址</p> 
<p>int vlanif 100 #进入虚拟接口100</p> 
<p>ip address 192.168.21.2 24 #设置ip地址</p> 
<p>int g0/0/1 #进入接口</p> 
<p>p l t #设置接口模式</p> 
<p>p t a v a #把所有vlan加入接口</p> 
<p>dhcp enable #dhcp开启</p> 
<p>int Vlanif 10 #进入虚拟接口10</p> 
<p>dhcp select relay #基于DHCP中继</p> 
<p>dhcp relay server-ip 192.168.100.100 #去192.168.21.100请求DHCP服务</p> 
<p>同理</p> 
<p>int Vlanif 20 #进入虚拟接口20</p> 
<p>dhcp select relay #基于DHCP中继</p> 
<p>dhcp relay server-ip 192.168.100.100 #去192.168.21.100请求DHCP服务</p> 
<p>int Vlanif 100 #进入虚拟接口100</p> 
<p>dhcp select relay #基于DHCP中继</p> 
<p>dhcp relay server-ip 192.168.100.100 #去192.168.21.100请求DHCP服务<br>  </p> 
<p id="%E8%AE%BE%E7%BD%AE%E6%9C%8D%E5%8A%A1%E5%99%A8">设置服务器</p> 
<p><img alt="" height="953" src="https://images2.imgbox.com/e8/bb/gtpkwecs_o.png" width="1200"></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p> 设置成仅主机模式  更改网卡配置</p> 
<p><img alt="" height="1002" src="https://images2.imgbox.com/dc/d9/6LzavdgW_o.png" width="1029"></p> 
<p></p> 
<p>  查看虚拟网络编辑器  ，查看NET1的子网IP</p> 
<p><img alt="" height="786" src="https://images2.imgbox.com/f9/b1/NZUvQMM8_o.png" width="917"></p> 
<p> </p> 
<p>编辑网卡</p> 
<p></p> 
<p> <img alt="" height="882" src="https://images2.imgbox.com/c8/47/SKuWKLXK_o.png" width="719"></p> 
<p></p> 
<p>网卡配置</p> 
<p><img alt="" height="621" src="https://images2.imgbox.com/53/89/tXaj6qFs_o.png" width="893"></p> 
<p></p> 
<p id="%C2%A0%E9%85%8D%E7%BD%AEhttp%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">配置http配置文件</p> 
<p>cd/etc/dhcp</p> 
<p><img alt="" height="39" src="https://images2.imgbox.com/35/8b/vPgYr6RV_o.png" width="978"></p> 
<p> </p> 
<p> vim dhcpd.conf </p> 
<p><img alt="" height="549" src="https://images2.imgbox.com/6f/05/gAwwR0MO_o.png" width="840"></p> 
<p> 保存退出</p> 
<p>systemctl start dhcpd 开启</p> 
<p>测试</p> 
<p>pc选择DHCP</p> 
<p><img alt="" height="699" src="https://images2.imgbox.com/e2/21/Vk9vJTFw_o.png" width="1061"></p> 
<p> 然后进入命令行 输入ipconfig 获取到ip地址 </p> 
<p><img alt="" height="643" src="https://images2.imgbox.com/b7/89/HyqPoHSZ_o.png" width="829"></p> 
<p> <img alt="" height="458" src="https://images2.imgbox.com/40/31/k6ZzhLMx_o.png" width="873"></p> 
<p> <img alt="" height="595" src="https://images2.imgbox.com/01/88/4EhNTeAo_o.png" width="817"></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/bd3d44e69faa6984dc4608d22281b435/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【vue】el-form-item添加icon和tooltip</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/27748d04ac4e5f1c4df6a79bd9b2995c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">报错：Cannot interpret ‘＜attribute ‘dtype‘ of ‘numpy.generic‘ objects＞‘ as a data</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>