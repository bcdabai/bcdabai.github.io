<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>机器学习大作业——基于DEAP数据集的脑电信号识别（DNN&#43;CNN） - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="机器学习大作业——基于DEAP数据集的脑电信号识别（DNN&#43;CNN）" />
<meta property="og:description" content="目录
一、实验目的
二、实验原理介绍
2.1 数据集描述
2.2深度神经网络
2.2.1 关于DNN
2.2.2 网络模型代码实现
2.3 卷积神经网络
2.3.1 关于CNN
2.3.2 网络模型代码实现
三、模型训练与测试
3.1数据预处理
3.2 模型训练与测试
3.2.1训练前期准备
3.2.2训练模型的过程
四、实验结果与分析
4.1二元价态分类结果
五、实验总结
附录：实验代码
prepare_deap.py
reduce_dim.py
datasets.py
models.py
train.py
train.py
train_util.py
一、实验目的 1.1了解DEAP数据集的格式
1.2 熟悉深度深度神经网络DNN和卷积神经网络CNN
1.3 通过统计实验对获得的模型进行测试，以比较不同的模型
二、实验原理介绍 本部分首先将介绍本次实验采用的DEAP数据集，另外由于本次实验采用了两种不同的神经网络架构：具有完全连接层的深度神经网络（DNN）和卷积神经网络（CNN），只做了一些小的修改，本部分也将详细解释该模型的基本框架及这些模型中的训练技术。
2.1 数据集描述 本次实验采用的是DEAP数据集。DEAP是2014年发布的一个用于情绪分析的数据集。它是情感计算领域最大的公开数据集之一，还包含各种不同的生理和视频信号。
DEAP数据集由两部分组成：
（1）一个由120个一分钟音乐视频组成的数据库，每一个视频由14-16名志愿者根据效价、唤醒度和主导度进行评分。
（2）40个以上音乐视频的子集，每个视频具有32个参与者中每个参与者的相应EEG和生理信号。与第一部分一样，每个视频都是根据效价、唤醒和支配维度进行评分的。
由于完成时间有限，本次实验只使用了DEAP数据集的第二部分，其中包含EEG信号。
脑电信号是使用Biosemi ActiveTwo设备收集的，该设备记录了32个具有可配置采样率的脑电通道。
DEAP是在512Hz下收集的，但数据集的创建者也提供了EEG信号的预处理版本，下采样到128Hz，并应用了频率滤波器和其他有用的预处理步骤。
特别地，对于32个参与者中的每一个，存在以下预处理的信息：
•数据：一个40 x 40 x 8064的阵列，包含40个频道中每个频道和40个音乐视频中每个频道的8064个录音。每个视频每个频道有8064个录音，因为试验时间为63秒（3秒预审基线&#43;60秒试验），采样率为128Hz（63 x 128=8064）。
•标签：一个40 x 4的数组，包含40个音乐视频中每个视频的效价、唤醒、支配和链接的注释。
下面展示的是准备DEAP数据集相关的部分代码。
2.2深度神经网络 2.2.1 关于DNN DNN神经网络是一个具有3个隐藏层的深度神经网络。该体系结构的近似图形方案如图2所示，而每一层的确切细节如下图所示。
上图所描绘的神经元的数量仅用于表示，每层下方都报告了神经元的真实数量。表1展示的是深度神经网络架构，表2中报告了对于DEAP数据集用于训练的超参数、优化器和损失函数。
表1:深度神经网络架构" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/20de673bf817ee70dafcd6deb445b78e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-22T11:05:33+08:00" />
<meta property="article:modified_time" content="2024-01-22T11:05:33+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">机器学习大作业——基于DEAP数据集的脑电信号识别（DNN&#43;CNN）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div> 
 <p id="main-toc"><strong>目录</strong></p> 
 <p id="%E4%B8%80%E3%80%81%E5%AE%9E%E9%AA%8C%E7%9B%AE%E7%9A%84-toc" style="margin-left:0px;"><a href="#%E4%B8%80%E3%80%81%E5%AE%9E%E9%AA%8C%E7%9B%AE%E7%9A%84" rel="nofollow">一、实验目的</a></p> 
 <p id="%E4%BA%8C%E3%80%81%E5%AE%9E%E9%AA%8C%E5%8E%9F%E7%90%86%E4%BB%8B%E7%BB%8D-toc" style="margin-left:0px;"><a href="#%E4%BA%8C%E3%80%81%E5%AE%9E%E9%AA%8C%E5%8E%9F%E7%90%86%E4%BB%8B%E7%BB%8D" rel="nofollow">二、实验原理介绍</a></p> 
 <p id="2.1%20%E6%95%B0%E6%8D%AE%E9%9B%86%E6%8F%8F%E8%BF%B0-toc" style="margin-left:40px;"><a href="#2.1%20%E6%95%B0%E6%8D%AE%E9%9B%86%E6%8F%8F%E8%BF%B0" rel="nofollow">2.1 数据集描述</a></p> 
 <p id="2.2%E6%B7%B1%E5%BA%A6%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C-toc" style="margin-left:40px;"><a href="#2.2%E6%B7%B1%E5%BA%A6%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C" rel="nofollow">2.2深度神经网络</a></p> 
 <p id="2.2.1%20%E5%85%B3%E4%BA%8EDNN-toc" style="margin-left:80px;"><a href="#2.2.1%20%E5%85%B3%E4%BA%8EDNN" rel="nofollow">2.2.1 关于DNN</a></p> 
 <p id="2.2.2%20%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0-toc" style="margin-left:80px;"><a href="#2.2.2%20%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0" rel="nofollow">2.2.2 网络模型代码实现</a></p> 
 <p id="2.3%20%E5%8D%B7%E7%A7%AF%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C-toc" style="margin-left:40px;"><a href="#2.3%20%E5%8D%B7%E7%A7%AF%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C" rel="nofollow">2.3 卷积神经网络</a></p> 
 <p id="2.3.1%20%E5%85%B3%E4%BA%8ECNN-toc" style="margin-left:80px;"><a href="#2.3.1%20%E5%85%B3%E4%BA%8ECNN" rel="nofollow">2.3.1 关于CNN</a></p> 
 <p id="2.3.2%20%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0-toc" style="margin-left:80px;"><a href="#2.3.2%20%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0" rel="nofollow">2.3.2 网络模型代码实现</a></p> 
 <p id="%E4%B8%89%E3%80%81%E6%A8%A1%E5%9E%8B%E8%AE%AD%E7%BB%83%E4%B8%8E%E6%B5%8B%E8%AF%95-toc" style="margin-left:0px;"><a href="#%E4%B8%89%E3%80%81%E6%A8%A1%E5%9E%8B%E8%AE%AD%E7%BB%83%E4%B8%8E%E6%B5%8B%E8%AF%95" rel="nofollow">三、模型训练与测试</a></p> 
 <p id="3.1%E6%95%B0%E6%8D%AE%E9%A2%84%E5%A4%84%E7%90%86-toc" style="margin-left:40px;"><a href="#3.1%E6%95%B0%E6%8D%AE%E9%A2%84%E5%A4%84%E7%90%86" rel="nofollow">3.1数据预处理</a></p> 
 <p id="3.2%20%E6%A8%A1%E5%9E%8B%E8%AE%AD%E7%BB%83%E4%B8%8E%E6%B5%8B%E8%AF%95-toc" style="margin-left:40px;"><a href="#3.2%20%E6%A8%A1%E5%9E%8B%E8%AE%AD%E7%BB%83%E4%B8%8E%E6%B5%8B%E8%AF%95" rel="nofollow">3.2 模型训练与测试</a></p> 
 <p id="3.2.1%E8%AE%AD%E7%BB%83%E5%89%8D%E6%9C%9F%E5%87%86%E5%A4%87-toc" style="margin-left:80px;"><a href="#3.2.1%E8%AE%AD%E7%BB%83%E5%89%8D%E6%9C%9F%E5%87%86%E5%A4%87" rel="nofollow">3.2.1训练前期准备</a></p> 
 <p id="3.2.2%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B%E7%9A%84%E8%BF%87%E7%A8%8B-toc" style="margin-left:80px;"><a href="#3.2.2%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B%E7%9A%84%E8%BF%87%E7%A8%8B" rel="nofollow">3.2.2训练模型的过程</a></p> 
 <p id="%E5%9B%9B%E3%80%81%E5%AE%9E%E9%AA%8C%E7%BB%93%E6%9E%9C%E4%B8%8E%E5%88%86%E6%9E%90-toc" style="margin-left:0px;"><a href="#%E5%9B%9B%E3%80%81%E5%AE%9E%E9%AA%8C%E7%BB%93%E6%9E%9C%E4%B8%8E%E5%88%86%E6%9E%90" rel="nofollow">四、实验结果与分析</a></p> 
 <p id="4.1%E4%BA%8C%E5%85%83%E4%BB%B7%E6%80%81%E5%88%86%E7%B1%BB%E7%BB%93%E6%9E%9C-toc" style="margin-left:40px;"><a href="#4.1%E4%BA%8C%E5%85%83%E4%BB%B7%E6%80%81%E5%88%86%E7%B1%BB%E7%BB%93%E6%9E%9C" rel="nofollow">4.1二元价态分类结果</a></p> 
 <p id="%E4%BA%94%E3%80%81%E5%AE%9E%E9%AA%8C%E6%80%BB%E7%BB%93-toc" style="margin-left:0px;"><a href="#%E4%BA%94%E3%80%81%E5%AE%9E%E9%AA%8C%E6%80%BB%E7%BB%93" rel="nofollow">五、实验总结</a></p> 
 <p id="%E9%99%84%E5%BD%95%EF%BC%9A%E5%AE%9E%E9%AA%8C%E4%BB%A3%E7%A0%81-toc" style="margin-left:0px;"><a href="#%E9%99%84%E5%BD%95%EF%BC%9A%E5%AE%9E%E9%AA%8C%E4%BB%A3%E7%A0%81" rel="nofollow">附录：实验代码</a></p> 
 <p id="prepare_deap.py-toc" style="margin-left:40px;"><a href="#prepare_deap.py" rel="nofollow">prepare_deap.py</a></p> 
 <p id="reduce_dim.py-toc" style="margin-left:40px;"><a href="#reduce_dim.py" rel="nofollow">reduce_dim.py</a></p> 
 <p id="datasets.py-toc" style="margin-left:40px;"><a href="#datasets.py" rel="nofollow">datasets.py</a></p> 
 <p style="margin-left:40px;"><a href="#models.py" rel="nofollow">models.py</a></p> 
 <p id="train.py-toc" style="margin-left:40px;"><a href="#train.py" rel="nofollow">train.py</a></p> 
 <p id="train.py-toc" style="margin-left:40px;"><a href="#train.py" rel="nofollow">train.py</a></p> 
 <p id="train_util.py-toc" style="margin-left:40px;"><a href="#train_util.py" rel="nofollow">train_util.py</a></p> 
 <hr id="hr-toc"> 
 <p></p> 
</div> 
<h2 id="%E4%B8%80%E3%80%81%E5%AE%9E%E9%AA%8C%E7%9B%AE%E7%9A%84" style="background-color:transparent;">一、实验目的</h2> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">1.1了解DEAP数据集的格式</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">1.2 熟悉深度深度神经网络DNN和卷积神经网络CNN</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">1.3 通过统计实验对获得的模型进行测试，以比较不同的模型</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h2 id="%E4%BA%8C%E3%80%81%E5%AE%9E%E9%AA%8C%E5%8E%9F%E7%90%86%E4%BB%8B%E7%BB%8D">二、实验原理介绍</h2> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">本部分首先将介绍本次实验采用的DEAP数据集，另外由于本次实验采用了两种不同的神经网络架构：具有完全连接层的深度神经网络（DNN）和卷积神经网络（CNN），只做了一些小的修改，本部分也将详细解释该模型的基本框架及这些模型中的训练技术。</span></p> 
<h3 id="2.1%20%E6%95%B0%E6%8D%AE%E9%9B%86%E6%8F%8F%E8%BF%B0" style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">2.1 数据集描述</span></h3> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">本次实验采用的是DEAP数据集。DEAP是2014年发布的一个用于情绪分析的数据集。它是情感计算领域最大的公开数据集之一，还包含各种不同的生理和视频信号。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">DEAP数据集由两部分组成：</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">（1）一个由120个一分钟音乐视频组成的数据库，每一个视频由14-16名志愿者根据效价、唤醒度和主导度进行评分。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">（2）40个以上音乐视频的子集，每个视频具有32个参与者中每个参与者的相应EEG和生理信号。与第一部分一样，每个视频都是根据效价、唤醒和支配维度进行评分的。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">由于完成时间有限，本次实验只使用了DEAP数据集的第二部分，其中包含EEG信号。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">脑电信号是使用Biosemi ActiveTwo设备收集的，该设备记录了32个具有可配置采样率的脑电通道。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">DEAP是在512Hz下收集的，但数据集的创建者也提供了EEG信号的预处理版本，下采样到128Hz，并应用了频率滤波器和其他有用的预处理步骤。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">特别地，对于32个参与者中的每一个，存在以下预处理的信息：</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;"> •数据：一个40 x 40 x 8064的阵列，包含40个频道中每个频道和40个音乐视频中每个频道的8064个录音。每个视频每个频道有8064个录音，因为试验时间为63秒（3秒预审基线+60秒试验），采样率为128Hz（63 x 128=8064）。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;"> •标签：一个40 x 4的数组，包含40个音乐视频中每个视频的效价、唤醒、支配和链接的注释。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">下面展示的是准备DEAP数据集相关的部分代码。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="720" src="https://images2.imgbox.com/ed/d7/4153B89o_o.gif" width="1004"></p> 
<h3 id="2.2%E6%B7%B1%E5%BA%A6%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C" style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">2.2深度神经网络</span></h3> 
<h4 id="2.2.1%20%E5%85%B3%E4%BA%8EDNN" style="background-color:transparent;margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">2.2.1 关于DNN</span></h4> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">DNN神经网络是一个具有3个隐藏层的深度神经网络。该体系结构的近似图形方案如图2所示，而每一层的确切细节如下图所示。</span></p> 
<p style="margin-left:.0001pt;text-align:center;"><img alt="" height="720" src="https://images2.imgbox.com/89/e2/Wizu2SZr_o.gif" width="1164"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">上图所描绘的神经元的数量仅用于表示，每层下方都报告了神经元的真实数量。表1展示的是深度神经网络架构，表2中报告了对于DEAP数据集用于训练的超参数、优化器和损失函数。</span></p> 
<p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">表1:深度神经网络架构</span></p> 
<table border="1" cellspacing="0" style="margin-left:4.4pt;width:384pt;"><tbody><tr><td style="border-color:#000000;width:96pt;"> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">Layer type </span></p> </td><td style="width:192pt;"> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">Layer params</span></p> </td><td style="width:96pt;"> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">Output shape</span></p> </td></tr><tr><td> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">Flatten</span></p> </td><td> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">-</span></p> </td><td> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">3168</span></p> </td></tr><tr><td> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">Dropout </span></p> </td><td> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">p=0.25</span></p> </td><td> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">3168</span></p> </td></tr><tr><td> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">Dense </span></p> </td><td> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">in=3168,out=5000</span></p> </td><td> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">5000</span></p> </td></tr><tr><td> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">Dropout  </span></p> </td><td> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">p=0.50</span></p> </td><td> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">5000</span></p> </td></tr><tr><td> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">Dense </span></p> </td><td> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">in=5000,out=500</span></p> </td><td> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">500</span></p> </td></tr><tr><td> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">Dropout  </span></p> </td><td> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">p=0.50</span></p> </td><td> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">500</span></p> </td></tr><tr><td> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">Dense </span></p> </td><td> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">in=500,out=100</span></p> </td><td> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">1000</span></p> </td></tr><tr><td> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">Dropout </span></p> </td><td> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">p=0.50</span></p> </td><td> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">1000</span></p> </td></tr><tr><td> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">Dense </span></p> </td><td> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">in=1000,out=1</span></p> </td><td> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">1</span></p> </td></tr><tr><td colspan="3"> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">Number of parameters=18'847'501</span></p> </td></tr></tbody></table> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">表2:DEAP数据集用于训练的超参数、优化器和损失函数等指标（DNN）</span></p> 
<table border="1" cellspacing="0"><tbody><tr><td style="border-color:#000000;width:213.05pt;"> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">metric</span></p> </td><td style="border-color:#000000;width:213.05pt;"> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">DEAP </span></p> </td></tr><tr><td style="width:213.05pt;"> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">Batch size</span></p> </td><td style="width:213.05pt;"> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">310</span></p> </td></tr><tr><td style="width:213.05pt;"> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">Epochs</span></p> </td><td style="width:213.05pt;"> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">250</span></p> </td></tr><tr><td style="width:213.05pt;"> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">Loss function</span></p> </td><td style="width:213.05pt;"> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">BCE </span></p> </td></tr><tr><td style="width:213.05pt;"> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">Optimizer</span></p> </td><td style="width:213.05pt;"> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">RMSProp </span></p> </td></tr><tr><td style="width:213.05pt;"> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">Learning rate</span></p> </td><td style="width:213.05pt;"> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">0.0001</span></p> </td></tr><tr><td style="width:213.05pt;"> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">Momentum</span></p> </td><td style="width:213.05pt;"> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">0</span></p> </td></tr></tbody></table> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h4 id="2.2.2%20%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0" style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">2.2.2 网络模型代码实现</span></h4> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="471" src="https://images2.imgbox.com/1d/6f/AaMZfoAN_o.gif" width="1200"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">上述设计的是一个简单的深度神经网络（DNN）模型类，继承自 PyTorch 的 Module 类。该模型由几个线性层（全连接层）和一些激活函数、Dropout 层组成。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">模型的主要组件是四个线性层（self.linear1, self.linear2, self.linear3, self.linear4），分别将输入特征映射到不同的维度。其中，self.linear4 是二元分类任务的最后一层，输出一个值，用于区分高价值和低价值情绪状态。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">模型还包括三个 Dropout 层（self.dropout1, self.dropout2），用于随机丢弃部分神经元，以减少过拟合风险。激活函数 ReLU（self.relu）被应用于线性层之后，以增加模型的非线性能力。最后，使用 Flatten 层（self.flatten）将输入张量展平，并通过 forward 方法来定义前向传播过程。在前向传播中，输入首先经过 Flatten 层，然后通过每个线性层、激活函数和 Dropout 层的序列。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">最终，模型返回最后一个线性层的输出张量，用于进行二元分类任务的预测。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h3 id="2.3%20%E5%8D%B7%E7%A7%AF%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C" style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">2.3 卷积神经网络</span></h3> 
<h4 id="2.3.1%20%E5%85%B3%E4%BA%8ECNN" style="background-color:transparent;margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">2.3.1 关于CNN</span></h4> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">卷积神经网络 (CNN) 是一种用于处理图像和声音等网格结构数据的前馈神经网络。它利用卷积运算提取输入数据的特征，使用池化操作来压缩特征图的尺寸。CNN 可以通过改变卷积核的参数来调整特征的维度。在卷积层后通常会应用非线性激活函数，如 ReLU，并可使用批量归一化、Dropout 等技术来提高模型性能。最后一层通常是全连接层，将特征转换为向量表示以进行分类或回归等任务。下图是CNN的架构：</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="537" src="https://images2.imgbox.com/7a/b0/WUZhmXmg_o.gif" width="1200"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;"> CNN模型利用卷积层，将数据视为形状为32 x 99的二维输入。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">简而言之，该模型由两个卷积层组成，然后是最大池化层，最后是两个完全连接的层。卷积层将输入视为2D图像，通过卷积操作应用3x3滤波器。这种类型的层主要用于涉及图像的任务中。最大池化层用于减少数据的空间维度，在图像上滑动一个2x2的窗口，该窗口被减少到一个值：具有最高激活的神经元的值。最大池化减少了图像的空间维度，从而减少了最终完全连接层中所需的参数数量，并有助于网络避免过度拟合。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">与DNN模型一样，CNN权重使用Xavier的正常技术进行初始化，偏差设置为0。表3中中报告了对于DEAP数据集用于训练的超参数、优化器和损失函数等。</span></p> 
<p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">表3:DEAP数据集用于训练的超参数、优化器和损失函数等指标（CNN）</span></p> 
<table border="1" cellspacing="0"><tbody><tr><td style="border-color:#000000;width:213.05pt;"> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">metric</span></p> </td><td style="border-color:#000000;width:213.05pt;"> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">DEAP </span></p> </td></tr><tr><td style="width:213.05pt;"> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">Batch size</span></p> </td><td style="width:213.05pt;"> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">50</span></p> </td></tr><tr><td style="width:213.05pt;"> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">Epochs</span></p> </td><td style="width:213.05pt;"> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">250</span></p> </td></tr><tr><td style="width:213.05pt;"> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">Loss function</span></p> </td><td style="width:213.05pt;"> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">BCE </span></p> </td></tr><tr><td style="width:213.05pt;"> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">Optimizer</span></p> </td><td style="width:213.05pt;"> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">SGD</span></p> </td></tr><tr><td style="width:213.05pt;"> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">Learning rate</span></p> </td><td style="width:213.05pt;"> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">0.0001</span></p> </td></tr><tr><td style="width:213.05pt;"> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">Momentum</span></p> </td><td style="width:213.05pt;"> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">0.9</span></p> </td></tr></tbody></table> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h4 id="2.3.2%20%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0" style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">2.3.2 网络模型代码实现</span></h4> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="720" src="https://images2.imgbox.com/02/28/E0SbiFhY_o.gif" width="1200"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">在代码中我定义了一个名为CNN的类，继承自Module。该类实现了一个简单的卷积神经网络模型。在初始化方法中，首先定义了4个卷积层。其中，self.conv1是一个输入通道数为1，输出通道数为20的卷积层，卷积核大小为3x3，填充为1。self.conv2是一个输入通道数为20，输出通道数为40的卷积层，同样使用3x3的卷积核和1的填充。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">接下来定义了一个最大池化层nn.MaxPool2d，使用2x2的窗口进行池化操作。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">然后定义了两个全连接层self.linear1和self.linear2。self.linear1将输入的特征展平成一维向量，并将其映射到128维向量空间。self.linear2将128维向量映射为1维，用于二分类任务。在网络的前向传播方法forward中，首先对输入数据添加一个维度作为通道维度。然后通过self.dropout0对输入进行随机失活操作。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">接下来通过卷积层self.conv1进行卷积操作，并通过ReLU激活函数进行非线性变换。随后再次应用self.dropout1进行随机失活，然后通过self.conv2进行卷积操作、ReLU激活函数和最大池化操作。之后通过self.flatten将特征图展平成一维向量，并通过self.dropout2进行随机失活。然后通过全连接层self.linear1进行线性变换和ReLU激活函数，并再次应用self.dropout3进行随机失活。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">最后通过self.linear2进行线性变换，得到模型的输出。该模型总体上适用于二分类任务。</span></p> 
<h3 style="margin-left:.0001pt;text-align:justify;"></h3> 
<h2 id="%E4%B8%89%E3%80%81%E6%A8%A1%E5%9E%8B%E8%AE%AD%E7%BB%83%E4%B8%8E%E6%B5%8B%E8%AF%95" style="margin-left:.0001pt;text-align:justify;">三、模型训练与测试</h2> 
<h3 id="3.1%E6%95%B0%E6%8D%AE%E9%A2%84%E5%A4%84%E7%90%86" style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">3.1数据预处理</span></h3> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">在进行模型训练和测试前，对DEAP数据集进行处理。由于本次实验只使用了DEAP数据集中包含EEG信号的第二部分，数据维度已经降低。40个通道已被削减至32个，仅保留EEG信号，每个通道的8064个读数已减少至99个值。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="99" src="https://images2.imgbox.com/2b/ee/6f0auMj2_o.gif" width="1200"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">预处理的具体过程如下：首先，通过循环遍历每位参与者（participant），并加载其数据。对每个参与者的数据进行以下操作： </span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">①从原始数据中提取出32个EEG通道的数据，去除非EEG通道。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="263" src="https://images2.imgbox.com/4f/f1/6ALcNyZt_o.gif" width="1200"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">如图所示，已去除非EEG通道</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">②对通道数据进行全局标准化，即减去全局均值并除以全局标准差。 </span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">③使用reduce_dim函数对数据进行降维处理，将每个通道的数据从n_recordings维降至99维。 </span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">数据降维主要通过函数reduce_dim实现。下面是降维操作主要步骤：</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">·首先，根据输入数据的形状，确定分批处理的大小和总样本数。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">·对每个通道的数据进行以下操作： a. 将8064个记录划分为10个批次（每个批次807个记录，第10个批次为801个记录）。 b. 针对每个批次，计算9个统计值，并将它们存储在处理后的数据中。这些统计值包括：平均值、中位数、最大值、最小值、标准差、方差、范围、偏度和峰度。 c. 对整个通道的数据也计算这9个统计值，并将它们存储在处理后的数据中的最后9个位置。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">·最后，确保处理后的数据形状为(32, 99)，并返回处理后的数据。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="130" src="https://images2.imgbox.com/1f/36/zmYBrw5V_o.gif" width="1200"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">④对降维后的数据进行独立通道标准化，即分别将每个</span><span style="color:#000000;">通道的数据减去该通道的均值并除以该通道的标准差。 </span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">⑤对所有通道的数据进行全局标准化，即减去总体均值并除以总体标准差。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">即使用以下公式，在示例的基础上对这些汇总值进行标准化，得到0的平均值和1的标准偏差：</span></p> 
<p style="margin-left:.0001pt;text-align:center;"><img alt="" height="112" src="https://images2.imgbox.com/d9/a8/6FpQPhxY_o.png" width="978"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">⑥提取情感标签（valence和arousal）。 </span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">关于情感标签：在情感分析中，valence和arousal通常用来描述情感状态的两个主要维度。Valence表示情感的好坏程度，范围通常从负面到正面，例如，沮丧、愤怒、快乐、满足等。Arousal表示情感的强度或活跃程度，范围通常从低到高，例如，冷静、放松、兴奋、惊恐等。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">⑦将处理后的数据和标签保存为.dat文件。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">⑧输出保存成功的信息。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">经过数据预处理后，DEAP数据集的大小为1280，数据集形状为32*99。数据包含32个通道，每个通道有99个记录，而标签包含2个值（效价和唤醒）。 </span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">执行以上数据预处理处理步骤的文件在项目中以prepare deap.py的名称提供。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h3 id="3.2%20%E6%A8%A1%E5%9E%8B%E8%AE%AD%E7%BB%83%E4%B8%8E%E6%B5%8B%E8%AF%95" style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">3.2 模型训练与测试</span></h3> 
<h4 id="3.2.1%E8%AE%AD%E7%BB%83%E5%89%8D%E6%9C%9F%E5%87%86%E5%A4%87" style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">3.2.1训练前期准备</span></h4> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">（1）配置文件读取</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">with open('deap_dnn_arousal.yml') as yaml_file:</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">  config = yaml.load(yaml_file, Loader=yaml.FullLoader)</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">使用 PyYAML 库读取并解析名为 'deap_dnn_arousal.yml' 的配置文件，将配置信息存储在 config 字典中供后续使用。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">配置文件常用于训练一个基于CNN模型的情感分类器来对DEAP数据集中的情感进行分类。其中包括使用dropout技术防止过拟合，设置随机种子，将数据集分为训练集和测试集，设定批量大小、学习率、动量、训练轮数和导出模型的路径等。此处给出配置文件 'deap_dnn_arousal.yml' 内容</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="720" src="https://images2.imgbox.com/3e/08/oa0maeK6_o.gif" width="1200"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">从该配置文件中还可以看出此部分数据集中，训练集与测试集比例为（1180:100）</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">（2）超参数设置</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="230" src="https://images2.imgbox.com/96/c5/pi61CDiw_o.gif" width="1200"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">从配置文件中获取训练相关的超参数，包括训练轮数、批量大小、学习率和动量。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">（3）模型类型选择</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">model_type = config['MODEL']['model']<br> 从配置文件中获取模型的类型，可以是 'dnn' 或 'cnn'。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">（4）训练目标选择</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">classification_of = config['TRAIN']['classification_of']</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">获取训练目标的类型，例如 'arousal' 或 'valence'。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">（5）数据集加载与划分</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">根据DEAP数据集的路径，使用自定义的 DEAP类加载数据集。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="253" src="https://images2.imgbox.com/1e/5a/42trFYtl_o.gif" width="1200"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">获取随机种子和训练集、测试集的划分比例。然后使用 PyTorch 的 random_split 函数将数据集划分为训练集和测试集，并设置相应的随机种子。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">（6）模型初始化</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="330" src="https://images2.imgbox.com/17/26/i7d8kbSx_o.gif" width="1200"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">根据模型类型选择并初始化相应的模型和优化器。如果是 'dnn'，则使用自定义的 DNN 类创建模型，并使用 RMSprop 优化器；如果是 'cnn'，则使用自定义的 CNN 类创建模型，并使用 SGD 优化器。</span></p> 
<p>（7）模型权重初始化</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="287" src="https://images2.imgbox.com/49/38/u85uYmi7_o.gif" width="1200"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">此部分定义了一个函数 init_weights，用于初始化模型的权重。它会遍历模型的所有线性层（Linear）并使用 Xavier 正态分布初始化权重，同时将偏置项（bias）设置为零。</span></p> 
<h4 id="3.2.2%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B%E7%9A%84%E8%BF%87%E7%A8%8B" style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">3.2.2训练模型的过程</span></h4> 
<ol><li>关于train()函数</li></ol> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="567" src="https://images2.imgbox.com/ef/70/1yVMfE9g_o.gif" width="1200"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">这个函数用于训练模型。它接受一个模型、训练集数据加载器、损失函数、优化器等参数，并可选地进行准确率检查和测试集评估。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">在函数内部，首先将模型设置为训练模式，并初始化最佳测试集准确率为 0.0。然后，创建空列表以记录每个 epoch 的平均损失值和准确率。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">接下来，开始循环训练。对于每个 epoch，初始化当前 epoch 的损失列表。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">然后，对于训练集中的每个批次，使用模型进行预测，并根据分类目标选择正确的标签列。计算损失并将其添加到当前 epoch 的损失列表中。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">清零优化器的梯度，进行反向传播和参数更新。在训练过程中，还会打印当前 epoch 和批次的信息。每个 epoch 结束后，计算平均损失值，并将其添加到列表中。如果设置了准确率检查，且达到检查的间隔，则进行训练集和测试集的准确率检查。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">如果测试集的准确率超过了之前的最佳准确率，则保存当前模型。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">循环结束后，输出换行符以美化输出，并根据是否存在最佳准确率来输出最佳的测试集准确率。如果有最佳准确率，则返回该准确率。</span></p> 
<p>2.关于准确率的计算</p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">上部分的准确率计算依据的是函数check_accuracy</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="720" src="https://images2.imgbox.com/fc/c9/ycYXLQSl_o.gif" width="1155"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">该函数用于计算模型在给定数据集上的准确率。它接受一个模型、数据加载器和一些可选参数（如分类目标、样本数量限制），并返回准确率。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">在函数内部，首先初始化正确预测数目为 0，并根据需要设置样本数量限制。然后进入无梯度计算的上下文（torch.no_grad()），将模型设置为评估模式。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">接下来，对于每个数据批次，使用模型进行预测，并将预测结果转换为二进制分类结果。根据分类目标选择正确的标签列，并确保预测结果和标签形状相同。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">通过计算预测结果和标签相等的元素数量，累加得到正确预测的数目。最后，将模型设置回训练模式，并返回准确率。</span></p> 
<p>3.关于测试集的准确度评估</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="536" src="https://images2.imgbox.com/c0/c1/avTWJuSN_o.gif" width="1200"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">在每个 epoch 的训练过程中，当满足 do_check_accuracy 为 True 并且当前 epoch 是检查准确率的间隔（根据 check_accuracy_every 参数指定）时，会执行准确率评估的代码块。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">首先，会对训练集进行准确率评估，并打印出结果。接着，会对测试集进行准确率评估，并打印出结果。最后，会将测试集的准确率添加到 accuracy_per_epoch 列表中，并判断是否超过之前的最佳准确率。如果是，则保存当前模型。因此，测试集的准确率结果会在每个 epoch 的训练过程中输出，并保存在 accuracy_per_epoch 列表中供后续使用。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h2 id="%E5%9B%9B%E3%80%81%E5%AE%9E%E9%AA%8C%E7%BB%93%E6%9E%9C%E4%B8%8E%E5%88%86%E6%9E%90">四、实验结果与分析</h2> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">在本次实验中，每个数据集被分为两个子集：训练部分和测试部分。对于这个实验，模型已经在数据集的训练部分上进行了训练，并在相应数据集的测试集上进行了测试。</span></p> 
<h3 id="4.1%E4%BA%8C%E5%85%83%E4%BB%B7%E6%80%81%E5%88%86%E7%B1%BB%E7%BB%93%E6%9E%9C" style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">4.1二元价态分类结果</span></h3> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;"> 本次实验结果是采用固定训练集/测试集分割样本后的结果。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">DNN和CNN模型在DEAP数据集上进行价值分类的结果，随着epoch的增加，测试的准确率变化如下图所示：</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="495" src="https://images2.imgbox.com/3f/c0/aNY57yJR_o.gif" width="1200"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">从上图可以看出，DNN模型在DEAP数据集上的分类结果似乎都优于CNN模型。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">使用DNN模型分类的准确率在62%～79%之间，而使用CNN模型的分类准确率在56%～75%之间。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">4.2 使用K折交叉验证对模型进行评估</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">此技术的主要思想是将数据集划分为相同大小的K个折叠（如果可能的话），然后，依次将每个折叠用作测试集，而数据集的其余部分用作训练集。对K个模型进行训练并评估其准确性，最后K次交叉验证的最终报告准确性是这些准确性的平均值。DEAP的32倍交叉验证结果如下图所示：</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="488" src="https://images2.imgbox.com/f1/de/sAk08KoY_o.gif" width="1200"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">使用K-fold交叉验证发现的准确性远低于使用固定训练/测试分割发现的准确性。因此，可以说，模型存在高方差误差，即其性能与特定的训练和提供给它们的测试集高度相关。对于上图的结果，在数据集上操作的训练/测试分割很可能是“幸运”的分割，偶然产生了高精度。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">在K折叠交叉验证过程中获得的特定折叠精度也证实了高方差猜想。例如，在DEAP上DNN模型的K-fold运行中，fold准确率从43%到78%不等，这表明不同的数据集分割如何从根本上改变准确率结果。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">    K-fold结果也证实了之前的结果，即CNN模型在两个数据集上都略优于DNN模型，而当在单个训练/测试分割上进行评估时，DNN模型能够达到更高的最大精度。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h2 id="%E4%BA%94%E3%80%81%E5%AE%9E%E9%AA%8C%E6%80%BB%E7%BB%93" style="margin-left:.0001pt;text-align:justify;">五、实验总结</h2> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">本次实验我们基于DEAP数据集进行二分类脑电信号识别，采用的网络模型是深度神经网络和卷积神经网络。由于之前未接触过这方面的训练，我在最开始做本次实验时有种无从下手的感觉。因此本次实验的很多思路都是借鉴于期刊论文中的做法，例如对数据的处理思路，对模型的训练方式等。但完成本次实验后，还是得到了不少的收获。首先，我对深度神经网络和卷积神经网络有了更深的理解，理论课上只是学习了关于CNN的一些知识和运算，而通过本次实践，真正感受到了神经网络的强大和奇妙；其次，我对科研的严谨性有了更深的体会。对于每一个问题，都尝试运用不同的模型去得到结果，然后进行对比和考量，选择最优的方法。又或者将几种模型集成，得到一个更优的模型，这与理论课上学习的集成学习思想很类似。最后，本次实验也让我深知科研训练的必要性。不仅是在知识的融会贯通上，还是能力的提升上，进行相关科研训练都是十分有益的。在今后，我也将花更多的时间去锻炼自己的科研能力，努力提高自己的科研素养！</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h2 id="%E9%99%84%E5%BD%95%EF%BC%9A%E5%AE%9E%E9%AA%8C%E4%BB%A3%E7%A0%81" style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">附录：实验代码</span></h2> 
<h3 id="prepare_deap.py" style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">prepare_deap.py</span></h3> 
<ol><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">import</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;"> os, pickle, math</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#a626a4;"><span style="background-color:#ffffff;">import</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;"> numpy </span></span><span style="color:#a626a4;"><span style="background-color:#ffffff;">as</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;"> np</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">import</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;"> reduce_dim</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">src_dir = </span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">'/Users/peach/Desktop/DEAP/data_preprocessed_python/'</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">dst_dir = </span></span><span style="color:#50a14f;"><span style="background-color:#ffffff;">'/Users/peach/Desktop/DEAP/deap_preprocessed_standardized_global/'</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">n_experiments = </span></span><span style="color:#986801;"><span style="background-color:#ffffff;">40</span></span>    <em><span style="color:#a0a1a7;"><em><span style="background-color:#ffffff;"># experiment per participant</span></em></span></em></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">n_channels = </span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">40</span></span>       <em><span style="color:#a0a1a7;"><em><span style="background-color:#f8f8f8;"># channel per experiment</span></em></span></em></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">n_recordings = </span></span><span style="color:#986801;"><span style="background-color:#ffffff;">8064</span></span>   <em><span style="color:#a0a1a7;"><em><span style="background-color:#ffffff;"># recordings per channel</span></em></span></em></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">participants = os.listdir(src_dir)</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">participants.sort()</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#a626a4;"><span style="background-color:#ffffff;">assert</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;"> len(participants) == </span></span><span style="color:#986801;"><span style="background-color:#ffffff;">32</span></span> <em><span style="color:#a0a1a7;"><em><span style="background-color:#ffffff;"># DEAP has 32 participants</span></em></span></em></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">tot_experiments = </span></span><span style="color:#986801;"><span style="background-color:#ffffff;">40</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;"> * </span></span><span style="color:#986801;"><span style="background-color:#ffffff;">32</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">exported_experiments = </span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">0</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">for</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;"> i, participant </span></span><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">in</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;"> enumerate(participants):</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">  print(</span></span><span style="color:#50a14f;"><span style="background-color:#ffffff;">f'Participant </span></span><span style="color:#e45649;"><span style="background-color:#ffffff;">{i+</span></span><span style="color:#986801;"><span style="background-color:#ffffff;">1</span></span><span style="color:#e45649;"><span style="background-color:#ffffff;">}</span></span><span style="color:#50a14f;"><span style="background-color:#ffffff;">/</span></span><span style="color:#e45649;"><span style="background-color:#ffffff;">{len(participants)}</span></span><span style="color:#50a14f;"><span style="background-color:#ffffff;"> (</span></span><span style="color:#e45649;"><span style="background-color:#ffffff;">{participant}</span></span><span style="color:#50a14f;"><span style="background-color:#ffffff;">)'</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">)</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">  participant_data_path = os.path.join(src_dir, participant)</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#ffffff;">  <span style="color:#a626a4;"><span style="background-color:#ffffff;">with</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;"> open(participant_data_path, mode=</span></span><span style="color:#50a14f;"><span style="background-color:#ffffff;">'r+b'</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">) </span></span><span style="color:#a626a4;"><span style="background-color:#ffffff;">as</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;"> f:</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;">    <em><span style="color:#a0a1a7;"><em><span style="background-color:#f8f8f8;"># encoding needed because DEAP data was pickled with Python2</span></em></span></em></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">    data = pickle.load(f, encoding=</span></span><span style="color:#50a14f;"><span style="background-color:#ffffff;">'latin1'</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">)</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">    data, labels = data[</span></span><span style="color:#50a14f;"><span style="background-color:#ffffff;">'data'</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">], data[</span></span><span style="color:#50a14f;"><span style="background-color:#ffffff;">'labels'</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">]</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;">    <span style="color:#a626a4;"><span style="background-color:#f8f8f8;">assert</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;"> data.shape == (n_experiments, n_channels, n_recordings)</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;">    <span style="color:#a626a4;"><span style="background-color:#ffffff;">assert</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;"> labels.shape == (n_experiments, </span></span><span style="color:#986801;"><span style="background-color:#ffffff;">4</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">)</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#ffffff;">    <span style="color:#a626a4;"><span style="background-color:#ffffff;">for</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;"> j </span></span><span style="color:#a626a4;"><span style="background-color:#ffffff;">in</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;"> range(n_experiments):</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;">      <em><span style="color:#a0a1a7;"><em><span style="background-color:#f8f8f8;"># Removes non-EEG channels from data</span></em></span></em></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">      data_tmp = data[j,</span></span><span style="color:#986801;"><span style="background-color:#ffffff;">0</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">:</span></span><span style="color:#986801;"><span style="background-color:#ffffff;">32</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">,:]</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;">      <span style="color:#a626a4;"><span style="background-color:#f8f8f8;">assert</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;"> data_tmp.shape == (</span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">32</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">, n_recordings)</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">      data_tmp = reduce_dim.reduce_dim(data_tmp)</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;">      <span style="color:#a626a4;"><span style="background-color:#ffffff;">assert</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;"> data_tmp.shape == (</span></span><span style="color:#986801;"><span style="background-color:#ffffff;">32</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">, </span></span><span style="color:#986801;"><span style="background-color:#ffffff;">99</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">)</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">      data_tmp = (data_tmp - np.mean(data_tmp)) / np.std(data_tmp)</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">      label_tmp = labels[j,</span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">0</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">:</span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">2</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">]</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;">      <span style="color:#a626a4;"><span style="background-color:#ffffff;">assert</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;"> label_tmp.shape == (</span></span><span style="color:#986801;"><span style="background-color:#ffffff;">2</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">,)</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">      dat = {<!-- --></span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;">        <span style="color:#50a14f;"><span style="background-color:#f8f8f8;">'data'</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">: data_tmp,</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;">        <span style="color:#50a14f;"><span style="background-color:#ffffff;">'labels'</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">: label_tmp,</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">      }</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">      dat_file_path = os.path.join(dst_dir, </span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">f'</span></span><span style="color:#e45649;"><span style="background-color:#f8f8f8;">{i+</span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">1</span></span><span style="color:#e45649;"><span style="background-color:#f8f8f8;">}</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">_</span></span><span style="color:#e45649;"><span style="background-color:#f8f8f8;">{j+</span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">1</span></span><span style="color:#e45649;"><span style="background-color:#f8f8f8;">}</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">.dat'</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">)</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;">      <span style="color:#a626a4;"><span style="background-color:#ffffff;">with</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;"> open(dat_file_path, mode=</span></span><span style="color:#50a14f;"><span style="background-color:#ffffff;">'w+b'</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">) </span></span><span style="color:#a626a4;"><span style="background-color:#ffffff;">as</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;"> dat_file:</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">        pickle.dump(dat, dat_file)</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">      print(</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">f'</span></span><span style="color:#e45649;"><span style="background-color:#f8f8f8;">{dat_file_path}</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;"> exported successfully.'</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">)</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">      exported_experiments += </span></span><span style="color:#986801;"><span style="background-color:#ffffff;">1</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">print(</span></span><span style="color:#50a14f;"><span style="background-color:#ffffff;">'Done.'</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">)</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">print(</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">f'Exported </span></span><span style="color:#e45649;"><span style="background-color:#f8f8f8;">{exported_experiments}</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;"> experiments out of </span></span><span style="color:#e45649;"><span style="background-color:#f8f8f8;">{tot_experiments}</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">.'</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">)</span></span></span></li></ol> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h3 id="reduce_dim.py" style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">reduce_dim.py</span></h3> 
<ol><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">import</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;"> numpy </span></span><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">as</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;"> np</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#a626a4;"><span style="background-color:#ffffff;">import</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;"> scipy.stats </span></span><span style="color:#a626a4;"><span style="background-color:#ffffff;">as</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;"> sp</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">def reduce_dim(</span></span><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">data</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">):</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">  assert (</span></span><span style="color:#a626a4;"><span style="background-color:#ffffff;">data</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">.shape == (</span></span><span style="color:#986801;"><span style="background-color:#ffffff;">32</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">, </span></span><span style="color:#986801;"><span style="background-color:#ffffff;">8064</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">) or </span></span><span style="color:#a626a4;"><span style="background-color:#ffffff;">data</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">.shape == (</span></span><span style="color:#986801;"><span style="background-color:#ffffff;">32</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">, </span></span><span style="color:#986801;"><span style="background-color:#ffffff;">8064</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">*</span></span><span style="color:#986801;"><span style="background-color:#ffffff;">2</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">))</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">  processed_data = np.zeros((</span></span><span style="color:#986801;"><span style="background-color:#ffffff;">32</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">, </span></span><span style="color:#986801;"><span style="background-color:#ffffff;">99</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">))</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#ffffff;">  <span style="color:#a626a4;"><span style="background-color:#ffffff;">for</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;"> channel_n </span></span><span style="color:#a626a4;"><span style="background-color:#ffffff;">in</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;"> range(</span></span><span style="color:#986801;"><span style="background-color:#ffffff;">32</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">):</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">    # Divide the </span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">8064</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;"> recordings </span></span><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">in</span></span> <span style="color:#986801;"><span style="background-color:#f8f8f8;">10</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;"> batches of </span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">807</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;"> (</span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">10</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">th batch: </span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">801</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">)</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;">    <span style="color:#a626a4;"><span style="background-color:#ffffff;">if</span></span> <span style="color:#a626a4;"><span style="background-color:#ffffff;">data</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">.shape == (</span></span><span style="color:#986801;"><span style="background-color:#ffffff;">32</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">, </span></span><span style="color:#986801;"><span style="background-color:#ffffff;">8064</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">):</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">      batch_size = </span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">807</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">      n_samples = </span></span><span style="color:#986801;"><span style="background-color:#ffffff;">8064</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">    elif </span></span><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">data</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">.shape == (</span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">32</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">, </span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">8064</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">*</span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">2</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">):</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">      batch_size = </span></span><span style="color:#986801;"><span style="background-color:#ffffff;">807</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;"> * </span></span><span style="color:#986801;"><span style="background-color:#ffffff;">2</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">      n_samples = </span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">8064</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;"> * </span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">2</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">    batch_n = </span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">0</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#f8f8f8;">    <span style="color:#a626a4;"><span style="background-color:#f8f8f8;">for</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;"> batch_n </span></span><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">in</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;"> range(</span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">10</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">):</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;">      <span style="color:#a626a4;"><span style="background-color:#ffffff;">if</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;"> batch_n != </span></span><span style="color:#986801;"><span style="background-color:#ffffff;">9</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">:</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">        batch = </span></span><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">data</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">[channel_n,(batch_n*batch_size):(batch_n*batch_size+batch_size)]</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;">      <span style="color:#a626a4;"><span style="background-color:#ffffff;">else</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">:</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">        batch = </span></span><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">data</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">[channel_n,(batch_n*batch_size):n_samples]</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">      processed_data[channel_n,(batch_n * </span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">9</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">):(batch_n * </span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">9</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;"> + </span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">9</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">)] = np.array([</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">        np.mean(batch),</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">        np.median(batch),</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">        np.max(batch),</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">        np.min(batch),</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">        np.std(batch),</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">        np.</span></span><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">var</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">(batch),</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">        np.max(batch) - np.min(batch),</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">        sp.skew(batch),</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">        sp.kurtosis(batch),</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">      ])</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;">      </span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">    processed_data[channel_n,</span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">90</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">:</span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">99</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">] = np.array([</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">        np.mean(</span></span><span style="color:#a626a4;"><span style="background-color:#ffffff;">data</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">[channel_n,:]),</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">        np.median(</span></span><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">data</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">[channel_n,:]),</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">        np.max(</span></span><span style="color:#a626a4;"><span style="background-color:#ffffff;">data</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">[channel_n,:]),</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">        np.min(</span></span><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">data</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">[channel_n,:]),</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">        np.std(</span></span><span style="color:#a626a4;"><span style="background-color:#ffffff;">data</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">[channel_n,:]),</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">        np.</span></span><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">var</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">(</span></span><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">data</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">[channel_n,:]),</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">        np.max(</span></span><span style="color:#a626a4;"><span style="background-color:#ffffff;">data</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">[channel_n,:]) - np.min(</span></span><span style="color:#a626a4;"><span style="background-color:#ffffff;">data</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">[channel_n,:]),</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">        sp.skew(</span></span><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">data</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">[channel_n,:]),</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">        sp.kurtosis(</span></span><span style="color:#a626a4;"><span style="background-color:#ffffff;">data</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">[channel_n,:]),</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">    ])</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">  assert processed_data.shape == (</span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">32</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">, </span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">99</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">)</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;">  <span style="color:#a626a4;"><span style="background-color:#ffffff;">return</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;"> processed_data</span></span></span></li></ol> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h3 id="datasets.py" style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">datasets.py</span></h3> 
<ol><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">import os, pickle, torch</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">from torch.utils.data import Dataset</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">n_channels = </span></span><span style="color:#986801;"><span style="background-color:#ffffff;">32</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">n_recordings = </span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">99</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#a0a1a7;"><span style="background-color:#f8f8f8;"># High val = 708, low val = 572</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#a0a1a7;"><span style="background-color:#ffffff;"># High ar = 737, low ar = 543</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">class</span></span> <span style="color:#c18401;"><span style="background-color:#f8f8f8;">DEAP</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">(</span></span><span style="color:#c18401;"><span style="background-color:#f8f8f8;">Dataset</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">):</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;">  <span style="color:#a626a4;"><span style="background-color:#ffffff;">def</span></span> <span style="color:#4078f2;"><span style="background-color:#ffffff;">__init__</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">(</span></span><span style="color:#a626a4;"><span style="background-color:#ffffff;">self</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">, dataset_path):</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;">    <span style="color:#a626a4;"><span style="background-color:#f8f8f8;">self</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">.dataset_path = dataset_path</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#f8f8f8;">    <span style="color:#a626a4;"><span style="background-color:#f8f8f8;">self</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">.sessions = os.listdir(dataset_path)</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;">    </span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;">    <span style="color:#a0a1a7;"><span style="background-color:#f8f8f8;"># remove .DS_Store if present</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;">    <span style="color:#a626a4;"><span style="background-color:#ffffff;">if</span></span> <span style="color:#50a14f;"><span style="background-color:#ffffff;">'.DS_Store'</span></span> <span style="color:#a626a4;"><span style="background-color:#ffffff;">in</span></span> <span style="color:#a626a4;"><span style="background-color:#ffffff;">self</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">.</span></span><span style="color:#4078f2;"><span style="background-color:#ffffff;">sessions:</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;">      <span style="color:#a626a4;"><span style="background-color:#f8f8f8;">self</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">.sessions.remove(</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">'.DS_Store'</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">)</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#f8f8f8;">  <span style="color:#a626a4;"><span style="background-color:#f8f8f8;">def</span></span> <span style="color:#4078f2;"><span style="background-color:#f8f8f8;">__len__</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">(</span></span><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">self</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">):</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;">    <span style="color:#a626a4;"><span style="background-color:#ffffff;">return</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;"> len(</span></span><span style="color:#a626a4;"><span style="background-color:#ffffff;">self</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">.sessions)</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#ffffff;">  <span style="color:#a626a4;"><span style="background-color:#ffffff;">def</span></span> <span style="color:#4078f2;"><span style="background-color:#ffffff;">__getitem__</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">(</span></span><span style="color:#a626a4;"><span style="background-color:#ffffff;">self</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">, index):</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">    file_path = os.path.join(</span></span><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">self</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">.dataset_path, </span></span><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">self</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">.sessions[index])</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">    with open(file_path, mode=</span></span><span style="color:#50a14f;"><span style="background-color:#ffffff;">'rb'</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">) as </span></span><span style="color:#4078f2;"><span style="background-color:#ffffff;">file:</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">      session = pickle.load(file)</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">      data, labels = session[</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">'data'</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">], session[</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">'labels'</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">]</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">      data, labels = torch.from_numpy(data), torch.from_numpy(labels)</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">      data, labels = data.float(), labels.float()</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#f8f8f8;">      <span style="color:#a0a1a7;"><span style="background-color:#f8f8f8;"># 1 = high value, 0 = low value</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">      labels = (labels &gt;= </span></span><span style="color:#986801;"><span style="background-color:#ffffff;">5.0</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">).long()</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">      assert data.shape == (n_channels, n_recordings)</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">      assert labels.shape == (</span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">2</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">,)</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#f8f8f8;">      <span style="color:#a626a4;"><span style="background-color:#f8f8f8;">return</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;"> data, labels</span></span></span></li></ol> 
<h3 style="margin-left:.0001pt;text-align:justify;"></h3> 
<h3 id="models.py" style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">models.py</span></h3> 
<ol><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">from torch import nn</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">n_channels = </span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">32</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">n_recordings = </span></span><span style="color:#986801;"><span style="background-color:#ffffff;">99</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#a626a4;"><span style="background-color:#ffffff;">class</span></span> <span style="color:#c18401;"><span style="background-color:#ffffff;">DNN</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">(</span></span><span style="color:#c18401;"><span style="background-color:#ffffff;">nn</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">.</span></span><span style="color:#c18401;"><span style="background-color:#ffffff;">Module</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">):</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;">  <span style="color:#a626a4;"><span style="background-color:#f8f8f8;">def</span></span> <span style="color:#4078f2;"><span style="background-color:#f8f8f8;">__init__</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">(</span></span><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">self</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">, sizes=(</span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">5000</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">, </span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">500</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">, </span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">1000</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">), dropout_probs=(</span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">0</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">.</span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">25</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">, </span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">0</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">.</span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">5</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">)):</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;">    <span style="color:#a626a4;"><span style="background-color:#ffffff;">super</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">(DNN, </span></span><span style="color:#a626a4;"><span style="background-color:#ffffff;">self</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">).__init_</span></span><span style="color:#986801;"><span style="background-color:#ffffff;">_</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">()</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#ffffff;">    <span style="color:#a626a4;"><span style="background-color:#ffffff;">self</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">.linear1 = nn.Linear(n_channels * n_recordings, sizes[</span></span><span style="color:#986801;"><span style="background-color:#ffffff;">0</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">])</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;">    <span style="color:#a626a4;"><span style="background-color:#f8f8f8;">self</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">.linear2 = nn.Linear(sizes[</span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">0</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">], sizes[</span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">1</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">])</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;">    <span style="color:#a626a4;"><span style="background-color:#ffffff;">self</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">.linear3 = nn.Linear(sizes[</span></span><span style="color:#986801;"><span style="background-color:#ffffff;">1</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">], sizes[</span></span><span style="color:#986801;"><span style="background-color:#ffffff;">2</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">])</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;">    <span style="color:#a626a4;"><span style="background-color:#f8f8f8;">self</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">.linear4 = nn.Linear(sizes[</span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">2</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">], </span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">1</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">) </span></span><em><span style="color:#a0a1a7;"><em><span style="background-color:#f8f8f8;"># binary classification: high vs low</span></em></span></em></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#f8f8f8;">    <span style="color:#a626a4;"><span style="background-color:#f8f8f8;">self</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">.dropout1 = nn.Dropout(dropout_probs[</span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">0</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">])</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;">    <span style="color:#a626a4;"><span style="background-color:#ffffff;">self</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">.dropout2 = nn.Dropout(dropout_probs[</span></span><span style="color:#986801;"><span style="background-color:#ffffff;">1</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">])</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#ffffff;">    <span style="color:#a626a4;"><span style="background-color:#ffffff;">self</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">.relu = nn.ReLU()</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#ffffff;">    <span style="color:#a626a4;"><span style="background-color:#ffffff;">self</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">.flatten = nn.Flatten(start_dim=</span></span><span style="color:#986801;"><span style="background-color:#ffffff;">1</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">)</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#ffffff;">  <span style="color:#a626a4;"><span style="background-color:#ffffff;">def</span></span> <span style="color:#4078f2;"><span style="background-color:#ffffff;">forward</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">(</span></span><span style="color:#a626a4;"><span style="background-color:#ffffff;">self</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">, x):</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">    x = </span></span><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">self</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">.flatten(x)</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">    x = </span></span><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">self</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">.dropout1(x)</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">    x = </span></span><span style="color:#a626a4;"><span style="background-color:#ffffff;">self</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">.linear1(x)</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">    x = </span></span><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">self</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">.relu(x)</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">    x = </span></span><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">self</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">.dropout2(x)</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">    x = </span></span><span style="color:#a626a4;"><span style="background-color:#ffffff;">self</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">.linear2(x)</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">    x = </span></span><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">self</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">.relu(x)</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">    x = </span></span><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">self</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">.dropout2(x)</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">    x = </span></span><span style="color:#a626a4;"><span style="background-color:#ffffff;">self</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">.linear3(x)</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">    x = </span></span><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">self</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">.relu(x)</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">    x = </span></span><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">self</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">.dropout2(x)</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">    x = </span></span><span style="color:#a626a4;"><span style="background-color:#ffffff;">self</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">.linear4(x)</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#ffffff;">    <span style="color:#a626a4;"><span style="background-color:#ffffff;">return</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;"> x</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">class</span></span> <span style="color:#c18401;"><span style="background-color:#f8f8f8;">CNN</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">(</span></span><span style="color:#c18401;"><span style="background-color:#f8f8f8;">nn</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">.</span></span><span style="color:#c18401;"><span style="background-color:#f8f8f8;">Module</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">):</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;">  <span style="color:#a626a4;"><span style="background-color:#ffffff;">def</span></span> <span style="color:#4078f2;"><span style="background-color:#ffffff;">__init__</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">(</span></span><span style="color:#a626a4;"><span style="background-color:#ffffff;">self</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">, dropout_probs=(</span></span><span style="color:#986801;"><span style="background-color:#ffffff;">0</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">.</span></span><span style="color:#986801;"><span style="background-color:#ffffff;">25</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">, </span></span><span style="color:#986801;"><span style="background-color:#ffffff;">0</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">.</span></span><span style="color:#986801;"><span style="background-color:#ffffff;">15</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">, </span></span><span style="color:#986801;"><span style="background-color:#ffffff;">0</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">.</span></span><span style="color:#986801;"><span style="background-color:#ffffff;">5</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">, </span></span><span style="color:#986801;"><span style="background-color:#ffffff;">0</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">.</span></span><span style="color:#986801;"><span style="background-color:#ffffff;">25</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">)):</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;">      <span style="color:#a626a4;"><span style="background-color:#f8f8f8;">super</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">(CNN, </span></span><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">self</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">).__init_</span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">_</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">()</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#f8f8f8;">      <span style="color:#a626a4;"><span style="background-color:#f8f8f8;">self</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">.conv1 = nn.Conv2d(</span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">1</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">, </span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">20</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">, (</span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">3</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">, </span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">3</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">), padding=(</span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">1</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">, </span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">1</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">))</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;">      <span style="color:#a626a4;"><span style="background-color:#ffffff;">self</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">.conv2 = nn.Conv2d(</span></span><span style="color:#986801;"><span style="background-color:#ffffff;">20</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">, </span></span><span style="color:#986801;"><span style="background-color:#ffffff;">40</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">, (</span></span><span style="color:#986801;"><span style="background-color:#ffffff;">3</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">, </span></span><span style="color:#986801;"><span style="background-color:#ffffff;">3</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">), padding=(</span></span><span style="color:#986801;"><span style="background-color:#ffffff;">1</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">, </span></span><span style="color:#986801;"><span style="background-color:#ffffff;">1</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">))</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#ffffff;">      <span style="color:#a626a4;"><span style="background-color:#ffffff;">self</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">.maxpool = nn.MaxPool2d((</span></span><span style="color:#986801;"><span style="background-color:#ffffff;">2</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">, </span></span><span style="color:#986801;"><span style="background-color:#ffffff;">2</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">))</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#ffffff;">      <span style="color:#a626a4;"><span style="background-color:#ffffff;">self</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">.linear1 = nn.Linear(</span></span><span style="color:#986801;"><span style="background-color:#ffffff;">40</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;"> * </span></span><span style="color:#986801;"><span style="background-color:#ffffff;">16</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;"> * </span></span><span style="color:#986801;"><span style="background-color:#ffffff;">49</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">, </span></span><span style="color:#986801;"><span style="background-color:#ffffff;">128</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">)</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;">      <span style="color:#a626a4;"><span style="background-color:#f8f8f8;">self</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">.linear2 = nn.Linear(</span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">128</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">, </span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">1</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">)</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#f8f8f8;">      <span style="color:#a626a4;"><span style="background-color:#f8f8f8;">self</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">.tanh = nn.Tanh()</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;">      <span style="color:#a626a4;"><span style="background-color:#ffffff;">self</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">.relu = nn.ReLU()</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#ffffff;">      <span style="color:#a626a4;"><span style="background-color:#ffffff;">self</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">.dropout</span></span><span style="color:#986801;"><span style="background-color:#ffffff;">0</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;"> = nn.Dropout(dropout_probs[</span></span><span style="color:#986801;"><span style="background-color:#ffffff;">0</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">])</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;">      <span style="color:#a626a4;"><span style="background-color:#f8f8f8;">self</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">.dropout1 = nn.Dropout2d(dropout_probs[</span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">1</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">])</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;">      <span style="color:#a626a4;"><span style="background-color:#ffffff;">self</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">.dropout2 = nn.Dropout(dropout_probs[</span></span><span style="color:#986801;"><span style="background-color:#ffffff;">2</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">])</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;">      <span style="color:#a626a4;"><span style="background-color:#f8f8f8;">self</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">.dropout3 = nn.Dropout(dropout_probs[</span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">3</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">]</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">)</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;">      <span style="color:#a626a4;"><span style="background-color:#f8f8f8;">self</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">.flatten = nn.Flatten(start_dim=</span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">1</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">)</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#f8f8f8;">      <span style="color:#a626a4;"><span style="background-color:#f8f8f8;">self</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">.softplus = nn.Softplus()</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#f8f8f8;">  <span style="color:#a626a4;"><span style="background-color:#f8f8f8;">def</span></span> <span style="color:#4078f2;"><span style="background-color:#f8f8f8;">forward</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">(</span></span><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">self</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">, x):</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">    x = x[</span></span><span style="color:#4078f2;"><span style="background-color:#ffffff;">:</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">,None,</span></span><span style="color:#4078f2;"><span style="background-color:#ffffff;">:</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">,</span></span><span style="color:#4078f2;"><span style="background-color:#ffffff;">:</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">] </span></span><em><span style="color:#a0a1a7;"><em><span style="background-color:#ffffff;"># add dummy dim for channel</span></em></span></em></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">    x = </span></span><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">self</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">.dropout</span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">0</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">(x)</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">    x = </span></span><span style="color:#a626a4;"><span style="background-color:#ffffff;">self</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">.relu(</span></span><span style="color:#a626a4;"><span style="background-color:#ffffff;">self</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">.conv1(x))</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">    x = </span></span><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">self</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">.dropout1(x)</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">    x = </span></span><span style="color:#a626a4;"><span style="background-color:#ffffff;">self</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">.relu(</span></span><span style="color:#a626a4;"><span style="background-color:#ffffff;">self</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">.conv2(x))</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">    x = </span></span><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">self</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">.dropout1(x)</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">    x = </span></span><span style="color:#a626a4;"><span style="background-color:#ffffff;">self</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">.maxpool(x)</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">    x = </span></span><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">self</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">.flatten(x)</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">    x = </span></span><span style="color:#a626a4;"><span style="background-color:#ffffff;">self</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">.dropout2(x)</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">    x = </span></span><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">self</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">.relu(</span></span><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">self</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">.linear1(x))</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">    x = </span></span><span style="color:#a626a4;"><span style="background-color:#ffffff;">self</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">.dropout3(x)</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">    x = </span></span><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">self</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">.linear2(x)</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;">    <span style="color:#a626a4;"><span style="background-color:#f8f8f8;">return</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;"> x</span></span></span></li></ol> 
<h3 id="train.py" style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">train.py</span></h3> 
<ol><li style="text-align:left;"><span style="background-color:#f8f8f8;"><em><span style="color:#a0a1a7;"><em><span style="background-color:#f8f8f8;"># Imports</span></em></span></em></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#a626a4;"><span style="background-color:#ffffff;">import</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;"> torch, yaml, os</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">from</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;"> torch.utils.data </span></span><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">import</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;"> DataLoader, random_split</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">from</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;"> datasets </span></span><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">import</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;"> DEAP, MAHNOB</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#a626a4;"><span style="background-color:#ffffff;">from</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;"> models </span></span><span style="color:#a626a4;"><span style="background-color:#ffffff;">import</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;"> DNN, CNN</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">from</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;"> utils </span></span><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">import</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;"> check_train_test_split_balanced</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#a626a4;"><span style="background-color:#ffffff;">from</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;"> train_utils </span></span><span style="color:#a626a4;"><span style="background-color:#ffffff;">import</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;"> train</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#ffffff;"><em><span style="color:#a0a1a7;"><em><span style="background-color:#ffffff;"># Read configs</span></em></span></em></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">with</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;"> open(</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">'deap_dnn_arousal.yml'</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">) </span></span><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">as</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;"> yaml_file:</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">  config = yaml.load(yaml_file, Loader=yaml.FullLoader)</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#ffffff;"><em><span style="color:#a0a1a7;"><em><span style="background-color:#ffffff;"># Hyperparams</span></em></span></em></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">num_epochs = config[</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">'TRAIN'</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">][</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">'num_epochs'</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">]</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">batch_size = config[</span></span><span style="color:#50a14f;"><span style="background-color:#ffffff;">'TRAIN'</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">][</span></span><span style="color:#50a14f;"><span style="background-color:#ffffff;">'batch_size'</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">]</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">lr = config[</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">'TRAIN'</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">][</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">'lr'</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">]</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">momentum = config[</span></span><span style="color:#50a14f;"><span style="background-color:#ffffff;">'TRAIN'</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">][</span></span><span style="color:#50a14f;"><span style="background-color:#ffffff;">'momentum'</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">]</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#ffffff;"><em><span style="color:#a0a1a7;"><em><span style="background-color:#ffffff;"># Model</span></em></span></em></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">model_type = config[</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">'MODEL'</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">][</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">'model'</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">]</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#f8f8f8;"><em><span style="color:#a0a1a7;"><em><span style="background-color:#f8f8f8;"># Train</span></em></span></em></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">classification_of = config[</span></span><span style="color:#50a14f;"><span style="background-color:#ffffff;">'TRAIN'</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">][</span></span><span style="color:#50a14f;"><span style="background-color:#ffffff;">'classification_of'</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">]</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#ffffff;"><em><span style="color:#a0a1a7;"><em><span style="background-color:#ffffff;"># Dataset</span></em></span></em></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">dataset_to_use = config[</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">'DATASET'</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">][</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">'dataset_to_use'</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">]</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#f8f8f8;"><em><span style="color:#a0a1a7;"><em><span style="background-color:#f8f8f8;"># Export</span></em></span></em></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">model_path = config[</span></span><span style="color:#50a14f;"><span style="background-color:#ffffff;">'EXPORT'</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">][</span></span><span style="color:#50a14f;"><span style="background-color:#ffffff;">'model_path'</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">]</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">model_name = </span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">f'</span></span><span style="color:#e45649;"><span style="background-color:#f8f8f8;">{dataset_to_use}</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">-</span></span><span style="color:#e45649;"><span style="background-color:#f8f8f8;">{model_type}</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">-</span></span><span style="color:#e45649;"><span style="background-color:#f8f8f8;">{classification_of}</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">'</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">if</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;"> dataset_to_use == </span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">'deap'</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">:</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">  dataset_path = config[</span></span><span style="color:#50a14f;"><span style="background-color:#ffffff;">'DATASET'</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">][</span></span><span style="color:#50a14f;"><span style="background-color:#ffffff;">'deap_dataset_path'</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">]</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">  dataset = DEAP(dataset_path)</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#a626a4;"><span style="background-color:#ffffff;">elif</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;"> dataset_to_use == </span></span><span style="color:#50a14f;"><span style="background-color:#ffffff;">'mahnob'</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">:</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">  dataset_path = config[</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">'DATASET'</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">][</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">'mahnob_dataset_path'</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">]</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">  dataset = MAHNOB(dataset_path)</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">else</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">:</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;">  <span style="color:#a626a4;"><span style="background-color:#ffffff;">assert</span></span> <span style="color:#0184bb;"><span style="background-color:#ffffff;">False</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#ffffff;"><em><span style="color:#a0a1a7;"><em><span style="background-color:#ffffff;"># check_dataset_balanced(dataset_path)</span></em></span></em></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">seed = config[</span></span><span style="color:#50a14f;"><span style="background-color:#ffffff;">'TRAIN'</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">][</span></span><span style="color:#50a14f;"><span style="background-color:#ffffff;">'seed'</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">]</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">train_set_size, test_set_size = config[</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">'TRAIN'</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">][</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">'train_test_split'</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">]</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">train_set, test_set = random_split(</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">  dataset,</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">  [train_set_size, test_set_size],</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">  generator=torch.Generator().manual_seed(seed)</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">)</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">print(</span></span><span style="color:#50a14f;"><span style="background-color:#ffffff;">f'</span></span><span style="color:#e45649;"><span style="background-color:#ffffff;">{len(dataset)}</span></span><span style="color:#50a14f;"><span style="background-color:#ffffff;"> examples found (</span></span><span style="color:#e45649;"><span style="background-color:#ffffff;">{train_set_size}</span></span><span style="color:#50a14f;"><span style="background-color:#ffffff;"> train, </span></span><span style="color:#e45649;"><span style="background-color:#ffffff;">{test_set_size}</span></span><span style="color:#50a14f;"><span style="background-color:#ffffff;"> test)'</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">)</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">train_loader = DataLoader(</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">  train_set,</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">  batch_size=batch_size,</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">  shuffle=</span></span><span style="color:#0184bb;"><span style="background-color:#f8f8f8;">True</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">)</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">test_loader = DataLoader(</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">  test_set,</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">  batch_size=batch_size,</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">  shuffle=</span></span><span style="color:#0184bb;"><span style="background-color:#f8f8f8;">True</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">)</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">check_train_test_split_balanced(train_loader, test_loader)</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#ffffff;"><em><span style="color:#a0a1a7;"><em><span style="background-color:#ffffff;"># Model</span></em></span></em></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">if</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;"> model_type == </span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">'dnn'</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">:</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">  model = DNN(</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">    sizes=tuple(config[</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">'MODEL'</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">][</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">'sizes'</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">]),</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">    dropout_probs=tuple(config[</span></span><span style="color:#50a14f;"><span style="background-color:#ffffff;">'MODEL'</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">][</span></span><span style="color:#50a14f;"><span style="background-color:#ffffff;">'dropout_probs'</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">])</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">  )</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">  optimizer = torch.optim.RMSprop(model.parameters(), lr=lr)</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">elif</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;"> model_type == </span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">'cnn'</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">:</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">  model = CNN(dropout_probs=tuple(config[</span></span><span style="color:#50a14f;"><span style="background-color:#ffffff;">'MODEL'</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">][</span></span><span style="color:#50a14f;"><span style="background-color:#ffffff;">'dropout_probs'</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">]))</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">  optimizer = torch.optim.SGD(model.parameters(), lr=lr, momentum=momentum)</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#a626a4;"><span style="background-color:#ffffff;">else</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">:</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;">  <span style="color:#a626a4;"><span style="background-color:#f8f8f8;">assert</span></span> <span style="color:#0184bb;"><span style="background-color:#f8f8f8;">False</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">def</span></span> <span style="color:#4078f2;"><span style="background-color:#f8f8f8;">init_weights</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">(m):</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;">  <span style="color:#a626a4;"><span style="background-color:#ffffff;">if</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;"> isinstance(m, torch.nn.Linear):</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">    torch.nn.init.xavier_normal_(m.weight)</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">    m.bias.data.fill_(</span></span><span style="color:#986801;"><span style="background-color:#ffffff;">0.0</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">)</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">model.apply(init_weights)</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#ffffff;"><em><span style="color:#a0a1a7;"><em><span style="background-color:#ffffff;"># Launch training</span></em></span></em></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">best_acc_test_set = train(</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">  model,</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">  train_loader,</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">  torch.nn.BCEWithLogitsLoss(),</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">  optimizer,</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">  classification_of=classification_of,</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">  num_epochs=num_epochs,</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">  do_check_accuracy=</span></span><span style="color:#0184bb;"><span style="background-color:#ffffff;">True</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">,</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">  check_accuracy_every=</span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">1</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">,</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">  test_loader=test_loader,</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">  model_path=model_path,</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">  model_name=model_name,</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">)</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">os.system(</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">f'say Best test accuracy </span></span><span style="color:#e45649;"><span style="background-color:#f8f8f8;">{(best_acc_test_set*</span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">100</span></span><span style="color:#e45649;"><span style="background-color:#f8f8f8;">):</span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">.2</span></span><span style="color:#e45649;"><span style="background-color:#f8f8f8;">f}</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">%'</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">)</span></span></span></li></ol> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h3 style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">train.py</span></h3> 
<ol><li style="text-align:left;"><span style="background-color:#f8f8f8;"><em><span style="color:#a0a1a7;"><em><span style="background-color:#f8f8f8;"># Imports</span></em></span></em></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#a626a4;"><span style="background-color:#ffffff;">import</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;"> torch, yaml, os</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">from</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;"> torch.utils.data </span></span><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">import</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;"> DataLoader, random_split</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">from</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;"> datasets </span></span><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">import</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;"> DEAP, MAHNOB</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#a626a4;"><span style="background-color:#ffffff;">from</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;"> models </span></span><span style="color:#a626a4;"><span style="background-color:#ffffff;">import</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;"> DNN, CNN</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">from</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;"> utils </span></span><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">import</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;"> check_train_test_split_balanced</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#a626a4;"><span style="background-color:#ffffff;">from</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;"> train_utils </span></span><span style="color:#a626a4;"><span style="background-color:#ffffff;">import</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;"> train</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#ffffff;"><em><span style="color:#a0a1a7;"><em><span style="background-color:#ffffff;"># Read configs</span></em></span></em></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">with</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;"> open(</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">'deap_dnn_arousal.yml'</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">) </span></span><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">as</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;"> yaml_file:</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">  config = yaml.load(yaml_file, Loader=yaml.FullLoader)</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#ffffff;"><em><span style="color:#a0a1a7;"><em><span style="background-color:#ffffff;"># Hyperparams</span></em></span></em></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">num_epochs = config[</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">'TRAIN'</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">][</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">'num_epochs'</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">]</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">batch_size = config[</span></span><span style="color:#50a14f;"><span style="background-color:#ffffff;">'TRAIN'</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">][</span></span><span style="color:#50a14f;"><span style="background-color:#ffffff;">'batch_size'</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">]</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">lr = config[</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">'TRAIN'</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">][</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">'lr'</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">]</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">momentum = config[</span></span><span style="color:#50a14f;"><span style="background-color:#ffffff;">'TRAIN'</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">][</span></span><span style="color:#50a14f;"><span style="background-color:#ffffff;">'momentum'</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">]</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#ffffff;"><em><span style="color:#a0a1a7;"><em><span style="background-color:#ffffff;"># Model</span></em></span></em></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">model_type = config[</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">'MODEL'</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">][</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">'model'</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">]</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#f8f8f8;"><em><span style="color:#a0a1a7;"><em><span style="background-color:#f8f8f8;"># Train</span></em></span></em></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">classification_of = config[</span></span><span style="color:#50a14f;"><span style="background-color:#ffffff;">'TRAIN'</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">][</span></span><span style="color:#50a14f;"><span style="background-color:#ffffff;">'classification_of'</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">]</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#ffffff;"><em><span style="color:#a0a1a7;"><em><span style="background-color:#ffffff;"># Dataset</span></em></span></em></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">dataset_to_use = config[</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">'DATASET'</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">][</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">'dataset_to_use'</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">]</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#f8f8f8;"><em><span style="color:#a0a1a7;"><em><span style="background-color:#f8f8f8;"># Export</span></em></span></em></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">model_path = config[</span></span><span style="color:#50a14f;"><span style="background-color:#ffffff;">'EXPORT'</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">][</span></span><span style="color:#50a14f;"><span style="background-color:#ffffff;">'model_path'</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">]</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">model_name = </span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">f'</span></span><span style="color:#e45649;"><span style="background-color:#f8f8f8;">{dataset_to_use}</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">-</span></span><span style="color:#e45649;"><span style="background-color:#f8f8f8;">{model_type}</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">-</span></span><span style="color:#e45649;"><span style="background-color:#f8f8f8;">{classification_of}</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">'</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">if</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;"> dataset_to_use == </span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">'deap'</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">:</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">  dataset_path = config[</span></span><span style="color:#50a14f;"><span style="background-color:#ffffff;">'DATASET'</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">][</span></span><span style="color:#50a14f;"><span style="background-color:#ffffff;">'deap_dataset_path'</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">]</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">  dataset = DEAP(dataset_path)</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#a626a4;"><span style="background-color:#ffffff;">elif</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;"> dataset_to_use == </span></span><span style="color:#50a14f;"><span style="background-color:#ffffff;">'mahnob'</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">:</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">  dataset_path = config[</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">'DATASET'</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">][</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">'mahnob_dataset_path'</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">]</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">  dataset = MAHNOB(dataset_path)</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">else</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">:</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;">  <span style="color:#a626a4;"><span style="background-color:#ffffff;">assert</span></span> <span style="color:#0184bb;"><span style="background-color:#ffffff;">False</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#ffffff;"><em><span style="color:#a0a1a7;"><em><span style="background-color:#ffffff;"># check_dataset_balanced(dataset_path)</span></em></span></em></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">seed = config[</span></span><span style="color:#50a14f;"><span style="background-color:#ffffff;">'TRAIN'</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">][</span></span><span style="color:#50a14f;"><span style="background-color:#ffffff;">'seed'</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">]</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">train_set_size, test_set_size = config[</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">'TRAIN'</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">][</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">'train_test_split'</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">]</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">train_set, test_set = random_split(</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">  dataset,</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">  [train_set_size, test_set_size],</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">  generator=torch.Generator().manual_seed(seed)</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">)</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">print(</span></span><span style="color:#50a14f;"><span style="background-color:#ffffff;">f'</span></span><span style="color:#e45649;"><span style="background-color:#ffffff;">{len(dataset)}</span></span><span style="color:#50a14f;"><span style="background-color:#ffffff;"> examples found (</span></span><span style="color:#e45649;"><span style="background-color:#ffffff;">{train_set_size}</span></span><span style="color:#50a14f;"><span style="background-color:#ffffff;"> train, </span></span><span style="color:#e45649;"><span style="background-color:#ffffff;">{test_set_size}</span></span><span style="color:#50a14f;"><span style="background-color:#ffffff;"> test)'</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">)</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">train_loader = DataLoader(</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">  train_set,</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">  batch_size=batch_size,</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">  shuffle=</span></span><span style="color:#0184bb;"><span style="background-color:#f8f8f8;">True</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">)</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">test_loader = DataLoader(</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">  test_set,</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">  batch_size=batch_size,</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">  shuffle=</span></span><span style="color:#0184bb;"><span style="background-color:#f8f8f8;">True</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">)</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">check_train_test_split_balanced(train_loader, test_loader)</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#ffffff;"><em><span style="color:#a0a1a7;"><em><span style="background-color:#ffffff;"># Model</span></em></span></em></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">if</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;"> model_type == </span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">'dnn'</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">:</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">  model = DNN(</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">    sizes=tuple(config[</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">'MODEL'</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">][</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">'sizes'</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">]),</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">    dropout_probs=tuple(config[</span></span><span style="color:#50a14f;"><span style="background-color:#ffffff;">'MODEL'</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">][</span></span><span style="color:#50a14f;"><span style="background-color:#ffffff;">'dropout_probs'</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">])</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">  )</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">  optimizer = torch.optim.RMSprop(model.parameters(), lr=lr)</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">elif</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;"> model_type == </span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">'cnn'</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">:</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">  model = CNN(dropout_probs=tuple(config[</span></span><span style="color:#50a14f;"><span style="background-color:#ffffff;">'MODEL'</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">][</span></span><span style="color:#50a14f;"><span style="background-color:#ffffff;">'dropout_probs'</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">]))</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">  optimizer = torch.optim.SGD(model.parameters(), lr=lr, momentum=momentum)</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#a626a4;"><span style="background-color:#ffffff;">else</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">:</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;">  <span style="color:#a626a4;"><span style="background-color:#f8f8f8;">assert</span></span> <span style="color:#0184bb;"><span style="background-color:#f8f8f8;">False</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">def</span></span> <span style="color:#4078f2;"><span style="background-color:#f8f8f8;">init_weights</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">(m):</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;">  <span style="color:#a626a4;"><span style="background-color:#ffffff;">if</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;"> isinstance(m, torch.nn.Linear):</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">    torch.nn.init.xavier_normal_(m.weight)</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">    m.bias.data.fill_(</span></span><span style="color:#986801;"><span style="background-color:#ffffff;">0.0</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">)</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">model.apply(init_weights)</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#ffffff;"><em><span style="color:#a0a1a7;"><em><span style="background-color:#ffffff;"># Launch training</span></em></span></em></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">best_acc_test_set = train(</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">  model,</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">  train_loader,</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">  torch.nn.BCEWithLogitsLoss(),</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">  optimizer,</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">  classification_of=classification_of,</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">  num_epochs=num_epochs,</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">  do_check_accuracy=</span></span><span style="color:#0184bb;"><span style="background-color:#ffffff;">True</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">,</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">  check_accuracy_every=</span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">1</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">,</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">  test_loader=test_loader,</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">  model_path=model_path,</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">  model_name=model_name,</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">)</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">os.system(</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">f'say Best test accuracy </span></span><span style="color:#e45649;"><span style="background-color:#f8f8f8;">{(best_acc_test_set*</span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">100</span></span><span style="color:#e45649;"><span style="background-color:#f8f8f8;">):</span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">.2</span></span><span style="color:#e45649;"><span style="background-color:#f8f8f8;">f}</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">%'</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">)</span></span></span></li></ol> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h3 id="train_util.py" style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">train_util.py</span></h3> 
<ol><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">import</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;"> torch</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#a626a4;"><span style="background-color:#ffffff;">import</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;"> numpy </span></span><span style="color:#a626a4;"><span style="background-color:#ffffff;">as</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;"> np</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">from</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;"> utils </span></span><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">import</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;"> save_model</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">def</span></span> <span style="color:#4078f2;"><span style="background-color:#f8f8f8;">check_accuracy</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">(model, data_loader, classification_of=</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">'valence'</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">, num_examples=</span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">-1</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">):</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">  num_corrects = </span></span><span style="color:#986801;"><span style="background-color:#ffffff;">0</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#ffffff;">  <span style="color:#a626a4;"><span style="background-color:#ffffff;">if</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;"> num_examples == </span></span><span style="color:#986801;"><span style="background-color:#ffffff;">-1</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">:</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">    num_examples = len(data_loader.dataset)</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#f8f8f8;">  <span style="color:#a626a4;"><span style="background-color:#f8f8f8;">with</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;"> torch.no_grad():</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">    model.eval()</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#ffffff;">    <span style="color:#a626a4;"><span style="background-color:#ffffff;">for</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;"> data, labels </span></span><span style="color:#a626a4;"><span style="background-color:#ffffff;">in</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;"> data_loader:</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">      preds = model(data)</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">      preds = torch.squeeze((preds &gt;= </span></span><span style="color:#986801;"><span style="background-color:#ffffff;">0.0</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">).long())</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">      labels = labels[:,</span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">0</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">] </span></span><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">if</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;"> classification_of == </span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">'valence'</span></span> <span style="color:#a626a4;"><span style="background-color:#f8f8f8;">else</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;"> labels[:,</span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">1</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">]</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#f8f8f8;">      <span style="color:#a626a4;"><span style="background-color:#f8f8f8;">assert</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;"> preds.shape == labels.shape</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">      num_corrects += torch.sum((preds == labels).long())</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">  model.train()</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#f8f8f8;">  <span style="color:#a626a4;"><span style="background-color:#f8f8f8;">return</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;"> (num_corrects / num_examples).item()</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">def</span></span> <span style="color:#4078f2;"><span style="background-color:#f8f8f8;">train</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">(</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">  model,</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">  train_loader,</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">  criterion,</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">  optimizer,</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">  classification_of=</span></span><span style="color:#50a14f;"><span style="background-color:#ffffff;">'valence'</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">,</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">  num_epochs=</span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">100</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">,</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">  do_check_accuracy=True,</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">  test_loader=None,</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">  model_path=None,</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">  model_name=None,</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">  check_accuracy_every=</span></span><span style="color:#986801;"><span style="background-color:#ffffff;">50</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">)</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">;</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">  model.train()</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">  best_acc_test_set = </span></span><span style="color:#986801;"><span style="background-color:#ffffff;">0.0</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">  avg_loss_per_epoch = []</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">  accuracy_per_epoch = []</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#f8f8f8;">  <span style="color:#a626a4;"><span style="background-color:#f8f8f8;">for</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;"> epoch_n </span></span><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">in</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;"> range(</span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">1</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">, num_epochs+</span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">1</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">):</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">    epoch_losses = []</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#ffffff;">    <span style="color:#a626a4;"><span style="background-color:#ffffff;">for</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;"> batch_i, (data, labels) </span></span><span style="color:#a626a4;"><span style="background-color:#ffffff;">in</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;"> enumerate(train_loader, start=</span></span><span style="color:#986801;"><span style="background-color:#ffffff;">1</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">):</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">      preds = torch.squeeze(model(data))</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">      labels = labels[:,</span></span><span style="color:#986801;"><span style="background-color:#ffffff;">0</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">].float() </span></span><span style="color:#a626a4;"><span style="background-color:#ffffff;">if</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;"> classification_of == </span></span><span style="color:#50a14f;"><span style="background-color:#ffffff;">'valence'</span></span> <span style="color:#a626a4;"><span style="background-color:#ffffff;">else</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;"> labels[:,</span></span><span style="color:#986801;"><span style="background-color:#ffffff;">1</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">].float()</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">      loss = criterion(preds, labels)</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;">      </span></li><li style="text-align:left;"><span style="background-color:#ffffff;">      <span style="color:#a626a4;"><span style="background-color:#ffffff;">if</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;"> len(data) == train_loader.batch_size:</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">        epoch_losses.append(loss.item())</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">      optimizer.zero_grad()</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">      loss.backward()</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">      optimizer.step()</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">      print(</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">f'\rEPOCH </span></span><span style="color:#e45649;"><span style="background-color:#f8f8f8;">{epoch_n}</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">/</span></span><span style="color:#e45649;"><span style="background-color:#f8f8f8;">{num_epochs}</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">: batch </span></span><span style="color:#e45649;"><span style="background-color:#f8f8f8;">{batch_i}</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">: </span></span><span style="color:#e45649;"><span style="background-color:#f8f8f8;">{loss:</span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">.3</span></span><span style="color:#e45649;"><span style="background-color:#f8f8f8;">f}</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">'</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">, end=</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">''</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">)</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">    avg_epoch_loss = np.mean(epoch_losses)</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">    avg_loss_per_epoch.append(avg_epoch_loss)</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">    print(</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">f' (Avg epoch loss = </span></span><span style="color:#e45649;"><span style="background-color:#f8f8f8;">{avg_epoch_loss:</span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">.3</span></span><span style="color:#e45649;"><span style="background-color:#f8f8f8;">f}</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">)'</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">, end=</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">''</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">)</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#f8f8f8;">    <span style="color:#a626a4;"><span style="background-color:#f8f8f8;">if</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;"> do_check_accuracy </span></span><span style="color:#a626a4;"><span style="background-color:#f8f8f8;">and</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;"> epoch_n % check_accuracy_every == </span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">0</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">:</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;">      <span style="color:#a626a4;"><span style="background-color:#ffffff;">if</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;"> test_loader == </span></span><span style="color:#0184bb;"><span style="background-color:#ffffff;">None</span></span> <span style="color:#a626a4;"><span style="background-color:#ffffff;">or</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;"> model_path == </span></span><span style="color:#0184bb;"><span style="background-color:#ffffff;">None</span></span> <span style="color:#a626a4;"><span style="background-color:#ffffff;">or</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;"> model_name == </span></span><span style="color:#0184bb;"><span style="background-color:#ffffff;">None</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">:</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;">        <span style="color:#a626a4;"><span style="background-color:#f8f8f8;">assert</span></span> <span style="color:#0184bb;"><span style="background-color:#f8f8f8;">False</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">      print(</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">'\nChecking accuracy on training set... '</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">, end=</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">' '</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">)</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">      acc_train_set = check_accuracy(model, train_loader, classification_of=classification_of)</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">      print(</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">f'</span></span><span style="color:#e45649;"><span style="background-color:#f8f8f8;">{(acc_train_set*</span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">100</span></span><span style="color:#e45649;"><span style="background-color:#f8f8f8;">):</span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">.2</span></span><span style="color:#e45649;"><span style="background-color:#f8f8f8;">f}</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">%'</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">)</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">      print(</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">'Testing accuracy on test set...'</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">, end=</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">' '</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">)</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">      acc_test_set = check_accuracy(model, test_loader, classification_of=classification_of)</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">      print(</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">f'</span></span><span style="color:#e45649;"><span style="background-color:#f8f8f8;">{(acc_test_set * </span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">100</span></span><span style="color:#e45649;"><span style="background-color:#f8f8f8;">):</span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">.2</span></span><span style="color:#e45649;"><span style="background-color:#f8f8f8;">f}</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">%'</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">)</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">      accuracy_per_epoch.append(acc_test_set)</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#ffffff;">      <span style="color:#a626a4;"><span style="background-color:#ffffff;">if</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;"> acc_test_set &gt; best_acc_test_set:</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">        save_model(model, model_path=model_path, model_name=model_name)</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">        best_acc_test_set = acc_test_set</span></span></span></li><li style="text-align:left;"><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">  print(</span></span><span style="color:#50a14f;"><span style="background-color:#ffffff;">'\n'</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">)</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;">  </span></li><li style="text-align:left;"><span style="background-color:#ffffff;">  <span style="color:#a626a4;"><span style="background-color:#ffffff;">if</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;"> best_acc_test_set != </span></span><span style="color:#986801;"><span style="background-color:#ffffff;">0.0</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;">:</span></span></span></li><li style="text-align:left;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">    print(</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">f'Best accuracy on test set: </span></span><span style="color:#e45649;"><span style="background-color:#f8f8f8;">{(best_acc_test_set*</span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">100</span></span><span style="color:#e45649;"><span style="background-color:#f8f8f8;">):</span></span><span style="color:#986801;"><span style="background-color:#f8f8f8;">.2</span></span><span style="color:#e45649;"><span style="background-color:#f8f8f8;">f}</span></span><span style="color:#50a14f;"><span style="background-color:#f8f8f8;">%'</span></span><span style="color:#5c5c5c;"><span style="background-color:#f8f8f8;">)</span></span></span></li><li style="text-align:left;"><span style="background-color:#ffffff;">    <span style="color:#a626a4;"><span style="background-color:#ffffff;">return</span></span><span style="color:#5c5c5c;"><span style="background-color:#ffffff;"> best_acc_test_set</span></span></span></li></ol> 
<p style="margin-left:.0001pt;text-align:justify;">写于2024-1-17</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/af35c95d91fd4e4f67ca9d7a9f260b8c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">three.js从入门到精通系列教程005 - three.js使用鼠标拖拽缩放浏览全景图</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a6574bc5ba7ca657657d448e1f515726/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">在 Spring MVC 中，用于接收前端传递的参数的注解常用的有以下几种</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>