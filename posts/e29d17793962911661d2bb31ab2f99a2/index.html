<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>RandomAccessFile学习笔记 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="RandomAccessFile学习笔记" />
<meta property="og:description" content="文章目录 RandomAccessFile学习笔记前言1、RandomAccessFile基本介绍1.1 RandomAccessFile相关基本概念1.2 RandomAccessFile家族体系 2、RandomAccessFile基本使用2.1 RandomAccessFile常用API介绍2.2 RandomAccessFile常用API演示2.3 RandomAccessFile实现断点续传 RandomAccessFile学习笔记 前言 本文将简要介绍RandomAccessFile这个类的使用，主要包括RandomAccessFile相关的一些概念，常见API的使用，如何利用RandomAccessFile实现一个断点续传的效果
1、RandomAccessFile基本介绍 1.1 RandomAccessFile相关基本概念 RandomAccessFile是什么？
RandomAccessFile 是 Java 中用于对文件进行随机访问的类。与普通的输入输出流不同，RandomAccessFile 允许在文件中任意位置读写数据。
RandomAccessFile的作用有哪些？
随机访问：与其他输入输出流不同，RandomAccessFile 允许在文件中任意位置进行读写操作，可以自由地定位文件指针。读写基本数据类型：RandomAccessFile 实现了 DataInput 和 DataOutput 接口，提供了方便的方法用于读取和写入基本数据类型。支持读写字节数组：除了读写基本数据类型外，还可以通过 read(byte[] buffer) 和 write(byte[] buffer) 方法来读写字节数组。支持文件截断：可以使用 setLength(long newLength) 方法来调整文件的长度，将文件截断或扩展为指定的大小。 常见的应用场景是使用 RandomAccessFile 实现断点续传
注意事项：RandomAccessFile只能读写文件（也就是字节数组）类型的数据，并不能读写流类型的数据
RandomAccessFile的四种访问模式
访问模式特点r（read，只读模式）能读文件，不能写文件、持久化rw（read write，读写模式）能读、写文件，不能持久化rws（read write sync，同步读写模式）能读、写文件，每次写操作都会持久化rwd（read write data，同步写模式）能读、写文件，只有在调用close()、getFD().sync()、关闭程序时才进行持久化 “r”（只读模式）：使用只读模式打开文件，只能对文件进行读取操作，无法修改文件内容。“rw”（读写模式）：使用读写模式打开文件，允许对文件进行读取和写入操作，并且可以修改文件内容。“rws”（同步读写模式）：使用同步读写模式打开文件，除了具有读写模式的功能外，还要求每次写入操作都要将数据同步刷新到底层存储介质（如硬盘）。在使用 rws 模式打开文件时，每次进行写入操作时，不仅会将数据写入到内存缓冲区，还会立即将数据刷新到底层存储介质（如硬盘）。这样可以保证数据的持久性，并且在发生系统崩溃或断电等异常情况时，数据不会丢失。由于每次写入操作都要进行磁盘刷新，所以相比于 rwd 模式，rws 模式的写入速度可能较慢。“rwd”（同步写模式）：使用同步写模式打开文件，类似于同步读写模式，在使用 rwd 模式打开文件时，每次进行写入操作时，只有将数据写入到内存缓冲区，而不会立即刷新到底层存储介质。只有在调用 close() 方法、显式调用 getFD().sync() 方法或关闭程序时，才会将数据刷新到存储介质。相比于 rws 模式，rwd 模式的写入速度可能稍快，因为不需要每次都进行磁盘刷新。 适用场景说明：
如果文件只需要具有读操作，就使用 r 模式；如果文件既需要读又需要写，同时对持久化没有要求，就可以用 rw 模式；如果文件既需要读又需要写，同时对持久化有要求严格或者是读多写少的情况，推荐使用 rws 模式如果文件既需要读又需要写，同时对持久化有要求不是很严格 或者是 读少写多，推荐使用 rwd 模式 1." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/e29d17793962911661d2bb31ab2f99a2/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-29T13:41:54+08:00" />
<meta property="article:modified_time" content="2023-11-29T13:41:54+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">RandomAccessFile学习笔记</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#RandomAccessFile_1" rel="nofollow">RandomAccessFile学习笔记</a></li><li><ul><li><a href="#_3" rel="nofollow">前言</a></li><li><a href="#1RandomAccessFile_5" rel="nofollow">1、RandomAccessFile基本介绍</a></li><li><ul><li><a href="#11_RandomAccessFile_7" rel="nofollow">1.1 RandomAccessFile相关基本概念</a></li><li><a href="#12_RandomAccessFile_45" rel="nofollow">1.2 RandomAccessFile家族体系</a></li></ul> 
   </li><li><a href="#2RandomAccessFile_58" rel="nofollow">2、RandomAccessFile基本使用</a></li><li><ul><li><a href="#21_RandomAccessFileAPI_60" rel="nofollow">2.1 RandomAccessFile常用API介绍</a></li><li><a href="#22_RandomAccessFileAPI_101" rel="nofollow">2.2 RandomAccessFile常用API演示</a></li><li><a href="#23_RandomAccessFile_277" rel="nofollow">2.3 RandomAccessFile实现断点续传</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="RandomAccessFile_1"></a>RandomAccessFile学习笔记</h2> 
<h3><a id="_3"></a>前言</h3> 
<blockquote> 
 <p>本文将简要介绍<code>RandomAccessFile</code>这个类的使用，主要包括RandomAccessFile相关的一些概念，常见API的使用，如何利用RandomAccessFile实现一个断点续传的效果</p> 
</blockquote> 
<h3><a id="1RandomAccessFile_5"></a>1、RandomAccessFile基本介绍</h3> 
<h4><a id="11_RandomAccessFile_7"></a>1.1 RandomAccessFile相关基本概念</h4> 
<ul><li> <p><strong>RandomAccessFile是什么</strong>？</p> 
  <blockquote> 
   <p><code>RandomAccessFile</code> 是 Java 中用于对文件进行随机访问的类。与普通的输入输出流不同，<code>RandomAccessFile</code> 允许在文件中任意位置读写数据。</p> 
  </blockquote> </li><li> <p><strong>RandomAccessFile的作用有哪些</strong>？</p> 
  <ul><li><strong>随机访问</strong>：与其他输入输出流不同，<code>RandomAccessFile</code> 允许在文件中任意位置进行读写操作，可以自由地定位文件指针。</li><li><strong>读写基本数据类型</strong>：<code>RandomAccessFile</code> 实现了 <code>DataInput</code> 和 <code>DataOutput</code> 接口，提供了方便的方法用于读取和写入基本数据类型。</li><li><strong>支持读写字节数组</strong>：除了读写基本数据类型外，还可以通过 <code>read(byte[] buffer)</code> 和 <code>write(byte[] buffer)</code> 方法来读写字节数组。</li><li><strong>支持文件截断</strong>：可以使用 <code>setLength(long newLength)</code> 方法来调整文件的长度，将文件截断或扩展为指定的大小。</li></ul> <p>常见的应用场景是使用 <code>RandomAccessFile</code> 实现断点续传</p> <p><mark>注意事项</mark>：<code>RandomAccessFile</code>只能读写文件（也就是字节数组）类型的数据，并不能读写流类型的数据</p> </li><li> <p><strong>RandomAccessFile的四种访问模式</strong></p> 
  <table><thead><tr><th>访问模式</th><th>特点</th></tr></thead><tbody><tr><td><code>r</code>（read，只读模式）</td><td>能读文件，不能写文件、持久化</td></tr><tr><td><code>rw</code>（read write，读写模式）</td><td>能读、写文件，不能持久化</td></tr><tr><td><code>rws</code>（read write sync，同步读写模式）</td><td>能读、写文件，每次写操作都会持久化</td></tr><tr><td><code>rwd</code>（read write data，同步写模式）</td><td>能读、写文件，只有在调用close()、getFD().sync()、关闭程序时才进行持久化</td></tr></tbody></table> 
  <ul><li>“<code>r</code>”（只读模式）：使用只读模式打开文件，只能对文件进行读取操作，无法修改文件内容。</li><li>“<code>rw</code>”（读写模式）：使用读写模式打开文件，允许对文件进行读取和写入操作，并且可以修改文件内容。</li><li>“<code>rws</code>”（同步读写模式）：使用同步读写模式打开文件，除了具有读写模式的功能外，还要求每次写入操作都要将数据同步刷新到底层存储介质（如硬盘）。在使用 <code>rws</code> 模式打开文件时，每次进行写入操作时，不仅会将数据写入到内存缓冲区，还会立即将数据刷新到底层存储介质（如硬盘）。这样可以保证数据的持久性，并且在发生系统崩溃或断电等异常情况时，数据不会丢失。由于每次写入操作都要进行磁盘刷新，所以相比于 <code>rwd</code> 模式，<code>rws</code> 模式的写入速度可能较慢。</li><li>“<code>rwd</code>”（同步写模式）：使用同步写模式打开文件，类似于同步读写模式，在使用 <code>rwd</code> 模式打开文件时，每次进行写入操作时，只有将数据写入到内存缓冲区，而不会立即刷新到底层存储介质。只有在调用 <code>close()</code> 方法、显式调用 <code>getFD().sync()</code> 方法或关闭程序时，才会将数据刷新到存储介质。相比于 <code>rws</code> 模式，<code>rwd</code> 模式的写入速度可能稍快，因为不需要每次都进行磁盘刷新。</li></ul> <p>适用场景说明：</p> 
  <ol><li>如果文件只需要具有读操作，就使用 r 模式；</li><li>如果文件既需要读又需要写，同时对持久化没有要求，就可以用 rw 模式；</li><li>如果文件既需要读又需要写，同时对持久化有要求严格或者是读多写少的情况，推荐使用 rws 模式</li><li>如果文件既需要读又需要写，同时对持久化有要求不是很严格 或者是 读少写多，推荐使用 rwd 模式</li></ol> </li></ul> 
<h4><a id="12_RandomAccessFile_45"></a>1.2 RandomAccessFile家族体系</h4> 
<ul><li> <p><strong>RandomAccessFile家族体系</strong></p> <p><img src="https://images2.imgbox.com/5c/ad/82iXgltR_o.png" alt="image-20230826185124272"></p> <p><img src="https://images2.imgbox.com/e9/66/NTNidEe5_o.png" alt="image-20230826185142134"></p> 
  <ul><li><code>java.io.DataOutput</code>：<code>DataOutput</code> 接口提供了写入基本数据类型的方法，用于将数据以二进制格式写入输出流。<code>RandomAccessFile</code> 类实现了 <code>DataOutput</code> 接口，因此可以使用该接口定义的方法写入数据。</li><li><code>java.io.DataInput</code>：<code>DataInput</code> 接口定义了读取基本数据类型的方法，用于从输入流中以二进制格式读取数据。<code>RandomAccessFile</code> 类实现了 <code>DataInput</code> 接口，因此可以使用该接口定义的方法读取数据。</li><li><code>java.io.Closeable</code>：<code>Closeable</code> 是一个可关闭的接口，表示实现了该接口的类具备关闭资源的能力。<code>RandomAccessFile</code> 类实现了 <code>Closeable</code> 接口，因此可以通过调用 <code>close()</code> 方法关闭文件。</li><li><code>java.lang.AutoCloseable</code>：<code>AutoCloseable</code> 是一个自动关闭的接口，在 Java 7 中引入。它扩展了 <code>Closeable</code> 接口，并要求实现类必须提供一个细化的 <code>close()</code> 方法。<code>RandomAccessFile</code> 实现了 <code>AutoCloseable</code> 接口，所以可以使用 try-with-resources 语句来自动关闭文件。</li></ul> </li></ul> 
<h3><a id="2RandomAccessFile_58"></a>2、RandomAccessFile基本使用</h3> 
<h4><a id="21_RandomAccessFileAPI_60"></a>2.1 RandomAccessFile常用API介绍</h4> 
<ul><li> <p><strong>构造方法</strong>：</p> 
  <ul><li><code>RandomAccessFile(String name, String mode)</code>：创建一个具有指定名称的RandomAccessFile对象，并根据指定的模式打开文件。模式可以是"r"（只读），“rw”（读写）等。</li></ul> </li><li> <p><strong>读取方法</strong>：</p> 
  <ul><li> <p><code>int read()</code>：从文件中读取一个字节并返回该字节的整数值。</p> </li><li> <p><code>int read(byte[] b)</code>：从文件中读取一定数量的字节并存储到字节数组b中，并返回实际读取的字节数。</p> </li><li> <p><code>int read(byte[] b, int off, int len)</code>：从文件中读取最多len个字节，并将其存储到字节数组b中，偏移量为off，并返回实际读取的字节数。</p> </li><li> <p><code>int skipBytes(int n)</code>：跳过指定字节读（<mark>相对位置</mark>）</p> </li></ul> </li><li> <p><strong>写入方法</strong>：</p> 
  <ul><li> <p><code>void write(int b)</code>：将一个字节写入文件。</p> </li><li> <p><code>void write(byte[] b)</code>：将字节数组b中的所有字节写入文件。</p> </li><li> <p><code>void write(byte[] b, int off, int len)</code>：将字节数组b中从偏移量off开始的len个字节写入文件。</p> </li></ul> </li><li> <p><strong>文件操作方法</strong>：</p> 
  <ul><li> <p><code>boolean exists()</code>：判断文件是否存在。</p> </li><li> <p><code>void createNewFile()</code>：创建一个新文件。</p> </li><li> <p><code>boolean delete()</code>：删除文件。</p> </li><li> <p><code>boolean renameTo(File dest)</code>：将文件重命名为dest指定的文件名。</p> </li><li> <p><code>long getFilePointer()</code>：返回当前文件指针的位置。</p> </li><li> <p><code>void seek(long pos)</code>：设置文件指针的位置为pos。（<mark>绝对位置</mark>）</p> </li></ul> </li><li> <p><strong>文件长度相关方法</strong>：</p> 
  <ul><li> <p><code>long length()</code>：返回文件的长度（以字节为单位）。</p> </li><li> <p><code>void setLength(long newLength)</code>：设置文件的长度为newLength。</p> </li></ul> </li><li> <p><strong>关闭方法</strong>：</p> 
  <ul><li><code>void close()</code>：关闭该RandomAccessFile对象，释放相关资源</li></ul> </li></ul> 
<h4><a id="22_RandomAccessFileAPI_101"></a>2.2 RandomAccessFile常用API演示</h4> 
<p><strong>环境搭建</strong></p> 
<ul><li> <p><strong>Step1</strong>：创建一个Maven工程</p> </li><li> <p><strong>Step2</strong>：在<code>src/main/resources</code>目录下准备一个 <code>data.txt</code> 文件，文件中的内容是</p> <pre><code class="prism language-txt">hello world!
</code></pre> </li></ul> 
<p><strong>示例一</strong></p> 
<blockquote> 
 <p>演示<code>read</code>方法</p> 
</blockquote> 
<pre><code class="prism language-java">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">RandomAccessFile</span> raf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RandomAccessFile</span><span class="token punctuation">(</span><span class="token string">"./src/main/resources/data.txt"</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 读取一个字节，此时已经读取了 h，data.txt 还剩 ello world!没有读取</span>
        raf<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment">// 将从data.txt中读取的数据转存到字节数组中</span>
        <span class="token keyword">int</span> len <span class="token operator">=</span> raf<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 由于在 raf.read(bytes) 之前执行过一个 raf.read() 方法了，所以此时字节数组中会直接跳过第一个字节的数组</span>
        <span class="token comment">// 由于UTF-8编码英文一个字母占一个字节（中文占3个字节）所以最终结果回漏掉 data.txt 中的首字母</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>bytes<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ello world!</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>备注：data.txt 中一个空格也算一个字节</p> 
<p><strong>示例二</strong></p> 
<blockquote> 
 <p>演示<code>skipBytes</code></p> 
</blockquote> 
<pre><code class="prism language-java">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">RandomAccessFile</span> raf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RandomAccessFile</span><span class="token punctuation">(</span><span class="token string">"./src/main/resources/data.txt"</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 读取一个字节，此时已经读取了 h，data.txt 还剩 ello world!没有读取</span>
        raf<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 相对当前读取位置（也就是 ello world!）再跳过两个字节 e 和 l，此时 data.txt 还剩 lo world! 没有读取</span>
        raf<span class="token punctuation">.</span><span class="token function">skipBytes</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> len <span class="token operator">=</span> raf<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>bytes<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// lo world!</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p><strong>示例三</strong></p> 
<blockquote> 
 <p>演示<code>seek</code></p> 
</blockquote> 
<pre><code class="prism language-java">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">RandomAccessFile</span> raf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RandomAccessFile</span><span class="token punctuation">(</span><span class="token string">"./src/main/resources/data.txt"</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 读取一个字节，此时已经读取了 h，data.txt 还剩 ello world!没有读取</span>
        raf<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 相对 data.txt 原始位置（也就是 hello world!）跳过2个字节，此时 data.txt 还剩 llo world! 没有读取</span>
        raf<span class="token punctuation">.</span><span class="token function">seek</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> len <span class="token operator">=</span> raf<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>bytes<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// llo world!</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p><strong>示例四</strong></p> 
<blockquote> 
 <p>演示<code>write</code></p> 
</blockquote> 
<pre><code class="prism language-java">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">RandomAccessFile</span> raf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RandomAccessFile</span><span class="token punctuation">(</span><span class="token string">"./src/main/resources/data.txt"</span><span class="token punctuation">,</span> <span class="token string">"rw"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 此时直接调用write方法，是从文件的第一个字节开始写， data.txt 变成了 ghplo world!</span>
        <span class="token comment">// 同时此时指针也会随着写操作来到了 l</span>
        raf<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"ghp"</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// raf.seek(0);</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> len <span class="token operator">=</span> raf<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 由于之前的写操作，导致指针来到了 l，所以读操作从 l 开始读，所以最终读取的结果是 lo world!</span>
        <span class="token comment">// 并不会读取到之前写入的数据</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>bytes<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// lo world!</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>备注：想要写入之后能够读取到 data.txt 中完整的数据，可以在执行完写操作之后，执行<code>seek(0)</code>将指针重置为初始位置，注意如果使用<code>skipBytes(0)</code>是没有效果的，因为它是相对位置</p> 
<p><strong>示例五</strong></p> 
<blockquote> 
 <p>比较 原始输入输出流单线程拷贝大文件 和 RandomAccessFile实现多线程拷贝大文件</p> 
</blockquote> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ghp<span class="token punctuation">.</span>file<span class="token punctuation">.</span>test</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">CountDownLatch</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author ghp
 * @title
 * @description
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">long</span> startTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        copyFileBySingleThread(); // 单线程拷贝 476MB 的视频耗时 6903ms</span>
        <span class="token function">copyFileByMultiThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 多线程拷贝 476MB 的视频耗时 3022ms</span>
        <span class="token keyword">long</span> endTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"文件拷贝耗时: "</span> <span class="token operator">+</span> <span class="token punctuation">(</span>endTime <span class="token operator">-</span> startTime<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"ms"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">copyFileBySingleThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"./src/main/resources/data.mp4"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">FileInputStream</span> fis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">FileOutputStream</span> fos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token string">"./src/main/resources/data-bak1.mp4"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>len <span class="token operator">=</span> fis<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            fos<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>bytes<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">copyFileByMultiThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"./src/main/resources/data.mp4"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> threadNum <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
        <span class="token comment">// 计算每个线程需要读取的字节大小</span>
        <span class="token keyword">int</span> part <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> threadNum<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 创建线程计数器对象，用于阻塞主线程</span>
        <span class="token class-name">CountDownLatch</span> latch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span>threadNum<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> threadNum<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">final</span> <span class="token keyword">int</span> k <span class="token operator">=</span> i<span class="token punctuation">;</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token class-name">RandomAccessFile</span> fis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RandomAccessFile</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">RandomAccessFile</span> fos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RandomAccessFile</span><span class="token punctuation">(</span><span class="token string">"./src/main/resources/data-bak.mp4"</span><span class="token punctuation">,</span> <span class="token string">"rw"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">// 设置读和写的位置</span>
                    fis<span class="token punctuation">.</span><span class="token function">seek</span><span class="token punctuation">(</span>k <span class="token operator">*</span> part<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    fos<span class="token punctuation">.</span><span class="token function">seek</span><span class="token punctuation">(</span>k <span class="token operator">*</span> part<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                    <span class="token keyword">int</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token keyword">int</span> len <span class="token operator">=</span> fis<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>len <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                            <span class="token comment">// 文件已经读完了</span>
                            <span class="token keyword">break</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                        sum <span class="token operator">+=</span> len<span class="token punctuation">;</span>
                        fos<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>bytes<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>sum <span class="token operator">&gt;=</span> part<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                            <span class="token comment">// 当前线程需要读取的字节已经读完了</span>
                            <span class="token keyword">break</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">// 子线程执行完毕，线程计数器减一</span>
                    latch<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 阻塞主线程，只有线程计数器归0，主线程才会继续执行</span>
        latch<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<p><mark>注意点</mark>：</p> 
<ol><li>文件的切分必须是向上取整，否则回存在数据遗漏。向上取整能够保证即使多读了数据也会被覆盖避免数据遗漏，不会发生数据堆叠，而如果是向下取整就会导致数据遗漏</li><li>当前线程是否已经将自己那部分字节读取完毕的判断操作要在写操作之后，这样能够防止数据遗漏，判断操作放在写操作的后面，即使多写了数据，会被覆盖掉</li></ol> 
<h4><a id="23_RandomAccessFile_277"></a>2.3 RandomAccessFile实现断点续传</h4> 
<pre><code class="prism language-java"><span class="token comment">/**
     * 断点续传
     *
     * @param src       源文件（需要拷贝的文件）
     * @param target    目标文件（拷贝后的文件）
     * @param threadNum 线程数
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">breakpointContinuation</span><span class="token punctuation">(</span><span class="token class-name">File</span> src<span class="token punctuation">,</span> <span class="token class-name">File</span> target<span class="token punctuation">,</span> <span class="token keyword">int</span> threadNum<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 每一个线程平均需要读取的字节数</span>
        <span class="token keyword">final</span> <span class="token keyword">int</span> part <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span>src<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> threadNum<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 创建应该HashMap，用于记录每一个线程已读取的位置</span>
        <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 读取日志文件中的数据</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> logDatas <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> logName <span class="token operator">=</span> target<span class="token punctuation">.</span><span class="token function">getCanonicalPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">".log"</span><span class="token punctuation">;</span>
        <span class="token class-name">File</span> logFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>logName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>logFile<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 日志文件存在，则从上一次读取的位置开始读</span>
            <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">BufferedReader</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span>logFile<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">String</span> data <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                logDatas <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">final</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> logData <span class="token operator">=</span> logDatas<span class="token punctuation">;</span>
        <span class="token class-name">CountDownLatch</span> latch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span>threadNum<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> threadNum<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">final</span> <span class="token keyword">int</span> k <span class="token operator">=</span> i<span class="token punctuation">;</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">RandomAccessFile</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RandomAccessFile</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                     <span class="token class-name">RandomAccessFile</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RandomAccessFile</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> <span class="token string">"rw"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                     <span class="token class-name">RandomAccessFile</span> log <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RandomAccessFile</span><span class="token punctuation">(</span>logName<span class="token punctuation">,</span> <span class="token string">"rw"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">// 从指定位置读</span>
                    <span class="token keyword">int</span> start <span class="token operator">=</span> logData <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> k <span class="token operator">*</span> part <span class="token operator">:</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>logData<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    in<span class="token punctuation">.</span><span class="token function">seek</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    out<span class="token punctuation">.</span><span class="token function">seek</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                    <span class="token keyword">int</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token keyword">int</span> len <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>len <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                            <span class="token comment">// 文件所有字节已读完，结束读取</span>
                            <span class="token keyword">break</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                        sum <span class="token operator">+=</span> len<span class="token punctuation">;</span>
                        <span class="token comment">// 记录当前线程已读取的位置</span>
                        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> sum <span class="token operator">+</span> start<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token comment">// 将读取到的数据、进行写入</span>
                        out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>bytes<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token comment">// 将 map 中的数据持久化</span>
                        log<span class="token punctuation">.</span><span class="token function">seek</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">StringJoiner</span> joiner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringJoiner</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        map<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> val<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> joiner<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        log<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>joiner<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>sum <span class="token operator">+</span> <span class="token punctuation">(</span>start<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> k<span class="token punctuation">)</span> <span class="token operator">*</span> part<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                            <span class="token comment">// 当前线程读取的字节数量已经够了，结束读取</span>
                            <span class="token keyword">break</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
                    latch<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        latch<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 读取完成后、将日志文件删除即可</span>
        <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>logName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p><strong>参考文章</strong>：</p> 
 <ul><li><a href="https://blog.csdn.net/qq_40100414/article/details/120179117">RandomAccessFile详解_江南煮酒的博客-CSDN博客</a></li><li><a href="https://www.w3schools.cn/javaio/java_io_randomaccessfile.asp" rel="nofollow">Java.io.RandomAccessFile 类 (w3schools.cn)</a></li><li><a href="https://cloud.tencent.com/developer/article/1925793" rel="nofollow">RandomAccessFile 解决多线程下载及断点续传-腾讯云开发者社区-腾讯云 (tencent.com)</a></li></ul> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d8d97acd1789b648e4e03833e8bee96d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">微信小程序 scrollview 滚动到指定位置</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6ad3eec041d945355d7ffd680e98f066/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">CentOS7安装MiniO</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>