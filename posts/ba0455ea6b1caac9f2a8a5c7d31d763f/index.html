<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>04-文件IO和标准IO - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="04-文件IO和标准IO" />
<meta property="og:description" content="IO 什么是IO #include &lt;stdio.h&gt;
std：standard 标准的
IO：input output
i：输入，数据从外部存储设备输入到内存中
o：输出，数据从内存到外部存储设备
存储设备：
1.硬件：机械硬盘，固态硬盘
2.内存：SDROM DDR4
总结：IO就是数据从硬盘到内存，内存到硬盘的流动
IO分类 1.文件IO
文件IO是由系统提供的基本IO函数，是与系统绑定的，又称之为系统调用
1.文件IO的复用性低
2.文件IO涉及到用户空间到内核空间的切换，cpu模式切换，C代码调用汇编指令等等。属于一种耗时操作，应该尽量减少文件IO的使用
3.每调用一次文件IO，就会进行一次空间切换
2.标准IO
标准IO是根据ANSI标准，对文件IO进行了二次封装(scanf printf)
if(操作系统 == windows){ w_input; }else if(操作系统 == ubuntu){ l_input; } 思考：既然有了文件IO，为什么还需要标准IO？
答案：为了达到代码的可移植性，让代码的复用性更高
作用：
1.提高代码的可移植性和复用性
2.提高代码的输入输出效率
设置了一个缓冲区，缓冲区满或者满足一定条件后，陷入到内核中，由内核完成对硬件的操作，大大减少了对文件IO的调用次数。
2.标准IO 1.流和流指针 1.概念
流(stream)：将数据一个一个地移入或移出文件的形式，叫做字节流；
流指针(FILE*)：每打开一个文件，就会在内存中申请一片空间（缓冲区），管理这片内存空间的变量都存储在FILE结构体中，FILE结构体由系统定义的，我们直接拿来用就好。
2.查看FILE结构体成员
$ vi -t FILE #可以用于查看系统提供的数据类型，结构体，变量，宏定义 输入1 struct _IO_FILE { int _flags; /* High-order word is _IO_MAGIC; rest is flags. #define _IO_file_flags _flags /* The following pointers correspond to the C&#43;&#43; streambuf protoco /* Note: Tk uses the _IO_read_ptr and _IO_read_end fields direct char* _IO_read_ptr; /* Current read pointer */ char* _IO_read_end; /* End of get area." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/ba0455ea6b1caac9f2a8a5c7d31d763f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-10-23T22:27:29+08:00" />
<meta property="article:modified_time" content="2020-10-23T22:27:29+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">04-文件IO和标准IO</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="IO_0"></a>IO</h2> 
<h3><a id="IO_1"></a>什么是IO</h3> 
<p><code>#include &lt;stdio.h&gt;</code></p> 
<blockquote> 
 <p>std：standard 标准的<br> IO：input output<br> i：输入，数据从外部存储设备输入到内存中<br> o：输出，数据从内存到外部存储设备</p> 
</blockquote> 
<blockquote> 
 <p>存储设备：<br> 1.硬件：机械硬盘，固态硬盘<br> 2.内存：SDROM DDR4<br> 总结：IO就是数据从硬盘到内存，内存到硬盘的流动</p> 
</blockquote> 
<h3><a id="IO_12"></a>IO分类</h3> 
<p>1.文件IO<br> 文件IO是由系统提供的基本IO函数，是与系统绑定的，又称之为系统调用</p> 
<blockquote> 
 <p>1.文件IO的复用性低<br> 2.文件IO涉及到用户空间到内核空间的切换，cpu模式切换，C代码调用汇编指令等等。属于一种耗时操作，应该尽量减少文件IO的使用<br> 3.每调用一次文件IO，就会进行一次空间切换</p> 
</blockquote> 
<p>2.标准IO<br> 标准IO是根据ANSI标准，对文件IO进行了二次封装(scanf printf)</p> 
<pre><code class="prism language-c"><span class="token keyword">if</span><span class="token punctuation">(</span>操作系统 <span class="token operator">==</span> windows<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	w_input<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>操作系统 <span class="token operator">==</span> ubuntu<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	l_input<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p>思考：既然有了文件IO，为什么还需要标准IO？<br> 答案：为了达到代码的可移植性，让代码的复用性更高</p> 
</blockquote> 
<p>作用：<br> 1.提高代码的可移植性和复用性<br> 2.提高代码的输入输出效率<br> 设置了一个缓冲区，缓冲区满或者满足一定条件后，陷入到内核中，由内核完成对硬件的操作，大大减少了对文件IO的调用次数。</p> 
<h2><a id="2IO_36"></a>2.标准IO</h2> 
<h3><a id="1_37"></a>1.流和流指针</h3> 
<p>1.概念<br> 流(stream)：将数据一个一个地移入或移出文件的形式，叫做字节流；<br> 流指针(FILE*)：每打开一个文件，就会在内存中申请一片空间（缓冲区），管理这片内存空间的变量都存储在FILE结构体中，FILE结构体由系统定义的，我们直接拿来用就好。</p> 
<p>2.查看FILE结构体成员</p> 
<pre><code class="prism language-bash">$ <span class="token function">vi</span> -t FILE <span class="token comment">#可以用于查看系统提供的数据类型，结构体，变量，宏定义</span>
输入1
</code></pre> 
<pre><code class="prism language-c"><span class="token keyword">struct</span> _IO_FILE <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">int</span> _flags<span class="token punctuation">;</span>       <span class="token comment">/* High-order word is _IO_MAGIC; rest is flags.
#define _IO_file_flags _flags
                                                                   
  /* The following pointers correspond to the C++ streambuf protoco
  /* Note:  Tk uses the _IO_read_ptr and _IO_read_end fields direct
  char* _IO_read_ptr;   /* Current read pointer */</span>
  <span class="token keyword">char</span><span class="token operator">*</span> _IO_read_end<span class="token punctuation">;</span>   <span class="token comment">/* End of get area. */</span>
  <span class="token keyword">char</span><span class="token operator">*</span> _IO_read_base<span class="token punctuation">;</span>  <span class="token comment">/* Start of putback+get area. */</span>
  <span class="token keyword">char</span><span class="token operator">*</span> _IO_write_base<span class="token punctuation">;</span> <span class="token comment">/* Start of put area. */</span>
  <span class="token keyword">char</span><span class="token operator">*</span> _IO_write_ptr<span class="token punctuation">;</span>  <span class="token comment">/* Current put pointer. */</span>
  <span class="token keyword">char</span><span class="token operator">*</span> _IO_write_end<span class="token punctuation">;</span>  <span class="token comment">/* End of put area. */</span>
  <span class="token keyword">char</span><span class="token operator">*</span> _IO_buf_base<span class="token punctuation">;</span>   <span class="token comment">/* Start of reserve area. */</span> 缓冲区的起始地址
  <span class="token keyword">char</span><span class="token operator">*</span> _IO_buf_end<span class="token punctuation">;</span>    <span class="token comment">/* End of reserve area. */</span> 缓冲区的结尾地址
  <span class="token comment">/* The following fields are used to support backing up and undo. 
  char *_IO_save_base; /* Pointer to start of non-current get area.
  char *_IO_backup_base;  /* Pointer to first valid character of ba
  char *_IO_save_end; /* Pointer to end of non-current get area. */</span>

  <span class="token keyword">struct</span> _IO_marker <span class="token operator">*</span>_markers<span class="token punctuation">;</span>

  <span class="token keyword">struct</span> _IO_FILE <span class="token operator">*</span>_chain<span class="token punctuation">;</span>

  <span class="token keyword">int</span> _fileno<span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-shell">安装vim: 	vimconfig.tar.bz2
	1.	<span class="token function">tar</span> –xvf vimconfig.tar.bz2
	2. 	执行 <span class="token function">ping</span> ww.baidu.com 	保证有网络
	3.	<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> vim 		安装vim
	4. 	./config.sh 				进入解压目录（vimconfig）
</code></pre> 
<p>3.标准输入输出流</p> 
<blockquote> 
 <p>在main函数启动之前，会默认打开三个流指针：<br> stdin -----标注输入-----从终端获取数据<br> stdout -----标准输出-----将数据输出到终端<br> stderr -----标准错误输出</p> 
</blockquote> 
<h3><a id="2IO_87"></a>2.标准IO函数</h3> 
<h4><a id="1IO_88"></a>1.常见的标准IO函数</h4> 
<pre><code class="prism language-c">fopen	<span class="token operator">/</span>fclose	打开<span class="token operator">/</span>关闭一个文件
fprintf <span class="token operator">/</span>fscanf 将标准格式化数据输出到文件中<span class="token operator">/</span>从文件标准格式化获取数据
fputc   <span class="token operator">/</span>fgetc  将单个字符输出到文件中<span class="token operator">/</span>从文件中获取单个字符
fputs   <span class="token operator">/</span>fgets  将字符串输出到文件中<span class="token operator">/</span>从文件中获取字符串
fwrite  <span class="token operator">/</span>fread  将数据的二进制数输出<span class="token operator">/</span>输入到文件中
fseek           偏移文件指针
</code></pre> 
<h4><a id="2man_98"></a>2.man手册</h4> 
<pre><code class="prism language-shell"><span class="token variable">$man</span> <span class="token function">man</span> <span class="token comment">#查看man手册</span>
 1   Executable programs or shell commands <span class="token comment">#linux的shell指令</span>
 2   System calls <span class="token punctuation">(</span>functions provided by the kernel<span class="token punctuation">)</span>  <span class="token comment">#Linux的系统调用(文件IO)</span>
 3   Library calls <span class="token punctuation">(</span>functions within program libraries<span class="token punctuation">)</span> <span class="token comment">#Linux的库调用(标准IO)</span>
</code></pre> 
<h4><a id="3IO_106"></a>3.标准IO函数的使用</h4> 
<h5><a id="1fopen_107"></a>1.fopen</h5> 
<blockquote> 
 <p>fopen<br> 功能：打开一个文件<br> 头文件：<br> <code>#include &lt;stdio.h&gt;</code><br> 原型：<br> <code>FILE *fopen(const char *path, const char *mode);</code><br> 参数：<br> <code>char *path</code>：指定要打开的文件的路径<br> <code>char *mode</code>：文件的打开方式<br> 返回值：<br> 成功返回打开的流指针<br> 失败返回NULL，更新errno</p> 
</blockquote> 
<pre><code class="prism language-c">r      Open text file <span class="token keyword">for</span> reading<span class="token punctuation">.</span>  The stream is positioned at the beginning of the file<span class="token punctuation">.</span>
<span class="token comment">//以只读的方式打开；</span>
r<span class="token operator">+</span>     Open <span class="token keyword">for</span> reading and writing<span class="token punctuation">.</span>  The stream is positioned at the beginning of the file<span class="token punctuation">.</span>
<span class="token comment">//以读写的方式打开，如果文件不存在，打开文件失败;</span>
w      Truncate file to zero length or create text file <span class="token keyword">for</span> writing<span class="token punctuation">.</span>  The stream is positioned at the beginning of the file<span class="token punctuation">.</span>
<span class="token comment">//以写的方式打开，如果文件不存在，则创建该文件；如果文件存在，则清空文件。</span>
w<span class="token operator">+</span>     Open <span class="token keyword">for</span> reading and writing<span class="token punctuation">.</span>  The file is created <span class="token keyword">if</span> it does not exist<span class="token punctuation">,</span> otherwise it is  truncated<span class="token punctuation">.</span>   The  stream  is positioned at the beginning of the file<span class="token punctuation">.</span>
<span class="token comment">//以读写的方式打开，如果文件不存在，则创建该文件；如果文件存在，则清空文件。</span>
a      Open  <span class="token keyword">for</span>  appending <span class="token punctuation">(</span>writing at end of file<span class="token punctuation">)</span><span class="token punctuation">.</span>  The file is created <span class="token keyword">if</span> it does not exist<span class="token punctuation">.</span>  The stream is positioned at the end of the file<span class="token punctuation">.</span>
<span class="token comment">//以写的方式打开文件，如果文件不存在，则创建文件；如果文件存在，则以追加的方式写文件；</span>
a<span class="token operator">+</span>     Open <span class="token keyword">for</span> reading and appending <span class="token punctuation">(</span>writing at end of file<span class="token punctuation">)</span><span class="token punctuation">.</span>  The file is created <span class="token keyword">if</span> it does not exist<span class="token punctuation">.</span>  The initial  file position <span class="token keyword">for</span> reading is at the beginning of the file<span class="token punctuation">,</span> but output is always appended to the end of the file<span class="token punctuation">.</span>
<span class="token comment">//以读写的方式打开文件，如果文件不存在，则创建文件；如果文件存在，则以追加的方式写文件;</span>
</code></pre> 
<pre><code class="prism language-c"><span class="token comment">//fopen</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	FILE<span class="token operator">*</span> fp<span class="token punctuation">;</span>
	fp <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"./fopen"</span><span class="token punctuation">,</span><span class="token string">"w"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>p <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"打开失败\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"打开成功\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">fclose</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="2perror_151"></a>2.perror</h5> 
<blockquote> 
 <p>功能：通过errno(错误码)，打印错误信息<br> 头文件：<br> <code>#include &lt;stdio.h&gt;</code><br> 原型：<br> <code>void perror(const char* s);</code><br> 参数：<br> <code>char* s</code>：用于提示的字符<br> <code>#include &lt;errno.h&gt;</code><br> <code>int errno</code>：<br> <code>errno</code>：本质上是一个全局变量，对文件进行操作的时候，会出现各种错误，errno中已经定义好了各种数值，与错误相对应<br> 位置：/usr/include/asm-generic/errno.h errno-bash.h</p> 
</blockquote> 
<pre><code class="prism language-c"><span class="token comment">//perror,errno</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	FILE<span class="token operator">*</span> fp<span class="token punctuation">;</span>
	fp <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"./fopen"</span><span class="token punctuation">,</span><span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>p <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"打开失败\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span>errno<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"fopen"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"打开成功\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">fclose</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="3fclose_181"></a>3.fclose</h5> 
<blockquote> 
 <p>功能：关闭一个文件；<br> 头文件：<br> <code>#include &lt;stdio.h&gt;</code><br> 原型：<br> <code>int fclose(FILE* fp);</code><br> 参数：<br> <code>FILE *fp</code>：指定要关闭的文件流指针<br> 返回值：<br> 成功，返回0<br> 失败，返回-1，更新errno</p> 
</blockquote> 
<pre><code class="prism language-c"><span class="token comment">//fclose</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	FILE<span class="token operator">*</span> fp<span class="token punctuation">;</span>
	fp <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"./fopen"</span><span class="token punctuation">,</span><span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>p <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"fopen"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"打开成功\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token function">fclose</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> <span class="token comment">//if(fclose(fp) &lt; 0)</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"关闭失败\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"关闭成功\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p>思考：能否对一个文件进行重复fopen和fclose<br> 答案：不能。<br> 1.调用fopen时，会去堆空间申请一片缓冲区，并且返回的流指针中储存了这片缓冲区的首地址<br> 2.不要重复打开一个文件，会造成资源浪费，而且，Linux内核文件的打开次数是有限制的（1024个）<br> 3.调用fclose时，会通过free释放指定的堆空间，再次调用fclose，会造成重复释放。</p> 
</blockquote> 
<h5><a id="4fprintf_219"></a>4.fprintf</h5> 
<blockquote> 
 <p>功能：将标准格式化数据输出到文件中<br> 头文件：<br> <code>#include &lt;stdio.h&gt;</code><br> 原型：<br> <code>int printf(const char *format, ...);</code><br> <code>int fprintf(FILE *stream, const char *format, ...);</code><br> 参数：<br> <code>FILe *stream</code>：文件流指针<br> <code>const char *fromat</code>：格式化数据<br> <code>...</code>：不定参数<br> 返回值：<br> 成功，返回输出的数据个数<br> 失败，返回负数，更新errno</p> 
</blockquote> 
<pre><code class="prism language-c"><span class="token comment">//fprintf</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	FILE<span class="token operator">*</span> fp<span class="token punctuation">;</span>
	fp <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"./test.c"</span><span class="token punctuation">,</span><span class="token string">"w"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>p <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"fopen"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"打开成功\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//将"hello"输出到文件中</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">fprintf</span><span class="token punctuation">(</span>fp<span class="token punctuation">,</span><span class="token string">"hello"</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"fprintf"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">fclose</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"fclose"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"关闭文件\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="5fscanf_259"></a>5.fscanf</h5> 
<blockquote> 
 <p>功能：从文件中标准格式化获取数据<br> 头文件：<br> <code>#include &lt;stdio.h&gt;</code><br> 原型：<br> <code>int scanf(const char *format, ...);</code><br> <code>int fscanf(FILE *stream, const char *format, ...);</code><br> 参数：<br> <code>FILe *stream</code>：文件流指针<br> <code>const char *fromat</code>：格式化数据<br> <code>...</code>：不定参数<br> 返回值：<br> 成功，返回获取的数据个数。大于等于0<br> 失败，或读取到文件结尾，返回EOF(其实就是-1)，更新errno</p> 
</blockquote> 
<pre><code class="prism language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	FILE<span class="token operator">*</span> fp<span class="token punctuation">;</span>
	fp <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"./test.c"</span><span class="token punctuation">,</span><span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>p <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"fopen"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
	<span class="token keyword">char</span> buf1<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
	<span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%s%s"</span><span class="token punctuation">,</span>buf<span class="token punctuation">,</span>buf1<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s \n"</span><span class="token punctuation">,</span>buf<span class="token punctuation">,</span>buf1<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//按照"%s %s"获取文件内容，分别存入到buf和buf1</span>
	<span class="token function">fscanf</span><span class="token punctuation">(</span>fp<span class="token punctuation">,</span><span class="token string">"%s %s"</span><span class="token punctuation">,</span>buf<span class="token punctuation">,</span>buf1<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token function">fclose</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="6fputc_294"></a>6.fputc</h5> 
<blockquote> 
 <p>功能：将单个字符输出到文件中<br> 头文件：<br> <code>#include &lt;stdio.h&gt;</code><br> 原型：<br> <code>int fputc(int c, FILE *stream);</code><br> 参数：<br> <code>int c</code>：指定输出的字符<br> <code>FILe *stream</code>：文件流指针<br> 返回值：<br> 成功，返回输出字符的ASCII码<br> 失败，返回EOF，更新errno</p> 
</blockquote> 
<pre><code class="prism language-c"><span class="token comment">//fputc</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	FILE<span class="token operator">*</span> fp<span class="token punctuation">;</span>
	fp <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"./test.c"</span><span class="token punctuation">,</span><span class="token string">"w"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">==</span> fp<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"fopen"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">fputc</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span>fp<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"fputc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">fclose</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="7fgetc_324"></a>7.fgetc</h5> 
<blockquote> 
 <p>功能：从文件中获取单个字符<br> 头文件：<br> <code>#include &lt;stdio.h&gt;</code><br> 原型：<br> <code>int fgetc(FILE *stream);</code><br> 参数：<br> <code>FILe *stream</code>：文件流指针<br> 返回值：<br> 成功，返回获取到的字符，从字符类型转化为int类型<br> 失败，返回EOF，更新errno</p> 
</blockquote> 
<pre><code class="prism language-c"><span class="token comment">//fgetc</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	FILE<span class="token operator">*</span> fp<span class="token punctuation">;</span>
	fp <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"./test.c"</span><span class="token punctuation">,</span><span class="token string">"w+"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">==</span> fp<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"fopen"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">fputc</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span>fp<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"fputc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token function">fgetc</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span>ret<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//输出-1</span>
		<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"fgetc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//succeed，未关闭的文件结尾默认加EOF</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span>ret<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token function">fclose</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>文件结尾默认加\nEOF</p> 
<blockquote> 
 <p>练习<br> 1.计算文件的大小<br> 2.写一个函数，计算一个文件总共有几行；(提示：判断文件有几个’\n’),就算是文件的结尾也会有个换行符<br> 3.实现一个文件的拷贝，例如将a.txt中的内容，拷贝到b.txt</p> 
</blockquote> 
<pre><code class="prism language-c"><span class="token comment">//计算文件大小</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">getsize</span><span class="token punctuation">(</span>FILE<span class="token operator">*</span> fp<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	<span class="token keyword">int</span> size <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">fgetc</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token constant">EOF</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		szie<span class="token operator">++</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> size<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>argc <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Usage %s filename\n"</span><span class="token punctuation">,</span>argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//打开文件</span>
    FILE <span class="token operator">*</span>fp <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">==</span> fp<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"fopen"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>   
    <span class="token comment">//计算文件大小</span>
    <span class="token keyword">int</span> szie <span class="token operator">=</span> <span class="token function">getsize</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"size = %d\n"</span><span class="token punctuation">,</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//关闭文件</span>
    <span class="token function">fclose</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> 
</code></pre> 
<pre><code class="prism language-c"><span class="token comment">//计算文件行数</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">mygetline</span><span class="token punctuation">(</span>FILE<span class="token operator">*</span> fp<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	<span class="token keyword">int</span> line <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>res<span class="token punctuation">;</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res <span class="token operator">=</span> <span class="token function">fgetc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token constant">EOF</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>res <span class="token operator">==</span> <span class="token string">'\n'</span><span class="token punctuation">)</span>
			line<span class="token operator">++</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> line<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>argc <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Usage %s filename\n"</span><span class="token punctuation">,</span>argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//打开文件</span>
    FILE <span class="token operator">*</span>fp <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">==</span> fp<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"fopen"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>   
    <span class="token comment">//计算文件行数</span>
    <span class="token keyword">int</span> line <span class="token operator">=</span> <span class="token function">mygetline</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"line = %d\n"</span><span class="token punctuation">,</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//关闭文件</span>
    <span class="token function">fclose</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> 
</code></pre> 
<pre><code class="prism language-c"><span class="token comment">//拷贝文件</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token keyword">void</span> <span class="token function">my_copy</span><span class="token punctuation">(</span>FILE<span class="token operator">*</span> src<span class="token punctuation">,</span>FILE<span class="token operator">*</span> dest<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> res<span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res <span class="token operator">=</span> <span class="token function">fgetc</span><span class="token punctuation">(</span>src<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token constant">EOF</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token function">fputc</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span>dest<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>   
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>argc <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> 
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Usage %s file_src file_dest\n"</span><span class="token punctuation">,</span>argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>   
    FILE <span class="token operator">*</span>src<span class="token punctuation">,</span><span class="token operator">*</span>dest<span class="token punctuation">;</span>
    src <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">==</span> src<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"fopen"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>   
    dest <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">"w"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">==</span> dest<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"fopen"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>   
	<span class="token comment">//拷贝文件</span>
    <span class="token function">my_copy</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span>dest<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">fclose</span><span class="token punctuation">(</span>src<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fclose</span><span class="token punctuation">(</span>dest<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>  
</code></pre> 
<h5><a id="8_464"></a>8.缓冲区</h5> 
<p>标准IO的内容都是存储在缓冲区中，然后输出到硬件中</p> 
<ul><li>1.全缓冲</li></ul> 
<blockquote> 
 <p>操作对象：对普通文件进行操作(即通过fopen打开的文件)，通过FILE<em>fp流指针维护一个4K大小的缓冲区<br> 大小：4K=4</em>1024=4096 或 fp-&gt;_IO_buf_end - fp-&gt;_IO_buf_base = 4096</p> 
</blockquote> 
<pre><code class="prism language-c"><span class="token comment">//全缓冲</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	FILE<span class="token operator">*</span> fp <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"./test.c"</span><span class="token punctuation">,</span><span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">==</span> fp<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"fopen"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//由于系统优化，如果只打开文件，不操作的话，并不会真正的去申请空间</span>
	<span class="token function">fputc</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> size <span class="token operator">=</span> fp<span class="token operator">-&gt;</span>_IO_buf_end <span class="token operator">-</span> fp<span class="token operator">-&gt;</span>_IO_buf_base<span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">fclose</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li>刷新缓冲区 
  <ul><li>1）缓冲区满</li><li>2）用fflush强制刷新缓冲区</li><li>3）关闭流指针的时候刷新</li><li>4）程序正常退出的时候刷新（return）</li><li>5）调用exit函数 – 退出整个进程</li></ul> </li></ul> 
<blockquote> 
 <p>fflush<br> 功能：强制刷新缓冲区<br> 头文件：<br> <code>#include &lt;stdio.h&gt;</code><br> 原型：<br> <code>int fflush(FILE *stream);</code><br> 参数：<br> <code>FILe *stream</code>：文件流指针<br> 返回值：<br> 成功，返回0<br> 失败，返回-1，更新errno</p> 
</blockquote> 
<blockquote> 
 <p>exit<br> 功能：退出进程<br> 头文件：<br> <code>#include &lt;stdlib.h&gt;</code><br> 原型：<br> <code>void exit(int status);</code><br> 参数：<br> <code>int status</code>：可以输入任意int类型数据</p> 
</blockquote> 
<pre><code class="prism language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	FILE <span class="token operator">*</span>fp <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"./test.txt"</span><span class="token punctuation">,</span><span class="token string">"w"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">==</span> fp<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"fopen"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">putc</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">fflush</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//刷新缓冲区，a直接写进去</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">&lt;</span><span class="token number">4096</span><span class="token punctuation">)</span>
			<span class="token function">putc</span><span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">,</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
		i<span class="token operator">++</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token comment">//缓冲区刚好为4096，不刷新</span>
	<span class="token function">fclose</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li>2.行缓冲</li></ul> 
<blockquote> 
 <p>操作对象：标准输入(stdin)和标准输出(stdout)<br> 大小：1K 或 fp-&gt;_IO_buf_end - fp-&gt;_IO_buf_base = 1024byte<br> 关闭fclose(stdout)</p> 
</blockquote> 
<ul><li>刷新缓冲区 
  <ul><li>1）缓冲区满</li><li>2）用fflush强制刷新缓冲区</li><li>3）关闭流指针的时候刷新</li><li>4）程序正常退出的时候刷新（return）</li><li>5）调用exit函数 – 退出整个进程</li><li>6）遇到’\n’刷新</li></ul> </li></ul> 
<pre><code class="prism language-c"><span class="token comment">//这个程序需加#if #elif #endif 后执行</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span> </span><span class="token comment">//exit</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">//1.缓冲区满</span>
	<span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span>i<span class="token operator">&lt;</span><span class="token number">1024</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> <span class="token comment">//比缓冲区多才能输出</span>
		<span class="token function">fputc</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token constant">stdout</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		i<span class="token operator">++</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//2.fflush强制刷新</span>
	<span class="token function">fputc</span><span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">,</span><span class="token constant">stdout</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">fflush</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//3.关闭流指针</span>
	<span class="token function">fputc</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">.</span><span class="token constant">stdout</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">fclose</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//4.程序正常退出</span>
	<span class="token function">fputc</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">.</span><span class="token constant">stdout</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token comment">//5.调用exit函数</span>
	<span class="token function">fputc</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token constant">stdout</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//6.遇到'\n'</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"fff\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//putc('\n',stdout);</span>
	
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li>3.无缓冲</li></ul> 
<blockquote> 
 <p>操作对象：标准错误输出(stderr)<br> 大小：0，无缓冲，perror调用的就是stderr</p> 
</blockquote> 
<pre><code class="prism language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"hello world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="9fputs_589"></a>9.fputs</h5> 
<blockquote> 
 <p>功能：将字符串输出到文件中<br> 头文件：<br> <code>#include &lt;stdio.h&gt;</code><br> 原型：<br> <code>int fputs(const char *s, FILE *stream);</code><br> 参数：<br> <code>char *s</code>：指定要输出的字符串首地址<br> 返回值：<br> 成功，返回0<br> 失败，返回-1，更新errno</p> 
</blockquote> 
<h5><a id="10fgets_601"></a>10.fgets</h5> 
<blockquote> 
 <p>功能：从文件中获取字符串<br> 头文件：<br> <code>#include &lt;stdio.h&gt;</code><br> 原型：<br> <code>char *fgets(char *s, int size, FILE *stream);</code><br> 参数：<br> <code>char *s</code>：存储获取到的字符串<br> <code>int size</code>：从文件中读取 size-1 个字符，因为要保留’\0’;注意：如果一行不足size个,则读取个数为一行的实际个数;<br> 返回值：<br> 成功，返回char* s<br> 失败，返回NULL，更新errno</p> 
</blockquote> 
<pre><code class="prism language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">//通过fopen打开的文件是全缓冲</span>
	FILE <span class="token operator">*</span>fp <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"./test.txt"</span><span class="token punctuation">,</span><span class="token string">"w+"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">==</span> fp<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"fopen"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//文件指针已经移动到d之后</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">fputs</span><span class="token punctuation">(</span><span class="token string">"hello world"</span><span class="token punctuation">,</span>fp<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"fputs"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//关闭再打开让文件指针指向头</span>
	<span class="token function">fclose</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
	FILE <span class="token operator">*</span>fp <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"./test.txt"</span><span class="token punctuation">,</span><span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//fseek(fp,0,SEEK_SET);直接调用fseek函数比较方便</span>
	<span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
	<span class="token function">fgets</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s\n"</span><span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//hello wor</span>
	<span class="token function">fclose</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="11fwrite_639"></a>11.fwrite</h5> 
<blockquote> 
 <p>功能：将数据的二进制形式写入文件中<br> 头文件：<br> <code>#include &lt;stdio.h&gt;</code><br> 原型：<br> <code>size_t fwrite(const void *ptr, size_t size, size_t nmemb, FILE *stream);</code><br> 参数：<br> <code>void *ptr</code>：要输出的数据地址，可以是任意类型的数据;<br> <code>size_t size</code>：以size个字节为单位输出。例如：<br> 如果要输出的是int类型数据，size == 4;<br> 如果要输出的是char类型数据，size == 1;<br> 如果要输出的是自定义结构体类型，struct aa ,size == sizeof(aa);<br> <code>size_t nmemb</code>：要输出的数据个数；<br> <code>FILE *stream</code>：流指针;<br> 返回值：<br> 成功，返回输出的数据个数，其实就是nmemb;<br> 失败，返回-1，更新errno;</p> 
</blockquote> 
<pre><code class="prism language-c"><span class="token comment">//fwrite，写入的是二进制</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	FILE <span class="token operator">*</span>fp <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"./test.txt"</span><span class="token punctuation">,</span><span class="token string">"w"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">==</span> fp<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"fopen"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">int</span> arr<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">fwrite</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">,</span>fp<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"fwrite"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"fwrite succeed\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">fclose</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="12fread_676"></a>12.fread</h5> 
<blockquote> 
 <p>功能：从文件中读取二进制数据;<br> 头文件：<br> <code>#include &lt;stdio.h&gt;</code><br> 原型：<br> <code>size_t fread(void *ptr, size_t size, size_t nmemb, FILE *stream);</code><br> 参数：<br> <code>void *ptr</code>：成功读取数据后，数据存储在该位置;<br> <code>size_t size</code>：以size个字节为单位输出。例如：<br> 如果要输出的是int类型数据，size == 4;<br> 如果要输出的是char类型数据，size == 1;<br> 如果要输出的是自定义结构体类型，struct aa ,size == sizeof(aa);<br> <code>size_t nmemb</code>：要输出的数据个数；<br> <code>FILE *stream</code>：流指针;<br> 返回值：<br> 成功，返回读取的数据个数，其实就是nmemb;<br> 失败，返回-1，更新errno;</p> 
</blockquote> 
<pre><code class="prism language-c"><span class="token comment">//fwrite，写入的是二进制</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	FILE <span class="token operator">*</span>fp <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"./test.txt"</span><span class="token punctuation">,</span><span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">==</span> fp<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"fopen"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">int</span> arr<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">fread</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span><span class="token function">sizoef</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span>fp<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"read"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"fread succeed\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">3</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d "</span><span class="token punctuation">,</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">putchar</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">fclose</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="13fseek_717"></a>13.fseek</h5> 
<blockquote> 
 <p>功能：偏移流指针；<br> 头文件：<br> <code>#include &lt;stdio.h&gt;</code><br> 原型：<br> <code>int fseek(FILE *stream, long offset, int whence);</code><br> 参数：<br> <code>FILE *stream</code>：流指针；<br> <code>long offset</code>：偏移量；<br> <code>int whence</code>：SEEK_SET：文件开头<br> SEET_CUR：文件指针当前位置<br> SEET_END：文件结束位置<br> 返回值：<br> 成功，返回0<br> 失败，返回-1，更新errno;</p> 
</blockquote> 
<blockquote> 
 <p><code>long ftell(FILE *stream);</code> 获取文件当前位置到文件开头的偏移量<br> 例子：long int size = ftell(fp);<br> <code>void rewind(FILE *stream);</code> 偏移文件指针到文件开头，相当于 fseek(fp, 0, SEEK_SET);</p> 
</blockquote> 
<blockquote> 
 <p>思考：如何使用fseek() ftel()计算文件大小</p> 
</blockquote> 
<pre><code class="prism language-c"><span class="token comment">//使用fseek() ftel()计算文件大小</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">//通过fopen打开的文件是全缓冲</span>
	FILE <span class="token operator">*</span>fp <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"./test.txt"</span><span class="token punctuation">,</span><span class="token string">"w+"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">==</span> fp<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"fopen"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//文件指针已经移动到d之后</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">fputs</span><span class="token punctuation">(</span><span class="token string">"hello world"</span><span class="token punctuation">,</span>fp<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"fputs"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//将文件指针移动到EOF前</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">fseek</span><span class="token punctuation">(</span>fp<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token constant">SEEK_END</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"fseek"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">long</span> <span class="token keyword">int</span> size <span class="token operator">=</span> <span class="token function">ftell</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span><span class="token string">"%ld"</span><span class="token punctuation">,</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">fclose</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="14time_767"></a>14.time</h5> 
<blockquote> 
 <p>功能：获取1970-01-01起至今的秒数;<br> 头文件：<br> <code>#include &lt;time.h&gt;</code><br> 原型：<br> <code>time_t time(time_t *tloc);</code><br> 参数：<br> <code>time_t *tloc</code>：存储获取到的时间;<br> 返回值：<br> 成功，返回获取到的时间;<br> 失败，返回（time_t） -1;更新errno;</p> 
</blockquote> 
<pre><code class="prism language-c"><span class="token comment">//方法1</span>
time_t tloc<span class="token punctuation">;</span>
<span class="token function">time</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>tloc<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%ld\n"</span><span class="token punctuation">,</span>tloc<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//方法2</span>
tloc <span class="token operator">=</span> <span class="token function">time</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%ld\n"</span><span class="token punctuation">,</span>tloc<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h5><a id="15localtime_789"></a>15.localtime</h5> 
<blockquote> 
 <p>功能：将1970-01-01起至今的秒数，转换成日历格式;<br> 头文件：<br> <code>#include &lt;time.h&gt;</code><br> 原型：<br> <code>struct tm *localtime(const time_t *c);</code><br> 参数：<br> <code>time_t *timep</code>：time函数返回的值<br> 返回值：<br> 成功，返回存储日历格式的结构体指针： struct tm *<br> struct tm<br> {<!-- --><br> int tm_sec; /* Seconds. [0-60] (1 leap second) <em>/<br> int tm_min; /</em> Minutes. [0-59] <em>/<br> int tm_hour; /</em> Hours. [0-23] <em>/<br> int tm_mday; /</em> Day. [1-31] <em>/<br> int tm_mon; /</em> Month. [0-11] <em>/ 月 = tm_mon+1;<br> int tm_year; /</em> Year - 1900. <em>/ 年 = tm_year+1900;<br> int tm_wday; /</em> Day of week. [0-6] <em>/ 星期 = tm_wday+1;<br> int tm_yday; /</em> Days in year.[0-365] */<br> }<br> 失败，返回NULL</p> 
</blockquote> 
<pre><code class="prism language-c"><span class="token comment">//localtime</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;time.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	time_t tloc <span class="token operator">=</span> <span class="token function">time</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">struct</span> tm<span class="token operator">*</span> info <span class="token operator">=</span> <span class="token function">localtime</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>tloc<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">==</span> info<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"localtime"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d-%d-%d %02d-%02d-%02d\n"</span><span class="token punctuation">,</span>info<span class="token operator">-&gt;</span>tm_year<span class="token operator">+</span><span class="token number">1900</span><span class="token punctuation">,</span>info<span class="token operator">-&gt;</span>tm_mon<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>\
	info<span class="token operator">-&gt;</span>tm_mday<span class="token punctuation">,</span>info<span class="token operator">-&gt;</span>tm_hour<span class="token punctuation">,</span>info<span class="token operator">-&gt;</span>tm_min<span class="token punctuation">,</span>info<span class="token operator">-&gt;</span>tm_sec<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="16sprintf_829"></a>16.sprintf</h5> 
<blockquote> 
 <p>功能：将数据格式化输出到字符串中，可以做数据拼接<br> 头文件：<br> <code>#include &lt;stdio.h&gt;</code><br> 原型：<br> <code>int printf(const char *format, ...);</code><br> <code>int fprintf(FILE *stream, const char *format, ...);</code><br> <code>int sprintf(char *str, const char *format, ...);</code><br> 参数：<br> <code>char *str</code>：接收的字符串<br> <code>const char *format</code>：格式化输出<br> <code>...</code>：不定参数<br> 返回值：</p> 
</blockquote> 
<h5><a id="17sscanf_842"></a>17.sscanf</h5> 
<blockquote> 
 <p>功能：将字符串以标准格式输入<br> 头文件：<br> <code>#include &lt;stdio.h&gt;</code><br> 原型：<br> <code>int scanf(const char *format, ...);</code><br> <code>int fscanf(FILE *stream, const char *format, ...);</code><br> <code>int sscanf(const char *str, const char *format, ...);</code><br> 参数：<br> <code>char *str</code>：字符串<br> <code>const char *format</code>：格式化输出<br> <code>...</code>：不定参数<br> 返回值：</p> 
</blockquote> 
<pre><code class="prism language-c"><span class="token comment">//sprintf,sscanf</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span> name<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"lisi"</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span> sex <span class="token operator">=</span> <span class="token string">'f'</span><span class="token punctuation">;</span>
    <span class="token keyword">float</span> score <span class="token operator">=</span> <span class="token number">89.5</span><span class="token punctuation">;</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d %s %c %.1f\n"</span><span class="token punctuation">,</span>num<span class="token punctuation">,</span> name<span class="token punctuation">,</span> sex<span class="token punctuation">,</span> score<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span> 
    <span class="token function">sprintf</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token string">"%d %s %c %.1f"</span><span class="token punctuation">,</span>num<span class="token punctuation">,</span> name<span class="token punctuation">,</span> sex<span class="token punctuation">,</span> score<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s\n"</span><span class="token punctuation">,</span> buf<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> num1<span class="token punctuation">;</span>
    <span class="token keyword">char</span> name1<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span> 
    <span class="token keyword">char</span> sex1<span class="token punctuation">;</span>
    <span class="token keyword">float</span> score1<span class="token punctuation">;</span>                                                                                            
    <span class="token function">sscanf</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token string">"%d %s %c %f"</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>num1<span class="token punctuation">,</span> name1<span class="token punctuation">,</span> <span class="token operator">&amp;</span>sex1<span class="token punctuation">,</span> <span class="token operator">&amp;</span>score1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d %s %c %f\n"</span><span class="token punctuation">,</span> num1<span class="token punctuation">,</span> name1<span class="token punctuation">,</span> sex1<span class="token punctuation">,</span> score1<span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="3IO_884"></a>3.文件IO</h2> 
<blockquote> 
 <p>1.文件IO是不带缓冲区的<br> 2.文件IO函数是由操作系统提供的，与操作系统绑定的，又称之为系统调用<br> 3.文件IO是通过文件描述符来维护一个文件</p> 
</blockquote> 
<h3><a id="_888"></a>文件描述符</h3> 
<h4><a id="1_889"></a>1.概念</h4> 
<blockquote> 
 <p>1.尝试打开一个文件的时候，系统会主动给这个文件分配一个编号(文件描述符)，用这个编号来描述文件<br> ⒉标准I0是对文件IO的二次封装，在文件I0的基础上封装了一个缓冲区，同时会将文件描述符也一起封装到FILE结构体中.<br> 3.文件IO对文件的读写，是通过文件描述符实现的。<br> 4.标准IO对文件的读写，是通过操作流指针实现的。</p> 
</blockquote> 
<h4><a id="2_894"></a>2.特殊的文件描述符</h4> 
<table><thead><tr><th align="left">特殊的流指针</th><th align="left">特殊的文件描述符</th><th>数值</th><th>宏</th></tr></thead><tbody><tr><td align="left">stdin</td><td align="left">stdin-&gt;_fileno</td><td>0</td><td>STDIN_FILENO</td></tr><tr><td align="left">stdout</td><td align="left">stdout-&gt;_fileno</td><td>1</td><td>STDOUT_FILENO</td></tr><tr><td align="left">stderr</td><td align="left">stderr-&gt;_fileno</td><td>2</td><td>STDERR_FILENO</td></tr></tbody></table> 
<pre><code class="prism language-c"><span class="token comment">//stdin-&gt;_fileno</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span>                                                                                                                         </span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d %d %d\n"</span><span class="token punctuation">,</span><span class="token constant">stdin</span><span class="token operator">-&gt;</span>_fileno<span class="token punctuation">,</span><span class="token constant">stdout</span><span class="token operator">-&gt;</span>_fileno<span class="token punctuation">,</span><span class="token constant">stderr</span><span class="token operator">-&gt;</span>_fileno<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="3_911"></a>3.文件描述符的总量</h4> 
<p>文件描述符的标号：[0,1023]。总共1024个<br> 其中0,1,2分别对应stdin、stdout、stderr</p> 
<p>注意：</p> 
<blockquote> 
 <p>1.每一个进程能打开的最大文件描述符是1023，数量是1024个;<br> 2.文件描述符的资源是有限的，在不使用的情况下，需要关闭;</p> 
</blockquote> 
<p>getdtableszie()函数</p> 
<blockquote> 
 <p>功能：获取当前进程能打开的文件描述符总量<br> 头文件：<br> <code>#include &lt;unistd.h&gt;</code><br> 原型：<br> <code>int getdtablesize(void);</code><br> 参数：<br> 返回值：当前进程能打开的文件描述符总量<br> 例子：<code>int size = getdtablesize();</code> //szie = 1024</p> 
</blockquote> 
<pre><code class="prism language-c"><span class="token comment">//用fopen查看文件描述符总量</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;sys/stat.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;fcntl.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    FILE <span class="token operator">*</span>fp<span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        fp <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"./1.txt"</span><span class="token punctuation">,</span><span class="token string">"w"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">==</span> fp<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"fopen"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\t"</span><span class="token punctuation">,</span>fp<span class="token operator">-&gt;</span>_fileno<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">putchar</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="2IO_952"></a>2.文件IO的函数</h3> 
<h4><a id="1IO_953"></a>1.常见的文件IO函数</h4> 
<blockquote> 
 <p>man 2 卷<br> open / close 打开 / 关闭一个文件<br> read / write 读 / 写一个文件<br> lseek 偏移</p> 
</blockquote> 
<h4><a id="2IO_958"></a>2.文件IO的使用</h4> 
<h5><a id="1open_959"></a>1.open</h5> 
<blockquote> 
 <p>功能：打开并可能创建一个文件或设备<br> 头文件：<br> <code>#include &lt;sys/types.h&gt;</code><br> <code>#include &lt;sys/stat.h&gt;</code><br> <code>#include &lt;fcntl.h&gt;</code><br> 原型：<br> <code>int open(const char *pathname, int flags);</code><br> <code>int open(const char *pathname, int flags, mode_t mode);</code><br> 参数：<br> <code>char *pathname</code>：指定要打开的文件路径及文件名<br> <code>int flags</code>：文件的打开方式；如果要包含多种方式，可以用按位或(|)的方式连接<br> <code>O_RDONLY</code>：只读方式打开<br> <code>O_WRONLY</code>：只写方式打开<br> <code>O_RDWR</code>：读写方式打开<br> 以上三种，必须包含一种<br> <code>O_APPEND</code>：追加的方式； flags = <code>O_WRONLY | O_APPEND</code><br> <code>O_CREAT</code>：文件不存在则创建；<br> <code>O_TRUNC</code>：清空文件；<br> <code>mode_t mode</code>：文件的八进制权限，如0777,0664；<br> 如果falgs中包含了O_CREAT，则必须要定义文件权限，如果不加，则忽略O_CREAT</p> 
 <hr> 
 <p><code>S_IRWXU</code> 00700 user (file owner) has read, write and execute permission<br> <code>S_IRUSR</code> 00400 user has read permission<br> <code>S_IWUSR</code> 00200 user has write permission<br> <code>S_IXUSR</code> 00100 user has execute permission<br> **************文件所属用户的权限<br> <code>S_IRWXG</code> 00070 group has read, write and execute permission<br> <code>S_IRGRP</code> 00040 group has read permission<br> <code>S_IWGRP</code> 00020 group has write permission<br> <code>S_IXGRP</code> 00010 group has execute permission<br> **************文件所属组的权限<br> <code>S_IRWXO</code> 00007 others have read, write and execute permission<br> <code>S_IROTH</code> 00004 others have read permission<br> <code>S_IWOTH</code> 00002 others have write permission<br> <code>S_IXOTH</code> 00001 others have execute permission<br> **************文件其他用户的权限</p> 
 <hr> 
 <p>返回值：<br> 成功，返回对应的文件描述符<br> 失败，返回-1，更新errno</p> 
</blockquote> 
<blockquote> 
 <p>作业：fopen的r r+ w w+ a a+，分别对应open的flags的哪几种组合</p> 
</blockquote> 
<pre><code class="prism language-c"><span class="token comment">//open,close</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;sys/stat.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;fcntl.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> fd <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"./test.c"</span><span class="token punctuation">,</span>O_RDWR<span class="token operator">|</span>O_CREAT<span class="token operator">|</span>O_TRUNC<span class="token punctuation">,</span><span class="token number">0777</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>fd <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> 
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"close"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>   
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"open succeed %d\n"</span><span class="token punctuation">,</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="2umask_1022"></a>2.umask</h5> 
<p>The permissions of the created file are (mode &amp; ~umask).<br> 文件创建的真实权限是 mode &amp; (~umask);<br> 1.什么是umask</p> 
<blockquote> 
 <p>umsk：文件权限掩码，会影响文件创建时候的权限，实际文件的权限是 mode &amp; (~umask);</p> 
</blockquote> 
<p>2.查看umask</p> 
<blockquote> 
 <p><code>$ umask</code> 得到结果是 0002<br> 实际创建的文件权限：0777 &amp; （~0002） = 0775</p> 
</blockquote> 
<p>3.设置umask</p> 
<blockquote> 
 <p>方法1：在终端上设置，但只在当前终端有效<br> <code>$ umask 0000</code> 将umask清0<br> 方法2：通过umask（）函数实现</p> 
</blockquote> 
<p>umsk()函数</p> 
<blockquote> 
 <p>功能：设置umask的值;<br> 头文件：<br> <code>#include &lt;sys/stat.h&gt;</code><br> 原型： mode_t umask(mode_t cmask);<br> 参数：<br> 返回值：</p> 
</blockquote> 
<pre><code class="prism language-c"><span class="token comment">//umask</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;sys/stat.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;fcntl.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">umask</span><span class="token punctuation">(</span><span class="token number">0000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//设置文件权限掩码为0000(八进制)</span>
    <span class="token keyword">int</span> fd <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"./open"</span><span class="token punctuation">,</span> O_RDWR<span class="token operator">|</span>O_CREAT<span class="token operator">|</span>O_TRUNC<span class="token punctuation">,</span> <span class="token number">0777</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>fd <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"open"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"open succeed %d\n"</span><span class="token punctuation">,</span> fd<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="3close_1065"></a>3.close</h5> 
<blockquote> 
 <p>功能：关闭文件描述符<br> 头文件：<br> <code>#include &lt;unistd.h&gt;</code><br> 原型：<br> <code>int close(int fd);</code><br> 参数：<br> <code>int fd</code>：指定要关闭的文件描述符;<br> 返回值：<br> 成功，返回0；<br> 失败，返回-1， 更新errno；</p> 
</blockquote> 
<h5><a id="4write_1076"></a>4.write</h5> 
<blockquote> 
 <p>功能：将数据写入文件描述<br> 头文件：<br> <code>#include &lt;unistd.h&gt;</code><br> 原型：<br> <code>ssize_t write(int fd, const void *buf, size_t count);</code><br> 参数：<br> int fd：指定文件描述符;<br> void *buf：要写入文件的数据的首地址;可以是任意类型;<br> size_t count：要写入的数据大小,以字节为单位;如果要写入int a[2], count = 8;<br> 返回值：<br> 成功，返回写入的数据个数；<br> 失败，返回-1，更新errno；</p> 
</blockquote> 
<pre><code class="prism language-c"><span class="token comment">//write</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;sys/stat.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;fcntl.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span> </span><span class="token comment">//strlen</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> fd <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"./test.c"</span><span class="token punctuation">,</span>O_WRONLY<span class="token operator">|</span>O_TRUNC<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>fd <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"open"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
    <span class="token function">fgets</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token constant">stdin</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//终端输入hello world回车</span>
    <span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token function">write</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//strlen不计'\0'</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"write"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"write %d\n"</span><span class="token punctuation">,</span>ret<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//输出write 9,文件里为hello wor</span>
    <span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="5read_1117"></a>5.read</h5> 
<blockquote> 
 <p>功能：从文件描述符读取数据;<br> 头文件：<br> <code>#include &lt;unistd.h&gt;</code><br> 原型：<br> <code>ssize_t read(int fd, void *buf, size_t count);</code><br> 参数：<br> <code>int fd</code>：文件描述符;<br> <code>void *buf</code>：存储读取到的数据;<br> <code>size_t count</code>：要读取的数据大小，以字节为单位;<br> 返回值：<br> 成功，返回读取到的数据个数;如果读到文件结尾返回0;<br> 失败，返回-1，更新errno；</p> 
</blockquote> 
<pre><code class="prism language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;sys/stat.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;fcntl.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> fd <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"./test.c"</span><span class="token punctuation">,</span>O_RDONLY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>fd <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> 
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"open"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>   
    <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span> 
    <span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token function">read</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//fd文件里写了hello world</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> 
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"read"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>   
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"read %d :%s\n"</span><span class="token punctuation">,</span>ret<span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//read 10:hello word</span>
    <span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>   
</code></pre> 
<h5><a id="6lseek_1154"></a>6.lseek</h5> 
<blockquote> 
 <p>功能：偏移文件指针;<br> 头文件：<br> <code>#include &lt;sys/types.h&gt;</code><br> <code>#include &lt;unistd.h&gt;</code><br> 原型：<br> <code>off_t lseek(int fd, off_t offset, int whence);</code><br> 参数：<br> <code>int fd</code>：文件描述符;<br> <code>off_t offset</code>：相对于 int whence 偏移量;<br> <code>int whence</code>：<br> SEEK_SET 文件开头;<br> SEEK_CUR 当前位置;<br> SEEK_END 文件结尾;<br> 返回值：<br> 成功，返回设置后的文件指针相对于文件开头的偏移量;<br> 失败，返回-1，更新errno;</p> 
</blockquote> 
<blockquote> 
 <p>用于计算文件的大小:<br> <code>off_t size = lseek(fd, 0, SEEK_END);</code> //size就是文件的大小;</p> 
</blockquote> 
<pre><code class="prism language-c"><span class="token comment">//lseek</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;sys/stat.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span><span class="token comment">//lseek</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;fcntl.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span><span class="token comment">//bzero</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">umask</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> fd <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"./write.txt"</span><span class="token punctuation">,</span> O_RDWR<span class="token operator">|</span>O_CREAT<span class="token operator">|</span>O_TRUNC<span class="token punctuation">,</span> <span class="token number">0777</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>fd <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>   
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"open"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"open成功\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span> 
    <span class="token comment">//fgets(buf, 15, stdin);</span>
    <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span> buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//写入</span>
    <span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token function">write</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>   
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"write"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>   
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"写入成功 %d\n"</span><span class="token punctuation">,</span> ret<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//关闭重新打开;</span>
    <span class="token comment">//用lseek函数</span>
    <span class="token function">lseek</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token constant">SEEK_SET</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">//读取</span>
    <span class="token function">bzero</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ret <span class="token operator">=</span> <span class="token function">read</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"read"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>   
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s\n"</span><span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p>练习：通过write和read函数实现图片的拷贝;</p> 
</blockquote> 
<pre><code class="prism language-c"><span class="token comment">//通过write和read函数实现图片的拷贝;</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;sys/stat.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;fcntl.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>argc <span class="token operator">!=</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> 
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Usage %s filesrc filedist\n"</span><span class="token punctuation">,</span>argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>   
    <span class="token function">umask</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> fd_src <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>O_RDONLY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>fd_src <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> 
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"open src"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>   
    <span class="token keyword">int</span> fd_dist <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>O_WRONLY<span class="token operator">|</span>O_CREAT<span class="token operator">|</span>O_TRUNC<span class="token punctuation">,</span><span class="token number">0664</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>fd_dist <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> 
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"open dist"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">close</span><span class="token punctuation">(</span>fd_src<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>   
    <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span> 
    <span class="token keyword">int</span> ret<span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ret <span class="token operator">=</span> <span class="token function">read</span><span class="token punctuation">(</span>fd_src<span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> 
        <span class="token function">write</span><span class="token punctuation">(</span>fd_dist<span class="token punctuation">,</span>buf<span class="token punctuation">,</span>ret<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>   
    <span class="token function">close</span><span class="token punctuation">(</span>fd_src<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">close</span><span class="token punctuation">(</span>fd_dist<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> 
</code></pre> 
<h4><a id="3_1261"></a>3.文件属性相关的函数</h4> 
<h5><a id="1stat_1262"></a>1.stat</h5> 
<blockquote> 
 <p>功能：获取文件的属性;<br> 头文件：<br> <code>#include &lt;sys/types.h&gt;</code><br> <code>#include &lt;sys/stat.h&gt;</code><br> <code>#include &lt;unistd.h&gt;</code><br> 原型：<br> <code>int stat(const char *path, struct stat *buf);</code><br> 参数：<br> <code>char *path</code>：指定文件的路径或路径加名字;<br> <code>struct stat *buf</code>:系统定义的结构体，存储文件的属性；</p> 
</blockquote> 
<pre><code class="prism language-c"><span class="token keyword">struct</span> stat <span class="token punctuation">{<!-- --></span>
	dev_t     st_dev<span class="token punctuation">;</span>     <span class="token comment">/* ID of device containing file */</span>
	ino_t     st_ino<span class="token punctuation">;</span>     <span class="token comment">/* inode number */</span> 				inode号 		    <span class="token operator">%</span>ld
	mode_t    st_mode<span class="token punctuation">;</span>    <span class="token comment">/* protection */</span> 					文件的类型<span class="token operator">+</span>文件的权限  <span class="token operator">%</span>o
	nlink_t   st_nlink<span class="token punctuation">;</span>   <span class="token comment">/* number of hard links */</span>		硬连接数 			<span class="token operator">%</span>d
	uid_t     st_uid<span class="token punctuation">;</span>     <span class="token comment">/* user ID of owner */</span>			当前用户的uid		<span class="token operator">%</span>d
	gid_t     st_gid<span class="token punctuation">;</span>     <span class="token comment">/* group ID of owner */</span>			当前用户组的gid 		<span class="token operator">%</span>d
	dev_t     st_rdev<span class="token punctuation">;</span>    <span class="token comment">/* device ID (if special file) */</span>
	off_t     st_size<span class="token punctuation">;</span>    <span class="token comment">/* total size, in bytes */</span>		文件大小			    <span class="token operator">%</span>ld
	blksize_t st_blksize<span class="token punctuation">;</span> <span class="token comment">/* blocksize for filesystem I/O */</span>
	blkcnt_t  st_blocks<span class="token punctuation">;</span>  <span class="token comment">/* number of 512B blocks allocated */</span>
	time_t    st_atime<span class="token punctuation">;</span>   <span class="token comment">/* time of last access */</span>			最后一次被访问的时间  <span class="token operator">%</span>ld
	time_t    st_mtime<span class="token punctuation">;</span>   <span class="token comment">/* time of last modification */</span>	最后一次被修改的时间
	time_t    st_ctime<span class="token punctuation">;</span>   <span class="token comment">/* time of last status change */</span>	最后一次改变状态的时间
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<blockquote> 
 <p>返回值：<br> 成功，返回0;<br> 失败，返回-1，更新errno;</p> 
</blockquote> 
<pre><code class="prism language-c"><span class="token comment">//stat例子</span>
<span class="token keyword">struct</span> stat buf<span class="token punctuation">;</span>
<span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token function">stat</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"stat"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="2_1305"></a>2.提取文件权限</h5> 
<blockquote> 
 <p><code>mode_t st_mode;</code> /* protection */ 文件的类型+文件的权限st_mode;<br> 是一个32位无符号的整形变量，其中低9位[0 , 8]，代表了文件的权限（rwx rwx rwx）；<br> 用st_mode &amp; 相应权限，如果结果大于0， 说明有该权限；如果结果等于0，说明没有该权限；</p> 
</blockquote> 
<pre><code class="prism language-c">st_mode<span class="token punctuation">:</span> <span class="token number">100664</span>
   <span class="token number">664</span><span class="token operator">-&gt;</span> <span class="token number">110</span> <span class="token number">110</span> <span class="token number">100</span>
   <span class="token operator">&amp;</span> 	 <span class="token number">100</span> <span class="token number">000</span> <span class="token number">000</span>     <span class="token operator">--</span><span class="token operator">&gt;</span><span class="token number">0400</span>
    <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
    	 <span class="token number">100</span> <span class="token number">000</span> <span class="token number">000</span> 	<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">&gt;</span> <span class="token number">0400</span> 文件所属用户有可读权限。
</code></pre> 
<p>对应的权限的宏：</p> 
<pre><code class="prism language-c">S_IRWXU    <span class="token number">00700</span>     mask <span class="token keyword">for</span> file owner permissions
S_IRUSR    <span class="token number">00400</span>     owner has read permission
S_IWUSR    <span class="token number">00200</span>     owner has write permission
S_IXUSR    <span class="token number">00100</span>     owner has execute permission
S_IRWXG    <span class="token number">00070</span>     mask <span class="token keyword">for</span> group permissions
S_IRGRP    <span class="token number">00040</span>     group has read permission
S_IWGRP    <span class="token number">00020</span>     group has write permission
S_IXGRP    <span class="token number">00010</span>     group has execute permission
S_IRWXO    <span class="token number">00007</span>     mask <span class="token keyword">for</span> permissions <span class="token keyword">for</span> others <span class="token punctuation">(</span>not in group<span class="token punctuation">)</span>
S_IROTH    <span class="token number">00004</span>     others have read permission
S_IWOTH    <span class="token number">00002</span>     others have write permission
S_IXOTH    <span class="token number">00001</span>     others have execute permission
</code></pre> 
<pre><code class="prism language-c"><span class="token comment">//mode_t st_mode</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;sys/stat.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>

<span class="token comment">//方法1</span>
<span class="token keyword">void</span> <span class="token function">getPermission</span><span class="token punctuation">(</span>mode_t m<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>m <span class="token operator">&amp;</span> <span class="token number">0400</span><span class="token punctuation">)</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"-"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>m<span class="token operator">&amp;</span> <span class="token number">0200</span><span class="token punctuation">)</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"w"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        <span class="token function">putchar</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>m <span class="token operator">&amp;</span> <span class="token number">0100</span><span class="token punctuation">)</span>
        <span class="token function">putchar</span><span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        <span class="token function">putchar</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/*****************************/</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>m <span class="token operator">&amp;</span> <span class="token number">0040</span><span class="token punctuation">)</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"-"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>m<span class="token operator">&amp;</span> <span class="token number">0020</span><span class="token punctuation">)</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"w"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        <span class="token function">putchar</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>m <span class="token operator">&amp;</span> <span class="token number">0010</span><span class="token punctuation">)</span>
        <span class="token function">putchar</span><span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        <span class="token function">putchar</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">/*****************************/</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>m <span class="token operator">&amp;</span> <span class="token number">0004</span><span class="token punctuation">)</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"-"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>m<span class="token operator">&amp;</span> <span class="token number">0002</span><span class="token punctuation">)</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"w"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        <span class="token function">putchar</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>m <span class="token operator">&amp;</span> <span class="token number">0001</span><span class="token punctuation">)</span>
        <span class="token function">putchar</span><span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        <span class="token function">putchar</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">putchar</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
<span class="token comment">//方法2</span>
<span class="token keyword">void</span> <span class="token function">getPermission</span><span class="token punctuation">(</span>mode_t m<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span> i<span class="token operator">&gt;=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>m <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"-"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">switch</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token comment">//或switch(i%3){case2:putcahr('r');case1:...</span>
        <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">case</span> <span class="token number">8</span><span class="token punctuation">:</span>
        <span class="token keyword">case</span> <span class="token number">5</span><span class="token punctuation">:</span>
        <span class="token keyword">case</span> <span class="token number">2</span><span class="token punctuation">:</span>
            <span class="token function">putchar</span><span class="token punctuation">(</span><span class="token string">'r'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>

        <span class="token keyword">case</span> <span class="token number">7</span><span class="token punctuation">:</span>
        <span class="token keyword">case</span> <span class="token number">4</span><span class="token punctuation">:</span>
        <span class="token keyword">case</span> <span class="token number">1</span><span class="token punctuation">:</span>
            <span class="token function">putchar</span><span class="token punctuation">(</span><span class="token string">'w'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>

        <span class="token keyword">case</span> <span class="token number">6</span><span class="token punctuation">:</span>
        <span class="token keyword">case</span> <span class="token number">3</span><span class="token punctuation">:</span>
        <span class="token keyword">case</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token function">putchar</span><span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>                               
    <span class="token punctuation">}</span>

    <span class="token function">putchar</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>argc <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"运行参数缺失\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">struct</span> stat buf<span class="token punctuation">;</span>
    <span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token function">stat</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"stat"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//文件的类型+权限</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"mode : %o\n"</span><span class="token punctuation">,</span> buf<span class="token punctuation">.</span>st_mode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">getPermission</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span>st_mode<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p>折叠：选中要折叠的-&gt;zf<br> 打开折叠：zE或左右键<br> 关上折叠：zc</p> 
</blockquote> 
<h5><a id="3_1458"></a>3.提取文件类型</h5> 
<blockquote> 
 <p>7种文件类型：bsp-lcd</p> 
</blockquote> 
<p>i)通过宏函数判断</p> 
<blockquote> 
 <p><code>S_ISREG(m)</code> is it a regular file? -<br> <code>S_ISDIR(m)</code> directory? d<br> <code>S_ISCHR(m)</code> character device? c<br> <code>S_ISBLK(m)</code> block device? b<br> <code>S_ISFIFO(m)</code> FIFO (named pipe)? p<br> <code>S_ISLNK(m)</code> symbolic link? (Not in POSIX.1-1996.) l<br> <code>S_ISSOCK(m)</code> socket? (Not in POSIX.1-1996.) s<br> 参数：<br> <code>mode_t st_mode;</code><br> 返回值：<br> 1，代表是该类型文件；<br> 0，不是该该类型文件;</p> 
</blockquote> 
<pre><code class="prism language-c"><span class="token comment">//mode_t st_mode通过宏函数判断提取文件类型</span>
<span class="token keyword">void</span> <span class="token function">getType</span><span class="token punctuation">(</span>mode_t m<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">S_ISREG</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token function">putchar</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">S_ISDIR</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token function">putchar</span><span class="token punctuation">(</span><span class="token string">'d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                                                              
    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">S_ISCHR</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token function">putchar</span><span class="token punctuation">(</span><span class="token string">'c'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">S_ISBLK</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token function">putchar</span><span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">S_ISFIFO</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token function">putchar</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">S_ISLNK</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token function">putchar</span><span class="token punctuation">(</span><span class="token string">'l'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">S_ISSOCK</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token function">putchar</span><span class="token punctuation">(</span><span class="token string">'s'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>ii)通过提取文件类型</p> 
<blockquote> 
 <p><code>mode_t st_mode;</code> /* protection */ 文件的类型+文件的权限<br> <code>st_mode</code>：是一个32位无符号的整形变量，其中低[18位 , 13位]，共6bit，代表了文件的类型；<br> <code>S_IFMT</code> 0170000 bit mask for the file type bit fields<br> 用<code>st_mode &amp; S_IFMT</code> ：提取出[低18位，低13位]：6bit，这6bit代表文件类型。</p> 
</blockquote> 
<pre><code class="prism language-c">st_mode：<span class="token number">100775</span>
    	<span class="token number">100775</span>		<span class="token number">001</span> <span class="token number">000</span> <span class="token number">000</span> <span class="token number">111</span> <span class="token number">111</span> <span class="token number">101</span>
S_IFMT  <span class="token number">170000</span>     <span class="token number">001</span> <span class="token number">111</span> <span class="token number">000</span> <span class="token number">000</span> <span class="token number">000</span> <span class="token number">000</span>
    <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
    				<span class="token number">001</span> <span class="token number">000</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">&gt;</span>提取出<span class="token number">6</span>bit<span class="token punctuation">:</span> <span class="token number">0100000</span>
将结果与下列宏作比较，如果相等，那么就是对应的文件类型：
		   S_IFSOCK   <span class="token number">0140000</span>   socket
           S_IFLNK    <span class="token number">0120000</span>   symbolic link
           S_IFREG    <span class="token number">0100000</span>   regular file
           S_IFBLK    <span class="token number">0060000</span>   block device
           S_IFDIR    <span class="token number">0040000</span>   directory
           S_IFCHR    <span class="token number">0020000</span>   character device
           S_IFIFO    <span class="token number">0010000</span>   FIFO
</code></pre> 
<pre><code class="prism language-c"><span class="token keyword">void</span> <span class="token function">getType</span><span class="token punctuation">(</span>mode_t m<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>              
    mode_t mode <span class="token operator">=</span> m<span class="token operator">&amp;</span>S_IFMT<span class="token punctuation">;</span>
    <span class="token keyword">switch</span><span class="token punctuation">(</span>mode<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>   
    <span class="token keyword">case</span> S_IFSOCK<span class="token punctuation">:</span>
        <span class="token function">putchar</span><span class="token punctuation">(</span><span class="token string">'s'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> S_IFLNK<span class="token punctuation">:</span>
        <span class="token function">putchar</span><span class="token punctuation">(</span><span class="token string">'l'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> S_IFREG<span class="token punctuation">:</span>
        <span class="token function">putchar</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> S_IFBLK<span class="token punctuation">:</span>
        <span class="token function">putchar</span><span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> S_IFDIR<span class="token punctuation">:</span>
        <span class="token function">putchar</span><span class="token punctuation">(</span><span class="token string">'d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> S_IFCHR<span class="token punctuation">:</span>
        <span class="token function">putchar</span><span class="token punctuation">(</span><span class="token string">'c'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> S_IFIFO<span class="token punctuation">:</span>
        <span class="token function">putchar</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>   
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="4_1547"></a>4.获取文件所属用户</h5> 
<blockquote> 
 <p><code>uid_t st_uid;</code> /* user ID of owner */ 当前用户的uid<br> 通过struct stat结构体中的 uid_t st_uid 成员变量获取文件所属用户</p> 
</blockquote> 
<p>getpwuid函数</p> 
<blockquote> 
 <p>功能：通过struct stat结构体中的 uid_t st_uid 成员变量获取文件所属用户;<br> 头文件：<br> <code>#include &lt;sys/types.h&gt;</code><br> <code>#include &lt;pwd.h&gt;</code><br> 原型：<br> <code>struct passwd *getpwuid(uid_t uid);</code><br> 参数：<br> <code>uid_t uid</code>：文件所属用户的uid;<br> 返回值：<br> 成功，返回存储文件所属用户信息的结构体地址;<br> 失败，返回NULL,更新errno;</p> 
</blockquote> 
<pre><code class="prism language-c"><span class="token keyword">struct</span> passwd <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">char</span>   <span class="token operator">*</span>pw_name<span class="token punctuation">;</span>       <span class="token comment">/* username */</span>
	<span class="token keyword">char</span>   <span class="token operator">*</span>pw_passwd<span class="token punctuation">;</span>     <span class="token comment">/* user password */</span>
	uid_t   pw_uid<span class="token punctuation">;</span>        <span class="token comment">/* user ID */</span>
	gid_t   pw_gid<span class="token punctuation">;</span>        <span class="token comment">/* group ID */</span>
	<span class="token keyword">char</span>   <span class="token operator">*</span>pw_gecos<span class="token punctuation">;</span>      <span class="token comment">/* user information */</span>
	<span class="token keyword">char</span>   <span class="token operator">*</span>pw_dir<span class="token punctuation">;</span>        <span class="token comment">/* home directory */</span>
	<span class="token keyword">char</span>   <span class="token operator">*</span>pw_shell<span class="token punctuation">;</span>      <span class="token comment">/* shell program */</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
sudo chown root<span class="token punctuation">:</span>root 文件名		将文件所属用户改成root
sudo chown linux<span class="token punctuation">:</span>root 文件名		将文件所属用户改成linux
</code></pre> 
<h5><a id="5_1577"></a>5.获取文件所属组用户</h5> 
<blockquote> 
 <p><code>gid_t st_gid;</code> /* group ID of owner */ 当前用户组的gid</p> 
</blockquote> 
<p>getgrgid函数</p> 
<blockquote> 
 <p>功能：根据 struct stat 结构体中的gid_t st_gid,获取文件所属的组;<br> 头文件：<br> <code>#include &lt;sys/types.h&gt;</code><br> <code>#include &lt;grp.h&gt;</code><br> 原型：<br> <code>struct group *getgrgid(gid_t gid);</code><br> 参数：<br> <code>gid_t gid</code>：组ID;<br> 返回值：<br> 成功，返回存储用户组信息的结构体地址；<br> 失败，返回NULL;</p> 
</blockquote> 
<pre><code class="prism language-c"><span class="token keyword">struct</span> group <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">char</span>   <span class="token operator">*</span>gr_name<span class="token punctuation">;</span>       <span class="token comment">/* group name */</span>
	<span class="token keyword">char</span>   <span class="token operator">*</span>gr_passwd<span class="token punctuation">;</span>     <span class="token comment">/* group password */</span>
	gid_t   gr_gid<span class="token punctuation">;</span>        <span class="token comment">/* group ID */</span>
	<span class="token keyword">char</span>  <span class="token operator">*</span><span class="token operator">*</span>gr_mem<span class="token punctuation">;</span>        <span class="token comment">/* group members */</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<blockquote> 
 <p>练习：读取一个文件的信息，main函数外部传参的方式。要求输出结果格式如下：<br> -rw-rw-r-- 1 linux linux 11 Sep 23 05:24 fileno</p> 
</blockquote> 
<h4><a id="4_1603"></a>4.操作文件目录的函数</h4> 
<h5><a id="1opendir_1604"></a>1.opendir</h5> 
<blockquote> 
 <p>功能：打开一个目录文件;<br> 头文件：<br> <code>#include &lt;sys/types.h&gt;</code><br> <code>#include &lt;dirent.h&gt;</code><br> 原型：<br> <code>DIR *opendir(const char *name);</code><br> 参数：<br> <code>char *name</code>：指定要打开的目录文件路径及目录名;<br> 返回值：<br> 成功，返回目录流指针;<br> 失败，返回NULL;更新errno;</p> 
</blockquote> 
<h5><a id="2closedir_1616"></a>2.closedir</h5> 
<h5><a id="3readdir_1617"></a>3.readdir</h5> 
<blockquote> 
 <p>功能：通过DIR*读取目录;<br> 头文件：<br> <code>#include &lt;dirent.h&gt;</code><br> 原型：<br> <code>struct dirent *readdir(DIR *dirp);</code><br> 参数：<br> <code>DIR *dirp</code>：指定的目录流指针;<br> 返回值：<br> 成功，返回 struct dirent *结构体地址；<br> 失败，返回NULL,更新errno；</p> 
</blockquote> 
<pre><code class="prism language-c"><span class="token keyword">struct</span> dirent <span class="token punctuation">{<!-- --></span>
	ino_t          d_ino<span class="token punctuation">;</span>       <span class="token comment">/* inode number */</span>
	off_t          d_off<span class="token punctuation">;</span>       <span class="token comment">/* not an offset; see NOTES */</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">short</span> d_reclen<span class="token punctuation">;</span>    <span class="token comment">/* length of this record */</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span>  d_type<span class="token punctuation">;</span>      <span class="token comment">/* type of file; not supported
	                               by all filesystem types */</span>
	<span class="token keyword">char</span>           d_name<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">/* filename */</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-c"><span class="token comment">//opendir/closedir/readdir</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;dirent.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    DIR<span class="token operator">*</span> dirp <span class="token operator">=</span> <span class="token function">opendir</span><span class="token punctuation">(</span><span class="token string">"../1_stdio/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">==</span> dirp<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>   
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"opendir"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>   
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"打开成功\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">struct</span> dirent<span class="token operator">*</span> dir_read<span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>   
        dir_read <span class="token operator">=</span> <span class="token function">readdir</span><span class="token punctuation">(</span>dirp<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">==</span> dir_read<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>   
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>   

        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%ld %s\n"</span><span class="token punctuation">,</span> dir_read<span class="token operator">-&gt;</span>d_ino<span class="token punctuation">,</span> dir_read<span class="token operator">-&gt;</span>d_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>   

    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">closedir</span><span class="token punctuation">(</span>dirp<span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>   
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"closedir"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"关闭成功\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>                                                           
<span class="token punctuation">}</span> 
</code></pre> 
<blockquote> 
 <p>练习：1.代码实现，打开目录，显示该目录下面所有文件的属性，权限，最有一次被修改的时间，类似ls –l。</p> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a85edfef88d99018137a6d24ed90a160/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【汇编】第1、2周作业：cmp、jmp入门————比较两个数大小、循环计算相加数之和</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ab6a1a579b395c99229d17b9d1673911/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">一篇文带你从0到1了解建站及完成CMS系统编写</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>