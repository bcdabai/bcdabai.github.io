<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>使用docker安装mysql主从集群 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="使用docker安装mysql主从集群" />
<meta property="og:description" content="1.安装MySQL主容器 1.1首先，使用以下命令创建MySQL主容器：
sudo docker run --name mysql-master -p 3306:3306 -e MYSQL_ROOT_PASSWORD=123456 -d mysql:latest
在这里，使用了Docker官方提供的MySQL镜像，并且使用了MySQL的默认3306端口。--name表示给该主容器设置一个名字，-p表示设置端口，-e选项用于设置MySQL的root密码，-d表示后台运行该容器。
然后使用sudo docker ps -a查看该进程
1.2配置MySQL主容器
使用以下步骤配置MySQL主容器：
1.2.1.连接MySQL主容器 使用以下命令连接到MySQL主容器：
sudo docker exec -it mysql-master bash
1.2.2.创建数据库和用户 在连接到MySQL主容器后，使用以下命令创建一个名为mydb的数据库，并创建一个名为myuser的用户：
mysql -uroot -p123456 -e &#34;create database mydb;&#34;
mysql -uroot -p123456 -e &#34;create user &#39;myuser&#39;@&#39;%&#39; identified by &#39;mypassword&#39;;&#34;
mysql -uroot -p123456 -e &#34;grant all privileges on mydb.* to &#39;myuser&#39;@&#39;%&#39;;&#34;
结果如下： 1.2.3.启用二进制日志 使用以下命令启用MySQL主容器的二进制日志功能：
mysql -uroot -p123456 -e &#34;set global log_bin_trust_function_creators=1;&#34; mysql -uroot -p123456 -e &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/efb87db21f0fe973dfd6e2ce497881c2/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-07-03T17:00:33+08:00" />
<meta property="article:modified_time" content="2023-07-03T17:00:33+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">使用docker安装mysql主从集群</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h4 id="%E5%AE%89%E8%A3%85MySQL%E4%B8%BB%E5%AE%B9%E5%99%A8">1.安装MySQL主容器</h4> 
<p>1.1首先，使用以下命令创建MySQL主容器：</p> 
<p>sudo docker run --name mysql-master -p 3306:3306 -e MYSQL_ROOT_PASSWORD=123456 -d mysql:latest</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/f1/3c/omfplGVG_o.png"></p> 
<p></p> 
<p>在这里，使用了Docker官方提供的MySQL镜像，并且使用了MySQL的默认3306端口。--name表示给该主容器设置一个名字，-p表示设置端口，-e选项用于设置MySQL的root密码，-d表示后台运行该容器。</p> 
<p>然后使用sudo docker ps -a查看该进程</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/7d/59/NAudyyjT_o.png"></p> 
<p></p> 
<p>1.2配置MySQL主容器</p> 
<p>使用以下步骤配置MySQL主容器：</p> 
<h4 id="1.%E8%BF%9E%E6%8E%A5MySQL%E4%B8%BB%E5%AE%B9%E5%99%A8">1.2.1.连接MySQL主容器</h4> 
<p>使用以下命令连接到MySQL主容器：</p> 
<p>sudo docker exec -it mysql-master bash</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/fd/1c/EXHdVJYr_o.png"></p> 
<h4 id="2.%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93%E5%92%8C%E7%94%A8%E6%88%B7">1.2.2.创建数据库和用户</h4> 
<p>在连接到MySQL主容器后，使用以下命令创建一个名为mydb的数据库，并创建一个名为myuser的用户：</p> 
<p>mysql -uroot -p123456 -e "create database mydb;"</p> 
<p>mysql -uroot -p123456 -e "create user 'myuser'@'%' identified by 'mypassword';"</p> 
<p>mysql -uroot -p123456 -e "grant all privileges on mydb.* to 'myuser'@'%';"</p> 
<p>结果如下： </p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/4a/f2/uvXj6Kez_o.png"></p> 
<p></p> 
<h4 id="3.%E5%90%AF%E7%94%A8%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%97%A5%E5%BF%97">1.2.3.启用二进制日志</h4> 
<p>使用以下命令启用MySQL主容器的二进制日志功能：</p> 
<pre><code>mysql -uroot -p123456 -e "set global log_bin_trust_function_creators=1;"
mysql -uroot -p123456 -e "set global binlog_format='ROW';"
mysql -uroot -p123456 -e "set global server_id=1;"
mysql -uroot -p123456 -e "set global log_bin='/var/lib/mysql/mysql-bin.log';"
mysql -uroot -p123456 -e "flush logs;"</code></pre> 
<p>结果如下：</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/e4/e8/HikUgkhS_o.png"></p> 
<p> 在上面的命令中，设置了二进制日志文件的位置为/var/lib/mysql/mysql-bin.log。</p> 
<h3 id="%E5%AE%89%E8%A3%85MySQL%E4%BB%8E%E5%AE%B9%E5%99%A8">2.安装MySQL从容器</h3> 
<p>2.1接下来，使用以下命令创建MySQL从容器，并将它们连接到MySQL主容器：</p> 
<pre><code>sudo docker run --name mysql-slave1 -p 3307:3306 -e MYSQL_ROOT_PASSWORD=123456 -d mysql:latest
sudo docker run --name mysql-slave2 -p 3308:3306 -e MYSQL_ROOT_PASSWORD=123456 -d mysql:latest</code></pre> 
<p>结果如下图： </p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/af/75/3Pu4PgRg_o.png"></p> 
<p> 在上面的命令中，创建了两个MySQL从容器，使用了3307和3308端口，并设置了相同的MySQL root密码。</p> 
<p>2.2配置MySQL从容器</p> 
<p>使用以下步骤配置MySQL从容器：</p> 
<h4 id="1.%E8%BF%9E%E6%8E%A5MySQL%E4%BB%8E%E5%AE%B9%E5%99%A8">2.2.1.连接MySQL从容器</h4> 
<p>使用以下命令连接到MySQL从容器：</p> 
<p>sudo docker exec -it mysql-slave1 bash</p> 
<p>创建库和用户</p> 
<p>mysql -uroot -p123456 -e "create database mydb;"</p> 
<p>mysql -uroot -p123456 -e "create user 'myuser'@'%' identified by 'mypassword';"</p> 
<p>mysql -uroot -p123456 -e "grant all privileges on mydb.* to 'myuser'@'%';"</p> 
<h4 id="2.%E5%90%AF%E7%94%A8%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6">2.2.2.启用主从复制</h4> 
<p>在连接到MySQL从容器后，使用以下命令配置MySQL从容器的主从复制：</p> 
<pre><code>mysql -uroot -p123456 -e "change master to master_host='mysql-master', master_user='myuser', master_password='mypassword', master_port=3306, master_log_file='mysql-bin.000001', master_log_pos=154;"
mysql -uroot -p123456 -e "start slave;"</code></pre> 
<p>结果如下：</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/0c/f5/sIpQ51Bi_o.png"></p> 
<p>在上面的命令中，设置了MySQL主容器的IP地址，用户名和密码，端口，二进制日志文件名和位置以及复制的起始位置。最后，使用start slave命令启动主从复制。</p> 
<h4 id="3.%E9%87%8D%E5%A4%8D%E4%B8%8A%E8%BF%B0%E6%AD%A5%E9%AA%A4">2.2.3.重复上述步骤</h4> 
<p>使用exit退出当前bash，然后重复上述步骤：</p> 
<p>使用以下命令连接到MySQL从容器：</p> 
<p>sudo docker exec -it mysql-slave2 bash</p> 
<p>创建库和用户</p> 
<p>mysql -uroot -p123456 -e "create database mydb;"</p> 
<p>mysql -uroot -p123456 -e "create user 'myuser'@'%' identified by 'mypassword';"</p> 
<p>mysql -uroot -p123456 -e "grant all privileges on mydb.* to 'myuser'@'%';"</p> 
<p>在mysql-slave2容器中配置主从复制</p> 
<pre><code>sudo docker exec -it mysql-slave2 bash
mysql -uroot -p123456 -e "change master to master_host='mysql-master', master_user='myuser', master_password='mypassword', master_port=3306, master_log_file='mysql-bin.000001', master_log_pos=154;"
mysql -uroot -p123456 -e "start slave;"</code></pre> 
<p>结果如下：</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/60/0e/2GsYjXTD_o.png"></p> 
<p>3.测试主从复制</p> 
<p>3.1现在，可以测试MySQL主从复制是否正常工作。在MySQL主容器中，使用以下命令创建一个名为test的表：</p> 
<p>sudo docker exec -it mysql-master bash然后</p> 
<p>mysql -uroot -p123456 -e "use mydb; create table test (id int(11) not null auto_increment, name varchar(255), primary key (id)); insert into test2 (name) values ('test');"</p> 
<p style="text-align:center;"> <img alt="" src="https://images2.imgbox.com/a6/b7/wbeWQ33A_o.png"></p> 
<p> 3.2然后，在mysql-slave1和mysql-slave2容器中检查是否已复制数据：</p> 
<pre><code>sudo docker exec -it mysql-slave1 bash
mysql -uroot -p123456 -e "use mydb; select * from test;"
exit

sudo docker exec -it mysql-slave2 bash
mysql -uroot -p123456 -e "use mydb; select * from test;"
exit</code></pre> 
<p>如果数据正确地复制到从容器中，则主从复制已成功完成。</p> 
<p>实际结果，问题来了，从1和从2机器没有自动生成表，更不用说测试数据了。</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/11/21/LRk9OGvR_o.png"></p> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1aa96497d779e8aab881558aed48b43f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">js 兼容iOS的时间 计算时间差(天数)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/24f7ab2218041ba60189bb1857f76a7c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">python-scrapy框架（四）settings.py文件的用法详解实例</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>