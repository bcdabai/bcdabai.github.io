<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>shell之sed命令详解 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="shell之sed命令详解" />
<meta property="og:description" content="sed概念
sed编辑器逐行处理文件。具体过程如下：首先sed把当前正在处理的行保存在一个临时缓存区中（也称为模式空间），然后处理临时缓冲区中的行，每处理完一行就将其从临时缓冲区删除，然后将下一行读入，进行处理和显示。处理完输入文件的最后一行后，sed便结束运行。sed把每一行都存在临时缓冲区中，对这个副本进行编辑，所以不会修改原文件（针对读取）。
调用sed的两种形式
sed [options] &#39;command&#39; file（s） sed [options] -f scriptfile file（s）
用法
sed [选项]... {脚本(如果没有其他脚本)} [输入文件]...
-n, --quiet, --silent
取消自动打印模式空间
-e 脚本, --expression=脚本
添加“脚本”到程序的运行列表
-f 脚本文件, --file=脚本文件
添加“脚本文件”到程序的运行列表
--follow-symlinks
follow symlinks when processing in place; hard links
will still be broken.
-i[SUFFIX], --in-place[=SUFFIX]
edit files in place (makes backup if extension supplied).
The default operation mode is to break symbolic and hard links.
This can be changed with --follow-symlinks and --copy." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/871f8e822e74ece6b3fd1a733b9fcdaa/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2013-12-11T22:36:48+08:00" />
<meta property="article:modified_time" content="2013-12-11T22:36:48+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">shell之sed命令详解</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><span style="font-family:Courier New; font-size:14px"><strong>sed概念</strong></span></p> 
<p><span style="font-family:Courier New; font-size:14px">sed编辑器逐行处理文件。具体过程如下：<u>首先sed把当前正在处理的行保存在一个临时缓存区中（也称为模式空间），然后处理临时缓冲区中的行，每处理完一行就将其从临时缓冲区删除，然后将下一行读入，进行处理和显示。处理完输入文件的最后一行后，sed便结束运行。</u>sed把每一行都存在临时缓冲区中，对这个副本进行编辑，所以不会修改原文件（针对读取）。</span></p> 
<p><span style="font-family:Courier New; font-size:14px"><strong>调用sed的两种形式</strong></span></p> 
<p><span style="font-family:Courier New; font-size:14px"><span style="line-height:26px">　　sed [options] 'command' file（s）</span><br style="line-height:26px"> <span style="line-height:26px">　　sed [options] -f scriptfile file（s）</span></span></p> 
<p><span style="font-family:Courier New; font-size:14px"></span></p> 
<p><span style="font-family:Courier New; font-size:14px"><strong>用法</strong></span></p> 
<p><span style="font-family:Courier New; font-size:14px">sed [选项]... {脚本(如果没有其他脚本)} [输入文件]...</span></p> 
<span style="font-family:Courier New; font-size:14px"><br>   -n, --quiet, --silent<br>                  取消自动打印模式空间<br>   -e 脚本, --expression=脚本<br>                  添加“脚本”到程序的运行列表<br>   -f 脚本文件, --file=脚本文件<br>                  添加“脚本文件”到程序的运行列表<br>   --follow-symlinks<br>                  follow symlinks when processing in place; hard links<br>                  will still be broken.<br>   -i[SUFFIX], --in-place[=SUFFIX]<br>                  edit files in place (makes backup if extension supplied).<br>                  The default operation mode is to break symbolic and hard links.<br>                  This can be changed with --follow-symlinks and --copy.<br>   -c, --copy<br>                  use copy instead of rename when shuffling files in -i mode.<br>                  While this will avoid breaking links (symbolic or hard), the<br>                  resulting editing operation is not atomic.  This is rarely<br>                  the desired mode; --follow-symlinks is usually enough, and<br>                  it is both faster and more secure.<br>   -l N, --line-length=N<br>                  指定“l”命令的换行期望长度<br>   --posix<br>                  关闭所有 GNU 扩展<br>   -r, --regexp-extended<br>                  在脚本中使用扩展正则表达式<br>   -s, --separate<br>                  将输入文件视为各个独立的文件而不是一个长的连续输入<br>   -u, --unbuffered<br>                  从输入文件读取最少的数据，更频繁的刷新输出<br>       --help     打印帮助并退出<br>       --version  输出版本信息并退出<br> <br> 如果没有 -e, --expression, -f 或 --file 选项，那么第一个非选项参数被视为<br> sed脚本。其他非选项参数被视为输入文件，如果没有输入文件，那么程序将从标准<br> 输入读取数据。</span> 
<p><span style="font-family:Courier New; font-size:14px"></span></p> 
<p><span style="font-family:Courier New; font-size:14px"><br> </span></p> 
<p><span style="font-family:Courier New; font-size:14px"><strong>定址</strong></span></p> 
<p><span style="font-family:Courier New; font-size:14px">定址用于决定对哪些行进行编辑。地址是逗号分隔的，那么需要处理的地址是这两行之间的范围（包括这两行在内）。<u>地址的形式可以是数字、正则表达式、或二者的结合</u>。如果没有指定地址，sed将处理输入文件的所有行。</span></p> 
<p><span style="font-family:Courier New; font-size:14px">Example：</span></p> 
<p><span style="font-family:Courier New; font-size:14px"><strong><span style="color:red"> p</span><span style="color:red">命令</span></strong></span></p> 
<p><span style="font-family:Courier New; font-size:14px"><strong>sed -n '3<span style="color:red">p</span>'Test.log       </strong><span style="color:#44964C">#</span><span style="color:#44964C">打印第三行，$</span>表示最后一行</span></p> 
<p><span style="font-family:Courier New; font-size:14px"><strong>sed -n '1,3p' Test.log     </strong><span style="color:#44964C">#</span><span style="color:#44964C">打印第一行到第三行的内容</span></span></p> 
<p><span style="color:#44964C"><span style="font-family:Courier New; font-size:14px"> </span></span></p> 
<p><span style="font-family:Courier New; font-size:14px"><strong><span style="color:red"> d</span><span style="color:red">命令</span></strong></span></p> 
<p><span style="font-family:Courier New; font-size:14px"><strong>sed '3<span style="color:red">d</span>'Test.log          </strong><span style="color:#44964C">#</span><span style="color:#44964C">删除第三行，并打印出其他行</span></span></p> 
<p><span style="font-family:Courier New; font-size:14px"><strong>sed '/My/,10d'  Test.log   </strong><span style="color:#44964C">#</span><span style="color:#44964C">删除包含"My"</span>的行到第十行的内容，并打印其他行</span></p> 
<p><span style="font-family:Courier New; font-size:14px"><strong>sed  '/My/,/You/d' Test.log</strong><span style="color:#44964C">#</span><span style="color:#44964C">删除包含"My"</span>的行到包含"You"的行之间的行，并打印其他行</span></p> 
<p><span style="font-family:Courier New; font-size:14px"> </span></p> 
<p><span style="font-family:Courier New; font-size:14px"><span style="color:red"> </span><strong><span style="color:red">s</span><span style="color:red">命令</span></strong></span></p> 
<p><span style="font-family:'Courier New'; font-size:14px"><strong>sed -i 's/My/You/' Test.log </strong> <span style="color:#33cc00">#将Test.log中文本My替换为You</span></span></p> 
<p><strong><span style="font-family:Courier New; font-size:14px">sed '<span style="color:red">s</span>/^My/You/<span style="color:red">g</span>' Test.log</span></strong></p> 
<p><span style="font-family:Courier New; font-size:14px"><span style="color:#44964C">#</span><span style="color:#44964C">命令末端的g</span>表示在行内进行全局替换，也就是说如果某行出现多个My，所有的My都被替换为You。</span></p> 
<p><strong><span style="font-family:Courier New; font-size:14px">sed -n '1,20s/My$/You/gp' Test.log</span></strong></p> 
<p><span style="font-family:Courier New; font-size:14px"><span style="color:#44964C">#</span><span style="color:#44964C">取消默认输出，处理1</span>到20行里匹配以My结尾的行，把行内所有的My替换为You，并打印到屏幕上。</span></p> 
<p><span style="font-family:Courier New; font-size:14px"><strong>sed '<span style="color:red">s</span>#My#Your#g' Test.log</strong><br> <span style="color:#44964C">#</span><span style="color:#44964C">紧跟在<u>s</u></span>命令后的字符就是查找串和替换串之间的分隔符。分隔符默认为正斜杠，但可以改变。无论什么字符（换行符、反斜线除外），只要紧跟s命令，就成了新的串分隔符。</span></p> 
<p><span style="color:#44964C"><span style="font-family:Courier New; font-size:14px"> </span></span></p> 
<p><span style="font-family:Courier New; font-size:14px"><span style="color:red"> </span><strong><span style="color:red">e</span><span style="color:red">命令</span></strong></span></p> 
<p><span style="font-family:Courier New; font-size:14px">-e是编辑命令，用于sed执行多个编辑任务的情况下。在下一行开始编辑前，所有的编辑动作将应用到模式缓冲区中的行上。</span></p> 
<p><strong><span style="font-family:Courier New; font-size:14px">sed -e '1,10d' -e 's/My/Your/g' Test.log</span></strong></p> 
<p><span style="font-family:Courier New; font-size:14px"><span style="color:#44964C">#</span><span style="color:#44964C">选项-e</span>用于进行多重编辑。第一重编辑删除第1-3行。第二重编辑将出现的所有My替换为Your。因为是逐行进行这两项编辑（即这两个命令都在模式空间的当前行上执行），所以编辑命令的顺序会影响结果。</span></p> 
<p><span style="color:#44964C"><span style="font-family:Courier New; font-size:14px"> </span></span></p> 
<p><span style="font-family:Courier New; font-size:14px"><span style="color:red"> </span><strong><span style="color:red">r</span><span style="color:red">命令</span></strong></span></p> 
<p><span style="font-family:Courier New; font-size:14px">r命令是读命令。sed使用该命令将一个文本文件中的内容加到当前文件的特定位置上</span></p> 
<p><span style="font-family:Courier New; font-size:14px"><strong>sed '/My/r introduce.txt' Test.log</strong><br> <span style="color:#44964C">#</span><span style="color:#44964C">如果在文件Test.log</span>的某一行匹配到模式My，就在该行后读入文件introduce.txt的内容。如果出现My的行不止一行，则在出现My的各行后都读入introduce.txt文件的内容。</span></p> 
<p><span style="font-family:Courier New; font-size:14px"> </span></p> 
<p><span style="font-family:Courier New; font-size:14px"><span style="color:red"> </span><strong><span style="color:red">w</span><span style="color:red">命令</span></strong></span></p> 
<p><strong><span style="font-family:Courier New; font-size:14px">sed -n '/hrwang/wme.txt' Test.log</span></strong></p> 
<p><strong><span style="font-family:Courier New; font-size:14px"> </span></strong></p> 
<p><span style="font-family:Courier New; font-size:14px"><span style="color:red"> </span><strong><span style="color:red">a\</span><span style="color:red">命令</span></strong></span></p> 
<p><span style="font-family:Courier New; font-size:14px">a\命令是追加命令，追加将添加新文本到文件中当前行（即读入模式缓冲区中的行）的后面。所追加的文本行位于sed命令的下方另起一行。如果要追加的内容超过一行，则每一行都必须以反斜线结束，最后一行除外。最后一行将以引号和文件名结束。</span></p> 
<p><strong><span style="font-family:Courier New; font-size:14px">sed '/^hrwang/a\</span></strong></p> 
<p><strong><span style="font-family:Courier New; font-size:14px">&gt;hrwang and mjfan are husband\</span></strong></p> 
<p><strong><span style="font-family:Courier New; font-size:14px">&gt;and wife' datafile</span></strong></p> 
<p><span style="font-family:Courier New; font-size:14px"><span style="color:#44964C">#</span><span style="color:#44964C">如果在datafile</span>文件中发现匹配以hrwang开头的行，则在该行下面追加hrwang and mjfan arehusband and wife</span></p> 
<p><strong><span style="font-family:Courier New; font-size:14px"> </span></strong></p> 
<p><span style="font-family:Courier New; font-size:14px"><span style="color:red"> </span><strong><span style="color:red">n</span><span style="color:red">命令</span></strong></span></p> 
<p><span style="font-family:Courier New; font-size:14px">sed使用该命令获取输入文件的下一行，并将其读入到模式缓冲区中，任何sed命令都将应用到匹配行紧接着的下一行上。</span></p> 
<p><strong><span style="font-family:Courier New; font-size:14px">sed '/hrwang/{n;s/My/Your/;}' datafile</span></strong></p> 
<p><span style="color:#44964C"><span style="font-family:Courier New; font-size:14px">注：如果需要使用多条命令，或者需要在某个地址范围内嵌套地址，就必须用花括号将命令括起来，每行只写一条命令，或这用分号分割同一行中的多条命令。</span></span></p> 
<p><strong><span style="font-family:Courier New; font-size:14px"> </span></strong></p> 
<p><span style="font-family:Courier New; font-size:14px"><strong><span style="color:red"> q</span><span style="color:red">命令</span></strong></span></p> 
<p><span style="font-family:Courier New; font-size:14px">q命令将导致sed程序退出，不再进行其它的处理。</span></p> 
<p><strong><span style="font-family:Courier New; font-size:14px">sed '/hrwang/{s/hrwang/HRWANG/;q;}'datafile</span></strong></p> 
<p><strong><span style="font-family:Courier New; font-size:14px"> </span></strong></p> 
<p><span style="font-family:Courier New; font-size:14px"><span style="color:red"> </span><strong><span style="color:red">h</span><span style="color:red">命令和g</span>命令</strong></span></p> 
<p><span style="font-family:Courier New; font-size:14px">#cat datafile</span></p> 
<p><span style="font-family:Courier New; font-size:14px">My name is hrwang.</span></p> 
<p><span style="font-family:Courier New; font-size:14px">Your name is mjfan.</span></p> 
<p><span style="font-family:Courier New; font-size:14px">hrwang is mjfan's husband.</span></p> 
<p><span style="font-family:Courier New; font-size:14px">mjfan is hrwang's wife.<strong></strong></span></p> 
<p><strong><span style="font-family:Courier New; font-size:14px">sed -e '/hrwang/h' -e '$G' datafile</span></strong></p> 
<p><strong><span style="font-family:Courier New; font-size:14px">sed -e '/hrwang/H' -e '$G' datafile</span></strong></p> 
<p><span style="font-family:Courier New; font-size:14px"><span style="color:#44964C">#</span><span style="color:#44964C">通过上面两条命令，你会发现h</span>会把原来暂存缓冲区的内容清除，只保存最近一次执行h时保存进去的模式空间的内容。而H命令则把每次匹配hrwnag的行都追加保存在暂存缓冲区。</span></p> 
<p><strong><span style="font-family:Courier New; font-size:14px">sed -e '/hrwang/H' -e '$g' datafile</span></strong></p> 
<p><strong><span style="font-family:Courier New; font-size:14px">sed -e '/hrwang/H' -e '$G' datafile</span></strong></p> 
<p><span style="font-family:Courier New; font-size:14px"><span style="color:#44964C">#</span><span style="color:#44964C">通过上面两条命令，你会发现g</span>把暂存缓冲区中的内容替换掉了模式空间中当前行的内容，此处即替换了最后一行。而G命令则把暂存缓冲区的内容追加到了模式空间的当前行后。此处即追加到了末尾。</span></p> 
<p><strong><span style="font-family:Courier New; font-size:14px"> </span></strong></p> 
<p><span style="font-family:Courier New; font-size:14px"><span style="color:red"> </span><strong><span style="color:red">sed</span><span style="color:red">脚本</span></strong></span></p> 
<p><span style="font-family:Courier New; font-size:14px">sed脚本就是写在文件中的一列sed命令。脚本中，要求命令的末尾不能有任何多余的空格或文本。如果在一行中有多个命令，要用分号分隔。执行脚本时，sed先将输入文件中第一行复制到模式缓冲区，然后对其执行脚本中所有的命令。每一行处理完毕后，sed再复制文件中下一行到模式缓冲区，对其执行脚本中所有命令。使用sed脚本时，不再用引号来确保sed命令不被shell解释。例如sed脚本script：</span></p> 
<table border="1" cellspacing="0" cellpadding="0" width="95%" style="background:#F1F1F1"><tbody><tr><td> <p><span style="font-family:Courier New; font-size:14px"><span style="color:#FF9900">#handle datafile</span><br> 3i\<br> <span style="color:#0000CC">~~~~~~~~~~~~~~~~~~~~~</span><br> 3<span style="color:#0000CC">,</span><span style="color:blue">$</span><span style="color:teal">s</span><span style="color:#0000CC">/\(</span>hrwang\<span style="color:#0000CC">)</span> is \<span style="color:#0000CC">(</span>mjfan\<span style="color:#0000CC">)/\</span>2 is \1<span style="color:#0000CC">/</span><br> <span style="color:blue">$</span><span style="color:teal">a\</span><br> We will love eachother <span style="color:blue">for</span>ever！！ </span></p> </td></tr><tr><td> <p><span style="font-family:Courier New; font-size:14px"><span style="color:#FF9900">#sed -f script datafile</span><br> <span style="color:blue">My</span> name is hrwang<br> Your name is mjfan<br> <span style="color:#0000CC">~~~~~~~~~~~~~~~~~~~~~</span><br> mjfan is hrwang's husband<span style="color:fuchsia">.          </span><span style="color:fuchsia"><br> </span>mjfan is hrwang's wife<span style="color:#0000CC">.</span><br> We will love eachother forever！！</span></p> </td></tr></tbody></table> 
<p><strong><span style="font-family:Courier New; font-size:14px"> </span></strong></p> 
<p><span style="font-family:Courier New; font-size:14px">      </span></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/64977fc2cafd52fb06adea840513f0bc/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">准确率与召回率</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f6d1253774fbd3e554b6d0db0a78bac5/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">尚未备份数据库 &#34;TEST&#34; 的日志尾部。如果该日志包含您不希望丢失的工作，请使用 BACKUP LOG WITH NORECOVERY 备份该日志。请使用 RESTORE 语句的 WITH REPL</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>