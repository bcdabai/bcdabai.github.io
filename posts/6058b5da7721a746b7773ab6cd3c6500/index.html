<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>KMP算法之next数组计算详细解析 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="KMP算法之next数组计算详细解析" />
<meta property="og:description" content="KMP算法 相比BF算法的改进：每当一趟匹配过程中出现字符比较不等时，无需回溯i指针（即无需将i指针完全退回至i-j&#43;1），而是利用已经得到的“部分匹配”的结果将模式向右“滑动”尽可能远的一段距离后，继续进行比较。需要解决的问题：当主串中的第i个字符与模式中第j个字符比较不相等时，主串中第i个字符（i指针不回溯）应与模式中哪个字符再比较？----假设从主串中第i个字符与模式中的第k个字符再进行比较它是则呢样来消除回溯的呢？就是因为它提取并运用了加速匹配的信息！
这种信息就是对于每模式串 t 的每个元素 t j，都存在一个实数 k ，使得模式串 t 开头的 k 个字符（t 0 t 1…t k-1）依次与 t j 前面的 k（t j-k t j-k&#43;1…t j-1，这里第一个字符 t j-k 最多从 t 1 开始，所以 k &lt; j）个字符相同。如果这样的 k 有多个，则取最大的一个。模式串 t 中每个位置 j 的字符都有这种信息，采用 next 数组表示，即 next[ j ]=MAX{ k }。 [外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-FxNAU0aV-1651734203665)(https://gitee.com/songjie001/typora_pictures/raw/master/2019032020342288.png)]
KMP算法（快速模式匹配算法）C语言详解 (biancheng.net)
充分利用了目标字符串t的性质（比如里面部分字符串的重复性，即使不存在重复字段，在比较时，实现最大的移动量）。
next数组里面存的是什么值呢？其实就是该位置前的字符串前缀与后缀的共用长度(文中的部分匹配值)-1（说白了就是前后相同的长度-1）
next数组计算：
next数组的含义就是一个固定字符串的最长前缀和最长后缀相同的长度。
KMP算法的精髓就在于next数组，从而达到跳跃式匹配的高效模式。
而next数组的值是代表着字符串的前缀与后缀相同的最大长度,(不能包括自身)。
注意：
最长前缀：是说以第一个字符开始，但是不包含最后一个字符。最长后缀：是说以最后一个字符开始，但是不包含第一个字符。 比如aaaa相同的最长前缀和最长后缀是aaa。
对于目标字符串ptr=ababaca，长度是7，所以next[0]，next[1]，next[2]，next[3]，next[4]，next[5]，next[6]分别计算的是
a：前缀：“”，后缀“”，相同的最长前缀和最长后缀是“”
ab：前缀：a，后缀b，相同的最长前缀和最长后缀是“”
aba：前缀：a、ab，后缀a、ba，相同的最长前缀和最长后缀是a
abab：前缀：a、ab、aba，后缀b、ab、bab，相同的最长前缀和最长后缀是ab
ababa：前缀：a、ab、aba、abab、，后缀a、ba、aba、baba，相同的最长前缀和最长后缀是aba
ababac：前缀：a、ab、aba、abab、ababa，后缀c、ac、bac、abac、babac，相同的最长前缀和最长后缀是“”
ababaca：前缀：a、ab、aba、abab、abab、ababac，后缀a、ca、aca、baca、abaca、babaca，相同的最长前缀和最长后缀是a
KMP算法讲解（next数组求解）_Liu Zhian的博客-CSDN博客_kmp算法next" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/6058b5da7721a746b7773ab6cd3c6500/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-10T16:38:47+08:00" />
<meta property="article:modified_time" content="2023-02-10T16:38:47+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">KMP算法之next数组计算详细解析</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="KMP_0"></a>KMP算法</h2> 
<ul><li>相比BF算法的改进：每当一趟匹配过程中出现字符比较不等时，无需回溯i指针（即无需将i指针完全退回至i-j+1），而是利用已经得到的“部分匹配”的结果将模式向右“滑动”尽可能远的一段距离后，继续进行比较。</li><li>需要解决的问题：当主串中的第i个字符与模式中第j个字符比较不相等时，主串中第i个字符（i指针不回溯）应与模式中哪个字符再比较？----假设从主串中第i个字符与模式中的第k个字符再进行比较</li><li>它是则呢样来消除回溯的呢？就是因为它提取并运用了加速匹配的信息！<br> 　　这种信息就是对于每模式串 t 的每个元素 t j，都存在一个实数 k ，使得模式串 t 开头的 k 个字符（t 0 t 1…t k-1）依次与 t j 前面的 k（t j-k t j-k+1…t j-1，这里第一个字符 t j-k 最多从 t 1 开始，所以 k &lt; j）个字符相同。如果这样的 k 有多个，则取最大的一个。模式串 t 中每个位置 j 的字符都有这种信息，采用 next 数组表示，即 next[ j ]=MAX{ k }。</li></ul> 
<p><img src="https://images2.imgbox.com/ff/44/dL2o4g1p_o.png" alt="img"></p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-FxNAU0aV-1651734203665)(https://gitee.com/songjie001/typora_pictures/raw/master/2019032020342288.png)]</p> 
<blockquote> 
 <p><a href="http://data.biancheng.net/view/180.html" rel="nofollow">KMP算法（快速模式匹配算法）C语言详解 (biancheng.net)</a></p> 
</blockquote> 
<p><strong>充分利用了目标字符串t的性质（比如里面部分字符串的重复性，即使不存在重复字段，在比较时，实现最大的移动量）。</strong></p> 
<p>next数组里面存的是什么值呢？其实就是<strong>该位置前</strong>的字符串前缀与后缀的共用长度(文中的部分匹配值)-1（说白了就是前后相同的长度-1）</p> 
<p><strong>next数组计算：</strong></p> 
<p>next数组的含义就是一个固定字符串的最长前缀和最长后缀相同的长度。</p> 
<p>KMP算法的精髓就在于next数组，从而达到跳跃式匹配的高效模式。</p> 
<p>而next数组的值是代表着字符串的前缀与后缀相同的最大长度,(不能包括自身)。</p> 
<p><strong>注意：</strong></p> 
<ul><li><strong>最长前缀：是说以第一个字符开始，但是不包含最后一个字符。</strong></li><li><strong>最长后缀：是说以最后一个字符开始，但是不包含第一个字符。</strong></li></ul> 
<p>比如aaaa相同的最长前缀和最长后缀是aaa。</p> 
<p>对于目标字符串ptr=ababaca，长度是7，所以next[0]，next[1]，next[2]，next[3]，next[4]，next[5]，next[6]分别计算的是</p> 
<p>a：前缀：“”，后缀“”，相同的最长前缀和最长后缀是“”</p> 
<p>ab：前缀：a，后缀b，相同的最长前缀和最长后缀是“”</p> 
<p>aba：前缀：a、ab，后缀a、ba，相同的最长前缀和最长后缀是a</p> 
<p>abab：前缀：a、ab、aba，后缀b、ab、bab，相同的最长前缀和最长后缀是ab</p> 
<p>ababa：前缀：a、ab、aba、abab、，后缀a、ba、aba、baba，相同的最长前缀和最长后缀是aba</p> 
<p>ababac：前缀：a、ab、aba、abab、ababa，后缀c、ac、bac、abac、babac，相同的最长前缀和最长后缀是“”</p> 
<p>ababaca：前缀：a、ab、aba、abab、abab、ababac，后缀a、ca、aca、baca、abaca、babaca，相同的最长前缀和最长后缀是a</p> 
<p><img src="https://images2.imgbox.com/4c/94/jHk2eBkm_o.png" alt="img"></p> 
<blockquote> 
 <p><a href="https://blog.csdn.net/qq_37174526/article/details/90141833">KMP算法讲解（next数组求解）_Liu Zhian的博客-CSDN博客_kmp算法next</a></p> 
 <p>[<a href="https://www.jianshu.com/p/6c53d06d23cc" rel="nofollow">算法] KMP算法中如何计算next数组 - 简书 (jianshu.com)</a></p> 
</blockquote> 
<h5><a id="next_53"></a>next数组计算</h5> 
<p><strong>注意：</strong></p> 
<ul><li><strong>最长前缀：是说以第一个字符开始，但是不包含最后一个字符。</strong></li><li><strong>最长后缀：是说以最后一个字符开始，但是不包含第一个字符。</strong></li></ul> 
<table><thead><tr><th>数组下标</th><th>0</th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th><th>8</th><th>9</th><th>10</th><th>11</th><th>12</th><th>13</th><th>14</th><th></th></tr></thead><tbody><tr><td>模式串元素</td><td>a</td><td>g</td><td>c</td><td>t</td><td>a</td><td>g</td><td>c</td><td>a</td><td>g</td><td>c</td><td>t</td><td>a</td><td>g</td><td>c</td><td>t</td><td></td></tr><tr><td>next</td><td>-1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>2</td><td>3</td><td>1</td><td>2</td><td>3</td><td>4</td><td>5</td><td>6</td><td>7</td><td>4</td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr></tbody></table> 
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          n 
         
        
          e 
         
        
          x 
         
        
          t 
         
        
          [ 
         
        
          j 
         
        
          ] 
         
        
          = 
         
         
         
           { 
          
          
           
            
             
              
              
                − 
               
              
                1 
               
              
             
            
            
             
              
               
              
                j 
               
              
                = 
               
              
                0 
               
              
                ( 
               
              
                不存在 
               
              
                t 
               
              
                [ 
               
              
                0 
               
              
                ] 
               
              
                到 
               
              
                t 
               
              
                [ 
               
              
                j 
               
              
                − 
               
              
                1 
               
              
                ] 
               
              
                的子串，无意义 
               
              
                ) 
               
              
             
            
           
           
            
             
              
              
                k 
               
              
                , 
               
              
                1 
               
              
                &lt; 
               
              
                = 
               
              
                k 
               
              
                &lt; 
               
              
                = 
               
              
                j 
               
              
             
            
            
             
              
               
              
                t 
               
              
                [ 
               
              
                0 
               
              
                ] 
               
              
                到 
               
              
                t 
               
              
                [ 
               
              
                j 
               
              
                − 
               
              
                1 
               
              
                ] 
               
              
                序列中最长的相同前缀与后缀长度为 
               
              
                k 
               
              
                ，即 
               
              
                t 
               
              
                [ 
               
              
                0 
               
              
                ] 
               
              
                . 
               
              
                . 
               
              
                . 
               
              
                t 
               
              
                [ 
               
              
                k 
               
              
                ] 
               
              
                = 
               
              
                t 
               
              
                [ 
               
              
                j 
               
              
                − 
               
              
                k 
               
              
                ] 
               
              
                . 
               
              
                . 
               
              
                . 
               
              
                t 
               
              
                [ 
               
              
                j 
               
              
                − 
               
              
                1 
               
              
                ] 
               
              
             
            
           
           
            
             
             
               0 
              
             
            
            
             
              
               
              
                t 
               
              
                [ 
               
              
                0 
               
              
                ] 
               
              
                到 
               
              
                t 
               
              
                [ 
               
              
                j 
               
              
                − 
               
              
                1 
               
              
                ] 
               
              
                序列中不存在相同的前缀与后缀 
               
              
                ) 
               
              
             
            
           
          
         
        
       
         next[j] = \begin{cases} -1 &amp; {\quad j=0(不存在t[0]到t[j-1]的子串，无意义)} \\ k,1&lt;= k &lt;=j &amp; { \quad t[0]到t[j-1]序列中最长的相同前缀与后缀长度为k，即t[0]...t[k]=t[j-k]...t[j-1]} \\ 0 &amp; {\quad t[0]到t[j-1]序列中不存在相同的前缀与后缀)} \\ \end{cases} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mord mathnormal">t</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right: 0.0572em;">j</span><span class="mclose">]</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 4.32em; vertical-align: -1.91em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.35em;"><span class="" style="top: -2.2em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎩</span></span></span><span class="" style="top: -2.192em;"><span class="pstrut" style="height: 3.15em;"></span><span class="" style="height: 0.316em; width: 0.8889em;"> 
              <svg width="0.8889em" height="0.316em" style="width:0.8889em" viewbox="0 0 888.89 316" preserveaspectratio="xMinYMin"> 
               <path d="M384 0 H504 V316 H384z M384 0 H504 V316 H384z"></path> 
              </svg></span></span><span class="" style="top: -3.15em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎨</span></span></span><span class="" style="top: -4.292em;"><span class="pstrut" style="height: 3.15em;"></span><span class="" style="height: 0.316em; width: 0.8889em;"> 
              <svg width="0.8889em" height="0.316em" style="width:0.8889em" viewbox="0 0 888.89 316" preserveaspectratio="xMinYMin"> 
               <path d="M384 0 H504 V316 H384z M384 0 H504 V316 H384z"></path> 
              </svg></span></span><span class="" style="top: -4.6em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎧</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.85em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.41em;"><span class="" style="top: -4.41em;"><span class="pstrut" style="height: 3.008em;"></span><span class="mord"><span class="mord">−</span><span class="mord">1</span></span></span><span class="" style="top: -2.97em;"><span class="pstrut" style="height: 3.008em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0315em;">k</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord">1</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">&lt;=</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mord mathnormal" style="margin-right: 0.0315em;">k</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">&lt;=</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mord mathnormal" style="margin-right: 0.0572em;">j</span></span></span><span class="" style="top: -1.53em;"><span class="pstrut" style="height: 3.008em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.91em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 1em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.41em;"><span class="" style="top: -4.41em;"><span class="pstrut" style="height: 3.008em;"></span><span class="mord"><span class="mord"><span class="mspace" style="margin-right: 1em;"></span><span class="mord mathnormal" style="margin-right: 0.0572em;">j</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mord">0</span><span class="mopen">(</span><span class="mord cjk_fallback">不存在</span><span class="mord mathnormal">t</span><span class="mopen">[</span><span class="mord">0</span><span class="mclose">]</span><span class="mord cjk_fallback">到</span><span class="mord mathnormal">t</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right: 0.0572em;">j</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord">1</span><span class="mclose">]</span><span class="mord cjk_fallback">的子串，无意义</span><span class="mclose">)</span></span></span></span><span class="" style="top: -2.97em;"><span class="pstrut" style="height: 3.008em;"></span><span class="mord"><span class="mord"><span class="mspace" style="margin-right: 1em;"></span><span class="mord mathnormal">t</span><span class="mopen">[</span><span class="mord">0</span><span class="mclose">]</span><span class="mord cjk_fallback">到</span><span class="mord mathnormal">t</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right: 0.0572em;">j</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord">1</span><span class="mclose">]</span><span class="mord cjk_fallback">序列中最长的相同前缀与后缀长度为</span><span class="mord mathnormal" style="margin-right: 0.0315em;">k</span><span class="mord cjk_fallback">，即</span><span class="mord mathnormal">t</span><span class="mopen">[</span><span class="mord">0</span><span class="mclose">]</span><span class="mord">...</span><span class="mord mathnormal">t</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right: 0.0315em;">k</span><span class="mclose">]</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mord mathnormal">t</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right: 0.0572em;">j</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord mathnormal" style="margin-right: 0.0315em;">k</span><span class="mclose">]</span><span class="mord">...</span><span class="mord mathnormal">t</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right: 0.0572em;">j</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord">1</span><span class="mclose">]</span></span></span></span><span class="" style="top: -1.53em;"><span class="pstrut" style="height: 3.008em;"></span><span class="mord"><span class="mord"><span class="mspace" style="margin-right: 1em;"></span><span class="mord mathnormal">t</span><span class="mopen">[</span><span class="mord">0</span><span class="mclose">]</span><span class="mord cjk_fallback">到</span><span class="mord mathnormal">t</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right: 0.0572em;">j</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord">1</span><span class="mclose">]</span><span class="mord cjk_fallback">序列中不存在相同的前缀与后缀</span><span class="mclose">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.91em;"><span class=""></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span></p> 
<p>j = 0：不存在t[0]到t[j-1]的子串，无意义，故next[0] = -1（固定）</p> 
<p>j = 1：子串t[0]到t[j-1]：a，无前缀与后缀，故next[1] = 0（固定）</p> 
<p>j = 2：子串t[0]到t[j-1]：ag，t[0]=a，t[j-1]=t[1]=g，不相等，故next[2] = 0</p> 
<p>j = 3：子串t[0]到t[j-1]：agc，t[0]=a，t[j-1]=t[2]=c，不相等，故next[3] = 0</p> 
<p>j = 4：子串t[0]到t[j-1]：agct，t[0]=a，t[j-1]=t[3]=t，不相等，故next[4] = 0</p> 
<p>j = 5：子串t[0]到t[j-1]：agcta，t[0]=a，t[j-1]=t[4]=a，相等，故next[5] = 1</p> 
<p>j = 6：子串t[0]到t[j-1]：agctag，t[1]=g，t[j-1]=t[5]=g，相等，故next[6] = next[5]+1 = 2</p> 
<p>j = 7：子串t[0]到t[j-1]：agctagc，t[2]=c，t[j-1]=t[6]=c，相等，故next[7] = next[6]+1 = 3</p> 
<p>j = 8：子串t[0]到t[j-1]：agctagca，t[3]=c，t[j-1]=t[7]=a，不相等（一旦出现不相等的情况，则代表不能继续前面计算的相同前缀后缀，要重新找相同的前缀后缀，没有之前的长，按道理需要再从t[0]…与…t[j-1]开始挨个增加对比）</p> 
<p>如：此处 t[0]=a，t[j-1]=t[7]=a，相等；故最长的相同前缀后缀为1，next[8] = 1</p> 
<p>j = 9：子串t[0]到t[j-1]：agctagcag，t[1]=g，t[j-1]=t[8]=g，相等，故next[9] = next[8]+1 = 2</p> 
<p>j = 10：子串t[0]到t[j-1]：agctagcagc，t[2]=c，t[j-1]=t[9]=c，相等，故next[10] = next[9]+1 = 3</p> 
<p>j = 11：子串t[0]到t[j-1]：agctagcagct，t[3]=t，t[j-1]=t[10]=t，相等，故next[11] = next[10]+1 = 4</p> 
<p>j = 12：子串t[0]到t[j-1]：agctagcagcta，t[4]=a，t[j-1]=t[11]=a，相等，故next[12] = next[11]+1 = 5</p> 
<p>j = 13：子串t[0]到t[j-1]：agctagcagctag，t[5]=g，t[j-1]=t[12]=g，相等，故next[13] = next[12]+1 = 6</p> 
<p>j = 14：子串t[0]到t[j-1]：agctagcagctagc，t[6]=c，t[j-1]=t[13]=c，相等，故next[14] = next[13]+1 = 7</p> 
<p>j = 15：子串t[0]到t[j-1]：agctagcagctagct，t[7]=a，t[j-1]=t[14]=t，不相等（一旦出现不相等的情况，则代表不能继续前面计算的相同前缀后缀，要重新找相同的前缀后缀，没有之前的长，按道理需要再从t[0]…与…t[j-1]开始挨个增加对比）</p> 
<p>如：此处 t[0]t[1]t[2]t[3]=agct，t[j-4]t[j-3]t[j-2]t[j-1]=agct，相等；故最长的相同前缀后缀为1，next[14] = 4</p> 
<p>此处计算如何合理利用前面已经计算出的next数组？</p> 
<p><img src="https://images2.imgbox.com/53/32/7r6VhTFQ_o.png" alt="image-20220504145114759"></p> 
<p>由前一步的next计算可知，序列 A=B（相同前缀后缀）</p> 
<p>新增加t[14]后，计算next[15]时，由于t[7] != t[j-1]=t[14]，此时k=7，j=15，故不能继续之前的前缀继续匹配，但也不一定直接退到t[0]处：</p> 
<p><strong>假设</strong>新增加t[14]后，子串t[0]到t[14]中仍然存在一个长度为k1（k1一定小于k）的序列，t[0]…t[k1]=t[j-k1]…t[14]，</p> 
<p>此时先不考虑新增的t[14]，即先忽略t[14]与t[k1]是否相等，首先要在t[0]到t[k-1]前缀中找出一个与t[j-k+1]…t[13]后缀相等的序列（次长的相同前缀后缀）</p> 
<p>若存在次长的相同前缀后缀序列，则可以得出t[0]…t[k1-1]=t[j-k1]…t[13]</p> 
<p><img src="https://images2.imgbox.com/7b/01/cAs3j9yc_o.png" alt="image-20220504145537882"></p> 
<p>借助前面的已知信息或计算出的next：</p> 
<p>next[14] = 7， A = B</p> 
<p>next[7] = 3， C = D</p> 
<p>故 E = C，F = D</p> 
<p>故 C = F，忽略t[14]时已有的相同前缀后缀长度为3（next[7]=3，原始k=7，已经比较到t[7]，）</p> 
<p>此时再度比较t[3]与t[14]，若相等，则next[15] = 3 + 1；否则，按照上述方式继续回退，直至退回到比较t[0]与t[j-1]</p> 
<p>------&gt; 以上推导，确定是否可能存在次长相同前缀后缀（不为空）的重要条件就是，next[k=7]的值！</p> 
<p>------&gt; next[7]为0时，不存在次长相同前缀后缀，直接比较t[0]与t[j]；next[k]不为0时，已经存在一个长度为 next[k]的相同前缀后缀序列，下一步继续比较t[k]与t[j]即可。</p> 
<ul><li>KMP算法的关键就是这个k的回退，灵活运用到已经算出的信息，无需每步回退至0重新匹配判断。</li></ul> 
<p>最终next数组的计算代码：</p> 
<pre><code class="prism language-java">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">get_next</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> t<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> next<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        next<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//无意义，不存在子串t[0]到t[0-1]</span>
        next<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>j <span class="token operator">&lt;</span> t<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//注意k=-1的情况，此时无论字符是否相等，k,j都要加一（）</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>k <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">||</span> t<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">==</span> t<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                next<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"next %d = %d\n"</span><span class="token punctuation">,</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> next<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                k<span class="token operator">++</span><span class="token punctuation">;</span>
                j<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>next<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                k <span class="token operator">=</span> next<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//回退部分，继续比较</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"当j= %d 时，k回退至 %d\n"</span><span class="token punctuation">,</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>KMF算法与BF算法完整代码：</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">KMF</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//System.out.println(Is_KMF("012345678", "4568"));</span>
        <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> t <span class="token operator">=</span> <span class="token string">"agctagcagctagct"</span><span class="token punctuation">.</span><span class="token function">toCharArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> s <span class="token operator">=</span> <span class="token string">"aaggccagctagctagctagctagcagctagct"</span><span class="token punctuation">.</span><span class="token function">toCharArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> next <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span>t<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token function">get_next</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> next<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"最终的next数组："</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> next<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"next [%d] = %d\n"</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> next<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"---------------------------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Is_BF</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"---------------------------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Is_KMF</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> t<span class="token punctuation">,</span> next<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token class-name">Is_BF</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> str<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> tem<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token comment">//当两个串均未比较到串尾</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> str<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span> j <span class="token operator">&lt;</span> tem<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>str<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> tem<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                i<span class="token operator">++</span><span class="token punctuation">;</span>
                j<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                i <span class="token operator">=</span> i <span class="token operator">-</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
                j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>j <span class="token operator">==</span> tem<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
            <span class="token keyword">return</span> i <span class="token operator">-</span> j<span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token class-name">Is_KMF</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> str<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> tem<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> next<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token comment">//当两个串均未比较到串尾</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> str<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span> j <span class="token operator">&lt;</span> tem<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>str<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> tem<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                i<span class="token operator">++</span><span class="token punctuation">;</span>
                j<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>j <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                i<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                j <span class="token operator">=</span> next<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"j= %d 时，退回至 %d\n"</span><span class="token punctuation">,</span> j<span class="token punctuation">,</span> next<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>j <span class="token operator">==</span> tem<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
            <span class="token keyword">return</span> i <span class="token operator">-</span> j<span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">get_next</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> t<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> next<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        next<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//无意义，不存在子串t[0]到t[0-1]</span>
        next<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>j <span class="token operator">&lt;</span> t<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//注意k=-1的情况，此时无论字符是否相等，k,j都要加一（）</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>k <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">||</span> t<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">==</span> t<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                next<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"next %d = %d\n"</span><span class="token punctuation">,</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> next<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                k<span class="token operator">++</span><span class="token punctuation">;</span>
                j<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>next<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                k <span class="token operator">=</span> next<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//回退部分，继续比较</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"当j= %d 时，k回退至 %d\n"</span><span class="token punctuation">,</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/cc868583c23969aeb36ba2cc13948853/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Java poi word导出工具</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a02633570894f909b1d01a2f8ad032a3/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">渗透测试奇淫技巧——信息收集</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>