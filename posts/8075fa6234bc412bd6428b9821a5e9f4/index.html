<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>freeswitch on centos dockerfile模式 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="freeswitch on centos dockerfile模式" />
<meta property="og:description" content="概述 freeswitch是一款简单好用的VOIP开源软交换平台。
centos7 docker上编译安装fs的流程记录，本文使用dockerfile模式。
环境 docker engine：Version 24.0.6
centos docker：7
freeswitch：v1.6.20
dockerfile 创建空目录，创建dockerfile文件。
github访问经常失败，先下载好源码包，并将fs.1.6.20源码文件夹拷贝到目录下。
mkdir centos.7-fs.1.6.20
cd centos.7-fs.1.6.20
ls
dockerfile freeswitch-1.6.20
dockerfile文件内容如下。
vi dockerfile
FROM centos:7
WORKDIR /root
ADD ./freeswitch-1.6.20 /root/freeswitch
RUN cd /root/ \
&amp;&amp; yum -y update \
&amp;&amp; echo &#34;signalwireusername&#34; &gt; /etc/yum/vars/signalwireusername \
&amp;&amp; echo &#34;pat_signalwiretoken&#34; &gt; /etc/yum/vars/signalwiretoken \
&amp;&amp; yum install -y https://$(&lt; /etc/yum/vars/signalwireusername):$(&lt; /etc/yum/vars/signalwiretoken)@freeswitch.signalwire.com/repo/yum/centos-release/freeswitch-release-repo-0-1.noarch.rpm \
&amp;&amp; yum install -y epel-release \
&amp;&amp; yum install -y autoconf automake libtool gcc-c&#43;&#43; ncurses-devel make zlib-devel libjpeg-devel yasm nasm libevent libevent-devel \" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/8075fa6234bc412bd6428b9821a5e9f4/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-19T18:20:15+08:00" />
<meta property="article:modified_time" content="2024-01-19T18:20:15+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">freeswitch on centos dockerfile模式</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="margin-left:0;text-align:center;"><img alt="" height="810" src="https://images2.imgbox.com/4b/25/dMmEMVPc_o.jpg" width="1080"></p> 
<h2 style="margin-left:0;text-align:justify;">概述</h2> 
<p style="margin-left:0;text-align:justify;">freeswitch是一款简单好用的VOIP开源软交换平台。</p> 
<p style="margin-left:0;text-align:justify;">centos7 docker上编译安装fs的流程记录，本文使用dockerfile模式。</p> 
<h2 style="margin-left:0;text-align:justify;">环境</h2> 
<p style="margin-left:0;text-align:justify;">docker engine：Version 24.0.6</p> 
<p style="margin-left:0;text-align:justify;">centos docker：7</p> 
<p style="margin-left:0;text-align:justify;">freeswitch：v1.6.20</p> 
<h2 style="margin-left:0;text-align:justify;">dockerfile</h2> 
<p style="margin-left:0;text-align:justify;">创建空目录，创建dockerfile文件。</p> 
<p style="margin-left:0;text-align:justify;">github访问经常失败，先下载好源码包，并将fs.1.6.20源码文件夹拷贝到目录下。</p> 
<p style="margin-left:0;text-align:justify;">mkdir centos.7-fs.1.6.20</p> 
<p style="margin-left:0;text-align:justify;">cd centos.7-fs.1.6.20</p> 
<p style="margin-left:0;text-align:justify;">ls</p> 
<p style="margin-left:0;text-align:justify;">dockerfile  freeswitch-1.6.20</p> 
<p style="margin-left:0;text-align:justify;"></p> 
<p style="margin-left:0;text-align:justify;">dockerfile文件内容如下。</p> 
<p style="margin-left:0;text-align:justify;">vi dockerfile</p> 
<p style="margin-left:0;text-align:justify;"></p> 
<p style="margin-left:0;text-align:justify;">FROM centos:7</p> 
<p style="margin-left:0;text-align:justify;"></p> 
<p style="margin-left:0;text-align:justify;">WORKDIR      /root</p> 
<p style="margin-left:0;text-align:justify;"></p> 
<p style="margin-left:0;text-align:justify;">ADD ./freeswitch-1.6.20 /root/freeswitch</p> 
<p style="margin-left:0;text-align:justify;"></p> 
<p style="margin-left:0;text-align:justify;">RUN cd /root/ \</p> 
<p style="margin-left:0;text-align:justify;">    &amp;&amp; yum -y update \</p> 
<p style="margin-left:0;text-align:justify;">    &amp;&amp; echo "signalwireusername" &gt; /etc/yum/vars/signalwireusername \</p> 
<p style="margin-left:0;text-align:justify;">    &amp;&amp; echo "pat_signalwiretoken" &gt; /etc/yum/vars/signalwiretoken \</p> 
<p style="margin-left:0;text-align:justify;">    &amp;&amp; yum install -y https://$(&lt; /etc/yum/vars/signalwireusername):$(&lt; /etc/yum/vars/signalwiretoken)@freeswitch.signalwire.com/repo/yum/centos-release/freeswitch-release-repo-0-1.noarch.rpm  \</p> 
<p style="margin-left:0;text-align:justify;">    &amp;&amp; yum install -y epel-release \</p> 
<p style="margin-left:0;text-align:justify;">    &amp;&amp; yum install -y autoconf automake libtool gcc-c++ ncurses-devel make zlib-devel libjpeg-devel yasm  nasm  libevent  libevent-devel \</p> 
<p style="margin-left:0;text-align:justify;">    &amp;&amp; yum install -y openssl-devel e2fsprogs-devel curl-devel pcre-devel speex-devel sqlite-devel mysql-devel \</p> 
<p style="margin-left:0;text-align:justify;">    &amp;&amp; yum install -y git ldns-devel libedit-devel lua-devel libsndfile-devel libshout-devel lame-devel \</p> 
<p style="margin-left:0;text-align:justify;">    &amp;&amp; yum install -y which tzdata ilbc2-devel opus-devel \</p> 
<p style="margin-left:0;text-align:justify;">    # &amp;&amp; git clone https://github.com/signalwire/freeswitch.git -bv1.6.20 freeswitch \</p> 
<p style="margin-left:0;text-align:justify;">    &amp;&amp; cd /root/freeswitch/ \</p> 
<p style="margin-left:0;text-align:justify;">    &amp;&amp; chmod 775 -R * \</p> 
<p style="margin-left:0;text-align:justify;">    &amp;&amp; sh support-d/prereq.sh \</p> 
<p style="margin-left:0;text-align:justify;">    &amp;&amp; ./bootstrap.sh -j \</p> 
<p style="margin-left:0;text-align:justify;">    &amp;&amp; ./configure \</p> 
<p style="margin-left:0;text-align:justify;">    &amp;&amp; make \</p> 
<p style="margin-left:0;text-align:justify;">    &amp;&amp; make install \</p> 
<p style="margin-left:0;text-align:justify;">    &amp;&amp; cd /root/freeswitch/src/mod/codecs/mod_ilbc \</p> 
<p style="margin-left:0;text-align:justify;">    &amp;&amp; make \</p> 
<p style="margin-left:0;text-align:justify;">    &amp;&amp; make install \</p> 
<p style="margin-left:0;text-align:justify;">    &amp;&amp; cd /root/freeswitch/src/mod/applications/mod_translate \</p> 
<p style="margin-left:0;text-align:justify;">    &amp;&amp; make \</p> 
<p style="margin-left:0;text-align:justify;">    &amp;&amp; make install \</p> 
<p style="margin-left:0;text-align:justify;">    &amp;&amp; ln -s /usr/lib64/ilbc2/libilbc.so.0 /usr/lib64/libilbc.so.0 \</p> 
<p style="margin-left:0;text-align:justify;">    &amp;&amp; cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime \</p> 
<p style="margin-left:0;text-align:justify;">    &amp;&amp; yum clean all \</p> 
<p style="margin-left:0;text-align:justify;">    &amp;&amp; rm -rf /var/cache/yum \</p> 
<p style="margin-left:0;text-align:justify;">    &amp;&amp; rm -rf /root/freeswitch \</p> 
<p style="margin-left:0;text-align:justify;">    &amp;&amp; rm -rf /usr/local/freeswitch/conf /usr/local/freeswitch/log /usr/local/freeswitch/recordings</p> 
<p style="margin-left:0;text-align:justify;"></p> 
<p style="margin-left:0;text-align:justify;"># EXPOSE 5080</p> 
<p style="margin-left:0;text-align:justify;"></p> 
<p style="margin-left:0;text-align:justify;">VOLUME ["/usr/local/freeswitch/conf", "/usr/local/freeswitch/log", "/usr/local/freeswitch/recordings", "/usr/local/freeswitch/sounds", "/usr/local/freeswitch/webapp"]</p> 
<p style="margin-left:0;text-align:justify;"></p> 
<p style="margin-left:0;text-align:justify;">CMD /usr/local/freeswitch/bin/freeswitch -nonat -nosql -nonatmap -nocal -nort</p> 
<h2 style="margin-left:0;text-align:justify;">镜像操作</h2> 
<p style="margin-left:0;text-align:justify;">制作镜像，注意命令最后一个参数是当前目录“.“。</p> 
<p style="margin-left:0;text-align:justify;">sudo docker build -t 10.55.55.136:5000/zr/centos.7-fs.1.6.20-test:v1.0 .</p> 
<p style="margin-left:0;text-align:justify;">[+] Building 768.1s (9/9) FINISHED                                                                                                                                                                               docker:default</p> 
<p style="margin-left:0;text-align:justify;"> =&gt; [internal] load .dockerignore                                                                                                                                                                                          0.2s</p> 
<p style="margin-left:0;text-align:justify;"> =&gt; =&gt; transferring context: 2B                                                                                                                                                                                            0.0s</p> 
<p style="margin-left:0;text-align:justify;"> =&gt; [internal] load build definition from dockerfile                                                                                                                                                                       0.1s</p> 
<p style="margin-left:0;text-align:justify;"> =&gt; =&gt; transferring dockerfile: 2.03kB                                                                                                                                                                                     0.0s</p> 
<p style="margin-left:0;text-align:justify;"> =&gt; [internal] load metadata for docker.io/library/centos:7                                                                                                                                                                0.0s</p> 
<p style="margin-left:0;text-align:justify;"> =&gt; [1/4] FROM docker.io/library/centos:7                                                                                                                                                                                  0.0s</p> 
<p style="margin-left:0;text-align:justify;"> =&gt; [internal] load build context                                                                                                                                                                                          2.3s</p> 
<p style="margin-left:0;text-align:justify;"> =&gt; =&gt; transferring context: 190.73MB                                                                                                                                                                                      2.0s</p> 
<p style="margin-left:0;text-align:justify;"> =&gt; CACHED [2/4] WORKDIR /ROOT                                                                                                                                                                                             0.0s</p> 
<p style="margin-left:0;text-align:justify;"> =&gt; [3/4] ADD ./freeswitch-1.6.20 /root/freeswitch                                                                                                                                                                         1.7s</p> 
<p style="margin-left:0;text-align:justify;"> =&gt; [4/4] RUN cd /root/     &amp;&amp; yum -y update     &amp;&amp; echo "signalwireusername" &gt; /etc/yum/vars/signalwireusername     &amp;&amp; echo "pat_signalwiretoken" &gt; /etc/yum/vars/signalwiretoken     &amp;&amp; yum install -y https://$(&lt;   757.8s</p> 
<p style="margin-left:0;text-align:justify;"> =&gt; exporting to image                                                                                                                                                                                                     5.5s</p> 
<p style="margin-left:0;text-align:justify;"> =&gt; =&gt; exporting layers                                                                                                                                                                                                    5.5s</p> 
<p style="margin-left:0;text-align:justify;"> =&gt; =&gt; writing image sha256:a0a8c5564ad901bc931d9610169b3388f60e07d2201f846d9c35a8603b880e69                                                                                                                               0.0s</p> 
<p style="margin-left:0;text-align:justify;"> =&gt; =&gt; naming to 10.55.55.136:5000/zr/centos.7-fs.1.6.20-test:v1.0                                                                                                                                                         0.0s</p> 
<p style="margin-left:0;text-align:justify;"></p> 
<p style="margin-left:0;text-align:justify;">上传镜像到registry。</p> 
<p style="margin-left:0;text-align:justify;">sudo docker images</p> 
<p style="margin-left:0;text-align:justify;">sudo docker push 10.55.55.136:5000/zr/centos.7-fs.1.6.20-test:v1.0</p> 
<p style="margin-left:0;text-align:justify;"></p> 
<p style="margin-left:0;text-align:justify;">下载镜像。</p> 
<p style="margin-left:0;text-align:justify;">sudo docker pull 10.55.55.136:5000/zr/centos.7-fs.1.6.20-test:v1.0</p> 
<p style="margin-left:0;text-align:justify;"></p> 
<p style="margin-left:0;text-align:justify;">查看私服registry的镜像版本。</p> 
<p style="margin-left:0;text-align:justify;">curl -XGET http://10.55.55.136:5000/v2/_catalog</p> 
<p style="margin-left:0;text-align:justify;">{"repositories":["test/debian","test/registry","zr/centos.7-fs.1.6.19-compile","zr/centos.7-fs.1.6.19-release"]}</p> 
<p style="margin-left:0;text-align:justify;"></p> 
<p style="margin-left:0;text-align:justify;">curl -XGET http://10.55.55.136:5000/v2/zr/centos.7-fs.1.6.19-release/tags/list</p> 
<p style="margin-left:0;text-align:justify;">{"name":"zr/centos.7-fs.1.6.19-release","tags":["v1.1","v1.2","v1.3","v1.4","v1.5","v1.6"]}</p> 
<h2 style="margin-left:0;text-align:justify;">问题处理</h2> 
<p style="margin-left:0;text-align:justify;">DOCKER使用过程问题汇总。</p> 
<p style="text-align:justify;">1 docker容器的时区设置问题，在容器中执行如下命令。</p> 
<p style="margin-left:0;text-align:justify;">yum install tzdata</p> 
<p style="margin-left:0;text-align:justify;">cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</p> 
<p style="text-align:justify;">2 运行一个无日志的Docker容器。</p> 
<p style="margin-left:0;text-align:justify;">docker run -d --log-driver none your_image_name</p> 
<p style="text-align:justify;">3 docker容器访问宿主机上nas目录的状态，取决于docker服务启动时宿主机挂载nas目录的状态。</p> 
<p style="margin-left:0;text-align:justify;">所以，nas挂载目录有变化的时候，需要重启docker服务，以便docker容器可以正常访问nas目录。</p> 
<p style="text-align:justify;">4 docker容器自动重启。</p> 
<p style="margin-left:0;text-align:justify;">docker run -d --restart=always your_image_name</p> 
<h2 style="margin-left:0;text-align:justify;">总结</h2> 
<p style="margin-left:0;text-align:justify;">centos系统后续的维护问题需要关注。</p> 
<p style="margin-left:0;text-align:justify;">centos和rocky的方向需要验证和抉择一下。</p> 
<p style="margin-left:0;text-align:justify;"></p> 
<p style="margin-left:0;text-align:justify;">空空如常</p> 
<p style="margin-left:0;text-align:justify;">求真得真</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a3a4a1a130cef42fbfe45aa6181b6fd1/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">K8s知识点总结_part1</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/347fcb53b80cae75f278dec0b38ed47b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">基于SpringBoot实现策略模式提供系统接口扩展能力</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>