<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>CC2530的串口通信原理与应用 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="CC2530的串口通信原理与应用" />
<meta property="og:description" content="目录 1.CC2530的串口资源1.1.CC2530的UART串口引脚的映射关系1.2.PERCFG外设控制寄存器 2.波特率的计算与设置3.串口0的UART初始化设置4.案例4.1.串口数据发送4.2.串口数据收发4.3.串口命令控制LED灯开关 1.CC2530的串口资源 CC2530有两个串行通信接口：异步UART模式： USART0和同步SPI模式： USART1
对于每个USART外设，有5个相关的寄存器（x时USART的编号，0或1）
UxCSR： USARTx 控制状态寄存器
UxUCR： USARTx UART控制寄存器
UxGCR： USARTx 通用控制寄存器
UxBUF： USARTx UART接受/发送数据缓冲区
UxBAUD： USARTx 波特率控制寄存器
1.1.CC2530的UART串口引脚的映射关系 两个USART接口具有相同的功能，通过PERCFG寄存器可以设置两个USART接口对应外部I/O引脚的映射关系
1.2.PERCFG外设控制寄存器 2.波特率的计算与设置 CC2530的波特率有BAUD_E和BAUD_M共同决定：
F为系统时钟频率，16MHz或32MHz
TI公司提供的数据手册中，给出了32MHz系统时钟频率下各种常用波特率的参数值
由计算公式可已计算出16MHz系统时钟频率下对应的参数值
16MHz下9600波特率的UxBAUD.BAUD_M：U0BAUD = 5916MHz下9600波特率的UxGCR.BAUD_E：U0GCR = 9 3.串口0的UART初始化设置 void Init_Uart0(){ //端口配置 PERCFG &amp;= ~0x01; //将串口0的引脚映射到位置1，即P0_2和P0_3 P0SEL = 0x0C; //将P0_2和P0_3端口设置为外设功能 /*======使用CC2530的内部16MHz晶振产生9600的波特率====*/ //波特率配置 U0BAUD = 59; U0GCR = 9; //流控配置 U0UCR |= 0x80; //禁止流控，8位数据，清楚缓冲器 //串口模式配置 U0CSR |= 0xC0; //选择UART模式，使能接收器 //中断配置 UTX0IF = 0; //清除TX发送中断标志 URX0IF = 0; //清除RX接收中断标志 URX0IE = 1; //使能URAT0的接收中断 EA = 1; //使能总中断 } 4." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/1dd6d4ba3dc4a2f55a23e9724e36937c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-06-15T10:26:51+08:00" />
<meta property="article:modified_time" content="2021-06-15T10:26:51+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">CC2530的串口通信原理与应用</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-dracula">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <hr> 
<p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#1CC2530_4" rel="nofollow">1.CC2530的串口资源</a></li><li><ul><li><a href="#11CC2530UART_14" rel="nofollow">1.1.CC2530的UART串口引脚的映射关系</a></li><li><a href="#12PERCFG_19" rel="nofollow">1.2.PERCFG外设控制寄存器</a></li></ul> 
  </li><li><a href="#2_23" rel="nofollow">2.波特率的计算与设置</a></li><li><a href="#30UART_36" rel="nofollow">3.串口0的UART初始化设置</a></li><li><a href="#4_64" rel="nofollow">4.案例</a></li><li><ul><li><a href="#41_65" rel="nofollow">4.1.串口数据发送</a></li><li><a href="#42_150" rel="nofollow">4.2.串口数据收发</a></li><li><a href="#43LED_227" rel="nofollow">4.3.串口命令控制LED灯开关</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="1CC2530_4"></a>1.CC2530的串口资源</h2> 
<p>CC2530有两个串行通信接口：<strong>异步UART模式：</strong> USART0和<strong>同步SPI模式：</strong> USART1</p> 
<p>对于每个<strong>USART外设</strong>，有<strong>5个</strong>相关的寄存器（x时USART的编号，0或1）</p> 
<blockquote> 
 <p><strong>UxCSR：</strong> USARTx 控制状态寄存器<br> <strong>UxUCR：</strong> USARTx UART控制寄存器<br> <strong>UxGCR：</strong> USARTx 通用控制寄存器<br> <strong>UxBUF：</strong> USARTx UART接受/发送数据缓冲区<br> <strong>UxBAUD：</strong> USARTx 波特率控制寄存器</p> 
</blockquote> 
<h3><a id="11CC2530UART_14"></a>1.1.CC2530的UART串口引脚的映射关系</h3> 
<p>两个USART接口具有相同的功能，通过<strong>PERCFG寄存器</strong>可以设置两个USART接口对应外部I/O引脚的<strong>映射关系</strong><br> <img src="https://images2.imgbox.com/d9/37/KwAfKVVG_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="12PERCFG_19"></a>1.2.PERCFG外设控制寄存器</h3> 
<p><img src="https://images2.imgbox.com/c5/b4/QSgA5KLU_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="2_23"></a>2.波特率的计算与设置</h2> 
<p>CC2530的波特率有BAUD_E和BAUD_M共同决定：<br> <img src="https://images2.imgbox.com/29/95/TLFyYwiG_o.png" alt="在这里插入图片描述"><br> F为系统时钟频率，16MHz或32MHz</p> 
<blockquote> 
 <p>TI公司提供的数据手册中，给出了32MHz系统时钟频率下各种常用波特率的参数值<br> <img src="https://images2.imgbox.com/19/e8/iXIRMp5D_o.png" alt="在这里插入图片描述"><br> 由计算公式可已计算出16MHz系统时钟频率下对应的参数值</p> 
 <ol><li>16MHz下9600波特率的UxBAUD.BAUD_M：U0BAUD = 59</li><li>16MHz下9600波特率的UxGCR.BAUD_E：U0GCR = 9</li></ol> 
</blockquote> 
<h2><a id="30UART_36"></a>3.串口0的UART初始化设置</h2> 
<pre><code class="prism language-c"><span class="token keyword">void</span> <span class="token function">Init_Uart0</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>

    <span class="token comment">//端口配置</span>
    PERCFG <span class="token operator">&amp;</span><span class="token operator">=</span> <span class="token operator">~</span><span class="token number">0x01</span><span class="token punctuation">;</span>    <span class="token comment">//将串口0的引脚映射到位置1，即P0_2和P0_3</span>
    P0SEL <span class="token operator">=</span> <span class="token number">0x0C</span><span class="token punctuation">;</span>       <span class="token comment">//将P0_2和P0_3端口设置为外设功能</span>
    
    <span class="token comment">/*======使用CC2530的内部16MHz晶振产生9600的波特率====*/</span>
    
    <span class="token comment">//波特率配置</span>
    U0BAUD <span class="token operator">=</span> <span class="token number">59</span><span class="token punctuation">;</span>
    U0GCR <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span>
    
    <span class="token comment">//流控配置</span>
    U0UCR <span class="token operator">|</span><span class="token operator">=</span> <span class="token number">0x80</span><span class="token punctuation">;</span>      <span class="token comment">//禁止流控，8位数据，清楚缓冲器</span>
    
    <span class="token comment">//串口模式配置</span>
    U0CSR <span class="token operator">|</span><span class="token operator">=</span> <span class="token number">0xC0</span><span class="token punctuation">;</span>      <span class="token comment">//选择UART模式，使能接收器</span>

    <span class="token comment">//中断配置</span>
    UTX0IF <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>         <span class="token comment">//清除TX发送中断标志</span>
    URX0IF <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>         <span class="token comment">//清除RX接收中断标志</span>
    URX0IE <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>         <span class="token comment">//使能URAT0的接收中断</span>
    EA <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>             <span class="token comment">//使能总中断</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="4_64"></a>4.案例</h2> 
<h3><a id="41_65"></a>4.1.串口数据发送</h3> 
<p><strong>要求：</strong></p> 
<blockquote> 
 <ol><li>USART0选择UART模式，波特率9600，I/O引脚映射到备用位置1</li><li>利用看门狗定时器的定时功能实现1秒定时</li><li>在看门狗中断服务模式中，由串口向上机位发送“Hello World!”，回车换行<br> D5等作为数据发送指示灯，在字符串发送前点亮，字符串发送结束后熄灭<br> <img src="https://images2.imgbox.com/c0/f0/6cGSVJ60_o.png" alt="在这里插入图片描述"></li></ol> 
</blockquote> 
<p><strong>代码：</strong></p> 
<pre><code class="prism language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"ioCC2530.h"</span></span>

<span class="token macro property">#<span class="token directive keyword">define</span> D5 P1_3</span>

<span class="token comment">/*=============系统时钟切换16MHz→32MHz（32MHz更为准确）====================*/</span>
<span class="token keyword">void</span> <span class="token function">Set_Clock_32M</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
  CLKCONCMD <span class="token operator">&amp;</span><span class="token operator">=</span> <span class="token operator">~</span><span class="token number">0x40</span><span class="token punctuation">;</span>        <span class="token comment">//选择系统时钟源为32MHz晶振</span>
  <span class="token keyword">while</span><span class="token punctuation">(</span>CLKCONCMD <span class="token operator">&amp;</span> <span class="token number">0x40</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//等待晶振稳定</span>
  CLKCONCMD <span class="token operator">&amp;</span><span class="token operator">=</span> <span class="token operator">~</span><span class="token number">0x47</span><span class="token punctuation">;</span>        <span class="token comment">//设置系统主时钟频率为32MHz</span>
<span class="token punctuation">}</span>

<span class="token comment">/*========================端口初始化函数====================================*/</span>
<span class="token keyword">void</span> <span class="token function">Init_Port</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
  <span class="token comment">//初始化LED灯的I/O口</span>
  P1SEL <span class="token operator">&amp;</span><span class="token operator">=</span> <span class="token operator">~</span><span class="token number">0x1B</span><span class="token punctuation">;</span>            <span class="token comment">//P1_0、P1_1、P1_3和P1_4作为通用I/O口</span>
  P1DIR <span class="token operator">|</span><span class="token operator">=</span> <span class="token number">0x1B</span><span class="token punctuation">;</span>             <span class="token comment">//P1_0、P1_1、P1_3和P1_4端口输出</span>
  P1 <span class="token operator">&amp;</span><span class="token operator">=</span> <span class="token operator">~</span><span class="token number">0x1B</span><span class="token punctuation">;</span>               <span class="token comment">//关灯D3~D6</span>
<span class="token punctuation">}</span>

<span class="token comment">/*==============================串口初始化函数==============================*/</span>
<span class="token keyword">void</span> <span class="token function">Init_Uart0</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
  <span class="token comment">//设置串口引脚功能，将P0_2、P0_3设置成外设功能</span>
  PERCFG <span class="token operator">&amp;</span><span class="token operator">=</span> <span class="token operator">~</span><span class="token number">0x01</span><span class="token punctuation">;</span>
  P0SEL <span class="token operator">|</span><span class="token operator">=</span> <span class="token number">0x0C</span><span class="token punctuation">;</span>             
  <span class="token comment">//设置串口波特率：32MHz——9600  中文手册P144</span>
  U0BAUD <span class="token operator">=</span> <span class="token number">59</span><span class="token punctuation">;</span>
  U0GCR <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>
  <span class="token comment">//设置UART控制U0UCR</span>
  U0UCR <span class="token operator">|</span><span class="token operator">=</span> <span class="token number">0x80</span><span class="token punctuation">;</span>
  <span class="token comment">//设置控制与状态寄存器</span>
  U0CSR <span class="token operator">|</span><span class="token operator">=</span> <span class="token number">0xC0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/*===============看门狗初始化函数，设置为定时器模式=========================*/</span>
<span class="token keyword">void</span> <span class="token function">Init_WDT</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
  WDCTL <span class="token operator">=</span> <span class="token number">0x0C</span><span class="token punctuation">;</span>
  INE2 <span class="token operator">|</span><span class="token operator">=</span> <span class="token number">0x20</span><span class="token punctuation">;</span>
  EA <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/*==================看门狗定时1秒中断服务函数===============================*/</span>
<span class="token macro property">#<span class="token directive keyword">pragma</span> vector = WDT_VECTOR</span>
__interrupt <span class="token keyword">void</span> <span class="token function">Service_WDT</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
  WDTIF <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  DS <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token function">UR0_SendString</span><span class="token punctuation">(</span><span class="token string">"Hello World!\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  D5 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/*=====================串口字节发送函数=====================================*/</span>
<span class="token keyword">void</span> <span class="token function">UR0_SendByte</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> dat<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
  U0DBUF <span class="token operator">=</span> dat<span class="token punctuation">;</span>
  <span class="token keyword">while</span><span class="token punctuation">(</span>UTX0IF <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  UTX0IF <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/*=============================串口字符发送函数=============================*/</span>
<span class="token keyword">void</span> <span class="token function">UR0_SendString</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>str<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
  <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">*</span>str <span class="token operator">!=</span> <span class="token string">'\0'</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">UR0_SendByte</span><span class="token punctuation">(</span><span class="token operator">*</span>str<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/*=====================================main函数=============================*/</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
  <span class="token function">Set_Clock_32M</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">Init_Port</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">Init_Uart0</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">Init_WDT</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="42_150"></a>4.2.串口数据收发</h3> 
<p><strong>要求：</strong></p> 
<blockquote> 
 <ol><li>USART0选择UART模式，波特率9600，I/O引脚映射到备用位置1</li><li>串口接受到上位机的一个数据后，在原值上加1，发回上位机</li><li>D3灯作为数据接受指示灯，在收到一个数据后，D3灯亮</li><li>D5灯作为数据发送指示灯，在数据发送之前亮，在数据发送完成后，D3灯与D5灯同时熄灭<br> <img src="https://images2.imgbox.com/08/e1/dxhIiJBo_o.png" alt="在这里插入图片描述"></li></ol> 
</blockquote> 
<p><strong>代码：</strong></p> 
<pre><code class="prism language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"ioCC2530.h"</span></span>

<span class="token macro property">#<span class="token directive keyword">define</span> D3 P1_0</span>
<span class="token macro property">#<span class="token directive keyword">define</span> D5 P1_3</span>

<span class="token comment">/*=============系统时钟切换16MHz→32MHz（32MHz更为准确）====================*/</span>
<span class="token keyword">void</span> <span class="token function">Set_Clock_32M</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
  CLKCONCMD <span class="token operator">&amp;</span><span class="token operator">=</span> <span class="token operator">~</span><span class="token number">0x40</span><span class="token punctuation">;</span>        <span class="token comment">//中文手册P60</span>
  <span class="token keyword">while</span><span class="token punctuation">(</span>CLKCONCMD <span class="token operator">&amp;</span> <span class="token number">0x40</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//中文手册P61</span>
  CLKCONCMD <span class="token operator">&amp;</span><span class="token operator">=</span> <span class="token operator">~</span><span class="token number">0x47</span><span class="token punctuation">;</span>        <span class="token comment">//中文手册P60</span>
<span class="token punctuation">}</span>

<span class="token comment">/*========================端口初始化函数====================================*/</span>
<span class="token keyword">void</span> <span class="token function">Init_Port</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
  P1SEL <span class="token operator">&amp;</span><span class="token operator">=</span> <span class="token operator">~</span><span class="token number">0x1B</span><span class="token punctuation">;</span>            <span class="token comment">//中文手册77</span>
  P1DIR <span class="token operator">|</span><span class="token operator">=</span> <span class="token number">0x1B</span><span class="token punctuation">;</span>
  P1 <span class="token operator">&amp;</span><span class="token operator">=</span> <span class="token operator">~</span><span class="token number">0x1B</span><span class="token punctuation">;</span>               <span class="token comment">//关灯D3~D6</span>
<span class="token punctuation">}</span>

<span class="token comment">/*==============================串口初始化函数==============================*/</span>
<span class="token keyword">void</span> <span class="token function">Init_Uart0</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
  <span class="token comment">//设置串口引脚功能，将P0_2、P0_3设置成外设功能，中文手册P72、P77</span>
  PERCFG <span class="token operator">&amp;</span><span class="token operator">=</span> <span class="token operator">~</span><span class="token number">0x01</span><span class="token punctuation">;</span>
  P0SEL <span class="token operator">|</span><span class="token operator">=</span> <span class="token number">0x0C</span><span class="token punctuation">;</span>             
  <span class="token comment">//设置串口波特率：32MHz——9600  中文手册P144</span>
  U0BAUD <span class="token operator">=</span> <span class="token number">59</span><span class="token punctuation">;</span>
  U0GCR <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>
  <span class="token comment">//设置UART控制U0UCR，中文手册P146</span>
  U0UCR <span class="token operator">|</span><span class="token operator">=</span> <span class="token number">0x80</span><span class="token punctuation">;</span>
  <span class="token comment">//设置控制与状态寄存器U0CSR，中文手册P145</span>
  U0CSR <span class="token operator">|</span><span class="token operator">=</span> <span class="token number">0xC0</span><span class="token punctuation">;</span>              <span class="token comment">//UART模式</span>
  <span class="token comment">//清除中断标志</span>
  UTX0IF <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  URX0IF <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/*================================串口字节发送函数==========================*/</span>
<span class="token keyword">void</span> <span class="token function">UR0_SendByte</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> dat<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
  U0DBUF <span class="token operator">=</span> dat<span class="token punctuation">;</span>
  <span class="token keyword">while</span><span class="token punctuation">(</span>UTX0IF <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  UTX0IF <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/*=========================串口数据接受完成的中断服务函数===================*/</span>
<span class="token macro property">#<span class="token directive keyword">pragma</span> vector = URX0_VECTOR</span>
__interrupt <span class="token keyword">void</span> <span class="token function">Service_UR0Recv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
  D3 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">unsigned</span> <span class="token keyword">char</span> tmp<span class="token punctuation">;</span>
  tmp <span class="token operator">=</span> U0DBUF<span class="token punctuation">;</span>
  tmp<span class="token operator">++</span><span class="token punctuation">;</span>
  D5 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token function">UR0_SendByte</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span>
  D3 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  D5 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/*=====================================main函数=============================*/</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
  <span class="token function">Set_Clock_32M</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">Init_Port</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">Init_Uart0</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="43LED_227"></a>4.3.串口命令控制LED灯开关</h3> 
<p><strong>要求：</strong></p> 
<blockquote> 
 <ol><li>USART0选择UART模式，波特率9600，I/O引脚映射到备用位置1</li><li>命令字"0xA1"，点亮D4，操作完成后，返回"D4 is open!"</li><li>命令字"0xA2"，关闭D4，操作完成后，返回"D4 is closed!"</li><li>命令字"0xA1"，点亮D6，操作完成后，返回"D6 is open!"</li><li>命令字"0xA1"，关闭D6，操作完成后，返回"D6 is closed!"<br> <img src="https://images2.imgbox.com/82/c3/6Hw47tZe_o.png" alt="在这里插入图片描述"></li></ol> 
</blockquote> 
<p><strong>代码：</strong></p> 
<pre><code class="prism language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"ioCC2530.h"</span></span>

<span class="token macro property">#<span class="token directive keyword">define</span> D3 P1_0</span>
<span class="token macro property">#<span class="token directive keyword">define</span> D4 P1_1</span>
<span class="token macro property">#<span class="token directive keyword">define</span> D5 P1_3</span>
<span class="token macro property">#<span class="token directive keyword">define</span> D6 P1_4</span>

<span class="token keyword">unsigned</span> <span class="token keyword">char</span> cmd <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token comment">//存放上机位PC发送过来的数据</span>

<span class="token comment">/*=============系统时钟切换16MHz→32MHz（32MHz更为准确）====================*/</span>
<span class="token keyword">void</span> <span class="token function">Set_Clock_32M</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
  CLKCONCMD <span class="token operator">&amp;</span><span class="token operator">=</span> <span class="token operator">~</span><span class="token number">0x40</span><span class="token punctuation">;</span>        <span class="token comment">//选择系统时钟源为32MHz晶振</span>
  <span class="token keyword">while</span><span class="token punctuation">(</span>CLKCONCMD <span class="token operator">&amp;</span> <span class="token number">0x40</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//等待晶振稳定</span>
  CLKCONCMD <span class="token operator">&amp;</span><span class="token operator">=</span> <span class="token operator">~</span><span class="token number">0x47</span><span class="token punctuation">;</span>        <span class="token comment">//设置系统主时钟频率为32MHz</span>
<span class="token punctuation">}</span>

<span class="token comment">/*========================端口初始化函数====================================*/</span>
<span class="token keyword">void</span> <span class="token function">Init_Port</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
  <span class="token comment">//初始化LED灯的I/O口</span>
  P1SEL <span class="token operator">&amp;</span><span class="token operator">=</span> <span class="token operator">~</span><span class="token number">0x1B</span><span class="token punctuation">;</span>            <span class="token comment">//P1_0、P1_1、P1_3和P1_4作为通用I/O口</span>
  P1DIR <span class="token operator">|</span><span class="token operator">=</span> <span class="token number">0x1B</span><span class="token punctuation">;</span>             <span class="token comment">//P1_0、P1_1、P1_3和P1_4端口输出</span>
  P1 <span class="token operator">&amp;</span><span class="token operator">=</span> <span class="token operator">~</span><span class="token number">0x1B</span><span class="token punctuation">;</span>               <span class="token comment">//关闭所有LED灯</span>
<span class="token punctuation">}</span>

<span class="token comment">/*==============================串口初始化函数==============================*/</span>
<span class="token keyword">void</span> <span class="token function">Init_Uart0</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
  <span class="token comment">//端口相关的配置——设置TXD和RXD引脚的外设功能</span>
  PERCFG <span class="token operator">&amp;</span><span class="token operator">=</span> <span class="token operator">~</span><span class="token number">0x01</span><span class="token punctuation">;</span>           <span class="token comment">//串口0的引脚映射到位置1，即P0_2和P0_3</span>
  P0SEL <span class="token operator">|</span><span class="token operator">=</span> <span class="token number">0x0C</span><span class="token punctuation">;</span>             <span class="token comment">//将P0_2和P0_3端口设置成外设功能</span>
  <span class="token comment">//波特率相关配置</span>
  U0BAUD <span class="token operator">=</span> <span class="token number">59</span><span class="token punctuation">;</span>               <span class="token comment">//32MHz的系统时钟产生9600BPS的波特率</span>
  U0GCR <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>                 <span class="token comment">//16MHz——9,32MHz——8</span>
  <span class="token comment">//串口属性相关配置——UART控制寄存器</span>
  U0UCR <span class="token operator">|</span><span class="token operator">=</span> <span class="token number">0x80</span><span class="token punctuation">;</span>             <span class="token comment">//禁止流控，8位数据，清除缓冲器</span>
  <span class="token comment">//串口属性相关配置——设置串口的工作模式：UART、使能接受</span>
  U0CSR <span class="token operator">|</span><span class="token operator">=</span> <span class="token number">0xC0</span><span class="token punctuation">;</span>             <span class="token comment">//UART模式，使能接收器</span>
  <span class="token comment">//串口中断相关配置——清除中断标志</span>
  UTX0IF <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>                <span class="token comment">//清除TX发送中断标志</span>
  URX0IF <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>                <span class="token comment">//清除RX接收中断标志</span>
  <span class="token comment">//串口中断香瓜配置——使能串口中断接受</span>
  URX0IF <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>                <span class="token comment">//使能UART0的接收中断</span>
  EA <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>                    <span class="token comment">//使能总中断</span>
<span class="token punctuation">}</span>

<span class="token comment">/*================================串口字节发送函数==========================*/</span>
<span class="token keyword">void</span> <span class="token function">UR0_Send_Byte</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> dat<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
  U0DBUF <span class="token operator">=</span> dat<span class="token punctuation">;</span>              <span class="token comment">//将要发送的1字节数据写入U0DBUF</span>
  <span class="token keyword">while</span><span class="token punctuation">(</span>UTX0IF <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//等待TX中断标志，即数据发送完成</span>
  UTX0IF <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>                <span class="token comment">//清除TX中断标志，准备下一次发送</span>
<span class="token punctuation">}</span>

<span class="token comment">/*=============================串口字符发送函数=============================*/</span>
<span class="token keyword">void</span> <span class="token function">UR0_Send_String</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>str<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
  <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">*</span>str <span class="token operator">!=</span> <span class="token string">'\0'</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>       <span class="token comment">//发送一个字符串</span>
    <span class="token function">UR0_SendByte</span><span class="token punctuation">(</span><span class="token operator">*</span>str<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//逐个发送字符串字节</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token comment">/*=========================串口数据接受完成的中断服务函数===================*/</span>
<span class="token macro property">#<span class="token directive keyword">pragma</span> vector = URX0_VECTOR</span>
__interrupt <span class="token keyword">void</span> <span class="token function">Service_UR0Recv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
  cmd <span class="token operator">=</span> U0DBUF<span class="token punctuation">;</span>              <span class="token comment">//将控制命令字节从缓冲区取出</span>
  F_UR0_Recv <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>            <span class="token comment">//标志成功接收上位机的单字节命令</span>
<span class="token punctuation">}</span>

<span class="token comment">/*=============================命令控制LED灯开关============================*/</span>
<span class="token keyword">void</span> <span class="token function">Control_LED</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
  <span class="token keyword">switch</span><span class="token punctuation">(</span>cmd<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">case</span> <span class="token number">0xA1</span>
      D4 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token function">UR0_Send_String</span><span class="token punctuation">(</span><span class="token string">"D4 is open!\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">0xA2</span>
      D4 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token function">UR0_Send_String</span><span class="token punctuation">(</span><span class="token string">"D4 is closed!\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">0xB1</span>
      D6 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token function">UR0_Send_String</span><span class="token punctuation">(</span><span class="token string">"D6 is open!\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">break</span><span class="token punctuation">;</span>
<span class="token keyword">case</span> <span class="token number">0xB2</span>
      D6 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token function">UR0_Send_String</span><span class="token punctuation">(</span><span class="token string">"D6 is closed!\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">break</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/*=====================================main函数=============================*/</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
  <span class="token function">Init_Clock_32M</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">Init_Port</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">Init_Uart0</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>cmd <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
      <span class="token function">control_LED</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<hr>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5dcaa086be3c3d2c1f61112d89a42c37/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">thymeleaf依赖问题 通过thymeleaf和model传值无法在html中获取或显示 thymeleaf自动加html的后缀和路径前缀</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e5dbb6d439db331f6314111f62f7dceb/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">手机微信html整人代码大全,2018年微信整人代码有哪些?2018年微信整人代码大全!...</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>