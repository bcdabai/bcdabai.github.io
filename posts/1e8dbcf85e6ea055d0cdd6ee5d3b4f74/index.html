<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>[HDF5] 封装了一个简单的C&#43;&#43; HDF5工具库，实现常用数据类型的读写 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="[HDF5] 封装了一个简单的C&#43;&#43; HDF5工具库，实现常用数据类型的读写" />
<meta property="og:description" content="目录
一.开发环境
二.主要功能
三.文件结构
四.HDF5写数据到hdf5文件功能实现
五.HDF5读hdf5文件数据到程序中数据结构功能实现
六.头文件Hdf5Function.h
七.工具类
八.主函数测试读写功能
本文基于HDF5官方库，封装了一个简单的常用数据类型的库，HDF5支持的数据类型很多，其中的功能也很强大，但是日常开发中可能常用的包括int、double、string等数据，所以为了简化官方库的使用，自己弄了个小玩意，水平不足，还请见谅。
一.开发环境 Visual Studio2013&#43;配置HDF5环境，也可以直接源码和HDF5库CMake编译。
如何配置HDF5开发环境请参考我的另一篇文章
如何配置HDF5环境
二.主要功能 1.HDF5写int,double,string类型的数据到hdf5文件中;
2.读hdf5文件中int,double,string的数据到程序的数据结构中;
3.写数据生成的hdf5文件名使用当前的时间戳来命名。
三.文件结构 Hdf5Function.hTools.hHdf5WriteValue.cppHdf5ReadValue.cppTools.cpp测试用的主函数main.cpp 四.HDF5写数据到hdf5文件功能实现 创建了类来实现相关功能，完整代码见：
HDF5-ZhaoDaBaoZzz-github.com
#include &#34;Tool.h&#34; #include &#34;Hdf5Function.h&#34; using namespace std; Hdf5WriteValue::Hdf5WriteValue(){}; //构造函数 Hdf5WriteValue::~Hdf5WriteValue(){};//析构函数 /*创建HDF5*/ void Hdf5WriteValue::CreateNewFile() { this-&gt;file=H5Fcreate(hdf5_filename().c_str,H5F_ACC_TRUNC,H5P_DEFAULT,H5P_DEFAULT); //H5F_ACC_TRUNC能覆盖，H5F_ACC_EXCL不能覆盖 } /*创建HDF5 String数据维度*/ void Hdf5WriteValue::CreateStringDataspace(const void *data,int rank,int col,int row) { hsize_t dim[2]; dim[0]=row; dim[1]=col; size_t size=sizeof(data)/sizeof(char); this-&gt;status=H5Test_size(dtype,size) this-&gt;dataspace=H5Screate_simple(rank,dim,NULL); } /*创建HDF5数据维度*/ void Hdf5WriteValue::CreateDataspace(int rank,int col,int row) { hsize_t dim[2]; dim[0]=row; dim[1]=col; this-&gt;dataspace=H5Screate_simple(rank,dim,NULL); } /*创建group*/ void Hdf5WriteValue::CreateGroup(string groupName) { this-&gt;group=H5Gcreate(this-&gt;file,groupName." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/1e8dbcf85e6ea055d0cdd6ee5d3b4f74/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-04-05T18:20:17+08:00" />
<meta property="article:modified_time" content="2023-04-05T18:20:17+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">[HDF5] 封装了一个简单的C&#43;&#43; HDF5工具库，实现常用数据类型的读写</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="%E4%B8%80.%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83-toc" style="margin-left:40px;"><a href="#%E4%B8%80.%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83" rel="nofollow">一.开发环境</a></p> 
<p id="%E4%BA%8C.%E4%B8%BB%E8%A6%81%E5%8A%9F%E8%83%BD-toc" style="margin-left:40px;"><a href="#%E4%BA%8C.%E4%B8%BB%E8%A6%81%E5%8A%9F%E8%83%BD" rel="nofollow">二.主要功能</a></p> 
<p id="%E4%B8%89.%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84-toc" style="margin-left:40px;"><a href="#%E4%B8%89.%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84" rel="nofollow">三.文件结构</a></p> 
<p id="%E5%9B%9B.HDF5%E5%86%99%E6%95%B0%E6%8D%AE%E5%88%B0hdf5%E6%96%87%E4%BB%B6%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0-toc" style="margin-left:40px;"><a href="#%E5%9B%9B.HDF5%E5%86%99%E6%95%B0%E6%8D%AE%E5%88%B0hdf5%E6%96%87%E4%BB%B6%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0" rel="nofollow">四.HDF5写数据到hdf5文件功能实现</a></p> 
<p id="%E4%BA%94.HDF5%E8%AF%BBhdf5%E6%96%87%E4%BB%B6%E6%95%B0%E6%8D%AE%E5%88%B0%E7%A8%8B%E5%BA%8F%E4%B8%AD%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0-toc" style="margin-left:40px;"><a href="#%E4%BA%94.HDF5%E8%AF%BBhdf5%E6%96%87%E4%BB%B6%E6%95%B0%E6%8D%AE%E5%88%B0%E7%A8%8B%E5%BA%8F%E4%B8%AD%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0" rel="nofollow">五.HDF5读hdf5文件数据到程序中数据结构功能实现</a></p> 
<p id="%E5%85%AD.%E5%A4%B4%E6%96%87%E4%BB%B6Hdf5Function.h-toc" style="margin-left:40px;"><a href="#%E5%85%AD.%E5%A4%B4%E6%96%87%E4%BB%B6Hdf5Function.h" rel="nofollow">六.头文件Hdf5Function.h</a></p> 
<p id="%E4%B8%83.%E5%B7%A5%E5%85%B7%E7%B1%BB-toc" style="margin-left:40px;"><a href="#%E4%B8%83.%E5%B7%A5%E5%85%B7%E7%B1%BB" rel="nofollow">七.工具类</a></p> 
<p id="%E5%85%AB.%E4%B8%BB%E5%87%BD%E6%95%B0%E6%B5%8B%E8%AF%95%E8%AF%BB%E5%86%99%E5%8A%9F%E8%83%BD-toc" style="margin-left:40px;"><a href="#%E5%85%AB.%E4%B8%BB%E5%87%BD%E6%95%B0%E6%B5%8B%E8%AF%95%E8%AF%BB%E5%86%99%E5%8A%9F%E8%83%BD" rel="nofollow">八.主函数测试读写功能</a></p> 
<hr id="hr-toc"> 
<p>本文基于HDF5官方库，封装了一个简单的常用数据类型的库，HDF5支持的数据类型很多，其中的功能也很强大，但是日常开发中可能常用的包括int、double、string等数据，所以为了简化官方库的使用，自己弄了个小玩意，水平不足，还请见谅。</p> 
<h3 id="%E4%B8%80.%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83">一.开发环境</h3> 
<p>Visual Studio2013+配置HDF5环境，也可以直接源码和HDF5库CMake编译。</p> 
<p>如何配置HDF5开发环境请参考我的另一篇文章</p> 
<p><a class="link-info" href="https://blog.csdn.net/qq_35902025/article/details/127049025?spm=1001.2014.3001.5501" title="如何配置HDF5环境">如何配置HDF5环境</a></p> 
<h3 id="%E4%BA%8C.%E4%B8%BB%E8%A6%81%E5%8A%9F%E8%83%BD">二.主要功能</h3> 
<p>1.HDF5写int,double,string类型的数据到hdf5文件中;</p> 
<p>2.读hdf5文件中int,double,string的数据到程序的数据结构中;</p> 
<p>3.写数据生成的hdf5文件名使用当前的时间戳来命名。</p> 
<h3 id="%E4%B8%89.%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84">三.文件结构</h3> 
<ul><li>Hdf5Function.h</li><li>Tools.h</li><li>Hdf5WriteValue.cpp</li><li>Hdf5ReadValue.cpp</li><li>Tools.cpp</li><li>测试用的主函数main.cpp</li></ul> 
<h3 id="%E5%9B%9B.HDF5%E5%86%99%E6%95%B0%E6%8D%AE%E5%88%B0hdf5%E6%96%87%E4%BB%B6%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0">四.HDF5写数据到hdf5文件功能实现</h3> 
<p>创建了类来实现相关功能，完整代码见：</p> 
<p><a href="https://github.com/ZhaoDaBaoZzz/CPlusPlusProjects/tree/master/HDF5" title="HDF5-ZhaoDaBaoZzz-github.com">HDF5-ZhaoDaBaoZzz-github.com</a></p> 
<pre><code class="language-cpp">#include "Tool.h"
#include "Hdf5Function.h"
using namespace std;

Hdf5WriteValue::Hdf5WriteValue(){}; //构造函数
Hdf5WriteValue::~Hdf5WriteValue(){};//析构函数

/*创建HDF5*/
void Hdf5WriteValue::CreateNewFile()
{
    this-&gt;file=H5Fcreate(hdf5_filename().c_str,H5F_ACC_TRUNC,H5P_DEFAULT,H5P_DEFAULT);
//H5F_ACC_TRUNC能覆盖，H5F_ACC_EXCL不能覆盖

}

/*创建HDF5 String数据维度*/
void Hdf5WriteValue::CreateStringDataspace(const void *data,int rank,int col,int row)
{
    hsize_t dim[2];
    dim[0]=row;
    dim[1]=col;
    size_t size=sizeof(data)/sizeof(char);
    this-&gt;status=H5Test_size(dtype,size)
    this-&gt;dataspace=H5Screate_simple(rank,dim,NULL);
}

/*创建HDF5数据维度*/
void Hdf5WriteValue::CreateDataspace(int rank,int col,int row)
{
    hsize_t dim[2];
    dim[0]=row;
    dim[1]=col;
    this-&gt;dataspace=H5Screate_simple(rank,dim,NULL);
}

/*创建group*/
void Hdf5WriteValue::CreateGroup(string groupName)
{
    this-&gt;group=H5Gcreate(this-&gt;file,groupName.c_str(),H5P_DEFAULT,H5P_DEFAULT,H5P_DEFAULT);
}

/*创建dataset,int,double,string*/
void Hdf5WriteValue::CreateIntDataset(string datasetName)
{
    this-&gt;dataset=H5Dcreate2(this-&gt;group,datasetNmae.c_str(),H5T_NATIVE_INT,this-&gt;dataspace,H5P_DEFAULT,H5P_DEFAULT,H5P_DEFAULT)
}

void Hdf5WriteValue::CreateDoubleDataset(string datasetName)
{
    this-&gt;dataset=H5Dcreate2(this-&gt;group,datasetNmae.c_str(),H5T_NATIVE_Double,this-&gt;dataspace,H5P_DEFAULT,H5P_DEFAULT,H5P_DEFAULT)
}

void Hdf5WriteValue::CreateStringDataset(string datasetName)
{
    this-&gt;dataset=H5Dcreate2(this-&gt;group,datasetNmae.c_str(),this-&gt;dtype,this-&gt;dataspace,H5P_DEFAULT,H5P_DEFAULT,H5P_DEFAULT)
}

/*写入数据到对应类型的dataset*/
void Hdf5WriteValue::WriteIntValue(const void *data)
{
    this-&gt;status=H5Dwrite(this-&gt;dataset,H5T_NATIVE_INT,H5S_ALL,H5S_ALL,H5P_DEFAULT,data);
}

void Hdf5WriteValue::WriteDoubleValue(const void *data)
{
    this-&gt;status=H5Dwrite(this-&gt;dataset,H5T_NATIVE_DOUNLE,H5S_ALL,H5S_ALL,H5P_DEFAULT,data);
}

void Hdf5WriteValue::WriteStringValue(const void *data)
{
    this-&gt;status=H5Dwrite(this-&gt;dataset,this-&gt;dtype,H5S_ALL,H5S_ALL,H5P_DEFAULT,data);
}
/*关闭数据及文件，注意关闭顺序*/
void Hdf5WriteValue::CloseFile()
{
    this-&gt;status=H5Dclose(this-&gt;dataset);
    this-&gt;status=H5Sclose(this-&gt;dataspace);
    this-&gt;status=H5Gclose(this-&gt;group);
    this-&gt;status=H5Fclose(this-&gt;file);
}</code></pre> 
<h3 id="%E4%BA%94.HDF5%E8%AF%BBhdf5%E6%96%87%E4%BB%B6%E6%95%B0%E6%8D%AE%E5%88%B0%E7%A8%8B%E5%BA%8F%E4%B8%AD%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0">五.HDF5读hdf5文件数据到程序中数据结构功能实现</h3> 
<pre><code class="language-cpp">#include "Tools.h"
#include "Hdf5Function.h"
using namespace std;

Hdf5ReadValue::Hdf5ReadValue(){}; //构造函数
Hdf5ReadValue::~Hdf5ReadValue(){};//析构函数

/*打开HDF5文件*/
void Hdf5ReadValue::OpenFile(const char* filepath)
{
	this-&gt;file = H5Fopen(filepath, H5F_ACC_RDONLY, H5P_DEFAULT);
}

/*打开HDF5文件对应的Group*/
void Hdf5ReadValue::OpenGroup(const char* group)
{
	this-&gt;group = H5Gopen2(this-&gt;file, group, H5P_DEFAULT);
}

/*打开HDF5文件对应的Dataset*/
void Hdf5ReadValue::OpenDataset(const char* dataset)
{
	this-&gt;dataset = H5Dopen(this-&gt;group, dataset, H5P_DEFAULT);
}

/*读文件中的各种类型数据int,double,string*/
void Hdf5ReadValue::ReadIntData(void *data)
{
	this-&gt;status = H5Dread(this-&gt;OpenDataset, H5T_NATIVE_INT, H5S_ALL, H5S_ALL, H5P_DEFAULT, data);
}

void Hdf5ReadValue::ReadDoubleData(void *data)
{
	this-&gt;status = H5Dread(this-&gt;OpenDataset, H5T_NATIVE_DOUBLE, H5S_ALL, H5S_ALL, H5P_DEFAULT, data);
}

void Hdf5ReadValue::ReadStringData(void *data)
{
	size_t size = sizeof(data) / sizeof(char);
	this-&gt;status = H5Test_size(dtype, size);
	this-&gt;status = H5Dread(this-&gt;OpenDataset, this-&gt;dtype, H5S_ALL, H5S_ALL, H5P_DEFAULT, data);
}

/*关闭数据及文件*/
void Hdf5ReadValue::CloseFile()
{
	this-&gt;status = H5Dclose(this-&gt;dataset);
	this-&gt;status = H5Gclose(this-&gt;group);
	this-&gt;status = H5Fclose(this-&gt;file);
}</code></pre> 
<h3 id="%E5%85%AD.%E5%A4%B4%E6%96%87%E4%BB%B6Hdf5Function.h">六.头文件Hdf5Function.h</h3> 
<pre><code class="language-cpp">#include &lt;iostream&gt;
#include &lt;string&gt;
#include &lt;ctime&gt;
#include "hdf5.h"

#ifndef HDF5FUNCTION_H_
#define HDF5FUNCTION_H_
using namespace std;

//HDF5写功能
class Hdf5WriteValue
{
public:
	hid_t file, dataset, dataspace, group;
	herr_t status;
	hid_t dtype = H5Tcopy(H5T_C_S1);
	
	Hdf5WriteValue(){}; //构造函数
	~Hdf5WriteValue(){};//析构函数
	void CreateNewFile();
	void CreateStringDataspace(const void *data, int rank, int col, int row);
	void CreateDataspace(int rank, int col, int row);
	void CreateGroup(string groupName);
	void CreateIntDataset(string datasetName);
	void CreateDoubleDataset(string datasetName);
	void CreateStringDataset(string datasetName);
	void WriteIntValue(const void *data);
	void WriteDoubleValue(const void *data);
	void WriteStringValue(const void *data);
	void CloseFile();
};

class Hdf5ReadValue
{
public:
	hid_t file, dataset, dataspace, group;
	herr_t status;
	hid_t dtype = H5Tcopy(H5T_C_S1);

	Hdf5ReadValue(){}; //构造函数
	~Hdf5ReadValue(){};//析构函数
	void OpenFile(const char* filepath);
	void OpenGroup(const char* group);
	void OpenDataset(const char* dataset);
	void ReadIntData(void *data);
	void ReadDoubleData(void *data);
	void ReadStringData(void *data);
	void CloseFile();
};
#endif</code></pre> 
<h3 id="%E4%B8%83.%E5%B7%A5%E5%85%B7%E7%B1%BB">七.工具类</h3> 
<p>Tools.cpp</p> 
<pre><code class="language-cpp">#include &lt;iostream&gt;
#include &lt;string&gt;
#include &lt;ctime&gt;

using namespace std;

string getLocalTime(string format)
{
	char char_time[64];
	time_t curr_time = time(NULL);
	tm* time_info = std::localtime(&amp;curr_time);
	if (NULL != time_info)
	{
		strftime(char_time, sizeof(char_time), format.c_str(), time_info);
	}
	else
	{
		strcpy(char_time, "NULL");
	}
	return char_time;
}
string hdf5Filename()
{
	string filename_id = "hdf5.out.";
	string time_stamp = getLocalTime("%Y.%m.%d.%H.%M.%S");
	string filename_m = filename_id + time_stamp + ".h5";
	return filename_m;
}</code></pre> 
<p>Tools.h</p> 
<pre><code class="language-cpp">#include &lt;iostream&gt;
#include &lt;string&gt;
#include &lt;ctime&gt;
#include "hdf5.h"

#ifndef TOOLS_H_
#define TOOLS_H_

using namespace std;

string getLocalTime(string);
string hdf5Filename();

#endif</code></pre> 
<h3 id="%E5%85%AB.%E4%B8%BB%E5%87%BD%E6%95%B0%E6%B5%8B%E8%AF%95%E8%AF%BB%E5%86%99%E5%8A%9F%E8%83%BD">八.主函数测试读写功能</h3> 
<pre><code class="language-cpp">#include &lt;windows.h&gt;
#include &lt;fstream&gt;
#include "Hdf5Function.h"

int main()
{
	/*测试代码*/
	//一维int
	const int a = 99;
	const int*value1 = &amp;a;
	//一维double
	const double b = 99.99;
	const double* value2 = &amp;b;
	//一维char
	const char* value3 = "abc";
	//二维intle数组
	int value4[5][6];
	int i, j;
	for (i = 0; i &lt; 5; i++)
	{
		for (j = 0; j &lt; 6; j++)
		{
			value4[i][j] = i + j;
		}
	}
	//二维double数组
	double value5[289][28];
	int i, j;
	for (i = 0; i &lt; 289; i++)
	{
		for (j = 0; j &lt; 28; j++)
		{
			value5[i][j] = 0.1 + i + j;
		}
	}

	//存放读数据的数据结构
	double* result = new double[289 * 28];
	char* result1 = new char[20];

	//同一个文件内写数据
	Hdf5WriteValue write;
	write.CreateNewFile();
	//写一个int数据
	write.CreateDataspace(1, 0, 1);
	write.CreateGroup("groupA");
	write.CreateIntDataset("datasetA");
	write.WriteIntValue(value1);
	//写一个double数据
	write.CreateDoubleDataset("datasetB");
	write.WriteDoubleValue(value2);
	//新建一个group写一个string数据
	write.CreateGroup("groupB");
	write.CreateStringDataspace(value3,1, 0, 1);
	write.CreateStringDataset("datasetC");
	write.WriteStringValue(value3);
	//写一个int二维数组
	write.CreateDataspace(2, 5, 6);
	write.CreateIntDataset("datasetD");
	write.WriteIntValue(value4);
	//写一个double二维数组
	write.CreateDataspace(2, 289, 28);
	write.CreateDoubleDataset("datasetE");
	write.WriteDoubleValue(value5);

	write.CloseFile();

	//读H5或HDF5文件
	Hdf5ReadValue read;
	//读double数据
	char filename[] = "hdf5.h5";
	read.OpenFile(filename);
	read.OpenGroup("groupB");
	read.OpenDataset("datasetE");
	read.ReadDoubleData(result);
	//打印测试
	cout.setf(ios::fixed, ios::floatfield);
	cout.precision(2);
	for (i = 0; i &lt; 8092; i++)
	{
		cout &lt;&lt; result[i] &lt;&lt; endl;
	}

	//读取字符串数据
	read.OpenGroup("groupB");
	read.OpenDataset("datasetC");
	read.ReadStringData(result1);
	cout &lt;&lt; result1 &lt;&lt; endl;

	read.CloseFile();
	delete result;
	delete result1;
	system("pause");
	return 0;

}</code></pre> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b9eef667c9b03e6d499c37076aa59f2a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Golang 的 datetime 格式化</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/960e1d39b17dcfd92239880e16a2ffaa/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Python水仙花数</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>