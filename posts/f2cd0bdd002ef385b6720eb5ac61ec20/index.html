<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>QEMU/Renode 开发嵌入式程序 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="QEMU/Renode 开发嵌入式程序" />
<meta property="og:description" content="参考链接;
在Ubuntu18.04下安装qemu，搭建u-boot&#43;Linux&#43;NFS学习环境 - 知乎 (zhihu.com)
QEM Install Sudo apt install qemu-system
xin@xin-dde:~$ qemu-system-arm -cpu help
Available CPUs:
arm1026
arm1136
arm1136-r2
arm1176
arm11mpcore
arm926
arm946
cortex-a15
cortex-a7
cortex-a8
cortex-a9
cortex-m0
cortex-m3
cortex-m33
cortex-m4
cortex-m55
cortex-m7
cortex-r5
cortex-r5f
max
pxa250
pxa255
pxa260
pxa261
pxa262
pxa270-a0
pxa270-a1
pxa270
pxa270-b0
pxa270-b1
pxa270-c0
pxa270-c5
sa1100
sa1110
ti925t
qemu-system-arm -M help
虚拟机启动脚本 qemu-system-arm -M vexpress-a9 -m 512M -nographic -dtb ./vexpress-v2p-ca9.dtb -kernel ./zImage -append “root=/dev/mmcblk0 rw console=ttyAMA0” -sd rootfs." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/f2cd0bdd002ef385b6720eb5ac61ec20/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-11T10:02:03+08:00" />
<meta property="article:modified_time" content="2023-12-11T10:02:03+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">QEMU/Renode 开发嵌入式程序</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="margin-left:0;">参考链接;</p> 
<p style="margin-left:0;"><a href="https://zhuanlan.zhihu.com/p/262274834" rel="nofollow" title="在Ubuntu18.04下安装qemu，搭建u-boot+Linux+NFS学习环境 - 知乎 (zhihu.com)">在Ubuntu18.04下安装qemu，搭建u-boot+Linux+NFS学习环境 - 知乎 (zhihu.com)</a></p> 
<p style="margin-left:0;"></p> 
<h2 style="margin-left:0;"><span style="color:#2f5496;">QEM Install </span></h2> 
<p style="margin-left:0;">Sudo apt install qemu-system</p> 
<p style="margin-left:0;"><img alt="" height="236" src="https://images2.imgbox.com/26/dc/gg45D9Et_o.png" width="668"></p> 
<p style="margin-left:0;"><strong><span style="background-color:#ffff00;">xin@xin-dde:~$ qemu-system-arm -cpu help</span></strong></p> 
<p style="margin-left:0;">Available CPUs:</p> 
<p style="margin-left:0;">  arm1026</p> 
<p style="margin-left:0;">  arm1136</p> 
<p style="margin-left:0;">  arm1136-r2</p> 
<p style="margin-left:0;">  arm1176</p> 
<p style="margin-left:0;">  arm11mpcore</p> 
<p style="margin-left:0;">  arm926</p> 
<p style="margin-left:0;">  arm946</p> 
<p style="margin-left:0;">  cortex-a15</p> 
<p style="margin-left:0;">  cortex-a7</p> 
<p style="margin-left:0;">  <span style="background-color:#ffff00;">cortex-a8</span></p> 
<p style="margin-left:0;"><span style="background-color:#ffff00;">  cortex-a9</span></p> 
<p style="margin-left:0;">  cortex-m0</p> 
<p style="margin-left:0;">  cortex-m3</p> 
<p style="margin-left:0;">  cortex-m33</p> 
<p style="margin-left:0;">  <span style="background-color:#ffff00;">cortex-m4</span></p> 
<p style="margin-left:0;">  cortex-m55</p> 
<p style="margin-left:0;">  cortex-m7</p> 
<p style="margin-left:0;">  cortex-r5</p> 
<p style="margin-left:0;">  cortex-r5f</p> 
<p style="margin-left:0;">  max</p> 
<p style="margin-left:0;">  pxa250</p> 
<p style="margin-left:0;">  pxa255</p> 
<p style="margin-left:0;">  pxa260</p> 
<p style="margin-left:0;">  pxa261</p> 
<p style="margin-left:0;">  pxa262</p> 
<p style="margin-left:0;">  pxa270-a0</p> 
<p style="margin-left:0;">  pxa270-a1</p> 
<p style="margin-left:0;">  pxa270</p> 
<p style="margin-left:0;">  pxa270-b0</p> 
<p style="margin-left:0;">  pxa270-b1</p> 
<p style="margin-left:0;">  pxa270-c0</p> 
<p style="margin-left:0;">  pxa270-c5</p> 
<p style="margin-left:0;">  sa1100</p> 
<p style="margin-left:0;">  sa1110</p> 
<p style="margin-left:0;">  ti925t</p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"><strong><span style="background-color:#ffff00;">qemu-system-arm -M help</span></strong></p> 
<p style="margin-left:0;"></p> 
<h2 style="margin-left:0;"><span style="color:#2f5496;">虚拟机启动脚本</span></h2> 
<table border="1" cellspacing="0"><tbody><tr><td style="border-color:#000000;vertical-align:top;width:522.8pt;"> <p style="margin-left:0;">qemu-system-arm -M vexpress-a9 -m 512M -nographic -dtb ./vexpress-v2p-ca9.dtb -kernel ./zImage -append “root=/dev/mmcblk0 rw console=ttyAMA0” -sd rootfs.ext3</p> </td></tr></tbody></table> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">模拟了vexpress-a9这个机器，内存512M，没有图形界面，Linux的kernel是./zImage, 设备树为vexpress-v2p-ca9.dtb文件，还有SD卡为rootfs.ext3文件. 还有一个附加的而启动指令，制定了console输出的端口。</p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">假设模拟一个<span style="background-color:#ffffff;"><span style="color:#4f4f4f;">STM32F4 </span></span><span style="background-color:#ffffff;"><span style="color:#4f4f4f;">的开发版，可以参考官方板子</span></span><span style="background-color:#ffffff;"><span style="color:#4f4f4f;">netduinoplus2 </span></span><span style="background-color:#ffffff;"><span style="color:#4f4f4f;">使用的是</span></span><span style="background-color:#ffffff;"><span style="color:#4f4f4f;">STM32F405RGT6</span></span><span style="background-color:#ffffff;"><span style="color:#4f4f4f;">。</span></span></p> 
<table border="1" cellspacing="0"><tbody><tr><td style="border-color:#000000;vertical-align:top;width:522.8pt;"> <p style="margin-left:0;">qemu-system-arm -M netduinoplus2 -nographic -kernel ./stm32_prj.elf <span style="background-color:#fafafa;"><span style="color:#000000;">-gdb tcp::3333 -serial tcp::7777,server</span></span></p> </td></tr></tbody></table> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">这样就可以直接运行起来一个STM32F05兼容的模拟器了，它的外围IO和端口参考<span style="background-color:#ffffff;"><span style="color:#4f4f4f;">netduinoplus2</span></span>。</p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"><span style="color:#0070c0;">-M</span><span style="color:#0070c0;">：指定模拟哪个目标板，这个一定得是</span><span style="color:#0070c0;">qemu</span><span style="color:#0070c0;">支持的，否则会提示错误。</span><span style="color:#0070c0;">RT-Thread</span><span style="color:#0070c0;">的生态里</span><span style="color:#0070c0;">qemu</span><span style="color:#0070c0;">是支持了这个</span><span style="color:#0070c0;">stm32f407-atk-explorer</span><span style="color:#0070c0;">板子的了</span></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"><span style="color:#0070c0;">-nographic</span><span style="color:#0070c0;">：告诉</span><span style="color:#0070c0;">qemu</span><span style="color:#0070c0;">无界面启动（因为默认有一个类似</span><span style="color:#0070c0;">VMware</span><span style="color:#0070c0;">那样的界面），这个非常重要，这样程序中串口打印信息（</span><span style="color:#0070c0;">printf</span><span style="color:#0070c0;">）才能输出到控制台来，否则不会有任何输出。</span></p> 
<p style="margin-left:0;"><span style="color:#0070c0;">（</span><span style="color:#0070c0;">qemu help</span><span style="color:#0070c0;">的解释：</span><span style="color:#0070c0;">-nographic      disable graphical output and redirect serial I/Os to console</span><span style="color:#0070c0;">），所以我们别去调用什么</span><span style="color:#0070c0;">-serial stdio</span><span style="color:#0070c0;">啥的命令，否则也不会输出。</span></p> 
<p style="margin-left:0;"><span style="color:#0070c0;">-kernel</span><span style="color:#0070c0;">：指定程序镜像文件，这个可以是</span><span style="color:#0070c0;">bin</span><span style="color:#0070c0;">文件，</span><span style="color:#0070c0;">elf</span><span style="color:#0070c0;">文件（含有调试信息）都可以</span></p> 
<p style="margin-left:0;"><span style="color:#0070c0;">-S</span><span style="color:#0070c0;">：代表不自动运行模拟（需要</span><span style="color:#0070c0;">gdb</span><span style="color:#0070c0;">连接之后进行操作）</span></p> 
<p style="margin-left:0;"><span style="color:#0070c0;">-s</span><span style="color:#0070c0;">：代表开放</span><span style="color:#0070c0;">tcp1234</span><span style="color:#0070c0;">作为远程调试端口</span></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">由于官方版本对board和CPU的支持有限，不能完全支持所有的芯片，所以有两个路子：</p> 
<ol><li>使用第三方版本qemu, 比如RT-Thread IDE自带的。（对STM32F4有官方支持）</li><li>xPack QEMU Arm 项目，<a href="https://xpack.github.io/dev-tools/qemu-arm/install/" rel="nofollow" title="How to install the xPack QEMU Arm binaries ">How to install the xPack QEMU Arm binaries </a></li><li>自己定制Board和CPU。（这个难度较高）</li></ol> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">然后就可以愉快地玩耍了！！</p> 
<p style="margin-left:0;">但是，如果板子上有的硬件和你自己的不符，怎么办？？？</p> 
<p style="margin-left:0;">所以，如果真的做产品级别的开发模拟，就需要走第三个路子，自己完成自己的板子的开发。</p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;">对于嵌入式Linux而言，因为大部分是软件内容，一般模拟起来相对比较容易，如果是STM32一类的MCU，如果原生不支持，就一定需要自己定制了。这个时候，可以考虑直接上硬件进行编码测试，因为软件定制成本也不低。</p> 
<p style="margin-left:0;">如果是需要模拟一整套x86/arm/risc-v系统，可以考虑使用Visual Box/VMware进行测试。</p> 
<p style="margin-left:0;"></p> 
<h2 style="margin-left:0;"><span style="color:#2f5496;">定制qmeu board</span></h2> 
<p style="margin-left:0;"><a href="https://yanglianoo.github.io/categories/%E5%9F%BA%E4%BA%8Eqemu%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%9E%84%E5%BB%BAriscv64%E7%9A%84%E5%B5%8C%E5%85%A5%E5%BC%8F%E7%B3%BB%E7%BB%9F/" rel="nofollow" title="分类: 基于qemu从零开始构建riscv64的嵌入式系统 | TimerのBlog (yanglianoo.github.io)">分类: 基于qemu从零开始构建riscv64的嵌入式系统 | TimerのBlog (yanglianoo.github.io)</a></p> 
<p style="margin-left:0;"><span style="background-color:#ffffff;"><span style="color:#4c4948;">向</span></span><span style="background-color:#ffffff;"><span style="color:#4c4948;">qemu</span></span><span style="background-color:#ffffff;"><span style="color:#4c4948;">中注册自定义的板子需要向</span></span><span style="background-color:#ffffff;"><span style="color:#4c4948;">qemu</span></span><span style="background-color:#ffffff;"><span style="color:#4c4948;">中添加源码，然后重新编</span></span><span style="background-color:#ffffff;"><span style="color:#4c4948;">译。</span></span></p> 
<ul><li>添加板子信息</li><li>初始化CPU和ROM信息</li><li>构建DTS设备树</li><li>中断、Uart、Flash太多了…</li></ul> 
<p style="margin-left:0;">建议还是在xPack QEMU的基础上进行修改。</p> 
<p style="margin-left:0;"><a href="https://www.jianshu.com/p/3904247621c2" rel="nofollow" title="qemu源码二次开发自定义开发板--Apple的学习笔记 - 简书 (jianshu.com)">qemu源码二次开发自定义开发板--Apple的学习笔记 - 简书 (jianshu.com)</a></p> 
<p style="margin-left:0;"><a href="https://blog.csdn.net/u011280717/article/details/112983720" title="如何利用qemu搭建SOC protoype：80行代码实现一个Cortex M4 模拟器_qemu模拟soc_MyeDy的博客-CSDN博客">如何利用qemu搭建SOC protoype：80行代码实现一个Cortex M4 模拟器_qemu模拟soc_MyeDy的博客-CSDN博客</a></p> 
<p style="margin-left:0;"></p> 
<h2 style="margin-left:0px;">Renode 替代</h2> 
<p style="margin-left:0;">QEMU虽好，但是对嵌入式支持不是很到位，有一个renode的类似平台，只支持嵌入式开发和board定制，非常不错。</p> 
<p style="margin-left:0;">特别是STM32F4等最新的板子支持，都有现成的spec文件。</p> 
<p style="margin-left:0;">支持的板子和芯片列表：<a href="https://renode.readthedocs.io/en/latest/introduction/supported-boards.html" rel="nofollow" title="Supported boards - Renode - documentation">Supported boards - Renode - documentation</a></p> 
<p style="margin-left:0;">使用教程参考：<a href="https://blog.csdn.net/deliapu/category_11364490.html" title="https://blog.csdn.net/deliapu/category_11364490.html">https://blog.csdn.net/deliapu/category_11364490.html</a></p> 
<p style="margin-left:0;"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9e1c447521963dc275104e8d6ecff4e3/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Windows下查看删除某一个端口号</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6f0352eee17391c724816ee3318d0d4b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【计算机网络】TCP socket编程</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>