<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>SpringBoot实用篇 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="SpringBoot实用篇" />
<meta property="og:description" content="SpringBoot实用篇 1、热部署 什么是热部署？
所谓热部署，就是在应用正在运行的时候升级软件，却不需要重新启动应用。对于Java应用程序来说，热部署就是在运行时更新Java类文件。
热部署有什么用？
节约时间，热部署只需要重新更新一下改动过的class文件，不需要全部再编译一遍提高开发效率，热部署对于静态资源能够实现实时更新，不需要再重启项目 1.1 手动开启热部署 之前在SSM中我们热部署，是通过勾选两个选项就实现了：
而在SpringBoot首先我们需要通过热部署依赖实现热部署：（Step1）
&lt;!--热部署依赖--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- 配置插件，让热部署依赖spring-boot-devtools生效 --&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;configuration&gt; &lt;!-- 设置为true，让热部署devtools生效 --&gt; &lt;fork&gt;true&lt;/fork&gt; &lt;addResources&gt;true&lt;/addResources&gt; &lt;/configuration&gt; &lt;/plugin&gt; 然后每次当我们修改了代码（Step2）后，我们需要点击构建项目：（Step3）
这样就不需要重启项目了
知识拓展：重启和重载
重启（Restart）：自定义开发代码，包含类、页面、配置文件等，加载位置restart类加载器重载（ReLoad）：jar包，加载位置base类加载器 重新运行项目也就是重启项目包括了Restart过程和ReLoad过程，而热部署只包含Restart过程
1.2 自动开启热部署 自动开启热部署，也是需要引入热部署依赖的
Step1：
Step2：
温馨提示：如果使用的是IDEA 2021.2之前版本的话还是使用快捷键Shift&#43;Ctrl&#43;Alt&#43;/，选择Registry...，将compiler.automake.allow.when.app.running选项勾上（这里我使用的是2022版的IDEA）
注意：汉化后的IDEA这个选项的位置发生了变化
Step3：
IDEA鼠标悬停5秒不动，IDEA就会自动开启热部署
1.3 热部署相关配置 通过修改项目中的文件，你可以发现其实并不是所有的文件修改都会激活热部署的，原因在于在开发者工具中有一组配置，当满足了配置中的条件后，才会启动热部署，配置中默认不参与热部署的目录信息如下：
/META-INF/maven/META-INF/resources/resources/static/public/templates 以上目录中的文件如果发生变化，是不参与热部署的。如果想修改配置，可以通过application.yml文件进行设定哪些文件不参与热部署操作，如果想添加不参与热部署的文件或文件夹，可以通过下面的配置：
spring: devtools: restart: # 设置不参与热部署的文件或文件夹 exclude: static/**,public/**,config/application.yml # 关闭或开启热部署（false表示关闭） enable: false /**表示文件夹
知识拓展：
在resource下的配置文件中选择关闭热部署，可以会在其它地方打开，比如在resource/config/下的配置文件中开启了热部署，又或者在file下的配置文件，又或者是file下config下的配置文件中开启了热部署，这是由于其它三个配置文件的优先级要高于resource下的配置文件，我们可以通过设置临时属性来提高优先级，也可以通过设置Java系统属性值，具体相关知识可以参考：SpringBoot运维篇学习笔记
2、高级配置 相关配置学习，在基础篇的学习了配置，在运维篇也学习了配置，现在实用篇还是接着学习配置。越往后相关配置就越接近开发，相关配置也是在开发中最常用的那些
2.1 属性绑定 所谓的属性绑定就是指“属性文件中的属性和配置类中字段之间形成一个映射关系”
2.1.1 @ConfigurationProperties 使用@ConfigurationProperties实现属性绑定" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/4fa61627a8c150990cf3e58816c31cec/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-31T09:00:54+08:00" />
<meta property="article:modified_time" content="2023-12-31T09:00:54+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">SpringBoot实用篇</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="SpringBoot_0"></a>SpringBoot实用篇</h2> 
<h3><a id="1_2"></a>1、热部署</h3> 
<ul><li> <p><strong>什么是热部署</strong>？</p> 
  <blockquote> 
   <p>所谓热部署，就是在应用正在运行的时候升级软件，却不需要重新启动应用。对于Java应用程序来说，热部署就是在运行时更新Java类文件。</p> 
  </blockquote> </li><li> <p><strong>热部署有什么用</strong>？</p> 
  <blockquote> 
   <ol><li>节约时间，热部署只需要重新更新一下改动过的class文件，不需要全部再编译一遍</li><li>提高开发效率，热部署对于静态资源能够实现实时更新，不需要再重启项目</li></ol> 
  </blockquote> </li></ul> 
<h4><a id="11__13"></a>1.1 手动开启热部署</h4> 
<p>之前在SSM中我们热部署，是通过勾选两个选项就实现了：</p> 
<img src="https://images2.imgbox.com/e4/b0/0PmZNgyW_o.png" alt="image-20221229103826696"> 
<p>而在SpringBoot首先我们需要通过热部署依赖实现热部署：（<strong>Step1</strong>）</p> 
<pre><code class="prism language-xml">        <span class="token comment">&lt;!--热部署依赖--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-devtools<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
			<span class="token comment">&lt;!--  配置插件，让热部署依赖spring-boot-devtools生效 --&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                    <span class="token comment">&lt;!-- 设置为true，让热部署devtools生效 --&gt;</span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fork</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fork</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>addResources</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>addResources</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>然后每次当我们修改了代码（<strong>Step2</strong>）后，我们需要点击构建项目：（<strong>Step3</strong>）</p> 
<img src="https://images2.imgbox.com/ff/d2/YL5XlLuY_o.png" alt="image-20221229104055492"> 
<p>这样就不需要重启项目了</p> 
<blockquote> 
 <p><font size="4">知识拓展</font>：重启和重载</p> 
 <ul><li><strong>重启</strong>（Restart）：自定义开发代码，包含类、页面、配置文件等，加载位置restart类加载器</li><li><strong>重载</strong>（ReLoad）：jar包，加载位置base类加载器</li></ul> 
 <p>重新运行项目也就是重启项目包括了Restart过程和ReLoad过程，而热部署只包含Restart过程</p> 
</blockquote> 
<h4><a id="12__52"></a>1.2 自动开启热部署</h4> 
<blockquote> 
 <p><mark>自动开启热部署，也是需要引入热部署依赖的</mark></p> 
</blockquote> 
<ul><li> <p><strong>Step1</strong>：</p> <img src="https://images2.imgbox.com/3b/7b/HeoTJfrf_o.png" alt="image-20221229105512516"> </li><li> <p><strong>Step2</strong>：</p> 
  <blockquote> 
   <p><font color="pink">温馨提示</font>：如果使用的是<strong>IDEA 2021.2</strong>之前版本的话还是使用快捷键<code>Shift+Ctrl+Alt+/</code>，选择<code>Registry...</code>，将<code>compiler.automake.allow.when.app.running</code>选项勾上（这里我使用的是2022版的IDEA）</p> 
  </blockquote> <img src="https://images2.imgbox.com/2c/d6/RVJwqWi2_o.png" alt="image-20221229111055868"> <p><mark>注意</mark>：汉化后的IDEA这个选项的位置发生了变化</p> <img src="https://images2.imgbox.com/08/b1/LAE888tt_o.png" alt="image-20221229110946177"> </li><li> <p><strong>Step3</strong>：</p> 
  <blockquote> 
   <p>IDEA鼠标悬停5秒不动，IDEA就会自动开启热部署</p> 
  </blockquote> </li></ul> 
<h4><a id="13__74"></a>1.3 热部署相关配置</h4> 
<p>通过修改项目中的文件，你可以发现其实并不是所有的文件修改都会激活热部署的，原因在于在开发者工具中有一组配置，当满足了配置中的条件后，才会启动热部署，配置中默认不参与热部署的目录信息如下：</p> 
<ul><li><code>/META-INF/maven</code></li><li><code>/META-INF/resources</code></li><li><code>/resources</code></li><li><code>/static</code></li><li><code>/public</code></li><li><code>/templates</code></li></ul> 
<p>以上目录中的文件如果发生变化，是不参与热部署的。如果想修改配置，可以通过application.yml文件进行设定哪些文件不参与热部署操作，如果想添加不参与热部署的文件或文件夹，可以通过下面的配置：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">devtools</span><span class="token punctuation">:</span>
    <span class="token key atrule">restart</span><span class="token punctuation">:</span>
    <span class="token comment"># 设置不参与热部署的文件或文件夹</span>
    <span class="token key atrule">exclude</span><span class="token punctuation">:</span> static/<span class="token important">**</span><span class="token punctuation">,</span>public/<span class="token important">**</span><span class="token punctuation">,</span>config/application.yml
    <span class="token comment"># 关闭或开启热部署（false表示关闭）</span>
    <span class="token key atrule">enable</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
</code></pre> 
<p><code>/**</code>表示文件夹</p> 
<blockquote> 
 <p><font size="4">知识拓展：</font></p> 
 <p>在resource下的配置文件中选择关闭热部署，可以会在其它地方打开，比如在resource/config/下的配置文件中开启了热部署，又或者在file下的配置文件，又或者是file下config下的配置文件中开启了热部署，这是由于其它三个配置文件的优先级要高于resource下的配置文件，我们可以通过设置临时属性来提高优先级，也可以通过设置Java系统属性值，具体相关知识可以参考：SpringBoot运维篇学习笔记</p> 
 <p><img src="https://images2.imgbox.com/c6/62/grIWQVfh_o.png" alt="image-20221229113951025"></p> 
</blockquote> 
<h3><a id="2_105"></a>2、高级配置</h3> 
<blockquote> 
 <p>相关配置学习，在基础篇的学习了配置，在运维篇也学习了配置，现在实用篇还是接着学习配置。越往后相关配置就越接近开发，相关配置也是在开发中最常用的那些</p> 
</blockquote> 
<h4><a id="21__109"></a>2.1 属性绑定</h4> 
<blockquote> 
 <p>所谓的属性绑定就是指“<strong>属性文件</strong>中的属性和<strong>配置类</strong>中字段之间形成一个映射关系”</p> 
</blockquote> 
<h5><a id="211_ConfigurationProperties_113"></a>2.1.1 @ConfigurationProperties</h5> 
<ul><li> <p><strong>使用<code>@ConfigurationProperties</code>实现属性绑定</strong></p> 
  <ul><li> <p><strong>为自定义的Bean绑定属性</strong></p> <p>配置文件（application.yml）：</p> <pre><code class="prism language-yaml"><span class="token key atrule">servers</span><span class="token punctuation">:</span>
  <span class="token key atrule">idAddress</span><span class="token punctuation">:</span> 192.168.0.1
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">6666</span>
  <span class="token key atrule">timeout</span><span class="token punctuation">:</span> <span class="token number">-1</span>
</code></pre> <p><font id="ServerConfig">配置类</font>（ServerConfig）：</p> <pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>hhxy<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>context<span class="token punctuation">.</span>properties<span class="token punctuation">.</span></span><span class="token class-name">ConfigurationProperties</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author ghp
 * @date 2022/12/29
 * @title
 * @description
 */</span>
<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">"servers"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServerConfig</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> idAddress<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> port<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">long</span> timeout<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
    <blockquote> 
     <p>可能会报这个警告：</p> 
     <p><img src="https://images2.imgbox.com/2c/5f/tYkBCy9g_o.png" alt="image-20221229125040950"></p> 
     <p>需要添加依赖：</p> 
     <pre><code class="prism language-xml">     <span class="token comment">&lt;!--SpringBoot配置注解处理器的依赖--&gt;</span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-configuration-processor<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
    </blockquote> <p>测试类（可以重新创建一个测试类，这里我是直接使用了启动类来测试）：</p> <pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>hhxy</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>druid<span class="token punctuation">.</span>pool<span class="token punctuation">.</span></span><span class="token class-name">DruidDataSource</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>hhxy<span class="token punctuation">.</span>config<span class="token punctuation">.</span></span><span class="token class-name">ServerConfig</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">ConfigurableApplicationContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Springboot10ConfigurationApplication</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">ConfigurableApplicationContext</span> ctx <span class="token operator">=</span> <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Springboot10ConfigurationApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ServerConfig</span> bean <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">ServerConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"bean = "</span> <span class="token operator">+</span> bean<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <p>测试结果：</p> <p><img src="https://images2.imgbox.com/4e/2b/LQ2wYNUr_o.png" alt="image-20221229121517222"></p> </li><li> <p><strong>为第三方的Bean绑定属性</strong></p> <p>配置类（这里我是直接将测试代码和第三方Bean都写在了入口类，可以分开写，将第三方Bean写在一个单独的配置类中）：</p> <pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>hhxy</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>druid<span class="token punctuation">.</span>pool<span class="token punctuation">.</span></span><span class="token class-name">DruidDataSource</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">ConfigurableApplicationContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Springboot10ConfigurationApplication</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token comment">//@ConfigurationProperties(prefix = "datasource")//这里也可以使用这个注解与配置文件中的值进行属性绑定</span>
    <span class="token keyword">public</span> <span class="token class-name">DruidDataSource</span> <span class="token function">dataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">DruidDataSource</span> ds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DruidDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ds<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">"ghp"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ds<span class="token punctuation">.</span><span class="token function">setDriverClassName</span><span class="token punctuation">(</span><span class="token string">"com.mysql.cj.jdbc.Driver"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> ds<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">ConfigurableApplicationContext</span> ctx <span class="token operator">=</span> <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Springboot10ConfigurationApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">DruidDataSource</span> ds <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">DruidDataSource</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ds.getUsername() = "</span> <span class="token operator">+</span> ds<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ds.getDriverClassName() = "</span> <span class="token operator">+</span> ds<span class="token punctuation">.</span><span class="token function">getDriverClassName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ds = "</span> <span class="token operator">+</span> ds<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <p>测试结果：</p> <p><img src="https://images2.imgbox.com/eb/be/CuIdMrtO_o.png" alt="image-20221229122231355"></p> <p>如果使用ConfigurationProperties进行属性绑定，但同时使用set设置属性值：</p> <p><img src="https://images2.imgbox.com/95/45/mQVXOBRN_o.png" alt="image-20221229130338667"></p> </li></ul> </li></ul> 
<blockquote> 
 <p><font size="4">知识拓展</font>：<strong><code>@EnableConfigurationProperties</code></strong>（开启属性绑定，并确定属性绑定的目标是谁）</p> 
 <p>使用@ConfigurationProperties注解可以为bean进行属性绑定，那在一个业务系统中，哪些bean通过注解@ConfigurationProperties去绑定属性了呢</p> 
 <p>目前我们定义Bean不是通过类注解<code>@Compent</code>定义，就是通过<code>@Bean</code>定义。通过类注解定义的Bean，我们将<code>@ConfigurationProperties</code>注解写在类上，通过<code>@Bean</code>定义的，我们将<code>@ConfigurationProperties</code>注解写在方法上，那么我们该如何确定哪些Bean通过<code>@ConfigurationProperties</code>注解绑定了属性呢？因为这个注解不仅可以写在类上，还可以写在方法上，所以找起来就比较麻烦了。为了解决这个问题，SpringBoot给我们提供了一个全新的注解，专门标注使用<code>@ConfigurationProperties</code>注解绑定属性的Bean是哪些。</p> 
 <p><code>@EnableConfigurationProperties</code>注解的主要作用是用来标记哪些Bean是使用<code>@ConfigurationProperties</code>去绑定了属性的，此外它不仅具有标记功能，还能帮我们把标记的类创建一个Bean（这个注解只能写在类上，方便查找）</p> 
 <pre><code class="prism language-java"><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token comment">// 告诉开发者ServerConfig配置类是使用@ConfigurationProperties去绑定属性的，同时为它创建一个Bean</span>
<span class="token annotation punctuation">@EnableConfigurationProperties</span><span class="token punctuation">(</span><span class="token class-name">ServerConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Springboot10ConfigurationApplication</span> <span class="token punctuation">{<!-- --></span>
 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre> 
 <p><mark>注意</mark>：此时<a href="#ServerConfig" rel="nofollow">ServerConfig</a>不需要再去添加<code>@Component</code>注解了（这个@ConfigurationProperties注解仍然需要），因为<code>@EnableConfigurationProperties</code>注解已经为他创建了一个Bean，如果同时存在会报一个<code>NoUniqueBeanDefinitionException</code>（没有定义唯一的Bean，说明此时重复定义了Bean）的异常</p> 
 <p>PS：@EnableConfigurationProperties注解可以同时标注多个类</p> 
 <pre><code class="prism language-java"><span class="token annotation punctuation">@EnableConfigurationProperties</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token class-name">ServerConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span><span class="token class-name">A</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span><span class="token class-name">B</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
</blockquote> 
<h5><a id="212__265"></a>2.1.2 宽松绑定/松散绑定</h5> 
<p>可以看到当我们的datasource编程dataSource时，就会报错：</p> 
<p><img src="https://images2.imgbox.com/6d/ac/i7npGDkG_o.png" alt="image-20221229130511778"></p> 
<p>这是由于这里属于严格格式，必须按照特定的规则（<mark>纯小写</mark>）来进行书写，但是对于配置文件中的属性和配置类中的字段，却是使用宽松绑定(松散绑定)的</p> 
<p><img src="https://images2.imgbox.com/45/66/KuyXiwdz_o.png" alt="image-20221229203607069"></p> 
<p>这里的<mark>随便写</mark>，意思就是可以<font color="red">忽略大小写、<code>_</code>、<code>-</code></font>，这三种东西可以随意组合，比如：idaddress，id-address，id_adress，Id-AddR_ess……这些最终都可以匹配到配置类中的idAdress，同理配置类中的idAddress也可以三种方式任意组合，<font color="gree">常用的有三种形式：烤肉串模式，下滑行模式，小驼峰模式，常量模式</font></p> 
<p>==注意：==必须是<code>@ConfigurationProperties</code>注解绑定的属性，才能随便写，如果使用<code>@Value("${servers.idAddress}")</code>注解获取配置文件中的属性值，则该属性只能使用 idAdress 这一种写法，否则就直接报错</p> 
<h4><a id="22__281"></a>2.2 常用计量单位</h4> 
<p>配置文件</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">servers</span><span class="token punctuation">:</span>
  <span class="token key atrule">idAddress</span><span class="token punctuation">:</span> 192.168.0.1
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">6666</span>
  <span class="token key atrule">timeout</span><span class="token punctuation">:</span> <span class="token number">-1</span>
  <span class="token key atrule">serverTimeOUt</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">dataSize</span><span class="token punctuation">:</span> <span class="token number">10</span>	<span class="token comment"># 这里现在代表10MB，因为@DataSizeUnit设置的单位是MB</span>
  <span class="token comment"># dataSize: 10MB  # 可以不使用注解，直接在这里使用MB，和上面使用注解的效果是一样的</span>
</code></pre> 
<p>配置类：</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">"servers"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServerConfig</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> idAddress<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> port<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">long</span> timeout<span class="token punctuation">;</span>	<span class="token comment">// long的单位一般默认ms，但是它没有提示</span>
    <span class="token annotation punctuation">@DurationUnit</span><span class="token punctuation">(</span><span class="token class-name">ChronoUnit</span><span class="token punctuation">.</span><span class="token constant">HOURS</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Duration</span> serverTimeOut<span class="token punctuation">;</span>	<span class="token comment">// 使用Duration，可以让数字带单位（默认是ms），并且可以设置单位，比如年、月、日</span>
    <span class="token annotation punctuation">@DataSizeUnit</span><span class="token punctuation">(</span><span class="token class-name">DataUnit</span><span class="token punctuation">.</span><span class="token constant">MEGABYTES</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">DataSize</span> dataSize<span class="token punctuation">;</span>	<span class="token comment">// 设置容量大小（默认单位是B），可以将单位改成MB、KB、GB</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>测试类：</p> 
<pre><code class="prism language-java">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">ConfigurableApplicationContext</span> ctx <span class="token operator">=</span> <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Springboot10ConfigurationApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ServerConfig</span> bean <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">ServerConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"bean = "</span> <span class="token operator">+</span> bean<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">DruidDataSource</span> ds <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">DruidDataSource</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ds.getUsername() = "</span> <span class="token operator">+</span> ds<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ds.getDriverClassName() = "</span> <span class="token operator">+</span> ds<span class="token punctuation">.</span><span class="token function">getDriverClassName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ds = "</span> <span class="token operator">+</span> ds<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/d2/b4/H7yYXpaM_o.png" alt="image-20221229210319924"></p> 
<p>PS：104857608 B / 1024 = 10240 KB / 1024 = 10MB</p> 
<h4><a id="23__331"></a>2.3 属性校验</h4> 
<blockquote> 
 <p>  目前我们在进行属性绑定时可以通过松散绑定规则在书写时放飞自我了，但是在书写时由于无法感知模型类中的数据类型，就会出现类型不匹配的问题，比如代码中需要int类型，配置中给了非法的数值，例如写一个“a"，这种数据肯定无法有效的绑定，还会引发错误。</p> 
 <p>  SpringBoot给出了强大的数据校验功能，可以有效的避免此类问题的发生。在JAVAEE的JSR303规范中给出了具体的数据校验标准，开发者可以根据自己的需要选择对应的校验框架，此处使用Hibernate提供的校验框架来作为实现进行数据校验。书写应用格式非常固定，话不多说，直接上步骤</p> 
</blockquote> 
<ul><li> <p><strong>Step1</strong>：导入依赖</p> <p>这里需要两个依赖，一个是JSR303规范，一个是JSR303规范的实现类，它们就类似于JDBC和MySQL驱动的关系。</p> <pre><code class="prism language-xml">        <span class="token comment">&lt;!--属性校验依赖（JSR303规范）--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>javax.validation<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>validation-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token comment">&lt;!--Hibernate校验器（JSR303规范的实现类）--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.hibernate.validator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hibernate-validator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> </li><li> <p><strong>Step2</strong>：在需要开启校验功能的类上使用注解<code>@Validated</code>开启校验功能</p> </li><li> <p><strong>Step3</strong>：在开启了校验功能的类中的字段上添加校验规则</p> <pre><code class="prism language-java"><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">"servers"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Validated</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServerConfig</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> idAddress<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Max</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token number">8888</span><span class="token punctuation">,</span> message <span class="token operator">=</span> <span class="token string">"不能大于最大值8888"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Min</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token number">8080</span><span class="token punctuation">,</span> message <span class="token operator">=</span> <span class="token string">"不能小于最小值8080"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> port<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">long</span> timeout<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@DurationUnit</span><span class="token punctuation">(</span><span class="token class-name">ChronoUnit</span><span class="token punctuation">.</span><span class="token constant">HOURS</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Duration</span> serverTimeOut<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@DataSizeUnit</span><span class="token punctuation">(</span><span class="token class-name">DataUnit</span><span class="token punctuation">.</span><span class="token constant">MEGABYTES</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">DataSize</span> dataSize<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> </li><li> <p><strong>Step4</strong>：测试</p> <p>测试类和2.2中的是一样的，略</p> </li></ul> 
<p><img src="https://images2.imgbox.com/dd/e1/tWvdKAg0_o.png" alt="image-20221229211722771"></p> 
<blockquote> 
 <p><font size="4">知识拓展</font>：类型转换的一个坑</p> 
 <img src="https://images2.imgbox.com/b4/15/rbU3T5ly_o.png" alt="image-20221229213213657"> 
 <p>在SpringBoot中，如果对于纯数字的字符串不使用引号包括，在解析时会将他转换成int类型！比如0127，它先会被默认当成8进制（8进制都是以0开始的，后面接0~7），0127转成int类型（默认是10进制）87，此时当我们获取配置属性中的值，就变成了87.</p> 
 <p>所以<mark>配置文件中书写纯数字的字符串时，一定要养成添加引号的习惯</mark>，说不定哪天就碰到这种错误了，让你看半天（习惯很重要）。</p> 
 <p>如果字符串是0x123也一样，会当成16进制来转换……</p> 
</blockquote> 
<h3><a id="3_394"></a>3、测试</h3> 
<h4><a id="31__396"></a>3.1 加载测试属性</h4> 
<ul><li> <p><strong>设置临时测试属性</strong></p> <p>配置文件：</p> <pre><code class="prism language-yaml"><span class="token key atrule">test</span><span class="token punctuation">:</span>
  <span class="token key atrule">prop</span><span class="token punctuation">:</span> testValue
</code></pre> <p>测试类：</p> <pre><code class="prism language-java"><span class="token comment">// properties用于添加临时属性</span>
<span class="token comment">//@SpringBootTest(properties = {"test.prop=testValue1"})</span>
<span class="token comment">// args同样可以添加临时属性</span>
<span class="token annotation punctuation">@SpringBootTest</span><span class="token punctuation">(</span>args <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"--test.prop=testValue2"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PropertiesAndArgsTest</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${test.prop}"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> value<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <p><mark>注意</mark>：当properties和args同时存在时，以args为主，三者的优先级是：<code>@Value &lt; properties &lt; args</code></p> </li><li> <p><code>@Important</code>：<strong>为测试类导入专属配置</strong></p> <p>配置类：</p> <pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>hhxy<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author ghp
 * @date 2022/12/29
 * @title
 * @description
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MsgConfig</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">msg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token string">"MsgConfig被加载了"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <p>测试类：</p> <pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>hhxy<span class="token punctuation">.</span>test</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>hhxy<span class="token punctuation">.</span>config<span class="token punctuation">.</span></span><span class="token class-name">MsgConfig</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">SpringBootTest</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Import</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author ghp
 * @date 2022/12/29
 * @title
 * @description
 */</span>
<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token class-name">MsgConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConfigTest</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> msg<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"msg = "</span> <span class="token operator">+</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <p><img src="https://images2.imgbox.com/a8/eb/cnNIumIf_o.png" alt="image-20221230101959399"></p> <p>这样这个配置类就只能在这一个测试类中生效了，对其它测试类没有任何的影响</p> <p><img src="https://images2.imgbox.com/91/93/U0mBrw3n_o.png" alt="image-20221230102155596"></p> </li></ul> 
<h4><a id="32_Controller_490"></a>3.2 测试Controller</h4> 
<blockquote> 
 <p>之前测试Controller都是使用postmain或者是RestfulTool插件进行测试的，而SpringBoot为我们提供了测试Controller的方式，只是默认是处于关闭状态的，我们需要手动开启</p> 
</blockquote> 
<h5><a id="321_Controller_494"></a>3.2.1 开启Controller测试</h5> 
<blockquote> 
 <p>如果我们想要测试Controller（表现层），首先我们应该在测试的使用启动Web服务器</p> 
</blockquote> 
<ul><li>默认值：<code>SpringBootTest.WebEnvironment.NONE</code>，不启动Web服务器</li><li><code>SpringBootTest.WebEnvironment.DEFINED_PORT</code>：启动Web服务器，并使用自定义的端口（也就是你当前配置的端口，没有配置就默认是8080）</li><li><code>SpringBootTest.WebEnvironment.RANDOM_PORT</code>：启动Web服务器，并且使用随机端口</li></ul> 
<p><img src="https://images2.imgbox.com/95/49/XDtpGLVY_o.png" alt="image-20221230103306966"></p> 
<p><font size="4">实例：</font></p> 
<p>先准备一个Controller</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>hhxy<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author ghp
 * @date 2022/12/30
 * @title
 * @description
 */</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/test"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestController</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/test1"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"test1被访问了！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">"test1被访问"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li> <p><strong>Step1</strong>：开启Web服务器</p> <pre><code class="prism language-java"><span class="token comment">// 开启Web服务器，并使用自定义的端口</span>
<span class="token annotation punctuation">@SpringBootTest</span><span class="token punctuation">(</span>webEnvironment <span class="token operator">=</span> <span class="token class-name">SpringBootTest<span class="token punctuation">.</span>WebEnvironment</span><span class="token punctuation">.</span><span class="token constant">DEFINED_PORT</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebTest</span> <span class="token punctuation">{<!-- --></span>
<span class="token punctuation">}</span>
</code></pre> </li><li> <p><strong>Step2</strong>：开启虚拟调用</p> <pre><code class="prism language-java"><span class="token annotation punctuation">@SpringBootTest</span><span class="token punctuation">(</span>webEnvironment <span class="token operator">=</span> <span class="token class-name">SpringBootTest<span class="token punctuation">.</span>WebEnvironment</span><span class="token punctuation">.</span><span class="token constant">DEFINED_PORT</span><span class="token punctuation">)</span>
<span class="token comment">// 开启虚拟MVC的调用</span>
<span class="token annotation punctuation">@AutoConfigureMockMvc</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebTest</span> <span class="token punctuation">{<!-- --></span>
<span class="token punctuation">}</span>
</code></pre> </li><li> <p><strong>Step3</strong>：创建请求</p> <pre><code class="prism language-java"><span class="token class-name">MockHttpServletRequestBuilder</span> requestBuilder <span class="token operator">=</span> <span class="token class-name">MockMvcRequestBuilders</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/test/test1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> </li><li> <p><strong>Step4</strong>：执行请求</p> <pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>hhxy<span class="token punctuation">.</span>test</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">AutoConfigureMockMvc</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">SpringBootTest</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">MockMvc</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>request<span class="token punctuation">.</span></span><span class="token class-name">MockHttpServletRequestBuilder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>request<span class="token punctuation">.</span></span><span class="token class-name">MockMvcRequestBuilders</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author ghp
 * @date 2022/12/30
 * @title
 * @description
 */</span>
<span class="token annotation punctuation">@SpringBootTest</span><span class="token punctuation">(</span>webEnvironment <span class="token operator">=</span> <span class="token class-name">SpringBootTest<span class="token punctuation">.</span>WebEnvironment</span><span class="token punctuation">.</span><span class="token constant">DEFINED_PORT</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@AutoConfigureMockMvc</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebTest</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testWeb</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Autowired</span> <span class="token class-name">MockMvc</span> mvc<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 访问路径: http://localhost:8080/test/test1</span>
        <span class="token comment">// 创建一个虚拟的请求</span>
        <span class="token class-name">MockHttpServletRequestBuilder</span> requestBuilder <span class="token operator">=</span> <span class="token class-name">MockMvcRequestBuilders</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/test/test1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 执行请求</span>
        mvc<span class="token punctuation">.</span><span class="token function">perform</span><span class="token punctuation">(</span>requestBuilder<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <p>测试结果如下：</p> <p><img src="https://images2.imgbox.com/e2/b8/Z3vMj9La_o.png" alt="image-20221230111240658"></p> </li></ul> 
<h5><a id="322__596"></a>3.2.2 匹配响应数据</h5> 
<ul><li> <p><strong>匹配响应状态</strong></p> <pre><code class="prism language-java"><span class="token comment">// 开启Web服务器，并使用自定义端口</span>
<span class="token annotation punctuation">@SpringBootTest</span><span class="token punctuation">(</span>webEnvironment <span class="token operator">=</span> <span class="token class-name">SpringBootTest<span class="token punctuation">.</span>WebEnvironment</span><span class="token punctuation">.</span><span class="token constant">DEFINED_PORT</span><span class="token punctuation">)</span>
<span class="token comment">// 开启虚拟MVC的调用</span>
<span class="token annotation punctuation">@AutoConfigureMockMvc</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebTest</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testStatus</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Autowired</span> <span class="token class-name">MockMvc</span> mvc<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 创建一个虚拟的请求</span>
        <span class="token class-name">MockHttpServletRequestBuilder</span> requestBuilder <span class="token operator">=</span> <span class="token class-name">MockMvcRequestBuilders</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/test/test2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 执行请求</span>
        <span class="token class-name">ResultActions</span> actions <span class="token operator">=</span> mvc<span class="token punctuation">.</span><span class="token function">perform</span><span class="token punctuation">(</span>requestBuilder<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 设置预期值，用于判断是否请求成功</span>
        <span class="token class-name">StatusResultMatchers</span> status <span class="token operator">=</span> <span class="token class-name">MockMvcResultMatchers</span><span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ResultMatcher</span> ok <span class="token operator">=</span> status<span class="token punctuation">.</span><span class="token function">isOk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token comment">// status中的API封装了所有请求状态（这里我使用的状态是请求成功，状态码是200）</span>

        <span class="token comment">// 将预期值与响应状态进行匹配</span>
        actions<span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span>ok<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <p><img src="https://images2.imgbox.com/bc/de/drHvkWmv_o.png" alt="image-20221230112709393"></p> </li><li> <p><strong>匹配响应体</strong></p> <pre><code class="prism language-java">    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testResponseBody</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Autowired</span> <span class="token class-name">MockMvc</span> mvc<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 创建一个虚拟的请求</span>
        <span class="token class-name">MockHttpServletRequestBuilder</span> requestBuilder <span class="token operator">=</span> <span class="token class-name">MockMvcRequestBuilders</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/test/test1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 执行请求</span>
        <span class="token class-name">ResultActions</span> actions <span class="token operator">=</span> mvc<span class="token punctuation">.</span><span class="token function">perform</span><span class="token punctuation">(</span>requestBuilder<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 设置预期值，用于判断是否请求成功</span>
        <span class="token class-name">ContentResultMatchers</span> content <span class="token operator">=</span> <span class="token class-name">MockMvcResultMatchers</span><span class="token punctuation">.</span><span class="token function">content</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ResultMatcher</span> result <span class="token operator">=</span> content<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token string">"springboot"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ResultMatcher json = content.json(""); // 还可以匹配JSON字符串</span>

        <span class="token comment">// 添加预期值与响应值进行匹配</span>
        actions<span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <p><img src="https://images2.imgbox.com/5b/ec/aurmlLsT_o.png" alt="image-20221230113207399"></p> </li><li> <p><strong>匹配响应头</strong></p> <pre><code class="prism language-java">	<span class="token comment">// 创建并执行请求    </span>

	<span class="token comment">// 设置预期值</span>
	<span class="token class-name">HeaderResultMatchers</span> header <span class="token operator">=</span> <span class="token class-name">MockMvcResultMatchers</span><span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ResultMatcher</span> contentType <span class="token operator">=</span> header<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token string">"Content-Type"</span><span class="token punctuation">,</span> <span class="token string">"application/json"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">// 添加预期值与响应值进行匹配</span>
    action<span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span>contentType<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> </li></ul> 
<h4><a id="33__662"></a>3.3 测试回滚</h4> 
<blockquote> 
 <p>前面（运维篇1.1小节）我们遇到了，打包项目时test下所有的测试方法都被执行了一遍，这是由于Maven的生命周期决定的。所有的测试方法执行一遍后，会给我们的数据库添加一些没有用的测试数据，虽然当时我们可以通过IDEA设置跳过测试，但显然跳过测试会给项目带来极大的安全隐患，所以我们需要测试，但如果避免测试后数据无法持久化保存到数据库中呢？这就需要用到<strong>测试回滚</strong>了</p> 
</blockquote> 
<p>主要实现是靠<code>@Transactional</code>注解，这个注解添加类上，可以让类中所有的方法变成一个个事物（在Spring篇学过），添加这个注解后，所有的方法就会被当成事物，众所周知<mark>事务必须提交才能生效，比提交的事物可以随时回滚</mark>，而<strong>在测试类中</strong>添加<code>@Transactional</code>注解，它的默认配置项<code>@Rollback</code>是<strong>true</strong>，并且测试类中的事务默认是不提交的，这样测试方法照样可以运行，但是数据是不能添加到数据库中的（如果想要数据添加到数据库中，可以设置@Rollback为false）</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@SpringBootTest</span>
<span class="token annotation punctuation">@Transactional</span>
<span class="token annotation punctuation">@Rollback</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DaoTest</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">BookService</span> bookService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">testSave</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Book</span> book <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Book</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        book<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"test`"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        book<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"test`"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        book<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"test`"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 将测试数据添加到数据库中</span>
        bookService<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>book<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="34__688"></a>3.4 随机生成测试用例</h4> 
<blockquote> 
 <p>前面我们一直都是使用硬编码，将测试数据写死的，但是写死的数据是很难成功测出bug的，所以我们需要随机生成测试数据</p> 
</blockquote> 
<p>配置文件：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">testCase</span><span class="token punctuation">:</span>
  <span class="token key atrule">book</span><span class="token punctuation">:</span>
    <span class="token key atrule">id</span><span class="token punctuation">:</span> $<span class="token punctuation">{<!-- --></span>random.int<span class="token punctuation">}</span>
    <span class="token key atrule">id2</span><span class="token punctuation">:</span> $<span class="token punctuation">{<!-- --></span>random.int(10)<span class="token punctuation">}</span> <span class="token comment"># [0,10)的整数</span>
    <span class="token key atrule">id3</span><span class="token punctuation">:</span> $<span class="token punctuation">{<!-- --></span>random.int(5<span class="token punctuation">,</span>10)<span class="token punctuation">}</span> <span class="token comment"># [5,10)的整数</span>
    <span class="token key atrule">id4</span><span class="token punctuation">:</span> $<span class="token punctuation">{<!-- --></span>random.int？5<span class="token punctuation">,</span>10！<span class="token punctuation">}</span> 
    <span class="token comment"># [5,10)的整数，数字前后可以是任意的符号，非敏感字符除外，比如-号，这里了解即可，一般都默认使用括号</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> $<span class="token punctuation">{<!-- --></span>random.value<span class="token punctuation">}</span> <span class="token comment"># 随机生成一个MD5加密的32位字符串</span>
    <span class="token key atrule">uuid</span><span class="token punctuation">:</span> $<span class="token punctuation">{<!-- --></span>random.uuid<span class="token punctuation">}</span> <span class="token comment"># 随机生成一个uuid</span>
    <span class="token key atrule">publishTime</span><span class="token punctuation">:</span> $<span class="token punctuation">{<!-- --></span>random.long<span class="token punctuation">}</span>  <span class="token comment"># 随机生成long范围内的整数</span>
</code></pre> 
<p>配置类：</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">"testcase.book"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BookCase</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> id2<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> id3<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> id4<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> uuid<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">long</span> publishTime<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>测试类：</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BookCaseTest</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">BookCase</span> bookCase<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testBookCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"bookCase = "</span> <span class="token operator">+</span> bookCase<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="4_741"></a>4、数据访问层解决方案</h3> 
<h4><a id="41_SQL_743"></a>4.1 SQL</h4> 
<h5><a id="411__745"></a>4.1.1 数据源技术</h5> 
<p>当我们引入Druid对应的starter后，即使在配置文件中不配置Druid，SpringBoot也会默认使用Druid。当我们不引入Druid对应的starter，SpringBoot会默认使用<code>HikariCP</code>数据源，他是SpringBoot内嵌的数据源，SpringBoot内部共配置了三种数据源：</p> 
<ol><li><strong>HikariCP</strong>（号称轻量级数据源中最快的）：默认使用</li><li><strong>Tomcat提供的DataSource</strong>：当HiKariCP不可用时，且在Web环境，将使用Tomcat内置的数据源</li><li><strong>Commons</strong> DBCP：HikariCP不可用，Tomcat数据源不可用，将使用DBCP数据源</li></ol> 
<p>这就是SpringBoot为开发者提供的数据源解决方案</p> 
<p>Hikari配置方式：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/ssm_db<span class="token punctuation">?</span>serverTimezone=UTC
    <span class="token key atrule">hikari</span><span class="token punctuation">:</span>
      <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
      <span class="token key atrule">username</span><span class="token punctuation">:</span> root
      <span class="token key atrule">password</span><span class="token punctuation">:</span> root
</code></pre> 
<p>druid配置方式：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">druid</span><span class="token punctuation">:</span>	
   	  <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/ssm_db<span class="token punctuation">?</span>serverTimezone=UTC
      <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
      <span class="token key atrule">username</span><span class="token punctuation">:</span> root
      <span class="token key atrule">password</span><span class="token punctuation">:</span> root
</code></pre> 
<h5><a id="412__779"></a>4.1.2 持久化技术</h5> 
<p>springboot充分发挥其最强辅助的特征，给开发者提供了一套现成的数据层技术，叫做JdbcTemplate。其实这个技术不能说是springboot提供的，因为不使用springboot技术，一样能使用它，谁提供的呢？spring技术提供的，所以在springboot技术范畴中，这个技术也是存在的，毕竟springboot技术是加速spring程序开发而创建的。</p> 
<p><font size="4">实例</font>：</p> 
<p>导入依赖</p> 
<pre><code class="prism language-xml">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-jdbc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>测试</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JdbcTemplateTest</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">JdbcTemplate</span> jdbcTemplate<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testJdbcTemplateQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">"select * from tb_book"</span><span class="token punctuation">;</span>

        <span class="token comment">/*
        这种方式查询出来是一个Map集合，Map集合用起来比较麻烦
        List&lt;Map&lt;String, Object&gt;&gt; books = jdbcTemplate.queryForList(sql);
        books.forEach(System.out::println);
        */</span>

        <span class="token comment">// 标准化查询</span>
        <span class="token class-name">RowMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Book</span><span class="token punctuation">&gt;</span></span> rm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RowMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Book</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">Book</span> <span class="token function">mapRow</span><span class="token punctuation">(</span><span class="token class-name">ResultSet</span> rs<span class="token punctuation">,</span> <span class="token keyword">int</span> rowNum<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">Book</span> book <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Book</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"type"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"description"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> book<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Book</span><span class="token punctuation">&gt;</span></span> books <span class="token operator">=</span> jdbcTemplate<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> rm<span class="token punctuation">)</span><span class="token punctuation">;</span>
        books<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testJdbcTemplateSave</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">"insert into tb_book values (null, 'test1', 'test2', 'test3')"</span><span class="token punctuation">;</span>
        jdbcTemplate<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/1b/50/awYAMvMU_o.png" alt="image-20221231083104824"></p> 
<blockquote> 
 <p><font size="4">知识拓展：</font>JdbcTemplate相关配置</p> 
 <pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
<span class="token comment"># jdbc相关配置</span>
<span class="token key atrule">jdbc</span><span class="token punctuation">:</span>
 <span class="token key atrule">template</span><span class="token punctuation">:</span>
   <span class="token key atrule">query-timeout</span><span class="token punctuation">:</span> 10s <span class="token comment"># 最大查询时间，超过这个时间就终止查询（不带单位默认是ms）</span>
   <span class="token key atrule">max-rows</span><span class="token punctuation">:</span> <span class="token number">100</span> <span class="token comment"># 一次能够查询到的最大记录条数，这里设置的一次最大能查100条记录</span>
   <span class="token key atrule">fetch-size</span><span class="token punctuation">:</span> <span class="token number">50</span> 
   <span class="token comment"># 一次查询给你的记录条数，超过50条就会重新执行查询操作（因为不可能将所有的记录一次性全部给你，内存有限）</span>
</code></pre> 
</blockquote> 
<h5><a id="413__851"></a>4.1.3 数据库技术</h5> 
<p>截止到目前，springboot给开发者提供了内置的数据源解决方案和持久化解决方案，在数据层解决方案三件套中还剩下一个数据库，莫非springboot也提供有内置的解决方案？还真有，还不是一个，三个，这一节就来说说内置的数据库解决方案。</p> 
<p>springboot提供了3款内置的数据库，分别是：</p> 
<ol><li><strong><a href="https://baike.baidu.com/item/H2%E6%95%B0%E6%8D%AE%E5%BA%93/23316077?fromModule=search-result_lemma" rel="nofollow">H2</a></strong>：内存数据库，是由Java编写的，支持在内存中创建表和数据库</li><li><strong><a href="https://baike.baidu.com/item/hsqldb/1452593?fromModule=search-result_lemma" rel="nofollow">HSQL</a></strong>：HSQLDB(HyperSQL DataBase)是一个开放源代码的JAVA数据库，其具有标准的SQL语法和JAVA接口，它可以自由使用和分发，非常简洁和快速的</li><li><strong><a href="https://baike.baidu.com/item/Derby?fromModule=lemma_search-box" rel="nofollow">Derby</a></strong>：是一个完全用java编写的数据库，它非常小巧，核心部分derby.jar只有2M，所以既可以做为单独的<a href="https://baike.baidu.com/item/%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9C%8D%E5%8A%A1%E5%99%A8/613818?fromModule=lemma_inlink" rel="nofollow">数据库服务器</a>使用，也可以内嵌在应用程序中使用</li></ol> 
<p>它们都很轻巧，都能在内存中运行，都是使用Java编写的，一般用来测试</p> 
<ul><li> <p><strong>配置H2DB</strong></p> 
  <ul><li> <p><strong>Step1</strong>：导入依赖</p> <pre><code class="prism language-xml">        <span class="token comment">&lt;!--h2依赖--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.h2database<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>h2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token comment">&lt;!--jpa对应的starter--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-jpa<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token comment">&lt;!--JdbcTemplate对应的starter--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-jdbc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <p><strong>备注</strong>：此外还需要SpringMVC对应的Starter（这不是H2DB所必须的，只是为了测试需要）</p> </li><li> <p><strong>Step2</strong>：编写配置文件</p> <pre><code class="prism language-yaml"><span class="token comment"># 配置端口</span>
<span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>
  
<span class="token comment"># Spring相关配置</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token comment"># h2数据库相关配置</span>
  <span class="token key atrule">h2</span><span class="token punctuation">:</span>
    <span class="token key atrule">console</span><span class="token punctuation">:</span>
      <span class="token key atrule">path</span><span class="token punctuation">:</span> /h2 <span class="token comment"># 启动路径</span>
      <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># 是否启用h2数据库（true表示是）</span>
  <span class="token comment"># 这个是数据源配置是用来初始化h2的一些信息，初始化后，就可以不需要了</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>h2<span class="token punctuation">:</span>~/test
    <span class="token key atrule">hikari</span><span class="token punctuation">:</span>
      <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> org.h2.Driver <span class="token comment"># 这一行可以省略</span>
      <span class="token key atrule">username</span><span class="token punctuation">:</span> sa
      <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123456</span>
</code></pre> </li><li> <p><strong>Step3</strong>：启动</p> <p>运行SpringBoot程序的启动类，运行成功后，在浏览器中访问<code>http://localhost:8080/h2</code>这个链接，就能够来到H2DB的控制台了</p> <p><img src="https://images2.imgbox.com/f6/46/YLwe9Gae_o.png" alt="image-20221231093859151"></p> <p><img src="https://images2.imgbox.com/34/66/FdN0wCYV_o.png" alt="image-20221231093925853"></p> <p><strong>备注</strong>：该数据库在C盘的user目录下</p> <p><img src="https://images2.imgbox.com/a9/1c/WVWkxLB0_o.png" alt="image-20221231094142729"></p> </li></ul> </li><li> <p><strong>Step4</strong>：测试</p> <p><img src="https://images2.imgbox.com/f5/5e/tAwMbloP_o.png" alt="image-20221231094443564"></p> <p><img src="https://images2.imgbox.com/ba/8e/WdlianJM_o.png" alt="image-20221231094630197"></p> <p><img src="https://images2.imgbox.com/13/67/rULzw4MG_o.png" alt="image-20221231094942495"></p> </li></ul> 
<p><font size="4"><strong>总结</strong></font></p> 
<ul><li>数据源技术：Druid、Hikari、tomcat DataSource、DBCP</li><li>持久化技术：MyBatisPlus、MyBatis、JdbcTemplate</li><li>数据库技术：MySQL、H2、HSQL、Derby</li></ul> 
<p>这些东西可以任意搭配，总共有<code>4*3*4</code>种方案</p> 
<h4><a id="42_NoSQL_940"></a>4.2 NoSQL</h4> 
<h5><a id="421_Redis_942"></a>4.2.1 整合Redis</h5> 
<blockquote> 
 <p>Redis安装教程请参考：Redis基础篇学习笔记</p> 
</blockquote> 
<ul><li> <p><strong>Step1</strong>：导入依赖</p> <pre><code class="prism language-xml">	    <span class="token comment">&lt;!--Redis对应的starter--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> </li><li> <p><strong>Step2</strong>：编写配置文件</p> <pre><code class="prism language-yaml"><span class="token comment"># 配置端口</span>
<span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>

<span class="token comment"># spring相关配置</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">redis</span><span class="token punctuation">:</span>
    <span class="token key atrule">host</span><span class="token punctuation">:</span> 192.168.88.130
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">6379</span>
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">32345678</span>
</code></pre> </li><li> <p><strong>Step3</strong>：测试</p> <pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>hhxy<span class="token punctuation">.</span>test</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">SpringBootTest</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">RedisTemplate</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">ValueOperations</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author ghp
 * @date 2022/12/31
 * @title
 * @description
 */</span>
<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisTest</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RedisTemplate</span> redisTemplate<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 获取操作String类型的对象</span>
        <span class="token class-name">ValueOperations</span> ops <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 将String类型的数据添加到Redis中</span>
        ops<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"zs"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">ValueOperations</span> ops <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> name <span class="token operator">=</span> ops<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"name = "</span> <span class="token operator">+</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <p><img src="https://images2.imgbox.com/5c/81/rTF5R9hY_o.png" alt="image-20221231103426742"></p> </li></ul> 
<blockquote> 
 <p><font size="4">知识拓展：</font>RedisTemplate&amp;StringRedisTemplate</p> 
 <p><img src="https://images2.imgbox.com/19/91/dkfgO3ht_o.png" alt="image-20221231104654795"></p> 
 <p>这是由于Redis内部不提供Java对象的存储格式，因此当操作的数据以对象的形式存在时，会进行转码，转换成字符串格式后进行操作。为了方便开发者使用基于字符串为数据的操作，SpringBoot整合Redis时提供了专用的API接口StringRedisTemplate（这在Redis基础篇学习笔记中有更加详细的说明，也提供了解决方案）</p> 
 <p>PS：其实StringReidsTemplate是RedisTemplate的一个指定了泛型的API，</p> 
 <p><mark>StringRedisTemplate就是RedisTemplate&lt;String, String&gt;</mark></p> 
</blockquote> 
<h5><a id="422_MongoDB_1023"></a>4.2.2 整合MongoDB</h5> 
<blockquote> 
 <p>  使用Redis技术可以有效的提高数据访问速度，但是由于Redis的数据格式单一性，无法操作结构化数据，当操作对象型的数据时，Redis就显得捉襟见肘了。在保障访问速度的情况下，如果想操作结构化数据，看来Redis无法满足要求了，此时需要使用全新的数据存储结束来解决此问题，本节讲解SpringBoot如何整合MongoDB技术。</p> 
 <p>  <a href="https://baike.baidu.com/item/mongodb?fromModule=lemma_search-box" rel="nofollow">MongoDB</a>是一个基于分布式文件存储的数据库，是一个开源、高性能、无模式<sup class="footnote-ref"><a href="#fn1" rel="nofollow" id="fnref1">1</a></sup>的文档型<sup class="footnote-ref"><a href="#fn2" rel="nofollow" id="fnref2">2</a></sup>数据库。由C++语言编写。旨在为WEB应用提供可扩展的高性能数据存储解决方案。MongoDB是一个介于关系数据库和非关系数据库之间的产品，是非关系数据库当中功能最丰富，最像关系数据库的。它支持的数据结构非常松散，是类似 json 的 bson 格式，因此可以存储比较复杂的数据类型。Mongo最大的特点是它支持的查询语言非常强大，其语法有点类似于面向对象的查询语言，几乎可以实现类似关系数据库单表查询的绝大部分功能，而且还支持对数据建立<a href="https://baike.baidu.com/item/%E7%B4%A2%E5%BC%95?fromModule=lemma_inlink" rel="nofollow">索引</a>。</p> 
 <p>MongoDB的安装可以参考：MongoDB学习笔记</p> 
</blockquote> 
<ul><li> <p><strong>Step1</strong>：启动MongoDB</p> </li><li> <p><strong>Step2</strong>：创建SpringBoot程序，导入依赖</p> <pre><code class="prism language-xml"> 		<span class="token comment">&lt;!--MongoDB对应的starter--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-mongodb<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> </li><li> <p><strong>Step3</strong>：编写配置文件</p> <pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">data</span><span class="token punctuation">:</span>
    <span class="token key atrule">mongodb</span><span class="token punctuation">:</span>
      <span class="token key atrule">uri</span><span class="token punctuation">:</span> mongodb<span class="token punctuation">:</span>//localhost/test
</code></pre> </li><li> <p><strong>Step4</strong>：编码测试</p> <pre><code class="prism language-java"><span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MongoTemplateTest</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">MongoTemplate</span> mongoTemplate<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSave</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Book</span> book <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Book</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"test1"</span><span class="token punctuation">,</span> <span class="token string">"test2"</span><span class="token punctuation">,</span><span class="token string">"test3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 添加数据</span>
        mongoTemplate<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>book<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testFind</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Book</span><span class="token punctuation">&gt;</span></span> books <span class="token operator">=</span> mongoTemplate<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token class-name">Book</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        books<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> </li></ul> 
<p><img src="https://images2.imgbox.com/d3/3c/FiU0wvm5_o.png" alt="image-20230101193529326"></p> 
<p>我们可以在robo3t中查看到，数据已经添加成功：</p> 
<p><img src="https://images2.imgbox.com/fc/05/sZ7sDXpM_o.png" alt="image-20230101193620479"></p> 
<h5><a id="423_ES_1085"></a>4.2.3 整合ES</h5> 
<blockquote> 
 <p>  NoSQL解决方案已经讲完了两种技术的整合了，Redis可以使用内存加载数据并实现数据快速访问，MongoDB可以在内存中存储类似对象的数据并实现数据的快速访问，在企业级开发中对于速度的追求是永无止境的。下面要讲的内容也是一款NoSQL解决方案，只不过他的作用不是为了直接加速数据的读写，而是加速数据的查询的，叫做ES技术</p> 
 <p>  ES（Elasticsearch ）是一个分布式、高扩展、高实时的搜索与数据分析引擎。主要特点能够实现全文搜索<sup class="footnote-ref"><a href="#fn3" rel="nofollow" id="fnref3">3</a></sup>，它能很方便的使大量数据具有搜索、分析和探索的能力。充分利用Elasticsearch的水平伸缩性，能使数据在生产环境变得更有价值。</p> 
 <p>PS：浏览器的搜索提示功能就是使用了ES</p> 
 <p>Elasticsearch 详细使用方法可以参考：ES学习笔记</p> 
</blockquote> 
<ul><li> <p><strong>Step1</strong>：启动ES</p> <p><img src="https://images2.imgbox.com/8a/6e/W6xq11E6_o.png" alt="image-20230101202538825"></p> <p>启动成功后，可以访问<code>localhost:9200</code>，如果出现下面这个页面就说明启动成功了</p> <p><img src="https://images2.imgbox.com/41/ec/bntpIrVx_o.png" alt="image-20230101202700898"></p> </li><li> <p><strong>Step2</strong>：创建SpringBoot程序，导入依赖</p> <pre><code class="prism language-xml">
</code></pre> </li><li> <p><strong>Step3</strong>：</p> </li></ul> 
<h3><a id="5_1111"></a>5、整合第三方技术</h3> 
<h4><a id="51__1113"></a>5.1 缓存</h4> 
<h5><a id="511__1115"></a>5.1.1 快速体验缓存</h5> 
<p><font size="4">体验一</font>：使用HashMap模拟一个缓存，减少数据库的查询操作</p> 
<ul><li> <p><strong>Step1</strong>：搭建环境</p> <p>1）导入依赖</p> <pre><code class="prism language-xml">        <span class="token comment">&lt;!--lombok依赖--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token comment">&lt;!--mysql驱动--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token comment">&lt;!--druid对应的starter--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>druid-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.2.6<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token comment">&lt;!--MybatisPlus对应的starter--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.baomidou<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-plus-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.4.3.4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token comment">&lt;!--SpringMVC对应的starter--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token comment">&lt;!--Junit对应的starter--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <p>2）编写配置文件</p> <pre><code class="prism language-yaml"><span class="token comment"># 端口配置</span>
<span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>

<span class="token comment"># Spring相关配置</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">druid</span><span class="token punctuation">:</span>
      <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
      <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/springboot_study<span class="token punctuation">?</span>serverTimezone=UTC
      <span class="token key atrule">username</span><span class="token punctuation">:</span> root
      <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">32345678</span>

<span class="token comment"># MybatisPlus相关配置</span>
<span class="token key atrule">mybatis-plus</span><span class="token punctuation">:</span>
  <span class="token key atrule">global-config</span><span class="token punctuation">:</span>
    <span class="token key atrule">db-config</span><span class="token punctuation">:</span>
      <span class="token key atrule">table-prefix</span><span class="token punctuation">:</span> tb_ <span class="token comment"># MyBatisPlus会自动将数据库中所有表的前缀给去掉，所以需要加上前缀</span>
      <span class="token key atrule">id-type</span><span class="token punctuation">:</span> auto <span class="token comment"># MyBatisPlus默认有自己设置Id的策略（雪花算法），如果想要使用数据库的Id自增，需要在这里进行设置</span>
  <span class="token comment"># 开启MyBatisPlus的日志</span>
  <span class="token key atrule">configuration</span><span class="token punctuation">:</span>
    <span class="token key atrule">log-impl</span><span class="token punctuation">:</span> org.apache.ibatis.logging.stdout.StdOutImpl
</code></pre> </li><li> <p><strong>Step2</strong>：编码</p> <p>BookService：</p> <pre><code class="prism language-java"><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BookServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">BookService</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">BookDao</span> bookDao<span class="token punctuation">;</span>

    <span class="token comment">// 使用HashMap模拟缓存</span>
    <span class="token keyword">private</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">Book</span><span class="token punctuation">&gt;</span></span> cache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Book</span> <span class="token function">getById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token comment">//        return bookDao.selectById(id);</span>
        <span class="token comment">// 当“缓存”中有数据就不用再去查数据库库了</span>
        <span class="token class-name">Book</span> book <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>book <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">Book</span> queryBook <span class="token operator">=</span> bookDao<span class="token punctuation">.</span><span class="token function">selectById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
            cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> queryBook<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <p>其它，略……详情请参考Gitee或Github仓库</p> </li><li> <p><strong>Step3</strong>：测试</p> <p><img src="https://images2.imgbox.com/6f/ab/zib3fCRV_o.png" alt="image-20230102083244959"></p> <p><img src="https://images2.imgbox.com/97/82/Nlo4IcGZ_o.png" alt="image-20230102083343712"></p> </li></ul> 
<p><font size="4">体验二</font>：使用SpringBoot内置的缓存，临时存储手机验证码</p> 
<ul><li> <p><strong>Step1</strong>：搭建环境</p> <p>上同，略……</p> </li><li> <p><strong>Step2</strong>：编码</p> <p>1）SmCodeServiceImpl：</p> <pre><code class="prism language-java"><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MsgServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">MsgService</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> cache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">String</span> telephone<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 取电话号码后六位，作为验证码</span>
        <span class="token class-name">String</span> code <span class="token operator">=</span> telephone<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>telephone<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>telephone<span class="token punctuation">,</span> code<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> code<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">check</span><span class="token punctuation">(</span><span class="token class-name">String</span> telephone<span class="token punctuation">,</span> <span class="token class-name">String</span> code<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">String</span> queryCode <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>telephone<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 判断用户输入的验证码和之前得到的验证码是否相同</span>
        <span class="token keyword">return</span> code<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>queryCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <p>2）MsgController：</p> <pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>hhxy<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>hhxy<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">SMCode</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>hhxy<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">SMCodeService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author ghp
 * @date 2023/1/2
 * @title
 * @description
 */</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/sms"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SMCodeController</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">SMCodeService</span> smCodeService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"{tel}"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getCode</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"tel"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> telephone<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">String</span> code <span class="token operator">=</span> smCodeService<span class="token punctuation">.</span><span class="token function">sendCodeToSM</span><span class="token punctuation">(</span>telephone<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> code<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@PostMapping</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">checkCode</span><span class="token punctuation">(</span><span class="token class-name">SMCode</span> smCode<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> smCodeService<span class="token punctuation">.</span><span class="token function">checkCode</span><span class="token punctuation">(</span>smCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> </li><li> <p><strong>Step3</strong>：测试</p> <p><img src="https://images2.imgbox.com/ce/7d/fyyu4oCV_o.png" alt="image-20230102083608162"></p> <p><img src="https://images2.imgbox.com/92/23/uIMAeUBw_o.png" alt="image-20230102083625183"></p> </li></ul> 
<h5><a id="512__1302"></a>5.1.2 内置缓存解决方案</h5> 
<blockquote> 
 <p>SpringBoot技术提供有内置的缓存解决方案，可以帮助开发者快速开启缓存技术，并使用缓存技术进行数据的快速操作，例如读取缓存数据和写入数据到缓存。</p> 
</blockquote> 
<table><thead><tr><th>注解</th><th>说明</th></tr></thead><tbody><tr><td><code>@EnableCaching</code></td><td>开启缓存注解功能</td></tr><tr><td><code>@Cacheable</code></td><td>在方法中执行前，Spring先查看缓存中是否有数据，如果有数据，则直接返回缓存数据；如果没有数据，则将方法返回值存储到缓存中</td></tr><tr><td><code>@CachePut</code></td><td>将方法的返回值放到缓存中</td></tr><tr><td><code>@CacheEvict</code></td><td>将一条或多条数据从缓存中删除</td></tr></tbody></table> 
<ul><li>condition：用于设置条件，满足条件时才缓存数据（没有result对象）</li><li>unless：满足条件，不缓存</li></ul> 
<p><font size="4">实例</font>：</p> 
<blockquote> 
 <p>使用5.1.1中体验一的例子，将它改造成使用SpringBoot内置的缓存技术</p> 
</blockquote> 
<ul><li> <p><strong>Step1</strong>：搭建环境</p> <p>1）导入依赖</p> <pre><code class="prism language-xml">        <span class="token comment">&lt;!--cache对应的starter--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-cache<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <p>2）编写配置文件……</p> </li><li> <p><strong>Step2</strong>：开启缓存</p> <p>在SpringBoot程序的入口类上加上一个<code>@EnableCaching</code>注解，告诉SpringBoot开启缓存</p> </li><li> <p><strong>Step3</strong>：编写</p> <pre><code class="prism language-java"><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BookServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">BookService</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">BookDao</span> bookDao<span class="token punctuation">;</span>

    <span class="token comment">// 使用SpringBoot内置的缓存策略</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token annotation punctuation">@Cacheable</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"cacheSpace"</span><span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token string">"#id"</span><span class="token punctuation">)</span>  <span class="token comment">// SpEL表达式，或者写#p0，表示第1个参数</span>
    <span class="token keyword">public</span> <span class="token class-name">Book</span> <span class="token function">getById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> bookDao<span class="token punctuation">.</span><span class="token function">selectById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>
</code></pre> <p>添加<code>@Cacheable</code>注解以后，vlaue用于设置缓存空间，缓存数据以key-value的形式存储到缓存空间中，而通过key可以设置key，这里我将key设置为查询数据的id（<mark>设置的key要保障唯一性，一般都是以id为key</mark>），这样后面查询重复数据时，就不需要再去查询数据库了，大大节约了时间、资源</p> </li></ul> 
<h5><a id="513_Ehcache_1359"></a>5.1.3 整合Ehcache</h5> 
<blockquote> 
 <p>常见的缓存技术：Generic、JCacheEhcache、Hazelcast、Infinispan、Couchbase、Redis、Caffeine、Simple（默认）、Memcached……共9种，前8种都有SpringBoot官方提供的整合策略，而最后一种SpringBoot官方没有提供整合策略，但是也很常见，而Simple是SpringBoot默认提供的缓存策略，<strong>5.1.2</strong>中使用的就是就是Simple</p> 
</blockquote> 
<ul><li> <p><strong>Step1</strong>：导入依赖</p> <pre><code class="prism language-xml">        <span class="token comment">&lt;!--Ehcache的依赖--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>net.sf.ehcache<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>ehcache<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <p>PS：相较于使用SpringBoot内置的缓存，我们使用Ehcache就是多加一个配置文件</p> </li><li> <p><strong>Step2</strong>：开启缓存</p> <p>在SpringBoot程序的入口类上加上一个<code>@EnableCaching</code>注解，告诉SpringBoot开启缓存</p> </li><li> <p><strong>Step3</strong>：添加Ehcache的配置文件</p> <p>1）application.yml</p> <pre><code class="prism language-yaml"><span class="token comment"># Spring相关配置</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">druid</span><span class="token punctuation">:</span>
      <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
      <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/springboot_study<span class="token punctuation">?</span>serverTimezone=UTC
      <span class="token key atrule">username</span><span class="token punctuation">:</span> root
      <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">32345678</span>
  <span class="token comment"># 告诉SpringBoot使用ehcache</span>
  <span class="token key atrule">cache</span><span class="token punctuation">:</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> ehcache
</code></pre> <p><mark>注意</mark>：当你的ehcache配置文件不是ehcache.xml，则需要使用对应的文件名，比如你改成my-ehcache.xml，那么你的就需要设置成</p> <pre><code class="prism language-yaml">  <span class="token key atrule">cache</span><span class="token punctuation">:</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> ehcache
    <span class="token key atrule">ehcache</span><span class="token punctuation">:</span>
    	<span class="token key atrule">config</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>ehcache.xml
</code></pre> <p>2）ehcache.xml：</p> <pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ehcache</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>noNamespaceSchemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://ehcache.org/ehcache.xsd<span class="token punctuation">"</span></span>
         <span class="token attr-name">updateCheck</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>diskStore</span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>D:\ehcache<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

    <span class="token comment">&lt;!--默认缓存策略 --&gt;</span>
    <span class="token comment">&lt;!-- external：是否永久存在，设置为true则不会被清除，此时与timeout冲突，通常设置为false--&gt;</span>
    <span class="token comment">&lt;!-- diskPersistent：是否启用磁盘持久化--&gt;</span>
    <span class="token comment">&lt;!-- maxElementsInMemory：最大缓存数量--&gt;</span>
    <span class="token comment">&lt;!-- overflowToDisk：超过最大缓存数量是否持久化到磁盘--&gt;</span>
    <span class="token comment">&lt;!-- timeToIdleSeconds：最大不活动间隔，设置过长缓存容易溢出，设置过短无效果，可用于记录时效性数据，例如验证码--&gt;</span>
    <span class="token comment">&lt;!-- timeToLiveSeconds：最大存活时间--&gt;</span>
    <span class="token comment">&lt;!-- memoryStoreEvictionPolicy：缓存清除策略--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>defaultCache</span>
        <span class="token attr-name">eternal</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span>
        <span class="token attr-name">diskPersistent</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span>
        <span class="token attr-name">maxElementsInMemory</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1000<span class="token punctuation">"</span></span>
        <span class="token attr-name">overflowToDisk</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span>
        <span class="token attr-name">timeToIdleSeconds</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>60<span class="token punctuation">"</span></span>
        <span class="token attr-name">timeToLiveSeconds</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>60<span class="token punctuation">"</span></span>
        <span class="token attr-name">memoryStoreEvictionPolicy</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>LRU<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

    <span class="token comment">&lt;!--注意：在service层中cache注解配置的缓存空间要和这里的name保持一致--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cache</span>
        <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>smCode<span class="token punctuation">"</span></span>
        <span class="token attr-name">eternal</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span>
        <span class="token attr-name">diskPersistent</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span>
        <span class="token attr-name">maxElementsInMemory</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1000<span class="token punctuation">"</span></span>
        <span class="token attr-name">overflowToDisk</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span>
        <span class="token attr-name">timeToIdleSeconds</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>10<span class="token punctuation">"</span></span>
        <span class="token attr-name">timeToLiveSeconds</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>10<span class="token punctuation">"</span></span>
        <span class="token attr-name">memoryStoreEvictionPolicy</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>LRU<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ehcache</span><span class="token punctuation">&gt;</span></span>
</code></pre> </li><li> <p><strong>Step4</strong>：测试</p> <p>和内置的缓存使用方式一样，主要通过：<code>@Cacheable</code>和<code>@CachePut</code>两个注解</p> </li></ul> 
<h5><a id="514_Redis_1450"></a>5.1.4 整合Redis（缓存）</h5> 
<ul><li> <p><strong>Step1</strong>：导入依赖</p> <pre><code class="prism language-xml">        <span class="token comment">&lt;!--redis缓存的依赖--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> </li><li> <p><strong>Step2</strong>：编写配置文件</p> <pre><code class="prism language-yaml">  <span class="token comment"># redis相关配置</span>
  <span class="token key atrule">cache</span><span class="token punctuation">:</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> redis
    <span class="token key atrule">redis</span><span class="token punctuation">:</span>
      <span class="token key atrule">user-key-prifix</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
      <span class="token key atrule">key-prifix</span><span class="token punctuation">:</span> sms_
      <span class="token key atrule">cache-null-values</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
      <span class="token key atrule">time-to-live</span><span class="token punctuation">:</span> 10s
  <span class="token key atrule">redis</span><span class="token punctuation">:</span>
    <span class="token key atrule">host</span><span class="token punctuation">:</span> 192.168.88.130
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">6379</span>
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">32345678</span>
</code></pre> </li><li> <p><strong>Step3</strong>：编码测试</p> <p>略……，和前面的一模一样，这足以说明SpringBoot的厉害之处，它将各种各样的缓存都实现了一个同一的接口，换一个缓存只需要修改一下配置文件的参数，导入对应缓存的依赖就可以了</p> </li></ul> 
<h5><a id="515_Memcached_1483"></a>5.1.5 整合Memcached</h5> 
<blockquote> 
 <p>这一节，我就直接跳过了，等以后要用的时候再来学习一下，就算现在学了，很久不用也很容易就忘了</p> 
</blockquote> 
<ul><li> <p><strong>Step1</strong>：下载</p> <p>windows版安装包下载地址：https://www.runoob.com/memcached/window-install-memcached.html</p> </li><li> <p><strong>Step2</strong>：安装</p> </li></ul> 
<p>自行脑补，略……</p> 
<h5><a id="516_JetCache_1495"></a>5.1.6 整合JetCache</h5> 
<blockquote> 
 <p>  目前我们使用的缓存都是要么A要么B，能不能AB一起用呢？这一节就解决这个问题。springboot针对缓存的整合仅仅停留在用缓存上面，如果缓存自身不支持同时支持AB一起用，springboot也没办法，所以要想解决AB缓存一起用的问题，就必须找一款缓存能够支持AB两种缓存一起用，有这种缓存吗？还真有，阿里出品，jetcache。</p> 
 <p>  jetcache严格意义上来说，并不是一个缓存解决方案，只能说他算是一个缓存框架，然后把别的缓存放到jetcache中管理，这样就可以支持AB缓存一起用了。并且jetcache参考了springboot整合缓存的思想，整体技术使用方式和springboot的缓存解决方案思想非常类似。下面咱们就先把jetcache用起来，然后再说它里面的一些小的功能。JetCache对SpringCache进行了封装，在原有功能的基础上实现了多级缓存、缓存统计、自动刷新、异步调用、数据报表等功能。</p> 
 <p>  做之前要先明确一下，jetcache并不是随便拿两个缓存都能拼到一起去的。目前jetcache支持的缓存方案本地缓存支持两种，远程缓存支持两种，分别如下：</p> 
 <ul><li>本地缓存（Local） 
   <ul><li>LinkedHashMap</li><li>Caffeine</li></ul> </li><li>远程缓存（Remote） 
   <ul><li>Redis</li><li>Tair</li></ul> </li></ul> 
 <p>其实也有人问我，为什么jetcache只支持2+2这么4款缓存呢？阿里研发这个技术其实主要是为了满足自身的使用需要。最初肯定只有1+1种，逐步变化成2+2种。下面就以LinkedHashMap+Redis的方案实现本地与远程缓存方案同时使用。</p> 
</blockquote> 
<h6><a id="5161__1512"></a>5.1.6.1 远程方案</h6> 
<ul><li> <p><strong>Step1</strong>：导入依赖</p> <pre><code class="prism language-xml">        <span class="token comment">&lt;!--lombok依赖--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token comment">&lt;!--mysql驱动--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token comment">&lt;!--druid对应的starter--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>druid-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.2.6<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token comment">&lt;!--MybatisPlus对应的starter--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.baomidou<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-plus-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.4.3.4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token comment">&lt;!--SpringMVC对应的starter--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token comment">&lt;!--Junit对应的starter--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token comment">&lt;!--JetCache对应的starter--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alicp.jetcache<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jetcache-starter-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.6.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token comment">&lt;!--热部署依赖--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-devtools<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> </li><li> <p><strong>Step2</strong>：启用JetCache</p> <p>在SpringBoot的启动类上加上<code>@EnableCreateCacheAnnotation</code>注解，告诉SpringBoot使用JetCache</p> </li><li> <p><strong>Step3</strong>：编写配置文件</p> <pre><code class="prism language-yaml"><span class="token key atrule">jetcache</span><span class="token punctuation">:</span>
  <span class="token key atrule">remote</span><span class="token punctuation">:</span>
    <span class="token key atrule">default</span><span class="token punctuation">:</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> redis
      <span class="token key atrule">host</span><span class="token punctuation">:</span> 192.168.88.130
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">6379</span>
      <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">32345678</span>
      <span class="token key atrule">poolConfig</span><span class="token punctuation">:</span>
        <span class="token key atrule">maxTotal</span><span class="token punctuation">:</span> <span class="token number">50</span>
</code></pre> </li><li> <p><strong>Step4</strong>：编码</p> <pre><code class="prism language-java"><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SMCodeServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">SMCodeService</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">CodeUtil</span> codeUtil<span class="token punctuation">;</span>

    <span class="token comment">// 创建JetCache对象</span>
    <span class="token annotation punctuation">@CreateCache</span><span class="token punctuation">(</span>area <span class="token operator">=</span> <span class="token string">"default"</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"jetCacheSpace_"</span><span class="token punctuation">,</span> expire <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span> timeUnit <span class="token operator">=</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span>
    <span class="token comment">// area用于设置缓存空间，默认是default，这个要与yml配置文件对应上，</span>
    <span class="token comment">// expire用于设置缓存有效期，默认单位是秒，timeUnit设置expire的单位</span>
    <span class="token keyword">private</span> <span class="token class-name">Cache</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> jetCache<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 发送验证码
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">sendCodeToSM</span><span class="token punctuation">(</span><span class="token class-name">String</span> telephone<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">String</span> code <span class="token operator">=</span> <span class="token class-name">CodeUtil</span><span class="token punctuation">.</span><span class="token function">generator</span><span class="token punctuation">(</span>telephone<span class="token punctuation">)</span><span class="token punctuation">;</span>
        jetCache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>telephone<span class="token punctuation">,</span> code<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> code<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 检查验证码
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">checkCode</span><span class="token punctuation">(</span><span class="token class-name">SMCode</span> smCode<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">String</span> code <span class="token operator">=</span> smCode<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> cacheCode <span class="token operator">=</span> jetCache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>smCode<span class="token punctuation">.</span><span class="token function">getTelephone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> cacheCode<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <p>Controller的代码参考5.1.1</p> </li><li> <p><strong>Step5</strong>：测试</p> <img src="https://images2.imgbox.com/c5/ca/2vz9BQMx_o.png" alt="image-20230103092204951"> <p>可以在redis中查看刚刚存进去的值，它是：<code>area_namevlaue</code>的形式：（一般name都是字符串加上下划线或者冒号，用于区分value）</p> <p><img src="https://images2.imgbox.com/06/50/K4zXDQ4g_o.png" alt="image-20230103092141269"></p> </li></ul> 
<blockquote> 
 <p><font color="pink">温馨提示：</font>SprintBoot版本使用5.4.2或者更低的版本，高版本已经禁止了循环依赖</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/bb/12/Fw9emgC6_o.png" alt="image-20230102220904456"></p> 
<h6><a id="5162__1639"></a>5.1.6.2 本地方案</h6> 
<ul><li> <p><strong>Step1</strong>：导入依赖</p> <p>上同，略……</p> </li><li> <p><strong>Step2</strong>：启动jetcache</p> </li><li> <p><strong>Step3</strong>：编写配置文件</p> <pre><code class="prism language-yaml"><span class="token key atrule">jetcache</span><span class="token punctuation">:</span>
  <span class="token key atrule">local</span><span class="token punctuation">:</span>
    <span class="token key atrule">localDefault</span><span class="token punctuation">:</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> linkedhashmap
      <span class="token key atrule">keyConvertor</span><span class="token punctuation">:</span> fastjson
</code></pre> </li><li> <p><strong>Step4</strong>：编码</p> <pre><code class="prism language-java">    <span class="token annotation punctuation">@CreateCache</span><span class="token punctuation">(</span>area <span class="token operator">=</span> <span class="token string">"localDefault"</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"jetCacheSpace_"</span><span class="token punctuation">,</span> expire <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span> timeUnit <span class="token operator">=</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">,</span> cacheType <span class="token operator">=</span> <span class="token class-name">CacheType</span><span class="token punctuation">.</span><span class="token constant">LOCAL</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Cache</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> jetCache<span class="token punctuation">;</span>
</code></pre> <p>cacheType用于指定使用本地缓存还是使用远程缓存，默认是使用远程缓存</p> </li><li> <p><strong>Step5</strong>：测试</p> <p><img src="https://images2.imgbox.com/f1/07/ob6iYMBH_o.png" alt="image-20230103094100729"></p> <p>可以发现程序运行了，但是在redis中并没有找到与之对应的值，这是由于使用了本地缓存，数据存储在LinkedHashMap中</p> <p><img src="https://images2.imgbox.com/a5/e0/5jHtiIHD_o.png" alt="image-20230103094150938"></p> </li></ul> 
<h6><a id="5163__1674"></a>5.1.6.3 远程+本地</h6> 
<pre><code class="prism language-yaml"><span class="token key atrule">jetcache</span><span class="token punctuation">:</span>
  <span class="token key atrule">local</span><span class="token punctuation">:</span>
    <span class="token key atrule">default</span><span class="token punctuation">:</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> linkedhashmap
      <span class="token key atrule">keyConvertor</span><span class="token punctuation">:</span> fastjson
  <span class="token key atrule">remote</span><span class="token punctuation">:</span>
    <span class="token key atrule">default</span><span class="token punctuation">:</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> redis
      <span class="token key atrule">host</span><span class="token punctuation">:</span> localhost
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">6379</span>
      <span class="token key atrule">poolConfig</span><span class="token punctuation">:</span>
        <span class="token key atrule">maxTotal</span><span class="token punctuation">:</span> <span class="token number">50</span>
    <span class="token key atrule">sms</span><span class="token punctuation">:</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> redis
      <span class="token key atrule">host</span><span class="token punctuation">:</span> localhost
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">6379</span>
      <span class="token key atrule">poolConfig</span><span class="token punctuation">:</span>
        <span class="token key atrule">maxTotal</span><span class="token punctuation">:</span> <span class="token number">50</span>
</code></pre> 
<p>配置cacheType为BOTH即则本地缓存与远程缓存同时使用</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SMSCodeServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">SMSCodeService</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@CreateCache</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"jetCache_"</span><span class="token punctuation">,</span>expire <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">,</span>timeUnit <span class="token operator">=</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">,</span>cacheType <span class="token operator">=</span> <span class="token class-name">CacheType</span><span class="token punctuation">.</span><span class="token constant">BOTH</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Cache</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span> <span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> jetCache<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><font size="4"><strong>JetCache相关配置</strong></font></p> 
<table><thead><tr><th>属性</th><th>默认值</th><th>说明</th></tr></thead><tbody><tr><td><code>jetcache.statIntervalMinutes</code></td><td>0</td><td>统计间隔，0表示不统计</td></tr><tr><td><code>jetcache.hiddenPackages</code></td><td>无</td><td>自动生成name时，隐藏指定的包名前缀</td></tr><tr><td>`jetcache.[local</td><td>remote].${area}.type`</td><td>无</td></tr><tr><td>`jetcache.[local</td><td>remote].${area}.keyConvertor`</td><td>无</td></tr><tr><td>`jetcache.[local</td><td>remote].${area}.valueEncoder`</td><td>java</td></tr><tr><td>`jetcache.[local</td><td>remote].${area}.valueDecoder`</td><td>java</td></tr><tr><td>`jetcache.[local</td><td>remote].${area}.limit`</td><td>100</td></tr><tr><td>`jetcache.[local</td><td>remote].${area}.expireAfterWriteInMillis`</td><td>无穷大</td></tr><tr><td><code>jetcache.local.${area}.expireAfterAccessInMillis</code></td><td>0</td><td>仅local类型的缓存有效，毫秒单位，最大不活动间隔</td></tr></tbody></table> 
<h6><a id="5164__1721"></a>5.1.6.4 方法缓存</h6> 
<blockquote> 
 <p>所谓的方法缓存，就是将方法返回的数据保存到缓存中，然后下次调用方法，会先从缓存中查询</p> 
</blockquote> 
<ul><li> <p><strong>Step1</strong>：导入依赖</p> <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alicp.jetcache<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jetcache-starter-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.6.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> </li><li> <p><strong>Step2</strong>：开启方法缓存</p> <pre><code class="prism language-java"><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token comment">// 启用jetcache</span>
<span class="token annotation punctuation">@EnableCreateCacheAnnotation</span>
<span class="token comment">// 开启方法缓存</span>
<span class="token annotation punctuation">@EnableMethodCache</span><span class="token punctuation">(</span>basePackages <span class="token operator">=</span> <span class="token string">"com.hhxy"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Springboot14JetcacheApplication</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Springboot14JetcacheApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> </li><li> <p><strong>Step3</strong>：编写配置文件</p> <pre><code class="prism language-yaml"><span class="token key atrule">jetcache</span><span class="token punctuation">:</span>
  <span class="token key atrule">remote</span><span class="token punctuation">:</span>
    <span class="token key atrule">default</span><span class="token punctuation">:</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> redis
      <span class="token key atrule">host</span><span class="token punctuation">:</span> 192.168.88.130
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">6379</span>
      <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">32345678</span>
      <span class="token key atrule">poolConfig</span><span class="token punctuation">:</span>
        <span class="token key atrule">maxTotal</span><span class="token punctuation">:</span> <span class="token number">50</span> <span class="token comment">#最大连接数</span>
  <span class="token key atrule">local</span><span class="token punctuation">:</span>
    <span class="token key atrule">localDefault</span><span class="token punctuation">:</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> linkedhashmap
      <span class="token key atrule">keyConvertor</span><span class="token punctuation">:</span> fastjson
</code></pre> <p>==注意：==这里一定要记得给remote方案配<code>keyConvertor: fastjson</code>，否则会报<strong>空指针异常</strong>，这是由于Redis是不支持保存Object</p> </li><li> <p><strong>Step4</strong>：编码</p> 
  <blockquote> 
   <p>  由于redis缓存中不支持保存对象，因此需要对redis设置当Object类型数据进入到redis中时如何进行类型转换。需要配置keyConvertor表示key的类型转换方式，同时标注value的转换类型方式，值进入redis时是java类型，标注valueEncode为java，值从redis中读取时转换成java，标注valueDecode为java。</p> 
   <p><mark>注意</mark>：为了实现Object类型的值进出redis，需要保障进出redis的Object类型的数据必须实现序列化接口，否则会报<code>NotSerializableException</code>。</p> 
  </blockquote> <p>1）BookService：</p> <pre><code class="prism language-java">    <span class="token annotation punctuation">@Override</span>
    <span class="token annotation punctuation">@Cached</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"book_"</span><span class="token punctuation">,</span>key<span class="token operator">=</span><span class="token string">"#id"</span><span class="token punctuation">,</span>expire <span class="token operator">=</span> <span class="token number">3600</span><span class="token punctuation">,</span>cacheType <span class="token operator">=</span> <span class="token class-name">CacheType</span><span class="token punctuation">.</span><span class="token constant">REMOTE</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Book</span> <span class="token function">getById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> bookDao<span class="token punctuation">.</span><span class="token function">selectById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <p>2）BookController：</p> <pre><code class="prism language-java"><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/books"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BookController</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">BookService</span> bookService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"{id}"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Cached</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"book"</span><span class="token punctuation">,</span> key <span class="token operator">=</span> <span class="token string">"#id"</span><span class="token punctuation">,</span> expire <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Book</span> <span class="token function">getById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token keyword">int</span> id<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> bookService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@Override</span>
    <span class="token comment">// 更新缓存中的数据</span>
    <span class="token annotation punctuation">@CacheUpdate</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"book_"</span><span class="token punctuation">,</span> key <span class="token operator">=</span> <span class="token string">"#book.id"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"#book"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">Book</span> book<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> bookDao<span class="token punctuation">.</span><span class="token function">updateById</span><span class="token punctuation">(</span>book<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token comment">// 删除缓存中的数据</span>
    <span class="token annotation punctuation">@CacheInvalidate</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"book_"</span><span class="token punctuation">,</span> key <span class="token operator">=</span> <span class="token string">"#id"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> bookDao<span class="token punctuation">.</span><span class="token function">deleteById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> </li><li> <p><strong>Step5</strong>：测试</p> <p>略……</p> </li></ul> 
<h5><a id="517_J2Cache_1823"></a>5.1.7 整合J2Cache</h5> 
<blockquote> 
 <p>jetcache可以在限定范围内构建多级缓存，但是灵活性不足，不能随意搭配缓存，本节介绍一种可以随意搭配缓存解决方案的缓存整合框架，j2cache</p> 
</blockquote> 
<p><font size="4">实例</font>：</p> 
<blockquote> 
 <p>使用J2Cache来创建EhCache+Redis的搭配</p> 
</blockquote> 
<ul><li> <p><strong>Step1</strong>：导入依赖</p> <pre><code class="prism language-xml">        <span class="token comment">&lt;!--j2cache核心实现包--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>net.oschina.j2cache<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>j2cache-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.8.4-release<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token comment">&lt;!--j2cache对应的starter（包含了redis）--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>net.oschina.j2cache<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>j2cache-spring-boot2-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.8.0-release<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token comment">&lt;!--Ehcache依赖--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>net.sf.ehcache<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>ehcache<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> </li><li> <p><strong>Step2</strong>：编写配置文件</p> <p>ehcache.xml：</p> <pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ehcache</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>noNamespaceSchemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://ehcache.org/ehcache.xsd<span class="token punctuation">"</span></span>
         <span class="token attr-name">updateCheck</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>diskStore</span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>D:\ehcache<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

    <span class="token comment">&lt;!--默认缓存策略 --&gt;</span>
    <span class="token comment">&lt;!-- external：是否永久存在，设置为true则不会被清除，此时与timeout冲突，通常设置为false--&gt;</span>
    <span class="token comment">&lt;!-- diskPersistent：是否启用磁盘持久化--&gt;</span>
    <span class="token comment">&lt;!-- maxElementsInMemory：最大缓存数量--&gt;</span>
    <span class="token comment">&lt;!-- overflowToDisk：超过最大缓存数量是否持久化到磁盘--&gt;</span>
    <span class="token comment">&lt;!-- timeToIdleSeconds：最大不活动间隔，设置过长缓存容易溢出，设置过短无效果，可用于记录时效性数据，例如验证码--&gt;</span>
    <span class="token comment">&lt;!-- timeToLiveSeconds：最大存活时间--&gt;</span>
    <span class="token comment">&lt;!-- memoryStoreEvictionPolicy：缓存清除策略--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>defaultCache</span>
        <span class="token attr-name">eternal</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span>
        <span class="token attr-name">diskPersistent</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span>
        <span class="token attr-name">maxElementsInMemory</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1000<span class="token punctuation">"</span></span>
        <span class="token attr-name">overflowToDisk</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span>
        <span class="token attr-name">timeToIdleSeconds</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>10<span class="token punctuation">"</span></span>
        <span class="token attr-name">timeToLiveSeconds</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>10<span class="token punctuation">"</span></span>
        <span class="token attr-name">memoryStoreEvictionPolicy</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>LRU<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ehcache</span><span class="token punctuation">&gt;</span></span>
</code></pre> <p>j2cache.properties：</p> <pre><code class="prism language-properties"># 1级缓存
j2cache.L1.provider_class = ehcache
ehcache.configXml = ehcache.xml

# 2级缓存
j2cache.L2.provider_class = net.oschina.j2cache.cache.support.redis.SpringRedisProvider
j2cache.L2.config_section = redis
redis.hosts = 192.168.88.130:6379
redis.password = 32345678
redis.mode = single

# 1级缓存中的数据如何到达二级缓存
j2cache.broadcast = net.oschina.j2cache.cache.support.redis.SpringRedisPubSubPolicy
</code></pre> <p>application.yml：</p> <pre><code class="prism language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>

<span class="token key atrule">j2cache</span><span class="token punctuation">:</span>
  <span class="token key atrule">config-location</span><span class="token punctuation">:</span> j2cache.properties
</code></pre> </li><li> <p><strong>Step3</strong>：编码测试</p> <p>SMSCodeServiceImpl：</p> <pre><code class="prism language-java"><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SMSCodeServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">SMSCodeService</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">CodeUtils</span> codeUtils<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">CacheChannel</span> cacheChannel<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">sendCodeToSMS</span><span class="token punctuation">(</span><span class="token class-name">String</span> tele<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">String</span> code <span class="token operator">=</span> codeUtils<span class="token punctuation">.</span><span class="token function">generator</span><span class="token punctuation">(</span>tele<span class="token punctuation">)</span><span class="token punctuation">;</span>
        cacheChannel<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"sms"</span><span class="token punctuation">,</span>tele<span class="token punctuation">,</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> code<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">checkCode</span><span class="token punctuation">(</span><span class="token class-name">SMSCode</span> smsCode<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">String</span> code <span class="token operator">=</span> cacheChannel<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"sms"</span><span class="token punctuation">,</span>smsCode<span class="token punctuation">.</span><span class="token function">getTele</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">asString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> smsCode<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> </li><li> <p><strong>Step4</strong>：测试</p> <p><img src="https://images2.imgbox.com/f4/53/vFMCIM4U_o.png" alt="image-20230103124110102"></p> </li></ul> 
<h4><a id="52__1948"></a>5.2 任务</h4> 
<blockquote> 
 <p>SpringBoot整合第三方技术第二部分我们来说说任务系统，其实这里说的任务系统指的是定时任务。定时任务是企业级开发中必不可少的组成部分，诸如长周期业务数据的计算，例如年度报表，诸如系统脏数据的处理，再比如系统性能监控报告，还有抢购类活动的商品上架，这些都离不开定时任务。本节将介绍两种不同的定时任务技术。</p> 
</blockquote> 
<h5><a id="521_Quartz_1952"></a>5.2.1 整合Quartz</h5> 
<blockquote> 
 <p>Quartz是一个定时任务框架，它的配置比较复杂， SpringBoot对Quartz进行了整合，通过设置默认配置，一定程度降低了Quartz的配置。关于Quartz具体可以参考：<a href="https://www.w3cschool.cn/quartz_doc/" rel="nofollow">Quartz官方文档_w3cschool</a></p> 
</blockquote> 
<p>Quartz基础概念：</p> 
<ul><li>工作（Job）：用于定义具体执行的工作</li><li>工作明细（JobDetail）：用于描述定时工作相关的信息</li><li>触发器（Trigger）：描述了工作明细与调度器的对应关系</li><li>调度器（Scheduler）：用于描述触发工作的执行规则，通常使用cron表达式定义规则</li></ul> 
<p>单说就是你定时干什么事情，这就是工作，工作不可能就是一个简单的方法，还要设置一些明细信息。工作啥时候执行，设置一个调度器，可以简单理解成设置一个工作执行的时间。工作和调度都是独立定义的，它们两个怎么配合到一起呢？用触发器。完了，就这么多。下面开始springboot整合Quartz。</p> 
<p><font size="4">示例</font>：</p> 
<ul><li> <p><strong>Step1</strong>：导入依赖</p> <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-quartz<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> </li><li> <p><strong>Step2</strong>：创建工作</p> <pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyQuartz</span> <span class="token keyword">extends</span> <span class="token class-name">QuartzJobBean</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">executeInternal</span><span class="token punctuation">(</span><span class="token class-name">JobExecutionContext</span> context<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JobExecutionException</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"任务开始执行..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> </li><li> <p><strong>Step3</strong>：编写配置类，主要是编写工作明细，绑定触发器</p> <pre><code class="prism language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">QuartzConfig</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">/**
     * 设置工作明细
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">JobDetail</span> <span class="token function">printJobDetail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 绑定具体的工作（storeDurably持久化，防止工作被清理）</span>
        <span class="token keyword">return</span> <span class="token class-name">JobBuilder</span><span class="token punctuation">.</span><span class="token function">newJob</span><span class="token punctuation">(</span><span class="token class-name">MyQuartz</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">storeDurably</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 设置触发器
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Trigger</span> <span class="token function">printJobTrigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">//0点0分0秒，0日0月0星期</span>
        <span class="token class-name">ScheduleBuilder</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Trigger</span><span class="token punctuation">&gt;</span></span> scheduleBuilder <span class="token operator">=</span> <span class="token class-name">CronScheduleBuilder</span><span class="token punctuation">.</span><span class="token function">cronSchedule</span><span class="token punctuation">(</span><span class="token string">"0/2 * * * * ?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//5秒执行一次</span>
        <span class="token comment">// 绑定对应的工作明细</span>
        <span class="token keyword">return</span> <span class="token class-name">TriggerBuilder</span><span class="token punctuation">.</span><span class="token function">newTrigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forJob</span><span class="token punctuation">(</span><span class="token function">printJobDetail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withSchedule</span><span class="token punctuation">(</span>scheduleBuilder<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> </li></ul> 
<h5><a id="522_Spring_Task_2015"></a>5.2.2 Spring Task</h5> 
<blockquote> 
 <p>前面我们使用了SpringBoot整合Quartz，但是发现Quartz还是比较复杂，于是Spring Boot就提供了Spring Task来用来解决定时任务（不得不说，SpringBoot真的太香了）</p> 
</blockquote> 
<ul><li> <p><strong>Step1</strong>：开启定时任务</p> <p>在SpringBoot程序的启动类上加上<code>@EnableScheduling</code>注解</p> </li><li> <p><strong>Step2</strong>：编写定时任务</p> <pre><code class="prism language-java"><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyJob</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Scheduled</span><span class="token punctuation">(</span>cron <span class="token operator">=</span> <span class="token string">"0/2 * * * * ?"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">printJob</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"使用spring task执行定时任务"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> </li></ul> 
<p>Spring Task相关配置：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">task</span><span class="token punctuation">:</span>
   	<span class="token key atrule">scheduling</span><span class="token punctuation">:</span>
      <span class="token key atrule">pool</span><span class="token punctuation">:</span>
       	<span class="token key atrule">size</span><span class="token punctuation">:</span> <span class="token number">1</span>							<span class="token comment"># 任务调度线程池大小 默认 1</span>
      <span class="token key atrule">thread-name-prefix</span><span class="token punctuation">:</span> ssm_      	<span class="token comment"># 调度线程名称前缀 默认 scheduling-      </span>
        <span class="token key atrule">shutdown</span><span class="token punctuation">:</span>
          <span class="token key atrule">await-termination</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>		<span class="token comment"># 线程池关闭时等待所有任务完成</span>
          <span class="token key atrule">await-termination-period</span><span class="token punctuation">:</span> 10s	<span class="token comment"># 调度线程关闭前最大等待时间，确保最后一定关闭</span>
</code></pre> 
<h4><a id="53__2050"></a>5.3 邮件</h4> 
<p>邮件相关基础概念：</p> 
<ul><li>SMTP（Simple Mail Transfer Protocol）：简单邮件传输协议，用于<strong>发送</strong>电子邮件的传输协议</li><li>POP3（Post Office Protocol - Version 3）：用于<strong>接收</strong>电子邮件的标准协议</li><li>IMAP（Internet Mail Access Protocol）：互联网消息协议，是POP3的替代协议</li></ul> 
<p>简单说就是SMPT是发邮件的标准，POP3是收邮件的标准，IMAP是对POP3的升级</p> 
<p><strong>备注</strong>：下面的示例使用qq邮箱，需要先开启smtp服务</p> 
<p><img src="https://images2.imgbox.com/10/df/wpbLyE3a_o.png" alt="image-20230103134724671"></p> 
<p><font size="4">示例一</font>：</p> 
<ul><li> <p><strong>Step1</strong>：导入依赖</p> <pre><code class="prism language-xml">        <span class="token comment">&lt;!--javamail对应的starter--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-mail<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> </li><li> <p><strong>Step2</strong>：编写配置文件</p> <p>application.yml</p> <pre><code class="prism language-java">spring<span class="token operator">:</span>
  mail<span class="token operator">:</span>
    host<span class="token operator">:</span> smtp<span class="token punctuation">.</span>qq<span class="token punctuation">.</span>com
    username<span class="token operator">:</span> <span class="token number">3254213612</span><span class="token annotation punctuation">@qq.com</span>
    password<span class="token operator">:</span> hnvluolizjmsdahi
</code></pre> </li><li> <p><strong>Ste3</strong>：发送邮件</p> <pre><code class="prism language-java"><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SendMailServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">SendMailService</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">JavaMailSender</span> javaMailSender<span class="token punctuation">;</span>

    <span class="token comment">// 发送人</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> from <span class="token operator">=</span> <span class="token string">"3254213612@qq.com"</span><span class="token punctuation">;</span>
    <span class="token comment">// 接收人</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token keyword">to</span> <span class="token operator">=</span> <span class="token string">"3254213612@qq.com"</span><span class="token punctuation">;</span>
    <span class="token comment">// 标题</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> subject <span class="token operator">=</span> <span class="token string">"测试邮件"</span><span class="token punctuation">;</span>
    <span class="token comment">// 正文</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> context <span class="token operator">=</span> <span class="token string">"测试使用Java发送邮件"</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendMail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">SimpleMailMessage</span> msg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleMailMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        msg<span class="token punctuation">.</span><span class="token function">setFrom</span><span class="token punctuation">(</span>from<span class="token operator">+</span><span class="token string">"(ghp)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        msg<span class="token punctuation">.</span><span class="token function">setTo</span><span class="token punctuation">(</span><span class="token keyword">to</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        msg<span class="token punctuation">.</span><span class="token function">setSubject</span><span class="token punctuation">(</span>subject<span class="token punctuation">)</span><span class="token punctuation">;</span>
        msg<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
        javaMailSender<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> </li><li> <p><strong>Step4</strong>：测试</p> <pre><code class="prism language-java"><span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SendMailServiceTest</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">SendMailService</span> sendMailService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSendMail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        sendMailService<span class="token punctuation">.</span><span class="token function">sendMail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <p><img src="https://images2.imgbox.com/b9/3d/aghLomWZ_o.png" alt="image-20230103141253801"></p> </li></ul> 
<p><font size="4">示例二：</font>发送复杂邮件</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>hhxy<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>hhxy<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">SendMailService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>mail<span class="token punctuation">.</span>javamail<span class="token punctuation">.</span></span><span class="token class-name">JavaMailSender</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>mail<span class="token punctuation">.</span>javamail<span class="token punctuation">.</span></span><span class="token class-name">MimeMessageHelper</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>mail<span class="token punctuation">.</span></span><span class="token class-name">MessagingException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>mail<span class="token punctuation">.</span>internet<span class="token punctuation">.</span></span><span class="token class-name">MimeMessage</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">File</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author ghp
 * @date 2023/1/3
 * @title
 * @description
 */</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SendMailServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">SendMailService</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">JavaMailSender</span> javaMailSender<span class="token punctuation">;</span>

    <span class="token comment">// 发送人</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> from <span class="token operator">=</span> <span class="token string">"3254213612@qq.com"</span><span class="token punctuation">;</span>
    <span class="token comment">// 接收人</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token keyword">to</span> <span class="token operator">=</span> <span class="token string">"3254213612@qq.com"</span><span class="token punctuation">;</span>
    <span class="token comment">// 标题</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> subject <span class="token operator">=</span> <span class="token string">"测试邮件"</span><span class="token punctuation">;</span>
    <span class="token comment">// 正文</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> context <span class="token operator">=</span> <span class="token string">"&lt;a href='https://www.baidu.com'&gt;点击跳转到百度&lt;/a&gt;"</span> <span class="token operator">+</span>
            <span class="token string">"&lt;img src='https://tse2-mm.cn.bing.net/th/id/OIP-C.0DHXK9N4Ogrz2MWvzNOJfAHaNL?w=182&amp;h=324&amp;c=7&amp;r=0&amp;o=5&amp;dpr=1.3&amp;pid=1.7'/&gt;"</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendMail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 发送复杂（多部件）邮件</span>
        <span class="token class-name">MimeMessage</span> msg <span class="token operator">=</span> javaMailSender<span class="token punctuation">.</span><span class="token function">createMimeMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// true表示要发送附件</span>
            <span class="token class-name">MimeMessageHelper</span> helper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MimeMessageHelper</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            helper<span class="token punctuation">.</span><span class="token function">setFrom</span><span class="token punctuation">(</span>from<span class="token operator">+</span><span class="token string">"(ghp)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            helper<span class="token punctuation">.</span><span class="token function">setTo</span><span class="token punctuation">(</span><span class="token keyword">to</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            helper<span class="token punctuation">.</span><span class="token function">setSubject</span><span class="token punctuation">(</span>subject<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//true表示要解析html</span>
            helper<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 添加附件</span>
            <span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"E:\\project\\SpringBoot\\springboot_15_email\\target\\springboot_15_email-0.0.1-SNAPSHOT.jar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            helper<span class="token punctuation">.</span><span class="token function">addAttachment</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">MessagingException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        javaMailSender<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="54__2198"></a>5.4 消息</h4> 
<h5><a id="541__2200"></a>5.4.1 消息基础概念</h5> 
<ul><li> <p><strong>什么是消息</strong>？</p> 
  <blockquote> 
   <p>消息可以理解为一组带有信息的数据，比如：对象、数字、字符等都可以是消息</p> 
  </blockquote> </li><li> <p><strong>消息的分类</strong></p> 
  <ul><li><strong>同步消息</strong>：发送的消息需要等待接收方作出响应，然后才能接着发送消息</li><li><strong>异步消息</strong>：发送的消息不需要接收方作出响应，可以继续发送消息</li></ul> <p>其实这个在AJAX中就有所了解了，所谓的同步请求和异步请求</p> </li><li> <p><strong>Java处理消息的三种异步消息传递技术</strong></p> 
  <ul><li> <p><strong>JMS</strong>：即Java消息服务（Java Message Service）应用程序接口，是一个Java平台中关于面向<a href="https://baike.baidu.com/item/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6/5899771?fromModule=lemma_inlink" rel="nofollow">消息中间件</a>（MOM）的API，用于在两个应用程序之间，或<a href="https://baike.baidu.com/item/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F/4905336?fromModule=lemma_inlink" rel="nofollow">分布式系统</a>中发送消息，进行<a href="https://baike.baidu.com/item/%E5%BC%82%E6%AD%A5%E9%80%9A%E4%BF%A1/2273903?fromModule=lemma_inlink" rel="nofollow">异步通信</a>。</p> <p>JMS规范中规范了消息有两种模型。分别是<strong>点对点模型</strong>和<strong>发布订阅模型</strong></p> 
    <ul><li><strong>点对点模型</strong>：peer-2-peer，生产者会将消息发送到一个保存消息的容器中，通常使用队列模型，使用队列保存消息。一个队列的消息只能被一个消费者消费，或未被及时消费导致超时。这种模型下，生产者和消费者是一对一绑定的</li><li><strong>发布订阅模型</strong>：publish-subscribe，生产者将消息发送到一个保存消息的容器中，也是使用队列模型来保存。但是消息可以被多个消费者消费，生产者和消费者完全独立，相互不需要感知对方的存在</li></ul> <p>JMS中消息共有6种：：TextMessage、MapMessage、BytesMessage、StreamMessage、ObjectMessage、Message （只有消息头和属性）。JMS实现有：ActiveMQ、Redis、HornetMQ、RabbitMQ、RocketMQ(没有完全遵守JMS规范)</p> <p><strong>备注</strong>：JMS只规范了Java语言的消息实现。<mark>JMS规范了消息开发的API</mark></p> </li><li> <p><strong>AMQP</strong>：即Advanced Message Queuing Protocol，一个提供统一消息服务的应用层标准高级<a href="https://baike.baidu.com/item/%E6%B6%88%E6%81%AF/1619218?fromModule=lemma_inlink" rel="nofollow">消息</a>队列协议，是应用层协议的一个开放标准，为面向消息的中间件设计。AMQP规范了网络交换的数据格式，兼容JMS。</p> <p><strong>备注</strong>：弥补了JMS的缺点，能够规范各种语言的消息实现，具有跨平台性。<mark>AMQP规范了消息的传递格式</mark></p> <p>AMQP相较于JMS有跟多的消息模型，灵活性非常高：</p> 
    <ul><li>direct exchange</li><li>fanout exchange</li><li>topic exchange</li><li>headers exchange</li><li>system exchange</li></ul> <p>AMQP统一了消息格式，消息种类只有一种：字节数组（byte[]）</p> <p>AMQP的实现：RabbitMQ、StormMQ、RocketMQ</p> </li><li> <p><strong>MQTT</strong>：MQTT（Message Queueing Telemetry Transport）是一个基于<a href="https://baike.baidu.com/item/%E5%AE%A2%E6%88%B7%E7%AB%AF/101081?fromModule=lemma_inlink" rel="nofollow">客户端</a>-<a href="https://baike.baidu.com/item/%E6%9C%8D%E5%8A%A1%E5%99%A8/100571?fromModule=lemma_inlink" rel="nofollow">服务器</a>的消息发布/订阅传输协议。MQTT协议是轻量、简单、开放和易于实现的，这些特点使它适用范围非常广泛，主要应用于物联网……</p> </li></ul> </li></ul> 
<h5><a id="542_ActiveMQ_2244"></a>5.4.2 整合ActiveMQ</h5> 
<p>略……跳过了😆</p> 
<h5><a id="543_RabbitMQ_2248"></a>5.4.3 整合RabbitMQ</h5> 
<h5><a id="544_RocketMQ_2252"></a>5.4.4 整合RocketMQ</h5> 
<h5><a id="545_Kafka_2256"></a>5.4.5 整合Kafka</h5> 
<h3><a id="6_2260"></a>6、监控</h3> 
<h4><a id="61__2262"></a>6.1 监控概述</h4> 
<ul><li> <p><strong>什么是监控</strong>？</p> 
  <blockquote> 
   <p>就是通过软件的方式展示另一个软件的运行情况，运行的情况则通过各种各样的指标数据反馈给监控人员。例如网络是否顺畅、服务器是否在运行、程序的功能是否能够整百分百运行成功，内存是否够用，等等等等。</p> 
  </blockquote> </li><li> <p><strong>监控的作用</strong>：</p> 
  <ul><li>监控服务是否处于宕机状态</li><li>监控服务的运行指标</li><li>监控程序的运行日志</li><li>管理服务的状态</li></ul> </li><li> <p><strong>监控的实现步骤</strong></p> 
  <ul><li><strong>Step1</strong>：显示监控信息的程序，用于获取服务信息（主动或被动拉去监控信息），并显示对应的信息</li><li><strong>Step2</strong>：运行的服务，启动时主动上报，同时需要告诉监控程序自己需要被监控，被监控的数据有哪些</li></ul> <p>如果监控程序被动拉去监控信息，而是由被监控的程序主动去上报监控信息，则不是实时监控（不推荐）；如果监控程序是主动去获取程序的监控信息，则是实时监控（推荐）。如果被监控程序不主动上报自己要被监控，则监控程序无法知道谁要被监控；如果被监控程序不明确告诉监控的数据有哪些，则监控程序会监控到机密数据，这是存在安全隐患的</p> </li><li> <p>监控的分类（基于SpringBoot）：</p> 
  <ul><li><code>HTTP</code>方式：通过编写一个服务端程序来监控应用（6.2的案例就是使用这种方式）</li><li><code>JMX</code>（Java Management Extensions）方式：通过原生Java官方提供的技术，JMX是一个为应用程序、设备、系统等植入管理功能的框架。JMX可以跨越一系列异构操作系统平台、系统体系结构和网络传输协议，灵活的开发无缝集成的系统、网络和服务管理应用（通过<code>jconsole</code>指令可以进入JMX窗口）</li></ul> </li></ul> 
<h4><a id="62__2287"></a>6.2 可视化监控平台</h4> 
<blockquote> 
 <p>  SpringBoot抽取了大部分监控系统的常用指标，提出了监控的总思想。然后就有好心的同志根据监控的总思想，制作了一个通用性很强的监控系统，因为是基于springboot监控的核心思想制作的，所以这个程序被命名为<strong>Spring Boot Admin</strong>。</p> 
 <p>  Spring Boot Admin，这是一个开源社区项目，用于管理和监控SpringBoot应用程序。这个项目中包含有客户端和服务端两部分，而监控平台指的就是服务端。我们做的程序如果需要被监控，将我们做的程序制作成客户端，然后配置服务端地址后，服务端就可以通过HTTP请求的方式从客户端获取对应的信息，并通过UI界面展示对应信息。</p> 
 <p>主要的功能点有：</p> 
 <ul><li>显示应用程序的监控状态</li><li>应用程序上下线监控</li><li>查看 JVM，线程信息</li><li>可视化的查看日志以及下载日志文件</li><li>动态切换日志级别</li><li>Http 请求信息跟踪</li><li>其他功能点……</li></ul> 
</blockquote> 
<h5><a id="621__2303"></a>6.2.1 开发服务端程序</h5> 
<ul><li> <p><strong>Step1</strong>：导入依赖</p> <pre><code class="prism language-xml">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>java.version</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>java.version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>spring-boot-admin.version</span><span class="token punctuation">&gt;</span></span>2.5.4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>spring-boot-admin.version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>
	<span class="token comment">&lt;!--SpringBoot监控服务的依赖--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>de.codecentric<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-admin-starter-server<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span> 
	<span class="token comment">&lt;!--版本依赖管理器--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>de.codecentric<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-admin-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${spring-boot-admin.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>
</code></pre> </li><li> <p><strong>Step2</strong>：开启监控服务</p> <p>在SpringBoot的启动类上添加<code>@EnableAdminServer</code>注解</p> </li><li> <p><strong>Step3</strong>：配置端口</p> <pre><code class="prism language-java">server<span class="token operator">:</span>
  port<span class="token operator">:</span> <span class="token number">8080</span>
</code></pre> </li><li> <p><strong>Step4</strong>：启动程序</p> <p><img src="https://images2.imgbox.com/8b/c3/8OskbfYj_o.png" alt="image-20230108102212868"></p> </li></ul> 
<h5><a id="622__2346"></a>6.2.2 开发客户端程序</h5> 
<ul><li> <p><strong>Step1</strong>：导入依赖</p> <pre><code class="prism language-xml">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>java.version</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>java.version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>spring-boot-admin.version</span><span class="token punctuation">&gt;</span></span>2.5.4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>spring-boot-admin.version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>
	<span class="token comment">&lt;!--SpringBoot监控服务的依赖--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>de.codecentric<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-admin-starter-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span> 
	<span class="token comment">&lt;!--版本依赖管理器--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>de.codecentric<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-admin-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${spring-boot-admin.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>
</code></pre> </li><li> <p><strong>Step2</strong>：编写配置文件</p> <pre><code class="prism language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">boot</span><span class="token punctuation">:</span>
    <span class="token key atrule">admin</span><span class="token punctuation">:</span>
      <span class="token key atrule">client</span><span class="token punctuation">:</span>
        <span class="token key atrule">url</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span><span class="token number">8080</span>
<span class="token key atrule">management</span><span class="token punctuation">:</span>
  <span class="token key atrule">endpoint</span><span class="token punctuation">:</span>
    <span class="token key atrule">health</span><span class="token punctuation">:</span>
      <span class="token key atrule">show-details</span><span class="token punctuation">:</span> always <span class="token comment"># 允许监控服务器查看健康相关的所有信息（默认是never，不监控）</span>
  <span class="token key atrule">endpoints</span><span class="token punctuation">:</span>
    <span class="token key atrule">web</span><span class="token punctuation">:</span>
      <span class="token key atrule">exposure</span><span class="token punctuation">:</span>
        <span class="token key atrule">include</span><span class="token punctuation">:</span> <span class="token string">"*"</span> <span class="token comment"># 允许监控服务器监控所有信息（默认是health，只能看健康信息）</span>
</code></pre> </li><li> <p><strong>Step3</strong>：启动程序</p> <p><img src="https://images2.imgbox.com/d0/dd/Sag4aFRT_o.png" alt="image-20230108102426140"></p> </li></ul> 
<h4><a id="63__2399"></a>6.3 监控原理（端点映射）</h4> 
<blockquote> 
 <p>前面可以可以通过SpringBoot Amin查看到被监控程序的很多数据，包括当前健康状态、程序线程相关数据、JVM相关数据、日志项数据……那么这些数据是怎么得到的，这就需要去查看映射了，在映射那个页面我们可以看到会有很多连接，这些连接就是监控服务器发送给客户端的请求，这些请求会被客户端响应，客户端会将相关信息发送给服务端，然后服务端会将这些数据进行展示</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/d5/66/4HbwB175_o.png" alt="image-20230108104253196"></p> 
<p>可以看到这里都是以<code>/autuator</code>开头的，<code>autuatory</code>可以称为端点，描述了一组监控信息，SpringBootAdmin提供了多个内置端点，通过访问端点就可以获取对应的监控信息，也可以根据需要自定义端点信息。通过发送请求路劲<code>/actuator</code>可以访问应用所有端点信息，如果端点中还有明细信息可以发送请求<code>/actuator/端点名称</code>来获取详细信息。以下列出了所有端点信息说明：</p> 
<table><thead><tr><th>ID</th><th>描述</th><th>默认启用</th></tr></thead><tbody><tr><td><code>auditevents</code></td><td>暴露当前应用程序的审计事件信息。</td><td>是</td></tr><tr><td><code>beans</code></td><td>显示应用程序中所有 Spring bean 的完整列表。</td><td>是</td></tr><tr><td><code>caches</code></td><td>暴露可用的缓存。</td><td>是</td></tr><tr><td><code>conditions</code></td><td>显示在配置和自动配置类上评估的条件以及它们匹配或不匹配的原因。</td><td>是</td></tr><tr><td><code>configprops</code></td><td>显示所有 @ConfigurationProperties 的校对清单。</td><td>是</td></tr><tr><td><code>env</code></td><td>暴露 Spring ConfigurableEnvironment 中的属性。</td><td>是</td></tr><tr><td><code>flyway</code></td><td>显示已应用的 Flyway 数据库迁移。</td><td>是</td></tr><tr><td><code>health</code></td><td>显示应用程序健康信息</td><td>是</td></tr><tr><td><code>httptrace</code></td><td>显示 HTTP 追踪信息（默认情况下，最后 100 个 HTTP 请求/响应交换）。</td><td>是</td></tr><tr><td><code>info</code></td><td>显示应用程序信息。</td><td>是</td></tr><tr><td><code>integrationgraph</code></td><td>显示 Spring Integration 图。</td><td>是</td></tr><tr><td><code>loggers</code></td><td>显示和修改应用程序中日志记录器的配置。</td><td>是</td></tr><tr><td><code>liquibase</code></td><td>显示已应用的 Liquibase 数据库迁移。</td><td>是</td></tr><tr><td><code>metrics</code></td><td>显示当前应用程序的指标度量信息。</td><td>是</td></tr><tr><td><code>mappings</code></td><td>显示所有 @RequestMapping 路径的整理清单。</td><td>是</td></tr><tr><td><code>scheduledtasks</code></td><td>显示应用程序中的调度任务。</td><td>是</td></tr><tr><td><code>sessions</code></td><td>允许从 Spring Session 支持的会话存储中检索和删除用户会话。当使用 Spring Session 的响应式 Web 应用程序支持时不可用。</td><td>是</td></tr><tr><td><code>shutdown</code></td><td>正常关闭应用程序。</td><td>否</td></tr><tr><td><code>threaddump</code></td><td>执行线程 dump。</td><td>是</td></tr><tr><td><code>heapdump</code></td><td>返回一个 hprof 堆 dump 文件。</td><td>是</td></tr><tr><td><code>jolokia</code></td><td>通过 HTTP 暴露 JMX bean（当 Jolokia 在 classpath 上时，不适用于 WebFlux）。</td><td>是</td></tr><tr><td><code>logfile</code></td><td>返回日志文件的内容（如果已设置 logging.file 或 logging.path 属性）。支持使用 HTTP Range 头来检索部分日志文件的内容。</td><td>是</td></tr><tr><td><code>prometheus</code></td><td>以可以由 Prometheus 服务器抓取的格式暴露指标。</td><td>是</td></tr></tbody></table> 
<p>虽然说这里的大部分端点都是默认开启的，但是默认暴露（允许对外访问）的只有 <code>health</code> 和 <code>info</code> 端点，所以如果需要允许端点对外暴露，可以通过如下配置（如果想要暴露所有的端点，则可以直接配置 <code>"*"</code> ，前面设置过了)：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">management</span><span class="token punctuation">:</span>
  <span class="token key atrule">endpoint</span><span class="token punctuation">:</span> <span class="token comment"># 单一端点的配置</span>
<span class="token comment"># 允许监控服务器查看健康相关的所有信息包括接入的第三方服务信息（默认是never，只监控当前应用的健康信息，不会将恐第三方应用信息）</span>
    <span class="token key atrule">health</span><span class="token punctuation">:</span>
      <span class="token key atrule">show-details</span><span class="token punctuation">:</span> always
  <span class="token key atrule">endpoints</span><span class="token punctuation">:</span> <span class="token comment"># 全部端点的配置</span>
    <span class="token key atrule">web</span><span class="token punctuation">:</span>
      <span class="token key atrule">exposure</span><span class="token punctuation">:</span>
        <span class="token comment"># 允许监控服务器监控所有信息（默认是对外开发health、info端点）</span>
        <span class="token key atrule">include</span><span class="token punctuation">:</span> <span class="token string">"*"</span>
        <span class="token comment"># include: [health, info, ...] # 这里也可以配置对外开发多个端点</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/26/66/VEvimQD8_o.png" alt="image-20230109161248971"></p> 
<p><img src="https://images2.imgbox.com/5a/8c/i9QGJn4s_o.png" alt="image-20230109161320333"></p> 
<h4><a id="64__2453"></a>6.4 常用端点</h4> 
<h5><a id="641_info_2455"></a>6.4.1 info端点</h5> 
<p>前面我们了解了所有的信息都是通过<code>autuator</code>这个端点的请求获取的，但是我们可以发现在信息这里是没有显示数据，这是因为</p> 
<p>管理信息数据的是info端点，而info端点需要开发者自己去配置，才能显示数据，具体配置如下：</p> 
<p><img src="https://images2.imgbox.com/04/54/9MbwEsRk_o.png" alt="image-20230109163223090"></p> 
<p>上面那种方式是通过配置文件来控制info端点的数据显示，下面我们将通过编程形式来控制info端点的数据显示</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">InfoConfig</span> <span class="token keyword">implements</span> <span class="token class-name">InfoContributor</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">contribute</span><span class="token punctuation">(</span><span class="token class-name">Info<span class="token punctuation">.</span>Builder</span> builder<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        builder<span class="token punctuation">.</span><span class="token function">withDetail</span><span class="token punctuation">(</span><span class="token string">"runTime"</span><span class="token punctuation">,</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//添加单个信息</span>
        <span class="token class-name">Map</span> infoMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		
        infoMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"buildTime"</span><span class="token punctuation">,</span><span class="token string">"2006"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        builder<span class="token punctuation">.</span><span class="token function">withDetails</span><span class="token punctuation">(</span>infoMap<span class="token punctuation">)</span><span class="token punctuation">;</span>									<span class="token comment">//添加一组信息</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="642_health_2478"></a>6.4.2 health端点</h5> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HealthConfig</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractHealthIndicator</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doHealthCheck</span><span class="token punctuation">(</span><span class="token class-name">Health<span class="token punctuation">.</span>Builder</span> builder<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">boolean</span> condition <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>condition<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            builder<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token class-name">Status</span><span class="token punctuation">.</span><span class="token constant">UP</span><span class="token punctuation">)</span><span class="token punctuation">;</span>					<span class="token comment">//设置运行状态为启动状态</span>
            builder<span class="token punctuation">.</span><span class="token function">withDetail</span><span class="token punctuation">(</span><span class="token string">"runTime"</span><span class="token punctuation">,</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Map</span> infoMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            infoMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"buildTime"</span><span class="token punctuation">,</span> <span class="token string">"2006"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            builder<span class="token punctuation">.</span><span class="token function">withDetails</span><span class="token punctuation">(</span>infoMap<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// builder.up();</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
            builder<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token class-name">Status</span><span class="token punctuation">.</span><span class="token constant">OUT_OF_SERVICE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//设置运行状态为不在服务状态</span>
            builder<span class="token punctuation">.</span><span class="token function">withDetail</span><span class="token punctuation">(</span><span class="token string">"上线了吗？"</span><span class="token punctuation">,</span><span class="token string">"你做梦"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// builder.down();</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="643_Metrics_2502"></a>6.4.3 Metrics端点</h5> 
<blockquote> 
 <p>metrics端点描述了性能指标，除了系统自带的监控性能指标，还可以自定义性能指标</p> 
</blockquote> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BookServiceImpl</span> <span class="token keyword">extends</span> <span class="token class-name">ServiceImpl</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BookDao</span><span class="token punctuation">,</span> <span class="token class-name">Book</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">IBookService</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">BookDao</span> bookDao<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">Counter</span> counter<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">BookServiceImpl</span><span class="token punctuation">(</span><span class="token class-name">MeterRegistry</span> meterRegistry<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        counter <span class="token operator">=</span> meterRegistry<span class="token punctuation">.</span><span class="token function">counter</span><span class="token punctuation">(</span><span class="token string">"用户付费操作次数："</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//每次执行删除业务等同于执行了付费业务</span>
        counter<span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> bookDao<span class="token punctuation">.</span><span class="token function">deleteById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/74/e6/tpsQUyxU_o.png" alt="image-20230109165759727"></p> 
<h4><a id="65__2529"></a>6.5 自定义端点</h4> 
<blockquote> 
 <p>虽然SpringBoot Admin中已经提供了很多比较实用的端点，但是对于一些特殊的业务，我们需要通过自定义一个端点来解决完成这些业务</p> 
</blockquote> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Component</span>
<span class="token comment">// 自定义端点，enableByDefault表示开启端点（默认就是true）</span>
<span class="token annotation punctuation">@Endpoint</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">"pay"</span><span class="token punctuation">,</span>enableByDefault <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PayEndpoint</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 访问这个端点就执行这个方法</span>
    <span class="token annotation punctuation">@ReadOperation</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getPay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Map</span> payMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        payMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"level 1"</span><span class="token punctuation">,</span><span class="token string">"300"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        payMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"level 2"</span><span class="token punctuation">,</span><span class="token string">"291"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        payMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"level 3"</span><span class="token punctuation">,</span><span class="token string">"666"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> payMap<span class="token punctuation">;</span> <span class="token comment">// 将数据返回给访问方</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/38/7a/XzLuRWn9_o.png" alt="image-20230116163606382"></p> 
<blockquote> 
 <p>参考资料：</p> 
 <ul><li><a href="https://www.bilibili.com/video/BV15b4y1a7yG/?spm_id_from=333.337.search-card.all.click" rel="nofollow">黑马程序员SpringBoot2全套视频教程，springboot零基础到项目实战（spring boot2完整版）_哔哩哔哩_bilibili</a></li></ul> 
</blockquote> 
<hr class="footnotes-sep"> 
<section class="footnotes"> 
 <ol class="footnotes-list"><li id="fn1" class="footnote-item"><p>无模式：是指没有固定的数据存储结构，比如第一条数据的字段是name、age，第二条数据的字段就是sex、id <a href="#fnref1" rel="nofollow" class="footnote-backref">↩︎</a></p> </li><li id="fn2" class="footnote-item"><p>文档型：是指以文文档为处理信息的基本单位。文档可长、可短、可无结构。一个文档相当于关系数据库中的一条记录 <a href="#fnref2" rel="nofollow" class="footnote-backref">↩︎</a></p> </li><li id="fn3" class="footnote-item"><p>全文搜索：是指不仅仅是比对某一个字段，而是比对所有字段，最终得到所有的搜索结果 <a href="#fnref3" rel="nofollow" class="footnote-backref">↩︎</a></p> </li></ol> 
</section>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/db4ca56b9a534459fd81422c82cd372f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">初识SpringBoot（2023最后一篇文章）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c5107bd9f36cfcbe13ae8856975518fc/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">MyBatis-Plus入门</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>