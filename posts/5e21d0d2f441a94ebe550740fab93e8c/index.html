<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>R 利用回归分析与时间序列预测北京市PM2.5 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="R 利用回归分析与时间序列预测北京市PM2.5" />
<meta property="og:description" content="注：代码全部在最后,数据来源UCI,链接如下： https://archive.ics.uci.edu/ml/datasets/Beijing&#43;PM2.5&#43;Data
摘要 现代社会科技进步，人们的生活质量逐步提高，但伴随着各类工业和科技的发展，环境问题凸显，最初人们粗放式的经济发展方式在一定程度上对环境造成不可逆转的破坏。在各种环境污染问题，空气污染问题又是如今人们关注的重中之重。北京是我国首都，同时也是我国空气污染较为严重的几个北方城市之一，因此关注北京市空气污染情况是我国观测空气污染情况的重要关注对象之一。在本文中，首先，我就北京市PM2.5及其他污染物和气象情况的近几年观测数据做出相应回归分析，建立回归模型试图利用已知的其他污染物和气象情况信息对PM2.5做出预测；其次，利用现如今已观察到的数据做单变量时间序列分析，寻找其变化规律、做简单预测，为北京市人民规划出行做好提前空气质量预警。
关键词：PM2.5 多元回归分析 时间序列分析
一、数据集介绍 该数据集来自于北京市环境检测中心，包括了2013年3月1日到2017年2月28日，12个国家控制的空气质量监测站每小时的空气污染数据，且每个空气质量站点的气象数据都与中国气象局站相匹配。此空气污染数据集包括12个站点数据集，每个数据集包括了35064个时间数据，共有（35064*12）个样本。
变量包括：PM2.5、PM10、SO2（二氧化硫）、NO2（二氧化氮）、CO（一氧化碳）、O3（臭氧）为空气污染物；剩余变量TEMP（温度）、PRES（大气压）、DEWP（露点温度）、RAIN（降雨量）、WD（风向）、WSPM（风速）天气情况。
站点包括：万寿西宫（西城区）、官园（西城区）、万柳（海淀区）、天坛（东城区）、农展馆（朝阳区）、奥体中心（朝阳区）、怀柔、古城（顺义区）、顺义、东寺（平谷区）、定陵（昌平区）、昌平共十二个，其地理位置分布如下：
二、研究问题一 （一）研究问题 将SO2、NO2、CO、O3、TEMP（温度）、PRES（大气压）、DEWP（露点温度）、RAIN（降雨量）、WD（风向）、WSPM（风速）作为解释变量，Y作为被解释变量，以预测误差最小为原则，选择最优多元回归模型。
（二）研究方法 多元回归
（三）研究步骤 1.数据集选择 由于该数据集有北京12个观测点的完整时间数据，以下以PM2.5为例绘制出PM2.5分布的盒图和小提琴图，并按照均值从从低到高排列，发现12个观测点PM2.5的分布基本相似，以下选择其中一个地区奥体中心的数据集进行分析。
2.数据可视化 在进行定量建模之前，先绘制图像对变量分布和变量之间的相关关系进行直观感受与定性分析。
观察SO2、NO2、CO和O3这四种污染物分别与PM2.5的相关关系：
可以看出PM2.5随着CO、NO2浓度的上升而呈线性上升趋势，O3和SO2和PM2.5的线性关系没有那么强烈。
接下来考虑气温、压强、露点温度、降雨量与被解释变量PM2.5的关系：
从图中可以看出气温、压强、露点温度、降雨量和PM2.5的相关性更弱，但具体会对PM2.5的预测有怎样的效果，需要在回归模型中进一步分析。
最后考虑风速和风向与被解释变量PM2.5的关系：
在第一幅图可以看中，图例从上到下以PM2.5均值大小排序，可以看出西北方向的风PM2.5峰度高且整体分布靠左，东南方向的风峰度低而整体分布靠右，也就是PM2.5值整体偏大；风速和PM2.5的线性相关关系不是很明显。
3.回归分析（以奥体中心为例） （1）前期准备
① 对待选入模型的变量进行平稳性检验，防止出现伪回归，使用ADF单位根检验，拒绝原假设，不存在单位根，序列平稳。
② 对所选的“奥体中心”数据做删失处理，由于数据量足够多，直接删除带有缺失值的行。
（2）变量选择：
先做全变量回归，发现有大量变量存在系数t检验结果不显著，并且存在VIF值较高的变量，需要进行变量选择，这里尝试了两种变量选择的方法，两种方法筛选出的变量相同。
① 根据BIC准则做逐步回归，依次从全模型剔除变量，直至BIC值最小。
② 利用10折交叉验证，将数据根据被解释变量均匀分为10份，每一份分别当作测试集，计算利用10个训练集训练出的模型在相应测试集上的MSE并取平均，建立循环寻找使得交叉验证所得MSE平均值最小的变量组合，即预测效果最好的变量组合。
（3）回归结果：
Coefficients: Estimate
Std. Error
t value
Pr(&gt;|t|)
(Intercept)
232.812250
64.033810
3.636
0.000278
***
SO2
0.463988
0.019179
24.192
&lt;2e-16
***
NO2
0.710602
0.015931
44.605
&lt;2e-16
***
CO
0.035909
0.000440
81.608" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/5e21d0d2f441a94ebe550740fab93e8c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-09-25T22:40:34+08:00" />
<meta property="article:modified_time" content="2020-09-25T22:40:34+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">R 利用回归分析与时间序列预测北京市PM2.5</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2 style="margin-left:0cm;">注：代码全部在最后,数据来源UCI,链接如下：</h2> 
<p><a href="https://archive.ics.uci.edu/ml/datasets/Beijing+PM2.5+Data" rel="nofollow">https://archive.ics.uci.edu/ml/datasets/Beijing+PM2.5+Data</a></p> 
<h2 id="%E6%91%98%E8%A6%81" style="margin-left:0cm;">摘要</h2> 
<p style="margin-left:0cm;">现代社会科技进步，人们的生活质量逐步提高，但伴随着各类工业和科技的发展，环境问题凸显，最初人们粗放式的经济发展方式在一定程度上对环境造成不可逆转的破坏。<span style="color:#222222;">在各种</span>环境污染问题，空气污染问题又是如今人们关注的重中之重。北京是我国首都，同时也是我国空气污染较为严重的几个北方城市之一，因此关注北京市空气污染情况是我国观测空气污染情况的重要关注对象之一。在本文中，首先，我就北京市PM2.5及其他污染物和气象情况的近几年观测数据做出相应回归分析，建立回归模型试图利用已知的其他污染物和气象情况信息对PM2.5做出预测；其次，利用现如今已观察到的数据做单变量时间序列分析，寻找其变化规律、做简单预测，为北京市人民规划出行做好提前空气质量预警。</p> 
<p style="margin-left:0cm;">关键词：PM2.5 多元回归分析 时间序列分析</p> 
<p style="margin-left:0cm;"> </p> 
<h2 id="%E4%B8%80%E3%80%81%E6%95%B0%E6%8D%AE%E9%9B%86%E4%BB%8B%E7%BB%8D" style="margin-left:0cm;">一、数据集介绍</h2> 
<p style="margin-left:0cm;"><span style="color:#222222;">该数据集来自于北京市环境检测中心，包括了</span><span style="color:#222222;">2013</span><span style="color:#222222;">年</span><span style="color:#222222;">3</span><span style="color:#222222;">月</span><span style="color:#222222;">1</span><span style="color:#222222;">日到</span><span style="color:#222222;">2017</span><span style="color:#222222;">年</span><span style="color:#222222;">2</span><span style="color:#222222;">月</span><span style="color:#222222;">28</span><span style="color:#222222;">日，</span><span style="color:#222222;">12</span><span style="color:#222222;">个国家控制的空气质量监测站每小时的空气污染数据，且每个空气质量站点的气象数据都与中国气象局站相匹配。此空气污染数据集包括</span><span style="color:#222222;">12</span><span style="color:#222222;">个站点数据集，每个数据集包括了</span><span style="color:#222222;">35064</span><span style="color:#222222;">个时间数据，共有（</span><span style="color:#222222;">35064*12</span><span style="color:#222222;">）个样本。</span></p> 
<p style="margin-left:0cm;"><span style="color:#222222;">变量包括：</span><span style="color:#222222;">PM2.5</span><span style="color:#222222;">、</span><span style="color:#222222;">PM10</span><span style="color:#222222;">、</span><span style="color:#222222;">SO2</span><span style="color:#222222;">（二氧化硫）、</span><span style="color:#222222;">NO2</span><span style="color:#222222;">（二氧化氮）、</span><span style="color:#222222;">CO</span><span style="color:#222222;">（一氧化碳）、</span><span style="color:#222222;">O3</span><span style="color:#222222;">（臭氧）为空气污染物；剩余变量</span><span style="color:#222222;">TEMP</span><span style="color:#222222;">（温度）、</span><span style="color:#222222;">PRES</span><span style="color:#222222;">（大气压）、</span><span style="color:#222222;">DEWP</span><span style="color:#222222;">（露点温度）、</span><span style="color:#222222;">RAIN</span><span style="color:#222222;">（降雨量）、</span><span style="color:#222222;">WD</span><span style="color:#222222;">（风向）、</span><span style="color:#222222;">WSPM</span><span style="color:#222222;">（风速）天气情况。</span></p> 
<p style="margin-left:0cm;"><span style="color:#222222;">站点包括：万寿西宫（西城区）、官园（西城区）、万柳（海淀区）、天坛（东城区）、农展馆（朝阳区）、奥体中心（朝阳区）、怀柔、古城（顺义区）、顺义、东寺（平谷区）、定陵（昌平区）、昌平共十二个，其地理位置分布如下：</span></p> 
<p style="margin-left:0cm;"><img alt="" height="736" src="https://images2.imgbox.com/c3/59/isVkyXiv_o.jpg" width="1178"></p> 
<p style="margin-left:0cm;"> </p> 
<h2 id="%E4%BA%8C%E3%80%81%E7%A0%94%E7%A9%B6%E9%97%AE%E9%A2%98%E4%B8%80" style="margin-left:0cm;">二、研究问题一</h2> 
<h3 id="%EF%BC%88%E4%B8%80%EF%BC%89%E7%A0%94%E7%A9%B6%E9%97%AE%E9%A2%98" style="margin-left:0cm;"><strong>（一）研究问题</strong></h3> 
<p style="margin-left:0cm;">将SO2、NO2、CO、O3、<span style="color:#222222;">TEMP</span><span style="color:#222222;">（温度）、</span><span style="color:#222222;">PRES</span><span style="color:#222222;">（大气压）、</span><span style="color:#222222;">DEWP</span><span style="color:#222222;">（露点温度）、</span><span style="color:#222222;">RAIN</span><span style="color:#222222;">（降雨量）、</span><span style="color:#222222;">WD</span><span style="color:#222222;">（风向）、</span><span style="color:#222222;">WSPM</span><span style="color:#222222;">（风速）作为解释变量，</span><span style="color:#222222;">Y</span><span style="color:#222222;">作为被解释变量，以预测误差最小为原则，选择最优多元回归模型。</span></p> 
<h3 id="%EF%BC%88%E4%BA%8C%EF%BC%89%E7%A0%94%E7%A9%B6%E6%96%B9%E6%B3%95" style="margin-left:0cm;"><strong>（二）研究方法</strong></h3> 
<p style="margin-left:0cm;">多元回归</p> 
<h3 id="%EF%BC%88%E4%B8%89%EF%BC%89%E7%A0%94%E7%A9%B6%E6%AD%A5%E9%AA%A4" style="margin-left:0cm;"><strong>（三）研究步骤</strong></h3> 
<h4 id="1.%E6%95%B0%E6%8D%AE%E9%9B%86%E9%80%89%E6%8B%A9" style="margin-left:0cm;"><strong>1.</strong><strong>数据集选择</strong></h4> 
<p style="margin-left:0cm;">由于该数据集有北京12个观测点的完整时间数据，以下以PM2.5为例绘制出PM2.5分布的盒图和小提琴图，并按照均值从从低到高排列，发现12个观测点PM2.5的分布基本相似，以下选择其中一个地区奥体中心的数据集进行分析。</p> 
<p style="margin-left:0cm;"><img alt="" height="1200" src="https://images2.imgbox.com/50/9c/YYVPGHEN_o.png" width="1200"></p> 
<h4 id="2.%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96" style="margin-left:0cm;"><strong><span style="color:#222222;">2.</span></strong><strong><span style="color:#222222;">数据可视化</span></strong></h4> 
<p style="margin-left:0cm;"><strong>    </strong><strong><span style="color:#222222;">在进行定量建模之前，先绘制图像对变量分布和变量之间的相关关系进行直观感受与定性分析。</span></strong></p> 
<p style="margin-left:0cm;">观察SO2、NO2、CO和O3这四种污染物分别与PM2.5的相关关系：</p> 
<p style="margin-left:0cm;"><img alt="" height="323" src="https://images2.imgbox.com/3f/f2/MRzSVOMZ_o.png" width="404"><img alt="" height="318" src="https://images2.imgbox.com/12/0c/Dq2EbcNf_o.png" width="398"><img alt="" height="328" src="https://images2.imgbox.com/cf/d6/btdkDQbs_o.png" width="409"><img alt="" height="319" src="https://images2.imgbox.com/43/02/mZvfTKrr_o.png" width="399"></p> 
<p style="margin-left:0cm;"><span style="color:#222222;">可以看出PM2.5随着CO、NO2浓度的上升而呈线性上升趋势，O3和SO2和PM2.5的线性关系没有那么强烈。</span></p> 
<p style="margin-left:0cm;"><span style="color:#222222;">接下来考虑气温、压强、</span><span style="color:#222222;">露点温度、降雨量</span><span style="color:#222222;">与被解释变量PM2.5的关系：</span></p> 
<p style="margin-left:0cm;"><img alt="" height="856" src="https://images2.imgbox.com/51/e7/L5QmLor3_o.png" width="1172"></p> 
<p style="margin-left:0cm;"><span style="color:#222222;">从图中可以看出气温、压强、</span><span style="color:#222222;">露点温度、降雨量和</span><span style="color:#222222;">PM2.5</span><span style="color:#222222;">的相关性更弱，但具体会对</span><span style="color:#222222;">PM2.5</span><span style="color:#222222;">的预测有怎样的效果，需要在回归模型中进一步分析。</span></p> 
<p style="margin-left:0cm;"><span style="color:#222222;">最后考虑风速和风向与被解释变量PM2.5的关系：</span></p> 
<p style="margin-left:0cm;"><img alt="" height="456" src="https://images2.imgbox.com/2e/40/ESspRAkH_o.png" width="1146"></p> 
<p style="margin-left:0cm;">   <span style="color:#222222;">在第一幅图可以看中，图例从上到下以PM2.5均值大小排序，可以看出西北方向的风PM2.5峰度高且整体分布靠左，东南方向的风峰度低而整体分布靠右，也就是PM2.5值整体偏大；风速和PM2.5的线性相关关系不是很明显。</span></p> 
<h4 id="3.%E5%9B%9E%E5%BD%92%E5%88%86%E6%9E%90%EF%BC%88%E4%BB%A5%E5%A5%A5%E4%BD%93%E4%B8%AD%E5%BF%83%E4%B8%BA%E4%BE%8B%EF%BC%89" style="margin-left:0cm;"><span style="color:#004000;">3<strong>.</strong><strong>回归分析</strong>（以奥体中心为例）</span></h4> 
<p style="margin-left:0cm;">（1）前期准备</p> 
<p style="margin-left:0cm;">① 对待选入模型的变量进行平稳性检验，防止出现伪回归，使用ADF单位根检验，拒绝原假设，不存在单位根，序列平稳。</p> 
<p style="margin-left:0cm;">② 对所选的“奥体中心”数据做删失处理，由于数据量足够多，直接删除带有缺失值的行。</p> 
<p style="margin-left:0cm;">（2）变量选择：</p> 
<p style="margin-left:0cm;">先做全变量回归，发现有大量变量存在系数t检验结果不显著，并且存在VIF值较高的变量，需要进行变量选择，这里尝试了两种变量选择的方法，两种方法筛选出的变量相同。</p> 
<p style="margin-left:0cm;">① 根据BIC准则做逐步回归，依次从全模型剔除变量，直至BIC值最小。</p> 
<p style="margin-left:0cm;">② 利用10折交叉验证，将数据根据被解释变量均匀分为10份，每一份分别当作测试集，计算利用10个训练集训练出的模型在相应测试集上的MSE并取平均，建立循环寻找使得交叉验证所得MSE平均值最小的变量组合，即预测效果最好的变量组合。</p> 
<p style="margin-left:0cm;">（3）回归结果：</p> 
<p style="margin-left:0cm;">Coefficients:                    </p> 
<table align="center" border="1" cellspacing="0"><thead><tr><td> <p style="margin-left:0cm;"> </p> </td><td> <p style="margin-left:0cm;">Estimate</p> </td><td> <p style="margin-left:0cm;">Std. Error</p> </td><td> <p style="margin-left:0cm;">t value</p> </td><td> <p style="margin-left:0cm;">Pr(&gt;|t|)</p> </td><td> <p style="margin-left:0cm;"> </p> </td></tr></thead><tbody><tr><td> <p style="margin-left:0cm;">(Intercept)</p> </td><td> <p style="margin-left:0cm;">232.812250</p> </td><td> <p style="margin-left:0cm;">64.033810</p> </td><td> <p style="margin-left:0cm;">3.636</p> </td><td> <p style="margin-left:0cm;">0.000278</p> </td><td> <p style="margin-left:0cm;">***</p> </td></tr><tr><td> <p style="margin-left:0cm;">SO2</p> </td><td> <p style="margin-left:0cm;">0.463988</p> </td><td> <p style="margin-left:0cm;">0.019179</p> </td><td> <p style="margin-left:0cm;">24.192</p> </td><td> <p style="margin-left:0cm;">&lt;2e-16</p> </td><td> <p style="margin-left:0cm;">***</p> </td></tr><tr><td> <p style="margin-left:0cm;">NO2</p> </td><td> <p style="margin-left:0cm;">0.710602</p> </td><td> <p style="margin-left:0cm;">0.015931</p> </td><td> <p style="margin-left:0cm;">44.605</p> </td><td> <p style="margin-left:0cm;">&lt;2e-16</p> </td><td> <p style="margin-left:0cm;">***</p> </td></tr><tr><td> <p style="margin-left:0cm;">CO</p> </td><td> <p style="margin-left:0cm;">0.035909</p> </td><td> <p style="margin-left:0cm;">0.000440</p> </td><td> <p style="margin-left:0cm;">81.608</p> </td><td> <p style="margin-left:0cm;">&lt;2e-16</p> </td><td> <p style="margin-left:0cm;">***</p> </td></tr><tr><td> <p style="margin-left:0cm;">O3</p> </td><td> <p style="margin-left:0cm;">0.249223</p> </td><td> <p style="margin-left:0cm;">0.009159</p> </td><td> <p style="margin-left:0cm;">27.211</p> </td><td> <p style="margin-left:0cm;">&lt;2e-16</p> </td><td> <p style="margin-left:0cm;">***</p> </td></tr><tr><td> <p style="margin-left:0cm;">TEMP</p> </td><td> <p style="margin-left:0cm;">-1.154538</p> </td><td> <p style="margin-left:0cm;">0.086582</p> </td><td> <p style="margin-left:0cm;">-13.335</p> </td><td> <p style="margin-left:0cm;">&lt;2e-16</p> </td><td> <p style="margin-left:0cm;">***</p> </td></tr><tr><td> <p style="margin-left:0cm;">PRES</p> </td><td> <p style="margin-left:0cm;">-0.255064</p> </td><td> <p style="margin-left:0cm;">0.062654</p> </td><td> <p style="margin-left:0cm;">-4.071</p> </td><td> <p style="margin-left:0cm;">4.7e-05</p> </td><td> <p style="margin-left:0cm;">***</p> </td></tr><tr><td> <p style="margin-left:0cm;">DEWP</p> </td><td> <p style="margin-left:0cm;">1.612418</p> </td><td> <p style="margin-left:0cm;">0.061157</p> </td><td> <p style="margin-left:0cm;">26.365</p> </td><td> <p style="margin-left:0cm;">&lt;2e-16</p> </td><td> <p style="margin-left:0cm;">***</p> </td></tr><tr><td> <p style="margin-left:0cm;">RAIN</p> </td><td> <p style="margin-left:0cm;">-1.605167</p> </td><td> <p style="margin-left:0cm;">0.413330</p> </td><td> <p style="margin-left:0cm;">-3.883</p> </td><td> <p style="margin-left:0cm;">0.000103</p> </td><td> <p style="margin-left:0cm;">***</p> </td></tr><tr><td> <p style="margin-left:0cm;">WSPM</p> </td><td> <p style="margin-left:0cm;">5.117095</p> </td><td> <p style="margin-left:0cm;">0.378114</p> </td><td> <p style="margin-left:0cm;">13.533</p> </td><td> <p style="margin-left:0cm;">&lt;2e-16</p> </td><td> <p style="margin-left:0cm;">***</p> </td></tr><tr><td> <p style="margin-left:0cm;">wdENE</p> </td><td> <p style="margin-left:0cm;">-3.069006</p> </td><td> <p style="margin-left:0cm;">1.125061</p> </td><td> <p style="margin-left:0cm;">-2.728</p> </td><td> <p style="margin-left:0cm;">0.006382</p> </td><td> <p style="margin-left:0cm;">**</p> </td></tr><tr><td> <p style="margin-left:0cm;">wdN</p> </td><td> <p style="margin-left:0cm;">3.049390</p> </td><td> <p style="margin-left:0cm;">1.506081</p> </td><td> <p style="margin-left:0cm;">2.025</p> </td><td> <p style="margin-left:0cm;">0.042913</p> </td><td> <p style="margin-left:0cm;">*</p> </td></tr><tr><td> <p style="margin-left:0cm;">wdNNW</p> </td><td> <p style="margin-left:0cm;">4.275978</p> </td><td> <p style="margin-left:0cm;">1.719299</p> </td><td> <p style="margin-left:0cm;">2.487</p> </td><td> <p style="margin-left:0cm;">0.012891</p> </td><td> <p style="margin-left:0cm;">*</p> </td></tr><tr><td> <p style="margin-left:0cm;">wdSE</p> </td><td> <p style="margin-left:0cm;">5.081616</p> </td><td> <p style="margin-left:0cm;">1.756569</p> </td><td> <p style="margin-left:0cm;">2.893</p> </td><td> <p style="margin-left:0cm;">0.003822</p> </td><td> <p style="margin-left:0cm;">**</p> </td></tr><tr><td> <p style="margin-left:0cm;">wdSSE</p> </td><td> <p style="margin-left:0cm;">4.561950</p> </td><td> <p style="margin-left:0cm;">2.014055</p> </td><td> <p style="margin-left:0cm;">2.265</p> </td><td> <p style="margin-left:0cm;">0.023523</p> </td><td> <p style="margin-left:0cm;">*</p> </td></tr><tr><td> <p style="margin-left:0cm;">wdSSW</p> </td><td> <p style="margin-left:0cm;">3.442118</p> </td><td> <p style="margin-left:0cm;">1.493166</p> </td><td> <p style="margin-left:0cm;">2.305</p> </td><td> <p style="margin-left:0cm;">0.021165</p> </td><td> <p style="margin-left:0cm;">*</p> </td></tr><tr><td> <p style="margin-left:0cm;">wdW</p> </td><td> <p style="margin-left:0cm;">-5.690030</p> </td><td> <p style="margin-left:0cm;">1.895453</p> </td><td> <p style="margin-left:0cm;">-3.002</p> </td><td> <p style="margin-left:0cm;">0.002687</p> </td><td> <p style="margin-left:0cm;">**</p> </td></tr><tr><td> <p style="margin-left:0cm;">wdWSW</p> </td><td> <p style="margin-left:0cm;">-3.425869</p> </td><td> <p style="margin-left:0cm;">1.428746</p> </td><td> <p style="margin-left:0cm;">-2.398</p> </td><td> <p style="margin-left:0cm;">0.016505</p> </td><td> <p style="margin-left:0cm;">*</p> </td></tr></tbody></table> 
<p style="margin-left:0cm;"><span style="color:#ffffff;">其拟合优度及显著性水平检验结果如下表：</span></p> 
<table border="1" cellspacing="0"><tbody><tr><td> <p style="margin-left:0cm;">Residual standard error</p> </td><td> <p style="margin-left:0cm;">42.81 on 15891 degrees of freedom</p> </td></tr><tr><td> <p style="margin-left:0cm;">Multiple R-squared</p> </td><td> <p style="margin-left:0cm;">0.7164</p> </td></tr><tr><td> <p style="margin-left:0cm;">Adjusted R-squared</p> </td><td> <p style="margin-left:0cm;">0.7161</p> </td></tr><tr><td> <p style="margin-left:0cm;">F-statistic</p> </td><td> <p style="margin-left:0cm;">2361 on 17 and 15891 DF</p> </td></tr><tr><td> <p style="margin-left:0cm;">p-value</p> </td><td> <p style="margin-left:0cm;">&lt; 2.2e-16</p> </td></tr></tbody></table> 
<p style="margin-left:0cm;">（4）模型检验：</p> 
<p style="margin-left:0cm;">a. 独立性检验：拒绝原假设rho==0，认为随机扰动项存在自相关；</p> 
<p style="margin-left:0cm;">b. 线性性检验：由图可以看出RAIN不是线性的；</p> 
<p style="margin-left:0cm;"><img alt="" height="304" src="https://images2.imgbox.com/d6/14/jripQSnh_o.png" width="553"></p> 
<p style="margin-left:0cm;"><img alt="" height="115" src="https://images2.imgbox.com/05/b3/ece3mfye_o.png" width="553"></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">c.同方差检验：拒绝原假设（方差恒定），模型存在异方差；</p> 
<p style="margin-left:0cm;"><img alt="" height="321" src="https://images2.imgbox.com/b2/a1/SgQZ5hYW_o.png" width="539"></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">d.多重共线性检验:</p> 
<p style="margin-left:0cm;">下表计算了变量选择之后建立的回归模型的各解释变量的VIF</p> 
<table align="center" border="1" cellspacing="0"><tbody><tr><td> <p style="margin-left:0cm;">SO2</p> </td><td> <p style="margin-left:0cm;">NO2</p> </td><td> <p style="margin-left:0cm;">CO</p> </td><td> <p style="margin-left:0cm;">O3</p> </td><td> <p style="margin-left:0cm;">TEMP</p> </td><td> <p style="margin-left:0cm;">PRES</p> </td></tr><tr><td> <p style="margin-left:0cm;">1.658091</p> </td><td> <p style="margin-left:0cm;">2.978911</p> </td><td> <p style="margin-left:0cm;">2.513574</p> </td><td> <p style="margin-left:0cm;">2.442158</p> </td><td> <p style="margin-left:0cm;">8.321385</p> </td><td> <p style="margin-left:0cm;">3.619437</p> </td></tr><tr><td> <p style="margin-left:0cm;">DEWP</p> </td><td> <p style="margin-left:0cm;">RAIN</p> </td><td> <p style="margin-left:0cm;">WSPM</p> </td><td> <p style="margin-left:0cm;">wdENE</p> </td><td> <p style="margin-left:0cm;">wdN</p> </td><td> <p style="margin-left:0cm;">wdNNW</p> </td></tr><tr><td> <p style="margin-left:0cm;">6.036338</p> </td><td> <p style="margin-left:0cm;">1.027168</p> </td><td> <p style="margin-left:0cm;">1.801353</p> </td><td> <p style="margin-left:0cm;">1.102301</p> </td><td> <p style="margin-left:0cm;">1.064934</p> </td><td> <p style="margin-left:0cm;">1.105588</p> </td></tr><tr><td> <p style="margin-left:0cm;">wdSE</p> </td><td> <p style="margin-left:0cm;">wdSSE</p> </td><td> <p style="margin-left:0cm;">wdSSW</p> </td><td> <p style="margin-left:0cm;">wdW</p> </td><td> <p style="margin-left:0cm;">wdWSW</p> </td><td> <p style="margin-left:0cm;">-</p> </td></tr><tr><td> <p style="margin-left:0cm;">1.047875</p> </td><td> <p style="margin-left:0cm;">1.042624</p> </td><td> <p style="margin-left:0cm;">1.091834</p> </td><td> <p style="margin-left:0cm;">1.033414</p> </td><td> <p style="margin-left:0cm;">1.057227</p> </td><td> <p style="margin-left:0cm;">-</p> </td></tr></tbody></table> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">e.鉴别强影响点与离群点：由结果得只有10个离群点和4个强影响点，相对于样本观测值数量而言极小，可忽略其影响；</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><img alt="" height="356" src="https://images2.imgbox.com/84/b7/htFev0sV_o.png" width="517"></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">（4）模型修正</p> 
<p style="margin-left:0cm;">    虽然对于用于预测的模型来说，自相关性和异方差的存在对预测没有影响，但是自相关性和异方差会影响回归模型的解释性，所以以下给出两种模型修正方法。</p> 
<p style="margin-left:0cm;">① 对数变换</p> 
<p style="margin-left:0cm;">对全部大于0的变量直接取对数，对大于等于0的变量，把0替换为0.01再取对数，对存在负值的变量和哑变量不取对数，再进行线性回归。</p> 
<p style="margin-left:0cm;">结果没有消除自相关和异方差，方法失效；</p> 
<p style="margin-left:0cm;">② NeweyWest方法</p> 
<p style="margin-left:0cm;">虽然自相关和异方差性不会影响参数估计的无偏性，但是会低估参数的标准误差，使得系数的显著性检验失效。此处利用NeweyWest方法修正标准误差，得到各解释变量真实的显著性水平：</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">t test of coefficients:</p> 
<table border="1" cellspacing="0"><thead><tr><td> <p style="margin-left:0cm;"> </p> </td><td> <p style="margin-left:0cm;">Estimate</p> </td><td> <p style="margin-left:0cm;">Std.Error</p> </td><td> <p style="margin-left:0cm;">t value</p> </td><td> <p style="margin-left:0cm;">Pr(&gt;|t|)</p> </td><td> <p style="margin-left:0cm;"> </p> </td></tr></thead><tbody><tr><td> <p style="margin-left:0cm;">(Intercept)</p> </td><td> <p style="margin-left:0cm;">232.8122503</p> </td><td> <p style="margin-left:0cm;">219.5400294</p> </td><td> <p style="margin-left:0cm;">1.0605</p> </td><td> <p style="margin-left:0cm;">0.288954</p> </td><td> <p style="margin-left:0cm;"> </p> </td></tr><tr><td> <p style="margin-left:0cm;">SO2</p> </td><td> <p style="margin-left:0cm;">0.4639883</p> </td><td> <p style="margin-left:0cm;">0.1171078</p> </td><td> <p style="margin-left:0cm;">3.9621</p> </td><td> <p style="margin-left:0cm;">7.463e-05</p> </td><td> <p style="margin-left:0cm;">***</p> </td></tr><tr><td> <p style="margin-left:0cm;">NO2</p> </td><td> <p style="margin-left:0cm;">0.7106023</p> </td><td> <p style="margin-left:0cm;">0.0699557</p> </td><td> <p style="margin-left:0cm;">10.1579</p> </td><td> <p style="margin-left:0cm;">&lt;2.2e-16</p> </td><td> <p style="margin-left:0cm;">***</p> </td></tr><tr><td> <p style="margin-left:0cm;">CO</p> </td><td> <p style="margin-left:0cm;">0.0359093</p> </td><td> <p style="margin-left:0cm;">0.0027966</p> </td><td> <p style="margin-left:0cm;">12.8404</p> </td><td> <p style="margin-left:0cm;">&lt;2.2e-16</p> </td><td> <p style="margin-left:0cm;">***</p> </td></tr><tr><td> <p style="margin-left:0cm;">O3</p> </td><td> <p style="margin-left:0cm;">0.2492227</p> </td><td> <p style="margin-left:0cm;">0.0246035</p> </td><td> <p style="margin-left:0cm;">10.1296</p> </td><td> <p style="margin-left:0cm;">&lt;2.2e-16</p> </td><td> <p style="margin-left:0cm;">***</p> </td></tr><tr><td> <p style="margin-left:0cm;">TEMP</p> </td><td> <p style="margin-left:0cm;">-1.1545382</p> </td><td> <p style="margin-left:0cm;">0.2041962</p> </td><td> <p style="margin-left:0cm;">-5.6541</p> </td><td> <p style="margin-left:0cm;">1.594e-08</p> </td><td> <p style="margin-left:0cm;">***</p> </td></tr><tr><td> <p style="margin-left:0cm;">PRES</p> </td><td> <p style="margin-left:0cm;">-0.2550644</p> </td><td> <p style="margin-left:0cm;">0.2146604</p> </td><td> <p style="margin-left:0cm;">-1.1882</p> </td><td> <p style="margin-left:0cm;">0.234764</p> </td><td> <p style="margin-left:0cm;"> </p> </td></tr><tr><td> <p style="margin-left:0cm;">DEWP</p> </td><td> <p style="margin-left:0cm;">1.6124182</p> </td><td> <p style="margin-left:0cm;">0.1631761</p> </td><td> <p style="margin-left:0cm;">9.8815</p> </td><td> <p style="margin-left:0cm;">&lt;2.2e-16</p> </td><td> <p style="margin-left:0cm;">***</p> </td></tr><tr><td> <p style="margin-left:0cm;">RAIN</p> </td><td> <p style="margin-left:0cm;">-1.6051674</p> </td><td> <p style="margin-left:0cm;">0.6104286</p> </td><td> <p style="margin-left:0cm;">-2.6296</p> </td><td> <p style="margin-left:0cm;">0.008557</p> </td><td> <p style="margin-left:0cm;">**</p> </td></tr><tr><td> <p style="margin-left:0cm;">WSPM</p> </td><td> <p style="margin-left:0cm;">5.1170951</p> </td><td> <p style="margin-left:0cm;">0.5528738</p> </td><td> <p style="margin-left:0cm;">9.2554</p> </td><td> <p style="margin-left:0cm;">&lt;2.2e-16</p> </td><td> <p style="margin-left:0cm;">***</p> </td></tr><tr><td> <p style="margin-left:0cm;">wdENE</p> </td><td> <p style="margin-left:0cm;">-3.0690056</p> </td><td> <p style="margin-left:0cm;">1.3442140</p> </td><td> <p style="margin-left:0cm;">-2.2831</p> </td><td> <p style="margin-left:0cm;">0.022436</p> </td><td> <p style="margin-left:0cm;">*</p> </td></tr><tr><td> <p style="margin-left:0cm;">wdN</p> </td><td> <p style="margin-left:0cm;">3.0493905</p> </td><td> <p style="margin-left:0cm;">2.1257378</p> </td><td> <p style="margin-left:0cm;">1.4345</p> </td><td> <p style="margin-left:0cm;">0.151447</p> </td><td> <p style="margin-left:0cm;"> </p> </td></tr><tr><td> <p style="margin-left:0cm;">wdNNW</p> </td><td> <p style="margin-left:0cm;">4.2759783</p> </td><td> <p style="margin-left:0cm;">1.7114650</p> </td><td> <p style="margin-left:0cm;">2.4984</p> </td><td> <p style="margin-left:0cm;">0.012484</p> </td><td> <p style="margin-left:0cm;">*</p> </td></tr><tr><td> <p style="margin-left:0cm;">wdSE</p> </td><td> <p style="margin-left:0cm;">5.0816158</p> </td><td> <p style="margin-left:0cm;">2.1300002</p> </td><td> <p style="margin-left:0cm;">2.3857</p> </td><td> <p style="margin-left:0cm;">0.017057</p> </td><td> <p style="margin-left:0cm;">*</p> </td></tr><tr><td> <p style="margin-left:0cm;">wdSSE</p> </td><td> <p style="margin-left:0cm;">4.5619502</p> </td><td> <p style="margin-left:0cm;">2.3059688</p> </td><td> <p style="margin-left:0cm;">1.9783</p> </td><td> <p style="margin-left:0cm;">0.047910</p> </td><td> <p style="margin-left:0cm;">*</p> </td></tr><tr><td> <p style="margin-left:0cm;">wdSSW</p> </td><td> <p style="margin-left:0cm;">3.4421184</p> </td><td> <p style="margin-left:0cm;">2.0387166</p> </td><td> <p style="margin-left:0cm;">1.6884</p> </td><td> <p style="margin-left:0cm;">0.091359</p> </td><td> <p style="margin-left:0cm;">.</p> </td></tr><tr><td> <p style="margin-left:0cm;">wdW</p> </td><td> <p style="margin-left:0cm;">-5.6900301</p> </td><td> <p style="margin-left:0cm;">2.0368072</p> </td><td> <p style="margin-left:0cm;">-2.7936</p> </td><td> <p style="margin-left:0cm;">0.005219</p> </td><td> <p style="margin-left:0cm;">**</p> </td></tr><tr><td> <p style="margin-left:0cm;">wdWSW</p> </td><td> <p style="margin-left:0cm;">-3.4258687</p> </td><td> <p style="margin-left:0cm;">2.0828541</p> </td><td> <p style="margin-left:0cm;">-1.6448</p> </td><td> <p style="margin-left:0cm;">0.100032</p> </td><td> <p style="margin-left:0cm;"> </p> </td></tr></tbody></table> 
<p style="margin-left:0cm;"> </p> 
<h3 id="%EF%BC%88%E5%9B%9B%EF%BC%89%E7%BB%93%E6%9E%9C%E5%88%86%E6%9E%90%EF%BC%9A" style="margin-left:0cm;"><strong><span style="color:#222222;">（四）结果分析：</span></strong></h3> 
<p style="margin-left:0cm;">从总体效果：所拟合模型修正后可决系数为0.7161，模型整体拟合优度较好，且各系数显著性较好；</p> 
<p style="margin-left:0cm;">从污染物角度：可以看出在SO2、NO2、CO和O3这四种污染物当中，NO2对PM2.5的影响最为严重，其次是SO2，接下来是O3，相对而言CO对PM2.5的影响最小因此我们应该重点关注于SO2和NO2的治理。比如涉及SO2和NO2排放的污染源或行业包括火电、石油炼制、有机化工、钢铁、有色等，所以可以考虑这类行业的污染检测或者技术革新；</p> 
<p style="margin-left:0cm;">从天气角度：当风向靠近西或者北时，PM2.5的密度曲线会更高更靠近0，当风向靠近南或者东时，发生PM2.5较大的事件的频率就会变高，而实际生活中大风可使空气流动性增强，污染物不易滞留，因此达到驱霾的目的，而北京的西北风往往是来自蒙古西伯利亚高压带，风力往往比东南风强，故驱霾效果更好，数据与生活经验相符。</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"> </p> 
<h2 id="%E4%B8%89%E3%80%81%E7%A0%94%E7%A9%B6%E9%97%AE%E9%A2%98%E4%BA%8C" style="margin-left:0cm;">三、研究问题二</h2> 
<h3 style="margin-left:0cm;"><strong>（一）研究问题</strong></h3> 
<p style="margin-left:0cm;">分析北京市奥体中心2013年1月到年月日的PM2.5存在的变化规律，并试图用分析结果对PM2.5的变化情况进行短期预测。</p> 
<h3 style="margin-left:0cm;"><strong>（二）研究方法</strong></h3> 
<p style="margin-left:0cm;">采用ARIMA模型、指数平滑模型时间序列分析。</p> 
<h3 style="margin-left:0cm;"><strong>（三）研究步骤</strong></h3> 
<h4 id="1.%E5%89%8D%E6%9C%9F%E5%87%86%E5%A4%87" style="margin-left:0cm;"><strong><span style="color:#222222;">1.</span></strong><strong><span style="color:#222222;">前期准备</span></strong></h4> 
<p style="margin-left:0cm;">（1）平稳性检验：</p> 
<p style="margin-left:0cm;">用于时间序列建模的数据必须是平稳的，从下面的2013-2017年PM2.5折线图可以看出序列大致平稳，同时在研究问题一中我们已经对序列做了ADF检验，结果是序列平稳。</p> 
<p style="margin-left:0cm;"><img alt="" height="283" src="https://images2.imgbox.com/23/59/ypgk9re8_o.png" width="354"></p> 
<p style="margin-left:0cm;">（2）缺失值处理：</p> 
<p style="margin-left:0cm;">由于时间序列分析需要完整的观测，因此采用KNN方法补齐缺失值</p> 
<p style="margin-left:0cm;">（3）观察序列季节性特征：</p> 
<p style="margin-left:0cm;">从上面的时间序列折线图能大概看出PM2.5具有秋冬高、春夏低的季节性变化，对数据进行更多的可视化以探求其他季节性特征。</p> 
<p style="margin-left:0cm;">以下四张图分别为按几时、星期几、一个月中的第几天和几月绘制的盒图，并将盒图按均值排序，可以看出只有小时（第一幅图）和月份（第四副图）具有较为明显的季节性趋势，因此接下来我们重点考察以24个小时和一年（8766个小时）为周期的季节性变化。</p> 
<p style="margin-left:0cm;"><img alt="" height="289" src="https://images2.imgbox.com/1b/2e/MOCcXLeQ_o.png" width="398"><img alt="" height="299" src="https://images2.imgbox.com/d3/31/beXDi75U_o.png" width="374"></p> 
<p style="margin-left:0cm;"><img alt="" height="305" src="https://images2.imgbox.com/1e/11/P9uDrDtW_o.png" width="389"><img alt="" height="307" src="https://images2.imgbox.com/1a/b3/m6KYvUiK_o.png" width="376"></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">（4）观察序列长期趋势：</p> 
<p style="margin-left:0cm;">分别绘制2013-2017年PM2.5的密度分布曲线如下，可以看出从2013年到2016年，PM2.5的分布逐年向左，即PM2.5值总体上变小，预测这是因为2017年的样本只有1-2月，为冬季样本，和全年PM2.5分布可能会有偏差。</p> 
<p style="margin-left:0cm;"><img alt="" height="422" src="https://images2.imgbox.com/a5/6e/5EIiAbJJ_o.png" width="527"></p> 
<h4 id="2.%E5%BB%BA%E7%AB%8BARIMA%E6%A8%A1%E5%9E%8B" style="margin-left:0cm;"><strong><span style="color:#222222;">2.</span></strong><strong><span style="color:#222222;">建立</span></strong><strong><span style="color:#222222;">ARIMA</span></strong><strong><span style="color:#222222;">模型</span></strong></h4> 
<p style="margin-left:0cm;">（1）定阶：</p> 
<p style="margin-left:0cm;">①自相关系数、偏自相关系数定阶：ACF图和PACF图分别如下，自相关系数和偏相关系数都呈拖尾，该序列不是AR模型，也不是MA模型，观察截尾定阶的方法失效。</p> 
<p style="margin-left:0cm;"><img alt="" height="384" src="https://images2.imgbox.com/dc/2f/QCv8de0z_o.png" width="480"></p> 
<p style="margin-left:0cm;">②BIC准则定阶：</p> 
<p style="margin-left:0cm;">R语言中存在两个函数都是利用BIC准则最小来定阶，由于其原理不同就分别尝试。</p> 
<p style="margin-left:0cm;"><span style="color:#000000;">a. armasubsets函数</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">该函数使用长自回归法，使用足够高阶的AR模型来逼近任意平稳序列，先估计逆转形式的参数，近似的求出原模型参数的估计值，可初步判断出模型为带有均值项的ARMA(13,23)过程，同时R给出该定阶结果的BIC值为93000。</span></p> 
<ol><li><span style="color:#000000;">auto.arima函数</span></li></ol> 
<p style="margin-left:0cm;"><span style="color:#000000;">该函数的原理是傅里叶展开的时间序列频域分析法，组合不同频率不同周期的波，并且支持带有季节性趋势的时间序列拟合，所以分别尝试不带季节性趋势序列的auto.arima拟合和以24小时为季节性周期的auto.arima拟合。</span></p> 
<ol><li><span style="color:#000000;">不带季节性趋势定阶结果：ARIMA(1,0,2)</span></li><li><span style="color:#000000;">带季节性趋势定阶结果：ARIMA(1,0,2)(0,0,2)[24]</span></li></ol> 
<p style="margin-left:0cm;">（2）参数估计：</p> 
<p style="margin-left:0cm;">在没有先验分布的情况下，采用最小二乘法分别对上面两个已经定阶的模型进行参数估计，结果如下。</p> 
<p style="margin-left:0cm;">模型①无季节性因子</p> 
<p style="margin-left:0cm;"><img alt="" height="42" src="https://images2.imgbox.com/c5/38/mE4MSYc0_o.png" width="808"></p> 
<p style="margin-left:0cm;">模型②有季节性因子，以一天（24h）为周期</p> 
<p style="margin-left:0cm;"><img alt="" height="33" src="https://images2.imgbox.com/a1/a0/Wz0TIWqf_o.png" width="1030">  </p> 
<p style="margin-left:0cm;">（3）残差检验：</p> 
<p style="margin-left:0cm;">进行Box Test，其中box.test函数需要参数lag,对于模型①，使用MA部分的阶数2，对于模型②，根据forecast包的作者Rob J Hyndman的书Forecasting : Principles and Practice中的建议，当拟合模型具有季节性变化时，且以m为周期时，参数lag设置为2m。</p> 
<p style="margin-left:0cm;">对于模型①，p&gt;0.05，不拒绝原假设，认为是白噪声；</p> 
<p style="margin-left:0cm;">对于模型②，p&lt;0.05,拒绝原假设，认为不是白噪声。</p> 
<table align="center" border="1" cellspacing="0"><tbody><tr><td style="vertical-align:top;"> <p style="margin-left:0cm;"><span style="color:#222222;">ARIMA(1,0,2)</span><span style="color:#222222;">模型类型</span></p> </td><td style="vertical-align:top;"> <p style="margin-left:0cm;"><em><span style="color:#222222;">χ2</span></em><img alt="" height="42" src="https://images2.imgbox.com/0d/8d/KaAh2ewG_o.png" width="30"></p> </td><td style="vertical-align:top;"> <p style="margin-left:0cm;"><span style="color:#222222;">df</span></p> </td><td style="vertical-align:top;"> <p style="margin-left:0cm;"><span style="color:#222222;">P</span><span style="color:#222222;">值</span></p> </td></tr><tr><td style="vertical-align:top;"> <p style="margin-left:0cm;">无季节性因子（模型①）</p> </td><td style="vertical-align:top;"> <p style="margin-left:0cm;"><span style="color:#222222;">0.0040207</span></p> </td><td style="vertical-align:top;"> <p style="margin-left:0cm;"><span style="color:#222222;">2</span></p> </td><td style="vertical-align:top;"> <p style="margin-left:0cm;"><span style="color:#222222;">0.998</span></p> </td></tr><tr><td style="vertical-align:top;"> <p style="margin-left:0cm;">有季节性因子（模型②）</p> </td><td style="vertical-align:top;"> <p style="margin-left:0cm;"><span style="color:#222222;">28721</span></p> </td><td style="vertical-align:top;"> <p style="margin-left:0cm;"><span style="color:#222222;">48</span></p> </td><td style="vertical-align:top;"> <p style="margin-left:0cm;"><span style="color:#222222;">&lt; </span><em><span style="color:#222222;">2.2×10-16</span></em><img alt="" height="42" src="https://images2.imgbox.com/42/85/8FqVEA8Z_o.png" width="139"></p> </td></tr></tbody></table> 
<p style="margin-left:0cm;">（4）预测：</p> 
<p style="margin-left:0cm;">PM2.5值的300阶预测结果分别如下，两种ARIMA模型的预测效果相当，差别极其细微；可以看出模型只能预测出一小截趋势，当预测阶数再增加时，只能预测出均值。</p> 
<p style="margin-left:0cm;"><img alt="" height="310" src="https://images2.imgbox.com/83/90/0YtFQMi0_o.png" width="388"><img alt="" height="309" src="https://images2.imgbox.com/ce/7a/RcuLjslz_o.png" width="386"></p> 
<h4 id="3.%E6%8C%87%E6%95%B0%E5%B9%B3%E6%BB%91%E6%A8%A1%E5%9E%8B" style="margin-left:0cm;"><strong><span style="color:#222222;">3.</span></strong><strong><span style="color:#222222;">指数平滑模型</span></strong></h4> 
<p style="margin-left:0cm;">（1）拟合：分别考虑对以天为周期和年（8766h）为周期，按HoltWinters指数平滑法建立时间序列模型。</p> 
<p style="margin-left:0cm;">以天为周期的指数平滑建模拟合效果如下，可以看出，拟合效果较好。</p> 
<p style="margin-left:0cm;"><img alt="" height="414" src="https://images2.imgbox.com/bd/47/gA6694xx_o.png" width="517"></p> 
<p style="margin-left:0cm;">以年为周期的指数平滑模型拟合出了大量的绝对值较大的负值，这是不合理的，因此舍弃按年（8766h）为周期的指数平滑模型。</p> 
<ol><li>预测：</li></ol> 
<p style="margin-left:0cm;">对以天为周期的指数平滑模型进行300阶预测，并绘图如下</p> 
<p style="margin-left:0cm;"><img alt="" height="384" src="https://images2.imgbox.com/da/8d/dKjTUHZb_o.png" width="480"></p> 
<p style="margin-left:0cm;">可以看出，该模型预测结果存在负值，而且有着明显的完全相同的波动趋势，预测效果十分差。</p> 
<p>   2.  模型改进：TBATS模型</p> 
<p style="margin-left:0cm;">①模型介绍：TS 模型全称为Exponential smoothing state space model with Box-Cox transformation, ARMA errors, Trend and Seasonal components，使用了时间序列频域分析法，可以进行多季节性时间序列的建模。由于PM2.5序列既具有一天（24h）的周期，又具有一年（8766h）的周期，所以可以尝试该方法。</p> 
<p style="margin-left:0cm;">②拟合： 先将PM2.5转化为msts格式，再使用tbats()函数。</p> 
<p style="margin-left:0cm;">参数估计结果如下：</p> 
<p style="margin-left:0cm;">  Lambda = 0.347269</p> 
<p style="margin-left:0cm;">  Alpha = 1.073336</p> 
<p style="margin-left:0cm;">  Beta = -0.04546997</p> 
<p style="margin-left:0cm;">  Damping Parameter: = 0.957411</p> 
<p style="margin-left:0cm;">绘制一段拟合图像如下，可以看出拟合效果的十分好，直观上存在过拟合的可能。</p> 
<p style="margin-left:0cm;"><img alt="" height="370" src="https://images2.imgbox.com/54/46/OAVVpcZ8_o.png" width="585"></p> 
<p style="margin-left:0cm;">③残差检验：原假设为残差是白噪声。在显著性水平为0.05的情况下，拒绝原假设，认为残差不是白噪声。</p> 
<p style="margin-left:0cm;">④预测：同样绘制300阶预测图像如下，可以看出其预测效果和ARIMA模型较为相似，即在一定阶数后就只能预测均值而不能预测趋势变化。</p> 
<p style="margin-left:0cm;"><img alt="" height="475" src="https://images2.imgbox.com/da/0b/IiYX3eKo_o.png" width="595"></p> 
<p style="margin-left:0cm;"> </p> 
<h3 id="%EF%BC%88%E5%9B%9B%EF%BC%89%E7%BB%93%E6%9E%9C%E5%88%86%E6%9E%90" style="margin-left:0cm;"><strong><span style="color:#222222;">（四）结果分析</span></strong></h3> 
<h4 id="1.%E6%A8%A1%E5%9E%8B%E6%80%BB%E4%BD%93%E8%AF%84%E4%BB%B7" style="margin-left:0cm;"><strong>1.</strong><strong>模型总体评价</strong></h4> 
<p style="margin-left:0cm;">（1）拟合效果：</p> 
<p style="margin-left:0cm;">ARIMA(1,0,2)(0,0,2)[24]和BATS(0.347, {0,0}, 0.957, -)拟合的BIC值分别为314897.3和556018.8，从BIC值越小越好的角度来看，ARIMA模型比指数平滑模型拟合的更好，同时TBATS模型也有过拟合的倾向。</p> 
<p style="margin-left:0cm;">（2）预测效果：</p> 
<p style="margin-left:0cm;">两种模型只能预测一小部分的PM2.5值，近期的观测值对当前值的影响较大，时间越是久远对当前值的影响就越小；当预测阶数继续增大时，预测结果回归到平均水平， 这与模型阶数较低有关，序列的记忆性较短。</p> 
<p style="margin-left:0cm;">根据所绘制的图像，ARIMA(1,0,2)(0,0,2)[24]和BATS(0.347, {0,0}, 0.957, -)效果相似，即只考虑24小时的季节性变化与同时考虑24小时和一年四季的时间序列预测效果相似，推测这是由于以年为周期时，样本量只有4年，建立模型时样本量太少，故无法很好地预测。</p> 
<h4 id="2.%20%E6%A8%A1%E5%9E%8B%E7%BB%93%E8%AE%BA" style="margin-left:0cm;"><strong>2. </strong><strong>模型结论</strong></h4> 
<p style="margin-left:0cm;">（1）北京市奥体中心PM2.5时间分布特点</p> 
<p style="margin-left:0cm;">PM2.5基本在0-100的范围内波动，且平均值在50以下，但是一年之中总有一段时间PM2.5的值会处于230-400的范围，甚至是爆表。这说明，北京市奥体中心附近的大气污染一年中的大部分时间相对较正常，小部分时间内大气污染非常严重。</p> 
<p style="margin-left:0cm;">（2）北京市奥体中心PM2.5季节性变化趋势</p> 
<p style="margin-left:0cm;">① PM2.5的变化受季节的影响呈现周期性，总是先上升再减少轮回波动。在一年中，从冬季到夏季呈下降趋势，从夏季到冬季呈上升趋势；这与冬季北京供暖，煤炭焚烧量增大、排放增大的先验信息相符。</p> 
<p style="margin-left:0cm;">② PM2.5在一天中也具有季节性变化，下午的PM2.5值较低，在午夜23时-2时PM2.5值较高，早晚的PM2.5值介于两者之间，这与2013-2017年北京日间不允许大型货车通行、只有午夜允许，且国内存在大量大型货车污染物排放超过国家标准的先验信息相符。</p> 
<p style="margin-left:0cm;">（3）北京市奥体中心未来150小时PM2.5变化</p> 
<p style="margin-left:0cm;">从2017年2月28日23:00起，未来的150个小时PM2.5呈上升趋势，且持续增加的可能性较大。未来的150个小时以后，难以预测出具体的趋势，PM2.5变化的均值仍是45，但其波动难以刻画。</p> 
<p style="margin-left:0cm;"> </p> 
<p> </p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">附录一 回归部分代码</p> 
<p style="margin-left:0cm;">一、载入数据</p> 
<p style="margin-left:0cm;">set.seed(1)</p> 
<p style="margin-left:0cm;">path &lt;- "C:/Users/91333/Documents/semiester5/R course/course_assignment/PRSA_Data_20130301-20170228"</p> 
<p style="margin-left:0cm;">fileNames &lt;- dir(path)</p> 
<p style="margin-left:0cm;">filePath &lt;- sapply(fileNames, function(x){<!-- --></p> 
<p style="margin-left:0cm;">  paste(path,x,sep='/')})  </p> 
<p style="margin-left:0cm;">bj_data &lt;- lapply(filePath, function(x){<!-- --></p> 
<p style="margin-left:0cm;">  read.csv(x, header=T)})</p> 
<p style="margin-left:0cm;">alldata &lt;- rbind(bj_data[[1]],bj_data[[2]],bj_data[[3]],bj_data[[4]],bj_data[[5]],bj_data[[6]],bj_data[[7]],bj_data[[8]],bj_data[[9]],bj_data[[10]],bj_data[[11]],bj_data[[12]])</p> 
<p style="margin-left:0cm;">Aotizhongxin &lt;- bj_data[[1]]</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">二、绘图</p> 
<p style="margin-left:0cm;">1. 绘制12观测点PM2.5分布盒图</p> 
<p style="margin-left:0cm;">ggplot(alldata,aes(x = reorder(as.factor(station), PM2.5, FUN = mean), y = PM2.5))+geom_boxplot(fill="lightblue",alpha=0.4) +geom_violin(fill="pink",alpha=0.3) +  xlab("station")</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">2. 绘各解释变量与PM2.5的散点图、PM2.5以风向分类的密度曲线</p> 
<p style="margin-left:0cm;">ggplot(Aotizhongxin2, aes(x=SO2,y=PM2.5))+geom_point(alpha=0.1)+geom_smooth()</p> 
<p style="margin-left:0cm;">ggplot(Aotizhongxin2, aes(x=NO2,y=PM2.5))+geom_point(alpha=0.1)+geom_smooth()</p> 
<p style="margin-left:0cm;">ggplot(Aotizhongxin2, aes(x=CO,y=PM2.5))+geom_point(alpha=0.1)+geom_smooth()</p> 
<p style="margin-left:0cm;">ggplot(Aotizhongxin2, aes(x=O3,y=PM2.5))+geom_point(alpha=0.1)+geom_smooth()</p> 
<p style="margin-left:0cm;">ggplot(Aotizhongxin2, aes(x=TEMP,y=PM2.5))+geom_point(alpha=0.1)+geom_smooth()</p> 
<p style="margin-left:0cm;">ggplot(Aotizhongxin2, aes(x=TEMP,y=PM2.5))+geom_point(alpha=0.1)+geom_smooth()</p> 
<p style="margin-left:0cm;">ggplot(Aotizhongxin2, aes(x=PRES,y=PM2.5))+geom_point(alpha=0.1)+geom_smooth()</p> 
<p style="margin-left:0cm;">ggplot(Aotizhongxin2, aes(x=DEWP,y=PM2.5))+geom_point(alpha=0.1)+geom_smooth()</p> 
<p style="margin-left:0cm;">ggplot(Aotizhongxin2, aes(x=RAIN,y=PM2.5))+geom_point(alpha=0.1)+geom_smooth()</p> 
<p style="margin-left:0cm;">ggplot(Aotizhongxin2, aes(x=WSPM,y=PM2.5))+geom_point(alpha=0.1)+geom_smooth()</p> 
<p style="margin-left:0cm;">ggplot(Aotizhongxin2,aes(x=PM2.5,fill=reorder(wd,PM2.5,FUN = median)))+geom_density(alpha=0.3)</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">三、缺失值处理</p> 
<p style="margin-left:0cm;">1．缺失值统计</p> 
<p style="margin-left:0cm;">list("数据集"="Aotizhongxin","缺失值"=sum(is.na(Aotizhongxin_data)),"缺失行"=sum(!complete.cases(Aotizhongxin_data)))</p> 
<p style="margin-left:0cm;">pMiss&lt;-function(x){<!-- --></p> 
<p style="margin-left:0cm;">  sum(is.na(x))/length(x)*100</p> 
<p style="margin-left:0cm;">}</p> 
<p style="margin-left:0cm;">sapply(Guanyuan_data,pMiss)</p> 
<p style="margin-left:0cm;">含有缺失值的样本大概占总样本的10%左右，但为保证充分利用数据，不首先考虑删除缺失值，CO与O3缺失值比率占其总数据最高，约为5%，缺失较少</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">2. 直接删除</p> 
<p style="margin-left:0cm;">Aotizhongxin&lt;-na.exclude(Aotizhongxin_data)</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">四、 平稳性检验</p> 
<p style="margin-left:0cm;">library(tseries)#ADF检验</p> 
<p style="margin-left:0cm;">list(adf.test(Aotizhongxin$PM2.5),</p> 
<p style="margin-left:0cm;">     adf.test(Aotizhongxin$PM10),</p> 
<p style="margin-left:0cm;">     adf.test(Aotizhongxin$SO2),</p> 
<p style="margin-left:0cm;">     adf.test(Aotizhongxin$NO2),</p> 
<p style="margin-left:0cm;">     adf.test(Aotizhongxin$CO),</p> 
<p style="margin-left:0cm;">     adf.test(Aotizhongxin$O3),</p> 
<p style="margin-left:0cm;">     adf.test(Aotizhongxin$TEMP),</p> 
<p style="margin-left:0cm;">     adf.test(Aotizhongxin$PRES),</p> 
<p style="margin-left:0cm;">     adf.test(Aotizhongxin$DEWP),</p> 
<p style="margin-left:0cm;">     adf.test(Aotizhongxin$RAIN),</p> 
<p style="margin-left:0cm;">     adf.test(Aotizhongxin$wd))</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">五、 多元线性回归</p> 
<p style="margin-left:0cm;">1．建立哑变量</p> 
<p style="margin-left:0cm;">dummy&lt;-model.matrix(~wd, Aotizhongxin)</p> 
<p style="margin-left:0cm;">Aotizhongxin&lt;-cbind(Aotizhongxin[-16],dummy[,-1])</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">2．全变量线性回归</p> 
<p style="margin-left:0cm;">allmodel1 &lt;- lm(PM2.5~., data = Aotizhongxin[,-c(1:5,7,17)])</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">看全变量线性回归拟合效果</p> 
<p style="margin-left:0cm;">plot(allmodel1)</p> 
<p style="margin-left:0cm;">library(car)</p> 
<p style="margin-left:0cm;">vif(allmodel1)</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"> </p> 
<ol><li>  10折交叉验证筛选变量</li></ol> 
<p style="margin-left:0cm;">library(class)</p> 
<p style="margin-left:0cm;">library(caret)</p> 
<p style="margin-left:0cm;"> </p> 
<ol><li><span style="color:#000000;">以利用createFolds使得数据集拆分时，PM2.5在十份中分布大体均匀</span></li></ol> 
<p style="margin-left:0cm;">folds=createFolds(Aotizhongxin$PM2.5,k=10)</p> 
<p style="margin-left:0cm;">str(folds)</p> 
<p style="margin-left:0cm;"> </p> 
<ol><li><span style="color:#000000;">编写可以利用输入变量建立线性回归、输出MSE的函数</span></li></ol> 
<p style="margin-left:0cm;">cv_results &lt;- function(yxs){temp1 &lt;- sapply(folds, function(x){<!-- --></p> 
<p style="margin-left:0cm;">  train = yxs[-x, ]</p> 
<p style="margin-left:0cm;">  test = yxs[x, ]</p> 
<p style="margin-left:0cm;">  actual &lt;- test$regress_y</p> 
<p style="margin-left:0cm;">  test$regress_y &lt;- NULL</p> 
<p style="margin-left:0cm;">  model1 &lt;- lm(train$regress_y~.,data = train)</p> 
<p style="margin-left:0cm;">  pred &lt;- predict(model1, new = test)</p> 
<p style="margin-left:0cm;">  return(sum((actual - pred)^2))</p> 
<p style="margin-left:0cm;">  return(temp1)</p> 
<p style="margin-left:0cm;">})}</p> 
<p style="margin-left:0cm;">regress_x &lt;- Aotizhongxin[,-c(1:7,17)]</p> 
<p style="margin-left:0cm;">regress_y &lt;- Aotizhongxin[,6]</p> 
<p style="margin-left:0cm;"> </p> 
<ol><li><span style="color:#000000;">以交叉验证为准则，使用backward，进行变量选择</span></li></ol> 
<p style="margin-left:0cm;">criterion &lt;-  mean(cv_results(cbind(regress_x, regress_y)))</p> 
<p style="margin-left:0cm;">while (TRUE){<!-- --></p> 
<p style="margin-left:0cm;">temp3 &lt;- colMeans(sapply(1:length(regress_x),function(n){<!-- --></p> 
<p style="margin-left:0cm;">  cv_results(cbind(regress_y, regress_x[,-n]))</p> 
<p style="margin-left:0cm;">  }</p> 
<p style="margin-left:0cm;">  ))</p> 
<p style="margin-left:0cm;">  if (criterion &lt;= min(temp3)){break}</p> 
<p style="margin-left:0cm;">  regress_x &lt;- regress_x[, -which.min(temp3)]</p> 
<p style="margin-left:0cm;">  criterion &lt;- min(temp3)</p> 
<p style="margin-left:0cm;">}</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">finalmodel &lt;- lm(regress_y ~., data = cbind(regress_x,regress_y))</p> 
<p style="margin-left:0cm;">summary(finalmodel)</p> 
<p style="margin-left:0cm;"> </p> 
<ol><li><span style="color:#000000;">逐步回归筛选变量</span></li></ol> 
<p style="margin-left:0cm;">stepmodel &lt;- stepAIC(object=allmodle1, direction = “backward”)</p> 
<p style="margin-left:0cm;">summary(stepmodle)</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">5．模型检验</p> 
<p style="margin-left:0cm;">a. 正态性检验</p> 
<p style="margin-left:0cm;">library(car)</p> 
<p style="margin-left:0cm;">par(mfrow=c(1,1))</p> 
<p style="margin-left:0cm;">qqPlot(stepmodle,main="Q-Q Plot")</p> 
<p style="margin-left:0cm;">b 独立性检验</p> 
<p style="margin-left:0cm;">durbinWatsonTest(stepmodle)#拒绝原假设rho==0，认为随机扰动项存在自相关</p> 
<p style="margin-left:0cm;">c. 线性检验</p> 
<p style="margin-left:0cm;">crPlots(stepmodle)#RAIN不是线性的</p> 
<p style="margin-left:0cm;">d. 同方差检验</p> 
<p style="margin-left:0cm;">ncvTest(stepmodle)</p> 
<p style="margin-left:0cm;">spreadLevelPlot(stepmodle)</p> 
<p style="margin-left:0cm;">e. 模型假设综合检验</p> 
<p style="margin-left:0cm;">library(gvlma)</p> 
<p style="margin-left:0cm;">gvmodel&lt;-gvlma(stepmodle)</p> 
<p style="margin-left:0cm;">summary(gvmodel)</p> 
<p style="margin-left:0cm;">f. 多重共线性</p> 
<p style="margin-left:0cm;">vif(stepmodle)</p> 
<p style="margin-left:0cm;">g. 鉴别离群点</p> 
<p style="margin-left:0cm;">outlierTest(stepmodle)</p> 
<p style="margin-left:0cm;">h. 鉴别强影响点</p> 
<p style="margin-left:0cm;">influencePlot(stepmodle)</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">6．模型改进</p> 
<p style="margin-left:0cm;">a. 对变量取对数</p> 
<p style="margin-left:0cm;"><a name="_Hlk29130628">对全部大于</a>0的变量直接取对数，对大于等于0的变量，把0替换为0.01再取对数，对存在负值的变量和哑变量不取对数</p> 
<p style="margin-left:0cm;">logAotizhongxin &lt;- Aotizhongxin</p> 
<p style="margin-left:0cm;">logAotizhongxin$WSPM[logAotizhongxin$WSPM==0] &lt;- 0.01</p> 
<p style="margin-left:0cm;">logAotizhongxin&lt;-cbind(log(logAotizhongxin[,-c(1:5,7,12,14,15,17:32)],logAotizhongxin[,c(12, 14, 15, 18:32)])</p> 
<p style="margin-left:0cm;">allmodel2 &lt;- lm(PM2.5~., data = logAotizhongxin)</p> 
<p style="margin-left:0cm;">library("MASS")</p> 
<p style="margin-left:0cm;">AICmodel2 &lt;- stepAIC(allmodel2, direction = "backward")</p> 
<p style="margin-left:0cm;">plot(AICmodel2)</p> 
<p style="margin-left:0cm;">library(carData)</p> 
<p style="margin-left:0cm;">library(car)</p> 
<p style="margin-left:0cm;">ncvTest(AICmodel2)</p> 
<p style="margin-left:0cm;">durbinWatsonTest(AICmodel2)</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">b. NeweyWest方法修正标准误差</p> 
<p style="margin-left:0cm;">library("AER")</p> 
<p style="margin-left:0cm;">coeftest(stepmodle, vcov. = NeweyWest)</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">附录二 时间序列部分<a name="%E4%B8%80%E5%88%9D%E6%AD%A5%E6%8E%A2%E7%B4%A2%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%87%86%E5%A4%87">代码</a></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">一、初步探索与数据准备</p> 
<p><span style="color:#5b9bd5;"><a name="%E4%B8%80%E7%BC%BA%E5%A4%B1%E5%80%BC%E8%A1%A5%E9%BD%90">（一）、缺失值补齐</a></span></p> 
<p style="margin-left:0cm;">由于需要完整观测，使用KNN方法对缺失值补齐。</p> 
<p style="margin-left:0cm;"><span style="color:#204a87;"><strong>require</strong></span><span style="color:#000000;">(DMwR)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Aotizhongxin1 &lt;-</span> <span style="color:#204a87;"><strong>knnImputation</strong></span><span style="color:#000000;">(Aotizhongxin)</span></p> 
<p><span style="color:#5b9bd5;"><a name="%E4%BA%8C%E7%BB%98%E5%9B%BE%E4%B8%8E%E5%B9%B3%E7%A8%B3%E6%80%A7%E6%A3%80%E9%AA%8C">（二）、绘图与平稳性检验</a></span></p> 
<p style="margin-left:0cm;">由全数据的时间序列图可以看出PM2.5具有以年为单位的时间序列趋势，分月份、星期几、几号、几时画出盒图。</p> 
<p style="margin-left:0cm;"><span style="color:#204a87;"><strong>library</strong></span><span style="color:#000000;">(ggplot2)</span><br><span style="color:#000000;">time &lt;-</span> <span style="color:#204a87;"><strong>seq.POSIXt</strong></span><span style="color:#000000;">(</span><span style="color:#204a87;">from =</span> <span style="color:#204a87;"><strong>as.POSIXct</strong></span><span style="color:#000000;">(</span><span style="color:#4e9a06;">"2013-03-01"</span><span style="color:#000000;">), </span><span style="color:#204a87;">to =</span> <span style="color:#204a87;"><strong>as.POSIXct</strong></span><span style="color:#000000;">(</span><span style="color:#4e9a06;">"2017-05-28 23:00:00 "</span><span style="color:#000000;">), </span><span style="color:#204a87;">by =</span> <span style="color:#4e9a06;">'hour'</span><span style="color:#000000;">)</span><br><span style="color:#204a87;"><strong>ggplot</strong></span><span style="color:#000000;">(Aotizhongxin1)</span><span style="color:#ce5c00;"><strong>+</strong></span><span style="color:#204a87;"><strong>geom_line</strong></span><span style="color:#000000;">(</span><span style="color:#204a87;"><strong>aes</strong></span><span style="color:#000000;">(</span><span style="color:#204a87;">y=</span><span style="color:#000000;">PM2</span><span style="color:#0000cf;">.5</span><span style="color:#000000;">, </span><span style="color:#204a87;">x=</span><span style="color:#000000;">time[</span><span style="color:#0000cf;">1</span><span style="color:#ce5c00;"><strong>:</strong></span><span style="color:#0000cf;">35064</span><span style="color:#000000;">])) </span><span style="color:#ce5c00;"><strong>+</strong></span> <span style="color:#204a87;"><strong>xlab</strong></span><span style="color:#000000;">(</span><span style="color:#4e9a06;">"</span><span style="color:#4e9a06;">时间"</span><span style="color:#000000;">)</span><span style="color:#ce5c00;"><strong>+</strong></span><span style="color:#204a87;"><strong>labs</strong></span><span style="color:#000000;">(</span><span style="color:#204a87;">title =</span> <span style="color:#4e9a06;">"2013-2017</span><span style="color:#4e9a06;">年PM2.5</span><span style="color:#4e9a06;">折线图"</span><span style="color:#000000;">)</span><span style="color:#ce5c00;"><strong>+</strong></span><span style="color:#204a87;"><strong>theme</strong></span><span style="color:#000000;">(</span><span style="color:#204a87;">plot.title =</span> <span style="color:#204a87;"><strong>element_text</strong></span><span style="color:#000000;">(</span><span style="color:#204a87;">hjust =</span> <span style="color:#0000cf;">0.5</span><span style="color:#000000;">))</span></p> 
<p style="margin-left:0cm;">由图，我们大致可以看出序列平稳，并且在多元回归部分已经做过ADF检验，数据通过。</p> 
<p><span style="color:#5b9bd5;"><a name="%E4%B8%89%E7%94%9F%E6%88%90ts%E6%A0%BC%E5%BC%8F%E6%95%B0%E6%8D%AE">（三）、生成</a>ts格式数据</span></p> 
<p style="margin-left:0cm;"><span style="color:#204a87;"><strong>library</strong></span><span style="color:#000000;">(forecast)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">PM2</span><span style="color:#0000cf;">.51</span><span style="color:#000000;"> &lt;-</span> <span style="color:#204a87;"><strong>ts</strong></span><span style="color:#000000;">(Aotizhongxin1</span><span style="color:#ce5c00;"><strong>$</strong></span><span style="color:#000000;">PM2</span><span style="color:#0000cf;">.5</span><span style="color:#000000;">)</span><br><span style="color:#000000;">PM2</span><span style="color:#0000cf;">.52</span><span style="color:#000000;"> &lt;-</span> <span style="color:#204a87;"><strong>ts</strong></span><span style="color:#000000;">(Aotizhongxin1</span><span style="color:#ce5c00;"><strong>$</strong></span><span style="color:#000000;">PM2</span><span style="color:#0000cf;">.5</span><span style="color:#000000;">, </span><span style="color:#204a87;">frequency =</span> <span style="color:#0000cf;">24</span><span style="color:#000000;">)</span><br><span style="color:#000000;">PM2</span><span style="color:#0000cf;">.53</span><span style="color:#000000;"> &lt;-</span> <span style="color:#204a87;"><strong>ts</strong></span><span style="color:#000000;">(Aotizhongxin1</span><span style="color:#ce5c00;"><strong>$</strong></span><span style="color:#000000;">PM2</span><span style="color:#0000cf;">.5</span><span style="color:#000000;">, </span><span style="color:#204a87;">frequency =</span> <span style="color:#0000cf;">8766</span><span style="color:#000000;">)</span></p> 
<h4 id="%E4%BA%8C%E3%80%81%E6%8B%9F%E5%90%88ARIMA%E6%A8%A1%E5%9E%8B" style="margin-left:0cm;"><span style="color:#5b9bd5;"><a name="%E4%BA%8C%E6%8B%9F%E5%90%88arima%E6%A8%A1%E5%9E%8B">二、拟合</a>ARIMA模型</span></h4> 
<p><span style="color:#5b9bd5;"><a name="%E4%B8%80%E5%AE%9A%E9%98%B6">(</a>一)、定阶</span></p> 
<ol><li><span style="color:#5b9bd5;"><em><a name="%E8%87%AA%E7%9B%B8%E5%85%B3%E5%9B%BE%E5%92%8C%E5%81%8F%E7%9B%B8%E5%85%B3%E5%9B%BE%E6%B3%95%E5%AE%9A%E9%98%B6"></a>自相关图和偏相关图法定阶</em></span></li></ol> 
<p style="margin-left:0cm;"><span style="color:#204a87;"><strong>par</strong></span><span style="color:#000000;">(</span><span style="color:#204a87;">mfrow=</span><span style="color:#204a87;"><strong>c</strong></span><span style="color:#000000;">(</span><span style="color:#0000cf;">2</span><span style="color:#000000;">,</span><span style="color:#0000cf;">1</span><span style="color:#000000;">), </span><span style="color:#204a87;">mar =</span> <span style="color:#204a87;"><strong>c</strong></span><span style="color:#000000;">(</span><span style="color:#0000cf;">2</span><span style="color:#000000;">,</span><span style="color:#0000cf;">3</span><span style="color:#000000;">,</span><span style="color:#0000cf;">5</span><span style="color:#000000;">,</span><span style="color:#0000cf;">0</span><span style="color:#000000;">), </span><span style="color:#204a87;">mgp=</span><span style="color:#204a87;"><strong>c</strong></span><span style="color:#000000;">(</span><span style="color:#0000cf;">1</span><span style="color:#000000;">,</span><span style="color:#0000cf;">0.3</span><span style="color:#000000;">,</span><span style="color:#0000cf;">0</span><span style="color:#000000;">))</span><br><span style="color:#204a87;"><strong>acf</strong></span><span style="color:#000000;">(PM2</span><span style="color:#0000cf;">.51</span><span style="color:#000000;">, </span><span style="color:#204a87;">main =</span> <span style="color:#4e9a06;">"ACF plot of PM2.5_ts"</span><span style="color:#000000;">)</span><br><span style="color:#204a87;"><strong>pacf</strong></span><span style="color:#000000;">(PM2</span><span style="color:#0000cf;">.51</span><span style="color:#000000;">, </span><span style="color:#204a87;">main =</span> <span style="color:#4e9a06;">"PACF plot of PM2.5_ts"</span><span style="color:#000000;">)</span></p> 
<p style="margin-left:0cm;"> </p> 
<ol><li><span style="color:#5b9bd5;"><em><a name="%E6%A0%B9%E6%8D%AEbic%E5%87%86%E5%88%99%E5%AE%9A%E9%98%B6"></a>根据BIC准则定阶</em></span></li></ol> 
<p><span style="color:#5b9bd5;"><a name="a.-armasubsets%E5%87%BD%E6%95%B0">a. armasubsets</a>函数</span></p> 
<p style="margin-left:0cm;">根据帮助文档，armasubsets函数使用了长自回归法，使用足够高阶的AR模型来逼近任意平稳序列，先估计逆转形式的参数，近似的求出原模型参数的估计值。</p> 
<p style="margin-left:0cm;"><span style="color:#204a87;"><strong>library</strong></span><span style="color:#000000;">(TSA)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">res &lt;-</span> <span style="color:#204a87;"><strong>armasubsets</strong></span><span style="color:#000000;">(</span><span style="color:#204a87;">y=</span><span style="color:#000000;">PM2</span><span style="color:#0000cf;">.51</span><span style="color:#000000;">, </span><span style="color:#204a87;">nar=</span><span style="color:#0000cf;">18</span><span style="color:#000000;">,</span><span style="color:#204a87;">nma=</span><span style="color:#0000cf;">25</span><span style="color:#000000;">,</span><span style="color:#204a87;">y.name=</span><span style="color:#4e9a06;">'test'</span><span style="color:#000000;">,</span><span style="color:#204a87;">ar.method=</span><span style="color:#4e9a06;">'ols'</span><span style="color:#000000;">)</span><br><span style="color:#204a87;"><strong>plot</strong></span><span style="color:#000000;">(res)</span></p> 
<p style="margin-left:0cm;">test-lag1,test-lag2,test-lag12,test-lag13和 error-lag12,error-lag13,error-lag15,error-lag23, 方块最黑，BIC 值最小为93000，那么该函数识别出的模型就是带均值项的 ARMA(13, 23) .</p> 
<p><span style="color:#5b9bd5;"><a name="b.-auto.arima%E5%87%BD%E6%95%B0">b. auto.arima</a>函数</span></p> 
<p style="margin-left:0cm;">auto.arima 函数默认使用 AICc 作为最优模型的判断标准，模型默认 allowdrift = TRUE，即考虑均值项。</p> 
<p style="margin-left:0cm;"><span style="color:#204a87;"><strong>library</strong></span><span style="color:#000000;">(forecast)</span><br><span style="color:#000000;">fitarima1 &lt;-</span> <span style="color:#204a87;"><strong>auto.arima</strong></span><span style="color:#000000;">(PM2</span><span style="color:#0000cf;">.51</span><span style="color:#000000;">,</span><span style="color:#204a87;">seasonal =</span><span style="color:#000000;"> T)</span><br><span style="color:#000000;">fitarima2 &lt;-</span> <span style="color:#204a87;"><strong>auto.arima</strong></span><span style="color:#000000;">(PM2</span><span style="color:#0000cf;">.52</span><span style="color:#000000;">, </span><span style="color:#204a87;">seasonal =</span><span style="color:#000000;"> T)</span></p> 
<p style="margin-left:0cm;">使用auto.arima的定阶结果为ARMA(1,2)，带有均值项。 由于使用auto.arima得出的BIC小于使用长自回归法得出的BIC，所以arima模型的拟合结果为ARMA(1,2)</p> 
<p><span style="color:#5b9bd5;"><a name="%E4%BA%8C%E6%8B%9F%E5%90%88%E4%B8%8E%E9%A2%84%E6%B5%8B">（二）拟合与预测</a></span></p> 
<ol><li><span style="color:#5b9bd5;"><em><a name="%E6%8B%9F%E5%90%88%E7%BB%93%E6%9E%9C"></a>拟合结果</em></span></li></ol> 
<p style="margin-left:0cm;">选择最小二乘的方法,arima模型表达式为<em>x</em><em>t</em><em>=82.5881+0.9522</em><em>x</em><em>t-1</em><em>+0.1489</em><em>ϵ</em><em>t</em><em>-0.0140</em><em>ϵt-1</em><img alt="" height="66" src="https://images2.imgbox.com/d2/aa/gGA9BSjz_o.png" width="725"></p> 
<ol><li><span style="color:#5b9bd5;"><em><a name="%E7%99%BD%E5%99%AA%E5%A3%B0%E6%A3%80%E9%AA%8C"></a>白噪声检验</em></span></li></ol> 
<p style="margin-left:0cm;">白噪声检验</p> 
<p style="margin-left:0cm;"><span style="color:#204a87;"><strong>Box.test</strong></span><span style="color:#000000;">(fitarima1</span><span style="color:#ce5c00;"><strong>$</strong></span><span style="color:#000000;">residuals,</span><span style="color:#204a87;">lag=</span><span style="color:#0000cf;">2</span><span style="color:#000000;">,</span><span style="color:#204a87;">type=</span><span style="color:#4e9a06;">'Ljung'</span><span style="color:#000000;">)</span><br><span style="color:#000000;">## X-squared = 0.0040207, df = 2, p-value = 0.998</span></p> 
<p style="margin-left:0cm;"><span style="color:#204a87;"><strong>Box.test</strong></span><span style="color:#000000;">(fitarima2</span><span style="color:#ce5c00;"><strong>$</strong></span><span style="color:#000000;">residuals,</span><span style="color:#204a87;">lag=</span><span style="color:#0000cf;">48</span><span style="color:#000000;">,</span><span style="color:#204a87;">type=</span><span style="color:#4e9a06;">'Ljung'</span><span style="color:#000000;">)</span><br><span style="color:#000000;">## X-squared = 286.44, df = 48, p-value &lt; 2.2e-16</span></p> 
<p style="margin-left:0cm;">对于第一个模型，p&gt;0.05,认为是白噪声 对于第二个模型，p&gt;0.05,认为不是白噪声</p> 
<ol><li><span style="color:#5b9bd5;"><em><a name="%E9%A2%84%E6%B5%8B%E7%BB%98%E5%9B%BE"></a>预测绘图</em></span></li></ol> 
<p style="margin-left:0cm;"><span style="color:#000000;">forecast_arima1 &lt;-</span> <span style="color:#204a87;"><strong>forecast</strong></span><span style="color:#000000;">(fitarima1, </span><span style="color:#204a87;">h =</span> <span style="color:#0000cf;">300</span><span style="color:#000000;">)</span></p> 
<p style="margin-left:0cm;"><span style="color:#204a87;"><strong>ggplot</strong></span><span style="color:#000000;">() </span><span style="color:#ce5c00;"><strong>+</strong></span> <span style="color:#204a87;"><strong>geom_line</strong></span><span style="color:#000000;">(</span><span style="color:#204a87;"><strong>aes</strong></span><span style="color:#000000;">(</span><span style="color:#204a87;">y=</span><span style="color:#204a87;"><strong>c</strong></span><span style="color:#000000;">(Aotizhongxin1</span><span style="color:#ce5c00;"><strong>$</strong></span><span style="color:#000000;">PM2</span><span style="color:#0000cf;">.5</span><span style="color:#000000;">[</span><span style="color:#0000cf;">34800</span><span style="color:#ce5c00;"><strong>:</strong></span><span style="color:#0000cf;">35064</span><span style="color:#000000;">],forecast_arima1</span><span style="color:#ce5c00;"><strong>$</strong></span><span style="color:#000000;">mean),</span><span style="color:#204a87;">x=</span><span style="color:#000000;">time[</span><span style="color:#0000cf;">34800</span><span style="color:#ce5c00;"><strong>:</strong></span><span style="color:#0000cf;">35364</span><span style="color:#000000;">]))</span><span style="color:#ce5c00;"><strong>+</strong></span> <span style="color:#204a87;"><strong>geom_point</strong></span><span style="color:#000000;">(</span><span style="color:#204a87;"><strong>aes</strong></span><span style="color:#000000;">(</span><span style="color:#204a87;">y=</span><span style="color:#000000;">forecast_arima1</span><span style="color:#ce5c00;"><strong>$</strong></span><span style="color:#000000;">mean,</span><span style="color:#204a87;">x=</span><span style="color:#000000;">time[</span><span style="color:#0000cf;">35065</span><span style="color:#ce5c00;"><strong>:</strong></span><span style="color:#0000cf;">35364</span><span style="color:#000000;">]),</span><span style="color:#204a87;">col=</span><span style="color:#4e9a06;">"red"</span><span style="color:#000000;">)</span><span style="color:#ce5c00;"><strong>+</strong></span><span style="color:#204a87;"><strong>labs</strong></span><span style="color:#000000;">(</span><span style="color:#204a87;">title  =</span> <span style="color:#4e9a06;">"</span><span style="color:#4e9a06;">奥体中心PM2.5</span><span style="color:#4e9a06;">值300</span><span style="color:#4e9a06;">期预测"</span><span style="color:#000000;">,</span><span style="color:#204a87;">subtitle=</span><span style="color:#4e9a06;">"ARIMA(1,0,2)"</span><span style="color:#000000;">) </span><span style="color:#ce5c00;"><strong>+</strong></span><span style="color:#204a87;"><strong>xlab</strong></span><span style="color:#000000;">(</span><span style="color:#204a87;">label =</span> <span style="color:#4e9a06;">"</span><span style="color:#4e9a06;">时间"</span><span style="color:#000000;">) </span><span style="color:#ce5c00;"><strong>+</strong></span> <span style="color:#204a87;"><strong>ylab</strong></span><span style="color:#000000;">(</span><span style="color:#204a87;">label =</span> <span style="color:#4e9a06;">"PM2.5"</span><span style="color:#000000;">)</span><span style="color:#ce5c00;"><strong>+</strong></span><span style="color:#204a87;"><strong>theme</strong></span><span style="color:#000000;">(</span><span style="color:#204a87;">plot.title  =</span> <span style="color:#204a87;"><strong>element_text</strong></span><span style="color:#000000;">(</span><span style="color:#204a87;">hjust =</span> <span style="color:#0000cf;">0.5</span><span style="color:#000000;">))</span></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><span style="color:#000000;">forecast_arima2 &lt;-</span> <span style="color:#204a87;"><strong>forecast</strong></span><span style="color:#000000;">(fitarima2, </span><span style="color:#204a87;">h =</span> <span style="color:#0000cf;">300</span><span style="color:#000000;">)</span></p> 
<p style="margin-left:0cm;"><span style="color:#204a87;"><strong>ggplot</strong></span><span style="color:#000000;">() </span><span style="color:#ce5c00;"><strong>+</strong></span> <span style="color:#204a87;"><strong>geom_line</strong></span><span style="color:#000000;">(</span><span style="color:#204a87;"><strong>aes</strong></span><span style="color:#000000;">(</span><span style="color:#204a87;">y=</span><span style="color:#204a87;"><strong>c</strong></span><span style="color:#000000;">(Aotizhongxin1</span><span style="color:#ce5c00;"><strong>$</strong></span><span style="color:#000000;">PM2</span><span style="color:#0000cf;">.5</span><span style="color:#000000;">[</span><span style="color:#0000cf;">34800</span><span style="color:#ce5c00;"><strong>:</strong></span><span style="color:#0000cf;">35064</span><span style="color:#000000;">],forecast_arima2</span><span style="color:#ce5c00;"><strong>$</strong></span><span style="color:#000000;">mean),</span><span style="color:#204a87;">x=</span><span style="color:#000000;">time[</span><span style="color:#0000cf;">34800</span><span style="color:#ce5c00;"><strong>:</strong></span><span style="color:#0000cf;">35364</span><span style="color:#000000;">]))</span><span style="color:#ce5c00;"><strong>+</strong></span> <span style="color:#204a87;"><strong>geom_point</strong></span><span style="color:#000000;">(</span><span style="color:#204a87;"><strong>aes</strong></span><span style="color:#000000;">(</span><span style="color:#204a87;">y=</span><span style="color:#000000;">forecast_arima2</span><span style="color:#ce5c00;"><strong>$</strong></span><span style="color:#000000;">mean,</span><span style="color:#204a87;">x=</span><span style="color:#000000;">time[</span><span style="color:#0000cf;">35065</span><span style="color:#ce5c00;"><strong>:</strong></span><span style="color:#0000cf;">35364</span><span style="color:#000000;">]),</span><span style="color:#204a87;">col=</span><span style="color:#4e9a06;">"red"</span><span style="color:#000000;">)</span><span style="color:#ce5c00;"><strong>+</strong></span><span style="color:#204a87;"><strong>labs</strong></span><span style="color:#000000;">(</span><span style="color:#204a87;">title  =</span> <span style="color:#4e9a06;">"</span><span style="color:#4e9a06;">奥体中心PM2.5</span><span style="color:#4e9a06;">值300</span><span style="color:#4e9a06;">期预测"</span><span style="color:#000000;">,</span><span style="color:#204a87;">subtitle=</span><span style="color:#4e9a06;">"ARIMA(1,0,2)(0,0,2)[24]"</span><span style="color:#000000;">) </span><span style="color:#ce5c00;"><strong>+</strong></span><span style="color:#204a87;"><strong>xlab</strong></span><span style="color:#000000;">(</span><span style="color:#204a87;">label =</span> <span style="color:#4e9a06;">"</span><span style="color:#4e9a06;">时间"</span><span style="color:#000000;">) </span><span style="color:#ce5c00;"><strong>+</strong></span> <span style="color:#204a87;"><strong>ylab</strong></span><span style="color:#000000;">(</span><span style="color:#204a87;">label =</span> <span style="color:#4e9a06;">"PM2.5"</span><span style="color:#000000;">)</span><span style="color:#ce5c00;"><strong>+</strong></span><span style="color:#204a87;"><strong>theme</strong></span><span style="color:#000000;">(</span><span style="color:#204a87;">plot.title  =</span> <span style="color:#204a87;"><strong>element_text</strong></span><span style="color:#000000;">(</span><span style="color:#204a87;">hjust =</span> <span style="color:#0000cf;">0.5</span><span style="color:#000000;">))</span></p> 
<h4 id="%E4%B8%89%E3%80%81%E6%8C%87%E6%95%B0%E5%B9%B3%E6%BB%91%E6%8B%9F%E5%90%88" style="margin-left:0cm;"><span style="color:#5b9bd5;"><a name="%E4%B8%89%E6%8C%87%E6%95%B0%E5%B9%B3%E6%BB%91%E6%8B%9F%E5%90%88">三、指数平滑拟合</a></span></h4> 
<p style="margin-left:0cm;">分别考虑以24小时和8766小时为周期的指数平滑</p> 
<p style="margin-left:0cm;"><span style="color:#000000;">fithot24&lt;-</span><span style="color:#204a87;"><strong>HoltWinters</strong></span><span style="color:#000000;">(PM2</span><span style="color:#0000cf;">.52</span><span style="color:#000000;">, </span><span style="color:#204a87;">beta =</span><span style="color:#000000;"> F) </span><br><span style="color:#204a87;"><strong>par</strong></span><span style="color:#000000;">(</span><span style="color:#204a87;">mfrow=</span><span style="color:#204a87;"><strong>c</strong></span><span style="color:#000000;">(</span><span style="color:#0000cf;">1</span><span style="color:#000000;">,</span><span style="color:#0000cf;">1</span><span style="color:#000000;">))</span><br><span style="color:#204a87;"><strong>plot</strong></span><span style="color:#000000;">(fithot24)  </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">fithot8766&lt;-</span><span style="color:#204a87;"><strong>HoltWinters</strong></span><span style="color:#000000;">(PM2</span><span style="color:#0000cf;">.53</span><span style="color:#000000;">, </span><span style="color:#204a87;">beta =</span><span style="color:#000000;"> F) </span><br><span style="color:#204a87;"><strong>par</strong></span><span style="color:#000000;">(</span><span style="color:#204a87;">mfrow=</span><span style="color:#204a87;"><strong>c</strong></span><span style="color:#000000;">(</span><span style="color:#0000cf;">1</span><span style="color:#000000;">,</span><span style="color:#0000cf;">1</span><span style="color:#000000;">))</span><br><span style="color:#204a87;"><strong>plot</strong></span><span style="color:#000000;">(fithot8766)  </span></p> 
<p style="margin-left:0cm;">上面这个以8766为周期的指数平滑拟合就不合理了，出现了比较大的负数值。</p> 
<p><span style="color:#5b9bd5;"><a name="%E4%B8%80%E6%8B%9F%E5%90%88%E6%95%88%E6%9E%9C">（一）、拟合效果</a></span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">fithot24_plot &lt;-</span> <span style="color:#204a87;"><strong>data.frame</strong></span><span style="color:#000000;">(</span><span style="color:#204a87;">PM2.5=</span><span style="color:#204a87;"><strong>c</strong></span><span style="color:#000000;">(PM2</span><span style="color:#0000cf;">.51</span><span style="color:#000000;">[</span><span style="color:#0000cf;">9456</span><span style="color:#ce5c00;"><strong>:</strong></span><span style="color:#0000cf;">9556</span><span style="color:#000000;">],fithot24</span><span style="color:#ce5c00;"><strong>$</strong></span><span style="color:#000000;">fitted[</span><span style="color:#0000cf;">9456</span><span style="color:#ce5c00;"><strong>:</strong></span><span style="color:#0000cf;">9556</span><span style="color:#000000;">]),</span><span style="color:#204a87;">difference=</span><span style="color:#204a87;"><strong>rep</strong></span><span style="color:#000000;">(</span><span style="color:#204a87;"><strong>c</strong></span><span style="color:#000000;">(</span><span style="color:#4e9a06;">"actual"</span><span style="color:#000000;">,</span><span style="color:#4e9a06;">"fitted"</span><span style="color:#000000;">),</span><span style="color:#204a87;"><strong>c</strong></span><span style="color:#000000;">(</span><span style="color:#0000cf;">101</span><span style="color:#000000;">,</span><span style="color:#0000cf;">101</span><span style="color:#000000;">)),</span><span style="color:#204a87;">time=</span><span style="color:#204a87;"><strong>c</strong></span><span style="color:#000000;">(time[</span><span style="color:#0000cf;">9456</span><span style="color:#ce5c00;"><strong>:</strong></span><span style="color:#0000cf;">9556</span><span style="color:#000000;">],time[</span><span style="color:#0000cf;">9456</span><span style="color:#ce5c00;"><strong>:</strong></span><span style="color:#0000cf;">9556</span><span style="color:#000000;">]))</span><br><br><span style="color:#204a87;"><strong>ggplot</strong></span><span style="color:#000000;">(fithot24_plot)</span><span style="color:#ce5c00;"><strong>+</strong></span><span style="color:#204a87;"><strong>geom_line</strong></span><span style="color:#000000;">(</span><span style="color:#204a87;"><strong>aes</strong></span><span style="color:#000000;">(</span><span style="color:#204a87;">y=</span><span style="color:#000000;">PM2</span><span style="color:#0000cf;">.5</span><span style="color:#000000;">,</span><span style="color:#204a87;">x=</span><span style="color:#000000;">time,</span><span style="color:#204a87;">group=</span><span style="color:#000000;">difference,</span><span style="color:#204a87;">linetype=</span><span style="color:#000000;">difference))</span><span style="color:#ce5c00;"><strong>+</strong></span><span style="color:#204a87;"><strong>labs</strong></span><span style="color:#000000;">(</span><span style="color:#204a87;">title  =</span> <span style="color:#4e9a06;">"</span><span style="color:#4e9a06;">奥体中心PM2.5</span><span style="color:#4e9a06;">值指数平滑拟合"</span><span style="color:#000000;">,</span><span style="color:#204a87;">subtitle=</span><span style="color:#4e9a06;">"seasonal = 24"</span><span style="color:#000000;">) </span><span style="color:#ce5c00;"><strong>+</strong></span><span style="color:#204a87;"><strong>xlab</strong></span><span style="color:#000000;">(</span><span style="color:#204a87;">label =</span> <span style="color:#4e9a06;">"</span><span style="color:#4e9a06;">时间"</span><span style="color:#000000;">) </span><span style="color:#ce5c00;"><strong>+</strong></span> <span style="color:#204a87;"><strong>ylab</strong></span><span style="color:#000000;">(</span><span style="color:#204a87;">label =</span> <span style="color:#4e9a06;">"PM2.5"</span><span style="color:#000000;">)</span><span style="color:#ce5c00;"><strong>+</strong></span><span style="color:#204a87;"><strong>theme</strong></span><span style="color:#000000;">(</span><span style="color:#204a87;">plot.title  =</span> <span style="color:#204a87;"><strong>element_text</strong></span><span style="color:#000000;">(</span><span style="color:#204a87;">hjust =</span> <span style="color:#0000cf;">0.5</span><span style="color:#000000;">))</span></p> 
<p style="margin-left:0cm;"> </p> 
<p><span style="color:#5b9bd5;"><a name="%E4%BA%8C%E9%A2%84%E6%B5%8B%E6%95%88%E6%9E%9C">（二）、预测效果</a></span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">forecast_fithot24&lt;-</span><span style="color:#204a87;"><strong>forecast</strong></span><span style="color:#000000;">(fithot24,</span><span style="color:#204a87;">h=</span><span style="color:#0000cf;">300</span><span style="color:#000000;">)</span><br><br><span style="color:#204a87;"><strong>ggplot</strong></span><span style="color:#000000;">() </span><span style="color:#ce5c00;"><strong>+</strong></span> <span style="color:#204a87;"><strong>geom_line</strong></span><span style="color:#000000;">(</span><span style="color:#204a87;"><strong>aes</strong></span><span style="color:#000000;">(</span><span style="color:#204a87;">y=</span><span style="color:#204a87;"><strong>c</strong></span><span style="color:#000000;">(PM2</span><span style="color:#0000cf;">.51</span><span style="color:#000000;">[</span><span style="color:#0000cf;">34800</span><span style="color:#ce5c00;"><strong>:</strong></span><span style="color:#0000cf;">35064</span><span style="color:#000000;">],forecast_fithot24</span><span style="color:#ce5c00;"><strong>$</strong></span><span style="color:#000000;">mean),</span><span style="color:#204a87;">x=</span><span style="color:#000000;">time[</span><span style="color:#0000cf;">34800</span><span style="color:#ce5c00;"><strong>:</strong></span><span style="color:#0000cf;">35364</span><span style="color:#000000;">]))</span><span style="color:#ce5c00;"><strong>+</strong></span> <span style="color:#204a87;"><strong>geom_line</strong></span><span style="color:#000000;">(</span><span style="color:#204a87;"><strong>aes</strong></span><span style="color:#000000;">(</span><span style="color:#204a87;">y=</span><span style="color:#000000;">forecast_fithot24</span><span style="color:#ce5c00;"><strong>$</strong></span><span style="color:#000000;">mean,</span><span style="color:#204a87;">x=</span><span style="color:#000000;">time[</span><span style="color:#0000cf;">35065</span><span style="color:#ce5c00;"><strong>:</strong></span><span style="color:#0000cf;">35364</span><span style="color:#000000;">]),</span><span style="color:#204a87;">col=</span><span style="color:#4e9a06;">"red"</span><span style="color:#000000;">,</span><span style="color:#204a87;">size=</span><span style="color:#0000cf;">1</span><span style="color:#000000;">)</span><span style="color:#ce5c00;"><strong>+</strong></span><span style="color:#204a87;"><strong>labs</strong></span><span style="color:#000000;">(</span><span style="color:#204a87;">title  =</span> <span style="color:#4e9a06;">"</span><span style="color:#4e9a06;">奥体中心PM2.5</span><span style="color:#4e9a06;">值300</span><span style="color:#4e9a06;">期预测"</span><span style="color:#000000;">,</span><span style="color:#204a87;">subtitle=</span><span style="color:#4e9a06;">"</span><span style="color:#4e9a06;">指数平滑 seasonal = 24"</span><span style="color:#000000;">) </span><span style="color:#ce5c00;"><strong>+</strong></span><span style="color:#204a87;"><strong>xlab</strong></span><span style="color:#000000;">(</span><span style="color:#204a87;">label =</span> <span style="color:#4e9a06;">"</span><span style="color:#4e9a06;">时间"</span><span style="color:#000000;">) </span><span style="color:#ce5c00;"><strong>+</strong></span> <span style="color:#204a87;"><strong>ylab</strong></span><span style="color:#000000;">(</span><span style="color:#204a87;">label =</span> <span style="color:#4e9a06;">"PM2.5"</span><span style="color:#000000;">)</span><span style="color:#ce5c00;"><strong>+</strong></span><span style="color:#204a87;"><strong>theme</strong></span><span style="color:#000000;">(</span><span style="color:#204a87;">plot.title  =</span> <span style="color:#204a87;"><strong>element_text</strong></span><span style="color:#000000;">(</span><span style="color:#204a87;">hjust =</span> <span style="color:#0000cf;">0.5</span><span style="color:#000000;">))</span></p> 
<p style="margin-left:0cm;">可以看出拟合结果还凑合，预测结果较差。</p> 
<p><span style="color:#5b9bd5;"><a name="%E4%B8%89%E6%8C%87%E6%95%B0%E5%B9%B3%E6%BB%91%E6%B3%95%E6%94%B9%E8%BF%9B">(</a>三)、指数平滑法改进</span></p> 
<p style="margin-left:0cm;">回忆上面的盒图，原数据时间变化，PM2.5的变化是有两方面的，12个月里，PM2.5具有季节性变化，24小时内,PM2.5也有“季节性变化”，考虑多季节性时间序列的建模。</p> 
<ol><li><span style="color:#5b9bd5;"><em><a name="%E5%B0%86%E6%95%B0%E6%8D%AE%E8%BD%AC%E4%B8%BAmsts%E6%A0%BC%E5%BC%8F"></a>将数据转为msts格式</em></span></li></ol> 
<p style="margin-left:0cm;"><span style="color:#204a87;"><strong>library</strong></span><span style="color:#000000;">(forecast)</span><br><span style="color:#000000;">PM2</span><span style="color:#0000cf;">.54</span><span style="color:#000000;"> &lt;-</span> <span style="color:#204a87;"><strong>msts</strong></span><span style="color:#000000;">(Aotizhongxin1</span><span style="color:#ce5c00;"><strong>$</strong></span><span style="color:#000000;">PM2</span><span style="color:#0000cf;">.5</span><span style="color:#000000;">,</span><span style="color:#204a87;">seasonal.periods =</span> <span style="color:#204a87;"><strong>c</strong></span><span style="color:#000000;">(</span><span style="color:#0000cf;">24</span><span style="color:#000000;">,</span><span style="color:#0000cf;">8766</span><span style="color:#000000;">))</span></p> 
<p style="margin-left:0cm;">与ts类型相对应，也存在msts的数据类型，并在转化时注明两种季节性变化。</p> 
<p><span style="color:#5b9bd5;"><em><a name="tbats%E6%8B%9F%E5%90%88">2.tbats</a>拟合</em></span></p> 
<p style="margin-left:0cm;">TBATS model (Exponential smoothing state space model with Box-Cox transformation, ARMA errors, Trend and Seasonal components)</p> 
<p style="margin-left:0cm;">De Livera、Hyndman和Snyder（2011）开发的另一种方法使用傅立叶项与指数平滑状态空间模型和Box-Cox变换的组合，完全自动化。</p> 
<p style="margin-left:0cm;"><span style="color:#000000;">fittbats &lt;-</span> <span style="color:#204a87;"><strong>tbats</strong></span><span style="color:#000000;">(PM2</span><span style="color:#0000cf;">.54</span><span style="color:#000000;">)</span><br><span style="color:#000000;">fittbats</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">## BATS(0.347, {0,0}, 0.957, -)</span><br><span style="color:#000000;">##<br> ## Call: tbats(y = PM2.54)<br> ##<br> ## Parameters<br> ##   Lambda: 0.347269<br> ##   Alpha: 1.073336<br> ##   Beta: -0.04546997<br> ##   Damping Parameter: 0.957411<br> ##<br> ## Seed States:<br> ##             [,1]<br> ## [1,]  0.35764556<br> ## [2,] -0.08296283<br> ## attr(,"lambda")<br> ## [1] 0.3472691<br> ##<br> ## Sigma: 1.154974<br> ## AIC: 556018.8</span></p> 
<ol><li><span style="color:#5b9bd5;"><em><a name="%E6%AE%8B%E5%B7%AE%E7%99%BD%E5%99%AA%E5%A3%B0%E6%A3%80%E9%AA%8C"></a>残差白噪声检验</em></span></li></ol> 
<p style="margin-left:0cm;">这里lag的阶数是这个函数的作者建议的2倍周期</p> 
<p style="margin-left:0cm;"><span style="color:#204a87;"><strong>Box.test</strong></span><span style="color:#000000;">(fittbats</span><span style="color:#ce5c00;"><strong>$</strong></span><span style="color:#000000;">errors,</span><span style="color:#204a87;">lag=</span><span style="color:#0000cf;">48</span><span style="color:#000000;">,</span><span style="color:#204a87;">type=</span><span style="color:#4e9a06;">'Ljung'</span><span style="color:#000000;">)</span><br><span style="color:#000000;">## X-squared = 221.39, df = 48, p-value &lt; 2.2e-16</span></p> 
<p style="margin-left:0cm;"><span style="color:#204a87;"><strong>Box.test</strong></span><span style="color:#000000;">(fittbats</span><span style="color:#ce5c00;"><strong>$</strong></span><span style="color:#000000;">errors,</span><span style="color:#204a87;">lag=</span><span style="color:#0000cf;">17532</span><span style="color:#000000;">,</span><span style="color:#204a87;">type=</span><span style="color:#4e9a06;">'Ljung'</span><span style="color:#000000;">)</span><br><span style="color:#000000;">## X-squared = 28721, df = 17532, p-value &lt; 2.2e-16</span></p> 
<p style="margin-left:0cm;">都通不过，认为不是白噪声。</p> 
<ol><li><span style="color:#5b9bd5;"><em><a name="%E6%8B%9F%E5%90%88%E6%95%88%E6%9E%9C"></a>拟合效果</em></span></li></ol> 
<p style="margin-left:0cm;"><span style="color:#000000;">fittbats_plot &lt;-</span> <span style="color:#204a87;"><strong>data.frame</strong></span><span style="color:#000000;">(</span><span style="color:#204a87;">PM2.5=</span><span style="color:#204a87;"><strong>c</strong></span><span style="color:#000000;">(PM2</span><span style="color:#0000cf;">.51</span><span style="color:#000000;">[</span><span style="color:#0000cf;">11510</span><span style="color:#ce5c00;"><strong>:</strong></span><span style="color:#0000cf;">11550</span><span style="color:#000000;">],fittbats</span><span style="color:#ce5c00;"><strong>$</strong></span><span style="color:#000000;">fitted.values[</span><span style="color:#0000cf;">11510</span><span style="color:#ce5c00;"><strong>:</strong></span><span style="color:#0000cf;">11550</span><span style="color:#000000;">]),</span><span style="color:#204a87;">difference=</span><span style="color:#204a87;"><strong>rep</strong></span><span style="color:#000000;">(</span><span style="color:#204a87;"><strong>c</strong></span><span style="color:#000000;">(</span><span style="color:#4e9a06;">"actual"</span><span style="color:#000000;">,</span><span style="color:#4e9a06;">"fitted"</span><span style="color:#000000;">),</span><span style="color:#204a87;"><strong>c</strong></span><span style="color:#000000;">(</span><span style="color:#0000cf;">41</span><span style="color:#000000;">,</span><span style="color:#0000cf;">41</span><span style="color:#000000;">)),</span><span style="color:#204a87;">time=</span><span style="color:#204a87;"><strong>c</strong></span><span style="color:#000000;">(time[</span><span style="color:#0000cf;">11510</span><span style="color:#ce5c00;"><strong>:</strong></span><span style="color:#0000cf;">11550</span><span style="color:#000000;">],time[</span><span style="color:#0000cf;">11510</span><span style="color:#ce5c00;"><strong>:</strong></span><span style="color:#0000cf;">11550</span><span style="color:#000000;">]))</span><br><br><span style="color:#204a87;"><strong>ggplot</strong></span><span style="color:#000000;">(fittbats_plot)</span><span style="color:#ce5c00;"><strong>+</strong></span><span style="color:#204a87;"><strong>geom_line</strong></span><span style="color:#000000;">(</span><span style="color:#204a87;"><strong>aes</strong></span><span style="color:#000000;">(</span><span style="color:#204a87;">y=</span><span style="color:#000000;">PM2</span><span style="color:#0000cf;">.5</span><span style="color:#000000;">,</span><span style="color:#204a87;">x=</span><span style="color:#000000;">time,</span><span style="color:#204a87;">group=</span><span style="color:#000000;">difference,</span><span style="color:#204a87;">linetype=</span><span style="color:#000000;">difference))</span><span style="color:#ce5c00;"><strong>+</strong></span><span style="color:#204a87;"><strong>labs</strong></span><span style="color:#000000;">(</span><span style="color:#204a87;">title  =</span> <span style="color:#4e9a06;">"</span><span style="color:#4e9a06;">奥体中心PM2.5</span><span style="color:#4e9a06;">值指TBATS</span><span style="color:#4e9a06;">模型拟合"</span><span style="color:#000000;">,</span><span style="color:#204a87;">subtitle=</span><span style="color:#4e9a06;">"BATS(0.347, {0,0}, 0.957, -)"</span><span style="color:#000000;">) </span><span style="color:#ce5c00;"><strong>+</strong></span><span style="color:#204a87;"><strong>xlab</strong></span><span style="color:#000000;">(</span><span style="color:#204a87;">label =</span> <span style="color:#4e9a06;">"</span><span style="color:#4e9a06;">时间"</span><span style="color:#000000;">) </span><span style="color:#ce5c00;"><strong>+</strong></span> <span style="color:#204a87;"><strong>ylab</strong></span><span style="color:#000000;">(</span><span style="color:#204a87;">label =</span> <span style="color:#4e9a06;">"PM2.5"</span><span style="color:#000000;">)</span><span style="color:#ce5c00;"><strong>+</strong></span><span style="color:#204a87;"><strong>theme</strong></span><span style="color:#000000;">(</span><span style="color:#204a87;">plot.title  =</span> <span style="color:#204a87;"><strong>element_text</strong></span><span style="color:#000000;">(</span><span style="color:#204a87;">hjust =</span> <span style="color:#0000cf;">0.5</span><span style="color:#000000;">))</span></p> 
<ol><li><span style="color:#5b9bd5;"><em><a name="%E9%A2%84%E6%B5%8B%E6%95%88%E6%9E%9C"></a>预测效果</em></span></li></ol> 
<p style="margin-left:0cm;"><span style="color:#000000;">forecast_tbats&lt;-</span><span style="color:#204a87;"><strong>forecast</strong></span><span style="color:#000000;">(fittbats,</span><span style="color:#204a87;">h=</span><span style="color:#0000cf;">300</span><span style="color:#000000;">)</span><br><br><span style="color:#204a87;"><strong>ggplot</strong></span><span style="color:#000000;">() </span><span style="color:#ce5c00;"><strong>+</strong></span> <span style="color:#204a87;"><strong>geom_line</strong></span><span style="color:#000000;">(</span><span style="color:#204a87;"><strong>aes</strong></span><span style="color:#000000;">(</span><span style="color:#204a87;">y=</span><span style="color:#204a87;"><strong>c</strong></span><span style="color:#000000;">(PM2</span><span style="color:#0000cf;">.51</span><span style="color:#000000;">[</span><span style="color:#0000cf;">34800</span><span style="color:#ce5c00;"><strong>:</strong></span><span style="color:#0000cf;">35064</span><span style="color:#000000;">],forecast_tbats</span><span style="color:#ce5c00;"><strong>$</strong></span><span style="color:#000000;">mean),</span><span style="color:#204a87;">x=</span><span style="color:#000000;">time[</span><span style="color:#0000cf;">34800</span><span style="color:#ce5c00;"><strong>:</strong></span><span style="color:#0000cf;">35364</span><span style="color:#000000;">]))</span><span style="color:#ce5c00;"><strong>+</strong></span> <span style="color:#204a87;"><strong>geom_line</strong></span><span style="color:#000000;">(</span><span style="color:#204a87;"><strong>aes</strong></span><span style="color:#000000;">(</span><span style="color:#204a87;">y=</span><span style="color:#000000;">forecast_tbats</span><span style="color:#ce5c00;"><strong>$</strong></span><span style="color:#000000;">mean,</span><span style="color:#204a87;">x=</span><span style="color:#000000;">time[</span><span style="color:#0000cf;">35065</span><span style="color:#ce5c00;"><strong>:</strong></span><span style="color:#0000cf;">35364</span><span style="color:#000000;">]),</span><span style="color:#204a87;">col=</span><span style="color:#4e9a06;">"red"</span><span style="color:#000000;">,</span><span style="color:#204a87;">size=</span><span style="color:#0000cf;">1</span><span style="color:#000000;">)</span><span style="color:#ce5c00;"><strong>+</strong></span><span style="color:#204a87;"><strong>labs</strong></span><span style="color:#000000;">(</span><span style="color:#204a87;">title  =</span> <span style="color:#4e9a06;">"</span><span style="color:#4e9a06;">奥体中心PM2.5</span><span style="color:#4e9a06;">值300</span><span style="color:#4e9a06;">期预测"</span><span style="color:#000000;">,</span><span style="color:#204a87;">subtitle=</span><span style="color:#4e9a06;">"BATS(0.347, {0,0}, 0.957, -)"</span><span style="color:#000000;">) </span><span style="color:#ce5c00;"><strong>+</strong></span><span style="color:#204a87;"><strong>xlab</strong></span><span style="color:#000000;">(</span><span style="color:#204a87;">label =</span> <span style="color:#4e9a06;">"</span><span style="color:#4e9a06;">时间"</span><span style="color:#000000;">) </span><span style="color:#ce5c00;"><strong>+</strong></span> <span style="color:#204a87;"><strong>ylab</strong></span><span style="color:#000000;">(</span><span style="color:#204a87;">label =</span> <span style="color:#4e9a06;">"PM2.5"</span><span style="color:#000000;">)</span><span style="color:#ce5c00;"><strong>+</strong></span><span style="color:#204a87;"><strong>theme</strong></span><span style="color:#000000;">(</span><span style="color:#204a87;">plot.title  =</span> <span style="color:#204a87;"><strong>element_text</strong></span><span style="color:#000000;">(</span><span style="color:#204a87;">hjust =</span> <span style="color:#0000cf;">0.5</span><span style="color:#000000;">))</span></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/069097f7d679ea8aa02767d131dc008d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">如何在vue3中优雅地使用v-model？</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/467630948721cc7e2c8aebb1bf3969c1/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">mapper适配【从mysql到oracle】</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>