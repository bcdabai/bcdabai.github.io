<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Impala - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Impala" />
<meta property="og:description" content="文章目录 Apache Impala二、 Apache Impala1． Impala基本介绍2． Impala与Hive关系3． Impala与Hive异同3.1． Impala使用的优化技术3.2． 执行计划3.3． 数据流3.4． 内存使用3.5． 调度3.6． 容错3.7． 适用面 4． Impala架构4.1． Impalad4.2． Impala State Store4.3． CLI4.4． Catalogd 5． Impala查询处理过程 三、 Impala安装部署1． 安装前提2． 下载安装包、依赖包3． 虚拟机新增磁盘（可选）3.1． 关机新增磁盘3.2． 开机挂载磁盘 4． 配置本地yum源4.1． 上传安装包解压4.2． 配置本地yum源信息 5． 安装Impala5.1． 集群规划5.2． 主节点安装5.3． 从节点安装 6． 修改Hadoop、Hive配置6.1． 修改hive配置6.2． 修改hadoop配置6.3． 重启hadoop、hive6.4． 复制hadoop、hive配置文件 7． 修改impala配置7.1． 修改impala默认配置7.2． 添加mysql驱动7.3． 修改bigtop配置 8． 启动、关闭impala服务8.1． impala web ui 四、 Impala-shell命令参数1． impala-shell外部命令2． impala-shell内部命令 五、 Impala sql语法1． 数据库特定语句1.1． 创建数据库1.2． 删除数据库 2． 表特定语句2.1． create table语句2." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/8fc20d978449ca8dfa142f6d1dc51fa1/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-09-02T15:23:31+08:00" />
<meta property="article:modified_time" content="2019-09-02T15:23:31+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Impala</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><a href="#Apache_Impala_1" rel="nofollow">Apache Impala</a></li><li><ul><li><a href="#_Apache_Impala_3" rel="nofollow">二、 Apache Impala</a></li><li><ul><li><a href="#1_Impala_5" rel="nofollow">1． Impala基本介绍</a></li><li><a href="#2_ImpalaHive_15" rel="nofollow">2． Impala与Hive关系</a></li><li><a href="#3_ImpalaHive_33" rel="nofollow">3． Impala与Hive异同</a></li><li><ul><li><a href="#31_Impala_43" rel="nofollow">3.1． Impala使用的优化技术</a></li><li><a href="#32__57" rel="nofollow">3.2． 执行计划</a></li><li><a href="#33__65" rel="nofollow">3.3． 数据流</a></li><li><a href="#34__73" rel="nofollow">3.4． 内存使用</a></li><li><a href="#35__81" rel="nofollow">3.5． 调度</a></li><li><a href="#36__89" rel="nofollow">3.6． 容错</a></li><li><a href="#37__97" rel="nofollow">3.7． 适用面</a></li></ul> 
     </li><li><a href="#4_Impala_105" rel="nofollow">4． Impala架构</a></li><li><ul><li><a href="#41_Impalad_115" rel="nofollow">4.1． Impalad</a></li><li><a href="#42_Impala_State_Store_123" rel="nofollow">4.2． Impala State Store</a></li><li><a href="#43_CLI_129" rel="nofollow">4.3． CLI</a></li><li><a href="#44_Catalogd_135" rel="nofollow">4.4． Catalogd</a></li></ul> 
     </li><li><a href="#5_Impala_141" rel="nofollow">5． Impala查询处理过程</a></li></ul> 
    </li><li><a href="#_Impala_155" rel="nofollow">三、 Impala安装部署</a></li><li><ul><li><a href="#1__157" rel="nofollow">1． 安装前提</a></li><li><a href="#2__169" rel="nofollow">2． 下载安装包、依赖包</a></li><li><a href="#3__183" rel="nofollow">3． 虚拟机新增磁盘（可选）</a></li><li><ul><li><a href="#31__195" rel="nofollow">3.1． 关机新增磁盘</a></li><li><a href="#32__211" rel="nofollow">3.2． 开机挂载磁盘</a></li></ul> 
     </li><li><a href="#4_yum_250" rel="nofollow">4． 配置本地yum源</a></li><li><ul><li><a href="#41__252" rel="nofollow">4.1． 上传安装包解压</a></li><li><a href="#42_yum_265" rel="nofollow">4.2． 配置本地yum源信息</a></li></ul> 
     </li><li><a href="#5_Impala_330" rel="nofollow">5． 安装Impala</a></li><li><ul><li><a href="#51__332" rel="nofollow">5.1． 集群规划</a></li><li><a href="#52__342" rel="nofollow">5.2． 主节点安装</a></li><li><a href="#53__352" rel="nofollow">5.3． 从节点安装</a></li></ul> 
     </li><li><a href="#6_HadoopHive_362" rel="nofollow">6． 修改Hadoop、Hive配置</a></li><li><ul><li><a href="#61_hive_368" rel="nofollow">6.1． 修改hive配置</a></li><li><a href="#62_hadoop_433" rel="nofollow">6.2． 修改hadoop配置</a></li><li><a href="#63_hadoophive_490" rel="nofollow">6.3． 重启hadoop、hive</a></li><li><a href="#64_hadoophive_506" rel="nofollow">6.4． 复制hadoop、hive配置文件</a></li></ul> 
     </li><li><a href="#7_impala_520" rel="nofollow">7． 修改impala配置</a></li><li><ul><li><a href="#71_impala_522" rel="nofollow">7.1． 修改impala默认配置</a></li><li><a href="#72_mysql_534" rel="nofollow">7.2． 添加mysql驱动</a></li><li><a href="#73_bigtop_548" rel="nofollow">7.3． 修改bigtop配置</a></li></ul> 
     </li><li><a href="#8_impala_559" rel="nofollow">8． 启动、关闭impala服务</a></li><li><ul><li><a href="#81_impala_web_ui_593" rel="nofollow">8.1． impala web ui</a></li></ul> 
    </li></ul> 
    </li><li><a href="#_Impalashell_603" rel="nofollow">四、 Impala-shell命令参数</a></li><li><ul><li><a href="#1_impalashell_605" rel="nofollow">1． impala-shell外部命令</a></li><li><a href="#2_impalashell_625" rel="nofollow">2． impala-shell内部命令</a></li></ul> 
    </li><li><a href="#_Impala_sql_669" rel="nofollow">五、 Impala sql语法</a></li><li><ul><li><a href="#1__671" rel="nofollow">1． 数据库特定语句</a></li><li><ul><li><a href="#11__673" rel="nofollow">1.1． 创建数据库</a></li><li><a href="#12__720" rel="nofollow">1.2． 删除数据库</a></li></ul> 
     </li><li><a href="#2__733" rel="nofollow">2． 表特定语句</a></li><li><ul><li><a href="#21_create_table_735" rel="nofollow">2.1． create table语句</a></li><li><a href="#22_insert_763" rel="nofollow">2.2． insert语句</a></li><li><a href="#23_select_799" rel="nofollow">2.3． select语句</a></li><li><a href="#24_describe_807" rel="nofollow">2.4． describe语句</a></li><li><a href="#25_alter_table_823" rel="nofollow">2.5． alter table</a></li><li><a href="#26_deletetruncate_table_856" rel="nofollow">2.6． delete、truncate table</a></li><li><a href="#27_view_880" rel="nofollow">2.7． view视图</a></li><li><a href="#28_order_by_916" rel="nofollow">2.8． order by子句</a></li><li><a href="#29_group_by_935" rel="nofollow">2.9． group by子句</a></li><li><a href="#210_having_943" rel="nofollow">2.10． having子句</a></li><li><a href="#211_limitoffset_951" rel="nofollow">2.11． limit、offset</a></li><li><a href="#212_with_963" rel="nofollow">2.12． with子句（适合子查询）</a></li><li><a href="#213_distinct_981" rel="nofollow">2.13． distinct</a></li></ul> 
    </li></ul> 
    </li><li><a href="#_Impala_993" rel="nofollow">六、 Impala数据导入方式</a></li><li><ul><li><a href="#1_load_data_995" rel="nofollow">1． load data</a></li><li><a href="#2_insert_into_values_1034" rel="nofollow">2． insert into values</a></li><li><a href="#3_insert_into_select_1047" rel="nofollow">3． insert into select</a></li><li><a href="#4_create_as_select_1053" rel="nofollow">4． create as select</a></li></ul> 
    </li><li><a href="#_Impalajava_1061" rel="nofollow">七、 Impala的java开发</a></li><li><ul><li><a href="#1_impala_jdbc_1065" rel="nofollow">1． 下载impala jdbc依赖</a></li><li><a href="#2_java_1077" rel="nofollow">2． 创建java工程</a></li><li><a href="#3_java_api_1085" rel="nofollow">3． java api</a></li></ul> 
   </li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="Apache_Impala_1"></a>Apache Impala</h3> 
<h4><a id="_Apache_Impala_3"></a>二、 Apache Impala</h4> 
<h5><a id="1_Impala_5"></a>1． Impala基本介绍</h5> 
<p><strong>impala</strong>是cloudera提供的一款高效率的sql查询工具，提供实时的查询效果，官方测试性能比hive快10到100倍，其sql查询比sparkSQL还要更加快速，号称是当前大数据领域最快的查询sql工具，</p> 
<p>impala是参照谷歌的新三篇论文（Caffeine–网络搜索引擎、Pregel–分布式图计算、Dremel–交互式分析工具）当中的Dremel实现而来，其中旧三篇论文分别是（BigTable，GFS，MapReduce）分别对应我们即将学的HBase和已经学过的HDFS以及MapReduce。</p> 
<p>impala是基于hive并使用内存进行计算，兼顾数据仓库，具有实时，批处理，多并发等优点。</p> 
<p><img src="https://images2.imgbox.com/6b/59/t8NEMie0_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="2_ImpalaHive_15"></a>2． Impala与Hive关系</h5> 
<p>impala是基于hive的大数据分析查询引擎，直接使用hive的元数据库metadata，意味着impala元数据都存储在hive的metastore当中，并且impala兼容hive的绝大多数sql语法。所以需要安装impala的话，必须先安装hive，保证hive安装成功，并且还需要启动hive的metastore服务。</p> 
<p>Hive元数据包含用Hive创建的database、table等元信息。元数据存储在关系型数据库中，如Derby、MySQL等。</p> 
<p>客户端连接metastore服务，metastore再去连接MySQL数据库来存取元数据。有了metastore服务，就可以有多个客户端同时连接，而且这些客户端不需要知道MySQL数据库的用户名和密码，只需要连接metastore 服务即可。</p> 
<pre><code class="prism language-shell"><span class="token function">nohup</span> hive --service metastore <span class="token operator">&gt;&gt;</span> ~/metastore.log 2<span class="token operator">&gt;</span><span class="token operator">&amp;</span>1 <span class="token operator">&amp;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/8d/e5/L39jd7O0_o.png" alt="在这里插入图片描述"></p> 
<p>Hive适合于长时间的批处理查询分析，而Impala适合于实时交互式SQL查询。可以先使用hive进行数据转换处理，之后使用Impala在Hive处理后的结果数据集上进行快速的数据分析。</p> 
<h5><a id="3_ImpalaHive_33"></a>3． Impala与Hive异同</h5> 
<p>Impala 与Hive都是构建在Hadoop之上的数据查询工具各有不同的侧重适应面，但从客户端使用来看Impala与Hive有很多的共同之处，如数据表元数据、ODBC/JDBC驱动、SQL语法、灵活的文件格式、存储资源池等。</p> 
<p>但是Impala跟Hive最大的优化区别在于：<strong>没有使用 MapReduce进行并行计算</strong>，虽然MapReduce是非常好的并行计算框架，但它更多的面向批处理模式，而不是面向交互式的SQL执行。与 MapReduce相比，Impala把整个查询分成一执行计划树，而不是一连串的MapReduce任务，在分发执行计划后，Impala使用拉式获取数据的方式获取结果，把结果数据组成按执行树流式传递汇集，减少的了把中间结果写入磁盘的步骤，再从磁盘读取数据的开销。Impala使用服务的方式避免每次执行查询都需要启动的开销，即相比Hive没了MapReduce启动时间。</p> 
<p><img src="https://images2.imgbox.com/ba/5a/G1uRGeZ1_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="31_Impala_43"></a>3.1． Impala使用的优化技术</h6> 
<p>使用LLVM产生运行代码，针对特定查询生成特定代码，同时使用Inline的方式减少函数调用的开销，加快执行效率。(C++特性)</p> 
<p>充分利用可用的硬件指令（SSE4.2）。</p> 
<p>更好的IO调度，Impala知道数据块所在的磁盘位置能够更好的利用多磁盘的优势，同时Impala支持直接数据块读取和本地代码计算checksum。</p> 
<p>通过选择合适数据存储格式可以得到最好性能（Impala支持多种存储格式）。</p> 
<p>最大使用内存，中间结果不写磁盘，及时通过网络以stream的方式传递</p> 
<h6><a id="32__57"></a>3.2． 执行计划</h6> 
<p><strong>Hive</strong>: 依赖于MapReduce执行框架，执行计划分成 map-&gt;shuffle-&gt;reduce-&gt;map-&gt;shuffle-&gt;reduce…的模型。如果一个Query会 被编译成多轮MapReduce，则会有更多的写中间结果。由于MapReduce执行框架本身的特点，过多的中间过程会增加整个Query的执行时间。</p> 
<p><strong>Impala</strong>: 把执行计划表现为一棵完整的执行计划树，可以更自然地分发执行计划到各个Impalad执行查询，而不用像Hive那样把它组合成管道型的 map-&gt;reduce模式，以此保证Impala有更好的并发性和避免不必要的中间sort与shuffle。</p> 
<h6><a id="33__65"></a>3.3． 数据流</h6> 
<p><strong>Hive</strong>: 采用推的方式，每一个计算节点计算完成后将数据主动推给后续节点。</p> 
<p><strong>Impala</strong>: 采用拉的方式，后续节点通过getNext主动向前面节点要数据，以此方式数据可以流式的返回给客户端，且只要有1条数据被处理完，就可以立即展现出来，而不用等到全部处理完成，更符合SQL交互式查询使用。</p> 
<h6><a id="34__73"></a>3.4． 内存使用</h6> 
<p><strong>Hive</strong>: 在执行过程中如果内存放不下所有数据，则会使用外存，以保证Query能顺序执行完。每一轮MapReduce结束，中间结果也会写入HDFS中，同样由于MapReduce执行架构的特性，shuffle过程也会有写本地磁盘的操作。</p> 
<p><strong>Impala</strong>: 在遇到内存放不下数据时，版本1.0.1是直接返回错误，而不会利用外存，以后版本应该会进行改进。这使用得Impala目前处理Query会受到一定的限制，最好还是与Hive配合使用。</p> 
<h6><a id="35__81"></a>3.5． 调度</h6> 
<p><strong>Hive</strong>: 任务调度依赖于Hadoop的调度策略。</p> 
<p><strong>Impala</strong>: 调度由自己完成，目前只有一种调度器simple-schedule，它会尽量满足数据的局部性，扫描数据的进程尽量靠近数据本身所在的物理机器。调度器 目前还比较简单，在SimpleScheduler::GetBackend中可以看到，现在还没有考虑负载，网络IO状况等因素进行调度。但目前 Impala已经有对执行过程的性能统计分析，应该以后版本会利用这些统计信息进行调度吧。</p> 
<h6><a id="36__89"></a>3.6． 容错</h6> 
<p><strong>Hive</strong>: 依赖于Hadoop的容错能力。</p> 
<p><strong>Impala</strong>: 在查询过程中，没有容错逻辑，如果在执行过程中发生故障，则直接返回错误（这与Impala的设计有关，因为Impala定位于实时查询，一次查询失败， 再查一次就好了，再查一次的成本很低）。</p> 
<h6><a id="37__97"></a>3.7． 适用面</h6> 
<p><strong>Hive</strong>: 复杂的批处理查询任务，数据转换任务。</p> 
<p><strong>Impala</strong>：实时数据分析，因为不支持UDF，能处理的问题域有一定的限制，与Hive配合使用,对Hive的结果数据集进行实时分析。</p> 
<h5><a id="4_Impala_105"></a>4． Impala架构</h5> 
<p>Impala主要由Impalad、 State Store、Catalogd和CLI组成。</p> 
<p><img src="https://images2.imgbox.com/4b/7d/uOwZqBUh_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/d4/e2/SIXquSRd_o.jpg" alt="在这里插入图片描述"></p> 
<h6><a id="41_Impalad_115"></a>4.1． Impalad</h6> 
<p><strong>Impalad</strong>: 与DataNode运行在同一节点上，由Impalad进程表示，它接收客户端的查询请求（<em>接收查询请求的Impalad为Coordinator，Coordinator通过JNI调用java前端解释SQL查询语句，生成查询计划树，再通过调度器把执行计划分发给具有相应数据的其它Impalad进行执行</em>），读写数据，并行执行查询，并把结果通过网络流式的传送回给Coordinator，由Coordinator返回给客户端。同时Impalad也与State Store保持连接，用于确定哪个Impalad是健康和可以接受新的工作。</p> 
<p>在Impalad中启动三个ThriftServer: beeswax_server（连接客户端），hs2_server（借用Hive元数据）， be_server（Impalad内部使用）和一个ImpalaServer服务。</p> 
<h6><a id="42_Impala_State_Store_123"></a>4.2． Impala State Store</h6> 
<p><strong>Impala State Store</strong>: 跟踪集群中的Impalad的健康状态及位置信息，由statestored进程表示，它通过创建多个线程来处理Impalad的注册订阅和与各Impalad保持心跳连接，各Impalad都会缓存一份State Store中的信息，当State Store离线后（Impalad发现State Store处于离线时，会进入recovery模式，反复注册，当State Store重新加入集群后，自动恢复正常，更新缓存数据）因为Impalad有State Store的缓存仍然可以工作，但会因为有些Impalad失效了，而已缓存数据无法更新，导致把执行计划分配给了失效的Impalad，导致查询失败。</p> 
<h6><a id="43_CLI_129"></a>4.3． CLI</h6> 
<p><strong>CLI:</strong> 提供给用户查询使用的命令行工具（Impala Shell使用python实现），同时Impala还提供了Hue，JDBC， ODBC使用接口。</p> 
<h6><a id="44_Catalogd_135"></a>4.4． Catalogd</h6> 
<p><strong>Catalogd</strong>：作为metadata访问网关，从Hive Metastore等外部catalog中获取元数据信息，放到impala自己的catalog结构中。impalad执行ddl命令时通过catalogd由其代为执行，该更新则由statestored广播。</p> 
<h5><a id="5_Impala_141"></a>5． Impala查询处理过程</h5> 
<p>Impalad分为Java前端与C++处理后端，接受客户端连接的Impalad即作为这次查询的Coordinator，Coordinator通过JNI调用Java前端对用户的查询SQL进行分析生成执行计划树。</p> 
<p><img src="https://images2.imgbox.com/a2/a9/pX5CrJCO_o.png" alt="在这里插入图片描述"></p> 
<p>Java前端产生的执行计划树以Thrift数据格式返回给C++后端（Coordinator）（<em>执行计划分为多个阶段，每一个阶段叫做一个PlanFragment，每一个PlanFragment在执行时可以由多个Impalad实例并行执行(有些PlanFragment只能由一个Impalad实例执行,如聚合操作)，整个执行计划为一执行计划树</em>）。</p> 
<p>Coordinator根据执行计划，数据存储信息（<em>Impala通过libhdfs与HDFS进行交互。通过hdfsGetHosts方法获得文件数据块所在节点的位置信息</em>），通过调度器（现在只有simple-scheduler, 使用round-robin算法）Coordinator::Exec对生成的执行计划树分配给相应的后端执行器Impalad执行（查询会使用LLVM进行代码生成，编译，执行），通过调用GetNext()方法获取计算结果。</p> 
<p>如果是insert语句，则将计算结果通过libhdfs写回HDFS当所有输入数据被消耗光，执行结束，之后注销此次查询服务。</p> 
<h4><a id="_Impala_155"></a>三、 Impala安装部署</h4> 
<h5><a id="1__157"></a>1． 安装前提</h5> 
<p>集群提前安装好hadoop，hive。</p> 
<p>hive安装包scp在所有需要安装impala的节点上，因为impala需要引用hive的依赖包。</p> 
<p>hadoop框架需要支持C程序访问接口，查看下图，如果有该路径下有这么文件，就证明支持C接口。</p> 
<p><img src="https://images2.imgbox.com/25/6e/LVwtyCKp_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="2__169"></a>2． 下载安装包、依赖包</h5> 
<p>由于impala没有提供tar包进行安装，只提供了rpm包。因此在安装impala的时候，需要使用rpm包来进行安装。rpm包只有cloudera公司提供了，所以去cloudera公司网站进行下载rpm包即可。</p> 
<p>但是另外一个问题，impala的rpm包依赖非常多的其他的rpm包，可以一个个的将依赖找出来，也可以将所有的rpm包下载下来，制作成我们本地yum源来进行安装。这里就选择制作本地的yum源来进行安装。</p> 
<p>所以首先需要下载到所有的rpm包，下载地址如下</p> 
<pre><code>http://archive.cloudera.com/cdh5/repo-as-tarball/5.14.0/cdh5.14.0-centos6.tar.gz
</code></pre> 
<h5><a id="3__183"></a>3． 虚拟机新增磁盘（可选）</h5> 
<p>由于下载的cdh5.14.0-centos6.tar.gz包非常大，大概5个G，解压之后也最少需要5个G的空间。而我们的虚拟机磁盘有限，可能会不够用了，所以可以为虚拟机挂载一块新的磁盘，专门用于存储的cdh5.14.0-centos6.tar.gz包。</p> 
<p>注意事项：新增挂载磁盘需要虚拟机保持在关机状态。</p> 
<p>如果磁盘空间有余，那么本步骤可以省略不进行。</p> 
<p><img src="https://images2.imgbox.com/bb/a6/hDZMfvim_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="31__195"></a>3.1． 关机新增磁盘</h6> 
<p>虚拟机关机的状态下，在VMware当中新增一块磁盘。</p> 
<p><img src="https://images2.imgbox.com/a8/03/vgP7t065_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/7e/28/bOftQpwq_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/02/c9/zcOQ4TKV_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/0e/16/qnTs9nei_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/44/56/xipWc6It_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="32__211"></a>3.2． 开机挂载磁盘</h6> 
<p>开启虚拟机，对新增的磁盘进行分区，格式化，并且挂载新磁盘到指定目录。</p> 
<p><img src="https://images2.imgbox.com/33/2c/52456f5B_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/80/06/ThaIynqt_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/9c/98/uaNF4dFY_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/d3/37/6yGqFKJn_o.png" alt="在这里插入图片描述"></p> 
<p>下面对分区进行格式化操作：</p> 
<pre><code class="prism language-shell">mkfs -t ext4 -c /dev/sdb1
</code></pre> 
<p><img src="https://images2.imgbox.com/f1/2b/B6W5q5u5_o.png" alt="在这里插入图片描述"></p> 
<p>创建挂载目录：</p> 
<pre><code class="prism language-shell"><span class="token function">mount</span> -t ext4 /dev/sdb1 /cloudera_data/
</code></pre> 
<p><img src="https://images2.imgbox.com/05/d3/InTpobUv_o.png" alt="在这里插入图片描述"></p> 
<p>添加至开机自动挂载：</p> 
<pre><code class="prism language-shell">vim /etc/fstab
/dev/sdb1   /cloudera_data    ext4    defaults    0 0
</code></pre> 
<p><img src="https://images2.imgbox.com/f1/1a/XNdrPMXG_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="4_yum_250"></a>4． 配置本地yum源</h5> 
<h6><a id="41__252"></a>4.1． 上传安装包解压</h6> 
<p>使用sftp的方式把安装包大文件上传到服务器/cloudera_data目录下。</p> 
<p><img src="https://images2.imgbox.com/0c/2e/ZhndjusC_o.jpg" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-shell"><span class="token function">cd</span> /cloudera_data
<span class="token function">tar</span> -zxvf cdh5.14.0-centos6.tar.gz
</code></pre> 
<h6><a id="42_yum_265"></a>4.2． 配置本地yum源信息</h6> 
<p>安装Apache Server服务器</p> 
<pre><code class="prism language-shell">yum  -y <span class="token function">install</span> httpd
<span class="token function">service</span> httpd start
<span class="token function">chkconfig</span> httpd on
</code></pre> 
<p>配置本地yum源的文件</p> 
<pre><code class="prism language-shell"><span class="token function">cd</span> /etc/yum.repos.d
vim localimp.repo 
</code></pre> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>localimp<span class="token punctuation">]</span>
name<span class="token operator">=</span>localimp
baseurl<span class="token operator">=</span>http://node-3/cdh5.14.0/
gpgcheck<span class="token operator">=</span>0
enabled<span class="token operator">=</span>1
</code></pre> 
<p>创建apache httpd的读取链接</p> 
<pre><code class="prism language-shell"><span class="token function">ln</span> -s /cloudera_data/cdh/5.14.0 /var/www/html/cdh5.14.0
</code></pre> 
<p><strong>确保linux的</strong> <strong>Selinux关闭</strong></p> 
<pre><code class="prism language-shell"><span class="token comment">#临时关闭：</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># getenforce</span>
Enforcing
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># setenforce 0</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># getenforce</span>

Permissive
<span class="token comment">#永久关闭：</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/sysconfig/selinux</span>
SELINUX<span class="token operator">=</span>enforcing 改为 SELINUX<span class="token operator">=</span>disabled
<span class="token comment">#重启服务reboot</span>
</code></pre> 
<p>通过浏览器访问本地yum源，如果出现下述页面则成功。</p> 
<pre><code class="prism language-shell">http://192.168.227.153/cdh5.14.0/
</code></pre> 
<p><img src="https://images2.imgbox.com/c8/01/7o2WiEDR_o.png" alt="在这里插入图片描述"></p> 
<p>将本地yum源配置文件localimp.repo发放到所有需要安装impala的节点。</p> 
<pre><code class="prism language-shell"><span class="token function">cd</span> /etc/yum.repos.d/
<span class="token function">scp</span> localimp.repo  node-2:<span class="token variable">$PWD</span>
<span class="token function">scp</span> localimp.repo  node-3:<span class="token variable">$PWD</span>
</code></pre> 
<h5><a id="5_Impala_330"></a>5． 安装Impala</h5> 
<h6><a id="51__332"></a>5.1． 集群规划</h6> 
<table><thead><tr><th>服务名称</th><th>从节点</th><th>从节点</th><th>主节点</th></tr></thead><tbody><tr><td>impala-catalog</td><td></td><td></td><td>Node-3</td></tr><tr><td>impala-state-store</td><td></td><td></td><td>Node-3</td></tr><tr><td>impala-server(impalad)</td><td>Node-1</td><td>Node-2</td><td>Node-3</td></tr></tbody></table> 
<h6><a id="52__342"></a>5.2． 主节点安装</h6> 
<p>在规划的<strong>主节点node-3</strong>执行以下命令进行安装：</p> 
<pre><code class="prism language-shell">yum <span class="token function">install</span> -y impala impala-server impala-state-store impala-catalog impala-shell
</code></pre> 
<h6><a id="53__352"></a>5.3． 从节点安装</h6> 
<p>在规划的<strong>从</strong> <strong>节点node-1</strong> <strong>、</strong> <strong>node-2</strong>执行以下命令进行安装：</p> 
<pre><code class="prism language-shell">yum <span class="token function">install</span> -y impala-server
</code></pre> 
<h5><a id="6_HadoopHive_362"></a>6． 修改Hadoop、Hive配置</h5> 
<p>需要在3台机器整个集群上进行操作，都需要修改。hadoop、hive是否正常服务并且配置好，是决定impala是否启动成功并使用的前提。</p> 
<h6><a id="61_hive_368"></a>6.1． 修改hive配置</h6> 
<p>可在node-1机器上进行配置，然后scp给其他2台机器。</p> 
<pre><code class="prism language-shell">vim /export/servers/hive/conf/hive-site.xml
</code></pre> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span> 
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>javax.jdo.option.ConnectionURL<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>  
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>jdbc:mysql://node01:3306/hive?createDatabaseIfNotExist=true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span> 
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>  
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>javax.jdo.option.ConnectionDriverName<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>  
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>com.mysql.jdbc.Driver<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span> 
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>  
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>javax.jdo.option.ConnectionUserName<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>  
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>root<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span> 
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>  
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>javax.jdo.option.ConnectionPassword<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>  
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>hadoop<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span> 
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>  
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>hive.cli.print.current.db<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>  
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span> 
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>  
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>hive.cli.print.header<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>  
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span> 
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>  
  <span class="token comment">&lt;!-- 绑定运行hiveServer2的主机host,默认localhost --&gt;</span>  
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>hive.server2.thrift.bind.host<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>  
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>node01<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span> 
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>  
  <span class="token comment">&lt;!-- 指定hive metastore服务请求的uri地址 --&gt;</span>  
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>hive.metastore.uris<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>  
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>thrift://node01:9083<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span> 
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>  
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>hive.metastore.client.socket.timeout<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>  
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>3600<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span> 
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span> 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<pre><code class="prism language-shell">vim /export/servers/hive/conf/hive-site.xml
</code></pre> 
<p>将hive安装包cp给其他两个机器</p> 
<pre><code class="prism language-shell"><span class="token function">cd</span> /export/servers/
<span class="token function">scp</span> -r hive/ node02:<span class="token variable">$PWD</span>
<span class="token function">scp</span> -r hive/ node03:<span class="token variable">$PWD</span>
</code></pre> 
<h6><a id="62_hadoop_433"></a>6.2． 修改hadoop配置</h6> 
<p>所有节点创建下述文件夹</p> 
<pre><code class="prism language-shell"><span class="token function">mkdir</span> -p /var/run/hdfs-sockets
</code></pre> 
<p>修改所有节点的hdfs-site.xml添加以下配置，修改完之后重启hdfs集群生效</p> 
<pre><code class="prism language-shell">vim   etc/hadoop/hdfs-site.xml
</code></pre> 
<pre><code class="prism language-shell">	<span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>dfs.client.read.shortcircuit<span class="token operator">&lt;</span>/name<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>true<span class="token operator">&lt;</span>/value<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>dfs.domain.socket.path<span class="token operator">&lt;</span>/name<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>/var/run/hdfs-sockets/dn<span class="token operator">&lt;</span>/value<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>dfs.client.file-block-storage-locations.timeout.millis<span class="token operator">&lt;</span>/name<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>10000<span class="token operator">&lt;</span>/value<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>dfs.datanode.hdfs-blocks-metadata.enabled<span class="token operator">&lt;</span>/name<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>true<span class="token operator">&lt;</span>/value<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>
</code></pre> 
<p>dfs.client.read.shortcircuit 打开DFSClient本地读取数据的控制，</p> 
<p>dfs.domain.socket.path是Datanode和DFSClient之间沟通的Socket的本地路径。</p> 
<p>把更新hadoop的配置文件，scp给其他机器。</p> 
<pre><code class="prism language-shell"><span class="token function">cd</span> /export/servers/hadoop-2.7.5/etc/hadoop
<span class="token function">scp</span> -r hdfs-site.xml node-2:<span class="token variable">$PWD</span>
<span class="token function">scp</span> -r hdfs-site.xml node-3:<span class="token variable">$PWD</span> 
</code></pre> 
<p>注意：root用户不需要下面操作，普通用户需要这一步操作。</p> 
<p>给这个文件夹赋予权限，如果用的是普通用户hadoop，那就直接赋予普通用户的权限，例如：</p> 
<pre><code class="prism language-shell"><span class="token function">chown</span>  -R  hadoop:hadoop   /var/run/hdfs-sockets/
</code></pre> 
<p>因为这里直接用的root用户，所以不需要赋权限了</p> 
<h6><a id="63_hadoophive_490"></a>6.3． 重启hadoop、hive</h6> 
<p>在node-1上执行下述命令分动别启hive metastore服务和hadoop。</p> 
<pre><code class="prism language-shell"><span class="token function">cd</span>  /export/servers/hive
<span class="token function">nohup</span> bin/hive --service metastore <span class="token operator">&amp;</span>
<span class="token function">nohup</span> bin/hive --service hiveserver2 <span class="token operator">&amp;</span>
<span class="token function">cd</span> /export/servers/hadoop-2.7.5/
sbin/stop-dfs.sh  <span class="token operator">|</span>  sbin/start-dfs.sh
</code></pre> 
<h6><a id="64_hadoophive_506"></a>6.4． 复制hadoop、hive配置文件</h6> 
<p>impala的配置目录为/etc/impala/conf，这个路径下面需要把core-site.xml，hdfs-site.xml以及hive-site.xml。</p> 
<p>所有节点执行以下命令</p> 
<pre><code class="prism language-shell"><span class="token function">cp</span> -r /export/servers/hadoop-2.7.5/etc/hadoop/core-site.xml /etc/impala/conf/core-site.xml
<span class="token function">cp</span> -r /export/servers/hadoop-2.7.5/etc/hadoop/hdfs-site.xml /etc/impala/conf/hdfs-site.xml
<span class="token function">cp</span> -r /export/servers/apache-hive-2.1.1-bin/conf/hive-site.xml /etc/impala/conf/hive-site.xml
</code></pre> 
<h5><a id="7_impala_520"></a>7． 修改impala配置</h5> 
<h6><a id="71_impala_522"></a>7.1． 修改impala默认配置</h6> 
<p>所有节点更改impala默认配置文件</p> 
<pre><code class="prism language-shell">vim /etc/default/impala
IMPALA_CATALOG_SERVICE_HOST<span class="token operator">=</span>node02
IMPALA_STATE_STORE_HOST<span class="token operator">=</span>node02
</code></pre> 
<h6><a id="72_mysql_534"></a>7.2． 添加mysql驱动</h6> 
<p>通过配置/etc/default/impala中可以发现已经指定了mysql驱动的位置名字。解开注释</p> 
<p><img src="https://images2.imgbox.com/3b/0e/3i7xuWpr_o.png" alt="在这里插入图片描述"></p> 
<p>使用软链接指向该路径即可（3台机器都需要执行）</p> 
<pre><code class="prism language-shell"><span class="token function">ln</span> -s /export/servers/apache-hive-2.1.1-bin/lib/mysql-connector-java-5.1.38.jar /usr/share/java/mysql-connector-java.jar
</code></pre> 
<h6><a id="73_bigtop_548"></a>7.3． 修改bigtop配置</h6> 
<p>修改bigtop的java_home路径（3台机器）</p> 
<pre><code class="prism language-shell">vim /etc/default/bigtop-utils
<span class="token function">export</span> JAVA_HOME<span class="token operator">=</span>/export/servers/jdk1.8.0_141
</code></pre> 
<h5><a id="8_impala_559"></a>8． 启动、关闭impala服务</h5> 
<p>主节点node-3启动以下三个服务进程</p> 
<pre><code class="prism language-shell"><span class="token function">service</span> impala-state-store start
<span class="token function">service</span> impala-catalog start
<span class="token function">service</span> impala-server start
</code></pre> 
<p>从节点启动node-1与node-2启动impala-server</p> 
<pre><code class="prism language-shell"><span class="token function">service</span>  impala-server  start
</code></pre> 
<p>查看impala进程是否存在</p> 
<pre><code class="prism language-shell"><span class="token function">ps</span> -ef <span class="token operator">|</span> <span class="token function">grep</span> impala
</code></pre> 
<p><img src="https://images2.imgbox.com/29/79/hn6jIb1U_o.png" alt="在这里插入图片描述"></p> 
<p>启动之后所有关于impala的<strong>日志默认都在/var/log/impala</strong></p> 
<p>如果需要关闭impala服务 把命令中的start该成stop即可。注意如果关闭之后进程依然驻留，可以采取下述方式删除。正常情况下是随着关闭消失的。</p> 
<p>解决方式：</p> 
<p><img src="https://images2.imgbox.com/5f/ab/ds7Em0AR_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="81_impala_web_ui_593"></a>8.1． impala web ui</h6> 
<p>访问impalad的管理界面http://node02:25000/</p> 
<p>访问statestored的管理界面http://node02:25010/</p> 
<p>访问impalad的端口为25020</p> 
<h4><a id="_Impalashell_603"></a>四、 Impala-shell命令参数</h4> 
<h5><a id="1_impalashell_605"></a>1． impala-shell外部命令</h5> 
<p>所谓的外部命令指的是不需要进入到impala-shell交互命令行当中即可执行的命令参数。impala-shell后面执行的时候可以带很多参数。你可以在启动 impala-shell 时设置，用于修改命令执行环境。</p> 
<p>impala-shell –h可以帮助我们查看帮助手册。也可以参考课程附件资料。</p> 
<p>比如几个常见的：</p> 
<p>impala-shell –r刷新impala元数据，与建立连接后执行 REFRESH 语句效果相同</p> 
<p>impala-shell –f 文件路径 执行指的的sql查询文件。</p> 
<p>impala-shell –i指定连接运行 impalad 守护进程的主机。默认端口是 21000。你可以连接到集群中运行 impalad 的任意主机。</p> 
<p>impala-shell –o保存执行结果到文件当中去。</p> 
<p><img src="https://images2.imgbox.com/d5/9e/XMfckU7B_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="2_impalashell_625"></a>2． impala-shell内部命令</h5> 
<p>所谓内部命令是指，进入impala-shell命令行之后可以执行的语法。</p> 
<p><img src="https://images2.imgbox.com/2e/65/qnydDEni_o.png" alt="在这里插入图片描述"></p> 
<p>connect hostname 连接到指定的机器impalad上去执行。</p> 
<p><img src="https://images2.imgbox.com/6f/64/O3kb2myF_o.jpg" alt="在这里插入图片描述"></p> 
<p>refresh dbname.tablename增量刷新，刷新某一张表的元数据，主要用于刷新hive当中数据表里面的数据改变的情况。</p> 
<p><img src="https://images2.imgbox.com/b7/2f/6YFnvjrw_o.jpg" alt="在这里插入图片描述"></p> 
<p>invalidate metadata全量刷新，性能消耗较大，主要用于hive当中新建数据库或者数据库表的时候来进行刷新。</p> 
<p>quit/exit命令 从Impala shell中弹出</p> 
<p>explain 命令 用于查看sql语句的执行计划。</p> 
<p><img src="https://images2.imgbox.com/12/fd/stalYFsY_o.png" alt="在这里插入图片描述"></p> 
<p>explain的值可以设置成0,1,2,3等几个值，其中3级别是最高的，可以打印出最全的信息</p> 
<p>set explain_level=3;</p> 
<p>profile命令执行sql语句之后执行，可以</p> 
<p>打印出更加详细的执行步骤，主要用于查询结果的查看，集群的调优等。</p> 
<p><img src="https://images2.imgbox.com/0b/53/8winQZfY_o.png" alt="在这里插入图片描述"></p> 
<p><strong>注意</strong>:如果在hive窗口中插入数据或者新建的数据库或者数据库表，那么在impala当中是不可直接查询，需要执行invalidate metadata以通知元数据的更新；</p> 
<p>在impala-shell当中插入的数据，在impala当中是可以直接查询到的，hive也可以直接查到，不需要刷新数据库，其中使用的就是catalog这个服务的功能实现的，catalog是impala1.2版本之后增加的模块功能，主要作用就是同步impala之间的元数据。</p> 
<p>更新操作通知Catalog，Catalog通过广播的方式通知其它的Impalad进程。默认情况下Catalog是异步加载元数据的，因此查询可能需要等待元数据加载完成之后才能进行（第一次加载）。</p> 
<h4><a id="_Impala_sql_669"></a>五、 Impala sql语法</h4> 
<h5><a id="1__671"></a>1． 数据库特定语句</h5> 
<h6><a id="11__673"></a>1.1． 创建数据库</h6> 
<p>CREATE DATABASE语句用于在Impala中创建新数据库。</p> 
<p>CREATE DATABASE IF NOT EXISTS database_name;</p> 
<p>这里，IF NOT EXISTS是一个可选的子句。如果我们使用此子句，则只有在没有具有相同名称的现有数据库时，才会创建具有给定名称的数据库。</p> 
<p><img src="https://images2.imgbox.com/93/04/n2ixrL1f_o.jpg" alt="在这里插入图片描述"></p> 
<p>impala默认使用impala用户执行操作，会报权限不足问题，解决办法：</p> 
<p>一：给HDFS指定文件夹授予权限</p> 
<p>hadoop fs -chmod -R 777 hdfs://node-1:9000/user/hive</p> 
<p>二：haoop 配置文件中hdfs-site.xml 中设置权限为false</p> 
<p><img src="https://images2.imgbox.com/21/21/kqZpwM2b_o.png" alt="在这里插入图片描述"></p> 
<p>上述两种方式都可以。</p> 
<p><img src="https://images2.imgbox.com/2a/b8/q1A5JUf4_o.png" alt="在这里插入图片描述"></p> 
<p>默认就会在hive的数仓路径下创建新的数据库名文件夹</p> 
<p>/user/hive/warehouse/ittest.db</p> 
<p>也可以在创建数据库的时候指定hdfs路径。需要注意该路径的权限。</p> 
<pre><code class="prism language-shell">hadoop fs -mkdir -p /input/impala
hadoop fs -chmod -R 777 /input/impala 
</code></pre> 
<pre><code class="prism language-shell">create  external table  t3<span class="token punctuation">(</span>id int ,name string ,age int <span class="token punctuation">)</span>  row  <span class="token function">format</span>  delimited fields terminated  by  <span class="token string">'\t'</span> location  <span class="token string">'/input/impala/external'</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/b3/64/snYNvOd4_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="12__720"></a>1.2． 删除数据库</h6> 
<p>Impala的DROP DATABASE语句用于从Impala中删除数据库。 在删除数据库之前，建议从中删除所有表。</p> 
<p>如果使用级联删除，Impala会在删除指定数据库中的表之前删除它。</p> 
<p>DROP database sample cascade;</p> 
<p><img src="https://images2.imgbox.com/cc/34/xXtODmgr_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/02/e2/979fI3qM_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="2__733"></a>2． 表特定语句</h5> 
<h6><a id="21_create_table_735"></a>2.1． create table语句</h6> 
<p>CREATE TABLE语句用于在Impala中的所需数据库中创建新表。 需要指定表名字并定义其列和每列的数据类型。</p> 
<p>impala支持的数据类型和hive类似，除了sql类型外，还支持java类型</p> 
<pre><code class="prism language-sql"><span class="token keyword">create</span> <span class="token keyword">table</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> database_name<span class="token punctuation">.</span>table_name <span class="token punctuation">(</span>
   column1 data_type<span class="token punctuation">,</span>
   column2 data_type<span class="token punctuation">,</span>
   column3 data_type<span class="token punctuation">,</span>
   ………
   columnN data_type
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> my_db<span class="token punctuation">.</span>student<span class="token punctuation">(</span>name STRING<span class="token punctuation">,</span> age <span class="token keyword">INT</span><span class="token punctuation">,</span> contact <span class="token keyword">INT</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/eb/fe/PWhiifT8_o.png" alt="在这里插入图片描述"></p> 
<p>默认建表的数据存储路径跟hive一致。也可以在建表的时候通过location指定具体路径，需要注意hdfs权限问题。</p> 
<p><img src="https://images2.imgbox.com/57/f1/JwXPDPnR_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="22_insert_763"></a>2.2． insert语句</h6> 
<p>Impala的INSERT语句有两个子句: into和overwrite。into用于插入新记录数据，overwrite用于覆盖已有的记录。</p> 
<pre><code class="prism language-sql"><span class="token keyword">insert</span> <span class="token keyword">into</span> table_name <span class="token punctuation">(</span>column1<span class="token punctuation">,</span> column2<span class="token punctuation">,</span> column3<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>columnN<span class="token punctuation">)</span>
<span class="token keyword">values</span> <span class="token punctuation">(</span>value1<span class="token punctuation">,</span> value2<span class="token punctuation">,</span> value3<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>valueN<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">Insert</span> <span class="token keyword">into</span> table_name <span class="token keyword">values</span> <span class="token punctuation">(</span>value1<span class="token punctuation">,</span> value2<span class="token punctuation">,</span> value2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>这里，column1，column2，… columnN是要插入数据的表中的列的名称。还可以添加值而不指定列名，但是，需要确保值的顺序与表中的列的顺序相同。</p> 
<p>举个例子：</p> 
<pre><code class="prism language-sql"><span class="token keyword">create</span> <span class="token keyword">table</span> employee <span class="token punctuation">(</span>Id <span class="token keyword">INT</span><span class="token punctuation">,</span> name STRING<span class="token punctuation">,</span> age <span class="token keyword">INT</span><span class="token punctuation">,</span>address STRING<span class="token punctuation">,</span> salary <span class="token keyword">BIGINT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> employee <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'Ramesh'</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token string">'Ahmedabad'</span><span class="token punctuation">,</span> <span class="token number">20000</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> employee <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'Khilan'</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token string">'Delhi'</span><span class="token punctuation">,</span> <span class="token number">15000</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">Insert</span> <span class="token keyword">into</span> employee <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'kaushik'</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token string">'Kota'</span><span class="token punctuation">,</span> <span class="token number">30000</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">Insert</span> <span class="token keyword">into</span> employee <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">'Chaitali'</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token string">'Mumbai'</span><span class="token punctuation">,</span> <span class="token number">35000</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">Insert</span> <span class="token keyword">into</span> employee <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">'Hardik'</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">,</span> <span class="token string">'Bhopal'</span><span class="token punctuation">,</span> <span class="token number">40000</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">Insert</span> <span class="token keyword">into</span> employee <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token string">'Komal'</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token string">'MP'</span><span class="token punctuation">,</span> <span class="token number">32000</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/4c/84/ncxEwIxu_o.png" alt="在这里插入图片描述"></p> 
<p>overwrite覆盖子句覆盖表当中<strong>全部记录</strong>。 覆盖的记录将从表中永久删除</p> 
<pre><code class="prism language-sql"><span class="token keyword">Insert</span> overwrite employee <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'Ram'</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">,</span> <span class="token string">'Vishakhapatnam'</span><span class="token punctuation">,</span> <span class="token number">37000</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h6><a id="23_select_799"></a>2.3． select语句</h6> 
<p>Impala SELECT语句用于从数据库中的一个或多个表中提取数据。 此查询以表的形式返回数据。</p> 
<p><img src="https://images2.imgbox.com/53/18/dBpKpc2f_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="24_describe_807"></a>2.4． describe语句</h6> 
<p>Impala中的describe语句用于提供表的描述。 此语句的结果包含有关表的信息，例如列名称及其数据类型。</p> 
<p>Describe table_name;</p> 
<p><img src="https://images2.imgbox.com/3b/9a/l0qN2cTK_o.png" alt="在这里插入图片描述"></p> 
<p>此外，还可以使用hive的查询表元数据信息语句。</p> 
<p>desc formatted table_name;</p> 
<p><img src="https://images2.imgbox.com/52/3a/N9o35sbM_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="25_alter_table_823"></a>2.5． alter table</h6> 
<p>Impala中的Alter table语句用于对给定表执行更改。使用此语句，我们可以添加，删除或修改现有表中的列，也可以重命名它们。</p> 
<p>表重命名：</p> 
<pre><code class="prism language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token punctuation">[</span>old_db_name<span class="token punctuation">.</span><span class="token punctuation">]</span>old_table_name <span class="token keyword">RENAME</span> <span class="token keyword">TO</span>
 <span class="token punctuation">[</span>new_db_name<span class="token punctuation">.</span><span class="token punctuation">]</span>new_table_name
</code></pre> 
<p>向表中添加列**：**</p> 
<pre><code class="prism language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> name <span class="token keyword">ADD</span> <span class="token keyword">COLUMNS</span> <span class="token punctuation">(</span>col_spec<span class="token punctuation">[</span><span class="token punctuation">,</span> col_spec <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p>从表中删除列：</p> 
<pre><code class="prism language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> name <span class="token keyword">DROP</span> <span class="token punctuation">[</span><span class="token keyword">COLUMN</span><span class="token punctuation">]</span> column_name
</code></pre> 
<p>更改列的名称和类型：</p> 
<pre><code class="prism language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> name CHANGE column_name new_name new_type
</code></pre> 
<p><img src="https://images2.imgbox.com/ee/2f/SxJS07rl_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="26_deletetruncate_table_856"></a>2.6． delete、truncate table</h6> 
<p>Impala drop table语句用于删除Impala中的现有表。此语句还会删除内部表的底层HDFS文件。</p> 
<p>注意：使用此命令时必须小心，因为删除表后，表中可用的所有信息也将永远丢失。</p> 
<pre><code class="prism language-sql"><span class="token keyword">DROP</span> <span class="token keyword">table</span> database_name<span class="token punctuation">.</span>table_name<span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/e9/39/0tXqgxY2_o.png" alt="在这里插入图片描述"></p> 
<p>Impala的Truncate Table语句用于从现有表中删除所有记录。保留表结构。</p> 
<p>您也可以使用DROP TABLE命令删除一个完整的表，但它会从数据库中删除完整的表结构，如果您希望存储一些数据，您将需要重新创建此表。</p> 
<pre><code class="prism language-sql"><span class="token keyword">truncate</span> table_name<span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/11/51/PsQCHam8_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="27_view_880"></a>2.7． view视图</h6> 
<p>视图仅仅是存储在数据库中具有关联名称的Impala查询语言的语句。 它是以预定义的SQL查询形式的表的组合。</p> 
<p>视图可以包含表的所有行或选定的行。</p> 
<pre><code class="prism language-sql"><span class="token keyword">Create</span> <span class="token keyword">View</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> view_name <span class="token keyword">as</span> <span class="token keyword">Select</span> statement
</code></pre> 
<p><img src="https://images2.imgbox.com/f0/d1/y9FnVgaD_o.png" alt="在这里插入图片描述"></p> 
<p>创建视图view、查询视图view</p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> employee_view <span class="token keyword">AS</span> <span class="token keyword">select</span> name<span class="token punctuation">,</span> age <span class="token keyword">from</span> employee<span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/68/9b/VeyrhyTy_o.png" alt="在这里插入图片描述"></p> 
<p>修改视图</p> 
<pre><code class="prism language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">VIEW</span> database_name<span class="token punctuation">.</span>view_name <span class="token keyword">as</span> <span class="token comment">--加上Select语句</span>
</code></pre> 
<p>删除视图</p> 
<pre><code class="prism language-sql"><span class="token keyword">DROP</span> <span class="token keyword">VIEW</span> database_name<span class="token punctuation">.</span>view_name<span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/6e/fa/tnfoKKIA_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="28_order_by_916"></a>2.8． order by子句</h6> 
<p>Impala ORDER BY子句用于根据一个或多个列以升序或降序对数据进行排序。 默认情况下，一些数据库按升序对查询结果进行排序。</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> table_name <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> col_name
<span class="token punctuation">[</span><span class="token keyword">ASC</span><span class="token operator">|</span><span class="token keyword">DESC</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>NULLS <span class="token keyword">FIRST</span><span class="token operator">|</span>NULLS <span class="token keyword">LAST</span><span class="token punctuation">]</span>
</code></pre> 
<p>可以使用关键字ASC或DESC分别按升序或降序排列表中的数据。</p> 
<p>如果我们使用NULLS FIRST，表中的所有空值都排列在顶行; 如果我们使用NULLS LAST，包含空值的行将最后排列。</p> 
<p><img src="https://images2.imgbox.com/49/a8/q3Oi17VL_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="29_group_by_935"></a>2.9． group by子句</h6> 
<p>Impala GROUP BY子句与SELECT语句协作使用，以将相同的数据排列到组中。</p> 
<p>select data from table_name Group BY col_name;</p> 
<h6><a id="210_having_943"></a>2.10． having子句</h6> 
<p>Impala中的Having子句允许您指定过滤哪些组结果显示在最终结果中的条件。</p> 
<p>一般来说，Having子句与group by子句一起使用; 它将条件放置在由GROUP BY子句创建的组上。</p> 
<h6><a id="211_limitoffset_951"></a>2.11． limit、offset</h6> 
<p>Impala中的limit子句用于将结果集的行数限制为所需的数，即查询的结果集不包含超过指定限制的记录。</p> 
<p>一般来说，select查询的resultset中的行从0开始。使用offset子句，我们可以决定从哪里考虑输出。</p> 
<p>一个表可能位于多个文件中，所以limit查询时最好配置order by和offset使用；</p> 
<p><img src="https://images2.imgbox.com/f8/21/HUEomjME_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="212_with_963"></a>2.12． with子句（适合子查询）</h6> 
<p>如果查询太复杂，我们可以为复杂部分定义别名，并使用Impala的with子句将它们包含在查询中。</p> 
<pre><code class="prism language-sql"><span class="token keyword">with</span> x <span class="token keyword">as</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> y <span class="token keyword">as</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> x <span class="token keyword">union</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>例如：使用with子句显示年龄大于25的员工和客户的记录。</p> 
<pre><code class="prism language-sql"><span class="token keyword">with</span> t1 <span class="token keyword">as</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> customers <span class="token keyword">where</span> age<span class="token operator">&gt;</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
   t2 <span class="token keyword">as</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> employee <span class="token keyword">where</span> age<span class="token operator">&gt;</span><span class="token number">25</span><span class="token punctuation">)</span> 
   <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t1 <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h6><a id="213_distinct_981"></a>2.13． distinct</h6> 
<p>Impala中的distinct运算符用于通过删除重复值来获取唯一值。</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> <span class="token keyword">distinct</span> <span class="token keyword">columns</span>… <span class="token keyword">from</span> table_name<span class="token punctuation">;</span>
</code></pre> 
<h4><a id="_Impala_993"></a>六、 Impala数据导入方式</h4> 
<h5><a id="1_load_data_995"></a>1． load data</h5> 
<p>首先创建一个表：</p> 
<pre><code class="prism language-sql"><span class="token keyword">create</span> <span class="token keyword">table</span> <span class="token keyword">user</span><span class="token punctuation">(</span>id <span class="token keyword">int</span> <span class="token punctuation">,</span>name string<span class="token punctuation">,</span>age <span class="token keyword">int</span> <span class="token punctuation">)</span> <span class="token keyword">row</span> format delimited <span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">"\t"</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/9d/83/FRkRlQ18_o.png" alt="在这里插入图片描述"></p> 
<p>准备数据user.txt并上传到hdfs的 /user/impala路径下去</p> 
<p><img src="https://images2.imgbox.com/2e/23/bvJ9c5Gb_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/6c/13/Q5ua9Q9d_o.png" alt="在这里插入图片描述"></p> 
<p>加载数据</p> 
<pre><code class="prism language-sql"><span class="token keyword">load</span> <span class="token keyword">data</span> inpath <span class="token string">'/user/impala/'</span> <span class="token keyword">into</span> <span class="token keyword">table</span> <span class="token keyword">user</span><span class="token punctuation">;</span>
<span class="token comment">--底层是mv,而不是cp</span>
</code></pre> 
<p>查询加载的数据</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span>  <span class="token operator">*</span>  <span class="token keyword">from</span>  <span class="token keyword">user</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/52/0e/AZJm89Me_o.png" alt="在这里插入图片描述"></p> 
<p>如果查询不不到数据，那么需要刷新一遍数据表。</p> 
<pre><code class="prism language-sql">refresh <span class="token keyword">user</span><span class="token punctuation">;</span>
</code></pre> 
<h5><a id="2_insert_into_values_1034"></a>2． insert into values</h5> 
<p>这种方式非常类似于RDBMS的数据插入方式。</p> 
<pre><code class="prism language-sql"><span class="token keyword">create</span> <span class="token keyword">table</span> t_test2<span class="token punctuation">(</span>id <span class="token keyword">int</span><span class="token punctuation">,</span>name string<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> <span class="token keyword">table</span> t_test2 <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>”zhangsan”<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">--速度相对hive快很多，但是不推荐</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/d7/7b/bplEjlgz_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="3_insert_into_select_1047"></a>3． insert into select</h5> 
<p>插入一张表的数据来自于后面的select查询语句返回的结果</p> 
<p><img src="https://images2.imgbox.com/17/25/x2sIIJci_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="4_create_as_select_1053"></a>4． create as select</h5> 
<p>建表的字段个数、类型、数据来自于后续的select查询语句。</p> 
<p><img src="https://images2.imgbox.com/f2/ae/bzhdV6tN_o.jpg" alt="在这里插入图片描述"></p> 
<h4><a id="_Impalajava_1061"></a>七、 Impala的java开发</h4> 
<p>在实际工作当中，因为impala的查询比较快，所以可能有会使用到impala来做数据库查询的情况，可以通过java代码来进行操作impala的查询。</p> 
<h5><a id="1_impala_jdbc_1065"></a>1． 下载impala jdbc依赖</h5> 
<p>下载路径：</p> 
<p>https://www.cloudera.com/downloads/connectors/impala/jdbc/2-5-28.html</p> 
<p>因为cloudera属于商业公司性质，其提供的jar并不会出现在开源的maven仓库中，如果在企业中需要使用，请添加到企业maven私服。</p> 
<p><img src="https://images2.imgbox.com/d0/4c/GDy6cjRa_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="2_java_1077"></a>2． 创建java工程</h5> 
<p>创建普通java工程，把依赖添加工程。</p> 
<p><img src="https://images2.imgbox.com/16/87/7nJcrMCC_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="3_java_api_1085"></a>3． java api</h5> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        Connection con <span class="token operator">=</span> null<span class="token punctuation">;</span>
        ResultSet rs <span class="token operator">=</span> null<span class="token punctuation">;</span>
        PreparedStatement ps <span class="token operator">=</span> null<span class="token punctuation">;</span>
        String JDBC_DRIVER <span class="token operator">=</span> <span class="token string">"com.cloudera.impala.jdbc41.Driver"</span><span class="token punctuation">;</span>
        String CONNECTION_URL <span class="token operator">=</span> <span class="token string">"jdbc:impala://node-3:21050"</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span>
        <span class="token punctuation">{<!-- --></span>
            Class<span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>JDBC_DRIVER<span class="token punctuation">)</span><span class="token punctuation">;</span>
            con <span class="token operator">=</span> <span class="token punctuation">(</span>Connection<span class="token punctuation">)</span> DriverManager<span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span>CONNECTION_URL<span class="token punctuation">)</span><span class="token punctuation">;</span>
            ps <span class="token operator">=</span> con<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span><span class="token string">"select * from my_db.employee"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            rs <span class="token operator">=</span> ps<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
                rs<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                ps<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                con<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/232e693cd5dc6e4cccfeedb482b7c781/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">流水线调度问题【java版本】</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b0a6498f6634741dc62328fd4e553921/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">HTTP code（状态码）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>