<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Apache安全及优化 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Apache安全及优化" />
<meta property="og:description" content="配置第一台虚拟机 VM1网卡 yum仓库 挂载磁盘 上传3个软件包到/目录 到/目录下进行解压缩 tar xf apr-1.6.2.tar.gz
tar xf apr-util-1.6.0.tar.gz
tar -xjf httpd-2.4.29.tar.bz2
mv apr-1.6.2 httpd-2.4.29/srclib/apr
mv apr-util-1.6.0 httpd-2.4.29/srclib/apr-util
安装服务 yum -y install \
gcc \
gcc-c&#43;&#43; \
make \
pcre-devel \
expat-devel \
perl \
zlib-devel \
zlib
切换目录 cd httpd-2.4.29
安装服务 ./configure \
--prefix=/usr/local/httpd \
--enable-so \
--enable-rewrite \
--enable-charset-lite \
--enable-cgi
make &amp;&amp; make install
cp /usr/local/httpd/bin/apachectl /etc/init.d/httpd
vi /etc/init.d/httpd
# chkconfig: 35 85 21 //35级别自动运行 第85个启动 第21个关闭" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/b98c146632647c27a312c67412824fa3/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-18T18:16:35+08:00" />
<meta property="article:modified_time" content="2024-01-18T18:16:35+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Apache安全及优化</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div> 
 <div style="margin-left:0in;"> 
  <div style="margin-left:0in;"> 
   <h6 style="margin-left:0px;">配置第一台虚拟机                                     </h6> 
   <h6 style="margin-left:0px;">VM1网卡  yum仓库 挂载磁盘</h6> 
   <h6 style="margin-left:0px;">上传3个软件包到/目录</h6> 
   <p style="margin-left:0;"><img alt="" height="142" src="https://images2.imgbox.com/e2/21/Xddh3UMI_o.png" width="722"></p> 
   <h6 style="margin-left:0px;">到/目录下进行解压缩</h6> 
   <p style="margin-left:0;">tar xf apr-1.6.2.tar.gz</p> 
   <p style="margin-left:0;">tar xf apr-util-1.6.0.tar.gz</p> 
   <p style="margin-left:0;">tar -xjf httpd-2.4.29.tar.bz2</p> 
   <p style="margin-left:0;">mv apr-1.6.2 httpd-2.4.29/srclib/apr</p> 
   <p style="margin-left:0;">mv apr-util-1.6.0 httpd-2.4.29/srclib/apr-util</p> 
   <h6 style="margin-left:0px;">安装服务</h6> 
   <p style="margin-left:0;">yum -y install \</p> 
   <p style="margin-left:0;">gcc \</p> 
   <p style="margin-left:0;">gcc-c++ \</p> 
   <p style="margin-left:0;">make \</p> 
   <p style="margin-left:0;">pcre-devel \</p> 
   <p style="margin-left:0;">expat-devel \</p> 
   <p style="margin-left:0;">perl \</p> 
   <p style="margin-left:0;">zlib-devel \</p> 
   <p style="margin-left:0;">zlib</p> 
   <h6 style="margin-left:0px;">切换目录</h6> 
   <p style="margin-left:0;">cd httpd-2.4.29</p> 
   <h6 style="margin-left:0px;">安装服务</h6> 
   <p style="margin-left:0;">./configure \</p> 
   <p style="margin-left:0;">--prefix=/usr/local/httpd \</p> 
   <p style="margin-left:0;">--enable-so \</p> 
   <p style="margin-left:0;">--enable-rewrite \</p> 
   <p style="margin-left:0;">--enable-charset-lite \</p> 
   <p style="margin-left:0;">--enable-cgi</p> 
   <p style="margin-left:0;"></p> 
   <p style="margin-left:0;">make &amp;&amp; make install</p> 
   <p style="margin-left:0;"></p> 
   <p style="margin-left:0;">cp /usr/local/httpd/bin/apachectl /etc/init.d/httpd</p> 
   <p style="margin-left:0;">vi /etc/init.d/httpd</p> 
   <p style="margin-left:0;"></p> 
   <p style="margin-left:0;"># chkconfig: 35 85 21  //35级别自动运行  第85个启动 第21个关闭</p> 
   <p style="margin-left:0;"># description: Apache is a World Wide Web server</p> 
   <p style="margin-left:0;"></p> 
   <p style="margin-left:0;">chkconfig --add httpd</p> 
   <p style="margin-left:0;"></p> 
   <p style="margin-left:0;">vi /usr/local/httpd/conf/httpd.conf</p> 
   <p style="margin-left:0;">ServerName</p> 
   <p style="margin-left:0;"></p> 
   <p style="margin-left:0;">ln -s /usr/local/httpd/conf/httpd.conf /etc/</p> 
   <p style="margin-left:0;">ln -s /usr/local/httpd/bin/* /usr/local/bin/</p> 
   <p style="margin-left:0;"></p> 
   <p style="margin-left:0;">systemctl stop firewalld.service</p> 
   <p style="margin-left:0;">setenforce 0</p> 
   <p style="margin-left:0;"></p> 
   <p style="margin-left:0;">service httpd start</p> 
   <p style="margin-left:0;">netstat -anpt | grep 80</p> 
   <p style="margin-left:0;"></p> 
   <h6 style="margin-left:0px;">重新编译压缩模块</h6> 
   <p style="margin-left:0;">-------- 以下配置网页压缩--到之前的源代码目录----------</p> 
   <p style="margin-left:0;">cd httpd-2.4.29</p> 
   <p style="margin-left:0;">./configure   --enable-deflate                    //增加压缩模块</p> 
   <p style="margin-left:0;">重新安装</p> 
   <p style="margin-left:0;">make &amp;&amp; make install</p> 
   <p style="margin-left:0;"></p> 
   <h6 style="margin-left:0px;">修改配置文件</h6> 
   <p style="margin-left:0;">vi /etc/httpd.conf</p> 
   <p style="margin-left:0;">搜索mod_deflate.so</p> 
   <p style="margin-left:0;">LoadModule deflate_module modules/mod_deflate.so</p> 
   <p style="margin-left:0;">将前面的#号去掉</p> 
   <p style="margin-left:0;"><img alt="" height="100" src="https://images2.imgbox.com/bc/a5/KcJZ5ZLD_o.png" width="663"></p> 
   <p style="margin-left:0;">重启服务</p> 
   <p style="margin-left:0;">service httpd restart</p> 
   <p style="margin-left:0;">查看</p> 
   <p style="margin-left:0;">apachectl -D DUMP_MODULES | grep deflate</p> 
   <p style="margin-left:0;"><img alt="" height="65" src="https://images2.imgbox.com/65/4d/mx9vsG4n_o.png" width="748"></p> 
   <p style="margin-left:0;"></p> 
   <h6 style="margin-left:0px;">------在配置文件末尾新增-------</h6> 
   <p style="margin-left:0;"></p> 
   <p style="margin-left:0;">修改配置文件</p> 
   <p style="margin-left:0;">vi /etc/httpd.conf</p> 
   <p style="margin-left:0;">文件末尾插入下面命令</p> 
   <p style="margin-left:0;">AddOutputFilterByType DEFLATE text/html text/plain text/css text/xml text/javascript image/png        image/jpeg application/x-httpd-php application/x-javascript    #文件类型</p> 
   <p style="margin-left:0;">DeflateCompressionLevel 9   #压缩级别</p> 
   <p style="margin-left:0;">SetOutputFilter DEFLATE    #压缩类型</p> 
   <p style="margin-left:0;"><img alt="" height="122" src="https://images2.imgbox.com/be/99/aSEC5tPb_o.png" width="1037"></p> 
   <p style="margin-left:0;"></p> 
   <p style="margin-left:0;"></p> 
   <p style="margin-left:0;"></p> 
   <p style="margin-left:0;">-----测试页----</p> 
   <p style="margin-left:0;">切换目录</p> 
   <p style="margin-left:0;">cd /usr/local/httpd/htdocs/</p> 
   <p style="margin-left:0;">ll查看 删除所有</p> 
   <p style="margin-left:0;"><img alt="" height="159" src="https://images2.imgbox.com/57/21/7QCw2ohT_o.png" width="580"></p> 
   <p style="margin-left:0;"></p> 
   <p style="margin-left:0;">cd /usr/local/httpd/htdocs/</p> 
   <p style="margin-left:0;">vim index.html</p> 
   <p style="margin-left:0;">&lt;html&gt;</p> 
   <p style="margin-left:0;">&lt;head&gt;</p> 
   <p style="margin-left:0;">&lt;title&gt;--压缩测试页--&lt;/title&gt;</p> 
   <p style="margin-left:0;">&lt;/head&gt;</p> 
   <p style="margin-left:0;">&lt;body&gt;&lt;h1&gt;这是一个测试网页内容压缩的页面！！This is test Page!!&lt;/h1&gt;</p> 
   <p style="margin-left:0;">&lt;img src=b.jpg / &gt;</p> 
   <p style="margin-left:0;">&lt;/body&gt;</p> 
   <p style="margin-left:0;">&lt;/html&gt;</p> 
   <p style="margin-left:0;">修改配置文件  将倒数第四行修改为1.jpg</p> 
   <p style="margin-left:0;"><img alt="" height="212" src="https://images2.imgbox.com/ab/b5/cJ2pdDpb_o.png" width="826"></p> 
   <p style="margin-left:0;">将1.jpg图上上传到远程连接软件</p> 
   <p style="margin-left:0;"><img alt="" height="88" src="https://images2.imgbox.com/75/a2/or1BaNFK_o.png" width="670"></p> 
   <h6 style="margin-left:0px;">访问 192.168.1.100</h6> 
   <p style="margin-left:0;"></p> 
   <h6 style="margin-left:0px;">-------注意中文乱码问题解决方法如下-----</h6> 
   <p style="margin-left:0;">vi /etc/httpd.conf</p> 
   <p style="margin-left:0;">插入到最后一行</p> 
   <p style="margin-left:0;">AddDefaultCharset utf-8  </p> 
   <p style="margin-left:0;">将图片上传到/目录</p> 
   <p style="margin-left:0;"><img alt="" height="99" src="https://images2.imgbox.com/ea/0b/FqYJqPs9_o.png" width="616"></p> 
   <p style="margin-left:0;"> 再从/目录移到/usr/local/httpd/htdocs/</p> 
   <p style="margin-left:0;"><img alt="" height="194" src="https://images2.imgbox.com/9a/df/V4pgA0BY_o.png" width="593"></p> 
   <p style="margin-left:0;"></p> 
   <p style="margin-left:0;"><img alt="" height="526" src="https://images2.imgbox.com/35/e6/SZvX53IG_o.png" width="1200"></p> 
   <p style="margin-left:0;"></p> 
   <p style="margin-left:0;"></p> 
   <p style="margin-left:0;">-----------配置网页缓存---------</p> 
   <p style="margin-left:0;">cd /usr/local/httpd/</p> 
   <p style="margin-left:0;">./bin/apachectl -D DUMP_MODULES | grep expires</p> 
   <p style="margin-left:0;"></p> 
   <p style="margin-left:0;">service httpd stop</p> 
   <p style="margin-left:0;"></p> 
   <p style="margin-left:0;"></p> 
   <p style="margin-left:0;">在文件最后新增</p> 
   <p style="margin-left:0;">vi /etc/httpd.conf</p> 
   <p style="margin-left:0;"><img alt="" height="216" src="https://images2.imgbox.com/70/b0/KbPRN4lO_o.png" width="541"></p> 
   <p style="margin-left:0;">&lt;IfModule mod_expires.c&gt;</p> 
   <p style="margin-left:0;">        ExpiresActive On</p> 
   <p style="margin-left:0;">        ExpiresDefault "access plus 60 seconds"</p> 
   <p style="margin-left:0;">&lt;/IfModule&gt;</p> 
   <p style="margin-left:0;"></p> 
   <p style="margin-left:0;"></p> 
   <p style="margin-left:0;"></p> 
   <p style="margin-left:0;"></p> 
   <p style="margin-left:0;">----------------------------------------------------------------------------------------------</p> 
   <h6 style="margin-left:0px;">配置第二台虚拟机                                     </h6> 
   <p style="margin-left:0;"></p> 
   <p style="margin-left:0;"></p> 
   <p style="margin-left:0;"></p> 
   <p style="margin-left:0px;">配置第二台：VM1网卡  yum仓库 挂载好磁盘</p> 
   <p style="margin-left:0px;">上传3个软件包到/目录下</p> 
   <p style="margin-left:0;"><img alt="" height="142" src="https://images2.imgbox.com/5d/f1/lpYhNnfF_o.png" width="722"></p> 
   <h6 style="margin-left:0px;">到/目录下进行压缩</h6> 
   <p style="margin-left:0;">tar xf apr-1.6.2.tar.gz</p> 
   <p style="margin-left:0;">tar xf apr-util-1.6.0.tar.gz</p> 
   <p style="margin-left:0;">tar -xjf httpd-2.4.29.tar.bz2</p> 
   <p style="margin-left:0;">mv apr-1.6.2 httpd-2.4.29/srclib/apr</p> 
   <p style="margin-left:0;">mv apr-util-1.6.0 httpd-2.4.29/srclib/apr-util</p> 
   <h6 style="margin-left:0px;">安装好服务</h6> 
   <p style="margin-left:0;">yum -y install \</p> 
   <p style="margin-left:0;">gcc \</p> 
   <p style="margin-left:0;">gcc-c++ \</p> 
   <p style="margin-left:0;">make \</p> 
   <p style="margin-left:0;">pcre-devel \</p> 
   <p style="margin-left:0;">expat-devel \</p> 
   <p style="margin-left:0;">perl \</p> 
   <p style="margin-left:0;">zlib-devel \</p> 
   <p style="margin-left:0;">zlib</p> 
   <p style="margin-left:0;"></p> 
   <p style="margin-left:0;">cd httpd-2.4.29</p> 
   <h6 style="margin-left:0px;">安装好服务</h6> 
   <p style="margin-left:0;">./configure \</p> 
   <p style="margin-left:0;">--prefix=/usr/local/httpd \</p> 
   <p style="margin-left:0;">--enable-so \</p> 
   <p style="margin-left:0;">--enable-rewrite \</p> 
   <p style="margin-left:0;">--enable-charset-lite \</p> 
   <p style="margin-left:0;">--enable-cgi</p> 
   <p style="margin-left:0;">--------------------------------------------------------------------------</p> 
   <p style="margin-left:0;">make &amp;&amp; make install   #</p> 
   <p style="margin-left:0;"></p> 
   <p style="margin-left:0;">cp /usr/local/httpd/bin/apachectl /etc/init.d/httpd  #</p> 
   <p style="margin-left:0;">vi /etc/init.d/httpd  #</p> 
   <p style="margin-left:0;"></p> 
   <p style="margin-left:0;"># chkconfig: 35 85 21  //35级别自动运行  第85个启动 第21个关闭  #</p> 
   <p style="margin-left:0;"># description: Apache is a World Wide Web server  #</p> 
   <p style="margin-left:0;"></p> 
   <p style="margin-left:0;">chkconfig --add httpd  #</p> 
   <p style="margin-left:0;"></p> 
   <p style="margin-left:0;">vi /usr/local/httpd/conf/httpd.conf   #</p> 
   <p style="margin-left:0;">ServerName   #</p> 
   <p style="margin-left:0;"></p> 
   <p style="margin-left:0;">ln -s /usr/local/httpd/conf/httpd.conf /etc/  #</p> 
   <p style="margin-left:0;">ln -s /usr/local/httpd/bin/* /usr/local/bin/  #</p> 
   <p style="margin-left:0;"></p> 
   <p style="margin-left:0;">systemctl stop firewalld.service   #</p> 
   <p style="margin-left:0;">setenforce 0   #</p> 
   <p style="margin-left:0;"></p> 
   <p style="margin-left:0;">service httpd start    #</p> 
   <p style="margin-left:0;">netstat -anpt | grep 80    #</p> 
   <p style="margin-left:0;"></p> 
   <p style="margin-left:0;"></p> 
   <h6 style="margin-left:0px;">-------配置防盗链--------</h6> 
   <h6 style="margin-left:0px;">到第二台虚拟机中</h6> 
   <p style="margin-left:0;">cd /httpd-2.4.29/</p> 
   <p style="margin-left:0;">安装下一个服务</p> 
   <p style="margin-left:0;">./configure --enable-expires</p> 
   <p style="margin-left:0;">编译安装</p> 
   <p style="margin-left:0;">make &amp;&amp; make install</p> 
   <p style="margin-left:0;"></p> 
   <p style="margin-left:0;">cd /usr/local/httpd/htdocs/</p> 
   <p style="margin-left:0;">ll查看</p> 
   <p style="margin-left:0;"><img alt="" height="136" src="https://images2.imgbox.com/cc/0a/744hf0Hp_o.png" width="629"></p> 
   <p style="margin-left:0;">编辑配置文件</p> 
   <p style="margin-left:0;">vim index.html</p> 
   <p style="margin-left:0;">插入</p> 
   <p style="margin-left:0;"></p> 
   <p style="margin-left:0;">&lt;html&gt;</p> 
   <p style="margin-left:0;">&lt;body&gt;</p> 
   <p style="margin-left:0;">&lt;h1&gt; Test Page! &lt;/h1&gt;</p> 
   <p style="margin-left:0;">&lt;img src="http://192.168.1.100/1.jpg"&gt;</p> 
   <p style="margin-left:0;">&lt;/body&gt;</p> 
   <p style="margin-left:0;">&lt;/html&gt;</p> 
   <p style="margin-left:0;"></p> 
   <h6 style="margin-left:0px;">访问 192.168.1.127</h6> 
   <p style="margin-left:0;"><img alt="" height="461" src="https://images2.imgbox.com/c6/98/I4vW74Of_o.png" width="1200"></p> 
   <p style="margin-left:0;"></p> 
   <p style="margin-left:0;">./bin/apachectl -D DUMP_MODULES | grep rewrite</p> 
   <p style="margin-left:0;"></p> 
   <p style="margin-left:0;">vi /etc/httpd.conf</p> 
   <p style="margin-left:0;"></p> 
   <p style="margin-left:0;">LoadModule rewrite_module modules/mod_rewrite.so</p> 
   <p style="margin-left:0;"></p> 
   <p style="margin-left:0;"></p> 
   <p style="margin-left:0;">将第二张图片命名为error.jpg  上传到第一台虚拟机中</p> 
   <p style="margin-left:0;"><img alt="" height="174" src="https://images2.imgbox.com/64/f8/Cncz20rP_o.png" width="569"></p> 
   <p style="margin-left:0;">------针对目录做防盗链处理------------在htdocs目录属性最后位置新增---</p> 
   <p style="margin-left:0;"> vim /etc/httpd.conf</p> 
   <p style="margin-left:0;">搜索AllowOverride None</p> 
   <p style="margin-left:0;"><img alt="" height="190" src="https://images2.imgbox.com/c9/87/AkmRcrF4_o.png" width="706"></p> 
   <p style="margin-left:0;">插入</p> 
   <p style="margin-left:0;">        RewriteEngine On</p> 
   <p style="margin-left:0;">RewriteCond %{HTTP_REFERER} !^http://192.168.1.100/*</p> 
   <p style="margin-left:0;">        RewriteCond %{HTTP_REFERER} !^http://bc.com/.*$ [NC]</p> 
   <p style="margin-left:0;">        RewriteCond %{HTTP_REFERER} !^http://bc.com$ [NC]</p> 
   <p style="margin-left:0;">        RewriteCond %{HTTP_REFERER} !^http://www.bc.com/.*$ [NC]</p> 
   <p style="margin-left:0;">        RewriteCond %{HTTP_REFERER} !^http://www.bc.com$ [NC]</p> 
   <p style="margin-left:0;">        RewriteRule .*\.(gif|jpg|swf|png)$ <a href="http://192.168.1.100/error.jpg" rel="nofollow" title="http://192.168.1.100/error.jpg">http://192.168.1.100/error.jpg</a> [R,NC] //需要重定向到一个盗链主机可以访问的位置，否则看不出效果来。</p> 
   <p style="margin-left:0;">重启服务</p> 
   <p style="margin-left:0;">systemctl restart httpd</p> 
   <p style="margin-left:0;">访问</p> 
   <p style="margin-left:0;"><img alt="" height="766" src="https://images2.imgbox.com/30/91/WAao4tk0_o.png" width="1200"></p> 
   <p style="margin-left:0;"></p> 
  </div> 
 </div> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/bb32b44f1772f8ab7710cb4aed755915/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Apache-iotdb物联网数据库的安装及使用</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/907882449f6b5566f8f4bba56301e441/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">《AI智能化办公：ChatGPT使用方法与技巧从入门到精通》</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>