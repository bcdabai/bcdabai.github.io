<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>关于React中函数组件中父子组件函数执行顺序 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="关于React中函数组件中父子组件函数执行顺序" />
<meta property="og:description" content="今天突发奇想 用了React怎么久还没有写过关于函数组件里useEffect在组件的执行顺序 下面我会按照自己的一些想法介绍 创作不易 望大家多多支持 点赞
我们需要探讨的就是 在父组件嵌套多层子组件的情况下每个组件里useEffect与页面渲染顺序 以及在修改父组件或子组件时 的执行顺序
大致结构是这样的
以下是我的测试代码 import React, { useState, useEffect } from &#39;react&#39; import ReactDOM from &#39;react-dom&#39; function Com3 () { const [isShow, setisShow] = useState(true) console.log(&#39;孙组件主线程&#39;) useEffect(() =&gt; { console.log(&#39;孙组件副作用&#39;) return () =&gt; { console.log(&#39;孙组件清理函数&#39;) } }) return ( &lt;div style={{ backgroundColor: &#39;#f09&#39;, height: 50, width: 50 }}&gt; 孙组件 {console.log(&#39;孙&#39;)} &lt;button onClick={() =&gt; { setisShow(false) }}&gt; {isShow}按钮 &lt;/button&gt; &lt;/div&gt; ) } function Com2 () { const [isShow, setisShow] = useState(true) console." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/e419bbaba1fb2c23f734ff5f3f2f8efd/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-11-13T14:11:46+08:00" />
<meta property="article:modified_time" content="2021-11-13T14:11:46+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">关于React中函数组件中父子组件函数执行顺序</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>今天突发奇想 用了React怎么久还没有写过关于函数组件里useEffect在组件的执行顺序 下面我会按照自己的一些想法介绍 创作不易 望大家多多支持 点赞</p> 
<p>我们需要探讨的就是 在父组件嵌套多层子组件的情况下每个组件里useEffect与页面渲染顺序 以及在修改父组件或子组件时 的执行顺序</p> 
<p> 大致结构是这样的</p> 
<p><img alt="" height="464" src="https://images2.imgbox.com/2c/0a/9CEmdYlf_o.png" width="433"></p> 
<p>以下是我的测试代码 </p> 
<pre><code class="language-TypeScript">import React, { useState, useEffect } from 'react'
import ReactDOM from 'react-dom'
function Com3 () {
  const [isShow, setisShow] = useState(true)
  console.log('孙组件主线程')
  useEffect(() =&gt; {
    console.log('孙组件副作用')
    return () =&gt; {
      console.log('孙组件清理函数')
    }
  })
  return (
    &lt;div style={<!-- -->{ backgroundColor: '#f09', height: 50, width: 50 }}&gt;
      孙组件
      {console.log('孙')}
      &lt;button
        onClick={() =&gt; {
          setisShow(false)
        }}&gt;
        {isShow}按钮
      &lt;/button&gt;
    &lt;/div&gt;
  )
}

function Com2 () {
  const [isShow, setisShow] = useState(true)
  console.log('子2组件主线程')
  useEffect(() =&gt; {
    console.log('子2组件副作用')
    return () =&gt; {
      console.log('子2组件清理函数')
    }
  })
  return (
    &lt;div style={<!-- -->{ backgroundColor: '#f99', height: 100, width: 100 }}&gt;
      子2组件
      &lt;Com3 /&gt;
      {console.log('子2')}
      &lt;button
        onClick={() =&gt; {
          setisShow(false)
        }}&gt;
        {isShow}按钮
      &lt;/button&gt;
    &lt;/div&gt;
  )
}

function Com1 () {
  const [isShow, setisShow] = useState(true)
  console.log('子1组件主线程')
  useEffect(() =&gt; {
    console.log('子1组件副作用')
    return () =&gt; {
      console.log('子1组件清理函数')
    }
  })
  return (
    &lt;div style={<!-- -->{ backgroundColor: 'red', height: 100, width: 100 }}&gt;
      子1组件
      {console.log('子1')}
      &lt;button
        onClick={() =&gt; {
          setisShow(false)
        }}&gt;
        {isShow}按钮
      &lt;/button&gt;
    &lt;/div&gt;
  )
}
export default function App () {
  const [isShow, setisShow] = useState(true)
  console.log('父组件主线程')
  useEffect(() =&gt; {
    console.log('父组件副作用')
    return () =&gt; {
      console.log('父组件清理函数')
    }
  })
  return (
    &lt;div style={<!-- -->{ backgroundColor: 'green', height: 250, width: 250 }}&gt;
      {console.log('父1')}
      父组件 {isShow}
      &lt;button
        onClick={() =&gt; {
          setisShow(false)
        }}&gt;
        {isShow}按钮
      &lt;/button&gt;
      &lt;Com1 /&gt;
      &lt;Com2 /&gt;
      {console.log('父2')}
    &lt;/div&gt;
  )
}
ReactDOM.render(&lt;App /&gt;, document.getElementById('root'))
</code></pre> 
<p> 这是我的测试界面</p> 
<h3><img alt="" height="628" src="https://images2.imgbox.com/38/e5/viQT06NP_o.png" width="641"></h3> 
<p></p> 
<h3> 第一种情况 页面第一次渲染时的执行顺序</h3> 
<p><img alt="" height="388" src="https://images2.imgbox.com/81/7e/mphQxmh6_o.png" width="284"></p> 
<p> 可以发现 主线程先执行  然后render 渲染   render 永远在副作用前面 </p> 
<p>为了方便理解  我先介绍如下俩种情况</p> 
<p>父子结构 先父组件渲染 然后子组件渲染 出来时则是 子组件的副作用先执行 后父组件执行  这种结构也是大名鼎鼎的"洋葱结构"</p> 
<p><img alt="" height="343" src="https://images2.imgbox.com/79/4e/QClmtHmx_o.png" width="449"></p> 
<p> 对于兄弟之间组件的渲染 会按照顺序 先render 然后副作用 我们这里简称'梯子结构'</p> 
<p><img alt="" height="457" src="https://images2.imgbox.com/d7/52/B1pEnQDq_o.png" width="410"></p> 
<p> 我们回过头来理解多层嵌套结构是不是要好理解多了 </p> 
<h3> 第二种情况 改变父组件</h3> 
<p>点击父组件的改变数据按钮 </p> 
<p><img alt="" height="442" src="https://images2.imgbox.com/66/72/PJFkD4Wo_o.png" width="307"></p> 
<p> 主线程 -&gt;render渲染-&gt;清理函数-&gt;副作用</p> 
<p>如图所示 清理函数也是按照'剥洋葱''梯子结构'的顺序来执行的  </p> 
<p><img alt="" height="410" src="https://images2.imgbox.com/96/bf/SvfJzgYi_o.png" width="427"></p> 
<h3> 第三种情况改变子组件</h3> 
<p>修改子1里的数据</p> 
<p><img alt="" height="153" src="https://images2.imgbox.com/17/a8/04jpG84D_o.png" width="280"></p> 
<p>修改孙里的数据</p> 
<p><img alt="" height="115" src="https://images2.imgbox.com/b7/3b/jlygrwk3_o.png" width="142"></p> 
<p> 在子2删除 孙</p> 
<p><img alt="" height="181" src="https://images2.imgbox.com/d9/7b/pzNRSI6R_o.png" width="235"></p> 
<p></p> 
<p> 可以看的到 无论是改变那一个子组件都不触发 父组件或其他组件 </p> 
<p>只有在删除孙组件时 才会触发孙组件里的清理函数 这个基础大家应该都知道 </p> 
<p>实际应用中的话 无论多么 复杂的 大家都可以按照 '洋葱''梯子'结构去分析 </p> 
<p>欢迎━(*｀∀´*)ノ亻!大家在react中发现其他情况的一起研究讨论</p> 
<p></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/61ac224154e59815d6837f02708f4b1a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Leetcode014最长公共前缀（这都没整明白我丢死人了）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/04c46719229554fc9b92ce1b87fd0f88/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">沧小海笔记之XILINX 7系列的时钟架构（上）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>