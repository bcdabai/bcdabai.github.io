<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Kafka 入门（二） - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Kafka 入门（二）" />
<meta property="og:description" content="Kafka 入门（二） 接着Kafka 入门（一），接着就要在应用中使用。
Spring6-Kafka 生产者，消费者分别使用不同的应用
生产者 引入依赖 &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.kafka&lt;/groupId&gt; &lt;artifactId&gt;spring-kafka&lt;/artifactId&gt; &lt;version&gt;3.0.4&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;version&gt;1.18.26&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt; &lt;artifactId&gt;logback-classic&lt;/artifactId&gt; &lt;version&gt;1.4.5&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; application.properties spring.kafka.bootstrap-servers=192.168.79.177:9092 logback.xml &lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt; &lt;configuration scan=&#34;true&#34; scanPeriod=&#34;60 seconds&#34; status=&#34;WARN&#34;&gt; &lt;appender name=&#34;CONSOLE&#34; class=&#34;ch.qos.logback.core.ConsoleAppender&#34;&gt; &lt;!--此日志appender是为开发使用，只配置最底级别，控制台输出的日志级别是大于或等于此级别的日志信息--&gt; &lt;filter class=&#34;ch.qos.logback.classic.filter.ThresholdFilter&#34;&gt; &lt;level&gt;INFO&lt;/level&gt; &lt;/filter&gt; &lt;layout class=&#34;ch.qos.logback.classic.PatternLayout&#34;&gt; &lt;pattern&gt;%date %level %logger %msg%n&lt;/pattern&gt; &lt;/layout&gt; &lt;/appender&gt; &lt;logger name=&#34;pr.iceworld.fernando.spring6.kafka.producer&#34; level=&#34;INFO&#34; additivity=&#34;false&#34;&gt; &lt;appender-ref ref=&#34;CONSOLE&#34;/&gt; &lt;/logger&gt; &lt;logger name=&#34;org.springframework.kafka&#34; level=&#34;WARN&#34; additivity=&#34;false&#34;&gt; &lt;appender-ref ref=&#34;CONSOLE&#34;/&gt; &lt;/logger&gt; &lt;logger name=&#34;org.apache.kafka&#34; level=&#34;WARN&#34; additivity=&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/52ec9630730370785cdb5b952a899489/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-03-10T20:57:09+08:00" />
<meta property="article:modified_time" content="2023-03-10T20:57:09+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Kafka 入门（二）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night-eighties">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="Kafka__0"></a>Kafka 入门（二）</h2> 
<p>接着<a href="https://blog.csdn.net/endswell/article/details/129400843">Kafka 入门（一）</a>，接着就要在应用中使用。</p> 
<h3><a id="Spring6Kafka_3"></a>Spring6-Kafka</h3> 
<p>生产者，消费者分别使用不同的应用</p> 
<h4><a id="_5"></a>生产者</h4> 
<h5><a id="_6"></a>引入依赖</h5> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.kafka<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-kafka<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.0.4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.18.26<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>ch.qos.logback<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>logback-classic<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.4.5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h5><a id="applicationproperties_26"></a>application.properties</h5> 
<pre><code class="prism language-bash">spring.kafka.bootstrap-servers<span class="token operator">=</span><span class="token number">192.168</span>.79.177:9092
</code></pre> 
<h5><a id="logbackxml_30"></a>logback.xml</h5> 
<pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span> <span class="token attr-name">scan</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> <span class="token attr-name">scanPeriod</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>60 seconds<span class="token punctuation">"</span></span> <span class="token attr-name">status</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>WARN<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>CONSOLE<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.ConsoleAppender<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--此日志appender是为开发使用，只配置最底级别，控制台输出的日志级别是大于或等于此级别的日志信息--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.classic.filter.ThresholdFilter<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>level</span><span class="token punctuation">&gt;</span></span>INFO<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>level</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>layout</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.classic.PatternLayout<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">&gt;</span></span>%date %level %logger %msg%n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>layout</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>logger</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pr.iceworld.fernando.spring6.kafka.producer<span class="token punctuation">"</span></span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>INFO<span class="token punctuation">"</span></span> <span class="token attr-name">additivity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>CONSOLE<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>logger</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>logger</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.springframework.kafka<span class="token punctuation">"</span></span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>WARN<span class="token punctuation">"</span></span> <span class="token attr-name">additivity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>CONSOLE<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>logger</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>logger</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.apache.kafka<span class="token punctuation">"</span></span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>WARN<span class="token punctuation">"</span></span> <span class="token attr-name">additivity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>CONSOLE<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>logger</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>root</span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>INFO<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>CONSOLE<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>root</span><span class="token punctuation">&gt;</span></span>

&lt;/conf
</code></pre> 
<h5><a id="_62"></a>配置类</h5> 
<p>扫描包下相关配置类，便于AnnotationConfigApplicationContext 加载。</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span><span class="token string">"pr.iceworld.fernando.spring6.kafka.producer"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">KafkaCommonConfig</span> <span class="token punctuation">{<!-- --></span>
<span class="token punctuation">}</span>
</code></pre> 
<p>Topic配置类</p> 
<ol><li>配置连接客户端</li><li>配置Topic</li></ol> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@PropertySource</span><span class="token punctuation">(</span><span class="token string">"classpath:application.properties"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">KafkaTopicConfig</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"${spring.kafka.bootstrap-servers}"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> bootstrapAddress<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">KafkaAdmin</span> <span class="token function">admin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> configs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        configs<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">AdminClientConfig</span><span class="token punctuation">.</span>BOOTSTRAP_SERVERS_CONFIG<span class="token punctuation">,</span> bootstrapAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">KafkaAdmin</span><span class="token punctuation">(</span>configs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">NewTopic</span> <span class="token function">topic1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token class-name">TopicBuilder</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">"topic1"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">partitions</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">replicas</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">compact</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">NewTopic</span> <span class="token function">topic2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token class-name">TopicBuilder</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">"topic2"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">partitions</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">replicas</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">compact</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">NewTopic</span> <span class="token function">topic3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token class-name">TopicBuilder</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">"topic3"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">partitions</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">replicas</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">compact</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>生产者配置类</p> 
<ol><li>生成Producer工厂</li><li>KafkaTemplate用于发送消息的模板。</li></ol> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">KafkaProducerConfig</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"${spring.kafka.bootstrap-servers}"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> bootstrapAddress<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">ProducerFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">producerFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> props <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ProducerConfig</span><span class="token punctuation">.</span>BOOTSTRAP_SERVERS_CONFIG<span class="token punctuation">,</span> bootstrapAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ProducerConfig</span><span class="token punctuation">.</span>KEY_SERIALIZER_CLASS_CONFIG<span class="token punctuation">,</span> <span class="token class-name">StringSerializer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ProducerConfig</span><span class="token punctuation">.</span>VALUE_SERIALIZER_CLASS_CONFIG<span class="token punctuation">,</span> <span class="token class-name">StringSerializer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DefaultKafkaProducerFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">KafkaTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">kafkaTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">KafkaTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token function">producerFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>发送消息类</p> 
<ol><li>模拟发送10个分区</li><li>消息发送包含确认回调</li></ol> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Service</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">KafkaProducerService</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">KafkaTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> kafkaTemplate<span class="token punctuation">;</span>

    <span class="token class-name">Random</span> random <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendMessageNormal</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">,</span> <span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">String</span> topic<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">int</span> ranPartition <span class="token operator">=</span> random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        kafkaTemplate<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token function">createRecord</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> ranPartition<span class="token punctuation">,</span> key<span class="token punctuation">,</span> topic<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"Normal sent topic={}, message={}, partition={}"</span><span class="token punctuation">,</span> topic<span class="token punctuation">,</span> message<span class="token punctuation">,</span> ranPartition<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendMessageWithHeaders</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">,</span> <span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">String</span> topic<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">int</span> ranPartition <span class="token operator">=</span> random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Message</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> providedMessage <span class="token operator">=</span> <span class="token class-name">MessageBuilder</span>
                <span class="token punctuation">.</span><span class="token function">withPayload</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token class-name">KafkaHeaders</span><span class="token punctuation">.</span>TOPIC<span class="token punctuation">,</span> topic<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token class-name">KafkaHeaders</span><span class="token punctuation">.</span>KEY<span class="token punctuation">,</span> key<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token class-name">KafkaHeaders</span><span class="token punctuation">.</span>PARTITION<span class="token punctuation">,</span> ranPartition<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        kafkaTemplate<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>providedMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"Header normal sent topic={}, message={}, partition={}"</span><span class="token punctuation">,</span> topic<span class="token punctuation">,</span> message<span class="token punctuation">,</span> ranPartition<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendMessageWithCallback</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">,</span> <span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">String</span> topic<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">final</span> <span class="token keyword">int</span> ranPartition <span class="token operator">=</span> random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token class-name">ProducerRecord</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">record</span> <span class="token operator">=</span> <span class="token function">createRecord</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> ranPartition<span class="token punctuation">,</span> key<span class="token punctuation">,</span> topic<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SendResult</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> future <span class="token operator">=</span> kafkaTemplate<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">record</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        future<span class="token punctuation">.</span><span class="token function">whenComplete</span><span class="token punctuation">(</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> ex<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>ex <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token function">handleSuccess</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                <span class="token function">handleFailure</span><span class="token punctuation">(</span><span class="token keyword">record</span><span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">handleFailure</span><span class="token punctuation">(</span><span class="token class-name">ProducerRecord</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">record</span><span class="token punctuation">,</span> <span class="token class-name">Throwable</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"Fail to send topic={}, message={} due to : {}"</span><span class="token punctuation">,</span> <span class="token keyword">record</span><span class="token punctuation">.</span><span class="token function">topic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">record</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ex<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">handleSuccess</span><span class="token punctuation">(</span><span class="token class-name">SendResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> sendResult<span class="token punctuation">,</span> <span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"Sent topic={}, message={}, offset={}, partition={}"</span><span class="token punctuation">,</span>
                sendResult<span class="token punctuation">.</span><span class="token function">getRecordMetadata</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">topic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                message<span class="token punctuation">,</span>
                sendResult<span class="token punctuation">.</span><span class="token function">getRecordMetadata</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">offset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                sendResult<span class="token punctuation">.</span><span class="token function">getRecordMetadata</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">partition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">ProducerRecord</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">createRecord</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">,</span> <span class="token keyword">int</span> ranPartition<span class="token punctuation">,</span> <span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">String</span> topic<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ProducerRecord</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span> ranPartition<span class="token punctuation">,</span> key<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>启动类</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainApp</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">AnnotationConfigApplicationContext</span> applicationContext <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnnotationConfigApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">KafkaCommonConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">KafkaProducerService</span> kafkaProducerService <span class="token operator">=</span> applicationContext<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">KafkaProducerService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            kafkaProducerService<span class="token punctuation">.</span><span class="token function">sendMessageNormal</span><span class="token punctuation">(</span><span class="token class-name">Uuid</span><span class="token punctuation">.</span><span class="token function">randomUuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"key1"</span><span class="token punctuation">,</span> <span class="token string">"topic1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            kafkaProducerService<span class="token punctuation">.</span><span class="token function">sendMessageWithHeaders</span><span class="token punctuation">(</span><span class="token class-name">Uuid</span><span class="token punctuation">.</span><span class="token function">randomUuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"key2"</span><span class="token punctuation">,</span> <span class="token string">"topic2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            kafkaProducerService<span class="token punctuation">.</span><span class="token function">sendMessageWithCallback</span><span class="token punctuation">(</span><span class="token class-name">Uuid</span><span class="token punctuation">.</span><span class="token function">randomUuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"key3"</span><span class="token punctuation">,</span> <span class="token string">"topic3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="_226"></a>消费者</h4> 
<h5><a id="_227"></a>引入依赖</h5> 
<pre><code class="prism language-xml"><span class="token comment">&lt;!-- ommit, same as producer's --&gt;</span>
</code></pre> 
<h5><a id="applicationproperties_231"></a>application.properties</h5> 
<pre><code class="prism language-bash">spring.kafka.bootstrap-servers<span class="token operator">=</span><span class="token number">192.168</span>.79.177:9092
</code></pre> 
<h5><a id="_235"></a>配置配置类</h5> 
<p>扫描包下相关配置类，便于AnnotationConfigApplicationContext 加载。</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span><span class="token string">"pr.iceworld.fernando.spring6.kafka.consumer"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">KafkaCommonConfig</span> <span class="token punctuation">{<!-- --></span>
<span class="token punctuation">}</span>
</code></pre> 
<p>消费者配置类，配置监听。</p> 
<ol><li>配置2个Consumer工厂</li><li>配置2个KafkaListenerContainerFactory，<br> 2.1 自动提交 默认<br> 2.2 手动提交<br> <code>props.put(ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG, false);</code><br> <code>factory.getContainerProperties().setAckMode(ContainerProperties.AckMode.MANUAL)</code></li><li>开启Kafka监听容器<br> <code>@EnableKafka</code> Enable Kafka listener annotated endpoints that are created under the covers by a AbstractListenerContainerFactory.</li></ol> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@EnableKafka</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@PropertySource</span><span class="token punctuation">(</span><span class="token string">"classpath:application.properties"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">KafkaConsumerConfig</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"${spring.kafka.bootstrap-servers}"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> bootstrapAddress<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">ConsumerFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">consumerFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> props <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ConsumerConfig</span><span class="token punctuation">.</span>BOOTSTRAP_SERVERS_CONFIG<span class="token punctuation">,</span> bootstrapAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ConsumerConfig</span><span class="token punctuation">.</span>GROUP_ID_CONFIG<span class="token punctuation">,</span> <span class="token string">"local"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ConsumerConfig</span><span class="token punctuation">.</span>KEY_DESERIALIZER_CLASS_CONFIG<span class="token punctuation">,</span> <span class="token class-name">StringDeserializer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ConsumerConfig</span><span class="token punctuation">.</span>VALUE_DESERIALIZER_CLASS_CONFIG<span class="token punctuation">,</span> <span class="token class-name">StringDeserializer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//props.put(ConsumerConfig.AUTO_OFFSET_RESET_CONFIG, "earliest");</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ConsumerConfig</span><span class="token punctuation">.</span>AUTO_OFFSET_RESET_CONFIG<span class="token punctuation">,</span> <span class="token string">"latest"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DefaultKafkaConsumerFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">ConcurrentKafkaListenerContainerFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">kafkaListenerContainerFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">ConcurrentKafkaListenerContainerFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> factory <span class="token operator">=</span>
                <span class="token keyword">new</span> <span class="token class-name">ConcurrentKafkaListenerContainerFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setConsumerFactory</span><span class="token punctuation">(</span><span class="token function">consumerFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setConcurrency</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">getContainerProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setPollTimeout</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> factory<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">ConsumerFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">consumerFactoryAutoCommitFalse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> props <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ConsumerConfig</span><span class="token punctuation">.</span>BOOTSTRAP_SERVERS_CONFIG<span class="token punctuation">,</span> bootstrapAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ConsumerConfig</span><span class="token punctuation">.</span>GROUP_ID_CONFIG<span class="token punctuation">,</span> <span class="token string">"localCommitFalse"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ConsumerConfig</span><span class="token punctuation">.</span>KEY_DESERIALIZER_CLASS_CONFIG<span class="token punctuation">,</span> <span class="token class-name">StringDeserializer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ConsumerConfig</span><span class="token punctuation">.</span>VALUE_DESERIALIZER_CLASS_CONFIG<span class="token punctuation">,</span> <span class="token class-name">StringDeserializer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//props.put(ConsumerConfig.AUTO_OFFSET_RESET_CONFIG, "earliest");</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ConsumerConfig</span><span class="token punctuation">.</span>AUTO_OFFSET_RESET_CONFIG<span class="token punctuation">,</span> <span class="token string">"latest"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ConsumerConfig</span><span class="token punctuation">.</span>ENABLE_AUTO_COMMIT_CONFIG<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DefaultKafkaConsumerFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">ConcurrentKafkaListenerContainerFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">kafkaListenerContainerFactoryAutoCommitFalse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">ConcurrentKafkaListenerContainerFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> factory <span class="token operator">=</span>
                <span class="token keyword">new</span> <span class="token class-name">ConcurrentKafkaListenerContainerFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setConsumerFactory</span><span class="token punctuation">(</span><span class="token function">consumerFactoryAutoCommitFalse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setConcurrency</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">getContainerProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAckMode</span><span class="token punctuation">(</span><span class="token class-name">ContainerProperties<span class="token punctuation">.</span>AckMode</span><span class="token punctuation">.</span>MANUAL<span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">getContainerProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setPollTimeout</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> factory<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>Topic接收类</p> 
<ol><li>设置接收Topic</li><li>设置需要处理的监听容器工厂</li><li>筛选需要处理的partition消息</li></ol> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Service</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">KafkaConsumerService</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@KafkaListener</span><span class="token punctuation">(</span>
            topics <span class="token operator">=</span> <span class="token string">"topic1"</span><span class="token punctuation">,</span>
            containerFactory <span class="token operator">=</span> <span class="token string">"kafkaListenerContainerFactory"</span><span class="token punctuation">,</span>
            groupId <span class="token operator">=</span> <span class="token string">"local"</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">receiveMessage</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">,</span> <span class="token class-name">ConsumerRecord</span> consumerRecord<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"====&gt; Topic={}, Partition={}, offset={}, Received message={}"</span><span class="token punctuation">,</span>
                consumerRecord<span class="token punctuation">.</span><span class="token function">topic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> consumerRecord<span class="token punctuation">.</span><span class="token function">partition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> consumerRecord<span class="token punctuation">.</span><span class="token function">offset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@KafkaListener</span><span class="token punctuation">(</span>
            topics <span class="token operator">=</span> <span class="token string">"topic2"</span><span class="token punctuation">,</span>
            containerFactory <span class="token operator">=</span> <span class="token string">"kafkaListenerContainerFactory"</span><span class="token punctuation">,</span>
            groupId <span class="token operator">=</span> <span class="token string">"local"</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">receiveMessageWithHeaders</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Payload</span> <span class="token class-name">String</span> message<span class="token punctuation">,</span>
                                          <span class="token annotation punctuation">@Header</span><span class="token punctuation">(</span><span class="token class-name">KafkaHeaders</span><span class="token punctuation">.</span>RECEIVED_TOPIC<span class="token punctuation">)</span> <span class="token class-name">String</span> topic<span class="token punctuation">,</span>
                                          <span class="token annotation punctuation">@Header</span><span class="token punctuation">(</span><span class="token class-name">KafkaHeaders</span><span class="token punctuation">.</span>RECEIVED_PARTITION<span class="token punctuation">)</span> <span class="token keyword">int</span> partition<span class="token punctuation">,</span>
                                          <span class="token annotation punctuation">@Header</span><span class="token punctuation">(</span><span class="token class-name">KafkaHeaders</span><span class="token punctuation">.</span>RECEIVED_KEY<span class="token punctuation">)</span> <span class="token class-name">String</span> messageKey<span class="token punctuation">,</span>
                                          <span class="token annotation punctuation">@Header</span><span class="token punctuation">(</span><span class="token class-name">KafkaHeaders</span><span class="token punctuation">.</span>TIMESTAMP_TYPE<span class="token punctuation">)</span> <span class="token class-name">String</span>  timestampType<span class="token punctuation">,</span>
                                          <span class="token annotation punctuation">@Header</span><span class="token punctuation">(</span><span class="token class-name">KafkaHeaders</span><span class="token punctuation">.</span>RECEIVED_TIMESTAMP<span class="token punctuation">)</span> <span class="token class-name">Long</span> timestamp<span class="token punctuation">,</span>
                                          <span class="token annotation punctuation">@Header</span><span class="token punctuation">(</span><span class="token class-name">KafkaHeaders</span><span class="token punctuation">.</span>OFFSET<span class="token punctuation">)</span> <span class="token keyword">int</span> offset<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"====&gt; Headers topic={}, partition={}, offset={}, messageKey={}, "</span>
                        <span class="token operator">+</span> <span class="token string">"timestampType={}, timestamp={}, Received message={}"</span><span class="token punctuation">,</span>
                 topic<span class="token punctuation">,</span> partition<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> messageKey<span class="token punctuation">,</span> timestampType<span class="token punctuation">,</span> timestamp<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@KafkaListener</span><span class="token punctuation">(</span>
            containerFactory <span class="token operator">=</span> <span class="token string">"kafkaListenerContainerFactoryAutoCommitFalse"</span><span class="token punctuation">,</span>
            groupId <span class="token operator">=</span> <span class="token string">"localCommitFalse"</span><span class="token punctuation">,</span>
            topicPartitions <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token annotation punctuation">@TopicPartition</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">"topic3"</span><span class="token punctuation">,</span>
                            partitions <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"0"</span><span class="token punctuation">}</span>
                    <span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">receiveMessageBySpecificPartition</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">,</span> <span class="token class-name">ConsumerRecord</span> consumerRecord<span class="token punctuation">,</span> <span class="token class-name">Acknowledgment</span> ack<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"====&gt; Specific topic={}, partition partition={}, offset={}, Received message={}"</span><span class="token punctuation">,</span>
                consumerRecord<span class="token punctuation">.</span><span class="token function">topic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> consumerRecord<span class="token punctuation">.</span><span class="token function">partition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> consumerRecord<span class="token punctuation">.</span><span class="token function">offset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        ack<span class="token punctuation">.</span><span class="token function">acknowledge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>启动类，启动多个实例模拟消费</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainApp</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">new</span> <span class="token class-name">AnnotationConfigApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">KafkaCommonConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>生产日志</p> 
<pre><code class="prism language-bash"><span class="token number">2023</span>-03-10 <span class="token number">20</span>:39:16,967 INFO pr.iceworld.fernando.spring6.kafka.producer.service.KafkaProducerService Normal sent <span class="token assign-left variable">topic</span><span class="token operator">=</span>topic1, <span class="token assign-left variable">message</span><span class="token operator">=</span>6smhtHX7SJ6hEwnr4Io9kA, <span class="token assign-left variable">partition</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token number">2023</span>-03-10 <span class="token number">20</span>:39:17,030 INFO pr.iceworld.fernando.spring6.kafka.producer.service.KafkaProducerService Header normal sent <span class="token assign-left variable">topic</span><span class="token operator">=</span>topic2, <span class="token assign-left variable">message</span><span class="token operator">=</span>QMIol2GlSRuODmK9hDDQcw, <span class="token assign-left variable">partition</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token number">2023</span>-03-10 <span class="token number">20</span>:39:17,041 INFO pr.iceworld.fernando.spring6.kafka.producer.service.KafkaProducerService Normal sent <span class="token assign-left variable">topic</span><span class="token operator">=</span>topic1, <span class="token assign-left variable">message</span><span class="token operator">=</span>sRi5iHY7TUqSqzM4TbUF1g, <span class="token assign-left variable">partition</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token number">2023</span>-03-10 <span class="token number">20</span>:39:17,042 INFO pr.iceworld.fernando.spring6.kafka.producer.service.KafkaProducerService Header normal sent <span class="token assign-left variable">topic</span><span class="token operator">=</span>topic2, <span class="token assign-left variable">message</span><span class="token operator">=</span>uiffzWw9TCab9u4QAQqoOA, <span class="token assign-left variable">partition</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token number">2023</span>-03-10 <span class="token number">20</span>:39:17,043 INFO pr.iceworld.fernando.spring6.kafka.producer.service.KafkaProducerService Normal sent <span class="token assign-left variable">topic</span><span class="token operator">=</span>topic1, <span class="token assign-left variable">message</span><span class="token operator">=</span>Vsl9WmPGQnCn9Ox6R3y-3Q, <span class="token assign-left variable">partition</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token number">2023</span>-03-10 <span class="token number">20</span>:39:17,043 INFO pr.iceworld.fernando.spring6.kafka.producer.service.KafkaProducerService Header normal sent <span class="token assign-left variable">topic</span><span class="token operator">=</span>topic2, <span class="token assign-left variable">message</span><span class="token operator">=</span>RSmQ34W9T9GiJsLBwW5XiQ, <span class="token assign-left variable">partition</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token number">2023</span>-03-10 <span class="token number">20</span>:39:17,044 INFO pr.iceworld.fernando.spring6.kafka.producer.service.KafkaProducerService Normal sent <span class="token assign-left variable">topic</span><span class="token operator">=</span>topic1, <span class="token assign-left variable">message</span><span class="token operator">=</span>vM447x4yTgqXp1ciulyeSw, <span class="token assign-left variable">partition</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token number">2023</span>-03-10 <span class="token number">20</span>:39:17,044 INFO pr.iceworld.fernando.spring6.kafka.producer.service.KafkaProducerService Header normal sent <span class="token assign-left variable">topic</span><span class="token operator">=</span>topic2, <span class="token assign-left variable">message</span><span class="token operator">=</span>WXQldMTxRxiUXhn0Ov2gPg, <span class="token assign-left variable">partition</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token number">2023</span>-03-10 <span class="token number">20</span>:39:17,045 INFO pr.iceworld.fernando.spring6.kafka.producer.service.KafkaProducerService Normal sent <span class="token assign-left variable">topic</span><span class="token operator">=</span>topic1, <span class="token assign-left variable">message</span><span class="token operator">=</span>ffYc0g3tR-euzDKO3Y2DQw, <span class="token assign-left variable">partition</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token number">2023</span>-03-10 <span class="token number">20</span>:39:17,046 INFO pr.iceworld.fernando.spring6.kafka.producer.service.KafkaProducerService Header normal sent <span class="token assign-left variable">topic</span><span class="token operator">=</span>topic2, <span class="token assign-left variable">message</span><span class="token operator">=</span>xpZy-YswSdeoobQaeZIFZA, <span class="token assign-left variable">partition</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token number">2023</span>-03-10 <span class="token number">20</span>:39:17,053 INFO pr.iceworld.fernando.spring6.kafka.producer.service.KafkaProducerService Sent <span class="token assign-left variable">topic</span><span class="token operator">=</span>topic3, <span class="token assign-left variable">message</span><span class="token operator">=</span>m0A92H1xQLq_cfxqNkc6ZQ, <span class="token assign-left variable">offset</span><span class="token operator">=</span><span class="token number">69</span>, <span class="token assign-left variable">partition</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token number">2023</span>-03-10 <span class="token number">20</span>:39:17,060 INFO pr.iceworld.fernando.spring6.kafka.producer.service.KafkaProducerService Sent <span class="token assign-left variable">topic</span><span class="token operator">=</span>topic3, <span class="token assign-left variable">message</span><span class="token operator">=</span>SwXaJVq7SQCZe3NkanhUBA, <span class="token assign-left variable">offset</span><span class="token operator">=</span><span class="token number">70</span>, <span class="token assign-left variable">partition</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token number">2023</span>-03-10 <span class="token number">20</span>:39:17,070 INFO pr.iceworld.fernando.spring6.kafka.producer.service.KafkaProducerService Sent <span class="token assign-left variable">topic</span><span class="token operator">=</span>topic3, <span class="token assign-left variable">message</span><span class="token operator">=</span>Qt4G_oXNTfy8gFs43SWp4Q, <span class="token assign-left variable">offset</span><span class="token operator">=</span><span class="token number">23</span>, <span class="token assign-left variable">partition</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token number">2023</span>-03-10 <span class="token number">20</span>:39:17,070 INFO pr.iceworld.fernando.spring6.kafka.producer.service.KafkaProducerService Sent <span class="token assign-left variable">topic</span><span class="token operator">=</span>topic3, <span class="token assign-left variable">message</span><span class="token operator">=</span>5qWN4-AXT9O2gLLvwH3s6A, <span class="token assign-left variable">offset</span><span class="token operator">=</span><span class="token number">23</span>, <span class="token assign-left variable">partition</span><span class="token operator">=</span><span class="token number">2</span>
<span class="token number">2023</span>-03-10 <span class="token number">20</span>:39:17,071 INFO pr.iceworld.fernando.spring6.kafka.producer.service.KafkaProducerService Sent <span class="token assign-left variable">topic</span><span class="token operator">=</span>topic3, <span class="token assign-left variable">message</span><span class="token operator">=</span>vuaoBOK_SamaeQ1e3MJ-kg, <span class="token assign-left variable">offset</span><span class="token operator">=</span><span class="token number">71</span>, <span class="token assign-left variable">partition</span><span class="token operator">=</span><span class="token number">0</span>
</code></pre> 
<p>消费者1 topic3 partition = {“0”}</p> 
<pre><code class="prism language-bash"><span class="token number">2023</span>-03-10 <span class="token number">20</span>:39:17,113 INFO pr.iceworld.fernando.spring6.kafka.consumer.service.KafkaConsumerService <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">&gt;</span> Specific <span class="token assign-left variable">topic</span><span class="token operator">=</span>topic3, partition <span class="token assign-left variable">partition</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">offset</span><span class="token operator">=</span><span class="token number">69</span>, Received <span class="token assign-left variable">message</span><span class="token operator">=</span>m0A92H1xQLq_cfxqNkc6ZQ
<span class="token number">2023</span>-03-10 <span class="token number">20</span>:39:17,131 INFO pr.iceworld.fernando.spring6.kafka.consumer.service.KafkaConsumerService <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">&gt;</span> Specific <span class="token assign-left variable">topic</span><span class="token operator">=</span>topic3, partition <span class="token assign-left variable">partition</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">offset</span><span class="token operator">=</span><span class="token number">70</span>, Received <span class="token assign-left variable">message</span><span class="token operator">=</span>SwXaJVq7SQCZe3NkanhUBA
<span class="token number">2023</span>-03-10 <span class="token number">20</span>:39:17,134 INFO pr.iceworld.fernando.spring6.kafka.consumer.service.KafkaConsumerService <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">&gt;</span> Specific <span class="token assign-left variable">topic</span><span class="token operator">=</span>topic3, partition <span class="token assign-left variable">partition</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">offset</span><span class="token operator">=</span><span class="token number">71</span>, Received <span class="token assign-left variable">message</span><span class="token operator">=</span>vuaoBOK_SamaeQ1e3MJ-kg
</code></pre> 
<p>消费者2 topic3 partition = {“1”, “2”}</p> 
<pre><code class="prism language-bash"><span class="token number">2023</span>-03-10 <span class="token number">20</span>:39:17,021 INFO pr.iceworld.fernando.spring6.kafka.consumer.service.KafkaConsumerService <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">&gt;</span> <span class="token assign-left variable">Topic</span><span class="token operator">=</span>topic1, <span class="token assign-left variable">Partition</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">offset</span><span class="token operator">=</span><span class="token number">69</span>, Received <span class="token assign-left variable">message</span><span class="token operator">=</span>6smhtHX7SJ6hEwnr4Io9kA
<span class="token number">2023</span>-03-10 <span class="token number">20</span>:39:17,037 INFO pr.iceworld.fernando.spring6.kafka.consumer.service.KafkaConsumerService <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">&gt;</span> Headers <span class="token assign-left variable">topic</span><span class="token operator">=</span>topic2, <span class="token assign-left variable">partition</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">offset</span><span class="token operator">=</span><span class="token number">106</span>, <span class="token assign-left variable">messageKey</span><span class="token operator">=</span>key2, <span class="token assign-left variable">timestampType</span><span class="token operator">=</span>CREATE_TIME, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1678451957029</span>, Received <span class="token assign-left variable">message</span><span class="token operator">=</span>QMIol2GlSRuODmK9hDDQcw
<span class="token number">2023</span>-03-10 <span class="token number">20</span>:39:17,051 INFO pr.iceworld.fernando.spring6.kafka.consumer.service.KafkaConsumerService <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">&gt;</span> <span class="token assign-left variable">Topic</span><span class="token operator">=</span>topic1, <span class="token assign-left variable">Partition</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">offset</span><span class="token operator">=</span><span class="token number">70</span>, Received <span class="token assign-left variable">message</span><span class="token operator">=</span>sRi5iHY7TUqSqzM4TbUF1g
<span class="token number">2023</span>-03-10 <span class="token number">20</span>:39:17,054 INFO pr.iceworld.fernando.spring6.kafka.consumer.service.KafkaConsumerService <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">&gt;</span> Specific <span class="token assign-left variable">topic</span><span class="token operator">=</span>topic3, partition <span class="token assign-left variable">partition</span><span class="token operator">=</span><span class="token number">1</span>, <span class="token assign-left variable">offset</span><span class="token operator">=</span><span class="token number">23</span>, Received <span class="token assign-left variable">message</span><span class="token operator">=</span>Qt4G_oXNTfy8gFs43SWp4Q
<span class="token number">2023</span>-03-10 <span class="token number">20</span>:39:17,054 INFO pr.iceworld.fernando.spring6.kafka.consumer.service.KafkaConsumerService <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">&gt;</span> Specific <span class="token assign-left variable">topic</span><span class="token operator">=</span>topic3, partition <span class="token assign-left variable">partition</span><span class="token operator">=</span><span class="token number">2</span>, <span class="token assign-left variable">offset</span><span class="token operator">=</span><span class="token number">23</span>, Received <span class="token assign-left variable">message</span><span class="token operator">=</span>5qWN4-AXT9O2gLLvwH3s6A
<span class="token number">2023</span>-03-10 <span class="token number">20</span>:39:17,056 INFO pr.iceworld.fernando.spring6.kafka.consumer.service.KafkaConsumerService <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">&gt;</span> <span class="token assign-left variable">Topic</span><span class="token operator">=</span>topic1, <span class="token assign-left variable">Partition</span><span class="token operator">=</span><span class="token number">1</span>, <span class="token assign-left variable">offset</span><span class="token operator">=</span><span class="token number">46</span>, Received <span class="token assign-left variable">message</span><span class="token operator">=</span>Vsl9WmPGQnCn9Ox6R3y-3Q
<span class="token number">2023</span>-03-10 <span class="token number">20</span>:39:17,056 INFO pr.iceworld.fernando.spring6.kafka.consumer.service.KafkaConsumerService <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">&gt;</span> <span class="token assign-left variable">Topic</span><span class="token operator">=</span>topic1, <span class="token assign-left variable">Partition</span><span class="token operator">=</span><span class="token number">1</span>, <span class="token assign-left variable">offset</span><span class="token operator">=</span><span class="token number">47</span>, Received <span class="token assign-left variable">message</span><span class="token operator">=</span>vM447x4yTgqXp1ciulyeSw
<span class="token number">2023</span>-03-10 <span class="token number">20</span>:39:17,057 INFO pr.iceworld.fernando.spring6.kafka.consumer.service.KafkaConsumerService <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">&gt;</span> Headers <span class="token assign-left variable">topic</span><span class="token operator">=</span>topic2, <span class="token assign-left variable">partition</span><span class="token operator">=</span><span class="token number">1</span>, <span class="token assign-left variable">offset</span><span class="token operator">=</span><span class="token number">9</span>, <span class="token assign-left variable">messageKey</span><span class="token operator">=</span>key2, <span class="token assign-left variable">timestampType</span><span class="token operator">=</span>CREATE_TIME, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1678451957041</span>, Received <span class="token assign-left variable">message</span><span class="token operator">=</span>uiffzWw9TCab9u4QAQqoOA
<span class="token number">2023</span>-03-10 <span class="token number">20</span>:39:17,058 INFO pr.iceworld.fernando.spring6.kafka.consumer.service.KafkaConsumerService <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">&gt;</span> Headers <span class="token assign-left variable">topic</span><span class="token operator">=</span>topic2, <span class="token assign-left variable">partition</span><span class="token operator">=</span><span class="token number">1</span>, <span class="token assign-left variable">offset</span><span class="token operator">=</span><span class="token number">10</span>, <span class="token assign-left variable">messageKey</span><span class="token operator">=</span>key2, <span class="token assign-left variable">timestampType</span><span class="token operator">=</span>CREATE_TIME, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1678451957043</span>, Received <span class="token assign-left variable">message</span><span class="token operator">=</span>RSmQ34W9T9GiJsLBwW5XiQ
<span class="token number">2023</span>-03-10 <span class="token number">20</span>:39:17,058 INFO pr.iceworld.fernando.spring6.kafka.consumer.service.KafkaConsumerService <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">&gt;</span> Headers <span class="token assign-left variable">topic</span><span class="token operator">=</span>topic2, <span class="token assign-left variable">partition</span><span class="token operator">=</span><span class="token number">1</span>, <span class="token assign-left variable">offset</span><span class="token operator">=</span><span class="token number">11</span>, <span class="token assign-left variable">messageKey</span><span class="token operator">=</span>key2, <span class="token assign-left variable">timestampType</span><span class="token operator">=</span>CREATE_TIME, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1678451957044</span>, Received <span class="token assign-left variable">message</span><span class="token operator">=</span>WXQldMTxRxiUXhn0Ov2gPg
<span class="token number">2023</span>-03-10 <span class="token number">20</span>:39:17,062 INFO pr.iceworld.fernando.spring6.kafka.consumer.service.KafkaConsumerService <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">&gt;</span> <span class="token assign-left variable">Topic</span><span class="token operator">=</span>topic1, <span class="token assign-left variable">Partition</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">offset</span><span class="token operator">=</span><span class="token number">71</span>, Received <span class="token assign-left variable">message</span><span class="token operator">=</span>ffYc0g3tR-euzDKO3Y2DQw
<span class="token number">2023</span>-03-10 <span class="token number">20</span>:39:17,064 INFO pr.iceworld.fernando.spring6.kafka.consumer.service.KafkaConsumerService <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">&gt;</span> Headers <span class="token assign-left variable">topic</span><span class="token operator">=</span>topic2, <span class="token assign-left variable">partition</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">offset</span><span class="token operator">=</span><span class="token number">107</span>, <span class="token assign-left variable">messageKey</span><span class="token operator">=</span>key2, <span class="token assign-left variable">timestampType</span><span class="token operator">=</span>CREATE_TIME, <span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">1678451957046</span>, Received <span class="token assign-left variable">message</span><span class="token operator">=</span>xpZy-YswSdeoobQaeZIFZA
</code></pre> 
<h3><a id="Reference_408"></a>Reference</h3> 
<p>https://docs.spring.io/spring-kafka/reference/html/</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/7a1315be9b91c4302155eaa841f7e908/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">几款支持国标GB28181平台的视频监控设备接入方案</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e22f53a06678f17de2c1347bdc552da8/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Altium Designer(AD)软件使用记录05-PCB叠层设计</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>