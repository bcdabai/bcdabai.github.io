<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>vue2-django 实现登录注册 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="vue2-django 实现登录注册" />
<meta property="og:description" content="目录
前端vue：
后端django处理请求
前端vue： cd到目标文件夹，输入：vue init webpack 文件名
前四个一路回车，后几个选no
接着cd到建好的文件夹，执行npm install ，然后就可以npm run dev 查看初始页面了
接下来我们通过vue组件来搭建一个前端页面
首先把默认样式清除，删除helloword.vue后将app.vue清除成如下内容。
然后在components文件夹中新建vue文件，写入我们需要的内容
我构建了三个文件，分别用来登录、注册、登录成功后显示
我们要做的是注册与登录功能，那么我们需要账号与密码
我们先做注册功能，也就是进入signup.vue中
因此我们在data里构建一个对象loginForm存储输入的账号与密码
data(){ return{ loginForm:{ username:&#39;&#39;, password:&#39;&#39; } } }, data写在&lt;script&gt;中，如
而后构建一个form表单，输入框绑定username与password
&lt;template&gt; &lt;div id=&#34;sign&#34;&gt; &lt;div style=&#34;text-align: center; font-family: 华文琥珀; font-size: larger;&#34;&gt; &lt;div&gt;欢迎注册&lt;/div&gt; &lt;div&gt;请输入您的信息&lt;/div&gt; &lt;/div&gt; &lt;div style=&#34;height: 50px;&#34;&gt;&lt;/div&gt; &lt;div&gt; &lt;form v-bind:model=&#34;loginForm&#34;&gt; &lt;input v-model=&#34;loginForm.username&#34; type=&#34;text&#34; placeholder=&#34;请输入用户名&#34;/&gt; &lt;input v-model=&#34;loginForm.password&#34; type=&#34;password&#34; placeholder=&#34;请输入密码&#34;/&gt; &lt;/form&gt; &lt;button v-on:click=&#34;summiti()&#34;&gt;注册&lt;/button&gt; &lt;/div&gt; &lt;/div&gt; &lt;/template&gt; 写好之后，我们要怎么查看写出来的页面是什么样子呢？
这需要用到vue-router
在项目的根目录的终端执行npm install --legacy-peer-deps vue-router@3." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/3eb26287f30d36d95ddbc2e1a143eb63/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-04-27T19:34:55+08:00" />
<meta property="article:modified_time" content="2023-04-27T19:34:55+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">vue2-django 实现登录注册</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="%E9%A6%96%E5%85%88%E6%98%AF%E5%89%8D%E7%AB%AFvue%EF%BC%9A-toc" style="margin-left:0px;"><a href="#%E9%A6%96%E5%85%88%E6%98%AF%E5%89%8D%E7%AB%AFvue%EF%BC%9A" rel="nofollow">前端vue：</a></p> 
<p id="%E6%8E%A5%E4%B8%8B%E6%9D%A5%E5%86%99%E5%90%8E%E7%AB%AF%E7%A8%8B%E5%BA%8F%E5%AF%B9%E8%AF%B7%E6%B1%82%E5%81%9A%E5%87%BA%E5%8F%8D%E5%BA%94-toc" style="margin-left:0px;"><a href="#%E6%8E%A5%E4%B8%8B%E6%9D%A5%E5%86%99%E5%90%8E%E7%AB%AF%E7%A8%8B%E5%BA%8F%E5%AF%B9%E8%AF%B7%E6%B1%82%E5%81%9A%E5%87%BA%E5%8F%8D%E5%BA%94" rel="nofollow">后端django</a>处理请求</p> 
<hr id="hr-toc"> 
<p></p> 
<h2>前端vue：</h2> 
<p>cd到目标文件夹，输入：vue init webpack 文件名</p> 
<p><img alt="" height="352" src="https://images2.imgbox.com/f8/f6/6X2bpgBD_o.png" width="1200"></p> 
<p> 前四个一路回车，后几个选no</p> 
<p>接着cd到建好的文件夹，执行npm install ，然后就可以npm run dev 查看初始页面了</p> 
<p><img alt="" height="541" src="https://images2.imgbox.com/d5/b6/mhBg1JRb_o.png" width="535"></p> 
<p> 接下来我们通过vue组件来搭建一个前端页面</p> 
<p>首先把默认样式清除，删除helloword.vue后将app.vue清除成如下内容。</p> 
<p><img alt="" height="589" src="https://images2.imgbox.com/3c/8e/gRg0gAus_o.png" width="693"></p> 
<p> 然后在components文件夹中新建vue文件，写入我们需要的内容</p> 
<p>我构建了三个文件，分别用来登录、注册、登录成功后显示</p> 
<p><img alt="" height="628" src="https://images2.imgbox.com/b3/8a/RDJcARsD_o.png" width="337"></p> 
<p> 我们要做的是注册与登录功能，那么我们需要账号与密码</p> 
<p>我们先做注册功能，也就是进入signup.vue中</p> 
<p>因此我们在data里构建一个对象loginForm存储输入的账号与密码</p> 
<pre><code class="language-javascript">data(){
            return{
                loginForm:{
                username:'',
                password:''  
            }
            }  
        },</code></pre> 
<p>data写在&lt;script&gt;中，如</p> 
<p><img alt="" height="399" src="https://images2.imgbox.com/cc/ee/fNj58Frp_o.png" width="721"></p> 
<p>而后构建一个form表单，输入框绑定username与password</p> 
<pre><code class="language-html">&lt;template&gt;
    &lt;div id="sign"&gt;
        &lt;div style="text-align: center; font-family: 华文琥珀; font-size: larger;"&gt;
        &lt;div&gt;欢迎注册&lt;/div&gt;
        &lt;div&gt;请输入您的信息&lt;/div&gt;
        &lt;/div&gt;
        &lt;div style="height: 50px;"&gt;&lt;/div&gt;
        &lt;div&gt;
      &lt;form v-bind:model="loginForm"&gt;
        &lt;input v-model="loginForm.username" type="text" placeholder="请输入用户名"/&gt;
        &lt;input v-model="loginForm.password" type="password" placeholder="请输入密码"/&gt;
    &lt;/form&gt;
    &lt;button v-on:click="summiti()"&gt;注册&lt;/button&gt;
    &lt;/div&gt;
    &lt;/div&gt;
&lt;/template&gt;</code></pre> 
<p>写好之后，我们要怎么查看写出来的页面是什么样子呢？</p> 
<p>这需要用到vue-router</p> 
<p>在项目的根目录的终端执行npm install --legacy-peer-deps vue-router@3.5.2</p> 
<p>然后在如图位置新建一个routers文件夹，其中新建一个index.js文件</p> 
<p><img alt="" height="580" src="https://images2.imgbox.com/e6/5a/Yj6lFl1K_o.png" width="339"></p> 
<p>其中写入</p> 
<p><img alt="" height="555" src="https://images2.imgbox.com/74/a1/RDIT3pf8_o.png" width="744"></p> 
<p></p> 
<p>然后在main.js中引入</p> 
<p><img alt="" height="693" src="https://images2.imgbox.com/94/a9/SWNSWqIT_o.png" width="872"></p> 
<p> 最后在app.vue中如图位置加一句&lt;router-view/&gt;</p> 
<p><img alt="" height="572" src="https://images2.imgbox.com/95/a0/hEA01T1G_o.png" width="645"></p> 
<p> 我们就可以在终端中输入npm run dev，在浏览器中输入指定地址，就可以看到页面了(ctrl+c 停止服务器)</p> 
<p>这篇文章主要讲解登录与注册的实现，美观度可以自己调节</p> 
<p><img alt="" height="1080" src="https://images2.imgbox.com/eb/3e/VFVkiCxf_o.png" width="1200"></p> 
<p> 前端的最后一步就是对用户名和密码的提交了，我们需要用到axios对请求进行处理</p> 
<p>首先安装：npm install axios </p> 
<p>然后在main.js中引入</p> 
<pre><code class="language-javascript">import axios from 'axios'

axios.defaults.withCredentials = true// 请求携带cookie
axios.defaults.headers.post['X-CSRFToken']='';//设置请求头的跨域密匙

axios.defaults.headers.post['Content-Type'] = 'application/x-www-form-urlencoded';

axios.defaults.transformRequest = [function (data) {  //将发送的post参数封装成FROM-DATA，使后端接收
  let ret = ''
  for (let it in data) {
  ret += encodeURIComponent(it) + '=' + encodeURIComponent(data[it]) + '&amp;'
  }
  return ret
  }];

Vue.prototype.$axios = axios</code></pre> 
<p>插入到如图位置</p> 
<p><img alt="" height="747" src="https://images2.imgbox.com/c7/ee/Cj0f23P0_o.png" width="1147"></p> 
<p> 接下来就在signup.vue中编写提交函数</p> 
<pre><code class="language-javascript">methods:{
            summiti(){
                this.$axios
              .post(
                '/regester/', //后端执行注册的url
                {'user':this.loginForm.username, //用户名
                'password':this.loginForm.password, //密码
            }
              ).then((res)=&gt;{
                alert("注册成功")
                this.$router.push({  //前往登录界面
                    path: './',
                    });
              }).catch((err)=&gt;{
                alert("注册失败，请更换用户名")
              })
            }
        }</code></pre> 
<p>写在如图位置</p> 
<p><img alt="" height="928" src="https://images2.imgbox.com/ea/cb/cj6xkB3Z_o.png" width="978"></p> 
<h2 id="%E6%8E%A5%E4%B8%8B%E6%9D%A5%E5%86%99%E5%90%8E%E7%AB%AF%E7%A8%8B%E5%BA%8F%E5%AF%B9%E8%AF%B7%E6%B1%82%E5%81%9A%E5%87%BA%E5%8F%8D%E5%BA%94">后端django处理请求</h2> 
<p>首先，下载django ：pip3 install django</p> 
<p>然后，cd到一个心仪的文件夹，创建django项目：django-admin startproject djan (djan是项目名称，可以换成一个心仪的名字)</p> 
<p>系统就为我们创建了一个框架</p> 
<p><img alt="" height="277" src="https://images2.imgbox.com/1e/84/pHzhmWer_o.png" width="478"></p> 
<p> 接着，cd到第一个djan文件夹，创建APP ： python manage.py startapp eapp（eapp是app名称），然后可以看到系统又为我们创建了一个文件夹</p> 
<p><img alt="" height="118" src="https://images2.imgbox.com/1a/01/TV1uRJmN_o.png" width="474"></p> 
<p></p> 
<p>我们可以开始写后端程序了</p> 
<p>为了保存注册了的用户，我们需要连接数据库</p> 
<p>我们首先需要引入app，不然数据库不知道为什么样的对象建表</p> 
<p>在setting.py的INSTALLED_APPS中引入app</p> 
<p><img alt="" height="269" src="https://images2.imgbox.com/70/51/1yRNe41c_o.png" width="394"></p> 
<p>然后在setting的DATABASES中配置数据库</p> 
<p><img alt="" height="320" src="https://images2.imgbox.com/0a/3c/bUkxj9QC_o.png" width="511"></p> 
<p> 之后进入eapp的models.py文件，写入</p> 
<pre><code class="language-javascript">class User(models.Model):
    object = models.Manager()
    name = models.CharField(max_length=15, unique=True)
    password = models.CharField(max_length=20)</code></pre> 
<p> name为用户名，password为密码，系统构造的数据库的结构将依赖这个User对象</p> 
<p>在django项目的根目录下输入命令python manage.py makemigrations</p> 
<p>这会在eapp目录中的migrations目录中生成一个0001_initial.py迁移记录文件</p> 
<p>然后还是根目录中输入python manage.py migrate</p> 
<p>系统将为我们建表（下图是通过navicat查看建好的表）</p> 
<p><img alt="" height="859" src="https://images2.imgbox.com/56/51/QXsmnXww_o.png" width="1200"></p> 
<p> 数据库连接完成</p> 
<p>进入eapp中的view.py文件夹 ，我们接下来构建响应路径，将内容改为</p> 
<pre><code class="language-python">from django.shortcuts import render
from eapp.models import User
from django.http import JsonResponse
# Create your views here.

def regester(request):
    user = request.POST.get("user")
    password = request.POST.get("password")
    userinfo = User(name=user,password=password)
    userinfo.save() #保存至数据库
    return JsonResponse({'codestatus':1},safe=False) </code></pre> 
<p>若在import处报错，则使用pycharm右键根目录，如图调整为源代码根目录</p> 
<p><img alt="" height="869" src="https://images2.imgbox.com/40/17/L7lJKc7a_o.png" width="780"></p> 
<p></p> 
<p>再将view导入url,进入url.py中</p> 
<p><img alt="" height="238" src="https://images2.imgbox.com/ee/9c/NIexSdk1_o.png" width="440"></p> 
<p> 那么注册路径就写好了。</p> 
<p>到目前，我们为注册的执行部署了接口，但对注册的网页还没部署接口</p> 
<p>因此我们接下来对网页的显示进行部署，但一个网站最开始一般是登录而不是注册，因此我打算以登录界面为基页面</p> 
<p>先写好登录页面的vue文件</p> 
<pre><code class="language-html">&lt;template&gt;
    &lt;div id="login"&gt;
    &lt;div style="text-align: center; font-size: larger;"&gt;
        &lt;div&gt;欢迎光临&lt;/div&gt;
        &lt;div&gt;请输入您的账户&lt;/div&gt;
    &lt;/div&gt;
    &lt;div&gt;
      &lt;form action="/index/" method="post"&gt;
        &lt;input v-model="loginfo.username" type="text" placeholder="请输入用户名"&gt;
        &lt;input v-model="loginfo.password" type="password" placeholder="请输入密码"&gt;
    &lt;/form&gt;
        &lt;input v-on:click="login()" value="登录" /&gt;
        &lt;div style="height: 5px;"&gt;&lt;/div&gt;
        &lt;div&gt;
          &lt;div style="height: 9px;"&gt;&lt;/div&gt;
          &lt;a href="/#/signup" style="color:black ;text-decoration:none"&gt;注册&lt;/a&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;

export default {
    name:'login',
    data(){
            return {loginfo:{
                'username':'',
                'password':''
            }}
        },
        methods:{
            login(){
                this.$axios
              .post(
                '/loginn/',//向loginn发送请求，验证密码是否正确
                {'user':this.loginfo.username,
                'password':this.loginfo.password,
            }
              ).then(res=&gt;{
                if(res.data.loginstatus==1) //loginstatus为后端返回的数据，
                {   
                    this.$router.push({ //页面跳转到登录成功界面
                        path: '/welcome',
                        params:{'username':this.loginfo.username}
                        });}
                else{
                    alert('账号或密码错误')
                }
              })
            }
        }
    
}
&lt;/script&gt;

&lt;style&gt;

&lt;/style&gt;</code></pre> 
<p>部署route</p> 
<p><img alt="" height="547" src="https://images2.imgbox.com/bc/50/9PnhQdya_o.png" width="453"></p> 
<p> npm run dev查看</p> 
<p><img alt="" height="1080" src="https://images2.imgbox.com/e8/f8/KBsZmkQL_o.png" width="1200"></p> 
<p> 点击注册跳转到signup页面运行成功</p> 
<p>在vue根目录终端输入npm run build,可以观察到多了一个dist文件夹</p> 
<p>接下来来到django根目录，将整个vue项目的文件夹放入django根目录下</p> 
<p>目录排列如图</p> 
<p><img alt="" height="374" src="https://images2.imgbox.com/9f/2c/Qqergl1T_o.png" width="475"></p> 
<p> 然后进入setting.py中首先</p> 
<pre>import os.path</pre> 
<p>然后更改其TEMPLATES</p> 
<p><img alt="" height="447" src="https://images2.imgbox.com/c9/8c/OiR55dbG_o.png" width="770"></p> 
<p> 而后在末尾更改（若不存在则引入）</p> 
<pre><code class="language-python">STATIC_URL = '/static/'
STATICFILES_DIRS=[
    os.path.join(BASE_DIR,'myvue/dist/static')
]</code></pre> 
<p>如</p> 
<p><img alt="" height="1080" src="https://images2.imgbox.com/35/27/4osxQ5xF_o.png" width="1200"></p> 
<p>进入urls.py,添加这两句，引入dist文件中的index.html，并将其设置为首页</p> 
<p><img alt="" height="302" src="https://images2.imgbox.com/c8/4e/Y9n23vDy_o.png" width="706"></p> 
<p> 到这一步可以调试注册功能了，但顺便先把登录功能实现</p> 
<p>在urls.py中添加一登陆路径，每一个路径都必须与前端发送请求的url对应</p> 
<pre>path('loginn/',views.loginn),</pre> 
<p>然后进入views.py中实现登录功能</p> 
<pre>from eapp import models</pre> 
<p>然后</p> 
<pre><code class="language-python">def loginn(request):
        username = request.POST.get('user')
        password = request.POST.get('password')
        if username and password:
            try:
                user = models.User.object.get(name=username)
            except:
                return JsonResponse({'loginstatus':2},safe=False) #未注册返回2
            if user.password == password:
                return JsonResponse({'loginstatus':1},safe=False) #登录成功返回1
        return JsonResponse({'loginstatus':3},safe=False)   #密码错误返回3</code></pre> 
<p>就放在import的后面</p> 
<p><img alt="" height="1080" src="https://images2.imgbox.com/3c/20/gFf7rF7E_o.png" width="1200"></p> 
<p> </p> 
<p>一切就ok了</p> 
<p>接下来我们调试，看看结果</p> 
<p>django根目录输入 python manage.py runserver 127.0.0.1:8000</p> 
<p>然后进入  http://127.0.0.1:8000/</p> 
<p>成功进入页面</p> 
<p><img alt="" height="1079" src="https://images2.imgbox.com/0b/78/o2aqtQRp_o.png" width="1200"></p> 
<p>但当我们点击登录时，会发现浏览器报错，显示CSRF token missing</p> 
<p>这是因为django会检测请求头cookies中的csrftoken与请求头的X-CSRFToken，若二者一致则通过请求，二者不同则拒绝请求，因此我们需要设置我们的请求头</p> 
<p>（<strong>此方法并不好，新方法已在文尾更新</strong>）</p> 
<p>进入浏览器的开发者模式，切换到network，再点击一下页面的登录，就会出现一个东西，我们查看一下他的Headers里的Request Headers，复制其cookie中csrftoken的值</p> 
<p><img alt="" height="737" src="https://images2.imgbox.com/75/33/upy3Mcgd_o.png" width="817"></p> 
<p> 再来到vue项目的main.js,将值填入X-CSRFToken后的双引号中</p> 
<p><img alt="" height="212" src="https://images2.imgbox.com/c8/af/sqX0bwGB_o.png" width="805"></p> 
<p> 保存之后，重新再vue项目的根目录下执行npm run build，就完成了</p> 
<p>回到浏览器页面，刷新</p> 
<p> 随便输入账号与密码，发现不会报错了，我们查看后端返回返回结果</p> 
<p><img alt="" height="439" src="https://images2.imgbox.com/d3/40/MUK5OHM7_o.png" width="705"></p> 
<p> 正如所设置的，返回结果是2，没有错误，</p> 
<p>点击注册来到注册页</p> 
<p><img alt="" height="505" src="https://images2.imgbox.com/ee/6a/wKHb2y8s_o.png" width="1200"></p> 
<p></p> 
<p>页面显示注册成功，我们看看数据库是否有记录</p> 
<p><img alt="" height="359" src="https://images2.imgbox.com/74/be/jrlDW30X_o.png" width="584"></p> 
<p> 确实有记录，接着回到登录页试试看登录</p> 
<p><img alt="" height="929" src="https://images2.imgbox.com/9e/b0/5JeE1xp9_o.png" width="723"></p> 
<p>status为1并且如同login.vue中定义的函数，跳转到了welcom页面。</p> 
<p>完成！ </p> 
<h2>更新</h2> 
<p>在处理跨域问题时我们处理的比较草率，只是获取了自己的一个cookie，属于是面向调试编程，经过不断的搜索，我找到了一个更好的办法</p> 
<p>思路是发送一个get请求从后端获取csrftoken的值，而后把这个值设置为请求头，以下为步骤</p> 
<p>1.在django项目的urls中新增一条路径</p> 
<pre><code class="language-python">path('getcsrf/',views.getcsrf),</code></pre> 
<p>2.在views文件中构建这条路径</p> 
<pre><code class="language-python">from django.http import JsonResponse, HttpResponse
from django.middleware.csrf import get_token

def getcsrf(request):
     return JsonResponse({'csrftoken': get_token(request) or 'NOTPROVIDED'})
//get_token(request) 的返回值即为csrftoken</code></pre> 
<p>3.来到vue项目的main.js</p> 
<pre><code class="language-javascript">//在import axios后添加
axios.defaults.withCredentials = true// 允许请求携带cookie</code></pre> 
<p>4.修改vue文件中的函数，以我的login.vue为例，将原来的axios请求套在一个向新地址提交的axios请求中</p> 
<pre><code class="language-javascript">login(){
                this.$axios.get('/getcsrf/').then(res=&gt;{
                var csrftoken=res.data.csrftoken
                this.$axios.post(
                '/loginn/', //向loginn发送请求，验证密码是否正确
                {'user':this.loginfo.username,
                'password':this.loginfo.password,
            },{
              headers:{
                'X-CSRFToken':csrftoken
              }
            }
              ).then(res=&gt;{
                if(res.data.loginstatus==1) //loginstatus为后端返回的数据，
                {   
                    this.$router.push({ //页面跳转到登录成功界面
                        path: '/welcome',
                        params:{'username':this.loginfo.username}
                        });}
                else{
                    alert('账号或密码错误')
                }
              })})
            }</code></pre> 
<p>然后重新npm run build，就完成了。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d428002aaafeafe81fad4bbf94b3232c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">golang：时间转换总结</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4029f744110bc5647afbe32a9e3f9a0d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【你好！我是MOSS】从0开始搭建本地MOSS智能机器人</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>