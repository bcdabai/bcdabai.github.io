<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>poi升级 ExcelUtil部分更新以及新问题产生小记 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="poi升级 ExcelUtil部分更新以及新问题产生小记" />
<meta property="og:description" content="一、版本升级触发条件 引入hutool新工具包，pom依赖与原系统旧版本冲突，导致报错 &lt;dependency&gt; &lt;groupId&gt;cn.hutool&lt;/groupId&gt; &lt;artifactId&gt;hutool-all&lt;/artifactId&gt; &lt;version&gt;5.6.4&lt;/version&gt; &lt;/dependency&gt; 二、由于poi版本升级引起的其他错误，需更新部分设置适配新版本 1、poi版本对比 旧版本： &lt;dependency&gt; &lt;groupId&gt;org.apache.poi&lt;/groupId&gt; &lt;artifactId&gt;poi&lt;/artifactId&gt; &lt;version&gt;3.13&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.poi&lt;/groupId&gt; &lt;artifactId&gt;poi-ooxml&lt;/artifactId&gt; &lt;version&gt;3.13&lt;/version&gt; &lt;/dependency&gt; 新版本： &lt;dependency&gt; &lt;groupId&gt;org.apache.poi&lt;/groupId&gt; &lt;artifactId&gt;poi&lt;/artifactId&gt; &lt;version&gt;5.2.2&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.poi&lt;/groupId&gt; &lt;artifactId&gt;poi-ooxml&lt;/artifactId&gt; &lt;version&gt;5.2.2&lt;/version&gt; &lt;/dependency&gt; 2、Cell类型对比 旧版本： switch (cell.getCellType()) { case Cell.CELL_TYPE_STRING: value = cell.getRichStringCellValue().getString().trim(); break; case Cell.CELL_TYPE_NUMERIC: if (HSSFDateUtil.isCellDateFormatted(cell)){ //用于转化为日期格式 Date d = cell.getDateCellValue(); value = formater.format(d); }else if (&#34;General&#34;.equals(cell.getCellStyle().getDataFormatString())) { value = df.format(cell.getNumericCellValue()); } else if (&#34;m/d/yy&#34;.equals(cell.getCellStyle().getDataFormatString())) { value = sdf.format(cell.getDateCellValue()); } else { value = df2." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/572a7ffceb2a1f679db01bb20aa2214c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-09-29T15:37:09+08:00" />
<meta property="article:modified_time" content="2022-09-29T15:37:09+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">poi升级 ExcelUtil部分更新以及新问题产生小记</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2 id="%E4%B8%80%E3%80%81%E7%89%88%E6%9C%AC%E5%8D%87%E7%BA%A7%E8%A7%A6%E5%8F%91%E6%9D%A1%E4%BB%B6">一、版本升级触发条件</h2> 
<h3 id="1%E3%80%81%E5%BC%95%E5%85%A5hutool%E6%96%B0%E5%B7%A5%E5%85%B7%E5%8C%85%EF%BC%8Cpom%E4%BE%9D%E8%B5%96%E4%B8%8E%E5%8E%9F%E7%B3%BB%E7%BB%9F%E6%97%A7%E7%89%88%E6%9C%AC%E5%86%B2%E7%AA%81%EF%BC%8C%E5%AF%BC%E8%87%B4%E6%8A%A5%E9%94%99">引入hutool新工具包，pom依赖与原系统旧版本冲突，导致报错</h3> 
<pre><code class="language-XML">        &lt;dependency&gt;
            &lt;groupId&gt;cn.hutool&lt;/groupId&gt;
            &lt;artifactId&gt;hutool-all&lt;/artifactId&gt;
            &lt;version&gt;5.6.4&lt;/version&gt;
        &lt;/dependency&gt;
</code></pre> 
<p></p> 
<h2 id="%E4%BA%8C%E3%80%81%E7%94%B1%E4%BA%8Epoi%E7%89%88%E6%9C%AC%E5%8D%87%E7%BA%A7%E5%BC%95%E8%B5%B7%E7%9A%84%E5%85%B6%E4%BB%96%E9%94%99%E8%AF%AF%EF%BC%8C%E9%9C%80%E6%9B%B4%E6%96%B0%E9%83%A8%E5%88%86%E8%AE%BE%E7%BD%AE%E9%80%82%E9%85%8D%E6%96%B0%E7%89%88%E6%9C%AC">二、由于poi版本升级引起的其他错误，需更新部分设置适配新版本</h2> 
<h3 id="1%E3%80%81poi%E7%89%88%E6%9C%AC%E5%AF%B9%E6%AF%94">1、poi版本对比</h3> 
<h4 id="%E6%97%A7%E7%89%88%E6%9C%AC%EF%BC%9A">旧版本：</h4> 
<pre><code class="language-XML">
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.poi&lt;/groupId&gt;
            &lt;artifactId&gt;poi&lt;/artifactId&gt;
            &lt;version&gt;3.13&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.poi&lt;/groupId&gt;
            &lt;artifactId&gt;poi-ooxml&lt;/artifactId&gt;
            &lt;version&gt;3.13&lt;/version&gt;
        &lt;/dependency&gt;
</code></pre> 
<h4 id="%E6%96%B0%E7%89%88%E6%9C%AC%EF%BC%9A">新版本：</h4> 
<pre><code class="language-XML">        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.poi&lt;/groupId&gt;
            &lt;artifactId&gt;poi&lt;/artifactId&gt;
            &lt;version&gt;5.2.2&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.poi&lt;/groupId&gt;
            &lt;artifactId&gt;poi-ooxml&lt;/artifactId&gt;
            &lt;version&gt;5.2.2&lt;/version&gt;
        &lt;/dependency&gt;
</code></pre> 
<p></p> 
<h3 id="2%E3%80%81Cell%E7%B1%BB%E5%9E%8B%E5%AF%B9%E6%AF%94">2、Cell类型对比</h3> 
<h4><strong>旧版本：</strong></h4> 
<pre><code class="language-java">switch (cell.getCellType()) {
            case Cell.CELL_TYPE_STRING:
                value = cell.getRichStringCellValue().getString().trim();
                break;
            case Cell.CELL_TYPE_NUMERIC:
                if (HSSFDateUtil.isCellDateFormatted(cell)){
                    //用于转化为日期格式
                    Date d = cell.getDateCellValue();
                    value = formater.format(d);
                }else if ("General".equals(cell.getCellStyle().getDataFormatString())) {
                    value = df.format(cell.getNumericCellValue());
                } else if ("m/d/yy".equals(cell.getCellStyle().getDataFormatString())) {
                    value = sdf.format(cell.getDateCellValue());
                } else {
                    value = df2.format(cell.getNumericCellValue());
                }
                break;
            case Cell.CELL_TYPE_BOOLEAN:
                value = cell.getBooleanCellValue();
                break;
            case Cell.CELL_TYPE_BLANK:
                value = "";
                break;
            default:
                break;
        }
</code></pre> 
<h4><strong>新版本：</strong></h4> 
<pre><code class="language-java"> switch (cell.getCellType()) {
//            case CellType.CELL_TYPE_STRING:
            case STRING:
                value = cell.getRichStringCellValue().getString().trim();
                break;
//            case Cell.CELL_TYPE_NUMERIC:
            case NUMERIC:
//                if (HSSFDateUtil.isCellDateFormatted(cell)){
                if (org.apache.poi.ss.usermodel.DateUtil.isCellDateFormatted(cell)){
                    //用于转化为日期格式
                    Date d = cell.getDateCellValue();
                    value = formater.format(d);
                }else if ("General".equals(cell.getCellStyle().getDataFormatString())) {
                    value = df.format(cell.getNumericCellValue());
                } else if ("m/d/yy".equals(cell.getCellStyle().getDataFormatString())) {
                    value = sdf.format(cell.getDateCellValue());
                } else {
                    value = df2.format(cell.getNumericCellValue());
                }
                break;
            case BOOLEAN:
                value = cell.getBooleanCellValue();
                break;
            case BLANK:
                value = "";
                break;
            default:
                break;
        } //switch</code></pre> 
<h3 id="3%E3%80%81%E8%AE%BE%E7%BD%AE%E8%A1%A8%E5%A4%B4%E6%A0%B7%E5%BC%8F">3、设置表头样式</h3> 
<h4>旧版本：</h4> 
<pre><code class="language-java"> // 设置表头字体样式
        HSSFFont columnHeadFont = workbook.createFont();
        columnHeadFont.setFontName("宋体");
        columnHeadFont.setFontHeightInPoints((short) 10);
        columnHeadFont.setBoldweight(HSSFFont.BOLDWEIGHT_BOLD);

        // 列头的样式
        HSSFCellStyle columnHeadStyle = workbook.createCellStyle();
        columnHeadStyle.setFont(columnHeadFont);
        // 左右居中
        columnHeadStyle.setAlignment(HSSFCellStyle.ALIGN_CENTER);
        // 上下居中
        columnHeadStyle.setVerticalAlignment(HSSFCellStyle.VERTICAL_CENTER);
        columnHeadStyle.setLocked(true);
        columnHeadStyle.setWrapText(true);
        // 左边框的颜色
        columnHeadStyle.setLeftBorderColor(HSSFColor.BLACK.index);
        // 边框的大小
        columnHeadStyle.setBorderLeft((short) 1);
        // 右边框的颜色
        columnHeadStyle.setRightBorderColor(HSSFColor.BLACK.index);
        // 边框的大小
        columnHeadStyle.setBorderRight((short) 1);
        // 设置单元格的边框为粗体
        columnHeadStyle.setBorderBottom(HSSFCellStyle.BORDER_THIN);
        // 设置单元格的边框颜色
        columnHeadStyle.setBottomBorderColor(HSSFColor.BLACK.index);
        // 设置单元格的背景颜色（单元格的样式会覆盖列或行的样式）
        columnHeadStyle.setFillForegroundColor(HSSFColor.WHITE.index);
        // 设置普通单元格字体样式
        HSSFFont font = workbook.createFont();
        font.setFontName("宋体");
        font.setFontHeightInPoints((short) 10);
</code></pre> 
<h4>新版本：</h4> 
<pre><code class="language-java">// 设置表头字体样式
        HSSFFont columnHeadFont = workbook.createFont();
        columnHeadFont.setFontName("宋体");
        columnHeadFont.setFontHeightInPoints((short) 10);
        columnHeadFont.setBold(true);
//        columnHeadFont.setBoldweight();

        // 列头的样式
        HSSFCellStyle columnHeadStyle = workbook.createCellStyle();
        columnHeadStyle.setFont(columnHeadFont);
        // 左右居中
        columnHeadStyle.setAlignment(HorizontalAlignment.CENTER);
        // 上下居中
        columnHeadStyle.setVerticalAlignment(VerticalAlignment.CENTER);
        columnHeadStyle.setLocked(true);
        columnHeadStyle.setWrapText(true);
        // 左边框的颜色
        columnHeadStyle.setLeftBorderColor(IndexedColors.BLACK.index);
        // 边框的大小
        columnHeadStyle.setBorderLeft(BorderStyle.THIN);
//        columnHeadStyle.setBorderLeft((short) 1);
        // 右边框的颜色
        columnHeadStyle.setRightBorderColor(IndexedColors.BLACK.index);
        // 边框的大小
        columnHeadStyle.setBorderRight(BorderStyle.THIN);
        // 设置单元格的边框为粗体
        columnHeadStyle.setBorderBottom(BorderStyle.THIN);
//        columnHeadStyle.setBorderBottom(HSSFCellStyle.BORDER_THIN);
        // 设置单元格的边框颜色
        columnHeadStyle.setBottomBorderColor(IndexedColors.BLACK.index);
        // 设置单元格的背景颜色（单元格的样式会覆盖列或行的样式）
        columnHeadStyle.setFillForegroundColor(IndexedColors.WHITE.index);</code></pre> 
<h2 id="%E4%B8%89%E3%80%81%E4%B8%80%E4%BA%9B%E9%94%99%E8%AF%AF%E7%9A%84%E6%B1%87%E6%80%BB%E8%AE%B0%E5%BD%95%EF%BC%8C%E4%BE%9B%E5%90%8E%E5%8F%82%E8%80%83">三、一些错误的汇总记录，供后参考</h2> 
<p>说明：以下错误已尝试多种解决方案，暂时没有耐心继续解决，搁置（惭愧）</p> 
<pre><code class="language-bash">org.springframework.web.util.NestedServletException: Handler dispatch failed; nested exception is java.lang.NoSuchMethodError: org.apache.logging.log4j.Logger.atTrace()Lorg/apache/logging/log4j/LogBuilder;
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1006)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:925)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:978)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:881)
</code></pre> 
<pre><code class="language-bash">Caused by: java.lang.NoSuchMethodError: org.apache.logging.log4j.Logger.atTrace()Lorg/apache/logging/log4j/LogBuilder;
</code></pre> 
<h2 id="%E5%9B%9B%E3%80%81%E5%B0%8F%E7%BB%93">四、小结</h2> 
<h3><strong>仅针对此次更正小感：</strong></h3> 
<p>开发过程中由于可能涉及到二次开发，原系统开发时间久远，开发人员没有达成一致规范设计，导致原开发内容风格各异，满足当时的开发场景，并由于原系统功能比较冗杂，pom依赖互相关联，因此部分依赖的版本升级或者增加会导致依赖冲突情况，以上，为poi版本升级需同步更正的地方；</p> 
<h3><strong>更正结果：</strong></h3> 
<p>poi版本升级之后随之改变的ExcelUtil中格式等内容的调用通过搜索基本完成problems更正；但是系统启动引发新的bug;</p> 
<p>经检查有其他pom依赖的jar冲突问题，一环套一环，预计耗费过多时间解决此类依赖冲突问题，故已放弃除以上更正之外的其他修复，决定用老版本poi依赖；</p> 
<h3><strong>期望：</strong></h3> 
<p>个人开发中可以考虑在pom文件中用<em><code>DepencyManagement </code></em><code>管理各依赖版本，防止各种冲突的反复定位和修复，耗费过多时间和精力；</code></p> 
<p><code>对于Maven知识的掌握和了解还是有所欠缺，需系统学习了解</code></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5ffe2c93a8eb4c6d37f3edae14204111/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【红日靶场系列】ATT&amp;CK红队评估5</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ef82c45e069cedab082ed94e88d21ace/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Git的安装卸载</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>