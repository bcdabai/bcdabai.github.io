<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Grafana UI 入门使用 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Grafana UI 入门使用" />
<meta property="og:description" content="最近项目上需要使用Grafana来做chart，因为server不是我在搭建，所以就不介绍怎么搭建grafana server，而是谈下怎么在UI上具体操作使用了。
DOCs 首先呢，贴一下官网doc的连接，方便查询 Grafana open source documentation | Grafana documentation
初步使用 搭建好server之后，浏览器输入部署的ip和port然后登录之后就可以进入UI。
因为也才接触grafana不久，只能share一下初步使用的浅见。
配置datasource 它datasource定义就是相当于一个chart的数据来源，也可以多个datasource给一个chart提供数据，也可以作为dropdown list的数据来源，dropdown list可以在dashboard里面作为选择给chart传入参数的选择使用。
首先需要创建一个datasource
它这边支持很多datasource，db,elasticsearch,etc...都是支持的
因为我这边是call我们自己的Back-End的api，所以选择的就是json api
进入之后需要填写你call api的具体url，我这边只用了这三个。
1.api的url
2.需要打开，因为我们是https的，需要跳过认证
3.把jwt添加进headers里面，来保证请求不被我们自己的BE拦截。
最后一个是默认的请求条件，这个可以也可以不配，看你引用这个datasource的时候需不需要这个默认请求条件了。
都配置完了之后点击 save&amp;test 然后看是不是call的通
Dashboard 这里面你可以创建自己的panel然后进行布局，里面可以有很多chart按照你配置进行布局，页面上可以添加value input 来给你的chart传入参数，它还自带的date range来进行时间区域选择。（当然些时间和我这个dropdown list传入的值是我的BE的api写好可以接收的）
第一次进入dashboard的话需要新建一个dashboard
进入之后需要选择一个datasource，就是一开始创建的datasource，来为你的chart提供数据。
选择好datasource之后就可以进入编辑panel，首先可以看到红圈这里，默认会给你创建一个datasrouce，可以理解成一开始创建的datasource，现在是给你实现了一个datasource的实例，这个实例可以有单独不同的数据解析，参数，hearder，body，etc....，所以没有什么特殊配置的前提下，首先需要做的就是配置parm
我的BEapi需要3个传入参数，所以这边就需要配置3个，当然因为我是通过RequestParm取得的参数所以在parm tab进行配置的，如果你是post并且是通过body传递参数的，就需要在body tab进行配置了。
红圈左边的是参数名字，需要和api接收的名字相同，右边是数据来源，你可以直接hardcode你需要的值，方便测试，我这里写的是变量(${}这个框起来就表明是变量)，他们三个会从dashbaord的dropdown list，time range里面进行取值，date我还做了日期格式化，因为我后端是string接收的。
第一个变量${Application}是我自己定义的，这个名称是自己取的，之后会讲到怎么去创建。
${__form},${__to}这个是固定写法，表示从UI中提供的time range里面取值。
如果想除了这些还有其他什么写法的，具体的可以参考官方文档：Add and manage variables | Grafana documentation 然后是数据提取
一开始会默认给你一个datasource，截图里面我已经创建了4个了，最后一个test可以模拟最开始默认的datasource，应该什么都没有的，你可以先写一个$，然后打开右上角的table view，就可以看到这次query的data返回
如果有多个datasource可以点击这里切换查看不同的返回值
然后可以按照jsonpath/jsonnata的方式进行获取数据，这里[*]表示X Array中任意一个数据，这个是很必要的
如果不加，可以看到，提取出来的一个array，我一开始卡了很久就是这里，我想已经提取成array了，为什么放不进chart里面，后面才发现，他这里相当于指定的是一行的数据，所以某一行的数据不可能是array的，所以必须要加x.[*]来指定这一行的值是x这个array里面的某一行
如果你的数据还需要精细处理，就可以点击 1 里面的trasform data,进行更加具体的数据转换。
然后2可以看到是另一个datasource，其实和第一个datasource instance配置一模一样，只是数据提取的时候提取的是major的数据，这时候就可以直接点击4 这里就可以复制出一个一模一样的datasrouce instance，这时候就不用再去配置一次parm，只用修改filed提取json就可以了。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/cfbd7bb6f742cda04507e811bd3dd01b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-08T10:48:06+08:00" />
<meta property="article:modified_time" content="2024-01-08T10:48:06+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Grafana UI 入门使用</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <blockquote> 
 <p>最近项目上需要使用Grafana来做chart，因为server不是我在搭建，所以就不介绍怎么搭建grafana server，而是谈下怎么在UI上具体操作使用了。</p> 
</blockquote> 
<h3>DOCs</h3> 
<p>首先呢，贴一下官网doc的连接，方便查询 </p> 
<p><a href="https://grafana.com/docs/grafana/latest/" rel="nofollow" title="Grafana open source documentation | Grafana documentation">Grafana open source documentation | Grafana documentation</a></p> 
<h3>初步使用</h3> 
<p><img alt="" height="914" src="https://images2.imgbox.com/e6/ee/nt7G4lmt_o.png" width="1200"></p> 
<p>搭建好server之后，浏览器输入部署的ip和port然后登录之后就可以进入UI。</p> 
<p>因为也才接触grafana不久，只能share一下初步使用的浅见。</p> 
<h3>配置datasource</h3> 
<p>它datasource定义就是相当于一个chart的数据来源，也可以多个datasource给一个chart提供数据，也可以作为dropdown list的数据来源，dropdown list可以在dashboard里面作为选择给chart传入参数的选择使用。</p> 
<p>首先需要创建一个datasource<br><img alt="" height="809" src="https://images2.imgbox.com/4e/48/IseXqh73_o.png" width="1166"></p> 
<p>它这边支持很多datasource，db,elasticsearch,etc...都是支持的<br><img alt="" height="910" src="https://images2.imgbox.com/c8/bf/KKsY8W89_o.png" width="1200"> 因为我这边是call我们自己的Back-End的api，所以选择的就是json api<br><img alt="" height="573" src="https://images2.imgbox.com/35/09/71o0giqq_o.png" width="1200"></p> 
<p>进入之后需要填写你call api的具体url，我这边只用了这三个。</p> 
<p>1.api的url</p> 
<p>2.需要打开，因为我们是https的，需要跳过认证</p> 
<p>3.把jwt添加进headers里面，来保证请求不被我们自己的BE拦截。</p> 
<p>最后一个是默认的请求条件，这个可以也可以不配，看你引用这个datasource的时候需不需要这个默认请求条件了。</p> 
<p><img alt="" height="906" src="https://images2.imgbox.com/0e/e2/TUwxreZX_o.png" width="1200"></p> 
<p>都配置完了之后点击 <strong>save&amp;test </strong>然后看是不是call的通</p> 
<h3>Dashboard</h3> 
<p>这里面你可以创建自己的panel然后进行布局，里面可以有很多chart按照你配置进行布局，页面上可以添加value input 来给你的chart传入参数，它还自带的date range来进行时间区域选择。（当然些时间和我这个dropdown list传入的值是我的BE的api写好可以接收的）</p> 
<p><img alt="" height="677" src="https://images2.imgbox.com/d4/f5/JVNZGFwd_o.png" width="1200"></p> 
<p>第一次进入dashboard的话需要新建一个dashboard<br><img alt="" height="822" src="https://images2.imgbox.com/a3/48/sMwQLV5p_o.png" width="1200"> 进入之后需要选择一个datasource，就是一开始创建的datasource，来为你的chart提供数据。</p> 
<p><img alt="" height="629" src="https://images2.imgbox.com/75/cb/MvRsxrCf_o.png" width="1200"></p> 
<p>选择好datasource之后就可以进入编辑panel，首先可以看到红圈这里，默认会给你创建一个datasrouce，可以理解成一开始创建的datasource，现在是给你实现了一个datasource的实例，这个实例可以有单独不同的数据解析，参数，hearder，body，etc....，所以没有什么特殊配置的前提下，首先需要做的就是配置parm</p> 
<p><img alt="" height="837" src="https://images2.imgbox.com/ee/a2/VmHIY25I_o.png" width="1200"> 我的BEapi需要3个传入参数，所以这边就需要配置3个，当然因为我是通过RequestParm取得的参数所以在parm tab进行配置的，如果你是post并且是通过body传递参数的，就需要在body tab进行配置了。</p> 
<p><img alt="" height="65" src="https://images2.imgbox.com/39/08/pAJNv2yJ_o.png" width="872"> 红圈左边的是参数名字，需要和api接收的名字相同，右边是数据来源，你可以直接hardcode你需要的值，方便测试，我这里写的是变量(${}这个框起来就表明是变量)，他们三个会从dashbaord的dropdown list，time range里面进行取值，date我还做了日期格式化，因为我后端是string接收的。</p> 
<p>第一个变量${Application}是我自己定义的，这个名称是自己取的，之后会讲到怎么去创建。</p> 
<p>${__form},${__to}这个是固定写法，表示从UI中提供的time range里面取值。<br><img alt="" height="557" src="https://images2.imgbox.com/08/9c/auJVw0p4_o.png" width="826"></p> 
<p>如果想除了这些还有其他什么写法的，具体的可以参考官方文档：<a href="https://grafana.com/docs/grafana/latest/dashboards/variables/add-template-variables/#__from-and-__to" rel="nofollow" title="Add and manage variables | Grafana documentation">Add and manage variables | Grafana documentation</a> </p> 
<p>然后是数据提取</p> 
<p>一开始会默认给你一个datasource，截图里面我已经创建了4个了，最后一个test可以模拟最开始默认的datasource，应该什么都没有的，你可以先写一个$，然后打开右上角的table view，就可以看到这次query的data返回</p> 
<p><img alt="" height="812" src="https://images2.imgbox.com/67/5d/xYVxOwWJ_o.png" width="1200"></p> 
<p> 如果有多个datasource可以点击这里切换查看不同的返回值</p> 
<p><img alt="" height="571" src="https://images2.imgbox.com/0c/4f/ejEBKIZR_o.png" width="1200"></p> 
<p>然后可以按照jsonpath/jsonnata的方式进行获取数据，这里[*]表示X Array中任意一个数据，这个是很必要的</p> 
<p><img alt="" height="703" src="https://images2.imgbox.com/61/5b/XidxNJfu_o.png" width="1200"> 如果不加，可以看到，提取出来的一个array，我一开始卡了很久就是这里，我想已经提取成array了，为什么放不进chart里面，后面才发现，他这里相当于指定的是一行的数据，所以某一行的数据不可能是array的，所以必须要加x.[*]来指定这一行的值是x这个array里面的某一行<img alt="" height="686" src="https://images2.imgbox.com/b2/ea/C0z9lCFN_o.png" width="1200"></p> 
<p>如果你的数据还需要精细处理，就可以点击 1 里面的trasform data,进行更加具体的数据转换。</p> 
<p>然后2可以看到是另一个datasource，其实和第一个datasource instance配置一模一样，只是数据提取的时候提取的是major的数据，这时候就可以直接点击4 这里就可以复制出一个一模一样的datasrouce instance，这时候就不用再去配置一次parm，只用修改filed提取json就可以了。<br> 配置完你所有需要的datasource instance之后就可以点击3，选择你需要的chart类型(我选择的是bar chart)，如果你清除你的数据适合那种chart，可以点5这里，就可以看到它根据你数据类型推荐的chart type。</p> 
<p><img alt="" height="888" src="https://images2.imgbox.com/fe/ed/tsiHemAp_o.png" width="1200">选择完成之后就可以看到你的图出现了，我是每一个Legend一个datasource instance，</p> 
<p><img alt="" height="390" src="https://images2.imgbox.com/a9/54/JMtYK7KP_o.png" width="601"></p> 
<p><img alt="" height="455" src="https://images2.imgbox.com/4b/57/3GPX2QkL_o.png" width="511"></p> 
<p>单击Legend 之后可以修改每一个legend在chart里面显示的颜色，但是当你第一选择之后会发现它并不生效，搞得我一开始都以为是bug了</p> 
<p>后面才发现，右边侧边栏滚动到最下面，你点击过的legend都会成一个overried(一个legend只会生成一次，没点过不会生成)</p> 
<p>然后在这个overried里面修改你需要绑定的的legend的name，然后再指定他的颜色就可以了</p> 
<p><img alt="" height="810" src="https://images2.imgbox.com/fd/c3/XvXmsEDL_o.png" width="481"></p> 
<p>然后所有做完之后记得点击save<br><img alt="" height="491" src="https://images2.imgbox.com/ad/92/Kx2UCXLN_o.png" width="655"></p> 
<h3>Variables</h3> 
<p>然后来创建variables(就是我图中的application的dropdown list)，为你的chart创建可以供用户选择的传入参数。</p> 
<p><img alt="" height="597" src="https://images2.imgbox.com/5c/45/iIufMxPU_o.png" width="1200"> <img alt="" height="650" src="https://images2.imgbox.com/7d/1a/aY9GWRqT_o.png" width="1200"></p> 
<p>依次点击之后进入创建的UI，这里选择你的variables数据来源是什么，是需要去query某个api的还是你定义好的几个值还是让用户输入的text，你自己选择了。我的demo是call后端的api</p> 
<p><img alt="" height="657" src="https://images2.imgbox.com/bf/01/o8gPL71G_o.png" width="1069"></p> 
<p> 1这里就是你去明明你的变量名称，就是之后我在parm里面配置的${Application}，你取什么那里配置就写什么名字，保持一直。</p> 
<p>2是我这个variables的datasource，如果你还没创建关于他的datasource，就去创建一个再来继续创建variables，然后3就是怎么提取你需要的值从response里面。</p> 
<p><img alt="" height="892" src="https://images2.imgbox.com/57/f0/0CrnuhlQ_o.png" width="1200"></p> 
<p>还可以设置一些类似于排序，是否支持多选，全选之内的配置，最后再preview of values下面可以看到他有具体哪些值会显示，我这里就不展示了。<img alt="" height="537" src="https://images2.imgbox.com/6d/55/dO9Arnph_o.png" width="924">然后就可以保存了。</p> 
<p>回到dashboard之后，配置完parm，你就可以选择不同的参数传入你的chart了，如果你想默认使用什么参数当你进入dashboard的时候，可以选择完所有参数之后，点击保存</p> 
<p><img alt="" height="501" src="https://images2.imgbox.com/fc/18/AH4XIC2Y_o.png" width="1200"></p> 
<p>然后勾选保存time range和variable 填写完change log就可以save了，下次进入就会默认使用这次保存的 time range和variable</p> 
<p><img alt="" height="515" src="https://images2.imgbox.com/40/ea/w3n8fnRd_o.png" width="894"></p> 
<h3>Share</h3> 
<p>panel 的右上角三个点，然后点击share </p> 
<h3><img alt="" height="365" src="https://images2.imgbox.com/72/db/skNxOmrB_o.png" width="1173"> <img alt="" height="409" src="https://images2.imgbox.com/37/6c/HKKzffnf_o.png" width="1200"></h3> 
<p> 这里面不同的tab可以选择不同的share方式，如果想用iframe方式引用的话，就需要选择第三个Embed</p> 
<p><img alt="" height="620" src="https://images2.imgbox.com/23/79/zsej2YED_o.png" width="1065"> 然后复制下面的代码，直接贴在html中就可以了。<img alt="" height="699" src="https://images2.imgbox.com/03/15/Trs9FQHP_o.png" width="1020"></p> 
<p>但是iframe share有一个前提，可以看我另外一篇blog：</p> 
<p><a href="https://blog.csdn.net/Damien_J_Scott/article/details/135356689" title="Grafana Refused to display ‘http://{ip:port}/‘ in a frame because it set ‘X-Frame-Options‘ to ‘deny‘-CSDN博客">Grafana Refused to display ‘http://{ip:port}/‘ in a frame because it set ‘X-Frame-Options‘ to ‘deny‘-CSDN博客</a></p> 
<p>这边还需要注意的是，我FE是用的angular，如果需要动态拼接url来成动态传入值的话，需要这样</p> 
<pre><code class="language-html">&lt;iframe [src]="getIframeUrl()" width="1814" height="500" frameborder="0"&gt;&lt;/iframe&gt;</code></pre> 
<pre><code class="language-TypeScript">import { DomSanitizer, SafeUrl } from '@angular/platform-browser';

constructor(private sanitizer: DomSanitizer) {}

getIframeUrl():SafeUrl{
    const url= 'http://xxxxx:xxxx/d-solo/xxxxx/xxxxxxx?orgId=1&amp;from='+this.rangeDates[0]?.getTime()+'&amp;to='+this.rangeDates[1].getTime()+'&amp;var-Application='+this.selectedApplications+'&amp;theme=light&amp;panelId=1'
    return this.sanitizer.bypassSecurityTrustResourceUrl(url)
  }</code></pre> 
<p> 重点是是<strong>不能直接返回url</strong>，必须用this.sanitizer.bypassSecurityTrustUrl(url)来返回safeUrl，否则会报错：</p> 
<blockquote> 
 <p>core.js:6162 ERROR Error: unsafe value used in a resource URL context (see https://g.co/ng/security#xss)<br>     at ɵɵsanitizeResourceUrl (core.js:5995:1)<br>     at elementPropertyInternal (core.js:9972:1)<br>     at Module.ɵɵproperty (core.js:14684:1)<br>     at ApplicationInsightsComponent_Template (applicationInsights.component.html:49:9)<br>     at executeTemplate (core.js:9549:1)<br>     at refreshView (core.js:9418:1)<br>     at refreshComponent (core.js:10584:1)<br>     at refreshChildComponents (core.js:9215:1)<br>     at refreshView (core.js:9468:1)<br>     at refreshEmbeddedViews (core.js:10538:1)</p> 
</blockquote> 
<h3>学习更新中。。。。</h3>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/89e48589f7e6090c28003749ee0858be/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">③使用Redis缓存，并增强数据一致性。</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e2b0dec1587782fe3ce148b03e2f7c83/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">系分笔记数据库技术之数据库安全措施</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>