<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>php cgi 71.sock 重启,/tmp/php-cgi-71.sock - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="php cgi 71.sock 重启,/tmp/php-cgi-71.sock" />
<meta property="og:description" content="2021/03/11 13:51:06 [error] 2209#0: *1251111 connect() to unix:/tmp/php-cgi-71.sock failed (11: Resource temporarily unavailable) while connecting to upstream, client: 110.24.15.5, server: app.xxx.cn, request: “GET /api/order/getAuth?uuid=fexasdq&amp;verify=MDAwMDAwMDAwMMbarGHJZ4uxmImynrCfumay372wsH5gcg&amp;ver=3.0.0.202103090 HTTP/1.1”, upstream: “fastcgi://unix:/tmp/php-cgi-71.sock:”, host: “app.baidu:17008”
正常时候不会有这个报错，请求量每秒50000~60000左右就会报错，还有加负载均衡会报错
回答
问题补充：
【PHP配置】
listen = /tmp/php-cgi-71.sock
listen.backlog = 8192
listen.allowed_clients = 127.0.0.1
listen.owner = www
listen.group = www
listen.mode = 0666
user = www
group = www
pm = static
pm.status_path = /phpfpm_71_status
pm.max_children = 200
pm.start_servers = 15" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/45757ba9eda84eaaf2a64dcc071f9a6e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-04-10T06:51:03+08:00" />
<meta property="article:modified_time" content="2021-04-10T06:51:03+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">php cgi 71.sock 重启,/tmp/php-cgi-71.sock</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div style="font-size:16px;"> 
 <p>2021/03/11 13:51:06 [error] 2209#0: *1251111 connect() to unix:/tmp/php-cgi-71.sock failed (11: Resource temporarily unavailable) while connecting to upstream, client: 110.24.15.5, server: app.xxx.cn, request: “GET /api/order/getAuth?uuid=fexasdq&amp;verify=MDAwMDAwMDAwMMbarGHJZ4uxmImynrCfumay372wsH5gcg&amp;ver=3.0.0.202103090 HTTP/1.1”, upstream: “fastcgi://unix:/tmp/php-cgi-71.sock:”, host: “app.baidu:17008”</p> 
 <p>正常时候不会有这个报错，请求量每秒50000~60000左右就会报错，还有加负载均衡会报错</p> 
 <p>回答</p> 
 <p>问题补充：</p> 
 <p>【PHP配置】</p> 
 <p>listen = /tmp/php-cgi-71.sock</p> 
 <p>listen.backlog = 8192</p> 
 <p>listen.allowed_clients = 127.0.0.1</p> 
 <p>listen.owner = www</p> 
 <p>listen.group = www</p> 
 <p>listen.mode = 0666</p> 
 <p>user = www</p> 
 <p>group = www</p> 
 <p>pm = static</p> 
 <p>pm.status_path = /phpfpm_71_status</p> 
 <p>pm.max_children = 200</p> 
 <p>pm.start_servers = 15</p> 
 <p>pm.min_spare_servers = 15</p> 
 <p>pm.max_spare_servers = 50</p> 
 <p>request_terminate_timeout = 100</p> 
 <p>request_slowlog_timeout = 30</p> 
 <p>slowlog = var/log/slow.log</p> 
 <p>【nginx配置】</p> 
 <p>user www www;</p> 
 <p>worker_processes auto;</p> 
 <p>error_log /www/wwwlogs/nginx_error.log crit;</p> 
 <p>pid /www/server/nginx/logs/nginx.pid;</p> 
 <p>worker_rlimit_nofile 51200;</p> 
 <p>events</p> 
 <p>{<!-- --></p> 
 <p>use epoll;</p> 
 <p>worker_connections 51200;</p> 
 <p>multi_accept on;</p> 
 <p>}</p> 
 <p>http</p> 
 <p>{<!-- --></p> 
 <p>include mime.types;</p> 
 <p>#include luawaf.conf;</p> 
 <p>include proxy.conf;</p> 
 <p>default_type application/octet-stream;</p> 
 <p>server_names_hash_bucket_size 512;</p> 
 <p>client_header_buffer_size 32k;</p> 
 <p>large_client_header_buffers 4 32k;</p> 
 <p>client_max_body_size 50m;</p> 
 <p>sendfile on;</p> 
 <p>tcp_nopush on;</p> 
 <p>keepalive_timeout 60;</p> 
 <p>tcp_nodelay on;</p> 
 <p>fastcgi_connect_timeout 300;</p> 
 <p>fastcgi_send_timeout 300;</p> 
 <p>fastcgi_read_timeout 300;</p> 
 <p>fastcgi_buffer_size 64k;</p> 
 <p>fastcgi_buffers 4 64k;</p> 
 <p>fastcgi_busy_buffers_size 128k;</p> 
 <p>fastcgi_temp_file_write_size 256k;</p> 
 <p>fastcgi_intercept_errors on;</p> 
 <p>gzip on;</p> 
 <p>gzip_min_length 1k;</p> 
 <p>gzip_buffers 4 16k;</p> 
 <p>gzip_http_version 1.1;</p> 
 <p>gzip_comp_level 2;</p> 
 <p>gzip_types text/plain application/javascript application/x-javascript text/javascript text/css application/xml;</p> 
 <p>gzip_vary on;</p> 
 <p>gzip_proxied expired no-cache no-store private auth;</p> 
 <p>gzip_disable "MSIE [1-6]\.";</p> 
 <p>limit_conn_zone $binary_remote_addr zone=perip:10m;</p> 
 <p>limit_conn_zone $server_name zone=perserver:10m;</p> 
 <p>server_tokens off;</p> 
 <p>access_log off;</p> 
 <p>include /www/server/panel/vhost/nginx/*.conf;</p> 
 <p>}</p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/503378a889aa20e325662e5ffc70d8be/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Java和php时间戳转换问题,java 时间戳和PHP时间戳 的转换 php time()</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/29a1afaee67c82087c6a3e3d8b6c3f80/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">查看SqlServer版本</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>