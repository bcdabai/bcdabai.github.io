<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>java-FFmpeg读取视频随机截图 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="java-FFmpeg读取视频随机截图" />
<meta property="og:description" content="package per.qy.dexter.video; import java.awt.image.BufferedImage; import java.io.FileOutputStream; import java.io.IOException; import java.util.ArrayList; import java.util.List; import java.util.UUID; import javax.imageio.ImageIO; import org.bytedeco.javacv.FFmpegFrameGrabber; import org.bytedeco.javacv.Frame; import org.bytedeco.javacv.Java2DFrameConverter; import org.junit.Test; public class FFmpegTest { @Test public void splitVideo() { FFmpegFrameGrabber frameGrabber = null; try { frameGrabber = FFmpegFrameGrabber.createDefault(&#34;d:/111.mp4&#34;); frameGrabber.start(); long frameTime = frameGrabber.getLengthInTime() / 1000000; int frameLength = frameGrabber.getLengthInFrames(); List&lt;Integer&gt; list = random(frameTime, frameLength); for (int i = 0; i &lt; frameLength; i&#43;&#43;) { Frame frame = frameGrabber." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/e14839a1b86d19ae39a4620883dec881/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-03-25T23:38:53+08:00" />
<meta property="article:modified_time" content="2018-03-25T23:38:53+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">java-FFmpeg读取视频随机截图</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <pre><code class="language-java">package per.qy.dexter.video;

import java.awt.image.BufferedImage;
import java.io.FileOutputStream;
import java.io.IOException;
import java.util.ArrayList;
import java.util.List;
import java.util.UUID;

import javax.imageio.ImageIO;

import org.bytedeco.javacv.FFmpegFrameGrabber;
import org.bytedeco.javacv.Frame;
import org.bytedeco.javacv.Java2DFrameConverter;
import org.junit.Test;

public class FFmpegTest {

	@Test
	public void splitVideo() {
		FFmpegFrameGrabber frameGrabber = null;
		try {
			frameGrabber = FFmpegFrameGrabber.createDefault("d:/111.mp4");
			frameGrabber.start();
			long frameTime = frameGrabber.getLengthInTime() / 1000000;
			int frameLength = frameGrabber.getLengthInFrames();
			List&lt;Integer&gt; list = random(frameTime, frameLength);
			for (int i = 0; i &lt; frameLength; i++) {
				Frame frame = frameGrabber.grabImage();
				if (list.contains(i)) {
					Java2DFrameConverter converter = new Java2DFrameConverter();
					BufferedImage image = converter.getBufferedImage(frame);
					FileOutputStream outFile = null;
					try {
						outFile = new FileOutputStream(
								"d:/111/" + UUID.randomUUID().toString().replaceAll("-", "") + ".png");
						ImageIO.write(image, "png", outFile);
					} catch (IOException e) {
					} finally {
						try {
							if (outFile != null) {
								outFile.close();
							}
						} catch (IOException e) {
						}
					}
				}
			}
			System.out.println(String.format("视频总时长=%ss，总帧数=%s，抽取帧数=%s", frameTime, frameLength, list.size()));
		} catch (org.bytedeco.javacv.FrameGrabber.Exception e) {
		} finally {
			if (frameGrabber != null) {
				try {
					frameGrabber.stop();
				} catch (org.bytedeco.javacv.FrameGrabber.Exception e) {
				}
			}
		}
	}

	private List&lt;Integer&gt; random(long frameTime, int frameLength) {
		long count = 200;
		if (frameTime &lt;= 100) {
			count = 10;
		} else if (frameTime &lt;= 1800) {
			count = frameTime / 10;
		}
		List&lt;Integer&gt; list = new ArrayList&lt;Integer&gt;();

		if (frameLength &lt; count) {
			for (int i = 0; i &lt; frameLength; i++) {
				list.add(i);
			}
			return list;
		}

		long range = (frameLength - 5) / count;
		for (long i = range + 5; i &lt; frameLength; i = i + range) {
			int rand = (int) ((i - range) + Math.random() * range);
			list.add(rand);
		}
		return list;
	}

}
</code></pre> 
<br>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3918dad9880f041b0129353b08067d47/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">生成随机数（C语言，任意随机）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/77cb9ac1fb16b08cb7d500bf50ab50d6/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Python Django 集成Redis Sentinel（哨兵）集群开发秒杀系统</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>