<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>socket编程之socket() - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="socket编程之socket()" />
<meta property="og:description" content="1 socket() socket（） 创建用于通信的终结点，并返回引用该终结点的文件描述符。成功调用返回的文件描述符是当前未被调用socket()的进程占用的最小的文件描述符。
1.1 包含头文件 #include &lt;sys/types.h&gt; #include &lt;sys/socket.h&gt; //包含域参数所需要的各种网络协议 1.2 函数主体 int socket(int domain, int type, int protocol); //例如： int clt = socket(AF_INET, SOCK_STREAM | SOCK_NONBLOCK, 0); 参数解释：
int domain 域参数指定通信域，即选择用什么样的通信协议，包括 AF_UNIX,、AF_LOCAL、AF_INET、AF_INET6、AF_IPX、AF_ALG等等。目前主要使用的为**AF_LOCAL（用于本地进程间的通信）、AF_INET（用于IPv4协议）。**其余的有需要时在做补充。
int type 套接字具有指示的类型，该类型指定通信语义,包括SOCK_STREAM、SOCK_DGRAM、SOCK_SEQPACKET、SOCK_RAW 、SOCK_RDM等。目前主要使用的为**SOCK_STREAM（实现TCP字节流通信。可能支持带外数据传输机制。）、SOCK_DGRAM（实现UDP数据报通信）。**其余的有需要时在做补充
从 Linux 2.6.27 开始，类型参数还可以实现对socket的进一步控制，通过按为OR操作实现以下操作：
SOCK_NONBLOCK : 设置socket为非阻塞类型，在此处设置可以节省对fcntl的额外调用，进一步减小开销 SOCK_CLOEXEC : 在进程调用exec函数族时，文件描述符就会自动关闭，无需手动关闭。 这里对SOCK_CLOEXEC和带外数据（out-of-band data）作进一步解释（新手可以不看）：
在多进程的场景中，在fork()函数后，由于子进程会拷贝父进程几乎所有的内容，这其中就包括了父进程打开的文件描述符，因此子进程和父进程使用的是相同的文件描述符。但是，当子进程执行exec()函数族时，由于子进程会使用新的内容覆盖父进程所有的数据，这其中就包括打开的文件描述符，此时打开的文件描述符就无法关闭了，因此在调用exec函数族前需要手动关闭文件描述符。而设置此参数即可以避免这种情况
带外数据（out-of-band data）是指建立连接双方中的一方有重要的事情需要及时通知对方，这种数据成为带外数据，发送优先级要高于带内数据（在消息缓存队列中排队的数据成为“带内数据”），带外数据发送不需要建立新的连接。对带外数据的实现一般使用BSD的紧急数据指针方式，需要接收方通过判断read()函数的返回值来判断带外数据。
int protocol 用来指定协议的特类型，一般设置为0，表示接收协议的任何类型，后续的处理由应用程序自己实现。
1.3 返回值 成功后，将返回新套接字的文件描述符。出错时，返回 -1，并正确设置 errno，错误类型如下：
错误类型解释EACCES创建指定类型和/或协议的套接字的权限被拒绝。EAFNOSUPPORT不支持指定的地址系列。EINVAL未知的协议，或协议系列不可用。或类型中的标志无效。EMFILE已达到每个进程对打开的文件描述符数的限制。ENFILE已达到系统范围内对打开的文件总数的限制。ENOBUFS or ENOMEM可用内存不足。 在释放足够的资源之前，无法创建套接字。EPROTONOSUPPORT此域中不支持协议类型或指定的协议。 1.4 结束 socket()函数介绍至此结束，虽然这个函数的使用一般来说并不会出错，但是建议养成良好的编程习惯，每次调用都对器返回值进行判断。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/6d2271a7cce908339b4cda34a33a0191/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-08-31T20:31:32+08:00" />
<meta property="article:modified_time" content="2022-08-31T20:31:32+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">socket编程之socket()</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="1_socket_0"></a>1 socket()</h3> 
<p>socket（） 创建用于通信的终结点，并返回引用该终结点的文件描述符。成功调用返回的文件描述符是当前未被调用socket()的进程占用的最小的文件描述符。</p> 
<h5><a id="11__4"></a>1.1 包含头文件</h5> 
<pre><code class="prism language-c++">#include &lt;sys/types.h&gt;
#include &lt;sys/socket.h&gt;    //包含域参数所需要的各种网络协议
</code></pre> 
<h5><a id="12__11"></a>1.2 函数主体</h5> 
<pre><code class="prism language-c++">int socket(int domain, int type, int protocol);
//例如：
int clt = socket(AF_INET, SOCK_STREAM | SOCK_NONBLOCK, 0);  
</code></pre> 
<p>参数解释：</p> 
<ul><li><strong>int domain</strong></li></ul> 
<p>域参数指定通信域，即选择用什么样的通信协议，包括 AF_UNIX,、AF_LOCAL、AF_INET、AF_INET6、AF_IPX、AF_ALG等等。目前主要使用的为**AF_LOCAL（用于本地进程间的通信）、AF_INET（用于IPv4协议）。**其余的有需要时在做补充。</p> 
<ul><li><strong>int</strong> <strong>type</strong></li></ul> 
<p>套接字具有指示的类型，该类型指定通信语义,包括SOCK_STREAM、SOCK_DGRAM、SOCK_SEQPACKET、SOCK_RAW 、SOCK_RDM等。目前主要使用的为**SOCK_STREAM（实现TCP字节流通信。可能支持带外数据传输机制。）、SOCK_DGRAM（实现UDP数据报通信）。**其余的有需要时在做补充</p> 
<p>从 Linux 2.6.27 开始，类型参数还可以实现对socket的进一步控制，通过按为OR操作实现以下操作：</p> 
<pre><code class="prism language-C++">SOCK_NONBLOCK : 设置socket为非阻塞类型，在此处设置可以节省对fcntl的额外调用，进一步减小开销
SOCK_CLOEXEC  : 在进程调用exec函数族时，文件描述符就会自动关闭，无需手动关闭。   
</code></pre> 
<p>这里对SOCK_CLOEXEC和带外数据（out-of-band data）作进一步解释（新手可以不看）：</p> 
<p>在多进程的场景中，在fork()函数后，由于子进程会拷贝父进程几乎所有的内容，这其中就包括了父进程打开的文件描述符，因此子进程和父进程使用的是相同的文件描述符。但是，当子进程执行exec()函数族时，由于子进程会使用新的内容覆盖父进程所有的数据，这其中就包括打开的文件描述符，此时打开的文件描述符就无法关闭了，因此在调用exec函数族前需要手动关闭文件描述符。而设置此参数即可以避免这种情况</p> 
<p>带外数据（out-of-band data）是指建立连接双方中的一方有重要的事情需要及时通知对方，这种数据成为带外数据，发送优先级要高于带内数据（在消息缓存队列中排队的数据成为“带内数据”），带外数据发送不需要建立新的连接。对带外数据的实现一般使用BSD的紧急数据指针方式，需要接收方通过判断read()函数的返回值来判断带外数据。</p> 
<ul><li><strong>int protocol</strong></li></ul> 
<p>用来指定协议的特类型，一般设置为0，表示接收协议的任何类型，后续的处理由应用程序自己实现。</p> 
<h5><a id="13__46"></a>1.3 返回值</h5> 
<p>成功后，将返回新套接字的文件描述符。出错时，返回 -1，并正确设置 errno，错误类型如下：</p> 
<table><thead><tr><th>错误类型</th><th>解释</th></tr></thead><tbody><tr><td>EACCES</td><td>创建指定类型和/或协议的套接字的权限被拒绝。</td></tr><tr><td>EAFNOSUPPORT</td><td>不支持指定的地址系列。</td></tr><tr><td>EINVAL</td><td>未知的协议，或协议系列不可用。或类型中的标志无效。</td></tr><tr><td>EMFILE</td><td>已达到每个进程对打开的文件描述符数的限制。</td></tr><tr><td>ENFILE</td><td>已达到系统范围内对打开的文件总数的限制。</td></tr><tr><td>ENOBUFS or ENOMEM</td><td>可用内存不足。 在释放足够的资源之前，无法创建套接字。</td></tr><tr><td>EPROTONOSUPPORT</td><td>此域中不支持协议类型或指定的协议。</td></tr></tbody></table> 
<h5><a id="14__60"></a>1.4 结束</h5> 
<p>socket()函数介绍至此结束，虽然这个函数的使用一般来说并不会出错，但是建议养成良好的编程习惯，每次调用都对器返回值进行判断。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3bc6e9a88388801a8b5a48585842141f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Python 基于OpenCV&#43;face_recognition实现人脸捕捉与人脸识别（照片对比）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/afe290e52930426ac9459843270f1ea8/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">1.基于正点原子STM32F103外部中断实验（HAL库实现）（cubeMX）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>