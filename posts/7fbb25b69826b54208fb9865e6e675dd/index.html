<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Vue3纯前端实现Vue路由权限的方法详解 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Vue3纯前端实现Vue路由权限的方法详解" />
<meta property="og:description" content="原文地址：Vue3纯前端实现Vue路由权限的方法详解_vue.js_脚本之家
前言 在开发管理后台时，都会存在多个角色登录，登录成功后，不同的角色会展示不同的菜单路由。这就是我们通常所说的动态路由权限，实现路由权限的方案有多种，比较常用的是由前端使用addRoutes（V3版本改成了addRoute）动态挂载路由和服务端返回可访问的路由菜单这两种。今天主要是从前端角度，实现路由权限的功能。
RBAC模型 前端实现路由权限主要是基于RBAC模型。
RBAC（Role-Based Access Control）即：基于角色的权限控制。通过角色关联用户，角色关联权限的方式间接赋予用户权限。
代码实现 登录 首先是登录，登录成功后，服务端会返回用户登录的角色、token以及用户信息等。用户角色如：role: [&#39;admin&#39;]。我们一般会将这些信息保存到Vuex里。
1
2
3
4
5
6
7
8
9
const login = () =&gt; {
ruleFormRef.value?.validate((valid: boolean) =&gt; {
if (valid) {
store.dispatch(&#39;userModule/login&#39;, { ...accountForm })
} else {
console.log(&#39;error submit!&#39;)
}
})
}
信息存储在Vuex：
1
2
3
4
5
6
7
8
9
10
11
async login({ commit }, payload: IRequest) {
// 登录获取token
const { data } = await accountLogin(payload)" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/7fbb25b69826b54208fb9865e6e675dd/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-01-02T08:54:45+08:00" />
<meta property="article:modified_time" content="2023-01-02T08:54:45+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Vue3纯前端实现Vue路由权限的方法详解</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>原文地址：<a href="https://www.jb51.net/article/247790.htm" rel="nofollow" title="Vue3纯前端实现Vue路由权限的方法详解_vue.js_脚本之家">Vue3纯前端实现Vue路由权限的方法详解_vue.js_脚本之家</a></p> 
<h3>前言</h3> 
<p>在开发管理后台时，都会存在多个角色登录，登录成功后，不同的角色会展示不同的菜单路由。这就是我们通常所说的动态路由权限，实现路由权限的方案有多种，比较常用的是由前端使用addRoutes（V3版本改成了addRoute）动态挂载路由和服务端返回可访问的路由菜单这两种。今天主要是从前端角度，实现路由权限的功能。</p> 
<p><a name="_label1"></a></p> 
<h3>RBAC模型</h3> 
<p>前端实现路由权限主要是基于RBAC模型。</p> 
<p>RBAC（Role-Based Access Control）即：基于角色的权限控制。通过角色关联用户，角色关联权限的方式间接赋予用户权限。</p> 
<p><a name="_label2"></a></p> 
<h3>代码实现</h3> 
<p><a name="_lab2_2_0"></a></p> 
<h4>登录</h4> 
<p>首先是登录，登录成功后，服务端会返回用户登录的角色、token以及用户信息等。用户角色如：role: ['admin']。我们一般会将这些信息保存到Vuex里。</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> <p>2</p> <p>3</p> <p>4</p> <p>5</p> <p>6</p> <p>7</p> <p>8</p> <p>9</p> </td><td> <p><code>const login = () =&gt; {<!-- --></code></p> <p><code>  </code><code>ruleFormRef.value?.validate((valid: boolean) =&gt; {<!-- --></code></p> <p><code>    </code><code>if</code> <code>(valid) {<!-- --></code></p> <p><code>      </code><code>store.dispatch(</code><code>'userModule/login'</code><code>, { ...accountForm })</code></p> <p><code>    </code><code>} </code><code>else</code> <code>{<!-- --></code></p> <p><code>      </code><code>console.log(</code><code>'error submit!'</code><code>)</code></p> <p><code>    </code><code>}</code></p> <p><code>  </code><code>})</code></p> <p><code>}</code></p> </td></tr></tbody></table> 
<p>信息存储在Vuex：</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> <p>2</p> <p>3</p> <p>4</p> <p>5</p> <p>6</p> <p>7</p> <p>8</p> <p>9</p> <p>10</p> <p>11</p> </td><td> <p><code>async login({ commit }, payload: IRequest) {<!-- --></code></p> <p><code>  </code><code>// 登录获取token</code></p> <p><code>  </code><code>const { data } = await accountLogin(payload)</code></p> <p><code>  </code><code>commit(</code><code>'SET_TOKEN'</code><code>, data.token)</code></p> <p><code>  </code><code>localCache.setCache(</code><code>'token'</code><code>, data.token)</code></p> <p><code>  </code><code>// 获取用户信息</code></p> <p><code>  </code><code>const userInfo = await getUserInfo(data.id)</code></p> <p><code>  </code><code>commit(</code><code>'SET_USERINFO'</code><code>, userInfo.data)</code></p> <p><code>  </code><code>localCache.setCache(</code><code>'userInfo'</code><code>, userInfo.data)</code></p> <p><code>  </code><code>router.replace(</code><code>'/'</code><code>)</code></p> <p><code>},</code></p> </td></tr></tbody></table> 
<p>服务端返回token：</p> 
<p></p> 
<p>服务端返回用户信息：</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/b5/82/kRFPY2KM_o.png"></p> 
<p><a name="_lab2_2_1"></a></p> 
<h4>菜单信息</h4> 
<p>路由菜单信息分为两种，一种是默认路由constantRoutes，即所有人都能够访问的页面，不需去通过用户角色去判断，如login、404、首页等等。还有一种就是动态路由asyncRoutes，用来放置有权限（roles 属性）的路由，这部分的路由是需要访问权限的。我们最终将在动态路由里面根据用户角色筛选出能访问的动态路由列表。</p> 
<p>我们将默认路由和动态路由都写在router/index.ts里。</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> <p>2</p> <p>3</p> <p>4</p> <p>5</p> <p>6</p> <p>7</p> <p>8</p> <p>9</p> <p>10</p> <p>11</p> <p>12</p> <p>13</p> <p>14</p> <p>15</p> <p>16</p> <p>17</p> <p>18</p> <p>19</p> <p>20</p> <p>21</p> <p>22</p> <p>23</p> <p>24</p> <p>25</p> <p>26</p> <p>27</p> <p>28</p> <p>29</p> <p>30</p> <p>31</p> <p>32</p> <p>33</p> <p>34</p> <p>35</p> <p>36</p> <p>37</p> <p>38</p> <p>39</p> <p>40</p> <p>41</p> <p>42</p> <p>43</p> <p>44</p> <p>45</p> <p>46</p> <p>47</p> <p>48</p> <p>49</p> <p>50</p> <p>51</p> <p>52</p> <p>53</p> <p>54</p> <p>55</p> <p>56</p> <p>57</p> <p>58</p> <p>59</p> <p>60</p> <p>61</p> <p>62</p> <p>63</p> <p>64</p> <p>65</p> <p>66</p> <p>67</p> <p>68</p> <p>69</p> <p>70</p> <p>71</p> <p>72</p> <p>73</p> <p>74</p> <p>75</p> <p>76</p> <p>77</p> <p>78</p> <p>79</p> <p>80</p> <p>81</p> <p>82</p> <p>83</p> <p>84</p> <p>85</p> <p>86</p> <p>87</p> <p>88</p> <p>89</p> <p>90</p> <p>91</p> <p>92</p> <p>93</p> <p>94</p> <p>95</p> <p>96</p> <p>97</p> <p>98</p> <p>99</p> <p>100</p> <p>101</p> <p>102</p> <p>103</p> <p>104</p> <p>105</p> <p>106</p> <p>107</p> <p>108</p> <p>109</p> <p>110</p> <p>111</p> <p>112</p> <p>113</p> <p>114</p> <p>115</p> <p>116</p> <p>117</p> <p>118</p> <p>119</p> <p>120</p> <p>121</p> <p>122</p> <p>123</p> <p>124</p> <p>125</p> <p>126</p> <p>127</p> <p>128</p> <p>129</p> <p>130</p> <p>131</p> <p>132</p> <p>133</p> <p>134</p> <p>135</p> <p>136</p> <p>137</p> <p>138</p> <p>139</p> <p>140</p> <p>141</p> <p>142</p> <p>143</p> <p>144</p> <p>145</p> <p>146</p> <p>147</p> <p>148</p> <p>149</p> <p>150</p> <p>151</p> <p>152</p> <p>153</p> <p>154</p> <p>155</p> </td><td> <p><code>import { createRouter, createWebHashHistory, RouteRecordRaw } from </code><code>'vue-router'</code></p> <p><code>const Layout = () =&gt; import(</code><code>'@/Layout'</code><code>)</code></p> <p></p> <p><code>/** 常驻路由 */</code></p> <p><code>export const constantRoutes: RouteRecordRaw[] = [</code></p> <p><code>  </code><code>{<!-- --></code></p> <p><code>    </code><code>path: </code><code>'/login'</code><code>,</code></p> <p><code>    </code><code>name: </code><code>'login'</code><code>,</code></p> <p><code>    </code><code>component: () =&gt; import(</code><code>'@/views/login/index.vue'</code><code>),</code></p> <p><code>    </code><code>meta: {<!-- --></code></p> <p><code>      </code><code>title: </code><code>'登录'</code><code>,</code></p> <p><code>      </code><code>hidden: </code><code>true</code></p> <p><code>    </code><code>}</code></p> <p><code>  </code><code>},</code></p> <p><code>  </code><code>{<!-- --></code></p> <p><code>    </code><code>path: </code><code>'/'</code><code>,</code></p> <p><code>    </code><code>component: Layout,</code></p> <p><code>    </code><code>redirect: </code><code>'/analysis/dashboard'</code><code>,</code></p> <p><code>    </code><code>name: </code><code>'Analysis'</code><code>,</code></p> <p><code>    </code><code>meta: {<!-- --></code></p> <p><code>      </code><code>hidden: </code><code>false</code><code>,</code></p> <p><code>      </code><code>icon: </code><code>'icon-home'</code><code>,</code></p> <p><code>      </code><code>title: </code><code>'系统总览'</code></p> <p><code>    </code><code>},</code></p> <p><code>    </code><code>children: [</code></p> <p><code>      </code><code>{<!-- --></code></p> <p><code>        </code><code>path: </code><code>'/analysis/dashboard'</code><code>,</code></p> <p><code>        </code><code>name: </code><code>'Dashboard'</code><code>,</code></p> <p><code>        </code><code>component: () =&gt; import(</code><code>'@/views/analysis/dashboard/dashboard.vue'</code><code>),</code></p> <p><code>        </code><code>meta: { title: </code><code>'商品统计'</code><code>, hidden: </code><code>false</code> <code>}</code></p> <p><code>      </code><code>},</code></p> <p><code>      </code><code>{<!-- --></code></p> <p><code>        </code><code>path: </code><code>'/analysis/overview'</code><code>,</code></p> <p><code>        </code><code>name: </code><code>'Overview'</code><code>,</code></p> <p><code>        </code><code>component: () =&gt; import(</code><code>'@/views/analysis/overview/overview.vue'</code><code>),</code></p> <p><code>        </code><code>meta: { title: </code><code>'核心技术'</code><code>, hidden: </code><code>false</code> <code>}</code></p> <p><code>      </code><code>}</code></p> <p><code>    </code><code>]</code></p> <p><code>  </code><code>},</code></p> <p><code>  </code><code>{<!-- --></code></p> <p><code>    </code><code>path: </code><code>'/product'</code><code>,</code></p> <p><code>    </code><code>component: Layout,</code></p> <p><code>    </code><code>redirect: </code><code>'/product/category'</code><code>,</code></p> <p><code>    </code><code>name: </code><code>'Product'</code><code>,</code></p> <p><code>    </code><code>meta: {<!-- --></code></p> <p><code>      </code><code>hidden: </code><code>false</code><code>,</code></p> <p><code>      </code><code>icon: </code><code>'icon-tuijian'</code><code>,</code></p> <p><code>      </code><code>title: </code><code>'商品中心'</code></p> <p><code>    </code><code>},</code></p> <p><code>    </code><code>children: [</code></p> <p><code>      </code><code>{<!-- --></code></p> <p><code>        </code><code>path: </code><code>'/product/category'</code><code>,</code></p> <p><code>        </code><code>name: </code><code>'Category'</code><code>,</code></p> <p><code>        </code><code>component: () =&gt; import(</code><code>'@/views/product/category/category.vue'</code><code>),</code></p> <p><code>        </code><code>meta: { title: </code><code>'商品类别'</code><code>, hidden: </code><code>false</code> <code>}</code></p> <p><code>      </code><code>},</code></p> <p><code>      </code><code>{<!-- --></code></p> <p><code>        </code><code>path: </code><code>'/product/goods'</code><code>,</code></p> <p><code>        </code><code>name: </code><code>'Goods'</code><code>,</code></p> <p><code>        </code><code>component: () =&gt; import(</code><code>'@/views/product/goods/goods.vue'</code><code>),</code></p> <p><code>        </code><code>meta: { title: </code><code>'商品信息'</code><code>, hidden: </code><code>false</code> <code>}</code></p> <p><code>      </code><code>}</code></p> <p><code>    </code><code>]</code></p> <p><code>  </code><code>},</code></p> <p><code>  </code><code>{<!-- --></code></p> <p><code>    </code><code>path: </code><code>'/story'</code><code>,</code></p> <p><code>    </code><code>component: Layout,</code></p> <p><code>    </code><code>redirect: </code><code>'/story/chat'</code><code>,</code></p> <p><code>    </code><code>name: </code><code>'Story'</code><code>,</code></p> <p><code>    </code><code>meta: {<!-- --></code></p> <p><code>      </code><code>hidden: </code><code>false</code><code>,</code></p> <p><code>      </code><code>icon: </code><code>'icon-xiaoxi'</code><code>,</code></p> <p><code>      </code><code>title: </code><code>'随便聊聊'</code></p> <p><code>    </code><code>},</code></p> <p><code>    </code><code>children: [</code></p> <p><code>      </code><code>{<!-- --></code></p> <p><code>        </code><code>path: </code><code>'/story/chat'</code><code>,</code></p> <p><code>        </code><code>name: </code><code>'Story'</code><code>,</code></p> <p><code>        </code><code>component: () =&gt; import(</code><code>'@/views/story/chat/chat.vue'</code><code>),</code></p> <p><code>        </code><code>meta: { title: </code><code>'你的故事'</code><code>, hidden: </code><code>false</code> <code>}</code></p> <p><code>      </code><code>},</code></p> <p><code>      </code><code>{<!-- --></code></p> <p><code>        </code><code>path: </code><code>'/story/list'</code><code>,</code></p> <p><code>        </code><code>name: </code><code>'List'</code><code>,</code></p> <p><code>        </code><code>component: () =&gt; import(</code><code>'@/views/story/list/list.vue'</code><code>),</code></p> <p><code>        </code><code>meta: { title: </code><code>'故事列表'</code><code>, hidden: </code><code>false</code> <code>}</code></p> <p><code>      </code><code>}</code></p> <p><code>    </code><code>]</code></p> <p><code>  </code><code>},</code></p> <p><code>  </code><code>{<!-- --></code></p> <p><code>    </code><code>path: </code><code>'/404'</code><code>,</code></p> <p><code>    </code><code>component: () =&gt; import(</code><code>'@/views/404.vue'</code><code>),</code></p> <p><code>    </code><code>meta: {<!-- --></code></p> <p><code>      </code><code>title: </code><code>'Not Found'</code><code>,</code></p> <p><code>      </code><code>hidden: </code><code>true</code></p> <p><code>    </code><code>}</code></p> <p><code>  </code><code>},</code></p> <p><code>  </code><code>{<!-- --></code></p> <p><code>    </code><code>path: </code><code>'/:pathMatch(.*)*'</code><code>,</code></p> <p><code>    </code><code>redirect: </code><code>'/404'</code><code>,</code></p> <p><code>    </code><code>meta: {<!-- --></code></p> <p><code>      </code><code>hidden: </code><code>true</code><code>,</code></p> <p><code>      </code><code>title: </code><code>'Not Found'</code></p> <p><code>    </code><code>}</code></p> <p><code>  </code><code>}</code></p> <p><code>]</code></p> <p><code>/**</code></p> <p><code> </code><code>* 动态路由</code></p> <p><code> </code><code>* 用来放置有权限（roles 属性）的路由</code></p> <p><code> </code><code>* 必须带有 name 属性</code></p> <p><code> </code><code>*/</code></p> <p><code>export const asyncRoutes: RouteRecordRaw[] = [</code></p> <p><code>  </code><code>{<!-- --></code></p> <p><code>    </code><code>path: </code><code>'/system'</code><code>,</code></p> <p><code>    </code><code>component: Layout,</code></p> <p><code>    </code><code>redirect: </code><code>'/system/department'</code><code>,</code></p> <p><code>    </code><code>name: </code><code>'System'</code><code>,</code></p> <p><code>    </code><code>meta: {<!-- --></code></p> <p><code>      </code><code>hidden: </code><code>false</code><code>,</code></p> <p><code>      </code><code>icon: </code><code>'icon-shezhi'</code><code>,</code></p> <p><code>      </code><code>title: </code><code>'系统管理'</code></p> <p><code>    </code><code>},</code></p> <p><code>    </code><code>children: [</code></p> <p><code>      </code><code>{<!-- --></code></p> <p><code>        </code><code>path: </code><code>'/system/department'</code><code>,</code></p> <p><code>        </code><code>name: </code><code>'Department'</code><code>,</code></p> <p><code>        </code><code>component: () =&gt; import(</code><code>'@/views/system/department/department.vue'</code><code>),</code></p> <p><code>        </code><code>meta: { title: </code><code>'部门管理'</code><code>, hidden: </code><code>false</code><code>, role: [</code><code>'admin'</code><code>] }</code></p> <p><code>      </code><code>},</code></p> <p><code>      </code><code>{<!-- --></code></p> <p><code>        </code><code>path: </code><code>'/system/menu'</code><code>,</code></p> <p><code>        </code><code>name: </code><code>'Menu'</code><code>,</code></p> <p><code>        </code><code>component: () =&gt; import(</code><code>'@/views/system/menu/menu.vue'</code><code>),</code></p> <p><code>        </code><code>meta: { title: </code><code>'菜单管理'</code><code>, hidden: </code><code>false</code><code>, role: [</code><code>'admin'</code><code>] }</code></p> <p><code>      </code><code>},</code></p> <p><code>      </code><code>{<!-- --></code></p> <p><code>        </code><code>path: </code><code>'/system/role'</code><code>,</code></p> <p><code>        </code><code>name: </code><code>'Role'</code><code>,</code></p> <p><code>        </code><code>component: () =&gt; import(</code><code>'@/views/system/role/role.vue'</code><code>),</code></p> <p><code>        </code><code>meta: { title: </code><code>'角色管理'</code><code>, hidden: </code><code>false</code><code>, role: [</code><code>'editor'</code><code>] }</code></p> <p><code>      </code><code>},</code></p> <p><code>      </code><code>{<!-- --></code></p> <p><code>        </code><code>path: </code><code>'/system/user'</code><code>,</code></p> <p><code>        </code><code>name: </code><code>'User'</code><code>,</code></p> <p><code>        </code><code>component: () =&gt; import(</code><code>'@/views/system/user/user.vue'</code><code>),</code></p> <p><code>        </code><code>meta: { title: </code><code>'用户管理'</code><code>, hidden: </code><code>false</code><code>, role: [</code><code>'editor'</code><code>] }</code></p> <p><code>      </code><code>}</code></p> <p><code>    </code><code>]</code></p> <p><code>  </code><code>}</code></p> <p><code>]</code></p> <p><code>const router = createRouter({<!-- --></code></p> <p><code>  </code><code>history: createWebHashHistory(),</code></p> <p><code>  </code><code>routes: constantRoutes</code></p> <p><code>})</code></p> <p><code>export </code><code>default</code> <code>router</code></p> </td></tr></tbody></table> 
<p>我们将系统管理这个菜单作为动态路由部分，里面的子菜单meta属性下都分配有一个访问权限的role属性，我们需要将role属性和用户角色去匹配是否用户具有访问权限。</p> 
<p><a name="_lab2_2_2"></a></p> 
<h4>动态路由筛选</h4> 
<p>思路：</p> 
<p>我们登录得到了用户角色role和写好路由信息（分为默认路由列表和动态路由列表），之后我们需要做的就是通过用户角色role去匹配动态路由列表里面每个子路由的role属性，得到能够访问的动态路由部分，将默认路由和我们得到的动态路由进行拼接这样我们就得到了用户能够访问的完整前端路由，最后使用addRoute将完整路由挂载到router上。</p> 
<p>有了这样一个比较清晰的思路，接下来我们就来尝试着实现它。</p> 
<p>我们可以将这块的逻辑也放在Vuex里面，在store/modules下新建一个permission.ts文件。</p> 
<p>首先我们需要写一个方法去判断用户是否具有访问单个路由的权限：</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> <p>2</p> <p>3</p> <p>4</p> <p>5</p> <p>6</p> <p>7</p> <p>8</p> <p>9</p> <p>10</p> <p>11</p> <p>12</p> <p>13</p> <p>14</p> <p>15</p> <p>16</p> <p>17</p> <p>18</p> </td><td> <p><code>/**</code></p> <p><code> </code><code>* 判断用户是否有权限访问单个路由</code></p> <p><code> </code><code>* roles：用户角色</code></p> <p><code> </code><code>* route：访问的路由</code></p> <p><code> </code><code>*/</code></p> <p><code>const hasPermission = (roles: string[], route: any) =&gt; {<!-- --></code></p> <p><code>  </code><code>if</code> <code>(route.meta &amp;&amp; route.meta.roles) {<!-- --></code></p> <p><code>    </code><code>return</code> <code>roles.some((role) =&gt; {<!-- --></code></p> <p><code>      </code><code>if</code> <code>(route.meta?.roles !== undefined) {<!-- --></code></p> <p><code>        </code><code>return</code> <code>route.meta.roles.includes(role)</code></p> <p><code>      </code><code>} </code><code>else</code> <code>{<!-- --></code></p> <p><code>        </code><code>return</code> <code>false</code></p> <p><code>      </code><code>}</code></p> <p><code>    </code><code>})</code></p> <p><code>  </code><code>} </code><code>else</code> <code>{<!-- --></code></p> <p><code>    </code><code>return</code> <code>true</code></p> <p><code>  </code><code>}</code></p> <p><code>}</code></p> </td></tr></tbody></table> 
<p>实现的核心是route.meta.roles.includes(role)，即路由的roles是否包含了用户的角色，包含了就可以访问，否则不能。</p> 
<p>对用户角色进行some遍历主要是用户的角色可能存在多个，如：['admin', 'editor']。</p> 
<p>这样我们就实现了单个路由访问权限的筛选，但是动态路由列表是一个数组，每个一级路由下可能有二级路由、三级路由甚至更多，这样我们就需要用到递归函数进行筛选：</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> <p>2</p> <p>3</p> <p>4</p> <p>5</p> <p>6</p> <p>7</p> <p>8</p> <p>9</p> <p>10</p> <p>11</p> <p>12</p> <p>13</p> <p>14</p> <p>15</p> <p>16</p> <p>17</p> <p>18</p> </td><td> <p><code>/**</code></p> <p><code> </code><code>* 筛选可访问的动态路由</code></p> <p><code> </code><code>* roles：用户角色</code></p> <p><code> </code><code>* route：访问的动态列表</code></p> <p><code> </code><code>*/</code></p> <p><code>const filterAsyncRoutes = (routes: RouteRecordRaw[], roles: string[]) =&gt; {<!-- --></code></p> <p><code>  </code><code>const res: RouteRecordRaw[] = []</code></p> <p><code>  </code><code>routes.forEach((route) =&gt; {<!-- --></code></p> <p><code>    </code><code>const r = { ...route }</code></p> <p><code>    </code><code>if</code> <code>(hasPermission(roles, r)) {<!-- --></code></p> <p><code>      </code><code>if</code> <code>(r.children) {<!-- --></code></p> <p><code>        </code><code>r.children = filterAsyncRoutes(r.children, roles)</code></p> <p><code>      </code><code>}</code></p> <p><code>      </code><code>res.push(r)</code></p> <p><code>    </code><code>}</code></p> <p><code>  </code><code>})</code></p> <p><code>  </code><code>return</code> <code>res</code></p> <p><code>}</code></p> </td></tr></tbody></table> 
<p>这样，通过调用filterAsyncRoutes这个函数，然后传入utes：动态路由列表，roles：用户角色两个参数就能得到我们能访问的动态路由了。</p> 
<p>然后我们将筛选得到的动态路由和默认路由通过concat拼接得到完整可访问路由，最后通过addRoute挂载。</p> 
<p>我们将以上代码逻辑整理到sion.ts里：</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> <p>2</p> <p>3</p> <p>4</p> <p>5</p> <p>6</p> <p>7</p> <p>8</p> <p>9</p> <p>10</p> <p>11</p> <p>12</p> <p>13</p> <p>14</p> <p>15</p> <p>16</p> <p>17</p> <p>18</p> <p>19</p> <p>20</p> <p>21</p> <p>22</p> <p>23</p> <p>24</p> <p>25</p> <p>26</p> <p>27</p> <p>28</p> <p>29</p> <p>30</p> <p>31</p> <p>32</p> <p>33</p> <p>34</p> <p>35</p> <p>36</p> <p>37</p> <p>38</p> <p>39</p> <p>40</p> <p>41</p> <p>42</p> <p>43</p> <p>44</p> <p>45</p> <p>46</p> <p>47</p> <p>48</p> <p>49</p> <p>50</p> <p>51</p> <p>52</p> <p>53</p> <p>54</p> <p>55</p> <p>56</p> <p>57</p> <p>58</p> <p>59</p> <p>60</p> <p>61</p> <p>62</p> <p>63</p> <p>64</p> <p>65</p> <p>66</p> <p>67</p> <p>68</p> <p>69</p> <p>70</p> <p>71</p> <p>72</p> <p>73</p> <p>74</p> </td><td> <p><code>import { Module } from </code><code>'vuex'</code></p> <p><code>import { RouteRecordRaw } from </code><code>'vue-router'</code></p> <p><code>import { constantRoutes, asyncRoutes } from </code><code>'@/router'</code></p> <p><code>import { IRootState } from </code><code>'../types'</code></p> <p><code>import router from </code><code>'@/router'</code></p> <p><code>/**</code></p> <p><code> </code><code>* 判断用户是否有权限访问单个路由</code></p> <p><code> </code><code>* roles：用户角色</code></p> <p><code> </code><code>* route：访问的路由</code></p> <p><code> </code><code>*/</code></p> <p><code>const hasPermission = (roles: string[], route: any) =&gt; {<!-- --></code></p> <p><code>  </code><code>if</code> <code>(route.meta &amp;&amp; route.meta.roles) {<!-- --></code></p> <p><code>    </code><code>return</code> <code>roles.some((role) =&gt; {<!-- --></code></p> <p><code>      </code><code>if</code> <code>(route.meta?.roles !== undefined) {<!-- --></code></p> <p><code>        </code><code>return</code> <code>route.meta.roles.includes(role)</code></p> <p><code>      </code><code>} </code><code>else</code> <code>{<!-- --></code></p> <p><code>        </code><code>return</code> <code>false</code></p> <p><code>      </code><code>}</code></p> <p><code>    </code><code>})</code></p> <p><code>  </code><code>} </code><code>else</code> <code>{<!-- --></code></p> <p><code>    </code><code>return</code> <code>true</code></p> <p><code>  </code><code>}</code></p> <p><code>}</code></p> <p><code>/**</code></p> <p><code> </code><code>* 筛选可访问的动态路由</code></p> <p><code> </code><code>* roles：用户角色</code></p> <p><code> </code><code>* route：访问的动态列表</code></p> <p><code> </code><code>*/</code></p> <p><code>const filterAsyncRoutes = (routes: RouteRecordRaw[], roles: string[]) =&gt; {<!-- --></code></p> <p><code>  </code><code>const res: RouteRecordRaw[] = []</code></p> <p><code>  </code><code>routes.forEach((route) =&gt; {<!-- --></code></p> <p><code>    </code><code>const r = { ...route }</code></p> <p><code>    </code><code>if</code> <code>(hasPermission(roles, r)) {<!-- --></code></p> <p><code>      </code><code>if</code> <code>(r.children) {<!-- --></code></p> <p><code>        </code><code>r.children = filterAsyncRoutes(r.children, roles)</code></p> <p><code>      </code><code>}</code></p> <p><code>      </code><code>res.push(r)</code></p> <p><code>    </code><code>}</code></p> <p><code>  </code><code>})</code></p> <p><code>  </code><code>return</code> <code>res</code></p> <p><code>}</code></p> <p><code>interface IPermissionState {<!-- --></code></p> <p><code>  </code><code>routes: RouteRecordRaw[]</code></p> <p><code>  </code><code>dynamicRoutes: RouteRecordRaw[]</code></p> <p><code>}</code></p> <p><code>export const routesModule: Module&lt;IPermissionState, IRootState&gt; = {<!-- --></code></p> <p><code>  </code><code>namespaced: </code><code>true</code><code>,</code></p> <p><code>  </code><code>state: {<!-- --></code></p> <p><code>    </code><code>routes: [],</code></p> <p><code>    </code><code>dynamicRoutes: []</code></p> <p><code>  </code><code>},</code></p> <p><code>  </code><code>getters: {},</code></p> <p><code>  </code><code>mutations: {<!-- --></code></p> <p><code>    </code><code>SET_ROUTES(state, routes) {<!-- --></code></p> <p><code>      </code><code>state.routes = routes</code></p> <p><code>    </code><code>},</code></p> <p><code>    </code><code>SET_DYNAMICROUTES(state, routes) {<!-- --></code></p> <p><code>      </code><code>state.dynamicRoutes = routes</code></p> <p><code>    </code><code>}</code></p> <p><code>  </code><code>},</code></p> <p><code>  </code><code>actions: {<!-- --></code></p> <p><code>    </code><code>generateRoutes({ commit }, { roles }) {<!-- --></code></p> <p><code>      </code><code>// accessedRoutes: 筛选出的动态路由</code></p> <p><code>      </code><code>const accessedRoutes = filterAsyncRoutes(asyncRoutes, roles)</code></p> <p><code>      </code><code>// 将accessedRoutes和默认路由constantRoutes拼接得到完整可访问路由</code></p> <p><code>      </code><code>commit(</code><code>'SET_ROUTES'</code><code>, constantRoutes.concat(accessedRoutes))</code></p> <p><code>      </code><code>commit(</code><code>'SET_DYNAMICROUTES'</code><code>, accessedRoutes)</code></p> <p><code>      </code><code>// 通过addRoute将路由挂载到router上</code></p> <p><code>      </code><code>accessedRoutes.forEach((route) =&gt; {<!-- --></code></p> <p><code>        </code><code>router.addRoute(route)</code></p> <p><code>      </code><code>})</code></p> <p><code>    </code><code>}</code></p> <p><code>  </code><code>}</code></p> <p><code>}</code></p> </td></tr></tbody></table> 
<p>这样就实现了所有代码逻辑。有个问题，addRoute应该何时调用，在哪里调用？</p> 
<p>登录后，获取用户的权限信息，然后筛选有权限访问的路由，再调用addRoute添加路由。这个方法是可行的。但是不可能每次进入应用都需要登录，用户刷新浏览器又要登录一次。所以addRoute还是要在全局路由守卫里进行调用。</p> 
<p>我们在router文件夹下创建一个permission.ts，用于写全局路由守卫相关逻辑：</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> <p>2</p> <p>3</p> <p>4</p> <p>5</p> <p>6</p> <p>7</p> <p>8</p> <p>9</p> <p>10</p> <p>11</p> <p>12</p> <p>13</p> <p>14</p> <p>15</p> <p>16</p> <p>17</p> <p>18</p> <p>19</p> <p>20</p> <p>21</p> <p>22</p> <p>23</p> <p>24</p> <p>25</p> <p>26</p> <p>27</p> <p>28</p> <p>29</p> <p>30</p> <p>31</p> <p>32</p> <p>33</p> <p>34</p> <p>35</p> <p>36</p> <p>37</p> <p>38</p> <p>39</p> <p>40</p> <p>41</p> <p>42</p> <p>43</p> <p>44</p> <p>45</p> <p>46</p> <p>47</p> <p>48</p> </td><td> <p><code>import router from </code><code>'@/router'</code></p> <p><code>import { RouteLocationNormalized } from </code><code>'vue-router'</code></p> <p><code>import localCache from </code><code>'@/utils/cache'</code></p> <p><code>import NProgress from </code><code>'nprogress'</code></p> <p><code>import </code><code>'nprogress/nprogress.css'</code></p> <p><code>import store from </code><code>'@/store'</code></p> <p></p> <p><code>NProgress.configure({ showSpinner: </code><code>false</code> <code>})</code></p> <p><code>const whiteList = [</code><code>'/login'</code><code>]</code></p> <p><code>router.beforeEach(</code></p> <p><code>  </code><code>async (</code></p> <p><code>    </code><code>to: RouteLocationNormalized,</code></p> <p><code>    </code><code>from: RouteLocationNormalized,</code></p> <p><code>    </code><code>next: any</code></p> <p><code>  </code><code>) =&gt; {<!-- --></code></p> <p><code>    </code><code>document.title = to.meta.title as string</code></p> <p><code>    </code><code>const token: string = localCache.getCache(</code><code>'token'</code><code>)</code></p> <p><code>    </code><code>NProgress.start()</code></p> <p><code>    </code><code>// 判断该用户是否登录</code></p> <p><code>    </code><code>if</code> <code>(token) {<!-- --></code></p> <p><code>      </code><code>if</code> <code>(to.path === </code><code>'/login'</code><code>) {<!-- --></code></p> <p><code>        </code><code>// 如果登录，并准备进入 login 页面，则重定向到主页</code></p> <p><code>        </code><code>next({ path: </code><code>'/'</code> <code>})</code></p> <p><code>        </code><code>NProgress.done()</code></p> <p><code>      </code><code>} </code><code>else</code> <code>{<!-- --></code></p> <p><code>        </code><code>const roles = store.state.userModule.roles</code></p> <p><code>        </code><code>store.dispatch(</code><code>'routesModule/generateRoutes'</code><code>, { roles })</code></p> <p><code>        </code><code>// 确保添加路由已完成</code></p> <p><code>        </code><code>// 设置 replace: true, 因此导航将不会留下历史记录</code></p> <p><code>        </code><code>next({ ...to, replace: </code><code>true</code> <code>})</code></p> <p><code>        </code><code>// next()</code></p> <p><code>      </code><code>}</code></p> <p><code>    </code><code>} </code><code>else</code> <code>{<!-- --></code></p> <p><code>      </code><code>// 如果没有 token</code></p> <p><code>      </code><code>if</code> <code>(whiteList.includes(to.path)) {<!-- --></code></p> <p><code>        </code><code>// 如果在免登录的白名单中，则直接进入</code></p> <p><code>        </code><code>next()</code></p> <p><code>      </code><code>} </code><code>else</code> <code>{<!-- --></code></p> <p><code>        </code><code>// 其他没有访问权限的页面将被重定向到登录页面</code></p> <p><code>        </code><code>next(</code><code>'/login'</code><code>)</code></p> <p><code>        </code><code>NProgress.done()</code></p> <p><code>      </code><code>}</code></p> <p><code>    </code><code>}</code></p> <p><code>  </code><code>}</code></p> <p><code>)</code></p> <p><code>router.afterEach(() =&gt; {<!-- --></code></p> <p><code>  </code><code>NProgress.done()</code></p> <p><code>})</code></p> </td></tr></tbody></table> 
<p>这样，完整的路由权限功能就完成了。我们可以做一下验证：</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/88/f9/YD6qeIae_o.png"></p> 
<p>动态路由</p> 
<p>我们登录的用户角色为roles: ['editor']，动态路由为系统管理菜单，里面有四个子路由对应有roles,正常情况下我们可以访问系统管理菜单下的角色管理和用户管理。</p> 
<p></p> 
<p>渲染菜单界面</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/88/a3/Cg8RGPYb_o.png"></p> 
<p>筛选出的动态路由</p> 
<p>没有任何问题！</p> 
<p><a name="_label3"></a></p> 
<h3>总结</h3> 
<p>前端实现动态路由是基于RBAC思想，通过用户角色去筛选出可以访问的路由挂载在router上。这样实现有一点不好的地方在于菜单信息是写死在前端，以后要改个显示文字或权限信息，需要重新修改然后编译。</p> 
<p>到此这篇关于Vue3纯前端实现Vue路由权限的文章就介绍到这了,更多相关Vue3纯前端实现路由权限内容请搜索脚本之家以前的文章或继续浏览下面的相关文章希望大家以后多多支持脚本之家！</p> 
<p></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d5c71078c964ca5352eabbaabb119b2a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">C语言仿天天酷跑小游戏</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6b51009e8f6c6ae594d9e0bbcddda909/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">VMware虚拟机快照——虚拟机状态恢复</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>