<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Ubuntu、stm32下的C程序中堆、栈、全局、局部等变量的分配地址 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Ubuntu、stm32下的C程序中堆、栈、全局、局部等变量的分配地址" />
<meta property="og:description" content="一、变量介绍 1、全局常量：在程序中定义的全局范围内不可改变的常量，它们的值在整个程序执行过程中都保持不变。
2、全局变量：在程序中定义的全局范围内可改变的变量，它们可以在程序的任何位置被访问和修改。
3、局部变量：在函数或代码块中定义的变量，它们的作用域仅限于函数或代码块内部，在外部无法访问。
4、静态变量：在函数内或代码块内用 static 关键字修饰的变量，它们的生存期会延长到整个程序的执行过程中，但作用域仍然限于所在的函数或代码块内部。
5、堆：动态分配内存的一种方式，通过调用 malloc 或 new 等函数在运行时分配的内存空间。它的生命周期由程序员手动管理，需要显式释放。
6、栈：存储函数调用和局部变量的一块内存空间，它的管理由编译器自动完成，具有先进后出的特点。
二、变量的内存分配 栈区（stack）：指那些由编译器在需要的时候分配，不需要时自动清除的变量所在的储存区，如函数执行时，函数的形参以及函数内的局部变量分配在栈区，函数运行结束后，形参和局部变量去栈（自动释放）。栈内存分配运算内置与处理器的指令集中，效率高但是分配的内存空间有限。
堆区（heap）：指哪些由程序员手动分配释放的储存区，如果程序员不释放这块内存，内存将一直被占用，直到程序运行结束由系统自动收回，c语言中使用malloc，free申请和释放空间。
静态储存区（static）：全局变量和静态变量的储存是放在一块的，其中初始化的全局变量和静态变量在一个区域，这块空间当程序运行结束后由系统释放。
常量储存区（const）：常量字符串就是储存在这里的，如“ABC”字符串就储存在常量区，储存在常量区的只读不可写。const修饰的全局变量也储存在常量区，const修饰的局部变量依然在栈上。
程序代码区：存放函数体的二进制代码。
例子程序
//main.cpp int a = 0; //全局初始化区 int a = 0; //全局初始化区 char *p1; //全局未初始化区 main() { int b; //栈 char s[] = &#34;abc&#34;; //栈 char *p2; //栈 char *p3 = &#34;123456&#34;; //123456\0在常量区，p3在栈上。 static int c = 0; //全局（静态）初始化区 p1 = (char *)malloc(10); p2 = (char *)malloc(20); //分配得来得10和20字节的区域就在堆区。 strcpy(p1, &#34;123456&#34;); //123456\0放在常量区，编译器可能会将它与p3所指向的&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/22428395e0ef03ce79c28508a77ee7d4/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-10-06T22:36:57+08:00" />
<meta property="article:modified_time" content="2023-10-06T22:36:57+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Ubuntu、stm32下的C程序中堆、栈、全局、局部等变量的分配地址</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_0"></a>一、变量介绍</h3> 
<p>1、全局常量：在程序中定义的全局范围内不可改变的常量，它们的值在整个程序执行过程中都保持不变。<br> 2、全局变量：在程序中定义的全局范围内可改变的变量，它们可以在程序的任何位置被访问和修改。<br> 3、局部变量：在函数或代码块中定义的变量，它们的作用域仅限于函数或代码块内部，在外部无法访问。<br> 4、静态变量：在函数内或代码块内用 static 关键字修饰的变量，它们的生存期会延长到整个程序的执行过程中，但作用域仍然限于所在的函数或代码块内部。<br> 5、堆：动态分配内存的一种方式，通过调用 malloc 或 new 等函数在运行时分配的内存空间。它的生命周期由程序员手动管理，需要显式释放。<br> 6、栈：存储函数调用和局部变量的一块内存空间，它的管理由编译器自动完成，具有先进后出的特点。</p> 
<h3><a id="_7"></a>二、变量的内存分配</h3> 
<p>栈区（stack）：指那些由编译器在需要的时候分配，不需要时自动清除的变量所在的储存区，如函数执行时，函数的形参以及函数内的局部变量分配在栈区，函数运行结束后，形参和局部变量去栈（自动释放）。栈内存分配运算内置与处理器的指令集中，效率高但是分配的内存空间有限。</p> 
<p>堆区（heap）：指哪些由程序员手动分配释放的储存区，如果程序员不释放这块内存，内存将一直被占用，直到程序运行结束由系统自动收回，c语言中使用malloc，free申请和释放空间。</p> 
<p>静态储存区（static）：全局变量和静态变量的储存是放在一块的，其中初始化的全局变量和静态变量在一个区域，这块空间当程序运行结束后由系统释放。</p> 
<p>常量储存区（const）：常量字符串就是储存在这里的，如“ABC”字符串就储存在常量区，储存在常量区的只读不可写。const修饰的全局变量也储存在常量区，const修饰的局部变量依然在栈上。</p> 
<p>程序代码区：存放函数体的二进制代码。<br> 例子程序</p> 
<pre><code class="prism language-c"><span class="token comment">//main.cpp</span>
<span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//全局初始化区</span>
<span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//全局初始化区</span>
<span class="token keyword">char</span> <span class="token operator">*</span>p1<span class="token punctuation">;</span> <span class="token comment">//全局未初始化区</span>
<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> b<span class="token punctuation">;</span> <span class="token comment">//栈</span>
    <span class="token keyword">char</span> s<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"abc"</span><span class="token punctuation">;</span> <span class="token comment">//栈</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>p2<span class="token punctuation">;</span> <span class="token comment">//栈</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>p3 <span class="token operator">=</span> <span class="token string">"123456"</span><span class="token punctuation">;</span> <span class="token comment">//123456\0在常量区，p3在栈上。</span>
    <span class="token keyword">static</span> <span class="token keyword">int</span> c <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//全局（静态）初始化区</span>
    p1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    p2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//分配得来得10和20字节的区域就在堆区。</span>
    <span class="token function">strcpy</span><span class="token punctuation">(</span>p1<span class="token punctuation">,</span> <span class="token string">"123456"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//123456\0放在常量区，编译器可能会将它与p3所指向的"123456"优化成一个地方。</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="RAMROMFlash_Memory_36"></a>RAM和ROM,Flash Memory的物理特性</h4> 
<p>RAM又称随机存取器，存储的内容可通过指令随机读写访问。RAM中的存储的数据在掉电是会丢失，因而只能在开机运行时存储数据。其中RAM又可以分为两种，一种时Dynamic RAM(DRAM 动态随机存储器)，另一种是Static RAM(SRAM,静态随机存储器)。</p> 
<p>ROM又称只读存储器，只能从里面读出数据而不能任意写入数据。具有掉电后数据可保持不变的优点。因此常用存放一次性写入的程序和数据，比如主板的BIOS程序就是ROM存储器。</p> 
<p>Flash Memory 由于ROM具有不易更改的特性，后面就发展了Flash Memory。Flash Memory不仅具有ROM掉电不丢失数据的特点，又可以在需要的时候对数据进行更改，不过价格比ROM高。</p> 
<p>不同数据的存放位置：<br> 由前面的分析我们知道，代码区和常量区的内容是不允许被修改的，ROM（STM32就是Flash Memory）也是不允许被修改的，所以代码区和常量区的内容编译后存储在ROM中。<br> 而栈、堆、全局区(.bss段、.data段)都是存放在RAM中。</p> 
<h3><a id="_46"></a>三、验证</h3> 
<p>1、Ubuntu中验证<br> 代码</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token comment">//定义全局变量</span>
<span class="token keyword">int</span> init_global_a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> uninit_global_a<span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token keyword">int</span> inits_global_b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token keyword">int</span> uninits_global_b<span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">output</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span> <span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>   
	<span class="token comment">//定义局部变量</span>
	<span class="token keyword">int</span> a<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span><span class="token comment">//栈</span>
	<span class="token keyword">static</span> <span class="token keyword">int</span> inits_local_c<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> uninits_local_c<span class="token punctuation">;</span>
    <span class="token keyword">int</span> init_local_d <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//栈</span>
    <span class="token function">output</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>p<span class="token punctuation">;</span><span class="token comment">//栈</span>
    <span class="token keyword">char</span> str<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"yaoyao"</span><span class="token punctuation">;</span><span class="token comment">//栈</span>
    <span class="token comment">//定义常量字符串</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>var1 <span class="token operator">=</span> <span class="token string">"1234567890"</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>var2 <span class="token operator">=</span> <span class="token string">"abcdefghij"</span><span class="token punctuation">;</span>
    <span class="token comment">//动态分配——堆区</span>
    <span class="token keyword">int</span> <span class="token operator">*</span>p1<span class="token operator">=</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> <span class="token operator">*</span>p2<span class="token operator">=</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//释放</span>
    <span class="token function">free</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">free</span><span class="token punctuation">(</span>p2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"栈区-变量地址\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"                a：%p\n"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"                init_local_d：%p\n"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>init_local_d<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"                p：%p\n"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"              str：%p\n"</span><span class="token punctuation">,</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n堆区-动态申请地址\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"                   %p\n"</span><span class="token punctuation">,</span> p1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"                   %p\n"</span><span class="token punctuation">,</span> p2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n全局区-全局变量和静态变量\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n.bss段\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"全局外部无初值 uninit_global_a：%p\n"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>uninit_global_a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"静态外部无初值 uninits_global_b：%p\n"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>uninits_global_b<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"静态内部无初值 uninits_local_c：%p\n"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>uninits_local_c<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n.data段\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"全局外部有初值 init_global_a：%p\n"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>init_global_a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"静态外部有初值 inits_global_b：%p\n"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>inits_global_b<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"静态内部有初值 inits_local_c：%p\n"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>inits_local_c<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n文字常量区\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"文字常量地址     ：%p\n"</span><span class="token punctuation">,</span>var1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"文字常量地址     ：%p\n"</span><span class="token punctuation">,</span>var2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n代码区\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"程序区地址       ：%p\n"</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>main<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"函数地址         ：%p\n"</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>output<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>使用gcc编译后，得<br> <img src="https://images2.imgbox.com/ee/98/OToH4PWv_o.png" alt="在这里插入图片描述"><br> 由此可知，Ubuntu下栈区和堆区的地址值都是从上到下增长的。<br> 2、keil中验证</p> 
<p>代码：</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"sys.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"usart.h"</span>		</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"delay.h"</span>	</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token comment">//定义全局变量</span>
<span class="token keyword">int</span> init_global_a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> uninit_global_a<span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token keyword">int</span> inits_global_b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token keyword">int</span> uninits_global_b<span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">output</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>				 
	u16 t<span class="token punctuation">;</span> u16 len<span class="token punctuation">;</span> u16 times<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token function">Stm32_Clock_Init</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//??????</span>
	<span class="token function">delay_init</span><span class="token punctuation">(</span><span class="token number">72</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	  		<span class="token comment">//?????</span>
	<span class="token function">uart_init</span><span class="token punctuation">(</span><span class="token number">72</span><span class="token punctuation">,</span><span class="token number">115200</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 	<span class="token comment">//??????115200</span>
  	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token comment">//定义局部变量</span>
	<span class="token keyword">int</span> a<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>
	<span class="token keyword">static</span> <span class="token keyword">int</span> inits_local_c<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> uninits_local_c<span class="token punctuation">;</span>
    <span class="token keyword">int</span> init_local_d <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token function">output</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>p<span class="token punctuation">;</span>
    <span class="token keyword">char</span> str<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"yaoyao"</span><span class="token punctuation">;</span>
    <span class="token comment">//定义常量字符串</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>var1 <span class="token operator">=</span> <span class="token string">"1234567890"</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>var2 <span class="token operator">=</span> <span class="token string">"abcdefghij"</span><span class="token punctuation">;</span>
    <span class="token comment">//动态分配</span>
    <span class="token keyword">int</span> <span class="token operator">*</span>p1<span class="token operator">=</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> <span class="token operator">*</span>p2<span class="token operator">=</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//释放</span>
    <span class="token function">free</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">free</span><span class="token punctuation">(</span>p2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"栈区-变量地址\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"                a：%p\n"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"                init_local_d：%p\n"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>init_local_d<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"                p：%p\n"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"              str：%p\n"</span><span class="token punctuation">,</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n堆区-动态申请地址\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"                   %p\n"</span><span class="token punctuation">,</span> p1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"                   %p\n"</span><span class="token punctuation">,</span> p2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n全局区-全局变量和静态变量\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n.bss段\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"全局外部无初值 uninit_global_a：%p\n"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>uninit_global_a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"静态外部无初值 uninits_global_b：%p\n"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>uninits_global_b<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"静态内部无初值 uninits_local_c：%p\n"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>uninits_local_c<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n.data段\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"全局外部有初值 init_global_a：%p\n"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>init_global_a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"静态外部有初值 inits_global_b：%p\n"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>inits_global_b<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"静态内部有初值 inits_local_c：%p\n"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>inits_local_c<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n文字常量区\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"文字常量地址     ：%p\n"</span><span class="token punctuation">,</span>var1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"文字常量地址     ：%p\n"</span><span class="token punctuation">,</span>var2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n代码区\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"程序区地址       ：%p\n"</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>main<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"函数地址         ：%p\n"</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>output<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>	 
<span class="token punctuation">}</span> 
</code></pre> 
<p>内存配置<br> <img src="https://images2.imgbox.com/fe/8e/eQhVrHaA_o.png" alt="在这里插入图片描述"><br> 1、默认分配的ROM区域是0x8000000开始，大小是0x80000的一片区域，那么这篇区域是只读区域，不可修改，也就是存放的代码区和常量区</p> 
<p>2、默认分配的RAM区域是0x20000000开始，大小是0x10000的一片区域，这篇区域是可读写区域，存放的是静态区、栈区和堆区。<br> <img src="https://images2.imgbox.com/6a/de/fQz5aP3o_o.png" alt="在这里插入图片描述"></p> 
<p>点击魔法棒，点击c/c++，勾选c99 mode<br> <img src="https://images2.imgbox.com/d4/72/6xLHyrnT_o.png" alt="在这里插入图片描述"></p> 
<p>点击target，勾选Use MicroLib<br> <img src="https://images2.imgbox.com/89/08/6oGlVfKB_o.png" alt="在这里插入图片描述"><br> 编译无误后将hex文件烧录进STM32，打开串口调试助手，可以看到以下结果。<br> <img src="https://images2.imgbox.com/ed/2d/pUsssZD6_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/3d/99/enpipteQ_o.png" alt="在这里插入图片描述"></p> 
<p>3、对比分析<br> 一般而言，程序内变量在堆栈上的分配，栈是由高地址到低地址，堆是由低地址到高地址。</p> 
<p>在Ubuntu下，栈区的地址存储是向上增长，堆区的地址存储也是向上增长；<br> 在STM32下，栈区的地址存储是向下增长，堆区的地址存储却是向上增长。</p> 
<p>可是为什么Ubuntu下，栈区的地址值也是增长的？<br> 查找了很多资料发现，大部分提到linux的栈，地址都是向下生长的，不过，也有以下解释：</p> 
<p>第一种解释：<br> 栈向低地址扩展(即”向下生长”)，是连续的内存区域；堆向高地址扩展(即”向上生长”)，是不连续的内存区域。</p> 
<p>这是由于系统用链表来存储空闲内存地址，自然不连续，而链表从低地址向高地址遍历。</p> 
<p>第二种解释：（暂时放到下面，还需要花时间理解分析这一点）</p> 
<p>进程地址空间的分布取决于操作系统，栈向什么方向增长取决于操作系统与CPU的组合。<br> 这里说的“栈”是函数调用栈，是以“栈帧”（stack frame）为单位的。<br> 每一次函数调用会在栈上分配一个新的栈帧，在这次函数调用结束时释放其空间。<br> 被调用函数（callee）的栈帧相对调用函数（caller）的栈帧的位置反映了栈的增长方向：如果被调用函数的栈帧比调用函数的在更低的地址，那么栈就是向下增长；反之则是向上增长。</p> 
<p>在一个栈帧内，局部变量是如何分布到栈帧里的（所谓栈帧布局，stack frame layout），这完全是编译器的自由。</p> 
<p>在简化的32位Linux/x86进程地址空间模型里，（主线程的）栈空间确实比堆空间的地址要高——它已经占据了用户态地址空间的最高可分配的区域，并且向下（向低地址）增长。</p> 
<h3><a id="_226"></a>参考资料</h3> 
<p>1、https://blog.csdn.net/yingms/article/details/53188974<br> 2、https://blog.csdn.net/cai88453626/article/details/130273950<br> 3、https://blog.csdn.net/qq_46467126/article/details/121875496<br> 4、https://blog.csdn.net/xwmrqqq/article/details/110149859</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/269c2ae59a1cd8776b9f9c151956596c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">组播路由协议——PIM基本概念</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e2dfb9bf6b875954784b2ebbb38ea00c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Selenium基础</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>