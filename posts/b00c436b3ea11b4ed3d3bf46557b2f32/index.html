<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Linux Docker容器 镜像的详解与创建 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Linux Docker容器 镜像的详解与创建" />
<meta property="og:description" content="一、什么是docker 镜像 就是把业务代码，可运行环境进行整体的打包
二、如何创建docker镜像： 现在docker官方共有仓库里面有大量的镜像，所以最基础的镜像，我们可以在公有仓库直接拉取，因为这些镜像都是原厂维护，可以得到即使的更新和修护。
Dockerfile： 我们如果想去定制这些镜像，我们可以去编写Dockerfile，然后重新bulid，最后把它打包成一个镜像，这种方式是最为推荐的方式包括我们以后去企业当中去实践应用的时候也是推荐这种方式。
Commit : 当然还有另外一种方式，就是通过镜像启动一个容器，然后进行操作，最终通过commit这个命令commit一个镜像，但是不推荐这种方式，虽然说通过commit这个命令像是操作虚拟机的模式，但是容器毕竟是容器，它不是虚拟机，最好还是使用dockerfile创建。
三、docker镜像的分层结构 四、Docker 镜像使用 当运行容器时，使用的镜像如果在本地中不存在，docker 就会自动从 docker 镜像仓库中下载，默认是从 Docker Hub 公共镜像源下载。
下面我们来学习：
1、管理和使用本地 Docker 主机镜像 2、创建镜像 12 列出镜像列表 我们可以使用 docker images 来列出本地主机上的镜像。
[root@server1 ~]# docker images REPOSITORY TAG IMAGE ID CREATED SIZE ubuntu latest 4e5021d210f6 2 weeks ago 64.2MB 123 各个选项说明:
REPOSITORY：表示镜像的仓库源 TAG：镜像的标签 IMAGE ID：镜像ID CREATED：镜像创建时间 SIZE：镜像大小 123456789 同一仓库源可以有多个 TAG，代表这个仓库源的不同个版本，如 ubuntu 仓库源里，有 15.10、14.04 等多个不同的版本，我们使用 REPOSITORY:TAG 来定义不同的镜像。
所以，我们如果要使用版本为15.10的ubuntu系统镜像来运行容器时，命令如下：
docker run -t -i ubuntu:15." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/b00c436b3ea11b4ed3d3bf46557b2f32/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-08-18T22:06:43+08:00" />
<meta property="article:modified_time" content="2020-08-18T22:06:43+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Linux Docker容器 镜像的详解与创建</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="docker__0"></a>一、什么是docker 镜像</h2> 
<p>就是把业务代码，可运行环境进行整体的打包</p> 
<h2><a id="docker_5"></a>二、如何创建docker镜像：</h2> 
<p>现在docker官方共有仓库里面有大量的镜像，所以最基础的镜像，我们可以在公有仓库直接拉取，因为这些镜像都是原厂维护，可以得到即使的更新和修护。</p> 
<h3><a id="Dockerfile_9"></a>Dockerfile：</h3> 
<p>我们如果想去定制这些镜像，我们可以去编写Dockerfile，然后重新bulid，最后把它打包成一个镜像，这种方式是最为推荐的方式包括我们以后去企业当中去实践应用的时候也是推荐这种方式。<br> <img src="https://images2.imgbox.com/71/09/saO3EN8N_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="Commit__13"></a>Commit :</h3> 
<p>当然还有另外一种方式，就是通过镜像启动一个容器，然后进行操作，最终通过commit这个命令commit一个镜像，但是不推荐这种方式，虽然说通过commit这个命令像是操作虚拟机的模式，但是容器毕竟是容器，它不是虚拟机，最好还是使用dockerfile创建。</p> 
<h2><a id="docker_17"></a>三、docker镜像的分层结构</h2> 
<p><img src="https://images2.imgbox.com/1b/b5/2p9q6zVs_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/2c/da/pCof0G0T_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="Docker__0"></a>四、Docker 镜像使用</h2> 
<p>当运行容器时，使用的镜像如果在本地中不存在，docker 就会自动从 docker 镜像仓库中下载，默认是从 Docker Hub 公共镜像源下载。</p> 
<p>下面我们来学习：</p> 
<pre class="prettyprint"><code class="has-numbering">1、管理和使用本地 Docker 主机镜像
2、创建镜像
</code>
 
 <div class="hljs-button {2}"></div>
 
 </pre><ul class="pre-numbering"><li>1</li><li>2</li></ul> 
<h3><a id="_9"></a>列出镜像列表</h3> 
<p>我们可以使用 <code>docker images</code> 来列出本地主机上的镜像。</p> 
<pre class="prettyprint"><code class="prism language-handlebars has-numbering"><span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@server1 ~</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">docker</span> <span class="token variable">images</span>
<span class="token variable">REPOSITORY</span>                     <span class="token variable">TAG</span>                 <span class="token variable">IMAGE</span> <span class="token variable">ID</span>            <span class="token variable">CREATED</span>             <span class="token variable">SIZE</span>
<span class="token variable">ubuntu</span>                         <span class="token variable">latest</span>              <span class="token number">4e5021</span><span class="token variable">d210f6</span>        <span class="token number">2</span> <span class="token variable">weeks</span> <span class="token variable">ago</span>         <span class="token number">64.2</span><span class="token variable">MB</span>
</code>
 
 <div class="hljs-button {2}"></div>
 
 </pre><ul class="pre-numbering"><li>1</li><li>2</li><li>3</li></ul> 
<p>各个选项说明:</p> 
<pre class="prettyprint"><code class="has-numbering">REPOSITORY：表示镜像的仓库源
TAG：镜像的标签
IMAGE ID：镜像ID
CREATED：镜像创建时间
SIZE：镜像大小
</code>
 
 <div class="hljs-button {2}"></div>
 
 </pre><ul class="pre-numbering"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><li>7</li><li>8</li><li>9</li></ul> 
<p>同一仓库源可以有多个 TAG，代表这个仓库源的不同个版本，如 ubuntu 仓库源里，有 15.10、14.04 等多个不同的版本，我们使用 REPOSITORY:TAG 来定义不同的镜像。</p> 
<p>所以，我们如果要使用版本为15.10的ubuntu系统镜像来运行容器时，命令如下：</p> 
<pre class="prettyprint"><code class="prism language-handlebars has-numbering"><span class="token variable">docker</span> <span class="token variable">run</span> <span class="token variable">-t</span> <span class="token variable">-i</span> <span class="token variable">ubuntu:</span><span class="token number">15.10</span> <span class="token block keyword">/bin/bash</span> 
<span class="token variable">root</span><span class="token punctuation">@</span><span class="token variable">d77ccb2e5cca:</span><span class="token punctuation">/</span><span class="token punctuation">#</span>
</code>
 
 <div class="hljs-button {2}"></div>
 
 </pre><ul class="pre-numbering"><li>1</li><li>2</li></ul> 
<p>参数说明：</p> 
<pre class="prettyprint"><code class="has-numbering">-i: 交互式操作。
-t: 终端。
ubuntu:15.10: 这是指用 ubuntu 15.10 版本镜像为基础来启动容器。
/bin/bash：放在镜像名后的是命令，这里我们希望有个交互式 Shell，因此用的是 /bin/bash。
</code>
 
 <div class="hljs-button {2}"></div>
 
 </pre><ul class="pre-numbering"><li>1</li><li>2</li><li>3</li><li>4</li></ul> 
<p>如果要使用版本为 14.04 的 ubuntu 系统镜像来运行容器时，命令如下：</p> 
<pre class="prettyprint"><code class="prism language-handlebars has-numbering"> <span class="token variable">docker</span> <span class="token variable">run</span> <span class="token variable">-t</span> <span class="token variable">-i</span> <span class="token variable">ubuntu:</span><span class="token number">14.04</span> <span class="token block keyword">/bin/bash</span> 
<span class="token variable">root</span><span class="token punctuation">@</span><span class="token number">39e968165990</span><span class="token variable">:</span><span class="token punctuation">/</span><span class="token punctuation">#</span> 
</code>
 
 <div class="hljs-button {2}"></div>
 
 </pre><ul class="pre-numbering"><li>1</li><li>2</li></ul> 
<p>如果你不指定一个镜像的版本标签，例如你只使用 ubuntu，docker 将默认使用 ubuntu:latest 镜像。</p> 
<h3><a id="_56"></a>获取一个新的镜像</h3> 
<p>当我们在本地主机上使用一个不存在的镜像时 Docker 就会自动下载这个镜像。如果我们想预先下载这个镜像，我们可以使用 docker pull 命令来下载它。</p> 
<pre class="prettyprint"><code class="prism language-handlebars has-numbering"><span class="token variable">docker</span> <span class="token variable">pull</span> <span class="token variable">ubuntu:</span><span class="token number">13.10</span>
</code>
 
 <div class="hljs-button {2}"></div>
 
 </pre><ul class="pre-numbering"><li>1</li></ul> 
<p>下载完成后，我们可以直接使用这个镜像来运行容器。<br> 查找镜像</p> 
<p>我们可以从 Docker Hub 网站来搜索镜像，Docker Hub 网址为： <a href="https://hub.docker.com/" rel="nofollow">https://hub.docker.com/</a></p> 
<p>我们也可以使用 docker search 命令来搜索镜像。比如我们需要一个 httpd 的镜像来作为我们的 web 服务。我们可以通过 docker search 命令搜索 httpd 来寻找适合我们的镜像。</p> 
<h3><a id="docker_search_httpd_71"></a>docker search httpd</h3> 
<p><img src="https://images2.imgbox.com/4b/9f/CIkXaulF_o.png" alt="在这里插入图片描述"></p> 
<pre class="prettyprint"><code class="prism language-handlebars has-numbering"><span class="token variable">NAME:</span> <span class="token variable">镜像仓库源的名称</span><span class="token punctuation">,</span><span class="token variable">一般直接以服务名称命名的镜像都是官方发布的镜像</span>
<span class="token variable">DESCRIPTION:</span> <span class="token variable">镜像的描述</span>
<span class="token variable">OFFICIAL:</span> <span class="token variable">是否</span> <span class="token variable">docker</span> <span class="token variable">官方发布</span>
<span class="token variable">stars:</span> <span class="token variable">类似</span> <span class="token variable">Github</span> <span class="token variable">里面的</span> <span class="token variable">star，表示点赞、喜欢的意思。</span>
<span class="token variable">AUTOMATED:</span> <span class="token variable">自动构建。</span>
</code>
 
 <div class="hljs-button {2}"></div>
 
 </pre><ul class="pre-numbering"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><li>7</li><li>8</li><li>9</li></ul> 
<h3><a id="_87"></a>拖取镜像</h3> 
<p>我们决定使用上图中的 httpd 官方版本的镜像，使用命令 docker pull 来下载镜像。</p> 
<pre class="prettyprint"><code class="prism language-handlebars has-numbering"><span class="token variable">docker</span> <span class="token variable">pull</span> <span class="token variable">httpd</span>
</code>
 
 <div class="hljs-button {2}"></div>
 
 </pre><ul class="pre-numbering"><li>1</li></ul> 
<p>下载完成后，我们就可以使用这个镜像了。</p> 
<pre class="prettyprint"><code class="prism language-handlebars has-numbering"> <span class="token variable">docker</span> <span class="token variable">run</span> <span class="token variable">httpd</span>
</code>
 
 <div class="hljs-button {2}"></div>
 
 </pre><ul class="pre-numbering"><li>1</li></ul> 
<h3><a id="_102"></a>删除镜像</h3> 
<p>镜像删除使用 docker rmi 命令，比如我们删除 hello-world 镜像：</p> 
<pre class="prettyprint"><code class="prism language-handlebars has-numbering"> <span class="token variable">docker</span> <span class="token variable">rmi</span> <span class="token variable">hello-world</span>
</code>
 
 <div class="hljs-button {2}"></div>
 
 </pre><ul class="pre-numbering"><li>1</li></ul> 
<h3><a id="_109"></a>查看镜像的构造历史</h3> 
<pre class="prettyprint"><code class="prism language-handlebars has-numbering"><span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@server1 ~</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">docker</span> <span class="token variable">history</span> <span class="token variable">nginx:latest</span> 
</code>
 
 <div class="hljs-button {2}"></div>
 
 </pre><ul class="pre-numbering"><li>1</li></ul> 
<p><img src="https://images2.imgbox.com/e7/7e/i0lkQf1z_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_115"></a>五、创建镜像方式</h2> 
<p>当我们从 docker 镜像仓库中下载的镜像不能满足我们的需求时，我们可以通过以下两种方式对镜像进行更改。</p> 
<pre class="prettyprint"><code class="has-numbering">1、commit：从已经创建的容器中更新镜像，并且提交这个镜像
2、Dockerfile：使用 Dockerfile 指令来创建一个新的镜像
</code>
 
 <div class="hljs-button {2}"></div>
 
 </pre><ul class="pre-numbering"><li>1</li><li>2</li></ul> 
<h2><a id="docker_commit_122"></a>六、docker commit创建镜像</h2> 
<p><img src="https://images2.imgbox.com/26/98/KXNHu6a9_o.png" alt="在这里插入图片描述"><br> 创建容器，以ubuntu为例<br> （1）拉取镜像，创建容器并运行</p> 
<pre class="prettyprint"><code class="prism language-handlebars has-numbering"><span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@server1 ~</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">docker</span> <span class="token variable">pull</span> <span class="token variable">ubuntu</span><span class="token punctuation">.</span><span class="token variable">tar</span>  <span class="token punctuation">#</span><span class="token punctuation">#</span><span class="token variable">添加镜像</span>
<span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@server1 ~</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">docker</span> <span class="token variable">images</span>  <span class="token punctuation">#</span><span class="token punctuation">#</span><span class="token variable">查看拉取的镜像</span>
<span class="token variable">REPOSITORY</span>          <span class="token variable">TAG</span>                 <span class="token variable">IMAGE</span> <span class="token variable">ID</span>            <span class="token variable">CREATED</span>             <span class="token variable">SIZE</span>
<span class="token variable">game2048</span>            <span class="token variable">latest</span>              <span class="token number">19299002</span><span class="token variable">fdbe</span>        <span class="token number">2</span> <span class="token variable">years</span> <span class="token variable">ago</span>         <span class="token number">55.5</span><span class="token variable">MB</span>
<span class="token variable">ubuntu</span>              <span class="token variable">latest</span>              <span class="token number">07</span><span class="token variable">c86167cdc4</span>        <span class="token number">3</span> <span class="token variable">years</span> <span class="token variable">ago</span>         <span class="token number">188</span><span class="token variable">MB</span>
<span class="token variable">rhel7</span>               <span class="token variable">latest</span>              <span class="token number">0</span><span class="token variable">a3eb3fde7fd</span>        <span class="token number">5</span> <span class="token variable">years</span> <span class="token variable">ago</span>      
<span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@server1 ~</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">docker</span> <span class="token variable">run</span> <span class="token variable">-it</span> <span class="token variable">--name</span> <span class="token variable">vm2</span> <span class="token variable">ubuntu</span> <span class="token variable">bash</span>      <span class="token punctuation">#</span><span class="token punctuation">#</span><span class="token variable">创建并运行容器</span> <span class="token variable">-it:以交互式方式打开</span>
<span class="token variable">root</span><span class="token punctuation">@</span><span class="token variable">a4aca5fcecc3:</span><span class="token punctuation">/</span><span class="token punctuation">#</span> <span class="token variable">ls</span>
<span class="token variable">bin</span>   <span class="token variable">dev</span>  <span class="token variable">home</span>  <span class="token variable">lib64</span>  <span class="token variable">mnt</span>  <span class="token variable">proc</span>  <span class="token variable">run</span>   <span class="token variable">srv</span>  <span class="token variable">tmp</span>  <span class="token variable">var</span>
<span class="token variable">boot</span>  <span class="token variable">etc</span>  <span class="token variable">lib</span>   <span class="token variable">media</span>  <span class="token variable">opt</span>  <span class="token variable">root</span>  <span class="token variable">sbin</span>  <span class="token variable">sys</span>  <span class="token variable">usr</span>
<span class="token variable">root</span><span class="token punctuation">@</span><span class="token variable">a4aca5fcecc3:</span><span class="token punctuation">/</span><span class="token punctuation">#</span> <span class="token variable">uname</span> <span class="token variable">-r</span>
<span class="token number">3.10</span><span class="token number">.0</span><span class="token variable">-</span><span class="token number">862.</span><span class="token variable">el7</span><span class="token punctuation">.</span><span class="token variable">x86_64</span>       <span class="token punctuation">#</span><span class="token punctuation">#</span><span class="token variable">与宿主机内核版本一致</span>
<span class="token variable">root</span><span class="token punctuation">@</span><span class="token variable">a4aca5fcecc3:</span><span class="token punctuation">/</span><span class="token punctuation">#</span>     
<span class="token variable">root</span><span class="token punctuation">@</span><span class="token variable">a4aca5fcecc3:</span><span class="token punctuation">/</span><span class="token punctuation">#</span> <span class="token variable">touch</span> <span class="token variable">file</span><span class="token punctuation">{<!-- --></span><span class="token number">1.</span><span class="token number">.10</span><span class="token punctuation">}</span>
<span class="token variable">root</span><span class="token punctuation">@</span><span class="token variable">a4aca5fcecc3:</span><span class="token punctuation">/</span><span class="token punctuation">#</span> <span class="token variable">ls</span>
<span class="token variable">bin</span>   <span class="token variable">etc</span>     <span class="token variable">file2</span>  <span class="token variable">file5</span>  <span class="token variable">file8</span>  <span class="token variable">lib</span>    <span class="token variable">mnt</span>   <span class="token variable">root</span>  <span class="token variable">srv</span>  <span class="token variable">usr</span>
<span class="token variable">boot</span>  <span class="token variable">file1</span>   <span class="token variable">file3</span>  <span class="token variable">file6</span>  <span class="token variable">file9</span>  <span class="token variable">lib64</span>  <span class="token variable">opt</span>   <span class="token variable">run</span>   <span class="token variable">sys</span>  <span class="token variable">var</span>
<span class="token variable">dev</span>   <span class="token variable">file10</span>  <span class="token variable">file4</span>  <span class="token variable">file7</span>  <span class="token variable">home</span>   <span class="token variable">media</span>  <span class="token variable">proc</span>  <span class="token variable">sbin</span>  <span class="token variable">tmp</span>
<span class="token variable">root</span><span class="token punctuation">@</span><span class="token variable">a4aca5fcecc3:</span><span class="token punctuation">/</span><span class="token punctuation">#</span> <span class="token variable">exit</span>
<span class="token variable">exit</span>
<span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@server1 ~</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">docker</span> <span class="token variable">rm</span> <span class="token variable">vm2</span>     <span class="token punctuation">#</span><span class="token punctuation">#</span><span class="token variable">删除此容器，此时容器内创建的文件均没有保存</span>
<span class="token variable">vm2</span>
</code>
 
 <div class="hljs-button {2}"></div>
 
 </pre><ul class="pre-numbering"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><li>7</li><li>8</li><li>9</li><li>10</li><li>11</li><li>12</li><li>13</li><li>14</li><li>15</li><li>16</li><li>17</li><li>18</li><li>19</li><li>20</li><li>21</li><li>22</li></ul> 
<p>删除容器vm2，重新用ubuntu镜像创建并运行容器时，之前创建的文件消失，因为上次的操作全部写在容器层，镜像层的内容只读。当上次的容器释放之后，写在容器层的内容也会随之消失。</p> 
<p>（2）使用docker commit保存修改后的镜像为新镜像<br> 先修改镜像</p> 
<pre class="prettyprint"><code class="prism language-handlebars has-numbering"><span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@server1 ~</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">docker</span> <span class="token variable">run</span> <span class="token variable">-it</span> <span class="token variable">--name</span> <span class="token variable">vm2</span> <span class="token variable">ubuntu</span> <span class="token variable">bash</span>
<span class="token variable">root</span><span class="token punctuation">@</span><span class="token number">8e0</span><span class="token variable">d11ca1b95:</span><span class="token punctuation">/</span><span class="token punctuation">#</span> <span class="token variable">ls</span>
<span class="token variable">bin</span>   <span class="token variable">dev</span>  <span class="token variable">home</span>  <span class="token variable">lib64</span>  <span class="token variable">mnt</span>  <span class="token variable">proc</span>  <span class="token variable">run</span>   <span class="token variable">srv</span>  <span class="token variable">tmp</span>  <span class="token variable">var</span>
<span class="token variable">boot</span>  <span class="token variable">etc</span>  <span class="token variable">lib</span>   <span class="token variable">media</span>  <span class="token variable">opt</span>  <span class="token variable">root</span>  <span class="token variable">sbin</span>  <span class="token variable">sys</span>  <span class="token variable">usr</span>
<span class="token variable">root</span><span class="token punctuation">@</span><span class="token number">8e0</span><span class="token variable">d11ca1b95:</span><span class="token punctuation">/</span><span class="token punctuation">#</span> <span class="token variable">touch</span> <span class="token variable">file</span><span class="token punctuation">{<!-- --></span><span class="token number">1.</span><span class="token number">.10</span><span class="token punctuation">}</span>
<span class="token variable">root</span><span class="token punctuation">@</span><span class="token number">8e0</span><span class="token variable">d11ca1b95:</span><span class="token punctuation">/</span><span class="token punctuation">#</span> <span class="token variable">ls</span>
<span class="token variable">bin</span>   <span class="token variable">etc</span>     <span class="token variable">file2</span>  <span class="token variable">file5</span>  <span class="token variable">file8</span>  <span class="token variable">lib</span>    <span class="token variable">mnt</span>   <span class="token variable">root</span>  <span class="token variable">srv</span>  <span class="token variable">usr</span>
<span class="token variable">boot</span>  <span class="token variable">file1</span>   <span class="token variable">file3</span>  <span class="token variable">file6</span>  <span class="token variable">file9</span>  <span class="token variable">lib64</span>  <span class="token variable">opt</span>   <span class="token variable">run</span>   <span class="token variable">sys</span>  <span class="token variable">var</span>
<span class="token variable">dev</span>   <span class="token variable">file10</span>  <span class="token variable">file4</span>  <span class="token variable">file7</span>  <span class="token variable">home</span>   <span class="token variable">media</span>  <span class="token variable">proc</span>  <span class="token variable">sbin</span>  <span class="token variable">tmp</span>
<span class="token variable">root</span><span class="token punctuation">@</span><span class="token number">8e0</span><span class="token variable">d11ca1b95:</span><span class="token punctuation">/</span><span class="token punctuation">#</span> <span class="token variable">exit</span>
<span class="token variable">exit</span>
</code>
 
 <div class="hljs-button {2}"></div>
 
 </pre><ul class="pre-numbering"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><li>7</li><li>8</li><li>9</li><li>10</li><li>11</li></ul> 
<p>使用docker commit保存修改后的镜像为新镜像</p> 
<pre class="prettyprint"><code class="prism language-handlebars has-numbering"><span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@server1 ~</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">docker</span> <span class="token variable">commit</span> <span class="token variable">vm2</span> <span class="token variable">ubuntu:v</span>      <span class="token punctuation">#</span><span class="token punctuation">#</span><span class="token variable">将此容器重新打包为一个镜像</span>
<span class="token variable">sha256:</span><span class="token number">593</span><span class="token variable">a662c6eedf8afc483f305ff9369ee9c8bddd8c71fca0718178d2895d1ea0d</span>
<span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@server1 ~</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">docker</span> <span class="token variable">images</span>
<span class="token variable">REPOSITORY</span>                      <span class="token variable">TAG</span>                        <span class="token variable">IMAGE</span> <span class="token variable">ID</span>            <span class="token variable">CREATED</span>             <span class="token variable">SIZE</span>
<span class="token variable">ubuntu</span>                          <span class="token variable">v</span>                          <span class="token number">593</span><span class="token variable">a662c6eed</span>        <span class="token number">14</span> <span class="token variable">seconds</span> <span class="token variable">ago</span>      <span class="token number">188</span><span class="token variable">MB</span>
<span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@server1 ~</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">docker</span> <span class="token variable">rm</span> <span class="token variable">vm2</span>      <span class="token punctuation">#</span><span class="token punctuation">#</span><span class="token variable">删除创建的容器</span>
<span class="token variable">vm2</span>
<span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@server1 ~</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">docker</span> <span class="token variable">run</span> <span class="token variable">-it</span> <span class="token variable">--name</span> <span class="token variable">vm2</span> <span class="token variable">ubuntu:v</span>      <span class="token punctuation">#</span><span class="token punctuation">#</span><span class="token variable">运行此容器</span>
<span class="token variable">root</span><span class="token punctuation">@</span><span class="token number">306</span><span class="token variable">c2ef91b50:</span><span class="token punctuation">/</span><span class="token punctuation">#</span> <span class="token variable">ls</span>      <span class="token punctuation">#</span><span class="token punctuation">#</span><span class="token variable">创建的文件依然存在</span>
<span class="token variable">bin</span>   <span class="token variable">etc</span>     <span class="token variable">file2</span>  <span class="token variable">file5</span>  <span class="token variable">file8</span>  <span class="token variable">lib</span>    <span class="token variable">mnt</span>   <span class="token variable">root</span>  <span class="token variable">srv</span>  <span class="token variable">usr</span>
<span class="token variable">boot</span>  <span class="token variable">file1</span>   <span class="token variable">file3</span>  <span class="token variable">file6</span>  <span class="token variable">file9</span>  <span class="token variable">lib64</span>  <span class="token variable">opt</span>   <span class="token variable">run</span>   <span class="token variable">sys</span>  <span class="token variable">var</span>
<span class="token variable">dev</span>   <span class="token variable">file10</span>  <span class="token variable">file4</span>  <span class="token variable">file7</span>  <span class="token variable">home</span>   <span class="token variable">media</span>  <span class="token variable">proc</span>  <span class="token variable">sbin</span>  <span class="token variable">tmp</span>
<span class="token variable">root</span><span class="token punctuation">@</span><span class="token number">306</span><span class="token variable">c2ef91b50:</span><span class="token punctuation">/</span><span class="token punctuation">#</span> <span class="token variable">exit</span>
<span class="token variable">exit</span>
</code>
 
 <div class="hljs-button {2}"></div>
 
 </pre><ul class="pre-numbering"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><li>7</li><li>8</li><li>9</li><li>10</li><li>11</li><li>12</li><li>13</li><li>14</li></ul> 
<p>使用镜像创建容器。容器就是在镜像层的最上方存在一个可写的容器层。将容器打包镜像，就是将该可写的容器层，变成一个只读的镜像层，和下层的所有镜像层一起作为新镜像的镜像层。</p> 
<p>（3）查看镜像的构造历史</p> 
<pre class="prettyprint"><code class="prism language-handlebars has-numbering"><span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@server1 ~</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">docker</span> <span class="token variable">history</span> <span class="token variable">ubuntu:v</span>
<span class="token variable">IMAGE</span>               <span class="token variable">CREATED</span>             <span class="token variable">CREATED</span> <span class="token variable">BY</span>                                      <span class="token variable">SIZE</span>                <span class="token variable">COMMENT</span>
<span class="token number">593</span><span class="token variable">a662c6eed</span>        <span class="token number">6</span> <span class="token variable">minutes</span> <span class="token variable">ago</span>       <span class="token punctuation">/</span><span class="token variable">bin</span><span class="token punctuation">/</span><span class="token variable">bash</span>                                       <span class="token number">29</span><span class="token variable">B</span>                 
<span class="token number">07</span><span class="token variable">c86167cdc4</span>        <span class="token number">3</span> <span class="token variable">years</span> <span class="token variable">ago</span>         <span class="token punctuation">/</span><span class="token variable">bin</span><span class="token punctuation">/</span><span class="token variable">sh</span> <span class="token variable">-c</span> <span class="token punctuation">#</span><span class="token punctuation">(</span><span class="token variable">nop</span><span class="token punctuation">)</span> <span class="token variable">CMD</span> <span class="token punctuation">[</span><span class="token string">"/bin/bash"</span><span class="token punctuation">]</span>             <span class="token number">0</span><span class="token variable">B</span>                  
<span class="token punctuation">&lt;</span><span class="token variable">missing</span><span class="token punctuation">&gt;</span>           <span class="token number">3</span> <span class="token variable">years</span> <span class="token variable">ago</span>         <span class="token punctuation">/</span><span class="token variable">bin</span><span class="token punctuation">/</span><span class="token variable">sh</span> <span class="token variable">-c</span> <span class="token variable">sed</span> <span class="token variable">-i</span> <span class="token punctuation">'</span><span class="token variable">s</span><span class="token punctuation">/</span><span class="token punctuation">^</span><span class="token punctuation">#</span><span class="token punctuation">\</span><span class="token variable">s</span><span class="token punctuation">*</span><span class="token punctuation">\</span><span class="token punctuation">(</span><span class="token variable">deb</span><span class="token punctuation">.</span><span class="token punctuation">*</span><span class="token variable">universe</span><span class="token punctuation">\</span><span class="token punctuation">)</span><span class="token variable">$…</span>   <span class="token number">1.9</span><span class="token variable">kB</span>               
<span class="token punctuation">&lt;</span><span class="token variable">missing</span><span class="token punctuation">&gt;</span>           <span class="token number">3</span> <span class="token variable">years</span> <span class="token variable">ago</span>         <span class="token punctuation">/</span><span class="token variable">bin</span><span class="token punctuation">/</span><span class="token variable">sh</span> <span class="token variable">-c</span> <span class="token variable">echo</span> <span class="token string">'#!/bin/sh'</span> <span class="token punctuation">&gt;</span> <span class="token punctuation">/</span><span class="token variable">usr</span><span class="token punctuation">/</span><span class="token variable">sbin</span><span class="token punctuation">/</span><span class="token variable">poli…</span>   <span class="token number">195</span><span class="token variable">kB</span>               
<span class="token punctuation">&lt;</span><span class="token variable">missing</span><span class="token punctuation">&gt;</span>           <span class="token number">3</span> <span class="token variable">years</span> <span class="token variable">ago</span>         <span class="token punctuation">/</span><span class="token variable">bin</span><span class="token punctuation">/</span><span class="token variable">sh</span> <span class="token variable">-c</span> <span class="token punctuation">#</span><span class="token punctuation">(</span><span class="token variable">nop</span><span class="token punctuation">)</span> <span class="token variable">ADD</span> <span class="token variable">file:b9504126dc5590898…</span>   <span class="token number">188</span><span class="token variable">MB</span>    
</code>
 
 <div class="hljs-button {2}"></div>
 
 </pre><ul class="pre-numbering"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><li>7</li></ul> 
<p>docker commit命令参数说明：</p> 
<pre class="prettyprint"><code class="has-numbering">-m: 提交的描述信息
-a: 指定镜像作者
</code>
 
 <div class="hljs-button {2}"></div>
 
 </pre><ul class="pre-numbering"><li>1</li><li>2</li><li>3</li></ul> 
<h2><a id="Dockerfile_216"></a>七、使用Dockerfile创建镜像</h2> 
<h3><a id="_Dockerfile_219"></a>什么是 Dockerfile？</h3> 
<p>Dockerfile 是一个用来构建镜像的文本文件，文本内容包含了一条条构建镜像所需的指令和说明。</p> 
<h3><a id="_Dockerfile__222"></a>使用 Dockerfile 定制简单镜像</h3> 
<pre class="prettyprint"><code class="prism language-handlebars has-numbering"><span class="token variable">mkdir</span> <span class="token variable">docker</span>
<span class="token variable">cd</span> <span class="token variable">docker</span><span class="token punctuation">/</span>
<span class="token variable">vim</span> <span class="token variable">Dockerfile</span>    <span class="token punctuation">#</span><span class="token variable">创建一个Dockerfile</span>
<span class="token variable">FROM</span> <span class="token variable">ubuntu</span>
<span class="token variable">RUN</span> <span class="token variable">touch</span> <span class="token variable">file</span><span class="token punctuation">{<!-- --></span><span class="token number">1.</span><span class="token number">.10</span><span class="token punctuation">}</span>
<span class="token variable">docker</span> <span class="token variable">build</span> <span class="token variable">-t</span> <span class="token variable">ubuntu:v1</span> <span class="token punctuation">.</span>    <span class="token punctuation">#</span><span class="token variable">在</span> <span class="token variable">Dockerfile</span> <span class="token variable">文件的存放目录下，执行构建动作构建镜像</span>
<span class="token variable">docker</span> <span class="token variable">history</span> <span class="token variable">ubuntu:v1</span>    <span class="token punctuation">#</span><span class="token variable">查看镜像的分层结构</span>
</code>
 
 <div class="hljs-button {2}"></div>
 
 </pre><ul class="pre-numbering"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><li>7</li></ul> 
<p>注：在镜像构建时，由于构建镜像会拉取该目录下的所有数据，所以不要直接在根目录下进行构建</p> 
<p>构建镜像的代码中，有提到指令最后一个 <code>.</code> 是上下文路径，那么什么是上下文路径呢？</p> 
<p>上下文路径，是指 docker 在构建镜像，有时候想要使用到本机的文件（比如复制），docker build 命令得知这个路径后，会将路径下的所有内容打包。</p> 
<p>解析：由于 docker 的运行模式是 C/S。我们本机是 C，docker 引擎是 S。实际的构建过程是在 docker 引擎下完成的，所以这个时候无法用到我们本机的文件。这就需要把我们本机的指定目录下的文件一起打包提供给 docker 引擎使用。</p> 
<p>如果未说明最后一个参数，那么默认上下文路径就是 Dockerfile 所在的位置。</p> 
<p>注意：上下文路径下不要放无用的文件，因为会一起打包发送给 docker 引擎，如果文件过多会造成过程缓慢。</p> 
<h3><a id="Dockerfile_245"></a>Dockerfile中的指令详解</h3> 
<h4><a id="FROM_246"></a>FROM</h4> 
<p>FROM：定制的镜像都是基于 FROM 的镜像，这里的 nginx 就是定制需要的基础镜像。后续的操作都是基于 nginx。</p> 
<h4><a id="RUN_248"></a>RUN</h4> 
<p>RUN：用于执行后面跟着的命令行命令。有以下俩种格式：</p> 
<p>shell 格式：</p> 
<pre class="prettyprint"><code class="prism language-handlebars has-numbering"><span class="token variable">RUN</span> <span class="token punctuation">&lt;</span><span class="token variable">命令行命令</span><span class="token punctuation">&gt;</span>
<span class="token punctuation">#</span> <span class="token punctuation">&lt;</span><span class="token variable">命令行命令</span><span class="token punctuation">&gt;</span> <span class="token variable">等同于，在终端操作的</span> <span class="token variable">shell</span> <span class="token variable">命令。</span>
</code>
 
 <div class="hljs-button {2}"></div>
 
 </pre><ul class="pre-numbering"><li>1</li><li>2</li></ul> 
<p>exec 格式：</p> 
<pre class="prettyprint"><code class="prism language-handlebars has-numbering"><span class="token variable">RUN</span> <span class="token punctuation">[</span><span class="token string">"可执行文件"</span><span class="token punctuation">,</span> <span class="token string">"参数1"</span><span class="token punctuation">,</span> <span class="token string">"参数2"</span><span class="token punctuation">]</span>
<span class="token punctuation">#</span> <span class="token variable">例如：</span>
<span class="token punctuation">#</span> <span class="token variable">RUN</span> <span class="token punctuation">[</span><span class="token string">"./test.php"</span><span class="token punctuation">,</span> <span class="token string">"dev"</span><span class="token punctuation">,</span> <span class="token string">"offline"</span><span class="token punctuation">]</span> <span class="token variable">等价于</span> <span class="token variable">RUN</span> <span class="token punctuation">.</span><span class="token punctuation">/</span><span class="token variable">test</span><span class="token punctuation">.</span><span class="token variable">php</span> <span class="token variable">dev</span> <span class="token variable">offline</span>
</code>
 
 <div class="hljs-button {2}"></div>
 
 </pre><ul class="pre-numbering"><li>1</li><li>2</li><li>3</li></ul> 
<h4><a id="COPY_267"></a>COPY</h4> 
<p>复制指令，从上下文目录（即Dockerfile所在的目录）中复制文件或者目录到容器里指定路径。</p> 
<p>格式：</p> 
<pre class="prettyprint"><code class="prism language-handlebars has-numbering"><span class="token variable">COPY</span> <span class="token brackets"><span class="token punctuation">[</span><span class="token variable">--chown=&lt;user&gt;:&lt;group&gt;</span><span class="token punctuation">]</span></span> <span class="token punctuation">&lt;</span><span class="token variable">源路径</span><span class="token number">1</span><span class="token punctuation">&gt;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>  <span class="token punctuation">&lt;</span><span class="token variable">目标路径</span><span class="token punctuation">&gt;</span>
<span class="token variable">COPY</span> <span class="token brackets"><span class="token punctuation">[</span><span class="token variable">--chown=&lt;user&gt;:&lt;group&gt;</span><span class="token punctuation">]</span></span> <span class="token punctuation">[</span><span class="token string">"&lt;源路径1&gt;"</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>  <span class="token string">"&lt;目标路径&gt;"</span><span class="token punctuation">]</span>
</code>
 
 <div class="hljs-button {2}"></div>
 
 </pre><ul class="pre-numbering"><li>1</li><li>2</li></ul> 
<blockquote> 
 <p>[–chown=:]：可选参数，用户改变复制到容器内文件的拥有者和属组。</p> 
 <p>&lt;源路径&gt;：源文件或者源目录，这里可以是通配符表达式，其通配符规则要满足 Go 的 filepath.Match 规则。例如：</p> 
 <p>COPY hom* /mydir/<br> COPY hom?.txt /mydir/</p> 
 <p>&lt;目标路径&gt;：容器内的指定路径，该路径不用事先建好，路径不存在的话，会自动创建。</p> 
</blockquote> 
<h4><a id="ADD_287"></a>ADD</h4> 
<p>ADD 指令和 COPY 的使用格式一致（同样需求下，官方推荐使用 COPY）。功能也类似，不同之处如下：</p> 
<pre class="prettyprint"><code class="has-numbering">ADD 的优点：在执行 &lt;源文件&gt; 为 tar 压缩文件的话，压缩格式为 gzip, bzip2 以及 xz 的情况下，会**自动复制并解压到 &lt;目标路径&gt;**。
ADD 的缺点：在不解压的前提下，无法复制 tar 压缩文件。会令镜像构建缓存失效，从而可能会令镜像构建变得比较缓慢。具体是否使用，可以根据是否需要自动解压来决定。
</code>
 
 <div class="hljs-button {2}"></div>
 
 </pre><ul class="pre-numbering"><li>1</li><li>2</li></ul> 
<h4><a id="CMD_293"></a>CMD</h4> 
<p>类似于 RUN 指令，用于运行程序，但二者运行的时间点不同:</p> 
<pre class="prettyprint"><code class="has-numbering">CMD 在docker run 时运行。
RUN 是在 docker build。
</code>
 
 <div class="hljs-button {2}"></div>
 
 </pre><ul class="pre-numbering"><li>1</li><li>2</li></ul> 
<p>作用：为启动的容器指定默认要运行的程序，程序运行结束，容器也就结束。<strong>CMD 指令指定的程序可被 docker run 命令行参数中指定要运行的程序所覆盖。</strong></p> 
<p>注意：如果 Dockerfile 中如果存在多个 CMD 指令，仅最后一个生效。</p> 
<p>格式：</p> 
<pre class="prettyprint"><code class="prism language-handlebars has-numbering"><span class="token variable">CMD</span> <span class="token punctuation">&lt;</span><span class="token variable">shell</span> <span class="token variable">命令</span><span class="token punctuation">&gt;</span> 
<span class="token variable">CMD</span> <span class="token punctuation">[</span><span class="token string">"&lt;可执行文件或命令&gt;"</span><span class="token punctuation">,</span><span class="token string">"&lt;param1&gt;"</span><span class="token punctuation">,</span><span class="token string">"&lt;param2&gt;"</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> 
<span class="token variable">CMD</span> <span class="token punctuation">[</span><span class="token string">"&lt;param1&gt;"</span><span class="token punctuation">,</span><span class="token string">"&lt;param2&gt;"</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span>  <span class="token punctuation">#</span> <span class="token variable">该写法是为</span> <span class="token variable">ENTRYPOINT</span> <span class="token variable">指令指定的程序提供默认参数</span>
</code>
 
 <div class="hljs-button {2}"></div>
 
 </pre><ul class="pre-numbering"><li>1</li><li>2</li><li>3</li></ul> 
<p>推荐使用第二种格式，执行过程比较明确。第一种格式实际上在运行的过程中也会自动转换成第二种格式运行，并且默认可执行文件是 sh。</p> 
<h4><a id="ENTRYPOINT_313"></a>ENTRYPOINT</h4> 
<p><strong>类似于 CMD 指令，但其不会被 docker run 的命令行参数指定的指令所覆盖</strong>，而且这些命令行参数会被当作参数送给 ENTRYPOINT 指令指定的程序。</p> 
<p>但是, 如果运行 docker run 时使用了 --entrypoint 选项，此选项的参数可当作要运行的程序覆盖 ENTRYPOINT 指令指定的程序。</p> 
<p>优点：在执行 docker run 的时候可以指定 ENTRYPOINT 运行所需的参数。</p> 
<p><strong>注意：如果 Dockerfile 中如果存在多个 ENTRYPOINT 指令，仅最后一个生效</strong>。</p> 
<p>格式：</p> 
<pre class="prettyprint"><code class="prism language-handlebars has-numbering"><span class="token variable">ENTRYPOINT</span> <span class="token punctuation">[</span><span class="token string">"&lt;executeable&gt;"</span><span class="token punctuation">,</span><span class="token string">"&lt;param1&gt;"</span><span class="token punctuation">,</span><span class="token string">"&lt;param2&gt;"</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span>
</code>
 
 <div class="hljs-button {2}"></div>
 
 </pre><ul class="pre-numbering"><li>1</li></ul> 
<p>可以搭配 CMD 命令使用：一般是变参才会使用 CMD ，这里的 CMD 等于是在给 ENTRYPOINT 传参，以下示例会提到。</p> 
<p>示例：</p> 
<p>假设已通过 Dockerfile 构建了 nginx:test 镜像：</p> 
<pre class="prettyprint"><code class="prism language-handlebars has-numbering"><span class="token variable">FROM</span> <span class="token variable">nginx</span>
<span class="token variable">ENTRYPOINT</span> <span class="token punctuation">[</span><span class="token string">"nginx"</span><span class="token punctuation">,</span> <span class="token string">"-c"</span><span class="token punctuation">]</span> <span class="token punctuation">#</span> <span class="token variable">定参</span>
<span class="token variable">CMD</span> <span class="token punctuation">[</span><span class="token string">"/etc/nginx/nginx.conf"</span><span class="token punctuation">]</span> <span class="token punctuation">#</span> <span class="token variable">变参</span> 
</code>
 
 <div class="hljs-button {2}"></div>
 
 </pre><ul class="pre-numbering"><li>1</li><li>2</li><li>3</li><li>4</li></ul> 
<p>1、不传参运行</p> 
<pre class="prettyprint"><code class="prism language-handlebars has-numbering"> <span class="token variable">docker</span> <span class="token variable">run</span>  <span class="token variable">nginx:test</span>
</code>
 
 <div class="hljs-button {2}"></div>
 
 </pre><ul class="pre-numbering"><li>1</li></ul> 
<p>容器内会默认运行以下命令，启动主进程。</p> 
<pre class="prettyprint"><code class="prism language-handlebars has-numbering"><span class="token variable">nginx</span> <span class="token variable">-c</span> <span class="token punctuation">/</span><span class="token variable">etc</span><span class="token punctuation">/</span><span class="token variable">nginx</span><span class="token punctuation">/</span><span class="token variable">nginx</span><span class="token punctuation">.</span><span class="token variable">conf</span>
</code>
 
 <div class="hljs-button {2}"></div>
 
 </pre><ul class="pre-numbering"><li>1</li></ul> 
<p>2、传参运行</p> 
<pre class="prettyprint"><code class="prism language-handlebars has-numbering"><span class="token variable">docker</span> <span class="token variable">run</span>  <span class="token variable">nginx:test</span> <span class="token variable">-c</span> <span class="token punctuation">/</span><span class="token variable">etc</span><span class="token punctuation">/</span><span class="token variable">nginx</span><span class="token punctuation">/</span><span class="token variable">new</span><span class="token punctuation">.</span><span class="token variable">conf</span>
</code>
 
 <div class="hljs-button {2}"></div>
 
 </pre><ul class="pre-numbering"><li>1</li></ul> 
<p>容器内会默认运行以下命令，启动主进程(/etc/nginx/new.conf:假设容器内已有此文件)</p> 
<pre class="prettyprint"><code class="prism language-handlebars has-numbering"><span class="token variable">nginx</span> <span class="token variable">-c</span> <span class="token punctuation">/</span><span class="token variable">etc</span><span class="token punctuation">/</span><span class="token variable">nginx</span><span class="token punctuation">/</span><span class="token variable">new</span><span class="token punctuation">.</span><span class="token variable">conf</span>
</code>
 
 <div class="hljs-button {2}"></div>
 
 </pre><ul class="pre-numbering"><li>1</li></ul> 
<h4><a id="ENV_366"></a>ENV</h4> 
<p>设置环境变量，定义了环境变量，那么在后续的指令中，就可以使用这个环境变量。</p> 
<p>格式：</p> 
<pre class="prettyprint"><code class="prism language-handlebars has-numbering"><span class="token variable">ENV</span> <span class="token punctuation">&lt;</span><span class="token variable">key</span><span class="token punctuation">&gt;</span> <span class="token punctuation">&lt;</span><span class="token variable">value</span><span class="token punctuation">&gt;</span>
<span class="token variable">ENV</span> <span class="token punctuation">&lt;</span><span class="token variable">key1</span><span class="token punctuation">&gt;</span><span class="token punctuation">=</span><span class="token punctuation">&lt;</span><span class="token variable">value1</span><span class="token punctuation">&gt;</span> <span class="token punctuation">&lt;</span><span class="token variable">key2</span><span class="token punctuation">&gt;</span><span class="token punctuation">=</span><span class="token punctuation">&lt;</span><span class="token variable">value2</span><span class="token punctuation">&gt;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code>
 
 <div class="hljs-button {2}"></div>
 
 </pre><ul class="pre-numbering"><li>1</li><li>2</li></ul> 
<p>以下示例设置 NODE_VERSION = 7.2.0 ， 在后续的指令中可以通过 $NODE_VERSION 引用：</p> 
<pre class="prettyprint"><code class="prism language-handlebars has-numbering"><span class="token variable">ENV</span> <span class="token variable">NODE_VERSION</span> <span class="token number">7.2</span><span class="token number">.0</span>
<span class="token variable">RUN</span> <span class="token variable">curl</span> <span class="token variable">-SLO</span> <span class="token string">"https://nodejs.org/dist/v$NODE_VERSION/node-v$NODE_VERSION-linux-x64.tar.xz"</span> <span class="token punctuation">\</span>
  <span class="token punctuation">&amp;</span><span class="token punctuation">&amp;</span> <span class="token variable">curl</span> <span class="token variable">-SLO</span> <span class="token string">"https://nodejs.org/dist/v$NODE_VERSION/SHASUMS256.txt.asc"</span>
</code>
 
 <div class="hljs-button {2}"></div>
 
 </pre><ul class="pre-numbering"><li>1</li><li>2</li><li>3</li><li>4</li></ul> 
<h4><a id="ARG_386"></a>ARG</h4> 
<p>构建参数，与 ENV 作用一至。不过作用域不一样。ARG 设置的环境变量仅对 Dockerfile 内有效，也就是说只有 docker build 的过程中有效，构建好的镜像内不存在此环境变量。</p> 
<p>构建命令 docker build 中可以用 --build-arg &lt;参数名&gt;=&lt;值&gt; 来覆盖。</p> 
<p>格式：</p> 
<pre class="prettyprint"><code class="prism language-handlebars has-numbering"><span class="token variable">ARG</span> <span class="token punctuation">&lt;</span><span class="token variable">参数名</span><span class="token punctuation">&gt;</span><span class="token brackets"><span class="token punctuation">[</span><span class="token variable">=&lt;默认值&gt;</span><span class="token punctuation">]</span></span>
</code>
 
 <div class="hljs-button {2}"></div>
 
 </pre><ul class="pre-numbering"><li>1</li></ul> 
<h4><a id="VOLUME_398"></a>VOLUME</h4> 
<p>定义匿名数据卷。在启动容器时忘记挂载数据卷，会自动挂载到匿名卷。</p> 
<p>作用：</p> 
<pre class="prettyprint"><code class="has-numbering">避免重要的数据，因容器重启而丢失，这是非常致命的。
避免容器不断变大。
</code>
 
 <div class="hljs-button {2}"></div>
 
 </pre><ul class="pre-numbering"><li>1</li><li>2</li></ul> 
<p>格式：</p> 
<pre class="prettyprint"><code class="prism language-handlebars has-numbering"><span class="token variable">VOLUME</span> <span class="token punctuation">[</span><span class="token string">"&lt;路径1&gt;"</span><span class="token punctuation">,</span> <span class="token string">"&lt;路径2&gt;"</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span>
<span class="token variable">VOLUME</span> <span class="token punctuation">&lt;</span><span class="token variable">路径</span><span class="token punctuation">&gt;</span>
</code>
 
 <div class="hljs-button {2}"></div>
 
 </pre><ul class="pre-numbering"><li>1</li><li>2</li></ul> 
<p>在启动容器 docker run 的时候，我们可以通过 -v 参数修改挂载点。</p> 
<h4><a id="EXPOSE_415"></a>EXPOSE</h4> 
<p>仅仅只是声明端口。</p> 
<p>作用：</p> 
<pre class="prettyprint"><code class="has-numbering">帮助镜像使用者理解这个镜像服务的守护端口，以方便配置映射。
在运行时使用随机端口映射时，也就是 docker run -P 时，会自动随机映射 EXPOSE 的端口。
</code>
 
 <div class="hljs-button {2}"></div>
 
 </pre><ul class="pre-numbering"><li>1</li><li>2</li></ul> 
<p>格式：</p> 
<pre class="prettyprint"><code class="prism language-handlebars has-numbering"><span class="token variable">EXPOSE</span> <span class="token punctuation">&lt;</span><span class="token variable">端口</span><span class="token number">1</span><span class="token punctuation">&gt;</span> <span class="token punctuation">[</span><span class="token punctuation">&lt;</span><span class="token variable">端口</span><span class="token number">2</span><span class="token punctuation">&gt;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span>
</code>
 
 <div class="hljs-button {2}"></div>
 
 </pre><ul class="pre-numbering"><li>1</li></ul> 
<h4><a id="WORKDIR_430"></a>WORKDIR</h4> 
<p><strong>指定工作目录</strong>。用 WORKDIR 指定的工作目录，会在构建镜像的每一层中都存在。（WORKDIR 指定的工作目录，必须是提前创建好的）。</p> 
<p>docker build 构建镜像过程中的，每一个 RUN 命令都是新建的一层。只有通过 WORKDIR 创建的目录才会一直存在。</p> 
<p>格式：</p> 
<pre class="prettyprint"><code class="prism language-handlebars has-numbering"><span class="token variable">WORKDIR</span> <span class="token punctuation">&lt;</span><span class="token variable">工作目录路径</span><span class="token punctuation">&gt;</span>
</code>
 
 <div class="hljs-button {2}"></div>
 
 </pre><ul class="pre-numbering"><li>1</li></ul> 
<h4><a id="USER_442"></a>USER</h4> 
<p>用于指定执行后续命令的用户和用户组，这边只是切换后续命令执行的用户（用户和用户组必须提前已经存在）。</p> 
<p>格式：</p> 
<pre class="prettyprint"><code class="prism language-handlebars has-numbering"><span class="token variable">USER</span> <span class="token punctuation">&lt;</span><span class="token variable">用户名</span><span class="token punctuation">&gt;</span><span class="token brackets"><span class="token punctuation">[</span><span class="token variable">:&lt;用户组&gt;</span><span class="token punctuation">]</span></span>
</code>
 
 <div class="hljs-button {2}"></div>
 
 </pre><ul class="pre-numbering"><li>1</li></ul> 
<h4><a id="HEALTHCHECK_452"></a>HEALTHCHECK</h4> 
<p>用于指定某个程序或者指令来监控 docker 容器服务的运行状态。</p> 
<p>格式：</p> 
<pre class="prettyprint"><code class="prism language-handlebars has-numbering"><span class="token variable">HEALTHCHECK</span> <span class="token brackets"><span class="token punctuation">[</span><span class="token variable">选项</span><span class="token punctuation">]</span></span> <span class="token variable">CMD</span> <span class="token punctuation">&lt;</span><span class="token variable">命令</span><span class="token punctuation">&gt;</span><span class="token variable">：设置检查容器健康状况的命令</span>
<span class="token variable">HEALTHCHECK</span> <span class="token variable">NONE：如果基础镜像有健康检查指令，使用这行可以屏蔽掉其健康检查指令</span>
<span class="token variable">HEALTHCHECK</span> <span class="token brackets"><span class="token punctuation">[</span><span class="token variable">选项</span><span class="token punctuation">]</span></span> <span class="token variable">CMD</span> <span class="token punctuation">&lt;</span><span class="token variable">命令</span><span class="token punctuation">&gt;</span> <span class="token variable">:</span> <span class="token variable">这边</span> <span class="token variable">CMD</span> <span class="token variable">后面跟随的命令使用，可以参考</span> <span class="token variable">CMD</span> <span class="token variable">的用法。</span>
</code>
 
 <div class="hljs-button {2}"></div>
 
 </pre><ul class="pre-numbering"><li>1</li><li>2</li><li>3</li><li>4</li></ul> 
<h4><a id="ONBUILD_465"></a>ONBUILD</h4> 
<p>用于延迟构建命令的执行。简单的说，就是 Dockerfile 里用 ONBUILD 指定的命令，在本次构建镜像的过程中不会执行（假设镜像为 test-build）。当有新的 Dockerfile 使用了之前构建的镜像 FROM test-build ，这是执行新镜像的 Dockerfile 构建时候，会执行 test-build 的 Dockerfile 里的 ONBUILD 指定的命令。</p> 
<p>格式：</p> 
<pre class="prettyprint"><code class="prism language-handlebars has-numbering"><span class="token variable">ONBUILD</span> <span class="token punctuation">&lt;</span><span class="token variable">其它指令</span><span class="token punctuation">&gt;</span>
</code>
 
 <div class="hljs-button {2}"></div>
 
 </pre><ul class="pre-numbering"><li>1</li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/df56b3bd0acb6b1921ab9f5362e2b3dc/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">给你一个区间列表，请你删除列表中被其他区间所覆盖的区间。</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/fb95213ec93331d55daf9e807be76edd/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">TensorFlow 2.0教程05：跨多个节点的分布式培训</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>