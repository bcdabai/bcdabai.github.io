<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Kubernetes集群搭建Zabbix监控平台 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Kubernetes集群搭建Zabbix监控平台" />
<meta property="og:description" content="目 录
一、检查本地k8s环境
1.检查系统pod运行状态
2.检查node节点状态
二、配置nfs共享存储
1.安装nfs
2.创建共享目录
3.配置共享目录
4.启动相关服务
5.使配置生效
6.查看nfs
7.其他节点检查nfs共享
三、安装zabbix-mysql
1.编写zabbix-mysql的yaml文件
2.创建命名空间
3.创建zabbix数据库
4.检查pod状态
四、检查zabbix数据库的service域名
1.运行测试pod
2.进入busybox的pod
3.查看域名解析
五、安装zabbix-server
1.编写zabbix_server.yaml文件
2.给node02节点打上标签
3.安装zabbix-server
4.检查pod状态
六、部署zabbix-web
1.编写zabbix_web.yaml文件
2.安装zabbix-web
3.查看pod状态
七、部署zabbix-agent
1.编辑zabbix_agent.yaml
2.安装zabbix-agent
3.查看pod状态
八、访问zabbix的web
1.查看svc
2.登录web
3.登录zabbix
4.查询zabbix-server的监控项图表
一、检查本地k8s环境
1.检查系统pod运行状态
[root@k8s-master ~]# kubectl get pods -A NAMESPACE NAME READY STATUS RESTARTS AGE kube-system calico-kube-controllers-7bc6547ffb-2nf66 1/1 Running 1 (9m28s ago) 2d16h kube-system calico-node-8c4pn 1/1 Running 1 (9m16s ago) 2d16h kube-system calico-node-f28qq 1/1 Running 1 (9m10s ago) 2d16h kube-system calico-node-wmc2j 1/1 Running 1 (9m29s ago) 2d16h kube-system coredns-6d8c4cb4d-6gm4x 1/1 Running 1 (9m28s ago) 2d16h kube-system coredns-6d8c4cb4d-7vxlz 1/1 Running 1 (9m29s ago) 2d16h kube-system etcd-k8s-master 1/1 Running 1 (9m30s ago) 2d16h kube-system kube-apiserver-k8s-master 1/1 Running 1 (9m29s ago) 2d16h kube-system kube-controller-manager-k8s-master 1/1 Running 1 (9m30s ago) 2d16h kube-system kube-proxy-8dfw8 1/1 Running 1 (9m29s ago) 2d16h kube-system kube-proxy-ghzrv 1/1 Running 1 (9m9s ago) 2d16h kube-system kube-proxy-j867z 1/1 Running 1 (9m15s ago) 2d16h kube-system kube-scheduler-k8s-master 1/1 Running 1 (9m28s ago) 2d16h 2." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/f1a9b85dcf0c55b387b7842d5584f850/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-08-08T10:29:32+08:00" />
<meta property="article:modified_time" content="2022-08-08T10:29:32+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Kubernetes集群搭建Zabbix监控平台</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>目 录<br> 一、检查本地k8s环境<br> 1.检查系统pod运行状态<br> 2.检查node节点状态</p> 
<p>二、配置nfs共享存储<br> 1.安装nfs<br> 2.创建共享目录<br> 3.配置共享目录<br> 4.启动相关服务<br> 5.使配置生效<br> 6.查看nfs<br> 7.其他节点检查nfs共享</p> 
<p>三、安装zabbix-mysql<br> 1.编写zabbix-mysql的yaml文件<br> 2.创建命名空间<br> 3.创建zabbix数据库<br> 4.检查pod状态</p> 
<p>四、检查zabbix数据库的service域名<br> 1.运行测试pod<br> 2.进入busybox的pod<br> 3.查看域名解析</p> 
<p>五、安装zabbix-server<br> 1.编写zabbix_server.yaml文件<br> 2.给node02节点打上标签<br> 3.安装zabbix-server<br> 4.检查pod状态</p> 
<p>六、部署zabbix-web<br> 1.编写zabbix_web.yaml文件<br> 2.安装zabbix-web<br> 3.查看pod状态</p> 
<p>七、部署zabbix-agent<br> 1.编辑zabbix_agent.yaml<br> 2.安装zabbix-agent<br> 3.查看pod状态</p> 
<p>八、访问zabbix的web<br> 1.查看svc<br> 2.登录web<br> 3.登录zabbix<br> 4.查询zabbix-server的监控项图表</p> 
<p>一、检查本地k8s环境</p> 
<p>1.检查系统pod运行状态</p> 
<pre><code class="prism language-clike"><span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master <span class="token operator">~</span><span class="token punctuation">]</span># kubectl get pods <span class="token operator">-</span>A
NAMESPACE     NAME                                       READY   STATUS    RESTARTS        AGE
kube<span class="token operator">-</span>system   calico<span class="token operator">-</span>kube<span class="token operator">-</span>controllers<span class="token operator">-</span><span class="token number">7</span>bc6547ffb<span class="token operator">-</span><span class="token number">2</span>nf66   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">1</span> <span class="token punctuation">(</span><span class="token number">9</span>m28s ago<span class="token punctuation">)</span>   <span class="token number">2</span>d16h
kube<span class="token operator">-</span>system   calico<span class="token operator">-</span>node<span class="token operator">-</span><span class="token number">8</span>c4pn                          <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">1</span> <span class="token punctuation">(</span><span class="token number">9</span>m16s ago<span class="token punctuation">)</span>   <span class="token number">2</span>d16h
kube<span class="token operator">-</span>system   calico<span class="token operator">-</span>node<span class="token operator">-</span>f28qq                          <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">1</span> <span class="token punctuation">(</span><span class="token number">9</span>m10s ago<span class="token punctuation">)</span>   <span class="token number">2</span>d16h
kube<span class="token operator">-</span>system   calico<span class="token operator">-</span>node<span class="token operator">-</span>wmc2j                          <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">1</span> <span class="token punctuation">(</span><span class="token number">9</span>m29s ago<span class="token punctuation">)</span>   <span class="token number">2</span>d16h
kube<span class="token operator">-</span>system   coredns<span class="token operator">-</span><span class="token number">6</span>d8c4cb4d<span class="token operator">-</span><span class="token number">6</span>gm4x                    <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">1</span> <span class="token punctuation">(</span><span class="token number">9</span>m28s ago<span class="token punctuation">)</span>   <span class="token number">2</span>d16h
kube<span class="token operator">-</span>system   coredns<span class="token operator">-</span><span class="token number">6</span>d8c4cb4d<span class="token operator">-</span><span class="token number">7</span>vxlz                    <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">1</span> <span class="token punctuation">(</span><span class="token number">9</span>m29s ago<span class="token punctuation">)</span>   <span class="token number">2</span>d16h
kube<span class="token operator">-</span>system   etcd<span class="token operator">-</span>k8s<span class="token operator">-</span>master                            <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">1</span> <span class="token punctuation">(</span><span class="token number">9</span>m30s ago<span class="token punctuation">)</span>   <span class="token number">2</span>d16h
kube<span class="token operator">-</span>system   kube<span class="token operator">-</span>apiserver<span class="token operator">-</span>k8s<span class="token operator">-</span>master                  <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">1</span> <span class="token punctuation">(</span><span class="token number">9</span>m29s ago<span class="token punctuation">)</span>   <span class="token number">2</span>d16h
kube<span class="token operator">-</span>system   kube<span class="token operator">-</span>controller<span class="token operator">-</span>manager<span class="token operator">-</span>k8s<span class="token operator">-</span>master         <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">1</span> <span class="token punctuation">(</span><span class="token number">9</span>m30s ago<span class="token punctuation">)</span>   <span class="token number">2</span>d16h
kube<span class="token operator">-</span>system   kube<span class="token operator">-</span>proxy<span class="token operator">-</span><span class="token number">8</span>dfw8                           <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">1</span> <span class="token punctuation">(</span><span class="token number">9</span>m29s ago<span class="token punctuation">)</span>   <span class="token number">2</span>d16h
kube<span class="token operator">-</span>system   kube<span class="token operator">-</span>proxy<span class="token operator">-</span>ghzrv                           <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">1</span> <span class="token punctuation">(</span><span class="token number">9</span>m9s ago<span class="token punctuation">)</span>    <span class="token number">2</span>d16h
kube<span class="token operator">-</span>system   kube<span class="token operator">-</span>proxy<span class="token operator">-</span>j867z                           <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">1</span> <span class="token punctuation">(</span><span class="token number">9</span>m15s ago<span class="token punctuation">)</span>   <span class="token number">2</span>d16h
kube<span class="token operator">-</span>system   kube<span class="token operator">-</span>scheduler<span class="token operator">-</span>k8s<span class="token operator">-</span>master                  <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">1</span> <span class="token punctuation">(</span><span class="token number">9</span>m28s ago<span class="token punctuation">)</span>   <span class="token number">2</span>d16h
</code></pre> 
<p>2.检查node节点状态</p> 
<pre><code class="prism language-clike"><span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master <span class="token operator">~</span><span class="token punctuation">]</span># kubectl get nodes <span class="token operator">-</span>owide
NAME         STATUS   ROLES                  AGE     VERSION   INTERNAL<span class="token operator">-</span>IP     EXTERNAL<span class="token operator">-</span>IP   OS<span class="token operator">-</span>IMAGE                KERNEL<span class="token operator">-</span>VERSION          CONTAINER<span class="token operator">-</span>RUNTIME
k8s<span class="token operator">-</span>master   Ready    control<span class="token operator">-</span>plane<span class="token punctuation">,</span>master   <span class="token number">2</span>d16h   v1<span class="token punctuation">.</span><span class="token number">23.1</span>   <span class="token number">192.168</span><span class="token number">.3</span><span class="token number">.201</span>   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        CentOS Linux <span class="token number">7</span> <span class="token punctuation">(</span>Core<span class="token punctuation">)</span>   <span class="token number">3.10</span><span class="token number">.0</span><span class="token operator">-</span><span class="token number">957.</span>el7<span class="token punctuation">.</span>x86_64   containerd<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">1.6</span><span class="token number">.6</span>
k8s<span class="token operator">-</span>node01   Ready    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>                 <span class="token number">2</span>d16h   v1<span class="token punctuation">.</span><span class="token number">23.1</span>   <span class="token number">192.168</span><span class="token number">.3</span><span class="token number">.202</span>   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        CentOS Linux <span class="token number">7</span> <span class="token punctuation">(</span>Core<span class="token punctuation">)</span>   <span class="token number">3.10</span><span class="token number">.0</span><span class="token operator">-</span><span class="token number">957.</span>el7<span class="token punctuation">.</span>x86_64   containerd<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">1.6</span><span class="token number">.6</span>
k8s<span class="token operator">-</span>node02   Ready    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>                 <span class="token number">2</span>d16h   v1<span class="token punctuation">.</span><span class="token number">23.1</span>   <span class="token number">192.168</span><span class="token number">.3</span><span class="token number">.203</span>   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        CentOS Linux <span class="token number">7</span> <span class="token punctuation">(</span>Core<span class="token punctuation">)</span>   <span class="token number">3.10</span><span class="token number">.0</span><span class="token operator">-</span><span class="token number">957.</span>el7<span class="token punctuation">.</span>x86_64   containerd<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">1.6</span><span class="token number">.6</span>
</code></pre> 
<p>二、配置nfs共享存储</p> 
<p>1.安装nfs</p> 
<pre><code class="prism language-clike">yum install <span class="token operator">-</span>y nfs<span class="token operator">-</span>utils
</code></pre> 
<p>2.创建共享目录</p> 
<pre><code class="prism language-clike">mkdir <span class="token operator">-</span>p <span class="token operator">/</span>nfs<span class="token operator">/</span>data
</code></pre> 
<p>3.配置共享目录</p> 
<pre><code class="prism language-clike">echo <span class="token string">"/nfs/data/ *(insecure,rw,sync,no_root_squash)"</span> <span class="token operator">&gt;</span> <span class="token operator">/</span>etc<span class="token operator">/</span>exports
</code></pre> 
<p>4.启动相关服务</p> 
<pre><code class="prism language-clike">systemctl enable rpcbind
systemctl enable nfs<span class="token operator">-</span>server
systemctl start rpcbind
</code></pre> 
<p>5.使配置生效</p> 
<pre><code class="prism language-clike">exportfs <span class="token operator">-</span>r
</code></pre> 
<p>6.查看nfs</p> 
<pre><code class="prism language-clike"><span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master <span class="token operator">~</span><span class="token punctuation">]</span># exportfs
<span class="token operator">/</span>nfs<span class="token operator">/</span>data       <span class="token operator">&lt;</span>world<span class="token operator">&gt;</span>
</code></pre> 
<p>7.其他节点检查nfs共享</p> 
<pre><code class="prism language-clike"><span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>node01 <span class="token operator">~</span><span class="token punctuation">]</span>#  showmount <span class="token operator">-</span>e <span class="token number">192.168</span><span class="token number">.3</span><span class="token number">.201</span>
Export list <span class="token keyword">for</span> <span class="token number">192.168</span><span class="token number">.3</span><span class="token number">.201</span><span class="token punctuation">:</span>
<span class="token operator">/</span>nfs<span class="token operator">/</span>data <span class="token operator">*</span>
</code></pre> 
<p>三、安装zabbix-mysql</p> 
<p>1.编写zabbix-mysql的yaml文件</p> 
<pre><code class="prism language-clike"><span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master zabbix<span class="token punctuation">]</span># cat zabbix_mysql<span class="token punctuation">.</span>yaml 
<span class="token operator">--</span><span class="token operator">-</span>
apiVersion<span class="token punctuation">:</span> v1
kind<span class="token punctuation">:</span> PersistentVolume
metadata<span class="token punctuation">:</span>
  name<span class="token punctuation">:</span> zabbixdb<span class="token operator">-</span>pv
spec<span class="token punctuation">:</span>
  capacity<span class="token punctuation">:</span>   #创建存储的大小
    storage<span class="token punctuation">:</span> <span class="token number">10</span>Gi
  volumeMode<span class="token punctuation">:</span> Filesystem  #存储的类型
  accessModes<span class="token punctuation">:</span>
    <span class="token operator">-</span> ReadWriteOnce
  persistentVolumeReclaimPolicy<span class="token punctuation">:</span> Recycle
  nfs<span class="token punctuation">:</span>
    path<span class="token punctuation">:</span> <span class="token operator">/</span>nfs<span class="token operator">/</span>data<span class="token operator">/</span>zabbix
    server<span class="token punctuation">:</span> <span class="token number">192.168</span><span class="token number">.3</span><span class="token number">.201</span>
  mountOptions<span class="token punctuation">:</span>
    <span class="token operator">-</span> hard
    <span class="token operator">-</span> nfsvers<span class="token operator">=</span><span class="token number">4.1</span>
<span class="token operator">--</span><span class="token operator">-</span>
apiVersion<span class="token punctuation">:</span> v1
kind<span class="token punctuation">:</span> PersistentVolumeClaim
metadata<span class="token punctuation">:</span>
  name<span class="token punctuation">:</span> zabbixdb<span class="token operator">-</span>pvc
  namespace<span class="token punctuation">:</span> zabbix
spec<span class="token punctuation">:</span>
  accessModes<span class="token punctuation">:</span>
    <span class="token operator">-</span> ReadWriteOnce
  volumeMode<span class="token punctuation">:</span> Filesystem   #存储类型 ，块存储Block
  resources<span class="token punctuation">:</span>
    requests<span class="token punctuation">:</span>
      storage<span class="token punctuation">:</span> <span class="token number">8</span>Gi
<span class="token operator">--</span><span class="token operator">-</span>
apiVersion<span class="token punctuation">:</span> apps<span class="token operator">/</span>v1
kind<span class="token punctuation">:</span> Deployment
metadata<span class="token punctuation">:</span>
  labels<span class="token punctuation">:</span>
    app<span class="token punctuation">:</span> zabbixdb
  name<span class="token punctuation">:</span> zabbixdb
  namespace<span class="token punctuation">:</span> zabbix
spec<span class="token punctuation">:</span>
  replicas<span class="token punctuation">:</span> <span class="token number">1</span>
  selector<span class="token punctuation">:</span>
    matchLabels<span class="token punctuation">:</span>
      app<span class="token punctuation">:</span> zabbixdb
  strategy<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
  template<span class="token punctuation">:</span>
    metadata<span class="token punctuation">:</span>
      labels<span class="token punctuation">:</span>
        app<span class="token punctuation">:</span> zabbixdb
    spec<span class="token punctuation">:</span>
      volumes<span class="token punctuation">:</span>
      <span class="token operator">-</span> name<span class="token punctuation">:</span> zabbixdb<span class="token operator">-</span>data
        persistentVolumeClaim<span class="token punctuation">:</span>
          claimName<span class="token punctuation">:</span> zabbixdb<span class="token operator">-</span>pvc
      containers<span class="token punctuation">:</span>
      <span class="token operator">-</span> image<span class="token punctuation">:</span> mysql<span class="token punctuation">:</span><span class="token number">8.0</span>
        name<span class="token punctuation">:</span> mysql
        ports<span class="token punctuation">:</span>
        <span class="token operator">-</span> name<span class="token punctuation">:</span> mysql
          containerPort<span class="token punctuation">:</span> <span class="token number">3306</span>
          protocol<span class="token punctuation">:</span> TCP
        volumeMounts<span class="token punctuation">:</span>
        <span class="token operator">-</span> name<span class="token punctuation">:</span> zabbixdb<span class="token operator">-</span>data
          mountPath<span class="token punctuation">:</span> <span class="token operator">/</span>var<span class="token operator">/</span>lib<span class="token operator">/</span>mysql
        env<span class="token punctuation">:</span>
        <span class="token operator">-</span> name<span class="token punctuation">:</span> MYSQL_DATABASE
          value<span class="token punctuation">:</span> <span class="token string">'zabbix'</span>
        <span class="token operator">-</span> name<span class="token punctuation">:</span> MYSQL_USER
          value<span class="token punctuation">:</span> <span class="token string">'zabbix'</span>
        <span class="token operator">-</span> name<span class="token punctuation">:</span> MYSQL_PASSWORD
          value<span class="token punctuation">:</span> <span class="token string">'zabbix'</span>
        <span class="token operator">-</span> name<span class="token punctuation">:</span> MYSQL_ROOT_PASSWORD
          value<span class="token punctuation">:</span> <span class="token string">'zabbix'</span>
        resources<span class="token punctuation">:</span> 
          requests<span class="token punctuation">:</span>
             cpu<span class="token punctuation">:</span> <span class="token number">0.1</span>
             memory<span class="token punctuation">:</span> <span class="token number">128</span>Mi
          limits<span class="token punctuation">:</span>
             cpu<span class="token punctuation">:</span> <span class="token number">0.3</span>
             memory<span class="token punctuation">:</span>  <span class="token number">512</span>Mi
<span class="token operator">--</span><span class="token operator">-</span>

apiVersion<span class="token punctuation">:</span> v1
kind<span class="token punctuation">:</span> Service
metadata<span class="token punctuation">:</span>
  creationTimestamp<span class="token punctuation">:</span> <span class="token keyword">null</span>
  labels<span class="token punctuation">:</span>
    app<span class="token punctuation">:</span> zabbixdb
  name<span class="token punctuation">:</span> zabbixdb
  namespace<span class="token punctuation">:</span> zabbix
spec<span class="token punctuation">:</span>
  clusterIP<span class="token punctuation">:</span> <span class="token number">10.96</span><span class="token number">.1</span><span class="token number">.99</span>
  ports<span class="token punctuation">:</span>
  <span class="token operator">-</span> name<span class="token punctuation">:</span> <span class="token number">3306</span><span class="token operator">-</span><span class="token number">3306</span>
    port<span class="token punctuation">:</span> <span class="token number">3306</span>
    protocol<span class="token punctuation">:</span> TCP
    targetPort<span class="token punctuation">:</span> <span class="token number">3306</span>
  selector<span class="token punctuation">:</span>
    app<span class="token punctuation">:</span> zabbixdb
  type<span class="token punctuation">:</span> ClusterIP
status<span class="token punctuation">:</span>
  loadBalancer<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
</code></pre> 
<p>2.创建命名空间</p> 
<pre><code class="prism language-clike"><span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master zabbix<span class="token punctuation">]</span># kubectl create namespace zabbix
namespace<span class="token operator">/</span>zabbix created
</code></pre> 
<p>3.创建zabbix数据库</p> 
<pre><code class="prism language-clike">kubectl apply <span class="token operator">-</span>f zabbix_mysql<span class="token punctuation">.</span>yaml
</code></pre> 
<p>4.检查pod状态</p> 
<pre><code class="prism language-clike"><span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master zabbix<span class="token punctuation">]</span># kubectl get pods <span class="token operator">-</span>n zabbix 
NAME                        READY   STATUS    RESTARTS   AGE
zabbixdb<span class="token operator">-</span><span class="token number">69</span>b7cd8dff<span class="token operator">-</span>jnpjd   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          <span class="token number">11</span>m
</code></pre> 
<p>四、检查zabbix数据库的service域名</p> 
<p>1.运行测试pod</p> 
<pre><code class="prism language-clike"><span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master <span class="token operator">~</span><span class="token punctuation">]</span># kubectl run busybox <span class="token operator">--</span>image<span class="token operator">=</span>busybox<span class="token punctuation">:</span><span class="token number">1.28</span> <span class="token operator">--</span> sleep <span class="token number">3600</span>
pod<span class="token operator">/</span>busybox created
</code></pre> 
<p>2.进入busybox的pod</p> 
<pre><code class="prism language-clike"><span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master <span class="token operator">~</span><span class="token punctuation">]</span># kubectl exec <span class="token operator">-</span>it busybox <span class="token operator">--</span> <span class="token operator">/</span>bin<span class="token operator">/</span>sh
<span class="token operator">/</span> #
</code></pre> 
<p>3.查看域名解析</p> 
<pre><code class="prism language-clike"><span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master <span class="token operator">~</span><span class="token punctuation">]</span># kubectl exec <span class="token operator">-</span>it busybox <span class="token operator">--</span> <span class="token operator">/</span>bin<span class="token operator">/</span>sh
<span class="token operator">/</span> # nslookup zabbixdb<span class="token punctuation">.</span>zabbix<span class="token punctuation">.</span>svc<span class="token punctuation">.</span>cluster<span class="token punctuation">.</span>local
Server<span class="token punctuation">:</span>    <span class="token number">10.96</span><span class="token number">.0</span><span class="token number">.10</span>
Address <span class="token number">1</span><span class="token punctuation">:</span> <span class="token number">10.96</span><span class="token number">.0</span><span class="token number">.10</span> kube<span class="token operator">-</span>dns<span class="token punctuation">.</span>kube<span class="token operator">-</span>system<span class="token punctuation">.</span>svc<span class="token punctuation">.</span>cluster<span class="token punctuation">.</span>local
</code></pre> 
<pre><code class="prism language-clike">Name<span class="token punctuation">:</span>      zabbixdb<span class="token punctuation">.</span>zabbix<span class="token punctuation">.</span>svc<span class="token punctuation">.</span>cluster<span class="token punctuation">.</span>local
Address <span class="token number">1</span><span class="token punctuation">:</span> <span class="token number">10.96</span><span class="token number">.1</span><span class="token number">.99</span> zabbixdb<span class="token punctuation">.</span>zabbix<span class="token punctuation">.</span>svc<span class="token punctuation">.</span>cluster<span class="token punctuation">.</span>local
<span class="token operator">/</span> #
</code></pre> 
<p>五、安装zabbix-server</p> 
<p>1.编写zabbix_server.yaml文件</p> 
<pre><code class="prism language-clike"><span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master zabbix<span class="token punctuation">]</span># cat zabbix_server<span class="token punctuation">.</span>yaml 
apiVersion<span class="token punctuation">:</span> apps<span class="token operator">/</span>v1
kind<span class="token punctuation">:</span> Deployment
metadata<span class="token punctuation">:</span>
  creationTimestamp<span class="token punctuation">:</span> <span class="token keyword">null</span>
  labels<span class="token punctuation">:</span>
    app<span class="token punctuation">:</span> zabbix<span class="token operator">-</span>server
  name<span class="token punctuation">:</span> zabbix<span class="token operator">-</span>server
  namespace<span class="token punctuation">:</span> zabbix
spec<span class="token punctuation">:</span>
  replicas<span class="token punctuation">:</span> <span class="token number">1</span>
  selector<span class="token punctuation">:</span>
    matchLabels<span class="token punctuation">:</span>
      app<span class="token punctuation">:</span> zabbix<span class="token operator">-</span>server
  strategy<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
  template<span class="token punctuation">:</span>
    metadata<span class="token punctuation">:</span>
      creationTimestamp<span class="token punctuation">:</span> <span class="token keyword">null</span>
      labels<span class="token punctuation">:</span>
        app<span class="token punctuation">:</span> zabbix<span class="token operator">-</span>server
    spec<span class="token punctuation">:</span>
      volumes<span class="token punctuation">:</span>
      <span class="token operator">-</span> name<span class="token punctuation">:</span> zabbix<span class="token operator">-</span>scripts
        hostPath<span class="token punctuation">:</span>
          path<span class="token punctuation">:</span> <span class="token operator">/</span>usr<span class="token operator">/</span>lib<span class="token operator">/</span>zabbix<span class="token operator">/</span>
      <span class="token operator">-</span> name<span class="token punctuation">:</span> zabbix<span class="token operator">-</span>file
        hostPath<span class="token punctuation">:</span>
          path<span class="token punctuation">:</span> <span class="token operator">/</span>var<span class="token operator">/</span>lib<span class="token operator">/</span>zabbix 
      nodeSelector<span class="token punctuation">:</span>
        zabbix<span class="token operator">-</span>server<span class="token punctuation">:</span> <span class="token string">"true"</span>
      hostNetwork<span class="token punctuation">:</span> <span class="token boolean">true</span>
      containers<span class="token punctuation">:</span>
      <span class="token operator">-</span> image<span class="token punctuation">:</span> zabbix<span class="token operator">/</span>zabbix<span class="token operator">-</span>server<span class="token operator">-</span>mysql<span class="token punctuation">:</span><span class="token number">6.0</span><span class="token operator">-</span>ubuntu<span class="token operator">-</span>latest
        name<span class="token punctuation">:</span> zabbix<span class="token operator">-</span>server<span class="token operator">-</span>mysql
        env<span class="token punctuation">:</span>
        <span class="token operator">-</span> name<span class="token punctuation">:</span> DB_SERVER_HOST
          value<span class="token punctuation">:</span>  <span class="token number">10.96</span><span class="token number">.1</span><span class="token number">.99</span>
        <span class="token operator">-</span> name<span class="token punctuation">:</span> MYSQL_USER
          value<span class="token punctuation">:</span> zabbix
        <span class="token operator">-</span> name<span class="token punctuation">:</span> MYSQL_PASSWORD
          value<span class="token punctuation">:</span> zabbix
        resources<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
status<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
</code></pre> 
<p>2.给node02节点打上标签</p> 
<pre><code class="prism language-clike"><span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master zabbix<span class="token punctuation">]</span># kubectl label nodes k8s<span class="token operator">-</span>node02  zabbix<span class="token operator">-</span>server<span class="token operator">=</span><span class="token boolean">true</span>
node<span class="token operator">/</span>k8s<span class="token operator">-</span>node02 labeled
</code></pre> 
<p>3.安装zabbix-server</p> 
<pre><code class="prism language-clike"><span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master zabbix<span class="token punctuation">]</span># kubectl apply <span class="token operator">-</span>f zabbix_server<span class="token punctuation">.</span>yaml 
deployment<span class="token punctuation">.</span>apps<span class="token operator">/</span>zabbix<span class="token operator">-</span>server created
</code></pre> 
<p>4.检查pod状态</p> 
<pre><code class="prism language-clike"><span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master zabbix<span class="token punctuation">]</span># kubectl get pods <span class="token operator">-</span>n zabbix
NAME                             READY   STATUS    RESTARTS   AGE
zabbix<span class="token operator">-</span>server<span class="token operator">-</span><span class="token number">5</span>f48d9d57d<span class="token operator">-</span>rkr5p   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          <span class="token number">66</span>s
zabbixdb<span class="token operator">-</span><span class="token number">69</span>b7cd8dff<span class="token operator">-</span>krt2w        <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          <span class="token number">4</span>m22s
</code></pre> 
<p>六、部署zabbix-web</p> 
<p>1.编写zabbix_web.yaml文件</p> 
<pre><code class="prism language-clike"><span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master zabbix<span class="token punctuation">]</span># cat zabbix_web<span class="token punctuation">.</span>yaml 
apiVersion<span class="token punctuation">:</span> apps<span class="token operator">/</span>v1
kind<span class="token punctuation">:</span> Deployment
metadata<span class="token punctuation">:</span>
  creationTimestamp<span class="token punctuation">:</span> <span class="token keyword">null</span>
  labels<span class="token punctuation">:</span>
    app<span class="token punctuation">:</span> zabbix<span class="token operator">-</span>web
  name<span class="token punctuation">:</span> zabbix<span class="token operator">-</span>web
  namespace<span class="token punctuation">:</span> zabbix
spec<span class="token punctuation">:</span>
  replicas<span class="token punctuation">:</span> <span class="token number">1</span>
  selector<span class="token punctuation">:</span>
    matchLabels<span class="token punctuation">:</span>
      app<span class="token punctuation">:</span> zabbix<span class="token operator">-</span>web
  strategy<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
  template<span class="token punctuation">:</span>
    metadata<span class="token punctuation">:</span>
      creationTimestamp<span class="token punctuation">:</span> <span class="token keyword">null</span>
      labels<span class="token punctuation">:</span>
        app<span class="token punctuation">:</span> zabbix<span class="token operator">-</span>web
    spec<span class="token punctuation">:</span>
      containers<span class="token punctuation">:</span>
      <span class="token operator">-</span> image<span class="token punctuation">:</span> zabbix<span class="token operator">/</span>zabbix<span class="token operator">-</span>web<span class="token operator">-</span>nginx<span class="token operator">-</span>mysql<span class="token punctuation">:</span><span class="token number">6.0</span><span class="token operator">-</span>ubuntu<span class="token operator">-</span>latest
        name<span class="token punctuation">:</span> zabbix<span class="token operator">-</span>web<span class="token operator">-</span>nginx<span class="token operator">-</span>mysql
        env<span class="token punctuation">:</span>
        <span class="token operator">-</span> name<span class="token punctuation">:</span> DB_SERVER_HOST
          value<span class="token punctuation">:</span> zabbixdb<span class="token punctuation">.</span>zabbix<span class="token punctuation">.</span>svc<span class="token punctuation">.</span>cluster<span class="token punctuation">.</span>local
        <span class="token operator">-</span> name<span class="token punctuation">:</span> MYSQL_USER
          value<span class="token punctuation">:</span> zabbix
        <span class="token operator">-</span> name<span class="token punctuation">:</span> MYSQL_PASSWORD
          value<span class="token punctuation">:</span> zabbix
        <span class="token operator">-</span> name<span class="token punctuation">:</span> ZBX_SERVER_HOST
          value<span class="token punctuation">:</span> <span class="token number">192.168</span><span class="token number">.3</span><span class="token number">.201</span>
        <span class="token operator">-</span> name<span class="token punctuation">:</span> PHP_TZ
          value<span class="token punctuation">:</span> Asia<span class="token operator">/</span>shanghai
        resources<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
status<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
<span class="token operator">--</span><span class="token operator">-</span>
apiVersion<span class="token punctuation">:</span> v1
kind<span class="token punctuation">:</span> Service
metadata<span class="token punctuation">:</span>
  creationTimestamp<span class="token punctuation">:</span> <span class="token keyword">null</span>
  labels<span class="token punctuation">:</span>
    app<span class="token punctuation">:</span> zabbix<span class="token operator">-</span>web
  name<span class="token punctuation">:</span> zabbix<span class="token operator">-</span>web
  namespace<span class="token punctuation">:</span> zabbix
spec<span class="token punctuation">:</span>
  ports<span class="token punctuation">:</span>
  <span class="token operator">-</span> name<span class="token punctuation">:</span> <span class="token number">8080</span><span class="token operator">-</span><span class="token number">8080</span>
    port<span class="token punctuation">:</span> <span class="token number">8080</span>
    protocol<span class="token punctuation">:</span> TCP
    targetPort<span class="token punctuation">:</span> <span class="token number">8080</span>
  selector<span class="token punctuation">:</span>
    app<span class="token punctuation">:</span> zabbix<span class="token operator">-</span>web
  type<span class="token punctuation">:</span> NodePort
status<span class="token punctuation">:</span>
  loadBalancer<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
</code></pre> 
<p>2.安装zabbix-web</p> 
<pre><code class="prism language-clike"><span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master zabbix<span class="token punctuation">]</span># kubectl apply <span class="token operator">-</span>f zabbix_web<span class="token punctuation">.</span>yaml 
deployment<span class="token punctuation">.</span>apps<span class="token operator">/</span>zabbix<span class="token operator">-</span>web created
service<span class="token operator">/</span>zabbix<span class="token operator">-</span>web created
</code></pre> 
<p>3.查看pod状态</p> 
<pre><code class="prism language-clike"><span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master zabbix<span class="token punctuation">]</span># kubectl get pods <span class="token operator">-</span>n zabbix
NAME                             READY   STATUS    RESTARTS   AGE
zabbix<span class="token operator">-</span>server<span class="token operator">-</span><span class="token number">5</span>f48d9d57d<span class="token operator">-</span>rkr5p   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          <span class="token number">2</span>m36s
zabbix<span class="token operator">-</span>web<span class="token operator">-</span><span class="token number">55</span>cd66f74f<span class="token operator">-</span><span class="token number">9</span>f284      <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          <span class="token number">18</span>s
zabbixdb<span class="token operator">-</span><span class="token number">69</span>b7cd8dff<span class="token operator">-</span>krt2w        <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          <span class="token number">5</span>m52s
</code></pre> 
<p>七、部署zabbix-agent</p> 
<p>1.编辑zabbix_agent.yaml</p> 
<pre><code class="prism language-clike"><span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master zabbix<span class="token punctuation">]</span># cat zabbix_agent<span class="token punctuation">.</span>yaml 
apiVersion<span class="token punctuation">:</span> apps<span class="token operator">/</span>v1
kind<span class="token punctuation">:</span> DaemonSet
metadata<span class="token punctuation">:</span>
  labels<span class="token punctuation">:</span>
    app<span class="token punctuation">:</span> zabbix<span class="token operator">-</span>agent
  name<span class="token punctuation">:</span> zabbix<span class="token operator">-</span>agent
  namespace<span class="token punctuation">:</span> zabbix
spec<span class="token punctuation">:</span>
  selector<span class="token punctuation">:</span>
    matchLabels<span class="token punctuation">:</span>
      app<span class="token punctuation">:</span> zabbix<span class="token operator">-</span>agent
  template<span class="token punctuation">:</span>
    metadata<span class="token punctuation">:</span>
      creationTimestamp<span class="token punctuation">:</span> <span class="token keyword">null</span>
      labels<span class="token punctuation">:</span>
        app<span class="token punctuation">:</span> zabbix<span class="token operator">-</span>agent
    spec<span class="token punctuation">:</span>
      hostNetwork<span class="token punctuation">:</span> <span class="token boolean">true</span>
      containers<span class="token punctuation">:</span>
      <span class="token operator">-</span> image<span class="token punctuation">:</span> zabbix<span class="token operator">/</span>zabbix<span class="token operator">-</span>agent<span class="token punctuation">:</span><span class="token number">6.0</span><span class="token operator">-</span>ubuntu<span class="token operator">-</span>latest
        name<span class="token punctuation">:</span> zabbix<span class="token operator">-</span>agent
        env<span class="token punctuation">:</span>
        <span class="token operator">-</span> name<span class="token punctuation">:</span> ZBX_SERVER_HOST
          value<span class="token punctuation">:</span> <span class="token number">192.168</span><span class="token number">.3</span><span class="token number">.201</span>
        resources<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
</code></pre> 
<p>2.安装zabbix-agent</p> 
<pre><code class="prism language-clike">kubectl apply <span class="token operator">-</span>f zabbix_agent<span class="token punctuation">.</span>yaml
</code></pre> 
<p>3.查看pod状态</p> 
<pre><code class="prism language-clike"><span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master zabbix<span class="token punctuation">]</span># kubectl get pods <span class="token operator">-</span>n zabbix
NAME                             READY   STATUS    RESTARTS   AGE
zabbix<span class="token operator">-</span>agent<span class="token operator">-</span>h2qwf               <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          <span class="token number">3</span>s
zabbix<span class="token operator">-</span>agent<span class="token operator">-</span>plnbd               <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          <span class="token number">3</span>s
zabbix<span class="token operator">-</span>server<span class="token operator">-</span><span class="token number">5</span>f48d9d57d<span class="token operator">-</span>rkr5p   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          <span class="token number">3</span>m2s
zabbix<span class="token operator">-</span>web<span class="token operator">-</span><span class="token number">55</span>cd66f74f<span class="token operator">-</span><span class="token number">9</span>f284      <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          <span class="token number">44</span>s
zabbixdb<span class="token operator">-</span><span class="token number">69</span>b7cd8dff<span class="token operator">-</span>krt2w        <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          <span class="token number">6</span>m18s
</code></pre> 
<p>八、访问zabbix的web</p> 
<p>1.查看svc</p> 
<pre><code class="prism language-clike"><span class="token punctuation">[</span>root@k8s<span class="token operator">-</span>master zabbix<span class="token punctuation">]</span>#  kubectl get svc <span class="token operator">-</span>n zabbix 
NAME         TYPE        CLUSTER<span class="token operator">-</span>IP    EXTERNAL<span class="token operator">-</span>IP   <span class="token function">PORT</span><span class="token punctuation">(</span>S<span class="token punctuation">)</span>          AGE
zabbix<span class="token operator">-</span>web   NodePort    <span class="token number">10.100</span><span class="token number">.50</span><span class="token number">.7</span>   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">8080</span><span class="token punctuation">:</span><span class="token number">30775</span><span class="token operator">/</span>TCP   <span class="token number">59</span>s
zabbixdb     ClusterIP   <span class="token number">10.96</span><span class="token number">.1</span><span class="token number">.99</span>    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">3306</span><span class="token operator">/</span>TCP         <span class="token number">6</span>m33s
</code></pre> 
<p>2.登录web</p> 
<pre><code class="prism language-clike">http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.3</span><span class="token number">.202</span><span class="token punctuation">:</span><span class="token number">30775</span>
</code></pre> 
<p>3.登录zabbix</p> 
<pre><code class="prism language-clike">初始账号admin<span class="token operator">/</span>zabbix
</code></pre> 
<p>4.查询zabbix-server的监控项图表</p> 
<p><img src="https://images2.imgbox.com/88/03/kN4ncahy_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/55/f7/X4FNXgBZ_o.png" alt="在这里插入图片描述"></p> 
<p>转载自：https://blog.csdn.net/jks212454/article/details/125624373</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/17ec3b8f001dc1b82090ad812cf7ed13/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Java Thread.yield()方法具有什么功能呢？</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7f52494ad1a08e5b3bde374cac4b2cd8/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Security ❀ 安全设备学习规范（第二版）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>