<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>MVP模式学习 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="MVP模式学习" />
<meta property="og:description" content="参考文档：
1：https://www.jianshu.com/p/fee58fe60a2d
1：MVP详解 1：简介 MVP全称是Model View Presenter。
M：业务模型；
V：用户界面；
P：主持者，Model和View之间的桥梁。
2：MVP核心思想 把Activity中的UI逻辑抽象成View接口，把业务逻辑抽象成Presenter接口，Model类还是原来的Model类。
3：MVP的作用 1：分离视图逻辑和业务逻辑，降低耦合；
2：Activity只处理生命周期的任务，代码简洁；
3：视图逻辑和业务逻辑抽象到了View和Presenter中，提高阅读性；
4：Presenter被抽象成接口，可以有多种具体的实现；
5：业务逻辑在Presenter中，避免后台线程引用Activity导致内存泄漏；
2：MVP实现实例 1：添加契约&amp;协议 public interface DownloaderContract { interface Model { //p层告诉M层，需要做什么事情 void requestDownloader(ImageBean imageBean) throws Exception; } interface PresenterView { //View层告诉Presenter层做什么事情 void requestDownloader(ImageBean imageBean); //Presenter层从Model层的结果返回，在通知View层 void responseDownloaderReult(boolean isSuccess, ImageBean imageBean); } } 2：定义数据model public class ImageBean { //图片请求地址 private String requestPath; //结果返回图片 private Bitmap bitmap; public String getRequestPath() { return requestPath; } public void setRequestPath(String requestPath) { this." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/2447a77476e53ba81d682f50cefc3ea1/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-04-18T14:15:28+08:00" />
<meta property="article:modified_time" content="2021-04-18T14:15:28+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">MVP模式学习</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>参考文档：</p> 
<p>1：<a href="https://www.jianshu.com/p/fee58fe60a2d" rel="nofollow">https://www.jianshu.com/p/fee58fe60a2d</a></p> 
<p> </p> 
<h3 id="msUPV">1：MVP详解</h3> 
<h4 id="go7gx">1：简介</h4> 
<p>MVP全称是Model View Presenter。</p> 
<p>M：业务模型；</p> 
<p>V：用户界面；</p> 
<p>P：主持者，Model和View之间的桥梁。</p> 
<p><img alt="25021128-909fac1dbd247bbc.png" src="https://images2.imgbox.com/f5/7a/XrTTXbf7_o.png"></p> 
<p> </p> 
<h4 id="6WNZI">2：MVP核心思想</h4> 
<p>把Activity中的UI逻辑抽象成View接口，把业务逻辑抽象成Presenter接口，Model类还是原来的Model类。</p> 
<p> </p> 
<h4 id="e8nHF">3：MVP的作用</h4> 
<p>1：分离视图逻辑和业务逻辑，降低耦合；</p> 
<p>2：Activity只处理生命周期的任务，代码简洁；</p> 
<p>3：视图逻辑和业务逻辑抽象到了View和Presenter中，提高阅读性；</p> 
<p>4：Presenter被抽象成接口，可以有多种具体的实现；</p> 
<p>5：业务逻辑在Presenter中，避免后台线程引用Activity导致内存泄漏；</p> 
<p> </p> 
<h3 id="TzqmS">2：MVP实现实例</h3> 
<h4 id="ohtVS">1：添加契约&amp;协议</h4> 
<blockquote> 
 <pre>public interface DownloaderContract {
    interface Model {
        //p层告诉M层，需要做什么事情
        void requestDownloader(ImageBean imageBean) throws Exception;
    }

    interface PresenterView {
        //View层告诉Presenter层做什么事情
        void requestDownloader(ImageBean imageBean);

        //Presenter层从Model层的结果返回，在通知View层
        void responseDownloaderReult(boolean isSuccess, ImageBean imageBean);
    }

}
</pre> 
</blockquote> 
<h4 id="4mWvR">2：定义数据model</h4> 
<blockquote> 
 <pre>public class ImageBean {

    //图片请求地址
    private String requestPath;

    //结果返回图片
    private Bitmap bitmap;

    public String getRequestPath() {
        return requestPath;
    }

    public void setRequestPath(String requestPath) {
        this.requestPath = requestPath;
    }

    public Bitmap getBitmap() {
        return bitmap;
    }

    public void setBitmap(Bitmap bitmap) {
        this.bitmap = bitmap;
    }
}</pre> 
</blockquote> 
<h4 id="g67gp">3：发布层presenter的实现类</h4> 
<blockquote> 
 <pre>public class DownLoaderPresenter implements DownloaderContract.PresenterView {

    private WeakReference&lt;DownloaderContract.PresenterView&gt; view;
    private DownloaderEngine model;//处理事情的模型

    public DownLoaderPresenter(DownloaderContract.PresenterView view){
        this.view = new WeakReference&lt;&gt;(view);
        model = new DownloaderEngine(this);
    }

    @Override
    public void requestDownloader(ImageBean imageBean) {
        //接收到view层的指令，去完成某个需求
        try{
            model.requestDownloader(imageBean);
        }catch (Exception e){
            e.printStackTrace();
        }
    }

    @Override
    public void responseDownloaderReult(final boolean isSuccess, final ImageBean imageBean) {
       ((Activity)view.get()).runOnUiThread(new Runnable() {
            @Override
            public void run() {
                view.get().responseDownloaderReult(isSuccess, imageBean);
            }
        });
    }
}</pre> 
</blockquote> 
<h4 id="EHYOa">4：发布层需用处理的功能模块</h4> 
<blockquote> 
 <pre>public class DownloaderEngine implements DownloaderContract.Model {

    private DownLoaderPresenter presenter;

    public DownloaderEngine(DownLoaderPresenter downLoaderPresenter) {
        this.presenter = downLoaderPresenter;
    }

    @Override
    public void requestDownloader(ImageBean imageBean) throws Exception {
        //p层让我做这个需求
        new Thread(new DownLoadr(imageBean)).start();
    }

    final class DownLoadr implements Runnable {

        private final ImageBean imageBean;

        public DownLoadr(ImageBean imageBean) {
            this.imageBean = imageBean;
        }

        @Override
        public void run() {
            try{
                URL url = new URL(imageBean.getRequestPath());
                HttpURLConnection httpURLConnection = (HttpURLConnection) url.openConnection();
                httpURLConnection.setConnectTimeout(5000);
                httpURLConnection.setRequestMethod("GET");

                if(httpURLConnection.getResponseCode() == HttpURLConnection.HTTP_OK){
                    InputStream inputStream = httpURLConnection.getInputStream();
                    Bitmap bitmap = BitmapFactory.decodeStream(inputStream);
                    showUi(Constant.SUCCESS, bitmap);
                }else{
                    showUi(Constant.ERROR, null);
                }

            }catch (Exception e){
                e.printStackTrace();
                showUi(Constant.ERROR,null);
            }
        }

        private void showUi(int error, Bitmap bitmap) {
            imageBean.setBitmap(bitmap);
            presenter.responseDownloaderReult(error == Constant.SUCCESS, imageBean);
        }
    }

}</pre> 
</blockquote> 
<h4 id="mbAgK">5：数据处理完成后更新视图</h4> 
<blockquote> 
 <pre>public class MpvWorkModeActivity extends AppCompatActivity implements DownloaderContract.PresenterView {

    private ImageView imageView;
    private DownLoaderPresenter presenter;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_mpv_work_mode);

        imageView = findViewById(R.id.iv);
        presenter = new DownLoaderPresenter(this);
    }

    @Override
    public void requestDownloader(ImageBean imageBean) {
        if(presenter != null) presenter.requestDownloader(imageBean);
    }

    @Override
    public void responseDownloaderReult(boolean isSuccess, ImageBean imageBean) {
        Toast.makeText(this,isSuccess?"下载成功":"下载失败", Toast.LENGTH_SHORT).show();

        if(isSuccess &amp;&amp; imageBean.getBitmap() != null){
            imageView.setImageBitmap(imageBean.getBitmap());
        }
    }

    public void down(View view) {
        ImageBean imageBean = new ImageBean();
        imageBean.setRequestPath(Constant.IMAGE_PATH);

        requestDownloader(imageBean);
    }
}</pre> 
</blockquote> 
<h4 id="UcqWD">6：工具类的补充</h4> 
<blockquote> 
 <pre>public class Constant {

    //网络图片地址
    public static final String IMAGE_PATH = "https://www.baidu.com/img/PCfb_5bf082d29588c07f842ccde3f97243ea.png";
    //成功
    public static final int SUCCESS = 200;
    //失败
    public static final int ERROR = 404;
}</pre> 
</blockquote> 
<h4 id="zq7mk">7：注意事项</h4> 
<p>以上代码中，使用到了弱引用，可以防止用户关闭activity导致的内存泄露问题</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c7a046b9c2a96b9d02e5e6944b817e17/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">RK fb源码分析（转载）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b5b399a91b0eaabc311016b72e417263/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Java IllegalArgumentException:Invalid character found in the request target问题解决</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>