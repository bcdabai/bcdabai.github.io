<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>银行客户流失分析 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="银行客户流失分析" />
<meta property="og:description" content="银行客户流失分析 摘要研究背景研究目标分析流程 数据探索与预处理数据探索1、定量变量初探2、分类指标分布情况3、目标变量分布 数据预处理数据清洗1、删除不相关变量2、异常值处理 数据变换1、字符型变量的量化2、连续特征离散化。3、样本不均衡处理4、虚拟变量变换5、特征标准化 特征选择 数据建模和调参模型评价XGBoost模型介绍、调参及评估XGBoost模型介绍XGBoost模型原理XGBoost模型优点 XGBoost模型调参模型评估 关于挽留和关怀客户的建议特征重要性建议 python编程 摘要 摘要
随着互联网金融的异军突起，银行业的竞争愈加激烈，防止客户流失和挽留老客户成为各大银行关心的重要问题。本文首先根据已有数据集对各特征进行描述性统计分析，初步了解数据；之后进行数据预处理，包括数据清洗，数据变换、特征选择；再后用SVM、LR、朴素贝叶斯、决策树、RF、XGBoost、LM神经网络进行建模，通过不同性能度量，选出XGBoost为表现最好的模型并进行调参；最后，根据描述性统计和特征重要性为银行挽留客户提出建议。
关键词：客户流失；数据预处理；XGBoost；调参；建议
研究背景 银行客户流失是指银行的客户不再继续参与原业务、不再重复购买或者终止原先的产品或者服务。近年来，随着互联网金融的异军突起和传统银行业的竞争加剧，银行发展自身潜力、吸引优质顾客、防止客户流失就显得格外重要。研究表明，发展一位新客户所花费的成本要比维持一位老客户的成本多达5到6倍。所以说，在客户流失后，如果企业要去重新发展新客户所需要的成本是巨大的，且大多数新用户产生的利润不如老用户。因此，不管是哪个行业都越来越重视客户流失管理。预测潜在的流失客户、有效挽留和关怀客户是各个企业关心的重要问题之一。
研究目标 1、通过确定客户流失模型，有效预测客户的流失情况。
2、通过预测模型的建立，提出相应建议提高用户的活跃度，实现挽留关怀客户的有效性，降低开展挽留关怀工作的成本。
分析流程 客户流失数据 数据探索与预处理 数据清洗 数据变换 特征选择 建模 训练样本 测试样本 模型评价 数据探索与预处理 本节首先观察样本数据，初步了解属性特征，对各属性进行描述性统计分析，初步探索各属性与客户流失情况的关系；其次进行数据预处理工作，包括异常值处理，数据变换，数据规约等；之后将样本划分为训练集和测试集，观察客户流失情况样本是否均衡，不均衡时需要对训练样本进行均衡化处理；最后，对训练集和测试集进行标准化处理。
数据探索 本次所使用的数据集是某欧洲银行的数据。数据集一共包含了14个变量，10000个样本，不包含缺失值。本数据集可从superdatascience官网下载。首先先来观察数据情况。 图1 数据集变量预览
在图1展示的数据集中，从左到右，数据集所具有的的变量有编号、用户ID、姓名、信用分、地区、性别、年龄、用户时长（使用银行产品时长）、存贷款情况、使用产品数量、是否有信用卡、是否为活跃用户、估计收入、是否已流失。将数据集特征进行汇总，由表1可以清楚地看出特征变量名称和属性。
表1 数据集特征汇总
我们从表1可以看到，数据集一共包含14个变量，其中第14个变量就是我们的目标变量，目标变量定义的是是否已经流失的分类变量，从而确定了本次数据挖掘的目标是分类。除了目标变量外，特征属性中有7个分类变量，其中有5个是字符类型的，这意味着在数据预处理时首先要处理这些变量才能做下一步分析。其余6个是数值变量，我们接下来要注意考虑数值变量是否存在异常值，是否需要进行数据变换。
下面对各变量首先进行描述性统计分析，观察变量分布情况，进一步了解数据。
1、定量变量初探 本小节主要是通过绘制定量变量的频数分布图来观察变量的分布情况，初步了解各变量分布。
图2-1 CreditScore-信用得分频数分布 图2-2 Age-年龄频数分布 图2-3 Tenure-客户使用年数分布 图2-4 Balance-客户存贷款情况 图2-5 NumOfProducts-拥有产品数量 图2-6 EstimateSalary-估计收入 图2 定量变量频数分布图 总体来看图2-1，对于信用分这个属性来说，流失和非流失总体呈现出一个偏正态分布，信用分在650-700之间达到峰值。由图2-2可以看出，年龄呈现出一个偏左态分布。该银行35到40岁的客户最多，在60岁以上的客户很少。且给银行的目标用户大部分年龄在25到45岁之间，比较符合多数银行客户年龄的分布情况。对于该银行，图2-3用户使用年数在1到9年的分布均匀，使用10年的人数最多，使用1年的人数较少。我们可以初步猜测该银行忠诚客户较多，但是在发展新客户方面不够重视或者策略需要调整。;对于客户存贷款情况，该样本数据显现的都是存贷款大于0的情况。从图中可以看出，存款在25000以下的占据大部分。在存款大于25000呈现正态分布。在持有产品数方面，该银行大多数用户使用银行的产品数量为1个或2个，拥有3个或4个产品的极少。说明该银行的产品只有少数具有吸引力，银行应该实施相应措施激励用户使用该银行产品。从图2-6可以看出，该银行客户估计收入在0到200000之间，且不同收入客户分布均匀，猜测该银行并没有清晰的目标客户定位，对不同收入层的客户效用没有差别。
2、分类指标分布情况 对于分类指标，这里展示了不同指标分类的频数分布情况，同时展示了在每种类别下客户流失情况。
图3-1 地区分布和流失情况 图3-2 性别分布和流失情况 图3-3 信用卡分布和流失情况 图3-4 活跃用户分布和流失情况 图3 定类变量频数分布图 图3-1中，在地区这个属性可以看出，样本数据集客户来自三个国家：法国、德国、西班牙。该银行法国用户最多，德国和西班牙客户数量几乎相等，但从流失情况来看，德国用户的流失率明显高过其他两国。从性别来看，图3-2显示，银行的男性用户高于女性，但是女性的流失率要高过男性。在客户是否拥有信用卡来看（图3-3），该银行70%的客户有信用卡，没有信用卡客户的流失率在20%以上，有信用卡的流失率在16%。使用该银行信用卡的用户忠诚度更高。由图3-4知，该银行的活跃客户稍高于非活跃用户，活跃用户的流失率明显低于非活跃用户，这也说明活跃客户较非活跃客户忠诚度更高。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/924858acab46c5b8988339e9cc3449b0/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-07-22T09:12:51+08:00" />
<meta property="article:modified_time" content="2019-07-22T09:12:51+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">银行客户流失分析</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>银行客户流失分析</h4> 
 <ul><li><a href="#_1" rel="nofollow">摘要</a></li><li><a href="#_5" rel="nofollow">研究背景</a></li><li><ul><li><a href="#_7" rel="nofollow">研究目标</a></li><li><a href="#_10" rel="nofollow">分析流程</a></li></ul> 
  </li><li><a href="#_26" rel="nofollow">数据探索与预处理</a></li><li><ul><li><a href="#_28" rel="nofollow">数据探索</a></li><li><ul><li><a href="#1_35" rel="nofollow">1、定量变量初探</a></li><li><a href="#2_55" rel="nofollow">2、分类指标分布情况</a></li><li><a href="#3_73" rel="nofollow">3、目标变量分布</a></li></ul> 
   </li><li><a href="#_76" rel="nofollow">数据预处理</a></li><li><ul><li><a href="#_77" rel="nofollow">数据清洗</a></li><li><ul><li><a href="#1_79" rel="nofollow">1、删除不相关变量</a></li><li><a href="#2_83" rel="nofollow">2、异常值处理</a></li></ul> 
    </li><li><a href="#_102" rel="nofollow">数据变换</a></li><li><ul><li><a href="#1_104" rel="nofollow">1、字符型变量的量化</a></li><li><a href="#2_107" rel="nofollow">2、连续特征离散化。</a></li><li><a href="#3_119" rel="nofollow">3、样本不均衡处理</a></li><li><a href="#4_132" rel="nofollow">4、虚拟变量变换</a></li><li><a href="#5_135" rel="nofollow">5、特征标准化</a></li></ul> 
    </li><li><a href="#_138" rel="nofollow">特征选择</a></li></ul> 
  </li></ul> 
  </li><li><a href="#_154" rel="nofollow">数据建模和调参</a></li><li><ul><li><a href="#_156" rel="nofollow">模型评价</a></li><li><a href="#XGBoost_184" rel="nofollow">XGBoost模型介绍、调参及评估</a></li><li><ul><li><a href="#XGBoost_187" rel="nofollow">XGBoost模型介绍</a></li><li><ul><li><a href="#XGBoost_188" rel="nofollow">XGBoost模型原理</a></li><li><a href="#XGBoost_239" rel="nofollow">XGBoost模型优点</a></li></ul> 
    </li><li><a href="#XGBoost_245" rel="nofollow">XGBoost模型调参</a></li><li><a href="#_260" rel="nofollow">模型评估</a></li></ul> 
  </li></ul> 
  </li><li><a href="#_274" rel="nofollow">关于挽留和关怀客户的建议</a></li><li><ul><li><a href="#_276" rel="nofollow">特征重要性</a></li><li><a href="#_280" rel="nofollow">建议</a></li></ul> 
  </li><li><a href="#python_284" rel="nofollow">python编程</a></li></ul> 
</div> 
<p></p> 
<h2><a id="_1"></a>摘要</h2> 
<p>                    摘要<br>   随着互联网金融的异军突起，银行业的竞争愈加激烈，防止客户流失和挽留老客户成为各大银行关心的重要问题。本文首先根据已有数据集对各特征进行描述性统计分析，初步了解数据；之后进行数据预处理，包括数据清洗，数据变换、特征选择；再后用SVM、LR、朴素贝叶斯、决策树、RF、XGBoost、LM神经网络进行建模，通过不同性能度量，选出XGBoost为表现最好的模型并进行调参；最后，根据描述性统计和特征重要性为银行挽留客户提出建议。<br> 关键词：客户流失；数据预处理；XGBoost；调参；建议</p> 
<h2><a id="_5"></a>研究背景</h2> 
<p>  银行客户流失是指银行的客户不再继续参与原业务、不再重复购买或者终止原先的产品或者服务。近年来，随着互联网金融的异军突起和传统银行业的竞争加剧，银行发展自身潜力、吸引优质顾客、防止客户流失就显得格外重要。研究表明，发展一位新客户所花费的成本要比维持一位老客户的成本多达5到6倍。所以说，在客户流失后，如果企业要去重新发展新客户所需要的成本是巨大的，且大多数新用户产生的利润不如老用户。因此，不管是哪个行业都越来越重视客户流失管理。预测潜在的流失客户、有效挽留和关怀客户是各个企业关心的重要问题之一。</p> 
<h3><a id="_7"></a>研究目标</h3> 
<p>1、通过确定客户流失模型，有效预测客户的流失情况。<br> 2、通过预测模型的建立，提出相应建议提高用户的活跃度，实现挽留关怀客户的有效性，降低开展挽留关怀工作的成本。</p> 
<h3><a id="_10"></a>分析流程</h3> 
<div class="mermaid"> 
 <svg xmlns="http://www.w3.org/2000/svg" id="mermaid-svg-KbrdwtmHt39l2xdF" height="278" width="858" viewbox="0 0 878 298"> 
  <g> 
   <g class="output"> 
    <g class="clusters"></g> 
    <g class="edgePaths"> 
     <g class="edgePath" style="opacity: 1;"> 
      <path class="path" d="M136,139L161,139L186,139" marker-end="url(#arrowhead162)" style="fill:none"></path> 
      <defs> 
       <marker id="arrowhead162" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"> 
        <path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path> 
       </marker> 
      </defs> 
     </g> 
     <g class="edgePath" style="opacity: 1;"> 
      <path class="path" d="M283.71875,116L359,43L384,43" marker-end="url(#arrowhead163)" style="fill:none"></path> 
      <defs> 
       <marker id="arrowhead163" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"> 
        <path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path> 
       </marker> 
      </defs> 
     </g> 
     <g class="edgePath" style="opacity: 1;"> 
      <path class="path" d="M334,139L359,139L384,139" marker-end="url(#arrowhead164)" style="fill:none"></path> 
      <defs> 
       <marker id="arrowhead164" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"> 
        <path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path> 
       </marker> 
      </defs> 
     </g> 
     <g class="edgePath" style="opacity: 1;"> 
      <path class="path" d="M283.71875,162L359,235L384,235" marker-end="url(#arrowhead165)" style="fill:none"></path> 
      <defs> 
       <marker id="arrowhead165" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"> 
        <path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path> 
       </marker> 
      </defs> 
     </g> 
     <g class="edgePath" style="opacity: 1;"> 
      <path class="path" d="M468,43L493,43L531.78125,116" marker-end="url(#arrowhead166)" style="fill:none"></path> 
      <defs> 
       <marker id="arrowhead166" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"> 
        <path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path> 
       </marker> 
      </defs> 
     </g> 
     <g class="edgePath" style="opacity: 1;"> 
      <path class="path" d="M468,139L493,139L518,139" marker-end="url(#arrowhead167)" style="fill:none"></path> 
      <defs> 
       <marker id="arrowhead167" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"> 
        <path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path> 
       </marker> 
      </defs> 
     </g> 
     <g class="edgePath" style="opacity: 1;"> 
      <path class="path" d="M468,235L493,235L531.78125,162" marker-end="url(#arrowhead168)" style="fill:none"></path> 
      <defs> 
       <marker id="arrowhead168" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"> 
        <path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path> 
       </marker> 
      </defs> 
     </g> 
     <g class="edgePath" style="opacity: 1;"> 
      <path class="path" d="M568.4375,116L595,91L620,91" marker-end="url(#arrowhead169)" style="fill:none"></path> 
      <defs> 
       <marker id="arrowhead169" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"> 
        <path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path> 
       </marker> 
      </defs> 
     </g> 
     <g class="edgePath" style="opacity: 1;"> 
      <path class="path" d="M568.4375,162L595,187L620,187" marker-end="url(#arrowhead170)" style="fill:none"></path> 
      <defs> 
       <marker id="arrowhead170" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"> 
        <path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path> 
       </marker> 
      </defs> 
     </g> 
     <g class="edgePath" style="opacity: 1;"> 
      <path class="path" d="M704,91L729,91L763.8958333333334,116" marker-end="url(#arrowhead171)" style="fill:none"></path> 
      <defs> 
       <marker id="arrowhead171" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"> 
        <path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path> 
       </marker> 
      </defs> 
     </g> 
     <g class="edgePath" style="opacity: 1;"> 
      <path class="path" d="M704,187L729,187L763.8958333333334,162" marker-end="url(#arrowhead172)" style="fill:none"></path> 
      <defs> 
       <marker id="arrowhead172" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"> 
        <path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path> 
       </marker> 
      </defs> 
     </g> 
    </g> 
    <g class="edgeLabels"> 
     <g class="edgeLabel" style="opacity: 1;" transform=""> 
      <g transform="translate(0,0)" class="label"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" style="opacity: 1;" transform=""> 
      <g transform="translate(0,0)" class="label"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" style="opacity: 1;" transform=""> 
      <g transform="translate(0,0)" class="label"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" style="opacity: 1;" transform=""> 
      <g transform="translate(0,0)" class="label"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" style="opacity: 1;" transform=""> 
      <g transform="translate(0,0)" class="label"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" style="opacity: 1;" transform=""> 
      <g transform="translate(0,0)" class="label"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" style="opacity: 1;" transform=""> 
      <g transform="translate(0,0)" class="label"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" style="opacity: 1;" transform=""> 
      <g transform="translate(0,0)" class="label"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" style="opacity: 1;" transform=""> 
      <g transform="translate(0,0)" class="label"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" style="opacity: 1;" transform=""> 
      <g transform="translate(0,0)" class="label"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" style="opacity: 1;" transform=""> 
      <g transform="translate(0,0)" class="label"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
    </g> 
    <g class="nodes"> 
     <g class="node" style="opacity: 1;" id="A" transform="translate(78,139)"> 
      <rect rx="5" ry="5" x="-58" y="-23" width="116" height="46"></rect> 
      <g class="label" transform="translate(0,0)"> 
       <g transform="translate(-48,-13)"> 
        <foreignobject width="96" height="26"> 
         <div style="display: inline-block; white-space: nowrap;">
           客户流失数据 
         </div> 
        </foreignobject> 
       </g> 
      </g> 
     </g> 
     <g class="node" style="opacity: 1;" id="B" transform="translate(260,139)"> 
      <rect rx="5" ry="5" x="-74" y="-23" width="148" height="46"></rect> 
      <g class="label" transform="translate(0,0)"> 
       <g transform="translate(-64,-13)"> 
        <foreignobject width="128" height="26"> 
         <div style="display: inline-block; white-space: nowrap;">
           数据探索与预处理 
         </div> 
        </foreignobject> 
       </g> 
      </g> 
     </g> 
     <g class="node" style="opacity: 1;" id="C" transform="translate(426,43)"> 
      <rect rx="0" ry="0" x="-42" y="-23" width="84" height="46"></rect> 
      <g class="label" transform="translate(0,0)"> 
       <g transform="translate(-32,-13)"> 
        <foreignobject width="64" height="26"> 
         <div style="display: inline-block; white-space: nowrap;">
           数据清洗 
         </div> 
        </foreignobject> 
       </g> 
      </g> 
     </g> 
     <g class="node" style="opacity: 1;" id="D" transform="translate(426,139)"> 
      <rect rx="0" ry="0" x="-42" y="-23" width="84" height="46"></rect> 
      <g class="label" transform="translate(0,0)"> 
       <g transform="translate(-32,-13)"> 
        <foreignobject width="64" height="26"> 
         <div style="display: inline-block; white-space: nowrap;">
           数据变换 
         </div> 
        </foreignobject> 
       </g> 
      </g> 
     </g> 
     <g class="node" style="opacity: 1;" id="I" transform="translate(426,235)"> 
      <rect rx="0" ry="0" x="-42" y="-23" width="84" height="46"></rect> 
      <g class="label" transform="translate(0,0)"> 
       <g transform="translate(-32,-13)"> 
        <foreignobject width="64" height="26"> 
         <div style="display: inline-block; white-space: nowrap;">
           特征选择 
         </div> 
        </foreignobject> 
       </g> 
      </g> 
     </g> 
     <g class="node" style="opacity: 1;" id="E" transform="translate(544,139)"> 
      <rect rx="5" ry="5" x="-26" y="-23" width="52" height="46"></rect> 
      <g class="label" transform="translate(0,0)"> 
       <g transform="translate(-16,-13)"> 
        <foreignobject width="32" height="26"> 
         <div style="display: inline-block; white-space: nowrap;">
           建模 
         </div> 
        </foreignobject> 
       </g> 
      </g> 
     </g> 
     <g class="node" style="opacity: 1;" id="F" transform="translate(662,91)"> 
      <rect rx="0" ry="0" x="-42" y="-23" width="84" height="46"></rect> 
      <g class="label" transform="translate(0,0)"> 
       <g transform="translate(-32,-13)"> 
        <foreignobject width="64" height="26"> 
         <div style="display: inline-block; white-space: nowrap;">
           训练样本 
         </div> 
        </foreignobject> 
       </g> 
      </g> 
     </g> 
     <g class="node" style="opacity: 1;" id="G" transform="translate(662,187)"> 
      <rect rx="0" ry="0" x="-42" y="-23" width="84" height="46"></rect> 
      <g class="label" transform="translate(0,0)"> 
       <g transform="translate(-32,-13)"> 
        <foreignobject width="64" height="26"> 
         <div style="display: inline-block; white-space: nowrap;">
           测试样本 
         </div> 
        </foreignobject> 
       </g> 
      </g> 
     </g> 
     <g class="node" style="opacity: 1;" id="H" transform="translate(796,139)"> 
      <rect rx="5" ry="5" x="-42" y="-23" width="84" height="46"></rect> 
      <g class="label" transform="translate(0,0)"> 
       <g transform="translate(-32,-13)"> 
        <foreignobject width="64" height="26"> 
         <div style="display: inline-block; white-space: nowrap;">
           模型评价 
         </div> 
        </foreignobject> 
       </g> 
      </g> 
     </g> 
    </g> 
   </g> 
  </g> 
 </svg> 
</div> 
<h2><a id="_26"></a>数据探索与预处理</h2> 
<p>  本节首先观察样本数据，初步了解属性特征，对各属性进行描述性统计分析，初步探索各属性与客户流失情况的关系；其次进行数据预处理工作，包括异常值处理，数据变换，数据规约等；之后将样本划分为训练集和测试集，观察客户流失情况样本是否均衡，不均衡时需要对训练样本进行均衡化处理；最后，对训练集和测试集进行标准化处理。</p> 
<h3><a id="_28"></a>数据探索</h3> 
<p>  本次所使用的数据集是某欧洲银行的数据。数据集一共包含了14个变量，10000个样本，不包含缺失值。本数据集可从<a href="superdatascience" rel="nofollow">superdatascience</a>官网下载。首先先来观察数据情况。<img src="https://images2.imgbox.com/b7/26/OLXYpuGw_o.png" alt="图1—数据集变量情况">              图1 数据集变量预览<br>   在图1展示的数据集中，从左到右，数据集所具有的的变量有编号、用户ID、姓名、信用分、地区、性别、年龄、用户时长（使用银行产品时长）、存贷款情况、使用产品数量、是否有信用卡、是否为活跃用户、估计收入、是否已流失。将数据集特征进行汇总，由表1可以清楚地看出特征变量名称和属性。<br>               表1 数据集特征汇总<br> <img src="https://images2.imgbox.com/87/31/rBWSb5Bq_o.png" alt="在这里插入图片描述"><br>   我们从表1可以看到，数据集一共包含14个变量，其中第14个变量就是我们的目标变量，目标变量定义的是是否已经流失的分类变量，从而确定了本次数据挖掘的目标是分类。除了目标变量外，特征属性中有7个分类变量，其中有5个是字符类型的，这意味着在数据预处理时首先要处理这些变量才能做下一步分析。其余6个是数值变量，我们接下来要注意考虑数值变量是否存在异常值，是否需要进行数据变换。<br>   下面对各变量首先进行描述性统计分析，观察变量分布情况，进一步了解数据。</p> 
<h4><a id="1_35"></a>1、定量变量初探</h4> 
<p>  本小节主要是通过绘制定量变量的频数分布图来观察变量的分布情况，初步了解各变量分布。</p> 
<table><tbody><tr><td> 
    <center> 
     <img src="https://images2.imgbox.com/b0/9d/hsIR7wBj_o.png">图2-1 CreditScore-信用得分频数分布 
    </center></td><td> 
    <center> 
     <img src="https://images2.imgbox.com/8f/aa/MO4oozrp_o.png">图2-2 Age-年龄频数分布 
    </center></td></tr><tr><td> 
    <center> 
     <img src="https://images2.imgbox.com/cd/50/rl148IDn_o.png">图2-3 Tenure-客户使用年数分布 
    </center></td><td> 
    <center> 
     <img src="https://images2.imgbox.com/87/92/8kLliKCo_o.png">图2-4 Balance-客户存贷款情况 
    </center></td></tr><tr><td> 
    <center> 
     <img src="https://images2.imgbox.com/d4/96/rRVKBr32_o.png">图2-5 NumOfProducts-拥有产品数量 
    </center></td><td> 
    <center> 
     <img src="https://images2.imgbox.com/10/f3/wKhJs4UQ_o.png">图2-6 EstimateSalary-估计收入 
    </center></td></tr></tbody></table>            图2 定量变量频数分布图 
<p>  总体来看图2-1，对于信用分这个属性来说，流失和非流失总体呈现出一个偏正态分布，信用分在650-700之间达到峰值。由图2-2可以看出，年龄呈现出一个偏左态分布。该银行35到40岁的客户最多，在60岁以上的客户很少。且给银行的目标用户大部分年龄在25到45岁之间，比较符合多数银行客户年龄的分布情况。对于该银行，图2-3用户使用年数在1到9年的分布均匀，使用10年的人数最多，使用1年的人数较少。我们可以初步猜测该银行忠诚客户较多，但是在发展新客户方面不够重视或者策略需要调整。;对于客户存贷款情况，该样本数据显现的都是存贷款大于0的情况。从图中可以看出，存款在25000以下的占据大部分。在存款大于25000呈现正态分布。在持有产品数方面，该银行大多数用户使用银行的产品数量为1个或2个，拥有3个或4个产品的极少。说明该银行的产品只有少数具有吸引力，银行应该实施相应措施激励用户使用该银行产品。从图2-6可以看出，该银行客户估计收入在0到200000之间，且不同收入客户分布均匀，猜测该银行并没有清晰的目标客户定位，对不同收入层的客户效用没有差别。</p> 
<h4><a id="2_55"></a>2、分类指标分布情况</h4> 
<p>  对于分类指标，这里展示了不同指标分类的频数分布情况，同时展示了在每种类别下客户流失情况。</p> 
<table><tbody><tr><td> 
    <center> 
     <img src="https://images2.imgbox.com/5b/99/5eMQOfi8_o.png">图3-1 地区分布和流失情况 
    </center></td><td> 
    <center> 
     <img src="https://images2.imgbox.com/fa/4c/GSpZoZue_o.png">图3-2 性别分布和流失情况 
    </center></td></tr><tr><td> 
    <center> 
     <img src="https://images2.imgbox.com/48/3a/NIFp1SLz_o.png">图3-3 信用卡分布和流失情况 
    </center></td><td> 
    <center> 
     <img src="https://images2.imgbox.com/68/48/QI8b2fZb_o.png">图3-4 活跃用户分布和流失情况 
    </center></td></tr></tbody></table>            图3 定类变量频数分布图 
<p>  图3-1中，在地区这个属性可以看出，样本数据集客户来自三个国家：法国、德国、西班牙。该银行法国用户最多，德国和西班牙客户数量几乎相等，但从流失情况来看，德国用户的流失率明显高过其他两国。从性别来看，图3-2显示，银行的男性用户高于女性，但是女性的流失率要高过男性。在客户是否拥有信用卡来看（图3-3），该银行70%的客户有信用卡，没有信用卡客户的流失率在20%以上，有信用卡的流失率在16%。使用该银行信用卡的用户忠诚度更高。由图3-4知，该银行的活跃客户稍高于非活跃用户，活跃用户的流失率明显低于非活跃用户，这也说明活跃客户较非活跃客户忠诚度更高。</p> 
<h4><a id="3_73"></a>3、目标变量分布</h4> 
<p><img src="https://images2.imgbox.com/fe/d6/inZtZ9a5_o.png" alt="在这里插入图片描述">              图4 客户流失情况<br>   从图4我们可以很明显看到，客户流失情况样本分布很不均衡，未流失与流失用户比例接近4:1。所以接下来在划分训练集和测试集之后，需要对不均衡的测试集样本进行均衡处理。</p> 
<h3><a id="_76"></a>数据预处理</h3> 
<h4><a id="_77"></a>数据清洗</h4> 
<p>  因为样本不含缺失值，所以不用进行缺失值的处理。数据清洗在这里主要包括两步：删除无关变量和异常值处理。</p> 
<h5><a id="1_79"></a>1、删除不相关变量</h5> 
<p>  我们将导入jupter notebook的数据集输出前5个数据观察变量，如图5。<br> <img src="https://images2.imgbox.com/7d/9b/B6xRtx9N_o.png" alt="在这里插入图片描述">              图5 数据集展示<br>   在所有变量中，RowNumber：用户编号，CustomerId：用户ID，Surname：用户姓名这三个变量明显是无关变量，我们将无关变量剔除。</p> 
<h5><a id="2_83"></a>2、异常值处理</h5> 
<p>  首先根据变量的箱线图来判断是否存在异常值。</p> 
<table><tbody><tr><td> 
    <center> 
     <img src="https://images2.imgbox.com/40/88/bb8Nn8ZJ_o.png">图6-1 信用分 
    </center> </td><td> 
    <center> 
     <img src="https://images2.imgbox.com/4b/6e/kyCNUnZ1_o.png">图6-2年龄 
    </center> </td></tr><tr><td> 
    <center> 
     <img src="https://images2.imgbox.com/07/ed/ZPRUcv4r_o.png">图6-3 使用年数 
    </center> </td><td> 
    <center> 
     <img src="https://images2.imgbox.com/eb/db/infjeerx_o.png">图6-4 存贷款 
    </center> </td></tr><tr><td> 
    <center> 
     <img src="https://images2.imgbox.com/7e/f6/FSjcqKRL_o.png">图6-5 产品数量 
    </center> </td><td> 
    <center> 
     <img src="https://images2.imgbox.com/5c/9b/ZTgufKa9_o.png">图6-6 估计收入 
    </center> </td></tr></tbody></table>               图6 特征箱线图 
<p>  由图6可以看出，信用分、年龄、产品数量存在异常值。信用分低于400分是异常值，年龄大于60的属于异常值，产品数为4的也属异常值。处理异常值的方法有很多，其中忽略异常值也是一种方法。由于认为信用分、年龄、产品数量属于重要变量，这里选择不剔除异常值。</p> 
<h4><a id="_102"></a>数据变换</h4> 
<p>  对于该数据集的数据变换处理，主要包括对字符型变量的量化、对分类变量的处理、连续属性离散化、样本不均衡处理和数据标准化。</p> 
<h5><a id="1_104"></a>1、字符型变量的量化</h5> 
<p>  由之前样本数据的观察了解到，地区、性别是字符型变量，无法进行分析，需要将这2个属性进行量化。这里使用转换数值工具包LabelEncoder进行转换。处理后，地区包含0、1、2三个值，性别包括0、1两个值。其中地区变量0代表France，1代表Germany，2代表Spain；性别变量0代表女，1代表男。图7展示了变化后的效果。<br> <img src="https://images2.imgbox.com/fe/1c/otJ7PnFx_o.png" alt="在这里插入图片描述">            图7 量化后数据集</p> 
<h5><a id="2_107"></a>2、连续特征离散化。</h5> 
<p>  将连续特征离散化对异常数据有很强的鲁棒性，能够增强模型的稳定性，降低了模型过拟合的风险，并且能够提高迭代速度。在之前的异常值检测中我们已知CreditScore和Age两个变量存在异常值，这里将他们进行离散化，将信用得分划分为600分以下、600-650、650-700、700-750、750以上共5个分组，年龄划分为30岁以下、30-40、40-50、50-60、60-70、70-80、80岁以上7个分组。<br>   下面给出分组后的信用分和年龄分布。</p> 
<table><tbody><tr><td> 
    <center> 
     <img src="https://images2.imgbox.com/be/97/BkgOlHSG_o.png">图8-1 信用分 
    </center></td><td> 
    <center> 
     <img src="https://images2.imgbox.com/96/98/jqzgrSK5_o.png">图8-2 信用分 
    </center></td></tr></tbody></table>             图8 信用分、年龄属性离散化后分布 
<p>  在进行完这些处理后 ，接下来的工作就是对分类变量进行独热编码以及特征矩阵的标准化。但是，考虑到类标签流失与未流失的比例接近1:4，属于不均衡数据。样本不均衡会给结果带来很大影响。在样本不均衡情况下，即使我们最终得到的模型准确度很高也是不可信的。所以，在进行分类任务时，解决样本不均衡问题很重要。解决样本不均衡的方法有很多，目前用的较多的有欠采样、过采样、加权、One-class分类。这里选择过采样的改进方法SMOTE算法来平衡样本。</p> 
<h5><a id="3_119"></a>3、样本不均衡处理</h5> 
<p>  在对样本处理前，首先简单介绍样本不均衡的处理方法SMOTE算法。<br>   SMOTE（Synthetic Minority Oversampling Technique），合成少数类过采样技术．它是基于随机过采样算法的一种改进方案，由于随机过采样采取简单复制样本的策略来增加少数类样本，这样容易产生模型过拟合的问题，即使得模型学习到的信息过于特别(Specific)而不够泛化(General)，SMOTE算法的基本思想是对少数类样本进行分析并根据少数类样本人工合成新样本添加到数据集中，具体如下图所示，算法流程如下。<br>   (1)对于少数类中每一个样本x，以欧氏距离为标准计算它到少数类样本集中所有样本的距离，得到其k近邻。<br>   (2)根据样本不平衡比例设置一个采样比例以确定采样倍率N，对于每一个少数类样本x，从其k近邻中随机选择若干个样本，假设选择的近邻为xn。<br>   (3)对于每一个随机选出的近邻xn，分别与原样本按照如下的公式构建新的样本。<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           x 
          
          
          
            n 
           
          
            e 
           
          
            w 
           
          
         
        
          = 
         
        
          x 
         
        
          + 
         
        
          r 
         
        
          a 
         
        
          n 
         
        
          d 
         
        
          ( 
         
        
          0 
         
        
          , 
         
        
          1 
         
        
          ) 
         
        
          ( 
         
         
         
           x 
          
         
           ^ 
          
         
        
          − 
         
        
          x 
         
        
          ) 
         
        
       
         x_{new}=x+rand(0,1)(\widehat{x}-x) 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.58056em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathit">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">n</span><span class="mord mathit mtight">e</span><span style="margin-right: 0.02691em;" class="mord mathit mtight">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.66666em; vertical-align: -0.08333em;"></span><span class="mord mathit">x</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span style="margin-right: 0.02778em;" class="mord mathit">r</span><span class="mord mathit">a</span><span class="mord mathit">n</span><span class="mord mathit">d</span><span class="mopen">(</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.67056em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathit">x</span></span></span><span class="svg-align" style="width: calc(100% - 0.05556em); margin-left: 0.05556em; top: -3.43056em;"><span class="pstrut" style="height: 3em;"></span><span class="" style="height: 0.24em;"> 
            <svg width="100%" height="0.24em" viewbox="0 0 1062 239" preserveaspectratio="none"> 
             <path d="M529 0h5l519 115c5 1 9 5 9 10 0 1-1 2-1 3l-4 22
c-1 5-5 9-11 9h-2L532 67 19 159h-2c-5 0-9-4-11-9l-5-22c-1-6 2-12 8-13z"></path> 
            </svg></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathit">x</span><span class="mclose">)</span></span></span></span></span></span><br> <img src="https://images2.imgbox.com/a8/22/0YOFxqmg_o.png" alt="在这里插入图片描述">                图9 SMOTE算法示意图<br>   介绍完SMOTE原理后，我们对数据集进行处理。首先将数据集划分为训练集和样本集，这里将原始数据的80%作为训练集，20%作为样本集然后需要对训练集样本不均衡进行处理。这里随机产生的训练集正负样本比例接近1:5。我们通过SMOTE算法将正样本也就是流失样本扩展到和未流失样本一样多。我们可以看一下SMOTE处理后的效果。<br> <img src="https://images2.imgbox.com/fd/73/Q1Lx77Xc_o.png" alt="在这里插入图片描述">              图10 均衡处理后训练样本数量<br>   图10中我们可以看出，SMOTE已经将训练集扩展成了正负样本一致。由于SMOTE算法是基于样本到k近邻之间的距离随机生成的样本，所以过采样后流失样本的离散变量会连续化。Geography、Gender、HasCrCard、IsActiveMember这四个变量是离散变量且为分类变量，但是Smote处理后将他们连续化了，因此需要进行离散化处理。这里划分数据离散化的标准就近原则，即样本数据离哪个指标近就划分到那一类中。</p> 
<h5><a id="4_132"></a>4、虚拟变量变换</h5> 
<p>  处理完样本不均衡问题后，我们考虑到Geography变量是三分类变量，直接编码(0,1,2)会让计算机直接将变量作为有序数组处理。所以，真正分析的时候要把他们作为虚拟变量处理，性别就是二分类引入一个虚拟变量，（即我们知道一个是0，另一个就是1）可以不变，地区是三分类，要引入两个虚拟变量，即要知道其中两个的类，才能确定另一个，比如France和Spain是0，我们才能确定Germany是1。这里可以直接用sklearn里的OneHotEncoder进行处理。OneHotEncoder是将分类变量的类别生成3列。这里当France为真时（1,0,0），Germany为真时（0,1,0），Spain为真时（0,0,1）。同时，为了避免掉入“虚拟变量陷阱”，我们删除其中一列，这里选择剔除Spain这一列。由于OneHotEncoder工具包会将独热编码后的数据放在最前面，因此此时变量顺序已经发生改变。展示效果如图11。<br> <img src="https://images2.imgbox.com/91/bc/S1BwAWYJ_o.png" alt="在这里插入图片描述">            图11 虚拟变量变换后的数据集</p> 
<h5><a id="5_135"></a>5、特征标准化</h5> 
<p>  数据的标准化处理，可以在保持列内数据多样性的同时，尽量减少不同类别之间差异的影响，可以让机器公平对待全部特征。同样用sklearn里StandardScaler包处理。这里训练集合测试集要进行相同的处理。</p> 
<h4><a id="_138"></a>特征选择</h4> 
<p>  在对单变量分析完之后，我们来观察下特征变量之间的相关性，当特征之间出现强相关性时，我们应该考虑剔除变量强相关性，下面给出了特征变量之间的相关系数矩阵。由于离散变量较多，因此这里采用相关系数矩阵展示。<br>             表2 特征变量相关关系表</p> 
<table><thead><tr><th align="center">Geography</th><th align="right">Gender</th><th align="center">Tenure</th><th align="center">Balance</th><th align="center">NumOfProducts</th><th align="center">HasCrCard</th><th align="center">IsActiveMember</th><th align="center">EstimatedSalary</th><th align="center">CreditScore_range</th><th align="center">age_group</th></tr></thead><tbody><tr><td align="center">1.000</td><td align="right">0.005</td><td align="center">0.004</td><td align="center">0.069</td><td align="center">0.004</td><td align="center">-0.009</td><td align="center">0.007</td><td align="center">-0.001</td><td align="center">-0.000</td><td align="center">0.018</td></tr><tr><td align="center"></td><td align="right">1.000</td><td align="center">0.015</td><td align="center">0.012</td><td align="center">-0.022</td><td align="center">0.006</td><td align="center">0.023</td><td align="center">-0.008</td><td align="center">-0.006</td><td align="center">-0.022</td></tr><tr><td align="center"></td><td align="right"></td><td align="center">1.000</td><td align="center">-0.012</td><td align="center">0.013</td><td align="center">0.023</td><td align="center">-0.028</td><td align="center">0.008</td><td align="center">0.004</td><td align="center">-0.010</td></tr><tr><td align="center"></td><td align="right"></td><td align="center"></td><td align="center">1.000</td><td align="center">-0.304</td><td align="center">-0.015</td><td align="center">-0.010</td><td align="center">0.013</td><td align="center">0.010</td><td align="center">0.027</td></tr><tr><td align="center"></td><td align="right"></td><td align="center"></td><td align="center"></td><td align="center">1.000</td><td align="center">0.003</td><td align="center">0.010</td><td align="center">0.014</td><td align="center">0.009253</td><td align="center">-0.030</td></tr><tr><td align="center"></td><td align="right"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">1.000</td><td align="center">-0.012</td><td align="center">-0.010</td><td align="center">-0.002</td><td align="center">-0.015</td></tr><tr><td align="center"></td><td align="right"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">1.000</td><td align="center">-0.011</td><td align="center">0.020</td><td align="center">0.088</td></tr><tr><td align="center"></td><td align="right"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">1.000</td><td align="center">0.005</td><td align="center">-0.003</td></tr><tr><td align="center"></td><td align="right"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">1.000</td><td align="center">-0.003</td></tr><tr><td align="center"></td><td align="right"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">1.000</td></tr></tbody></table> 
<p>   由相关系数矩阵可以看出，特征变量之间相关关系较弱，因此我们可以将全部特征纳入。</p> 
<h2><a id="_154"></a>数据建模和调参</h2> 
<p>  关于分类算法，目前几大主流基学习器如决策树、支持向量机、朴素贝叶斯、逻辑回归都可以实现，集成学习效果一般较基学习器好，包括随机森林、GBDT、还有比赛使用最多的XGBoost。同时，深度学习也成为数据挖掘上的重要工具，如LM神经网络、BP神经网络、RNN、CNN等。这里使用了决策树、支持向量机、朴素贝叶斯、逻辑回归、XGBoost、LM神经网络进行建模，通过对不同模型的学习能力评估选择能够预测客户流失的最优模型。</p> 
<h3><a id="_156"></a>模型评价</h3> 
<p>  通过不同模型对样本训练集的学习，之后用测试集来验证模型的学习能力。这里选用了分类度量指标precision、recall、F1值、准确度、ROC曲线、AUC值、Kappa值来比较各模型。<br>   首先给出各模型的precision、recall、F1值对比，结果见下图。<br>               表3 各模型性能度量</p> 
<table><thead><tr><th align="center">measure</th><th align="center">SVM</th><th align="center">LR</th><th align="center">Tree</th><th align="center">RF</th><th align="center">XGB</th><th align="center">Bayes</th><th align="center">LM</th></tr></thead><tbody><tr><td align="center">precision</td><td align="center">0.79</td><td align="center">0.80</td><td align="center">0.80</td><td align="center">0.85</td><td align="center">0.86</td><td align="center">0.80</td><td align="center">0.84</td></tr><tr><td align="center">recall</td><td align="center">0.78</td><td align="center">0.70</td><td align="center">0.79</td><td align="center">0.86</td><td align="center">0.87</td><td align="center">0.73</td><td align="center">0.81</td></tr><tr><td align="center">F1</td><td align="center">0.78</td><td align="center">0.73</td><td align="center">0.79</td><td align="center">0.85</td><td align="center">0.86</td><td align="center">0.75</td><td align="center">0.82</td></tr><tr><td align="center">Accuracy</td><td align="center">77.90%</td><td align="center">70.25%</td><td align="center">78.70%</td><td align="center">85.65%</td><td align="center">86.55%</td><td align="center">73.15%</td><td align="center">81.20%</td></tr></tbody></table> 
<p>  从上表我们可以看出，XGBoost、随机森林、LM神经网络三种模型所有评价指标都在0.8以上，性能较好。其中XGBoost的四个指标都是最大值，随机森林次之，两者precision、recall、F1值都很接近，准确率相差接近1%，之后是LM神经网络。其余的模型较XGBoost、随机森林、LM神经网络表现差。<br> 我们再来比较一下ROC曲线和AUC值。见图12<br> <img src="https://images2.imgbox.com/c1/13/uRh2LELE_o.png" alt="在这里插入图片描述">                图12 ROC曲线<br>   从ROC曲线可以看出，XGBoost包含了其他模型的ROC曲线曲线，最靠近ROC曲线的左上角。并且比较各模型的AUC值，XGBoost也是最大的。从ROC曲线结合AUC值，认为XGBoost表现最好。<br>   最后，再来比较一下各模型的kappa值。Kappa统计量比较的是分类器与仅仅基于随机的分类器的性能，它是根据混淆矩阵计算得出，和混淆矩阵评价保持一致。Kappa统计量的值在-1到1之间，小于0表示分类器性能不如随机分类，大于1表示比随机分类效果好，越接近于1表示分类性能越好。一般kappa值大于0.4才认为具有较好的分类性能。kappa统计量的计算公式是：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          k 
         
        
          = 
         
         
          
           
           
             p 
            
           
             0 
            
           
          
            − 
           
           
           
             p 
            
           
             c 
            
           
          
          
          
            1 
           
          
            − 
           
          
            p 
           
          
            c 
           
          
         
        
       
         k=\frac{p_0-p_c}{1-pc} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span style="margin-right: 0.03148em;" class="mord mathit">k</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.14077em; vertical-align: -0.88044em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.26033em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathit">p</span><span class="mord mathit">c</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathit">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathit">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.88044em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span><br>   其中，<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           p 
          
         
           0 
          
         
        
          = 
         
         
          
           
           
             ∑ 
            
            
            
              i 
             
            
              = 
             
            
              1 
             
            
           
             r 
            
           
           
           
             x 
            
            
            
              i 
             
            
              i 
             
            
           
          
         
           N 
          
         
        
          ， 
         
         
         
           p 
          
         
           c 
          
         
        
          = 
         
         
          
           
           
             ∑ 
            
            
            
              i 
             
            
              = 
             
            
              1 
             
            
           
             2 
            
           
          
            ( 
           
           
           
             x 
            
            
            
              i 
             
            
              . 
             
            
           
           
           
             x 
            
            
            
              . 
             
            
              i 
             
            
           
          
            ) 
           
          
          
          
            N 
           
          
            2 
           
          
         
        
       
         p_0=\frac{\sum_{i=1}^rx_{ii}}{N}，p_c=\frac{\sum_{i=1}^2(x_{i.}x_{.i})}{N^2} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord mathit">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.18em; vertical-align: -0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.494em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span style="margin-right: 0.10903em;" class="mord mathit">N</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.68971em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mop"><span class="mop op-symbol small-op" style="position: relative; top: -0.000005em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.804292em;"><span class="" style="top: -2.40029em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span class="" style="top: -3.2029em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.02778em;" class="mord mathit mtight">r</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.29971em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathit">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">i</span><span class="mord mathit mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord cjk_fallback">，</span><span class="mord"><span class="mord mathit">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.32972em; vertical-align: -0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.64372em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span style="margin-right: 0.10903em;" class="mord mathit">N</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.740108em;"><span class="" style="top: -2.989em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.68971em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mop"><span class="mop op-symbol small-op" style="position: relative; top: -0.000005em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.954008em;"><span class="" style="top: -2.40029em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span class="" style="top: -3.2029em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.29971em;"><span class=""></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathit">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">i</span><span class="mord mtight">.</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mord mathit">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">.</span><span class="mord mathit mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span><br>   xij表示的是混淆矩阵对应的值。<br>   我们用图像直观地表现各模型的kappa表现。<br> <img src="https://images2.imgbox.com/fa/e6/GOvKZPC4_o.png" alt="在这里插入图片描述">              图13 各模型kappa值比较<br>   由kappa值的条形图可以看出，XGBoost、RF、LM的值都超过了0.4，可以认为是较好的分类器。其中XGBoost最大，我们认为XGBoost的分类性能最好。<br>   综合以上评价指标，XGBoost表现最好。下面将针对XGBoost学习器进行调参，使模型表现达到最优。</p> 
<h3><a id="XGBoost_184"></a>XGBoost模型介绍、调参及评估</h3> 
<p>  由上一节的模型评价，确定了本次关于数据集预测银行流失客户的最优算法是XGBoost。同时，XGBoost也是目前在数据挖掘比赛中表现非常好的模型。在本节首先介绍XGBoost算法的原理以及优点，然后结合数据集对XGBoost模型进行调参，获取最优超参数，最后输出模型调参后的性能指标。</p> 
<h4><a id="XGBoost_187"></a>XGBoost模型介绍</h4> 
<h5><a id="XGBoost_188"></a>XGBoost模型原理</h5> 
<p>  XGBoost是boosting算法的其中一种。Boosting算法的思想是将许多弱分类器集成在一起形成一个强分类器。因为XGBoost是一种提升树模型，所以它是将许多树模型集成在一起，形成一个很强的分类器。而所用到的树模型则是CART回归树模型。<br>   XGBoost的算法思想就是不断地添加树，不断地进行特征分裂来生长一棵树，每次添加一个树，其实是学习一个新函数，去拟合上次预测的残差。当我们训练完成得到k棵树，我们要预测一个样本的分数，其实就是根据这个样本的特征，在每棵树中会落到对应的一个叶子节点，每个叶子节点就对应一个分数，最后只需要将每棵树对应的分数加起来就是该样本的预测值。<br>   XGBoost的目标函数是：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          O 
         
        
          b 
         
        
          j 
         
        
          ( 
         
        
          t 
         
        
          ) 
         
        
          = 
         
         
         
           ∑ 
          
          
          
            i 
           
          
            = 
           
          
            1 
           
          
         
           n 
          
         
        
          l 
         
        
          ( 
         
         
         
           y 
          
         
           i 
          
         
        
          , 
         
         
          
          
            y 
           
          
            ^ 
           
          
         
           i 
          
          
          
            ( 
           
          
            t 
           
          
            − 
           
          
            1 
           
          
            ) 
           
          
         
        
          + 
         
         
         
           f 
          
         
           t 
          
         
        
          ( 
         
         
         
           x 
          
         
           i 
          
         
        
          ) 
         
        
          ) 
         
        
          + 
         
         
         
           ∑ 
          
          
          
            k 
           
          
            = 
           
          
            1 
           
          
         
           k 
          
         
        
          Ω 
         
        
          ( 
         
         
         
           f 
          
         
           k 
          
         
        
          ) 
         
        
          + 
         
        
          c 
         
        
          o 
         
        
          n 
         
        
          s 
         
        
          t 
         
        
          a 
         
        
          n 
         
        
          t 
        &amp;ThinSpace; 
        
       
         Obj (t)= \sum_{i=1}^n l(y_i,\widehat{y}_i^{(t-1)}+f_t(x_i))+\sum_{k=1}^k\Omega(f_k)+constant\, 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span style="margin-right: 0.02778em;" class="mord mathit">O</span><span class="mord mathit">b</span><span style="margin-right: 0.05724em;" class="mord mathit">j</span><span class="mopen">(</span><span class="mord mathit">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.92907em; vertical-align: -1.27767em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.6514em;"><span class="" style="top: -1.87233em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span class="" style="top: -3.05001em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span><span class="" style="top: -4.30001em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.27767em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span style="margin-right: 0.01968em;" class="mord mathit">l</span><span class="mopen">(</span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathit">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.67056em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathit">y</span></span></span><span class="svg-align" style="width: calc(100% - 0.11112em); margin-left: 0.11112em; top: -3.43056em;"><span class="pstrut" style="height: 3em;"></span><span class="" style="height: 0.24em;"> 
             <svg width="100%" height="0.24em" viewbox="0 0 1062 239" preserveaspectratio="none"> 
              <path d="M529 0h5l519 115c5 1 9 5 9 10 0 1-1 2-1 3l-4 22
c-1 5-5 9-11 9h-2L532 67 19 159h-2c-5 0-9-4-11-9l-5-22c-1-6 2-12 8-13z"></path> 
             </svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.19444em;"><span class=""></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.0448em;"><span class="" style="top: -2.42314em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span><span class="" style="top: -3.2198em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathit mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.276864em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord"><span style="margin-right: 0.10764em;" class="mord mathit">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.280556em;"><span class="" style="top: -2.55em; margin-left: -0.10764em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathit">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 3.13823em; vertical-align: -1.30211em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.83611em;"><span class="" style="top: -1.84789em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.03148em;" class="mord mathit mtight">k</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span class="" style="top: -3.05001em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span><span class="" style="top: -4.30001em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.03148em;" class="mord mathit mtight">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.30211em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">Ω</span><span class="mopen">(</span><span class="mord"><span style="margin-right: 0.10764em;" class="mord mathit">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: -0.10764em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.03148em;" class="mord mathit mtight">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.61508em; vertical-align: 0em;"></span><span class="mord mathit">c</span><span class="mord mathit">o</span><span class="mord mathit">n</span><span class="mord mathit">s</span><span class="mord mathit">t</span><span class="mord mathit">a</span><span class="mord mathit">n</span><span class="mord mathit">t</span><span class="mspace" style="margin-right: 0.166667em;"></span></span></span></span></span></span><br>   其中，<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           f 
          
         
           t 
          
         
        
          ( 
         
        
          x 
         
        
          ) 
         
        
          = 
         
         
         
           w 
          
         
           q 
          
         
        
          ( 
         
        
          x 
         
        
          ) 
         
        
          , 
         
        
          w 
         
        
          ∈ 
         
         
         
           R 
          
         
           T 
          
         
        
          , 
         
        
          q 
         
        
          : 
         
         
         
           R 
          
         
           d 
          
         
        
          → 
         
         
         
           ( 
          
         
           1 
          
         
           , 
          
         
           2 
          
         
           , 
          
         
           ⋯ 
          
         
           T 
          
         
           ) 
          
         
        
       
         f_t(x)=w_q(x), w\in R^T,q:R^d\rightarrow{(1,2,\cdots T)} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord"><span style="margin-right: 0.10764em;" class="mord mathit">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.280556em;"><span class="" style="top: -2.55em; margin-left: -0.10764em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.03611em; vertical-align: -0.286108em;"></span><span class="mord"><span style="margin-right: 0.02691em;" class="mord mathit">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.02691em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.03588em;" class="mord mathit mtight">q</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span style="margin-right: 0.02691em;" class="mord mathit">w</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.08577em; vertical-align: -0.19444em;"></span><span class="mord"><span style="margin-right: 0.00773em;" class="mord mathit">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.891331em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.13889em;" class="mord mathit mtight">T</span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span style="margin-right: 0.03588em;" class="mord mathit">q</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.899108em; vertical-align: 0em;"></span><span class="mord"><span style="margin-right: 0.00773em;" class="mord mathit">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.899108em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">d</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord"><span class="mopen">(</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right: 0.166667em;"></span><span style="margin-right: 0.13889em;" class="mord mathit">T</span><span class="mclose">)</span></span></span></span></span></span></span><br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          Ω 
         
        
          ( 
         
         
         
           f 
          
         
           t 
          
         
        
          ) 
         
        
          = 
         
        
          γ 
         
        
          T 
         
        
          + 
         
         
         
           1 
          
         
           2 
          
         
         
         
           ∑ 
          
          
          
            j 
           
          
            = 
           
          
            1 
           
          
         
           T 
          
         
         
         
           w 
          
         
           j 
          
         
           2 
          
         
        
       
         \Omega(f_t)=\gamma T+\frac{1}{2}\sum_{j=1}^Tw_j^2 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">Ω</span><span class="mopen">(</span><span class="mord"><span style="margin-right: 0.10764em;" class="mord mathit">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.280556em;"><span class="" style="top: -2.55em; margin-left: -0.10764em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.87777em; vertical-align: -0.19444em;"></span><span style="margin-right: 0.05556em;" class="mord mathit">γ</span><span style="margin-right: 0.13889em;" class="mord mathit">T</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 3.24211em; vertical-align: -1.41378em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.32144em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">2</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.82834em;"><span class="" style="top: -1.87233em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.05724em;" class="mord mathit mtight">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span class="" style="top: -3.05001em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span><span class="" style="top: -4.30001em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.13889em;" class="mord mathit mtight">T</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.41378em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span style="margin-right: 0.02691em;" class="mord mathit">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.864108em;"><span class="" style="top: -2.453em; margin-left: -0.02691em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.05724em;" class="mord mathit mtight">j</span></span></span><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.383108em;"><span class=""></span></span></span></span></span></span></span></span></span></span></span><br>   目标函数由两部分构成，第一部分用来衡量预测分数和真实分数的差距，另一部分则是正则化项。正则化项同样包含两部分，T表示叶子结点的个数，w表示叶子节点的分数，q是叶子的索引号。γ可以控制叶子结点的个数，λ可以控制叶子节点的分数不会过大，防止过拟合。<br>   用泰勒展开来近似目标函数：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          f 
         
        
          ( 
         
        
          x 
         
        
          + 
         
        
          Δ 
         
        
          x 
         
        
          ) 
         
        
          ≃ 
         
        
          f 
         
        
          ( 
         
        
          x 
         
        
          ) 
         
        
          + 
         
         
         
           f 
          
          
           
          
            ′ 
           
          
         
        
          ( 
         
        
          x 
         
        
          ) 
         
        
          Δ 
         
        
          x 
         
        
          + 
         
         
         
           1 
          
         
           2 
          
         
         
         
           x 
          
         
           2 
          
         
        
       
         f(x+\Delta x)\simeq f(x)+f^{&amp;#x27;}(x)\Delta x+\frac{1}{2}x^2 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span style="margin-right: 0.10764em;" class="mord mathit">f</span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">Δ</span><span class="mord mathit">x</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">≃</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span style="margin-right: 0.10764em;" class="mord mathit">f</span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1.24248em; vertical-align: -0.25em;"></span><span class="mord"><span style="margin-right: 0.10764em;" class="mord mathit">f</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.99248em;"><span class="" style="top: -2.99248em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.57948em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class=""></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.827829em;"><span class="" style="top: -2.931em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mclose">)</span><span class="mord">Δ</span><span class="mord mathit">x</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 2.00744em; vertical-align: -0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.32144em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">2</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="mord mathit">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.864108em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span></span><br>   定义<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           g 
          
         
           i 
          
         
        
          = 
         
         
         
           ∂ 
          
          
           
           
             y 
            
           
             ^ 
            
           
           
           
             ( 
            
           
             t 
            
           
             − 
            
           
             1 
            
           
             ) 
            
           
          
         
        
          l 
         
        
          ( 
         
         
         
           y 
          
         
           i 
          
         
        
          , 
         
         
          
          
            y 
           
          
            ^ 
           
          
          
          
            ( 
           
          
            t 
           
          
            − 
           
          
            1 
           
          
            ) 
           
          
         
        
          ) 
         
        
          , 
         
         
         
           h 
          
         
           i 
          
         
        
          = 
         
         
         
           ∂ 
          
          
           
           
             y 
            
           
             ^ 
            
           
           
           
             ( 
            
           
             t 
            
           
             − 
            
           
             1 
            
           
             ) 
            
           
          
         
           2 
          
         
        
          l 
         
        
          ( 
         
         
         
           y 
          
         
           i 
          
         
        
          , 
         
         
          
          
            y 
           
          
            ^ 
           
          
          
          
            ( 
           
          
            t 
           
          
            − 
           
          
            1 
           
          
            ) 
           
          
         
        
          ) 
         
        
       
         g_i=\partial_{\widehat{y}^{(t-1)}}l(y_i,\widehat{y}^{(t-1)}),h_i=\partial_{\widehat{y}^{(t-1)}}^2l(y_i,\widehat{y}^{(t-1)}) 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.19444em;"></span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathit">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.30473em; vertical-align: -0.366733em;"></span><span class="mord"><span style="margin-right: 0.05556em;" class="mord">∂</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3448em;"><span class="" style="top: -2.46938em; margin-left: -0.05556em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord accent mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.67056em;"><span class="" style="top: -2.7em;"><span class="pstrut" style="height: 2.7em;"></span><span class="mord mtight"><span style="margin-right: 0.03588em;" class="mord mathit mtight">y</span></span></span><span class="svg-align" style="width: calc(100% - 0.11112em); margin-left: 0.11112em; top: -3.13056em;"><span class="pstrut" style="height: 2.7em;"></span><span class="mtight" style="height: 0.24em;"> 
                     <svg width="100%" height="0.24em" viewbox="0 0 1062 239" preserveaspectratio="none"> 
                      <path d="M529 0h5l519 115c5 1 9 5 9 10 0 1-1 2-1 3l-4 22
c-1 5-5 9-11 9h-2L532 67 19 159h-2c-5 0-9-4-11-9l-5-22c-1-6 2-12 8-13z"></path> 
                     </svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.19444em;"><span class=""></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.822036em;"><span class="" style="top: -2.82204em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.53571em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathit mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.366733em;"><span class=""></span></span></span></span></span></span><span style="margin-right: 0.01968em;" class="mord mathit">l</span><span class="mopen">(</span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathit">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.67056em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathit">y</span></span></span><span class="svg-align" style="width: calc(100% - 0.11112em); margin-left: 0.11112em; top: -3.43056em;"><span class="pstrut" style="height: 3em;"></span><span class="" style="height: 0.24em;"> 
             <svg width="100%" height="0.24em" viewbox="0 0 1062 239" preserveaspectratio="none"> 
              <path d="M529 0h5l519 115c5 1 9 5 9 10 0 1-1 2-1 3l-4 22
c-1 5-5 9-11 9h-2L532 67 19 159h-2c-5 0-9-4-11-9l-5-22c-1-6 2-12 8-13z"></path> 
             </svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.19444em;"><span class=""></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.938em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathit mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathit">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.39653em; vertical-align: -0.458533em;"></span><span class="mord"><span style="margin-right: 0.05556em;" class="mord">∂</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.864108em;"><span class="" style="top: -2.37758em; margin-left: -0.05556em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord accent mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.67056em;"><span class="" style="top: -2.7em;"><span class="pstrut" style="height: 2.7em;"></span><span class="mord mtight"><span style="margin-right: 0.03588em;" class="mord mathit mtight">y</span></span></span><span class="svg-align" style="width: calc(100% - 0.11112em); margin-left: 0.11112em; top: -3.13056em;"><span class="pstrut" style="height: 2.7em;"></span><span class="mtight" style="height: 0.24em;"> 
                     <svg width="100%" height="0.24em" viewbox="0 0 1062 239" preserveaspectratio="none"> 
                      <path d="M529 0h5l519 115c5 1 9 5 9 10 0 1-1 2-1 3l-4 22
c-1 5-5 9-11 9h-2L532 67 19 159h-2c-5 0-9-4-11-9l-5-22c-1-6 2-12 8-13z"></path> 
                     </svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.19444em;"><span class=""></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.822036em;"><span class="" style="top: -2.82204em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.53571em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathit mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.458533em;"><span class=""></span></span></span></span></span></span><span style="margin-right: 0.01968em;" class="mord mathit">l</span><span class="mopen">(</span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathit">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.67056em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathit">y</span></span></span><span class="svg-align" style="width: calc(100% - 0.11112em); margin-left: 0.11112em; top: -3.43056em;"><span class="pstrut" style="height: 3em;"></span><span class="" style="height: 0.24em;"> 
             <svg width="100%" height="0.24em" viewbox="0 0 1062 239" preserveaspectratio="none"> 
              <path d="M529 0h5l519 115c5 1 9 5 9 10 0 1-1 2-1 3l-4 22
c-1 5-5 9-11 9h-2L532 67 19 159h-2c-5 0-9-4-11-9l-5-22c-1-6 2-12 8-13z"></path> 
             </svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.19444em;"><span class=""></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.938em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathit mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></span><br>   所以，目标函数在泰勒展开下近似为：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          O 
         
        
          b 
         
         
         
           j 
          
          
          
            ( 
           
          
            t 
           
          
            ) 
           
          
         
        
          ≃ 
         
         
         
           ∑ 
          
          
          
            i 
           
          
            = 
           
          
            1 
           
          
         
           n 
          
         
        
          [ 
         
        
          l 
         
        
          ( 
         
         
         
           y 
          
         
           i 
          
         
        
          , 
         
         
          
          
            y 
           
          
            ^ 
           
          
         
           i 
          
          
          
            ( 
           
          
            t 
           
          
            − 
           
          
            1 
           
          
            ) 
           
          
         
        
          ) 
         
        
          + 
         
         
         
           g 
          
         
           i 
          
         
         
         
           f 
          
         
           t 
          
         
        
          ( 
         
         
         
           x 
          
         
           i 
          
         
        
          ) 
         
        
          + 
         
         
         
           1 
          
         
           2 
          
         
         
         
           h 
          
         
           i 
          
         
         
         
           f 
          
         
           t 
          
         
           2 
          
         
        
          ( 
         
         
         
           x 
          
         
           i 
          
         
        
          ) 
         
        
          ] 
         
        
          + 
         
        
          Ω 
         
        
          ( 
         
         
         
           f 
          
         
           t 
          
         
        
          ) 
         
        
          + 
         
        
          c 
         
        
          o 
         
        
          n 
         
        
          s 
         
        
          t 
         
        
          a 
         
        
          n 
         
        
          t 
        &amp;ThinSpace; 
        
       
         Obj^{(t)}\simeq \sum_{i=1}^n[l(y_i,\widehat{y}_i^{(t-1)})+g_if_t(x_i)+\frac{1}{2}h_if_t^2(x_i)]+\Omega(f_t)+constant\, 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.13244em; vertical-align: -0.19444em;"></span><span style="margin-right: 0.02778em;" class="mord mathit">O</span><span class="mord mathit">b</span><span class="mord"><span style="margin-right: 0.05724em;" class="mord mathit">j</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.938em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathit mtight">t</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">≃</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.92907em; vertical-align: -1.27767em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.6514em;"><span class="" style="top: -1.87233em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span class="" style="top: -3.05001em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span><span class="" style="top: -4.30001em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.27767em;"><span class=""></span></span></span></span></span><span class="mopen">[</span><span style="margin-right: 0.01968em;" class="mord mathit">l</span><span class="mopen">(</span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathit">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.67056em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathit">y</span></span></span><span class="svg-align" style="width: calc(100% - 0.11112em); margin-left: 0.11112em; top: -3.43056em;"><span class="pstrut" style="height: 3em;"></span><span class="" style="height: 0.24em;"> 
             <svg width="100%" height="0.24em" viewbox="0 0 1062 239" preserveaspectratio="none"> 
              <path d="M529 0h5l519 115c5 1 9 5 9 10 0 1-1 2-1 3l-4 22
c-1 5-5 9-11 9h-2L532 67 19 159h-2c-5 0-9-4-11-9l-5-22c-1-6 2-12 8-13z"></path> 
             </svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.19444em;"><span class=""></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.0448em;"><span class="" style="top: -2.42314em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span><span class="" style="top: -3.2198em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathit mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.276864em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathit">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord"><span style="margin-right: 0.10764em;" class="mord mathit">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.280556em;"><span class="" style="top: -2.55em; margin-left: -0.10764em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathit">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 2.00744em; vertical-align: -0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.32144em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">2</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="mord mathit">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord"><span style="margin-right: 0.10764em;" class="mord mathit">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.864108em;"><span class="" style="top: -2.453em; margin-left: -0.10764em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">t</span></span></span><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.247em;"><span class=""></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathit">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose">]</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">Ω</span><span class="mopen">(</span><span class="mord"><span style="margin-right: 0.10764em;" class="mord mathit">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.280556em;"><span class="" style="top: -2.55em; margin-left: -0.10764em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.61508em; vertical-align: 0em;"></span><span class="mord mathit">c</span><span class="mord mathit">o</span><span class="mord mathit">n</span><span class="mord mathit">s</span><span class="mord mathit">t</span><span class="mord mathit">a</span><span class="mord mathit">n</span><span class="mord mathit">t</span><span class="mspace" style="margin-right: 0.166667em;"></span></span></span></span></span></span><br>   在对正则化新的定义下，我们可以将目标函数改写：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          O 
         
        
          b 
         
         
         
           j 
          
          
          
            ( 
           
          
            t 
           
          
            ) 
           
          
         
        
          ≃ 
         
         
         
           ∑ 
          
          
          
            i 
           
          
            = 
           
          
            1 
           
          
         
           n 
          
         
        
          [ 
         
         
         
           g 
          
         
           i 
          
         
         
         
           f 
          
         
           t 
          
         
        
          ( 
         
         
         
           x 
          
         
           i 
          
         
        
          ) 
         
        
          + 
         
         
         
           1 
          
         
           2 
          
         
         
         
           h 
          
         
           i 
          
         
         
         
           f 
          
         
           t 
          
         
           2 
          
         
        
          ( 
         
         
         
           x 
          
         
           i 
          
         
        
          ) 
         
        
          ] 
         
        
          + 
         
        
          Ω 
         
        
          ( 
         
         
         
           f 
          
         
           t 
          
         
        
          ) 
         
         
        
          = 
         
         
         
           ∑ 
          
          
          
            i 
           
          
            = 
           
          
            1 
           
          
         
           n 
          
         
        
          [ 
         
         
         
           g 
          
         
           i 
          
         
         
         
           w 
          
          
          
            q 
           
          
            ( 
           
           
           
             x 
            
           
             i 
            
           
          
            ) 
           
          
         
        
          + 
         
         
         
           1 
          
         
           2 
          
         
         
         
           h 
          
         
           i 
          
         
         
         
           w 
          
          
          
            q 
           
          
            ( 
           
           
           
             x 
            
           
             i 
            
           
          
            ) 
           
          
         
        
          ] 
         
        
          + 
         
        
          γ 
         
        
          T 
         
        
          + 
         
        
          λ 
         
         
         
           1 
          
         
           2 
          
         
         
         
           ∑ 
          
          
          
            j 
           
          
            = 
           
          
            1 
           
          
         
           T 
          
         
         
         
           w 
          
         
           j 
          
         
           2 
          
         
         
        
          = 
         
         
         
           ∑ 
          
          
          
            j 
           
          
            = 
           
          
            1 
           
          
         
           T 
          
         
        
          [ 
         
        
          ( 
         
         
         
           ∑ 
          
          
          
            i 
           
          
            ∈ 
           
           
           
             I 
            
           
             j 
            
           
          
         
         
         
           g 
          
         
           i 
          
         
        
          ) 
         
         
         
           w 
          
         
           j 
          
         
        
          + 
         
         
         
           1 
          
         
           2 
          
         
        
          ( 
         
         
         
           ∑ 
          
          
          
            i 
           
          
            ∈ 
           
           
           
             I 
            
           
             j 
            
           
          
         
         
         
           h 
          
         
           i 
          
         
        
          + 
         
        
          λ 
         
        
          ) 
         
         
         
           w 
          
         
           j 
          
         
           2 
          
         
        
          ] 
         
        
          + 
         
        
          λ 
         
        
          T 
        &amp;ThinSpace; 
        
       
         Obj^{(t)}\simeq \sum_{i=1}^n[g_if_t(x_i)+\frac{1}{2}h_if_t^2(x_i)]+\Omega(f_t)\\=\sum_{i=1}^n[g_iw_{q(x_i)}+\frac{1}{2}h_iw_{q(x_i)}]+\gamma T+\lambda \frac{1}{2}\sum_{j=1}^Tw_j^2\\=\sum_{j=1}^T[(\sum_{i\in{I_j}}g_i)w_j+\frac{1}{2}(\sum_{i\in{I_j}}h_i+\lambda)w_j^2]+\lambda T\, 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.13244em; vertical-align: -0.19444em;"></span><span style="margin-right: 0.02778em;" class="mord mathit">O</span><span class="mord mathit">b</span><span class="mord"><span style="margin-right: 0.05724em;" class="mord mathit">j</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.938em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathit mtight">t</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">≃</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.92907em; vertical-align: -1.27767em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.6514em;"><span class="" style="top: -1.87233em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span class="" style="top: -3.05001em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span><span class="" style="top: -4.30001em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.27767em;"><span class=""></span></span></span></span></span><span class="mopen">[</span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathit">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord"><span style="margin-right: 0.10764em;" class="mord mathit">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.280556em;"><span class="" style="top: -2.55em; margin-left: -0.10764em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathit">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 2.00744em; vertical-align: -0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.32144em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">2</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="mord mathit">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord"><span style="margin-right: 0.10764em;" class="mord mathit">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.864108em;"><span class="" style="top: -2.453em; margin-left: -0.10764em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">t</span></span></span><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.247em;"><span class=""></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathit">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose">]</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">Ω</span><span class="mopen">(</span><span class="mord"><span style="margin-right: 0.10764em;" class="mord mathit">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.280556em;"><span class="" style="top: -2.55em; margin-left: -0.10764em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height: 0.36687em; vertical-align: 0em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.92907em; vertical-align: -1.27767em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.6514em;"><span class="" style="top: -1.87233em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span class="" style="top: -3.05001em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span><span class="" style="top: -4.30001em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.27767em;"><span class=""></span></span></span></span></span><span class="mopen">[</span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathit">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord"><span style="margin-right: 0.02691em;" class="mord mathit">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3448em;"><span class="" style="top: -2.5198em; margin-left: -0.02691em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.03588em;" class="mord mathit mtight">q</span><span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mathit mtight">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.328086em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.3552em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 2.00744em; vertical-align: -0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.32144em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">2</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="mord mathit">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord"><span style="margin-right: 0.02691em;" class="mord mathit">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3448em;"><span class="" style="top: -2.5198em; margin-left: -0.02691em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.03588em;" class="mord mathit mtight">q</span><span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mathit mtight">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.328086em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.3552em;"><span class=""></span></span></span></span></span></span><span class="mclose">]</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.87777em; vertical-align: -0.19444em;"></span><span style="margin-right: 0.05556em;" class="mord mathit">γ</span><span style="margin-right: 0.13889em;" class="mord mathit">T</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 3.24211em; vertical-align: -1.41378em;"></span><span class="mord mathit">λ</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.32144em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">2</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.82834em;"><span class="" style="top: -1.87233em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.05724em;" class="mord mathit mtight">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span class="" style="top: -3.05001em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span><span class="" style="top: -4.30001em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.13889em;" class="mord mathit mtight">T</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.41378em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span style="margin-right: 0.02691em;" class="mord mathit">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.864108em;"><span class="" style="top: -2.453em; margin-left: -0.02691em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.05724em;" class="mord mathit mtight">j</span></span></span><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.383108em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height: 0.36687em; vertical-align: 0em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 3.31999em; vertical-align: -1.49166em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.82834em;"><span class="" style="top: -1.87233em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.05724em;" class="mord mathit mtight">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span class="" style="top: -3.05001em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span><span class="" style="top: -4.30001em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.13889em;" class="mord mathit mtight">T</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.41378em;"><span class=""></span></span></span></span></span><span class="mopen">[</span><span class="mopen">(</span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.05001em;"><span class="" style="top: -1.85566em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">i</span><span class="mrel mtight">∈</span><span class="mord mtight"><span class="mord mtight"><span style="margin-right: 0.07847em;" class="mord mathit mtight">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.328086em;"><span class="" style="top: -2.357em; margin-left: -0.07847em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span style="margin-right: 0.05724em;" class="mord mathit mtight">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.281886em;"><span class=""></span></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.05001em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.49166em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathit">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mord"><span style="margin-right: 0.02691em;" class="mord mathit">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.02691em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.05724em;" class="mord mathit mtight">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 2.8131em; vertical-align: -1.49166em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.32144em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">2</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mopen">(</span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.05001em;"><span class="" style="top: -1.85566em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">i</span><span class="mrel mtight">∈</span><span class="mord mtight"><span class="mord mtight"><span style="margin-right: 0.07847em;" class="mord mathit mtight">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.328086em;"><span class="" style="top: -2.357em; margin-left: -0.07847em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span style="margin-right: 0.05724em;" class="mord mathit mtight">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.281886em;"><span class=""></span></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.05001em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.49166em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathit">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1.24722em; vertical-align: -0.383108em;"></span><span class="mord mathit">λ</span><span class="mclose">)</span><span class="mord"><span style="margin-right: 0.02691em;" class="mord mathit">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.864108em;"><span class="" style="top: -2.453em; margin-left: -0.02691em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.05724em;" class="mord mathit mtight">j</span></span></span><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.383108em;"><span class=""></span></span></span></span></span></span><span class="mclose">]</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathit">λ</span><span style="margin-right: 0.13889em;" class="mord mathit">T</span><span class="mspace" style="margin-right: 0.166667em;"></span></span></span></span></span></span><br>   其中，<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           I 
          
         
           j 
          
         
        
          = 
         
         
         
           { 
          
         
           i 
          
         
           ∣ 
          
         
           q 
          
         
           ( 
          
          
          
            x 
           
          
            i 
           
          
         
           ) 
          
         
           = 
          
         
           j 
          
         
           } 
          
         
        
       
         I_j=\left \{i|q(x_i)=j\right\} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.969438em; vertical-align: -0.286108em;"></span><span class="mord"><span style="margin-right: 0.07847em;" class="mord mathit">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.07847em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.05724em;" class="mord mathit mtight">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;">{<!-- --></span><span class="mord mathit">i</span><span class="mord">∣</span><span style="margin-right: 0.03588em;" class="mord mathit">q</span><span class="mopen">(</span><span class="mord"><span class="mord mathit">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span style="margin-right: 0.05724em;" class="mord mathit">j</span><span class="mclose delimcenter" style="top: 0em;">}</span></span></span></span></span></span></span><br>   为了简化，我们令<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           G 
          
         
           j 
          
         
        
          = 
         
         
         
           ∑ 
          
          
          
            i 
           
          
            ∈ 
           
           
           
             I 
            
           
             j 
            
           
          
         
         
         
           g 
          
         
           i 
          
         
        
          , 
         
         
         
           H 
          
         
           j 
          
         
        
          = 
         
         
         
           ∑ 
          
          
          
            i 
           
          
            ∈ 
           
           
           
             I 
            
           
             j 
            
           
          
         
         
         
           h 
          
         
           i 
          
         
        
       
         G_j=\sum_{i\in{I_j}}g_i,H_j=\sum_{i\in{I_j}}h_i 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.969438em; vertical-align: -0.286108em;"></span><span class="mord"><span class="mord mathit">G</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.05724em;" class="mord mathit mtight">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.54166em; vertical-align: -1.49166em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.05001em;"><span class="" style="top: -1.85566em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">i</span><span class="mrel mtight">∈</span><span class="mord mtight"><span class="mord mtight"><span style="margin-right: 0.07847em;" class="mord mathit mtight">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.328086em;"><span class="" style="top: -2.357em; margin-left: -0.07847em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span style="margin-right: 0.05724em;" class="mord mathit mtight">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.281886em;"><span class=""></span></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.05001em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.49166em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathit">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span style="margin-right: 0.08125em;" class="mord mathit">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.08125em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.05724em;" class="mord mathit mtight">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.54166em; vertical-align: -1.49166em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.05001em;"><span class="" style="top: -1.85566em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">i</span><span class="mrel mtight">∈</span><span class="mord mtight"><span class="mord mtight"><span style="margin-right: 0.07847em;" class="mord mathit mtight">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.328086em;"><span class="" style="top: -2.357em; margin-left: -0.07847em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span style="margin-right: 0.05724em;" class="mord mathit mtight">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.281886em;"><span class=""></span></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.05001em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.49166em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathit">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span></span><br>   最终公式可以化简为：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          O 
         
        
          b 
         
         
         
           j 
          
          
          
            ( 
           
          
            t 
           
          
            ) 
           
          
         
        
          = 
         
         
         
           ∑ 
          
          
          
            j 
           
          
            = 
           
          
            1 
           
          
         
           T 
          
         
        
          [ 
         
        
          ( 
         
         
         
           ∑ 
          
          
          
            i 
           
          
            ∈ 
           
           
           
             I 
            
           
             j 
            
           
          
         
         
         
           g 
          
         
           i 
          
         
        
          ) 
         
         
         
           w 
          
         
           j 
          
         
        
          + 
         
         
         
           1 
          
         
           2 
          
         
        
          ( 
         
         
         
           ∑ 
          
          
          
            i 
           
          
            ∈ 
           
           
           
             I 
            
           
             j 
            
           
          
         
         
         
           h 
          
         
           i 
          
         
        
          + 
         
        
          λ 
         
        
          ) 
         
         
         
           w 
          
         
           j 
          
         
           2 
          
         
        
          ] 
         
        
          + 
         
        
          λ 
         
        
          T 
         
         
        
          = 
         
         
         
           ∑ 
          
          
          
            j 
           
          
            = 
           
          
            1 
           
          
         
           T 
          
         
        
          [ 
         
         
         
           G 
          
         
           j 
          
         
         
         
           w 
          
         
           j 
          
         
        
          + 
         
         
         
           1 
          
         
           2 
          
         
        
          ( 
         
         
         
           H 
          
         
           j 
          
         
        
          + 
         
         
         
           λ 
          
         
           j 
          
         
           2 
          
         
        
          ] 
         
        
          + 
         
        
          γ 
         
        
          T 
        &amp;ThinSpace; 
        
       
         Obj^{(t)}=\sum_{j=1}^T[(\sum_{i\in{I_j}}g_i)w_j+\frac{1}{2}(\sum_{i\in{I_j}}h_i+\lambda)w_j^2]+\lambda T\\=\sum_{j=1}^T[G_jw_j+\frac{1}{2}(H_j+\lambda_j^2]+\gamma T\, 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.13244em; vertical-align: -0.19444em;"></span><span style="margin-right: 0.02778em;" class="mord mathit">O</span><span class="mord mathit">b</span><span class="mord"><span style="margin-right: 0.05724em;" class="mord mathit">j</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.938em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathit mtight">t</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 3.31999em; vertical-align: -1.49166em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.82834em;"><span class="" style="top: -1.87233em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.05724em;" class="mord mathit mtight">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span class="" style="top: -3.05001em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span><span class="" style="top: -4.30001em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.13889em;" class="mord mathit mtight">T</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.41378em;"><span class=""></span></span></span></span></span><span class="mopen">[</span><span class="mopen">(</span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.05001em;"><span class="" style="top: -1.85566em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">i</span><span class="mrel mtight">∈</span><span class="mord mtight"><span class="mord mtight"><span style="margin-right: 0.07847em;" class="mord mathit mtight">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.328086em;"><span class="" style="top: -2.357em; margin-left: -0.07847em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span style="margin-right: 0.05724em;" class="mord mathit mtight">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.281886em;"><span class=""></span></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.05001em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.49166em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathit">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mord"><span style="margin-right: 0.02691em;" class="mord mathit">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.02691em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.05724em;" class="mord mathit mtight">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 2.8131em; vertical-align: -1.49166em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.32144em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">2</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mopen">(</span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.05001em;"><span class="" style="top: -1.85566em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">i</span><span class="mrel mtight">∈</span><span class="mord mtight"><span class="mord mtight"><span style="margin-right: 0.07847em;" class="mord mathit mtight">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.328086em;"><span class="" style="top: -2.357em; margin-left: -0.07847em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span style="margin-right: 0.05724em;" class="mord mathit mtight">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.281886em;"><span class=""></span></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.05001em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.49166em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathit">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1.24722em; vertical-align: -0.383108em;"></span><span class="mord mathit">λ</span><span class="mclose">)</span><span class="mord"><span style="margin-right: 0.02691em;" class="mord mathit">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.864108em;"><span class="" style="top: -2.453em; margin-left: -0.02691em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.05724em;" class="mord mathit mtight">j</span></span></span><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.383108em;"><span class=""></span></span></span></span></span></span><span class="mclose">]</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathit">λ</span><span style="margin-right: 0.13889em;" class="mord mathit">T</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height: 0.36687em; vertical-align: 0em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 3.24211em; vertical-align: -1.41378em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.82834em;"><span class="" style="top: -1.87233em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.05724em;" class="mord mathit mtight">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span class="" style="top: -3.05001em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span><span class="" style="top: -4.30001em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.13889em;" class="mord mathit mtight">T</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.41378em;"><span class=""></span></span></span></span></span><span class="mopen">[</span><span class="mord"><span class="mord mathit">G</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.05724em;" class="mord mathit mtight">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mord"><span style="margin-right: 0.02691em;" class="mord mathit">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.02691em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.05724em;" class="mord mathit mtight">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 2.00744em; vertical-align: -0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.32144em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">2</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mopen">(</span><span class="mord"><span style="margin-right: 0.08125em;" class="mord mathit">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.08125em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.05724em;" class="mord mathit mtight">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1.24722em; vertical-align: -0.383108em;"></span><span class="mord"><span class="mord mathit">λ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.864108em;"><span class="" style="top: -2.453em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.05724em;" class="mord mathit mtight">j</span></span></span><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.383108em;"><span class=""></span></span></span></span></span></span><span class="mclose">]</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.87777em; vertical-align: -0.19444em;"></span><span style="margin-right: 0.05556em;" class="mord mathit">γ</span><span style="margin-right: 0.13889em;" class="mord mathit">T</span><span class="mspace" style="margin-right: 0.166667em;"></span></span></span></span></span></span><br>   通过对wj求导等于0，可以得到<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           w 
          
         
           j 
          
         
           ∗ 
          
         
        
          = 
         
        
          − 
         
         
          
          
            G 
           
          
            j 
           
          
          
           
           
             H 
            
           
             j 
            
           
          
            + 
           
          
            λ 
           
          
         
        
       
         w_j^*=-\frac{G_j}{H_j+\lambda} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.1218em; vertical-align: -0.383108em;"></span><span class="mord"><span style="margin-right: 0.02691em;" class="mord mathit">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.738696em;"><span class="" style="top: -2.453em; margin-left: -0.02691em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.05724em;" class="mord mathit mtight">j</span></span></span><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.383108em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.33244em; vertical-align: -0.972108em;"></span><span class="mord">−</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.36033em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span style="margin-right: 0.08125em;" class="mord mathit">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.08125em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.05724em;" class="mord mathit mtight">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathit">λ</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathit">G</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.05724em;" class="mord mathit mtight">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.972108em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span><br>   将最优解代入可得：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          O 
         
        
          b 
         
        
          j 
         
        
          = 
         
        
          − 
         
         
         
           1 
          
         
           2 
          
         
         
         
           ∑ 
          
          
          
            j 
           
          
            = 
           
          
            1 
           
          
         
           T 
          
         
         
          
          
            G 
           
          
            j 
           
          
            2 
           
          
          
           
           
             H 
            
           
             j 
            
           
          
            + 
           
          
            λ 
           
          
         
        
          + 
         
        
          γ 
         
        
          T 
        &amp;ThinSpace; 
        
       
         Obj=-\frac{1}{2}\sum_{j=1}^T\frac{G_j^2}{H_j+\lambda}+\gamma T\, 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span style="margin-right: 0.02778em;" class="mord mathit">O</span><span class="mord mathit">b</span><span style="margin-right: 0.05724em;" class="mord mathit">j</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 3.24211em; vertical-align: -1.41378em;"></span><span class="mord">−</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.32144em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">2</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.82834em;"><span class="" style="top: -1.87233em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.05724em;" class="mord mathit mtight">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span class="" style="top: -3.05001em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span><span class="" style="top: -4.30001em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.13889em;" class="mord mathit mtight">T</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.41378em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.59888em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span style="margin-right: 0.08125em;" class="mord mathit">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.08125em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.05724em;" class="mord mathit mtight">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathit">λ</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.78477em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathit">G</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -2.44134em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.05724em;" class="mord mathit mtight">j</span></span></span><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.394772em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.972108em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.87777em; vertical-align: -0.19444em;"></span><span style="margin-right: 0.05556em;" class="mord mathit">γ</span><span style="margin-right: 0.13889em;" class="mord mathit">T</span><span class="mspace" style="margin-right: 0.166667em;"></span></span></span></span></span></span></p> 
<h5><a id="XGBoost_239"></a>XGBoost模型优点</h5> 
<p>  （1）精度高。XGBoost的损失函数用到了二阶导数信息，而GBDT只用到一阶；<br> 在大多数情况，数据集都无法避免出现null值的情况，从而导致梯度稀疏，在这种情况下，XGBoost为损失函数指定了默认的梯度方向，间接提升了模型精度和速度。<br>   （2）速度快。XGBoost在生成树的最佳分割点时，放弃了贪心算法，而是采用了一种从若干备选点中选择出最优分割点的近似算法，而且可以多线程搜索最佳分割点。XGBoost还以块为单位优化了特征在内存中的存取，解决了Cache-miss问题，间接提高了训练效率。根据论文所说，通过这些方法优化之后，XGBoost的训练速度比scikit-learn快40倍。<br>   （3）可扩展性高。GBDT的基分类器是CART，而XGBoost的基分类器支持CART，Linear，LR；Xgboost的目标函数支持linear、logistic、softmax等，可以处理回归、二分类，多分类问题。另外，XGBoost还可以自定义损失函数。<br>   （4）防止过拟合。XGBoost在损失函数里加入了正则项，降低模型的方差，使模型更简单，防止过拟合，还能自动处理one-hot特征。</p> 
<h4><a id="XGBoost_245"></a>XGBoost模型调参</h4> 
<p>  XGBoost的参数很多，我们主要调节的参数如下：<br>   n_estimators：迭代次数，也就是树的个数；<br>   max_depth：树的深度；<br>   min_child_weight：最小叶子节点样本权重和，值较大是可以避免过拟合；<br>   Gamma：指定了节点分裂所需的最小损失函数下降值；<br>   subsample， colsample_bytree：这两个值一般都是0.8;<br>   lambda, alpha:正则化参数；<br>   learning_rat：学习速率。<br>   调参方法选用网格搜索法，在内部设置好交叉验证的折数，这里设置为5，得分函数选择的是AUC，最后让模型输出最佳得分模型。<br>                   表4 最优参数</p> 
<table><thead><tr><th align="center">learning_rat</th><th align="center">n_estimators</th><th align="center">max_depth</th><th align="center">min_child_weight</th><th align="center">Gamma</th><th align="center">subsample</th><th align="center">colsample_bytree</th><th align="center">lambda</th><th align="center">alpha</th><th align="center">score</th></tr></thead><tbody><tr><td align="center">0.1</td><td align="center">100</td><td align="center">7</td><td align="center">2</td><td align="center">0</td><td align="center">0.8</td><td align="center">0.8</td><td align="center">3</td><td align="center">1</td><td align="center">0.9637</td></tr></tbody></table> 
<h4><a id="_260"></a>模型评估</h4> 
<p>  最后，对调整参数后的模型再次评估。这里采用仍采用原来的评价准则。最后基于评价准则生成了表5和图14。<br>           表5 precision、recall、F1、kappa、accurancy</p> 
<table><thead><tr><th align="center">category</th><th align="center">precision</th><th align="center">recall</th><th align="center">F1</th><th align="center">Kappa</th><th align="center">Accuracy</th></tr></thead><tbody><tr><td align="center">total</td><td align="center">0.86</td><td align="center">0.87</td><td align="center">0.86</td><td align="center">0.55</td><td align="center">86.95%</td></tr><tr><td align="center">0</td><td align="center">0.90</td><td align="center">0.94</td><td align="center">0.92</td><td align="center">-</td><td align="center">-</td></tr><tr><td align="center">1</td><td align="center">0.70</td><td align="center">0.57</td><td align="center">0.62</td><td align="center">-</td><td align="center">-</td></tr></tbody></table> 
<p>  从类别来看，模型对留存客户的预测更为准确，精确度、召回率、F1值都达到了90%左右，但是对已流失客户的表现不是很好。在所有判定为流失客户中有70%是真实流失的，在所有实际流失的客户中仅判定对了57%。但模型总体的精确度是86%、召回率87%、F1值86%、kappa统计量为0.55，准确度是86.95%。总体预测的准确度还是较高的，较未调参的模型提高了0.4个百分点。<br>   下面看一下ROC曲线。</p> 
<p><img src="https://images2.imgbox.com/2a/14/obV0X7pd_o.png" alt="在这里插入图片描述">             图14 XGBoost的ROC曲线<br>   观察ROC曲线图，曲线靠近左上角，即在假阳率很低的情况下真阳率较高，并且AUC面积为0.8756，表示模型效果良好，可用于预测。</p> 
<h2><a id="_274"></a>关于挽留和关怀客户的建议</h2> 
<p>  客户流失的根源在于通过建立客户流失模型使银行能从源头上控制客户流失，防患于未然从而有效的防止客户流失，在日益激烈的市场竞争中，防范客户流失不是“亡羊补牢式”的被动行为，而是贯穿银行经营管理始终的营销策略。防范客户流失、开发新市场、发展新客户都具有重要意义。从营销策略效率考虑，防范客户流失比发展新客户更加经济。主动式的防范客户流失即为银行客户关系管理中长期的策略，重点是通过挽留和关怀客户，提高客户的活跃程度来防止客户向流失状态的转换。由图3-4可知，银行活跃用户的流失率远低于非活跃用户。本节旨在通过分析影响客户流失模型的重要因子，结合之前的描述性分析，为银行挽留和关怀客户提出建议。</p> 
<h3><a id="_276"></a>特征重要性</h3> 
<p>  通过上一节建立的最佳模型，通过weight(权重：所有树中一个特征被用来分裂数据的次数）的方法来衡量特征的重要性，最后得出的特征重要性排序见图15。<br> <img src="https://images2.imgbox.com/33/35/uEk8JP42_o.png" alt="在这里插入图片描述">               图15 特征重要性排序<br>   特征值越大，说明特征越重要。从图15可以清楚的显示出在XGBoost模型下特征的重要程度。其中，特征重要程度得分超过400的有EstimatedSalary（估计收入）、Balance（存贷款）、Tenure（用户使用年数）、CreditScore_range（信用分分组）、age_group（年龄分组）。400分以下的按得分排序分别是NumOfProducts（产品数量）、IsActiveMenber（是否为活跃用户）、Geography_Germany（地区_德国）、Gender（性别）、Geography_Franch（地区_法国），HasCrCard（是否有信用卡）。</p> 
<h3><a id="_280"></a>建议</h3> 
<p>  1、目标人群定位。根据特征重要性排序，特征估计收入和存贷款情况是影响预测客户流失的最重要因素。结合之前的特征频数分布图得知，该银行客户各收入层分布均匀，说明银行并没有重视目标收入客户定位，没有明确目标人群，更多客户选择存入较少的钱。目标客户定位有助于银行指定针对性策略，提供适合目标客户的商品和服务，提高银行的竞争力。例如中国工商银行以中等收入阶层为重点目标客户；中国农业银行重点服务“三农”，建立城乡一体化；中国银行更倾向于中高端客户和大型企业。因此，认为该银行有必要明确目标客户群。<br>   2、用户关怀策略。由图15知，客户使用该银行产品年数也是影响模型的重要因素。为了挽留老客户，推出相应的关怀和激励策略十分有必要。对于使用产品年数较长的客户，银行可以采用会员积分制、会员优先服务、老客户感恩回馈等活动，令客户感受到银行对客户的重视；对于银行新用户，可通过各种优惠活动吸引客户使用，如与政府和商家合作推出打折活动，同时也要通过会员积分制激励新用户向老用户的转换。<br>   3、高信用评级激励制度。信用得分也是预测客户流失的重要影响因素。信用得分是银行用来评估客户是否具有获得信用卡的资格。根据图3-3，可以得知该银行没有取得信用卡的用户流失率更高，但是有信用卡的用户流失率也达到了16%左右。因此，为了挽留银行高信用用户，银行可推出一系列信用卡激励策略，一来可以挽留更多高信用用户，二可以刺激其他未办理信用卡的高信用评级用户申请该银行信用卡。</p> 
<h2><a id="python_284"></a>python编程</h2> 
<pre><code class="prism language-javascript"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> scipy<span class="token punctuation">.</span>stats <span class="token keyword">as</span> stats
<span class="token keyword">import</span> seaborn <span class="token keyword">as</span> sns
<span class="token keyword">import</span> math
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> train_test_split
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">import</span> LabelEncoder<span class="token punctuation">,</span> OneHotEncoder
<span class="token keyword">from</span> imblearn<span class="token punctuation">.</span>over_sampling <span class="token keyword">import</span> <span class="token constant">SMOTE</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> classification_report
<span class="token keyword">from</span> collections <span class="token keyword">import</span> Counter
<span class="token keyword">from</span> sklearn <span class="token keyword">import</span> tree
<span class="token keyword">from</span> sklearn <span class="token keyword">import</span> svm
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>ensemble <span class="token keyword">import</span> RandomForestClassifier
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>linear_model <span class="token keyword">import</span> LogisticRegression
<span class="token keyword">import</span> tensorflow <span class="token keyword">as</span> tf
<span class="token keyword">import</span> keras
<span class="token keyword">from</span> keras<span class="token punctuation">.</span>models <span class="token keyword">import</span> Sequential
<span class="token keyword">from</span> keras<span class="token punctuation">.</span>layers<span class="token punctuation">.</span>core <span class="token keyword">import</span> Dense<span class="token punctuation">,</span>Activation
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>naive_bayes <span class="token keyword">import</span> GaussianNB
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> roc_curve<span class="token punctuation">,</span>roc_auc_score
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> cohen_kappa_score
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> confusion_matrix
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> GridSearchCV
<span class="token operator">%</span>matplotlib inline
#导入数据
customers_data <span class="token operator">=</span> pd<span class="token punctuation">.</span><span class="token function">read_csv</span><span class="token punctuation">(</span><span class="token string">'G://Churn_Modelling.csv'</span><span class="token punctuation">)</span>
<span class="token constant">X</span> <span class="token operator">=</span> customers_data<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'CreditScore'</span><span class="token punctuation">,</span> <span class="token string">'Geography'</span><span class="token punctuation">,</span> <span class="token string">'Gender'</span><span class="token punctuation">,</span> <span class="token string">'Age'</span><span class="token punctuation">,</span> <span class="token string">'Tenure'</span><span class="token punctuation">,</span> <span class="token string">'Balance'</span><span class="token punctuation">,</span> <span class="token string">'NumOfProducts'</span><span class="token punctuation">,</span> <span class="token string">'HasCrCard'</span><span class="token punctuation">,</span> <span class="token string">'IsActiveMember'</span><span class="token punctuation">,</span> <span class="token string">'EstimatedSalary'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
y<span class="token operator">=</span>customers_data<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token string">'Exited'</span><span class="token punctuation">]</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token function">Counter</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span>#打印类标签
#字符变量量化
labelencoder1 <span class="token operator">=</span> <span class="token function">LabelEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token constant">X</span><span class="token punctuation">.</span>Geography<span class="token operator">=</span> labelencoder1<span class="token punctuation">.</span><span class="token function">fit_transform</span><span class="token punctuation">(</span><span class="token constant">X</span><span class="token punctuation">.</span>Geography<span class="token punctuation">)</span>
labelencoder2 <span class="token operator">=</span> <span class="token function">LabelEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token constant">X</span><span class="token punctuation">.</span>Gender <span class="token operator">=</span> labelencoder2<span class="token punctuation">.</span><span class="token function">fit_transform</span><span class="token punctuation">(</span><span class="token constant">X</span><span class="token punctuation">.</span>Gender<span class="token punctuation">)</span>
#变量频数分布和箱线图
def <span class="token function">visual_exploratory</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
    
    <span class="token keyword">for</span> <span class="token keyword">var</span> <span class="token keyword">in</span> x<span class="token punctuation">.</span><span class="token function">select_dtypes</span><span class="token punctuation">(</span>include <span class="token operator">=</span> <span class="token punctuation">[</span>np<span class="token punctuation">.</span>number<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>columns <span class="token punctuation">:</span>
        <span class="token function">print</span><span class="token punctuation">(</span> <span class="token keyword">var</span> <span class="token operator">+</span> <span class="token string">' : '</span><span class="token punctuation">)</span>
        descStats <span class="token operator">=</span>x<span class="token punctuation">[</span><span class="token keyword">var</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">describe</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        mu <span class="token operator">=</span> <span class="token string">"%.2e"</span> <span class="token operator">%</span> descStats<span class="token punctuation">[</span><span class="token string">'mean'</span><span class="token punctuation">]</span>
        std <span class="token operator">=</span> <span class="token string">"%.2e"</span> <span class="token operator">%</span> descStats<span class="token punctuation">[</span><span class="token string">'std'</span><span class="token punctuation">]</span>
        maxVal <span class="token operator">=</span> <span class="token string">"%.2e"</span> <span class="token operator">%</span> descStats<span class="token punctuation">[</span><span class="token string">'max'</span><span class="token punctuation">]</span>
        minVal <span class="token operator">=</span> <span class="token string">"%.2e"</span> <span class="token operator">%</span> descStats<span class="token punctuation">[</span><span class="token string">'min'</span><span class="token punctuation">]</span>
        x<span class="token punctuation">[</span><span class="token keyword">var</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">plot</span><span class="token punctuation">(</span><span class="token string">'hist'</span><span class="token punctuation">)</span>
        titleText <span class="token operator">=</span> <span class="token string">'Histogram of '</span><span class="token operator">+</span> <span class="token keyword">var</span> <span class="token operator">+</span><span class="token string">'\n Mean ='</span><span class="token operator">+</span>mu<span class="token operator">+</span> <span class="token string">' Std='</span><span class="token operator">+</span>std<span class="token operator">+</span><span class="token string">'\n Max='</span><span class="token operator">+</span>maxVal<span class="token operator">+</span><span class="token string">' Min='</span><span class="token operator">+</span>minVal
        plt<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        
<span class="token function">visual_exploratory</span><span class="token punctuation">(</span>customers_data <span class="token punctuation">)</span>

# ploting the box plot to visually inspect numeric data

def <span class="token function">boxPlot_exploratory</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
    
    <span class="token keyword">for</span> <span class="token keyword">var</span> <span class="token keyword">in</span> x<span class="token punctuation">.</span><span class="token function">select_dtypes</span><span class="token punctuation">(</span>include <span class="token operator">=</span> <span class="token punctuation">[</span>np<span class="token punctuation">.</span>number<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>columns <span class="token punctuation">:</span>
        <span class="token function">print</span><span class="token punctuation">(</span> <span class="token keyword">var</span> <span class="token operator">+</span> <span class="token string">' : '</span><span class="token punctuation">)</span>
        x<span class="token punctuation">.</span><span class="token function">boxplot</span><span class="token punctuation">(</span>column <span class="token operator">=</span> <span class="token keyword">var</span><span class="token punctuation">)</span>
        plt<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        
<span class="token function">boxPlot_exploratory</span><span class="token punctuation">(</span><span class="token constant">X</span><span class="token punctuation">)</span>
Xgroup<span class="token operator">=</span><span class="token constant">X</span><span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
#将信用分进行分组
# Helper <span class="token keyword">function</span> that will create and add a <span class="token keyword">new</span> <span class="token class-name">column</span> tof credit score range the data frame
def <span class="token function">creditscore</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    score <span class="token operator">=</span> data<span class="token punctuation">.</span>CreditScore
    score_range <span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token function">range</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>score<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> 
        <span class="token keyword">if</span> <span class="token punctuation">(</span>score<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">600</span><span class="token punctuation">)</span> <span class="token punctuation">:</span>  
            score_range<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> # <span class="token string">'Very Bad Credit'</span>
        <span class="token function">elif</span> <span class="token punctuation">(</span> <span class="token number">600</span> <span class="token operator">&lt;=</span> score<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">650</span><span class="token punctuation">)</span> <span class="token punctuation">:</span>  
            score_range<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> # <span class="token string">'Bad Credit'</span>
        <span class="token function">elif</span> <span class="token punctuation">(</span> <span class="token number">650</span> <span class="token operator">&lt;=</span> score<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">700</span><span class="token punctuation">)</span> <span class="token punctuation">:</span>  
            score_range<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> # <span class="token string">'Good Credit'</span>
        <span class="token function">elif</span> <span class="token punctuation">(</span> <span class="token number">700</span> <span class="token operator">&lt;=</span> score<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">750</span><span class="token punctuation">)</span> <span class="token punctuation">:</span>  
            score_range<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> # <span class="token string">'Very Good Credit'</span>
        elif score<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">750</span> <span class="token punctuation">:</span> 
            score_range<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> # <span class="token string">'Excellent Credit'</span>
    <span class="token keyword">return</span> score_range

# converting the returned list into a dataframe
CreditScore_category <span class="token operator">=</span> pd<span class="token punctuation">.</span><span class="token function">DataFrame</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'CreditScore_range'</span><span class="token punctuation">:</span> <span class="token function">creditscore</span><span class="token punctuation">(</span>Xgroup<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
#年龄分组
def <span class="token function">agegroup</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    age <span class="token operator">=</span> data<span class="token punctuation">.</span>Age
    age_range <span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token function">range</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> 
        <span class="token keyword">if</span> <span class="token punctuation">(</span>age<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">30</span><span class="token punctuation">)</span> <span class="token punctuation">:</span>  
            age_range<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> # <span class="token string">'Between 18 and 30 year'</span>   
        <span class="token function">elif</span> <span class="token punctuation">(</span> <span class="token number">30</span> <span class="token operator">&lt;=</span> age<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">40</span><span class="token punctuation">)</span> <span class="token punctuation">:</span>  
            age_range<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> # <span class="token string">'Between 30 and 40 year'</span>
        <span class="token function">elif</span> <span class="token punctuation">(</span> <span class="token number">40</span> <span class="token operator">&lt;=</span> age<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">)</span> <span class="token punctuation">:</span>  
            age_range<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> # <span class="token string">'Between 40 and 50 year'</span>
        <span class="token function">elif</span> <span class="token punctuation">(</span> <span class="token number">50</span> <span class="token operator">&lt;=</span> age<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">60</span><span class="token punctuation">)</span> <span class="token punctuation">:</span>  
            age_range<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> # <span class="token string">''</span>Between <span class="token number">50</span> and <span class="token number">60</span> year'
        <span class="token function">elif</span> <span class="token punctuation">(</span> <span class="token number">60</span> <span class="token operator">&lt;=</span> age<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">70</span><span class="token punctuation">)</span> <span class="token punctuation">:</span>  
            age_range<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> # <span class="token string">'Between 60 and 70 year'</span>
        <span class="token function">elif</span> <span class="token punctuation">(</span> <span class="token number">70</span> <span class="token operator">&lt;=</span> age<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">80</span><span class="token punctuation">)</span> <span class="token punctuation">:</span>  
            age_range<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span> # <span class="token string">'Between 70 and 80 year'</span>
        elif age<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">80</span> <span class="token punctuation">:</span> 
            age_range<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span> # <span class="token string">''</span>Above <span class="token number">80</span> year'
    <span class="token keyword">return</span> age_range
def <span class="token function">visual_exploratory</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
    
    <span class="token keyword">for</span> <span class="token keyword">var</span> <span class="token keyword">in</span> x<span class="token punctuation">.</span><span class="token function">select_dtypes</span><span class="token punctuation">(</span>include <span class="token operator">=</span> <span class="token punctuation">[</span>np<span class="token punctuation">.</span>number<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>columns <span class="token punctuation">:</span>
        <span class="token function">print</span><span class="token punctuation">(</span> <span class="token keyword">var</span> <span class="token operator">+</span> <span class="token string">' : '</span><span class="token punctuation">)</span>
        descStats <span class="token operator">=</span>x<span class="token punctuation">[</span><span class="token keyword">var</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">describe</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        mu <span class="token operator">=</span> <span class="token string">"%.2e"</span> <span class="token operator">%</span> descStats<span class="token punctuation">[</span><span class="token string">'mean'</span><span class="token punctuation">]</span>
        std <span class="token operator">=</span> <span class="token string">"%.2e"</span> <span class="token operator">%</span> descStats<span class="token punctuation">[</span><span class="token string">'std'</span><span class="token punctuation">]</span>
        maxVal <span class="token operator">=</span> <span class="token string">"%.2e"</span> <span class="token operator">%</span> descStats<span class="token punctuation">[</span><span class="token string">'max'</span><span class="token punctuation">]</span>
        minVal <span class="token operator">=</span> <span class="token string">"%.2e"</span> <span class="token operator">%</span> descStats<span class="token punctuation">[</span><span class="token string">'min'</span><span class="token punctuation">]</span>
        x<span class="token punctuation">[</span><span class="token keyword">var</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">plot</span><span class="token punctuation">(</span><span class="token string">'hist'</span><span class="token punctuation">)</span>
        titleText <span class="token operator">=</span> <span class="token string">'Histogram of '</span><span class="token operator">+</span> <span class="token keyword">var</span> <span class="token operator">+</span><span class="token string">'\n Mean ='</span><span class="token operator">+</span>mu<span class="token operator">+</span> <span class="token string">' Std='</span><span class="token operator">+</span>std<span class="token operator">+</span><span class="token string">'\n Max='</span><span class="token operator">+</span>maxVal<span class="token operator">+</span><span class="token string">' Min='</span><span class="token operator">+</span>minVal
        plt<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        
<span class="token function">visual_exploratory</span><span class="token punctuation">(</span>AgeGroup_category <span class="token punctuation">)</span>
<span class="token function">visual_exploratory</span><span class="token punctuation">(</span>CreditScore_category<span class="token punctuation">)</span>
# converting the returned list into a dataframe
AgeGroup_category <span class="token operator">=</span> pd<span class="token punctuation">.</span><span class="token function">DataFrame</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'age_group'</span><span class="token punctuation">:</span> <span class="token function">agegroup</span><span class="token punctuation">(</span><span class="token constant">X</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
#插入Xgroup<span class="token punctuation">,</span> CreditScore_category，删去<span class="token string">'CreditScore'</span><span class="token punctuation">,</span><span class="token string">'Age'</span>
Xgroup<span class="token operator">=</span>pd<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span>Xgroup<span class="token punctuation">,</span> CreditScore_category<span class="token punctuation">]</span><span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
Xgroup<span class="token operator">=</span>pd<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span>Xgroup<span class="token punctuation">,</span>AgeGroup_category<span class="token punctuation">]</span><span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
Xgroup<span class="token operator">=</span>Xgroup<span class="token punctuation">.</span><span class="token function">drop</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'CreditScore'</span><span class="token punctuation">,</span><span class="token string">'Age'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
#相关性检验
Xcorr<span class="token operator">=</span>Xgroup
<span class="token function">print</span><span class="token punctuation">(</span>Xcorr<span class="token punctuation">.</span><span class="token function">corr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
g<span class="token operator">=</span>sns<span class="token punctuation">.</span><span class="token function">pairplot</span><span class="token punctuation">(</span>Xcorr<span class="token punctuation">,</span>vars<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'Geography'</span><span class="token punctuation">,</span><span class="token string">'Gender'</span><span class="token punctuation">,</span><span class="token string">'Tenure'</span><span class="token punctuation">,</span> <span class="token string">'Balance'</span><span class="token punctuation">,</span> <span class="token string">'NumOfProducts'</span><span class="token punctuation">,</span> <span class="token string">'HasCrCard'</span><span class="token punctuation">,</span> <span class="token string">'IsActiveMember'</span><span class="token punctuation">,</span> <span class="token string">'EstimatedSalary'</span><span class="token punctuation">,</span><span class="token string">'CreditScore_range'</span><span class="token punctuation">,</span><span class="token string">'age_group'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
#划分训练集、测试集
Xgroup_train<span class="token punctuation">,</span> Xgroup_test<span class="token punctuation">,</span> ygroup_train<span class="token punctuation">,</span> ygroup_test <span class="token operator">=</span> <span class="token function">train_test_split</span><span class="token punctuation">(</span>Xgroup<span class="token punctuation">,</span> y<span class="token punctuation">,</span> test_size <span class="token operator">=</span> <span class="token number">0.2</span><span class="token punctuation">,</span> random_state <span class="token operator">=</span><span class="token number">40</span><span class="token punctuation">)</span>
model_smote <span class="token operator">=</span> <span class="token constant">SMOTE</span><span class="token punctuation">(</span><span class="token punctuation">)</span> # 建立<span class="token constant">SMOTE</span>模型对象
xgroup_smote<span class="token punctuation">,</span> ygroup_smote <span class="token operator">=</span> model_smote<span class="token punctuation">.</span><span class="token function">fit_sample</span><span class="token punctuation">(</span>Xgroup_train<span class="token punctuation">,</span> ygroup_train<span class="token punctuation">)</span> # 输入数据并作过抽样处理
xgroup_smote <span class="token operator">=</span> pd<span class="token punctuation">.</span><span class="token function">DataFrame</span><span class="token punctuation">(</span>xgroup_smote<span class="token punctuation">,</span> columns<span class="token operator">=</span><span class="token punctuation">[</span> <span class="token string">'Geography'</span><span class="token punctuation">,</span> <span class="token string">'Gender'</span><span class="token punctuation">,</span> <span class="token string">'Tenure'</span><span class="token punctuation">,</span> <span class="token string">'Balance'</span><span class="token punctuation">,</span> <span class="token string">'NumOfProducts'</span><span class="token punctuation">,</span> <span class="token string">'HasCrCard'</span><span class="token punctuation">,</span> <span class="token string">'IsActiveMember'</span><span class="token punctuation">,</span> <span class="token string">'EstimatedSalary'</span><span class="token punctuation">,</span><span class="token string">'CreditScore_range'</span><span class="token punctuation">,</span><span class="token string">'age_group'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> # 将数据转换为数据框并命名列名
ygroup_smote <span class="token operator">=</span> pd<span class="token punctuation">.</span><span class="token function">DataFrame</span><span class="token punctuation">(</span>ygroup_smote<span class="token punctuation">,</span>columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'Exited'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> # 将数据转换为数据框并命名列名
smotegroup_resampled <span class="token operator">=</span> pd<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span>xgroup_smote<span class="token punctuation">,</span> ygroup_smote<span class="token punctuation">]</span><span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span> # 按列合并数据框
groupby_data_smote <span class="token operator">=</span> smotegroup_resampled<span class="token punctuation">.</span><span class="token function">groupby</span><span class="token punctuation">(</span><span class="token string">'Exited'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> # 对label做分类汇总
#smote处理后分类变量离散化
Xgroup_smote_train<span class="token operator">=</span>pd<span class="token punctuation">.</span><span class="token function">DataFrame</span><span class="token punctuation">(</span>Xgroup_smote<span class="token punctuation">,</span>columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'Geography_Franch'</span><span class="token punctuation">,</span><span class="token string">'Geography_Germany'</span><span class="token punctuation">,</span><span class="token string">'Geography_Spain'</span><span class="token punctuation">,</span> <span class="token string">'Gender'</span><span class="token punctuation">,</span> <span class="token string">'Tenure'</span><span class="token punctuation">,</span> <span class="token string">'Balance'</span><span class="token punctuation">,</span> <span class="token string">'NumOfProducts'</span><span class="token punctuation">,</span> <span class="token string">'HasCrCard'</span><span class="token punctuation">,</span> <span class="token string">'IsActiveMember'</span><span class="token punctuation">,</span> <span class="token string">'EstimatedSalary'</span><span class="token punctuation">,</span><span class="token string">'CreditScore_range'</span><span class="token punctuation">,</span><span class="token string">'age_group'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
length<span class="token operator">=</span><span class="token function">len</span><span class="token punctuation">(</span>xgroup_smote<span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token function">range</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">:</span>
    
    <span class="token keyword">if</span> xgroup_smote<span class="token punctuation">.</span>Geography<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">&gt;=</span><span class="token number">1.5</span><span class="token punctuation">:</span>
        xgroup_smote<span class="token punctuation">.</span>Geography<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">int</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    elif xgroup_smote<span class="token punctuation">.</span>Geography<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">&gt;=</span><span class="token number">0.5</span> and xgroup_smote<span class="token punctuation">.</span>Geography<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">&lt;</span><span class="token number">1.5</span><span class="token punctuation">:</span>
        xgroup_smote<span class="token punctuation">.</span>Geography<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">int</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        xgroup_smote<span class="token punctuation">.</span>Geography<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">int</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> xgroup_smote<span class="token punctuation">.</span>Gender<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">&gt;=</span><span class="token number">0.5</span><span class="token punctuation">:</span>
        xgroup_smote<span class="token punctuation">.</span>Gender<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">1</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        xgroup_smote<span class="token punctuation">.</span>Gender<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span>
    <span class="token keyword">if</span> xgroup_smote<span class="token punctuation">.</span>HasCrCard<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">&gt;=</span><span class="token number">0.5</span><span class="token punctuation">:</span>
        xgroup_smote<span class="token punctuation">.</span>HasCrCard<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">1</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        xgroup_smote<span class="token punctuation">.</span>HasCrCard<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span>
    <span class="token keyword">if</span> xgroup_smote<span class="token punctuation">.</span>IsActiveMember<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">&gt;=</span><span class="token number">0.5</span><span class="token punctuation">:</span>
        xgroup_smote<span class="token punctuation">.</span>IsActiveMember<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">1</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        xgroup_smote<span class="token punctuation">.</span>IsActiveMember<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
#独热编码
Xgroup_smote<span class="token operator">=</span>xgroup_smote<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
onehotencoder <span class="token operator">=</span> <span class="token function">OneHotEncoder</span><span class="token punctuation">(</span>categorical_features <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
Xgroup_smote <span class="token operator">=</span> onehotencoder<span class="token punctuation">.</span><span class="token function">fit_transform</span><span class="token punctuation">(</span>Xgroup_smote<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toarray</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
Xgroup_smote_train<span class="token operator">=</span>pd<span class="token punctuation">.</span><span class="token function">DataFrame</span><span class="token punctuation">(</span>Xgroup_smote<span class="token punctuation">,</span>columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'Geography_Franch'</span><span class="token punctuation">,</span><span class="token string">'Geography_Germany'</span><span class="token punctuation">,</span><span class="token string">'Geography_Spain'</span><span class="token punctuation">,</span> <span class="token string">'Gender'</span><span class="token punctuation">,</span> <span class="token string">'Tenure'</span><span class="token punctuation">,</span> <span class="token string">'Balance'</span><span class="token punctuation">,</span> <span class="token string">'NumOfProducts'</span><span class="token punctuation">,</span> <span class="token string">'HasCrCard'</span><span class="token punctuation">,</span> <span class="token string">'IsActiveMember'</span><span class="token punctuation">,</span> <span class="token string">'EstimatedSalary'</span><span class="token punctuation">,</span><span class="token string">'CreditScore_range'</span><span class="token punctuation">,</span><span class="token string">'age_group'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
Xgrouphot_test<span class="token operator">=</span>Xgroup_test<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
onehotencoder <span class="token operator">=</span> <span class="token function">OneHotEncoder</span><span class="token punctuation">(</span>categorical_features <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
Xgrouphot_test <span class="token operator">=</span> onehotencoder<span class="token punctuation">.</span><span class="token function">fit_transform</span><span class="token punctuation">(</span>Xgrouphot_test<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toarray</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
Xgrouphot_test<span class="token operator">=</span>pd<span class="token punctuation">.</span><span class="token function">DataFrame</span><span class="token punctuation">(</span>Xgrouphot_test<span class="token punctuation">,</span>columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'Geography_Franch'</span><span class="token punctuation">,</span><span class="token string">'Geography_Germany'</span><span class="token punctuation">,</span><span class="token string">'Geography_Spain'</span><span class="token punctuation">,</span> <span class="token string">'Gender'</span><span class="token punctuation">,</span> <span class="token string">'Tenure'</span><span class="token punctuation">,</span> <span class="token string">'Balance'</span><span class="token punctuation">,</span> <span class="token string">'NumOfProducts'</span><span class="token punctuation">,</span> <span class="token string">'HasCrCard'</span><span class="token punctuation">,</span> <span class="token string">'IsActiveMember'</span><span class="token punctuation">,</span> <span class="token string">'EstimatedSalary'</span><span class="token punctuation">,</span><span class="token string">'CreditScore_range'</span><span class="token punctuation">,</span><span class="token string">'age_group'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
#虚拟变量处理
Xgroup_smote_train<span class="token operator">=</span>Xgroup_smote_train<span class="token punctuation">.</span><span class="token function">drop</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Geography_Spain'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
Xgrouphot_test<span class="token operator">=</span>Xgrouphot_test<span class="token punctuation">.</span><span class="token function">drop</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Geography_Spain'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>

#标准化
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">import</span> StandardScaler
sc <span class="token operator">=</span> <span class="token function">StandardScaler</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
Xgroup_smote_train <span class="token operator">=</span> sc<span class="token punctuation">.</span><span class="token function">fit_transform</span><span class="token punctuation">(</span>Xgroup_smote_train<span class="token punctuation">)</span>
Xgrouphot_test <span class="token operator">=</span> sc<span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span>Xgrouphot_test<span class="token punctuation">)</span>
#tree
clfgroup <span class="token operator">=</span> tree<span class="token punctuation">.</span><span class="token function">DecisionTreeClassifier</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
clfgroup <span class="token operator">=</span> clfgroup<span class="token punctuation">.</span><span class="token function">fit</span><span class="token punctuation">(</span>Xgroup_smote_train<span class="token punctuation">,</span>ygroup_smote<span class="token punctuation">)</span>
y_predgroup <span class="token operator">=</span> clfgroup<span class="token punctuation">.</span><span class="token function">predict</span><span class="token punctuation">(</span>Xgrouphot_test<span class="token punctuation">)</span>
accuracy1 <span class="token operator">=</span> <span class="token function">accuracy_score</span><span class="token punctuation">(</span>ygroup_test<span class="token punctuation">,</span> y_predgroup<span class="token punctuation">)</span>

<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Accuracy: %.2f%%"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>accuracy1<span class="token operator">*</span> <span class="token number">100.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token function">classification_report</span><span class="token punctuation">(</span>ygroup_test<span class="token punctuation">,</span> y_predgroup<span class="token punctuation">)</span><span class="token punctuation">)</span>
#XGBoost
xgb_model2<span class="token operator">=</span> xgb<span class="token punctuation">.</span><span class="token function">XGBClassifier</span><span class="token punctuation">(</span>objective <span class="token operator">=</span><span class="token string">'binary:logistic'</span><span class="token punctuation">,</span>learning_rat<span class="token operator">=</span> <span class="token number">0.1</span><span class="token punctuation">,</span> n_estimators<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> max_depth<span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">,</span> min_child_weight<span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> seed<span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
                    subsample<span class="token operator">=</span><span class="token number">0.8</span><span class="token punctuation">,</span> colsample_bytree<span class="token operator">=</span> <span class="token number">0.8</span><span class="token punctuation">,</span> gamma<span class="token operator">=</span><span class="token number">0.</span><span class="token punctuation">,</span> reg_alpha<span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> reg_lambda<span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span>
                    xgb_model2<span class="token punctuation">.</span><span class="token function">fit</span><span class="token punctuation">(</span>Xgroup_smote_train<span class="token punctuation">,</span>ygroup_smote<span class="token punctuation">)</span>
# make predictions <span class="token keyword">for</span> test data
predictions2 <span class="token operator">=</span> xgb_model2<span class="token punctuation">.</span><span class="token function">predict</span><span class="token punctuation">(</span>Xgrouphot_test<span class="token punctuation">)</span>
# evaluate predictions
accuracy2 <span class="token operator">=</span> <span class="token function">accuracy_score</span><span class="token punctuation">(</span>ygroup_test<span class="token punctuation">,</span> predictions2<span class="token punctuation">)</span>

<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Accuracy: %.2f%%"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>accuracy2<span class="token operator">*</span> <span class="token number">100.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token function">classification_report</span><span class="token punctuation">(</span>ygroup_test<span class="token punctuation">,</span> predictions2<span class="token punctuation">)</span><span class="token punctuation">)</span>
#<span class="token constant">RF</span>
clfrf <span class="token operator">=</span> <span class="token function">RandomForestClassifier</span><span class="token punctuation">(</span>n_estimators<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> max_depth<span class="token operator">=</span>None<span class="token punctuation">,</span>min_samples_split<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span> 
clfrf<span class="token operator">=</span>clfrf<span class="token punctuation">.</span><span class="token function">fit</span><span class="token punctuation">(</span>Xgroup_smote_train<span class="token punctuation">,</span>ygroup_smote<span class="token punctuation">)</span>
predictions_rf <span class="token operator">=</span> clfrf<span class="token punctuation">.</span><span class="token function">predict</span><span class="token punctuation">(</span>Xgrouphot_test<span class="token punctuation">)</span>
# evaluate predictions
accuracy_rf <span class="token operator">=</span> <span class="token function">accuracy_score</span><span class="token punctuation">(</span>ygroup_test<span class="token punctuation">,</span> predictions_rf<span class="token punctuation">)</span>

<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Accuracy: %.2f%%"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>accuracy_rf<span class="token operator">*</span> <span class="token number">100.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token function">classification_report</span><span class="token punctuation">(</span>ygroup_test<span class="token punctuation">,</span> predictions_rf<span class="token punctuation">)</span><span class="token punctuation">)</span>
#svm
ygroup_smote_np<span class="token operator">=</span>np<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span>ygroup_smote<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reshape</span><span class="token punctuation">(</span><span class="token number">12694</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
sv <span class="token operator">=</span> svm<span class="token punctuation">.</span><span class="token constant">SVC</span><span class="token punctuation">(</span>kernel<span class="token operator">=</span><span class="token string">'rbf'</span><span class="token punctuation">,</span> <span class="token constant">C</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> gamma<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>probability<span class="token operator">=</span>True<span class="token punctuation">)</span> 
sv<span class="token operator">=</span>sv<span class="token punctuation">.</span><span class="token function">fit</span><span class="token punctuation">(</span>Xgroup_smote_train<span class="token punctuation">,</span>ygroup_smote_np<span class="token punctuation">)</span>
predictions_sv <span class="token operator">=</span> sv<span class="token punctuation">.</span><span class="token function">predict</span><span class="token punctuation">(</span>Xgrouphot_test<span class="token punctuation">)</span>
# evaluate predictions
accuracy_sv <span class="token operator">=</span> <span class="token function">accuracy_score</span><span class="token punctuation">(</span>ygroup_test<span class="token punctuation">,</span> predictions_sv<span class="token punctuation">)</span>

<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Accuracy: %.2f%%"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>accuracy_sv<span class="token operator">*</span> <span class="token number">100.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token function">classification_report</span><span class="token punctuation">(</span>ygroup_test<span class="token punctuation">,</span> predictions_sv<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token function">confusion_matrix</span><span class="token punctuation">(</span>ygroup_test<span class="token punctuation">,</span> predictions_sv<span class="token punctuation">)</span><span class="token punctuation">)</span>
#<span class="token constant">LR</span>
lr<span class="token operator">=</span><span class="token function">LogisticRegression</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
lr<span class="token operator">=</span>lr<span class="token punctuation">.</span><span class="token function">fit</span><span class="token punctuation">(</span>Xgroup_smote_train<span class="token punctuation">,</span>ygroup_smote_np<span class="token punctuation">)</span>
predictions_lr <span class="token operator">=</span> lr<span class="token punctuation">.</span><span class="token function">predict</span><span class="token punctuation">(</span>Xgrouphot_test<span class="token punctuation">)</span>
# evaluate predictions
accuracy_lr <span class="token operator">=</span> <span class="token function">accuracy_score</span><span class="token punctuation">(</span>ygroup_test<span class="token punctuation">,</span> predictions_lr<span class="token punctuation">)</span>

<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Accuracy: %.2f%%"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>accuracy_lr<span class="token operator">*</span> <span class="token number">100.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token function">classification_report</span><span class="token punctuation">(</span>ygroup_test<span class="token punctuation">,</span> predictions_lr<span class="token punctuation">)</span><span class="token punctuation">)</span>

#bayes
by<span class="token operator">=</span><span class="token function">GaussianNB</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
by<span class="token operator">=</span>by<span class="token punctuation">.</span><span class="token function">fit</span><span class="token punctuation">(</span>Xgroup_smote_train<span class="token punctuation">,</span>ygroup_smote_np<span class="token punctuation">)</span>
predictions_by <span class="token operator">=</span> by<span class="token punctuation">.</span><span class="token function">predict</span><span class="token punctuation">(</span>Xgrouphot_test<span class="token punctuation">)</span>
# evaluate predictions
accuracy_by <span class="token operator">=</span> <span class="token function">accuracy_score</span><span class="token punctuation">(</span>ygroup_test<span class="token punctuation">,</span> predictions_by<span class="token punctuation">)</span>

<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Accuracy: %.2f%%"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>accuracy_by<span class="token operator">*</span> <span class="token number">100.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token function">classification_report</span><span class="token punctuation">(</span>ygroup_test<span class="token punctuation">,</span> predictions_by<span class="token punctuation">)</span><span class="token punctuation">)</span>
#<span class="token constant">LM</span>
net<span class="token operator">=</span><span class="token function">Sequential</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
net<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">Dense</span><span class="token punctuation">(</span>input_dim<span class="token operator">=</span><span class="token number">11</span><span class="token punctuation">,</span>output_dim<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
net<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">Activation</span><span class="token punctuation">(</span><span class="token string">'relu'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
net<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">Dense</span><span class="token punctuation">(</span>input_dim<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span>output_dim<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
net<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">Activation</span><span class="token punctuation">(</span><span class="token string">'sigmoid'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
net<span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span>loss<span class="token operator">=</span><span class="token string">'mean_squared_error'</span><span class="token punctuation">,</span>optimizer<span class="token operator">=</span><span class="token string">'adam'</span><span class="token punctuation">)</span>
net<span class="token punctuation">.</span><span class="token function">fit</span><span class="token punctuation">(</span>Xgroup_smote_train<span class="token punctuation">,</span>ygroup_smote<span class="token punctuation">,</span>epochs <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">,</span> batch_size <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">)</span>
pred_lm<span class="token operator">=</span> net<span class="token punctuation">.</span><span class="token function">predict_classes</span><span class="token punctuation">(</span>Xgrouphot_test<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reshape</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>ygroup_test<span class="token punctuation">)</span><span class="token punctuation">)</span>
prob_lm<span class="token operator">=</span> net<span class="token punctuation">.</span><span class="token function">predict</span><span class="token punctuation">(</span>Xgrouphot_test<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reshape</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>ygroup_test<span class="token punctuation">)</span><span class="token punctuation">)</span>
accuracy_lm <span class="token operator">=</span> <span class="token function">accuracy_score</span><span class="token punctuation">(</span>ygroup_test<span class="token punctuation">,</span> pred_lm<span class="token punctuation">)</span>

<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Accuracy: %.2f%%"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>accuracy_lm<span class="token operator">*</span> <span class="token number">100.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token function">classification_report</span><span class="token punctuation">(</span>ygroup_test<span class="token punctuation">,</span> pred_lm<span class="token punctuation">)</span>
#<span class="token constant">ROC</span>
prob_sv<span class="token operator">=</span>sv<span class="token punctuation">.</span><span class="token function">predict_proba</span><span class="token punctuation">(</span>Xgrouphot_test<span class="token punctuation">)</span>
prob_lr<span class="token operator">=</span>lr<span class="token punctuation">.</span><span class="token function">predict_proba</span><span class="token punctuation">(</span>Xgrouphot_test<span class="token punctuation">)</span>
prob_by<span class="token operator">=</span>by<span class="token punctuation">.</span><span class="token function">predict_proba</span><span class="token punctuation">(</span>Xgrouphot_test<span class="token punctuation">)</span>
prob_rf<span class="token operator">=</span>clfrf<span class="token punctuation">.</span><span class="token function">predict_proba</span><span class="token punctuation">(</span>Xgrouphot_test<span class="token punctuation">)</span>
prob_xgb<span class="token operator">=</span>xgb_model2<span class="token punctuation">.</span><span class="token function">predict_proba</span><span class="token punctuation">(</span>Xgrouphot_test<span class="token punctuation">)</span>
prob_tree<span class="token operator">=</span>clfgroup<span class="token punctuation">.</span><span class="token function">predict_proba</span><span class="token punctuation">(</span>Xgrouphot_test<span class="token punctuation">)</span>
fpr_sv<span class="token punctuation">,</span> tpr_sv<span class="token punctuation">,</span> thresholds_sv <span class="token operator">=</span> <span class="token function">roc_curve</span><span class="token punctuation">(</span>ygroup_test<span class="token punctuation">,</span> prob_sv<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> drop_intermediate<span class="token operator">=</span> True<span class="token punctuation">)</span>
fpr_lr<span class="token punctuation">,</span> tpr_lr<span class="token punctuation">,</span> thresholds_lr <span class="token operator">=</span> <span class="token function">roc_curve</span><span class="token punctuation">(</span>ygroup_test<span class="token punctuation">,</span> prob_lr<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> drop_intermediate<span class="token operator">=</span> True<span class="token punctuation">)</span>
fpr_by<span class="token punctuation">,</span> tpr_by<span class="token punctuation">,</span> thresholds_by <span class="token operator">=</span> <span class="token function">roc_curve</span><span class="token punctuation">(</span>ygroup_test<span class="token punctuation">,</span> prob_by<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> drop_intermediate<span class="token operator">=</span> True<span class="token punctuation">)</span>
fpr_rf<span class="token punctuation">,</span> tpr_rf<span class="token punctuation">,</span> thresholds_rf <span class="token operator">=</span> <span class="token function">roc_curve</span><span class="token punctuation">(</span>ygroup_test<span class="token punctuation">,</span> prob_rf<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> drop_intermediate<span class="token operator">=</span> True<span class="token punctuation">)</span>
fpr_xgb<span class="token punctuation">,</span> tpr_xgb<span class="token punctuation">,</span> thresholds_xgb <span class="token operator">=</span> <span class="token function">roc_curve</span><span class="token punctuation">(</span>ygroup_test<span class="token punctuation">,</span> prob_xgb<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> drop_intermediate<span class="token operator">=</span> True<span class="token punctuation">)</span>
fpr_tree<span class="token punctuation">,</span> tpr_tree<span class="token punctuation">,</span> thresholds_tree <span class="token operator">=</span> <span class="token function">roc_curve</span><span class="token punctuation">(</span>ygroup_test<span class="token punctuation">,</span> prob_tree<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> drop_intermediate<span class="token operator">=</span> True<span class="token punctuation">)</span>
fpr_lm<span class="token punctuation">,</span> tpr_lm<span class="token punctuation">,</span> thresholds_lm<span class="token operator">=</span> <span class="token function">roc_curve</span><span class="token punctuation">(</span>ygroup_test<span class="token punctuation">,</span> prob_lm<span class="token punctuation">,</span> drop_intermediate<span class="token operator">=</span> True<span class="token punctuation">)</span>
auc_lm<span class="token operator">=</span><span class="token function">roc_auc_score</span><span class="token punctuation">(</span>ygroup_test<span class="token punctuation">,</span>prob_lm<span class="token punctuation">)</span>
auc_sv<span class="token operator">=</span><span class="token function">roc_auc_score</span><span class="token punctuation">(</span>ygroup_test<span class="token punctuation">,</span> prob_sv<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
auc_lr<span class="token operator">=</span><span class="token function">roc_auc_score</span><span class="token punctuation">(</span>ygroup_test<span class="token punctuation">,</span> prob_lr<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
auc_by<span class="token operator">=</span><span class="token function">roc_auc_score</span><span class="token punctuation">(</span>ygroup_test<span class="token punctuation">,</span> prob_by<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
auc_rf<span class="token operator">=</span><span class="token function">roc_auc_score</span><span class="token punctuation">(</span>ygroup_test<span class="token punctuation">,</span> prob_rf<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
auc_xgb<span class="token operator">=</span><span class="token function">roc_auc_score</span><span class="token punctuation">(</span>ygroup_test<span class="token punctuation">,</span> prob_xgb<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
auc_tree<span class="token operator">=</span><span class="token function">roc_auc_score</span><span class="token punctuation">(</span>ygroup_test<span class="token punctuation">,</span> prob_tree<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span><span class="token function">plot</span><span class="token punctuation">(</span>fpr_sv<span class="token punctuation">,</span> tpr_sv<span class="token punctuation">,</span>label<span class="token operator">=</span> <span class="token string">"SVM-AUC:%.4f"</span><span class="token operator">%</span>auc_sv<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span><span class="token function">plot</span><span class="token punctuation">(</span>fpr_lr<span class="token punctuation">,</span> tpr_lr<span class="token punctuation">,</span>label<span class="token operator">=</span> <span class="token string">"LR-AUC:%.4f"</span><span class="token operator">%</span>auc_lr<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span><span class="token function">plot</span><span class="token punctuation">(</span>fpr_by<span class="token punctuation">,</span> tpr_by<span class="token punctuation">,</span>label<span class="token operator">=</span> <span class="token string">"Bayes-AUC:%.4f"</span><span class="token operator">%</span>auc_by<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span><span class="token function">plot</span><span class="token punctuation">(</span>fpr_rf<span class="token punctuation">,</span> tpr_rf<span class="token punctuation">,</span>label<span class="token operator">=</span> <span class="token string">"RF-AUC:%.4f"</span><span class="token operator">%</span>auc_rf<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span><span class="token function">plot</span><span class="token punctuation">(</span>fpr_xgb<span class="token punctuation">,</span> tpr_xgb<span class="token punctuation">,</span>label<span class="token operator">=</span> <span class="token string">"XGB-AUC:%.4f"</span><span class="token operator">%</span>auc_xgb<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span><span class="token function">plot</span><span class="token punctuation">(</span>fpr_tree<span class="token punctuation">,</span> tpr_tree<span class="token punctuation">,</span>label<span class="token operator">=</span> <span class="token string">"Tree-AUC:%.4f"</span><span class="token operator">%</span>auc_tree<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span><span class="token function">plot</span><span class="token punctuation">(</span>fpr_lm<span class="token punctuation">,</span> tpr_lm<span class="token punctuation">,</span>label<span class="token operator">=</span> <span class="token string">"LM-AUC:%.4f"</span><span class="token operator">%</span>auc_lm<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span><span class="token function">legend</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span><span class="token function">plot</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span><span class="token function">xlim</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span><span class="token function">ylim</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span><span class="token function">title</span><span class="token punctuation">(</span><span class="token string">'Roc curve'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
#kappa
kappa_SVM<span class="token operator">=</span><span class="token function">cohen_kappa_score</span><span class="token punctuation">(</span>ygroup_test<span class="token punctuation">,</span> predictions_sv<span class="token punctuation">)</span>
kappa_LR<span class="token operator">=</span><span class="token function">cohen_kappa_score</span><span class="token punctuation">(</span>ygroup_test<span class="token punctuation">,</span> predictions_lr<span class="token punctuation">)</span>
kappa_Tree<span class="token operator">=</span><span class="token function">cohen_kappa_score</span><span class="token punctuation">(</span>ygroup_test<span class="token punctuation">,</span> y_predgroup<span class="token punctuation">)</span>
kappa_RF<span class="token operator">=</span><span class="token function">cohen_kappa_score</span><span class="token punctuation">(</span>ygroup_test<span class="token punctuation">,</span> predictions_rf<span class="token punctuation">)</span>
kappa_XGB<span class="token operator">=</span><span class="token function">cohen_kappa_score</span><span class="token punctuation">(</span>ygroup_test<span class="token punctuation">,</span> predictions2<span class="token punctuation">)</span>
kappa_Bayes<span class="token operator">=</span><span class="token function">cohen_kappa_score</span><span class="token punctuation">(</span>ygroup_test<span class="token punctuation">,</span> predictions_by<span class="token punctuation">)</span>
kappa_LM<span class="token operator">=</span><span class="token function">cohen_kappa_score</span><span class="token punctuation">(</span>ygroup_test<span class="token punctuation">,</span> pred_lm<span class="token punctuation">)</span>
num_list<span class="token operator">=</span><span class="token punctuation">[</span>kappa_SVM<span class="token punctuation">,</span>kappa_LR<span class="token punctuation">,</span>kappa_Tree<span class="token punctuation">,</span>kappa_RF<span class="token punctuation">,</span>kappa_XGB<span class="token punctuation">,</span>kappa_Bayes<span class="token punctuation">,</span>kappa_LM<span class="token punctuation">]</span>
name_list<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'SVM'</span><span class="token punctuation">,</span><span class="token string">'LR'</span><span class="token punctuation">,</span><span class="token string">'Tree'</span><span class="token punctuation">,</span><span class="token string">'RF'</span><span class="token punctuation">,</span><span class="token string">'XGB'</span><span class="token punctuation">,</span><span class="token string">'Bayes'</span><span class="token punctuation">,</span><span class="token string">'LM'</span><span class="token punctuation">]</span>
plt<span class="token punctuation">.</span><span class="token function">bar</span><span class="token punctuation">(</span>name_list<span class="token punctuation">,</span>num_list<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span><span class="token function">title</span><span class="token punctuation">(</span>u<span class="token string">'各模型kappa值对比'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
#调参
#n_estimators
cv_params <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'n_estimators'</span><span class="token punctuation">:</span> <span class="token number">80</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">120</span><span class="token punctuation">,</span><span class="token number">140</span><span class="token punctuation">,</span><span class="token number">160</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
other_params <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'learning_rat'</span><span class="token punctuation">:</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token string">'n_estimators'</span><span class="token punctuation">:</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">'max_depth'</span><span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token string">'min_child_weight'</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span>
                    <span class="token string">'subsample'</span><span class="token punctuation">:</span><span class="token number">0.8</span><span class="token punctuation">,</span> <span class="token string">'colsample_bytree'</span><span class="token punctuation">:</span> <span class="token number">0.8</span><span class="token punctuation">,</span> <span class="token string">'gamma'</span><span class="token punctuation">:</span><span class="token number">0.</span><span class="token punctuation">,</span> <span class="token string">'reg_alpha'</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'reg_lambda'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span>
optimized_GBM<span class="token punctuation">.</span><span class="token function">fit</span><span class="token punctuation">(</span>Xgroup_smote_train<span class="token punctuation">,</span>ygroup_smote<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'参数的最佳取值：{0}'</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>optimized_GBM<span class="token punctuation">.</span>best_params_<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'最佳模型得分:{0}'</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>optimized_GBM<span class="token punctuation">.</span>best_score_<span class="token punctuation">)</span><span class="token punctuation">)</span>
#max_depth、min_child_weight
cv_params <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token string">'max_depth'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'min_child_weight'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
other_params <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'learning_rat'</span><span class="token punctuation">:</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token string">'n_estimators'</span><span class="token punctuation">:</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">'max_depth'</span><span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token string">'min_child_weight'</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span>
                    <span class="token string">'subsample'</span><span class="token punctuation">:</span><span class="token number">0.8</span><span class="token punctuation">,</span> <span class="token string">'colsample_bytree'</span><span class="token punctuation">:</span> <span class="token number">0.8</span><span class="token punctuation">,</span> <span class="token string">'gamma'</span><span class="token punctuation">:</span><span class="token number">0.</span><span class="token punctuation">,</span> <span class="token string">'reg_alpha'</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'reg_lambda'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span>
                    model <span class="token operator">=</span> xgb<span class="token punctuation">.</span><span class="token function">XGBClassifier</span><span class="token punctuation">(</span><span class="token operator">**</span>other_params<span class="token punctuation">)</span>
optimized_GBM <span class="token operator">=</span> <span class="token function">GridSearchCV</span><span class="token punctuation">(</span>estimator<span class="token operator">=</span>model<span class="token punctuation">,</span> param_grid<span class="token operator">=</span>cv_params<span class="token punctuation">,</span> scoring<span class="token operator">=</span><span class="token string">'roc_auc'</span><span class="token punctuation">,</span> cv<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> verbose<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> n_jobs<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>
optimized_GBM<span class="token punctuation">.</span><span class="token function">fit</span><span class="token punctuation">(</span>Xgroup_smote_train<span class="token punctuation">,</span>ygroup_smote<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'参数的最佳取值：{0}'</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>optimized_GBM<span class="token punctuation">.</span>best_params_<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'最佳模型得分:{0}'</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>optimized_GBM<span class="token punctuation">.</span>best_score_<span class="token punctuation">)</span><span class="token punctuation">)</span>
#gamma
cv_params <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'gamma'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.6</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
other_params <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'learning_rate'</span><span class="token punctuation">:</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token string">'n_estimators'</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">'max_depth'</span><span class="token punctuation">:</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token string">'min_child_weight'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'seed'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                    <span class="token string">'subsample'</span><span class="token punctuation">:</span> <span class="token number">0.8</span><span class="token punctuation">,</span> <span class="token string">'colsample_bytree'</span><span class="token punctuation">:</span> <span class="token number">0.8</span><span class="token punctuation">,</span> <span class="token string">'gamma'</span><span class="token punctuation">:</span> <span class="token number">0.</span><span class="token punctuation">,</span> <span class="token string">'reg_alpha'</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'reg_lambda'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span>
                    model <span class="token operator">=</span> xgb<span class="token punctuation">.</span><span class="token function">XGBClassifier</span><span class="token punctuation">(</span><span class="token operator">**</span>other_params<span class="token punctuation">)</span>
optimized_GBM <span class="token operator">=</span> <span class="token function">GridSearchCV</span><span class="token punctuation">(</span>estimator<span class="token operator">=</span>model<span class="token punctuation">,</span> param_grid<span class="token operator">=</span>cv_params<span class="token punctuation">,</span> scoring<span class="token operator">=</span><span class="token string">'roc_auc'</span><span class="token punctuation">,</span> cv<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> verbose<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> n_jobs<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
optimized_GBM<span class="token punctuation">.</span><span class="token function">fit</span><span class="token punctuation">(</span>Xgroup_smote_train<span class="token punctuation">,</span>ygroup_smote<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'参数的最佳取值：{0}'</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>optimized_GBM<span class="token punctuation">.</span>best_params_<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'最佳模型得分:{0}'</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>optimized_GBM<span class="token punctuation">.</span>best_score_<span class="token punctuation">)</span><span class="token punctuation">)</span>
#reg_alpha、'reg_lambda
cv_params <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'reg_alpha'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0.2</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.6</span><span class="token punctuation">,</span><span class="token number">0.8</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'reg_lambda'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
other_params <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'learning_rate'</span><span class="token punctuation">:</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token string">'n_estimators'</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">'max_depth'</span><span class="token punctuation">:</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token string">'min_child_weight'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'seed'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                    <span class="token string">'subsample'</span><span class="token punctuation">:</span> <span class="token number">0.8</span><span class="token punctuation">,</span> <span class="token string">'colsample_bytree'</span><span class="token punctuation">:</span> <span class="token number">0.8</span><span class="token punctuation">,</span> <span class="token string">'gamma'</span><span class="token punctuation">:</span> <span class="token number">0.</span><span class="token punctuation">,</span> <span class="token string">'reg_alpha'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'reg_lambda'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span>
                    model <span class="token operator">=</span> xgb<span class="token punctuation">.</span><span class="token function">XGBClassifier</span><span class="token punctuation">(</span><span class="token operator">**</span>other_params<span class="token punctuation">)</span>
optimized_GBM <span class="token operator">=</span> <span class="token function">GridSearchCV</span><span class="token punctuation">(</span>estimator<span class="token operator">=</span>model<span class="token punctuation">,</span> param_grid<span class="token operator">=</span>cv_params<span class="token punctuation">,</span> scoring<span class="token operator">=</span><span class="token string">'roc_auc'</span><span class="token punctuation">,</span> cv<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> verbose<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> n_jobs<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
optimized_GBM<span class="token punctuation">.</span><span class="token function">fit</span><span class="token punctuation">(</span>Xgroup_smote_train<span class="token punctuation">,</span>ygroup_smote<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'参数的最佳取值：{0}'</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>optimized_GBM<span class="token punctuation">.</span>best_params_<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'最佳模型得分:{0}'</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>optimized_GBM<span class="token punctuation">.</span>best_score_<span class="token punctuation">)</span><span class="token punctuation">)</span>
#learning_rate
cv_params <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'learning_rate'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0.01</span><span class="token punctuation">,</span> <span class="token number">0.05</span><span class="token punctuation">,</span> <span class="token number">0.07</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
other_params <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'learning_rate'</span><span class="token punctuation">:</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token string">'n_estimators'</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">'max_depth'</span><span class="token punctuation">:</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token string">'min_child_weight'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'seed'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                    <span class="token string">'subsample'</span><span class="token punctuation">:</span> <span class="token number">0.8</span><span class="token punctuation">,</span> <span class="token string">'colsample_bytree'</span><span class="token punctuation">:</span> <span class="token number">0.8</span><span class="token punctuation">,</span> <span class="token string">'gamma'</span><span class="token punctuation">:</span> <span class="token number">0.</span><span class="token punctuation">,</span> <span class="token string">'reg_alpha'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'reg_lambda'</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">}</span>
                    model <span class="token operator">=</span> xgb<span class="token punctuation">.</span><span class="token function">XGBClassifier</span><span class="token punctuation">(</span><span class="token operator">**</span>other_params<span class="token punctuation">)</span>
optimized_GBM <span class="token operator">=</span> <span class="token function">GridSearchCV</span><span class="token punctuation">(</span>estimator<span class="token operator">=</span>model<span class="token punctuation">,</span> param_grid<span class="token operator">=</span>cv_params<span class="token punctuation">,</span> scoring<span class="token operator">=</span><span class="token string">'roc_auc'</span><span class="token punctuation">,</span> cv<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> verbose<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> n_jobs<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
optimized_GBM<span class="token punctuation">.</span><span class="token function">fit</span><span class="token punctuation">(</span>Xgroup_smote_train<span class="token punctuation">,</span>ygroup_smote<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'参数的最佳取值：{0}'</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>optimized_GBM<span class="token punctuation">.</span>best_params_<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'最佳模型得分:{0}'</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>optimized_GBM<span class="token punctuation">.</span>best_score_<span class="token punctuation">)</span><span class="token punctuation">)</span>
#模型评估
xgb_model_xgb<span class="token operator">=</span> xgb<span class="token punctuation">.</span><span class="token function">XGBClassifier</span><span class="token punctuation">(</span>objective <span class="token operator">=</span><span class="token string">'binary:logistic'</span><span class="token punctuation">,</span>learning_rate<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">,</span> n_estimators<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> max_depth<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span> min_child_weight<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> seed<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>
                    subsample<span class="token operator">=</span><span class="token number">0.8</span><span class="token punctuation">,</span> colsample_bytree<span class="token operator">=</span><span class="token number">0.8</span><span class="token punctuation">,</span> gamma<span class="token operator">=</span><span class="token number">0.</span><span class="token punctuation">,</span> reg_alpha<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> reg_lambda<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
xgb_model_xgb<span class="token punctuation">.</span><span class="token function">fit</span><span class="token punctuation">(</span>Xgroup_smote_train<span class="token punctuation">,</span>ygroup_smote<span class="token punctuation">)</span>
# make predictions <span class="token keyword">for</span> test data
predictions_xgb <span class="token operator">=</span> xgb_model_xgb<span class="token punctuation">.</span><span class="token function">predict</span><span class="token punctuation">(</span>Xgrouphot_test<span class="token punctuation">)</span>
# evaluate predictions
accuracy_xgb <span class="token operator">=</span> <span class="token function">accuracy_score</span><span class="token punctuation">(</span>ygroup_test<span class="token punctuation">,</span> predictions_xgb<span class="token punctuation">)</span>

<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Accuracy: %.2f%%"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>accuracy_xgb<span class="token operator">*</span> <span class="token number">100.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
prob_xgb<span class="token operator">=</span>xgb_model_xgb<span class="token punctuation">.</span><span class="token function">predict_proba</span><span class="token punctuation">(</span>Xgrouphot_test<span class="token punctuation">)</span>
fpr<span class="token punctuation">,</span> tpr<span class="token punctuation">,</span> thresholds <span class="token operator">=</span> <span class="token function">roc_curve</span><span class="token punctuation">(</span>ygroup_test<span class="token punctuation">,</span> prob_xgb<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> drop_intermediate<span class="token operator">=</span> True<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span><span class="token function">plot</span><span class="token punctuation">(</span>fpr<span class="token punctuation">,</span> tpr<span class="token punctuation">,</span>label<span class="token operator">=</span> <span class="token string">"auc"</span><span class="token punctuation">)</span>
auc<span class="token operator">=</span><span class="token function">roc_auc_score</span><span class="token punctuation">(</span>ygroup_test<span class="token punctuation">,</span> prob_xgb<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span><span class="token function">legend</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span><span class="token function">plot</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span><span class="token function">xlim</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span><span class="token function">ylim</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span><span class="token function">title</span><span class="token punctuation">(</span>auc<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
xgb<span class="token punctuation">.</span><span class="token function">plot_importance</span><span class="token punctuation">(</span>xgb_model_xgb<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
kappa<span class="token operator">=</span><span class="token function">cohen_kappa_score</span><span class="token punctuation">(</span>ygroup_test<span class="token punctuation">,</span> pxgb<span class="token punctuation">)</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/00c24511790f594dc9dbf8b29ccf997d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">GAN的系列经典模型讲解</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/566edd64690c80327ab4b0db4d205f9a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Android 系统签名</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>