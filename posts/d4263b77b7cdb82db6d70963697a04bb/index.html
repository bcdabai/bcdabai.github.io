<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>linux下/etc/hosts 和hostname文件的区别 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="linux下/etc/hosts 和hostname文件的区别" />
<meta property="og:description" content="linux下/etc/hosts 和hostname文件的区别 hostname与/etc/hosts的关系
很过人一提到更改hostname首先就想到修改/etc/hosts文件，认为hostname的配置文件就是/etc/hosts。其实不是的。
hosts文件的作用相当如DNS，提供IP地址到hostname的对应。早期的互联网计算机少，单机hosts文件里足够存放所有联网计算机。不过随着互联网的发展，这就远远不够了。于是就出现了分布式的DNS系统。由DNS服务器来提供类似的IP地址到域名的对应。具体可以man hosts。
Linux系统在向DNS服务器发出域名解析请求之前会查询/etc/hosts文件，如果里面有相应的记录，就会使用hosts里面的记录。/etc/hosts文件通常里面包含这一条记录
127.0.0.1 localhost.localdomain localhost
hosts文件格式是一行一条记录，分别是IP地址 hostname aliases，三者用空白字符分隔，aliases可选。
127.0.0.1到localhost这一条建议不要修改，因为很多应用程序会用到这个，比如sendmail，修改之后这些程序可能就无法正常运行。
修改hostname后，如果想要在本机上用newhostname来访问，就必须在/etc/hosts文件里添加一条newhostname的记录。比如我的eth0的IP是192.168.1.61，我将hosts文件修改如下：
#hostname blog.infernor.net
# cat /etc/hosts
127.0.0.1 localhost.localdomain localhost
192.168.1.61 blog.infernor.net blog
这样，我就可以通过blog或者blog.infernor.net来访问本机。
从上面这些来看，/etc/hosts于设置hostname是没直接关系的，仅仅当你要在本机上用新的hostname来访问自己的时候才会用到/etc/hosts文件。两者没有必然的联系。
RHEL还有个问题。
我开始在测试的时候，只修改/etc/hosts，里面添加 192.168.1.61 blog.infernor.net blog，而/etc/sysconfig/network维持原状，也就是里面的HOSTNAME=localhost.localdomain。我重启系统后居然发现hostname给修改成了blog.infernor.net。这样看的话，倒真觉得/etc/hosts是hostname的配置文件。后来终于在/etc/rc.d/rc.sysinit这个启动脚本里发现了问题的所在。
rc.sysinit文件里一开始就设置了hostname
if [ -f /etc/sysconfig/network ]; then
. /etc/sysconfig/network
fi
if [ -z &#34;$HOSTNAME&#34; -o &#34;$HOSTNAME&#34; = &#34;(none)&#34; ]; then
HOSTNAME=localhost
fi
确实使用了/etc/sysconfig/network里的hostname值。不过后面还有一段关于设置hostname的
ipaddr=
if [ &#34;$HOSTNAME&#34; = &#34;localhost&#34; -o &#34;$HOSTNAME&#34; = &#34;localhost.localdomain&#34; ]
; then" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/d4263b77b7cdb82db6d70963697a04bb/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2012-09-21T11:15:32+08:00" />
<meta property="article:modified_time" content="2012-09-21T11:15:32+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">linux下/etc/hosts 和hostname文件的区别</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div class="content-head clearfix" style="zoom:1; color:rgb(69,69,69); font-family:'Microsoft Yahei',微软雅黑,Tahoma,Arial,Helvetica,STHeiti"> 
 <h3 class="title content-title" style="margin:0px 0px 10px; padding:0px; font-size:20px; color:rgb(58,58,58); font-weight:normal; float:left"> linux下/etc/hosts 和hostname文件的区别</h3> 
</div> 
<div id="content" class="content mod-cs-content text-content clearfix" style="zoom:1; width:758px; overflow:hidden; font-size:14px; margin:7px 0px 10px; color:rgb(69,69,69); font-family:'Microsoft Yahei',微软雅黑,Tahoma,Arial,Helvetica,STHeiti"> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> hostname与/etc/hosts的关系<br> <br> 很过人一提到更改hostname首先就想到修改/etc/hosts文件，认为hostname的配置文件就是/etc/hosts。其实不是的。<br> <br> hosts文件的作用相当如DNS，提供IP地址到hostname的对应。早期的互联网计算机少，单机hosts文件里足够存放所有联网计算机。不过随着互联网的发展，这就远远不够了。于是就出现了分布式的DNS系统。由DNS服务器来提供类似的IP地址到域名的对应。具体可以man hosts。<br> <br> Linux系统在向DNS服务器发出域名解析请求之前会查询/etc/hosts文件，如果里面有相应的记录，就会使用hosts里面的记录。/etc/hosts文件通常里面包含这一条记录<br> <br> 127.0.0.1    localhost.localdomain   localhost<br> hosts文件格式是一行一条记录，分别是IP地址 hostname aliases，三者用空白字符分隔，aliases可选。<br> <br> 127.0.0.1到localhost这一条建议不要修改，因为很多应用程序会用到这个，比如sendmail，修改之后这些程序可能就无法正常运行。<br> <br> 修改hostname后，如果想要在本机上用newhostname来访问，就必须在/etc/hosts文件里添加一条newhostname的记录。比如我的eth0的IP是192.168.1.61，我将hosts文件修改如下：<br> <br> #hostname blog.infernor.net<br> # cat /etc/hosts<br> 127.0.0.1  localhost.localdomain localhost<br> 192.168.1.61    blog.infernor.net       blog<br> 这样，我就可以通过blog或者blog.infernor.net来访问本机。<br> <br> 从上面这些来看，/etc/hosts于设置hostname是没直接关系的，仅仅当你要在本机上用新的hostname来访问自己的时候才会用到/etc/hosts文件。两者没有必然的联系。<br> <br> RHEL还有个问题。<br> <br> 我开始在测试的时候，只修改/etc/hosts，里面添加 192.168.1.61 blog.infernor.net blog，而/etc/sysconfig/network维持原状，也就是里面的HOSTNAME=localhost.localdomain。我重启系统后居然发现hostname给修改成了blog.infernor.net。这样看的话，倒真觉得/etc/hosts是hostname的配置文件。后来终于在/etc/rc.d/rc.sysinit这个启动脚本里发现了问题的所在。<br> <br> rc.sysinit文件里一开始就设置了hostname<br> <br> if [ -f /etc/sysconfig/network ]; then<br> . /etc/sysconfig/network<br> fi<br> if [ -z "$HOSTNAME" -o "$HOSTNAME" = "(none)" ]; then<br> HOSTNAME=localhost<br> fi<br> 确实使用了/etc/sysconfig/network里的hostname值。不过后面还有一段关于设置hostname的<br> <br> ipaddr=<br> if [ "$HOSTNAME" = "localhost" -o "$HOSTNAME" = "localhost.localdomain" ]<br> ; then<br> ipaddr=$(ip addr show to 0/0 scope global | awk '/[[:space:]]inet<br> / { print gensub("/.*","","g",$2) }')<br> if [ -n "$ipaddr" ]; then<br> eval $(ipcalc -h $ipaddr 2&gt;/dev/null)<br> hostname ${HOSTNAME}<br> fi<br> fi<br> 脚本判断hostname是否为localhost或者localhost.localdomain，如果是的话，将会使用接口IP地址对应的 hostname来重新设置系统的hostname。问题就出在这里，我的/etc/sysconfig/network默认的hostname是 localhost.localdomain，eth0的IP是192.168.1.61，而/etc/hosts里有192.168.1.61的记录。于是就用192.168.1.61这条记录来替换了hostname。<br> <br> 估计这也是很多人将/etc/hosts误以为是hostname的配置文件的原因。<br> <br> hostname带选项查询<br> <br> hostname的-s -f -i等等选项都用到了/etc/hosts或者DNS系统，跟我们讨论的hostname有点远了，也容易产生误会。具体可以man hostname查看。</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> ----------------------------------------</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> </p> 
 <p style="font-family:Simsun; font-size:14px">总结一下修改主机名最安全的方法：</p> 
 <p style="font-family:Simsun; font-size:14px">1. 停止与主机名相关的软件运行，比如mysql。</p> 
 <p style="font-family:Simsun; font-size:14px">2. 先使用 hostname newname 设置主机名。</p> 
 <p style="font-family:Simsun; font-size:14px">3. 在/etc/hosts中修改或增加 ip newname 行，并检查原来127.0.0.1行localhost回环的设置。</p> 
 <p style="font-family:Simsun; font-size:14px">4. 在/etc/sysconfig/network中修改HOSTNAME=newname。</p> 
 <p style="font-family:Simsun; font-size:14px">5. 重新启动机器并确认是否修改成功。</p> 
 <br> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> <br> </p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> 转自：<a href="http://hi.baidu.com/xingzai621/item/b92c66ef2adab0225b2d640a" rel="nofollow">http://hi.baidu.com/xingzai621/item/b92c66ef2adab0225b2d640a</a></p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f61ed153eb8b75e6c5de79153dee9d51/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Oracle安装目录admin下各文件夹的作用的说明</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/fdfbacde8a06b25939b00e3bb9151ae2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">delphi function 与 procedure</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>