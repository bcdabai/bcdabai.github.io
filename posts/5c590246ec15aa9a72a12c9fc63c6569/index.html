<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>PostgreSQL pg_hba.conf 文件简析 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="PostgreSQL pg_hba.conf 文件简析" />
<meta property="og:description" content="点击上方&#34;蓝字&#34;
关注我们，享更多干货！
pg_hba.conf文件存放在数据库集群的数据目录里。
HBA 的意思是 host-based authentication：基于主机的认证。在initdb初始化数据目录的时候，它会安装一个缺省的文件。
文件pg_hba.conf的常用格式是一套记录，每行一条。空白行被忽略，井号（ # ）开头的注释也被忽略并且记录不能跨行存在。
每条记录声明一种联接类型、一个客户端 IP 地址范围（如果和联接类型相关的话）、一个数据库名、一个用户名字以及对匹配这些参数的联接使用的认证方法。
第一条匹配联接类型、客户端地址和联接企图请求的数据库名和用户名的记录将用于执行认证。
下面是常用的pg_hba.conf配置：
# TYPE DATABASE USER CIDR-ADDRESS METHOD # &#34;local&#34; is for Unix domain socket connections only local all all ident # IPv4 local connections: host all all 127.0.0.1/32 md5 # IPv6 local connections: host all all ::1/128 md5 TYPE定义了多种连接PostgreSQL的方式，分别是：
“local”使用本地unix套接字
“host”使用TCP/IP连接（包括SSL和非SSL）
“host”结合“IPv4地址”使用IPv4方式
结合“IPv6地址”则使用IPv6方式
“hostssl”只能使用SSL TCP/IP连接
“hostnossl”不能使用SSL TCP/IP连接
DATABASE指定哪个数据库、多个数据库、库名间以逗号分隔。“all”只有在没有其他条目符合时才代表“所有”，如果有其他条目符合则代表“除了该条之外的”，因为“all”的优先级最低。如下例：
local testdb test reject local all all ident 这两条都是指定local访问方式，因为前一条指定了特定的数据库testdb，所以后一条的all代表的是除了tesstdb之外的数据库，同理，用户的all也是如此。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/5c590246ec15aa9a72a12c9fc63c6569/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-07-09T17:14:38+08:00" />
<meta property="article:modified_time" content="2021-07-09T17:14:38+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">PostgreSQL pg_hba.conf 文件简析</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div id="js_content"> 
 <p>点击上方"蓝字"</p> 
 <p>关注我们，享更多干货！</p> 
 <p>pg_hba.conf文件存放在数据库集群的数据目录里。<br></p> 
 <p>HBA 的意思是 host-based authentication：基于主机的认证。在initdb初始化数据目录的时候，它会安装一个缺省的文件。</p> 
 <p>文件pg_hba.conf的常用格式是一套记录，每行一条。空白行被忽略，井号（ # ）开头的注释也被忽略并且记录不能跨行存在。</p> 
 <p>每条记录声明一种联接类型、一个客户端 IP 地址范围（如果和联接类型相关的话）、一个数据库名、一个用户名字以及对匹配这些参数的联接使用的认证方法。<br></p> 
 <p>第一条匹配联接类型、客户端地址和联接企图请求的数据库名和用户名的记录将用于执行认证。</p> 
 <hr> 
 <p>下面是常用的pg_hba.conf配置：<br></p> 
 <pre class="has"><code class="language-go"># TYPE  DATABASE  USER  CIDR-ADDRESS  METHOD
 
# "local" is for Unix domain socket connections only
local    all      all                 ident
# IPv4 local connections:
host     all      all   127.0.0.1/32  md5
# IPv6 local connections:
host     all      all   ::1/128       md5
</code></pre> 
 <p>TYPE定义了多种连接PostgreSQL的方式，分别是：</p> 
 <ul><li><p>“local”使用本地unix套接字</p></li><li><p>“host”使用TCP/IP连接（包括SSL和非SSL）</p></li><li><p>“host”结合“IPv4地址”使用IPv4方式</p></li><li><p>结合“IPv6地址”则使用IPv6方式</p></li><li><p>“hostssl”只能使用SSL TCP/IP连接</p></li><li><p>“hostnossl”不能使用SSL TCP/IP连接</p></li></ul> 
 <p>DATABASE指定哪个数据库、多个数据库、库名间以逗号分隔。“all”只有在没有其他条目符合时才代表“所有”，如果有其他条目符合则代表“除了该条之外的”，因为“all”的优先级最低。如下例：</p> 
 <pre class="has"><code class="language-go">local   testdb    test      reject
local    all      all        ident
</code></pre> 
 <p>这两条都是指定local访问方式，因为前一条指定了特定的数据库testdb，所以后一条的all代表的是除了tesstdb之外的数据库，同理，用户的all也是如此。</p> 
 <p>USER指定哪个数据库用户（PostgreSQL正规的叫法是角色，role）。多个用户以逗号分隔。</p> 
 <p>CIDR-ADDRESS项local方式不必填写，该项可以是IPv4地址或IPv6地址，可以定义某台主机或某个网段。</p> 
 <p>METHOD指定如何处理客户端的认证。常用的有ident、md5、password、trust、peer、reject。其中ident和peer模式仅适用于Linux、Unix和Max，不适用于Windows。</p> 
 <p>ident是Linux下PostgreSQL默认的local认证方式，凡是能正确登录服务器的操作系统用户（注：不是数据库用户），就能使用本用户映射的数据库且用户不需密码登录数据库。用户映射文件为pg_ident.conf，这个文件记录着与操作系统用户匹配的数据库用户，如果某操作系统用户在本文件中没有映射用户，则默认的映射数据库用户与操作系统用户同名。比如，服务器上有名为test的操作系统用户，同时数据库上也有同名的数据库用户，test登录操作系统后可以直接输入psql，以test数据库用户身份登录数据库且不需密码。所以在刚开始学习PG的时候常遇到psql -U username登录数据库却出现“username ident 认证失败”的错误，明明数据库用户已经createuser。原因就在于使用了ident认证方式，却没有同名的操作系统用户或没有相应的映射用户。解决方案如下：</p> 
 <p>1、在pg_ident.conf中添加映射用户；</p> 
 <p>2、改变认证方式。</p> 
 <p>md5是常用的密码认证方式，如果你不使用ident，最好使用md5。密码是以md5形式传送给数据库，较安全，且不需建立同名的操作系统用户。</p> 
 <p>password是以明文密码传送给数据库，建议不要在生产环境中使用。</p> 
 <p>trust是只要知道数据库用户名不需要密码或ident就能登录，建议不要在生产环境中使用。</p> 
 <p>peer是使用连接发起端的操作系统名进行身份验证。仅限于Linux、BSD、Mac OS X和Solaris，并且仅可用于本地服务器发起的连接。</p> 
 <p>reject是拒绝认证。</p> 
 <p>即使是针对同一个数据库，多种身份验证模式可以同时使用。对于每一个连接请求，postgres服务器会按照pg_hba.conf文件中记录的规则条目自上而下进行检查。</p> 
 <p>当匹配到第一条满足条件的规则时，就不再向下检查。如果到文件末尾都没有搜到匹配的规则，那么按默认规则处理，即拒绝该链接。</p> 
 <p>本地使用psql登录数据库，是以unix套接字附合local的方式。</p> 
 <p>使用PGAdmin3或php登录数据库，不论是否本地，均是以TCP/IP附合host的方式。如果是本地（数据库地址localhost），CIDR-ADDRESS则为127.0.0.1/32。</p> 
 <p>例：</p> 
 <p>1、允许本地使用PGAdmin3登录数据库，数据库地址localhost，用户test，数据库testdb：</p> 
 <pre class="has"><code class="language-go">host    testdb    test   127.0.0.1/32      md5
</code></pre> 
 <p>2、允许192.168.116.12~192.168.116.12.255网段登录数据库：</p> 
 <pre class="has"><code class="language-go">host    all    all    192.168.116.12/24    md5
</code></pre> 
 <p>3、信任192.168.116.12登录数据库：</p> 
 <pre class="has"><code class="language-go">host    all    all    192.168.116.12/32    trust
</code></pre> 
 <p>pg_hba.conf修改后，使用pg_ctl reload重新读取pg_hba.conf文件，如果pg_ctl找不到数据库，则用-D /…/pgsql/data/　指定数据库目录，或export PGDATA=/…/pgsql/data/　导入环境变量。</p> 
 <p>如果是在linux以服务的形式安装的，那么执行：</p> 
 <p>命令：</p> 
 <pre class="has"><code class="language-go">service postgresql-9.5 reload      执行时输入对应安装的数据库版本

</code></pre> 
 <p>另外一种加载配置文件的方法是以超级用户登录到任何一个数据库后执行：</p> 
 <p>命令：</p> 
 <pre class="has"><code class="language-go">select pg_reload_conf();
</code></pre> 
 <p>以下提供官方文档对pg_hba.conf文件的解释：</p> 
 <p style="text-align: left">官方文档英文版地址：https://www.postgresql.org/docs/13/auth-pg-hba-conf.ht</p> 
 <p style="text-align: left">官方文档中文版地址：http://www.postgres.cn/docs/11/auth-pg-hba-conf.html</p> 
 <p style="text-align: left">墨天轮原文链接：https://www.modb.pro/db/25634（复制到浏览器或者点击“阅读原文”立即查看）</p> 
 <p>END</p> 
 <p>推荐阅读：<a href="http://mp.weixin.qq.com/s?__biz=MjM5MDAxOTk2MQ%3D%3D&amp;chksm=be47afca893026dcc6d0fa06bd56d61b128cac1aee3d2f219c62adac69d5cc8dc92e41b1edec&amp;idx=1&amp;mid=2650290140&amp;scene=21&amp;sn=1701367a66086dc38399527c8823c2e4#wechat_redirect" rel="nofollow">267页！2020年度数据库技术年刊</a></p> 
 <p>推荐下载：<a href="http://mp.weixin.qq.com/s?__biz=MjM5MDAxOTk2MQ%3D%3D&amp;chksm=be47ab998930228f9c321a4272d616776daa81e253f7d8955e9f14fcea93cbf134f3ff5415ef&amp;idx=1&amp;mid=2650289039&amp;scene=21&amp;sn=eccb043c1ca79ee805856545238ce885#wechat_redirect" rel="nofollow">2020数据技术嘉年华PPT下载</a><br></p> 
 <p><br>2020数据技术嘉年华近50个PPT下载、视频回放已上传墨天轮平台，可在“<strong>数据和云</strong>”公众号回复关键词“<strong>2020DTC</strong>”获得！</p> 
 <p>你知道吗？我们的视频号里已经发布了很多精彩的内容，快去看看吧！↓↓↓</p> 
 <p>点击下图查看更多 ↓<br></p> 
 <p style="text-align: center"><a href="http://mp.weixin.qq.com/s?__biz=MjM5MzExMTU2OQ%3D%3D&amp;chksm=be958cf489e205e22b4d260d0f16e4bac913d407e1c812b4f59fbb99cedff7f3a63f8860339e&amp;idx=1&amp;mid=2650613642&amp;scene=21&amp;sn=62335d205e89a269007674fac351be6b#wechat_redirect" rel="nofollow"><img src="https://images2.imgbox.com/a4/f7/rsLSssXi_o.png"></a></p> 
 <p style="text-align: center"><a href="http://mp.weixin.qq.com/s?__biz=MjM5MzExMTU2OQ%3D%3D&amp;chksm=be958db589e204a3c33bb79ad6acbbf9eb9eacc460b703d5f9acbb213f2efa2f3c0717627b18&amp;idx=1&amp;mid=2650613451&amp;scene=21&amp;sn=0ce5d9c4aa78ef9da779e01a76655955#wechat_redirect" rel="nofollow"><img src="https://images2.imgbox.com/a9/3f/DRszjRek_o.png"></a></p> 
 <p style="text-align: center"><a href="http://mp.weixin.qq.com/s?__biz=MjM5MzExMTU2OQ%3D%3D&amp;chksm=be958c6089e205761ad431f006cc51216b5c7197606063ac12ac1b85fa30be460aaa40d240ed&amp;idx=1&amp;mid=2650613534&amp;scene=21&amp;sn=478a57fb55bcb5c7b7876f36a20349e2#wechat_redirect" rel="nofollow"><img src="https://images2.imgbox.com/13/53/DJ8pnxKd_o.png"></a></p> 
 <p><strong>云和恩墨大讲堂 | </strong>一个分享交流的地方</p> 
 <p>长按，识别二维码，加入<strong>万人</strong>交流社群</p> 
 <p><strong>请备注：云和恩墨大讲堂</strong></p> 
 <p style="text-align: right"><strong>  点个“在看”</strong> </p> 
 <p style="text-align: right"><strong>你的喜欢会被看到❤</strong></p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/431f6fd6001f1e8197faccc6af1c723f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">富文本框编辑器word复制粘贴图文上传</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/834c81d9b7848e72cab19fa2581ed39a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">6.830 / 6.814: Syllabus 2021 - MIT Lab 2 - SimpleDB Operators</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>