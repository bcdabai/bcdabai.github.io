<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>瑞吉外卖项目实践（个人精简升级版） - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="瑞吉外卖项目实践（个人精简升级版）" />
<meta property="og:description" content="前言 本次实践旨在提高自己在以下方面的动手能力：
Spring，SpringMVC，SpringBootMybatis，MybatisPlusIO，并发式编程 因此，在原有项目需求上，会有以下方面的额外考量：
参照Spring，SpringBoot的面试难题，为项目设计“炫技点”综合运用XML，注解以及MybatisPlus三种方式，实现数据库读取引入对IO的操作以及并发式编程 如果读者也有类似的想法，不妨继续读下去
正文 项目共分为两期：
一期：根据H5设计的前端实现客户端服务器功能，根据管理页面实现管理端服务器功能二期：移植H5前端至微信小程序，将登陆验证由手机号&#43;验证码改为微信验证 一期工程中，客户端服务器的主要功能有：
登录功能 用户发起验证码请求 请求数据：手机号响应数据：6位验证码PS1：验证码存于Redis中，TTL为60s，key为手机号，value为验证码 用户发起登录请求 请求数据：手机号&#43;验证码响应数据：tokenPS1：token存于Redis中，TTL为30min，key为token，value为手机号PS2：token的存入位于数据库操作（读取用户信息，不存在则创建）后，两者进行事务管理保证一致性 菜品浏览 获取分类信息 请求数据：无响应数据：Result. &lt;List&gt;分类条目 获取购物车信息 请求数据：无响应数据：Result. &lt;List&gt;购物车条目 获取菜品信息 请求数据：{分类ID, Status}响应数据：Result. &lt;DishList&gt;菜品条目 获取套餐信息 请求数据：{分类ID, Status}响应数据：Result. &lt;DishList&gt;套餐条目 购物车 添加点餐条目 请求数据：&lt;DishParams&gt;购物车条目响应数据：Result. 无特殊Data 修改点餐条目 请求数据：&lt;DishParams&gt;购物车条目响应数据：Result. 无特殊Data 删除点餐条目 请求数据：&lt;DishDeleteParams&gt;购物车条目响应数据：Result. 无特殊Data PS1：购物车条目信息存于Redis，TTL为30min 下单 提交订单 请求数据：&lt;OrderParams&gt;订单条目响应数据：Result. 无特殊Data 拦截功能 登录状态拦截 请求数据：token响应数据 ：对应请求或拦截 省略部分 地址历史订单 // DishParams let params = { amount:item.price/100,//金额 dishFlavor:item.dishFlavor,//口味 如果没有传undefined dishId:undefined,//菜品id setmealId:undefined,//套餐id name:item.name, image:item.image } // DishDeleteParams let params = { dishId:item." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/6545f488269e3011ad342da615fb4f2e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-12-08T15:23:49+08:00" />
<meta property="article:modified_time" content="2022-12-08T15:23:49+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">瑞吉外卖项目实践（个人精简升级版）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>前言</h2> 
<p>本次实践旨在提高自己在以下方面的动手能力：</p> 
<ul><li>Spring，SpringMVC，SpringBoot</li><li>Mybatis，MybatisPlus</li><li>IO，并发式编程</li></ul> 
<p>因此，在原有项目需求上，会有以下方面的额外考量：</p> 
<ul><li>参照Spring，SpringBoot的面试难题，为项目设计“炫技点”</li><li>综合运用XML，注解以及MybatisPlus三种方式，实现数据库读取</li><li>引入对IO的操作以及并发式编程</li></ul> 
<p>如果读者也有类似的想法，不妨继续读下去</p> 
<h2><a id="_14"></a>正文</h2> 
<p>项目共分为两期：</p> 
<ul><li>一期：根据H5设计的前端实现客户端服务器功能，根据管理页面实现管理端服务器功能</li><li>二期：移植H5前端至微信小程序，将登陆验证由手机号+验证码改为微信验证</li></ul> 
<p>一期工程中，客户端服务器的主要功能有：</p> 
<ul><li>登录功能 
  <ul><li>用户发起验证码请求 
    <ul><li>请求数据：手机号</li><li>响应数据：6位验证码</li><li>PS1：验证码存于Redis中，TTL为60s，key为手机号，value为验证码</li></ul> </li><li>用户发起登录请求 
    <ul><li>请求数据：手机号+验证码</li><li>响应数据：token</li><li>PS1：token存于Redis中，TTL为30min，key为token，value为手机号</li><li>PS2：token的存入位于数据库操作（读取用户信息，不存在则创建）后，两者进行<strong>事务管理</strong>保证一致性</li></ul> </li></ul> </li><li>菜品浏览 
  <ul><li>获取分类信息 
    <ul><li>请求数据：无</li><li>响应数据：Result. &lt;List&gt;分类条目</li></ul> </li><li>获取购物车信息 
    <ul><li>请求数据：无</li><li>响应数据：Result. &lt;List&gt;购物车条目</li></ul> </li><li>获取菜品信息 
    <ul><li>请求数据：{分类ID, Status}</li><li>响应数据：Result. &lt;DishList&gt;菜品条目</li></ul> </li><li>获取套餐信息 
    <ul><li>请求数据：{分类ID, Status}</li><li>响应数据：Result. &lt;DishList&gt;套餐条目</li></ul> </li></ul> </li><li>购物车 
  <ul><li>添加点餐条目 
    <ul><li>请求数据：&lt;DishParams&gt;购物车条目</li><li>响应数据：Result. 无特殊Data</li></ul> </li><li>修改点餐条目 
    <ul><li>请求数据：&lt;DishParams&gt;购物车条目</li><li>响应数据：Result. 无特殊Data</li></ul> </li><li>删除点餐条目 
    <ul><li>请求数据：&lt;DishDeleteParams&gt;购物车条目</li><li>响应数据：Result. 无特殊Data</li></ul> </li><li>PS1：购物车条目信息存于Redis，TTL为30min</li></ul> </li><li>下单 
  <ul><li>提交订单 
    <ul><li>请求数据：&lt;OrderParams&gt;订单条目</li><li>响应数据：Result. 无特殊Data</li></ul> </li></ul> </li><li>拦截功能 
  <ul><li>登录状态拦截 
    <ul><li>请求数据：token</li><li>响应数据 ：对应请求或拦截</li></ul> </li></ul> </li><li><font color="red"> 省略部分 </font> 
  <ul><li><font color="red">地址</font></li><li><font color="red">历史订单</font></li></ul> </li></ul> 
<pre><code class="prism language-js"><span class="token comment">// DishParams</span>
<span class="token keyword">let</span> params <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
                <span class="token literal-property property">amount</span><span class="token operator">:</span>item<span class="token punctuation">.</span>price<span class="token operator">/</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token comment">//金额</span>
                <span class="token literal-property property">dishFlavor</span><span class="token operator">:</span>item<span class="token punctuation">.</span>dishFlavor<span class="token punctuation">,</span><span class="token comment">//口味  如果没有传undefined</span>
                <span class="token literal-property property">dishId</span><span class="token operator">:</span><span class="token keyword">undefined</span><span class="token punctuation">,</span><span class="token comment">//菜品id</span>
                <span class="token literal-property property">setmealId</span><span class="token operator">:</span><span class="token keyword">undefined</span><span class="token punctuation">,</span><span class="token comment">//套餐id</span>
                <span class="token literal-property property">name</span><span class="token operator">:</span>item<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
                <span class="token literal-property property">image</span><span class="token operator">:</span>item<span class="token punctuation">.</span>image
              <span class="token punctuation">}</span>
<span class="token comment">// DishDeleteParams</span>
<span class="token keyword">let</span> params <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
                 <span class="token literal-property property">dishId</span><span class="token operator">:</span>item<span class="token punctuation">.</span>dishId<span class="token punctuation">,</span>
                 <span class="token literal-property property">setmealId</span><span class="token operator">:</span>item<span class="token punctuation">.</span>setmealId<span class="token punctuation">,</span>
             <span class="token punctuation">}</span>
<span class="token comment">// OrderParams</span>
<span class="token keyword">const</span> params <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
                 <span class="token literal-property property">remark</span><span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>note<span class="token punctuation">,</span>
                 <span class="token literal-property property">payMethod</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>
                 <span class="token literal-property property">addressBookId</span><span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>address<span class="token punctuation">.</span>id
               <span class="token punctuation">}</span>
</code></pre> 
<p>管理端服务器的主要功能有：</p> 
<ul><li>登录功能 
  <ul><li>用户发起登录请求 
    <ul><li>请求数据：用户名+密码</li><li>响应数据：token</li><li>PS1：token存于Redis中，TTL为30min，key为token，value为用户名</li></ul> </li></ul> </li><li>数据库对应表格的增删改查基本功能 
  <ul><li>分类管理<font color="green">（省略详细描述） </font> 
    <ul><li>对应表格：category</li></ul> </li><li>菜品管理<font color="green">（省略详细描述） </font> 
    <ul><li>菜品本身对应表格：dish</li><li>菜品口味对应表格：dish_flavor</li></ul> </li><li>套餐管理<font color="green">（省略详细描述） </font> 
    <ul><li>对应表格：setmeal</li></ul> </li><li>员工管理<font color="green">（省略详细描述） </font> 
    <ul><li>对应表格：employee</li></ul> </li></ul> </li><li>根据登录成员，授予不同的操作权限 
  <ul><li>登陆成功后，授予token</li><li>再次访问时，服务器根据token判断用户的权限等级，返回可显示的类别：menuList</li><li>前端接收返回数据，更正menuList</li></ul> </li></ul> 
<h3><a id="_109"></a>管理端服务器的率先实现</h3> 
<p>之所以先实现管理端，有两个原因</p> 
<ul><li>通过管理端可制造相关的数据信息，存入Mysql中，方便客户端的查询</li><li>管理端是一个比较简单的数据库调用，实现较为简单。而且使用不涉及兵法式编程，不需要过多考虑性能调优</li></ul> 
<p>前期准备：</p> 
<ul><li>安装Redis服务</li><li>初始化数据库表</li><li>利用templete，生成所有表格的entity, mapper, service模板文件(非常方便，建议都这么来做)<a href="https://blog.csdn.net/jjj___jjj/article/details/117172161">[1]</a></li><li>前端代码分离，resources下的静态资源不再由tomcat管理，而是交给nginx服务器</li></ul> 
<p><strong>这里需要着重介绍一下nginx服务器进行前后端分离的相关工作</strong>，它涉及nginx两个精妙的设计：</p> 
<ul><li>nginx既可以配置静态资源的本地映射信息，也可以配置动态资源的反向代理</li><li>如果配有多个location，越精确的匹配范式，其匹配的<strong>优先级越高</strong></li></ul> 
<p>因此，一个简洁的前后端分离思路是：</p> 
<ul><li>配置一个<strong>精确的</strong>静态资源映射，凡是符合的静态资源均优先由nginx完成匹配，并从本地路径中获取</li><li>配置一个<strong>模糊或者有别于静态路径</strong>的动态资源反向代理，凡是未被静态资源匹配的访问，由nginx代理至对应路径</li></ul> 
<pre><code class="prism language-c"> location <span class="token operator">/</span> <span class="token punctuation">{<!-- --></span>
     proxy_pass http<span class="token operator">:</span><span class="token comment">//localhost:8080/;</span>
     # 模糊的动态资源反向代理，优先级低于静态资源访问
<span class="token punctuation">}</span>

location <span class="token operator">/</span>www <span class="token punctuation">{<!-- --></span>
    root   <span class="token punctuation">[</span>classpath<span class="token punctuation">]</span><span class="token operator">:</span><span class="token operator">/</span>resources<span class="token punctuation">;</span> # 此处配置要映射的静态资源的本地绝对路径
    index  index<span class="token punctuation">.</span>html index<span class="token punctuation">.</span>htm<span class="token punctuation">;</span>
    # 上述配置在浏览器访问<span class="token punctuation">[</span>nginx<span class="token operator">-</span>server<span class="token operator">-</span>ip<span class="token punctuation">]</span><span class="token operator">:</span><span class="token punctuation">[</span>port<span class="token punctuation">]</span><span class="token operator">/</span>www时，便会自动去nginx服务器的<span class="token punctuation">[</span>classpath<span class="token punctuation">]</span><span class="token operator">:</span><span class="token operator">/</span>resources<span class="token operator">/</span>www寻找<span class="token operator">/</span>www之后的请求文件
<span class="token punctuation">}</span>
</code></pre> 
<p>登录功能的实现并没有太多的细节想要分享，也没有做出创新的内容，略过</p> 
<p>在使用自己开发的<a href="https://gitee.com/zhu_hong_jun/curd_-templates" rel="nofollow">CURD</a>模板生成了员工，分类，菜品和套餐的基础增删改查操作后，接下来剩下的工作为：</p> 
<ul><li>员工管理 
  <ul><li>操作权限授予</li></ul> </li><li>菜品管理 
  <ul><li>嵌入根据菜品分类id的查询</li></ul> </li><li>套餐管理 
  <ul><li>嵌入根据套餐分类id的查询</li></ul> </li><li>模板修正 
  <ul><li>对新增和修改业务，在数据库未对username或name开启<code>unique_key</code>的情况下，提供可选功能：如果存在name或username（后者优先级高于前者）字段，为该字段设定重复检测功能</li><li>增设批量删除条目，批量修改状态字段功能</li><li>优化分页查询的条件单，允许模糊查询 + 对于begenTime和endTime字段，专设范围查询</li></ul> </li></ul> 
<p>在员工的操作权限授予部分，我遇到了一个疑难点，那就是：<strong>如何使用正则表达式来为SpringMVC的拦截器设置拦截URI</strong>，关于这部分内容，可以参看我的<a href="https://blog.csdn.net/weixin_43008154/article/details/127879620">另一篇博客</a></p> 
<p>然后，在实现客户端功能上，由于黑马程序员提供的代码是h5，而我们也不想再去微信小程序里调试，所以继续坚持利用h5来实现</p> 
<p>那么为了项目的完整性，有两个外部功能需要额外的技术支持：</p> 
<ul><li><a href="https://www.bilibili.com/video/BV19E411H7VZ/?spm_id_from=333.337.search-card.all.click&amp;vd_source=cf0eaeae7e96ca0a27b3bd894361b99d" rel="nofollow">h5支付</a></li><li><a href="https://blog.csdn.net/zlb_zlb/article/details/108922051#:~:text=%E5%88%B6%E4%BD%9C%E4%B8%80%E4%B8%AA%E4%BA%8C%E7%BB%B4%E7%A0%81%EF%BC%8C%E6%89%AB%E6%8F%8F%E8%AE%BF%E9%97%AE%E7%BD%91%E9%A1%B5%201%20import%20qrcode%202%20url%20=%20%22https://blog.csdn.net/zlb_zlb/article/details/108700540%22,qr.make_image%20%28%29%208%20img.save%20%28%20%22./url.png%22%29%20#%20%E4%BF%9D%E5%AD%98%E4%BA%8C%E7%BB%B4%E7%A0%81%E5%9B%BE%E7%89%87">扫二维码访问网站</a></li></ul> 
<p>这两个是独立于当前客户端项目的，所以我们先实现基本的客户端功能，再来考虑这两个外部功能的支持</p> 
<p>客户端基本需求已完成，收获的知识点如下，读者可自行阅读：</p> 
<ul><li><a href="https://blog.csdn.net/weixin_43008154/article/details/127893288">为什么仅通过模糊匹配就可以完成绝大多数条件查询了？来看看Mysql的新特性</a></li><li><a href="https://blog.csdn.net/weixin_43008154/article/details/127865831">java8新特性，stream()流的巧妙使用</a></li><li><a href="https://blog.csdn.net/weixin_43008154/article/details/127862144">javaDebug记录11-20条</a></li><li><a href="https://blog.csdn.net/weixin_43008154/article/details/127493310">Spring上传与下载文件工具类，自动注入即可使用</a></li></ul> 
<p>在进一步完善付款与回执功能前，我们首先要解决之前遗留的一个问题：</p> 
<ul><li>问题：客户端与服务端用户登录校验的区分</li><li>解决思路：将存在localStorage中的用户信息做区分，客户端叫做userInfo，服务端叫做employeeInfo。此时，两者在发起各自的ajax请求时，会从不同的info中读取token（如果未登录则对应info不存在，无法获取token），从而避免了共用token的问题</li></ul> 
<p>下一步工作：</p> 
<ul><li>增设功能：前端要区分用户是外送还是堂食（不需要额外的API，只需要多增加一种订单状态：堂食）</li><li>在沙箱支付宝环境下，完成整体功能的开发</li><li>构造API文档，要求完整匹配美其乐小程序的需求</li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5bfdb6b8288077f03265120073d97ab9/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Vue项目安装core-js报错解决方案</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/13ff88c7e347bdc07bdee243aee94ada/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">使用STM32组建基于LoRa的环境监测系统</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>