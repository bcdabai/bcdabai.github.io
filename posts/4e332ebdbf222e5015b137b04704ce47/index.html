<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>手把手教你从零跑一个Skynet - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="手把手教你从零跑一个Skynet" />
<meta property="og:description" content="一、前言 最近，我在搞服务端的skynet框架，看看以后自己做些作品（skynet框架服务端&#43;Unity客户端）。今天呢，我就先把skynet环境搞一下，讲讲流程，也方便想学习的同学，话不多说，我们开始吧~
二、关于Skynet skynet是一个轻量级的网络游戏框架，也可用于许多其他领域。
建议大家看下云风的《[Skynet设计综述][Skynet 4]》，这里我不过多赘述，主要讲讲操作流程~
三、Ubuntu虚拟机 skynet需要运行在linux或macos系统中，这里作为演示，我使用Ubuntu虚拟机。下面我讲下Ubuntu虚拟机的安装过程。
1、Ubuntu系统镜像下载 首先我们需要先下载Ubuntu系统的iso文件，下面这些地址都可以下载，大家选择一个即可：
网易开源镜像：[http://mirrors.163.com/ubuntu-releases/][http_mirrors.163.com_ubuntu-releases]
Ubuntu官方：[http://releases.ubuntu.com/][http_releases.ubuntu.com]
Ubuntu中国官网：[https://ubuntu.com/download/alternative-downloads][https_ubuntu.com_download_alternative-downloads]
中科开源镜像：[http://mirrors.ustc.edu.cn/ubuntu-releases/][http_mirrors.ustc.edu.cn_ubuntu-releases]
阿里开源镜像：[http://mirrors.aliyun.com/ubuntu-releases/][http_mirrors.aliyun.com_ubuntu-releases]
浙江大学开源镜像：[http://mirrors.zju.edu.cn/ubuntu-releases/][http_mirrors.zju.edu.cn_ubuntu-releases]
我以Ubuntu 16.04.7版本为例，地址：[http://mirrors.163.com/ubuntu-releases/16.04.7/][http_mirrors.163.com_ubuntu-releases_16.04.7]
把iso文件下载到本地，
2、VirtualBox虚拟机软件 有了iso文件，需要将其安装到虚拟机中，而虚拟机需要运行在虚拟机软件上，所以，我们还需要先安装一个虚拟机软件。
虚拟机软件大家常用的是VMWare，这里我强烈推荐另一款虚拟机软件：VirtualBox，它轻量、开源免费，对于个人学习使用完全足够，五星推荐~
关于VirtualBox：
VirtualBox是一款开源虚拟机软件。VirtualBox是由德国Innotek公司开发，由Sun Microsystems公司出品的软件，使用Qt编写，在 Sun被 Oracle收购后正式更名成 Oracle VM VirtualBox。
VirtualBox号称是最强的免费虚拟机软件，它不仅具有丰富的特色，而且性能也很优异！它简单易用，可虚拟的系统包括Windows（从Windows 3.1到Windows 10、Windows Server 2012，所有的Windows系统都支持）、Mac OS X、Linux、OpenBSD、Solaris、IBM OS2甚至Android等操作系统！使用者可以在VirtualBox上安装并且运行上述的这些操作系统！
2.1、VirtualBox下载 VirtualBox我们可以从官网下载到，地址：[https://www.virtualbox.org/][https_www.virtualbox.org]
选择windows版本，点击下载，
下载完毕，
2.2、VirtualBox安装 双击安装包运行安装，过程没有什么特别的，这里不赘述~
安装成功后打开VirtualBox，界面如下：
2.3、创建虚拟机 点击菜单控制/新建，
填写虚拟机名称，设置虚拟机保存路径，如下，我设置为E:\ubuntu16，
设置内存大小，建议分配2G内存，
创建虚拟硬盘，
建议分配10G的虚拟硬盘空间，
虚拟机创建完成，如下
3、载入Ubuntu iso镜像 点击启动虚拟机，会提示选择启动盘，点击下面的小按钮，
点击注册，
选择我们刚刚下载的iso系统镜像文件，打开，可以看到列表中出现了我们的镜像，选中它，
点击启动，即可进入系统安装。
4、Ubuntu系统安装过程 点击Install Ubuntu，
点击Continue，
点击Install Now，
此时会弹个提示框，点击Continue，
时区填写China Time，然后点击Continue，
语言默认English，点击Continue，
接着输入账号密码，后面进入系统的时候要用到，这里提示我的密码弱（Weak password），由于只是自己学习使用，密码弱也没什么关系，点击Continue，" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/4e332ebdbf222e5015b137b04704ce47/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-11T19:31:12+08:00" />
<meta property="article:modified_time" content="2023-02-11T19:31:12+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">手把手教你从零跑一个Skynet</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h4><a id="_1"></a>一、前言</h4> 
<p>最近，我在搞服务端的<code>skynet</code>框架，看看以后自己做些作品（<code>skynet</code>框架服务端+<code>Unity</code>客户端）。今天呢，我就先把<code>skynet</code>环境搞一下，讲讲流程，也方便想学习的同学，话不多说，我们开始吧~</p> 
<h4><a id="Skynet_5"></a>二、关于Skynet</h4> 
<p><code>skynet</code>是一个轻量级的网络游戏框架，也可用于许多其他领域。<br> <img src="https://images2.imgbox.com/9b/57/rzsyNE3W_o.png" alt="在这里插入图片描述"></p> 
<p>建议大家看下云风的《[Skynet设计综述][Skynet 4]》，这里我不过多赘述，主要讲讲操作流程~</p> 
<h4><a id="Ubuntu_12"></a>三、Ubuntu虚拟机</h4> 
<p><code>skynet</code>需要运行在<code>linux</code>或<code>macos</code>系统中，这里作为演示，我使用<code>Ubuntu</code>虚拟机。下面我讲下<code>Ubuntu</code>虚拟机的安装过程。</p> 
<h5><a id="1Ubuntu_16"></a>1、Ubuntu系统镜像下载</h5> 
<p>首先我们需要先下载<code>Ubuntu</code>系统的<code>iso</code>文件，下面这些地址都可以下载，大家选择一个即可：</p> 
<blockquote> 
 <p>网易开源镜像：[http://mirrors.163.com/ubuntu-releases/][http_mirrors.163.com_ubuntu-releases]<br> <code>Ubuntu</code>官方：[http://releases.ubuntu.com/][http_releases.ubuntu.com]<br> <code>Ubuntu</code>中国官网：[https://ubuntu.com/download/alternative-downloads][https_ubuntu.com_download_alternative-downloads]<br> 中科开源镜像：[http://mirrors.ustc.edu.cn/ubuntu-releases/][http_mirrors.ustc.edu.cn_ubuntu-releases]<br> 阿里开源镜像：[http://mirrors.aliyun.com/ubuntu-releases/][http_mirrors.aliyun.com_ubuntu-releases]<br> 浙江大学开源镜像：[http://mirrors.zju.edu.cn/ubuntu-releases/][http_mirrors.zju.edu.cn_ubuntu-releases]</p> 
</blockquote> 
<p>我以<code>Ubuntu 16.04.7</code>版本为例，地址：[http://mirrors.163.com/ubuntu-releases/16.04.7/][http_mirrors.163.com_ubuntu-releases_16.04.7]<br> <img src="https://images2.imgbox.com/06/bd/xWt7vTJA_o.png" alt="在这里插入图片描述"><br> 把<code>iso</code>文件下载到本地，<br> <img src="https://images2.imgbox.com/8f/cd/ZEsgEwPf_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="2VirtualBox_32"></a>2、VirtualBox虚拟机软件</h5> 
<p>有了<code>iso</code>文件，需要将其安装到虚拟机中，而虚拟机需要运行在虚拟机软件上，所以，我们还需要先安装一个虚拟机软件。<br> 虚拟机软件大家常用的是<code>VMWare</code>，这里我强烈推荐另一款虚拟机软件：<code>VirtualBox</code>，它轻量、开源免费，对于个人学习使用完全足够，五星推荐~</p> 
<blockquote> 
 <p>关于VirtualBox：<br> <code>VirtualBox</code>是一款开源虚拟机软件。<code>VirtualBox</code>是由德国<code>Innotek</code>公司开发，由<code>Sun Microsystems</code>公司出品的软件，使用<code>Qt</code>编写，在 <code>Sun</code>被 <code>Oracle</code>收购后正式更名成 <code>Oracle VM VirtualBox</code>。<br> <code>VirtualBox</code>号称是最强的免费虚拟机软件，它不仅具有丰富的特色，而且性能也很优异！它简单易用，可虚拟的系统包括<code>Windows</code>（从<code>Windows 3.1</code>到<code>Windows 10</code>、<code>Windows Server 2012</code>，所有的<code>Windows</code>系统都支持）、<code>Mac OS X</code>、<code>Linux</code>、<code>OpenBSD</code>、<code>Solaris</code>、<code>IBM OS2</code>甚至<code>Android</code>等操作系统！使用者可以在<code>VirtualBox</code>上安装并且运行上述的这些操作系统！</p> 
</blockquote> 
<h6><a id="21VirtualBox_41"></a>2.1、VirtualBox下载</h6> 
<p><code>VirtualBox</code>我们可以从官网下载到，地址：[https://www.virtualbox.org/][https_www.virtualbox.org]<br> <img src="https://images2.imgbox.com/02/d6/eF0FDYNg_o.png" alt="在这里插入图片描述"><br> 选择<code>windows</code>版本，点击下载，<br> <img src="https://images2.imgbox.com/2b/f0/3Yprjy1D_o.png" alt="在这里插入图片描述"></p> 
<p>下载完毕，<br> <img src="https://images2.imgbox.com/a6/71/59h4f8bQ_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="22VirtualBox_51"></a>2.2、VirtualBox安装</h6> 
<p>双击安装包运行安装，过程没有什么特别的，这里不赘述~<br> 安装成功后打开<code>VirtualBox</code>，界面如下：<br> <img src="https://images2.imgbox.com/dc/51/ctW0ZTe9_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="23_57"></a>2.3、创建虚拟机</h6> 
<p>点击菜单<code>控制/新建</code>，<br> <img src="https://images2.imgbox.com/02/94/nnUqPo8v_o.png" alt="在这里插入图片描述"><br> 填写虚拟机名称，设置虚拟机保存路径，如下，我设置为<code>E:\ubuntu16</code>，<br> <img src="https://images2.imgbox.com/f6/fb/SH8PNokE_o.png" alt="在这里插入图片描述"></p> 
<p>设置内存大小，建议分配<code>2G</code>内存，<br> <img src="https://images2.imgbox.com/f0/42/zxtzs2ce_o.png" alt="在这里插入图片描述"></p> 
<p>创建虚拟硬盘，<br> <img src="https://images2.imgbox.com/4c/ec/uLp4Klep_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/e7/2f/jqWu8E9P_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/47/88/zkscQisU_o.png" alt="在这里插入图片描述"></p> 
<p>建议分配<code>10G</code>的虚拟硬盘空间，<br> <img src="https://images2.imgbox.com/88/3a/8WcnrFe4_o.png" alt="在这里插入图片描述"><br> 虚拟机创建完成，如下<br> <img src="https://images2.imgbox.com/04/d5/ERLp8Tdm_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="3Ubuntu_iso_79"></a>3、载入Ubuntu iso镜像</h5> 
<p>点击启动虚拟机，会提示选择启动盘，点击下面的小按钮，<br> <img src="https://images2.imgbox.com/e1/06/H9Rp4MrE_o.png" alt="在这里插入图片描述"><br> 点击注册，<br> <img src="https://images2.imgbox.com/e0/1b/x3TLoMcp_o.png" alt="在这里插入图片描述"><br> 选择我们刚刚下载的<code>iso</code>系统镜像文件，打开，可以看到列表中出现了我们的镜像，选中它，<br> <img src="https://images2.imgbox.com/78/0f/4Cvihlfk_o.png" alt="在这里插入图片描述"><br> 点击启动，即可进入系统安装。</p> 
<h5><a id="4Ubuntu_89"></a>4、Ubuntu系统安装过程</h5> 
<p>点击<code>Install Ubuntu</code>，<br> <img src="https://images2.imgbox.com/eb/88/CLeWqN7H_o.png" alt="在这里插入图片描述"><br> 点击<code>Continue</code>，<br> <img src="https://images2.imgbox.com/f3/ef/960y76iZ_o.png" alt="在这里插入图片描述"><br> 点击<code>Install Now</code>，<br> <img src="https://images2.imgbox.com/66/a9/0WO3vwI5_o.png" alt="在这里插入图片描述"><br> 此时会弹个提示框，点击<code>Continue</code>，<br> <img src="https://images2.imgbox.com/e7/af/PXW4c5ht_o.png" alt="在这里插入图片描述"><br> 时区填写<code>China Time</code>，然后点击<code>Continue</code>，<br> <img src="https://images2.imgbox.com/dc/87/LYL2QoQC_o.png" alt="在这里插入图片描述"><br> 语言默认<code>English</code>，点击<code>Continue</code>，<br> <img src="https://images2.imgbox.com/79/92/vnMTXTxI_o.gif" alt="请添加图片描述"><br> 接着输入账号密码，后面进入系统的时候要用到，这里提示我的密码弱（<code>Weak password</code>），由于只是自己学习使用，密码弱也没什么关系，点击<code>Continue</code>，<br> <img src="https://images2.imgbox.com/32/9e/qODlelSA_o.png" alt="在这里插入图片描述"><br> 接着就是耐心等待它安装，<br> <img src="https://images2.imgbox.com/1a/1a/cuZEtkQg_o.png" alt="在这里插入图片描述"><br> 完成后，会提示需要重启，点击<code>Restart Now</code>，<br> <img src="https://images2.imgbox.com/52/b2/4q5SGJOI_o.png" alt="在这里插入图片描述"><br> 进入下面这个界面时，按一下回车键，<br> <img src="https://images2.imgbox.com/81/00/J25KJY1R_o.png" alt="在这里插入图片描述"><br> 输入刚刚设置的密码，<br> <img src="https://images2.imgbox.com/ba/2f/1luyHObn_o.png" alt="在这里插入图片描述"><br> 顺利进入系统，<br> <img src="https://images2.imgbox.com/89/15/xZr3cxeE_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_116"></a>四、安装必要的工具</h4> 
<h5><a id="1git_118"></a>1、安装git</h5> 
<p>我们需要通过<code>git</code>来下载<code>skynet</code>，所以必须先安装<code>git</code>，我们先打开终端，如下：<br> <img src="https://images2.imgbox.com/70/3d/JCyRg9Ja_o.gif" alt="请添加图片描述"><br> 在终端输入下面的命令：（注意按回车后需要输入一次密码，并且密码不会显示出来，不要怀疑你的键盘）</p> 
<pre><code class="prism language-java">sudo apt<span class="token operator">-</span>get install git
</code></pre> 
<p>如下：<img src="https://images2.imgbox.com/6f/a6/o5hmVukW_o.gif" alt="请添加图片描述"><br> 安装完毕后，输入下面的命令检查下<code>git</code>是否安装成功了，</p> 
<pre><code class="prism language-java">git <span class="token operator">--</span>version
</code></pre> 
<p>如果输出了版本号，则说明<code>git</code>已经安装成功了，<br> <img src="https://images2.imgbox.com/37/21/Y7uarF0B_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="2autoconf_138"></a>2、安装autoconf</h5> 
<p>编译<code>skynet</code>需要用到<code>autoconf</code>，在终端输入下面的命令来安装<code>autoconf</code>，</p> 
<pre><code class="prism language-java">sudo apt<span class="token operator">-</span>get install autoconf
</code></pre> 
<p>如下：<br> <img src="https://images2.imgbox.com/c2/43/LmMImxTu_o.gif" alt="请添加图片描述"><br> 安装完毕后，输入<code>autoconf --version</code>按回车，如果能输出版本号，则说明安装成功了，<br> <img src="https://images2.imgbox.com/16/19/EG1G4MGA_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="3gcc_151"></a>3、安装gcc</h5> 
<p>编译<code>skynet</code>需要用到<code>gcc</code>，因为<code>Ubuntu</code>默认安装了<code>gcc</code>，所以我们这里就不用重复安装了，可以在终端中输入<code>gcc --version</code>，如果能输出版本号，则说明已经安装了<code>gcc</code>，<br> <img src="https://images2.imgbox.com/66/e0/I4HoyH6z_o.png" alt="在这里插入图片描述"><br> 如果提示没有<code>gcc</code>，则执行<code>sudo apt-get install gcc</code>进行安装即可。</p> 
<h4><a id="Skynet_157"></a>五、下载Skynet源码</h4> 
<p>在终端中执行下面的命令，</p> 
<pre><code class="prism language-java">git clone https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>gitee<span class="token punctuation">.</span>com<span class="token operator">/</span>mirrors<span class="token operator">/</span>skynet<span class="token punctuation">.</span>git
</code></pre> 
<p>如下：<br> <img src="https://images2.imgbox.com/36/38/nZYFv7Qg_o.gif" alt="请添加图片描述"><br> 下载完毕后，我们打开文件夹浏览器，可以在<code>Home</code>目录中看到多了一个<code>skynet</code>文件夹，<br> <img src="https://images2.imgbox.com/96/78/9bb3DYBC_o.gif" alt="请添加图片描述"><br> 进入<code>skynet</code>文件夹，就可以看到框架源码啦，<br> <img src="https://images2.imgbox.com/87/48/bojM7o8V_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="Skynet_172"></a>六、编译Skynet源码</h4> 
<p>在终端中进入<code>skynet</code>目录，</p> 
<pre><code class="prism language-java">cd skynet
</code></pre> 
<p>如下：<br> <img src="https://images2.imgbox.com/69/dc/UicmtDMC_o.png" alt="在这里插入图片描述"><br> 然后执行下面的命令：</p> 
<pre><code class="prism language-java">make linux
</code></pre> 
<p>此处你可能会报错，如下：<br> <img src="https://images2.imgbox.com/6d/d5/PN6J2B0i_o.png" alt="在这里插入图片描述"><br> 这是因为过程中去<code>gitub</code>下载<code>jemalloc</code>失败了，可以多试几次，编译成功后显示的输出内容如下：<br> <img src="https://images2.imgbox.com/c8/ce/fo9Qgqa1_o.png" alt="在这里插入图片描述"><br> 我们可以在<code>skynet</code>目录中看到生成了一个可执行文件：<code>skynet</code>，如下：<br> <img src="https://images2.imgbox.com/d2/44/VXdg110j_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="Skynet_195"></a>七、运行Skynet案例</h4> 
<p>在终端中进入<code>skynet</code>目录后，执行下面的命令，</p> 
<pre><code class="prism language-java"><span class="token punctuation">.</span>/skynet example<span class="token operator">/</span>config
</code></pre> 
<p>如下，可以看到服务启动成功了，<br> <img src="https://images2.imgbox.com/26/05/uAgUjzUL_o.png" alt="在这里插入图片描述"><br> 接下来，我们开启一个新的终端，<br> <img src="https://images2.imgbox.com/37/ee/xHNFq0XS_o.png" alt="在这里插入图片描述"><br> 运行一个客户端来测试一下，先<code>cd skynet</code>进入目录，<br> 然后执行如下命令：</p> 
<pre><code class="prism language-java"><span class="token punctuation">.</span>/<span class="token number">3</span>rd<span class="token operator">/</span>lua<span class="token operator">/</span>lua example<span class="token operator">/</span>client<span class="token punctuation">.</span>lua
</code></pre> 
<p>如下，每隔5秒就会给服务端发送一个<code>heartbeat</code>心跳包，<br> <img src="https://images2.imgbox.com/9e/53/Tlldfrwc_o.png" alt="在这里插入图片描述"><br> 我们可以输入<code>hello</code>，服务器会回应一个<code>world</code>，如下：<br> <img src="https://images2.imgbox.com/ee/87/8IG4Hd18_o.gif" alt="请添加图片描述"></p> 
<h4><a id="Demo_219"></a>八、写个Demo</h4> 
<p>想要自己写个<code>Demo</code>，得先知道<code>skynet</code>是如何工作的。</p> 
<h5><a id="1_223"></a>1、配置文件</h5> 
<p>运行<code>skynet</code>时，需要制定一个配置文件，例：</p> 
<pre><code class="prism language-java"><span class="token punctuation">.</span>/skynet example<span class="token operator">/</span>config
</code></pre> 
<p>我们先看看这个<code>config</code>文件里面是啥，进入<code>examples</code>目录，打开<code>config</code>文件，<br> <img src="https://images2.imgbox.com/63/43/C5tVYlMW_o.png" alt="在这里插入图片描述"><br> <code>config</code>文件内容如下：</p> 
<pre><code class="prism language-java">include <span class="token string">"config.path"</span>

<span class="token operator">--</span> preload <span class="token operator">=</span> <span class="token string">"./examples/preload.lua"</span>	<span class="token operator">--</span> run preload<span class="token punctuation">.</span>lua before every lua service run
thread <span class="token operator">=</span> <span class="token number">8</span>
logger <span class="token operator">=</span> nil
logpath <span class="token operator">=</span> <span class="token string">"."</span>
harbor <span class="token operator">=</span> <span class="token number">1</span>
address <span class="token operator">=</span> <span class="token string">"127.0.0.1:2526"</span>
master <span class="token operator">=</span> <span class="token string">"127.0.0.1:2013"</span>
start <span class="token operator">=</span> <span class="token string">"main"</span>	<span class="token operator">--</span> main script
bootstrap <span class="token operator">=</span> <span class="token string">"snlua bootstrap"</span>	<span class="token operator">--</span> <span class="token class-name">The</span> service <span class="token keyword">for</span> bootstrap
standalone <span class="token operator">=</span> <span class="token string">"0.0.0.0:2013"</span>
<span class="token operator">--</span> snax_interface_g <span class="token operator">=</span> <span class="token string">"snax_g"</span>
cpath <span class="token operator">=</span> root<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token string">"cservice/?.so"</span>
<span class="token operator">--</span> daemon <span class="token operator">=</span> <span class="token string">"./skynet.pid"</span>
</code></pre> 
<p>第一行引用了<code>config.path</code>文件，我们打开<code>config.path</code>文件，<br> <img src="https://images2.imgbox.com/74/bd/WLHSrJL2_o.png" alt="在这里插入图片描述"><br> 内容如下：</p> 
<pre><code class="prism language-java">root <span class="token operator">=</span> <span class="token string">"./"</span>
luaservice <span class="token operator">=</span> root<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token string">"service/?.lua;"</span><span class="token punctuation">.</span><span class="token punctuation">.</span>root<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token string">"test/?.lua;"</span><span class="token punctuation">.</span><span class="token punctuation">.</span>root<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token string">"examples/?.lua;"</span><span class="token punctuation">.</span><span class="token punctuation">.</span>root<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token string">"test/?/init.lua"</span>
lualoader <span class="token operator">=</span> root <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token string">"lualib/loader.lua"</span>
lua_path <span class="token operator">=</span> root<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token string">"lualib/?.lua;"</span><span class="token punctuation">.</span><span class="token punctuation">.</span>root<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token string">"lualib/?/init.lua"</span>
lua_cpath <span class="token operator">=</span> root <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token string">"luaclib/?.so"</span>
snax <span class="token operator">=</span> root<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token string">"examples/?.lua;"</span><span class="token punctuation">.</span><span class="token punctuation">.</span>root<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token string">"test/?.lua"</span>
</code></pre> 
<p>现在，我们把两个文件合在一起看，如下：</p> 
<pre><code class="prism language-java">root <span class="token operator">=</span> <span class="token string">"./"</span>
luaservice <span class="token operator">=</span> root<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token string">"service/?.lua;"</span><span class="token punctuation">.</span><span class="token punctuation">.</span>root<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token string">"test/?.lua;"</span><span class="token punctuation">.</span><span class="token punctuation">.</span>root<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token string">"examples/?.lua;"</span><span class="token punctuation">.</span><span class="token punctuation">.</span>root<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token string">"test/?/init.lua"</span>
lualoader <span class="token operator">=</span> root <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token string">"lualib/loader.lua"</span>
lua_path <span class="token operator">=</span> root<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token string">"lualib/?.lua;"</span><span class="token punctuation">.</span><span class="token punctuation">.</span>root<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token string">"lualib/?/init.lua"</span>
lua_cpath <span class="token operator">=</span> root <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token string">"luaclib/?.so"</span>
snax <span class="token operator">=</span> root<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token string">"examples/?.lua;"</span><span class="token punctuation">.</span><span class="token punctuation">.</span>root<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token string">"test/?.lua"</span>

<span class="token operator">--</span> preload <span class="token operator">=</span> <span class="token string">"./examples/preload.lua"</span>	<span class="token operator">--</span> run preload<span class="token punctuation">.</span>lua before every lua service run
thread <span class="token operator">=</span> <span class="token number">8</span>
logger <span class="token operator">=</span> nil
logpath <span class="token operator">=</span> <span class="token string">"."</span>
harbor <span class="token operator">=</span> <span class="token number">1</span>
address <span class="token operator">=</span> <span class="token string">"127.0.0.1:2526"</span>
master <span class="token operator">=</span> <span class="token string">"127.0.0.1:2013"</span>
start <span class="token operator">=</span> <span class="token string">"main"</span>	<span class="token operator">--</span> main script
bootstrap <span class="token operator">=</span> <span class="token string">"snlua bootstrap"</span>	<span class="token operator">--</span> <span class="token class-name">The</span> service <span class="token keyword">for</span> bootstrap
standalone <span class="token operator">=</span> <span class="token string">"0.0.0.0:2013"</span>
<span class="token operator">--</span> snax_interface_g <span class="token operator">=</span> <span class="token string">"snax_g"</span>
cpath <span class="token operator">=</span> root<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token string">"cservice/?.so"</span>
<span class="token operator">--</span> daemon <span class="token operator">=</span> <span class="token string">"./skynet.pid"</span>
</code></pre> 
<p>我这里对几个重要的参数做一下说明：</p> 
<table><thead><tr><th>参数</th><th>描述</th></tr></thead><tbody><tr><td><code>luaservice</code></td><td>服务脚本路径，包括<code>skynet</code>框架自带的一些服务和自己写的服务</td></tr><tr><td><code>lualoader</code></td><td><code>lua</code>脚本加载器，指定<code>skynet</code>的<code>loader.lua</code></td></tr><tr><td><code>lua_path</code></td><td>程序加载<code>lua</code>脚本时，会搜索这个<code>lua_path</code>配置的路径</td></tr><tr><td><code>lua_cpath</code></td><td>用<code>C</code>语言编写的程序库（<code>.so</code>文件）的路径</td></tr><tr><td><code>thread</code></td><td>启用的工作线程数量，一般配置为<code>CPU</code>核心数</td></tr><tr><td><code>harbor</code></td><td>主从节点模式。<code>skynet</code>初期提供了<code>master/slave</code>集群模式，后来提供了更适用的<code>cluster</code>集群模式，建议使用<code>cluster</code>模式，配<code>0</code></td></tr><tr><td><code>start</code></td><td>主服务入口</td></tr><tr><td><code>cpath</code></td><td>用<code>C</code>语言编写的服务模块的路径</td></tr></tbody></table> 
<p>画个图，强化记忆：<br> <img src="https://images2.imgbox.com/27/f1/Qj5mkEQ7_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="2_339"></a>2、规范目录结构</h5> 
<p>上面介绍了配置文件，现在我们可以自己写一个配置文件啦，不过，实际项目中，一般会先规范一下目录结构，我们把根目录重命名为<code>game</code>，新建一些子文件夹：</p> 
<table><thead><tr><th>文件夹</th><th>说明</th></tr></thead><tbody><tr><td><code>etc</code></td><td>存放配置文件</td></tr><tr><td><code>luaclib</code></td><td>存放一些<code>C</code>模块（<code>.so</code>文件）</td></tr><tr><td><code>lualib</code></td><td>存放<code>lua</code>模块</td></tr><tr><td><code>service</code></td><td>存放各服务的<code>lua</code>代码</td></tr><tr><td><code>skynet</code></td><td>存放<code>skynet</code>框架（存放我们刚刚下载的<code>skynet</code>框架源码）</td></tr></tbody></table> 
<p>最终如下：<br> <img src="https://images2.imgbox.com/71/7b/OvpExljo_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="3_377"></a>3、自己写个配置文件</h5> 
<p>我们在<code>etc</code>目录中新建一个<code>config.node1</code>配置，如下：<br> <img src="https://images2.imgbox.com/20/bc/oRLDcgND_o.png" alt="在这里插入图片描述"><br> 因为我们把<code>skynet</code>框架源码丢在了<code>skynet</code>子目录中，所以我们配置路径的时候需要加多一层<code>skynet</code>，最终<code>config.node1</code>配置如下：</p> 
<pre><code class="prism language-java">thread <span class="token operator">=</span> <span class="token number">8</span>
cpath <span class="token operator">=</span> <span class="token string">"./skynet/cservice/?.so"</span>
bootstrap <span class="token operator">=</span> <span class="token string">"snlua bootstrap"</span>

start <span class="token operator">=</span> <span class="token string">"main"</span>
harbor <span class="token operator">=</span> <span class="token number">0</span>

lualoader <span class="token operator">=</span> <span class="token string">"./skynet/lualib/loader.lua"</span>

luaservice <span class="token operator">=</span> <span class="token string">"./service/?.lua;"</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token string">"./service/?/init.lua;"</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token string">"./skynet/service/?.lua;"</span>

lua_path <span class="token operator">=</span> <span class="token string">"./etc/?.lua;"</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token string">"./lualib/?.lua;"</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token string">"./skynet/lualib/?.lua;"</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token string">"./skynet/lualib/?/init.lua;"</span>

lua_cpath <span class="token operator">=</span> <span class="token string">"./luaclib/?.so;"</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token string">"./skynet/luaclib/?.so"</span>
</code></pre> 
<h5><a id="4_400"></a>4、主服务</h5> 
<p>上面我们配置的主服务是<code>main</code>，</p> 
<pre><code class="prism language-java">start <span class="token operator">=</span> <span class="token string">"main"</span>
</code></pre> 
<p>它会去配置的<code>luaservice</code>路径中查找一个<code>main.lua</code>脚本，</p> 
<pre><code class="prism language-java">luaservice <span class="token operator">=</span> <span class="token string">"./service/?.lua;"</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token string">"./service/?/init.lua;"</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token string">"./skynet/service/?.lua;"</span>
</code></pre> 
<p>框架会去启动这个<code>main</code>服务，我们现在还没有这个<code>main.lua</code>脚本，现在我们就来写这个<code>main.lua</code>脚本吧~</p> 
<p>进入<code>service</code>目录，创建<code>main.lua</code>脚本，代码如下：</p> 
<pre><code class="prism language-java">local skynet <span class="token operator">=</span> require <span class="token string">"skynet"</span>
skynet<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token function">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	skynet<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"[start main] hello world"</span><span class="token punctuation">)</span>
	
	<span class="token operator">--</span> <span class="token constant">TODO</span> 启动其他服务
	
	skynet<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
end<span class="token punctuation">)</span>
</code></pre> 
<p>上面我们用到了<code>skynet</code>的三个<code>API</code>，如下：<br> <img src="https://images2.imgbox.com/3c/87/w7zvzZXK_o.png" alt="在这里插入图片描述"><br> 有同学会问了，明明说三个<code>API</code>，怎么列了四个，那个<code>newservice(name, ...)</code>没看到呀！<br> 因为<code>main</code>是主服务，它是由框架来启动的，所以是框架帮我们调用了<code>newservice</code>，如果我们想在主服务中启动其他服务，就要自己调用<code>newservice</code>了。</p> 
<p>现在我们测试一下，打开终端，进入<code>game</code>目录，然后执行命令：</p> 
<pre><code class="prism language-java"><span class="token punctuation">.</span>/skynet<span class="token operator">/</span>skynet etc<span class="token operator">/</span>config<span class="token punctuation">.</span>node1
</code></pre> 
<p>运行效果如下，可以看到<code>main.lua</code>脚本被执行了，输出了<code>[start main] hello world</code>，<br> <img src="https://images2.imgbox.com/1f/9d/P1ul0h11_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="5_443"></a>5、写个打工服务</h5> 
<p>服务脚本统一放在<code>service</code>目录中，以服务名为文件夹名字创建子目录，打工服务我们取名为<code>worker</code>，所以，我们在<code>service</code>文件夹中新建一个<code>worker</code>目录，<br> <img src="https://images2.imgbox.com/58/9b/MPCgyJvP_o.png" alt="在这里插入图片描述"><br> 进入<code>worker</code>目录，新建一个<code>init.lua</code>脚本，<br> <img src="https://images2.imgbox.com/ba/68/V7cXqiuG_o.png" alt="在这里插入图片描述"><br> <code>init.lua</code>脚本需要实现服务的逻辑，<br> <img src="https://images2.imgbox.com/56/40/LfAF6e75_o.png" alt="在这里插入图片描述"></p> 
<p><code>init.lua</code>代码如下，</p> 
<pre><code class="prism language-java"><span class="token operator">--</span> service<span class="token operator">/</span>worker<span class="token operator">/</span>init<span class="token punctuation">.</span>lua脚本

local skynet <span class="token operator">=</span> require <span class="token string">"skynet"</span>

<span class="token operator">--</span> 消息响应函数表
local <span class="token constant">CMD</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
   
     
     <span class="token punctuation">}</span>
<span class="token operator">--</span> 服务名
local worker_name <span class="token operator">=</span> <span class="token string">""</span>
<span class="token operator">--</span> 服务id
local worker_id <span class="token operator">=</span> <span class="token string">""</span>
<span class="token operator">--</span> 工钱
local money <span class="token operator">=</span> <span class="token number">0</span>
<span class="token operator">--</span> 是否在工作
local isworking <span class="token operator">=</span> <span class="token boolean">false</span>

<span class="token operator">--</span> 每帧调用，一帧的时间是<span class="token number">0.2</span>秒
local function <span class="token function">update</span><span class="token punctuation">(</span>frame<span class="token punctuation">)</span>
    <span class="token keyword">if</span> isworking then
        money <span class="token operator">=</span> money <span class="token operator">+</span> <span class="token number">1</span>
        skynet<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>worker_name <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token function">tostring</span><span class="token punctuation">(</span>worker_id<span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token string">", money: "</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token function">tostring</span><span class="token punctuation">(</span>money<span class="token punctuation">)</span><span class="token punctuation">)</span>
    end
end

<span class="token operator">--</span> 定时器，每隔<span class="token number">0.2</span>秒调用一次update函数
local function <span class="token function">timer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    local stime <span class="token operator">=</span> skynet<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    local frame <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">while</span> <span class="token boolean">true</span> <span class="token keyword">do</span>
        frame <span class="token operator">=</span> frame <span class="token operator">+</span> <span class="token number">1</span>
        local isok<span class="token punctuation">,</span> err <span class="token operator">=</span> <span class="token function">pcall</span><span class="token punctuation">(</span>update<span class="token punctuation">,</span> frame<span class="token punctuation">)</span>
        <span class="token keyword">if</span> not isok then
            skynet<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
        end
        local etime <span class="token operator">=</span> skynet<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token operator">--</span> 保证<span class="token number">0.2</span>秒
        local waittime <span class="token operator">=</span> frame <span class="token operator">*</span> <span class="token number">20</span> <span class="token operator">-</span> <span class="token punctuation">(</span>etime <span class="token operator">-</span> stime<span class="token punctuation">)</span>
        <span class="token keyword">if</span> waittime <span class="token operator">&lt;=</span> <span class="token number">0</span> then
            waittime <span class="token operator">=</span> <span class="token number">2</span>
        end
        skynet<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span>waittime<span class="token punctuation">)</span>
    end
end


<span class="token operator">--</span> 初始化
local function <span class="token function">init</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> id<span class="token punctuation">)</span>
    worker_name <span class="token operator">=</span> name
    worker_id <span class="token operator">=</span> id
end

<span class="token operator">--</span> 开始工作
function <span class="token constant">CMD</span><span class="token punctuation">.</span><span class="token function">start_work</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span>
    isworking <span class="token operator">=</span> <span class="token boolean">true</span>
end

<span class="token operator">--</span> 停止工作
function <span class="token constant">CMD</span><span class="token punctuation">.</span><span class="token function">stop_work</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span>
    isworking <span class="token operator">=</span> <span class="token boolean">false</span>
end

<span class="token operator">--</span> 调用初始化函数，<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>是不定参数，会从skynet<span class="token punctuation">.</span>newservice的第二个参数开始透传过来
<span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>

skynet<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>function <span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token operator">--</span> 消息分发
    skynet<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">"lua"</span><span class="token punctuation">,</span> function <span class="token punctuation">(</span>session<span class="token punctuation">,</span> source<span class="token punctuation">,</span> cmd<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
    	<span class="token operator">--</span> 从<span class="token constant">CMD</span>这个表中查找是否有定义响应函数，如果有，则触发响应函数
        local func <span class="token operator">=</span> <span class="token constant">CMD</span><span class="token punctuation">[</span>cmd<span class="token punctuation">]</span>
        <span class="token keyword">if</span> func then
            <span class="token function">func</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
        end
    end<span class="token punctuation">)</span>

	<span class="token operator">--</span> 启动定时器
    skynet<span class="token punctuation">.</span><span class="token function">fork</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span>
end<span class="token punctuation">)</span>
</code></pre> 
<blockquote> 
 <p>注：这里对代码说明一下，<code>timer</code>定时器函数中，<code>waittime</code>代表每次循环等待的时间，由于程序有可能会卡住，我们很难保证 “每隔0.2秒调用一次<code>update</code>” 是精确的，<code>update</code>函数本身执行也需要时间，所以等待时间是<code>0.2</code>减去执行时间，执行时间就是<code>etime - stime</code>。</p> 
</blockquote> 
<h5><a id="6_538"></a>6、在主服务中启动打工服务</h5> 
<p>我们回到主服务<code>main.lua</code>脚本中，添加一句<code>skynet.newservice</code>调用，如下：</p> 
<pre><code class="prism language-java"><span class="token operator">--</span> main<span class="token punctuation">.</span>lua脚本

local skynet <span class="token operator">=</span> require <span class="token string">"skynet"</span>

skynet<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>function <span class="token punctuation">(</span><span class="token punctuation">)</span>
    skynet<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"[start main] hello world"</span><span class="token punctuation">)</span>

	<span class="token operator">--</span> 启动打工服务，其中第二个参数和第三个参数会透传给service<span class="token operator">/</span>worker<span class="token operator">/</span>init<span class="token punctuation">.</span>lua脚本
    local worker1 <span class="token operator">=</span> skynet<span class="token punctuation">.</span><span class="token function">newservice</span><span class="token punctuation">(</span><span class="token string">"worker"</span><span class="token punctuation">,</span> <span class="token string">"worker"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>

    skynet<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
end<span class="token punctuation">)</span>
</code></pre> 
<p>现在我们测试一下，在<code>game</code>目录中执行命令</p> 
<pre><code class="prism language-java"><span class="token punctuation">.</span>/skynet<span class="token operator">/</span>skynet etc<span class="token operator">/</span>config<span class="token punctuation">.</span>node1
</code></pre> 
<p>运行效果如下，可以看到启动了一个<code>worker</code>服务，<br> <img src="https://images2.imgbox.com/50/b9/gV19Wh8r_o.png" alt="在这里插入图片描述"><br> 有同学可能会问了，我们调用<code>skynet.newservice</code>时第一个参数是<code>worker</code>，框架怎么知道会去执行<code>service/worker/init.lua</code>脚本呢？<br> 还记得我们的<code>config.node1</code>配置吗，里面的<code>luaservice</code>我们配置了<code>"./service/?/init.lua;"</code>，如下：</p> 
<pre><code class="prism language-java"><span class="token operator">--</span> config<span class="token punctuation">.</span>node1配置

luaservice <span class="token operator">=</span> <span class="token string">"./service/?.lua;"</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token string">"./service/?/init.lua;"</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token string">"./skynet/service/?.lua;"</span>
</code></pre> 
<p>其中，<code>?</code>符号会匹配服务名，也就是说，当我们调用<code>skynet.newservice("worker")</code>时，框架先去检查<code>./service/worker.lua</code>脚本是否存在，发现不存在，于是接着检查<code>./service/worker/init.lua</code>脚本，发现存在，于是执行<code>./service/worker/init.lua</code>脚本作为<code>worker</code>服务，当然，如果找不到，它就会去检查<code>./skynet/service/worker.lua</code>是否存在了。</p> 
<p>另外，<code>newservice</code>的函数原型是<code>newservice(name, ...)</code>，我们调用<code>skynet.newservice</code>时可以透传一些参数给服务，比如我们上面的</p> 
<pre><code class="prism language-java"><span class="token operator">--</span> main<span class="token punctuation">.</span>lua脚本

local worker1 <span class="token operator">=</span> skynet<span class="token punctuation">.</span><span class="token function">newservice</span><span class="token punctuation">(</span><span class="token string">"worker"</span><span class="token punctuation">,</span> <span class="token string">"worker"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
</code></pre> 
<p>第二个参数和第三个参数就会透传给<code>init.lua</code>脚本，我们在<code>init.lua</code>脚本中可以取出来缓存起来，如下：</p> 
<pre><code class="prism language-java"><span class="token operator">--</span> service<span class="token operator">/</span>worker<span class="token operator">/</span>init<span class="token punctuation">.</span>lua脚本

<span class="token operator">--</span> 服务名
local worker_name <span class="token operator">=</span> <span class="token string">""</span>
<span class="token operator">--</span> 服务id
local worker_id <span class="token operator">=</span> <span class="token string">""</span>

local function <span class="token function">init</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> id<span class="token punctuation">)</span>
    worker_name <span class="token operator">=</span> name
    worker_id <span class="token operator">=</span> id
end

<span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
</code></pre> 
<h5><a id="7_602"></a>7、在主服务中给打工服务发消息</h5> 
<p>打工服务中我们定义了两个消息：<code>start_work</code>和<code>stop_work</code>，现在我们在主服务中给打工服务发送消息，添加<code>skynet.send</code>调用，如下：</p> 
<pre><code class="prism language-java">local skynet <span class="token operator">=</span> require <span class="token string">"skynet"</span>

skynet<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>function <span class="token punctuation">(</span><span class="token punctuation">)</span>
    skynet<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"[start main] hello world"</span><span class="token punctuation">)</span>
	<span class="token operator">--</span> 启动打工服务，其中第二个参数和第三个参数会透传给service<span class="token operator">/</span>worker<span class="token operator">/</span>init<span class="token punctuation">.</span>lua脚本
    local worker1 <span class="token operator">=</span> skynet<span class="token punctuation">.</span><span class="token function">newservice</span><span class="token punctuation">(</span><span class="token string">"worker"</span><span class="token punctuation">,</span> <span class="token string">"worker"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token operator">--</span> 开始工作
    skynet<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>worker1<span class="token punctuation">,</span> <span class="token string">"lua"</span><span class="token punctuation">,</span> <span class="token string">"start_work"</span><span class="token punctuation">)</span>
	<span class="token operator">--</span> 主服务休息<span class="token number">2</span>秒，注意，这里是主服务休息<span class="token number">2</span>秒，并不会卡住worker服务
    skynet<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span>
    <span class="token operator">--</span> 停止工作
    skynet<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>worker1<span class="token punctuation">,</span> <span class="token string">"lua"</span><span class="token punctuation">,</span> <span class="token string">"stop_work"</span><span class="token punctuation">)</span>
    
    skynet<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
end<span class="token punctuation">)</span>
</code></pre> 
<p>我们再次执行命令</p> 
<pre><code class="prism language-java"><span class="token punctuation">.</span>/skynet<span class="token operator">/</span>skynet etc<span class="token operator">/</span>config<span class="token punctuation">.</span>node1
</code></pre> 
<p>运行效果如下，可以看到打工服务开始工作了，<code>2秒</code>赚了<code>10</code>块钱~<br> <img src="https://images2.imgbox.com/ba/25/HGH2xois_o.gif" alt="请添加图片描述"></p> 
<h5><a id="8_633"></a>8、封装服务类</h5> 
<p>假设我们现在要再写一个买猫粮的服务，这个时候，可以按照上面的打工服务写一个服务。事实上，每个服务都有一些通用的变量和方法，我们可以封装一个<code>service</code>类，方便复用减少代码量。<br> 我们在<code>lualib</code>目录中新建一个<code>service.lua</code>脚本，<br> <img src="https://images2.imgbox.com/44/3a/dWYjPANJ_o.png" alt="在这里插入图片描述"><br> <code>service.lua</code>代码如下，</p> 
<pre><code class="prism language-java">local skynet <span class="token operator">=</span> require <span class="token string">"skynet"</span>
local cluster <span class="token operator">=</span> require <span class="token string">"skynet.cluster"</span>

<span class="token operator">--</span> 封装服务类
local <span class="token class-name">M</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
   
     
     
	<span class="token operator">--</span> 服务名
    name <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">,</span>
    <span class="token operator">--</span> 服务id
    id <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token operator">--</span> 退出
    exit <span class="token operator">=</span> nil<span class="token punctuation">,</span>
    <span class="token operator">--</span> 初始化
    init <span class="token operator">=</span> nil<span class="token punctuation">,</span>
    <span class="token operator">--</span> 消息响应函数表
    resp <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
   
     
     <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token operator">--</span> 输出堆栈
local function <span class="token function">tracback</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    skynet<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token function">tostring</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span>
    skynet<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>debug<span class="token punctuation">.</span><span class="token function">traceback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
end

<span class="token operator">--</span> 消息分发
local dispatch <span class="token operator">=</span> function <span class="token punctuation">(</span>session<span class="token punctuation">,</span> address<span class="token punctuation">,</span> cmd<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
	<span class="token operator">--</span> 从resp表中查找是否存在消息的响应函数
    local func <span class="token operator">=</span> <span class="token class-name">M</span><span class="token punctuation">.</span>resp<span class="token punctuation">[</span>cmd<span class="token punctuation">]</span>
    <span class="token keyword">if</span> not func then
        skynet<span class="token punctuation">.</span><span class="token function">ret</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span>
    end
	<span class="token operator">--</span> 调用响应函数
    local ret <span class="token operator">=</span> table<span class="token punctuation">.</span><span class="token function">pack</span><span class="token punctuation">(</span><span class="token function">xpcall</span><span class="token punctuation">(</span>func<span class="token punctuation">,</span> tracback<span class="token punctuation">,</span> address<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    local isok <span class="token operator">=</span> ret<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>

    <span class="token keyword">if</span> not isok then
        skynet<span class="token punctuation">.</span><span class="token function">ret</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span>
    end

    skynet<span class="token punctuation">.</span><span class="token function">retpack</span><span class="token punctuation">(</span>table<span class="token punctuation">.</span><span class="token function">unpack</span><span class="token punctuation">(</span>ret<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
end

<span class="token operator">--</span> 初始化
local function <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    skynet<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token class-name">M</span><span class="token punctuation">.</span>name <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token string">" "</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token class-name">M</span><span class="token punctuation">.</span>id <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token string">" init"</span><span class="token punctuation">)</span>
    skynet<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">"lua"</span><span class="token punctuation">,</span> dispatch<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token class-name">M</span><span class="token punctuation">.</span>init then
        <span class="token class-name">M</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    end
end

<span class="token operator">--</span> 启动服务
function <span class="token class-name">M</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> id<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
    <span class="token class-name">M</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name
    <span class="token class-name">M</span><span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token function">tonumber</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
    skynet<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>init<span class="token punctuation">)</span>
end

<span class="token keyword">return</span> <span class="token class-name">M</span>
</code></pre> 
<h5><a id="9_709"></a>9、重写打工服务</h5> 
<p>有了<code>service</code>类，我们写服务的时候，只需要按下面这个模板写就可以了，</p> 
<pre><code class="prism language-java">local skynet <span class="token operator">=</span> require <span class="token string">"skynet"</span>
local s <span class="token operator">=</span> require <span class="token string">"service"</span>

s<span class="token punctuation">.</span>init <span class="token operator">=</span> <span class="token function">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token operator">--</span> 初始化
end

s<span class="token punctuation">.</span>resp<span class="token punctuation">.</span>协议<span class="token number">1</span> <span class="token operator">=</span> <span class="token function">function</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
	<span class="token operator">--</span> <span class="token constant">TODO</span>
end

s<span class="token punctuation">.</span>resp<span class="token punctuation">.</span>协议<span class="token number">2</span> <span class="token operator">=</span> <span class="token function">function</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
	<span class="token operator">--</span> <span class="token constant">TODO</span>
end

s<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
</code></pre> 
<p>现在，我们重新写一下打工服务，改造后代码如下，我们后面新写服务也按照这个格式来写，统一，方便维护，</p> 
<pre><code class="prism language-java">local skynet <span class="token operator">=</span> require <span class="token string">"skynet"</span>
local s <span class="token operator">=</span> require <span class="token string">"service"</span>

s<span class="token punctuation">.</span>money <span class="token operator">=</span> <span class="token number">0</span>
s<span class="token punctuation">.</span>isworking <span class="token operator">=</span> <span class="token boolean">false</span>

s<span class="token punctuation">.</span>update <span class="token operator">=</span> <span class="token function">function</span><span class="token punctuation">(</span>frame<span class="token punctuation">)</span>
    <span class="token keyword">if</span> s<span class="token punctuation">.</span>isworking then
        s<span class="token punctuation">.</span>money <span class="token operator">=</span> s<span class="token punctuation">.</span>money <span class="token operator">+</span> <span class="token number">1</span>
        skynet<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>name <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token function">tostring</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token string">", money: "</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token function">tostring</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>money<span class="token punctuation">)</span><span class="token punctuation">)</span>
    end
end

s<span class="token punctuation">.</span>init <span class="token operator">=</span> function <span class="token punctuation">(</span><span class="token punctuation">)</span>
    skynet<span class="token punctuation">.</span><span class="token function">fork</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>timer<span class="token punctuation">)</span>
end

s<span class="token punctuation">.</span>timer <span class="token operator">=</span> <span class="token function">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    local stime <span class="token operator">=</span> skynet<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    local frame <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">while</span> <span class="token boolean">true</span> <span class="token keyword">do</span>
        frame <span class="token operator">=</span> frame <span class="token operator">+</span> <span class="token number">1</span>
        local isok<span class="token punctuation">,</span> err <span class="token operator">=</span> <span class="token function">pcall</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>update<span class="token punctuation">,</span> frame<span class="token punctuation">)</span>
        <span class="token keyword">if</span> not isok then
            skynet<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
        end
        local etime <span class="token operator">=</span> skynet<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        local waittime <span class="token operator">=</span> frame <span class="token operator">*</span> <span class="token number">20</span> <span class="token operator">-</span> <span class="token punctuation">(</span>etime <span class="token operator">-</span> stime<span class="token punctuation">)</span>
        <span class="token keyword">if</span> waittime <span class="token operator">&lt;=</span> <span class="token number">0</span> then
            waittime <span class="token operator">=</span> <span class="token number">2</span>
        end
        skynet<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span>waittime<span class="token punctuation">)</span>
    end
end


s<span class="token punctuation">.</span>resp<span class="token punctuation">.</span>start_work <span class="token operator">=</span> <span class="token function">function</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>isworking <span class="token operator">=</span> <span class="token boolean">true</span>
end

s<span class="token punctuation">.</span>resp<span class="token punctuation">.</span>stop_work <span class="token operator">=</span> <span class="token function">function</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>isworking <span class="token operator">=</span> <span class="token boolean">false</span>
end

s<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
</code></pre> 
<h5><a id="10_782"></a>10、买猫粮服务</h5> 
<p>打工挣钱，有了钱我们就可以买猫粮啦，我们来写一个买猫粮的服务脚本。<br> 我们在<code>service</code>文件夹中新建一个<code>buy</code>文件夹，如下，<br> <img src="https://images2.imgbox.com/8b/44/JLPl4xTs_o.png" alt="在这里插入图片描述"><br> 进入<code>buy</code>目录，然后创建一个<code>init.lua</code>脚本，<br> <img src="https://images2.imgbox.com/20/8f/X3KTg9aB_o.png" alt="在这里插入图片描述"><br> 代码如下：</p> 
<pre><code class="prism language-java"><span class="token operator">--</span> service<span class="token operator">/</span>buy<span class="token operator">/</span>init<span class="token punctuation">.</span>lua脚本

local skynet <span class="token operator">=</span> require <span class="token string">"skynet"</span>
local s <span class="token operator">=</span> require <span class="token string">"service"</span>

s<span class="token punctuation">.</span>cat_food_price <span class="token operator">=</span> <span class="token number">5</span>
s<span class="token punctuation">.</span>cat_food_cnt <span class="token operator">=</span> <span class="token number">0</span>

s<span class="token punctuation">.</span>resp<span class="token punctuation">.</span>buy <span class="token operator">=</span> function <span class="token punctuation">(</span>source<span class="token punctuation">)</span>
	<span class="token operator">--</span> 先扣费
	local left_money <span class="token operator">=</span> skynet<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">"worker1"</span><span class="token punctuation">,</span> <span class="token string">"lua"</span><span class="token punctuation">,</span> <span class="token string">"change_money"</span><span class="token punctuation">,</span> <span class="token operator">-</span>s<span class="token punctuation">.</span>cat_food_price<span class="token punctuation">)</span>
    <span class="token keyword">if</span> left_money <span class="token operator">&gt;=</span> <span class="token number">0</span> then
        s<span class="token punctuation">.</span>cat_food_cnt <span class="token operator">=</span> s<span class="token punctuation">.</span>cat_food_cnt <span class="token operator">+</span> <span class="token number">1</span>
        skynet<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"buy cat food ok, current cnt: "</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token function">tostring</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>cat_food_cnt<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span>
    end
    <span class="token operator">--</span> 购买失败，把钱加回去
    skynet<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"buy failed, money not enough"</span><span class="token punctuation">)</span>
    skynet<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">"worker1"</span><span class="token punctuation">,</span> <span class="token string">"lua"</span><span class="token punctuation">,</span> <span class="token string">"change_money"</span><span class="token punctuation">,</span> s<span class="token punctuation">.</span>cat_food_price<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span>
end

s<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
</code></pre> 
<p>然后我们给打工服务加多一个消息，</p> 
<pre><code class="prism language-java"><span class="token operator">--</span> service<span class="token operator">/</span>worker<span class="token operator">/</span>init<span class="token punctuation">.</span>lua脚本

s<span class="token punctuation">.</span>resp<span class="token punctuation">.</span>change_money <span class="token operator">=</span> <span class="token function">function</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> delta<span class="token punctuation">)</span>
	s<span class="token punctuation">.</span>money <span class="token operator">=</span> s<span class="token punctuation">.</span>money <span class="token operator">+</span> delta
	<span class="token keyword">return</span> s<span class="token punctuation">.</span>money
end
</code></pre> 
<p>最后，在主服务中加上买猫粮服务的启动和消息发送，如下：</p> 
<pre><code class="prism language-java">local skynet <span class="token operator">=</span> require <span class="token string">"skynet"</span>

skynet<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>function <span class="token punctuation">(</span><span class="token punctuation">)</span>
    skynet<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"[start main] hello world"</span><span class="token punctuation">)</span>
	<span class="token operator">--</span> 启动打工服务
    local worker1 <span class="token operator">=</span> skynet<span class="token punctuation">.</span><span class="token function">newservice</span><span class="token punctuation">(</span><span class="token string">"worker"</span><span class="token punctuation">,</span> <span class="token string">"worker"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token operator">--</span> 启动买猫粮服务
    local buy1 <span class="token operator">=</span> skynet<span class="token punctuation">.</span><span class="token function">newservice</span><span class="token punctuation">(</span><span class="token string">"buy"</span><span class="token punctuation">,</span> <span class="token string">"buy"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>

	<span class="token operator">--</span> 开始打工
    skynet<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>worker1<span class="token punctuation">,</span> <span class="token string">"lua"</span><span class="token punctuation">,</span> <span class="token string">"start_work"</span><span class="token punctuation">)</span>
    skynet<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span>
    <span class="token operator">--</span> 结束打工
    skynet<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>worker1<span class="token punctuation">,</span> <span class="token string">"lua"</span><span class="token punctuation">,</span> <span class="token string">"stop_work"</span><span class="token punctuation">)</span>

    <span class="token operator">--</span> 买猫粮
    skynet<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>buy1<span class="token punctuation">,</span> <span class="token string">"lua"</span><span class="token punctuation">,</span> <span class="token string">"buy"</span><span class="token punctuation">)</span>
    
    <span class="token operator">--</span> 退出主服务
    skynet<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
end<span class="token punctuation">)</span>
</code></pre> 
<p>好啦，现在我们测试一下，运行效果如下：<br> <img src="https://images2.imgbox.com/94/a5/Zd24b9GC_o.gif" alt="请添加图片描述"><br> 可以看到，最后买猫粮成功啦~<br> <img src="https://images2.imgbox.com/16/ca/CtBMJ3GQ_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_859"></a>九、补充</h4> 
<h5><a id="1_861"></a>1、网络模块</h5> 
<p>写服务端，肯定需要涉及到网络模块，需要用到<code>skynet.socket</code>，案例：</p> 
<pre><code class="prism language-java"><span class="token operator">--</span> main<span class="token punctuation">.</span>lua

local skynet <span class="token operator">=</span> require <span class="token string">"skynet"</span>
local socket <span class="token operator">=</span> require <span class="token string">"skynet.socket"</span>

local function <span class="token function">on_connect</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> addr<span class="token punctuation">)</span>
	socket<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span>
	<span class="token keyword">while</span> <span class="token boolean">true</span> <span class="token keyword">do</span>
		local readdata <span class="token operator">=</span> socket<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span>
		<span class="token keyword">if</span> readdata then
			<span class="token operator">--</span> <span class="token constant">TODO</span> 处理消息
			
			<span class="token operator">--</span> 回应客户端，把readdata返回给客户端
			<span class="token operator">--</span> socket<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> <span class="token string">"server get data: "</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> readdata<span class="token punctuation">)</span>
		<span class="token keyword">else</span>
			<span class="token operator">--</span> 连接断开了
			socket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span>
		end
	end
end

skynet<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token function">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	local listenfd <span class="token operator">=</span> socket<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string">"0.0.0.0"</span><span class="token punctuation">,</span> <span class="token number">8888</span><span class="token punctuation">)</span>
	socket<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>listenfd<span class="token punctuation">,</span> on_connect<span class="token punctuation">)</span>
end<span class="token punctuation">)</span>
</code></pre> 
<p>如果要写一个多人聊天功能的话，只需要把消息广播出去即可，例：</p> 
<pre><code class="prism language-java"><span class="token operator">--</span> main<span class="token punctuation">.</span>lua

local skynet <span class="token operator">=</span> require <span class="token string">"skynet"</span>
local socket <span class="token operator">=</span> require <span class="token string">"skynet.socket"</span>

local clients <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
   
     
     <span class="token punctuation">}</span>

local function <span class="token function">on_connect</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> addr<span class="token punctuation">)</span>
	clients<span class="token punctuation">[</span>fd<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
   
     
     <span class="token punctuation">}</span>
	socket<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span>
	<span class="token keyword">while</span> <span class="token boolean">true</span> <span class="token keyword">do</span>
		local readdata <span class="token operator">=</span> socket<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span>
		<span class="token keyword">if</span> readdata then
			<span class="token operator">--</span> 广播
			<span class="token keyword">for</span> client_fd<span class="token punctuation">,</span> _ in <span class="token function">pairs</span><span class="token punctuation">(</span>clients<span class="token punctuation">)</span> <span class="token keyword">do</span>
				socket<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>client_fd<span class="token punctuation">,</span> readdata<span class="token punctuation">)</span>
			end 
		<span class="token keyword">else</span>
			<span class="token operator">--</span> 连接断开了
			socket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span>
			clients<span class="token punctuation">[</span>fd<span class="token punctuation">]</span> <span class="token operator">=</span> nil
		end
	end
end

skynet<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token function">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	local listenfd <span class="token operator">=</span> socket<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string">"0.0.0.0"</span><span class="token punctuation">,</span> <span class="token number">8888</span><span class="token punctuation">)</span>
	socket<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>listenfd<span class="token punctuation">,</span> on_connect<span class="token punctuation">)</span>
end<span class="token punctuation">)</span>
</code></pre> 
<h5><a id="2_933"></a>2、节点集群</h5> 
<p>我上面写的打工赚钱买猫粮，都在同一个节点中，<br> <img src="https://images2.imgbox.com/dc/b4/BIVOLXX4_o.png" alt="在这里插入图片描述"></p> 
<p>实际项目中，可能会开启多个节点，两个服务如果在同一个节点中，则通过<code>skynet.send</code>或<code>skynet.call</code>来传递消息，</p> 
<blockquote> 
 <p>注：<code>send</code>是发送消息，不会阻塞调用方；<code>call</code>是阻塞调用。</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/f1/60/XGCvcUz2_o.png" alt="在这里插入图片描述"></p> 
<p>如果在不同的节点中，则需要使用<code>cluster.send</code>或<code>cluster.call</code>，</p> 
<blockquote> 
 <p>注：<code>send</code>是发送消息，不会阻塞调用方；<code>call</code>是阻塞调用。</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/c6/1c/2XP4m1OQ_o.png" alt="在这里插入图片描述"></p> 
<p>对此，我们可以优化一下上文中的<code>service.lua</code>，封装<code>send</code>和<code>call</code>方法，</p> 
<pre><code class="prism language-java"><span class="token operator">--</span> lualib<span class="token operator">/</span>service<span class="token punctuation">.</span>lua

local cluster <span class="token operator">=</span> require <span class="token string">"skynet.cluster"</span>

<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

function <span class="token class-name">M</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> srv<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
	local mynode <span class="token operator">=</span> skynet<span class="token punctuation">.</span><span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string">"node"</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> node <span class="token operator">==</span> mynode then	
		<span class="token keyword">return</span> skynet<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>srv<span class="token punctuation">,</span> <span class="token string">"lua"</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
	<span class="token keyword">else</span>
		<span class="token keyword">return</span> cluster<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> srv<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
	end
end

function <span class="token class-name">M</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> srv<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
	local mynode <span class="token operator">=</span> skynet<span class="token punctuation">.</span><span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string">"node"</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> node <span class="token operator">==</span> mynode then	
		<span class="token keyword">return</span> skynet<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>srv<span class="token punctuation">,</span> <span class="token string">"lua"</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
	<span class="token keyword">else</span>
		<span class="token keyword">return</span> cluster<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> srv<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
	end
end
</code></pre> 
<p>我们在<code>etc/config.node1</code>的末尾加多一行</p> 
<pre><code class="prism language-java">node <span class="token operator">=</span> <span class="token string">"node1"</span>
</code></pre> 
<p>拷贝一份，重命名为<code>config.node2</code>，把末尾一行改为</p> 
<pre><code class="prism language-java">node <span class="token operator">=</span> <span class="token string">"node2"</span>
</code></pre> 
<p>然后，我们改下<code>main.lua</code>脚本，让它在<code>node1</code>节点开启打工服务，在<code>node2</code>节点开启买猫粮节点，最终<code>main.lua</code>脚本如下：</p> 
<pre><code class="prism language-java">local skynet <span class="token operator">=</span> require <span class="token string">"skynet"</span>
local cluster <span class="token operator">=</span> require <span class="token string">"skynet.cluster"</span>
require <span class="token string">"skynet.manager"</span>

skynet<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>function <span class="token punctuation">(</span><span class="token punctuation">)</span>
    skynet<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"[start main] hello world"</span><span class="token punctuation">)</span>

	<span class="token operator">--</span> 集群配置
    cluster<span class="token punctuation">.</span><span class="token function">reload</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
   
     
     
        node1 <span class="token operator">=</span> <span class="token string">"127.0.0.1:7001"</span><span class="token punctuation">,</span>
        node2 <span class="token operator">=</span> <span class="token string">"127.0.0.1:7002"</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    local mynode <span class="token operator">=</span> skynet<span class="token punctuation">.</span><span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string">"node"</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token string">"node1"</span> <span class="token operator">==</span> mynode then
    	<span class="token operator">--</span> 启动集群节点
        cluster<span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token string">"node1"</span><span class="token punctuation">)</span>
        <span class="token operator">--</span> node1节点，开启打工服务
        local worker1 <span class="token operator">=</span> skynet<span class="token punctuation">.</span><span class="token function">newservice</span><span class="token punctuation">(</span><span class="token string">"worker"</span><span class="token punctuation">,</span> <span class="token string">"worker"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
        skynet<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">"worker1"</span><span class="token punctuation">,</span> worker1<span class="token punctuation">)</span>
        skynet<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>worker1<span class="token punctuation">,</span> <span class="token string">"lua"</span><span class="token punctuation">,</span> <span class="token string">"start_work"</span><span class="token punctuation">)</span>
        skynet<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span>
        skynet<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>worker1<span class="token punctuation">,</span> <span class="token string">"lua"</span><span class="token punctuation">,</span> <span class="token string">"stop_work"</span><span class="token punctuation">)</span>
    elseif <span class="token string">"node2"</span> <span class="token operator">==</span> mynode then
    	<span class="token operator">--</span> 启动集群节点
        cluster<span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token string">"node2"</span><span class="token punctuation">)</span>
        <span class="token operator">--</span> node2节点，开启买猫粮服务
        local buy1 <span class="token operator">=</span> skynet<span class="token punctuation">.</span><span class="token function">newservice</span><span class="token punctuation">(</span><span class="token string">"buy"</span><span class="token punctuation">,</span> <span class="token string">"buy"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token operator">--</span> 请求买猫粮，买三次
        skynet<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>buy1<span class="token punctuation">,</span> <span class="token string">"lua"</span><span class="token punctuation">,</span> <span class="token string">"buy"</span><span class="token punctuation">)</span>
        skynet<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>buy1<span class="token punctuation">,</span> <span class="token string">"lua"</span><span class="token punctuation">,</span> <span class="token string">"buy"</span><span class="token punctuation">)</span>
        skynet<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>buy1<span class="token punctuation">,</span> <span class="token string">"lua"</span><span class="token punctuation">,</span> <span class="token string">"buy"</span><span class="token punctuation">)</span>
    end

    skynet<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
end<span class="token punctuation">)</span>
</code></pre> 
<p>最后，我们改下<code>buy/init.lua</code>脚本，把<code>skynet.call</code>改成<code>s.call</code>，如下：</p> 
<pre><code class="prism language-java">local skynet <span class="token operator">=</span> require <span class="token string">"skynet"</span>
local s <span class="token operator">=</span> require <span class="token string">"service"</span>

s<span class="token punctuation">.</span>cat_food_price <span class="token operator">=</span> <span class="token number">5</span>
s<span class="token punctuation">.</span>cat_food_cnt <span class="token operator">=</span> <span class="token number">0</span>

s<span class="token punctuation">.</span>resp<span class="token punctuation">.</span>buy <span class="token operator">=</span> function <span class="token punctuation">(</span>source<span class="token punctuation">)</span>

    local left_money <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">"node1"</span><span class="token punctuation">,</span> <span class="token string">"worker1"</span><span class="token punctuation">,</span> <span class="token string">"change_money"</span><span class="token punctuation">,</span> <span class="token operator">-</span>s<span class="token punctuation">.</span>cat_food_price<span class="token punctuation">)</span>

    <span class="token keyword">if</span> left_money <span class="token operator">&gt;=</span> <span class="token number">0</span> then
        s<span class="token punctuation">.</span>cat_food_cnt <span class="token operator">=</span> s<span class="token punctuation">.</span>cat_food_cnt <span class="token operator">+</span> <span class="token number">1</span>
        skynet<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"buy cat food ok, current cnt: "</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token function">tostring</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>cat_food_cnt<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span>
    end
    skynet<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"buy cat food failed, money not enough"</span><span class="token punctuation">)</span>
    s<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">"node1"</span><span class="token punctuation">,</span> <span class="token string">"worker1"</span><span class="token punctuation">,</span> <span class="token string">"change_money"</span><span class="token punctuation">,</span> s<span class="token punctuation">.</span>cat_food_price<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span>
end

s<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
</code></pre> 
<p>好了，现在我们先开启<code>节点1</code>，在终端执行命令</p> 
<pre><code class="prism language-java"><span class="token punctuation">.</span>/skynet<span class="token operator">/</span>skynet etc<span class="token operator">/</span>config<span class="token punctuation">.</span>node1
</code></pre> 
<p>可以看到<code>节点1</code>开启了打工服务，赚了<code>10块钱</code>，</p> 
<p><img src="https://images2.imgbox.com/17/48/HDHDrFMJ_o.gif" alt="请添加图片描述"><br> 现在我们开启<code>节点2</code>，在终端执行命令</p> 
<pre><code class="prism language-java"><span class="token punctuation">.</span>/skynet<span class="token operator">/</span>skynet etc<span class="token operator">/</span>config<span class="token punctuation">.</span>node2
</code></pre> 
<p>因为猫粮价格是<code>5块钱</code>一包，所以只能买两次，执行结果如下，可以看到第三次买猫粮失败，因为钱不够了，<br> <img src="https://images2.imgbox.com/88/20/UVZS13vd_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="3_1078"></a>3、数据库模块</h5> 
<h6><a id="31MySQL_1080"></a>3.1、安装MySQL</h6> 
<p>在终端执行命令</p> 
<pre><code class="prism language-java">sudo apt<span class="token operator">-</span>get install mysql<span class="token operator">-</span>server
</code></pre> 
<p>执行过程中会弹出框让你输入<code>MySQL</code>的<code>root</code>账号的密码，如下，需要输入两次，<br> <img src="https://images2.imgbox.com/eb/99/s49QnAhR_o.png" alt="在这里插入图片描述"><br> 安装完毕后，执行<code>mysql --version</code>，如果输出版本号，则说明安装成功了，<br> <img src="https://images2.imgbox.com/20/22/7eZibb5O_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="32MySQL_1093"></a>3.2、启动MySQL</h6> 
<p>在终端执行命令</p> 
<pre><code class="prism language-java">service mysql start
</code></pre> 
<p>此时会弹出一个框，注意此处输入<code>Ubuntu</code>的开机密码，而不是<code>MySQL</code>的<code>root</code>账号密码哦，点击<code>Authenticate</code>，<br> <img src="https://images2.imgbox.com/ce/30/TcH6CsO6_o.png" alt="在这里插入图片描述"><br> 启动成功后，我们可以通过下面的命令看是否有<code>mysql</code>的进程，</p> 
<pre><code class="prism language-java">ps <span class="token operator">-</span>axj <span class="token operator">|</span>grep mysql
</code></pre> 
<p>可以看到有<code>mysql</code>进程，说明<code>MySQL</code>服务已经成功启动了，<br> <img src="https://images2.imgbox.com/44/78/r3NKtwhN_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="33MySQL_1112"></a>3.3、关闭MySQL</h6> 
<p>在终端执行命令</p> 
<pre><code class="prism language-java">service mysql stop
</code></pre> 
<p>此时会弹出一个框，此处输入<code>Ubuntu</code>的开机密码，点击<code>Authenticate</code>，<br> <img src="https://images2.imgbox.com/81/a7/elUZatIT_o.png" alt="在这里插入图片描述"><br> 执行完毕后，同理，我们可以通过下面的命令查看是否已经没有<code>mysql</code>进程了，</p> 
<pre><code class="prism language-java">ps <span class="token operator">-</span>axj <span class="token operator">|</span>grep mysql
</code></pre> 
<h6><a id="34MySQL_1128"></a>3.4、登录MySQL</h6> 
<p>在终端执行命令</p> 
<pre><code class="prism language-java">mysql <span class="token operator">-</span>h127<span class="token punctuation">.</span><span class="token number">0.0</span><span class="token number">.1</span> <span class="token operator">-</span>uroot <span class="token operator">-</span>p你的密码
</code></pre> 
<p>如下，登录成功，<br> <img src="https://images2.imgbox.com/b7/cd/OVJmA5hK_o.png" alt="在这里插入图片描述"><br> 现在我们可以愉快地使用<code>mysql</code>啦，执行<code>show databases;</code>，查看所有的数据库<br> <img src="https://images2.imgbox.com/55/61/d7jLK0Ug_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="35skynet_1141"></a>3.5、在skynet中操作数据库</h6> 
<p>我们先在终端手动创建一个数据库，</p> 
<pre><code class="prism language-java">create database test_db<span class="token punctuation">;</span>
</code></pre> 
<p>如下,<br> <img src="https://images2.imgbox.com/82/69/IwJxWHq6_o.png" alt="在这里插入图片描述"><br> 选择<code>test_db</code>，<br> <img src="https://images2.imgbox.com/01/80/skjBSqzV_o.png" alt="在这里插入图片描述"><br> 接着再创建一个表，</p> 
<pre><code class="prism language-java">create table users <span class="token punctuation">(</span>
	id <span class="token keyword">int</span> not <span class="token keyword">null</span> auto_increment<span class="token punctuation">,</span>
	name <span class="token function">varchar</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> not <span class="token keyword">null</span><span class="token punctuation">,</span>
	primary key <span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>如下：<br> <img src="https://images2.imgbox.com/6e/a9/fsomoO72_o.png" alt="在这里插入图片描述"><br> 好了，现在我们在<code>skynet</code>中来操作数据库吧，例：</p> 
<pre><code class="prism language-java">local skynet <span class="token operator">=</span> require <span class="token string">"skynet"</span>
local mysql <span class="token operator">=</span> require <span class="token string">"skynet.db.mysql"</span>


skynet<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>function <span class="token punctuation">(</span><span class="token punctuation">)</span>
    skynet<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"[start main] hello world"</span><span class="token punctuation">)</span>

    local db <span class="token operator">=</span> mysql<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>
        <span class="token punctuation">{<!-- --></span>
   
     
     
            host <span class="token operator">=</span> <span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span>
            port <span class="token operator">=</span> <span class="token number">3306</span><span class="token punctuation">,</span>
            database <span class="token operator">=</span> <span class="token string">"test_db"</span><span class="token punctuation">,</span>
            user <span class="token operator">=</span> <span class="token string">"root"</span><span class="token punctuation">,</span>
            password <span class="token operator">=</span> <span class="token string">"123456"</span><span class="token punctuation">,</span>
            max_packet_size <span class="token operator">=</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">,</span>
            on_connect <span class="token operator">=</span> nil
        <span class="token punctuation">}</span>
    <span class="token punctuation">)</span>
	<span class="token operator">--</span> 插入数据
    local res <span class="token operator">=</span> db<span class="token operator">:</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">"insert into users(name) values (\'linxinfa\')"</span><span class="token punctuation">)</span>
    <span class="token operator">--</span> 查询数据
    res <span class="token operator">=</span> db<span class="token operator">:</span><span class="token function">query</span><span class="token punctuation">(</span>'select <span class="token operator">*</span> from users'<span class="token punctuation">)</span>
    <span class="token keyword">for</span> i<span class="token punctuation">,</span> v in <span class="token function">pairs</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token keyword">do</span>
        <span class="token function">print</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token string">" "</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> v<span class="token punctuation">.</span>id <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token string">" "</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> v<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
    end

    skynet<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
end<span class="token punctuation">)</span>
</code></pre> 
<p>我们执行两次，结果如下，可以看到，数据正常写入到数据库中了，成功~<br> <img src="https://images2.imgbox.com/ea/b9/nXSYZqy9_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d38d11a2647140f27daf7947d188e3d4/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">VMware共享文件夹在虚拟机中的位置</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6fe524105a1c09f115efdd425f8990c9/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">sql实现模糊搜索以及按匹配度进行排序</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>