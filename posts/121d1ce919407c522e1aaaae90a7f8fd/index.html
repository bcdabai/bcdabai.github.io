<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>nginx和php连接的2种方式,Nginx 中 fastcgi_pass 监听端口有2种方式（转发给php的2种方式）： unix socket和tcp socket差异... - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="nginx和php连接的2种方式,Nginx 中 fastcgi_pass 监听端口有2种方式（转发给php的2种方式）： unix socket和tcp socket差异..." />
<meta property="og:description" content="Nginx链接fastcgi的方式有2种：
unix domain socket和TCP，Unix domain socket 或者 IPC socket是一种终端，能够使同一台操做系统上的两个或多个进程进行数据通讯。与管道相比，Unix domain sockets 既能够使用字节流和数据队列，而管道通讯则只能经过字节流。Unix domain sockets的接口和Internet socket很像，但它不使用网络底层协议来通讯。Unix domain socket 的功能是POSIX操做系统里的一种组件。php
TCP和unix domain socket方式对比
TCP是使用TCP端口链接127.0.0.1:9000html
Socket是使用unix domain socket链接套接字/dev/shm/php-cgi.sock(不少教程使用路径/tmp，而路径/dev/shm是个tmpfs，速度比磁盘快得多。我这里用的是/tmp，用/dev/shm的请看原文)linux
fastcgi_pass unix:/tmp/php-cgi.sock
fastcgi_pass 127.0.0.1:9000
在服务器压力不大的状况下，tcp和socket差异不大，但在压力比较满的时候，用套接字方式，效果确实比较好。nginx
下面是php 5.3以上版本将TCP改为socket方式的配置方法：服务器
修改php-fpm.conf(/usr/local/php/etc/php-fpm.conf)网络
注意：注释掉是用；我这里是写 中文注释习惯了，前面加个#，也就是你用的话，要给#及后面的去掉dom
[global]
pid = /usr/local/php/var/run/php-fpm.pid
error_log = /usr/local/php/var/log/php-fpm.log
log_level = notice
[www]
;listen = 127.0.0.1:9000 #默认是tcp
listen = /tmp/php-cgi.sock #修改为socket
listen.backlog = -1
listen.allowed_clients = 127.0.0.1
listen.owner = www
listen.group = www
listen.mode = 0666" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/121d1ce919407c522e1aaaae90a7f8fd/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-04-05T15:24:16+08:00" />
<meta property="article:modified_time" content="2021-04-05T15:24:16+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">nginx和php连接的2种方式,Nginx 中 fastcgi_pass 监听端口有2种方式（转发给php的2种方式）： unix socket和tcp socket差异...</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div style="font-size:16px;"> 
 <p>Nginx链接fastcgi的方式有2种：</p> 
 <p>unix domain socket和TCP，Unix domain socket 或者 IPC socket是一种终端，能够使同一台操做系统上的两个或多个进程进行数据通讯。与管道相比，Unix domain sockets 既能够使用字节流和数据队列，而管道通讯则只能经过字节流。Unix domain sockets的接口和Internet socket很像，但它不使用网络底层协议来通讯。Unix domain socket 的功能是POSIX操做系统里的一种组件。php</p> 
 <p>TCP和unix domain socket方式对比</p> 
 <p>TCP是使用TCP端口链接127.0.0.1:9000html</p> 
 <p>Socket是使用unix domain socket链接套接字/dev/shm/php-cgi.sock(不少教程使用路径/tmp，而路径/dev/shm是个tmpfs，速度比磁盘快得多。我这里用的是/tmp，用/dev/shm的请看原文)linux</p> 
 <p>fastcgi_pass unix:/tmp/php-cgi.sock</p> 
 <p>fastcgi_pass 127.0.0.1:9000</p> 
 <p>在服务器压力不大的状况下，tcp和socket差异不大，但在压力比较满的时候，用套接字方式，效果确实比较好。nginx</p> 
 <p>下面是php 5.3以上版本将TCP改为socket方式的配置方法：服务器</p> 
 <p>修改php-fpm.conf(/usr/local/php/etc/php-fpm.conf)网络</p> 
 <p>注意：注释掉是用；我这里是写 中文注释习惯了，前面加个#，也就是你用的话，要给#及后面的去掉dom</p> 
 <p>[global]</p> 
 <p>pid = /usr/local/php/var/run/php-fpm.pid</p> 
 <p>error_log = /usr/local/php/var/log/php-fpm.log</p> 
 <p>log_level = notice</p> 
 <p>[www]</p> 
 <p>;listen = 127.0.0.1:9000 #默认是tcp</p> 
 <p>listen = /tmp/php-cgi.sock #修改为socket</p> 
 <p>listen.backlog = -1</p> 
 <p>listen.allowed_clients = 127.0.0.1</p> 
 <p>listen.owner = www</p> 
 <p>listen.group = www</p> 
 <p>listen.mode = 0666</p> 
 <p>user = www</p> 
 <p>group = www</p> 
 <p>pm = dynamic</p> 
 <p>pm.max_children = 60</p> 
 <p>pm.start_servers = 30</p> 
 <p>pm.min_spare_servers = 30</p> 
 <p>pm.max_spare_servers = 60</p> 
 <p>request_terminate_timeout = 300</p> 
 <p>request_slowlog_timeout = 0</p> 
 <p>slowlog = var/log/slow.log</p> 
 <p>修改nginx配置文件server段的配置，将http的方式改成socket方式socket</p> 
 <p>location ~ [^/]\.php(/|$)</p> 
 <p>{<!-- --></p> 
 <p>try_files $uri =404;</p> 
 <p>fastcgi_pass unix:/tmp/php-cgi.sock; #用socket模式</p> 
 <p>fastcgi_index index.php;</p> 
 <p>include fastcgi.conf;</p> 
 <p>}</p> 
 <p>重启php-fpm与nginxtcp</p> 
 <p>service nginx restart</p> 
 <p>service php-fpm restart</p> 
 <p>ls -al /tmp</p> 
 <p>重启php-fpm服务的时候，若是报错：An another FPM instance seems to already listen on /tmp/php-cgi-71.sockphp-fpm</p> 
 <p>只要将/tmp/php-cgi-71.sock删除在从新启动php-fpm便可解决</p> 
 <p>能够看到php-cgi.sock文件unix套接字类型。理论上，unix socket 不走网络，效率高一些，但稳定性不是很理想</p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f65e41b0e688400f70b620b681e407d1/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Spring Boot中使用JdbcTemplate访问达梦数据库详解</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/02e39080987a53e20ddf0e835f703e7b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Spring Boot中使用mybatis访问达梦数据库详解</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>