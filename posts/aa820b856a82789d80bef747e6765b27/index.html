<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>RustDesk自建服务器实录 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="RustDesk自建服务器实录" />
<meta property="og:description" content="购买腾讯云 选择地理上最近的地域，以便速度最快，我在武汉，选择的是成都。
云服务器基本配置：
镜像信息：Ubuntu 22.04 LTS
实例规格：CPU: 2核 内存: 2GB
系统盘：40GB SSD云硬盘
流量包：300GB/月（带宽：4Mbps）
远程登录选择WebShell一键登录，简单方便。
腾讯云 产业智变·云启未来 - 腾讯 (tencent.com)
→控制台→产品管理→最近访问→轻量服务器→服务器→Ubuntu→远程登录→一键登录→进入远程Bash界面
安装配置Docker容器 文章来源：docker-compose自建RustDesk远程控制服务器
所有操作均在root权限进行，需要先切换用户
sudo -i 1、新建文件夹【/root/rustdesk_data】
mkdir /root/rustdesk_data 2、进入文件夹
cd /root/rustdesk_data 3、新建yml文件，并写入保存配置
vi docker-compose.yml yml文件配置内容如下：
version: &#39;3&#39; networks: rustdesk-net: external: false services: hbbs: container_name: hbbs ports: - 21115:21115 - 21116:21116 - 21116:21116/udp - 21118:21118 image: rustdesk/rustdesk-server:latest command: hbbs -r rustdesk.example.com:21117 volumes: - ./data:/root networks: - rustdesk-net depends_on: - hbbr restart: unless-stopped hbbr: container_name: hbbr ports: - 21117:21117 - 21119:21119 image: rustdesk/rustdesk-server:latest command: hbbr volumes: - ." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/aa820b856a82789d80bef747e6765b27/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-01-31T12:51:46+08:00" />
<meta property="article:modified_time" content="2023-01-31T12:51:46+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">RustDesk自建服务器实录</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_1"></a>购买腾讯云</h2> 
<p>选择地理上最近的地域，以便速度最快，我在武汉，选择的是成都。<br> 云服务器基本配置：<br> 镜像信息：Ubuntu 22.04 LTS<br> 实例规格：CPU: 2核 内存: 2GB<br> 系统盘：40GB SSD云硬盘<br> 流量包：300GB/月（带宽：4Mbps）</p> 
<p>远程登录选择WebShell一键登录，简单方便。<br> <a href="https://cloud.tencent.com/" rel="nofollow">腾讯云 产业智变·云启未来 - 腾讯 (tencent.com)</a><br> →控制台→产品管理→最近访问→轻量服务器→服务器→Ubuntu→远程登录→一键登录→进入远程Bash界面</p> 
<h2><a id="Docker_15"></a>安装配置Docker容器</h2> 
<p>文章来源：<a href="https://www.cnblogs.com/zwgbk/p/16648073.html" rel="nofollow">docker-compose自建RustDesk远程控制服务器</a><br> 所有操作均在root权限进行，需要先切换用户</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token parameter variable">-i</span>
</code></pre> 
<p>1、新建文件夹【/root/rustdesk_data】</p> 
<pre><code class="prism language-bash"><span class="token function">mkdir</span> /root/rustdesk_data
</code></pre> 
<p>2、进入文件夹</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> /root/rustdesk_data
</code></pre> 
<p>3、新建yml文件，并写入保存配置</p> 
<pre><code class="prism language-bash"><span class="token function">vi</span> docker-compose.yml
</code></pre> 
<p>yml文件配置内容如下：</p> 
<pre><code class="prism language-json"><span class="token literal-property property">version</span><span class="token operator">:</span> <span class="token string">'3'</span>

<span class="token literal-property property">networks</span><span class="token operator">:</span>
  rustdesk<span class="token operator">-</span>net<span class="token operator">:</span>
    <span class="token literal-property property">external</span><span class="token operator">:</span> <span class="token boolean">false</span>

<span class="token literal-property property">services</span><span class="token operator">:</span>
  <span class="token literal-property property">hbbs</span><span class="token operator">:</span>
    <span class="token literal-property property">container_name</span><span class="token operator">:</span> hbbs
    <span class="token literal-property property">ports</span><span class="token operator">:</span>
      <span class="token operator">-</span> <span class="token number">21115</span><span class="token operator">:</span><span class="token number">21115</span>
      <span class="token operator">-</span> <span class="token number">21116</span><span class="token operator">:</span><span class="token number">21116</span>
      <span class="token operator">-</span> <span class="token number">21116</span><span class="token operator">:</span><span class="token number">21116</span><span class="token operator">/</span>udp
      <span class="token operator">-</span> <span class="token number">21118</span><span class="token operator">:</span><span class="token number">21118</span>
    <span class="token literal-property property">image</span><span class="token operator">:</span> rustdesk<span class="token operator">/</span>rustdesk<span class="token operator">-</span>server<span class="token operator">:</span>latest
    <span class="token literal-property property">command</span><span class="token operator">:</span> hbbs <span class="token operator">-</span>r rustdesk<span class="token punctuation">.</span>example<span class="token punctuation">.</span>com<span class="token operator">:</span><span class="token number">21117</span>
    <span class="token literal-property property">volumes</span><span class="token operator">:</span>
      <span class="token operator">-</span> <span class="token punctuation">.</span><span class="token operator">/</span>data<span class="token operator">:</span><span class="token operator">/</span>root
    <span class="token literal-property property">networks</span><span class="token operator">:</span>
      <span class="token operator">-</span> rustdesk<span class="token operator">-</span>net
    <span class="token literal-property property">depends_on</span><span class="token operator">:</span>
      <span class="token operator">-</span> hbbr
    <span class="token literal-property property">restart</span><span class="token operator">:</span> unless<span class="token operator">-</span>stopped

  <span class="token literal-property property">hbbr</span><span class="token operator">:</span>
    <span class="token literal-property property">container_name</span><span class="token operator">:</span> hbbr
    <span class="token literal-property property">ports</span><span class="token operator">:</span>
      <span class="token operator">-</span> <span class="token number">21117</span><span class="token operator">:</span><span class="token number">21117</span>
      <span class="token operator">-</span> <span class="token number">21119</span><span class="token operator">:</span><span class="token number">21119</span>
    <span class="token literal-property property">image</span><span class="token operator">:</span> rustdesk<span class="token operator">/</span>rustdesk<span class="token operator">-</span>server<span class="token operator">:</span>latest
    <span class="token literal-property property">command</span><span class="token operator">:</span> hbbr
    <span class="token literal-property property">volumes</span><span class="token operator">:</span>
      <span class="token operator">-</span> <span class="token punctuation">.</span><span class="token operator">/</span>data<span class="token operator">:</span><span class="token operator">/</span>root
    <span class="token literal-property property">networks</span><span class="token operator">:</span>
      <span class="token operator">-</span> rustdesk<span class="token operator">-</span>net
    <span class="token literal-property property">restart</span><span class="token operator">:</span> unless<span class="token operator">-</span>stopped
</code></pre> 
<p>注意：<br> ①其中第16行【rustdesk.example.com】更改为本机centos服务器公网ip地址，或已正确解析并可访问的域名。<br> ②设置云服务器网卡安全组放行相关端口。<br> ③设置centos系统防火墙放行相关端口，或直接把墙关停。</p> 
<pre><code class="prism language-bash"><span class="token comment">#临时关停防火墙</span>
systemctl stop firewalld.service
<span class="token comment">#永久关停防火墙</span>
systemctl disable firewalld.service
<span class="token comment">#查看防火墙状态</span>
systemctl status firewalld.service
</code></pre> 
<p>由于害怕关停防火墙会引起安全问题，因此通过手动在管理页面配置了防火墙规则，打开了相关网络断口<br> 添加规则1：<br> 应用类型：自定义<br> 协议：TCP<br> 断口：21115-21119<br> 策略：允许<br> 添加规则2：<br> 应用类型：自定义<br> 协议：UDP<br> 断口：21116<br> 策略：允许</p> 
<p>4、给yml文件开权限</p> 
<pre><code class="prism language-bash"><span class="token function">chmod</span> <span class="token number">755</span> docker-compose.yml
</code></pre> 
<p>5、执行下载镜像和启动docker容器</p> 
<pre><code class="prism language-bash"><span class="token function">docker-compose</span> up <span class="token parameter variable">-d</span>
</code></pre> 
<p>因为yml文件第15行和30行已经填写rustdesk官方的docker hub在线路径，所以执行时候会自动pull运行。</p> 
<p>6、查看docker运行情况</p> 
<pre><code class="prism language-bash"><span class="token function">docker</span> <span class="token function">ps</span>
</code></pre> 
<p>7、把yml文件里改好的IP或域名，填写到使用端中【ID服务器】<br> 至此，测试远程控制使用应该已经没有问题了，即使服务器重启，docker容器也会自启动。</p> 
<p>但是，有一个风险点：如果其他人知道了该IP或域名部署了rustdesk服务器，那么他人也可以直接填写ID服务器，使用服务。</p> 
<p>这样的话，流量就给别人白嫖了。</p> 
<p>所以接下来，需要强制开启填写key才能连接服务器。</p> 
<p>8、修改并保存第3步配置的yml文件【/root/rustdesk_data/docker-compose.yml】</p> 
<pre><code class="prism language-bash"><span class="token function">vi</span> /root/rustdesk_data/docker-compose.yml
</code></pre> 
<p>在16行和31行末尾加上【-k _ 】，以强制开启验证key，即：</p> 
<pre><code class="prism language-bash"><span class="token comment">#第16行</span>
command: hbbs <span class="token parameter variable">-r</span> rustdesk.example.com:21117 <span class="token parameter variable">-k</span> _ 
<span class="token comment">#第31行</span>
command: hbbr <span class="token parameter variable">-k</span> _ 
</code></pre> 
<p>注意16行填写自己的IP或域名</p> 
<p>9、重新加载容器</p> 
<pre><code class="prism language-bash"><span class="token comment">#进入容器文件夹</span>
<span class="token builtin class-name">cd</span> /root/rustdesk_data
<span class="token comment">#执行命令</span>
<span class="token function">docker-compose</span> pull
<span class="token function">docker-compose</span> up <span class="token parameter variable">-d</span>
</code></pre> 
<p>此时，重新测试用户端控制，没有填写KEY的情况下，会报错无法连上。</p> 
<p>10、找到KEY，并复制出来</p> 
<pre><code class="prism language-bash"><span class="token comment">#进入容器文件夹里【data文件夹】</span>
<span class="token builtin class-name">cd</span> /root/rusrdesk_data/data

<span class="token comment">#显示文件，可以看到2个id文件</span>
<span class="token comment">#如：id_ed25519  id_ed25519.pub</span>
<span class="token function">ls</span>
<span class="token comment">#查看公钥文件【id_ed25519.pub】，如：aMXQFBM+NpRIDqh0KZ7CUAXuQFxHqykAn5Fm0YqSQKM= 10 cat ./id_ed25519.pub</span>
</code></pre> 
<p>11、把KEY粘贴到用户端<br> 12、重启服务器</p> 
<pre><code class="prism language-bash"><span class="token function">reboot</span>
</code></pre> 
<p>注意进行重启，否则可能即使填写KEY仍连不上。</p> 
<pre><code class="prism language-json"><span class="token literal-property property">ersion</span><span class="token operator">:</span> <span class="token string">'3'</span>

<span class="token literal-property property">networks</span><span class="token operator">:</span>
  rustdesk<span class="token operator">-</span>net<span class="token operator">:</span>
    <span class="token literal-property property">external</span><span class="token operator">:</span> <span class="token boolean">false</span>

<span class="token literal-property property">services</span><span class="token operator">:</span>
  <span class="token literal-property property">hbbs</span><span class="token operator">:</span>
    <span class="token literal-property property">container_name</span><span class="token operator">:</span> hbbs
    <span class="token literal-property property">ports</span><span class="token operator">:</span>
      <span class="token operator">-</span> <span class="token number">21115</span><span class="token operator">:</span><span class="token number">21115</span>
      <span class="token operator">-</span> <span class="token number">21116</span><span class="token operator">:</span><span class="token number">21116</span>
      <span class="token operator">-</span> <span class="token number">21116</span><span class="token operator">:</span><span class="token number">21116</span><span class="token operator">/</span>udp
      <span class="token operator">-</span> <span class="token number">21118</span><span class="token operator">:</span><span class="token number">21118</span>
    <span class="token literal-property property">image</span><span class="token operator">:</span> rustdesk<span class="token operator">/</span>rustdesk<span class="token operator">-</span>server<span class="token operator">:</span>latest
    <span class="token literal-property property">command</span><span class="token operator">:</span> hbbs <span class="token operator">-</span>r <span class="token number">162.14</span><span class="token number">.75</span><span class="token number">.216</span><span class="token operator">:</span><span class="token number">21117</span> <span class="token operator">-</span>k _
    <span class="token literal-property property">volumes</span><span class="token operator">:</span>
      <span class="token operator">-</span> <span class="token punctuation">.</span><span class="token operator">/</span>data<span class="token operator">:</span><span class="token operator">/</span>root
    <span class="token literal-property property">networks</span><span class="token operator">:</span>
      <span class="token operator">-</span> rustdesk<span class="token operator">-</span>net
    <span class="token literal-property property">depends_on</span><span class="token operator">:</span>
      <span class="token operator">-</span> hbbr
    <span class="token literal-property property">restart</span><span class="token operator">:</span> unless<span class="token operator">-</span>stopped

  <span class="token literal-property property">hbbr</span><span class="token operator">:</span>
    <span class="token literal-property property">container_name</span><span class="token operator">:</span> hbbr
    <span class="token literal-property property">ports</span><span class="token operator">:</span>
      <span class="token operator">-</span> <span class="token number">21117</span><span class="token operator">:</span><span class="token number">21117</span>
      <span class="token operator">-</span> <span class="token number">21119</span><span class="token operator">:</span><span class="token number">21119</span>
    <span class="token literal-property property">image</span><span class="token operator">:</span> rustdesk<span class="token operator">/</span>rustdesk<span class="token operator">-</span>server<span class="token operator">:</span>latest
    <span class="token literal-property property">command</span><span class="token operator">:</span> hbbr <span class="token operator">-</span>k _
    <span class="token literal-property property">volumes</span><span class="token operator">:</span>
      <span class="token operator">-</span> <span class="token punctuation">.</span><span class="token operator">/</span>data<span class="token operator">:</span><span class="token operator">/</span>root
    <span class="token literal-property property">networks</span><span class="token operator">:</span>
      <span class="token operator">-</span> rustdesk<span class="token operator">-</span>net
    <span class="token literal-property property">restart</span><span class="token operator">:</span> unless<span class="token operator">-</span>stopped
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e2af7f118be79671f65e62ce943fda13/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">《最佳停止时间》：什么时候可以停止寻找？</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/5bc1a2a337bcbd4abefa28a951627e50/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Impala常用函数</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>