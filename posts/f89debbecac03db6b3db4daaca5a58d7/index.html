<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【大数据】Hive_DDL、DML - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【大数据】Hive_DDL、DML" />
<meta property="og:description" content="文章目录 一、DDL数据定义1. 数据库1.1 创建数据库1.2 查询数据库1.3 修改数据库1.4 删除数据库1.5 切换当前数据库 2. 表（table）2.1 创建表2.1.1 普通建表2.1.2 Create Table As Select（CTAS）建表2.1.3 Create Table Like建表2.1.4案例 2.2 查看表2.3 修改表2.4 删除表2.5 清空表 二、DML数据操作1. Load2. Insert2.1 将查询结果插入表中2.2 将给定Values插入表中2.3 将查询结果写入目标路径 3. Export&amp;Import 一、DDL数据定义 1. 数据库 1.1 创建数据库 （1）语法
CREATE DATABASE [IF NOT EXISTS] database_name [COMMENT database_comment] [LOCATION hdfs_path] [WITH DBPROPERTIES (property_name=property_value, ...)]; （2）案例
-- 创建一个数据库，不指定路径 create database db_hive1; -- 创建一个数据库，指定路径 create database db_hive2 location &#39;/db_hive2&#39;; -- 创建一个数据库，带有dbproperties create database db_hive3 with dbproperties(&#39;create_date&#39;=&#39;2023-9-22&#39;); 若不指定路径，其默认路径为${hive." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/f89debbecac03db6b3db4daaca5a58d7/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-09-29T18:10:39+08:00" />
<meta property="article:modified_time" content="2023-09-29T18:10:39+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【大数据】Hive_DDL、DML</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <p></p> 
 <div class="toc"> 
  <h4>文章目录</h4> 
  <ul><li><a href="#DDL_2" rel="nofollow">一、DDL数据定义</a></li><li><ul><li><a href="#1__3" rel="nofollow">1. 数据库</a></li><li><ul><li><a href="#11__4" rel="nofollow">1.1 创建数据库</a></li><li><a href="#12__27" rel="nofollow">1.2 查询数据库</a></li><li><a href="#13__57" rel="nofollow">1.3 修改数据库</a></li><li><a href="#14__79" rel="nofollow">1.4 删除数据库</a></li><li><a href="#15__98" rel="nofollow">1.5 切换当前数据库</a></li></ul> 
    </li><li><a href="#2_table_104" rel="nofollow">2. 表（table）</a></li><li><ul><li><a href="#21__105" rel="nofollow">2.1 创建表</a></li><li><ul><li><a href="#211__106" rel="nofollow">2.1.1 普通建表</a></li><li><a href="#212_Create_Table_As_SelectCTAS_165" rel="nofollow">2.1.2 Create Table As Select（CTAS）建表</a></li><li><a href="#213_Create_Table_Like_178" rel="nofollow">2.1.3 Create Table Like建表</a></li><li><a href="#214_190" rel="nofollow">2.1.4案例</a></li></ul> 
     </li><li><a href="#22__314" rel="nofollow">2.2 查看表</a></li><li><a href="#23__347" rel="nofollow">2.3 修改表</a></li><li><a href="#24__389" rel="nofollow">2.4 删除表</a></li><li><a href="#25__401" rel="nofollow">2.5 清空表</a></li></ul> 
   </li></ul> 
   </li><li><a href="#DML_415" rel="nofollow">二、DML数据操作</a></li><li><ul><li><a href="#1_Load_416" rel="nofollow">1. Load</a></li><li><a href="#2_Insert_428" rel="nofollow">2. Insert</a></li><li><ul><li><a href="#21__429" rel="nofollow">2.1 将查询结果插入表中</a></li><li><a href="#22_Values_460" rel="nofollow">2.2 将给定Values插入表中</a></li><li><a href="#23__472" rel="nofollow">2.3 将查询结果写入目标路径</a></li></ul> 
    </li><li><a href="#3_ExportImport_487" rel="nofollow">3. Export&amp;Import</a></li></ul> 
  </li></ul> 
 </div> 
 <p></p> 
</blockquote> 
<h2><a id="DDL_2"></a>一、DDL数据定义</h2> 
<h3><a id="1__3"></a>1. 数据库</h3> 
<h4><a id="11__4"></a>1.1 创建数据库</h4> 
<p>（1）语法</p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> <span class="token punctuation">[</span><span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span><span class="token punctuation">]</span> database_name
<span class="token punctuation">[</span><span class="token keyword">COMMENT</span> database_comment<span class="token punctuation">]</span>
<span class="token punctuation">[</span>LOCATION hdfs_path<span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token keyword">WITH</span> DBPROPERTIES <span class="token punctuation">(</span>property_name<span class="token operator">=</span>property_value<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> 
<p>（2）案例</p> 
<pre><code class="prism language-sql"><span class="token comment">-- 创建一个数据库，不指定路径</span>
<span class="token keyword">create</span> <span class="token keyword">database</span> db_hive1<span class="token punctuation">;</span>
<span class="token comment">-- 创建一个数据库，指定路径</span>
<span class="token keyword">create</span> <span class="token keyword">database</span> db_hive2 location <span class="token string">'/db_hive2'</span><span class="token punctuation">;</span>
<span class="token comment">-- 创建一个数据库，带有dbproperties</span>
<span class="token keyword">create</span> <span class="token keyword">database</span> db_hive3 <span class="token keyword">with</span> dbproperties<span class="token punctuation">(</span><span class="token string">'create_date'</span><span class="token operator">=</span><span class="token string">'2023-9-22'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<blockquote> 
 <p>若不指定路径，其默认路径为<code>${hive.metastore.warehouse.dir}/database_name.db</code></p> 
</blockquote> 
<h4><a id="12__27"></a>1.2 查询数据库</h4> 
<p>（1）展示所有数据库</p> 
<pre><code class="prism language-sql"><span class="token keyword">SHOW</span> <span class="token keyword">DATABASES</span> <span class="token punctuation">[</span><span class="token operator">LIKE</span> <span class="token string">'identifier_with_wildcards'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> 
<blockquote> 
 <p>like通配表达式说明：*表示任意个任意字符，|表示或的关系。</p> 
</blockquote> 
<p>案例</p> 
<pre><code class="prism language-sql"><span class="token keyword">show</span> <span class="token keyword">databases</span> <span class="token operator">like</span> <span class="token string">'db_hive*'</span><span class="token punctuation">;</span>
</code></pre> 
<p>（2）查看数据库信息</p> 
<pre><code class="prism language-sql"><span class="token keyword">DESCRIBE</span> <span class="token keyword">DATABASE</span> <span class="token punctuation">[</span><span class="token keyword">EXTENDED</span><span class="token punctuation">]</span> db_name<span class="token punctuation">;</span>
</code></pre> 
<p>案例</p> 
<pre><code class="prism language-sql"><span class="token comment">-- 查看基本信息</span>
<span class="token keyword">desc</span> <span class="token keyword">database</span> db_hive3<span class="token punctuation">;</span>
<span class="token comment">-- 查看更多信息</span>
<span class="token keyword">desc</span> <span class="token keyword">database</span> <span class="token keyword">extended</span> db_hive3<span class="token punctuation">;</span>
</code></pre> 
<h4><a id="13__57"></a>1.3 修改数据库</h4> 
<blockquote> 
 <p>用户可以使用alter database命令修改数据库某些信息，其中能够修改的信息包括dbproperties、location、owner user。需要注意的是：修改数据库location，不会改变当前已有表的路径信息，而只是改变后续创建的新表的默认的父目录。</p> 
</blockquote> 
<p>（1）语法</p> 
<pre><code class="prism language-sql"><span class="token comment">--修改dbproperties</span>
<span class="token keyword">ALTER</span> <span class="token keyword">DATABASE</span> database_name <span class="token keyword">SET</span> DBPROPERTIES <span class="token punctuation">(</span>property_name<span class="token operator">=</span>property_value<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">--修改location</span>
<span class="token keyword">ALTER</span> <span class="token keyword">DATABASE</span> database_name <span class="token keyword">SET</span> LOCATION hdfs_path<span class="token punctuation">;</span>
<span class="token comment">--修改owner user</span>
<span class="token keyword">ALTER</span> <span class="token keyword">DATABASE</span> database_name <span class="token keyword">SET</span> OWNER <span class="token keyword">USER</span> user_name<span class="token punctuation">;</span>
</code></pre> 
<p>（2）案例</p> 
<pre><code class="prism language-sql"><span class="token comment">--修改dbproperties</span>
<span class="token keyword">ALTER</span> <span class="token keyword">DATABASE</span> db_hive3 <span class="token keyword">SET</span> DBPROPERTIES <span class="token punctuation">(</span><span class="token string">'create_date'</span><span class="token operator">=</span><span class="token string">'2023-11-20'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="14__79"></a>1.4 删除数据库</h4> 
<p>（1）语法</p> 
<pre><code class="prism language-sql"><span class="token keyword">DROP</span> <span class="token keyword">DATABASE</span> <span class="token punctuation">[</span><span class="token keyword">IF</span> <span class="token keyword">EXISTS</span><span class="token punctuation">]</span> database_name <span class="token punctuation">[</span><span class="token keyword">RESTRICT</span><span class="token operator">|</span><span class="token keyword">CASCADE</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> 
<blockquote> 
 <ul><li>RESTRICT：严格模式，若数据库不为空，则会删除失败，默认为该模式。</li><li>CASCADE：级联模式，若数据库不为空，则会将库中的表一并删除。</li></ul> 
</blockquote> 
<p>（2）案例</p> 
<pre><code class="prism language-sql"><span class="token comment">--删除空数据库</span>
<span class="token keyword">drop</span> <span class="token keyword">database</span> db_hive2<span class="token punctuation">;</span>
<span class="token comment">--删除非空数据库</span>
<span class="token keyword">drop</span> <span class="token keyword">database</span> db_hive3 <span class="token keyword">cascade</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="15__98"></a>1.5 切换当前数据库</h4> 
<pre><code class="prism language-sql"><span class="token keyword">USE</span> database_name<span class="token punctuation">;</span>
</code></pre> 
<h3><a id="2_table_104"></a>2. 表（table）</h3> 
<h4><a id="21__105"></a>2.1 创建表</h4> 
<h5><a id="211__106"></a>2.1.1 普通建表</h5> 
<p>（1）语法</p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token punctuation">[</span><span class="token keyword">TEMPORARY</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>EXTERNAL<span class="token punctuation">]</span> <span class="token keyword">TABLE</span> <span class="token punctuation">[</span><span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>db_name<span class="token punctuation">.</span><span class="token punctuation">]</span>table_name   
<span class="token punctuation">[</span><span class="token punctuation">(</span>col_name data_type <span class="token punctuation">[</span><span class="token keyword">COMMENT</span> col_comment<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token keyword">COMMENT</span> table_comment<span class="token punctuation">]</span>
<span class="token punctuation">[</span>PARTITIONED <span class="token keyword">BY</span> <span class="token punctuation">(</span>col_name data_type <span class="token punctuation">[</span><span class="token keyword">COMMENT</span> col_comment<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token keyword">CLUSTERED</span> <span class="token keyword">BY</span> <span class="token punctuation">(</span>col_name<span class="token punctuation">,</span> col_name<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> 
<span class="token punctuation">[</span>SORTED <span class="token keyword">BY</span> <span class="token punctuation">(</span>col_name <span class="token punctuation">[</span><span class="token keyword">ASC</span><span class="token operator">|</span><span class="token keyword">DESC</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">INTO</span> num_buckets BUCKETS<span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token keyword">ROW</span> FORMAT row_format<span class="token punctuation">]</span> 
<span class="token punctuation">[</span>STORED <span class="token keyword">AS</span> file_format<span class="token punctuation">]</span>
<span class="token punctuation">[</span>LOCATION hdfs_path<span class="token punctuation">]</span>
<span class="token punctuation">[</span>TBLPROPERTIES <span class="token punctuation">(</span>property_name<span class="token operator">=</span>property_value<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
</code></pre> 
<p>（2）关键字说明：</p> 
<ul><li>TEMPORARY<br> 临时表，该表只在当前会话可见，会话结束，表会被删除。</li><li>EXTERNAL（重点）<br> 外部表，与之相对应的是内部表（管理表）。管理表意味着Hive会完全接管该表，包括元数据和HDFS中的数据。而外部表则意味着Hive只接管元数据，而不完全接管HDFS中的数据。</li><li>data_type（重点）<br> Hive中的字段类型可分为基本数据类型和复杂数据类型。<br> <img src="https://images2.imgbox.com/24/f9/iPsosxYe_o.png" alt="在这里插入图片描述"></li></ul> 
<p><img src="https://images2.imgbox.com/f9/12/kE5mTZrq_o.png" alt="在这里插入图片描述"></p> 
<ul><li>PARTITIONED BY（重点）<br> 创建分区表</li><li>CLUSTERED BY … SORTED BY…INTO … BUCKETS（重点）<br> 创建分桶表</li><li>ROW FORMAT（重点）<br> 指定SERDE，SERDE是Serializer and Deserializer的简写。Hive使用SERDE序列化和反序列化每行数据。详情可参考 Hive-Serde。语法说明如下：</li></ul> 
<pre><code class="prism language-sql"><span class="token comment">--DELIMITED关键字表示对文件中的每个字段按照特定分割符进行分割，其会使用默认的SERDE对每行数据进行序列化和反序列化。</span>
<span class="token keyword">ROW</span> FORAMT DELIMITED 
<span class="token punctuation">[</span><span class="token keyword">FIELDS</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token keyword">char</span><span class="token punctuation">]</span> 
<span class="token punctuation">[</span>COLLECTION ITEMS <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token keyword">char</span><span class="token punctuation">]</span> 
<span class="token punctuation">[</span>MAP <span class="token keyword">KEYS</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token keyword">char</span><span class="token punctuation">]</span> 
<span class="token punctuation">[</span><span class="token keyword">LINES</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token keyword">char</span><span class="token punctuation">]</span> 
<span class="token punctuation">[</span><span class="token boolean">NULL</span> DEFINED <span class="token keyword">AS</span> <span class="token keyword">char</span><span class="token punctuation">]</span>

<span class="token comment">--SERDE关键字可用于指定其他内置的SERDE或者用户自定义的SERDE。例如JSON SERDE，可用于处理JSON字符串。</span>
<span class="token keyword">ROW</span> FORMAT SERDE serde_name <span class="token punctuation">[</span><span class="token keyword">WITH</span> SERDEPROPERTIES <span class="token punctuation">(</span>property_name<span class="token operator">=</span>property_value<span class="token punctuation">,</span>property_name<span class="token operator">=</span>property_value<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">]</span> 
</code></pre> 
<blockquote> 
 <ul><li>fields terminated by ：列分隔符</li><li>collection items terminated by ： map、struct和array中每个元素之间的分隔符</li><li>map keys terminated by ：map中的key与value的分隔符</li><li>lines terminated by ：行分隔符</li></ul> 
</blockquote> 
<ul><li>STORED AS（重点）<br> 指定文件格式，常用的文件格式有，textfile（默认值），sequence file，orc file、parquet file等等。</li><li>LOCATION<br> 指定表所对应的HDFS路径，若不指定路径，其默认值为<br> ${hive.metastore.warehouse.dir}/db_name.db/table_name</li><li>TBLPROPERTIES<br> 用于配置表的一些KV键值对参数</li></ul> 
<h5><a id="212_Create_Table_As_SelectCTAS_165"></a>2.1.2 Create Table As Select（CTAS）建表</h5> 
<p>该语法允许用户利用select查询语句返回的结果，直接建表，表的结构和查询语句的结构保持一致，且保证包含select查询语句放回的内容。</p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token punctuation">[</span><span class="token keyword">TEMPORARY</span><span class="token punctuation">]</span> <span class="token keyword">TABLE</span> <span class="token punctuation">[</span><span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span><span class="token punctuation">]</span> table_name 
<span class="token punctuation">[</span><span class="token keyword">COMMENT</span> table_comment<span class="token punctuation">]</span> 
<span class="token punctuation">[</span><span class="token keyword">ROW</span> FORMAT row_format<span class="token punctuation">]</span> 
<span class="token punctuation">[</span>STORED <span class="token keyword">AS</span> file_format<span class="token punctuation">]</span> 
<span class="token punctuation">[</span>LOCATION hdfs_path<span class="token punctuation">]</span>
<span class="token punctuation">[</span>TBLPROPERTIES <span class="token punctuation">(</span>property_name<span class="token operator">=</span>property_value<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token keyword">AS</span> select_statement<span class="token punctuation">]</span>
</code></pre> 
<h5><a id="213_Create_Table_Like_178"></a>2.1.3 Create Table Like建表</h5> 
<p>该语法允许用户复刻一张已经存在的表结构，与上述的CTAS语法不同，该语法创建出来的表中不包含数据。</p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token punctuation">[</span><span class="token keyword">TEMPORARY</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>EXTERNAL<span class="token punctuation">]</span> <span class="token keyword">TABLE</span> <span class="token punctuation">[</span><span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>db_name<span class="token punctuation">.</span><span class="token punctuation">]</span>table_name
<span class="token punctuation">[</span><span class="token operator">LIKE</span> exist_table_name<span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token keyword">ROW</span> FORMAT row_format<span class="token punctuation">]</span> 
<span class="token punctuation">[</span>STORED <span class="token keyword">AS</span> file_format<span class="token punctuation">]</span> 
<span class="token punctuation">[</span>LOCATION hdfs_path<span class="token punctuation">]</span>
<span class="token punctuation">[</span>TBLPROPERTIES <span class="token punctuation">(</span>property_name<span class="token operator">=</span>property_value<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
</code></pre> 
<h5><a id="214_190"></a>2.1.4案例</h5> 
<p>（1）内部表</p> 
<blockquote> 
 <p>Hive中默认创建的表都是的内部表，有时也被称为管理表。对于内部表，Hive会完全管理表的元数据和数据文件。</p> 
</blockquote> 
<p>创建内部表如下：</p> 
<pre><code class="prism language-sql"><span class="token keyword">create</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token operator">not</span> <span class="token keyword">exists</span> student<span class="token punctuation">(</span>
    id <span class="token keyword">int</span><span class="token punctuation">,</span> 
    name string
<span class="token punctuation">)</span>
<span class="token keyword">row</span> format delimited <span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">'\t'</span>
location <span class="token string">'/user/hive/warehouse/student'</span><span class="token punctuation">;</span>
</code></pre> 
<p>准备其需要的文件如下，注意字段之间的分隔符。</p> 
<pre><code class="prism language-sql">vim <span class="token operator">/</span>opt<span class="token operator">/</span>module<span class="token operator">/</span>datas<span class="token operator">/</span>student<span class="token punctuation">.</span>txt

<span class="token number">1001</span>	student1
<span class="token number">1002</span>	student2
<span class="token number">1003</span>	student3
<span class="token number">1004</span>	student4
<span class="token number">1005</span>	student5
<span class="token number">1006</span>	student6
<span class="token number">1007</span>	student7
<span class="token number">1008</span>	student8
<span class="token number">1009</span>	student9
<span class="token number">1010</span>	student10
<span class="token number">1011</span>	student11
<span class="token number">1012</span>	student12
<span class="token number">1013</span>	student13
<span class="token number">1014</span>	student14
<span class="token number">1015</span>	student15
<span class="token number">1016</span>	student16
<span class="token comment">--上传文件到Hive表指定的路径</span>
hadoop fs <span class="token operator">-</span>put student<span class="token punctuation">.</span>txt <span class="token operator">/</span><span class="token keyword">user</span><span class="token operator">/</span>hive<span class="token operator">/</span>warehouse<span class="token operator">/</span>student
<span class="token comment">--删除表，观察数据HDFS中的数据文件是否还在</span>
hive <span class="token punctuation">(</span><span class="token keyword">default</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token keyword">drop</span> <span class="token keyword">table</span> student<span class="token punctuation">;</span>
</code></pre> 
<blockquote> 
 <p>当我们删除一个内部表时，Hive也会删除这个表中的数据。内部表不适合和其他工具共享数据。即：Mysql元数据库中的元数据信息、Hdfs上的数据文件夹和数据文件都会被删除。</p> 
</blockquote> 
<p>（2）外部表</p> 
<blockquote> 
 <p>外部表通常可用于处理其他工具上传的数据文件，对于外部表，Hive只负责管理元数据，不负责管理HDFS中的数据文件。</p> 
</blockquote> 
<p>创建外部表如下：</p> 
<pre><code class="prism language-sql"><span class="token keyword">create</span> external <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token operator">not</span> <span class="token keyword">exists</span> student<span class="token punctuation">(</span>
    id <span class="token keyword">int</span><span class="token punctuation">,</span> 
    name string
<span class="token punctuation">)</span>
<span class="token keyword">row</span> format delimited <span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">'\t'</span>
location <span class="token string">'/user/hive/warehouse/student'</span><span class="token punctuation">;</span>

<span class="token comment">--上传文件到Hive表指定的路径</span>
hadoop fs <span class="token operator">-</span>put student<span class="token punctuation">.</span>txt <span class="token operator">/</span><span class="token keyword">user</span><span class="token operator">/</span>hive<span class="token operator">/</span>warehouse<span class="token operator">/</span>student
<span class="token comment">--删除表，观察数据HDFS中的数据文件是否还在</span>
hive <span class="token punctuation">(</span><span class="token keyword">default</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token keyword">drop</span> <span class="token keyword">table</span> student<span class="token punctuation">;</span>
</code></pre> 
<blockquote> 
 <p>删除该表并不会删除掉这份数据，不过描述表的元数据信息会被删除掉。也即：只删除 Mysql 元数据库中存储的元数据信息，不删除 hdfs 上的数据文件内容。</p> 
</blockquote> 
<p>（3）SERDE和复杂数据类型<br> 若现有如下格式的JSON文件需要由Hive进行分析处理，请考虑如何设计表？以下内容为格式化之后的结果，文件中每行数据为一个完整的JSON字符串。</p> 
<pre><code class="prism language-sql">{
    <span class="token string">"name"</span>: <span class="token string">"dasongsong"</span><span class="token punctuation">,</span>
    <span class="token string">"friends"</span>: <span class="token punctuation">[</span>
        <span class="token string">"bingbing"</span><span class="token punctuation">,</span>
        <span class="token string">"lili"</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">"students"</span>: {
        <span class="token string">"xiaohaihai"</span>: <span class="token number">18</span><span class="token punctuation">,</span>
        <span class="token string">"xiaoyangyang"</span>: <span class="token number">16</span>
    }<span class="token punctuation">,</span>
    <span class="token string">"address"</span>: {
        <span class="token string">"street"</span>: <span class="token string">"hui long guan"</span><span class="token punctuation">,</span>
        <span class="token string">"city"</span>: <span class="token string">"beijing"</span><span class="token punctuation">,</span>
        <span class="token string">"postal_code"</span>: <span class="token number">10010</span>
    }
}
</code></pre> 
<p>我们可以考虑使用专门负责JSON文件的JSON Serde，设计表字段时，表的字段与JSON字符串中的一级字段保持一致，对于具有嵌套结构的JSON字符串，考虑使用合适复杂数据类型保存其内容。最终设计出的表结构如下：</p> 
<pre><code class="prism language-sql"><span class="token keyword">create</span> <span class="token keyword">table</span> teacher
<span class="token punctuation">(</span>
    name     string<span class="token punctuation">,</span>
    friends  array<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span><span class="token punctuation">,</span>
    students map<span class="token operator">&lt;</span>string<span class="token punctuation">,</span><span class="token keyword">int</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    address  struct<span class="token operator">&lt;</span>city:string<span class="token punctuation">,</span>street:string<span class="token punctuation">,</span>postal_code:<span class="token keyword">int</span><span class="token operator">&gt;</span>
<span class="token punctuation">)</span>
<span class="token keyword">row</span> format serde <span class="token string">'org.apache.hadoop.hive.serde2.JsonSerDe'</span>
location <span class="token string">'/user/hive/warehouse/teacher'</span><span class="token punctuation">;</span>
</code></pre> 
<p>创建该表，并准备以下文件。注意，需要确保文件中每行数据都是一个完整的JSON字符串，JSON SERDE才能正确的处理。</p> 
<pre><code class="prism language-sql">vim <span class="token operator">/</span>opt<span class="token operator">/</span>module<span class="token operator">/</span>datas<span class="token operator">/</span>teacher<span class="token punctuation">.</span>txt

{<!-- --><span class="token string">"name"</span>:<span class="token string">"dasongsong"</span><span class="token punctuation">,</span><span class="token string">"friends"</span>:<span class="token punctuation">[</span><span class="token string">"bingbing"</span><span class="token punctuation">,</span><span class="token string">"lili"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">"students"</span>:{<!-- --><span class="token string">"xiaohaihai"</span>:<span class="token number">18</span><span class="token punctuation">,</span><span class="token string">"xiaoyangyang"</span>:<span class="token number">16</span>}<span class="token punctuation">,</span><span class="token string">"address"</span>:{<!-- --><span class="token string">"street"</span>:<span class="token string">"hui long guan"</span><span class="token punctuation">,</span><span class="token string">"city"</span>:<span class="token string">"beijing"</span><span class="token punctuation">,</span><span class="token string">"postal_code"</span>:<span class="token number">10010</span>}}
<span class="token comment">--上传文件到Hive表指定的路径</span>
hadoop fs <span class="token operator">-</span>put teacher<span class="token punctuation">.</span>txt <span class="token operator">/</span><span class="token keyword">user</span><span class="token operator">/</span>hive<span class="token operator">/</span>warehouse<span class="token operator">/</span>teacher
</code></pre> 
<p>（4）create table as select 和 create table like</p> 
<pre><code class="prism language-sql"><span class="token comment">--create table as select</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> teacher1 <span class="token keyword">as</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> teacher<span class="token punctuation">;</span>

<span class="token comment">--create table like</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> teacher2 <span class="token operator">like</span> teacher<span class="token punctuation">;</span>
</code></pre> 
<h4><a id="22__314"></a>2.2 查看表</h4> 
<p>（1）展示所有表</p> 
<pre><code class="prism language-sql"><span class="token keyword">SHOW</span> <span class="token keyword">TABLES</span> <span class="token punctuation">[</span><span class="token operator">IN</span> database_name<span class="token punctuation">]</span> <span class="token operator">LIKE</span> <span class="token punctuation">[</span><span class="token string">'identifier_with_wildcards'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> 
<blockquote> 
 <p>like通配表达式说明：*表示任意个任意字符，|表示或的关系。</p> 
</blockquote> 
<p>案例</p> 
<pre><code class="prism language-sql"><span class="token keyword">show</span> <span class="token keyword">tables</span> <span class="token operator">like</span> <span class="token string">'stu*'</span><span class="token punctuation">;</span>
</code></pre> 
<p>（2）查看表信息</p> 
<pre><code class="prism language-sql"><span class="token keyword">DESCRIBE</span> <span class="token punctuation">[</span><span class="token keyword">EXTENDED</span> <span class="token operator">|</span> FORMATTED<span class="token punctuation">]</span> <span class="token punctuation">[</span>db_name<span class="token punctuation">.</span><span class="token punctuation">]</span>table_name
</code></pre> 
<blockquote> 
 <ul><li>EXTENDED：展示详细信息</li><li>FORMATTED：对详细信息进行格式化的展示</li></ul> 
</blockquote> 
<p>案例</p> 
<pre><code class="prism language-sql"><span class="token operator">-</span> 查看基本信息
<span class="token keyword">desc</span> stu<span class="token punctuation">;</span>
<span class="token operator">-</span> 查看更多信息
<span class="token keyword">desc</span> formatted stu<span class="token punctuation">;</span>
</code></pre> 
<h4><a id="23__347"></a>2.3 修改表</h4> 
<p>（1）重命名表</p> 
<pre><code class="prism language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> table_name <span class="token keyword">RENAME</span> <span class="token keyword">TO</span> new_table_name
</code></pre> 
<p>案例</p> 
<pre><code class="prism language-sql"><span class="token keyword">alter</span> <span class="token keyword">table</span> stu <span class="token keyword">rename</span> <span class="token keyword">to</span> stu1<span class="token punctuation">;</span>
</code></pre> 
<p>（2）修改列信息</p> 
<pre><code class="prism language-sql"><span class="token comment">--增加列（该语句允许用户增加新的列，新增列的位置位于末尾）</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> table_name <span class="token keyword">ADD</span> <span class="token keyword">COLUMNS</span> <span class="token punctuation">(</span>col_name data_type <span class="token punctuation">[</span><span class="token keyword">COMMENT</span> col_comment<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>

<span class="token comment">--更新列</span>
<span class="token comment">--该语句允许用户修改指定列的列名、数据类型、注释信息以及在表中的位置。</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> table_name CHANGE <span class="token punctuation">[</span><span class="token keyword">COLUMN</span><span class="token punctuation">]</span> col_old_name col_new_name column_type <span class="token punctuation">[</span><span class="token keyword">COMMENT</span> col_comment<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">FIRST</span><span class="token operator">|</span><span class="token keyword">AFTER</span> column_name<span class="token punctuation">]</span>

<span class="token comment">--替换列（该语句允许用户用新的列集替换表中原有的全部列）</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> table_name <span class="token keyword">REPLACE</span> <span class="token keyword">COLUMNS</span> <span class="token punctuation">(</span>col_name data_type <span class="token punctuation">[</span><span class="token keyword">COMMENT</span> col_comment<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
</code></pre> 
<p>案例</p> 
<pre><code class="prism language-sql"><span class="token comment">--查询表结构</span>
<span class="token keyword">desc</span> stu<span class="token punctuation">;</span>
<span class="token comment">--添加列</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span> stu <span class="token keyword">add</span> <span class="token keyword">columns</span><span class="token punctuation">(</span>age <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">--查询表结构</span>
<span class="token keyword">desc</span> stu<span class="token punctuation">;</span>
<span class="token comment">--更新列</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span> stu change <span class="token keyword">column</span> age ages <span class="token keyword">double</span><span class="token punctuation">;</span>
<span class="token comment">--替换列</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span> stu <span class="token keyword">replace</span> <span class="token keyword">columns</span><span class="token punctuation">(</span>id <span class="token keyword">int</span><span class="token punctuation">,</span> name string<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="24__389"></a>2.4 删除表</h4> 
<pre><code class="prism language-sql"><span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token punctuation">[</span><span class="token keyword">IF</span> <span class="token keyword">EXISTS</span><span class="token punctuation">]</span> table_name<span class="token punctuation">;</span>
</code></pre> 
<p>案例</p> 
<pre><code class="prism language-sql"><span class="token keyword">drop</span> <span class="token keyword">table</span> stu<span class="token punctuation">;</span>
</code></pre> 
<h4><a id="25__401"></a>2.5 清空表</h4> 
<pre><code class="prism language-sql"><span class="token keyword">TRUNCATE</span> <span class="token punctuation">[</span><span class="token keyword">TABLE</span><span class="token punctuation">]</span> table_name
</code></pre> 
<blockquote> 
 <p>注意：truncate只能清空管理表，不能删除外部表中数据。</p> 
</blockquote> 
<p>案例</p> 
<pre><code class="prism language-sql"><span class="token keyword">truncate</span> <span class="token keyword">table</span> student<span class="token punctuation">;</span>
</code></pre> 
<h2><a id="DML_415"></a>二、DML数据操作</h2> 
<h3><a id="1_Load_416"></a>1. Load</h3> 
<p>Load语句可将文件导入到Hive表中。</p> 
<pre><code class="prism language-sql"><span class="token keyword">LOAD</span> <span class="token keyword">DATA</span> <span class="token punctuation">[</span><span class="token keyword">LOCAL</span><span class="token punctuation">]</span> INPATH <span class="token string">'filepath'</span> <span class="token punctuation">[</span>OVERWRITE<span class="token punctuation">]</span> <span class="token keyword">INTO</span> <span class="token keyword">TABLE</span> tablename <span class="token punctuation">[</span><span class="token keyword">PARTITION</span> <span class="token punctuation">(</span>partcol1<span class="token operator">=</span>val1<span class="token punctuation">,</span> partcol2<span class="token operator">=</span>val2 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> 
<blockquote> 
 <p>关键字说明：<br> （1）local：表示从本地加载数据到Hive表；否则从HDFS加载数据到Hive表。<br> （2）overwrite：表示覆盖表中已有数据，否则表示追加。<br> （3）partition：表示上传到指定分区，若目标是分区表，需指定分区。</p> 
</blockquote> 
<h3><a id="2_Insert_428"></a>2. Insert</h3> 
<h4><a id="21__429"></a>2.1 将查询结果插入表中</h4> 
<pre><code class="prism language-sql"><span class="token keyword">INSERT</span> <span class="token punctuation">(</span><span class="token keyword">INTO</span> <span class="token operator">|</span> OVERWRITE<span class="token punctuation">)</span> <span class="token keyword">TABLE</span> tablename <span class="token punctuation">[</span><span class="token keyword">PARTITION</span> <span class="token punctuation">(</span>partcol1<span class="token operator">=</span>val1<span class="token punctuation">,</span> partcol2<span class="token operator">=</span>val2 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">]</span> select_statement<span class="token punctuation">;</span>
</code></pre> 
<blockquote> 
 <p>关键字说明：<br> （1）INTO：将结果追加到目标表<br> （2）OVERWRITE：用结果覆盖原有数据</p> 
</blockquote> 
<p>案例</p> 
<pre><code class="prism language-sql"><span class="token comment">--新建一张表</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> student1<span class="token punctuation">(</span>
    id <span class="token keyword">int</span><span class="token punctuation">,</span> 
    name string
<span class="token punctuation">)</span> 
<span class="token keyword">row</span> format delimited <span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">'\t'</span><span class="token punctuation">;</span>
<span class="token comment">--根据查询结果插入数据</span>
<span class="token keyword">insert</span> overwrite <span class="token keyword">table</span> student3 
<span class="token keyword">select</span> 
    id<span class="token punctuation">,</span> 
    name 
<span class="token keyword">from</span> student<span class="token punctuation">;</span>
</code></pre> 
<blockquote> 
 <p>注意：</p> 
 <ul><li>insert不支持插入部分字段；</li><li>insert 可以从A表插入A表，即允许insert into table A select * from A，可以替换其中某些字段，来避免使用update。</li></ul> 
</blockquote> 
<h4><a id="22_Values_460"></a>2.2 将给定Values插入表中</h4> 
<pre><code class="prism language-sql"><span class="token keyword">INSERT</span> <span class="token punctuation">(</span><span class="token keyword">INTO</span> <span class="token operator">|</span> OVERWRITE<span class="token punctuation">)</span> <span class="token keyword">TABLE</span> tablename <span class="token punctuation">[</span><span class="token keyword">PARTITION</span> <span class="token punctuation">(</span>partcol1<span class="token punctuation">[</span><span class="token operator">=</span>val1<span class="token punctuation">]</span><span class="token punctuation">,</span> partcol2<span class="token punctuation">[</span><span class="token operator">=</span>val2<span class="token punctuation">]</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">VALUES</span> values_row <span class="token punctuation">[</span><span class="token punctuation">,</span> values_row <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span>
</code></pre> 
<p>案例</p> 
<pre><code class="prism language-sql"><span class="token keyword">insert</span> <span class="token keyword">into</span> <span class="token keyword">table</span>  student1 <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'wangwu'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'zhaoliu'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="23__472"></a>2.3 将查询结果写入目标路径</h4> 
<pre><code class="prism language-sql"><span class="token keyword">INSERT</span> OVERWRITE <span class="token punctuation">[</span><span class="token keyword">LOCAL</span><span class="token punctuation">]</span> DIRECTORY directory
  <span class="token punctuation">[</span><span class="token keyword">ROW</span> FORMAT row_format<span class="token punctuation">]</span> <span class="token punctuation">[</span>STORED <span class="token keyword">AS</span> file_format<span class="token punctuation">]</span> select_statement<span class="token punctuation">;</span>
</code></pre> 
<p>案例</p> 
<pre><code class="prism language-sql"><span class="token keyword">insert</span> overwrite <span class="token keyword">local</span> directory <span class="token string">'/opt/module/datas/student'</span> 
<span class="token keyword">ROW</span> FORMAT SERDE <span class="token string">'org.apache.hadoop.hive.serde2.JsonSerDe'</span>
<span class="token keyword">select</span> id<span class="token punctuation">,</span>name <span class="token keyword">from</span> student<span class="token punctuation">;</span>
</code></pre> 
<h3><a id="3_ExportImport_487"></a>3. Export&amp;Import</h3> 
<blockquote> 
 <p>Export导出语句可将表的数据和元数据信息一并到处的HDFS路径，Import可将Export导出的内容导入Hive，表的数据和元数据信息都会恢复。Export和Import可用于两个Hive实例之间的数据迁移。</p> 
</blockquote> 
<p>（1）语法</p> 
<pre><code class="prism language-sql"><span class="token comment">--导出</span>
EXPORT <span class="token keyword">TABLE</span> tablename <span class="token keyword">TO</span> <span class="token string">'export_target_path'</span>

<span class="token comment">--导入</span>
<span class="token keyword">IMPORT</span> <span class="token punctuation">[</span>EXTERNAL<span class="token punctuation">]</span> <span class="token keyword">TABLE</span> new_or_original_tablename <span class="token keyword">FROM</span> <span class="token string">'source_path'</span> <span class="token punctuation">[</span>LOCATION <span class="token string">'import_target_path'</span><span class="token punctuation">]</span>
</code></pre> 
<p>（2）案例</p> 
<pre><code class="prism language-sql"><span class="token comment">--导出</span>
export <span class="token keyword">table</span> <span class="token keyword">default</span><span class="token punctuation">.</span>student <span class="token keyword">to</span> <span class="token string">'/user/hive/warehouse/export/student'</span><span class="token punctuation">;</span>

<span class="token comment">--导入</span>
<span class="token keyword">import</span> <span class="token keyword">table</span> student2 <span class="token keyword">from</span> <span class="token string">'/user/hive/warehouse/export/student'</span><span class="token punctuation">;</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/fe014c5a241a398fe90e562ec9229ca3/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">freertos中函数调用和启动第一个任务(栈相关!!!!!!）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f48e6703f449130278f87992da5b10f4/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">11-11 AEB 算法建模</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>