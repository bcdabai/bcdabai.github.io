<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ubuntu22.04&#43;cuda11.5&#43;gcc11.4第一个cuda程序示例 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="ubuntu22.04&#43;cuda11.5&#43;gcc11.4第一个cuda程序示例" />
<meta property="og:description" content="VisualStudio 2019是微软的集成开发环境(IDE)，通常在Windows操作系统上使用。然而，并不直接支持在Linux上安装。如果想在Ubuntu上进行开发，可以考虑以下几个选项:
使用替代的IDE或文本编辑器: Ubuntu上有许多适用于C&#43;&#43;等编程语言的开发工具，比如
Visual Studio Code、 Code.:Blocks、 Eclipse等。
使用虚拟机或容器: 如果你非常需要使用Visual Studio 2019，可以在Ubuntu上安装虚拟机软件(比如VirtualBox) 或容器平台(比如Docker) ，然后在虚拟机或容器中运行Windows，再在其中安装Visual Studio 2019。
使用Wine: Wine是一款允许在Linux上运行Windows应用程序的兼容层。你可以尝试使用Wine来安装和运行Visual Studio 2019，但请注意，并不是所有Windows应用程序都能在Wine下正常工作作。
使用双系统: 如果你需要长期在Linux上开发，但又需要使用VisualStudio 2019，可以考虑在计算机上设置双系统，一边运行Ubuntu，一边运行Windows
使用nano 文本编辑器创建文件，然后在终端中进行运行代码 gcc cuda example.cu -o cuda example/usr/bin/ld:cuda_example.cu: file format not recognized; treating as linker script/usr/bin/ld:cuda example.cu:5: syntax errorcollecto: error:ld returned i exit status 类似于上述错误信息，说明使用
~gcc尝试编译CUDA代码文件cuda_example.cu’，
但
~gcc无法直接编译CUDA代码。
CUDA代码需要使用NVIDIA的nvcc~编译器进行编译，因为它包含了CUDA特定的语法和功能。
编译运行CUDA代码，您需要使用NVIDIA的~nvce”编译器，而不是gcc”。
利用nvcc编译运行代码的步骤 示例代码如下
//本示例演示了如何使用 OpenMP API 为多个 GPU 编写应用程序 #include &lt;iostream&gt; #include &lt;omp.h&gt; #include &lt;stdio.h&gt; // 使用 stdio 函数，因为 C&#43;&#43; 流不一定是线程安全的 #define checkCudaErrors(err) __checkCudaErrors(err, __FILE__, __LINE__) inline void __checkCudaErrors(cudaError_t err, const char *file, int line) { if (err !" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/a1b7228495b5d2598a81a77582fdd33e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-08-13T17:17:59+08:00" />
<meta property="article:modified_time" content="2023-08-13T17:17:59+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ubuntu22.04&#43;cuda11.5&#43;gcc11.4第一个cuda程序示例</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><img src="https://images2.imgbox.com/20/37/J64nuFEH_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/1e/fa/W3THOLTr_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/34/42/MT9FfrLX_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>VisualStudio 2019是微软的集成开发环境(IDE)，通常在Windows操作系统上使用。然而，并不直接支持在Linux上安装。如果想在Ubuntu上进行开发，可以考虑以下几个选项:<br> 使用替代的IDE或文本编辑器: Ubuntu上有许多适用于C++等编程语言的开发工具，比如</p> 
 <blockquote> 
  <p>Visual Studio Code、 Code.:Blocks、 Eclipse等。</p> 
 </blockquote> 
 <blockquote> 
  <p>使用虚拟机或容器: 如果你非常需要使用Visual Studio 2019，可以在Ubuntu上安装虚拟机软件(比如VirtualBox) 或容器平台(比如Docker) ，然后在虚拟机或容器中运行Windows，再在其中安装Visual Studio 2019。</p> 
 </blockquote> 
 <blockquote> 
  <p>使用Wine: Wine是一款允许在Linux上运行Windows应用程序的兼容层。你可以尝试使用Wine来安装和运行Visual Studio 2019，但请注意，并不是所有Windows应用程序都能在Wine下正常工作作。</p> 
 </blockquote> 
 <blockquote> 
  <p>使用双系统: 如果你需要长期在Linux上开发，但又需要使用VisualStudio 2019，可以考虑在计算机上设置双系统，一边运行Ubuntu，一边运行Windows</p> 
 </blockquote> 
</blockquote> 
<h2><a id="nano__14"></a>使用nano 文本编辑器创建文件，然后在终端中进行运行代码</h2> 
<p><img src="https://images2.imgbox.com/08/fd/0mlkmUsX_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-c">gcc cuda example<span class="token punctuation">.</span>cu <span class="token operator">-</span>o cuda example<span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>ld<span class="token operator">:</span>cuda_example<span class="token punctuation">.</span>cu<span class="token operator">:</span> file format not recognized<span class="token punctuation">;</span> treating as linker script<span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>ld<span class="token operator">:</span>cuda example<span class="token punctuation">.</span>cu<span class="token operator">:</span><span class="token number">5</span><span class="token operator">:</span> syntax errorcollecto<span class="token operator">:</span> error<span class="token operator">:</span>ld returned i exit status
</code></pre> 
<p>类似于上述错误信息，说明使用<br> ~gcc尝试编译CUDA代码文件cuda_example.cu’，<br> 但<br> ~gcc无法直接编译CUDA代码。<br> CUDA代码需要使用NVIDIA的nvcc~编译器进行编译，因为它包含了CUDA特定的语法和功能。<br> 编译运行CUDA代码，您需要使用NVIDIA的~nvce”编译器，而不是gcc”。</p> 
<h3><a id="nvcc_26"></a>利用nvcc编译运行代码的步骤</h3> 
<p>示例代码如下</p> 
<pre><code class="prism language-c"><span class="token comment">//本示例演示了如何使用 OpenMP API 为多个 GPU 编写应用程序</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;omp.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span>  <span class="token comment">// 使用 stdio 函数，因为 C++ 流不一定是线程安全的</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">checkCudaErrors</span><span class="token expression"><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token function">__checkCudaErrors</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> <span class="token constant">__FILE__</span><span class="token punctuation">,</span> <span class="token constant">__LINE__</span><span class="token punctuation">)</span></span></span>

<span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">__checkCudaErrors</span><span class="token punctuation">(</span><span class="token class-name">cudaError_t</span> err<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>file<span class="token punctuation">,</span> <span class="token keyword">int</span> line<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err <span class="token operator">!=</span> cudaSuccess<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        std<span class="token operator">::</span>cerr <span class="token operator">&lt;&lt;</span> <span class="token string">"CUDA error at "</span> <span class="token operator">&lt;&lt;</span> file <span class="token operator">&lt;&lt;</span> <span class="token string">":"</span> <span class="token operator">&lt;&lt;</span> line <span class="token operator">&lt;&lt;</span> <span class="token string">" - "</span> <span class="token operator">&lt;&lt;</span> <span class="token function">cudaGetErrorString</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span>EXIT_FAILURE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

using namespace std<span class="token punctuation">;</span>

<span class="token comment">//一个简单的kernel，只需将每个数组元素递增 b</span>
__global__ <span class="token keyword">void</span> <span class="token function">kernelAddConstant</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span>g_a<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> idx <span class="token operator">=</span> blockIdx<span class="token punctuation">.</span>x <span class="token operator">*</span> blockDim<span class="token punctuation">.</span>x <span class="token operator">+</span> threadIdx<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
    g_a<span class="token punctuation">[</span>idx<span class="token punctuation">]</span> <span class="token operator">+=</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//用于检查每个数组元素是否被设置为其索引加上 b</span>
<span class="token keyword">int</span> <span class="token function">correctResult</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span>data<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">int</span> n<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!=</span> i <span class="token operator">+</span> b<span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> num_gpus <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>   <span class="token comment">// CUDA GPU 数量</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s Starting...\n\n"</span><span class="token punctuation">,</span> argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/</span>
   <span class="token comment">//确定支持 CUDA 的 GPU 数量</span>
    <span class="token function">cudaGetDeviceCount</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>num_gpus<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>num_gpus <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"no CUDA capable devices were detected\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/</span>
    <span class="token comment">//显示 CPU 和 GPU 配置</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"number of host CPUs:\t%d\n"</span><span class="token punctuation">,</span> <span class="token function">omp_get_num_procs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"number of CUDA devices:\t%d\n"</span><span class="token punctuation">,</span> num_gpus<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> num_gpus<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        cudaDeviceProp dprop<span class="token punctuation">;</span>
        <span class="token function">cudaGetDeviceProperties</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>dprop<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"   %d: %s\n"</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> dprop<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"---------------------------\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/</span>
    <span class="token comment">// initialize data</span>
    <span class="token comment">//</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> n <span class="token operator">=</span> num_gpus <span class="token operator">*</span> <span class="token number">8192</span><span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> nbytes <span class="token operator">=</span> n <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> <span class="token operator">*</span>a <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>     <span class="token comment">// // 指向 CPU 上数据的指针</span>
    <span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>      <span class="token comment">// 数组递增的值</span>
    a <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span>nbytes<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> a<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"couldn't allocate CPU memory\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span>


    <span class="token comment"></span>
<span class="token comment">// 运行与 CUDA 设备数量相同的 CPU 线程</span>
    <span class="token comment">//每个 CPU 线程控制不同的设备，处理各自的数据部分。 </span>
    <span class="token comment">// 使用的 CPU 线程数量有可能多于 CUDA 设备的数量，在这种情况下，多个 CPU 线程将在同一设备上分配资源并启动内核。</span>
    <span class="token comment">// 例如，尝试 omp_set_num_threads(2 * num_gpus); </span>
    <span class="token comment">// 请注意，在 "omparallel "作用域内声明的所有变量都是 是每个 CPU 线程的局部变量</span>
    <span class="token comment">//</span>
    <span class="token function">omp_set_num_threads</span><span class="token punctuation">(</span>num_gpus<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//创建与 CUDA 设备数量相同的 CPU 线程</span>
    <span class="token comment">//omp_set_num_threads(2*num_gpus);// 创建的 CPU 线程数量是 CUDA 设备数量的两倍</span>
    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">omp parallel</span></span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">unsigned</span> <span class="token keyword">int</span> cpu_thread_id <span class="token operator">=</span> <span class="token function">omp_get_thread_num</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">unsigned</span> <span class="token keyword">int</span> num_cpu_threads <span class="token operator">=</span> <span class="token function">omp_get_num_threads</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      
        <span class="token keyword">int</span> gpu_id <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token function">checkCudaErrors</span><span class="token punctuation">(</span><span class="token function">cudaSetDevice</span><span class="token punctuation">(</span>cpu_thread_id <span class="token operator">%</span> num_gpus<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   
        <span class="token function">checkCudaErrors</span><span class="token punctuation">(</span><span class="token function">cudaGetDevice</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>gpu_id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"CPU thread %d (of %d) uses CUDA device %d\n"</span><span class="token punctuation">,</span> cpu_thread_id<span class="token punctuation">,</span> num_cpu_threads<span class="token punctuation">,</span> gpu_id<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">int</span> <span class="token operator">*</span>d_a <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> 
        <span class="token keyword">int</span> <span class="token operator">*</span>sub_a <span class="token operator">=</span> a <span class="token operator">+</span> cpu_thread_id <span class="token operator">*</span> n <span class="token operator">/</span> num_cpu_threads<span class="token punctuation">;</span>  
        <span class="token keyword">unsigned</span> <span class="token keyword">int</span> nbytes_per_kernel <span class="token operator">=</span> nbytes <span class="token operator">/</span> num_cpu_threads<span class="token punctuation">;</span>
        dim3 <span class="token function">gpu_threads</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 128 threads per block</span>
        dim3 <span class="token function">gpu_blocks</span><span class="token punctuation">(</span>n <span class="token operator">/</span> <span class="token punctuation">(</span>gpu_threads<span class="token punctuation">.</span>x <span class="token operator">*</span> num_cpu_threads<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">checkCudaErrors</span><span class="token punctuation">(</span><span class="token function">cudaMalloc</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>d_a<span class="token punctuation">,</span> nbytes_per_kernel<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">checkCudaErrors</span><span class="token punctuation">(</span><span class="token function">cudaMemset</span><span class="token punctuation">(</span>d_a<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> nbytes_per_kernel<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">checkCudaErrors</span><span class="token punctuation">(</span><span class="token function">cudaMemcpy</span><span class="token punctuation">(</span>d_a<span class="token punctuation">,</span> sub_a<span class="token punctuation">,</span> nbytes_per_kernel<span class="token punctuation">,</span> cudaMemcpyHostToDevice<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        kernelAddConstant<span class="token operator">&lt;&lt;</span><span class="token operator">&lt;</span>gpu_blocks<span class="token punctuation">,</span> gpu_threads<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>d_a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>

         <span class="token function">checkCudaErrors</span><span class="token punctuation">(</span><span class="token function">cudaMemcpy</span><span class="token punctuation">(</span>sub_a<span class="token punctuation">,</span> d_a<span class="token punctuation">,</span> nbytes_per_kernel<span class="token punctuation">,</span> cudaMemcpyDeviceToHost<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">checkCudaErrors</span><span class="token punctuation">(</span><span class="token function">cudaFree</span><span class="token punctuation">(</span>d_a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"---------------------------\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>cudaSuccess <span class="token operator">!=</span> <span class="token function">cudaGetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s\n"</span><span class="token punctuation">,</span> <span class="token function">cudaGetErrorString</span><span class="token punctuation">(</span><span class="token function">cudaGetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment"></span>
    <span class="token comment">// check the result</span>
    <span class="token comment">//</span>
    bool bResult <span class="token operator">=</span> <span class="token function">correctResult</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> n<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">)</span>
        <span class="token function">free</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// free CPU memory</span>

    <span class="token function">exit</span><span class="token punctuation">(</span>bResult <span class="token operator">?</span> EXIT_SUCCESS <span class="token operator">:</span> EXIT_FAILURE<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> 
<ol><li>打开终端（快捷键，ctrl+alt+t）</li><li>进入CUDA代码文件所在的目录，即 ‘/home/lcr/try’</li></ol> 
<pre><code class="prism language-c">cd <span class="token operator">/</span>home<span class="token operator">/</span>lcr<span class="token operator">/</span>try
</code></pre> 
<p>3.使用nvcc编译CUDA代码文件，并生成可执行文件。运行以下命令:</p> 
<pre><code class="prism language-c">nvcc <span class="token operator">-</span>o example example<span class="token punctuation">.</span>cu
</code></pre> 
<p>nvcc命令中的-o选项用于指定<strong>输出文件名</strong>，而不是输入文件名。 以下是<strong>编译名为 example.cu 的 CUDA 源文件</strong>并在特定目录中 <em>生成名为 example 的可执行文件</em></p> 
<p>确保 -o 和输出文件路径之间包含空格。 该命令还应包含源代码文件 (example.cu) 和所需输出可执行文件 (/home/user/lcr/example) 的正确路径。</p> 
<p>如果是用open mp</p> 
<pre><code class="prism language-c">user@user<span class="token operator">-</span>SYS<span class="token operator">-</span><span class="token number">420</span>GP<span class="token operator">-</span>TNR<span class="token operator">:</span><span class="token operator">~</span><span class="token operator">/</span>lcr<span class="token operator">/</span>try$ nvcc <span class="token operator">-</span>o example example<span class="token punctuation">.</span>cu
<span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>ld<span class="token operator">:</span> <span class="token operator">/</span>tmp<span class="token operator">/</span>tmpxft_0015851b_00000000<span class="token operator">-</span><span class="token number">11</span>_example<span class="token punctuation">.</span>o<span class="token operator">:</span> in function `main'<span class="token operator">:</span>
tmpxft_0015851b_00000000<span class="token operator">-</span><span class="token number">6</span>_example<span class="token punctuation">.</span>cudafe1<span class="token punctuation">.</span>cpp<span class="token operator">:</span><span class="token punctuation">(</span><span class="token punctuation">.</span>text<span class="token operator">+</span><span class="token number">0xfa</span><span class="token punctuation">)</span><span class="token operator">:</span> undefined reference to `omp_get_num_procs'
<span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>ld<span class="token operator">:</span> tmpxft_0015851b_00000000<span class="token operator">-</span><span class="token number">6</span>_example<span class="token punctuation">.</span>cudafe1<span class="token punctuation">.</span>cpp<span class="token operator">:</span><span class="token punctuation">(</span><span class="token punctuation">.</span>text<span class="token operator">+</span><span class="token number">0x24f</span><span class="token punctuation">)</span><span class="token operator">:</span> undefined reference to `omp_set_num_threads'
<span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>ld<span class="token operator">:</span> tmpxft_0015851b_00000000<span class="token operator">-</span><span class="token number">6</span>_example<span class="token punctuation">.</span>cudafe1<span class="token punctuation">.</span>cpp<span class="token operator">:</span><span class="token punctuation">(</span><span class="token punctuation">.</span>text<span class="token operator">+</span><span class="token number">0x254</span><span class="token punctuation">)</span><span class="token operator">:</span> undefined reference to `omp_get_thread_num'
<span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>ld<span class="token operator">:</span> tmpxft_0015851b_00000000<span class="token operator">-</span><span class="token number">6</span>_example<span class="token punctuation">.</span>cudafe1<span class="token punctuation">.</span>cpp<span class="token operator">:</span><span class="token punctuation">(</span><span class="token punctuation">.</span>text<span class="token operator">+</span><span class="token number">0x25f</span><span class="token punctuation">)</span><span class="token operator">:</span> undefined reference to `omp_get_num_threads'
collect2<span class="token operator">:</span> error<span class="token operator">:</span> ld returned <span class="token number">1</span> exit status

</code></pre> 
<p>链接过程中找不到 omp_get_num_procs、omp_set_num_threads、omp_get_thread_num、omp_get_num_threads 这些函数的定义。这些函数属于 OpenMP 库，用于并行编程。在代码中可能使用了 OpenMP 的相关函数，但链接时找不到其定义。<br> 解决方法是，需要在链接时显式地添加 OpenMP 库。在使用 nvcc 进行链接时，可以通过 -Xcompiler 选项将链接参数传递给底层编译器（通常是 g++），以链接 OpenMP 库。<br> 尝试使用以下命令编译链接 CUDA C++ 代码，并添加 OpenMP 支持：</p> 
<pre><code class="prism language-c">nvcc <span class="token operator">-</span>o example example<span class="token punctuation">.</span>cu <span class="token operator">-</span>Xcompiler <span class="token operator">-</span>fopenmp
</code></pre> 
<p>这个命令会将 -fopenmp 选项传递给底层编译器，以链接 OpenMP 库<br> 4. 运行生成的可执行文件</p> 
<pre><code class="prism language-c"><span class="token punctuation">.</span><span class="token operator">/</span>example
</code></pre> 
<p>运行结果如下所示<br> <img src="https://images2.imgbox.com/54/32/CtNp7AMY_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_nvcc_o_example_examplecu_Xcompiler_fopenmp__200"></a>如果你使用 nvcc -o example example.cu -Xcompiler -fopenmp 成功编译了你的程序，但在运行时没有反应，可能有几个原因导致这种情况。以下是一些可能的解决方法：</h3> 
<ol><li> <p>检查代码逻辑和输出：首先，请确保你的 CUDA C++ 代码本身没有逻辑问题。你可以在代码中添加一些输出语句，以便你在运行程序时能够看到一些信息，帮助你确定程序是否在运行。</p> </li><li> <p>命令行运行：尝试在终端中运行你的可执行文件 example，看看是否有任何输出或错误消息。在终端中输入以下命令：<br> <code>./example</code><br> 如果程序需要输入参数，确保你提供了正确的参数。</p> </li><li> <p>查看CUDA运行时错误：在运行程序时，CUDA 运行时错误可能会导致程序崩溃或没有输出。你可以在终端中运行以下命令来检查 CUDA 运行时错误：</p> </li></ol> 
<pre><code class="prism language-c">cuda<span class="token operator">-</span>memcheck <span class="token punctuation">.</span><span class="token operator">/</span>example
</code></pre> 
<p>已经退出.cu所在文件下，为了确保使用正确的可执行文件路径来运行 cuda-memcheck。如果可执行文件名是 example，那么可以使用绝对路径来运行</p> 
<pre><code>cuda-memcheck /home/user/lcr/try/example
</code></pre> 
<p><code>./home/user/lcr/try/ </code>.是example文件的位置路径<br> <img src="https://images2.imgbox.com/ca/17/I7CU2xXP_o.png" alt="在这里插入图片描述"></p> 
<p>需要注意的是，cuda-memcheck 工具已经被官方标记为过时，推荐使用 compute-sanitizer 工具作为替代。</p> 
<h3><a id="computesanitizer_221"></a>compute-sanitizer</h3> 
<p>是 NVIDIA 提供的一个工具，用于检测 CUDA 应用程序中的内存问题、数据竞争等。下面是如何<strong>在 example.cu 文件上使用 compute-sanitizer 工具的基本步骤</strong>：</p> 
<ol><li> <p>确保已经安装了 CUDA Toolkit 12.0 或更高版本，因为 compute-sanitizer 是在这些版本中引入的。</p> </li><li> <p>打开终端，并切换到包含 example.cu 文件的目录。</p> </li><li> <p>使用以下命令编译 example.cu 文件，并在编译选项中添加 -fsanitize=compute 标志：</p> </li></ol> 
<pre><code class="prism language-c">nvcc <span class="token operator">-</span>o example example<span class="token punctuation">.</span>cu <span class="token operator">-</span>Xcompiler <span class="token operator">-</span>fopenmp <span class="token operator">-</span>fsanitize<span class="token operator">=</span>compute

</code></pre> 
<p>编译完成后，运行生成的可执行文件 <code>./example</code><br> 如果在程序中存在 CUDA 相关的问题，compute-sanitizer 会在运行时检测并报告这些问题。<br> 需要注意的是，compute-sanitizer 的使用方式可能会因为不同的 CUDA 版本和工具包而有所不同，具体的细节可以参考 NVIDIA 的官方文档或资源。在使用前，建议查阅相关文档以了解更多详细信息。</p> 
<h4><a id="example__computesanitizer__237"></a>在example 可执行文件上使用 compute-sanitizer 工具的步骤：</h4> 
<ol><li> <p>确保已经安装了 CUDA Toolkit 12.0 或更高版本，因为 compute-sanitizer 是在这些版本中引入的。</p> </li><li> <p>打开终端，并切换到包含 example 可执行文件的目录。</p> </li></ol> 
<p>使用以下命令运行 compute-sanitizer 工具，将你的 example 可执行文件作为参数传递：</p> 
<pre><code class="prism language-c">compute<span class="token operator">-</span>sanitizer <span class="token punctuation">.</span><span class="token operator">/</span>example

</code></pre> 
<p>compute-sanitizer 将会在运行时检测可执行文件中的 CUDA 相关问题，并输出相应的报告。</p> 
<h2><a id="_249"></a>一些问题</h2> 
<h5><a id="_CUDA__250"></a>使用以下命令来查找 CUDA 的安装路径</h5> 
<pre><code class="prism language-c">find <span class="token operator">/</span> <span class="token operator">-</span>name libsanitizer<span class="token operator">-</span>collection<span class="token punctuation">.</span>so

</code></pre> 
<p>将在整个系统中搜索 libsanitizer-collection.so 文件，一旦找到，就可以使用找到的路径来设置环境变量或者直接使用 compute-sanitizer 工具。请确保CUDA 安装已经正确完成，并且路径和文件都存在</p> 
<h5><a id="_libsanitizercollectionso__256"></a>找不到 libsanitizer-collection.so 文件。这可能是因为文件不存在或者路径不正确。</h5> 
<p>以下命令来查看 libsanitizer-collection.so 文件是否存在：</p> 
<pre><code class="prism language-c">ls <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>cuda<span class="token operator">/</span>extras<span class="token operator">/</span>CUPTI<span class="token operator">/</span>lib64<span class="token operator">/</span>libsanitizer<span class="token operator">-</span>collection<span class="token punctuation">.</span>so

</code></pre> 
<p>如果上述库文件存在，尝试将其目录添加到 LD_LIBRARY_PATH 环境变量中。在终端中运行以下命令：</p> 
<pre><code class="prism language-c">export LD_LIBRARY_PATH<span class="token operator">=</span><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>cuda<span class="token operator">/</span>extras<span class="token operator">/</span>CUPTI<span class="token operator">/</span>lib64<span class="token operator">:</span>$LD_LIBRARY_PATH

</code></pre> 
<p>然后再次尝试运行 compute-sanitizer</p> 
<pre><code class="prism language-c">find <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>cuda <span class="token operator">-</span>name libsanitizer<span class="token operator">-</span>collection<span class="token punctuation">.</span>so
</code></pre> 
<p>如果文件存在，你可以将路径添加到 LD_LIBRARY_PATH 环境变量中，然后尝试运行 compute-sanitizer。如果文件确实不存在，可能需要检查 CUDA 和 CUPTI 的安装是否完整。</p> 
<h2><a id="vscode_275"></a>vscode</h2> 
<h3><a id="cuda_ccudagdbcuda_ccudagdbservercuda_c_qnxcudagdbserver_276"></a>cuda c++(cuda-gdb),cuda c++(cuda-gdbserver),cuda c++ qnx(cuda-gdbserver),各自是做什么的，有什么作用，如何使用</h3> 
<p>CUDA C++（cuda-gdb）：<br> CUDA C++ 是 C++ 编程语言的扩展，允许开发人员编写可在传统 CPU 和 NVIDIA GPU 上执行的代码。 CUDA C++ 提供将计算卸载到 GPU 并利用并行性的功能。 cuda-gdb 是 CUDA 程序的 NVIDIA 调试器。 它允许您通过提供断点、观察点、单步执行代码、检查变量和分析内存使用情况等功能在 GPU 上调试 CUDA C++ 程序。</p> 
<p>CUDA C++（cuda-gdbserver）：<br> cuda-gdbserver 是用于远程调试场景的实用程序。 它允许您从单独的主机调试目标设备（例如嵌入式系统或具有 GPU 的远程计算机）上的 CUDA 应用程序。 cuda-gdbserver 在目标设备上运行，并与主机上的 cuda-gdb 通信，使您能够远程调试 CUDA 应用程序。</p> 
<p>CUDA C++ QNX（cuda-gdbserver）：<br> cuda-gdbserver for QNX 是 cuda-gdbserver 实用程序的一个版本，专门设计用于与 QNX 操作系统配合使用。 QNX 常用于嵌入式系统。 与标准 cuda-gdbserver 类似，该版本允许在 QNX 目标设备上远程调试 CUDA 应用程序。</p> 
<p>如何使用：</p> 
<p>CUDA C++（cuda-gdb）：</p> 
<p>安装 cuda-gdb 作为 CUDA 工具包的一部分。<br> 使用 nvcc 编译 CUDA C++ 程序。<br> 使用 cuda-gdb 命令，后跟编译的二进制文件来启动调试器：cuda-gdb my_program。<br> 使用 cuda-gdb 命令设置断点、运行程序、检查变量并分析内存使用情况。</p> 
<p>CUDA C++（cuda-gdbserver）：</p> 
<p>在目标设备上，安装并运行 cuda-gdbserver。<br> 在主机上，使用 nvcc 编译 CUDA C++ 程序。<br> 使用带有 --remote 标志的 cuda-gdb 命令连接到远程 cuda-gdbserver：cuda-gdb --remote=target:port my_program。<br> 调试远程 CUDA 程序，就像它在主机上运行一样。</p> 
<p>CUDA C++ QNX（cuda-gdbserver）：</p> 
<p>请遵循与 cuda-gdbserver 相同的步骤，但请确保您拥有与 QNX 目标设备兼容的 QNX 版本的 cuda-gdbserver。<br> 使用带有 --remote 标志的 cuda-gdb 命令，指定 QNX 目标：cuda-gdb --remote=qnx:port my_program。<br> 请记住，使用 cuda-gdb 和 cuda-gdbserver 等调试工具需要熟悉调试概念和 CUDA 编程。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ccd84e82bf56e52eeef258ee0f0c7570/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">数仓建设规范</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a212f16aa2d0fe0bde0547244679372e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">网络基础(一)桥接网络</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>