<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>LINUX - EFK（elastic &#43; filebeat &#43; kibana）日志审计系统小白构建过程 日记 手册 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="LINUX - EFK（elastic &#43; filebeat &#43; kibana）日志审计系统小白构建过程 日记 手册" />
<meta property="og:description" content="由于领导要求让我研究 efk 日志审计系统。我之前从未接触过，所以写这一篇文章作为研究和搭建过程的笔记 供自己以后参考，其中记录了我搭建过程中的遇到的各种问题，以及解决办法 包括常用到的指令。
一. 准备阶段 1.准备好elasticsearch ，filebeat ，kibana 的压缩文件（网上下载），并下载好Xftp用于文件上传，Centos镜像文件并用VMware创建虚拟机 （注意elastic，filebeat，kibana的版本号要一样 如下图版本号均为-7.3.1 避免发生兼容性问题）
2.VMware16创建虚拟机 （本人之前没怎么接触过 摸索【百度】了很久，会的这里可以跳过不看） 点击主页中的创建虚拟机
这边我直接点击的典型（推荐）
根据实际情况选择（一般默认就可以了）
点击完成
然后耐心等待机器加载
加载完毕后还有一些配置 需要处理
语言选择好之后 进行软件选择 选择GNOME桌面 和 开发工具 就可以了 点击左上角完成退出
第二步点击网络和主机名 链接网络 一样还是点击完成退出
最后点击安装位置 ，默认的就可以了 点击完成退出 再点右下角开始安装 这里设置root密码 开机用的 设置完后等待系统安装好就可以了
安装好效果图如下：
二.搭建EFK日志审计系统 打开终端：在根目录下创建一个存放 压缩包的文件夹
cd / &lt;----------------- 到根目录下 mkdir mysoft &lt;------------ 创建文件夹的指令 mysoft 是文件夹的名称 名称随意 使用 ifconfig 查看虚拟机的ip （这个ip之后会经常用到） 用xftp链接这台虚拟机需要用到
ifconfig 点开下载好的xftp 把你下载好的 压缩包 拉进来放在 你才创建好的文件夹内
这时我们在虚拟机中创建的文件夹中查看
现在开始对elastic，filebeat，kibana 三个压缩包进行解压" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/29ad21a15ecc8a1cf4f7cec36af75039/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-06-27T17:12:54+08:00" />
<meta property="article:modified_time" content="2023-06-27T17:12:54+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">LINUX - EFK（elastic &#43; filebeat &#43; kibana）日志审计系统小白构建过程 日记 手册</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>      <strong>  由于领导要求让我研究 efk 日志审计系统。我之前从未接触过，所以写这一篇文章作为研究和搭建过程的笔记 供自己以后参考，其中记录了我搭建过程中的遇到的各种问题，以及解决办法 包括常用到的指令。</strong></p> 
<p></p> 
<h2>一. 准备阶段</h2> 
<h3>1.准备好elasticsearch ，filebeat ，kibana 的压缩文件（网上下载），并下载好Xftp用于文件上传，Centos镜像文件并用VMware创建虚拟机</h3> 
<p>（注意elastic，filebeat，kibana的版本号要一样 如下图版本号均为-7.3.1 避免发生兼容性问题）</p> 
<p><img alt="" height="162" src="https://images2.imgbox.com/60/74/18JfJJB5_o.png" width="672"></p> 
<p><img alt="" height="52" src="https://images2.imgbox.com/55/be/hRqiNAtr_o.png" width="634"></p> 
<p></p> 
<p><img alt="" height="143" src="https://images2.imgbox.com/46/14/GpYHD5EC_o.png" width="161">          <img alt="" height="138" src="https://images2.imgbox.com/89/8a/YhQFoBTY_o.png" width="127"></p> 
<p></p> 
<h3>2.VMware16创建虚拟机 （本人之前没怎么接触过 摸索【百度】了很久，会的这里可以跳过不看）</h3> 
<p> 点击主页中的创建虚拟机</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/5c/aa/ghmkbdVF_o.png" width="1200"></p> 
<p>这边我直接点击的典型（推荐）</p> 
<p><img alt="" height="463" src="https://images2.imgbox.com/f3/8b/durVnx9O_o.png" width="496"></p> 
<p></p> 
<p><img alt="" height="461" src="https://images2.imgbox.com/e7/6f/pC48Aea4_o.png" width="494"></p> 
<p> <img alt="" height="457" src="https://images2.imgbox.com/38/3a/3okMkaSI_o.png" width="490"></p> 
<p>根据实际情况选择（一般默认就可以了）</p> 
<p><img alt="" height="462" src="https://images2.imgbox.com/49/06/5H8wbz2m_o.png" width="496"></p> 
<p>点击完成</p> 
<p><img alt="" height="466" src="https://images2.imgbox.com/43/f9/VOGymckp_o.png" width="499"></p> 
<p>然后耐心等待机器加载</p> 
<p><img alt="" height="269" src="https://images2.imgbox.com/7f/07/Wol1c3Bu_o.png" width="501"></p> 
<p>加载完毕后还有一些配置 需要处理</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/78/e1/OzHepOI1_o.png" width="1200"></p> 
<p></p> 
<p>语言选择好之后 进行软件选择  <img alt="" height="600" src="https://images2.imgbox.com/18/cc/G7tiGLdd_o.png" width="800"></p> 
<p>选择GNOME桌面 和 开发工具 就可以了 点击左上角完成退出</p> 
<p><img alt="" height="600" src="https://images2.imgbox.com/38/1a/4NleJzoa_o.png" width="800"></p> 
<p>第二步点击网络和主机名 </p> 
<p><img alt="" height="600" src="https://images2.imgbox.com/6a/29/yC18B0r6_o.png" width="800"></p> 
<p>链接网络 一样还是点击完成退出</p> 
<p><img alt="" height="600" src="https://images2.imgbox.com/c5/03/raGmNmjo_o.png" width="800"></p> 
<p>最后点击安装位置 ，默认的就可以了 点击完成退出 再点右下角开始安装 </p> 
<p><img alt="" height="600" src="https://images2.imgbox.com/aa/ab/hegwDjjQ_o.png" width="800"></p> 
<p>这里设置root密码 开机用的  设置完后等待系统安装好就可以了</p> 
<p><img alt="" height="600" src="https://images2.imgbox.com/58/d6/VGVBNg8m_o.png" width="800"></p> 
<p> 安装好效果图如下：<img alt="" height="1200" src="https://images2.imgbox.com/ef/b3/mWG2yr8a_o.png" width="1200"></p> 
<p></p> 
<h2>二.搭建EFK日志审计系统</h2> 
<p>打开终端：在根目录下创建一个存放 压缩包的文件夹</p> 
<pre><code>cd /  &lt;----------------- 到根目录下
mkdir mysoft   &lt;------------ 创建文件夹的指令 mysoft 是文件夹的名称 名称随意</code></pre> 
<p>使用 <span style="background-color:#38d8f0;">ifconfig 查看虚拟机的ip</span> （<span style="background-color:#38d8f0;">这个ip之后会经常用到</span>） 用xftp链接这台虚拟机需要用到</p> 
<pre><code>ifconfig</code></pre> 
<p><img alt="" height="420" src="https://images2.imgbox.com/a2/9d/1kWHY9KC_o.png" width="501"></p> 
<p></p> 
<p> 点开下载好的xftp </p> 
<p><img alt="" height="574" src="https://images2.imgbox.com/34/77/iRsrREPo_o.png" width="1200"></p> 
<p></p> 
<p><img alt="" height="691" src="https://images2.imgbox.com/3e/1d/uphvO9g0_o.png" width="546"></p> 
<p>把你下载好的 压缩包 拉进来放在 你才创建好的文件夹内</p> 
<p><img alt="" height="401" src="https://images2.imgbox.com/a2/7d/zgcCDP8E_o.png" width="552"></p> 
<p>这时我们在虚拟机中创建的文件夹中查看<img alt="" height="230" src="https://images2.imgbox.com/fe/4b/uZ9EVekm_o.png" width="1052"></p> 
<p> 现在开始对elastic，filebeat，kibana 三个压缩包进行解压</p> 
<pre><code>执行解压缩命令：
tar -zxvf elasticsearch-7.3.1-linux-x86_64.tar.gz -C /usr/local &lt;-----解压到/usr/local目录下
tar -zxvf 文件名称（按TAB可以补全）                -C （解压到的位置）</code></pre> 
<p>此时查看 usr/local目录下 刚才解压好的文件</p> 
<p><img alt="" height="390" src="https://images2.imgbox.com/73/6f/q5vY5QXG_o.png" width="1059"></p> 
<p>接下来 我们要对这三个组件进行配置</p> 
<h3>1. cd 到elastic的目录下 对其配置文件进行修改 </h3> 
<p> （<span style="background-color:#38d8f0;">注意需要先登入root 用户才可以对其进行修改</span> 否则会出现一下情况）：</p> 
<p><img alt="" height="524" src="https://images2.imgbox.com/64/a7/ZNZRmgS8_o.png" width="1071"></p> 
<p>文件无内容  退出需要同时按住shift + ：键 输入 q！ 再按回车键才能退出</p> 
<p> <img alt="" height="446" src="https://images2.imgbox.com/13/29/8wLDLpNC_o.png" width="543"></p> 
<p> <img alt="" height="441" src="https://images2.imgbox.com/25/cf/xPtg609y_o.png" width="534"></p> 
<p>正确方式如下先登录 root 用户 并输入密码</p> 
<p><img alt="" height="291" src="https://images2.imgbox.com/db/f3/zQ9S93Wc_o.png" width="1034">进入文件后点击 键盘 i 建 进入插入模式 （插入模式才可以对文件进行修改）</p> 
<p><img alt="" height="236" src="https://images2.imgbox.com/b1/cd/42H4RRmb_o.png" width="974"></p> 
<p></p> 
<p> <img alt="" height="459" src="https://images2.imgbox.com/35/be/hsDbJWzm_o.png" width="550"></p> 
<p>设置network.host  </p> 
<p><img alt="" height="364" src="https://images2.imgbox.com/ae/9e/WPsLCIs6_o.png" width="884"></p> 
<p>修改完毕后 按键盘 ESC 键退出插入模式 按住shift + ： 键 输入wq 点击回车 保存并退出</p> 
<p><img alt="" height="181" src="https://images2.imgbox.com/36/70/WnLHsB6j_o.png" width="948"></p> 
<p></p> 
<p> 现在我们准备启动elastic </p> 
<p>前往elastic 的bin目录下输入./elasticsearch启动elastic</p> 
<pre><code>./elasticserach</code></pre> 
<p> 你会发现启动不了 报错了 这是因为elastic 不能允许root 用户启动它 ，我们需要创建专门启动它的用户</p> 
<p><img alt="" height="478" src="https://images2.imgbox.com/2b/93/Z2WGHBYp_o.png" width="1200"></p> 
<p>创建用户 指令 </p> 
<pre><code>创建用户
useradd user-es &lt;-----------user-es 是我起的用户名称这里随意

创建所属组：
chown user-es:user-es -R /usr/local/elasticsearch-7.3.1 &lt;-----------user-es 为名称

切换到user-es用户
su user-es</code></pre> 
<p> 再次启动elastic </p> 
<p><img alt="" height="218" src="https://images2.imgbox.com/6d/25/dgn6uHGY_o.png" width="584"></p> 
<p>结果还是报错  错误如下：</p> 
<p><img alt="" height="130" src="https://images2.imgbox.com/70/65/FL03sze4_o.png" width="987"></p> 
<p>解决办法 如下：</p> 
<pre><code>问题翻译过来就是：elasticsearch用户拥有的可创建文件描述的权限太低，至少需要65536；

解决办法：

#切换到root用户修改

vim /etc/security/limits.conf

# 在最后面追加下面内容

*** hard nofile 65536 或  262144
 
*** soft nofile 65536
***  是启动ES的用户


添加内容

vi /etc/sysctl.conf 

然后在文末添加如下内容

vm.max_map_count = 655360

保存退出以后再在 root用户状态下 执行一下内容:

sysctl -p

接下来切换到非root用户就可以启动了
</code></pre> 
<p>效果图如下： </p> 
<p>                                  <img alt="" class="right" height="224" src="https://images2.imgbox.com/98/0a/IdsUP24B_o.png" width="315">                                          <img alt="" height="209" src="https://images2.imgbox.com/75/a4/kePnd0ym_o.png" width="314"></p> 
<p>修改完后即可正常运行</p> 
<p>要执行后台启动elastic命令 </p> 
<pre><code>启动elasticsearch（在bin 目录下）
./elasticsearch

后台启动elasticsearch(在bin 目录下)
./elasticsearch -d</code></pre> 
<p>检测 elastic是否正常启动命令，返回结果为拒绝连接则为启动失败</p> 
<pre><code>通过下面的命令找到进程IP
fuser -n tcp 9200   &lt;------elastic默认端口号是9200</code></pre> 
<p>启动成功后 在浏览器进行访问 虚拟机ip + elastic的9200端口 </p> 
<h3><img alt="" height="419" src="https://images2.imgbox.com/90/a3/xdUYxS6T_o.png" width="784"></h3> 
<p><span style="background-color:#ffd900;">如果elastic启动成功但 浏览器访问不了 可能是防火墙有限制  以下列举一些可能用到的指令</span>：</p> 
<pre><code>.查询指定端口是否已开启
firewall-cmd --query-port=9200/tcp

添加指定需要开放的端口
firewall-cmd --add-port=9200/tcp --permanent

查看想开的端口是否已开
firewall-cmd --query-port=9200/tcp
注意：如果查询是no，则需要执行防火墙命令重载
firewall-cmd --reload

</code></pre> 
<p></p> 
<h3> 2.对kibana 进行配置</h3> 
<p>    首先我们同样要像 elasticsearch 一样给 Kibana 配置一个 账户 来专门开启 Kibana 配置过程相同 指令如下：</p> 
<pre><code>创建用户
useradd user-ki

创建所属组：
chown user-ki:user-ki -R /usr/local/kibana-7.3.1-linux-x86_64

切换到user-ki用户
su user-ki
</code></pre> 
<p>切换到<span style="background-color:#fe2c24;"> user-ki用户</span>的 记得<span style="background-color:#fe2c24;">重新切换至 root 用户 </span>再进行配置</p> 
<p>配置文件所在位置为 /usr/local/kibana-7.3.1-linux-x86_64/config/kibana.yml</p> 
<p><img alt="" height="347" src="https://images2.imgbox.com/96/65/2dBXGkHb_o.png" width="1200"></p> 
<p></p> 
<p> 对配置文件进行修改 </p> 
<p>根据实际情况填写 ：<img alt="" height="739" src="https://images2.imgbox.com/52/cf/mq6SXubx_o.png" width="987"></p> 
<p> <img alt="" height="336" src="https://images2.imgbox.com/c8/67/FMaH6sA3_o.png" width="831"></p> 
<p></p> 
<p> 配置修改 并保存后 再kibana的bin目录下启动kibana</p> 
<p>启动指令如下：</p> 
<pre><code>kibana 后台启动在  kibana的bin目录下执行以下命令在后台启动：
nohup ./kibana &amp;

kibana 启动：
./kibana </code></pre> 
<p>记得切换至我们刚才创建的 专门启动kibana 的账户 再启动</p> 
<p><img alt="" height="216" src="https://images2.imgbox.com/99/f3/ZMK8EiEH_o.png" width="1200"><span style="background-color:#ffd900;"> 这种情况 请输入</span><span style="background-color:#fe2c24;">一遍 </span><span style="background-color:#ffd900;">exit 按回车键 </span><img alt="" height="181" src="https://images2.imgbox.com/ae/5e/oBF5rTaV_o.png" width="807"></p> 
<p> <img alt="" height="200" src="https://images2.imgbox.com/6d/1b/1vQPIwXk_o.png" width="838"></p> 
<p> 启动成功后（可能要等待一段时间 Kibana启动比较慢） 用浏览器访问 虚拟机ip + Kibana 5601端口 ，检查是否启动成功</p> 
<p>当出现这个页面表示 启动成功：</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/16/aa/oV82g3DO_o.png" width="1200"></p> 
<p></p> 
<h3>3.最后配置并启动filebeat </h3> 
<p>首先来的filebeat目录下 ，对filebeat.yml文件进行配置 </p> 
<p><img alt="" height="171" src="https://images2.imgbox.com/2a/dd/w2ozlOOX_o.png" width="1200"></p> 
<p> 根据实际情况 配置Kibana的host <img alt="" height="436" src="https://images2.imgbox.com/77/87/ya6vOT8R_o.png" width="1031"></p> 
<p> 根据实际情况配置elastic的hosts</p> 
<p> <img alt="" height="422" src="https://images2.imgbox.com/a6/c2/KlO1QH4t_o.png" width="644"></p> 
<p>保存退出 启动filebeat </p> 
<p> 在filebeat 目录下 输入 ./filebeat -e  启动</p> 
<pre><code>./filebeat -e
</code></pre> 
<p><img alt="" height="360" src="https://images2.imgbox.com/de/77/SHwD5C4E_o.png" width="915"></p> 
<p>启动成功后 我们用刚才浏览器打开的kibana页面</p> 
<p>点击添加日志 ：</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/a5/1f/cbSBtYIk_o.png" width="1200"></p> 
<p> 由于我需要的是系统日志，这里点击的系统日志</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/73/43/s1Vd00FF_o.png" width="1200"></p> 
<p></p> 
<p> 进入页面后翻到最底下，直接点击检查数据（上面的配置我们都配置好了 不用再配置了）</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/e9/18/2gdJd2lG_o.png" width="1200"></p> 
<p>出现(此模块成功收到数据)表示 日志审计服务搭建成功<img alt="" height="314" src="https://images2.imgbox.com/ae/4b/bwvDEaw5_o.png" width="1200"></p> 
<p></p> 
<p>点击左上角 仪表盘 进行查看日志信息 </p> 
<p> <img alt="" height="1200" src="https://images2.imgbox.com/f6/85/477XnJrn_o.png" width="1200"></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/69a8fbc12f6132e23c515e859b38bd6f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">处理png图片毛边问题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d1f403f3896a2ba22647f3a3c7c21ca8/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">探秘安卓广播：揭秘Android广播机制的神奇之处</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>