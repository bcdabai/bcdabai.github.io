<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【数据库】sql语句的基本书写规范，数据库基本书写方法和注意事项（基于mysql） - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【数据库】sql语句的基本书写规范，数据库基本书写方法和注意事项（基于mysql）" />
<meta property="og:description" content="sql语句的基本语法 序幕sql语句的大小写问题 开篇 sql基础查询语句 select打印字符多列查询：筛选条件 whereDISTICT关键字防重复 插入语句insert into更新语句update删除语句 操作符比较运算符逻辑运算符 and or not特殊符号（in、not in、between...and..、is NULL 、LIKE）排序 order by和 限制输出 limit 函数算术函数（1）（avg、max、min、sum）算术函数 （2） （ROUND、NULL、COUNT）时间函数 （1） （NOW、CURDATE、CURTIME、DATE、TIME、EXTRACT、DATE_FORMAT）时间函数2 （2）（DATE_ADD、DATE_SUB、DATEDIFF、TIMESTAMPDIFF） 约束与连结约束(not null、UNIQUE、PRIMARY KEY、CHECK、DEFAULT)连结内连接 INNER JOIN外连接 OUTER JOIN交叉连接 CROSS JOIN 以下为知识进阶（工作需掌握）查询进阶（分组查询（group by，having），子查询）分组查询 group byHAVING 子句简单子查询子查询进阶内联视图子查询IN操作符的多行子查询ANY操作符的多行子查询ALL 操作符的多行子查询多列子查询having子句中的子查询 小结练习： MySQL事务（transaction）锁锁的认识InnoDB锁的种类之自增锁InnoDB锁的种类之共享锁和排他锁InnoDB锁的种类之意向锁、记录锁和间隙锁 如何上锁如何加行锁 序幕 简单范例： select * from courses where name = “李明”;
上面这句sql的作用就是查询courses表中姓名为李明的人的所有信息（未关联表的情况下的信息）
注意所有的sql语句以分号;结束
注意下面的
sql语句的大小写问题 这个我查询的文档：原文链接：http://c.biancheng.net/view/7178.html
简单总结就是：
我们常用的sql的关键字，函数名，表的列名 不区分大小写 至于另外的视图名，数据库名，表名要根据使用的系统来进行具体的情况划分，详情点开上面的链接
下面这些语句都是等价的：
SELECT name FROM student ; SELECT NAME FROM student ; SELECT nAmE FROM student ; select name from student ; 开篇 sql基础 查询语句 select 关于select查询语句中的反引号的疑问：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/ac9695618bb4b64e8d709c166e3161d4/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-06-17T14:48:49+08:00" />
<meta property="article:modified_time" content="2022-06-17T14:48:49+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【数据库】sql语句的基本书写规范，数据库基本书写方法和注意事项（基于mysql）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>sql语句的基本语法</h4> 
 <ul><li><a href="#_2" rel="nofollow">序幕</a></li><li><ul><li><a href="#sql_9" rel="nofollow">sql语句的大小写问题</a></li></ul> 
  </li><li><a href="#__sql_25" rel="nofollow">开篇 sql基础</a></li><li><ul><li><a href="#_select_26" rel="nofollow">查询语句 select</a></li><li><ul><li><a href="#_30" rel="nofollow">打印字符</a></li><li><a href="#_34" rel="nofollow">多列查询：</a></li><li><ul><li><a href="#_where_38" rel="nofollow">筛选条件 where</a></li><li><a href="#DISTICT_43" rel="nofollow">DISTICT关键字防重复</a></li></ul> 
   </li></ul> 
   </li><li><a href="#insert_into_56" rel="nofollow">插入语句insert into</a></li><li><a href="#update_85" rel="nofollow">更新语句update</a></li><li><a href="#_101" rel="nofollow">删除语句</a></li></ul> 
  </li><li><a href="#_120" rel="nofollow">操作符</a></li><li><ul><li><a href="#_121" rel="nofollow">比较运算符</a></li><li><a href="#_and_or_not_133" rel="nofollow">逻辑运算符 and or not</a></li><li><a href="#innot_inbetweenandis_NULL_LIKE_157" rel="nofollow">特殊符号（in、not in、between...and..、is NULL 、LIKE）</a></li><li><a href="#_order_by__limit_225" rel="nofollow">排序 order by和 限制输出 limit</a></li></ul> 
  </li><li><a href="#_260" rel="nofollow">函数</a></li><li><ul><li><a href="#1avgmaxminsum_261" rel="nofollow">算术函数（1）（avg、max、min、sum）</a></li><li><a href="#_2_ROUNDNULLCOUNT_308" rel="nofollow">算术函数 （2） （ROUND、NULL、COUNT）</a></li><li><a href="#_1_NOWCURDATECURTIMEDATETIMEEXTRACTDATE_FORMAT_380" rel="nofollow">时间函数 （1） （NOW、CURDATE、CURTIME、DATE、TIME、EXTRACT、DATE_FORMAT）</a></li><li><a href="#2_2DATE_ADDDATE_SUBDATEDIFFTIMESTAMPDIFF_447" rel="nofollow">时间函数2 （2）（DATE_ADD、DATE_SUB、DATEDIFF、TIMESTAMPDIFF）</a></li></ul> 
  </li><li><a href="#_505" rel="nofollow">约束与连结</a></li><li><ul><li><a href="#not_nullUNIQUEPRIMARY_KEYCHECKDEFAULT_506" rel="nofollow">约束(not null、UNIQUE、PRIMARY KEY、CHECK、DEFAULT)</a></li><li><a href="#_815" rel="nofollow">连结</a></li><li><ul><li><a href="#_INNER_JOIN_827" rel="nofollow">内连接 INNER JOIN</a></li><li><a href="#_OUTER_JOIN_850" rel="nofollow">外连接 OUTER JOIN</a></li><li><a href="#_CROSS_JOIN_902" rel="nofollow">交叉连接 CROSS JOIN</a></li></ul> 
  </li></ul> 
  </li><li><a href="#_924" rel="nofollow">以下为知识进阶（工作需掌握）</a></li><li><a href="#group_byhaving_925" rel="nofollow">查询进阶（分组查询（group by，having），子查询）</a></li><li><ul><li><a href="#_group_by_926" rel="nofollow">分组查询 group by</a></li><li><a href="#HAVING__948" rel="nofollow">HAVING 子句</a></li><li><a href="#_964" rel="nofollow">简单子查询</a></li><li><a href="#_1034" rel="nofollow">子查询进阶</a></li><li><ul><li><a href="#_1035" rel="nofollow">内联视图子查询</a></li><li><a href="#IN_1049" rel="nofollow">IN操作符的多行子查询</a></li><li><a href="#ANY_1061" rel="nofollow">ANY操作符的多行子查询</a></li><li><a href="#ALL__1081" rel="nofollow">ALL 操作符的多行子查询</a></li><li><a href="#_1096" rel="nofollow">多列子查询</a></li><li><a href="#having_1109" rel="nofollow">having子句中的子查询</a></li></ul> 
   </li><li><a href="#_1128" rel="nofollow">小结练习：</a></li></ul> 
  </li><li><a href="#MySQLtransaction_1147" rel="nofollow">MySQL事务（transaction）</a></li><li><a href="#_1161" rel="nofollow">锁</a></li><li><ul><li><a href="#_1162" rel="nofollow">锁的认识</a></li><li><a href="#InnoDB_1182" rel="nofollow">InnoDB锁的种类之自增锁</a></li><li><a href="#InnoDB_1198" rel="nofollow">InnoDB锁的种类之共享锁和排他锁</a></li><li><a href="#InnoDB_1232" rel="nofollow">InnoDB锁的种类之意向锁、记录锁和间隙锁</a></li></ul> 
  </li><li><a href="#_1254" rel="nofollow">如何上锁</a></li><li><ul><li><a href="#_1278" rel="nofollow">如何加行锁</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="_2"></a>序幕</h2> 
<p>简单范例： <code>select * from courses where name = “李明”;</code><br> 上面这句sql的作用就是查询courses表中姓名为李明的人的所有信息（未关联表的情况下的信息）</p> 
<p>注意所有的sql语句以分号<code>;</code>结束</p> 
<p><font color="red">注意下面的</font></p> 
<h3><a id="sql_9"></a>sql语句的大小写问题</h3> 
<p>这个我查询的文档：原文链接：<a href="http://c.biancheng.net/view/7178.html" rel="nofollow">http://c.biancheng.net/view/7178.html</a><br> 简单总结就是：</p> 
<ul><li>我们常用的sql的关键字，函数名，表的列名 <font color="red">不区分大小写</font></li></ul> 
<p>至于另外的视图名，数据库名，表名要根据使用的系统来进行具体的情况划分，详情点开上面的链接</p> 
<p>下面这些语句都是等价的：</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> name <span class="token keyword">FROM</span> student <span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> NAME <span class="token keyword">FROM</span> student <span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> nAmE <span class="token keyword">FROM</span> student <span class="token punctuation">;</span>
<span class="token keyword">select</span> name <span class="token keyword">from</span> student <span class="token punctuation">;</span>
</code></pre> 
<h2><a id="__sql_25"></a>开篇 sql基础</h2> 
<h3><a id="_select_26"></a>查询语句 select</h3> 
<p>关于select查询语句中的反引号的疑问：<br> <img src="https://images2.imgbox.com/1c/a6/CoCsvhIp_o.png" alt="反引号的疑问"></p> 
<h4><a id="_30"></a>打印字符</h4> 
<p><code>select "Hello SQL!";</code><br> 直接将要打印的内容写在sql语句的引号中就是要打印的字符串</p> 
<h4><a id="_34"></a>多列查询：</h4> 
<p><code>select name,student from courses</code><br> 从courses表中查询name 和 student 两列</p> 
<h5><a id="_where_38"></a>筛选条件 where</h5> 
<p><code>where name ="李明"</code><br> 其中where的操作符有 <code>等于= 大于&gt; 小于&lt; 不等于!=或&lt;&gt; </code><br> <font color="bred">注意没有 == 这个符号</font></p> 
<h5><a id="DISTICT_43"></a>DISTICT关键字防重复</h5> 
<p>这个distict的采用例题的方式更容易让人明白<br> 比如：查询如下所示的teacher表中所有的国籍<br> <img src="https://images2.imgbox.com/71/b0/aSHIu9YH_o.png" alt="老师国籍"><br> 如果直接写为<code>select country from teacher</code><br> 那么查询到的结果将会显示为表最后一列：<br> <img src="https://images2.imgbox.com/aa/ef/qlpC82rK_o.png" alt="查询结果"><br> 如若查询的sql语句改为：<code>select DISTINCT country from teacher</code><br> 那么它就会自动去重 得到的结果为<br> <img src="https://images2.imgbox.com/a5/61/4lqRNGMP_o.png" alt="结果2"><br> 这种去重的查询在对确定有哪些地方，哪些人，需要考虑重复的情况下比较有效</p> 
<h3><a id="insert_into_56"></a>插入语句insert into</h3> 
<p>作用就是向表中添加新的数据</p> 
<ul><li>第一种插入方式：(插入的数据为表的<font color="red">一行</font>的数据，且valuen的数据是表对应的列的顺序)<br> <code>INSERT INTO `table_name` VALUES (value1, value2, value3,...); </code><br> <font color="blue">例如</font>：已有的数据库表：<br> <img src="https://images2.imgbox.com/97/f1/CBubUTbH_o.png" alt="已有的数据库表"><br> 插入一条新的数据的书写方式：</li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> courses
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token string">"Python"</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">,</span> <span class="token string">"2021-05-23"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><font color="red">需要注意的是设计的表中对应的integer类型的valuen可直接写整数，其他字符类型 如String类型 要写成<code>""或者‘’</code>括起来的形式</font></p> 
<ul><li>第二种插入方式：（插入指定列名的数据）<br> <code>INSERT INTO `table_name` (`column1`, `column2`, `column3`,...) VALUES (value1, value2, value3,...);</code><br> 相应的column的名称对应value要插入的数据<br> <font color="blue">例如</font>：向teachers表中插入一条数据</li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> teachers <span class="token punctuation">(</span>name<span class="token punctuation">,</span>email<span class="token punctuation">,</span>age<span class="token punctuation">,</span>country<span class="token punctuation">)</span> 
 <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">"XiaoFu"</span><span class="token punctuation">,</span><span class="token string">"XiaoFu@lintcode.com"</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token string">"CN"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>插入的效果（第一列为自增列可不用插入数据，数据库自己增加序列）：<br> <img src="https://images2.imgbox.com/b7/0c/vWdrzCWL_o.png" alt="表格的信息"></p> 
<p><font color="red"><font color="blue">注意</font>：不管是哪种插入方式它都不能插入一个不存在的列</font></p> 
<h3><a id="update_85"></a>更新语句update</h3> 
<p>插入语句的语法：</p> 
<pre><code class="prism language-sql"><span class="token keyword">UPDATE</span> <span class="token identifier"><span class="token punctuation">`</span>table_name<span class="token punctuation">`</span></span>
<span class="token keyword">SET</span> <span class="token identifier"><span class="token punctuation">`</span>column1<span class="token punctuation">`</span></span><span class="token operator">=</span>value1<span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>column2<span class="token punctuation">`</span></span><span class="token operator">=</span>value2<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">WHERE</span> <span class="token identifier"><span class="token punctuation">`</span>some_column<span class="token punctuation">`</span></span><span class="token operator">=</span>some_value<span class="token punctuation">;</span>
</code></pre> 
<p>where一般作为筛选条件，可根据筛选条件具体判定是哪一列的数据<br> <font color="blue">例如</font>：修改课程表courses选择Artificial Intelligence的人数为500（若表中没有这个名称的课程那么表不会被修改）</p> 
<pre><code class="prism language-sql"><span class="token keyword">update</span> courses 
<span class="token keyword">set</span> student_count <span class="token operator">=</span> <span class="token number">500</span>
<span class="token keyword">where</span> name <span class="token operator">=</span> <span class="token string">"Artificial Intelligence"</span><span class="token punctuation">;</span> 
</code></pre> 
<h3><a id="_101"></a>删除语句</h3> 
<p>标准格式删除某一行的数据（通过where来进行筛选）：</p> 
<pre><code class="prism language-sql"><span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>table_name<span class="token punctuation">`</span></span>
<span class="token keyword">WHERE</span> <span class="token identifier"><span class="token punctuation">`</span>some_column<span class="token punctuation">`</span></span> <span class="token operator">=</span> <span class="token identifier"><span class="token punctuation">`</span>some_value<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
</code></pre> 
<p><font color="blue">例如</font>：删除courses表中2020年之前所有的信息</p> 
<pre><code class="prism language-sql"><span class="token keyword">delete</span> <span class="token keyword">from</span> courses
<span class="token keyword">where</span> created_at <span class="token operator">&lt;</span> <span class="token string">"2020-1-1"</span><span class="token punctuation">;</span>
</code></pre> 
<p>若是不加where的判定条件，直接执行<code>delete from courses</code>后将会清空这个表的数据</p> 
<p>注意删除表的定义和整个表采用的是 <code>drop table_name</code></p> 
<p>其中关于删除表，删除表中数据，参考这个网站或百度（关于drop，truncate和delete对数据库表的相关操作）：<a href="https://www.cnblogs.com/1312mn/p/4422396.html" rel="nofollow">https://www.cnblogs.com/1312mn/p/4422396.html</a></p> 
<h2><a id="_120"></a>操作符</h2> 
<h3><a id="_121"></a>比较运算符</h3> 
<p><code>&lt; &gt; = &lt;&gt;或!= &gt;= &lt;=</code><br> 大于，小于，等于，不等于（&lt;&gt;或!=）,大于等于，小于等于<br> <code>WHERE A operator B</code><br> 如：<code>where age &gt; 20</code>或<code>where name = "小张</code><br> 当b是字符串时记得用引号括起来</p> 
<p><font color="blue">例如</font>：查询teachers表中所有的国籍为中国的姓名</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> name <span class="token keyword">from</span> teachers
<span class="token keyword">where</span> country <span class="token operator">=</span> <span class="token string">"CN"</span>
</code></pre> 
<h3><a id="_and_or_not_133"></a>逻辑运算符 and or not</h3> 
<ul><li>and<br> <code>WHERE condition1 AND condition2;</code><br> 用于连接多个条件，condition为每一个单独的条件 要求同时满足多个条件<br> <font color="blue">例如</font>：查询courses表中教师id为4 学生上课大于500的课程信息：</li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> courses 
<span class="token keyword">WHERE</span> teacher_id <span class="token operator">=</span> <span class="token number">4</span> <span class="token operator">and</span> student_count <span class="token operator">&gt;</span> <span class="token number">500</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li>or<br> 连接多个条件 要求满足这几个条件中的一个<br> <font color="blue">例如</font>：查询courses表中名为’Web’或‘Big Data’的课程信息</li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> courses
<span class="token keyword">WHERE</span> name <span class="token operator">=</span> <span class="token string">'Web'</span> <span class="token operator">or</span> name <span class="token operator">=</span> <span class="token string">'Big Data'</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li>not<br> 过滤不满足条件的数据<br> <font color="blue">例如</font>：查询教师 id 不为 3 且人数大于 800 的课程</li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> courses
<span class="token keyword">WHERE</span> <span class="token operator">not</span> teacher_id <span class="token operator">=</span> <span class="token number">3</span> <span class="token operator">and</span> student_count <span class="token operator">&gt;</span> <span class="token number">800</span>
</code></pre> 
<h3><a id="innot_inbetweenandis_NULL_LIKE_157"></a>特殊符号（in、not in、between…and…、is NULL 、LIKE）</h3> 
<ul><li>in<br> 用法：</li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>table_name<span class="token punctuation">`</span></span>
<span class="token keyword">WHERE</span> <span class="token identifier"><span class="token punctuation">`</span>column_name<span class="token punctuation">`</span></span> <span class="token operator">IN</span> <span class="token identifier"><span class="token punctuation">`</span>value<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
</code></pre> 
<p>可用于查询多条件 value 可以是一个集合，也可嵌套一个sql的查询语句得到的集合<br> <font color="blue">例如</font>：查询课程表 courses 中开课日期为 2021-01-01 或者 2021-01-03 的所有课程信息</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> courses
<span class="token keyword">WHERE</span> created_at <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token string">'2021-01-01'</span><span class="token punctuation">,</span><span class="token string">'2021-01-03'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li>not in 排除</li></ul> 
<p>语法：</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>table_name<span class="token punctuation">`</span></span>
<span class="token keyword">WHERE</span> <span class="token identifier"><span class="token punctuation">`</span>column_name<span class="token punctuation">`</span></span> <span class="token operator">NOT</span> <span class="token operator">IN</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
</code></pre> 
<p><font color="blue">例如</font>：查询课程表 courses 中所有教师 id teacher_id 不为 1 或 3 的所有课程名称</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> name <span class="token keyword">FROM</span> courses
<span class="token keyword">WHERE</span> teacher_id <span class="token operator">not</span> <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li>between…and… 查询两值间的数据范围</li></ul> 
<p>语法：</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>table_name<span class="token punctuation">`</span></span>
<span class="token keyword">WHERE</span> <span class="token identifier"><span class="token punctuation">`</span>column_name<span class="token punctuation">`</span></span> <span class="token operator">BETWEEN</span> <span class="token identifier"><span class="token punctuation">`</span>value<span class="token punctuation">`</span></span> <span class="token operator">AND</span> <span class="token identifier"><span class="token punctuation">`</span>value<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
</code></pre> 
<p><font color="blue">例如</font>：查询课程表 courses 中学生数量在 50 到 55 之间的所有课程信息</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">from</span> courses
<span class="token keyword">where</span> student_count <span class="token operator">BETWEEN</span> <span class="token number">50</span> <span class="token operator">and</span> <span class="token number">55</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li>IS NULL 查询空数据<br> NULL 值代表遗漏的未知数据。默认的，表的列可以存放 NULL 值。</li></ul> 
<p><font color="blue">例如</font>：查询教师表 teachers 中，国籍为 ‘CN’ 或 ‘JP’ 且 email 信息不为空的所有教师信息</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> teachers
<span class="token keyword">WHERE</span> country <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token string">'CN'</span><span class="token punctuation">,</span><span class="token string">'JP'</span><span class="token punctuation">)</span> <span class="token operator">and</span> email <span class="token operator">is</span> <span class="token operator">not</span>  <span class="token boolean">NULL</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li>LIKE 模糊查询</li></ul> 
<p>语法：</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>table_name<span class="token punctuation">`</span></span>
<span class="token keyword">WHERE</span> <span class="token identifier"><span class="token punctuation">`</span>column_name<span class="token punctuation">`</span></span> <span class="token operator">LIKE</span>  <span class="token identifier"><span class="token punctuation">`</span>value<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
</code></pre> 
<p>关于value中的使用规范：<br> <img src="https://images2.imgbox.com/8f/03/EKcBMuAD_o.png" alt="通配符"></p> 
<p><font color="blue">例如</font>：查询教师表 teachers 中，所有使用 qq 邮箱的教师名字和邮箱</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> name<span class="token punctuation">,</span>email <span class="token keyword">FROM</span> teachers
<span class="token keyword">WHERE</span> email <span class="token operator">like</span> <span class="token string">'%@qq.com'</span>
</code></pre> 
<p><font color="red">上面的这个%就代表了前面有0个或多个字符，最后以@qq.com结尾，有点类似于python中的正则表达式</font></p> 
<h3><a id="_order_by__limit_225"></a>排序 order by和 限制输出 limit</h3> 
<ul><li>order by 对数据进行排序 默认升序<br> ASC ：按升序排列，ORDER BY 默认按照升序对记录进行排序，因此升序的关键字 ASC 可以省去不写。<br> DESC：按降序排列，如果需要按照降序对记录进行排序，可以使用 DESC 关键字。</li></ul> 
<p>语法：</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token identifier"><span class="token punctuation">`</span>column_name<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>column_name<span class="token punctuation">`</span></span>
<span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>table_name<span class="token punctuation">`</span></span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token identifier"><span class="token punctuation">`</span>column_name<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>column_name<span class="token punctuation">`</span></span> <span class="token keyword">ASC</span><span class="token operator">|</span><span class="token keyword">DESC</span><span class="token punctuation">;</span>
</code></pre> 
<p><font color="blue">例如</font>：查询教师表 teachers 中的中国教师，并按照年龄降序排序</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> teachers 
<span class="token keyword">WHERE</span> country <span class="token operator">=</span> <span class="token string">'CN'</span>
<span class="token keyword">order</span> <span class="token keyword">by</span> age <span class="token keyword">DESC</span>
</code></pre> 
<ul><li>limit 对输出结果集的行数进行约束<br> offset ：是返回集的初始标注，起始点是0，不是1哦<br> count ：制定返回的数量</li></ul> 
<p>语法：</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token identifier"><span class="token punctuation">`</span>column_name<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>column_name<span class="token punctuation">`</span></span>
<span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>table_name<span class="token punctuation">`</span></span>
<span class="token keyword">LIMIT</span> <span class="token identifier"><span class="token punctuation">`</span>offset<span class="token punctuation">`</span></span> <span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>count<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
</code></pre> 
<p><font color="blue">例如</font>：从教师表（teachers）中查询一条年龄最大的中国教师的信息</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> teachers
<span class="token keyword">WHERE</span> country <span class="token operator">=</span> <span class="token string">'CN'</span>
<span class="token keyword">order</span> <span class="token keyword">by</span> age <span class="token keyword">DESC</span>
<span class="token keyword">limit</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre> 
<h2><a id="_260"></a>函数</h2> 
<h3><a id="1avgmaxminsum_261"></a>算术函数（1）（avg、max、min、sum）</h3> 
<ul><li>AVG() 函数<br> 平均函数 它用于求数值列的平均值。它可以用来返回所有列的平均值，也可以用来返回特定列和行的平均值， 列中的数据均为空时，结果会返回 NULL</li></ul> 
<p>语法：</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>student_count<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token identifier"><span class="token punctuation">`</span>average_student_count<span class="token punctuation">`</span></span>
<span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>courses<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
</code></pre> 
<p>as 后面的是给计算的结果这个新的列去的一个名字<br> <font color="blue">例如</font>：查询教师表 teachers 中教师邮箱为 ‘@qq.com’ 结尾的年龄的平均值，最后返回结果列名显示为 ‘average_teacher_age’ 。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token function">avg</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span> <span class="token keyword">as</span> average_teacher_age <span class="token keyword">FROM</span> teachers
<span class="token keyword">WHERE</span> email <span class="token operator">like</span> <span class="token string">'%@qq.com'</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li>MAX() 函数<br> 用于返回指定列中的最大值 列中的数据均为空时，结果会返回 NULL</li></ul> 
<p>语法：</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token function">MAX</span><span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>column_name<span class="token punctuation">`</span></span><span class="token punctuation">)</span> 
<span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>table_name<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
</code></pre> 
<p><font color="blue">例如</font>：从教师表 teachers 中，查询最年长的中国教师信息，并返回该教师的年龄。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token function">MAX</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span> <span class="token keyword">as</span> max_age <span class="token keyword">from</span> teachers 
<span class="token keyword">WHERE</span> country <span class="token operator">=</span> <span class="token string">'CN'</span>
</code></pre> 
<ul><li> <p>MIN() 函数<br> 用于返回指定列中的最小值 与MAX相同 就不特此举例了</p> </li><li> <p>SUM() 函数<br> 用于统计数值列的总数并返回其值</p> </li></ul> 
<p>语法：</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token function">SUM</span><span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>column_name<span class="token punctuation">`</span></span><span class="token punctuation">)</span> 
<span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>table_name<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
</code></pre> 
<p><font color="blue">例如</font>：统计课程表 courses 中 teacher_id 为 3 的教师所教授的学生总数，并用select_student_sum 作为结果集列名。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token function">SUM</span><span class="token punctuation">(</span>student_count<span class="token punctuation">)</span> <span class="token keyword">as</span> select_student_sum <span class="token keyword">FROM</span> courses
<span class="token keyword">WHERE</span> teacher_id <span class="token operator">=</span> <span class="token number">3</span>
</code></pre> 
<h3><a id="_2_ROUNDNULLCOUNT_308"></a>算术函数 （2） （ROUND、NULL、COUNT）</h3> 
<ul><li>ROUND () 函数<br> 用于把数值字段舍入(四舍五入)为指定的小数位数</li></ul> 
<p>语法：</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token function">ROUND</span><span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>column_name<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>decimals<span class="token punctuation">`</span></span><span class="token punctuation">)</span> 
<span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>table_name<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
</code></pre> 
<p><font color="blue">例如</font>：查询教师表 teachers 中，20 岁（不包含 20 岁）以上教师的平均年龄，返回的字段为 avg_teacher_age ，结果保留四舍五入后的整数</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token function">ROUND</span><span class="token punctuation">(</span><span class="token function">AVG</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> avg_teacher_age <span class="token keyword">FROM</span> teachers
<span class="token keyword">where</span> age <span class="token operator">&gt;</span> <span class="token number">20</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li>NULL () 函数 讲述不是很详细，请参考：<a href="https://www.lintcode.com/learn/33/212" rel="nofollow">跳转</a> 
  <ul><li>ISNULL() 函数用于判断字段是否为 NULL，它只有一个参数 column_name 为列名，根据column_name 列中的字段是否为 NULL 值返回 0 或 1。<br> 语法：</li></ul> </li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> ISNULL<span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>column_name<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>table_name<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
</code></pre> 
<p>如果 column_name 列中的某个字段是 NULL 则返回 1，不是则返回 0</p> 
<ul><li>IFNULL() 函数也用于判断字段是否为NULL，但是与 ISNULL() 不同的是它接收两个参数，第一个参数 column_name 为列名，第二个参数 value 相当于备用值。<br> 语法：</li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> IFNULL<span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>column_name<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>value<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>table_name<span class="token punctuation">`</span></span><span class="token punctuation">;</span> 
</code></pre> 
<p>如果 column_name 列中的某个字段是 NULL 则返回 value 值，不是则返回对应内容。<br> COALESCE(column_name, value) 函数也用于判断字段是否为NULL，其用法和 IFNULL() 相同</p> 
<p><font color="blue">例如</font>：从 teachers 表中找出没有邮箱并且年龄大于20岁的教师信息</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> teachers 
<span class="token keyword">WHERE</span> isnull<span class="token punctuation">(</span>email<span class="token punctuation">)</span> <span class="token operator">and</span> age <span class="token operator">&gt;</span> <span class="token number">20</span>
</code></pre> 
<p>isnull函数的返回值可用于判断条件</p> 
<ul><li> <p>count() 函数</p> 
  <ul><li>COUNT( column_name ) 会对指定列具有的行数进行计数，<font color="red">但是会除去值为 NULL 的行</font></li><li>COUNT(*) 会对表中行的数目进行计数，<font color="red">包括值为 NULL 所在行和重复项所在行</font></li></ul> </li></ul> 
<p><font color="blue">例如</font>：统计教师表中年龄在 20 到 28 岁之间，且国籍为中国或英国的教师人数，最后返回统计值，结果列名显示为 teacher_count</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> teacher_count 
<span class="token keyword">FROM</span> teachers
<span class="token keyword">WHERE</span> age <span class="token operator">between</span> <span class="token number">20</span> <span class="token operator">and</span> <span class="token number">28</span> <span class="token operator">and</span> country <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token string">'CN'</span><span class="token punctuation">,</span><span class="token string">'UK'</span><span class="token punctuation">)</span>
</code></pre> 
<p>注意： COUNT(column_name) 与 COUNT(*) 的区别</p> 
<p>COUNT(column_name) 中，如果 column_name 字段中的值为 NULL，则计数不会增加，而如果字段值为空字符串""，则字段值会加 1</p> 
<p>COUNT(<em>) 中，除非整个记录全为 NULL，则计数不会增加，如果存在某一个记录不为 NULL，或者为空字符串""，计数值都会加 1。正常来说，表都会有主键，而主键不为空，所以 COUNT(</em>) 在有主键的表中等同于 COUNT(PRIMARY_KEY)，即查询有多少条记录。</p> 
<ul><li>COUNT(DISTINCT column_name)<br> COUNT(DISTINCT column_name) 函数返回指定列的不同值的数目</li></ul> 
<p><font color="blue">例如</font>：统计课程表 courses 中不同的教师 id teacher_id 的数量，最后返回统计值，结果列名显示为 teacher_count</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> teacher_id<span class="token punctuation">)</span> <span class="token keyword">as</span> teacher_count
<span class="token keyword">FROM</span> courses
</code></pre> 
<p>相当于统计有多少个teacher_id (有多少个教师）</p> 
<h3><a id="_1_NOWCURDATECURTIMEDATETIMEEXTRACTDATE_FORMAT_380"></a>时间函数 （1） （NOW、CURDATE、CURTIME、DATE、TIME、EXTRACT、DATE_FORMAT）</h3> 
<ul><li>NOW（） CURDATE() CURTIME() 获取当前时间 
  <ul><li>NOW() 可以用来返回当前日期和时间 格式：YYYY-MM-DD hh:mm:ss</li><li>CURDATE() 可以用来返回当前日期 格式：YYYY-MM-DD</li><li>CURTIME() 可以用来返回当前时间 格式：hh:mm:ss</li></ul> </li></ul> 
<pre><code>在使用 NOW() 和 CURTIME() 时，如果要精确的秒以后的时间的话，
可以在（）中加数字，加多少，就表示精确到秒后多少位
比如 NOW(3) 就是精确到毫秒，表示为： 2021-03-31 15:27:20.645
</code></pre> 
<p><font color="blue">例如</font>：向记录表 records 中插入当前的日期</p> 
<pre><code class="prism language-sql"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> records
<span class="token keyword">VALUES</span><span class="token punctuation">(</span>CURDATE<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<ul><li>DATE() 、TIME() 获取日期和时间</li></ul> 
<p><font color="blue">例如</font>：查询课程表中课程的创建日期</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token keyword">DATE</span><span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>created_at<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token identifier"><span class="token punctuation">`</span>created_date<span class="token punctuation">`</span></span>
<span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>courses<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
</code></pre> 
<p>得到结果：<br> <img src="https://images2.imgbox.com/6b/ee/1TgNGI6z_o.png" alt="在这里插入图片描述"><br> <font color="blue">例如2</font>：分别查询出课程表的课程创建时间中的日期与时间</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>created_at<span class="token punctuation">`</span></span><span class="token punctuation">,</span> 
	DATE_FORMAT<span class="token punctuation">(</span><span class="token keyword">DATE</span><span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>created_at<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"%Y-%m-%d"</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token identifier"><span class="token punctuation">`</span>created_date<span class="token punctuation">`</span></span><span class="token punctuation">,</span> 
	DATE_FORMAT<span class="token punctuation">(</span><span class="token keyword">TIME</span><span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>created_at<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"%H:%i:%s"</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token identifier"><span class="token punctuation">`</span>created_time<span class="token punctuation">`</span></span>
<span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>courses<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
</code></pre> 
<p>结果如下：<br> <img src="https://images2.imgbox.com/48/4c/19p4JkOq_o.png" alt="查询结果"></p> 
<ul><li>EXTRACT() 函数提取指定的时间信息</li></ul> 
<p>语法：</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> EXTRACT<span class="token punctuation">(</span>unit <span class="token keyword">FROM</span> <span class="token keyword">date</span><span class="token punctuation">)</span>
<span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>table<span class="token punctuation">`</span></span>
</code></pre> 
<p>date 参数是合法的日期表达式。<br> unit 参数是需要返回的时间部分，如 YEAR 、MONTH 、 DAY 、 HOUR 、MINUTE 、SECOND 等。</p> 
<p><font color="blue">例如</font>：从课程表 courses 中查询所有课程的课程名称（ name ）和课程创建时间（ created_at ）的小时数，将提取小时数的列名起别名为 created_hour。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> name<span class="token punctuation">,</span>EXTRACT<span class="token punctuation">(</span><span class="token keyword">hour</span> <span class="token keyword">FROM</span> created_at<span class="token punctuation">)</span> <span class="token keyword">as</span> created_hour
<span class="token keyword">FROM</span> courses
</code></pre> 
<ul><li>DATE_FORMAT() 格式化输出日期</li></ul> 
<p>语法：</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> DATE_FORMAT<span class="token punctuation">(</span><span class="token keyword">date</span><span class="token punctuation">,</span>format<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>其中<br> date 一个有效日期。<br> format 是 date/time 的输出格式。 其中 %m 表示月份，%d 表示日期，%Y 表示年份，%w 表示星期。<br> 关于format的格式要求：<a href="https://www.w3school.com.cn/sql/func_date_format.asp" rel="nofollow">参考</a><br> %i、%l（小写L）、%I（大写i）每一个所表示的格式都不同，参考上面的这个链接<br> <font color="blue">例如</font>：查询 courses 表，查询课程创建时间，按照 ’年-月-日 时：分：秒’ 的格式返回结果，返回列名显示为 DATE_FORMAT</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> DATE_FORMAT<span class="token punctuation">(</span>created_at<span class="token punctuation">,</span><span class="token string">'%Y-%m-%d %H:%i:%S'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> DATE_FORMAT <span class="token keyword">FROM</span> courses
</code></pre> 
<h3><a id="2_2DATE_ADDDATE_SUBDATEDIFFTIMESTAMPDIFF_447"></a>时间函数2 （2）（DATE_ADD、DATE_SUB、DATEDIFF、TIMESTAMPDIFF）</h3> 
<ul><li>DATE_ADD() 增加时间<br> 常用的时间函数之一，用于向日期添加指定的时间间隔</li></ul> 
<p>语法：</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> DATE_ADD<span class="token punctuation">(</span><span class="token keyword">date</span><span class="token punctuation">,</span> <span class="token keyword">INTERVAL</span> expr <span class="token keyword">type</span><span class="token punctuation">)</span>
<span class="token keyword">FROM</span> table_name
</code></pre> 
<p>date 指代希望被操作的有效日期，为起始日期<br> expr 是希望添加的时间间隔的数值（expr 是一个字符串，对于负值的间隔，可以以 ”-“ 开头）<br> type 是具体的数据类型，表示加上时间间隔的单位（可以是 MICROSECOND , SECOND , MINUTE , HOUR , DAY , WEEK , MONTH , QUARTER , YEAR 等）</p> 
<p><font color="blue">例如</font>：修改 courses 表中课程的课程创建日期，将课程创建日期均推迟一天，最后返回课程名称 name 及修改后的课程创建时间，修改后的课程创建时间命名为 new_created</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> name<span class="token punctuation">,</span> DATE_ADD<span class="token punctuation">(</span>created_at<span class="token punctuation">,</span> <span class="token keyword">INTERVAL</span> <span class="token number">1</span> <span class="token keyword">day</span><span class="token punctuation">)</span> <span class="token keyword">as</span> new_created
<span class="token keyword">FROM</span> courses
</code></pre> 
<ul><li>DATE_SUB() 函数<br> 用于从日期减去指定的时间间隔。它与 DATE_ADD() 函数具有相似的用法。</li></ul> 
<p>语法：</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> DATE_SUB<span class="token punctuation">(</span><span class="token keyword">date</span><span class="token punctuation">,</span> <span class="token keyword">INTERVAL</span> expr <span class="token keyword">type</span><span class="token punctuation">)</span>
<span class="token keyword">FROM</span> table_name
</code></pre> 
<p>expr和type与上面DATE_ADD()函数相同<br> <font color="blue">注意：date_add 本身为加，expr为负数时，为减，date_SUB 本身为减，expr为负数时，为加</font></p> 
<ul><li>DATEDIFF() 函数<br> 常用的日期差，在 MySQL 中默认<font color="red">只能计算天数差</font></li></ul> 
<p>语法：</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> DATEDIFF<span class="token punctuation">(</span>时间<span class="token number">1</span><span class="token punctuation">,</span>时间<span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> date_diff <span class="token keyword">FROM</span> courses<span class="token punctuation">;</span>
</code></pre> 
<p>DATEDIFF() 差值计算规则：<font color="red">时间 1 - 时间 2 </font></p> 
<p><font color="blue">例如</font>：查询 courses 表，计算从 2019 年 03 月 26 日到创建时间（created_at）相差的天数，结果列名以 date_diff 显示</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span>  DATEDIFF<span class="token punctuation">(</span>created_at<span class="token punctuation">,</span><span class="token string">'2019-03-26'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> date_diff <span class="token keyword">from</span> courses
</code></pre> 
<ul><li>TIMESTAMPDIFF() 函数<br> 查询功能多的 MySQL 自带的日期函数，可以计算两个日期相差的年(YEAR，时间1,时间2)，月(MONTH，时间1,时间2)，周(WEEK，时间1,时间2)，日(DAY，时间1,时间2)，小时(HOUR，时间1,时间2)。</li></ul> 
<p>语法：</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> TIMESTAMPDIFF <span class="token punctuation">(</span>类型<span class="token punctuation">,</span>时间<span class="token number">1</span><span class="token punctuation">,</span>时间<span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> year_diff；
</code></pre> 
<p>TIMESTAMPDIFF() 差值计算规则：<font color="red">时间 2 - 时间 1</font><br> <font color="blue">例如：</font>查询 courses 表，计算课程创建时间与 ‘2020-04-22’ 的月数差，返回列名显示为 MonthDiff</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> TIMESTAMPDIFF<span class="token punctuation">(</span><span class="token keyword">month</span><span class="token punctuation">,</span>created_at<span class="token punctuation">,</span><span class="token string">'2020-04-22'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> MonthDiff <span class="token keyword">from</span> courses
</code></pre> 
<p>注意两个时间相减的方向</p> 
<h2><a id="_505"></a>约束与连结</h2> 
<h3><a id="not_nullUNIQUEPRIMARY_KEYCHECKDEFAULT_506"></a>约束(not null、UNIQUE、PRIMARY KEY、CHECK、DEFAULT)</h3> 
<p>在 SQL 中，约束是规定表中的数据规则。若存在违反约束的行为，行为就会阻止。它能帮助管理员更好地管理数据库，并且确保数据库中数据的正确性和有效性。例如在后台的数据库设计中对要输入的数据进行核查或判断，再决定是否写入数据库，这都是约束的应用。</p> 
<ul><li>not null <font color="red">非空约束</font><br> NOT NULL 约束强制列不接受 NULL 值，强制字段始终包含值，这意味着，如果不向字段添加值，就无法插入新纪录或者更新记录。</li></ul> 
<p><font color="blue">例如</font>：</p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>Persons<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
    <span class="token identifier"><span class="token punctuation">`</span>ID<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>LastName<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>FirstName<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>Age<span class="token punctuation">`</span></span> <span class="token keyword">int</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>在一个已创建的表的 Age 字段中添加 NOT NULL 约束如下所示：</p> 
<pre><code class="prism language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>Persons<span class="token punctuation">`</span></span>
<span class="token keyword">MODIFY</span> <span class="token identifier"><span class="token punctuation">`</span>Age<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span>
</code></pre> 
<p>在一个已创建的表的 Age 字段中删除 NOT NULL 约束如下所示：</p> 
<pre><code class="prism language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>Persons<span class="token punctuation">`</span></span>
<span class="token keyword">MODIFY</span> <span class="token identifier"><span class="token punctuation">`</span>Age<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span>
</code></pre> 
<pre><code>注意
不要把 NULL 值与空串相混淆。NULL 值是没有值，
</code></pre> 
<p>它不是空串。如果指定’ '（两个单引号，其间没有字符），这在 NOT NULL 列中是允许的。空串是一个有效的值，它不是无值。NULL 值用关键字 NULL 而不是空串指定</p> 
<ul><li>UNIQUE <font color="red">唯一约束</font> <a href="https://www.lintcode.com/learn/53/136" rel="nofollow">写作参考</a><br> 三个特点： 
  <ul><li>UNIQUE 约束唯一标识数据库表中的每条记录</li><li>UNIQUE 和 主键约束均为列或列集合提供了唯一性的保证(<font color="red">同列唯一</font>)</li><li>主键约束会自动定义一个 UNIQUE 约束，或者说主键约束是一种特殊的 UNIQUE 约束。但是二者有明显的区别：每个表可以有多个 UNIQUE 约束，但只能有一个主键约束。</li></ul> </li></ul> 
<p>create table的时候 unique的约束创建<br> 下面的 SQL 在 Persons 表创建时在 P_Id 列上创建 UNIQUE 约束：<br> <strong>MYSQL中</strong>：</p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>Persons<span class="token punctuation">`</span></span>
<span class="token punctuation">(</span>
<span class="token identifier"><span class="token punctuation">`</span>P_Id<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
<span class="token identifier"><span class="token punctuation">`</span>LastName<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
<span class="token identifier"><span class="token punctuation">`</span>FirstName<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token identifier"><span class="token punctuation">`</span>Address<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token identifier"><span class="token punctuation">`</span>City<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token keyword">UNIQUE</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>P_Id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre> 
<p><strong>SQL Server / Oracle / MS Access</strong>中：</p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>Persons<span class="token punctuation">`</span></span>
<span class="token punctuation">(</span>
<span class="token identifier"><span class="token punctuation">`</span>P_Id<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">UNIQUE</span><span class="token punctuation">,</span>
<span class="token identifier"><span class="token punctuation">`</span>LastName<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
<span class="token identifier"><span class="token punctuation">`</span>FirstName<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token identifier"><span class="token punctuation">`</span>Address<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token identifier"><span class="token punctuation">`</span>City<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre> 
<p>命名 UNIQUE 约束，并定义多个列的 UNIQUE 约束:<br> <strong>MYSQL / SQL Server / Oracle / MS Access</strong> <font color="blue"> 所有都是</font>：</p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>Persons<span class="token punctuation">`</span></span>
<span class="token punctuation">(</span>
<span class="token identifier"><span class="token punctuation">`</span>P_Id<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
<span class="token identifier"><span class="token punctuation">`</span>LastName<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
<span class="token identifier"><span class="token punctuation">`</span>FirstName<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token identifier"><span class="token punctuation">`</span>Address<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token identifier"><span class="token punctuation">`</span>City<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token keyword">CONSTRAINT</span> uc_PersonID <span class="token keyword">UNIQUE</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>P_Id<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>LastName<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre> 
<p>ALTER TABLE 时的 UNIQUE 约束：<br> 当表已被创建时，在 P_Id 列创建 UNIQUE 约束:<br> <strong>MySQL / SQL Server / Oracle / MS Access</strong>中，<font color="red">增加约束</font>：</p> 
<pre><code class="prism language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>Persons<span class="token punctuation">`</span></span>
<span class="token keyword">ADD</span> <span class="token keyword">UNIQUE</span>（<span class="token identifier"><span class="token punctuation">`</span>P_Id<span class="token punctuation">`</span></span>）
</code></pre> 
<p><font color="blue">例如：</font>当表已被创建时，需命名 UNIQUE 约束，并定义多个列的 UNIQUE 约束:<br> <strong>MySQL / SQL Server / Oracle / MS Access</strong>：</p> 
<pre><code class="prism language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>Persons<span class="token punctuation">`</span></span>
<span class="token keyword">ADD</span> <span class="token keyword">CONSTRAINT</span> uc_PersonID <span class="token keyword">UNIQUE</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>P_Id<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>LastName<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
</code></pre> 
<p>constraint 是给取别名</p> 
<p>如需撤销 UNIQUE 约束 :<br> <strong>MySQL</strong>中：</p> 
<pre><code class="prism language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>Persons<span class="token punctuation">`</span></span>
<span class="token keyword">DROP</span> <span class="token keyword">INDEX</span> uc_PersonID
</code></pre> 
<p><strong>SQL Server / Oracle / MS Access</strong>中：</p> 
<pre><code class="prism language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>Persons<span class="token punctuation">`</span></span>
<span class="token keyword">DROP</span> <span class="token keyword">CONSTRAINT</span> uc_PersonID
</code></pre> 
<ul><li>PRIMARY KEY 主键约束<br> 唯一标识数据库表中的每条记录 ，简单的说，PRIMARY KEY = UNIQUE + NOT NULL ,从技术的角度来看，PRIMARY KEY 和 UNIQUE 有很多相似之处。但还是有以下区别： 
  <ul><li>NOT NULL UNIQUE 可以将表的一列或多列定义为唯一性属性，而 PRIMARY KEY 设为多列时，仅能保证多列之和是唯一的，具体到某一列可能会重复。</li><li>PRIMARY KEY 可以与外键配合，从而形成主从表的关系，而 NOT NULL UNIQUE 则做不到这一点</li><li>更大的区别在逻辑设计上。 PRIMARY KEY 一般在逻辑设计中用作记录标识，这也是设置 PRIMARY KEY 的本来用意，而 UNIQUE 只是为了保证域/域组的唯一性。</li></ul> </li></ul> 
<pre><code>如:
表一：用户 id (主键)，用户名
表二: 银行卡号 id (主键)，用户 id (外键)
则表一为主表，表二为从表。
</code></pre> 
<p>CREATE TABLE 时 添加 PRIMARY KEY 约束<br> 下面的 SQL 在 个人信息表 Persons 创建时，在 P_Id 列上添加 PRIMARY KEY 约束：<br> <strong>方式1：</strong></p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>Persons<span class="token punctuation">`</span></span>
<span class="token punctuation">(</span>
    <span class="token identifier"><span class="token punctuation">`</span>P_Id<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>LastName<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>FirstName<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>Address<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>City<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>P_Id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><strong>方式2：</strong></p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>Persons<span class="token punctuation">`</span></span>
<span class="token punctuation">(</span>
    <span class="token identifier"><span class="token punctuation">`</span>P_Id<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>LastName<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>FirstName<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>Address<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>City<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre> 
<p>由多个值一起构成主键：</p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>Persons<span class="token punctuation">`</span></span>
<span class="token punctuation">(</span>
    <span class="token identifier"><span class="token punctuation">`</span>P_Id<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>LastName<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>FirstName<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>Address<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>City<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">CONSTRAINT</span> pk_PersonID <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>P_Id<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>LastName<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre> 
<p>在已创建的表中添加主键：</p> 
<pre><code class="prism language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>Persons<span class="token punctuation">`</span></span>
<span class="token keyword">ADD</span> <span class="token keyword">CONSTRAINT</span> pk_PersonID <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>P_Id<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>LastName<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
</code></pre> 
<pre><code>注释：
如果您使用 ALTER TABLE 语句添加主键，必须把主键列声明为不包含 NULL 值（在表首次创建时）
</code></pre> 
<p>撤销主键：</p> 
<pre><code class="prism language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>Persons<span class="token punctuation">`</span></span>
<span class="token keyword">DROP</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span>
</code></pre> 
<p>另一种方式(取别名的主键，上一种方法其实也可以去除)：</p> 
<pre><code class="prism language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>Persons<span class="token punctuation">`</span></span>
<span class="token keyword">DROP</span> <span class="token keyword">CONSTRAINT</span> pk_PersonID
</code></pre> 
<ul><li>FOREIGN KEY 外键约束 
  <ul><li>一个表中的 FOREIGN KEY 指向另一个表中的 UNIQUE KEY 。</li><li>外键最根本的作用：保证数据的完整性和一致性。</li><li>外键约束是指用于在两个表之间建立关系，需要指定引用主表的哪一列。</li></ul> </li></ul> 
<p>CREATE TABLE 时的 SQL FOREIGN KEY 约束<br> 在 “Orders” 表创建时在 “P_Id” 列上创建 FOREIGN KEY 约束：</p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>Orders<span class="token punctuation">`</span></span>
<span class="token punctuation">(</span>
<span class="token identifier"><span class="token punctuation">`</span>O_Id<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
<span class="token identifier"><span class="token punctuation">`</span>OrderNo<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
<span class="token identifier"><span class="token punctuation">`</span>P_Id<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">,</span>
<span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>O_Id<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>P_Id<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> Persons<span class="token punctuation">(</span>P_Id<span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre> 
<p>写法2：</p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>Orders<span class="token punctuation">`</span></span>
<span class="token punctuation">(</span>
<span class="token identifier"><span class="token punctuation">`</span>O_Id<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
<span class="token identifier"><span class="token punctuation">`</span>OrderNo<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
P_Id <span class="token keyword">int</span> <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token keyword">REFERENCES</span> Persons<span class="token punctuation">(</span>P_Id<span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre> 
<pre><code>其中
NOT NULL 表示该字段不为空
REFERENCES 表示 引用一个表
</code></pre> 
<p>命名外键约束：</p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>Orders<span class="token punctuation">`</span></span>
<span class="token punctuation">(</span>
<span class="token identifier"><span class="token punctuation">`</span>O_Id<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
<span class="token identifier"><span class="token punctuation">`</span>OrderNo<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
<span class="token identifier"><span class="token punctuation">`</span>P_Id<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">,</span>
<span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>O_Id<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token keyword">CONSTRAINT</span> fk_PerOrders <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>P_Id<span class="token punctuation">)</span>
<span class="token keyword">REFERENCES</span> Persons<span class="token punctuation">(</span>P_Id<span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre> 
<pre><code>其中
CONSTRAINT 表示约束，后面接约束名称，常用于创建约束和删除约束；
</code></pre> 
<p>添加外键约束：<br> 写法1：</p> 
<pre><code class="prism language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>Orders<span class="token punctuation">`</span></span>
<span class="token keyword">ADD</span> <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>P_Id<span class="token punctuation">)</span>
<span class="token keyword">REFERENCES</span> Persons<span class="token punctuation">(</span>P_Id<span class="token punctuation">)</span>
</code></pre> 
<p>写法2：</p> 
<pre><code class="prism language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>Orders<span class="token punctuation">`</span></span>
<span class="token keyword">ADD</span> <span class="token keyword">CONSTRAINT</span> fk_PerOrders
<span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>P_Id<span class="token punctuation">)</span>
<span class="token keyword">REFERENCES</span> Persons<span class="token punctuation">(</span>P_Id<span class="token punctuation">)</span>
</code></pre> 
<p>撤销外键约束：</p> 
<pre><code class="prism language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>Orders<span class="token punctuation">`</span></span>
<span class="token keyword">DROP</span> <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> fk_PerOrders
</code></pre> 
<ul><li> <p>check 检查约束<br> 用于限制列中的值的范围，评估插入或修改后的值。满足条件的值将会插入表中，否则将放弃插入操作。 可以为同一列指定多个 CHECK 约束。<br> CHECK 约束既可以用于某一列也可以用于某张表：<br> 1、如果对单个列定义 CHECK 约束，那么该列只允许特定的值。<br> 2、如果对一个表定义 CHECK 约束，那么此约束会基于行中其他列的值在特定的列中对值进行限制。</p> <p>定义 CHECK 约束条件在某种程度上类似于编写查询的 WHERE 子句，使用不同的比较运算符（例如 AND、OR、BETWEEN、IN、LIKE 和 IS NULL）编写其布尔表达式，该布尔表达式将返回 TRUE、FALSE 或 UNKNOWN 。 当条件中存在 NULL 值时，CHECK约束将返回 UNKNOWN 值。</p> </li></ul> 
<p>在创建课程表 courses 时，给学生总数 student_count 字段加上一个大于 0 的约束：</p> 
<pre><code class="prism language-sql"><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">,</span>
<span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token identifier"><span class="token punctuation">`</span>student_count<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">,</span>
<span class="token identifier"><span class="token punctuation">`</span>created_at<span class="token punctuation">`</span></span> <span class="token keyword">date</span><span class="token punctuation">,</span>
<span class="token identifier"><span class="token punctuation">`</span>teacher_id<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">,</span>
<span class="token keyword">CHECK</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>student_count<span class="token punctuation">`</span></span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre> 
<p>为多个列添加 CHECK 约束：</p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>courses<span class="token punctuation">`</span></span>
<span class="token punctuation">(</span>
<span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">,</span>
<span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token identifier"><span class="token punctuation">`</span>student_count<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">,</span>
<span class="token identifier"><span class="token punctuation">`</span>created_at<span class="token punctuation">`</span></span> <span class="token keyword">date</span><span class="token punctuation">,</span>
<span class="token identifier"><span class="token punctuation">`</span>teacher_id<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">,</span>
<span class="token keyword">CHECK</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>student_count<span class="token punctuation">`</span></span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">AND</span> <span class="token identifier"><span class="token punctuation">`</span>teacher_id<span class="token punctuation">`</span></span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre> 
<p>表已存在时添加 CHECK 约束:</p> 
<pre><code class="prism language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>courses<span class="token punctuation">`</span></span> 
<span class="token keyword">ADD</span> <span class="token keyword">CHECK</span> <span class="token punctuation">(</span> <span class="token identifier"><span class="token punctuation">`</span>student_count<span class="token punctuation">`</span></span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>撤销 CHECK 约束:</p> 
<pre><code class="prism language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>courses<span class="token punctuation">`</span></span> 
<span class="token keyword">DROP</span> <span class="token keyword">CHECK</span> chk_courses
</code></pre> 
<ul><li>DEFAULT 默认约束<br> 1、DEFAULT 约束用于向列中插入默认值。<br> 2、如果没有规定其他的值，那么会将默认值添加到所有的新记录。<br> 例如女同学较多，性别就可以默认为“女”，如果插入一条新的记录时没有为这个字段赋值，那么系统会自动为这个字段赋值为“女”。</li></ul> 
<p>语法：<br> <code>&lt;字段名&gt; &lt;数据类型&gt; DEFAULT &lt;默认值&gt;</code></p> 
<p><strong>CREATE TABLE 时的 DEFAULT 约束:</strong></p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>Persons<span class="token punctuation">`</span></span>
<span class="token punctuation">(</span>
    <span class="token identifier"><span class="token punctuation">`</span>P_Id<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>LastName<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>FirstName<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>Address<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>City<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token string">'Sandnes'</span>
<span class="token punctuation">)</span>
</code></pre> 
<p><strong>ALTER TABLE 时的 DEFAULT 约束:</strong></p> 
<pre><code class="prism language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>Persons<span class="token punctuation">`</span></span>
<span class="token keyword">ALTER</span> <span class="token identifier"><span class="token punctuation">`</span>City<span class="token punctuation">`</span></span> <span class="token keyword">SET</span> <span class="token keyword">DEFAULT</span> <span class="token string">'SANDNES'</span>
</code></pre> 
<p><strong>撤销 DEFAULT 约束:</strong></p> 
<pre><code class="prism language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>Persons<span class="token punctuation">`</span></span>
<span class="token keyword">ALTER</span> <span class="token identifier"><span class="token punctuation">`</span>City<span class="token punctuation">`</span></span> <span class="token keyword">DROP</span> <span class="token keyword">DEFAULT</span>
</code></pre> 
<h3><a id="_815"></a>连结</h3> 
<p>联结是一种机制，用于在一条 SELECT 语句中关联多个表，返回一组输出。<br> 这个时候就要说一下联结中的两大主角——主键（PRIMARY KEY）和外键（FOREIGN KEY）</p> 
<p>JOIN 连接子句</p> 
<ul><li>INNER JOIN：内联结 如果表中有至少一个匹配，则返回行</li><li>LEFT JOIN：左联结 即使右表中没有匹配，也从左表返回所有的行</li><li>RIGHT JOIN：右联结 即使左表中没有匹配，也从右表返回所有的行</li><li>FULL JOIN：全联结 只要其中一个表中存在匹配，则返回行</li><li>CROSS JOIN：交叉联结 又称笛卡尔积，两个表数据一一对应，返回结果的行数等于两个表行数的乘积</li><li>. 内连接 INNER JOIN 简单的说，内连接就是取两个表的交集，返回的结果就是连接的两张表中都满足条件的部分</li></ul> 
<h4><a id="_INNER_JOIN_827"></a>内连接 INNER JOIN</h4> 
<p>语法：</p> 
<pre><code class="prism language-sql">写法一：
<span class="token keyword">SELECT</span> <span class="token identifier"><span class="token punctuation">`</span>table1<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>column1<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>table2<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>column2<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>table1<span class="token punctuation">`</span></span>
<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> <span class="token identifier"><span class="token punctuation">`</span>table2<span class="token punctuation">`</span></span>
<span class="token keyword">ON</span> <span class="token identifier"><span class="token punctuation">`</span>table1<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>common_field<span class="token punctuation">`</span></span> <span class="token operator">=</span> <span class="token identifier"><span class="token punctuation">`</span>table2<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>common_field<span class="token punctuation">`</span></span><span class="token punctuation">;</span>

写法二：
<span class="token keyword">SELECT</span> <span class="token identifier"><span class="token punctuation">`</span>table1<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>column1<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>table2<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>column2<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>table1<span class="token punctuation">`</span></span>
<span class="token keyword">JOIN</span> <span class="token identifier"><span class="token punctuation">`</span>table2<span class="token punctuation">`</span></span>
<span class="token keyword">ON</span> <span class="token identifier"><span class="token punctuation">`</span>table1<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>common_field<span class="token punctuation">`</span></span> <span class="token operator">=</span> <span class="token identifier"><span class="token punctuation">`</span>table2<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>common_field<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
</code></pre> 
<p>需要注意的是，联结条件需使用特定的 ON 子句给出。</p> 
<p><font color="blue">例如</font>：请编写 SQL 语句，将课程表 courses 和教师表 teachers 进行内连接，查询 “Eastern Heretic” 老师所教的所有课程的课程名和课程编号 , 且结果列名分别以课程编号 id 、课程名称 course_name 和教师姓名 teacher_name 显示。</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> c<span class="token punctuation">.</span>id<span class="token punctuation">,</span>c<span class="token punctuation">.</span>name <span class="token keyword">as</span> course_name<span class="token punctuation">,</span>t<span class="token punctuation">.</span>name <span class="token keyword">as</span> teacher_name 
<span class="token keyword">from</span> courses c <span class="token keyword">join</span> teachers t <span class="token keyword">on</span> c<span class="token punctuation">.</span>teacher_id <span class="token operator">=</span> t<span class="token punctuation">.</span>id
<span class="token keyword">where</span> t<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'Eastern Heretic'</span>
</code></pre> 
<h4><a id="_OUTER_JOIN_850"></a>外连接 OUTER JOIN</h4> 
<p>在MySQL中，外连接查询会返回所操作的表中至少一个表的所有数据记录。在MySQL中，数据查询通过SQL语句 “OUTER JOIN…ON” 来实现，外连接查询可以分为以下三类：</p> 
<ul><li> <p>左外连接<br> 左外连接的结果包括 LEFT OUTER 子句中指定的左表的所有行，而不仅仅是连接列所匹配的行，这就意味着，左连接会返回左表中的所有记录，加上右表中匹配到的记录。如果左表的某行在右表中没有匹配行，那么在相关联的结果行中，右表的所有选择列表均为空值。</p> </li><li> <p>右外连接<br> 外连接查询中的右外连接是指新关系中执行匹配条件时，以关键字 RIGHT JOIN 右边的表为参考表，如果右表的某行在左表中没有匹配行，左表就返回空值。</p> </li><li> <p>全外连接<br> FULL OUTER JOIN 关键字只要左表（table1）和右表（table2）其中一个表中存在匹配，则返回行。FULL OUTER JOIN 关键字结合了 LEFT JOIN 和 RIGHT JOIN 的结果。<br> mysql不支持全连接(full join)，可以使用 left join+ union+right join<br> (SELECT * from a left JOIN b on a.name=b.id) UNION (SELECT * from a RIGHT JOIN b on a.name=b.id );</p> </li></ul> 
<p>查询语法：</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> column_name <span class="token number">1</span><span class="token punctuation">,</span>column_name <span class="token number">2</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> column_name n
    <span class="token keyword">FROM</span> table1
        <span class="token keyword">LEFT</span> <span class="token operator">|</span> <span class="token keyword">RIGHT</span> <span class="token operator">|</span> <span class="token keyword">FULL</span>  <span class="token punctuation">(</span><span class="token keyword">OUTER</span><span class="token punctuation">)</span> <span class="token keyword">JOIN</span> table2
        <span class="token keyword">ON</span> CONDITION<span class="token punctuation">;</span>
</code></pre> 
<p>在上述语句中，参数 column_name 表示所要查询的字段名字，来源于所连接的表 table1 和 table2，关键字 OUTER JOIN 表示表进行外连接，参数 CONDITION 表示进行匹配的条件。</p> 
<p>测试样例表：<br> <img src="https://images2.imgbox.com/3f/7f/oCRddUpr_o.png" alt="测试表"></p> 
<p><font color="blue">例如1：</font><br> 请编写 SQL 语句，将教师表 teachers 和课程表 courses 进行左连接，查询来自中国（讲师国籍 country =‘CN’ ）的教师名称以及所教课程名称，结果列名请分别以课程名称 course_name ，教师名称 teacher_name 显示。</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> c<span class="token punctuation">.</span>name <span class="token keyword">as</span> course_name<span class="token punctuation">,</span>t<span class="token punctuation">.</span>name  <span class="token keyword">as</span> teacher_name
<span class="token keyword">from</span> teachers t <span class="token keyword">left</span> <span class="token keyword">join</span> courses c <span class="token keyword">on</span> t<span class="token punctuation">.</span>id <span class="token operator">=</span> c<span class="token punctuation">.</span>teacher_id
<span class="token keyword">where</span> country <span class="token operator">=</span><span class="token string">'CN'</span>
</code></pre> 
<p><font color="blue">例如2：</font><br> 请编写 SQL 语句，将课程表 courses 和教师表 teachers 进行右连接，查询来自中国（讲师国籍 country =‘CN’ ）的教师姓名，邮箱以及所教课程名称，结果列名请分别以课程名称 course_name ，教师名称 teacher_name ，教师邮箱 teacher_email 显示。</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> c<span class="token punctuation">.</span>name <span class="token keyword">as</span> course_name<span class="token punctuation">,</span>t<span class="token punctuation">.</span>name <span class="token keyword">as</span> teacher_name<span class="token punctuation">,</span>t<span class="token punctuation">.</span>email <span class="token keyword">as</span> teacher_email
<span class="token keyword">from</span> courses c <span class="token keyword">right</span> <span class="token keyword">join</span> teachers t <span class="token keyword">on</span> c<span class="token punctuation">.</span>teacher_id <span class="token operator">=</span> t<span class="token punctuation">.</span>id
<span class="token keyword">where</span> country <span class="token operator">=</span> <span class="token string">'CN'</span>
</code></pre> 
<p><font color="blue">例如3：</font><br> 将课程表 courses 和教师表 teachers 进行外连接，查询所有课程名称以及与其相互对应的教师名称和教师国籍，结果列名请分别以课程名称 course_name 、教师名称 teacher_name 、教师国籍 teacher_country 显示。</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> c<span class="token punctuation">.</span>name <span class="token keyword">as</span> course_name<span class="token punctuation">,</span> t<span class="token punctuation">.</span>name <span class="token keyword">as</span> teacher_name<span class="token punctuation">,</span>t<span class="token punctuation">.</span>country <span class="token keyword">as</span> teacher_country
<span class="token keyword">from</span> courses c <span class="token keyword">left</span> <span class="token keyword">join</span> teachers t <span class="token keyword">on</span> c<span class="token punctuation">.</span>teacher_id <span class="token operator">=</span> t<span class="token punctuation">.</span>id
<span class="token keyword">union</span>
<span class="token keyword">select</span> c<span class="token punctuation">.</span>name <span class="token keyword">as</span> course_name<span class="token punctuation">,</span> t<span class="token punctuation">.</span>name <span class="token keyword">as</span> teacher_name<span class="token punctuation">,</span>t<span class="token punctuation">.</span>country <span class="token keyword">as</span> teacher_country
<span class="token keyword">from</span> courses c <span class="token keyword">right</span> <span class="token keyword">join</span> teachers t <span class="token keyword">on</span> c<span class="token punctuation">.</span>teacher_id <span class="token operator">=</span> t<span class="token punctuation">.</span>id
</code></pre> 
<h4><a id="_CROSS_JOIN_902"></a>交叉连接 CROSS JOIN</h4> 
<p>与内连接和外连接相比，交叉连接非常简单，因为它不存在 ON 子句<br> 交叉连接：返回左表中的所有行，左表中的每一行与右表中的所有行组合。即将两个表的数据一一对应，其查询结果的行数为左表中的行数乘以右表中的行数。</p> 
<p>CROSS JOIN（交叉连接）的结果也称作笛卡尔积<br> 笛卡尔乘积是指在数学中，两个集合 X 和 Y 的笛卡尓积（Cartesian product），又称直积，表示为X × Y，第一个对象是 X 的成员而第二个对象是 Y 的所有可能有序对的其中一个成员。</p> 
<p>定义方式：<br> 交叉连接有两种定义方式，分为隐式连接和显式连接。两种定义方式的查询结果是相同的。<br> 隐式交叉连接：不需要使用 CROSS JOIN 关键字，只要在 SELECT 语句的 FROM 语句后将要进行交叉连接的表名列出即可，这种方式基本上可以被任意数据库系统支持。<br> 隐式语法：</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span>  <span class="token identifier"><span class="token punctuation">`</span>c<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token keyword">AS</span> <span class="token identifier"><span class="token punctuation">`</span>course_name<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>t<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token keyword">AS</span> <span class="token identifier"><span class="token punctuation">`</span>teacher_name<span class="token punctuation">`</span></span>
<span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>courses<span class="token punctuation">`</span></span> <span class="token identifier"><span class="token punctuation">`</span>c<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>teachers<span class="token punctuation">`</span></span> <span class="token identifier"><span class="token punctuation">`</span>t<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
</code></pre> 
<p>显示语法：</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span>  <span class="token identifier"><span class="token punctuation">`</span>c<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token keyword">AS</span> <span class="token identifier"><span class="token punctuation">`</span>course_name<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>t<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token keyword">AS</span> <span class="token identifier"><span class="token punctuation">`</span>teacher_name<span class="token punctuation">`</span></span>
<span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>courses<span class="token punctuation">`</span></span> <span class="token identifier"><span class="token punctuation">`</span>c<span class="token punctuation">`</span></span>
<span class="token keyword">CROSS</span> <span class="token keyword">JOIN</span> <span class="token identifier"><span class="token punctuation">`</span>teachers<span class="token punctuation">`</span></span> <span class="token identifier"><span class="token punctuation">`</span>t<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
</code></pre> 
<h2><a id="_924"></a>以下为知识进阶（工作需掌握）</h2> 
<h2><a id="group_byhaving_925"></a>查询进阶（分组查询（group by，having），子查询）</h2> 
<h3><a id="_group_by_926"></a>分组查询 group by</h3> 
<p>语法：</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token identifier"><span class="token punctuation">`</span>column_name<span class="token punctuation">`</span></span><span class="token punctuation">,</span> aggregate_function<span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>column_name<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>table_name<span class="token punctuation">`</span></span>
<span class="token keyword">WHERE</span> <span class="token identifier"><span class="token punctuation">`</span>column_name<span class="token punctuation">`</span></span> operator <span class="token keyword">value</span>
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token identifier"><span class="token punctuation">`</span>column_name<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
</code></pre> 
<p><font color="blue">例如：</font>查询教师表 teachers，统计不同年龄教师的人数，并将结果按照年龄从大到小排列，返回列名显示为 age_count：</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span>  age <span class="token punctuation">,</span><span class="token function">count</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span> <span class="token keyword">as</span> age_count
<span class="token keyword">from</span> teachers 
<span class="token keyword">group</span> <span class="token keyword">by</span> age
<span class="token keyword">order</span> <span class="token keyword">by</span> age <span class="token keyword">DESC</span>
</code></pre> 
<p><font color="blue">例如2：</font>查询教师表 teachers 和课程表 courses,统计每个老师教授课程的数量，并将结果按课程数量从大到小排列，如果相同课程数量则按照教师姓名排列，返回列名老师姓名列名显示为 teacher_name ，课程数量列名显示为 course_count：</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> t<span class="token punctuation">.</span>name <span class="token keyword">as</span> teacher_name<span class="token punctuation">,</span>IFNULL<span class="token punctuation">(</span><span class="token function">count</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">as</span> course_count
<span class="token keyword">from</span> courses c <span class="token keyword">right</span> <span class="token keyword">join</span> teachers t <span class="token keyword">on</span> c<span class="token punctuation">.</span>teacher_id <span class="token operator">=</span> t<span class="token punctuation">.</span>id
<span class="token keyword">group</span> <span class="token keyword">by</span> teacher_name
<span class="token keyword">order</span> <span class="token keyword">by</span> course_count <span class="token keyword">DESC</span><span class="token punctuation">,</span>teacher_name
</code></pre> 
<h3><a id="HAVING__948"></a>HAVING 子句</h3> 
<p>我们在使用 WHERE 条件子句时会发现其不能与聚合函数联合使用，为解决这一点，SQL 中提供了 HAVING 子句。在使用时， HAVING 子句经常与 GROUP BY 联合使用，HAVING 子句就是对分组统计函数进行过滤的子句<br> HAVING 子句对于 GROUP BY 子句设置条件的方式其实与 WHERE 子句与 SELECT 的方式类似，语法也相近，但 WHERE 子句搜索条件是在分组操作之前，而 HAVING 则是在之后<br> <font color="red">语法</font>：</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span>   <span class="token identifier"><span class="token punctuation">`</span>column_name<span class="token punctuation">`</span></span><span class="token punctuation">,</span> aggregate_function<span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>column_name<span class="token punctuation">`</span></span><span class="token punctuation">)</span> 
<span class="token keyword">FROM</span>     <span class="token identifier"><span class="token punctuation">`</span>table_name<span class="token punctuation">`</span></span> 
<span class="token keyword">WHERE</span>    <span class="token identifier"><span class="token punctuation">`</span>column_name<span class="token punctuation">`</span></span> operator <span class="token keyword">value</span> 
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token identifier"><span class="token punctuation">`</span>column_name<span class="token punctuation">`</span></span> 
<span class="token keyword">HAVING</span>   aggregate_function<span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>column_name<span class="token punctuation">`</span></span><span class="token punctuation">)</span> operator <span class="token keyword">value</span><span class="token punctuation">;</span>
</code></pre> 
<p><font color="blue">例如：</font>查询 teachers 表中，各个国家所有教师的平均年龄大于所有国家教师的平均年龄的教师信息：</p> 
<pre><code class="prism language-sql">待补充
</code></pre> 
<h3><a id="_964"></a>简单子查询</h3> 
<p><font color="red">语法</font>：</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token identifier"><span class="token punctuation">`</span>column_name(s)<span class="token punctuation">`</span></span>
<span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>table_name<span class="token punctuation">`</span></span>
<span class="token keyword">WHERE</span> <span class="token identifier"><span class="token punctuation">`</span>column_name<span class="token punctuation">`</span></span> OPERATOR <span class="token punctuation">(</span>
    <span class="token keyword">SELECT</span> <span class="token identifier"><span class="token punctuation">`</span>column_name(s)<span class="token punctuation">`</span></span>
    <span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>table_name<span class="token punctuation">`</span></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-sql"><span class="token number">1</span>、子查询方法：
<span class="token keyword">select</span> name <span class="token keyword">from</span> teachers
<span class="token keyword">where</span> id <span class="token operator">=</span> <span class="token punctuation">(</span>
    <span class="token keyword">select</span> teacher_id <span class="token keyword">from</span> courses
    <span class="token keyword">where</span> name <span class="token operator">=</span> <span class="token string">'Big Data'</span>
<span class="token punctuation">)</span>
<span class="token number">2</span>、表联结方法：
<span class="token keyword">select</span> t<span class="token punctuation">.</span>name <span class="token keyword">from</span>
teachers t <span class="token keyword">join</span> courses c <span class="token keyword">on</span> t<span class="token punctuation">.</span>id <span class="token operator">=</span> c<span class="token punctuation">.</span>teacher_id
<span class="token keyword">where</span> c<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'Big Data'</span>
</code></pre> 
<p>方法一耗时：<br> <img src="https://images2.imgbox.com/90/84/ONXqTw0J_o.png" alt="在这里插入图片描述"><br> 方法二耗时：<br> <img src="https://images2.imgbox.com/4f/28/QGwji8VA_o.png" alt="在这里插入图片描述"></p> 
<p>对于 INSERT 语句中的子查询来说，首先是使用子查询的 SELECT 语句找到需要插入的数据，之后将返回的数据插入到另一个表中。在子查询中所选择的数据可以用任何字符、日期或数字函数修改：<br> insert into 插入子查询：<br> <font color="red">语法：</font></p> 
<pre><code class="prism language-sql"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>table_name<span class="token punctuation">`</span></span>
	<span class="token keyword">SELECT</span> <span class="token identifier"><span class="token punctuation">`</span>colnum_name(s)<span class="token punctuation">`</span></span>
	<span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>table_name<span class="token punctuation">`</span></span>
	<span class="token punctuation">[</span> <span class="token keyword">WHERE</span> <span class="token keyword">VALUE</span> OPERATOR <span class="token punctuation">]</span>
</code></pre> 
<p><font color="blue">例如：</font>备份teachers表的数据</p> 
<pre><code class="prism language-sql"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>teachers_bkp<span class="token punctuation">`</span></span> 
<span class="token keyword">SELECT</span> <span class="token operator">*</span> 
<span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>teachers<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
</code></pre> 
<p>update 子查询用法：<br> <font color="red">语法：</font></p> 
<pre><code class="prism language-sql"><span class="token keyword">UPDATE</span> <span class="token identifier"><span class="token punctuation">`</span>table_name<span class="token punctuation">`</span></span> 
<span class="token keyword">SET</span> <span class="token identifier"><span class="token punctuation">`</span>column_name<span class="token punctuation">`</span></span> <span class="token operator">=</span> <span class="token identifier"><span class="token punctuation">`</span>new_value<span class="token punctuation">`</span></span>
<span class="token keyword">WHERE</span> <span class="token identifier"><span class="token punctuation">`</span>column_name<span class="token punctuation">`</span></span> OPERATOR 
   <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token identifier"><span class="token punctuation">`</span>column_name<span class="token punctuation">`</span></span>
   <span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>table_name<span class="token punctuation">`</span></span>
   <span class="token punctuation">[</span><span class="token keyword">WHERE</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>
</code></pre> 
<p>DELETE语句的子查询<br> <font color="red">语法</font>：</p> 
<pre><code class="prism language-sql"><span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>table_name<span class="token punctuation">`</span></span>
<span class="token keyword">WHERE</span> <span class="token identifier"><span class="token punctuation">`</span>column_name<span class="token punctuation">`</span></span> OPERATOR 
   <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token identifier"><span class="token punctuation">`</span>column_name<span class="token punctuation">`</span></span>
   <span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>table_name<span class="token punctuation">`</span></span>  
   <span class="token punctuation">[</span><span class="token keyword">WHERE</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>
</code></pre> 
<p><font color="blue">例如：</font>删除教师表 teachers 中在 2020 年前（不包括 2020 年）创建过课程的教师</p> 
<pre><code class="prism language-sql"><span class="token keyword">delete</span> <span class="token keyword">from</span> teachers 
<span class="token keyword">where</span> id <span class="token operator">in</span> <span class="token punctuation">(</span>
    <span class="token keyword">select</span> <span class="token keyword">distinct</span> teacher_id <span class="token keyword">from</span> courses 
    <span class="token keyword">where</span> created_at <span class="token operator">&lt;</span> <span class="token string">'2020-01-01'</span>
<span class="token punctuation">)</span>
</code></pre> 
<h3><a id="_1034"></a>子查询进阶</h3> 
<h4><a id="_1035"></a>内联视图子查询</h4> 
<p>范例：现需要查询国籍为美国（USA），且年龄最大的教师，请使用内联视图子查询实现。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> <span class="token punctuation">(</span>
	<span class="token keyword">SELECT</span> <span class="token operator">*</span>
	<span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>teachers<span class="token punctuation">`</span></span>
	<span class="token keyword">WHERE</span> <span class="token identifier"><span class="token punctuation">`</span>country<span class="token punctuation">`</span></span> <span class="token operator">=</span> <span class="token string">'USA'</span>
<span class="token punctuation">)</span> <span class="token identifier"><span class="token punctuation">`</span>T<span class="token punctuation">`</span></span>
<span class="token keyword">WHERE</span> <span class="token identifier"><span class="token punctuation">`</span>age<span class="token punctuation">`</span></span> <span class="token operator">=</span> <span class="token punctuation">(</span>
	<span class="token keyword">SELECT</span> <span class="token function">MAX</span><span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>age<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
	<span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>teachers<span class="token punctuation">`</span></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="IN_1049"></a>IN操作符的多行子查询</h4> 
<p>范例：现需要查询国籍为美国（USA）的教师所开的所有课程，请使用 IN 操作符进行多行子查询。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span>
<span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>courses<span class="token punctuation">`</span></span>
<span class="token keyword">WHERE</span> <span class="token identifier"><span class="token punctuation">`</span>teacher_id<span class="token punctuation">`</span></span> <span class="token operator">IN</span> <span class="token punctuation">(</span>
	<span class="token keyword">SELECT</span> <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span>
	<span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>teachers<span class="token punctuation">`</span></span>
	<span class="token keyword">WHERE</span> <span class="token identifier"><span class="token punctuation">`</span>country<span class="token punctuation">`</span></span> <span class="token operator">=</span> <span class="token string">'USA'</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="ANY_1061"></a>ANY操作符的多行子查询</h4> 
<p>范例：现需要查询学生上课人数超过 “Eastern Heretic” 的任意一门课的学生人数的课程信息，请使用 ANY 操作符实现多行子查询。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>courses<span class="token punctuation">`</span></span>
<span class="token keyword">WHERE</span> <span class="token identifier"><span class="token punctuation">`</span>student_count<span class="token punctuation">`</span></span> <span class="token operator">&gt;</span> <span class="token keyword">ANY</span> <span class="token punctuation">(</span>
		<span class="token keyword">SELECT</span> <span class="token identifier"><span class="token punctuation">`</span>student_count<span class="token punctuation">`</span></span>
		<span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>courses<span class="token punctuation">`</span></span>
		<span class="token keyword">WHERE</span> <span class="token identifier"><span class="token punctuation">`</span>teacher_id<span class="token punctuation">`</span></span> <span class="token operator">=</span> <span class="token punctuation">(</span>
			<span class="token keyword">SELECT</span> <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span>
			<span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>teachers<span class="token punctuation">`</span></span>
			<span class="token keyword">WHERE</span> <span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token operator">=</span> <span class="token string">'Eastern Heretic'</span>
		<span class="token punctuation">)</span>
	<span class="token punctuation">)</span>
	<span class="token operator">AND</span> <span class="token identifier"><span class="token punctuation">`</span>teacher_id<span class="token punctuation">`</span></span> <span class="token operator">&lt;&gt;</span> <span class="token punctuation">(</span>
		<span class="token keyword">SELECT</span> <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span>
		<span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>teachers<span class="token punctuation">`</span></span>
		<span class="token keyword">WHERE</span> <span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token operator">=</span> <span class="token string">'Eastern Heretic'</span>
	<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="ALL__1081"></a>ALL 操作符的多行子查询</h4> 
<p>范例：现需要查询学生人数超过 ”Western Venom“ 所有课程学生人数的课程信息，请使用 ALL 操作符实现多行子查询。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>courses<span class="token punctuation">`</span></span>
<span class="token keyword">WHERE</span> <span class="token identifier"><span class="token punctuation">`</span>student_count<span class="token punctuation">`</span></span> <span class="token operator">&gt;</span> <span class="token keyword">ALL</span> <span class="token punctuation">(</span>
	<span class="token keyword">SELECT</span> <span class="token identifier"><span class="token punctuation">`</span>student_count<span class="token punctuation">`</span></span>
	<span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>courses<span class="token punctuation">`</span></span>
	<span class="token keyword">WHERE</span> <span class="token identifier"><span class="token punctuation">`</span>teacher_id<span class="token punctuation">`</span></span> <span class="token operator">=</span> <span class="token punctuation">(</span>
		<span class="token keyword">SELECT</span> <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span>
		<span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>teachers<span class="token punctuation">`</span></span>
		<span class="token keyword">WHERE</span> <span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token operator">=</span> <span class="token string">'Western Venom'</span>
	<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="_1096"></a>多列子查询</h4> 
<p>当是多行多列子查询时，主查询语句的条件语句中引用子查询结果时必须用多行比较符号（IN，ANY，ALL 等）来进行比较。</p> 
<p>范例：现需要找到每个国家年龄最大的教师，请编写 SQL 语句实现多列子查询</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>age<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>country<span class="token punctuation">`</span></span> 
<span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>teachers<span class="token punctuation">`</span></span> 
<span class="token keyword">WHERE</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>country<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>age<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token operator">IN</span> <span class="token punctuation">(</span> 
        <span class="token keyword">SELECT</span> <span class="token identifier"><span class="token punctuation">`</span>country<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token function">MAX</span><span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>age<span class="token punctuation">`</span></span><span class="token punctuation">)</span> 
        <span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>teachers<span class="token punctuation">`</span></span> 
        <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token identifier"><span class="token punctuation">`</span>country<span class="token punctuation">`</span></span> 
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="having_1109"></a>having子句中的子查询</h4> 
<p>当子查询出现在 HAVING 子句中时，像 HAVING 子句中的任何表达式一样，表示要进行分组过滤，它被用作行组选择的一部分，一般返回单行单列的数据</p> 
<p>范例：现需要计算每位教师所开课程的平均学生人数与全部课程的平均学生人数，比较其大小，最后返回超过全部课程平均学生人数的教师姓名，请编写相应的 SQL 语句实现。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span>
<span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>teachers<span class="token punctuation">`</span></span>
<span class="token keyword">WHERE</span> <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token operator">IN</span> <span class="token punctuation">(</span>
	<span class="token keyword">SELECT</span> <span class="token identifier"><span class="token punctuation">`</span>teacher_id<span class="token punctuation">`</span></span>
	<span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>courses<span class="token punctuation">`</span></span>
	<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token identifier"><span class="token punctuation">`</span>teacher_id<span class="token punctuation">`</span></span>
	<span class="token keyword">HAVING</span> <span class="token function">AVG</span><span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>student_count<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token punctuation">(</span>
		<span class="token keyword">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>student_count<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
		<span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>courses<span class="token punctuation">`</span></span>
	<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="_1128"></a>小结练习：</h3> 
<p>描述：请编写 SQL 语句，连接 courses 与 teachers 表，统计不同国籍教师所开课程的学生总数，对于没有任课的老师，学生总人数计为 0 。最后查询教师国籍是 ‘U’ 开头且这个国籍的所有教师的学生总数在 2000 到 5000 之间（包括 2000 和 5000）的教师国籍及学生总数 （别名为 student_count ），结果按照学生总数降序排列，如果学生总数相同，则按照教师国籍升序排列。<br> 两个表字段如下所示：<br> <img src="https://images2.imgbox.com/a6/17/HyWtVMMz_o.png" alt="在这里插入图片描述"><br> <font color="red">先在这儿思考一下吧！！！</font></p> 
<p>练习答案：</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> country<span class="token punctuation">,</span> <span class="token function">sum</span><span class="token punctuation">(</span>student_count<span class="token punctuation">)</span> student_count
<span class="token keyword">from</span> courses c <span class="token keyword">left</span> <span class="token keyword">join</span> teachers t <span class="token keyword">on</span> c<span class="token punctuation">.</span>teacher_id <span class="token operator">=</span> t<span class="token punctuation">.</span>id 
<span class="token keyword">where</span> t<span class="token punctuation">.</span>id <span class="token operator">in</span> <span class="token punctuation">(</span>
    <span class="token keyword">select</span> id <span class="token keyword">from</span> teachers 
    <span class="token keyword">where</span> country <span class="token operator">like</span> <span class="token string">"U%"</span>
<span class="token punctuation">)</span> 
<span class="token keyword">group</span> <span class="token keyword">by</span> t<span class="token punctuation">.</span>country
<span class="token keyword">having</span> <span class="token function">sum</span><span class="token punctuation">(</span>student_count<span class="token punctuation">)</span> <span class="token operator">between</span> <span class="token number">2000</span> <span class="token operator">and</span> <span class="token number">5000</span>
<span class="token keyword">order</span> <span class="token keyword">by</span> student_count <span class="token keyword">desc</span> <span class="token punctuation">,</span> country <span class="token keyword">asc</span>
</code></pre> 
<h2><a id="MySQLtransaction_1147"></a>MySQL事务（transaction）</h2> 
<p>MySQL 为我们提供了以下重要语句来控制事务：</p> 
<ul><li>为了启动一个事务，你使用 START TRANSACTION 语句。BEGIN 或 BEGIN WORK 是 START TRANSACTION 的别名。</li><li>要提交当前事务并使其变化永久化，你要使用 COMMIT 语句。</li><li>要回滚当前事务并取消其变化，你可以使用 ROLLBACK 语句。</li><li>要禁用或启用当前事务的自动提交模式，你可以使用 SET autocommit 语句。</li></ul> 
<p>默认情况下，MySQL 自动将更改永久性地提交给数据库。要强迫 MySQL 不自动提交更改，你可以使用以下语句：</p> 
<pre><code class="prism language-sql"><span class="token keyword">SET</span> autocommit <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token comment">-- OR --</span>
<span class="token keyword">SET</span> autocommit <span class="token operator">=</span> <span class="token keyword">OFF</span>
</code></pre> 
<h2><a id="_1161"></a>锁</h2> 
<h3><a id="_1162"></a>锁的认识</h3> 
<p>锁：<font color="red">计算机协调多个进程或线程并发访问某一资源的机制。</font></p> 
<p>锁的重要性：<br> 在数据库中，除了传统的计算资源（CPU、RAM、I\O等）的争抢，数据也是一种供多用户共享的资源。</p> 
<p>因此，如何保证数据并发访问的一致性，有效性，是所有数据库必须要解决的问题。<br> 锁冲突也是影响数据库并发访问性能的一个重要因素，因此锁对数据库尤其重要。</p> 
<p>锁的缺点：<br> 加锁是消耗资源的，锁的各种操作，包括：获得锁、检测锁是否已经解除、释放锁等，都会增加系统的开销。<br> Oracle 数据库的事务隔离级别基本都是读已提交（READ-COMMITTED），所有的锁也针对这个级别来总结</p> 
<pre><code>MySQL 默认隔离级别是 Repeatable read（可重复读）
</code></pre> 
<p>查看自己的数据库的事务隔离级别<br> 命令：</p> 
<pre><code class="prism language-sql"><span class="token keyword">SHOW</span> VARIABLES <span class="token operator">like</span> <span class="token string">'%isolation%'</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="InnoDB_1182"></a>InnoDB锁的种类之自增锁</h3> 
<p>查询当前数据库的自增锁模式：</p> 
<pre><code class="prism language-sql"><span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">'%innodb_autoinc_lock_mode%'</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/26/cd/v51S2b0p_o.png" alt="在这里插入图片描述"></p> 
<ul><li> <p>0：traditonal 每次 insert 语句执行都会产生表锁</p> </li><li> <p>1：consecutive simple insert 会获得批量的锁，保证一批插入自增序列的连续性，插入之前提前释放锁，在这个模式下你会发现当你 insert 多条数据回滚的时候虽然 DB 没有插入数据，但是自增 ID 已经增长了，也是数据库默认的级别</p> </li><li> <p>2：interleaved 不会锁表，实时插入，并发最高，但是基于主从的复制是不安全的，感兴趣可以去查询 RBR 和 SBR 的优缺点</p> </li></ul> 
<p>通过查询知道，我的数据库是开启 consecutive 级别，simple insert 表示通过分析 insert 语句可以确定插入的数量；如：insert, insert, insert … valies(), values(), values()；相应的其他插入方式还有 Bulk inserts,Mixed-mode inserts 等。</p> 
<p>案例可访问这个页面进行查看：<a href="https://www.lintcode.com/learn/84/285" rel="nofollow">https://www.lintcode.com/learn/84/285</a></p> 
<h3><a id="InnoDB_1198"></a>InnoDB锁的种类之共享锁和排他锁</h3> 
<ul><li> <p>并发控制<br> 提到共享锁和排它锁就不得不提并发控制（Concurrency Control），并发控制可以解决临界资源操作时不一致的情况产生，保证数据一致性常见的手段就是锁和数据多版本（Multi Version）</p> </li><li> <p>直接加锁<br> 这种方式会导致被加锁的资源都被锁住，读取任务也无法执行直到锁释放，所有执行的任务相当于串行化方式，简单粗暴，不能并发</p> </li><li> <p>共享锁（Shared Locks）简称为 S 锁<br> 读取数据时候可以加 S 锁。</p> </li></ul> 
<p>共享 (S) 锁允许并发事务读取 (SELECT) 一个资源。资源上存在共享 (S) 锁时，任何其它事务都不能修改数据。一旦已经读取数据，便立即释放资源上的共享 (S) 锁，除非将事务隔离级别设置为可重复读或更高级别，或者在事务生存周期内用锁定提示保留共享 (S) 锁。</p> 
<ul><li>排它锁 （Exclusive Locks）简称为 X 锁<br> 修改数据时候加 X 锁。</li></ul> 
<p>排它 (X) 锁可以防止并发事务对资源进行访问。其它事务不能读取或修改排它 (X) 锁锁定的数据。</p> 
<p>共享锁之间可以并行，排它锁和共享锁之间互斥，也就是说只要共享锁开启没有释放掉的时候，更新锁是不能抢占的，此时其他读取同资源的操作可以进行读取不受限制；同理排它锁开启时候只要没有释放其他不管是排它锁还是共享锁都不可以抢占资源直到锁释放。</p> 
<p>案例讲解：<a href="https://www.lintcode.com/learn/84/292" rel="nofollow">https://www.lintcode.com/learn/84/292</a></p> 
<p>因为锁是使用可能会引发死锁的状态：<br> 死锁<br> 死锁在本文不详细进行讲解，只列举一些可能会造成死锁的诱因</p> 
<ul><li>1、如上所述并发修改同一记录</li><li>2、事务之间对资源访问（表）顺序的交替进行，与第一条大同小异，上升到锁表的级别</li><li>3、数据量庞大时候索引建立机制不行，经常扫全表操作，也会造成资源阻塞死锁</li><li>4、愿意在代码里开大事务然后对数据库一顿操作互相等待，容易引发死锁，所以代码里要节俭对事务的开销，以及事务开销时候尽可能有效合理利用资源</li></ul> 
<p><font color="blue" size="12">数据多版本</font><br> 上面讲到 X 锁占领后其他 S 锁没法占用导致只要写没完成读就不能进行并发查询，InnoDB 引入了数据多版本概念去解决这一问题</p> 
<p>核心原理简单讲就是 clone 了一个版本数据进行修改，比如原有的数据版本号是 Version0，这个时候进行写操作 clone 了一份版本号 V1，这个时候对 V1 版本数据进行修改写入操作；与此同时其他查询读任务并发进来一样可以读取 V0 版本数据不受任何影响，这样就解决了在数据更新回写之前不能读取的问题，进一步提高了数据库引擎处理并发的能力</p> 
<h3><a id="InnoDB_1232"></a>InnoDB锁的种类之意向锁、记录锁和间隙锁</h3> 
<ul><li>意向锁（Intention Locks; table-level lock）</li></ul> 
<p>意向锁是一种特殊的表级锁，意向锁是为了让 InnoDB 多粒度的锁能共存而设计的。取得行的共享锁和排他锁之前需要先取得表的意向共享锁（IS）和意向排他锁（IX），意向共享锁和意向排他锁都是系统自动添加和自动释放的，整个过程无需人工干预。<br> 意向锁就是指未来的某一个时刻事务可能要加共享锁或者排它锁，提前声明一个意向，分为两种：</p> 
<ul><li>意向共享锁（Intention Shared Lock） IS<br> 事务有意向对表中的某些行加共享锁（S锁）</li></ul> 
<pre><code class="prism language-sql"><span class="token comment">-- 事务要获取某些行的 S 锁，必须先获得表的 IS 锁。</span>
<span class="token keyword">SELECT</span> <span class="token keyword">column</span> <span class="token keyword">FROM</span> <span class="token keyword">table</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">LOCK</span> <span class="token operator">IN</span> <span class="token keyword">SHARE</span> <span class="token keyword">MODE</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li>意向排它锁（Intention Exclusive Lock）IX<br> 事务有意向对表中的某些行加排他锁（X锁）</li></ul> 
<pre><code class="prism language-sql"><span class="token comment">-- 事务要获取某些行的 X 锁，必须先获得表的 IX 锁。</span>
<span class="token keyword">SELECT</span> <span class="token keyword">column</span> <span class="token keyword">FROM</span> <span class="token keyword">table</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">FOR</span> <span class="token keyword">UPDATE</span><span class="token punctuation">;</span>
</code></pre> 
<p>另：关于InnoDB锁的种类之临键锁和插入意向锁以及临键锁和插入意向锁的浏览地址：<a href="https://www.lintcode.com/learn/84/294" rel="nofollow">https://www.lintcode.com/learn/84/294</a></p> 
<h2><a id="_1254"></a>如何上锁</h2> 
<p>MySQL常用存储引擎有 MyISAM 和 InnoDB，而 InnoDB 是 MySQL 默认的引擎。MyISAM 不支持行锁，而 InnoDB 支持行锁和表锁。</p> 
<ul><li>隐式上锁（默认，自动加锁、自动释放）<br> MyISAM 在执行查询语句（SELECT）前，会自动给涉及的所有表加读锁，在执行更新操作（UPDATE、DELETE、INSERT等）前，会自动给涉及的表加写锁，这个过程并不需要用户干预，因此用户一般不需要直接用 LOCK TABLE; 命令给 MyISAM 表显式加锁。</li></ul> 
<pre><code class="prism language-sql"><span class="token comment">-- 上读锁 --</span>
<span class="token keyword">SELECT</span> 
<span class="token comment">-- 上写锁 --</span>
<span class="token keyword">INSERT</span><span class="token punctuation">,</span> <span class="token keyword">UPDATE</span><span class="token punctuation">,</span> <span class="token keyword">DELETE</span>
</code></pre> 
<ul><li>显式上锁（手动）<br> 上共享锁（读锁）的写法：lock in share mode，例如：</li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">select</span>  column_name <span class="token keyword">from</span> table_name <span class="token keyword">where</span> <span class="token keyword">lock</span> <span class="token operator">in</span> <span class="token keyword">share</span> <span class="token keyword">mode</span>；
上排它锁（写锁）的写法：<span class="token keyword">for</span> <span class="token keyword">update</span>，例如：
<span class="token keyword">select</span> column_name <span class="token keyword">from</span> table_name <span class="token keyword">where</span> conditions <span class="token keyword">for</span> <span class="token keyword">update</span>；
</code></pre> 
<ul><li>解锁（手动）</li></ul> 
<pre><code class="prism language-sql"><span class="token comment">-- 解锁所有锁表 --</span>
<span class="token keyword">UNLOCK</span> <span class="token keyword">TABLES</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="_1278"></a>如何加行锁</h3> 
<p><font color="blue">例如</font><br> <font color="red"></font><br> 待后续更新<br> to be continue。。。。。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f9ea12afae959235a0661deae6b4c59f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">编写函数，通过指针求字符串的长度。**输入格式要求：“%s“ 提示信息：“Enter string:“**输出格式要求：“string length=%d\n“</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1f4c3ca6475d55f05acf3070a1fa12f6/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Python的isnull识别缺失值nan</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>