<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>向pycdc项目提的一个pr - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="向pycdc项目提的一个pr" />
<meta property="og:description" content="向pycdc项目提的一个pr 前言 pycdc这个项目，我之前一直有在关注，之前使用他反编译python3.10项目，之前使用的 uncompyle6无法反编译pyhton3.10生成的pyc文件，但是pycdc可以，但是反编译效果感觉不如uncompyle6。但是版本更新很快，支持的python版本很多。
在issue看到别人提供的pyc文件 我逛github的时候，看看这个项目有没有更新啥新特性，在issue里面看到别人提的issue，带了一个pyc文件。本着乐于助人的态度，也想学习一下这个项目是如何解析pyc文件到py文件的。就下载了这个pyc。看他提的pr。是报了一个Unsupported Node type: 27错误。但是看他发的报错。感觉不止这一个报错。
E:\temp_vc\pycdc\build_v141\Release&gt;pycdc.exe model.pyc &gt;model.py Unsupported Node type: 27 Unsupported Node type: 27 Unsupported Node type: 27 Unsupported argument found for LIST_EXTEND Unsupported opcode: LIST_TO_TUPLE Unsupported opcode: CALL_FUNCTION_EX Unsupported opcode: DICT_MERGE Unsupported Node type: 27 Unsupported Node type: 27 Unsupported argument found for LIST_EXTEND Unsupported opcode: LIST_TO_TUPLE Unsupported Node type: 27 Unsupported Node type: 27 Unsupported Node type: 27 Unsupported Node type: 27 Unsupported Node type: 27 Unsupported Node type: 27 Unsupported Node type: 27 Warning: block stack is not empty!" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/effdbe19472203eb61111d41bcad63c5/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-18T17:24:04+08:00" />
<meta property="article:modified_time" content="2023-11-18T17:24:04+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">向pycdc项目提的一个pr</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h4>向pycdc项目提的一个pr</h4> 
<h5>前言</h5> 
<p><code>pycdc</code>这个项目，我之前一直有在关注，之前使用他反编译python3.10项目，之前使用的 <code>uncompyle6</code>无法反编译pyhton3.10生成的pyc文件，但是<code>pycdc</code>可以，但是反编译效果感觉不如<code>uncompyle6</code>。但是版本更新很快，支持的python版本很多。</p> 
<h5>在issue看到别人提供的pyc文件</h5> 
<p>我逛github的时候，看看这个项目有没有更新啥新特性，在issue里面看到别人提的issue，带了一个pyc文件。本着乐于助人的态度，也想学习一下这个项目是如何解析pyc文件到py文件的。就下载了这个pyc。看他提的pr。是报了一个Unsupported Node type: 27错误。但是看他发的报错。感觉不止这一个报错。</p> 
<pre><code>E:\temp_vc\pycdc\build_v141\Release&gt;pycdc.exe model.pyc &gt;model.py
Unsupported Node type: 27
Unsupported Node type: 27
Unsupported Node type: 27
Unsupported argument found for LIST_EXTEND
Unsupported opcode: LIST_TO_TUPLE
Unsupported opcode: CALL_FUNCTION_EX
Unsupported opcode: DICT_MERGE
Unsupported Node type: 27
Unsupported Node type: 27
Unsupported argument found for LIST_EXTEND
Unsupported opcode: LIST_TO_TUPLE
Unsupported Node type: 27
Unsupported Node type: 27
Unsupported Node type: 27
Unsupported Node type: 27
Unsupported Node type: 27
Unsupported Node type: 27
Unsupported Node type: 27
Warning: block stack is not empty!
Unsupported Node type: 27
Unsupported Node type: 27
Warning: block stack is not empty!

</code></pre> 
<h5>下载项目</h5> 
<p>OK，先fork一下这个项目，fork完成之后了，这个项目就到你的仓库了。本地的话，就直接git clone一下自己fork的仓库。把项目先下载到本地，准备编译运行，这个pycdc项目是c++写的。用的是cmake进行编译的。</p> 
<p>环境说明：</p> 
<ol><li> <p>cmake</p> </li><li> <p>vs2022</p> </li><li> <p>python 3.9</p> </li></ol> 
<p>我这边的话，就是这么多了。编译的话很简单，下载cmake后，在项目目录，cmake一下就会自动生成vs项目，打开vs项目编译生成pycdc.exe和pycdas.exe后就行。这个pycdc是将pyc变成py，这个pycdas解析pyc文件，输出python的字节码。</p> 
<p>我们随便写个hello,保存为test.py测试一下效果</p> 
<pre><code>print("hello,world")
</code></pre> 
<p>使用命令</p> 
<pre><code>python -m py_compile test.py
</code></pre> 
<p>使用pycdc对生成的test2.cpython-39.pyc进行反编译</p> 
<p class="img-center"><img alt="" height="262" src="https://images2.imgbox.com/1d/56/qfXhseIj_o.png" width="1200"></p> 
<p>可以看到结果，已经反编译成功了。</p> 
<p>OK，我们继续</p> 
<h5>尝试调试程序</h5> 
<p>我们修改一下这个接受参数，再pycdc.cpp里面。</p> 
<p></p> 
<p class="img-center"><img alt="" height="235" src="https://images2.imgbox.com/8a/a9/qUJWgSCP_o.png" width="1200"></p> 
<p>手动给他加上我们需要的参数，方便后期调试。好了，经过调试。发现问题。</p> 
<pre><code>class t(test.t):
 pass
</code></pre> 
<p>这样的代码就会报错，会错误的识别为</p> 
<pre><code>def t():
 pass
</code></pre> 
<p>并且会报错,Unsupported Node type: 27。</p> 
<p>经过调试，最终将问题集中到这里ASTree.cpp</p> 
<pre><code> while (TOS_type == ASTNode::NODE_NAME) {
    bases.resize(basecnt + 1);
    bases[basecnt] = TOS;
    basecnt++;
    stack.pop();
    TOS = stack.top();
    TOS_type
    }
</code></pre> 
<p>这个地方,CALL_FUNCTION_A字节码这个位置。因为我们传参的是test.t。这个玩意被识别为NODE_BINARY。没有被识别为:NODE_NAME 。导致这个while循环没进入，这个NODE_NAME没有被清除，导致后面一些解析错误。变成这样就可以了</p> 
<pre><code> while (TOS_type == ASTNode::NODE_NAME || TOS_type == ASTNode::NODE_BINARY) {
    bases.resize(basecnt + 1);
    bases[basecnt] = TOS;
    basecnt++;
    stack.pop();
    TOS = stack.top();
    TOS_type = TOS.type();
   }
</code></pre> 
<p>修改完毕后，</p> 
<pre><code>git add ASTree.cpp
git commit -m "fix"
git push
</code></pre> 
<p>上传到我们自己的仓库。</p> 
<h5>提交pr</h5> 
<p class="img-center"><img alt="" height="1183" src="https://images2.imgbox.com/d9/0f/6EGfKmA9_o.png" width="1200"></p> 
<p>我们就可以向源项目提交pr了，说明一下自己的修改的原因，以及效果。就可以了。我这边的话，是自己提交了一个issue，在issue里面说了这个报错。提交的pr链接的这个issue。</p> 
<h5>等待被合并</h5> 
<p>我这边大概等了一个星期左右。（我猜是为python3.12做适配了，回复我那天就更新了python3.12适配，并且后面回复就很及时了）作者回复我了，让我加一些测试文件进去。我加了之后。因为有时差，作者回复一般都是晚上12点以后了。我加完测试文件后。第二天我的请求就被merge了。</p> 
<p class="img-center"><img alt="" height="1200" src="https://images2.imgbox.com/e8/f4/KFai1QQF_o.png" width="1200"></p> 
<p>整个流程就完成了，我也成为这个项目的贡献者了，虽然实际修改代码只有一行（偷偷的笑）。</p> 
<hr> 
<p> 今天就到这里，如果您觉得不错，欢迎关注。如有错误，欢迎私聊指正。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/39feead8245e0fb122577e03b87f7c4a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">24年考研即将开始，我想告诉你这几件事</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/dff75248aea5715970791e587e683376/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">2311rust,到46版本更新</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>