<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>指标评估 —— AP &amp; mAP 详细解读 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="指标评估 —— AP &amp; mAP 详细解读" />
<meta property="og:description" content="文章目录 问题背景相关概念两个阈值非极大值抑制Precision x Recall CurveAverage Precision实例展示参考链接 问题背景 针对【目标检测】领域，解析【AP，mAP】的概念以及计算过程。
相关概念 在计算mAP之前，需先理解清楚其概念，以及相关特定术语的【准确】含义。每次遇到评估指标计算的时候，都会感觉很模糊，理解似是而非，其中关键的原因就是特定术语的理解不到位。
AP
AP：Average Precison，所有预测图片内某一类别PR曲线（横轴为Recall，纵轴为Precision）下的面积。
mAP
mAP：mean Average Precision， 各类别【AP】的平均值。
TP
True Positive（TP）：预测框与真实框的IOU&gt;IOU阈值，IOU阈值一般设置为0.5,0.75,0.95等。在目标检测的评估指标规定下，一个真实框（groud truth box）只有一个 TP框，其它均为FP框（即使IOU大于阈值）；
FP
False Positive（FP）：存在两种情况，（a）预测框与真实框的 i o u &lt; i o u t h r e s h iou&lt; iou_{thresh} iou&lt;iouthresh​；（b）多余的预测框（iou值并不是最大的），即使 i o u iou iou 大于阈值，但是真实框已经存在匹配的预测框；
FN
False Negative（FN）：没有匹配到预测框的 GT数量，也即是真实框没有任何预测框与之重叠，目标检测中也称为漏检；
TN
True Negative（TN）：没有负样本，图像应该至少包含一个目标；mAP 指标不需要该值；
注意：目标检测中，TN 表示将背景正确检测为背景，等价于没有检测任何目标，通常不需要该指标。
Precision
所有预测结果中，正确预测框所占的比例。
简言之，所有的预测结果中，存在两种情况：（a）正确的预测结果（TP）；（b）错误的预测结果（FP）；
P r e c i s i o n = T P / ( T P &#43; F P ) = T P / A l l D e t e c t i o n s Precision = TP/(TP&#43;FP)= TP/All Detections Precision=TP/(TP&#43;FP)=TP/AllDetections" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/a9170c5b6b6c6db570e4c9f8c0cdd2b1/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-16T17:06:41+08:00" />
<meta property="article:modified_time" content="2023-02-16T17:06:41+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">指标评估 —— AP &amp; mAP 详细解读</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><a href="#_1" rel="nofollow">问题背景</a></li><li><a href="#_3" rel="nofollow">相关概念</a></li><li><a href="#_43" rel="nofollow">两个阈值</a></li><li><a href="#_52" rel="nofollow">非极大值抑制</a></li><li><a href="#Precision_x_Recall_Curve_78" rel="nofollow">Precision x Recall Curve</a></li><li><a href="#Average_Precision_98" rel="nofollow">Average Precision</a></li><li><a href="#_121" rel="nofollow">实例展示</a></li><li><a href="#_193" rel="nofollow">参考链接</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="_1"></a>问题背景</h3> 
<p>  针对【<font color="red">目标检测</font>】领域，解析【<font color="red">AP，mAP</font>】的概念以及计算过程。</p> 
<h3><a id="_3"></a>相关概念</h3> 
<p>  在计算mAP之前，需先理解清楚其概念，以及相关特定术语的【准确】含义。每次遇到评估指标计算的时候，都会感觉很模糊，理解似是而非，其中关键的原因就是特定术语的理解不到位。</p> 
<ol><li> <p>AP</p> 
  <blockquote> 
   <p>AP：Average Precison，所有预测图片内某一类别PR曲线（横轴为Recall，纵轴为Precision）下的面积。</p> 
  </blockquote> </li><li> <p>mAP</p> 
  <blockquote> 
   <p>mAP：mean Average Precision， 各类别【AP】的平均值。</p> 
  </blockquote> </li><li> <p>TP</p> 
  <blockquote> 
   <p>True Positive（TP）：预测框与真实框的IOU&gt;IOU阈值，IOU阈值一般设置为0.5,0.75,0.95等。在目标检测的评估指标规定下，一个真实框（groud truth box）只有一个 TP框，其它均为FP框（即使IOU大于阈值）；</p> 
  </blockquote> </li><li> <p>FP</p> 
  <blockquote> 
   <p>False Positive（FP）：存在两种情况，（a）预测框与真实框的 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            i 
           
          
            o 
           
          
            u 
           
          
            &lt; 
           
          
            i 
           
          
            o 
           
           
           
             u 
            
            
            
              t 
             
            
              h 
             
            
              r 
             
            
              e 
             
            
              s 
             
            
              h 
             
            
           
          
         
           iou&lt; iou_{thresh} 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6986em; vertical-align: -0.0391em;"></span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.8095em; vertical-align: -0.15em;"></span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">h</span><span class="mord mathnormal mtight">res</span><span class="mord mathnormal mtight">h</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>；（b）多余的预测框（iou值并不是最大的），即使 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            i 
           
          
            o 
           
          
            u 
           
          
         
           iou 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6595em;"></span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span></span></span></span></span> 大于阈值，但是真实框已经存在匹配的预测框；</p> 
  </blockquote> </li><li> <p>FN</p> 
  <blockquote> 
   <p>False Negative（FN）：没有匹配到预测框的 GT数量，也即是真实框没有任何预测框与之重叠，目标检测中也称为漏检；</p> 
  </blockquote> </li><li> <p>TN</p> 
  <blockquote> 
   <p>True Negative（TN）：没有负样本，图像应该至少包含一个目标；mAP 指标不需要该值；<br> <font color="blue">注意</font>：目标检测中，TN 表示将背景正确检测为背景，等价于没有检测任何目标，通常不需要该指标。</p> 
  </blockquote> </li><li> <p>Precision</p> 
  <blockquote> 
   <p>所有预测结果中，正确预测框所占的比例。<br> 简言之，所有的预测结果中，存在两种情况：（a）正确的预测结果（TP）；（b）错误的预测结果（FP）；<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
         
          
           
           
             P 
            
           
             r 
            
           
             e 
            
           
             c 
            
           
             i 
            
           
             s 
            
           
             i 
            
           
             o 
            
           
             n 
            
           
             = 
            
           
             T 
            
           
             P 
            
           
             / 
            
           
             ( 
            
           
             T 
            
           
             P 
            
           
             + 
            
           
             F 
            
           
             P 
            
           
             ) 
            
           
             = 
            
           
             T 
            
           
             P 
            
           
             / 
            
           
             A 
            
           
             l 
            
           
             l 
            
           
             D 
            
           
             e 
            
           
             t 
            
           
             e 
            
           
             c 
            
           
             t 
            
           
             i 
            
           
             o 
            
           
             n 
            
           
             s 
            
           
          
            Precision = TP/(TP+FP)= TP/All Detections 
           
          
        </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span><span class="mord mathnormal">rec</span><span class="mord mathnormal">i</span><span class="mord mathnormal">s</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">TP</span><span class="mord">/</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.1389em;">TP</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">FP</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">TP</span><span class="mord">/</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right: 0.0197em;">ll</span><span class="mord mathnormal">De</span><span class="mord mathnormal">t</span><span class="mord mathnormal">ec</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal">s</span></span></span></span></span></span></p> 
  </blockquote> </li><li> <p>Recall</p> 
  <blockquote> 
   <p>真实目标被正确预测所占的比例。<br> Recall = TP/(TP+FN)，其中，all_ground_truths = TP + FN； 简言之，所有的真实框，有多少被检测出来（TP）；</p> 
  </blockquote> </li></ol> 
<h3><a id="_43"></a>两个阈值</h3> 
<ol><li> <p>IOU 阈值</p> 
  <blockquote> 
   <p>IOU阈值：预测框和真实框交并比大于IOU阈值，才可能被判定为正样本（TP）。通常用于【NMS】和【mAP】的计<br> 算。</p> 
  </blockquote> </li><li> <p>置信度阈值</p> 
  <blockquote> 
   <p>衡量目标框内包含目标的可信程度，通常在【NMS】处理阶段，用于过滤低置信度的检测框。</p> 
  </blockquote> </li></ol> 
<h3><a id="_52"></a>非极大值抑制</h3> 
<ol><li> <p>什么是非极大值抑制？</p> 
  <blockquote> 
   <p>非极大值抑制（Non-Maximum Suppression），简称NMS，搜索局部最大值，抑制非局部极大值，广泛应用于计算机视觉任务。它是从许多重叠的实体中选择一个最佳的实体（例如，边框）的一类算法，我们可以选择设置标准来达到预期的结果。</p> 
  </blockquote> </li><li> <p>为什么要使用非极大值抑制？</p> 
  <blockquote> 
   <p>在这里，我们以目标检测举例，检测模型通常会预测输出大量的候选框，这些候选框相互重叠。实际应用中，我们只需要一个目标只有一个候选框负责（也即是，局部最优候选边框）。通常使用NMS来解决这类问题，具体如下图所示：<br> <img src="https://images2.imgbox.com/7f/57/RF4qztEa_o.png" alt="在这里插入图片描述"></p> 
  </blockquote> </li><li> <p>非极大值抑制的流程？<br> 假设预测得到的候选框集合为【Q】，最终保存预期边框的列表为【Keep】，具体流程如下，</p> 
  <blockquote> 
   <p>（1）根据置信度阈值，从【Q】中过滤一部分候选框，记为【P】；<br> （2）从【P】中取出置信度分数最高的边框【s】，放入列表【Keep】；<br> （3）计算【s】与【P】中剩余边框的 IOU，如果大于IOU阈值，则将该边框从【P】中删除。<br> （4）如果【P】列表不为空，则继续从（1）开始执行，直到【P】为空；</p> 
  </blockquote> </li><li> <p>注意问题</p> 
  <blockquote> 
   <p>（1）从上述的流程中可以看出，我们选择最大置信度的候选框，并抑制大于一定IoU阈值的的候选框。也就是说，我们选择最大的置信度边框，抑制非最大的边框，达到去除冗余边框的目的。因此，也就称之为非极大值抑制。<br> （2）上述流程中，边框的滤除依赖【IoU】阈值，所以该值的选择对于模型的性能也有一定影响。通常设置的值为【0.5】，当然也需要根据实际任务决定。<br> （3）上述算法中，所有的边框是同时处理的。也就会存在一个问题，如果不同类别的两个目标重叠的话，那么会将其它类别的边框滤除，影响检测效果。因此，有时候为了避免这种情况出现，通常采用类内NMS，也即是逐类处理。</p> 
  </blockquote> </li></ol> 
<h3><a id="Precision_x_Recall_Curve_78"></a>Precision x Recall Curve</h3> 
<ol><li> <p>为什么需要设置置信度阈值？</p> 
  <blockquote> 
   <p>定义：当前bounding box 包含目标的可信程度。每一个 bounding box 的预测输出包含置信度值，它是一个概率值，范围【0,1】。<br> 作用：假如一个bounding box 的置信度值为 0.1，那么当前 bounding box 包含目标可信吗？它可能是包含目标，甚至可能是负样本（不包含任何目标），所以为了客观评定检测器的能力，我们需要设置一个置信度阈值，低于该阈值的为负样本。所以置信度阈值起到一个基本的过滤作用。</p> 
  </blockquote> </li><li> <p>置信度阈值如何影响 Precision 和 Recall ？</p> 
  <blockquote> 
   <p>（1）当调大置信度阈值时，那么很多预测结果会被过滤掉，R值会降低，相应的P值应该会提升。当调小置信度阈值时，很多预测结果会被保留，那么R值会升高，P值会降低。<br> （2）通常PR曲线都是单调递减。</p> 
  </blockquote> </li><li> <p>如何合理的衡量检测器的性能呢？</p> 
  <blockquote> 
   <p>从【2.】中的表述，我们知道，不同的阈值会产生不同的（precision，recall）结果，那么单个（precision，recall）对作为检测器优劣的判定标准就不合适。通常是固定一个置信度阈值，然后设置一组IOU阈值（比如IOU@[0.5:0.95]），每一个IOU阈值可以得到一组（precision，recall）对，最终可以得到一条PR曲线。</p> 
  </blockquote> </li><li> <p>PR曲线时如何计算的？</p> 
  <blockquote> 
   <p>首先，我们需要将所有的预测框按置信度降序排序；<br> 然后，按照置信度从大到小的顺序，统计每一个置信度层级下的TP，FP，累积TP，累积FP；<br> 最后，根据累积的TP，FP，计算PR值；</p> 
  </blockquote> </li></ol> 
<h3><a id="Average_Precision_98"></a>Average Precision</h3> 
<ol><li> <p>AP 的作用是什么？</p> 
  <blockquote> 
   <p>定义：从【<strong>Precision x Recall Curve</strong>】中的陈述，AP表示在一组不同IOU阈值下，某一类别的平均准确度。<br> 作用：综合评定一个检测器检测某一类目标的性能，并给出量化值，便于不同检测器之间的性能对比。</p> 
  </blockquote> </li><li> <p>AP 的计算方法<br> <strong>11-点插值法（11-point interpolation）</strong></p> 
  <blockquote> 
   <p>11-point interpolation：就是用11个等间距的 recall 层级 【0,0.1,0.2,…,1】下的【平均】 precision 来近似模拟 RP曲线，公式如下：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
         
          
           
           
             A 
            
           
             P 
            
           
             = 
            
            
            
              1 
             
            
              11 
             
            
            
            
              ∑ 
             
             
              
              
                r 
               
              
                ∈ 
               
              
              
              
                0 
               
              
                , 
               
              
                0.1 
               
              
                , 
               
              
                0.2 
               
              
                , 
               
              
                . 
               
              
                . 
               
              
                . 
               
              
                , 
               
              
                1 
               
              
             
            
            
            
              ρ 
             
             
             
               i 
              
             
               n 
              
             
               t 
              
             
               e 
              
             
               r 
              
             
               p 
              
             
               ( 
              
             
               r 
              
             
               ) 
              
             
            
           
          
            AP = \frac{1}{11}\sum_{r_\in{0,0.1,0.2,...,1}}\rho_{interp(r)} 
           
          
        </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 2.7247em; vertical-align: -1.4032em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.3214em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">11</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.05em;"><span class="" style="top: -1.8829em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0278em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2421em;"><span class="" style="top: -2.357em; margin-left: -0.0278em; margin-right: 0.0714em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mrel mtight">∈</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.1709em;"><span class=""></span></span></span></span></span></span><span class="mord mtight"><span class="mord mtight">0</span><span class="mpunct mtight">,</span><span class="mord mtight">0.1</span><span class="mpunct mtight">,</span><span class="mord mtight">0.2</span><span class="mpunct mtight">,</span><span class="mord mtight">...</span><span class="mpunct mtight">,</span><span class="mord mtight">1</span></span></span></span></span><span class="" style="top: -3.05em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.4032em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord"><span class="mord mathnormal">ρ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3448em;"><span class="" style="top: -2.5198em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">in</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight" style="margin-right: 0.0278em;">er</span><span class="mord mathnormal mtight">p</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right: 0.0278em;">r</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.3552em;"><span class=""></span></span></span></span></span></span></span></span></span></span></span><br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
         
          
           
            
            
              ρ 
             
             
             
               i 
              
             
               n 
              
             
               t 
              
             
               e 
              
             
               r 
              
             
               p 
              
             
            
           
             = 
            
            
             
             
               m 
              
             
               a 
              
             
               x 
              
             
             
              
              
                r 
               
              
                ˉ 
               
              
             
               : 
              
              
               
               
                 r 
                
               
                 ˉ 
                
               
              
                &gt; 
               
              
                r 
               
              
             
            
           
             ρ 
            
            
            
              ( 
             
             
             
               r 
              
             
               ˉ 
              
             
            
              ) 
             
            
           
          
            \rho_{interp}=\mathop{max}_{\bar{r}:{\bar{r}&gt;r}}\rho{(\bar{r})} 
           
          
        </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.7167em; vertical-align: -0.2861em;"></span><span class="mord"><span class="mord mathnormal">ρ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">in</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight" style="margin-right: 0.0278em;">er</span><span class="mord mathnormal mtight">p</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2861em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mop"><span class="mop"><span class="mord mathnormal">ma</span><span class="mord mathnormal">x</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2474em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord accent mtight"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.5678em;"><span class="" style="top: -2.7em;"><span class="pstrut" style="height: 2.7em;"></span><span class="mord mathnormal mtight" style="margin-right: 0.0278em;">r</span></span><span class="" style="top: -2.7em;"><span class="pstrut" style="height: 2.7em;"></span><span class="accent-body" style="left: -0.1944em;"><span class="mord mtight">ˉ</span></span></span></span></span></span></span><span class="mrel mtight">:</span><span class="mord mtight"><span class="mord accent mtight"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.5678em;"><span class="" style="top: -2.7em;"><span class="pstrut" style="height: 2.7em;"></span><span class="mord mathnormal mtight" style="margin-right: 0.0278em;">r</span></span><span class="" style="top: -2.7em;"><span class="pstrut" style="height: 2.7em;"></span><span class="accent-body" style="left: -0.1944em;"><span class="mord mtight">ˉ</span></span></span></span></span></span></span><span class="mrel mtight">&gt;</span><span class="mord mathnormal mtight" style="margin-right: 0.0278em;">r</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.1774em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal">ρ</span><span class="mord"><span class="mopen">(</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.5678em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">r</span></span><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.1944em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></span></span><br> 这里，<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            ρ 
           
          
            ( 
           
           
           
             r 
            
           
             ˉ 
            
           
          
            ) 
           
          
         
           \rho(\bar{r}) 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">ρ</span><span class="mopen">(</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.5678em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">r</span></span><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.1944em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span> 是在 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            r 
           
          
            e 
           
          
            c 
           
          
            a 
           
          
            l 
           
          
            l 
           
          
            = 
           
           
           
             r 
            
           
             ˉ 
            
           
          
         
           recall=\bar{r} 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6944em;"></span><span class="mord mathnormal">rec</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.0197em;">ll</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.5678em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.5678em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">r</span></span><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.1944em;"><span class="mord">ˉ</span></span></span></span></span></span></span></span></span></span></span> 的 precision值。AP 的计算是取大于当前层级 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            r 
           
          
         
           r 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.4306em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">r</span></span></span></span></span> 的<font color="blue">最大 precision 值</font>，也即是取大于当前recall值对应应precision的最大值。</p> 
  </blockquote> <p><strong>所有点插值（Interpolating all points）</strong></p> 
  <blockquote> 
   <p>取代插值11个等间距点，我们可以插值所有点（n个），具体公式如下：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
         
          
           
            
            
              ∑ 
             
             
             
               n 
              
             
               = 
              
             
               0 
              
             
            
           
             ( 
            
            
            
              r 
             
             
             
               n 
              
             
               + 
              
             
               1 
              
             
            
           
             − 
            
            
            
              r 
             
            
              n 
             
            
           
             ) 
            
            
            
              ρ 
             
             
             
               i 
              
             
               n 
              
             
               t 
              
             
               e 
              
             
               r 
              
             
               p 
              
             
            
           
             ( 
            
            
            
              r 
             
             
             
               n 
              
             
               + 
              
             
               1 
              
             
            
           
             ) 
            
           
          
            \sum_{n=0}(r_{n+1}-r_n)\rho_{interp}(r_{n+1}) 
           
          
        </span><span class="katex-html"><span class="base"><span class="strut" style="height: 2.3171em; vertical-align: -1.2671em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.05em;"><span class="" style="top: -1.8829em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span class="" style="top: -3.05em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.2671em;"><span class=""></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0278em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: -0.0278em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2083em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1.0361em; vertical-align: -0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0278em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.0278em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mord"><span class="mord mathnormal">ρ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">in</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight" style="margin-right: 0.0278em;">er</span><span class="mord mathnormal mtight">p</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2861em;"><span class=""></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0278em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: -0.0278em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2083em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></span><br> 其中，<span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
         
          
           
            
            
              ρ 
             
             
             
               i 
              
             
               n 
              
             
               t 
              
             
               e 
              
             
               r 
              
             
               p 
              
             
            
           
             ( 
            
            
            
              r 
             
             
             
               n 
              
             
               + 
              
             
               1 
              
             
            
           
             ) 
            
           
             = 
            
            
             
             
               m 
              
             
               a 
              
             
               x 
              
             
             
              
              
                r 
               
              
                ˉ 
               
              
             
               : 
              
              
               
               
                 r 
                
               
                 ˉ 
                
               
              
                &gt; 
               
               
               
                 r 
                
                
                
                  n 
                 
                
                  + 
                 
                
                  1 
                 
                
               
              
             
            
           
             ρ 
            
            
            
              ( 
             
             
             
               r 
              
             
               ˉ 
              
             
            
              ) 
             
            
           
          
            \rho_{interp}(r_{n+1})=\mathop{max}_{\bar{r}:{\bar{r}&gt;r_{n+1}}}\rho{(\bar{r})} 
           
          
        </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.0361em; vertical-align: -0.2861em;"></span><span class="mord"><span class="mord mathnormal">ρ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">in</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight" style="margin-right: 0.0278em;">er</span><span class="mord mathnormal mtight">p</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2861em;"><span class=""></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0278em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: -0.0278em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2083em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1.0418em; vertical-align: -0.2918em;"></span><span class="mop"><span class="mop"><span class="mord mathnormal">ma</span><span class="mord mathnormal">x</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2474em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord accent mtight"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.5678em;"><span class="" style="top: -2.7em;"><span class="pstrut" style="height: 2.7em;"></span><span class="mord mathnormal mtight" style="margin-right: 0.0278em;">r</span></span><span class="" style="top: -2.7em;"><span class="pstrut" style="height: 2.7em;"></span><span class="accent-body" style="left: -0.1944em;"><span class="mord mtight">ˉ</span></span></span></span></span></span></span><span class="mrel mtight">:</span><span class="mord mtight"><span class="mord accent mtight"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.5678em;"><span class="" style="top: -2.7em;"><span class="pstrut" style="height: 2.7em;"></span><span class="mord mathnormal mtight" style="margin-right: 0.0278em;">r</span></span><span class="" style="top: -2.7em;"><span class="pstrut" style="height: 2.7em;"></span><span class="accent-body" style="left: -0.1944em;"><span class="mord mtight">ˉ</span></span></span></span></span></span></span><span class="mrel mtight">&gt;</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0278em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3173em;"><span class="" style="top: -2.357em; margin-left: -0.0278em; margin-right: 0.0714em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2025em;"><span class=""></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2918em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal">ρ</span><span class="mord"><span class="mopen">(</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.5678em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">r</span></span><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.1944em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></span></span><br> 这里，<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            ρ 
           
          
            ( 
           
           
           
             r 
            
           
             ˉ 
            
           
          
            ) 
           
          
         
           \rho(\bar{r}) 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">ρ</span><span class="mopen">(</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.5678em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">r</span></span><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.1944em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span> 是在 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            r 
           
          
            e 
           
          
            c 
           
          
            a 
           
          
            l 
           
          
            l 
           
          
            = 
           
           
           
             r 
            
           
             ˉ 
            
           
          
         
           recall=\bar{r} 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6944em;"></span><span class="mord mathnormal">rec</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.0197em;">ll</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.5678em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.5678em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">r</span></span><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.1944em;"><span class="mord">ˉ</span></span></span></span></span></span></span></span></span></span></span> 的 precision值。相比于11点插值方法，该方法取每一个层级r的最大precision值。</p> 
  </blockquote> </li></ol> 
<h3><a id="_121"></a>实例展示</h3> 
<p><img src="https://images2.imgbox.com/af/70/FVHojFRH_o.png" alt="在这里插入图片描述"><br> 如上图所示，具体内容如下：</p> 
<blockquote> 
 <p>图片数量：7张。<br> 绿框：真实标签，15个。<br> 红框：检测框，包含置信度值，并用大小字母（A-Y）标示，24个。</p> 
</blockquote> 
<p>下表展示了所有图片中的目标检测情况，最后一列表示【TP，FP】。该例子中，TP：iou&gt;0.3，否则是FP。通过观察图片中的检测框重叠情况，我们可以大概判定该检测框是【TP】或者【FP】。<br> <img src="https://images2.imgbox.com/ac/06/sETiQHc4_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>在image2-7中，存在多个检测框覆盖一个真实框，这种情况下，IOU最大的检测框为TP，其它均为FP（比如，Image2中 E是TP，D是FP）。PASCAL VOC 2012 metric：5个TP检测框被计数为1个，其它4个是FP。</p> 
</blockquote> 
<p>PR曲线绘制流程如下</p> 
<ol><li> <p>计算 precision，recall</p> 
  <blockquote> 
   <p>首先，将检测框按照置信度降序排列，然后根据累积的TPs，FPs，计算【precisioin，recall】，表格如下<br> <img src="https://images2.imgbox.com/72/d7/JXjUUfz7_o.png" alt="在这里插入图片描述" width="600"><br> （1）如上表所示，以第二行为例计算：Precision = TP/(TP+FP)=1/(1+1)=0.5，Recall = TP/(TP+FN)=1/15=0.066.<br> （2）置信度需要降序排序。<br> （3）</p> 
  </blockquote> </li><li> <p>绘制PR曲线<br> <img src="https://images2.imgbox.com/ee/62/DN1wxCcy_o.png" alt="在这里插入图片描述"></p> 
  <blockquote> 
   <p>PR曲线图解析：<br> 横坐标：recall<br> 纵坐标：precision<br> 蓝色点：每一个字母表示一个检测框，对应一对（recall，precision）值，它是根据【<strong>1.</strong>】中的累积TPs，FPs计算。</p> 
  </blockquote> </li><li> <p>11点计算AP值<br> 如【<strong>2.</strong>】中图示，该方法是取11个召回率层级（11 recall levels，[0,0.1,…,1]）的平均 Precision 值。当前Recall层级的Precison值是取大于该Recall层级的最大，也就是下图中的红色实心点。蓝线表示实际的PR曲线，红色点是插值的新点，用于计算AP值。<br> <img src="https://images2.imgbox.com/16/16/SwLjWSET_o.png" alt="在这里插入图片描述"></p> 
  <blockquote> 
   <p>计算如下：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
         
          
           
            
             
              
               
               
                 A 
                
               
                 P 
                
               
              
             
             
              
               
                
               
                 = 
                
                
                
                  1 
                 
                
                  11 
                 
                
                
                
                  ∑ 
                 
                 
                 
                   r 
                  
                 
                   ∈ 
                  
                 
                   { 
                  
                 
                   0 
                  
                 
                   , 
                  
                 
                   0.1 
                  
                 
                   , 
                  
                 
                   . 
                  
                 
                   . 
                  
                 
                   . 
                  
                 
                   , 
                  
                 
                   1 
                  
                 
                   } 
                  
                 
                
                
                
                  ρ 
                 
                 
                 
                   i 
                  
                 
                   n 
                  
                 
                   t 
                  
                 
                   e 
                  
                 
                   r 
                  
                 
                   p 
                  
                 
                   ( 
                  
                 
                   r 
                  
                 
                   ) 
                  
                 
                
               
              
             
            
            
             
              
               
              
             
             
              
               
                
               
                 = 
                
                
                
                  1 
                 
                
                  11 
                 
                
               
                 ( 
                
               
                 1 
                
               
                 + 
                
               
                 0.6666 
                
               
                 + 
                
               
                 0.4285 
                
               
                 + 
                
               
                 0.4285 
                
               
                 + 
                
               
                 0.4285 
                
               
                 + 
                
               
                 0 
                
               
                 + 
                
               
                 0 
                
               
                 + 
                
               
                 0 
                
               
                 + 
                
               
                 0 
                
               
                 + 
                
               
                 0 
                
               
                 + 
                
               
                 0 
                
               
                 ) 
                
               
              
             
            
            
             
              
               
              
             
             
              
               
                
               
                 = 
                
               
                 26.84 
                
               
                 % 
                
               
              
             
            
           
          
            \begin{aligned} AP&amp;=\frac{1}{11}\sum_{r\in\lbrace0,0.1,...,1\rbrace}\rho_{interp(r)}\\ &amp;=\frac{1}{11}(1+0.6666+0.4285+0.4285+0.4285+0+0+0+0+0+0)\\ &amp;=26.84\% \end{aligned} 
           
          
        </span><span class="katex-html"><span class="base"><span class="strut" style="height: 6.9449em; vertical-align: -3.2224em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 3.7224em;"><span class="" style="top: -5.7224em;"><span class="pstrut" style="height: 3.3214em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span></span></span><span class="" style="top: -2.585em;"><span class="pstrut" style="height: 3.3214em;"></span><span class="mord"></span></span><span class="" style="top: -0.759em;"><span class="pstrut" style="height: 3.3214em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 3.2224em;"><span class=""></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 3.7224em;"><span class="" style="top: -5.7224em;"><span class="pstrut" style="height: 3.3214em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.3214em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">11</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.05em;"><span class="" style="top: -1.809em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0278em;">r</span><span class="mrel mtight">∈</span><span class="mopen mtight">{<!-- --></span><span class="mord mtight">0</span><span class="mpunct mtight">,</span><span class="mord mtight">0.1</span><span class="mpunct mtight">,</span><span class="mord mtight">...</span><span class="mpunct mtight">,</span><span class="mord mtight">1</span><span class="mclose mtight">}</span></span></span></span><span class="" style="top: -3.05em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.516em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord"><span class="mord mathnormal">ρ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3448em;"><span class="" style="top: -2.5198em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">in</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight" style="margin-right: 0.0278em;">er</span><span class="mord mathnormal mtight">p</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right: 0.0278em;">r</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.3552em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -2.585em;"><span class="pstrut" style="height: 3.3214em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.3214em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">11</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord">0.6666</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord">0.4285</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord">0.4285</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord">0.4285</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord">0</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord">0</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord">0</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord">0</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord">0</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord">0</span><span class="mclose">)</span></span></span><span class="" style="top: -0.759em;"><span class="pstrut" style="height: 3.3214em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mord">26.84%</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 3.2224em;"><span class=""></span></span></span></span></span></span></span></span></span></span></span></span></p> 
  </blockquote> </li><li> <p>所有点插值计算AP<br> 插值所有点近似于PR曲线下的面积（AUC），其目的是减少曲线摆动的影响。我们还可以通过查看从最高(0.4666)到0(从右到左查看图)的召回率值来直观地获得内插的精确点，当我们减少召回时，我们收集精确度最高的值，如下图所示：<br> <img src="https://images2.imgbox.com/49/d7/RnNDELzj_o.png" alt="在这里插入图片描述"><br> 根据上述绘制的图，我们可以将AUC分为四个区域（A1，A2，A3，A4），如下图所示：<br> <img src="https://images2.imgbox.com/1c/de/ErS1zZe0_o.png" alt="在这里插入图片描述"></p> 
  <blockquote> 
   <p>计算AP如下：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
         
          
           
            
             
              
               
               
                 A 
                
               
                 1 
                
               
              
             
             
              
               
                
               
                 = 
                
               
                 ( 
                
               
                 0.0666 
                
               
                 − 
                
               
                 0 
                
               
                 ) 
                
               
                 × 
                
               
                 1 
                
               
                 = 
                
               
                 0.0666 
                
               
              
             
            
            
             
              
               
               
                 A 
                
               
                 2 
                
               
              
             
             
              
               
                
               
                 = 
                
               
                 ( 
                
               
                 0.1333 
                
               
                 − 
                
               
                 0.0666 
                
               
                 ) 
                
               
                 × 
                
               
                 0.6666 
                
               
                 = 
                
               
                 0.04446222 
                
               
              
             
            
            
             
              
               
               
                 A 
                
               
                 3 
                
               
              
             
             
              
               
                
               
                 = 
                
               
                 ( 
                
               
                 0.4 
                
               
                 − 
                
               
                 0.1333 
                
               
                 ) 
                
               
                 × 
                
               
                 0.4285 
                
               
                 = 
                
               
                 0.11428095 
                
               
              
             
            
            
             
              
               
               
                 A 
                
               
                 4 
                
               
              
             
             
              
               
                
               
                 = 
                
               
                 ( 
                
               
                 0.4666 
                
               
                 − 
                
               
                 0.4 
                
               
                 ) 
                
               
                 × 
                
               
                 0.3043 
                
               
                 = 
                
               
                 0.02026638 
                
               
              
             
            
           
          
            \begin{aligned} A1&amp;=(0.0666-0)\times 1=0.0666\\ A2&amp;=(0.1333-0.0666)\times 0.6666=0.04446222\\ A3&amp;=(0.4-0.1333)\times 0.4285=0.11428095\\ A4&amp;=(0.4666-0.4)\times 0.3043=0.02026638\\ \end{aligned} 
           
          
        </span><span class="katex-html"><span class="base"><span class="strut" style="height: 6em; vertical-align: -2.75em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 3.25em;"><span class="" style="top: -5.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="mord">1</span></span></span><span class="" style="top: -3.91em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="mord">2</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="mord">3</span></span></span><span class="" style="top: -0.91em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="mord">4</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.75em;"><span class=""></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 3.25em;"><span class="" style="top: -5.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mopen">(</span><span class="mord">0.0666</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord">0</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord">1</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mord">0.0666</span></span></span><span class="" style="top: -3.91em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mopen">(</span><span class="mord">0.1333</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord">0.0666</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord">0.6666</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mord">0.04446222</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mopen">(</span><span class="mord">0.4</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord">0.1333</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord">0.4285</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mord">0.11428095</span></span></span><span class="" style="top: -0.91em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mopen">(</span><span class="mord">0.4666</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord">0.4</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord">0.3043</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mord">0.02026638</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.75em;"><span class=""></span></span></span></span></span></span></span></span></span></span></span></span><br> 那么，<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
         
          
           
            
             
              
               
               
                 A 
                
               
                 P 
                
               
              
             
             
              
               
                
               
                 = 
                
               
                 A 
                
               
                 1 
                
               
                 + 
                
               
                 A 
                
               
                 2 
                
               
                 + 
                
               
                 A 
                
               
                 3 
                
               
                 + 
                
               
                 A 
                
               
                 4 
                
               
              
             
            
            
             
              
               
              
             
             
              
               
                
               
                 = 
                
               
                 0.0666 
                
               
                 + 
                
               
                 0.04446222 
                
               
                 + 
                
               
                 0.11428095 
                
               
                 + 
                
               
                 0.02026638 
                
               
              
             
            
            
             
              
               
              
             
             
              
               
                
               
                 = 
                
               
                 0.24560955 
                
               
              
             
            
            
             
              
               
              
             
             
              
               
                
               
                 = 
                
               
                 24.56 
                
               
                 % 
                
               
              
             
            
           
          
            \begin{aligned} AP&amp;=A1+A2+A3+A4\\ &amp;=0.0666+0.04446222+0.11428095+0.02026638\\ &amp;=0.24560955\\ &amp;=24.56\% \end{aligned} 
           
          
        </span><span class="katex-html"><span class="base"><span class="strut" style="height: 6em; vertical-align: -2.75em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 3.25em;"><span class="" style="top: -5.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span></span></span><span class="" style="top: -3.91em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"></span></span><span class="" style="top: -0.91em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.75em;"><span class=""></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 3.25em;"><span class="" style="top: -5.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mord mathnormal">A</span><span class="mord">1</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord mathnormal">A</span><span class="mord">2</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord mathnormal">A</span><span class="mord">3</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord mathnormal">A</span><span class="mord">4</span></span></span><span class="" style="top: -3.91em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mord">0.0666</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord">0.04446222</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord">0.11428095</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord">0.02026638</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mord">0.24560955</span></span></span><span class="" style="top: -0.91em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mord">24.56%</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.75em;"><span class=""></span></span></span></span></span></span></span></span></span></span></span></span></p> 
  </blockquote> </li></ol> 
<h3><a id="_193"></a>参考链接</h3> 
<ol><li><a href="https://learnopencv.com/mean-average-precision-map-object-detection-model-evaluation-metric/" rel="nofollow">https://learnopencv.com/mean-average-precision-map-object-detection-model-evaluation-metric/</a></li><li><a href="https://www.zhihu.com/question/53405779" rel="nofollow">https://www.zhihu.com/question/53405779</a></li><li><a href="https://github.com/rafaelpadilla/Object-Detection-Metrics">https://github.com/rafaelpadilla/Object-Detection-Metrics</a></li><li><a href="https://zhuanlan.zhihu.com/p/482175618" rel="nofollow">简洁明了的解析</a></li></ol>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/fe63f90695b5a0ecc58149b5fc548056/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">TwinCAT 学习进阶之路</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/916a098f8905b5d089f60ba70bb42f0d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">手把手带你读java源码之JAVA-stream数据结构和初始化源码详解(万字长文详解)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>