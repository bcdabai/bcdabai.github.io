<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>SQL自学三部曲_Part2：十大必学语法（二） - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="SQL自学三部曲_Part2：十大必学语法（二）" />
<meta property="og:description" content="文章目录 前言一、看前须知二、sqlzoo数据介绍三、基础语法和运行原理6. having&amp;简单运行原理7. 部分常见函数8. 窗口函数9. 表连接10. 子查询 四、如何继续提升1. 在题库里夯实基础2. 在笔试中不断积累3. 在实战中不断提升 系列文章 前言 本文主要介绍SQL基础语法和运行原理，但是因为内容较多，阅读起来时间较长，所以分成两篇文章
一、看前须知 本文主要适用于MySQL数据库，不过核心语句也通用于其他数据库
只学习SQL语句的查询语句部分，对于数据分析师而言完全足够（数据库就像一个图书馆，里面放了很多表；开发相当于图书管理员，会去管理图书馆；分析师只是去图书管里面选择数据进行使用，只需要知道数在哪并把它拿出来就可以了）
主要使用资源：基础语法部分基于公开网站sqlzoo的MySQL数据库引擎，必须使用英文界面练习代码（不同语言界面不同引擎可能导致数据库数据不同），并切换至Mysql引擎；小进阶部分基于自行搭建的云端数据库和外卖场景数据
SQL查询语句语法结构和运行顺序
语法结构：select–from–where–group by–having–order by–limit运行顺序：from–where–group by–having–order by–limit–select
SQL语句本身并不难，更难的是理清实际需求中的逻辑转换为SQL代码和每个表格所呈现的业务信息及多个表之间的不同连接逻辑及应用
本文是为了帮助快速入门SQL，理解SQL主要语句、语法和使用方法，可以快速解决80%以上场景的SQL问题，但仍然需要在实战中继续练习，文章的最后也提供了对应的提升路径
二、sqlzoo数据介绍 1. world
数据库引擎-MySQL一张包含每个国家信息（大洲、面积、人口、gdp、国家首都等）的表每一行数据记录了一个国家的相关信息数据部分示例
字段名-译名-解释 name-国家名continent-大洲-共有七大洲分别为：亚洲(Asia)、欧洲(Europe)、北美洲(North America)、南美洲(South America)、非洲(Africa)、大洋洲(Oceania)与南极洲(Antarctica)area-面积-国家面积population-人口gdp-gdp-Gross Domestic Product(GDP，国内生产总值)，一个国家（或地区）所有常住单位在一定时期内生产活动的最终成果，是国民经济核算的核心指标capital-首都-国家首都tld-顶级域名-国家顶级域名，中国顶级域名为.cnflag-旗帜 数据库表信息 列数：8列行数：195行字段类型
2. nobel
数据库引擎-MySQL一张诺贝尔奖获得者的名单表每一行数据记录了一名诺贝尔奖获得者及这个诺贝尔奖所属科目和年份数据部分示例
字段名-译名-解释 yr-年份-获奖年份subject-科目-获得的诺贝尔奖所属科目winner-获奖者-诺贝尔奖获得者的姓名 数据库表信息 列数：3列行数：895行字段类型
3. covid
数据库引擎-MySQL一张记录了2020年1月22号到10月9号各国每天新冠相关信息的表每一行数据记录了一个国家到截至时间的累计确诊人数、累计死亡人数、累计治愈人数数据部分示例
字段名-译名-解释 name-国家名whn-截至时间confirmed-累计确诊-截至该时间的累计确诊人数deaths-累计死亡-截至该时间的累计死亡人数recovered-累计治愈-截至该时间的累计治愈人数 数据库表信息 列数：5列行数：47946行字段类型
4. ge
数据库引擎-MySQL一张记录了2015、2017、2019年的竞选的候选人信息表每一行数据记录了当年竞选候选人的名字、姓名、所在选区编号、所属团体和得票数数据部分示例
- 字段名-译名-解释 yr-年份-举办的年份firstName-名字-候选人名字lastName-姓氏-候选人姓氏constituency-选区-所在选区编号party-团体-所属团体votes-得票数-获得选票的数量 数据库表信息 列数：6列行数：10595行字段类型
5. game、goal、eteam
数据库引擎-MySQLgame 一张记录赛事的表每一条数据记录一场赛事的编号（id），赛事的举办时间（mdate），赛事举办的场地（stadium），参加本场比赛的两个队伍（team1，team2）
goal 一张记录球员进球得分的表每一条数据记录一名进球的球员的姓名（player），进球时间（gtime），所在队伍编号（teamid），当时的赛事编号（matchid）
eteam 一张队伍表每一条数据记录一个队伍的编号（id）、名字（teamname）和教练姓名（coach）
数据部分示例 game" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/dc08009d4cd6c1534bb925d2f67ecf52/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-16T14:48:34+08:00" />
<meta property="article:modified_time" content="2023-11-16T14:48:34+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">SQL自学三部曲_Part2：十大必学语法（二）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_4" rel="nofollow">前言</a></li><li><a href="#_8" rel="nofollow">一、看前须知</a></li><li><a href="#sqlzoo_22" rel="nofollow">二、sqlzoo数据介绍</a></li><li><a href="#_258" rel="nofollow">三、基础语法和运行原理</a></li><li><ul><li><a href="#6_having_259" rel="nofollow">6. having&amp;简单运行原理</a></li><li><a href="#7__385" rel="nofollow">7. 部分常见函数</a></li><li><a href="#8__640" rel="nofollow">8. 窗口函数</a></li><li><a href="#9__798" rel="nofollow">9. 表连接</a></li><li><a href="#10__977" rel="nofollow">10. 子查询</a></li></ul> 
  </li><li><a href="#_1211" rel="nofollow">四、如何继续提升</a></li><li><ul><li><a href="#1__1212" rel="nofollow">1. 在题库里夯实基础</a></li><li><a href="#2__1220" rel="nofollow">2. 在笔试中不断积累</a></li><li><a href="#3__1224" rel="nofollow">3. 在实战中不断提升</a></li></ul> 
  </li><li><a href="#_1232" rel="nofollow">系列文章</a></li></ul> 
</div> 
<p></p> 
<hr> 
<h2><a id="_4"></a>前言</h2> 
<p>本文主要介绍SQL基础语法和运行原理，但是因为内容较多，阅读起来时间较长，所以分成两篇文章</p> 
<hr> 
<h2><a id="_8"></a>一、看前须知</h2> 
<ul><li> <p>本文主要适用于MySQL数据库，不过核心语句也通用于其他数据库</p> </li><li> <p>只学习SQL语句的查询语句部分，对于数据分析师而言完全足够（数据库就像一个图书馆，里面放了很多表；开发相当于图书管理员，会去管理图书馆；分析师只是去图书管里面选择数据进行使用，只需要知道数在哪并把它拿出来就可以了）</p> </li><li> <p>主要使用资源：基础语法部分基于公开网站sqlzoo的MySQL数据库引擎，必须使用英文界面练习代码（不同语言界面不同引擎可能导致数据库数据不同），并切换至Mysql引擎；小进阶部分基于自行搭建的云端数据库和外卖场景数据</p> </li><li> <p>SQL查询语句语法结构和运行顺序</p> 
  <ul><li>语法结构：select–from–where–group by–having–order by–limit</li><li>运行顺序：from–where–group by–having–order by–limit–select<br> <img src="https://images2.imgbox.com/ca/68/7mBAn39q_o.png" alt="在这里插入图片描述"></li></ul> </li><li> <p>SQL语句本身并不难，更难的是理清实际需求中的逻辑转换为SQL代码和每个表格所呈现的业务信息及多个表之间的不同连接逻辑及应用</p> </li><li> <p>本文是为了帮助快速入门SQL，理解SQL主要语句、语法和使用方法，可以快速解决80%以上场景的SQL问题，但仍然需要在实战中继续练习，文章的最后也提供了对应的提升路径</p> </li></ul> 
<br> 
<h2><a id="sqlzoo_22"></a>二、sqlzoo数据介绍</h2> 
<p><font color="#FF8C00" size="5"><strong>1. world</strong></font></p> 
<ul><li>数据库引擎-<strong>MySQL</strong></li><li>一张包含每个国家信息（大洲、面积、人口、gdp、国家首都等）的表</li><li>每一行数据记录了一个国家的相关信息</li><li>数据部分示例<br> <img src="https://images2.imgbox.com/78/2a/0Nwq8xXw_o.png" alt="在这里插入图片描述"></li><li>字段名-译名-解释 
  <ul><li><strong>name-国家名</strong></li><li><strong>continent-大洲</strong>-共有七大洲分别为：亚洲(Asia)、欧洲(Europe)、北美洲(North America)、南美洲(South America)、非洲(Africa)、大洋洲(Oceania)与南极洲(Antarctica)</li><li><strong>area-面积</strong>-国家面积</li><li><strong>population-人口</strong></li><li><strong>gdp-gdp</strong>-Gross Domestic Product(GDP，国内生产总值)，一个国家（或地区）所有常住单位在一定时期内生产活动的最终成果，是国民经济核算的核心指标</li><li><strong>capital-首都</strong>-国家首都</li><li><strong>tld-顶级域名</strong>-国家顶级域名，中国顶级域名为.cn</li><li><strong>flag-旗帜</strong></li></ul> </li><li>数据库表信息 
  <ul><li>列数：8列</li><li>行数：195行</li><li>字段类型<br> <img src="https://images2.imgbox.com/82/f9/vxAMPbxB_o.png" alt="在这里插入图片描述"><br> <br></li></ul> </li></ul> 
<p><font color="#FF8C00" size="5"><strong>2. nobel</strong></font></p> 
<ul><li>数据库引擎-<strong>MySQL</strong></li><li>一张诺贝尔奖获得者的名单表</li><li>每一行数据记录了<strong>一名</strong>诺贝尔奖获得者及这个诺贝尔奖所属科目和年份</li><li>数据部分示例<br> <img src="https://images2.imgbox.com/e0/be/W7zdAERq_o.png" alt="在这里插入图片描述"></li><li>字段名-译名-解释 
  <ul><li><strong>yr-年份</strong>-获奖年份</li><li><strong>subject-科目</strong>-获得的诺贝尔奖所属科目</li><li><strong>winner-获奖者</strong>-诺贝尔奖获得者的姓名</li></ul> </li><li>数据库表信息 
  <ul><li>列数：3列</li><li>行数：895行</li><li>字段类型<br> <img src="https://images2.imgbox.com/f9/63/zFKHEPTw_o.png" alt="在这里插入图片描述"><br> <br></li></ul> </li></ul> 
<p><font color="#FF8C00" size="5"><strong>3. covid</strong></font></p> 
<ul><li>数据库引擎-<strong>MySQL</strong></li><li>一张记录了2020年1月22号到10月9号各国每天新冠相关信息的表</li><li>每一行数据记录了一个国家到截至时间的累计确诊人数、累计死亡人数、累计治愈人数</li><li>数据部分示例<br> <img src="https://images2.imgbox.com/87/e9/l47fyxro_o.png" alt="在这里插入图片描述"></li><li>字段名-译名-解释 
  <ul><li><strong>name-国家名</strong></li><li><strong>whn-截至时间</strong></li><li><strong>confirmed-累计确诊</strong>-截至该时间的累计确诊人数</li><li><strong>deaths-累计死亡</strong>-截至该时间的累计死亡人数</li><li><strong>recovered-累计治愈</strong>-截至该时间的累计治愈人数</li></ul> </li><li>数据库表信息 
  <ul><li>列数：5列</li><li>行数：47946行</li><li>字段类型<br> <img src="https://images2.imgbox.com/23/18/Qun0XUj2_o.png" alt="在这里插入图片描述"><br> <br></li></ul> </li></ul> 
<p><font color="#FF8C00" size="5"><strong>4. ge</strong></font></p> 
<ul><li>数据库引擎-<strong>MySQL</strong></li><li>一张记录了2015、2017、2019年的竞选的候选人信息表</li><li>每一行数据记录了当年竞选候选人的名字、姓名、所在选区编号、所属团体和得票数</li><li>数据部分示例<br> <img src="https://images2.imgbox.com/0b/ca/p8lf4meJ_o.png" alt="在这里插入图片描述">- 字段名-译名-解释 
  <ul><li><strong>yr-年份</strong>-举办的年份</li><li><strong>firstName-名字</strong>-候选人名字</li><li><strong>lastName-姓氏</strong>-候选人姓氏</li><li><strong>constituency-选区</strong>-所在选区编号</li><li><strong>party-团体</strong>-所属团体</li><li><strong>votes-得票数</strong>-获得选票的数量</li></ul> </li><li>数据库表信息 
  <ul><li>列数：6列</li><li>行数：10595行</li><li>字段类型<br> <img src="https://images2.imgbox.com/d5/59/lhkfkd3h_o.png" alt="在这里插入图片描述"><br> <br></li></ul> </li></ul> 
<p><font color="#FF8C00" size="5"><strong>5. game、goal、eteam</strong></font></p> 
<ul><li>数据库引擎-<strong>MySQL</strong></li><li>game 
  <ul><li>一张记录赛事的表</li><li>每一条数据记录一场赛事的编号（id），赛事的举办时间（mdate），赛事举办的场地（stadium），参加本场比赛的两个队伍（team1，team2）<br> <br></li></ul> </li><li>goal 
  <ul><li>一张记录球员进球得分的表</li><li>每一条数据记录一名进球的球员的姓名（player），进球时间（gtime），所在队伍编号（teamid），当时的赛事编号（matchid）<br> <br></li></ul> </li><li>eteam 
  <ul><li>一张队伍表</li><li>每一条数据记录一个队伍的编号（id）、名字（teamname）和教练姓名（coach）<br> <br></li></ul> </li><li>数据部分示例 
  <ul><li>game<br> <img src="https://images2.imgbox.com/41/37/1VXbRivb_o.png" alt="在这里插入图片描述"></li><li>goal<br> <img src="https://images2.imgbox.com/37/64/54KghpmC_o.png" alt="在这里插入图片描述"></li><li>eteam<br> <img src="https://images2.imgbox.com/01/e2/hU3aE2as_o.png" alt="在这里插入图片描述"><br> <br></li></ul> </li><li>字段名-译名-解释 
  <ul><li>game 
    <ul><li><strong>id-编号</strong>-赛事编号</li><li><strong>mdate-日期</strong>-举办赛事的日期</li><li><strong>stadium-场馆</strong>-赛事场馆</li><li><strong>team1-队伍1</strong>-参与赛事队伍1</li><li><strong>team2-队伍2</strong>-参与赛事队伍2</li></ul> </li><li>goal 
    <ul><li><strong>matchid-赛事编号</strong></li><li><strong>teamid-队伍编号</strong>-入球球员所在的队伍编号</li><li><strong>player-入球球员</strong></li><li><strong>gtime-入球时间</strong>-比赛开始到入球时间的分钟数</li></ul> </li><li>eteam 
    <ul><li><strong>id-编号</strong>-队伍编号</li><li><strong>teamname-队名</strong>-队伍名字</li><li><strong>coach-教练</strong>-队伍的教练<br> <br></li></ul> </li></ul> </li><li>数据库表信息 
  <ul><li>game 
    <ul><li>列数：5行</li><li>行数：31行</li><li>字段类型<br> <img src="https://images2.imgbox.com/52/63/7pZlZYIW_o.png" alt="在这里插入图片描述"></li></ul> </li><li>goal 
    <ul><li>列数：4列</li><li>行数：76行</li><li>字段类型<br> <img src="https://images2.imgbox.com/d8/a4/j7XfWOK1_o.png" alt="在这里插入图片描述"></li></ul> </li><li>eteam 
    <ul><li>列数：3列</li><li>行数：16行</li><li>字段类型<br> <img src="https://images2.imgbox.com/fe/0e/k8gzYkGS_o.png" alt="在这里插入图片描述"></li></ul> </li></ul> </li></ul> 
<p><font color="#FF8C00" size="5"><strong>6. teacher、dept</strong></font></p> 
<ul><li>数据库引擎-<strong>MySQL</strong> 
  <ul><li>teacher 
    <ul><li>一张记录教师信息的表</li><li>每一条数据记录一名教师的编号、教授科目编号、教师名、教师电话号码和教师手机号<br> <br></li></ul> </li><li>dept 
    <ul><li>一张记录科目信息的表</li><li>每一条数据记录一个科目名及其对应的编号<br> <br></li></ul> </li></ul> </li><li>数据部分示例 
  <ul><li>teacher<br> <img src="https://images2.imgbox.com/a0/5f/nKjWgYAQ_o.png" alt="在这里插入图片描述"></li><li>dept<br> <img src="https://images2.imgbox.com/a2/3f/7M7F2Mw4_o.png" alt="在这里插入图片描述"><br> <br></li></ul> </li><li>字段名-译名-解释 
  <ul><li>teacher 
    <ul><li><strong>id-编号</strong>-教师编号</li><li><strong>dept-科目编号</strong></li><li><strong>name-名字</strong>-教师名字</li><li><strong>phone-电话号码</strong>-教师的电话号码</li><li><strong>mobile-手机号</strong>-教师的手机号</li></ul> </li><li>dept 
    <ul><li><strong>id-科目编号</strong></li><li><strong>name-科目名</strong><br> <br></li></ul> </li></ul> </li><li>数据库表信息 
  <ul><li>teacher 
    <ul><li>列数：5列</li><li>行数：6行</li><li>字段类型<br> <img src="https://images2.imgbox.com/7a/01/LlRAWHT1_o.png" alt="在这里插入图片描述"></li></ul> </li><li>dept 
    <ul><li>列数：2列</li><li>行数：3行</li><li>字段类型<br> <img src="https://images2.imgbox.com/e5/10/LurUT6pP_o.png" alt="在这里插入图片描述"><br> <br></li></ul> </li></ul> </li></ul> 
<p><font color="#FF8C00" size="5"><strong>7. movie、actor、casting</strong></font></p> 
<ul><li> <p>数据库引擎-<strong>MySQL</strong></p> 
  <ul><li>movie 
    <ul><li>一张记录电影相关信息的表</li><li>每一行数据记录了一部电影的id、电影名称（title）、首影年份（yr）、导演（director）、制作费（budget）、票房收入（gross）<br> <br></li></ul> </li><li>actor 
    <ul><li>一张记录了演员信息的表</li><li>每一行数据记录了一名演员的id号和姓名<br> <br></li></ul> </li><li>casting</li><li>一张记录每部电影中参演演员的角色次序的表，也是一张中间表用来连接movie和actor表 
    <ul><li>每一行数据记录了一部电影中的一个演员及其所对应的角色次序<br> <br></li></ul> </li></ul> </li><li> <p>数据部分示例</p> 
  <ul><li>movie<br> <img src="https://images2.imgbox.com/f6/4a/BBkcUI2a_o.png" alt="在这里插入图片描述"></li><li>casting<br> <img src="https://images2.imgbox.com/7f/8d/KgO95gmN_o.png" alt="在这里插入图片描述"></li><li>actor<br> <img src="https://images2.imgbox.com/e0/8e/OVzYyG0v_o.png" alt="在这里插入图片描述"><br> <br></li></ul> </li><li> <p>字段名-译名-解释</p> 
  <ul><li>movie 
    <ul><li><strong>id-编号</strong>-电影编号</li><li><strong>title-电影名称</strong></li><li><strong>yr-首影年份</strong>-电影第一次上映年份</li><li><strong>director-导演</strong></li><li><strong>budget-制作费</strong></li><li><strong>gross-票房收入</strong><br> <br></li></ul> </li><li>casting 
    <ul><li><strong>movieid-电影编号</strong></li><li><strong>actorid-演员编号</strong></li><li><strong>ord-角色次序</strong>-角色次序代表第1主角是1, 第2主角是2…如此类推<br> <br></li></ul> </li><li>actor 
    <ul><li><strong>id-演员编号</strong></li><li><strong>name-演员姓名</strong><br> <br></li></ul> </li></ul> </li><li> <p>数据库表信息</p> 
  <ul><li>movie 
    <ul><li>列数：6列</li><li>行数：12026行</li><li>字段类型<br> <img src="https://images2.imgbox.com/1c/c9/1AillQCx_o.png" alt="在这里插入图片描述"></li></ul> </li><li>casting 
    <ul><li>列数：3列</li><li>行数：120172行</li><li>字段类型<br> <img src="https://images2.imgbox.com/dc/4b/8RZft0ov_o.png" alt="在这里插入图片描述"></li></ul> </li><li>actor 
    <ul><li>列数：2列</li><li>行数：48148行</li><li>字段类型<br> <img src="https://images2.imgbox.com/3e/6f/9dib6P0j_o.png" alt="在这里插入图片描述"><br> <br></li></ul> </li></ul> </li></ul> 
<h2><a id="_258"></a>三、基础语法和运行原理</h2> 
<h3><a id="6_having_259"></a>6. having&amp;简单运行原理</h3> 
<p><font size="4"><strong>（1）知识点引入</strong></font></p> 
<ul><li> <p><strong>标准语法</strong></p> 
  <ul><li>select 字段名</li><li>from 表名</li><li>[where 表达式]</li><li>[group by 字段名]</li><li><strong>[having 表达式]</strong></li><li>[order by 字段名 asc|desc]</li><li>[limit [位置偏移量,]行数]<br> <br></li></ul> </li><li> <p><strong>语法解释</strong></p> 
  <ul><li>having 表达式： <strong>限定分组聚合后的查询行必须满足的条件</strong></li><li>having核心子句是<strong>可选项</strong>，使用该子句是为了对group by分组后的数据进行筛选<br> <br></li></ul> </li></ul> 
<p><font size="4"><strong>（2）例题讲解</strong></font></p> 
<p><font color="#EE82EE"><strong>例题链接：（链接中标号8）<a href="https://sqlzoo.net/wiki/SUM_and_COUNT" rel="nofollow">https://sqlzoo.net/wiki/SUM_and_COUNT</a> 涉及数据表：world</strong></font></p> 
<p><strong><font color="#EE82EE">【例题26】查询总人口数量至少为1亿（100000000）的大洲</font></strong></p> 
<ul><li><strong>运行代码</strong><br> <img src="https://images2.imgbox.com/c6/78/Db8VNCA2_o.png" alt="在这里插入图片描述"></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> 
	continent
<span class="token keyword">from</span> world
<span class="token keyword">group</span> <span class="token keyword">by</span> continent
<span class="token keyword">having</span> <span class="token function">sum</span><span class="token punctuation">(</span>population<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">100000000</span>
</code></pre> 
<ul><li><strong>运行结果</strong><br> <img src="https://images2.imgbox.com/6c/74/OZXs4nXX_o.png" alt="在这里插入图片描述"></li><li><strong>知识点讲解</strong> 
  <ul><li>1.只有使用了group by子句后才会使用having子句，having子句不能脱离group by子句单独使用，因为having子句本质上是对group by分组的筛选</li><li>2.having子句中只能使用聚合函数和group by作为分组依据的字段</li><li>3.having的表达式和where的表达式基本相同，但是<strong>having的表达式中可以使用聚合函数</strong>，where的表达式中不可以，因为where是对原表的行数据筛选，having是对group by分组后的数据筛选</li><li>4.建议对<strong>行数据进行筛选</strong>时使用<strong>where子句</strong>，对<strong>含有聚合函数的筛选表达式</strong>使用<strong>having子句</strong><br> <br></li></ul> </li></ul> 
<p><strong><font color="#EE82EE">【例题27】（运行原理）查询总人口数至少为3亿的大洲和其平均gdp，其中只有gdp高于200亿且人口数大于6000万或者gdp低于80亿且首都中含有三个a的国家的计入计算，最后按国家数从大到小排序，只显示第一行</font></strong></p> 
<ul><li><strong>运行代码</strong><br> <img src="https://images2.imgbox.com/4a/40/5xB4HoAW_o.png" alt="在这里插入图片描述"></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">select</span>
	continent
	<span class="token punctuation">,</span><span class="token function">avg</span><span class="token punctuation">(</span>gdp<span class="token punctuation">)</span> 平均gdp
<span class="token keyword">from</span> world
<span class="token keyword">where</span> <span class="token punctuation">(</span>gdp <span class="token operator">&gt;</span> <span class="token number">20000000000</span> <span class="token operator">and</span> population <span class="token operator">&gt;</span> <span class="token number">60000000</span><span class="token punctuation">)</span>
<span class="token operator">or</span> <span class="token punctuation">(</span>gdp <span class="token operator">&lt;</span><span class="token number">8000000000</span> <span class="token operator">and</span> capital <span class="token operator">like</span> <span class="token string">'%a%a%a%'</span><span class="token punctuation">)</span>
<span class="token keyword">group</span> <span class="token keyword">by</span> continent
<span class="token keyword">having</span> <span class="token function">sum</span><span class="token punctuation">(</span>population<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">300000000</span>
<span class="token keyword">order</span> <span class="token keyword">by</span> <span class="token function">count</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token keyword">desc</span>
<span class="token keyword">limit</span> <span class="token number">1</span>
</code></pre> 
<ul><li><strong>运行结果</strong><br> <img src="https://images2.imgbox.com/be/e4/vER22FBv_o.png" alt="在这里插入图片描述"></li><li><strong>SQL运行原理</strong> 
  <ul><li>from–where–group by–having–order by–limit–select 
    <ul><li>执行from语句：从数据库中调取复制一份表格</li><li>执行where语句：在复制的表格中筛选出符合条件的数据行</li><li>执行group by语句：依据指定字段对筛选后的数据分区，将依据的字段去重分组，相当于Excel建立了一个数据透视表，添加了行标签<br> <img src="https://images2.imgbox.com/fe/00/jvIdKikp_o.png" alt="在这里插入图片描述"></li><li>执行having语句：筛选满足条件的分组</li><li>执行order by语句：对筛选后的数据进行排序</li><li>执行limit语句：对排序后的数据限制显示的行</li><li>执行select语句：提取最后要显示的字段</li></ul> </li></ul> </li><li><strong>Excel演示</strong><br> <code>结合SQL运行原理，讲解例题代码查询数据的过程</code> 
  <ul><li>首先先从数据库中调取复制一张world表</li><li>通过where子句筛选满足<strong>gdp高于200亿且人口数大于6000万</strong>或者<strong>gdp低于80亿且首都中含有三个a</strong>的国家<br> <img src="https://images2.imgbox.com/08/43/eZqatUR1_o.png" alt="在这里插入图片描述"></li><li>group by continent类似建立一个数据透视表，依据continent字段分组，相当于透视表中continent作为<strong>行标签</strong><br> <img src="https://images2.imgbox.com/fe/42/oIhZTwh1_o.png" alt="在这里插入图片描述"></li><li>having sum(population)&gt;= 300000000通过依据continent分组聚合运算出sum(population)，再筛选出大于等于3亿的分组 
    <ul><li>类似于对Excel透视表中行标签进行值筛选 <img src="https://images2.imgbox.com/46/ca/sjE2oSOa_o.png" alt="在这里插入图片描述"></li></ul> </li><li>order by count(name) desc通过依据continent分组聚合运算算出count(name)，对计数值从大到小即降序排序<br> <img src="https://images2.imgbox.com/c0/c2/30UidYiG_o.png" alt="在这里插入图片描述"></li><li>limit1只显示排序后的结果集的前一行<br> <img src="https://images2.imgbox.com/22/2a/r3rjLr7e_o.png" alt="在这里插入图片描述"></li><li>select进行最后的计算（包括算式和函数）并选取最后要显示的字段<br> <img src="https://images2.imgbox.com/d6/f6/0l4GFRj4_o.png" alt="在这里插入图片描述"></li></ul> </li></ul> 
<br> 
<p><font size="4"><strong>（3）总结</strong></font></p> 
<ul><li> <p><strong>标准语法</strong></p> 
  <ul><li>select 字段名</li><li>from 表名</li><li>[where 表达式]</li><li>[group by 字段名]</li><li><strong>[having 表达式]</strong></li><li>[order by 字段名 asc|desc]</li><li>[limit [位置偏移量,]行数]<br> <br></li></ul> </li><li> <p><strong>运行原理</strong></p> 
  <ul><li><strong>from–where–group by–having–order by–limit–select</strong><br> <br></li></ul> </li></ul> 
<p><font size="4"><strong>（4）练习题</strong></font></p> 
<p><font color="#EE82EE"><strong>习题链接1：<a href="https://sqlzoo.net/wiki/SUM_and_COUNT" rel="nofollow">https://sqlzoo.net/wiki/SUM_and_COUNT</a>（链接中标号1）涉及数据表：world</strong></font></p> 
<p><strong><font color="#EE82EE">题目1：查询人均gdp大于3000的大洲及其人口数，仅gdp在200亿和300亿之间的国家计入计算</font></strong></p> 
<ul><li><strong>运行代码</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> 
	continent<span class="token punctuation">,</span>
	<span class="token function">sum</span><span class="token punctuation">(</span>population<span class="token punctuation">)</span> 人口数<span class="token punctuation">,</span>
	<span class="token function">sum</span><span class="token punctuation">(</span>gdp<span class="token punctuation">)</span><span class="token operator">/</span><span class="token function">sum</span><span class="token punctuation">(</span>population<span class="token punctuation">)</span> 人均GDP
<span class="token keyword">from</span> world
<span class="token keyword">where</span> gdp <span class="token operator">between</span> <span class="token number">20000000000</span> <span class="token operator">and</span> <span class="token number">30000000000</span>
<span class="token keyword">group</span> <span class="token keyword">by</span> continent
<span class="token keyword">having</span> <span class="token function">sum</span><span class="token punctuation">(</span>gdp<span class="token punctuation">)</span><span class="token operator">/</span><span class="token function">sum</span><span class="token punctuation">(</span>population<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">3000</span>
</code></pre> 
<ul><li><strong>运行结果</strong><br> <img src="https://images2.imgbox.com/86/1e/biFTMeSE_o.png" alt="在这里插入图片描述"><br> <br></li></ul> 
<h3><a id="7__385"></a>7. 部分常见函数</h3> 
<p><font size="4"><strong>（1）知识点引入</strong></font></p> 
<p><strong><font color="#FF8C00" size="4">a. 数学函数</font></strong></p> 
<ul><li><strong>round(x,y)—四舍五入函数</strong> 
  <ul><li>round函数对x值进行四舍五入，精确到小数点后y位</li><li>y为负值时，保留小数点左边相应的位数为0，不进行四舍五入 
    <ul><li>例如：round(3.15,1)返回3.2，round(14.15,-1)返回10<br> <br></li></ul> </li></ul> </li></ul> 
<p><strong><font color="#FF8C00" size="4">b. 字符串函数</font></strong></p> 
<ul><li><strong>concat(s1,s2,…)—连接字符串函数</strong> 
  <ul><li>concat函数返回连接参数s1、s2等产生的字符串</li><li>任一参数为null时，则返回null 
    <ul><li>例如：concat(‘My’,’ ',‘SQL’)返回My SQL，concat(‘My’,null,‘SQL’)返回null<br> <br></li></ul> </li></ul> </li><li><strong>replace(s,s1,s2)—替换函数</strong> 
  <ul><li>replace函数使用字符串s2代替s中所有的s1 
    <ul><li>例如：replace(‘MySQLMySQL’,‘SQL’,‘sql’)返回MysqlMysql<br> <br></li></ul> </li></ul> </li><li><strong>left(s,n)、right(s,n)、substring(s,n,len)—截取字符串一部分的函数</strong> 
  <ul><li>left函数返回字符串s最左边n个字符</li><li>right函数返回字符串s最右边n个字符</li><li>substring函数返回字符串s从第n个字符起取长度为len的子字符串，n也可以为负值，则从倒数第n个字符起取长度为len的子字符串，没有len值则取从第n个字符起到最后一位 
    <ul><li>例如：left(‘abcdefg’,3)返回abc，right(‘abcdefg’,3)返回efg，substring(‘abcdefg’,2,3)返回bcd，substring(‘abcdefg’,-2,3)返回fg，substring(‘abcdefg’,2)返回bcdefg<br> <br></li></ul> </li></ul> </li></ul> 
<p><strong><font color="#FF8C00" size="4">c. 数据类型转换函数</font></strong></p> 
<ul><li><strong>cast(x as type)—转换数据类型的函数</strong> 
  <ul><li>cast函数将一个类型的x值转换为另一个类型的值</li><li>type参数可以填写char(n)、date、time、datetime、decimal等转换为对应的数据类型<br> <br></li></ul> </li></ul> 
<p><strong><font color="#FF8C00" size="4">d. 日期时间函数</font></strong></p> 
<ul><li><strong>year(date)、month(date)、day(date)—获取年月日的函数</strong> 
  <ul><li>date可以是年月日组成的日期，也可以是年月日时分秒组成的日期时间</li><li>year(date)返回日期格式中的年份</li><li>month(date)返回日期格式中的月份</li><li>day(date)返回年日期格式中的日份 
    <ul><li>例如：year(‘2021-08-03’)返回2021，month(‘2021-08-03’)返回8，day(‘2021-08-03’)返回3<br> <br></li></ul> </li></ul> </li><li><strong>date_add(date,interval expr type)、date_sub(date,interval expr type)—对指定起始时间进行加减操作</strong> 
  <ul><li>date用来指定起始时间</li><li>date可以是年月日组成的日期，也可以是年月日时分秒组成的日期时间</li><li>expr用来指定从起始时间添加或减去的时间间隔</li><li>type指示expr被解释的方式，type可以可以是以下值 
    <ul><li><strong>主要使用红框中的值</strong><br> <img src="https://images2.imgbox.com/8f/90/26PKNf9y_o.png" alt="在这里插入图片描述"></li></ul> </li><li>date_add函数对起始时间进行加操作，date_sub函数对起始时间进行减操作 
    <ul><li>例如：date_add(‘2021-08-03 23:59:59’,interval 1 second)返回2021-08-04 24:00:00，date_sub(‘2021-08-03 23:59:59’,interval 2 month)返回2021-06-03 23:59:59<br> <br></li></ul> </li></ul> </li><li><strong>datediff(date1,date2)—计算两个日期之间间隔的天数</strong> 
  <ul><li>datediff函数由date1-date2计算出间隔的时间，只有date的日期部分参与计算，时间不参与 
    <ul><li>例如：datediff(‘2021-06-08’,‘2021-06-01’)返回7，datediff(‘2021-06-08 23:59:59’,‘2021-06-01 21:00:00’)返回7，datediff(‘2021-06-01’,‘2021-06-08’)返回-7<br> <br></li></ul> </li></ul> </li><li><strong>date_format(date,format)—将日期和时间格式化</strong> 
  <ul><li> <p>date_format函数根据format指定的格式显示date值</p> </li><li> <p><strong>可以换使用的格式有</strong><br> <img src="https://images2.imgbox.com/a9/e2/ogSSFrte_o.png" alt="在这里插入图片描述"></p> 
    <ul><li>例如：date_format(‘2018-06-01 16:23:12’,‘%b %d %Y %h:%i %p’)返回Jun 01 2018 04:23 PM，date_format(‘2018-06-01 16:23:12’,‘%Y/%d/%m’)返回2018/01/06<br> <br></li></ul> </li></ul> </li></ul> 
<p><strong><font color="#FF8C00" size="4">e. 条件判断函数</font></strong><br> <code>根据满足不同条件，执行相应流程</code></p> 
<ul><li><strong>if(expr,v1,v2)</strong> 
  <ul><li>如果表达式expr是true返回值v1，否则返回v2 
    <ul><li>例如：if(1&lt;2,‘Y’,‘N’)返回Y，if(1&gt;2,‘Y’,‘N’)返回N<br> <br></li></ul> </li></ul> </li><li><strong>case when</strong> 
  <ul><li>case expr when v1 then r1 [when v2 then r2] …[else rn] end 
    <ul><li>例如：case 2 when 1 then ‘one’ when 2 then ‘two’ else ‘more’ end 返回two</li><li>case后面的值为2，与第二条分支语句when后面的值相等相等，因此返回two</li></ul> </li><li>case when v1 then r1 [when v2 then r2]…[else rn] end 
    <ul><li>例如：case when 1&lt;0 then ‘T’ else ‘F’ end返回F</li><li>1&lt;0的结果为false，因此函数返回值为else后面的F<br> <br></li></ul> </li></ul> </li></ul> 
<p><font size="4"><strong>（2）例题讲解</strong></font></p> 
<p><font color="#EE82EE"><strong>例题链接：（链接中标号1）<a href="https://sqlzoo.net/wiki/Window_LAG" rel="nofollow">https://sqlzoo.net/wiki/Window_LAG</a> 涉及数据表：covid</strong></font></p> 
<p><strong><font color="#EE82EE">【例题28】尝试使用刚学习的函数</font></strong></p> 
<p><strong><font color="#FF8C00">a. case when和if函数</font></strong></p> 
<ul><li><strong>运行代码</strong><br> <img src="https://images2.imgbox.com/78/9b/WE6m0MMw_o.png" alt="在这里插入图片描述"></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">select</span>
	recovered 累计治愈人数
	<span class="token punctuation">,</span><span class="token keyword">case</span> <span class="token keyword">when</span> recovered <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">then</span> <span class="token string">'one'</span> 
	      <span class="token keyword">when</span> recovered <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token keyword">then</span> <span class="token string">'more'</span> 
	      <span class="token keyword">else</span> <span class="token string">'0'</span> <span class="token keyword">end</span>
<span class="token keyword">from</span> covid
<span class="token keyword">where</span> recovered <span class="token operator">&gt;</span> <span class="token number">0</span>
</code></pre> 
<ul><li><strong>运行结果</strong><br> <img src="https://images2.imgbox.com/27/d0/TRuQNcB0_o.png" alt="在这里插入图片描述"><br> <br></li></ul> 
<p><strong><font color="#FF8C00"> b. year、month、day函数</font></strong></p> 
<ul><li><strong>运行代码</strong><br> <img src="https://images2.imgbox.com/d0/14/yRs2lPs7_o.png" alt="在这里插入图片描述"></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">select</span>
	whn 更新时间
	<span class="token punctuation">,</span><span class="token keyword">year</span><span class="token punctuation">(</span>whn<span class="token punctuation">)</span> 年
	<span class="token punctuation">,</span><span class="token keyword">month</span><span class="token punctuation">(</span>whn<span class="token punctuation">)</span> 月
	<span class="token punctuation">,</span><span class="token keyword">day</span><span class="token punctuation">(</span>whn<span class="token punctuation">)</span> 日
<span class="token keyword">from</span> covid
<span class="token keyword">where</span> recovered <span class="token operator">&gt;</span> <span class="token number">0</span>
</code></pre> 
<ul><li><strong>运行结果</strong><br> <img src="https://images2.imgbox.com/69/ac/QUNij9k6_o.png" alt="在这里插入图片描述"></li></ul> 
<br> 
<p><strong><font color="#FF8C00"> c. date_add函数</font></strong></p> 
<ul><li><strong>运行代码</strong><br> <img src="https://images2.imgbox.com/df/01/nziR75bw_o.png" alt="在这里插入图片描述"></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">select</span>
	whn 更新时间
	<span class="token punctuation">,</span>date_add<span class="token punctuation">(</span>whn<span class="token punctuation">,</span><span class="token keyword">interval</span> <span class="token number">2</span> <span class="token keyword">day</span><span class="token punctuation">)</span> 加<span class="token number">2</span>天
<span class="token keyword">from</span> covid
<span class="token keyword">where</span> recovered <span class="token operator">&gt;</span> <span class="token number">0</span>
</code></pre> 
<ul><li><strong>运行结果</strong><br> <img src="https://images2.imgbox.com/b5/f0/9U0D0kfw_o.png" alt="在这里插入图片描述"><br> <br></li></ul> 
<p><strong><font color="#FF8C00">d. round和concat嵌套得到百分比数据</font></strong></p> 
<ul><li><strong>运行代码</strong><br> <img src="https://images2.imgbox.com/8f/94/AhQfPN8O_o.png" alt="在这里插入图片描述"></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">select</span>
	confirmed
	<span class="token punctuation">,</span>deaths
	<span class="token punctuation">,</span>recovered
	<span class="token punctuation">,</span>recovered<span class="token operator">/</span>confirmed
	<span class="token punctuation">,</span>concat<span class="token punctuation">(</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">(</span>recovered<span class="token operator">/</span>confirmed<span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'%'</span><span class="token punctuation">)</span> 治愈率
<span class="token keyword">from</span> covid
<span class="token keyword">where</span> recovered<span class="token operator">/</span>confirmed <span class="token operator">&gt;</span> <span class="token number">0.3</span>
</code></pre> 
<ul><li><strong>运行结果</strong><br> <img src="https://images2.imgbox.com/95/e7/ODn44lQF_o.png" alt="在这里插入图片描述"><br> <br></li></ul> 
<p><strong><font color="#FF8C00">e. replace函数</font></strong></p> 
<ul><li><strong>运行代码</strong><br> <img src="https://images2.imgbox.com/b5/0b/mYPkdYub_o.png" alt="在这里插入图片描述"></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> <span class="token keyword">distinct</span>
	name
	<span class="token punctuation">,</span><span class="token keyword">replace</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token string">'替换'</span><span class="token punctuation">)</span> 替换
<span class="token keyword">from</span> covid
</code></pre> 
<ul><li><strong>运行结果</strong><br> <img src="https://images2.imgbox.com/4f/24/ycX1lPUg_o.png" alt="在这里插入图片描述"><br> <br></li></ul> 
<p><strong><font color="#FF8C00"> f. substring函数</font></strong></p> 
<ul><li><strong>运行代码</strong><br> <img src="https://images2.imgbox.com/ae/57/4r7YuYtE_o.png" alt="在这里插入图片描述"></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> <span class="token keyword">distinct</span>
	name
	<span class="token punctuation">,</span>substring<span class="token punctuation">(</span>name<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span>
	<span class="token punctuation">,</span>substring<span class="token punctuation">(</span>name<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">from</span> covid
<span class="token keyword">where</span> recovered<span class="token operator">/</span>confirmed <span class="token operator">&gt;</span> <span class="token number">0.3</span>
</code></pre> 
<ul><li><strong>运行结果</strong><br> <img src="https://images2.imgbox.com/fb/96/iCbEvdId_o.png" alt="在这里插入图片描述"><br> <br></li></ul> 
<p><font size="4"><strong>（3）总结</strong></font></p> 
<ul><li><strong>数学函数</strong> 
  <ul><li>round(x,y)—四舍五入函数<br> <br></li></ul> </li><li><strong>字符串函数</strong> 
  <ul><li>concat(s1,s2,…)—连接字符串函数</li><li>replace(s,s1,s2)—替换函数</li><li>left(s,n)—从左截取字符串一部分的函数</li><li>right(s,n)—从右截取字符串一部分的函数</li><li>substring(s,n,len)—从指定位置截取字符串一部分的函数<br> <br></li></ul> </li><li><strong>数据类型转换函数</strong> 
  <ul><li>cast(x as type)—转换数据类型的函数<br> <br></li></ul> </li><li><strong>日期时间函数</strong> 
  <ul><li>year(date)—获取年的函数</li><li>month(date)—获取月的函数</li><li>day(date)—获取日的函数</li><li>date_add(date,interval expr type)—对指定起始时间进行加操作</li><li>date_sub(date,interval expr type)—对指定起始时间进行减操作</li><li>datediff(date1,date2)—计算两个日期之间间隔的天数</li><li>date_format(date,format)—将日期和时间格式化<br> <br></li></ul> </li><li><strong>条件判断函数</strong>—根据满足不同条件，执行相应流程 
  <ul><li>if(expr,v1,v2)</li><li>case when 
    <ul><li>case expr when v1 then r1 [when v2 then r2] …[else rn] end</li><li>case when v1 then r1 [when v2 then r2]…[else rn] end<br> <br></li></ul> </li></ul> </li></ul> 
<p><font size="4"><strong>（4）练习题</strong></font></p> 
<p><font color="#EE82EE"><strong>习题链接1：<a href="https://sqlzoo.net/wiki/SELECT_from_WORLD_Tutorial" rel="nofollow">https://sqlzoo.net/wiki/SELECT_from_WORLD_Tutorial</a>（链接中标号12）涉及数据表：world</strong></font></p> 
<p><strong><font color="#EE82EE">题目1：查询国家名称及其首都名称都以相同的字母开头的国家名及其首都，且不能包括国家名称和首都名称完全相同的情况</font></strong></p> 
<ul><li><strong>运行代码</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">select</span>
	name
	<span class="token punctuation">,</span>capital
<span class="token keyword">from</span> world
<span class="token keyword">where</span> <span class="token keyword">left</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">left</span><span class="token punctuation">(</span>capital<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token operator">and</span> name <span class="token operator">!=</span> capital
</code></pre> 
<ul><li><strong>运行结果</strong><br> <img src="https://images2.imgbox.com/d9/4d/bKcGTaQV_o.png" alt="在这里插入图片描述"></li></ul> 
<p><font color="#EE82EE"><strong>习题链接2：<a href="https://sqlzoo.net/wiki/SELECT_names" rel="nofollow">https://sqlzoo.net/wiki/SELECT_names</a>（链接中标号14）涉及数据表：world</strong></font></p> 
<p><strong><font color="#EE82EE">题目2：查询首都和名称，其中首都需是国家名称的扩展</font></strong><br> <code>例如：答案中应该包括墨西哥城（Mexico City），因为它比墨西哥（Mexico）更长，而不应该将卢森堡（Luxembourg）包括在内，因为首都名与国家名相同</code></p> 
<ul><li><strong>运行代码</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">select</span>
	capital
	<span class="token punctuation">,</span>name
<span class="token keyword">from</span> world
<span class="token keyword">where</span> capital <span class="token operator">like</span> concat<span class="token punctuation">(</span><span class="token string">'%'</span><span class="token punctuation">,</span>name<span class="token punctuation">,</span><span class="token string">'%'</span><span class="token punctuation">)</span>
<span class="token operator">and</span> capital <span class="token operator">!=</span> name
</code></pre> 
<ul><li><strong>运行结果</strong><br> <img src="https://images2.imgbox.com/cf/51/Dh9AnFlb_o.png" alt="在这里插入图片描述"><br> <br></li></ul> 
<h3><a id="8__640"></a>8. 窗口函数</h3> 
<p><font size="4"><strong>（1）知识点引入</strong></font></p> 
<ul><li><strong>标准语法</strong> 
  <ul><li>窗口函数 over([partition by 字段名] [order by 字段名 asc|desc])<br> <br></li></ul> </li><li><strong>语法讲解</strong> 
  <ul><li>over()中两个子句为可选项，partition by指定<strong>分区</strong>依据，order by指定<strong>排序</strong>依据<br> <br></li></ul> </li><li><strong>排序窗口函数</strong> 
  <ul><li>rank() over()：12245…</li><li>dense_rank() over()：12234…</li><li>row_number() over()：12345…<br> <br></li></ul> </li><li><strong>偏移分析函数</strong> 
  <ul><li>lag(字段名,偏移量[,默认值]) over()：向前</li><li>lead(字段名,偏移量[,默认值]) over()：向后<br> <br></li></ul> </li></ul> 
<p><font size="4"><strong>（2）例题讲解</strong></font></p> 
<p><strong><font color="#FF8C00" size="4">a. 排序窗口函数</font></strong></p> 
<p><font color="#EE82EE"><strong>例题链接：（链接中标号3）<a href="https://sqlzoo.net/wiki/Window_functions" rel="nofollow">https://sqlzoo.net/wiki/Window_functions</a> 涉及数据表：ge</strong></font></p> 
<p><strong><font color="#EE82EE">【例题29】查询每一年S14000021选区中所有候选人所在的团体(party)和得票数(votes)，并对每一年中的所有候选人根据选票数的高低赋予名次，选票数最高则为1，第二名则为2，后续以此类推，最后根据团体(party)和年份(yr)排序</font></strong></p> 
<ul><li><strong>运行代码</strong><br> <img src="https://images2.imgbox.com/8e/88/YAwkmwTH_o.png" alt="在这里插入图片描述"></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">select</span>
	yr
	<span class="token punctuation">,</span>party
	<span class="token punctuation">,</span>votes
	<span class="token punctuation">,</span>rank<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">over</span><span class="token punctuation">(</span><span class="token keyword">partition</span> <span class="token keyword">by</span> yr <span class="token keyword">order</span> <span class="token keyword">by</span> votes <span class="token keyword">desc</span><span class="token punctuation">)</span> <span class="token keyword">as</span> posn
<span class="token keyword">from</span> ge
<span class="token keyword">where</span> constituency <span class="token operator">=</span> <span class="token string">'S14000021'</span>
<span class="token keyword">order</span> <span class="token keyword">by</span> party<span class="token punctuation">,</span>yr
</code></pre> 
<ul><li><strong>运行结果</strong><br> <img src="https://images2.imgbox.com/77/28/KscLLY1y_o.png" alt="在这里插入图片描述"></li><li><strong>Excel演示：演示排序窗口函数如何赋予排序值</strong><br> <img src="https://images2.imgbox.com/68/4b/IEgSDKAM_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/56/07/RbjuUSlo_o.png" alt="在这里插入图片描述"></li><li><strong>知识点讲解</strong> 
  <ul><li>1.窗口函数只能写在select字句中</li><li>2.窗函数中的partition by子句可以指定数据的分区，和group by要去重分组不同的是，partition by<strong>只分区不去重</strong></li><li>3.窗口函数中没有partition by子句时，即不对数据分区，直接整个表为一个区</li><li>4.排序窗口函数中<strong>order by</strong>子句是<strong>必选项</strong>，窗口函数中order by子句在<strong>分区内</strong>，依据指定字段和排序方法对数据行排序</li><li>5.rank()、dense_rank)、row_number()指定<strong>排序赋值方法</strong>，对比三个排序窗口函数的异同 
    <ul><li><strong>rank()：跳跃式排序</strong>——比如数值为99，99，90，89，那么通过这个<br> 函数得到的排名为1，1，3，4</li><li><strong>dense_rank()：并列连续型排序</strong>——比如数值为99，99，90，89，那么通过这个函数得到的排名为1，1，2，3</li><li><strong>row_number()：连续型排序</strong>——比如数值为99，99，90，89，那么通过这个函数得到的排名为1，2，3，4</li><li>根据对排序值的需求选择相应的排序窗口函数，由于值的不同特性(比如数值不重复)，这三个函数可以通用<br> <br></li></ul> </li></ul> </li></ul> 
<p><strong><font color="#FF8C00" size="4">b. 偏移分析函数</font></strong></p> 
<p><font color="#EE82EE"><strong>例题链接：（链接中标号2）<a href="https://sqlzoo.net/wiki/Window_LAG" rel="nofollow">https://sqlzoo.net/wiki/Window_LAG</a> 涉及数据表：covid</strong></font></p> 
<p><strong><font color="#EE82EE">【例题30】查询法国和德国1月每天新增确诊人数，最后显示国家名、标准日期（2020-01-27）、当天截至时间累计确诊人数、昨天截至时间累计确诊人数、每天新增确诊人数，按照截至时间排序</font></strong></p> 
<ul><li><strong>运行代码</strong><br> <img src="https://images2.imgbox.com/7e/9c/HjHeglup_o.png" alt="在这里插入图片描述"></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">select</span>
	name
	<span class="token punctuation">,</span>date_format<span class="token punctuation">(</span>whn<span class="token punctuation">,</span><span class="token string">'%Y-%m-%d'</span><span class="token punctuation">)</span> <span class="token keyword">date</span>
	<span class="token punctuation">,</span>confirmed 当天截至时间累计确诊人数
	<span class="token punctuation">,</span>lag<span class="token punctuation">(</span>confirmed<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token keyword">over</span><span class="token punctuation">(</span><span class="token keyword">partition</span> <span class="token keyword">by</span> name <span class="token keyword">order</span> <span class="token keyword">by</span> whn<span class="token punctuation">)</span> 昨天截至时间累计确诊人数
	<span class="token punctuation">,</span><span class="token punctuation">(</span>confirmed <span class="token operator">-</span> lag<span class="token punctuation">(</span>confirmed<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token keyword">over</span><span class="token punctuation">(</span><span class="token keyword">partition</span> <span class="token keyword">by</span> name <span class="token keyword">order</span> <span class="token keyword">by</span> whn<span class="token punctuation">)</span><span class="token punctuation">)</span> 每天新增确诊人数
<span class="token keyword">from</span> covid
<span class="token keyword">where</span> name <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token string">'France'</span><span class="token punctuation">,</span><span class="token string">'Germany'</span><span class="token punctuation">)</span> <span class="token operator">and</span> <span class="token keyword">month</span><span class="token punctuation">(</span>whn<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">order</span> <span class="token keyword">by</span> whn
</code></pre> 
<ul><li> <p><strong>运行结果</strong><br> <img src="https://images2.imgbox.com/62/d9/VK49aIfg_o.png" alt="在这里插入图片描述"></p> </li><li> <p><strong>Excel演示</strong><br> <img src="https://images2.imgbox.com/4a/b4/XAdGTDee_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/fa/d8/9B6HSHe4_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/15/29/QK2OwYGw_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/a2/a5/ZXe5ecmP_o.png" alt="在这里插入图片描述"></p> </li><li> <p><strong>知识点讲解</strong></p> 
  <ul><li>1.偏移分析窗口函数中<strong>order by子句是必选项</strong></li><li>2.lag()和lead()指定偏移的方向，<strong>lag是向上偏移</strong>，行向上取数据，<strong>lead是向下偏移</strong>，行向下取数据</li><li>3.lag(字段名,偏移量[,默认值])over()还有一个参数为<strong>默认值，是可选项</strong>，在分区中没有前一行的情况下填充默认值，不填的情况下<strong>默认是null</strong><br> <br></li></ul> </li></ul> 
<p><font size="4"><strong>（3）总结</strong></font></p> 
<ul><li><strong>排序窗口函数语法</strong> 
  <ul><li>rank() over([partition by 字段名] order by 字段名 asc|desc)</li><li>dense_rank() over([partition by 字段名] order by 字段名 asc|desc)</li><li>row_number() over([partition by 字段名] order by 字段名 asc|desc)<br> <br></li></ul> </li><li><strong>偏移分析函数语法</strong> 
  <ul><li>lag(字段名,偏移量[,默认值]) over([partition by 字段名] order by 字段名 asc|desc)</li><li>lead(字段名,偏移量[,默认值]) over([partition by 字段名] order by 字段名 asc|desc)<br> <br></li></ul> </li></ul> 
<p><font size="4"><strong>（4）练习题</strong></font><br> <font color="#EE82EE"><strong>习题链接1：<a href="https://sqlzoo.net/wiki/Window_functions" rel="nofollow">https://sqlzoo.net/wiki/Window_functions</a>（链接中标号2）涉及数据表：ge</strong></font></p> 
<p><strong><font color="#EE82EE">题目1：查询2017年选区为 ‘S14000024’ 的所有候选人所在团体（party）和其选票数（votes）、还有候选人得票数在选区内对应的的排名</font></strong></p> 
<ul><li><strong>运行代码</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">select</span>
	party
	<span class="token punctuation">,</span>votes
	<span class="token punctuation">,</span>rank<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">over</span> <span class="token punctuation">(</span><span class="token keyword">order</span> <span class="token keyword">by</span> votes <span class="token keyword">desc</span><span class="token punctuation">)</span> <span class="token keyword">as</span> posn
<span class="token keyword">from</span> ge
<span class="token keyword">where</span> constituency <span class="token operator">=</span> <span class="token string">'S14000024'</span> <span class="token operator">and</span> yr <span class="token operator">=</span> <span class="token number">2017</span>
<span class="token keyword">order</span> <span class="token keyword">by</span> party
</code></pre> 
<ul><li><strong>运行结果</strong><br> <img src="https://images2.imgbox.com/c8/18/tB8E2L1I_o.png" alt="在这里插入图片描述"></li></ul> 
<p><code>高考排名：rank()排名</code><br> <br></p> 
<p><font color="#EE82EE"><strong>习题链接2：<a href="https://sqlzoo.net/wiki/Window_LAG" rel="nofollow">https://sqlzoo.net/wiki/Window_LAG</a>（链接中标号6）涉及数据表：covid</strong></font></p> 
<p><strong><font color="#EE82EE">题目2：查询截至时间为2020年4月20日的国家名，确诊人数，确诊人数排名，死亡人数，死亡人数排名，按照确诊人数降序排名</font></strong></p> 
<ul><li><strong>运行代码</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">select</span>
name
	<span class="token punctuation">,</span>confirmed
	<span class="token punctuation">,</span>rank<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">over</span><span class="token punctuation">(</span><span class="token keyword">order</span> <span class="token keyword">by</span> confirmed <span class="token keyword">desc</span><span class="token punctuation">)</span> rk
	<span class="token punctuation">,</span>deaths
	<span class="token punctuation">,</span>rank<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">over</span><span class="token punctuation">(</span><span class="token keyword">order</span> <span class="token keyword">by</span> deaths <span class="token keyword">desc</span><span class="token punctuation">)</span> deathrk
<span class="token keyword">from</span> covid
<span class="token keyword">where</span> whn <span class="token operator">=</span> <span class="token string">'2020-04-20'</span>
<span class="token keyword">order</span> <span class="token keyword">by</span> confirmed <span class="token keyword">desc</span>
</code></pre> 
<ul><li><strong>运行结果</strong><br> <img src="https://images2.imgbox.com/f9/84/VG78Yfmg_o.png" alt="在这里插入图片描述"><br> <br></li></ul> 
<p><font color="#EE82EE"><strong>习题链接3：<a href="https://sqlzoo.net/wiki/Window_LAG" rel="nofollow">https://sqlzoo.net/wiki/Window_LAG</a>（链接中标号4）涉及数据表：covid</strong></font></p> 
<p><strong><font color="#EE82EE">题目3：查询意大利每周新增确诊数（显示每周一的数值 weekday(whn) = 0）；最后显示国家名，标准日期（2020-01-27），每周新增人数；按照截至时间排序</font></strong></p> 
<ul><li><strong>运行代码</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">select</span>
	name
	<span class="token punctuation">,</span> date_format<span class="token punctuation">(</span>whn<span class="token punctuation">,</span><span class="token string">'%Y-%m-%d'</span><span class="token punctuation">)</span> <span class="token keyword">date</span>
	<span class="token punctuation">,</span> <span class="token punctuation">(</span>confirmed <span class="token operator">-</span> lag<span class="token punctuation">(</span>confirmed<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token keyword">over</span><span class="token punctuation">(</span><span class="token keyword">partition</span> <span class="token keyword">by</span> name <span class="token keyword">order</span> <span class="token keyword">by</span> whn<span class="token punctuation">)</span><span class="token punctuation">)</span>  New
<span class="token keyword">from</span> covid
<span class="token keyword">where</span> name <span class="token operator">=</span> <span class="token string">'Italy'</span>
<span class="token operator">and</span> weekday<span class="token punctuation">(</span>whn<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">order</span> <span class="token keyword">by</span> whn
</code></pre> 
<ul><li><strong>运行结果</strong><br> <img src="https://images2.imgbox.com/99/01/PMtwP4Mn_o.png" alt="在这里插入图片描述"><br> <br></li></ul> 
<h3><a id="9__798"></a>9. 表连接</h3> 
<p><font size="4"><strong>（1）知识点引入</strong></font></p> 
<ul><li><strong>基础语法</strong> 
  <ul><li><strong>内连接</strong> 
    <ul><li>select 字段名</li><li>from 表名1 inner join 表名2 on 表名1.字段名 = 表名2.字段名</li><li>注意内连接inner可以省略，直接使用join默认为内连接<br> <br></li></ul> </li><li><strong>左连接</strong> 
    <ul><li>select 字段名</li><li>from 表名1 left join 表名2 on 表名1.字段名 = 表名2.字段名<br> <br></li></ul> </li><li><strong>右连接</strong> 
    <ul><li>select 字段名</li><li>from 表名1 right join 表名2 on 表名1.字段名 = 表名2.字段名</li></ul> </li></ul> </li><li><strong>语法解释</strong> 
  <ul><li> <p>join表连接通过on 表名1.字段名= 表名2.字段名，将两个表格各自的字段等值连接来匹配连接，无法匹配的填充null值</p> </li><li> <p><strong>Excel演示</strong> <code>连接其实是先连接再剔除的过程</code><img src="https://images2.imgbox.com/ee/71/hrJg9HAS_o.png" alt="在这里插入图片描述"></p> </li><li> <p>inner join内连接，连接两个表留下同时互相匹配上的行得到一张新表</p> 
    <ul><li>Excel演示<br> <img src="https://images2.imgbox.com/28/73/MQcfYNSi_o.png" alt="在这里插入图片描述"><br> <code>将左右两表有null值的行全部剔除，只保留连接上的行（不允许任何null值存在）</code></li></ul> </li><li> <p>left join左连接，左边的表返回所有行，右边的表只留下匹配上的行得到一张新表</p> 
    <ul><li>Excel演示 <img src="https://images2.imgbox.com/10/47/nytRoGlJ_o.png" alt="在这里插入图片描述"><br> <code>将左边表null值剔除（左边表不允许null值存在）</code></li></ul> </li><li> <p>right join右连接，右边的表返回所有行，左边的表只留下匹配上的行得到一张新表</p> 
    <ul><li>Excel演示<br> <img src="https://images2.imgbox.com/56/78/grq4Q70M_o.png" alt="在这里插入图片描述"><br> <code>将右边表null值剔除（右边表不允许null值存在）</code></li></ul> </li><li> <p>from <strong>表1 left join 表2</strong> on 表1字段A=表2.字段B <strong>等价于</strong> from <strong>表2 right join 表1</strong> on 表1.字段A=表2.字段B<br> <br></p> </li></ul> </li></ul> 
<p><font size="4"><strong>（2）例题讲解</strong></font><br> <font color="#EE82EE"><strong>例题链接：（链接中标号4）<a href="https://sqlzoo.net/wiki/The_JOIN_operation" rel="nofollow">https://sqlzoo.net/wiki/The_JOIN_operation</a> 涉及数据表：game、goal、eteam</strong></font></p> 
<p><strong><font color="#EE82EE">【例题31】查询有球员名叫Mario进球的队伍1（team1），队伍2（team2）及球员姓名</font></strong></p> 
<ul><li><strong>运行代码</strong><br> <img src="https://images2.imgbox.com/69/f8/hY3KkDuV_o.png" alt="在这里插入图片描述"></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">select</span>
	team1
	<span class="token punctuation">,</span>team2
	<span class="token punctuation">,</span>player
<span class="token keyword">from</span> game
<span class="token keyword">join</span> goal
<span class="token keyword">on</span> game<span class="token punctuation">.</span>id <span class="token operator">=</span> goal<span class="token punctuation">.</span>matchid
<span class="token keyword">where</span> player <span class="token operator">like</span> <span class="token string">'Mario%'</span>
</code></pre> 
<ul><li><strong>运行结果</strong><br> <img src="https://images2.imgbox.com/80/47/XvN4YrnY_o.png" alt="在这里插入图片描述"><br> <br></li></ul> 
<p><strong><font color="#EE82EE">【例题32】查询队伍1（team1）的教练是“Fernando Santos”的球队名称（teamname）、比赛日期（mdate）和赛事编号（id）</font></strong></p> 
<ul><li><strong>运行代码</strong><br> <img src="https://images2.imgbox.com/c0/1b/JAgTbQ6g_o.png" alt="在这里插入图片描述"></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">select</span>
	mdate
	<span class="token punctuation">,</span>teamname
	<span class="token punctuation">,</span>game<span class="token punctuation">.</span>id
<span class="token keyword">from</span> game
<span class="token keyword">join</span> eteam
<span class="token keyword">on</span> eteam<span class="token punctuation">.</span>id <span class="token operator">=</span> game<span class="token punctuation">.</span>team1
<span class="token keyword">where</span> coach <span class="token operator">=</span> <span class="token string">'Fernando Santos'</span>
</code></pre> 
<ul><li><strong>运行结果</strong><br> <img src="https://images2.imgbox.com/36/ed/5rXfpPm1_o.png" alt="在这里插入图片描述"><br> <br></li></ul> 
<p><font color="#EE82EE"><strong>例题链接：（链接中标号3）<a href="https://sqlzoo.net/wiki/Using_Null" rel="nofollow">https://sqlzoo.net/wiki/Using_Null</a> 涉及数据表：teacher、dept</strong></font></p> 
<p><strong><font color="#EE82EE">【例题33】使用合适的连接显示所有教师及其所教授的科目名</font></strong></p> 
<ul><li><strong>运行代码</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">select</span>
	t<span class="token punctuation">.</span>name
	<span class="token punctuation">,</span>d<span class="token punctuation">.</span>name
<span class="token keyword">from</span> teacher t
<span class="token keyword">left</span> <span class="token keyword">join</span> dept d
<span class="token keyword">on</span> t<span class="token punctuation">.</span>dept <span class="token operator">=</span> d<span class="token punctuation">.</span>id
</code></pre> 
<ul><li><strong>运行结果</strong><br> <img src="https://images2.imgbox.com/16/a6/4aOOKDkb_o.png" alt="在这里插入图片描述"></li><li><strong>知识点讲解</strong> 
  <ul><li>1.左连接可以保留左边表的所有数据行，同理右连接保留右边表的所有数据行</li><li>2.from <strong>teacher left join</strong> dept等同于from dept <strong>right join teacher</strong></li><li>3.对比以下连接运行结果，可以说表连接也有筛选数据的功能 
    <ul><li>join内连接<br> <img src="https://images2.imgbox.com/d4/2e/wIxwkO4o_o.png" alt="在这里插入图片描述"></li><li>left join左连接<br> <img src="https://images2.imgbox.com/23/4d/qPk1bcOZ_o.png" alt="在这里插入图片描述"></li><li>right join右连接 <img src="https://images2.imgbox.com/db/b7/GpYdfBrt_o.png" alt="在这里插入图片描述"><br> <br></li></ul> </li></ul> </li></ul> 
<p><font size="4"><strong>（3）总结</strong></font></p> 
<ul><li><strong>内连接inner join语法</strong> 
  <ul><li>select 字段名</li><li>from 表名1 inner join 表名2 on 表名1.字段名 = 表名2.字段名</li><li>注意内连接inner可以省略，直接使用join默认为内连接<br> <br></li></ul> </li><li><strong>左连接left join语法</strong> 
  <ul><li>select 字段名</li><li>from 表名1 left join 表名2 on 表名1.字段名 = 表名2.字段名<br> <br></li></ul> </li><li><strong>右连接right join语法</strong> 
  <ul><li>select 字段名</li><li>from 表名1 right join 表名2 on 表名1.字段名 = 表名2.字段名<br> <br></li></ul> </li></ul> 
<p><font size="4"><strong>（4）练习题</strong></font></p> 
<p><font color="#EE82EE"><strong>习题链接1：<a href="https://sqlzoo.net/wiki/More_JOIN_operations" rel="nofollow">https://sqlzoo.net/wiki/More_JOIN_operations</a>（链接中标号13）涉及数据表：movie、casting、actor</strong></font></p> 
<p><strong><font color="#EE82EE">题目1：查询至少出演过第1主角30次的演员名</font></strong></p> 
<ul><li><strong>运行代码</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> 
	name
<span class="token keyword">from</span> casting c
<span class="token keyword">join</span> actor a
<span class="token keyword">on</span> c<span class="token punctuation">.</span>actorid <span class="token operator">=</span> a<span class="token punctuation">.</span>id
<span class="token keyword">where</span> ord <span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">group</span> <span class="token keyword">by</span> name
<span class="token keyword">having</span> <span class="token function">count</span><span class="token punctuation">(</span>movieid<span class="token punctuation">)</span><span class="token operator">&gt;=</span><span class="token number">30</span>
</code></pre> 
<ul><li><strong>运行结果</strong><br> <img src="https://images2.imgbox.com/b5/b0/Zesi0JKV_o.png" alt="在这里插入图片描述"><br> <br></li></ul> 
<p><font color="#EE82EE"><strong>习题链接2：<a href="https://sqlzoo.net/wiki/The_JOIN_operation" rel="nofollow">https://sqlzoo.net/wiki/The_JOIN_operation</a>（链接中标号5）涉及数据表：game、goal、eteam</strong></font></p> 
<p><strong><font color="#EE82EE">题目2：查询在比赛前十分钟有进球记录的球员，他的队伍编号(teamid)，教练(coach), 进球时间(gtime)</font></strong></p> 
<ul><li><strong>运行代码</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">select</span>
	player
	<span class="token punctuation">,</span>teamid
	<span class="token punctuation">,</span>coach
	<span class="token punctuation">,</span>gtime
<span class="token keyword">from</span> goal
<span class="token keyword">join</span> eteam
<span class="token keyword">on</span> goal<span class="token punctuation">.</span>teamid <span class="token operator">=</span> eteam<span class="token punctuation">.</span>id
<span class="token keyword">where</span> goal<span class="token punctuation">.</span>gtime  <span class="token operator">&lt;=</span> <span class="token number">10</span>
</code></pre> 
<ul><li><strong>运行结果</strong><br> <img src="https://images2.imgbox.com/38/a0/NEiAs28U_o.png" alt="在这里插入图片描述"><br> <br></li></ul> 
<p><font color="#EE82EE"><strong>习题链接3：<a href="https://sqlzoo.net/wiki/The_JOIN_operation" rel="nofollow">https://sqlzoo.net/wiki/The_JOIN_operation</a>（链接中标号13）涉及数据表：game、goal、eteam</strong></font></p> 
<p><strong><font color="#EE82EE">题目3：查询每场比赛，每个球队的得分情况，按照以下格式显示，最后按照举办时间（mdate）、赛事编号（matchid）、队伍1（team1）和队伍2（team2）排序</font></strong><br> <img src="https://images2.imgbox.com/6d/80/ZmfQ8cHx_o.png" alt="在这里插入图片描述"></p> 
<ul><li><strong>运行代码</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">select</span>
	ga<span class="token punctuation">.</span>mdate
	<span class="token punctuation">,</span>ga<span class="token punctuation">.</span>team1
	<span class="token punctuation">,</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">case</span> <span class="token keyword">when</span> ga<span class="token punctuation">.</span>team1<span class="token operator">=</span>go<span class="token punctuation">.</span>teamid <span class="token keyword">then</span> <span class="token number">1</span> <span class="token keyword">else</span> <span class="token number">0</span> <span class="token keyword">end</span><span class="token punctuation">)</span> score1
	<span class="token punctuation">,</span>ga<span class="token punctuation">.</span>team2
	<span class="token punctuation">,</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">case</span> <span class="token keyword">when</span> ga<span class="token punctuation">.</span>team2<span class="token operator">=</span>go<span class="token punctuation">.</span>teamid <span class="token keyword">then</span> <span class="token number">1</span> <span class="token keyword">else</span> <span class="token number">0</span> <span class="token keyword">end</span><span class="token punctuation">)</span> score2
<span class="token keyword">from</span> game ga
<span class="token keyword">left</span> <span class="token keyword">join</span> goal go
<span class="token keyword">on</span> ga<span class="token punctuation">.</span>id <span class="token operator">=</span> go<span class="token punctuation">.</span>matchid
<span class="token keyword">group</span> <span class="token keyword">by</span> ga<span class="token punctuation">.</span>mdate<span class="token punctuation">,</span>ga<span class="token punctuation">.</span>team1<span class="token punctuation">,</span>ga<span class="token punctuation">.</span>team2
<span class="token keyword">order</span> <span class="token keyword">by</span> ga<span class="token punctuation">.</span>mdate<span class="token punctuation">,</span> go<span class="token punctuation">.</span>matchid<span class="token punctuation">,</span> ga<span class="token punctuation">.</span>team1<span class="token punctuation">,</span> ga<span class="token punctuation">.</span>team2
</code></pre> 
<ul><li><strong>运行结果</strong><br> <img src="https://images2.imgbox.com/e2/47/75Sb8Kkp_o.png" alt="在这里插入图片描述"><br> <br></li></ul> 
<h3><a id="10__977"></a>10. 子查询</h3> 
<p><font size="4"><strong>（1）知识点引入</strong></font></p> 
<ul><li>子查询本身就是一段完整的查询语句，然后用括号<strong>英文括号()<strong>包裹</strong>嵌套在主查询语句</strong>中，子查询可以<strong>多层嵌套</strong></li><li>最常用的子查询运用在from和where子句中<br> <br></li></ul> 
<p><font size="4"><strong>（2）例题讲解</strong></font></p> 
<p><strong><font color="#FF8C00" size="4">a. where基于子查询条件筛选（比较运算符&amp;in关键字）</font></strong></p> 
<p><font color="#EE82EE"><strong>例题链接：（链接中标号6）<a href="https://sqlzoo.net/wiki/SELECT_within_SELECT_Tutorial" rel="nofollow">https://sqlzoo.net/wiki/SELECT_within_SELECT_Tutorial</a> 涉及数据表：world</strong></font></p> 
<p><strong><font color="#EE82EE">【例题34】查询出gdp高于欧洲每个国家的所有国家名，有一些国家gdp值可能为NULL，请排除这些国家</font></strong></p> 
<ul><li><strong>运行代码</strong><br> <img src="https://images2.imgbox.com/64/50/fpILWi1n_o.png" alt="在这里插入图片描述"></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> 
	name
<span class="token keyword">from</span> world
<span class="token keyword">where</span> gdp <span class="token operator">is</span> <span class="token operator">not</span> <span class="token boolean">null</span>
<span class="token operator">and</span> gdp <span class="token operator">&gt;</span> <span class="token punctuation">(</span>
             <span class="token keyword">select</span> 
             	<span class="token function">max</span><span class="token punctuation">(</span>gdp<span class="token punctuation">)</span>
             <span class="token keyword">from</span> world
             <span class="token keyword">where</span> continent <span class="token operator">=</span> <span class="token string">'Europe'</span>
<span class="token punctuation">)</span>
</code></pre> 
<ul><li><strong>运行结果</strong><br> <img src="https://images2.imgbox.com/be/16/0RSReK8k_o.png" alt="在这里插入图片描述"><br> <br></li></ul> 
<p><strong><font color="#EE82EE">【例题35】查询跟阿尔及尼亚（Argentina）和澳大利亚（Australia）在同一大洲的所有国家名及其所属大洲， 并按照国家名进行排序</font></strong></p> 
<ul><li><strong>运行代码</strong><br> <img src="https://images2.imgbox.com/6c/5c/x5nFd2rH_o.png" alt="在这里插入图片描述"></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">select</span>
	name
	<span class="token punctuation">,</span>continent
<span class="token keyword">from</span> world
<span class="token keyword">where</span> continent <span class="token operator">in</span> <span class="token punctuation">(</span>
                       <span class="token keyword">select</span> 
                         	continent
                       <span class="token keyword">from</span> world
                       <span class="token keyword">where</span> name <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token string">'Argentina'</span><span class="token punctuation">,</span><span class="token string">'Australia'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
<span class="token keyword">order</span> <span class="token keyword">by</span> name
</code></pre> 
<ul><li><strong>运行结果</strong><br> <img src="https://images2.imgbox.com/82/87/PkoQZoUv_o.png" alt="在这里插入图片描述"><br> <br></li></ul> 
<p><strong><font color="#FF8C00" size="4">b. from基于子查询作为数据表</font></strong></p> 
<p><font color="#EE82EE"><strong>例题链接：（链接中标号5）<a href="https://sqlzoo.net/wiki/Window_functions" rel="nofollow">https://sqlzoo.net/wiki/Window_functions</a> 涉及数据表：ge</strong></font></p> 
<p><strong><font color="#EE82EE">【例题36】查询2017年所有在爱丁堡的选区当选议员所在选区（constituency）及其团队（party），已知爱丁堡选区编号为S14000021至S14000026，当选议员即各选区得票数最高的候选人</font></strong></p> 
<ul><li><strong>运行代码</strong><br> <img src="https://images2.imgbox.com/73/1d/YhnUeYwe_o.png" alt="在这里插入图片描述"></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">select</span>
	constituency
	<span class="token punctuation">,</span>party
<span class="token keyword">from</span><span class="token punctuation">(</span>
	    <span class="token keyword">select</span>
	    	constituency
	    	<span class="token punctuation">,</span>party
	    	<span class="token punctuation">,</span>votes
	    	<span class="token punctuation">,</span>rank<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">over</span><span class="token punctuation">(</span><span class="token keyword">partition</span> <span class="token keyword">by</span> constituency <span class="token keyword">order</span> <span class="token keyword">by</span> votes <span class="token keyword">desc</span><span class="token punctuation">)</span>  posn
	    <span class="token keyword">from</span> ge
	    <span class="token keyword">where</span> constituency <span class="token operator">between</span> <span class="token string">'S14000021'</span> <span class="token operator">and</span> <span class="token string">'S14000026'</span>
	    <span class="token operator">and</span> yr  <span class="token operator">=</span> <span class="token number">2017</span>
<span class="token punctuation">)</span>  <span class="token keyword">as</span> rk
<span class="token keyword">where</span> rk<span class="token punctuation">.</span>posn <span class="token operator">=</span> <span class="token number">1</span>
</code></pre> 
<ul><li><strong>运行结果</strong><br> <img src="https://images2.imgbox.com/ae/4d/jziJFRuz_o.png" alt="在这里插入图片描述"></li><li><strong>知识点讲解</strong> 
  <ul><li>1.from子句中的子查询，本质上是通过一段查询语句得出的查询结果<strong>作为主查询的数据来源</strong></li><li>2.from子查询结果可以是<strong>多行多列</strong></li><li>3.from子查询<strong>必须使用别名</strong>，同样可以省略as，不使用别名会报错</li><li>4.where rk.posn=1要写在主查询中，不能写在子查询中，因为一段查询语句中where子句先于窗口函数运行，运行where子句时还没有posn字段，无法进行条件筛选，运行完窗口函数有posn字段时，不会再返回运行where子句，因此必须写子查询，优先运行完子查询得到的查询结果有posn列，该子查询作为主查询的数据来源，主查询就可以正常运行筛选条件语句where rk.posn=1<br> <br></li></ul> </li></ul> 
<p><font size="4"><strong>（3）总结</strong></font></p> 
<ul><li>子查询本身是一个完整的查询，由括号包裹嵌套在主查询中</li><li>子查询最后返回查询出的结果给主查询</li><li>子查询可以在select，from，where，having子句（同where）中使用，但要注意不同子句能接受的子查询种类有差别</li><li>子查询可以多重嵌套（子查询可以作为主查询再嵌套子查询）<br> <br></li></ul> 
<p><font size="4"><strong>（4）练习题</strong></font></p> 
<p><font color="#EE82EE"><strong>习题链接1：<a href="https://sqlzoo.net/wiki/SELECT_within_SELECT_Tutorial" rel="nofollow">https://sqlzoo.net/wiki/SELECT_within_SELECT_Tutorial</a>（链接中标号2）涉及数据表：world</strong></font></p> 
<p><strong><font color="#EE82EE">题目1：查询在欧洲(Europe)人均gdp大于英国 (United Kingdom)的国家名</font></strong></p> 
<p><code>人均国内生产总值（人均GDP）=国内生产总值（GDP）/人口（populaiton）</code></p> 
<ul><li><strong>运行代码</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> 
	name
<span class="token keyword">from</span> world
<span class="token keyword">where</span> continent<span class="token operator">=</span><span class="token string">'europe'</span>
<span class="token operator">and</span> gdp<span class="token operator">/</span>population <span class="token operator">&gt;</span> <span class="token punctuation">(</span>
                            <span class="token keyword">select</span> 
                            	gdp<span class="token operator">/</span>population
                            <span class="token keyword">from</span> world
                            <span class="token keyword">where</span> name<span class="token operator">=</span><span class="token string">'united kingdom'</span>
<span class="token punctuation">)</span>
</code></pre> 
<ul><li><strong>运行结果</strong><br> <img src="https://images2.imgbox.com/49/0c/GNgJnLd4_o.png" alt="在这里插入图片描述"><br> <br></li></ul> 
<p><font color="#EE82EE"><strong>习题链接2：<a href="https://sqlzoo.net/wiki/SELECT_within_SELECT_Tutorial" rel="nofollow">https://sqlzoo.net/wiki/SELECT_within_SELECT_Tutorial</a>（链接中标号4）涉及数据表：world</strong></font></p> 
<p><strong><font color="#EE82EE">题目2：查询人口数（population）超过加拿大（Canada）但是少于波兰（Poland）的国家，结果显示这些国家名（name）和人口数（population）</font></strong></p> 
<ul><li><strong>运行代码</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">select</span>
	name
	<span class="token punctuation">,</span>population
<span class="token keyword">from</span> world
<span class="token keyword">where</span> population <span class="token operator">&gt;</span> <span class="token punctuation">(</span>
                        <span class="token keyword">select</span> 
                        	population
                        <span class="token keyword">from</span> world
                        <span class="token keyword">where</span> name<span class="token operator">=</span> <span class="token string">'Canada'</span>
<span class="token punctuation">)</span>
<span class="token operator">and</span> population <span class="token operator">&lt;</span> <span class="token punctuation">(</span>
                         <span class="token keyword">select</span> 
                         	population
                         <span class="token keyword">from</span> world
                         <span class="token keyword">where</span> name <span class="token operator">=</span> <span class="token string">'Poland'</span>
<span class="token punctuation">)</span>
</code></pre> 
<ul><li><strong>运行结果</strong><br> <img src="https://images2.imgbox.com/e5/e1/SQkmBv8Y_o.png" alt="在这里插入图片描述"></li></ul> 
<br> 
<p><font color="#EE82EE"><strong>习题链接3：<a href="https://sqlzoo.net/wiki/SELECT_within_SELECT_Tutorial" rel="nofollow">https://sqlzoo.net/wiki/SELECT_within_SELECT_Tutorial</a>（链接中标号9）涉及数据表：world</strong></font></p> 
<p><strong><font color="#EE82EE">题目3：查询所有国家人口均≤25000000的大洲，及其国家名（name）和人口（population）</font></strong></p> 
<ul><li><strong>错误代码</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">select</span>
	name
	<span class="token punctuation">,</span>continent
	<span class="token punctuation">,</span>population
<span class="token keyword">from</span> world
<span class="token keyword">where</span> continent <span class="token operator">in</span> <span class="token punctuation">(</span>
                        <span class="token keyword">select</span> 
                        		<span class="token keyword">distinct</span> continent
                        <span class="token keyword">from</span> world
                        <span class="token keyword">where</span> population <span class="token operator">&lt;=</span><span class="token number">25000000</span>
<span class="token punctuation">)</span>
</code></pre> 
<p><code>如果用正向&lt;=，那么意思是只要有国家小于等于25000000，则该大洲就会被选择出来；不满足题目要求的所有国家均小于等于25000000，所以要反向选择</code></p> 
<ul><li><strong>正确代码</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">select</span>
	name
	<span class="token punctuation">,</span>continent
	<span class="token punctuation">,</span>population
<span class="token keyword">from</span> world
<span class="token keyword">where</span> continent <span class="token operator">not</span> <span class="token operator">in</span> <span class="token punctuation">(</span>
	                        <span class="token keyword">select</span> 
	                        		<span class="token keyword">distinct</span> continent
	                        <span class="token keyword">from</span> world
	                        <span class="token keyword">where</span> population <span class="token operator">&gt;</span><span class="token number">25000000</span>
<span class="token punctuation">)</span>
</code></pre> 
<ul><li><strong>运行结果</strong><br> <img src="https://images2.imgbox.com/69/5b/ZgXq6YhL_o.png" alt="在这里插入图片描述"><br> <br></li></ul> 
<p><font color="#EE82EE"><strong>习题链接4：<a href="https://sqlzoo.net/wiki/SELECT_within_SELECT_Tutorial" rel="nofollow">https://sqlzoo.net/wiki/SELECT_within_SELECT_Tutorial</a>（链接中标号7）涉及数据表：world</strong></font></p> 
<p><strong><font color="#EE82EE">题目4：查找每个大陆（continent）中最大的国家（按区域area），显示该大洲（continent），国家名（name）和面积（area）</font></strong></p> 
<ul><li><strong>运行代码</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">select</span>
	continent
	<span class="token punctuation">,</span>name
	<span class="token punctuation">,</span>area
<span class="token keyword">from</span> world
<span class="token keyword">where</span> <span class="token punctuation">(</span>continent<span class="token punctuation">,</span>area<span class="token punctuation">)</span> <span class="token operator">in</span>  <span class="token punctuation">(</span>
                               <span class="token keyword">select</span>
                               		continent
                               		<span class="token punctuation">,</span><span class="token function">max</span><span class="token punctuation">(</span>area<span class="token punctuation">)</span>
                               <span class="token keyword">from</span> world
                               <span class="token keyword">group</span> <span class="token keyword">by</span> continent
<span class="token punctuation">)</span>
</code></pre> 
<ul><li><strong>运行结果</strong><br> <img src="https://images2.imgbox.com/58/31/i3fMivov_o.png" alt="在这里插入图片描述"></li></ul> 
<br> 
<p><font color="#EE82EE"><strong>习题链接5：<a href="https://sqlzoo.net/wiki/Window_LAG" rel="nofollow">https://sqlzoo.net/wiki/Window_LAG</a>（链接中标号2）涉及数据表：covid</strong></font></p> 
<p><strong><font color="#EE82EE">题目5：查询德国和意大利每天新增治愈人数并从高到低排名，查询结果按国家名，截至日期（输出格式为’xxxx年xx月xx日’），新增治愈人数，按排名排序</font></strong></p> 
<ul><li><strong>运行代码</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">select</span>
	name
	<span class="token punctuation">,</span>日期
	<span class="token punctuation">,</span>每天新增治愈人数
	<span class="token punctuation">,</span>rank<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">over</span><span class="token punctuation">(</span><span class="token keyword">partition</span> <span class="token keyword">by</span> name <span class="token keyword">order</span> <span class="token keyword">by</span> 每天新增治愈人数 <span class="token keyword">desc</span><span class="token punctuation">)</span> 排名
<span class="token keyword">from</span><span class="token punctuation">(</span>
    <span class="token keyword">select</span>
    	name
   	 	<span class="token punctuation">,</span>date_format<span class="token punctuation">(</span>whn<span class="token punctuation">,</span><span class="token string">'%Y年%m月%d日'</span><span class="token punctuation">)</span> 日期
    	<span class="token punctuation">,</span><span class="token punctuation">(</span>recovered <span class="token operator">-</span> lag<span class="token punctuation">(</span>recovered<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token keyword">over</span><span class="token punctuation">(</span><span class="token keyword">partition</span> <span class="token keyword">by</span> name <span class="token keyword">order</span> <span class="token keyword">by</span> whn<span class="token punctuation">)</span><span class="token punctuation">)</span> 每天新增治愈人数
    <span class="token keyword">from</span> covid
    <span class="token keyword">where</span> name <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token string">'France'</span><span class="token punctuation">,</span><span class="token string">'Italy'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> re
<span class="token keyword">order</span> <span class="token keyword">by</span> 排名
</code></pre> 
<ul><li><strong>运行结果</strong><br> <img src="https://images2.imgbox.com/dc/14/c98Jui0c_o.png" alt="在这里插入图片描述"><br> <br></li></ul> 
<h2><a id="_1211"></a>四、如何继续提升</h2> 
<h3><a id="1__1212"></a>1. 在题库里夯实基础</h3> 
<ul><li>牛客网SQL真题：<a href="https://www.nowcoder.com/ta/sql" rel="nofollow">https://www.nowcoder.com/ta/sql</a></li><li><strong>按照顺序把题库里的题全部刷一遍，要做到看到题目就能有思路，还能准确无误地写出代码</strong></li><li>这样基本上能搞定80%以上的实际数据需求和SQL笔试题</li><li>剩下的20%需要更加复杂的业务场景、数据和需求才能继续提升</li><li>不过不用担心，你自学的SQL技能已经可以超过大多数人</li><li>入职后，你的SQL会在实战场景中突飞猛进！<br> <br></li></ul> 
<h3><a id="2__1220"></a>2. 在笔试中不断积累</h3> 
<ul><li>认真对待每一道你遇到的SQL题</li><li><strong>每一道都要搞懂，做出来</strong><br> <br></li></ul> 
<h3><a id="3__1224"></a>3. 在实战中不断提升</h3> 
<ul><li><strong>梳理自己的数据字典</strong></li><li><strong>把同事已有的代码全部学习一遍</strong></li><li>掌握更多复杂的真实场景用法<br> <br></li></ul> 
<hr> 
<h2><a id="_1232"></a>系列文章</h2> 
<p><a href="https://blog.csdn.net/myy12456789/article/details/132542822">SQL自学三部曲_Part1：云端数据库配置&amp;Excel/Tableau连接数据库</a><br> <a href="https://blog.csdn.net/myy12456789/article/details/132335024">SQL自学三部曲_Part2：十大必学语法（一）</a><br> <a href="https://blog.csdn.net/myy12456789/article/details/132742613">SQL自学三部曲_Part2：十大必学语法（二）</a><br> <a href="https://blog.csdn.net/myy12456789/article/details/134297496">SQL自学三部曲_Part3：关于SQL必须要知道的一切</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/dc617844408a47a87a6cfc231393e458/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Flutter关于获取用户相关信息权限</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/cbedf73623d53221a24590c5bbd8b4e5/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">python图像处理基础代码（分辨率、格式、删除指定文件）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>