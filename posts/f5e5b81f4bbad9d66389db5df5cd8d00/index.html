<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Centost7中Redis源码编译与安装 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Centost7中Redis源码编译与安装" />
<meta property="og:description" content="Centost7中Redis源码编译与安装 基本环境：
操作系统：Linux Centos 7
Redis版本：redis-5.0.3.tar.gz，其他版本安装方式可参考此文档
1.下载与安装 查看centos 7 版本的命令
查看系统版本的命令 1. cat /etc/redhat-release [root@localhost ~]# cat /etc/redhat-release CentOS Linux release 7.6.1810 (Core) 2. rpm -q centos-release [root@localhost ~]# rpm -q centos-release centos-release-7-6.1810.2.el7.centos.x86_64 查看内核命令： 1.uname -a [root@localhost ~]# uname -a Linux localhost.localdomain 3.10.0-957.1.3.el7.x86_64 #1 SMP Thu Nov 29 14:49:43 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux 2. cat /proc/version [root@localhost ~]# cat /proc/version Linux version 3.10.0-957.1.3.el7.x86_64 (mockbuild@kbuilder.bsys.centos.org) (gcc version 4.8.5 20150623 (Red Hat 4." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/f5e5b81f4bbad9d66389db5df5cd8d00/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-15T08:57:10+08:00" />
<meta property="article:modified_time" content="2024-01-15T08:57:10+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Centost7中Redis源码编译与安装</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="Centost7Redis_0"></a>Centost7中Redis源码编译与安装</h2> 
<blockquote> 
 <p>基本环境：</p> 
 <p>操作系统：Linux Centos 7</p> 
 <p>Redis版本：redis-5.0.3.tar.gz，其他版本安装方式可参考此文档</p> 
</blockquote> 
<h2><a id="1_8"></a>1.下载与安装</h2> 
<p>查看centos 7 版本的命令</p> 
<pre><code class="prism language-shell">查看系统版本的命令
<span class="token number">1</span>. <span class="token function">cat</span> /etc/redhat-release 
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/redhat-release </span>
CentOS Linux release <span class="token number">7.6</span>.1810 <span class="token punctuation">(</span>Core<span class="token punctuation">)</span> 
<span class="token number">2</span>. <span class="token function">rpm</span> <span class="token parameter variable">-q</span> centos-release
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># rpm -q centos-release</span>
centos-release-7-6.1810.2.el7.centos.x86_64

查看内核命令：
<span class="token number">1</span>.uname <span class="token parameter variable">-a</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># uname -a</span>
Linux localhost.localdomain <span class="token number">3.10</span>.0-957.1.3.el7.x86_64 <span class="token comment">#1 SMP Thu Nov 29 14:49:43 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux</span>
<span class="token number">2</span>. <span class="token function">cat</span> /proc/version
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment">#  cat /proc/version</span>
Linux version <span class="token number">3.10</span>.0-957.1.3.el7.x86_64 <span class="token punctuation">(</span>mockbuild@kbuilder.bsys.centos.org<span class="token punctuation">)</span> 
<span class="token punctuation">(</span>gcc version <span class="token number">4.8</span>.5 <span class="token number">20150623</span> <span class="token punctuation">(</span>Red Hat <span class="token number">4.8</span>.5-36<span class="token punctuation">)</span> <span class="token punctuation">(</span>GCC<span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token comment">#1 SMP Thu Nov 29 14:49:43 UTC 2018</span>
</code></pre> 
<h3><a id="1_31"></a>1.下载</h3> 
<p>官网：https://redis.io/</p> 
<h3><a id="2_35"></a>2.安装</h3> 
<p>本文以redis-5.0.3.tar.gz版本为例</p> 
<ol><li>将下载好的redis-5.0.3.tar.gz文件复制到/opt目录中</li><li>解压：tar -zxvf redis-5.0.3.tar.gz</li><li>在解压后的redis-5.0.3目录下执行make命令，如果gcc未找到，则会出现如下错误</li></ol> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@localhost redis-5.0.3<span class="token punctuation">]</span><span class="token comment"># make</span>
<span class="token builtin class-name">cd</span> src <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> all
make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: 进入目录“/opt/redis-5.0.3/src”
    CC Makefile.dep
make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: 离开目录“/opt/redis-5.0.3/src”
make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: 进入目录“/opt/redis-5.0.3/src”
<span class="token function">rm</span> <span class="token parameter variable">-rf</span> redis-server redis-sentinel redis-cli redis-benchmark redis-check-rdb redis-check-aof *.o *.gcda *.gcno *.gcov red
is.info lcov-html Makefile.dep dict-benchmark
<span class="token punctuation">(</span>cd <span class="token punctuation">..</span>/deps <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> distclean<span class="token punctuation">)</span>
make<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>: 进入目录“/opt/redis-5.0.3/deps”
<span class="token punctuation">(</span>cd hiredis <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> clean<span class="token punctuation">)</span> <span class="token operator">&gt;</span> /dev/null <span class="token operator">||</span> <span class="token boolean">true</span>
<span class="token punctuation">(</span>cd linenoise <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> clean<span class="token punctuation">)</span> <span class="token operator">&gt;</span> /dev/null <span class="token operator">||</span> <span class="token boolean">true</span>
<span class="token punctuation">(</span>cd lua <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> clean<span class="token punctuation">)</span> <span class="token operator">&gt;</span> /dev/null <span class="token operator">||</span> <span class="token boolean">true</span>
<span class="token punctuation">(</span>cd jemalloc <span class="token operator">&amp;&amp;</span> <span class="token punctuation">[</span> <span class="token parameter variable">-f</span> Makefile <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> distclean<span class="token punctuation">)</span> <span class="token operator">&gt;</span> /dev/null <span class="token operator">||</span> <span class="token boolean">true</span>
<span class="token punctuation">(</span>rm <span class="token parameter variable">-f</span> .make-*<span class="token punctuation">)</span>
make<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>: 离开目录“/opt/redis-5.0.3/deps”
<span class="token punctuation">(</span>rm <span class="token parameter variable">-f</span> .make-*<span class="token punctuation">)</span>
<span class="token builtin class-name">echo</span> <span class="token assign-left variable">STD</span><span class="token operator">=</span>-std<span class="token operator">=</span>c99 <span class="token parameter variable">-pedantic</span> <span class="token parameter variable">-DREDIS_STATIC</span><span class="token operator">=</span><span class="token string">''</span> <span class="token operator">&gt;&gt;</span> .make-settings
<span class="token builtin class-name">echo</span> <span class="token assign-left variable">WARN</span><span class="token operator">=</span>-Wall <span class="token parameter variable">-W</span> -Wno-missing-field-initializers <span class="token operator">&gt;&gt;</span> .make-settings
<span class="token builtin class-name">echo</span> <span class="token assign-left variable">OPT</span><span class="token operator">=</span>-O2 <span class="token operator">&gt;&gt;</span> .make-settings
<span class="token builtin class-name">echo</span> <span class="token assign-left variable">MALLOC</span><span class="token operator">=</span>jemalloc <span class="token operator">&gt;&gt;</span> .make-settings
<span class="token builtin class-name">echo</span> <span class="token assign-left variable">CFLAGS</span><span class="token operator">=</span> <span class="token operator">&gt;&gt;</span> .make-settings
<span class="token builtin class-name">echo</span> <span class="token assign-left variable">LDFLAGS</span><span class="token operator">=</span> <span class="token operator">&gt;&gt;</span> .make-settings
<span class="token builtin class-name">echo</span> <span class="token assign-left variable">REDIS_CFLAGS</span><span class="token operator">=</span> <span class="token operator">&gt;&gt;</span> .make-settings
<span class="token builtin class-name">echo</span> <span class="token assign-left variable">REDIS_LDFLAGS</span><span class="token operator">=</span> <span class="token operator">&gt;&gt;</span> .make-settings
<span class="token builtin class-name">echo</span> <span class="token assign-left variable">PREV_FINAL_CFLAGS</span><span class="token operator">=</span>-std<span class="token operator">=</span>c99 <span class="token parameter variable">-pedantic</span> <span class="token parameter variable">-DREDIS_STATIC</span><span class="token operator">=</span><span class="token string">''</span> <span class="token parameter variable">-Wall</span> <span class="token parameter variable">-W</span> -Wno-missing-field-initializers <span class="token parameter variable">-O2</span> <span class="token parameter variable">-g</span> <span class="token parameter variable">-ggdb</span>   -I<span class="token punctuation">..</span>/
deps/hiredis -I<span class="token punctuation">..</span>/deps/linenoise -I<span class="token punctuation">..</span>/deps/lua/src <span class="token parameter variable">-DUSE_JEMALLOC</span> -I<span class="token punctuation">..</span>/deps/jemalloc/include <span class="token operator">&gt;&gt;</span> .make-settings
<span class="token builtin class-name">echo</span> <span class="token assign-left variable">PREV_FINAL_LDFLAGS</span><span class="token operator">=</span>  <span class="token parameter variable">-g</span> <span class="token parameter variable">-ggdb</span> <span class="token parameter variable">-rdynamic</span> <span class="token operator">&gt;&gt;</span> .make-settings
<span class="token punctuation">(</span>cd <span class="token punctuation">..</span>/deps <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> hiredis linenoise lua jemalloc<span class="token punctuation">)</span>
make<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>: 进入目录“/opt/redis-5.0.3/deps”
<span class="token punctuation">(</span>cd hiredis <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> clean<span class="token punctuation">)</span> <span class="token operator">&gt;</span> /dev/null <span class="token operator">||</span> <span class="token boolean">true</span>
<span class="token punctuation">(</span>cd linenoise <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> clean<span class="token punctuation">)</span> <span class="token operator">&gt;</span> /dev/null <span class="token operator">||</span> <span class="token boolean">true</span>
<span class="token punctuation">(</span>cd lua <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> clean<span class="token punctuation">)</span> <span class="token operator">&gt;</span> /dev/null <span class="token operator">||</span> <span class="token boolean">true</span>
<span class="token punctuation">(</span>cd jemalloc <span class="token operator">&amp;&amp;</span> <span class="token punctuation">[</span> <span class="token parameter variable">-f</span> Makefile <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> distclean<span class="token punctuation">)</span> <span class="token operator">&gt;</span> /dev/null <span class="token operator">||</span> <span class="token boolean">true</span>
<span class="token punctuation">(</span>rm <span class="token parameter variable">-f</span> .make-*<span class="token punctuation">)</span>
<span class="token punctuation">(</span>echo <span class="token string">""</span> <span class="token operator">&gt;</span> .make-cflags<span class="token punctuation">)</span>
<span class="token punctuation">(</span>echo <span class="token string">""</span> <span class="token operator">&gt;</span> .make-ldflags<span class="token punctuation">)</span>
MAKE hiredis
<span class="token builtin class-name">cd</span> hiredis <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> static
make<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>: 进入目录“/opt/redis-5.0.3/deps/hiredis”
gcc <span class="token parameter variable">-std</span><span class="token operator">=</span>c99 <span class="token parameter variable">-pedantic</span> <span class="token parameter variable">-c</span> <span class="token parameter variable">-O3</span> <span class="token parameter variable">-fPIC</span>  <span class="token parameter variable">-Wall</span> <span class="token parameter variable">-W</span> -Wstrict-prototypes -Wwrite-strings <span class="token parameter variable">-g</span> <span class="token parameter variable">-ggdb</span>  net.c
make<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>: gcc：命令未找到
make<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>: *** <span class="token punctuation">[</span>net.o<span class="token punctuation">]</span> 错误 <span class="token number">127</span>
make<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>: 离开目录“/opt/redis-5.0.3/deps/hiredis”
make<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>: *** <span class="token punctuation">[</span>hiredis<span class="token punctuation">]</span> 错误 <span class="token number">2</span>
make<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>: 离开目录“/opt/redis-5.0.3/deps”
make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: <span class="token punctuation">[</span>persist-settings<span class="token punctuation">]</span> 错误 <span class="token number">2</span> <span class="token punctuation">(</span>忽略<span class="token punctuation">)</span>
    CC adlist.o
/bin/sh: cc: 未找到命令
make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: *** <span class="token punctuation">[</span>adlist.o<span class="token punctuation">]</span> 错误 <span class="token number">127</span>
make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: 离开目录“/opt/redis-5.0.3/src”
make: *** <span class="token punctuation">[</span>all<span class="token punctuation">]</span> 错误 <span class="token number">2</span>
<span class="token punctuation">[</span>root@localhost redis-5.0.3<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre> 
<h3><a id="3_gcc_99"></a>3 .解决gcc未找到的问题</h3> 
<p>gcc是Linux下的一个编译程序，是C程序的编译工具</p> 
<p>解决方法：</p> 
<h4><a id="1_105"></a>1.能连网直接使用命令安装(本文的安装方式)：</h4> 
<ol><li>使用yum install gcc-c++ 命令进行安装</li></ol> 
<pre><code class="prism language-shell">---<span class="token operator">&gt;</span> 软件包 kernel-headers.x86_64.0.3.10.0-957.1.3.el7 将被 安装
--<span class="token operator">&gt;</span> 解决依赖关系完成

依赖关系解决

<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
 Package                         架构                   版本                               源                       大小
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
正在安装:
 gcc-c++                         x86_64                 <span class="token number">4.8</span>.5-36.el7                       base                    <span class="token number">7.2</span> M
为依赖而安装:
 cpp                             x86_64                 <span class="token number">4.8</span>.5-36.el7                       base                    <span class="token number">5.9</span> M
 gcc                             x86_64                 <span class="token number">4.8</span>.5-36.el7                       base                     <span class="token number">16</span> M
 glibc-devel                     x86_64                 <span class="token number">2.17</span>-260.el7                       base                    <span class="token number">1.1</span> M
 glibc-headers                   x86_64                 <span class="token number">2.17</span>-260.el7                       base                    <span class="token number">683</span> k
 kernel-headers                  x86_64                 <span class="token number">3.10</span>.0-957.1.3.el7                 updates                 <span class="token number">8.0</span> M
 libmpc                          x86_64                 <span class="token number">1.0</span>.1-3.el7                        base                     <span class="token number">51</span> k
 libstdc++-devel                 x86_64                 <span class="token number">4.8</span>.5-36.el7                       base                    <span class="token number">1.5</span> M
 mpfr                            x86_64                 <span class="token number">3.1</span>.1-4.el7                        base                    <span class="token number">203</span> k

事务概要
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
安装  <span class="token number">1</span> 软件包 <span class="token punctuation">(</span>+8 依赖软件包<span class="token punctuation">)</span>

总下载量：41 M
安装大小：84 M
Is this ok <span class="token punctuation">[</span>y/d/N<span class="token punctuation">]</span>: y

如果出现下面内容则说明安装成功：
已安装:
  gcc-c++.x86_64 <span class="token number">0</span>:4.8.5-36.el7                                                                                         
作为依赖被安装:
  cpp.x86_64 <span class="token number">0</span>:4.8.5-36.el7              gcc.x86_64 <span class="token number">0</span>:4.8.5-36.el7                   glibc-devel.x86_64 <span class="token number">0</span>:2.17-260.el7 
  glibc-headers.x86_64 <span class="token number">0</span>:2.17-260.el7    kernel-headers.x86_64 <span class="token number">0</span>:3.10.0-957.1.3.el7  libmpc.x86_64 <span class="token number">0</span>:1.0.1-3.el7       
  libstdc++-devel.x86_64 <span class="token number">0</span>:4.8.5-36.el7  mpfr.x86_64 <span class="token number">0</span>:3.1.1-4.el7       

安装后使用下面命令查看版本
gcc <span class="token parameter variable">-v</span>

</code></pre> 
<ol start="2"><li> <p>gcc安装后,再使用make命令安装，如果出现了下面错误,需要使用make distclean 命令清理下：</p> <p>zmalloc.h:50:31: 致命错误：jemalloc/jemalloc.h：没有那个文件或目录</p> </li></ol> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@localhost redis-5.0.3<span class="token punctuation">]</span><span class="token comment"># make</span>
<span class="token builtin class-name">cd</span> src <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> all
make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: 进入目录“/opt/redis-5.0.3/src”
    CC Makefile.dep
make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: 离开目录“/opt/redis-5.0.3/src”
make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: 进入目录“/opt/redis-5.0.3/src”
    CC adlist.o
In <span class="token function">file</span> included from adlist.c:34:0:
zmalloc.h:50:31: 致命错误：jemalloc/jemalloc.h：没有那个文件或目录
 <span class="token comment">#include &lt;jemalloc/jemalloc.h&gt;</span>
                               ^
编译中断。
make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: *** <span class="token punctuation">[</span>adlist.o<span class="token punctuation">]</span> 错误 <span class="token number">1</span>
make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: 离开目录“/opt/redis-5.0.3/src”
make: *** <span class="token punctuation">[</span>all<span class="token punctuation">]</span> 错误 <span class="token number">2</span>
<span class="token punctuation">[</span>root@localhost redis-5.0.3<span class="token punctuation">]</span><span class="token comment"># </span>

解决方法：使用make distclean 清理后再make
</code></pre> 
<ol start="3"><li>解决方法：使用make distclean 清理后再make</li><li>在使用make安装，安装成功后，则会显示下面信息：</li></ol> 
<pre><code class="prism language-shell">
Hint: It<span class="token string">'s a good idea to run '</span><span class="token function">make</span> test' <span class="token punctuation">;</span><span class="token punctuation">)</span>

make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: 离开目录“/opt/redis-5.0.3/src”
<span class="token punctuation">[</span>root@localhost redis-5.0.3<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre> 
<ol start="5"><li>make test可以不执行，如果执行make test ,有可能出现tcl未安装的情况，如下</li></ol> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@localhost redis-5.0.3<span class="token punctuation">]</span><span class="token comment"># make test</span>
<span class="token builtin class-name">cd</span> src <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> <span class="token builtin class-name">test</span>
make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: 进入目录“/opt/redis-5.0.3/src”
    CC Makefile.dep
make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: 离开目录“/opt/redis-5.0.3/src”
make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: 进入目录“/opt/redis-5.0.3/src”
You need tcl <span class="token number">8.5</span> or newer <span class="token keyword">in</span> order to run the Redis <span class="token builtin class-name">test</span>
make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: *** <span class="token punctuation">[</span>test<span class="token punctuation">]</span> 错误 <span class="token number">1</span>
make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: 离开目录“/opt/redis-5.0.3/src”
make: *** <span class="token punctuation">[</span>test<span class="token punctuation">]</span> 错误 <span class="token number">2</span>
<span class="token punctuation">[</span>root@localhost redis-5.0.3<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre> 
<ol start="6"><li> <p>安装TCL</p> <p>TCL官网：http://www.linuxfromscratch.org/blfs/view/cvs/general/tcl.html</p> <p>tcl 安装步骤：</p> </li></ol> 
<pre><code class="prism language-shell">--安装wget命令:yum <span class="token parameter variable">-y</span> <span class="token function">install</span> <span class="token function">wget</span>
--能连网就使用wget命令安装tcl
<span class="token function">wget</span> https://downloads.sourceforge.net/tcl/tcl8.6.9-src.tar.gz
<span class="token comment"># 2021-10-12 wget https://downloads.sourceforge.net/tcl/tcl8.6.11-src.tar.gz</span>
<span class="token number">1</span>.然后使用解压命令将tcl8.6.9-src.tar.gz解压到/usr/local/目录下：
<span class="token function">tar</span> <span class="token parameter variable">-zxvf</span> tcl8.6.9-src.tar.gz <span class="token parameter variable">-C</span> /usr/local/ 
<span class="token number">2</span>. 执行命令：
<span class="token punctuation">[</span>root@localhost<span class="token punctuation">]</span><span class="token comment"># cd /usr/local/tcl8.6.9/unix/</span>
<span class="token number">3</span>. 执行命令
<span class="token punctuation">[</span>root@localhost unix<span class="token punctuation">]</span><span class="token comment"># ./configure</span>
<span class="token number">4</span>.执行命令：
<span class="token punctuation">[</span>root@localhost unix<span class="token punctuation">]</span><span class="token comment"># make</span>
<span class="token number">5</span>.执行命令：
<span class="token punctuation">[</span>root@localhost unix<span class="token punctuation">]</span><span class="token comment"># make install</span>

<span class="token number">5</span>.切换至目录下执行make <span class="token builtin class-name">test</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># cd /opt/redis-5.0.3</span>
<span class="token punctuation">[</span>root@localhost redis-5.0.3<span class="token punctuation">]</span><span class="token comment"># make test</span>

如果test通过后会在最后输出 <span class="token string">"所有测试都通过了，没有错误！"</span>的信息,如下：
<span class="token punctuation">\</span>o/ All tests passed without errors<span class="token operator">!</span>
</code></pre> 
<ol start="7"><li>使用make install 命令完成最终的安装</li></ol> 
<pre><code class="prism language-shell">切换至 redis-5.0.3目录下，输入 <span class="token function">make</span> instll 命令完成最终的安装，如下
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># cd /opt/redis-5.0.3</span>
<span class="token punctuation">[</span>root@localhost redis-5.0.3<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@localhost redis-5.0.3<span class="token punctuation">]</span><span class="token comment"># make install</span>

输出如下信息表示安装成功：
<span class="token punctuation">[</span>root@localhost redis-5.0.3<span class="token punctuation">]</span><span class="token comment"># make install</span>
<span class="token builtin class-name">cd</span> src <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> <span class="token function">install</span>
make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: 进入目录“/opt/redis-5.0.3/src”

Hint: It<span class="token string">'s a good idea to run '</span><span class="token function">make</span> test' <span class="token punctuation">;</span><span class="token punctuation">)</span>

    INSTALL <span class="token function">install</span>
    INSTALL <span class="token function">install</span>
    INSTALL <span class="token function">install</span>
    INSTALL <span class="token function">install</span>
    INSTALL <span class="token function">install</span>
make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: 离开目录“/opt/redis-5.0.3/src”
<span class="token punctuation">[</span>root@localhost redis-5.0.3<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre> 
<h4><a id="2_257"></a>2.不能连网：从安装镜像中找到对应的包进行安装</h4> 
<p>（安装过程忽略）</p> 
<pre><code class="prism language-shell">从安装Linux的安装镜像文件中找到对应的rpm文件<span class="token punctuation">(</span>上网查对应文件），然后使用下面命令进行安装
<span class="token function">rpm</span> <span class="token parameter variable">-ivh</span> xxxx.rpm 回车
</code></pre> 
<h2><a id="2redisconfhello_world_266"></a>2.redis.conf及hello world</h2> 
<p>Redis安装完成后在 /usr/local/bin/目录下可查看</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@MiWiFi-R1CL-srv<span class="token punctuation">]</span><span class="token comment"># cd /usr/local/bin/</span>
<span class="token punctuation">[</span>root@MiWiFi-R1CL-srv bin<span class="token punctuation">]</span><span class="token comment"># ls -l</span>
总用量 <span class="token number">32716</span>
-rwxr-xr-x. <span class="token number">1</span> root root <span class="token number">4366576</span> <span class="token number">1</span>月   <span class="token number">3</span> <span class="token number">21</span>:06 redis-benchmark
-rwxr-xr-x. <span class="token number">1</span> root root <span class="token number">8090008</span> <span class="token number">1</span>月   <span class="token number">3</span> <span class="token number">21</span>:06 redis-check-aof
-rwxr-xr-x. <span class="token number">1</span> root root <span class="token number">8090008</span> <span class="token number">1</span>月   <span class="token number">3</span> <span class="token number">21</span>:06 redis-check-rdb
-rwxr-xr-x. <span class="token number">1</span> root root <span class="token number">4801824</span> <span class="token number">1</span>月   <span class="token number">3</span> <span class="token number">21</span>:06 redis-cli
lrwxrwxrwx. <span class="token number">1</span> root root      <span class="token number">12</span> <span class="token number">1</span>月   <span class="token number">3</span> <span class="token number">21</span>:06 redis-sentinel -<span class="token operator">&gt;</span> redis-server
-rwxr-xr-x. <span class="token number">1</span> root root <span class="token number">8090008</span> <span class="token number">1</span>月   <span class="token number">3</span> <span class="token number">21</span>:06 redis-server
-rwxr-xr-x. <span class="token number">1</span> root root   <span class="token number">30291</span> <span class="token number">1</span>月   <span class="token number">3</span> <span class="token number">20</span>:59 sqlite3_analyzer
-rwxr-xr-x. <span class="token number">1</span> root root    <span class="token number">8664</span> <span class="token number">1</span>月   <span class="token number">3</span> <span class="token number">20</span>:59 tclsh8.6

</code></pre> 
<h3><a id="1redisconf_285"></a>1.redis.conf文件</h3> 
<ol><li>安装完成后，先将redis-5.0.3目录下的redis.conf文件拷贝到其他地放进行修改</li></ol> 
<pre><code class="prism language-shell"><span class="token number">1</span>.在根目录下新建myredis目录：
<span class="token function">mkdir</span> myredis
<span class="token number">2</span>.redis.conf文件拷贝：
<span class="token function">cp</span> /opt/redis-5.0.3/redis.conf /myredis/
</code></pre> 
<ol start="2"><li>/myredis/redis.conf文件修改</li></ol> 
<pre><code class="prism language-shell"><span class="token function">vim</span> /myredis/redis.conf 打开文件，然后找到daemonize no，【shift+$ 移动到行末】
<span class="token number">1</span>.将daemonize no 修改为 daemonize <span class="token function">yes</span>
</code></pre> 
<h3><a id="2redis_303"></a>2.启动redis</h3> 
<pre><code class="prism language-shell"><span class="token number">1</span>.进入bin目录下
<span class="token punctuation">[</span>root@MiWiFi-R1CL-srv ~<span class="token punctuation">]</span><span class="token comment"># cd /usr/local/bin/</span>
<span class="token punctuation">[</span>root@MiWiFi-R1CL-srv bin<span class="token punctuation">]</span><span class="token comment"># ls -l</span>
总用量 <span class="token number">32716</span>
-rwxr-xr-x. <span class="token number">1</span> root root <span class="token number">4366576</span> <span class="token number">1</span>月   <span class="token number">3</span> <span class="token number">21</span>:06 redis-benchmark
-rwxr-xr-x. <span class="token number">1</span> root root <span class="token number">8090008</span> <span class="token number">1</span>月   <span class="token number">3</span> <span class="token number">21</span>:06 redis-check-aof
-rwxr-xr-x. <span class="token number">1</span> root root <span class="token number">8090008</span> <span class="token number">1</span>月   <span class="token number">3</span> <span class="token number">21</span>:06 redis-check-rdb
-rwxr-xr-x. <span class="token number">1</span> root root <span class="token number">4801824</span> <span class="token number">1</span>月   <span class="token number">3</span> <span class="token number">21</span>:06 redis-cli
lrwxrwxrwx. <span class="token number">1</span> root root      <span class="token number">12</span> <span class="token number">1</span>月   <span class="token number">3</span> <span class="token number">21</span>:06 redis-sentinel -<span class="token operator">&gt;</span> redis-server
-rwxr-xr-x. <span class="token number">1</span> root root <span class="token number">8090008</span> <span class="token number">1</span>月   <span class="token number">3</span> <span class="token number">21</span>:06 redis-server
-rwxr-xr-x. <span class="token number">1</span> root root   <span class="token number">30291</span> <span class="token number">1</span>月   <span class="token number">3</span> <span class="token number">20</span>:59 sqlite3_analyzer
-rwxr-xr-x. <span class="token number">1</span> root root    <span class="token number">8664</span> <span class="token number">1</span>月   <span class="token number">3</span> <span class="token number">20</span>:59 tclsh8.6
<span class="token punctuation">[</span>root@MiWiFi-R1CL-srv bin<span class="token punctuation">]</span>

<span class="token number">2</span>.用命令查看后台redis服务有么有启动
<span class="token punctuation">[</span>root@MiWiFi-R1CL-srv bin<span class="token punctuation">]</span><span class="token comment"># ps -ef|grep redis</span>
root     <span class="token number">27171</span> <span class="token number">27146</span>  <span class="token number">0</span> <span class="token number">21</span>:45 pts/0    00:00:00 <span class="token function">grep</span> <span class="token parameter variable">--color</span><span class="token operator">=</span>auto redis

<span class="token number">3</span>.启动redis服务，这里不启动出厂默认redis.conf,而是启动我们自己配置的 /myredis/redis.conf
<span class="token punctuation">[</span>root@MiWiFi-R1CL-srv bin<span class="token punctuation">]</span><span class="token comment"># redis-server /myredis/redis.conf </span>
<span class="token number">27172</span>:C 03 Jan <span class="token number">2019</span> <span class="token number">21</span>:47:34.945 <span class="token comment"># oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span>
<span class="token number">27172</span>:C 03 Jan <span class="token number">2019</span> <span class="token number">21</span>:47:34.945 <span class="token comment"># Redis version=5.0.3, bits=64, commit=00000000, modified=0, pid=27172, just started</span>
<span class="token number">27172</span>:C 03 Jan <span class="token number">2019</span> <span class="token number">21</span>:47:34.945 <span class="token comment"># Configuration loaded</span>

<span class="token number">4</span>.启动redis客户端
<span class="token punctuation">[</span>root@MiWiFi-R1CL-srv bin<span class="token punctuation">]</span><span class="token comment"># redis-cli -p 6379</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> 
输入ping命令验证
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token function">ping</span>
PONG
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> 

<span class="token number">5</span>.输出hello world
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">set</span> k1 <span class="token string">"hell world"</span>
OK
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get k1
<span class="token string">"hell world"</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> 

<span class="token number">6</span>.再次查看redis后台进程有么有启动
<span class="token punctuation">[</span>root@MiWiFi-R1CL-srv ~<span class="token punctuation">]</span><span class="token comment"># ps -ef|grep redis</span>
root     <span class="token number">27173</span>     <span class="token number">1</span>  <span class="token number">0</span> <span class="token number">21</span>:47 ?        00:00:00 redis-server <span class="token number">127.0</span>.0.1:6379
root     <span class="token number">27179</span> <span class="token number">27146</span>  <span class="token number">0</span> <span class="token number">21</span>:49 pts/0    00:00:00 redis-cli <span class="token parameter variable">-p</span> <span class="token number">6379</span>
root     <span class="token number">27199</span> <span class="token number">27181</span>  <span class="token number">0</span> <span class="token number">21</span>:52 pts/1    00:00:00 <span class="token function">grep</span> <span class="token parameter variable">--color</span><span class="token operator">=</span>auto redis
</code></pre> 
<h3><a id="3redis_352"></a>3.关闭redis服务</h3> 
<pre><code class="prism language-shell">命令：SHUTDOWN <span class="token punctuation">[</span>NOSAVE<span class="token operator">|</span>SAVE<span class="token punctuation">]</span>

<span class="token number">1</span>.关闭redis服务并退出
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> SHUTDOWN
not connected<span class="token operator">&gt;</span> <span class="token builtin class-name">exit</span>

<span class="token number">2</span>.关闭后查看后台redis服务有没有
<span class="token punctuation">[</span>root@MiWiFi-R1CL-srv bin<span class="token punctuation">]</span><span class="token comment"># ps -ef|grep redis</span>
root     <span class="token number">27203</span> <span class="token number">27146</span>  <span class="token number">0</span> <span class="token number">22</span>:00 pts/0    00:00:00 <span class="token function">grep</span> <span class="token parameter variable">--color</span><span class="token operator">=</span>auto redis
<span class="token punctuation">[</span>root@MiWiFi-R1CL-srv bin<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre> 
<h2><a id="3Redis_367"></a>3.Redis启动后简单操作</h2> 
<h3><a id="1_redisbenchmark__369"></a>1. redis-benchmark [性能测试]</h3> 
<pre><code class="prism language-shell"><span class="token number">1</span>.进入bin目录
<span class="token punctuation">[</span>root@MiWiFi-R1CL-srv bin<span class="token punctuation">]</span><span class="token comment"># ls -l /usr/local/bin </span>
总用量 <span class="token number">32720</span>
-rw-r--r--. <span class="token number">1</span> root root     <span class="token number">112</span> <span class="token number">1</span>月   <span class="token number">3</span> <span class="token number">21</span>:58 dump.rdb
-rwxr-xr-x. <span class="token number">1</span> root root <span class="token number">4366576</span> <span class="token number">1</span>月   <span class="token number">3</span> <span class="token number">21</span>:06 redis-benchmark
-rwxr-xr-x. <span class="token number">1</span> root root <span class="token number">8090008</span> <span class="token number">1</span>月   <span class="token number">3</span> <span class="token number">21</span>:06 redis-check-aof
-rwxr-xr-x. <span class="token number">1</span> root root <span class="token number">8090008</span> <span class="token number">1</span>月   <span class="token number">3</span> <span class="token number">21</span>:06 redis-check-rdb
-rwxr-xr-x. <span class="token number">1</span> root root <span class="token number">4801824</span> <span class="token number">1</span>月   <span class="token number">3</span> <span class="token number">21</span>:06 redis-cli
lrwxrwxrwx. <span class="token number">1</span> root root      <span class="token number">12</span> <span class="token number">1</span>月   <span class="token number">3</span> <span class="token number">21</span>:06 redis-sentinel -<span class="token operator">&gt;</span> redis-server
-rwxr-xr-x. <span class="token number">1</span> root root <span class="token number">8090008</span> <span class="token number">1</span>月   <span class="token number">3</span> <span class="token number">21</span>:06 redis-server
-rwxr-xr-x. <span class="token number">1</span> root root   <span class="token number">30291</span> <span class="token number">1</span>月   <span class="token number">3</span> <span class="token number">20</span>:59 sqlite3_analyzer
-rwxr-xr-x. <span class="token number">1</span> root root    <span class="token number">8664</span> <span class="token number">1</span>月   <span class="token number">3</span> <span class="token number">20</span>:59 tclsh8.6
<span class="token punctuation">[</span>root@MiWiFi-R1CL-srv bin<span class="token punctuation">]</span><span class="token comment">#  redis-benchmark </span>
</code></pre> 
<ol><li>单进程：单进程模型来处理客户端的请求。对读写等事件的响应是通过epoll函数的包装来做到的。Redis的实际处理速度完全依靠主进程的执行效率【Epoll是Linux内核为处理大批量文件描述符而作了改进的epoll,是Linux下多路复用IO接口select/poll的增强版本，它能显著提高程序在大量并发连接中只有少量活跃的情况下的系统CPU利用率。】</li><li>出厂默认16个数据库:库的顺序类似数组下标从零开始，初始默认使用零号库</li><li>select命令切换数据库：select index，index为库的下标，index=库总数-1</li><li>DBSIZE - :查看当前数据库下key的数量</li><li>keys pattern: 如 keys * 查看当前库下所有的key，keys k? 查看以k开头的所有key</li><li>FLUSHDB [ASYNC] :清空当期库</li><li>FLUSHALL [ASYNC]:通杀所有库</li><li>统一密码管理：16个库都使用同一个密码，要么都OK，要么一个也连不上</li><li>默认端口：6379</li><li>Redis索引都是从0开始</li></ol> 
<h3><a id="2Key_398"></a>2.Key(键)</h3> 
<pre><code class="prism language-shell"><span class="token number">1</span>.keys pattern  查看当期库所有的key
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> keys *
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"k1"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"k2"</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"k3"</span>

<span class="token number">2</span>.set key value <span class="token punctuation">[</span>expiration EX seconds<span class="token operator">|</span>PX milliseconds<span class="token punctuation">]</span> <span class="token punctuation">[</span>NX<span class="token operator">|</span>XX<span class="token punctuation">]</span>：设置key及key的值
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">set</span> k1 <span class="token string">"Hello World!"</span>
OK

<span class="token number">3</span>.get key :根据key获取值
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get k1
<span class="token string">"Hello World!"</span>

<span class="token number">4</span>.EXISTS key <span class="token punctuation">[</span>key <span class="token punctuation">..</span>.<span class="token punctuation">]</span>  判断某个key或某些key是否存在，存在则返回存在key的个数，不存在则返回 <span class="token number">0</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> exists k1 k2
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">2</span>

<span class="token number">5</span>. move key db  将某个key从当前库移动到其他库中，移动后当前库中就不存在了，成功返回1，失败返回0
【注：如果其他库已经存在当前key则会移动失败，直接返回0】
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> move k3 <span class="token number">1</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>

<span class="token number">6</span>.EXPIRE key seconds 设置key的过期时间,key过期后就不存在了，单位:秒
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> EXPIRE k3 <span class="token number">10</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span>

<span class="token number">7</span>. TTL key 查看key还有多少秒过期，返回-1：表示永不过期；返回-2：表示已经过期
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> TTL k1
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token parameter variable">-1</span>

<span class="token number">8</span>. TYPE key  查看key的数据类型
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">type</span> k1
string

<span class="token number">9</span>. DEL key <span class="token punctuation">[</span>key <span class="token punctuation">..</span>.<span class="token punctuation">]</span> 删除key或多个key
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> DEL k2
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>


</code></pre> 
<h3><a id="3String_443"></a>3.字符串(String)</h3> 
<p>1.单值单value</p> 
<pre><code class="prism language-shell"><span class="token number">1</span>.set/get/append/strlen<span class="token punctuation">..</span><span class="token punctuation">..</span>.

<span class="token number">2</span>.incr/incrby/decr/decrby 一定操作的是数字才能进行加与减
INCRBY key  每次+1
INCRBY key increment 每次+increment
DECRBY key 每次-1
DECRBY key decrement  每次-decrement

<span class="token number">3</span>.GETRANGE key start end/SETRANGE key offset value
GETRANGE: 获取指定区间范围的值，类似于java中的substring
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> GETRANGE k1 <span class="token number">0</span> <span class="token parameter variable">-1</span>   <span class="token number">0</span>到-1表示全部
<span class="token string">"hello world"</span>

SETRANGE: 设置指定区间范围的值，设值key的值，从offset 开始设置其值为value，类似java中的replace 
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> SETRANGE k1 <span class="token number">2</span> XXX
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">11</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get k1
<span class="token string">"heXXX world"</span>

<span class="token number">4</span>. SETEX key seconds value 设置key的值为value存活seconds秒后过期消失

<span class="token number">5</span>. SETNX key value  判断key是否存在，如果存在则忽略，否则设置key的值为value
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> setnx k1 <span class="token string">'aaa'</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> 

<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> setnx k5 <span class="token string">'aaa'</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> 

<span class="token number">6</span>. MSET key value <span class="token punctuation">[</span>key value <span class="token punctuation">..</span>.<span class="token punctuation">]</span>/MGET key <span class="token punctuation">[</span>key <span class="token punctuation">..</span>.<span class="token punctuation">]</span> 设置/获取多个键值对
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> mset k1 aaa k2 bbb k3 ccc
OK

<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> mget k1 k2 k3
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"aaa"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"bbb"</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"ccc"</span>

<span class="token number">7</span>. MSETNX key value <span class="token punctuation">[</span>key value <span class="token punctuation">..</span>.<span class="token punctuation">]</span>  设置多个键值对，如果其中一个key已经存在则本次操作全部忽略
 --k1已经存在,则忽略本次操作，即k1不会改变，k5为nil
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> msetnx k1 xxx k5 yyy 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span>
 --查看k1 k5
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> mget k1 k5 
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"aaa"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>nil<span class="token punctuation">)</span>
 --查看k1 到 k5 的值
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> mget k1 k2 k3 k4 k5
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"aaa"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"bbb"</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"ccc"</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>nil<span class="token punctuation">)</span>
<span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>nil<span class="token punctuation">)</span>
 <span class="token parameter variable">--msetnx</span> 设置 k4 k5的值
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> msetnx k4 xxx k5 yyy
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
 --设置完 k4 k5后查看k1 到 k5 的值
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> mget k1 k2 k3 k4 k5
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"aaa"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"bbb"</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"ccc"</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"xxx"</span>
<span class="token number">5</span><span class="token punctuation">)</span> <span class="token string">"yyy"</span>

<span class="token number">8</span>. GETSET key value  先get在set
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> getset k6 ttt
<span class="token punctuation">(</span>nil<span class="token punctuation">)</span>

</code></pre> 
<h3><a id="3_519"></a>3.其他操作</h3> 
<blockquote> 
 <p>详见官方文档：https://redis.io/docs</p> 
 <p>数据类型文档：https://redis.io/docs/data-types</p> 
</blockquote> 
<h2><a id="5_JavaJedisRedis_525"></a>5. Java使用Jedis连接Redis服务器</h2> 
<h3><a id="1_527"></a>1.配置项</h3> 
<ol><li>需关闭Linux防火墙</li></ol> 
<pre><code class="prism language-shell">--1.查看防火墙状态
<span class="token punctuation">[</span>root@MiWiFi-R1CL-srv ~<span class="token punctuation">]</span><span class="token comment"># firewall-cmd --state</span>
running
--2.关闭防火墙
<span class="token punctuation">[</span>root@MiWiFi-R1CL-srv bin<span class="token punctuation">]</span><span class="token comment"># systemctl stop firewalld.service</span>
</code></pre> 
<p>不关防火墙连接是错误如下</p> 
<pre><code class="prism language-java"><span class="token class-name">Exception</span> in thread <span class="token string">"main"</span> <span class="token class-name"><span class="token namespace">redis<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>jedis<span class="token punctuation">.</span>exceptions<span class="token punctuation">.</span></span>JedisConnectionException</span><span class="token operator">:</span> <span class="token class-name">Failed</span> connecting <span class="token keyword">to</span> <span class="token namespace">host</span> <span class="token number">192.31</span><span class="token number">.1</span><span class="token number">.122</span><span class="token operator">:</span><span class="token number">6379</span>
	at <span class="token class-name"><span class="token namespace">redis<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>jedis<span class="token punctuation">.</span></span>Connection</span><span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token class-name">Connection</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">204</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">redis<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>jedis<span class="token punctuation">.</span></span>BinaryClient</span><span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token class-name">BinaryClient</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">100</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">redis<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>jedis<span class="token punctuation">.</span></span>Connection</span><span class="token punctuation">.</span><span class="token function">sendCommand</span><span class="token punctuation">(</span><span class="token class-name">Connection</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">125</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">redis<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>jedis<span class="token punctuation">.</span></span>Connection</span><span class="token punctuation">.</span><span class="token function">sendCommand</span><span class="token punctuation">(</span><span class="token class-name">Connection</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">120</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">redis<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>jedis<span class="token punctuation">.</span></span>BinaryClient</span><span class="token punctuation">.</span><span class="token function">ping</span><span class="token punctuation">(</span><span class="token class-name">BinaryClient</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">113</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">redis<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>jedis<span class="token punctuation">.</span></span>BinaryJedis</span><span class="token punctuation">.</span><span class="token function">ping</span><span class="token punctuation">(</span><span class="token class-name">BinaryJedis</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">186</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>yuan<span class="token punctuation">.</span></span>RedisClient</span><span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">RedisClient</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">16</span><span class="token punctuation">)</span>
<span class="token class-name">Caused</span> by<span class="token operator">:</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span>SocketTimeoutException</span><span class="token operator">:</span> connect timed out
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span>DualStackPlainSocketImpl</span><span class="token punctuation">.</span><span class="token function">waitForConnect</span><span class="token punctuation">(</span><span class="token class-name">Native</span> <span class="token class-name">Method</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span>DualStackPlainSocketImpl</span><span class="token punctuation">.</span><span class="token function">socketConnect</span><span class="token punctuation">(</span><span class="token class-name">DualStackPlainSocketImpl</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">85</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span>AbstractPlainSocketImpl</span><span class="token punctuation">.</span><span class="token function">doConnect</span><span class="token punctuation">(</span><span class="token class-name">AbstractPlainSocketImpl</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">350</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span>AbstractPlainSocketImpl</span><span class="token punctuation">.</span><span class="token function">connectToAddress</span><span class="token punctuation">(</span><span class="token class-name">AbstractPlainSocketImpl</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">206</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span>AbstractPlainSocketImpl</span><span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token class-name">AbstractPlainSocketImpl</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">188</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span>PlainSocketImpl</span><span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token class-name">PlainSocketImpl</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">172</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span>SocksSocketImpl</span><span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token class-name">SocksSocketImpl</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">392</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span>Socket</span><span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token class-name">Socket</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">589</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">redis<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>jedis<span class="token punctuation">.</span></span>Connection</span><span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token class-name">Connection</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">181</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token number">6</span> more
</code></pre> 
<ol start="2"><li>修改 /myredis/redis.conf文件相关配置项</li></ol> 
<pre><code class="prism language-shell"><span class="token number">1</span>.redis默认只能通过本地localhost <span class="token punctuation">(</span><span class="token number">127.0</span>.0.1）进行连接，如果使用192.168.31.122连接则会报一下错误
<span class="token punctuation">(</span>error<span class="token punctuation">)</span> DENIED Redis is running <span class="token keyword">in</span> protected mode because protected mode is enabled, no <span class="token builtin class-name">bind</span> address was specified, no authentication password is requested to clients. In this mode connections are only accepted from the lookback interface. If you want to connect from external computers to Redis you may adopt one of the following solutions: <span class="token number">1</span><span class="token punctuation">)</span> Just disable protected mode sending the <span class="token builtin class-name">command</span> <span class="token string">'CONFIG SET protected-mode no'</span> from the loopback interface by connecting to Redis from the same <span class="token function">host</span> the server is running, however MAKE SURE Redis is not publicly accessible from internet <span class="token keyword">if</span> you <span class="token keyword">do</span> so. Use CONFIG REWRITE to <span class="token function">make</span> this change permanent. <span class="token number">2</span><span class="token punctuation">)</span> Alternatively you can just disable the protected mode by editing the Redis configuration file, and setting the protected mode option to <span class="token string">'no'</span>, and <span class="token keyword">then</span> restarting the server. <span class="token number">3</span><span class="token punctuation">)</span> If you started the server manually just <span class="token keyword">for</span> testing, restart it with the --portected-mode no option. <span class="token number">4</span><span class="token punctuation">)</span> Setup a <span class="token builtin class-name">bind</span> address or an authentication password. NOTE: You only need to <span class="token keyword">do</span> one of the above things <span class="token keyword">in</span> order <span class="token keyword">for</span> the server to start accepting connections from the outside.

解决方法:注释掉redis.conf文件中的 <span class="token builtin class-name">bind</span> <span class="token number">127.0</span>.0.1 即： <span class="token comment">#bind 127.0.0.1</span>

<span class="token number">2</span>.Redis默认不是以守护进程的方式运行，可以通过该配置项修改，使用yes启用守护进程，使用jedis连接redis时需设置为出厂默认的no，即在redis.conf中找到daemonize，将其设置为: daemonize no  

<span class="token number">3</span>.设置保护模式，将出厂默认设置：protected-mode <span class="token function">yes</span> 设置为：protected-mode no   
</code></pre> 
<h3><a id="2javaJedisRedis_580"></a>2.java通过Jedis连接Redis服务器</h3> 
<ol><li>准备Jedis的jar包，使用maven下载Jedis的jar包</li></ol> 
<pre><code class="prism language-xml"><span class="token comment">&lt;!-- https://mvnrepository.com/artifact/redis.clients/jedis --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>redis.clients<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jedis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.0.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>			
</code></pre> 
<ol start="2"><li>编写测试类代码</li></ol> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisClientTest</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">redisClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">"192.168.31.122"</span><span class="token punctuation">,</span><span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">ping</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"k1"</span><span class="token punctuation">,</span><span class="token string">"hello world!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"k1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/cde793c5cc37a5ed591a95f207014555/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">HTTPS环境下使用WebSocket问题解决</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4982e75c0071beb9e2c16866c7289b42/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">黑豹程序员-webstorm支持同时打开多个项目</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>