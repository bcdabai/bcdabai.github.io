<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>STM32的各种疑难杂症和小技巧 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="STM32的各种疑难杂症和小技巧" />
<meta property="og:description" content="这里是目录 疑难杂症定时器输入捕获HAL库修改输入捕获的极性 PWM输出标准库初始化配置TIM1、TIM8高级定时器 无法烧录程序提示Could not stop Cortex-M device!Please check the JTAG cable.提示No Cortex_M SW Device Found、Error: Flash Download failed - Target DLL has been cancelled 小技巧三种启动模式 疑难杂症 定时器 输入捕获 HAL库修改输入捕获的极性 HAL库在用库函数调整输入捕获的极性时，要先重置上一次的设定，才能修改成功： TIM_RESET_CAPTUREPOLARITY(&amp;htim1,TIM_CHANNEL_1); TIM_SET_CAPTUREPOLARITY(&amp;htim1,TIM_CHANNEL_1,TIM_INPUTCHANNELPOLARITY_RISING); 如上述代码所示，在用TIM_SET_CAPTUREPOLARITY()函数修改输入捕获的极性前，要先用TIM_RESET_CAPTUREPOLARITY（）函数重置一下设置，才能修改成功，否则会无法修改。（这一条目前只在STM32F407系列单片机上使用过，不确定其他系列单片机是否有这种要求，当然也有可能HAL库更新到某一版本后就没有这个要求了） PWM输出 标准库初始化配置TIM1、TIM8高级定时器 标准库在初始化高级定时器TIM1、TIM8时，和初始化普通定时器不同，需要多调用一个函数才能正常输出PWM信号： TIM_CtrlPWMOutputs(TIM8,ENABLE); 这一条目前只在STM32F407系列单片机上使用过，不确定其他系列单片机是否有这种要求，当然也有可能HAL库更新到某一版本后就没有这个要求了 无法烧录程序 提示Could not stop Cortex-M device!Please check the JTAG cable. 弹出如下图所示的两个提示框
我出现这个问题的原因非常奇怪，是因为我板子上的复位电路（如下图所示，按键没按下时，复位信号线被上拉电阻R2拉高，按下后复位信号线上电平被开关拉低至GND从而产生复位，电容的目的是为了消抖防误触等）里的电容坏了，导致NRST信号线被拉低至了0.7V左右，从而芯片一直处于复位状态而产生的这个bug。把该电容去掉或者更换一个新的后该问题即得到解决，可以成功烧录程序。
提示No Cortex_M SW Device Found、Error: Flash Download failed - Target DLL has been cancelled 如下图所示，出现这个问题的原因是，PLL锁相环电路设置不正确导致芯片运行频率过高锁死（一般情况都是，原本跑在8MHz晶振板子上的程序，换到了一个25MHz晶振的板子上运行，你不知道它是25MHz或者忘记修改程序了而导致的）
解决办法也很简单，因为STM有三种启动模式，而只有一种是从默认的主闪存存储器启动（即从STM32的片上Flash启动，STM32的片上Flash也是存储用户编写的程序的地方），因此修改BOOT引脚的高低电平，不从flash启动，芯片就不会因频率过高而自锁，从而就可以烧录进去修改后的设置正确的程序，再把BOOT引脚改过来，即可正常使用。 小技巧 三种启动模式 STM32是现在非常流行的一款单片机，它一共有三种启动方式，如下图所示：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/c1c04cd845fab828b9829d4a7a2a097c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-16T10:57:18+08:00" />
<meta property="article:modified_time" content="2023-11-16T10:57:18+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">STM32的各种疑难杂症和小技巧</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>这里是目录</h4> 
 <ul><li><a href="#_1" rel="nofollow">疑难杂症</a></li><li><ul><li><a href="#_2" rel="nofollow">定时器</a></li><li><ul><li><a href="#_3" rel="nofollow">输入捕获</a></li><li><ul><li><a href="#HAL_4" rel="nofollow">HAL库修改输入捕获的极性</a></li></ul> 
    </li><li><a href="#PWM_15" rel="nofollow">PWM输出</a></li><li><ul><li><a href="#TIM1TIM8_16" rel="nofollow">标准库初始化配置TIM1、TIM8高级定时器</a></li></ul> 
   </li></ul> 
   </li><li><a href="#_25" rel="nofollow">无法烧录程序</a></li><li><ul><li><a href="#Could_not_stop_CortexM_devicePlease_check_the_JTAG_cable_26" rel="nofollow">提示Could not stop Cortex-M device!Please check the JTAG cable.</a></li><li><a href="#No_Cortex_M_SW_Device_FoundError_Flash_Download_failed__Target_DLL_has_been_cancelled_33" rel="nofollow">提示No Cortex_M SW Device Found、Error: Flash Download failed - Target DLL has been cancelled</a></li></ul> 
  </li></ul> 
  </li><li><a href="#_38" rel="nofollow">小技巧</a></li><li><ul><li><a href="#_39" rel="nofollow">三种启动模式</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="_1"></a>疑难杂症</h2> 
<h3><a id="_2"></a>定时器</h3> 
<h4><a id="_3"></a>输入捕获</h4> 
<h5><a id="HAL_4"></a>HAL库修改输入捕获的极性</h5> 
<ol><li><code>HAL库</code>在用库函数调整输入捕获的极性时，要先重置上一次的设定，才能修改成功：</li></ol> 
<pre><code class="prism language-c"><span class="token function">TIM_RESET_CAPTUREPOLARITY</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>htim1<span class="token punctuation">,</span>TIM_CHANNEL_1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">TIM_SET_CAPTUREPOLARITY</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>htim1<span class="token punctuation">,</span>TIM_CHANNEL_1<span class="token punctuation">,</span>TIM_INPUTCHANNELPOLARITY_RISING<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<ol start="3"><li>如上述代码所示，在用<code>TIM_SET_CAPTUREPOLARITY()</code>函数修改输入捕获的极性前，要先用<code>TIM_RESET_CAPTUREPOLARITY（）</code>函数重置一下设置，才能修改成功，否则会无法修改。（这一条目前只在STM32F407系列单片机上使用过，不确定其他系列单片机是否有这种要求，当然也有可能HAL库更新到某一版本后就没有这个要求了）</li></ol> 
<h4><a id="PWM_15"></a>PWM输出</h4> 
<h5><a id="TIM1TIM8_16"></a>标准库初始化配置TIM1、TIM8高级定时器</h5> 
<ol><li><code>标准库</code>在初始化高级定时器TIM1、TIM8时，和初始化普通定时器不同，需要多调用一个函数才能正常输出PWM信号：</li></ol> 
<pre><code class="prism language-c"><span class="token function">TIM_CtrlPWMOutputs</span><span class="token punctuation">(</span>TIM8<span class="token punctuation">,</span>ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<ol start="2"><li>这一条目前只在STM32F407系列单片机上使用过，不确定其他系列单片机是否有这种要求，当然也有可能HAL库更新到某一版本后就没有这个要求了</li></ol> 
<h3><a id="_25"></a>无法烧录程序</h3> 
<h4><a id="Could_not_stop_CortexM_devicePlease_check_the_JTAG_cable_26"></a>提示Could not stop Cortex-M device!Please check the JTAG cable.</h4> 
<ol><li>弹出如下图所示的两个提示框<br> <img src="https://images2.imgbox.com/43/3b/cNeYedoP_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/d1/67/ACvyJP8R_o.png" alt="在这里插入图片描述"></li><li>我出现这个问题的原因非常奇怪，是因为我板子上的复位电路（如下图所示，按键没按下时，复位信号线被上拉电阻R2拉高，按下后复位信号线上电平被开关拉低至GND从而产生复位，电容的目的是为了消抖防误触等）里的电容坏了，导致NRST信号线被拉低至了0.7V左右，从而芯片一直处于复位状态而产生的这个bug。把该电容去掉或者更换一个新的后该问题即得到解决，可以成功烧录程序。<br> <img src="https://images2.imgbox.com/74/90/sZjnWxiJ_o.png" alt="在这里插入图片描述"></li></ol> 
<h4><a id="No_Cortex_M_SW_Device_FoundError_Flash_Download_failed__Target_DLL_has_been_cancelled_33"></a>提示No Cortex_M SW Device Found、Error: Flash Download failed - Target DLL has been cancelled</h4> 
<ol><li>如下图所示，出现这个问题的原因是，PLL锁相环电路设置不正确导致芯片运行频率过高锁死（一般情况都是，原本跑在8MHz晶振板子上的程序，换到了一个25MHz晶振的板子上运行，你不知道它是25MHz或者忘记修改程序了而导致的）<br> <img src="https://images2.imgbox.com/4f/79/Milnngw7_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/d5/f4/mrPA6N9i_o.png" alt="在这里插入图片描述"></li><li>解决办法也很简单，因为STM有三种启动模式，而只有一种是从默认的主闪存存储器启动（即从STM32的片上Flash启动，STM32的片上Flash也是存储用户编写的程序的地方），因此修改BOOT引脚的高低电平，不从flash启动，芯片就不会因频率过高而自锁，从而就可以烧录进去修改后的设置正确的程序，再把BOOT引脚改过来，即可正常使用。</li></ol> 
<h2><a id="_38"></a>小技巧</h2> 
<h3><a id="_39"></a>三种启动模式</h3> 
<ol><li>STM32是现在非常流行的一款单片机，它一共有三种启动方式，如下图所示：<br> <img src="https://images2.imgbox.com/0d/d6/bjfUSRIg_o.png" alt="在这里插入图片描述"></li><li>STM32的启动方式是由BOOT0和BOOT1两个引脚的电平状态确定的，即在给STM32上电后，会在第四个SYSCLK时钟上升沿锁定这两个引脚的电平，并且转到对应的启动方式。而这两个引脚的电平一般是由外部的跳线帽进行选择这两个引脚是接到开发板的VCC还是GND上，GND对应着0，VCC对应着1。</li><li>上图BOOT1处的X表示当BOOT0为0即低电平时，不论BOOT1为0还是为1，STM32都从主闪存存储器启动即从STM32的片上Flash启动，STM32的片上Flash是存储用户编写的程序的地方。这个一般也是最常用的启动方式。</li><li>第二种从系统存储器启动的方式就是我们常说的串口下载程序，即ISP。在32出厂时由生产者内置了一段BootLoader，而且这个地方是ROM，即只读存储器，用户是无法修改的，从这里启动后我们可以通过STM32的串口1将程序烧录进单片机里。需要注意的是这里烧录的程序是存储在主闪存存储器里的，因此我们还需要再次将跳线帽拔下来，将BOOT0引脚设置为低电平，然后将单片机重新上电启动，才能运行刚刚通过串口1烧录进单片机的程序。另外还需要注意的是这种下载程序的方法只能从串口1下载，其他串口是不可以的。</li></ol>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e12b937f4c2dc9ef9ac9b4de9a27ba76/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Feign调用返回值统一处理</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ec391122c2e5477dea1880aa859155a9/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【算法】最短路径——弗洛伊德 (Floyd) 算法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>