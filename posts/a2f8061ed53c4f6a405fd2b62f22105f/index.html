<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>搭建OpenWrt开发环境（包括编译过程） - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="搭建OpenWrt开发环境（包括编译过程）" />
<meta property="og:description" content="【转】搭建OpenWrt开发环境（包括编译过程） OpenWrt是一个高度模块化、高度自动化的嵌入式linux发行版，其编译和安装过程比普通的linux发行版而言，要简单太多了。如果您是新手，您那恐惧的心大可放到肚子里，呵呵。对于新手来说最麻烦的恐怕是安装开发环境需要的软件了。
最基本条件：
&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;
1.PC一台，性能强点，性能好编译得就快。linux推荐安装ubuntu 8.04中文版（或者suse）和fedora 11（对于初学者而言，最好是装在虚拟机如VM里，可省去很多麻烦。如何在VM里安装linux，您可多google或者baidu） 2.宽带一条，需要速度好点，因为有很多软件包是网络下载后安装。 3.耐心和时间。
编译环境准备（安装linux发行版和软件包）：
&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;
1.安装好ubuntu8.04中文版本或者fedora 9或者11，搞定网络连接。
以非root用户登陆，打开“应用程序—-附件—-终端”。如果您已经安装好linux, 那么此步骤请略去。
2.如果您选择ubuntu, 那么ubuntu开发环境需要的软件有sudo apt-get install gcc g&#43;&#43; binutils patch bzip2 flex bison make autoconf gettext texinfo unzip sharutils subversion libncurses5-dev ncurses-term zlib1g-dev
然后
sudo apt-get update
如您选择安装fedora11或者fedora9
Fedora 11 or 9: # yum install autoconf binutils bison bzip2 flex gawk gcc gcc-c&#43;&#43; gettext make ncurses-devel patch unzip wget zlib-devel 由于fedora 安装包本来就很全面，所以需另外安装的东西较少。所以一般情况下，推荐安装fedora 11。对于初学者而言，最方便的方法是在VM上安装linux。
由于ubuntu本来就是基于suse， 所以如果您要以suse为开发环境，那么您参考ubuntu的安装步骤即可。
如果你能阅读英文，那么请参考" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/a2f8061ed53c4f6a405fd2b62f22105f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2013-02-26T09:20:38+08:00" />
<meta property="article:modified_time" content="2013-02-26T09:20:38+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">搭建OpenWrt开发环境（包括编译过程）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div class="content-head clearfix" style="zoom:1"> 
 <h3 class="title content-title" style="margin:0px 0px 10px; padding:0px; font-size:20px; font-family:tahoma,helvetica,'microsoft yahei',arial; color:rgb(69,69,69); font-weight:normal; float:left"> 【转】搭建OpenWrt开发环境（包括编译过程）</h3> 
</div> 
<div id="content" class="content mod-cs-content text-content clearfix" style="zoom:1; width:758px; overflow:hidden; font-size:14px; line-height:1.5; margin:20px 0px"> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> OpenWrt是一个高度模块化、高度自动化的嵌入式linux发行版，其编译和安装过程比普通的linux发行版而言，要简单太多了。如果您是新手，您那恐惧的心大可放到肚子里，呵呵。对于新手来说最麻烦的恐怕是安装开发环境需要的软件了。<br> 最基本条件：</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++<br> 1.PC一台，性能强点，性能好编译得就快。linux推荐安装ubuntu 8.04中文版（或者suse）和fedora 11（对于初学者而言，最好是装在虚拟机如VM里，可省去很多麻烦。如何在VM里安装linux，您可多google或者baidu） <br> 2.宽带一条，需要速度好点，因为有很多软件包是网络下载后安装。 <br> 3.耐心和时间。<br> 编译环境准备（安装linux发行版和软件包）：</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++<br> 1.安装好ubuntu8.04中文版本或者fedora 9或者11，搞定网络连接。<br> 以非root用户登陆，打开“应用程序—-附件—-终端”。如果您已经安装好linux, 那么此步骤请略去。<br> 2.如果您选择ubuntu, 那么ubuntu开发环境需要的软件有sudo apt-get install gcc g++ binutils patch bzip2 flex bison make autoconf gettext texinfo unzip sharutils subversion libncurses5-dev ncurses-term zlib1g-dev<br> 然后<br> sudo apt-get update<br> 如您选择安装fedora11或者fedora9<br> Fedora 11 or 9: <br> # yum install autoconf binutils bison bzip2 flex gawk gcc gcc-c++ gettext make ncurses-devel patch unzip wget zlib-devel <br> 由于fedora 安装包本来就很全面，所以需另外安装的东西较少。所以一般情况下，推荐安装fedora 11。对于初学者而言，最方便的方法是在VM上安装linux。<br> 由于ubuntu本来就是基于suse， 所以如果您要以suse为开发环境，那么您参考ubuntu的安装步骤即可。<br> 如果你能阅读英文，那么请参考<br> <a href="http://wiki.openwrt.org/doc/howto/buildroot" rel="nofollow noopener noreferrer" target="_blank" style="color:rgb(95,155,205)">http://wiki.openwrt.org/doc/howto/buildroot</a>，<br> OpenWrt英文论坛2006年文章：Building OpenWrt Kamikaze from source <br> <a href="https://forum.openwrt.org/viewtopic.php?id=9180" rel="nofollow noopener noreferrer" target="_blank" style="color:rgb(95,155,205)">https://forum.openwrt.org/viewtopic.php?id=9180</a><br> 这里有更详细权威的说明。<br> 4.获取OpenWrt源代码和安装包，更新 <br> 1. svn checkout svn://svn.openwrt.org/openwrt/trunk （开发版本，不稳定，不建议下载）</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial">     PS：wget<a href="http://downloads.openwrt.org/backfire/10.03/backfire_10.03_source.tar.bz2" rel="nofollow" style="color:rgb(95,155,205)">http://downloads.openwrt.org/backfire/10.03/backfire_10.03_source.tar.bz2</a>（目前稳定版本，建议）<br> 2. 检查配置环境</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> 必须使用非root用户进行操作，添加一个普通用户。（注意：如果使用root进行操作的话，会提示检查失败：Checking 'non-root'... failed.）</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> [root@localhost trunk]# adduser openwrt </p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> [root@localhost trunk]# su openwrt</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> 为了防止文件读写权限造成问题，需要将源码copy到openwet的根目录下进行所有操作。</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> [openwrt@localhost openwrt]$ cd ~</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> [openwrt@localhost ~]$ cp -r /usr/src/test/trunk ./</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> [openwrt@localhost ~]$ cd trunk/</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> [openwrt@localhost trunk]$ ls</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> BSDmakefile  LICENSE   README  feeds.conf.default  package   scripts  toolchain</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> Config.in    Makefile  docs    include             rules.mk  target   tools</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> <br> 3.下载feeds</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> Feeds是OpenWrt环境所需要的软件包套件。最重要的feeds有：</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> ‘packages’一些额外的基础路由器特性软件</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> ‘LuCI’OpenWrt默认的GUI</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> ‘Xwrt’另一种可选的GUI界面</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> 需要能够连接互联网。</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> 在下载之前可以通过查看’feeds.conf.default’文件，来检查哪些文件需要包含在环境中。</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> 开始下载，使用：</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> [openwrt@localhost trunk]$ ./scripts/feeds update -a</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> 安装feeds包，只有安装之后，在后面的make menuconfig时，才可以对相关配置进行勾选。</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> [openwrt@localhost trunk]$ ./scripts/feeds install -a</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> 如果更新了feeds的配置文件，需要添加新的软件包用于生成系统。只需进行重复操作：</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> [openwrt@localhost trunk]$ ./scripts/feeds update -a</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> [openwrt@localhost trunk]$ ./scripts/feeds install -a</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> <br>  4.进行配置</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> 编译过程使用的交叉编译，交叉编译生成的SDK以及image等文件的类型取决于开发环境、应用硬件、以及源码版本。所以要对自己的环境进行了解，才能进行正确的配置。我在配置过程中，就遇到了这个问题，我的硬件是brcm47xx，在第一次编译的时候，选择地是Target System (Broadcom BCM947xx/953xx)，最后生成的包无法在router上安装，版本不匹配。第二次安装时，选择了Target System (Broadcom BCM947xx/953xx[2.4]),安装成功，我的板子可能只支持linux2.4的内核。（设备型号是Linksys Wrt54gs v3.0） (2011.05.01添加：其实Linksys Wrt54gs v3.0是支持Linux 2.6版本的，Target System 选择 Broadcom BCM947xx/953xx，编译后也是可以用的，这周末由于项目需要改某个软件，每次修改代码后，都得重新编译一下固件，经过来回编译了十来次，都可以使用。另外。内核版本升级之后，无线驱动改成了mac802.11，而非以前的wl，以为wl.o这个专门的库只在linux2.4中才用到。)</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> [openwrt@localhost trunk]$ make defconfig</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> [openwrt@localhost trunk]$ make prereq</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> [openwrt@localhost trunk]$ make menuconfig</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> 通过文本对话框进行选项配置，最主要的配置项有：</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> Target system（目标系统类型）</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> Package selection（软件包选择）</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> Build system settings  （编译系统设置）</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> Kernel modules  （内核模块）</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> [*]表示:这个包裹选中编译，并安装在firmware中；</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> [M]表示：这个软件包选中编译，但并不安装在firmware中。</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> 在退出Menuconfig的时，会提示是否保存配置。</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> 在此我只对target system进行了选择；勾选了Advanced configuration option和Build the OpenWrt SDK选项。</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> 5. 编译</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> （1）一般情况，使用一个简单的命令：</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> [openwrt@localhost trunk]$ make</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> （2）在多核处理器系统上为提高速度，可使用（例如用3核处理器）：</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> [openwrt@localhost trunk]$ make –j 3</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> （3）在后台进行编译，使用空闲的I/O资源和CPU性能，可使用（例如使用双核处理器）</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> [openwrt@localhost trunk]$ onice -c 3 nice -n 20 make -j 2</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> （4）编译一个单独的软件包（例如在cups软件包）：</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> [openwrt@localhost trunk]$ make package/cups/compile V=99</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> （5）如果特殊原因需要分析编译报错信息：</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> [openwrt@localhost trunk]$ make V=99 2&gt;&amp;1 |tee build.log |grep -i error</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> 说明：将编译的所有输出信息保存在build.log中，将error信息打印在屏幕上。</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> （6）一个复杂指令的应用</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> [openwrt@localhost trunk]$ ionice -c 3 nice -n 20 make -j 2 V=99 CONFIG_DEBUG_SECTION_MISMATCH=y 2&gt;&amp;1 \|tee build.log |egrep -i '(warn|error)'</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> 说明：将编译的所有输出信息保存在build.log中，将error和warning信息打印在屏幕上。编译过程使用双核CPU，占用后台资源。</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> <br> 6.生成镜像（Image）位置</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> 新生成的镜像会默认放在新建的一个bin目录下。例如:/bin/brcm-2.4/packages</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> [openwrt@localhost trunk]$ ls bin/*</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> 将编译好的镜像做个备份，例如备份到/目录下：</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> [openwrt@localhost trunk]$ cp bin /</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> <br> 7.清理工作</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> 建议现在清理编译产生的文件，以免下次编译时造成冲突，（文件如果存在的话，将不会被替换），执行make clean</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> 注意：在执行clean命令，确保已经将编译好的image进行了备份。清理工作会清楚bin目录。</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> [openwrt@localhost trunk]$ make clean </p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> 除了清除生成的目录，还想清除交叉编译工具（以及工具链目录）</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> [openwrt@localhost trunk]$ make dirclean</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> 清除所有相关的东西，包括下载的软件包，配置文件，feed内容等：（不建议使用）</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> [openwrt@localhost trunk]$ make distclean</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> 对于更新feeds后出现的错误：</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> ERROR:please fix package/feeds/packages/mc/Makefile 等类似的问题，需要执行这条语句进行系统的清理</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial">  <br> 更详细的信息建议您参考<br> <a href="http://downloads.openwrt.org/kamikaze/docs/openwrt.html" rel="nofollow noopener noreferrer" target="_blank" style="color:rgb(95,155,205)">http://downloads.openwrt.org/kamikaze/docs/openwrt.html</a>  <br> 应该是当前最新最权威的文档</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial">  </p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> 编译过程中需要通过官网下载很多相关的软件包，所以必须保证能够顺利连上外网。由于下载速度的限制，编译过程大概需要数小时。编译结束后，所有的产品都会放在编译根目录下的bin/yourtarget/. 例如:我所编译的产物都放在./bin/brcm47xx/下，其中文件主要有几类：<br> （1）. bin/.trx 文件: 这些都是在我们所选的target-system的类别之下，针对不同路由器型号、版本编译的路由器固件。这些不同路由器的型号和版本是openwrt预先设置好的，我们不需要更改。至于.bin和.trx的区别，一种说法是，第一次刷路由器的时候，需要用.bin文件，如果需要再升级，则不能再使用. bin文件，而需要用.trx文件。原因是，.bin是将路由器的相关配置信息和.trx封装在一起而生成的封包，也就是说是包含路由器版本信息的. trx。在第一次刷固件的时候，我们需要提供这样的信息，而在后续升级时，则不再需要，用.trx文件即可。<br> （2）packages文件夹: 里面包含了我们在配置文件里设定的所有编译好的软件包。默认情况下，会有默认选择的软件包。<br> （3） OpenWrt-SDK.**.tar.bz2: 这个也就是我们定制编译好的OpenWRT SDK环境。我们将用这个来进行OpenWrt软件包的开发。例如，我所编译好的SDK环境包为：/bin/brcm47xx/OpenWrt-SDK- brcm47xx-for-Linux-x86_64-gcc-4.3.3+cs_uClibc-0.9.30.1.tar.bz2<br> 可以从名称上看出，target system是brcm47xx，host system是Linux-x86_64，使用的编译工具以及库是4.3.3+cs_uClibc-0.9.30.1。<br> （4）md5sums 文件: 这个文件记录了所有我们编译好的文件的MD5值，来保证文件的完整性。因为文件的不完整，很容易将路由器变成“砖头”。<br> 需要主要的是，编译完成后，一定要将编译好的bin目录进行备份（如果里面东西对你很重要的话），因为在下次编译之前，执行make clean 会将bin目录下的所有文件给清除掉!!<br> 2、 更改原有packages<br> 在编译根目录下会有一个dl的目录，这个目录其实是“download”的简写，在编译前期，需要从网络下载的数据包都会放在这个目录下，这些软件包的一个特点就是，会自动安装在所编译的固件中，也就是我们make menuconfig的时候，为固件配置的一些软件包。如果我们需要更改这些源码包，只需要将更改好的源码包打包成相同的名字放在这个目录下，然后开始编译即可。编译时，会将软件包解压到build_dir目录下。<br> 当然，你也可以自己在dl里面创建自己的软件包，然后更改相关的配置文件，让openwrt可以识别这个文件包。<br> 由于我的项目更改的内容是底层的，需要跟固件一起安装。所以，我使用的方法就是直接更改dl目录下软件包，然后重新进行固件编译。感觉类似于Linux的内核编译。反复编过十多次，没有任何问题。</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> <br> 第一次编译由于要下载大量的软件包，慢慢的等吧，快则半小时，慢则2，3小时. 如果下载过慢，建议您中断编译过程，然后用迅雷去主动下载，放到./dl目录下。一个加快速度的小技巧： 本站小编已经将将一些常用的软件包打包成dl.tar,放在<a href="http://ul.to/2y8a2w" rel="nofollow noopener noreferrer" target="_blank" style="color:rgb(95,155,205)">http://ul.to/2y8a2w</a>, 下载后用tar xvf dl.tar（在windows下用winrar打开即可，然后你用ftp或者samba之类传到Linux PC上），将解包出来的东东直接放到./dl目录下，相必会大大加快初次安装、编译的速度。同样在<a href="http://ul.to/fasgus" rel="nofollow noopener noreferrer" target="_blank" style="color:rgb(95,155,205)">http://ul.to/fasgus</a>上可下载linux-2.36.30.10.tar.bz2，当然您也可以用迅雷之类的工具来下。<br> 8. 编译好的文件在当前目录的bin文件夹下。 <br> 如果是brcm-2.4 <br> ls bin/brcm-2.4/ <br> 就可以看到很多熟悉的文件了。</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> 9、  安装OpenWrt</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> 找到对应的固件，进行固件升级。网上方法很多，这里不再赘述。</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial">  </p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> 下面我们编写自己的package:</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> 新建自己的packages<br> 对于自己新建的package，而这个package又不需要随固件一起安装，换句话说，就是可以当做一个可选软件包的话。我们可以利用我们的SDK环境来单独编译，编译后会生成一个ipk的文件包。然后利用 opkg install xxx.ipk 来安装这个软件。<br> 下面具体说下，如何编译一个helloword的软件包。<br> （1）首先，编写helloworld程序<br> 编写helloworld.c<br> /****************<br> * Helloworld.c<br> * The most simplistic C program ever written.<br> * An epileptic monkey on crack could write this code.<br> *****************/<br> #include &lt;stdio.h&gt;<br> #include &lt;unistd.h&gt;<br> int main(void)<br> {<!-- --><br> printf("Hell! O' world, why won't my code compile?\n\n");<br> return 0;<br> }<br> 编写Makefile文件<br> # build helloworld executable when user executes "make"<br> helloworld: helloworld.o<br> $(CC) $(LDFLAGS) helloworld.o -o helloworld<br> helloworld.o: helloworld.c<br> $(CC) $(CFLAGS) -c helloworld.c<br> # remove object files and executable when user executes "make clean"<br> clean:<br> rm *.o helloworld</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> 在这两个文件的目录下，执行make 应该可以生成helloworld的可执行文件。执行helloworld后，能够打印出“Hell! O' world, why won't my code compile?”。这一步，主要保证我们的源程序是可以正常编译的。下面我们将其移植到OpenWRT上。<br> （2）将OpenWrt-SDK-brcm47xx-for-Linux-x86_64-gcc-4.3.3+cs_uClibc-0.9.30.1.tar.bz2解压<br> tar –xvf OpenWrt-SDK-brcm47xx-for-Linux-x86_64-gcc-4.3.3+cs_uClibc-0.9.30.1.tar.bz2<br> （3）进入SDK<br> cd OpenWrt-SDK-brcm47xx-for-Linux-x86_64-gcc-4.3.3+cs_uClibc-0.9.30.1<br> 可以看到里面的目录结构跟我们之前source的目录结构基本相同，所需要编译的软件包，需要放置在package目录下<br> （4）在package目录下创建helloworld目录<br> cd package<br> mkdir helloworld<br> cd helloworld<br> （5）创建src目录，拷贝 helloworld文件<br> mkdir src<br> cp /home/wrt/test/helloworld.c src<br> cp /home/wrt/test/Makefile src<br> （6）在helloworld目录下创建Makefile文件<br> 这个Makefile文件是给OpenWRT读的，而之前写的那个Makefile文件是针对helloworld给编译其读的。两个Makefile不在同一层目录下。<br> touch Makefile<br> vim Makefile<br> Makefile文件模板内容如下：<br> ##############################################<br> # OpenWrt Makefile for helloworld program<br> #<br> #<br> # Most of the variables used here are defined in<br> # the include directives below. We just need to<br> # specify a basic description of the package,<br> # where to build our program, where to find<br> # the source files, and where to install the<br> # compiled program on the router.<br> #<br> # Be very careful of spacing in this file.<br> # Indents should be tabs, not spaces, and<br> # there should be no trailing whitespace in<br> # lines that are not commented.<br> #<br> ##############################################<br> include $(TOPDIR)/rules.mk<br> # Name and release number of this package<br> PKG_NAME:=helloworld<br> PKG_RELEASE:=1</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> # This specifies the directory where we're going to build the program.<br> # The root build directory, $(BUILD_DIR), is by default the build_mipsel<br> # directory in your OpenWrt SDK directory<br> PKG_BUILD_DIR := $(BUILD_DIR)/$(PKG_NAME)</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> include $(INCLUDE_DIR)/package.mk</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> # Specify package information for this program.<br> # The variables defined here should be self explanatory.<br> # If you are running Kamikaze, delete the DESCRIPTION<br> # variable below and uncomment the Kamikaze define<br> # directive for the description below<br> define Package/helloworld<br> SECTION:=utils<br> CATEGORY:=Utilities<br> TITLE:=Helloworld -- prints a snarky message<br> endef</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> # Uncomment portion below for Kamikaze and delete DESCRIPTION variable above<br> define Package/helloworld/description<br> If you can't figure out what this program does, you're probably<br> brain-dead and need immediate medical attention.<br> endef</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> # Specify what needs to be done to prepare for building the package.<br> # In our case, we need to copy the source files to the build directory.<br> # This is NOT the default. The default uses the PKG_SOURCE_URL and the<br> # PKG_SOURCE which is not defined here to download the source from the web.<br> # In order to just build a simple program that we have just written, it is<br> # much easier to do it this way.<br> define Build/Prepare<br> mkdir -p $(PKG_BUILD_DIR)<br> $(CP) ./src/* $(PKG_BUILD_DIR)/<br> endef</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> # We do not need to define Build/Configure or Build/Compile directives<br> # The defaults are appropriate for compiling a simple program such as this one</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> # Specify where and how to install the program. Since we only have one file,<br> # the helloworld executable, install it by copying it to the /bin directory on<br> # the router. The $(1) variable represents the root directory on the router running<br> # OpenWrt. The $(INSTALL_DIR) variable contains a command to prepare the install<br> # directory if it does not already exist. Likewise $(INSTALL_BIN) contains the<br> # command to copy the binary file from its current location (in our case the build<br> # directory) to the install directory.<br> define Package/helloworld/install<br> $(INSTALL_DIR) $(1)/bin<br> $(INSTALL_BIN) $(PKG_BUILD_DIR)/helloworld $(1)/bin/<br> endef</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> # This line executes the necessary commands to compile our program.<br> # The above define directives specify all the information needed, but this<br> # line calls BuildPackage which in turn actually uses this information to<br> # build a package.<br> $(eval $(call BuildPackage,helloworld))</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial"> （7）返回到SDK的根目录<br> 执行make进行编译<br> 编译过程会在build_dir目录下完成<br> 编译结果会放在 bin/[yourtarget]/package目录下helloworld_1_bcm47xx.ipk<br> （8）上传helloworld_1_bcm47xx.ipk<br> 使用sftp软件上传helloworld_1_bcm47xx.ipk至路由器<br> 执行 opkg install helloworld_1_bcm47xx.ipk<br> 输入hello然后按Tab键，发现openwrt中已经有helloworld可执行命令。<br> 执行 helloworld 查看程序的效果。<br> Hell! O' world, why won't my code compile?</p> 
 <div> 
  <br> 
 </div> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6d6a354d0c2269db62019a3549676fc9/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">金融信息交换协议(FIX)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f006d00ae2df0c7ea87f30375715860f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">11gr2 新特性之：Oracle Flashback Data Archive（FDA） -（total recall）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>