<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【前端性能优化】前端懒加载 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【前端性能优化】前端懒加载" />
<meta property="og:description" content="一、什么是懒加载？什么预加载？ 懒加载也叫做延迟加载、按需加载，指的是在长网页中延迟加载图片数据，是一种较好的网页性能优化的方式。
有的网站图片很多，而如果一上来就加载所有的图片，会导致网页加载很慢
图片懒加载：等图片正式进入到可视区中时，才加载对应的图片，否则不请求图片
预加载指的是将所需的资源提前请求加载到本地，这样后面在需要用到时就直接从缓存取资源。通过预加载能够减少用户的等待时间，提高用户的体验。我了解的预加载的最常用的方式是使用 js 中的 image 对象，通过为 image 对象来设置 scr 属性，来实现图片的预加载。
二、图片懒加载的基本实现 图片的加载是由src引起的，当对src赋值时，浏览器就会请求图片资源。根据这个原理，我们使用HTML5 的data-xxx属性来储存图片的路径，在需要加载图片的时候，将data-xxx中图片的路径赋值给src，这样就实现了图片的按需加载，即懒加载。
懒加载的实现重点在于确定用户需要加载哪张图片，在浏览器中，可视区域内的资源就是用户需要的资源。所以当图片出现在可视区域时，获取图片的真实地址并赋值给图片即可。
&lt;div class=&#34;container&#34;&gt; &lt;img src=&#34;loading.gif&#34; data-src=&#34;pic.png&#34;&gt; &lt;img src=&#34;loading.gif&#34; data-src=&#34;pic.png&#34;&gt; &lt;img src=&#34;loading.gif&#34; data-src=&#34;pic.png&#34;&gt; &lt;img src=&#34;loading.gif&#34; data-src=&#34;pic.png&#34;&gt; &lt;img src=&#34;loading.gif&#34; data-src=&#34;pic.png&#34;&gt; &lt;img src=&#34;loading.gif&#34; data-src=&#34;pic.png&#34;&gt; &lt;/div&gt; &lt;script&gt; var imgs = document.querySelectorAll(&#39;img&#39;); function lozyLoad(){ var scrollTop = document.body.scrollTop || document.documentElement.scrollTop; var winHeight= window.innerHeight; for(var i=0;i &lt; imgs.length;i&#43;&#43;){ if(imgs[i].offsetTop &lt; scrollTop &#43; winHeight ){ imgs[i].src = imgs[i].getAttribute(&#39;data-src&#39;); } } } window." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/53e6995c0500ddd898848b9f5c2530b0/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-07-21T12:26:09+08:00" />
<meta property="article:modified_time" content="2022-07-21T12:26:09+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【前端性能优化】前端懒加载</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_0"></a>一、什么是懒加载？什么预加载？</h3> 
<p>懒加载也叫做延迟加载、按需加载，指的是在长网页中延迟加载图片数据，是一种较好的网页性能优化的方式。<br> 有的网站图片很多，而如果一上来就加载所有的图片，会导致网页加载很慢<br> 图片懒加载：等图片正式进入到可视区中时，才加载对应的图片，否则不请求图片</p> 
<p>预加载指的是将所需的资源提前请求加载到本地，这样后面在需要用到时就直接从缓存取资源。通过预加载能够减少用户的等待时间，提高用户的体验。我了解的预加载的最常用的方式是使用 js 中的 image 对象，通过为 image 对象来设置 scr 属性，来实现图片的预加载。</p> 
<h3><a id="_7"></a>二、图片懒加载的基本实现</h3> 
<p>图片的加载是由src引起的，当对src赋值时，浏览器就会请求图片资源。根据这个原理，我们使用HTML5 的data-xxx属性来储存图片的路径，在需要加载图片的时候，将data-xxx中图片的路径赋值给src，这样就实现了图片的按需加载，即懒加载。</p> 
<p>懒加载的实现重点在于确定用户需要加载哪张图片，在浏览器中，可视区域内的资源就是用户需要的资源。所以当图片出现在可视区域时，获取图片的真实地址并赋值给图片即可。</p> 
<pre><code class="prism language-javascript"><span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"container"</span><span class="token operator">&gt;</span>
     <span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token string">"loading.gif"</span>  data<span class="token operator">-</span>src<span class="token operator">=</span><span class="token string">"pic.png"</span><span class="token operator">&gt;</span>
     <span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token string">"loading.gif"</span>  data<span class="token operator">-</span>src<span class="token operator">=</span><span class="token string">"pic.png"</span><span class="token operator">&gt;</span>
     <span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token string">"loading.gif"</span>  data<span class="token operator">-</span>src<span class="token operator">=</span><span class="token string">"pic.png"</span><span class="token operator">&gt;</span>
     <span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token string">"loading.gif"</span>  data<span class="token operator">-</span>src<span class="token operator">=</span><span class="token string">"pic.png"</span><span class="token operator">&gt;</span>
     <span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token string">"loading.gif"</span>  data<span class="token operator">-</span>src<span class="token operator">=</span><span class="token string">"pic.png"</span><span class="token operator">&gt;</span>
     <span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token string">"loading.gif"</span>  data<span class="token operator">-</span>src<span class="token operator">=</span><span class="token string">"pic.png"</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token keyword">var</span> imgs <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">lozyLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token keyword">var</span> scrollTop <span class="token operator">=</span> document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>scrollTop <span class="token operator">||</span> document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>scrollTop<span class="token punctuation">;</span>
		<span class="token keyword">var</span> winHeight<span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>
		<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> imgs<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>imgs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>offsetTop <span class="token operator">&lt;</span> scrollTop <span class="token operator">+</span> winHeight <span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
				imgs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>src <span class="token operator">=</span> imgs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">'data-src'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
  window<span class="token punctuation">.</span>onscroll <span class="token operator">=</span> <span class="token function">lozyLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

</code></pre> 
<h3><a id="Intersection_Observer_37"></a>三、Intersection Observer实现图片懒加载</h3> 
<p>Intersection Observer是HTML5新增的API，可以用来实现图片懒加载。MDN中对Intersection Observer的解释</p> 
<p><strong>IntersectionObserver接口 (从属于Intersection Observer API) 提供了一种异步观察目标元素与其祖先元素或顶级文档视窗(viewport)交叉状态的方法。祖先元素与视窗(viewport)被称为根(root)。</strong></p> 
<p><strong>当一个IntersectionObserver对象被创建时，其被配置为监听根中一段给定比例的可见区域。一旦IntersectionObserver被创建，则无法更改其配置，所以一个给定的观察者对象只能用来监听可见区域的特定变化值；然而，你可以在同一个观察者对象中配置监听多个目标元素。</strong></p> 
<p>这里封装一个组件并且自定义一个v-lazy属性，然后替换到src上，实现懒加载。</p> 
<pre><code class="prism language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> useIntersectionObserver <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@vueuse/core"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> defaultImg <span class="token keyword">from</span> <span class="token string">'@/assets/images/200.png'</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> App <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">install</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">app</span><span class="token operator">:</span> App</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 全局指令</span>
        app<span class="token punctuation">.</span><span class="token function">directive</span><span class="token punctuation">(</span><span class="token string">'lazy'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// mounted 是 v3 中自定义指令的生命周期，他会被自动调用</span>
            <span class="token comment">// 它表示的含义和组件的mounted是一样的</span>
            <span class="token comment">// el是 dom 元素， binding</span>
            <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> binding</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                el<span class="token punctuation">.</span>src <span class="token operator">=</span> defaultImg
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'lazy'</span><span class="token punctuation">,</span> el<span class="token punctuation">,</span> binding<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">//实时鉴定el是否可见， 如果可见 给它的src设置binding.value</span>
                <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> stop <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useIntersectionObserver</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span> isIntersecting <span class="token punctuation">}</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>isIntersecting<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        el<span class="token punctuation">.</span>src <span class="token operator">=</span> binding<span class="token punctuation">.</span>value

                        <span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        el<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                            el<span class="token punctuation">.</span>src <span class="token operator">=</span> defaultImg
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>

            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
 <span class="token operator">&lt;</span>img  v<span class="token operator">-</span>lazy<span class="token operator">=</span><span class="token string">"item.picture"</span>   alt<span class="token operator">=</span><span class="token string">""</span><span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre> 
<h3><a id="__81"></a>四. 延迟加载视频</h3> 
<p>图片和视频这类静态资源资源占比都最大。与图片一样，视频同样可以延迟加载，来达到优化性能的目的。正常情况下加载视频，使用的是 video 标签，那么对于一些需要由用户自己播放的视频，最好指定video标签的preload属性为none，这样浏览器就不会预加载任何视频数据。为了占用空间，使用poster属性为video占位。如下：</p> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> imgLazyLoad <span class="token operator">=</span> <span class="token function">throttle</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'懒加载操作'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'scroll'</span><span class="token punctuation">,</span> imgLazyLoad<span class="token punctuation">)</span>
</code></pre> 
<h3><a id="__90"></a>五. 使用第三方延迟加载库</h3> 
<p>除了上面介绍的一些延迟加载方法之外，还可以借助一些已经封装好的第三方库，下面是一些成熟的第三方库：<br> lozad.js 是超轻量级且只使用 Intersection Observer 的库， 因此它的性能极佳，但如果要在旧版本浏览器上使用，则需要配置polyfill。<br> lazysizes 是功能全面的延迟加载库，其使用的模式与本文所示的代码示例非常相似，会自动与 元素上的lazyload 类绑定，然后在data-src 和/或 data-srcset 属性中指定图像网址，该库还可以通过许多插件进行扩展，执行延迟各种资源等操作。<br> 如果使用React，可以使用 react-lazyload来进行图片懒加载操作，这个库是React图片懒加载的主流解决方案。</p> 
<p>转载<a href="https://juejin.cn/post/7120214953256026125" rel="nofollow">https://juejin.cn/post/7120214953256026125</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c404dfd1179dee8304b8cabbf0e60f70/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Vue 发送数据请求</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/83751889da689418f2169034438f1d46/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">跟着代码随想录练算法——二叉树（JS）（下）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>