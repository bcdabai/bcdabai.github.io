<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>SQL IF..ELSE..在存储过程的使用规范 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="SQL IF..ELSE..在存储过程的使用规范" />
<meta property="og:description" content="来自: http://hi.baidu.com/%B5%AD%CB%AE%B5%AD%CB%AE/blog/item/bc4938b5a95ae4678ad4b266.html
分类：ＳＱＬ存储过程 (
@city nvarchar(20),
@town nvarchar(20),
@village nvarchar(20)
)
as
declare @num numeric(10)
declare @yd_num numeric(10)
declare @lt_num numeric(10)
declare @gh_num numeric(10)
declare @xlt_num numeric(10)
select @num=count(jmzh) from jfxd.t_gongan_end_2
if @city=&#39;aaa&#39; begin
select @yd_num=count(jmzh) from jfxd.t_gongan_end_2 where SERIAL_NUMBER is notnull
select @lt_num=count(jmzh) from jfxd.t_gongan_end_2 where unicom is not null
select @gh_num=count(jmzh) from jfxd.t_gongan_end_2 where tel is not null
select @xlt_num=count(jmzh) from jfxd.t_gongan_end_2 where little_tel is notnull
end" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/3cbd07ab5b4761640fb073397b6ebea5/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2012-05-13T13:15:51+08:00" />
<meta property="article:modified_time" content="2012-05-13T13:15:51+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">SQL IF..ELSE..在存储过程的使用规范</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2><span style="color:rgb(109,109,109); background-color:white"><span style="font-size:10px">来自: <a href="http://hi.baidu.com/%B5%AD%CB%AE%B5%AD%CB%AE/blog/item/bc4938b5a95ae4678ad4b266.html" rel="nofollow noopener noreferrer" target="_blank"> http://hi.baidu.com/%B5%AD%CB%AE%B5%AD%CB%AE/blog/item/bc4938b5a95ae4678ad4b266.html</a></span><br> </span></h2> 
<h2><span style="color:rgb(109,109,109); background-color:white">分类：ＳＱＬ存储过程</span></h2> 
<p align="left" style="background:white"><span style="color:rgb(109,109,109)">(<br> @city nvarchar(20),<br> @town nvarchar(20),<br> @village nvarchar(20)<br> )<br> as<br> declare @num numeric(10)<br> declare @yd_num numeric(10)<br> declare @lt_num numeric(10)<br> declare @gh_num numeric(10)<br> declare @xlt_num numeric(10)<br> select @num=count(jmzh) from jfxd.t_gongan_end_2<br> if @city='aaa' <br> begin<br> select @yd_num=count(jmzh) from jfxd.t_gongan_end_2 where SERIAL_NUMBER is notnull<br> select @lt_num=count(jmzh) from jfxd.t_gongan_end_2 where unicom is not null<br> select @gh_num=count(jmzh) from jfxd.t_gongan_end_2 where tel is not null<br> select @xlt_num=count(jmzh) from jfxd.t_gongan_end_2 where little_tel is notnull<br> end<br> else if @town='bbb' <br> begin<br> //sql</span><span style="color:#6D6D6D">语句</span><span style="color:#6D6D6D"><br> end<br> else<br> begin<br> //sql</span><span style="color:#6D6D6D">语句</span><span style="color:#6D6D6D"><br> end<br> update t_stat_info set……<br> GO </span><span style="color:#6D6D6D">存储过程人门</span><span style="color:#6D6D6D"><br> </span><span style="color:#6D6D6D">字号</span><span style="color:#6D6D6D"> [</span><span style="color:#6D6D6D">大</span><span style="color:#6D6D6D">中</span><span style="color:#6D6D6D">小</span><span style="color:#6D6D6D">]<br> </span><span style="color:#6D6D6D">分类：ＳＱＬ存储过程</span><span style="color:#6D6D6D"> | </span><span style="color:#6D6D6D">标签：</span><span style="color:#6D6D6D">beck716.chaokuai.com<br> </span><span style="color:#6D6D6D">课程目标</span><span style="color:#6D6D6D">:</span></p> 
<p align="left" style="background:white"><span style="color:#6D6D6D">一、</span><span style="color:#6D6D6D">TRUNCATE</span></p> 
<p align="left" style="background:white"><span style="color:#6D6D6D">二、</span><span style="color:#6D6D6D">Select INTO </span><span style="color:#6D6D6D">建表</span><span style="color:#6D6D6D"><br> </span><span style="color:#6D6D6D">把一个表中的数据复制到另外一个表中。</span></p> 
<p align="left" style="background:white"><span style="color:#6D6D6D">三、</span><span style="color:#6D6D6D">Insert INTO Select</span></p> 
<p align="left" style="background:white"><span style="color:#6D6D6D">四、补充：临时表</span><span style="color:#6D6D6D"><br> </span><span style="color:#6D6D6D">临时表存储在系统数据库</span><span style="color:#6D6D6D">tempdb</span><span style="color:#6D6D6D">中</span><span style="color:#6D6D6D"><br> </span><span style="color:#6D6D6D">临时表会被系统隐式地丢弃</span></p> 
<p align="left" style="background:white"><span style="color:#6D6D6D">---------------------------------------------------------</span></p> 
<p align="left" style="background:white"><span style="color:#6D6D6D">五、存储过程</span><span style="color:#6D6D6D">(**)</span></p> 
<p align="left" style="background:white"><span style="color:#6D6D6D">一、简介：</span><span style="color:#6D6D6D"><br> <br> </span><span style="color:#6D6D6D">　　　存储过程（</span><span style="color:#6D6D6D">Stored Procedure</span><span style="color:#6D6D6D">），</span><span style="color:#6D6D6D">是一组为了完成特定功能的</span><span style="color:#6D6D6D">SQL </span><span style="color:#6D6D6D">语句，集经编译后</span><span style="color:#6D6D6D"><br> </span><span style="color:#6D6D6D">存储在数据库中，用户通过指定存储过程的名字并给出参数，如果该存储过程带有参数来执行</span></p> 
<p align="left" style="background:white"><span style="color:#6D6D6D">它，</span><span style="color:#6D6D6D"><br> </span><span style="color:#6D6D6D">在</span><span style="color:#6D6D6D">SQL Server </span><span style="color:#6D6D6D">的系列版本中，存储过程分为两类：系统提供的存储过程和用户自定义存储过程</span></p> 
<p align="left" style="background:white"><span style="color:#6D6D6D">。</span><span style="color:#6D6D6D"><br> </span><span style="color:#6D6D6D">系统</span><span style="color:#6D6D6D">SP</span><span style="color:#6D6D6D">，主要存储</span><span style="color:#6D6D6D">master </span><span style="color:#6D6D6D">数据库中，并以</span><span style="color:#6D6D6D">sp_</span><span style="color:#6D6D6D">为前缀并且系统存储过程主要是从系统表中获取</span><span style="color:#6D6D6D"><br> </span><span style="color:#6D6D6D">信息，从而为系统管理员管理</span><span style="color:#6D6D6D">SQL Server</span><span style="color:#6D6D6D">。</span><span style="color:#6D6D6D">用户自定义存储过程是由用户创建，并能完成</span><span style="color:#6D6D6D"><br> </span><span style="color:#6D6D6D">某一特定功能，如：查询用户所需数据信息的存储过程。</span><span style="color:#6D6D6D"><br> <br> </span><span style="color:#6D6D6D">　　存储过程具有以下优点</span><span style="color:#6D6D6D"><br> 1.</span><span style="color:#6D6D6D">存储过程允许标准组件式编程</span><span style="color:#6D6D6D">(</span><span style="color:#6D6D6D">模块化设计</span><span style="color:#6D6D6D">)<br> </span><span style="color:#6D6D6D">存储过程在被创建以后，可以在程序中被多次调用，而不必重新编写该存储过程的</span><span style="color:#6D6D6D">SQL</span><span style="color:#6D6D6D">语句，而</span></p> 
<p align="left" style="background:white"><span style="color:#6D6D6D">且数</span><span style="color:#6D6D6D"><br> </span><span style="color:#6D6D6D">据库专业人员可随时对存储过程进行修改，但对应用程序源代码毫无影响。因为应用程序源代</span></p> 
<p align="left" style="background:white"><span style="color:#6D6D6D">码只包含存</span><span style="color:#6D6D6D"><br> </span><span style="color:#6D6D6D">储过程的调用语句，从而极大地提高了程序的可移植性。</span><span style="color:#6D6D6D"><br> <br> 2.</span><span style="color:#6D6D6D">存储过程能够实现快速的执行速度</span><span style="color:#6D6D6D"><br> </span><span style="color:#6D6D6D">　　　如果某一操作包含大量的</span><span style="color:#6D6D6D">Transaction-SQL </span><span style="color:#6D6D6D">代码</span><span style="color:#6D6D6D">,</span><span style="color:#6D6D6D">，或分别被多次执行，那么存储过程要比批处理</span></p> 
<p align="left" style="background:white"><span style="color:#6D6D6D">的</span><span style="color:#6D6D6D"><br> </span><span style="color:#6D6D6D">执行速度快很多，因为存储过程是预编译的，在首次运行一个存储过程时，查询优化器对其进</span></p> 
<p align="left" style="background:white"><span style="color:#6D6D6D">行分析优</span><span style="color:#6D6D6D"><br> </span><span style="color:#6D6D6D">化，并给出最终被存在系统表中的执行计划，而批处理的</span><span style="color:#6D6D6D">Transaction-SQL </span><span style="color:#6D6D6D">语句在每次运行时</span></p> 
<p align="left" style="background:white"><span style="color:#6D6D6D">都要进行</span><span style="color:#6D6D6D"><br> </span><span style="color:#6D6D6D">编译和优化，因此速度相对要慢一些。</span><span style="color:#6D6D6D"><br> <br> 3.</span><span style="color:#6D6D6D">存储过程能够减少网络流量</span><span style="color:#6D6D6D"><br> </span><span style="color:#6D6D6D">　　　对于同一个针对数据数据库对象的操作，如查询修改，如果这一操作所涉及到的</span><span style="color:#6D6D6D">Transaction-SQL <br> </span><span style="color:#6D6D6D">语句被组织成一存储过程，那么当在客户计算机上调用该存储过程时，网络中传送的只是该调</span></p> 
<p align="left" style="background:white"><span style="color:#6D6D6D">用语句，否</span><span style="color:#6D6D6D"><br> </span><span style="color:#6D6D6D">则将是多条</span><span style="color:#6D6D6D">SQL </span> <span style="color:#6D6D6D">语句从而大大增加了网络流量降低网络负载。</span><span style="color:#6D6D6D"><br> <br> 4.</span><span style="color:#6D6D6D">存储过程可被作为一种安全机制来充分利用</span><span style="color:#6D6D6D"><br> </span><span style="color:#6D6D6D">　　　系统管理员通过，对执行某一存储过程的权限进行限制，从而能够实现对相应的数据访问权限的</span></p> 
<p align="left" style="background:white"><span style="color:#6D6D6D">限</span><span style="color:#6D6D6D"><br> </span><span style="color:#6D6D6D">制。</span></p> 
<p align="left" style="background:white"><span style="color:#6D6D6D"><br> </span><span style="color:#6D6D6D">二、变量</span></p> 
<p align="left" style="background:white"><span style="color:#6D6D6D">@I</span></p> 
<p align="left" style="background:white"><span style="color:#6D6D6D">三、流程控制语句</span><span style="color:#6D6D6D">(if else | select case | while )<br> Select ... CASE </span><span style="color:#6D6D6D">实例</span><span style="color:#6D6D6D"><br> DECLARE @iRet INT, @PKDisp VARCHAR(20)<br> SET @iRet = '1'<br> Select @iRet = <br> CASE<br> WHEN @PKDisp = '</span><span style="color:#6D6D6D">一</span><span style="color:#6D6D6D">' THEN 1<br> WHEN @PKDisp = '</span><span style="color:#6D6D6D">二</span><span style="color:#6D6D6D">' THEN 2<br> WHEN @PKDisp = '</span><span style="color:#6D6D6D">三</span><span style="color:#6D6D6D">' THEN 3<br> WHEN @PKDisp = '</span><span style="color:#6D6D6D">四</span><span style="color:#6D6D6D">' THEN 4<br> WHEN @PKDisp = '</span><span style="color:#6D6D6D">五</span><span style="color:#6D6D6D">' THEN 5<br> ELSE 100<br> END</span></p> 
<p align="left" style="background:white"><span style="color:#6D6D6D">四、存储过程格式</span><span style="color:#6D6D6D"><br> <br> </span><span style="color:#6D6D6D">创建存储过程</span><span style="color:#6D6D6D"><br> Create Proc dbo.</span><span style="color:#6D6D6D">存储过程名</span><span style="color:#6D6D6D"><br> </span><span style="color:#6D6D6D">存储过程参数</span><span style="color:#6D6D6D"><br> AS<br> </span><span style="color:#6D6D6D">执行语句</span><span style="color:#6D6D6D"><br> RETURN<br> </span><span style="color:#6D6D6D">执行存储过程</span><span style="color:#6D6D6D"><br> GO<br> *********************************************************/</span></p> 
<p align="left" style="background:white"><span style="color:#6D6D6D"><br> -- </span><span style="color:#6D6D6D">变量的声明</span><span style="color:#6D6D6D">,sql</span><span style="color:#6D6D6D">里面声明变量时必须在变量前加</span><span style="color:#6D6D6D">@</span><span style="color:#6D6D6D">符号</span><span style="color:#6D6D6D"><br> DECLARE @I INT</span></p> 
<p align="left" style="background:white"><span style="color:#6D6D6D">-- </span><span style="color:#6D6D6D">变量的赋值，变量赋值时变量前必须加</span><span style="color:#6D6D6D">set<br> SET @I = 30</span></p> 
<p align="left" style="background:white"><span style="color:#6D6D6D">-- </span><span style="color:#6D6D6D">声明多个变量</span><span style="color:#6D6D6D"><br> DECLARE @s varchar(10),@a INT</span></p> 
<p align="left" style="background:white"><span style="color:#6D6D6D">-- Sql </span> <span style="color:#6D6D6D">里</span><span style="color:#6D6D6D">if</span><span style="color:#6D6D6D">语句</span><span style="color:#6D6D6D"><br> IF </span><span style="color:#6D6D6D">条件</span><span style="color:#6D6D6D"> BEGIN<br> </span><span style="color:#6D6D6D">执行语句</span><span style="color:#6D6D6D"><br> END<br> ELSE BEGIN<br> </span><span style="color:#6D6D6D">执行语句</span><span style="color:#6D6D6D"><br> END<br> <br> DECLARE @d INT<br> set @d = 1</span></p> 
<p align="left" style="background:white"><span style="color:#6D6D6D">IF @d = 1 BEGIN</span></p> 
<p align="left" style="background:white"><span style="color:#6D6D6D">-- </span><span style="color:#6D6D6D">打印</span><span style="color:#6D6D6D"><br> PRINT '</span><span style="color:#6D6D6D">正确</span><span style="color:#6D6D6D">'<br> END<br> ELSE BEGIN<br> PRINT '</span><span style="color:#6D6D6D">错误</span><span style="color:#6D6D6D">'<br> END</span></p> 
<p align="left" style="background:white"><span style="color:#6D6D6D"><br> -- Sql </span><span style="color:#6D6D6D">里的多条件选择语句</span><span style="color:#6D6D6D">.<br> DECLARE @iRet INT, @PKDisp VARCHAR(20)<br> SET @iRet = 1<br> Select @iRet = <br> CASE<br> WHEN @PKDisp = '</span><span style="color:#6D6D6D">一</span><span style="color:#6D6D6D">' THEN 1<br> WHEN @PKDisp = '</span><span style="color:#6D6D6D">二</span><span style="color:#6D6D6D">' THEN 2<br> WHEN @PKDisp = '</span><span style="color:#6D6D6D">三</span><span style="color:#6D6D6D">' THEN 3<br> WHEN @PKDisp = '</span><span style="color:#6D6D6D">四</span><span style="color:#6D6D6D">' THEN 4<br> WHEN @PKDisp = '</span><span style="color:#6D6D6D">五</span><span style="color:#6D6D6D">' THEN 5<br> ELSE 100<br> END</span></p> 
<p align="left" style="background:white"><span style="color:#6D6D6D">-- </span><span style="color:#6D6D6D">循环语句</span><span style="color:#6D6D6D"><br> WHILE </span><span style="color:#6D6D6D">条件</span><span style="color:#6D6D6D"> BEGIN <br> </span><span style="color:#6D6D6D">执行语句</span><span style="color:#6D6D6D"><br> END</span></p> 
<p align="left" style="background:white"><span style="color:#6D6D6D">DECLARE @i INT<br> SET @i = 1<br> WHILE @i&lt;1000000 BEGIN<br> set @i=@i+1<br> END<br> -- </span><span style="color:#6D6D6D">打印</span><span style="color:#6D6D6D"><br> PRINT @i</span></p> 
<p align="left" style="background:white"><span style="color:#6D6D6D"><br> -- TRUNCATE </span><span style="color:#6D6D6D">删除表中的所有行，而不记录单个行删除操作，不能带条件</span></p> 
<p align="left" style="background:white"><span style="color:#6D6D6D"><br> <br> TRUNCATE TABLE authors</span></p> 
<p align="left" style="background:white"><span style="color:#6D6D6D">-- Select INTO </span><span style="color:#6D6D6D">从一个查询的计算结果中创建一个新表。</span><span style="color:#6D6D6D">数据并不返回给客户端，这一点和普通的</span><span style="color:#6D6D6D"><br> -- Select </span><span style="color:#6D6D6D">不同。</span><span style="color:#6D6D6D">新表的字段具有和</span><span style="color:#6D6D6D"> Select </span><span style="color:#6D6D6D">的输出字段相关联（相同）的名字和数据类型。</span><span style="color:#6D6D6D"> <br> <br> select * into NewTable<br> from Uname</span></p> 
<p align="left" style="background:white"><span style="color:#6D6D6D"><br> -- Insert INTO Select<br> -- </span><span style="color:#6D6D6D">表</span><span style="color:#6D6D6D">ABC</span><span style="color:#6D6D6D">必须存在</span><span style="color:#6D6D6D"><br> -- </span><span style="color:#6D6D6D">把表</span><span style="color:#6D6D6D">Uname</span><span style="color:#6D6D6D">里面的字段</span><span style="color:#6D6D6D">Username</span><span style="color:#6D6D6D">复制到表</span><span style="color:#6D6D6D">ABC<br> Insert INTO ABC Select Username FROM Uname</span></p> 
<p align="left" style="background:white"><span style="color:#6D6D6D">-- </span><span style="color:#6D6D6D">创建临时表</span><span style="color:#6D6D6D"><br> Create TABLE #temp(<br> UID int identity(1, 1) PRIMARY KEY,<br> UserName varchar(16),<br> Pwd varchar(50),<br> Age smallint,<br> Sex varchar(6)<br> )<br> -- </span><span style="color:#6D6D6D">打开临时表</span><span style="color:#6D6D6D"><br> Select * from #temp</span></p> 
<p align="left" style="background:white"><span style="color:#6D6D6D">-- </span><span style="color:#6D6D6D">存储过程</span><span style="color:#6D6D6D"><br> -- </span><span style="color:#6D6D6D">要创建存储过程的数据库</span><span style="color:#6D6D6D"><br> Use Test<br> -- </span><span style="color:#6D6D6D">判断要创建的存储过程名是否存在</span><span style="color:#6D6D6D"><br> if Exists(Select name From sysobjects Where And </span></p> 
<p align="left" style="background:white"><span style="color:#6D6D6D">type='P')<br> -- </span><span style="color:#6D6D6D">删除存储过程</span><span style="color:#6D6D6D"><br> Drop Procedure dbo.csp_AddInfo<br> Go<br> <br> <br> -- </span><span style="color:#6D6D6D">创建存储过程</span><span style="color:#6D6D6D"><br> Create Proc dbo.csp_AddInfo<br> -- </span><span style="color:#6D6D6D">存储过程参数</span><span style="color:#6D6D6D"><br> @UserName varchar(16),<br> @Pwd varchar(50),<br> @Age smallint,<br> @Sex varchar(6)<br> AS<br> -- </span><span style="color:#6D6D6D">存储过程语句体</span><span style="color:#6D6D6D"><br> insert into Uname (UserName,Pwd,Age,Sex)<br> values (@UserName,@Pwd,@Age,@Sex)<br> RETURN<br> -- </span><span style="color:#6D6D6D">执行</span><span style="color:#6D6D6D"><br> GO<br> <br> -- </span><span style="color:#6D6D6D">执行存储过程</span><span style="color:#6D6D6D"><br> EXEC csp_AddInfo 'Junn.A','123456',20,'</span><span style="color:#6D6D6D">男</span><span style="color:#6D6D6D">' <br> sql server</span><span style="color:#6D6D6D">中翻页存储过程</span><span style="color:#6D6D6D">:<br> Create PROC blog_GetPagedPosts<br> (<br> @PageIndex int,<br> @PageSize int,<br> @BlogID int=0,<br> @PostType int=-1,<br> @CategoryID int=-1,<br> @Hiding bit =0,<br> @Count int output <br> <br> )<br> as<br> DECLARE @PageLowerBound int<br> DECLARE @PageUpperBound int<br> SET @PageLowerBound = @PageSize * @PageIndex - @PageSize<br> SET @PageUpperBound = @PageLowerBound + @PageSize + 1</span></p> 
<p align="left" style="background:white"><span style="color:#6D6D6D">Create Table #IDs<br> (<br> TempID int IDENTITY (1, 1) NOT NULL,<br> EntryID int not null<br> )<br> Insert into #IDs(EntryID) select DISTINCT [ID] from view_Content whereCategoryID=@CategoryID and blogID=@BlogID order by [ID] desc<br> SELECT vc.*<br> FROM View_Content vc <br> INNER JOIN #IDS tmp ON (vc .[ID] = tmp.EntryID)<br> WHERE tmp.TempID &gt; @PageLowerBound <br> AND tmp.TempID &lt; @PageUpperBound and vc.Hiding=0<br> ORDER BY tmp.TempID<br> SELECT @Count=COUNT(*) FROM #IDS <br> SELECT @Count=COUNT(*) FROM #IDS <br> DROP TABLE #IDS<br> return @Count<br> GO</span></p> 
<p align="left" style="background:white"><span style="color:#6D6D6D">在</span><span style="color:#6D6D6D">Access</span><span style="color:#6D6D6D">中由于不支持存储过程</span><span style="color:#6D6D6D">,</span><span style="color:#6D6D6D">不能建立临时表只能在程序中实现</span><span style="color:#6D6D6D"><br> Access</span><span style="color:#6D6D6D">中实现如下</span><span style="color:#6D6D6D">,</span><span style="color:#6D6D6D">这也是我在</span><span style="color:#6D6D6D">myblog Access</span><span style="color:#6D6D6D">版中使用的</span><span style="color:#6D6D6D">:<br> public List&lt;DayBook&gt; GetPagedPost(PagedPost p, out int TotalRecords)<br> {<!-- --><br> List&lt;DayBook&gt; list = new List&lt;DayBook&gt;();</span></p> 
<p align="left" style="background:white"><span style="color:#6D6D6D">using (OleDbConnection conn = GetOleDbConnection())<br> {<!-- --><br> StringBuilder sql = new StringBuilder();<br> sql.AppendFormat("select [ID] from blog_Content as p ");//</span><span style="color:#6D6D6D">构造查询条件</span><span style="color:#6D6D6D"><br> if (p.CategoryID &gt; 0)<br> {<!-- --><br> sql.AppendFormat(",blog_Categories AS c, blog_Links AS l WHEREc.CategoryID=l.CategoryID and (p.ID=l.PostID ) and c.CategoryID={1} andp.BlogID={0} ",p.BlogID, p.CategoryID);<br> }<br> else<br> {<!-- --><br> sql.AppendFormat(" where p.blogID={0} ", p.BlogID);<br> }<br> if (p.PostType != PostType.Undeclared)<br> {<!-- --><br> sql.AppendFormat(" and p.PostType={0} ", (int)p.PostType);<br> }<br> sql.Append(" order by p.[DateUpdated] desc");<br> // NetDiskContext.Current.Context.Response.Write(sql.ToString());<br> //NetDiskContext.Current.Context.Response.End();<br> OleDbCommand MyComm = new OleDbCommand(sql.ToString(), conn);<br> List&lt;int&gt; IDs = new List&lt;int&gt;(); //</span><span style="color:#6D6D6D">获取主题</span><span style="color:#6D6D6D">ID</span><span style="color:#6D6D6D">列表</span><span style="color:#6D6D6D"><br> conn.Open();<br> using (OleDbDataReader dr = MyComm.ExecuteReader())<br> {<!-- --><br> while (dr.Read())<br> {<!-- --><br> IDs.Add((int)dr[0]);<br> <br> }<br> }<br> <br> TotalRecords=IDs.Count;//</span><span style="color:#6D6D6D">返回记录总数</span><span style="color:#6D6D6D"><br> if (TotalRecords &lt; 1)<br> return list;<br> int pageLowerBound = p.PageSize * p.PageIndex - p.PageSize;//</span><span style="color:#6D6D6D">记录索引</span><span style="color:#6D6D6D"><br> int pageUpperBound = pageLowerBound + p.PageSize ; <br> StringBuilder sb = new StringBuilder();<br> if (TotalRecords &gt;= pageLowerBound)<br> for (int i = pageLowerBound; i &lt; TotalRecords &amp;&amp; i &lt;pageUpperBound; i++)<br> {<!-- --><br> sb.AppendFormat("{0},", IDs[i]);//</span><span style="color:#6D6D6D">构造</span><span style="color:#6D6D6D">ID in() </span><span style="color:#6D6D6D">条件</span><span style="color:#6D6D6D">,</span><span style="color:#6D6D6D">取其中一页</span><span style="color:#6D6D6D"><br> }<br> else return list; //</span><span style="color:#6D6D6D">如没有记录返回空表</span><span style="color:#6D6D6D"><br> if(sb.Length&gt;1)<br> sb.Remove(sb.Length - 1, 1);//</span><span style="color:#6D6D6D">删除最后一个逗号</span><span style="color:#6D6D6D"><br> MyComm.CommandText = string.Format("SELECT b.* , c.Account as Account FROMblog_Content b, Blog_Config c where b.BlogID=c.BlogID and b.[ID] in ({0}) orderby b.dateadded desc", sb.ToString());<br> using (OleDbDataReader dr = MyComm.ExecuteReader())<br> {<!-- --><br> while (dr.Read())<br> {<!-- --><br> list.Add(DataHelp.LoadDayBook(dr));<br> }<br> }<br> return list;<br> }<br> }</span></p> 
<span style="color:#6D6D6D"><br> </span> 
<span style="color:#6D6D6D">存储过程</span> 
<span style="color:#6D6D6D">.chaokuai.com<br> </span> 
<span style="color:#6D6D6D">　定义总是很抽象。存储过程其实就是能完成一定操作的一组</span> 
<span style="color:#6D6D6D">SQL</span> 
<span style="color:#6D6D6D">语句，只不过这组语句是放在数据库中的</span> 
<span style="color:#6D6D6D">(</span> 
<span style="color:#6D6D6D">这里我们只谈</span> 
<span style="color:#6D6D6D">SQL Server)</span> 
<span style="color:#6D6D6D">。如果我们通过创建存储过程以及在</span> 
<span style="color:#6D6D6D">ASP</span> 
<span style="color:#6D6D6D">中调用存储过程，就可以避免将</span> 
<span style="color:#6D6D6D">SQL</span> 
<span style="color:#6D6D6D">语句同</span> 
<span style="color:#6D6D6D">ASP</span> 
<span style="color:#6D6D6D">代码混杂在一起。这样做的好处至少有三个：</span> 
<span style="color:#6D6D6D"> <br> <br> </span> 
<span style="color:#6D6D6D">　　第一、大大提高效率。存储过程本身的执行速度非常快，而且，调用存储过程可以大大减少同数据库的交互次数。</span> 
<span style="color:#6D6D6D"> <br> <br> </span> 
<span style="color:#6D6D6D">　　第二、提高安全性。假如将</span> 
<span style="color:#6D6D6D">SQL</span> 
<span style="color:#6D6D6D">语句混合在</span> 
<span style="color:#6D6D6D">ASP</span> 
<span style="color:#6D6D6D">代码中，一旦代码失密，同时也就意味着库结构失密。</span> 
<span style="color:#6D6D6D"> <br> <br> </span> 
<span style="color:#6D6D6D">　　第三、有利于</span> 
<span style="color:#6D6D6D">SQL</span> 
<span style="color:#6D6D6D">语句的重用。</span> 
<span style="color:#6D6D6D"> <br> <br> </span> 
<span style="color:#6D6D6D">　　在</span> 
<span style="color:#6D6D6D">ASP</span> 
<span style="color:#6D6D6D">中，一般通过</span> 
<span style="color:#6D6D6D">command</span> 
<span style="color:#6D6D6D">对象调用存储过程，根据不同情况，本文也介绍其它调用方法。为了方便说明，根据存储过程的输入输出，作以下简单分类：</span> 
<span style="color:#6D6D6D"> <br> <br> </span> 
<span style="color:#6D6D6D">1. </span> 
<span style="color:#6D6D6D">只返回单一记录集的存储过程</span> 
<span style="color:#6D6D6D"> <br> <br> </span> 
<span style="color:#6D6D6D">　　假设有以下存储过程</span> 
<span style="color:#6D6D6D">(</span> 
<span style="color:#6D6D6D">本文的目的不在于讲述</span> 
<span style="color:#6D6D6D">T-SQL</span> 
<span style="color:#6D6D6D">语法，所以存储过程只给出代码，不作说明</span> 
<span style="color:#6D6D6D">)</span> 
<span style="color:#6D6D6D">：</span> 
<span style="color:#6D6D6D"> <br> <br> <br> CREATE PROCEDURE dbo.delUserAll <br> as <br> set nocount on <br> begin <br> delete from dbo.[userinfo] <br> end <br> go <br> <br> </span> 
<span style="color:#6D6D6D">　　该存储过程删去</span> 
<span style="color:#6D6D6D">userinfo</span> 
<span style="color:#6D6D6D">表中的所有记录，没有任何输入及输出，调用方法与上面讲过的基本相同，只是不用取得记录集：</span> 
<span style="color:#6D6D6D"> <br> <br> '**</span> 
<span style="color:#6D6D6D">通过</span> 
<span style="color:#6D6D6D">Command</span> 
<span style="color:#6D6D6D">对象调用存储过程</span> 
<span style="color:#6D6D6D">** <br> DIM MyComm <br> Set MyComm = Server.CreateObject("ADODB.Command") <br> MyComm.ActiveConnection = MyConStr 'MyConStr</span> 
<span style="color:#6D6D6D">是数据库连接字串</span> 
<span style="color:#6D6D6D"> <br> MyComm.CommandText = "delUserAll" '</span> 
<span style="color:#6D6D6D">指定存储过程名</span> 
<span style="color:#6D6D6D"> <br> MyComm.CommandType = 4 '</span> 
<span style="color:#6D6D6D">表明这是一个存储过程</span> 
<span style="color:#6D6D6D"> <br> MyComm.Prepared = true '</span> 
<span style="color:#6D6D6D">要求将</span> 
<span style="color:#6D6D6D">SQL</span> 
<span style="color:#6D6D6D">命令先行编译</span> 
<span style="color:#6D6D6D"> <br> MyComm.Execute '</span> 
<span style="color:#6D6D6D">此处不必再取得记录集</span> 
<span style="color:#6D6D6D"> <br> Set MyComm = Nothing <br> <br> </span> 
<span style="color:#6D6D6D">　　当然也可通过</span> 
<span style="color:#6D6D6D">Connection</span> 
<span style="color:#6D6D6D">对象或</span> 
<span style="color:#6D6D6D">Recordset</span> 
<span style="color:#6D6D6D">对象调用此类存储过程，不过建立</span> 
<span style="color:#6D6D6D">Recordset</span> 
<span style="color:#6D6D6D">对象是为了取得记录集，在没有返回记录集的情况下，还是利用</span> 
<span style="color:#6D6D6D">Command</span> 
<span style="color:#6D6D6D">对象吧。</span>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b01d8f2b574c74e75e8d43f13690faf7/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">接口设计与数据同步解决方案小结</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9c994e8f44c46fe8ef2dffe0dcb9617d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">JSP九大内置对象...</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>