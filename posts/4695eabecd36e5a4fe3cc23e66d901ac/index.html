<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>关于MySQL 建表的一些建议 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="关于MySQL 建表的一些建议" />
<meta property="og:description" content="MySQL作为关系型数据库，被用来存储持久化的数据，避免不了需要创建表。如果没有利用ORM(对象关系模型)来自动创建表，则需要开发者通过图形界面（Navicat）或者手写MySQL语句。
由于在生产环境下，我们对MySQL数据库的操作通常是通过命令行进行操作，因此，建议建表的时候也手写MySQL语句（不建议用图形界面建表）。
1、添加注释的格式
在编写MySQL语句时，我们通常会被要求加上注释，推荐的注释格式为：
------------------------------------------------- -- 创建表 tb_example 创建示例表 ------------------------------------------------- create table tb_example( …. )… 理由：这种注释格式MySQL解析器也会认为是注释的，然后，会正确执行你的create table相关语句。我们通常将要更改的sql语句整理到一个1.0.0.sql文件中，然后，你只需要登录MySQL客户端，输入：source /文件目录/1.0.0.sql。因此，这样的注释可以达到一举两得的目的。
2、指定表的引擎和缺省的编码格式以及该表的说明
示例语句如下： create table tb_example( …. )engine=innodb default charset=utf8 comment ‘这是一张示例表’; 理由：上述显示的指定使用的引擎为innodb，在5.6之前默认的引擎是MyISAM，而现在主流推荐性能较好的是innodb，具体参考：高性能MySQL 这本书。上述也指定了缺省字符集为utf8，还有不要漏掉使用comment来注释下这张表的用途，便于其他开发人员了解这张表的意图。
3、一个经典的建表语句示例并分析
示例语句如下：
create table tb_example( id int unsigned not null auto_increment comment &#39;主键id&#39;, app_id int unsigned not null default &#39;0&#39; comment &#39;应用id&#39;, app_name varchar(255) not null default &#39;&#39; comment &#39;应用名&#39;, click_cnt int unsigned not null default &#39;0&#39; comment &#39;点击数&#39;, disp_cnt int unsigned not null default &#39;0&#39; comment &#39;展示数&#39;, status tinyint unsigned not null default &#39;0&#39; comment &#39;状态： 1-启用；0-禁用&#39;, click_rate float unsigned not null default &#39;0&#39; comment &#39;点击率=点击数/展示数&#39;, note text not null default &#39;&#39; comment &#39;备注&#39;, date varchar(255) not null default &#39;统计日期&#39;, mtime int unsigned not null comment &#39;修改时间&#39;, ctime int unsigned not null comment &#39;创建时间&#39;, primary key (&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/4695eabecd36e5a4fe3cc23e66d901ac/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-08-15T21:13:13+08:00" />
<meta property="article:modified_time" content="2017-08-15T21:13:13+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">关于MySQL 建表的一些建议</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><span style="white-space:pre"></span>MySQL作为关系型数据库，被用来存储持久化的数据，避免不了需要创建表。如果没有利用ORM(对象关系模型)来自动创建表，则需要开发者通过图形界面（Navicat）或者手写MySQL语句。</p> 
<p><span style="white-space:pre"></span>由于在生产环境下，我们对MySQL数据库的操作通常是通过命令行进行操作，因此，建议建表的时候也手写MySQL语句（不建议用图形界面建表）。</p> 
<p><strong>1、添加注释的格式</strong></p> 
<p>在编写MySQL语句时，我们通常会被要求加上注释，<strong>推荐的注释格式</strong>为：</p> 
<p></p> 
<pre><code class="language-sql">-------------------------------------------------
-- 创建表 tb_example 创建示例表
-------------------------------------------------
create table tb_example(
   ….
)…
</code></pre> 
<p></p> 
<p><strong>理由：</strong>这种注释格式MySQL解析器也会认为是注释的，然后，会正确执行你的create table相关语句。我们通常将要更改的sql语句整理到一个1.0.0.sql文件中，然后，你只需要登录MySQL客户端，输入：<u>source /文件目录/1.0.0.sql</u>。因此，这样的注释可以达到一举两得的目的。</p> 
<p><strong>2、指定表的引擎和缺省的编码格式以及该表的说明</strong></p> 示例语句如下： 
<br> 
<pre><code class="language-sql">create table tb_example(
	….
)engine=innodb default charset=utf8 comment ‘这是一张示例表’;
</code></pre> 
<p><strong>理由：</strong>上述显示的指定使用的引擎为innodb，在5.6之前默认的引擎是MyISAM，而现在主流推荐性能较好的是innodb，具体参考：<u>高性能MySQL 这本书</u>。上述也指定了缺省字符集为utf8，还有不要漏掉使用comment来注释下这张表的用途，便于其他开发人员了解这张表的意图。</p> 
<p><strong>3、一个经典的建表语句示例并分析</strong></p> 
<p><strong>示例语句如下：</strong></p> 
<pre><code class="language-sql">create table tb_example(
	id int unsigned not null auto_increment comment '主键id',
	app_id int unsigned not null default '0' comment '应用id',
	app_name varchar(255) not null default '' comment '应用名',
	click_cnt int unsigned not null default '0' comment '点击数',
	disp_cnt int unsigned not null default '0' comment '展示数',
	status tinyint unsigned not null default '0' comment '状态： 1-启用；0-禁用',
	click_rate float unsigned not null default '0' comment '点击率=点击数/展示数',
	note text not null default '' comment '备注',
	date varchar(255) not null default '统计日期',
	mtime int unsigned not null comment '修改时间',
	ctime int unsigned not null comment '创建时间',
	primary key ("id"),
	unique key unique_date_appid ("date","app_id"),
	key idx_date ("date"),
	key idx_ctime ("ctime")
)engine=innodb default charset=utf8 comment '这是一张示例表';
</code></pre> 
<p><strong>需要注意的点如下：</strong></p> 
<p><strong>1）所有的字段要加commet注释</strong></p> 
<p>由于我们创建的表也可能被其他人所用，因此加上comment注释，其他人或者我们自己可以通过命令show create tabletb_example来查看表的结果信息。</p> 
<p><strong>2）、int 符号确定</strong></p> 
<p>如果确定整形为非负数，就将int设置为无符号型的，即int unsigned，可以多一半的值范围，又能避免插入负数。int设置为无符号的场景在很多场合都使用。</p> 
<p><strong>3）、不定长varchar的长度设置</strong></p> 
<p>对于不定长字符串varchar如果不确定字符串长度（且知道字符串长度小于255）可以设置为vachar(255)，此时，存储空间只比正常的多一个字节（与设置varcahr(10)额外存储的空间是一样的），又能够最大限度的利用varchar的特定。<strong><span style="color:red">注意：</span></strong><span style="color:red">超过255</span>则用于存储该长度的空间会多于一个字节。具体参考：高性能MySQL。</p> 
<p><strong>4）、有限状态的类型设置</strong></p> 
<p>对于表示状态数值的数据类型建议设置为tinyint unsigned（只占用一个字节的空间） 可以表示0到255的范围。<strong><span style="color:red">注意：</span></strong><span style="color:red">无需用int</span>，占用四个字节的空间。</p> 
<p><strong>5）字段创建时间ctime和修改时间mtime</strong></p> 
<p>每个表中尽量加上字段创建时间ctime和字段修改时间mtime，便于后期排查问题，知道该条记录是何时插入，何时修改。</p> 
<p><strong>6）、日期时间设置为int时的查询</strong></p> 
<p>这里的ctime表示创建时间，用的是unix时间戳来存储，但是不能设置缺省值unix_timestamp()，我们在实际查询的时候，<strong>可以使用from_unixtime(ctime)来将unix时间戳转为date日期格式</strong>。</p> 
<p>示例如下：</p> 
<pre><code class="language-sql">insert into tb_example(app_id, app_name, click_cnt, disp_cnt, status, click_rate, note, date, mtime, ctime) values (1, 'timApp', 12, 6, 1, 0.50, '这是备注', '20170815', 1502796713, 1502796713);
select *, FROM_UNIXTIME(mtime), FROM_UNIXTIME(ctime) from tb_example;
</code></pre> 
<p>效果如下：</p> 
<img src="https://images2.imgbox.com/13/0c/zcxFD1Ub_o.png" alt=""> 
<br> 
<p><strong>7）所有的字段尽量设置为not null。</strong></p> 
<p><strong>8）尽可能的设置default的值</strong></p> 
<p>比如：app_name 中通过设置default ‘’，click_cnt设置default ‘0’。</p> 
<p><strong>9）将有可能要<span style="color:red">进行查询的字段</span>设置为索引</strong></p> 
<p>比如：key idx_date(“date”)，这里因为可能会查询一段时间内的数据，因此添加字段“date”的索引。<strong>注意：</strong><u>一般索引的命名规则是idx_字段名</u></p> 
<p><strong>10）设置唯一索引</strong></p> 
<p>根据业务确定哪些字段或者字段组合的值是唯一的，则将该字段或字段组合设置为唯一索引。</p> 
<p><strong>比如：</strong>unique keyunique_date_appid(“date”, “app_id”) 这里因为根据业务我们只要对于具体的某一天具体的某个应用的记录一定只能有一条，因此，设置联合唯一索引可以防止改天对应的该应用的数据重复插入。<strong>注意：</strong><u>唯一索引的命名规则为：unique_字段1_字段2。</u></p> 
<p><strong>一个小知识点：</strong></p> 
<p>由于我们添加了唯一索引unique_date_appid，如果插入重复的date 和 app_id组合，则会报联合索引重复错误，比如，再次执行：</p> 
<pre><code class="language-sql">insert into tb_example(app_id, app_name, click_cnt, disp_cnt, status, click_rate, note, date, mtime, ctime) values (1, 'timApp', 12, 6, 1, 0.50, '这是备注', '20170815', 1502796713, 1502796713);</code></pre> 
<p><strong>提示：</strong></p> 
<img src="https://images2.imgbox.com/db/7d/gPMdN2s6_o.png" alt=""> 
<br> 
<p>但是，我们在很多场景时，不希望执行SQL语句报错，而是提示重复插入，此时，<strong>可以利用insert ignore into语句，将上述SQL语句改为：</strong></p> 
<pre><code class="language-sql">insert ignore into tb_example(app_id, app_name, click_cnt, disp_cnt, status, click_rate, note, date, mtime, ctime) values (1, 'timApp', 12, 6, 1, 0.50, '这是备注', '20170815', 1502796713, 1502796713);</code></pre> 
<p><strong>提示：</strong></p> 
<img src="https://images2.imgbox.com/99/f4/imc8GP1B_o.png" alt=""> 
<br> 
<p>我们可以通过返回结果result进行判断，如果result为0，则表示重复插入。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f3b4f1062081c1204c60afaf91cadfc8/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">PC端 微信支付 扫码之后页面跳转处理</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/458758a08dede88102ff8e9927375c78/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">鼠标滑轮成了页面缩放的解决方法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>