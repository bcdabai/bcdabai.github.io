<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>使用Jenkins部署.Net Core遇到的几个坑 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="使用Jenkins部署.Net Core遇到的几个坑" />
<meta property="og:description" content="搞过CI/CD的同学一定吃过不少苦头，或者说遇到不少坑，但是对自动化的执着住挡不了前进的步伐，如果你缺少了运维这一块知识，那么你的流水线总是不那么完美，本文记录的是自己躺过的坑，希望对你有所帮助。
一、相关环境和版本 服务器：windows2008【历史遗留服务器，建议升级到2012以上，2016支持Windows的容器化技术】源代码管理：git.net core版本：net core 2.2 这里最应该注意的是操作系统版本和Jenkins的版本，不同的版本，特别是操作系统操作的shell可能千差万别，你会在网上看到各种命令，所以选择好自己的环境。
安装Jenkins比较简单，这里略过……
二、Jenkins相关配置 Step1.创建一个自由风格的Jenkins项目，这一步比较简单略过（pipeline项目是一项更加挑战，也许运维高手更需要熟悉，这里跳过）
Step2.在 配置git 源码路径的时候报错： 解决方法：
1.安装git client插件，并重启jenkins
2.确保安装jenkins的服务器同时也安装了git，并在jenkins上配置git的路径，如下图：
3.成功配置git源码路径
Step3.构建时候报错：
从中可以判断，我的邮件还没有配置，所以发送报错……
Step4.进行 邮件的配置 Jenkins内置邮箱功能： 1.首先配置Jenkins Location
所在路径：Manage Jenkins=》Configure System=&gt;Jenkins Location
2.配置E-mail Notification如下图所示
3.测试发送成功
Email插件：Email Extension 插件安装后如下图所示：
step5.构建的坑[该坑最耗时间，最后发现却是最简单] 1.请指定项目或解决方案文件。当前工作目录中未包含项目或解决方案文件。
排查：切换到服务器cmd下进行restore后发现，原来是nuget作怪，因为服务器无法找到部署在本地服务器的nuget包
2.发布Nuget包到官网 试着解决：试着把nuget包发布到官网。具体如何发布请跳转
新版本的发布需要增加License.txt，否则无法通过，配置如下：其中Licese是从github上拷贝过来的。如果你发布后发现代码没有生效，请确认你是否在release下进行编译，并且build过？
解决方法：如下图所示，极其简单，折腾的半天，晕！你甚至dotnet restore和dotnet build都不用写，因为dotnet publish本身包含restore和build
Step6. 卡住在using GIT_ASKPASS to set credentials的坑 Unable to delete &#39;D:\Program Files (x86)\Jenkins\workspace\Stone.Base.API&#39;. Tried 3 times (of a maximum of 3) waiting 0.1 秒 between attempts." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/5a7e871c0c552669a6ea360baa990c09/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-07-08T08:24:00+08:00" />
<meta property="article:modified_time" content="2019-07-08T08:24:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">使用Jenkins部署.Net Core遇到的几个坑</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div id="cnblogs_post_body" class="blogpost-body"> 
 <blockquote> 
  <p class="ql-long-13832613">搞过CI/CD的同学一定吃过不少苦头，或者说遇到不少坑，但是对自动化的执着住挡不了前进的步伐，如果你缺少了运维这一块知识，那么你的流水线总是不那么完美，本文记录的是自己躺过的坑，希望对你有所帮助。</p> 
 </blockquote> 
 <h2 class="ql-long-13832613"><span class="ql-author-13832613">一、相关环境和版本</span></h2> 
 <ul><li><span class="ql-author-13832613">服务器：windows2008【历史遗留服务器，建议升级到2012以上，2016支持Windows的容器化技术】</span></li><li><span class="ql-author-13832613">源代码管理：git</span></li><li><span class="ql-author-13832613">.net core版本：net core 2.2</span></li></ul> 
 <p><span class="ql-author-13832613">　　这里最应该注意的是操作系统版本和Jenkins的版本，不同的版本，特别是操作系统操作的shell可能千差万别，你会在网上看到各种命令，所以选择好自己的环境。</span></p> 
 <p class="ql-long-13832613"><a class="ql-link ql-author-13832613" href="https://jenkins.io/zh/" rel="nofollow">安装Jenkins</a><span class="ql-author-13832613">比较简单，这里略过……</span></p> 
 <h2 class="ql-long-13832613"><span class="ql-author-13832613">二、Jenkins相关配置</span></h2> 
 <p class="ql-long-13832613"><strong class="ql-author-13832613">Step1.创建一个自由风格的Jenkins项目，这一步比较简单略过（pipeline项目是一项更加挑战，也许运维高手更需要熟悉，这里跳过）</strong></p> 
 <div class="ql-long-13832613"> 
  <strong class="ql-author-13832613">Step2.在</strong> 
  <strong class="ql-author-13832613 ql-size-14">配置git</strong> 
  <strong class="ql-author-13832613">源码路径的时候报错：</strong> 
 </div> 
 <p class="ql-long-13832613"><span class="ql-author-13832613"> <img src="https://images2.imgbox.com/09/b9/scYXJQNb_o.png" alt="" width="786"></span></p> 
 <p class="ql-long-13832613"><strong class="ql-author-13832613">解决方法</strong><span class="ql-author-13832613">：</span></p> 
 <p class="ql-long-13832613"><span class="ql-author-13832613">1.安装git client插件，并重启jenkins</span></p> 
 <p class="ql-long-13832613"><span class="ql-author-13832613">2.确保安装jenkins的服务器同时也安装了git，并在jenkins上配置git的路径，如下图：</span></p> 
 <p class="ql-long-13832613"><span class="ql-author-13832613"> <img src="https://images2.imgbox.com/a4/09/qAN7HNAT_o.png" alt="" width="776"></span></p> 
 <p class="ql-long-13832613"><span class="ql-author-13832613">3.成功配置git源码路径</span></p> 
 <p class="ql-long-13832613"><span class="ql-author-13832613"> <img src="https://images2.imgbox.com/24/28/CIjylWl8_o.png" alt="" width="780"></span></p> 
 <p> </p> 
 <p class="ql-long-13832613"><strong class="ql-author-13832613">Step3.构建时候报错：</strong></p> 
 <p class="ql-long-13832613"><span class="ql-author-13832613"> <img src="https://images2.imgbox.com/ed/dd/vqttZuc1_o.png" alt="" width="1153"></span></p> 
 <p class="ql-long-13832613"><span class="ql-author-13832613">从中可以判断，我的邮件还没有配置，所以发送报错……</span></p> 
 <div class="ql-long-13832613"> 
  <strong class="ql-author-13832613">Step4.进行</strong> 
  <strong class="ql-author-13832613 ql-size-14">邮件的配置</strong> 
 </div> 
 <ul><li> <h4><span class="ql-author-13832613">Jenkins内置邮箱功能：</span></h4> </li></ul> 
 <p class="ql-long-13832613"><span class="ql-author-13832613">1.首先配置Jenkins Location</span></p> 
 <p class="ql-long-13832613"><span class="ql-author-13832613">所在路径：Manage Jenkins=》Configure System=&gt;Jenkins Location</span></p> 
 <p class="ql-long-13832613"><span class="ql-author-13832613"> <img src="https://images2.imgbox.com/45/74/HW9uLCMB_o.png" alt="" width="536"></span></p> 
 <p class="ql-long-13832613"><span class="ql-author-13832613">2.配置E-mail Notification如下图所示</span></p> 
 <p class="ql-long-13832613"><span class="ql-author-13832613"> <img src="https://images2.imgbox.com/88/76/DV6DCROW_o.png" alt="" width="636"></span></p> 
 <p class="ql-long-13832613"><span class="ql-author-13832613">3.测试发送成功</span></p> 
 <ul><li> <h4><span class="ql-author-13832613">Email插件：Email Extension</span></h4> </li></ul> 
 <p class="ql-text-indent-1 ql-long-13832613"><span class="ql-author-13832613">插件安装后如下图所示：</span></p> 
 <p class="ql-long-13832613"><span class="ql-author-13832613"> <img src="https://images2.imgbox.com/f4/ec/kiEu6myF_o.png" alt="" width="436"></span></p> 
 <div class="ql-long-13832613"> 
  <span class="ql-author-13832613">step5.构建的坑[该坑最耗时间，最后发现却是最简单]</span> 
 </div> 
 <p class="ql-long-13832613"><strong class="ql-author-13832613">1.请指定项目或解决方案文件。当前工作目录中未包含项目或解决方案文件。</strong></p> 
 <p class="ql-long-13832613"><span class="ql-author-13832613"> <img src="https://images2.imgbox.com/33/e8/AVSwE9MS_o.png" alt="" width="724"></span></p> 
 <p class="ql-long-13832613"><span class="ql-author-13832613">排查：切换到服务器cmd下进行restore后发现，原来是nuget作怪，因为服务器无法找到部署在本地服务器的nuget包</span></p> 
 <p class="ql-long-13832613"><span class="ql-author-13832613"> <img src="https://images2.imgbox.com/12/d9/rNOY4QCY_o.png" alt="" width="650"></span></p> 
 <div class="ql-long-13832613"> 
  <span class="ql-author-13832613">2.发布Nuget包到官网</span> 
 </div> 
 <p class="ql-long-13832613"><span class="ql-author-13832613">试着解决：试着把nuget包发布到官网。具体如何发布请<a class="ql-link ql-author-13832613" href="https://www.cnblogs.com/stulzq/p/8874426.html" rel="nofollow">跳转</a></span></p> 
 <p class="ql-long-13832613"><span class="ql-author-13832613">新版本的发布需要增加License.txt，否则无法通过，配置如下：其中Licese是从<a class="ql-link ql-author-13832613" href="https://github.com/Nuget/Samples">github</a><span class="ql-author-13832613">上拷贝过来的。<strong class="ql-author-13832613"><span style="text-decoration:underline;">如果你发布后发现代码没有生效，请确认你是否在release下进行编译，并且build过？</span></strong></span></span></p> 
 <p class="ql-long-13832613"><span class="ql-author-13832613"> <img src="https://images2.imgbox.com/ca/54/GNjnRdmF_o.png" alt="" width="676"></span></p> 
 <p> <strong class="ql-author-13832613">解决方法</strong><span class="ql-author-13832613">：如下图所示，极其简单，折腾的半天，晕！你甚至dotnet restore和dotnet build都不用写，因为dotnet publish本身包含restore和build</span></p> 
 <p class="ql-long-13832613"><span class="ql-author-13832613"> <img src="https://images2.imgbox.com/68/ae/vbfDfWJR_o.png" alt="" width="903"></span></p> 
 <div class="ql-long-13832613"> 
  <strong class="ql-author-13832613">Step6.</strong> 
  <span class="ql-author-13832613">卡住在using GIT_ASKPASS to set credentials<strong class="ql-author-13832613">的坑</strong></span> 
 </div> 
 <p class="ql-long-13832613"><span class="ql-author-13832613">Unable to delete 'D:\Program Files (x86)\Jenkins\workspace\Stone.Base.API'. Tried 3 times (of a maximum of 3) waiting 0.1 秒 between attempts.</span></p> 
 <p class="ql-long-13832613"><strong class="ql-author-13832613">解决方法</strong><span class="ql-author-13832613">：关闭配置里的删除功能</span></p> 
 <p class="ql-long-13832613"><span class="ql-author-13832613">6.构建的时候卡住在using GIT_ASKPASS to set credentials </span></p> 
 <p class="ql-long-13832613"><a class="ql-link ql-author-13832613" href="https://dotblogs.com.tw/milkgreenteaprograme_c_sharp/2018/01/09/002251" rel="nofollow"><strong>解决方法</strong></a><a class="ql-link ql-author-13832613" href="https://dotblogs.com.tw/milkgreenteaprograme_c_sharp/2018/01/09/002251" rel="nofollow">：</a></p> 
 <p class="ql-long-13832613"><span class="ql-author-13832613">Step 1:開始 -&gt; 命令提示字元 -&gt; 滑鼠右鍵 -&gt; 以系統管理員身分執行</span></p> 
 <p class="ql-long-13832613"><span class="ql-author-13832613">Step 2: 找出Jenkins Server 的Git 布置位置，可以從自己的Jenkins 錯誤中知道位置在哪裡，以下是第一張圖顯示的Git </span></p> 
 <p class="ql-long-13832613"><span class="ql-author-13832613">Step3: 將命令提示字元(管理者權限) 移動到該位置，輸入cd C:\Program Files\Git\bin 移動到該目錄</span></p> 
 <p class="ql-long-13832613"><span class="ql-author-13832613">Step 4: 輸入 git config --system --unset credential.helper ，按下Enter</span></p> 
 <p class="ql-long-13832613"><span class="ql-author-13832613">Step 5: 再重新建置Jenkins Job 就可以正常運行了</span></p> 
 <div class="ql-long-13832613"> 
  <strong class="ql-author-13832613">Step7.</strong> 
  <span class="ql-author-13832613">无法复制的坑</span> 
 </div> 
 <p class="ql-long-13832613"><span class="ql-author-13832613">现象：无法将“obj\Debug\netcoreapp2.2\Stone.Base.API.dll”复制到“E:\Jacky\WebAPI\Base.API\Stone.Base.API.dll”</span></p> 
 <p class="ql-long-13832613"><span class="ql-author-13832613"> <img src="https://images2.imgbox.com/a4/84/a5S7pBfT_o.png" alt="" width="856"></span></p> 
 <p class="ql-long-13832613"><span class="ql-author-13832613">原因：该站点正在运行，dll被占用，无法进行替换覆盖</span></p> 
 <p class="ql-long-13832613"><strong class="ql-author-13832613">解决方法</strong><span class="ql-author-13832613">：</span></p> 
 <p class="ql-long-13832613">　　目前暂时还没有找到方法，后面再做补充……</p> 
 <div class="ql-long-13832613"> 
  <strong class="ql-author-13832613">Step8.无法删除的坑</strong> 
 </div> 
 <p class="ql-long-13832613"><span class="ql-author-13832613"> <img src="https://images2.imgbox.com/67/30/FOPr0bhr_o.png" alt="" width="934"></span></p> 
 <p class="ql-long-13832613"><span class="ql-author-13832613">原因：该站点正在运行，无法进行替换覆盖</span></p> 
 <p class="ql-long-13832613"><strong class="ql-author-13832613">解决方法</strong><span class="ql-author-13832613">：把<span class="ql-author-13832613">Delete workspace before build starts选项勾去掉，如下图：</span></span></p> 
 <p class="ql-long-13832613"><span class="ql-author-13832613"> <img src="https://images2.imgbox.com/59/1b/B589rKho_o.png" alt="" width="420"></span></p> 
 <h2 class="ql-long-13832613"><span class="ql-author-13832613">三、全自动发布自家类库到</span><span class="ql-author-13832613">Nuget</span><span class="ql-author-13832613">官网或自家服务器</span></h2> 
 <p class="ql-text-indent-1 ql-long-13832613"><span class="ql-author-13832613">　　这里的发布改进了以往的手工发布。从代码上传那一刻开始，jenkins自动到git抓取代码，自动编译打包，然后上传到nuget服务器。</span></p> 
 <p class="ql-text-indent-1 ql-long-13832613"><span class="ql-author-13832613">jenkins配置如下：这里有很多坑，特别是linux和windows很不一样，同学们要留意。配置其实不麻烦，所有的jenkins编译都可以在系统内部自行跑一遍，如果系统能跑通，jenkins绝对没有问题。具体配置如下图所示：</span></p> 
 <p class="ql-text-indent-1 ql-long-13832613"><span class="ql-author-13832613"> <img src="https://images2.imgbox.com/f1/ae/Geamy12g_o.png" alt="" width="1200"></span></p> 
 <div class="cnblogs_code"> 
  <pre>dotnet build <span style="color:#800000;">"</span><span style="color:#800000;">D:\Program Files (x86)\Jenkins\workspace\Stone.Util\UtilLib\Stone.Util</span><span style="color:#800000;">"</span>  -<span style="color:#000000;">c Release


md publish\nuget
md publish\archives


dotnet pack </span><span style="color:#800000;">"</span><span style="color:#800000;">D:\Program Files (x86)\Jenkins\workspace\Stone.Util\UtilLib\Stone.Util</span><span style="color:#800000;">"</span> -c Release -<span style="color:#000000;">o publish\nuget


dotnet nuget push </span><span style="color:#800000;">"</span><span style="color:#800000;">D:\Program Files (x86)\Jenkins\workspace\Stone.Util\UtilLib\Stone.Util\publish\nuget\*.nupkg</span><span style="color:#800000;">"</span> -k {自己key} -s https:<span style="color:#008000;">//</span><span style="color:#008000;">api.nuget.org/v3/index.json</span>
<span style="color:#000000;">

move </span><span style="color:#800000;">"</span><span style="color:#800000;">D:\Program Files (x86)\Jenkins\workspace\Stone.Util\UtilLib\Stone.Util\publish\nuget\*</span><span style="color:#800000;">"</span> <span style="color:#800000;">"</span><span style="color:#800000;">D:\Program Files (x86)\Jenkins\workspace\Stone.Util\UtilLib\Stone.Util\publish\archiv</span></pre> 
 </div> 
 <p> </p> 
 <p class="ql-text-indent-1"><strong>参考文献：</strong></p> 
 <ul><li><a class="ql-link ql-author-13832613" href="https://www.cnblogs.com/stulzq/p/8877652.html" rel="nofollow">.NET Core 从 Github到 Nuget 持续集成、部署</a></li></ul> 
 <h2 class="ql-long-13832613"><span class="ql-author-13832613">四、Jenkins常用插件</span></h2> 
 <ul><li><span class="ql-author-13832613">Green Balls</span></li></ul> 
 <p class="ql-text-indent-1 ql-long-13832613"><span class="ql-author-13832613">该插件让你的感官有了更好的提升，客官请看：</span></p> 
 <p class="ql-text-indent-1 ql-long-13832613"><span class="ql-author-13832613"> <img src="https://images2.imgbox.com/dd/f5/9uUs4loi_o.png" alt="" width="326"></span></p> 
 <p class="ql-text-indent-1 ql-long-13832613"><span class="ql-author-13832613"> <img src="https://images2.imgbox.com/bf/00/o504JfnR_o.png" alt="" width="260"></span></p> 
 <ul><li><span class="ql-author-13832613">Build Monitor View</span></li></ul> 
 <p class="ql-text-indent-1 ql-long-13832613"><span class="ql-author-13832613">非常棒的构建看板，把团队信息透明度提升一个档次，再也不用听到前端开发在问：“有人在构建吗？”，客官请看：</span></p> 
 <p class="ql-text-indent-1 ql-long-13832613"><span class="ql-author-13832613"> <img src="https://images2.imgbox.com/f2/40/wwbm7w6M_o.png" alt="" width="705"></span></p> 
 <h2 class="ql-long-13832613"><span class="ql-author-13832613">五、总结</span></h2> 
 <p><span class="ql-author-13832613">　　jenkins是如此强大，以至于今年来基本上一统CI、CD的江山，他的内容又是如此之多，足够写一本书，感叹所学只不过它的冰山一角。在pipeline项目中，它也支持python等其他脚本语言的流水化作业，功能非常之强大，期待后面的挖掘和丰富……</span></p> 
 <p> </p> 
 <p> </p> 
 <p> </p> 
 <p> </p> 
 <p class="ql-text-indent-1 ql-long-13832613"> </p> 
 <p> </p> 
</div> 
<p>转载于:https://www.cnblogs.com/jackyfei/p/11146353.html</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5414e19e5f1f8359e073f88cdaa89e96/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">C&#43;&#43;实现冒泡排序、选择排序、插入排序、希尔排序、堆排序、归并排序、快速排序</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9e66f6c5023f6c968c17db0a23d1699a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">用于图像分类的经典的卷积神经网络CNN</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>