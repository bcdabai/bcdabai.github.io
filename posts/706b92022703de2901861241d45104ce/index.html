<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>K8s Kubectl基础命令的使用、滚动更新、以及回滚操作 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="K8s Kubectl基础命令的使用、滚动更新、以及回滚操作" />
<meta property="og:description" content="Kubectl基础命令的使用 kubernetes基本概念kubectl管理命令kubectl帮助 Kubectl常用命令的使用explaineditscaleautoscalecluster-infocordonuncordondescribelogsattachexecprot-forwardcplabelapi-resourcesapi-versionsversion使用deployment控制器部署镜像 滚动更新、回滚用Dockerfile编写两个镜像滚动更新、回滚 kubernetes基本概念 Pod：k8s最小部署单元，一组容器的集合
Deployment：最常见的控制器，用于更高级别部署和管理Pod
Service：为一组Pod提供负载均衡，对外提供统一访问入口
Label：标签，附加到某个资源上，用于关联对象、查询和筛选
Namespaces：命名空间。将对象逻辑上隔离，也利于权限控制
kubectl管理命令 类型命令描述基础命令create
expose
run
expose
set
explain
get edit
delete通过文件名或标准输入创建资源； 为Deployment，Pod创建Service；
在集群中运行一个特定的镜像；
在对象上设置特定的功能； 文档参考资料；
显示一个或多个资源； 使用系统编辑器编辑一个资源；
通过文件名，标准输入，资源名称或标签选择器来删除资源部署命令rollout
rolling-update
scale
autoscale管理Deployment，Daemonset资源的发布(例如状态、发布记录、回滚等)； 滚动升级，仅限ReplicationController；
对Deployment、ReplicaSet、RC或Job资源扩容或缩容Pod数量； 为Deploy，RS，RC配置自动伸缩规则(依赖metrics-server和hpa)集群管理命令certificate cluster-info top cordon uncordon drain
taint修改证书资源;
显示集群信息; 查看资源利用率(依赖metrics-server); 标记节点不可调度;
标记节点可调度; 驱逐节点上的应用，准备下线维护;
修改节点taint标记 kubectl帮助 kubectl命令官方文档
用kubectl help可以查看kubectl相关的命令
[root@master ~]# kubectl --help kubectl controls the Kubernetes cluster manager. Find more information at: https://kubernetes.io/docs/reference/kubectl/overview/ Basic Commands (Beginner): create Create a resource from a file or from stdin." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/706b92022703de2901861241d45104ce/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-12-20T23:43:42+08:00" />
<meta property="article:modified_time" content="2021-12-20T23:43:42+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">K8s Kubectl基础命令的使用、滚动更新、以及回滚操作</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night-eighties">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>Kubectl基础命令的使用</h4> 
 <ul><li><a href="#kubernetes_1" rel="nofollow">kubernetes基本概念</a></li><li><ul><li><a href="#kubectl_12" rel="nofollow">kubectl管理命令</a></li><li><a href="#kubectl_18" rel="nofollow">kubectl帮助</a></li></ul> 
  </li><li><a href="#Kubectl_85" rel="nofollow">Kubectl常用命令的使用</a></li><li><ul><li><a href="#explain_86" rel="nofollow">explain</a></li><li><a href="#edit_127" rel="nofollow">edit</a></li><li><a href="#scale_168" rel="nofollow">scale</a></li><li><a href="#autoscale_191" rel="nofollow">autoscale</a></li><li><a href="#clusterinfo_215" rel="nofollow">cluster-info</a></li><li><a href="#cordon_225" rel="nofollow">cordon</a></li><li><a href="#uncordon_250" rel="nofollow">uncordon</a></li><li><a href="#describe_278" rel="nofollow">describe</a></li><li><a href="#logs_295" rel="nofollow">logs</a></li><li><a href="#attach_344" rel="nofollow">attach</a></li><li><a href="#exec_357" rel="nofollow">exec</a></li><li><a href="#protforward_377" rel="nofollow">prot-forward</a></li><li><a href="#cp_451" rel="nofollow">cp</a></li><li><a href="#label_473" rel="nofollow">label</a></li><li><a href="#apiresources_520" rel="nofollow">api-resources</a></li><li><a href="#apiversions_537" rel="nofollow">api-versions</a></li><li><a href="#version_580" rel="nofollow">version</a></li><li><a href="#deployment_589" rel="nofollow">使用deployment控制器部署镜像</a></li></ul> 
  </li><li><a href="#_676" rel="nofollow">滚动更新、回滚</a></li><li><ul><li><a href="#Dockerfile_677" rel="nofollow">用Dockerfile编写两个镜像</a></li><li><a href="#_750" rel="nofollow">滚动更新、回滚</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="kubernetes_1"></a>kubernetes基本概念</h2> 
<ul><li> <p>Pod：k8s最小部署单元，一组容器的集合</p> </li><li> <p>Deployment：最常见的控制器，用于更高级别部署和管理Pod</p> </li><li> <p>Service：为一组Pod提供负载均衡，对外提供统一访问入口</p> </li><li> <p>Label：标签，附加到某个资源上，用于关联对象、查询和筛选</p> </li><li> <p>Namespaces：命名空间。将对象逻辑上隔离，也利于权限控制</p> </li></ul> 
<h3><a id="kubectl_12"></a>kubectl管理命令</h3> 
<table><thead><tr><th>类型</th><th align="left">命令</th><th align="left">描述</th></tr></thead><tbody><tr><td>基础命令</td><td align="left">create<br> expose<br> run<br> expose<br>set<br> explain<br> get <br>edit<br> delete</td><td align="left">通过文件名或标准输入创建资源； <br>为Deployment，Pod创建Service；<br> 在集群中运行一个特定的镜像；<br> 在对象上设置特定的功能； <br>文档参考资料；<br> 显示一个或多个资源； <br>使用系统编辑器编辑一个资源；<br> 通过文件名，标准输入，资源名称或标签选择器来删除资源</td></tr><tr><td>部署命令</td><td align="left">rollout<br> rolling-update<br> scale<br> autoscale</td><td align="left">管理Deployment，Daemonset资源的发布(例如状态、发布记录、回滚等)； <br>滚动升级，仅限ReplicationController；<br> 对Deployment、ReplicaSet、RC或Job资源扩容或缩容Pod数量； <br>为Deploy，RS，RC配置自动伸缩规则(依赖metrics-server和hpa)</td></tr><tr><td>集群管理命令</td><td align="left">certificate <br>cluster-info <br>top <br>cordon <br>uncordon drain<br> taint</td><td align="left">修改证书资源;<br>显示集群信息; <br>查看资源利用率(依赖metrics-server); <br>标记节点不可调度;<br> 标记节点可调度; <br>驱逐节点上的应用，准备下线维护;<br> 修改节点taint标记</td></tr></tbody></table> 
<h3><a id="kubectl_18"></a>kubectl帮助</h3> 
<p><a href="https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands" rel="nofollow">kubectl命令官方文档</a><br> 用kubectl help可以查看kubectl相关的命令</p> 
<pre><code class="prism language-python"><span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl --help</span>
kubectl controls the Kubernetes cluster manager<span class="token punctuation">.</span>
 
Find more information at<span class="token punctuation">:</span> https<span class="token punctuation">:</span><span class="token operator">//</span>kubernetes<span class="token punctuation">.</span>io<span class="token operator">/</span>docs<span class="token operator">/</span>reference<span class="token operator">/</span>kubectl<span class="token operator">/</span>overview<span class="token operator">/</span>
 
Basic Commands <span class="token punctuation">(</span>Beginner<span class="token punctuation">)</span><span class="token punctuation">:</span>
  create         Create a resource <span class="token keyword">from</span> a <span class="token builtin">file</span> <span class="token keyword">or</span> <span class="token keyword">from</span> stdin<span class="token punctuation">.</span>
  expose         使用 replication controller<span class="token punctuation">,</span> service<span class="token punctuation">,</span> deployment 或者 pod 并暴露它作为一个新的Kubernetes Service
  run            在集群中运行一个指定的镜像
  <span class="token builtin">set</span>            为 objects 设置一个指定的特征
 
Basic Commands <span class="token punctuation">(</span>Intermediate<span class="token punctuation">)</span><span class="token punctuation">:</span>
  explain        查看资源的文档
  get            显示一个或更多 resources
  edit           在服务器上编辑一个资源
  delete         Delete resources by filenames<span class="token punctuation">,</span> stdin<span class="token punctuation">,</span> resources <span class="token keyword">and</span> names<span class="token punctuation">,</span> <span class="token keyword">or</span> by resources <span class="token keyword">and</span> label selector
 
Deploy Commands<span class="token punctuation">:</span>
  rollout        Manage the rollout of a resource
  scale          为 Deployment<span class="token punctuation">,</span> ReplicaSet<span class="token punctuation">,</span> Replication Controller 或者 Job 设置一个新的副本数量
  autoscale      自动调整一个 Deployment<span class="token punctuation">,</span> ReplicaSet<span class="token punctuation">,</span> 或者 ReplicationController 的副本数量
 
Cluster Management Commands<span class="token punctuation">:</span>
  certificate    修改 certificate 资源<span class="token punctuation">.</span>
  cluster<span class="token operator">-</span>info   显示集群信息
  top            Display Resource <span class="token punctuation">(</span>CPU<span class="token operator">/</span>Memory<span class="token operator">/</span>Storage<span class="token punctuation">)</span> usage<span class="token punctuation">.</span>
  cordon         标记 node 为 unschedulable
  uncordon       标记 node 为 schedulable
  drain          Drain node <span class="token keyword">in</span> preparation <span class="token keyword">for</span> maintenance
  taint          更新一个或者多个 node 上的 taints
 
Troubleshooting <span class="token keyword">and</span> Debugging Commands<span class="token punctuation">:</span>
  describe       显示一个指定 resource 或者 group 的 resources 详情
  logs           输出容器在 pod 中的日志
  attach         Attach 到一个运行中的 container
  <span class="token keyword">exec</span>           在一个 container 中执行一个命令
  port<span class="token operator">-</span>forward   Forward one <span class="token keyword">or</span> more local ports to a pod
  proxy          运行一个 proxy 到 Kubernetes API server
  cp             复制 files 和 directories 到 containers 和从容器中复制 files 和 directories<span class="token punctuation">.</span>
  auth           Inspect authorization
 
Advanced Commands<span class="token punctuation">:</span>
  diff           Diff live version against would<span class="token operator">-</span>be applied version
  <span class="token builtin">apply</span>          通过文件名或标准输入流<span class="token punctuation">(</span>stdin<span class="token punctuation">)</span>对资源进行配置
  patch          使用 strategic merge patch 更新一个资源的 field<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
  replace        通过 filename 或者 stdin替换一个资源
  wait           Experimental<span class="token punctuation">:</span> Wait <span class="token keyword">for</span> a specific condition on one <span class="token keyword">or</span> many resources<span class="token punctuation">.</span>
  convert        在不同的 API versions 转换配置文件
 
Settings Commands<span class="token punctuation">:</span>
  label          更新在这个资源上的 labels
  annotate       更新一个资源的注解
  completion     Output shell completion code <span class="token keyword">for</span> the specified shell <span class="token punctuation">(</span>bash <span class="token keyword">or</span> zsh<span class="token punctuation">)</span>
 
Other Commands<span class="token punctuation">:</span>
  alpha         Commands <span class="token keyword">for</span> features <span class="token keyword">in</span> alpha
  api<span class="token operator">-</span>resources  Print the supported API resources on the server
  api<span class="token operator">-</span>versions   Print the supported API versions on the server<span class="token punctuation">,</span> <span class="token keyword">in</span> the form of <span class="token string">"group/version"</span>
  config         修改 kubeconfig 文件
  plugin         Provides utilities <span class="token keyword">for</span> interacting <span class="token keyword">with</span> plugins<span class="token punctuation">.</span>
  version        输出 client 和 server 的版本信息
</code></pre> 
<h2><a id="Kubectl_85"></a>Kubectl常用命令的使用</h2> 
<h3><a id="explain_86"></a>explain</h3> 
<p>获取资源</p> 
<pre><code class="prism language-python">用法：
kubectl explain RESOURCE

<span class="token operator">//</span>获取资源及其字段的文档
<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl explain pods</span>
KIND<span class="token punctuation">:</span>     Pod
VERSION<span class="token punctuation">:</span>  v1

DESCRIPTION<span class="token punctuation">:</span>
     Pod <span class="token keyword">is</span> a collection of containers that can run on a host<span class="token punctuation">.</span> This resource <span class="token keyword">is</span>
     created by clients <span class="token keyword">and</span> scheduled onto hosts<span class="token punctuation">.</span>

FIELDS<span class="token punctuation">:</span>
   apiVersion   <span class="token operator">&lt;</span>string<span class="token operator">&gt;</span>
     APIVersion defines the versioned schema of this representation of an
     <span class="token builtin">object</span><span class="token punctuation">.</span> Servers should convert recognized schemas to the latest internal
     value<span class="token punctuation">,</span> <span class="token keyword">and</span> may reject unrecognized values<span class="token punctuation">.</span> More info<span class="token punctuation">:</span>
     https<span class="token punctuation">:</span><span class="token operator">//</span>git<span class="token punctuation">.</span>k8s<span class="token punctuation">.</span>io<span class="token operator">/</span>community<span class="token operator">/</span>contributors<span class="token operator">/</span>devel<span class="token operator">/</span>sig<span class="token operator">-</span>architecture<span class="token operator">/</span>api<span class="token operator">-</span>conventions<span class="token punctuation">.</span>md<span class="token comment">#resources</span>

   kind <span class="token operator">&lt;</span>string<span class="token operator">&gt;</span>
     Kind <span class="token keyword">is</span> a string value representing the REST resource this <span class="token builtin">object</span>
     represents<span class="token punctuation">.</span> Servers may infer this <span class="token keyword">from</span> the endpoint the client submits
     requests to<span class="token punctuation">.</span> Cannot be updated<span class="token punctuation">.</span> In CamelCase<span class="token punctuation">.</span> More info<span class="token punctuation">:</span>
     https<span class="token punctuation">:</span><span class="token operator">//</span>git<span class="token punctuation">.</span>k8s<span class="token punctuation">.</span>io<span class="token operator">/</span>community<span class="token operator">/</span>contributors<span class="token operator">/</span>devel<span class="token operator">/</span>sig<span class="token operator">-</span>architecture<span class="token operator">/</span>api<span class="token operator">-</span>conventions<span class="token punctuation">.</span>md<span class="token comment">#types-kinds</span>

   metadata     <span class="token operator">&lt;</span>Object<span class="token operator">&gt;</span>
     Standard <span class="token builtin">object</span>'s metadata<span class="token punctuation">.</span> More info<span class="token punctuation">:</span>
     https<span class="token punctuation">:</span><span class="token operator">//</span>git<span class="token punctuation">.</span>k8s<span class="token punctuation">.</span>io<span class="token operator">/</span>community<span class="token operator">/</span>contributors<span class="token operator">/</span>devel<span class="token operator">/</span>sig<span class="token operator">-</span>architecture<span class="token operator">/</span>api<span class="token operator">-</span>conventions<span class="token punctuation">.</span>md<span class="token comment">#metadata</span>

   spec <span class="token operator">&lt;</span>Object<span class="token operator">&gt;</span>
     Specification of the desired behavior of the pod<span class="token punctuation">.</span> More info<span class="token punctuation">:</span>
     https<span class="token punctuation">:</span><span class="token operator">//</span>git<span class="token punctuation">.</span>k8s<span class="token punctuation">.</span>io<span class="token operator">/</span>community<span class="token operator">/</span>contributors<span class="token operator">/</span>devel<span class="token operator">/</span>sig<span class="token operator">-</span>architecture<span class="token operator">/</span>api<span class="token operator">-</span>conventions<span class="token punctuation">.</span>md<span class="token comment">#spec-and-status</span>

   status       <span class="token operator">&lt;</span>Object<span class="token operator">&gt;</span>
     Most recently observed status of the pod<span class="token punctuation">.</span> This data may <span class="token keyword">not</span> be up to date<span class="token punctuation">.</span>
     Populated by the system<span class="token punctuation">.</span> Read<span class="token operator">-</span>only<span class="token punctuation">.</span> More info<span class="token punctuation">:</span>
     https<span class="token punctuation">:</span><span class="token operator">//</span>git<span class="token punctuation">.</span>k8s<span class="token punctuation">.</span>io<span class="token operator">/</span>community<span class="token operator">/</span>contributors<span class="token operator">/</span>devel<span class="token operator">/</span>sig<span class="token operator">-</span>architecture<span class="token operator">/</span>api<span class="token operator">-</span>conventions<span class="token punctuation">.</span>md<span class="token comment">#spec-and-status</span>
</code></pre> 
<h3><a id="edit_127"></a>edit</h3> 
<p>编辑资源</p> 
<pre><code class="prism language-python"><span class="token operator">//</span>运行一个pod类型的nginx，名字叫nginx<span class="token punctuation">,</span>内型是deployment
<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl create deployment nginx --image nginx </span>
deployment<span class="token punctuation">.</span>apps<span class="token operator">/</span>nginx created
<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl get pod</span>
NAME                     READY   STATUS              RESTARTS   AGE
nginx<span class="token operator">-</span><span class="token number">6799fc88d8</span><span class="token operator">-</span>cpbg4   <span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span>     ContainerCreating   <span class="token number">0</span>          10s


<span class="token operator">//</span>使用edit命令编辑
<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl edit deployment nginx</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
kind<span class="token punctuation">:</span> Deployment
metadata<span class="token punctuation">:</span>
  annotations<span class="token punctuation">:</span>
    deployment<span class="token punctuation">.</span>kubernetes<span class="token punctuation">.</span>io<span class="token operator">/</span>revision<span class="token punctuation">:</span> <span class="token string">"1"</span>
  creationTimestamp<span class="token punctuation">:</span> <span class="token string">"2021-12-20T10:33:49Z"</span>
  generation<span class="token punctuation">:</span> <span class="token number">1</span>
  labels<span class="token punctuation">:</span>
    app<span class="token punctuation">:</span> nginx
    name<span class="token punctuation">:</span> jjyy	<span class="token comment">#添加name: jjyy</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token operator">//</span>查看
<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl describe deploy nginx</span>
Name<span class="token punctuation">:</span>                   nginx
Namespace<span class="token punctuation">:</span>              default
CreationTimestamp<span class="token punctuation">:</span>      Mon<span class="token punctuation">,</span> <span class="token number">20</span> Dec <span class="token number">2021</span> <span class="token number">18</span><span class="token punctuation">:</span><span class="token number">33</span><span class="token punctuation">:</span><span class="token number">49</span> <span class="token operator">+</span><span class="token number">0800</span>
Labels<span class="token punctuation">:</span>                 app<span class="token operator">=</span>nginx
                        name<span class="token operator">=</span>jjyy
Annotations<span class="token punctuation">:</span>            deployment<span class="token punctuation">.</span>kubernetes<span class="token punctuation">.</span>io<span class="token operator">/</span>revision<span class="token punctuation">:</span> <span class="token number">1</span>
Selector<span class="token punctuation">:</span>               app<span class="token operator">=</span>nginx
Replicas<span class="token punctuation">:</span>               <span class="token number">1</span> desired <span class="token operator">|</span> <span class="token number">1</span> updated <span class="token operator">|</span> <span class="token number">1</span> total <span class="token operator">|</span> <span class="token number">1</span> available <span class="token operator">|</span> <span class="token number">0</span> unavailable
StrategyType<span class="token punctuation">:</span>           RollingUpdate
MinReadySeconds<span class="token punctuation">:</span>        <span class="token number">0</span>
RollingUpdateStrategy<span class="token punctuation">:</span>  <span class="token number">25</span><span class="token operator">%</span> <span class="token builtin">max</span> unavailable<span class="token punctuation">,</span> <span class="token number">25</span><span class="token operator">%</span> <span class="token builtin">max</span> surge
Pod Template<span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre> 
<h3><a id="scale_168"></a>scale</h3> 
<p>动态扩展</p> 
<pre><code class="prism language-python"><span class="token operator">//</span>使用scale扩展
<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl scale deployment/nginx --replicas 3</span>
deployment<span class="token punctuation">.</span>apps<span class="token operator">/</span>nginx scaled
<span class="token operator">//</span>扩展后查看多了几个相同类型的pod
<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl get pod</span>
NAME                     READY   STATUS    RESTARTS   AGE
nginx<span class="token operator">-</span><span class="token number">6799fc88d8</span><span class="token operator">-</span>8bnn8   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          37s
nginx<span class="token operator">-</span><span class="token number">6799fc88d8</span><span class="token operator">-</span>cpbg4   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          15m
nginx<span class="token operator">-</span><span class="token number">6799fc88d8</span><span class="token operator">-</span>t6vpw   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          37s

<span class="token operator">//</span>如果只需要<span class="token number">2</span>个deployment类型的nginx的pod
<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl scale deployment/nginx --replicas 2</span>
deployment<span class="token punctuation">.</span>apps<span class="token operator">/</span>nginx scaled
<span class="token operator">//</span>查看发现只有两个（删除是随机的）
<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl get pod</span>
NAME                     READY   STATUS    RESTARTS   AGE
nginx<span class="token operator">-</span><span class="token number">6799fc88d8</span><span class="token operator">-</span>8bnn8   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          3m22s
nginx<span class="token operator">-</span><span class="token number">6799fc88d8</span><span class="token operator">-</span>cpbg4   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          18m
</code></pre> 
<h3><a id="autoscale_191"></a>autoscale</h3> 
<p>自动扩展，给定一个范围，自动根据业务的访问量增加或减少</p> 
<pre><code class="prism language-python"><span class="token operator">//</span>最少<span class="token number">3</span>个，当不满足条件时会自动创建
<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl autoscale deployment/nginx --min 3 --max=5</span>
horizontalpodautoscaler<span class="token punctuation">.</span>autoscaling<span class="token operator">/</span>nginx autoscaled
<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl get pod</span>
NAME                     READY   STATUS              RESTARTS   AGE
nginx<span class="token operator">-</span><span class="token number">6799fc88d8</span><span class="token operator">-</span>8bnn8   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running             <span class="token number">0</span>          8m1s
nginx<span class="token operator">-</span><span class="token number">6799fc88d8</span><span class="token operator">-</span>cpbg4   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running             <span class="token number">0</span>          23m
nginx<span class="token operator">-</span><span class="token number">6799fc88d8</span><span class="token operator">-</span>ctjmt   <span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span>     ContainerCreating   <span class="token number">0</span>          4s

<span class="token operator">//</span>当大于<span class="token number">5</span>个时，先创建，之后也会随机删除，直到满足条件五个
<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl scale deployment/nginx --replicas 7</span>
deployment<span class="token punctuation">.</span>apps<span class="token operator">/</span>nginx scaled
<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl get pod</span>
NAME                     READY   STATUS        RESTARTS   AGE
nginx<span class="token operator">-</span><span class="token number">6799fc88d8</span><span class="token operator">-</span>84mfw   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running       <span class="token number">0</span>          52s
nginx<span class="token operator">-</span><span class="token number">6799fc88d8</span><span class="token operator">-</span>8bnn8   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running       <span class="token number">0</span>          20m
nginx<span class="token operator">-</span><span class="token number">6799fc88d8</span><span class="token operator">-</span>cpbg4   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running       <span class="token number">0</span>          35m
nginx<span class="token operator">-</span><span class="token number">6799fc88d8</span><span class="token operator">-</span>ctjmt   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running       <span class="token number">0</span>          12m
nginx<span class="token operator">-</span><span class="token number">6799fc88d8</span><span class="token operator">-</span>rf74m   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running       <span class="token number">0</span>          52s
</code></pre> 
<h3><a id="clusterinfo_215"></a>cluster-info</h3> 
<p>显示集群信息</p> 
<pre><code class="prism language-python"><span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl cluster-info</span>
Kubernetes control plane <span class="token keyword">is</span> running at https<span class="token punctuation">:</span><span class="token operator">//</span><span class="token number">192.168</span><span class="token number">.129</span><span class="token number">.250</span><span class="token punctuation">:</span><span class="token number">6443</span>
KubeDNS <span class="token keyword">is</span> running at https<span class="token punctuation">:</span><span class="token operator">//</span><span class="token number">192.168</span><span class="token number">.129</span><span class="token number">.250</span><span class="token punctuation">:</span><span class="token number">6443</span><span class="token operator">/</span>api<span class="token operator">/</span>v1<span class="token operator">/</span>namespaces<span class="token operator">/</span>kube<span class="token operator">-</span>system<span class="token operator">/</span>services<span class="token operator">/</span>kube<span class="token operator">-</span>dns<span class="token punctuation">:</span>dns<span class="token operator">/</span>proxy

To further debug <span class="token keyword">and</span> diagnose cluster problems<span class="token punctuation">,</span> use <span class="token string">'kubectl cluster-info dump'</span><span class="token punctuation">.</span>
</code></pre> 
<h3><a id="cordon_225"></a>cordon</h3> 
<p>可调度</p> 
<pre><code class="prism language-python"><span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl cordon node2</span>
node<span class="token operator">/</span>node2 already cordoned
<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl get node</span>
NAME     STATUS                     ROLES                  AGE    VERSION
master   Ready                      control<span class="token operator">-</span>plane<span class="token punctuation">,</span>master   2d4h   v1<span class="token punctuation">.</span><span class="token number">20.0</span>
node1    NotReady                   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>                 2d4h   v1<span class="token punctuation">.</span><span class="token number">20.0</span>
node2    Ready<span class="token punctuation">,</span>SchedulingDisabled   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>                 2d4h   v1<span class="token punctuation">.</span><span class="token number">20.0</span>
<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl get pod -o wide</span>
NAME                     READY   STATUS    RESTARTS   AGE    IP            NODE    NOMINATED NODE   READINESS GATES
nginx<span class="token operator">-</span><span class="token number">6799fc88d8</span><span class="token operator">-</span>cpbg4   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          132m   <span class="token number">10.244</span><span class="token number">.1</span><span class="token number">.24</span>   node1   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
nginx<span class="token operator">-</span><span class="token number">6799fc88d8</span><span class="token operator">-</span>plvhf   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          95m    <span class="token number">10.244</span><span class="token number">.1</span><span class="token number">.31</span>   node1   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
nginx<span class="token operator">-</span><span class="token number">6799fc88d8</span><span class="token operator">-</span>rf74m   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">1</span>          97m    <span class="token number">10.244</span><span class="token number">.2</span><span class="token number">.4</span>    node2   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>  

<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl scale deployment/nginx --replicas 2</span>
<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl get pod -o wide</span>
NAME                     READY   STATUS        RESTARTS   AGE     IP            NODE     NOMINATED NODE   READINESS GATES
nginx<span class="token operator">-</span><span class="token number">6799fc88d8</span><span class="token operator">-</span>9wk4h   <span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span>     Pending       <span class="token number">0</span>          3m46s   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
nginx<span class="token operator">-</span><span class="token number">6799fc88d8</span><span class="token operator">-</span>rf74m   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running       <span class="token number">1</span>          103m    <span class="token number">10.244</span><span class="token number">.2</span><span class="token number">.4</span>    node2    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
nginx<span class="token operator">-</span><span class="token number">6799fc88d8</span><span class="token operator">-</span>snm2v   <span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span>     Pending       <span class="token number">0</span>          16s     <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span> 
</code></pre> 
<h3><a id="uncordon_250"></a>uncordon</h3> 
<p>不可调度</p> 
<pre><code class="prism language-python"><span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl uncordon node2</span>
node<span class="token operator">/</span>node2 uncordoned
<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl get node</span>
NAME     STATUS     ROLES                  AGE    VERSION
master   Ready      control<span class="token operator">-</span>plane<span class="token punctuation">,</span>master   2d4h   v1<span class="token punctuation">.</span><span class="token number">20.0</span>
node1    NotReady   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>                 2d4h   v1<span class="token punctuation">.</span><span class="token number">20.0</span>
node2    Ready      <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>                 2d4h   v1<span class="token punctuation">.</span><span class="token number">20.0</span>

<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl create deployment nginx2  --image nginx</span>
deployment<span class="token punctuation">.</span>apps<span class="token operator">/</span>nginx2 created
<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl get pod</span>
NAME                      READY   STATUS        RESTARTS   AGE
nginx<span class="token operator">-</span><span class="token number">6799fc88d8</span><span class="token operator">-</span>9wk4h    <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running       <span class="token number">0</span>          8m22s
nginx<span class="token operator">-</span><span class="token number">6799fc88d8</span><span class="token operator">-</span>rf74m    <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running       <span class="token number">1</span>          108m
nginx<span class="token operator">-</span><span class="token number">6799fc88d8</span><span class="token operator">-</span>snm2v    <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running       <span class="token number">0</span>          4m52s
nginx2<span class="token operator">-</span><span class="token number">5fc4444698</span><span class="token operator">-</span>bf76p   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running       <span class="token number">0</span>          25s
<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl get pod -o wide</span>
NAME                      READY   STATUS        RESTARTS   AGE     IP            NODE    NOMINATED NODE   READINESS GATES
nginx<span class="token operator">-</span><span class="token number">6799fc88d8</span><span class="token operator">-</span>9wk4h    <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running       <span class="token number">0</span>          8m59s   <span class="token number">10.244</span><span class="token number">.2</span><span class="token number">.5</span>    node2   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
nginx<span class="token operator">-</span><span class="token number">6799fc88d8</span><span class="token operator">-</span>rf74m    <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running       <span class="token number">1</span>          109m    <span class="token number">10.244</span><span class="token number">.2</span><span class="token number">.4</span>    node2   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
nginx<span class="token operator">-</span><span class="token number">6799fc88d8</span><span class="token operator">-</span>snm2v    <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running       <span class="token number">0</span>          5m29s   <span class="token number">10.244</span><span class="token number">.2</span><span class="token number">.6</span>    node2   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
nginx2<span class="token operator">-</span><span class="token number">5fc4444698</span><span class="token operator">-</span>bf76p   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running       <span class="token number">0</span>          62s     <span class="token number">10.244</span><span class="token number">.2</span><span class="token number">.7</span>    node2   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
</code></pre> 
<h3><a id="describe_278"></a>describe</h3> 
<p>显示指定pod的详细信息</p> 
<pre><code class="prism language-python"><span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl describe pod nginx</span>
Name<span class="token punctuation">:</span>         nginx<span class="token operator">-</span><span class="token number">6799fc88d8</span><span class="token operator">-</span>cpbg4
Namespace<span class="token punctuation">:</span>    default
Priority<span class="token punctuation">:</span>     <span class="token number">0</span>
Node<span class="token punctuation">:</span>         node1<span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.129</span><span class="token number">.135</span>
Start Time<span class="token punctuation">:</span>   Mon<span class="token punctuation">,</span> <span class="token number">20</span> Dec <span class="token number">2021</span> <span class="token number">18</span><span class="token punctuation">:</span><span class="token number">33</span><span class="token punctuation">:</span><span class="token number">49</span> <span class="token operator">+</span><span class="token number">0800</span>
Labels<span class="token punctuation">:</span>       app<span class="token operator">=</span>nginx
              pod<span class="token operator">-</span>template<span class="token operator">-</span><span class="token builtin">hash</span><span class="token operator">=</span><span class="token number">6799fc88d8</span>
Annotations<span class="token punctuation">:</span>  <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
Status<span class="token punctuation">:</span>       Running
IP<span class="token punctuation">:</span>           <span class="token number">10.244</span><span class="token number">.1</span><span class="token number">.24</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre> 
<h3><a id="logs_295"></a>logs</h3> 
<p>查看日志</p> 
<pre><code class="prism language-python"><span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl logs deployment/nginx</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token number">2021</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">20</span> <span class="token number">10</span><span class="token punctuation">:</span><span class="token number">34</span><span class="token punctuation">:</span><span class="token number">05</span> <span class="token punctuation">[</span>notice<span class="token punctuation">]</span> <span class="token number">1</span><span class="token comment">#1: start worker processes</span>
<span class="token number">2021</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">20</span> <span class="token number">10</span><span class="token punctuation">:</span><span class="token number">34</span><span class="token punctuation">:</span><span class="token number">05</span> <span class="token punctuation">[</span>notice<span class="token punctuation">]</span> <span class="token number">1</span><span class="token comment">#1: start worker process 32</span>
<span class="token number">2021</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">20</span> <span class="token number">10</span><span class="token punctuation">:</span><span class="token number">34</span><span class="token punctuation">:</span><span class="token number">05</span> <span class="token punctuation">[</span>notice<span class="token punctuation">]</span> <span class="token number">1</span><span class="token comment">#1: start worker process 33</span>
<span class="token operator">/</span>docker<span class="token operator">-</span>entrypoint<span class="token punctuation">.</span>sh<span class="token punctuation">:</span> Configuration complete<span class="token punctuation">;</span> ready <span class="token keyword">for</span> start up

<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl get svc</span>
NAME         TYPE        CLUSTER<span class="token operator">-</span>IP      EXTERNAL<span class="token operator">-</span>IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>    AGE
kubernetes   ClusterIP   <span class="token number">10.96</span><span class="token number">.0</span><span class="token number">.1</span>       <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">443</span><span class="token operator">/</span>TCP    2d4h
nginx        ClusterIP   <span class="token number">10.102</span><span class="token number">.213</span><span class="token number">.63</span>   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">8080</span><span class="token operator">/</span>TCP   24h
<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># curl 10.102.213.63:8080</span>
<span class="token operator">&lt;</span>!DOCTYPE html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>Welcome to nginx!<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>style<span class="token operator">&gt;</span>
html <span class="token punctuation">{<!-- --></span> color<span class="token operator">-</span>scheme<span class="token punctuation">:</span> light dark<span class="token punctuation">;</span> <span class="token punctuation">}</span>
body <span class="token punctuation">{<!-- --></span> width<span class="token punctuation">:</span> 35em<span class="token punctuation">;</span> margin<span class="token punctuation">:</span> <span class="token number">0</span> auto<span class="token punctuation">;</span>
font<span class="token operator">-</span>family<span class="token punctuation">:</span> Tahoma<span class="token punctuation">,</span> Verdana<span class="token punctuation">,</span> Arial<span class="token punctuation">,</span> sans<span class="token operator">-</span>serif<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>Welcome to nginx!<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>If you see this page<span class="token punctuation">,</span> the nginx web server <span class="token keyword">is</span> successfully installed <span class="token keyword">and</span>
working<span class="token punctuation">.</span> Further configuration <span class="token keyword">is</span> required<span class="token punctuation">.</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>For online documentation <span class="token keyword">and</span> support please refer to
<span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"http://nginx.org/"</span><span class="token operator">&gt;</span>nginx<span class="token punctuation">.</span>org<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token operator">&lt;</span>br<span class="token operator">/</span><span class="token operator">&gt;</span>
Commercial support <span class="token keyword">is</span> available at
<span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"http://nginx.com/"</span><span class="token operator">&gt;</span>nginx<span class="token punctuation">.</span>com<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token operator">&lt;</span>em<span class="token operator">&gt;</span>Thank you <span class="token keyword">for</span> using nginx<span class="token punctuation">.</span><span class="token operator">&lt;</span><span class="token operator">/</span>em<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span>

<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment">#  kubectl logs deployment/nginx</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token number">2021</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">20</span> <span class="token number">12</span><span class="token punctuation">:</span><span class="token number">44</span><span class="token punctuation">:</span><span class="token number">49</span> <span class="token punctuation">[</span>notice<span class="token punctuation">]</span> <span class="token number">1</span><span class="token comment">#1: start worker processes</span>
<span class="token number">2021</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">20</span> <span class="token number">12</span><span class="token punctuation">:</span><span class="token number">44</span><span class="token punctuation">:</span><span class="token number">49</span> <span class="token punctuation">[</span>notice<span class="token punctuation">]</span> <span class="token number">1</span><span class="token comment">#1: start worker process 31</span>
<span class="token number">2021</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">20</span> <span class="token number">12</span><span class="token punctuation">:</span><span class="token number">44</span><span class="token punctuation">:</span><span class="token number">49</span> <span class="token punctuation">[</span>notice<span class="token punctuation">]</span> <span class="token number">1</span><span class="token comment">#1: start worker process 32</span>
<span class="token number">10.244</span><span class="token number">.0</span><span class="token number">.0</span> <span class="token operator">-</span> <span class="token operator">-</span> <span class="token punctuation">[</span><span class="token number">20</span><span class="token operator">/</span>Dec<span class="token operator">/</span><span class="token number">2021</span><span class="token punctuation">:</span><span class="token number">13</span><span class="token punctuation">:</span><span class="token number">04</span><span class="token punctuation">:</span><span class="token number">14</span> <span class="token operator">+</span><span class="token number">0000</span><span class="token punctuation">]</span> <span class="token string">"GET / HTTP/1.1"</span> <span class="token number">200</span> <span class="token number">615</span> <span class="token string">"-"</span> <span class="token string">"curl/7.61.1"</span> <span class="token string">"-"</span>
<span class="token number">10.244</span><span class="token number">.0</span><span class="token number">.0</span> <span class="token operator">-</span> <span class="token operator">-</span> <span class="token punctuation">[</span><span class="token number">20</span><span class="token operator">/</span>Dec<span class="token operator">/</span><span class="token number">2021</span><span class="token punctuation">:</span><span class="token number">13</span><span class="token punctuation">:</span><span class="token number">05</span><span class="token punctuation">:</span><span class="token number">26</span> <span class="token operator">+</span><span class="token number">0000</span><span class="token punctuation">]</span> <span class="token string">"GET / HTTP/1.1"</span> <span class="token number">200</span> <span class="token number">615</span> <span class="token string">"-"</span> <span class="token string">"curl/7.61.1"</span> <span class="token string">"-"</span>
</code></pre> 
<h3><a id="attach_344"></a>attach</h3> 
<p>附加在一个容器里</p> 
<pre><code class="prism language-python"><span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl get pod</span>
NAME                     READY   STATUS    RESTARTS   AGE
nginx<span class="token operator">-</span><span class="token number">6799fc88d8</span><span class="token operator">-</span>cpbg4   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          43m
nginx<span class="token operator">-</span><span class="token number">6799fc88d8</span><span class="token operator">-</span>plvhf   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          6m38s
nginx<span class="token operator">-</span><span class="token number">6799fc88d8</span><span class="token operator">-</span>rf74m   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          8m57s
<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl attach nginx-6799fc88d8-cpbg4 		</span>
Defaulting container name to nginx<span class="token punctuation">.</span>
Use <span class="token string">'kubectl describe pod/nginx-6799fc88d8-cpbg4 -n default'</span> to see <span class="token builtin">all</span> of the containers <span class="token keyword">in</span> this pod<span class="token punctuation">.</span>
If you don't see a command prompt<span class="token punctuation">,</span> <span class="token keyword">try</span> pressing enter<span class="token punctuation">.</span>
</code></pre> 
<h3><a id="exec_357"></a>exec</h3> 
<p>执行容器命令</p> 
<pre><code class="prism language-python"><span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl get pod</span>
NAME                     READY   STATUS    RESTARTS   AGE
nginx<span class="token operator">-</span><span class="token number">6799fc88d8</span><span class="token operator">-</span>cpbg4   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          45m
nginx<span class="token operator">-</span><span class="token number">6799fc88d8</span><span class="token operator">-</span>plvhf   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          8m2s
nginx<span class="token operator">-</span><span class="token number">6799fc88d8</span><span class="token operator">-</span>rf74m   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          10m

<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl exec nginx-6799fc88d8-cpbg4 -- date</span>
Mon Dec <span class="token number">20</span> <span class="token number">11</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">02</span> UTC <span class="token number">2021</span>

<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl exec -it nginx-6799fc88d8-cpbg4 -- /bin/sh</span>
<span class="token comment"># ls</span>
<span class="token builtin">bin</span>   dev                  docker<span class="token operator">-</span>entrypoint<span class="token punctuation">.</span>sh  home  lib64  mnt  proc  run   srv  tmp  var
boot  docker<span class="token operator">-</span>entrypoint<span class="token punctuation">.</span>d  etc                   lib   media  opt  root  sbin  sys  usr
<span class="token comment"># exit</span>
<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre> 
<h3><a id="protforward_377"></a>prot-forward</h3> 
<p>转发一个或多个端口到pod里面去</p> 
<pre><code class="prism language-python"><span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl get pod</span>
NAME                     READY   STATUS        RESTARTS   AGE
web<span class="token operator">-</span><span class="token number">96d5df5c8</span><span class="token operator">-</span>8fzdv      <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running       <span class="token number">0</span>          17s

<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl port-forward deployment/web 80 	#可以变成':80'（随机一个端口号，只能本机访问）或者变成指定的端口号'8080:80'(本机访问用80，其它主机访问就可以用8080)</span>
Forwarding <span class="token keyword">from</span> <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">:</span><span class="token number">80</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">80</span>
Forwarding <span class="token keyword">from</span> <span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token number">80</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">80</span>

<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># ss -anlt</span>
State          Recv<span class="token operator">-</span>Q          Send<span class="token operator">-</span>Q                     Local Address<span class="token punctuation">:</span>Port                    Peer Address<span class="token punctuation">:</span>Port         
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                        <span class="token number">0.0</span><span class="token number">.0</span><span class="token number">.0</span><span class="token punctuation">:</span><span class="token operator">*</span>            
LISTEN         <span class="token number">0</span>               <span class="token number">128</span>                            <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">:</span><span class="token number">2381</span>                         <span class="token number">0.0</span><span class="token number">.0</span><span class="token number">.0</span><span class="token punctuation">:</span><span class="token operator">*</span>            
LISTEN         <span class="token number">0</span>               <span class="token number">128</span>                            <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">:</span><span class="token number">80</span>                           <span class="token number">0.0</span><span class="token number">.0</span><span class="token number">.0</span><span class="token punctuation">:</span><span class="token operator">*</span>            

<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># curl 127.0.0.1</span>
<span class="token operator">&lt;</span>!DOCTYPE html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>Welcome to nginx!<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>style<span class="token operator">&gt;</span>
html <span class="token punctuation">{<!-- --></span> color<span class="token operator">-</span>scheme<span class="token punctuation">:</span> light dark<span class="token punctuation">;</span> <span class="token punctuation">}</span>
body <span class="token punctuation">{<!-- --></span> width<span class="token punctuation">:</span> 35em<span class="token punctuation">;</span> margin<span class="token punctuation">:</span> <span class="token number">0</span> auto<span class="token punctuation">;</span>
font<span class="token operator">-</span>family<span class="token punctuation">:</span> Tahoma<span class="token punctuation">,</span> Verdana<span class="token punctuation">,</span> Arial<span class="token punctuation">,</span> sans<span class="token operator">-</span>serif<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>Welcome to nginx!<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>If you see this page<span class="token punctuation">,</span> the nginx web server <span class="token keyword">is</span> successfully installed <span class="token keyword">and</span>
working<span class="token punctuation">.</span> Further configuration <span class="token keyword">is</span> required<span class="token punctuation">.</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>For online documentation <span class="token keyword">and</span> support please refer to
<span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"http://nginx.org/"</span><span class="token operator">&gt;</span>nginx<span class="token punctuation">.</span>org<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token operator">&lt;</span>br<span class="token operator">/</span><span class="token operator">&gt;</span>
Commercial support <span class="token keyword">is</span> available at
<span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"http://nginx.com/"</span><span class="token operator">&gt;</span>nginx<span class="token punctuation">.</span>com<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token operator">&lt;</span>em<span class="token operator">&gt;</span>Thank you <span class="token keyword">for</span> using nginx<span class="token punctuation">.</span><span class="token operator">&lt;</span><span class="token operator">/</span>em<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span>

<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl port-forward --address 0.0.0.0 deployment/web 80</span>
Forwarding <span class="token keyword">from</span> <span class="token number">0.0</span><span class="token number">.0</span><span class="token number">.0</span><span class="token punctuation">:</span><span class="token number">80</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">80</span>

<span class="token operator">//</span>允许所有IP访问<span class="token number">80</span>端口
<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># curl 192.168.129.250</span>
<span class="token operator">&lt;</span>!DOCTYPE html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>Welcome to nginx!<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>style<span class="token operator">&gt;</span>
html <span class="token punctuation">{<!-- --></span> color<span class="token operator">-</span>scheme<span class="token punctuation">:</span> light dark<span class="token punctuation">;</span> <span class="token punctuation">}</span>
body <span class="token punctuation">{<!-- --></span> width<span class="token punctuation">:</span> 35em<span class="token punctuation">;</span> margin<span class="token punctuation">:</span> <span class="token number">0</span> auto<span class="token punctuation">;</span>
font<span class="token operator">-</span>family<span class="token punctuation">:</span> Tahoma<span class="token punctuation">,</span> Verdana<span class="token punctuation">,</span> Arial<span class="token punctuation">,</span> sans<span class="token operator">-</span>serif<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>Welcome to nginx!<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>If you see this page<span class="token punctuation">,</span> the nginx web server <span class="token keyword">is</span> successfully installed <span class="token keyword">and</span>
working<span class="token punctuation">.</span> Further configuration <span class="token keyword">is</span> required<span class="token punctuation">.</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>For online documentation <span class="token keyword">and</span> support please refer to
<span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"http://nginx.org/"</span><span class="token operator">&gt;</span>nginx<span class="token punctuation">.</span>org<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token operator">&lt;</span>br<span class="token operator">/</span><span class="token operator">&gt;</span>
Commercial support <span class="token keyword">is</span> available at
<span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"http://nginx.com/"</span><span class="token operator">&gt;</span>nginx<span class="token punctuation">.</span>com<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token operator">&lt;</span>em<span class="token operator">&gt;</span>Thank you <span class="token keyword">for</span> using nginx<span class="token punctuation">.</span><span class="token operator">&lt;</span><span class="token operator">/</span>em<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/a7/e9/FQTcIg13_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="cp_451"></a>cp</h3> 
<p>复制<br> 拷贝文件或目录到容器中，或者从容器内向外拷贝</p> 
<pre><code class="prism language-python"><span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl get pod</span>
NAME                     READY   STATUS        RESTARTS   AGE
nginx<span class="token operator">-</span><span class="token number">6799fc88d8</span><span class="token operator">-</span>cpbg4   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Terminating   <span class="token number">0</span>          3h42m
nginx<span class="token operator">-</span><span class="token number">6799fc88d8</span><span class="token operator">-</span>plvhf   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Terminating   <span class="token number">0</span>          3h5m
web<span class="token operator">-</span><span class="token number">96d5df5c8</span><span class="token operator">-</span>8fzdv      <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running       <span class="token number">0</span>          5m38s

<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># ls</span>
anaconda<span class="token operator">-</span>ks<span class="token punctuation">.</span>cfg  init  kube<span class="token operator">-</span>flannel<span class="token punctuation">.</span>yml
<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl cp /root/anaconda-ks.cfg web-96d5df5c8-8fzdv:/usr</span>
<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl exec web-96d5df5c8-8fzdv -- ls -l /usr/</span>
total <span class="token number">4</span>
<span class="token operator">-</span>rw<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span> <span class="token number">1</span> root root <span class="token number">1184</span> Dec <span class="token number">20</span> <span class="token number">14</span><span class="token punctuation">:</span><span class="token number">17</span> anaconda<span class="token operator">-</span>ks<span class="token punctuation">.</span>cfg
drwxr<span class="token operator">-</span>xr<span class="token operator">-</span>x <span class="token number">1</span> root root  <span class="token number">261</span> Dec  <span class="token number">2</span> <span class="token number">10</span><span class="token punctuation">:</span><span class="token number">59</span> <span class="token builtin">bin</span>
drwxr<span class="token operator">-</span>xr<span class="token operator">-</span>x <span class="token number">2</span> root root    <span class="token number">6</span> Oct  <span class="token number">3</span> <span class="token number">09</span><span class="token punctuation">:</span><span class="token number">15</span> games
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>略
</code></pre> 
<h3><a id="label_473"></a>label</h3> 
<p>标签<br> 给资源设置、更新标签</p> 
<pre><code class="prism language-python"><span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl run nginx --image nginx</span>
pod<span class="token operator">/</span>nginx created
<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl describe pod nginx</span>
Name<span class="token punctuation">:</span>         nginx
Namespace<span class="token punctuation">:</span>    default
Priority<span class="token punctuation">:</span>     <span class="token number">0</span>
Node<span class="token punctuation">:</span>         node2<span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.129</span><span class="token number">.136</span>
Start Time<span class="token punctuation">:</span>   Mon<span class="token punctuation">,</span> <span class="token number">20</span> Dec <span class="token number">2021</span> <span class="token number">22</span><span class="token punctuation">:</span><span class="token number">34</span><span class="token punctuation">:</span><span class="token number">38</span> <span class="token operator">+</span><span class="token number">0800</span>
Labels<span class="token punctuation">:</span>       run<span class="token operator">=</span>nginx
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token operator">//</span>追加标签
<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl label pods nginx app=test</span>
pod<span class="token operator">/</span>nginx labeled

<span class="token operator">//</span>查看标签
<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl describe pod nginx</span>
Name<span class="token punctuation">:</span>         nginx
Namespace<span class="token punctuation">:</span>    default
Priority<span class="token punctuation">:</span>     <span class="token number">0</span>
Node<span class="token punctuation">:</span>         node2<span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.129</span><span class="token number">.136</span>
Start Time<span class="token punctuation">:</span>   Mon<span class="token punctuation">,</span> <span class="token number">20</span> Dec <span class="token number">2021</span> <span class="token number">22</span><span class="token punctuation">:</span><span class="token number">34</span><span class="token punctuation">:</span><span class="token number">38</span> <span class="token operator">+</span><span class="token number">0800</span>
Labels<span class="token punctuation">:</span>       app<span class="token operator">=</span>test
              run<span class="token operator">=</span>nginx
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token operator">//</span>更改标签
<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl label --overwrite pods nginx app=hehe</span>
pod<span class="token operator">/</span>nginx labeled

<span class="token operator">//</span>查看是否更改成功
<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl describe pod nginx</span>
Name<span class="token punctuation">:</span>         nginx
Namespace<span class="token punctuation">:</span>    default
Priority<span class="token punctuation">:</span>     <span class="token number">0</span>
Node<span class="token punctuation">:</span>         node2<span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.129</span><span class="token number">.136</span>
Start Time<span class="token punctuation">:</span>   Mon<span class="token punctuation">,</span> <span class="token number">20</span> Dec <span class="token number">2021</span> <span class="token number">22</span><span class="token punctuation">:</span><span class="token number">34</span><span class="token punctuation">:</span><span class="token number">38</span> <span class="token operator">+</span><span class="token number">0800</span>
Labels<span class="token punctuation">:</span>       app<span class="token operator">=</span>hehe
              run<span class="token operator">=</span>nginx
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre> 
<h3><a id="apiresources_520"></a>api-resources</h3> 
<p>查看所有资源</p> 
<pre><code class="prism language-python"><span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl api-resources</span>
NAME                              SHORTNAMES   APIVERSION                             NAMESPACED   KIND
bindings                                       v1                                     true         Binding
componentstatuses                 cs           v1                                     false        ComponentStatus
configmaps                        cm           v1                                     true         ConfigMap
endpoints                         ep           v1                                     true         Endpoints
events                            ev           v1                                     true         Event
limitranges                       limits       v1                                     true         LimitRange
namespaces                        ns           v1                                     false        Namespace
nodes                             no           v1                                     false        Node
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>  
</code></pre> 
<h3><a id="apiversions_537"></a>api-versions</h3> 
<p>API版本</p> 
<pre><code class="prism language-python"><span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl api-versions</span>
admissionregistration<span class="token punctuation">.</span>k8s<span class="token punctuation">.</span>io<span class="token operator">/</span>v1
admissionregistration<span class="token punctuation">.</span>k8s<span class="token punctuation">.</span>io<span class="token operator">/</span>v1beta1
apiextensions<span class="token punctuation">.</span>k8s<span class="token punctuation">.</span>io<span class="token operator">/</span>v1
apiextensions<span class="token punctuation">.</span>k8s<span class="token punctuation">.</span>io<span class="token operator">/</span>v1beta1
apiregistration<span class="token punctuation">.</span>k8s<span class="token punctuation">.</span>io<span class="token operator">/</span>v1
apiregistration<span class="token punctuation">.</span>k8s<span class="token punctuation">.</span>io<span class="token operator">/</span>v1beta1
apps<span class="token operator">/</span>v1
authentication<span class="token punctuation">.</span>k8s<span class="token punctuation">.</span>io<span class="token operator">/</span>v1
authentication<span class="token punctuation">.</span>k8s<span class="token punctuation">.</span>io<span class="token operator">/</span>v1beta1
authorization<span class="token punctuation">.</span>k8s<span class="token punctuation">.</span>io<span class="token operator">/</span>v1
authorization<span class="token punctuation">.</span>k8s<span class="token punctuation">.</span>io<span class="token operator">/</span>v1beta1
autoscaling<span class="token operator">/</span>v1
autoscaling<span class="token operator">/</span>v2beta1
autoscaling<span class="token operator">/</span>v2beta2
batch<span class="token operator">/</span>v1
batch<span class="token operator">/</span>v1beta1
certificates<span class="token punctuation">.</span>k8s<span class="token punctuation">.</span>io<span class="token operator">/</span>v1
certificates<span class="token punctuation">.</span>k8s<span class="token punctuation">.</span>io<span class="token operator">/</span>v1beta1
coordination<span class="token punctuation">.</span>k8s<span class="token punctuation">.</span>io<span class="token operator">/</span>v1
coordination<span class="token punctuation">.</span>k8s<span class="token punctuation">.</span>io<span class="token operator">/</span>v1beta1
discovery<span class="token punctuation">.</span>k8s<span class="token punctuation">.</span>io<span class="token operator">/</span>v1beta1
events<span class="token punctuation">.</span>k8s<span class="token punctuation">.</span>io<span class="token operator">/</span>v1
events<span class="token punctuation">.</span>k8s<span class="token punctuation">.</span>io<span class="token operator">/</span>v1beta1
extensions<span class="token operator">/</span>v1beta1
flowcontrol<span class="token punctuation">.</span>apiserver<span class="token punctuation">.</span>k8s<span class="token punctuation">.</span>io<span class="token operator">/</span>v1beta1
networking<span class="token punctuation">.</span>k8s<span class="token punctuation">.</span>io<span class="token operator">/</span>v1
networking<span class="token punctuation">.</span>k8s<span class="token punctuation">.</span>io<span class="token operator">/</span>v1beta1
node<span class="token punctuation">.</span>k8s<span class="token punctuation">.</span>io<span class="token operator">/</span>v1
node<span class="token punctuation">.</span>k8s<span class="token punctuation">.</span>io<span class="token operator">/</span>v1beta1
policy<span class="token operator">/</span>v1beta1
rbac<span class="token punctuation">.</span>authorization<span class="token punctuation">.</span>k8s<span class="token punctuation">.</span>io<span class="token operator">/</span>v1
rbac<span class="token punctuation">.</span>authorization<span class="token punctuation">.</span>k8s<span class="token punctuation">.</span>io<span class="token operator">/</span>v1beta1
scheduling<span class="token punctuation">.</span>k8s<span class="token punctuation">.</span>io<span class="token operator">/</span>v1
scheduling<span class="token punctuation">.</span>k8s<span class="token punctuation">.</span>io<span class="token operator">/</span>v1beta1
storage<span class="token punctuation">.</span>k8s<span class="token punctuation">.</span>io<span class="token operator">/</span>v1
storage<span class="token punctuation">.</span>k8s<span class="token punctuation">.</span>io<span class="token operator">/</span>v1beta1
v1
</code></pre> 
<h3><a id="version_580"></a>version</h3> 
<p>查看版本</p> 
<pre><code class="prism language-python"><span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl version</span>
Client Version<span class="token punctuation">:</span> version<span class="token punctuation">.</span>Info<span class="token punctuation">{<!-- --></span>Major<span class="token punctuation">:</span><span class="token string">"1"</span><span class="token punctuation">,</span> Minor<span class="token punctuation">:</span><span class="token string">"20"</span><span class="token punctuation">,</span> GitVersion<span class="token punctuation">:</span><span class="token string">"v1.20.0"</span><span class="token punctuation">,</span> GitCommit<span class="token punctuation">:</span><span class="token string">"af46c47ce925f4c4ad5cc8d1fca46c7b77d13b38"</span><span class="token punctuation">,</span> GitTreeState<span class="token punctuation">:</span><span class="token string">"clean"</span><span class="token punctuation">,</span> BuildDate<span class="token punctuation">:</span><span class="token string">"2020-12-08T17:59:43Z"</span><span class="token punctuation">,</span> GoVersion<span class="token punctuation">:</span><span class="token string">"go1.15.5"</span><span class="token punctuation">,</span> Compiler<span class="token punctuation">:</span><span class="token string">"gc"</span><span class="token punctuation">,</span> Platform<span class="token punctuation">:</span><span class="token string">"linux/amd64"</span><span class="token punctuation">}</span>
Server Version<span class="token punctuation">:</span> version<span class="token punctuation">.</span>Info<span class="token punctuation">{<!-- --></span>Major<span class="token punctuation">:</span><span class="token string">"1"</span><span class="token punctuation">,</span> Minor<span class="token punctuation">:</span><span class="token string">"20"</span><span class="token punctuation">,</span> GitVersion<span class="token punctuation">:</span><span class="token string">"v1.20.0"</span><span class="token punctuation">,</span> GitCommit<span class="token punctuation">:</span><span class="token string">"af46c47ce925f4c4ad5cc8d1fca46c7b77d13b38"</span><span class="token punctuation">,</span> GitTreeState<span class="token punctuation">:</span><span class="token string">"clean"</span><span class="token punctuation">,</span> BuildDate<span class="token punctuation">:</span><span class="token string">"2020-12-08T17:51:19Z"</span><span class="token punctuation">,</span> GoVersion<span class="token punctuation">:</span><span class="token string">"go1.15.5"</span><span class="token punctuation">,</span> Compiler<span class="token punctuation">:</span><span class="token string">"gc"</span><span class="token punctuation">,</span> Platform<span class="token punctuation">:</span><span class="token string">"linux/amd64"</span><span class="token punctuation">}</span>
</code></pre> 
<h3><a id="deployment_589"></a>使用deployment控制器部署镜像</h3> 
<pre><code class="prism language-python"><span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl create deployment nginx --image lizhenliang/java-demo</span>
deployment<span class="token punctuation">.</span>apps<span class="token operator">/</span>nginx created
<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl get pod</span>
NAME                     READY   STATUS              RESTARTS   AGE
nginx<span class="token operator">-</span><span class="token number">5fd5cdd7d4</span><span class="token operator">-</span>4sjb7   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running       <span class="token number">0</span>          3m30s
nginx<span class="token operator">-</span><span class="token number">5fd5cdd7d4</span><span class="token operator">-</span>nq9bb   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running       <span class="token number">0</span>          3m30s
nginx<span class="token operator">-</span><span class="token number">5fd5cdd7d4</span><span class="token operator">-</span>p97tp   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running       <span class="token number">0</span>          3m45s

<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl get deploy,pods</span>
NAME                    READY   UP<span class="token operator">-</span>TO<span class="token operator">-</span>DATE   AVAILABLE   AGE
deployment<span class="token punctuation">.</span>apps<span class="token operator">/</span>nginx   <span class="token number">1</span><span class="token operator">/</span><span class="token number">3</span>     <span class="token number">3</span>            <span class="token number">1</span>           38s

NAME                         READY   STATUS              RESTARTS   AGE
pod<span class="token operator">/</span>nginx<span class="token operator">-</span><span class="token number">5fd5cdd7d4</span><span class="token operator">-</span>4sjb7   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running       <span class="token number">0</span>          3m59s
pod<span class="token operator">/</span>nginx<span class="token operator">-</span><span class="token number">5fd5cdd7d4</span><span class="token operator">-</span>nq9bb   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running       <span class="token number">0</span>          3m59s
pod<span class="token operator">/</span>nginx<span class="token operator">-</span><span class="token number">5fd5cdd7d4</span><span class="token operator">-</span>p97tp   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running       <span class="token number">0</span>          4m14s

<span class="token operator">//</span>使用Service将pod暴露出去
<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl expose deployment nginx --port=80 --target-port=8080 --type=NodePort</span>
service<span class="token operator">/</span>nginx exposed
<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl get service</span>
NAME         TYPE        CLUSTER<span class="token operator">-</span>IP       EXTERNAL<span class="token operator">-</span>IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>        AGE
kubernetes   ClusterIP   <span class="token number">10.96</span><span class="token number">.0</span><span class="token number">.1</span>        <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">443</span><span class="token operator">/</span>TCP        2d6h
nginx        NodePort    <span class="token number">10.111</span><span class="token number">.209</span><span class="token number">.122</span>   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">80</span><span class="token punctuation">:</span><span class="token number">32603</span><span class="token operator">/</span>TCP   8s

<span class="token operator">//</span>访问
<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># curl 192.168.129.250:32603</span>
<span class="token operator">&lt;</span>!DOCTYPE html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>head lang<span class="token operator">=</span><span class="token string">"en"</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>meta http<span class="token operator">-</span>equiv<span class="token operator">=</span><span class="token string">"X-UA-Compatible"</span> content<span class="token operator">=</span><span class="token string">"IE=edge"</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>把美女带回家应用案例<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>meta name<span class="token operator">=</span><span class="token string">"description"</span> content<span class="token operator">=</span><span class="token string">"把美女带回家应用案例"</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>meta name<span class="token operator">=</span><span class="token string">"keywords"</span> content<span class="token operator">=</span><span class="token string">"index"</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>meta name<span class="token operator">=</span><span class="token string">"viewport"</span> content<span class="token operator">=</span><span class="token string">"width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>meta name<span class="token operator">=</span><span class="token string">"renderer"</span> content<span class="token operator">=</span><span class="token string">"webkit"</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>meta http<span class="token operator">-</span>equiv<span class="token operator">=</span><span class="token string">"X-UA-Compatible"</span> content<span class="token operator">=</span><span class="token string">"IE=edge,chrome=1"</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>meta http<span class="token operator">-</span>equiv<span class="token operator">=</span><span class="token string">"Cache-Control"</span> content<span class="token operator">=</span><span class="token string">"no-siteapp"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>link rel<span class="token operator">=</span><span class="token string">"stylesheet"</span> href<span class="token operator">=</span><span class="token string">"../js/layui/css/layui.css"</span> media<span class="token operator">=</span><span class="token string">"all"</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>link rel<span class="token operator">=</span><span class="token string">"stylesheet"</span> href<span class="token operator">=</span><span class="token string">"../css/reset.css"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>link rel<span class="token operator">=</span><span class="token string">"stylesheet"</span> href<span class="token operator">=</span><span class="token string">"../css/supersized.css"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>link rel<span class="token operator">=</span><span class="token string">"stylesheet"</span> href<span class="token operator">=</span><span class="token string">"../css/style.css"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>link rel<span class="token operator">=</span><span class="token string">"stylesheet"</span> href<span class="token operator">=</span><span class="token string">"../css/typeit.css"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>link rel<span class="token operator">=</span><span class="token string">"stylesheet"</span> href<span class="token operator">=</span><span class="token string">"../css/date.css"</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>!<span class="token operator">-</span><span class="token operator">-</span> <span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token string">"../images/logo.png"</span><span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"page-container"</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>h1 <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"title"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token string">"margin-top: 15%;"</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>button <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"layui-btn layui-btn-lg layui-btn-primary layui-btn-radius"</span> onclick<span class="token operator">=</span><span class="token string">"adduser()"</span><span class="token operator">&gt;</span>添加美女<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>button <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"layui-btn layui-btn-lg layui-btn-primary layui-btn-radius"</span> onclick<span class="token operator">=</span><span class="token string">"queryuserList()"</span><span class="token operator">&gt;</span>今晚翻盘哪个<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
         <span class="token operator">&lt;</span>!<span class="token operator">-</span><span class="token operator">-</span>    <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token string">"text-align:center;clear:both"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"date"</span><span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span>!<span class="token operator">-</span><span class="token operator">-</span> <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"connect"</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>联系作者<span class="token punctuation">:</span>子彬<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span>a <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"qq"</span> target<span class="token operator">=</span><span class="token string">"_blank"</span> href<span class="token operator">=</span><span class="token string">"http://wpa.qq.com/msgrd?Menu=no&amp;Exe=QQ&amp;Uin=125720240"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span>a <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"twitter"</span> href<span class="token operator">=</span><span class="token string">""</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"../js/jquery-1.8.2.min.js"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"../js/layui/layui.js"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"../js/supersized.3.2.7.min.js"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"../js/supersized-init.js"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"../js/typeit.js"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"../js/date.js"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"../js/index.js"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>script <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">"text/javascript"</span><span class="token operator">&gt;</span>
                 $<span class="token punctuation">(</span><span class="token string">'.title'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>typeIt<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                  whatToType<span class="token punctuation">:</span> <span class="token string">"这里有很多美女，挑一个回家吧！"</span><span class="token punctuation">,</span>
              typeSpeed<span class="token punctuation">:</span> <span class="token number">300</span><span class="token punctuation">,</span>
              lifeLike<span class="token punctuation">:</span> true<span class="token punctuation">,</span>
              breakLines <span class="token punctuation">:</span>true
                <span class="token punctuation">}</span><span class="token punctuation">,</span> function<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                          console<span class="token punctuation">.</span>log<span class="token punctuation">(</span><span class="token string">'This is tomcat callback function!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span>
</code></pre> 
<h2><a id="_676"></a>滚动更新、回滚</h2> 
<h3><a id="Dockerfile_677"></a>用Dockerfile编写两个镜像</h3> 
<pre><code class="prism language-python"><span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># mkdir httpd</span>
<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># cd httpd/</span>
<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># ls</span>
anaconda<span class="token operator">-</span>ks<span class="token punctuation">.</span>cfg  httpd  init  kube<span class="token operator">-</span>flannel<span class="token punctuation">.</span>yml

<span class="token operator">//</span>制作第一版镜像
<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># vim httpd/Dockerfile</span>
FROM busybox

RUN mkdir  <span class="token operator">/</span>data <span class="token operator">&amp;</span><span class="token operator">&amp;</span> \
    echo <span class="token string">"test page on jjyy"</span> <span class="token operator">&gt;</span> <span class="token operator">/</span>data<span class="token operator">/</span>index<span class="token punctuation">.</span>html
ENTRYPOINT <span class="token punctuation">[</span><span class="token string">"/bin/httpd"</span><span class="token punctuation">,</span><span class="token string">"-f"</span><span class="token punctuation">,</span><span class="token string">"-h"</span><span class="token punctuation">,</span><span class="token string">"/data"</span><span class="token punctuation">]</span>

<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># docker build -t 1314444/httpd:v0.1 httpd</span>
Sending build context to Docker daemon  <span class="token number">2.</span>048kB
Step <span class="token number">1</span><span class="token operator">/</span><span class="token number">3</span> <span class="token punctuation">:</span> FROM busybox
 <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> ffe9d497c324
Step <span class="token number">2</span><span class="token operator">/</span><span class="token number">3</span> <span class="token punctuation">:</span> RUN mkdir  <span class="token operator">/</span>data <span class="token operator">&amp;</span><span class="token operator">&amp;</span>     echo <span class="token string">"test page on jjyy"</span> <span class="token operator">&gt;</span> <span class="token operator">/</span>data<span class="token operator">/</span>index<span class="token punctuation">.</span>html
 <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> Using cache
 <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">2329b553343b</span>
Step <span class="token number">3</span><span class="token operator">/</span><span class="token number">3</span> <span class="token punctuation">:</span> ENTRYPOINT <span class="token punctuation">[</span><span class="token string">"/bin/httpd"</span><span class="token punctuation">,</span><span class="token string">"-f"</span><span class="token punctuation">,</span><span class="token string">"-h"</span><span class="token punctuation">,</span><span class="token string">"/data"</span><span class="token punctuation">]</span>
 <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> Using cache
 <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">17a2afe17b15</span>
Successfully built <span class="token number">17a2afe17b15</span>
Successfully tagged <span class="token number">1314444</span><span class="token operator">/</span>httpd<span class="token punctuation">:</span>v0<span class="token punctuation">.</span><span class="token number">1</span>


<span class="token operator">//</span>制作第二版镜像
<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># cat httpd/Dockerfile </span>
FROM busybox

RUN mkdir  <span class="token operator">/</span>data <span class="token operator">&amp;</span><span class="token operator">&amp;</span> \
    echo <span class="token string">"test page on 666"</span> <span class="token operator">&gt;</span> <span class="token operator">/</span>data<span class="token operator">/</span>index<span class="token punctuation">.</span>html
ENTRYPOINT <span class="token punctuation">[</span><span class="token string">"/bin/httpd"</span><span class="token punctuation">,</span><span class="token string">"-f"</span><span class="token punctuation">,</span><span class="token string">"-h"</span><span class="token punctuation">,</span><span class="token string">"/data"</span><span class="token punctuation">]</span>

<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># docker build -t 1314444/httpd:v0.2 httpd</span>
Sending build context to Docker daemon  <span class="token number">2.</span>048kB
Step <span class="token number">1</span><span class="token operator">/</span><span class="token number">3</span> <span class="token punctuation">:</span> FROM busybox
 <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> ffe9d497c324
Step <span class="token number">2</span><span class="token operator">/</span><span class="token number">3</span> <span class="token punctuation">:</span> RUN mkdir  <span class="token operator">/</span>data <span class="token operator">&amp;</span><span class="token operator">&amp;</span>     echo <span class="token string">"test page on 666"</span> <span class="token operator">&gt;</span> <span class="token operator">/</span>data<span class="token operator">/</span>index<span class="token punctuation">.</span>html
 <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> Using cache
 <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">1674557401b0</span>
Step <span class="token number">3</span><span class="token operator">/</span><span class="token number">3</span> <span class="token punctuation">:</span> ENTRYPOINT <span class="token punctuation">[</span><span class="token string">"/bin/httpd"</span><span class="token punctuation">,</span><span class="token string">"-f"</span><span class="token punctuation">,</span><span class="token string">"-h"</span><span class="token punctuation">,</span><span class="token string">"/data"</span><span class="token punctuation">]</span>
 <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> Using cache
 <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> e83d0d9638e2
Successfully built e83d0d9638e2
Successfully tagged <span class="token number">1314444</span><span class="token operator">/</span>httpd<span class="token punctuation">:</span>v0<span class="token punctuation">.</span><span class="token number">2</span>


<span class="token operator">//</span>上传镜像
<span class="token punctuation">[</span>root@master httpd<span class="token punctuation">]</span><span class="token comment"># docker login </span>
Login <span class="token keyword">with</span> your Docker ID to push <span class="token keyword">and</span> pull images <span class="token keyword">from</span> Docker Hub<span class="token punctuation">.</span> If you don't have a Docker ID<span class="token punctuation">,</span> head over to https<span class="token punctuation">:</span><span class="token operator">//</span>hub<span class="token punctuation">.</span>docker<span class="token punctuation">.</span>com to create one<span class="token punctuation">.</span>
Username<span class="token punctuation">:</span> <span class="token number">1314444</span>
Password<span class="token punctuation">:</span> 
WARNING! Your password will be stored unencrypted <span class="token keyword">in</span> <span class="token operator">/</span>root<span class="token operator">/</span><span class="token punctuation">.</span>docker<span class="token operator">/</span>config<span class="token punctuation">.</span>json<span class="token punctuation">.</span>
Configure a credential helper to remove this warning<span class="token punctuation">.</span> See
https<span class="token punctuation">:</span><span class="token operator">//</span>docs<span class="token punctuation">.</span>docker<span class="token punctuation">.</span>com<span class="token operator">/</span>engine<span class="token operator">/</span>reference<span class="token operator">/</span>commandline<span class="token operator">/</span>login<span class="token operator">/</span><span class="token comment">#credentials-store</span>

Login Succeeded

<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># docker push 1314444/httpd:v0.1</span>
The push refers to repository <span class="token punctuation">[</span>docker<span class="token punctuation">.</span>io<span class="token operator">/</span><span class="token number">1314444</span><span class="token operator">/</span>httpd<span class="token punctuation">]</span>
e25a80053b84<span class="token punctuation">:</span> Pushed 
<span class="token number">64cac9eaf0da</span><span class="token punctuation">:</span> Mounted <span class="token keyword">from</span> library<span class="token operator">/</span>busybox 
v0<span class="token punctuation">.</span><span class="token number">1</span><span class="token punctuation">:</span> digest<span class="token punctuation">:</span> sha256<span class="token punctuation">:</span><span class="token number">81a6649c29cb2e926f0da674f5d95a63650320eb942e64b8f6e8def7e4396cc2</span> size<span class="token punctuation">:</span> <span class="token number">734</span>
<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># docker push 1314444/httpd:v0.2</span>
The push refers to repository <span class="token punctuation">[</span>docker<span class="token punctuation">.</span>io<span class="token operator">/</span><span class="token number">1314444</span><span class="token operator">/</span>httpd<span class="token punctuation">]</span>
bf7ee3fa3965<span class="token punctuation">:</span> Pushed 
<span class="token number">64cac9eaf0da</span><span class="token punctuation">:</span> Layer already exists 
v0<span class="token punctuation">.</span><span class="token number">2</span><span class="token punctuation">:</span> digest<span class="token punctuation">:</span> sha256<span class="token punctuation">:</span>b81f22b6c54cd94b75959633f51cd10e5e4dc97ed827c7a3a2d9e8165722abd6 size<span class="token punctuation">:</span> <span class="token number">734</span>
</code></pre> 
<h3><a id="_750"></a>滚动更新、回滚</h3> 
<pre><code class="prism language-python"><span class="token operator">//</span>用k8s运行镜像
<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl create deploy httpd --image 1314444/httpd:v0.1 --replicas 3</span>
deployment<span class="token punctuation">.</span>apps<span class="token operator">/</span>httpd created

<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl get pod</span>
NAME                     READY   STATUS              RESTARTS   AGE
httpd<span class="token operator">-</span><span class="token number">9b8f648df</span><span class="token operator">-</span>4fl48    <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running       <span class="token number">0</span>          119s
httpd<span class="token operator">-</span><span class="token number">9b8f648df</span><span class="token operator">-</span>j85cp    <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running       <span class="token number">0</span>          119s
httpd<span class="token operator">-</span><span class="token number">9b8f648df</span><span class="token operator">-</span>nftfn    <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running       <span class="token number">0</span>          119s

<span class="token comment">#暴露端口号</span>
<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl expose deploy httpd --port 80 --type NodePort </span>
service<span class="token operator">/</span>httpd exposed

<span class="token comment">#访问</span>
<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># curl 10.103.215.90</span>
test page on jjyy



<span class="token operator">//</span>更新
<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl set image deploy/httpd httpd=1314444/httpd:v0.2</span>
deployment<span class="token punctuation">.</span>apps<span class="token operator">/</span>httpd image updated

<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl get pod</span>
NAME                     READY   STATUS              RESTARTS   AGE
httpd<span class="token operator">-</span><span class="token number">7bcffb4f6</span><span class="token operator">-</span>sd6rw    <span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span>     ContainerCreating   <span class="token number">0</span>          18s
httpd<span class="token operator">-</span><span class="token number">9b8f648df</span><span class="token operator">-</span>4fl48    <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running             <span class="token number">0</span>          6m59s
httpd<span class="token operator">-</span><span class="token number">9b8f648df</span><span class="token operator">-</span>j85cp    <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running             <span class="token number">0</span>          6m59s
httpd<span class="token operator">-</span><span class="token number">9b8f648df</span><span class="token operator">-</span>nftfn    <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running             <span class="token number">0</span>          6m59s

<span class="token comment">#已经更新了</span>
<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl get pod</span>
NAME                     READY   STATUS        RESTARTS   AGE
httpd<span class="token operator">-</span><span class="token number">7bcffb4f6</span><span class="token operator">-</span>gdq68    <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running       <span class="token number">0</span>          26s
httpd<span class="token operator">-</span><span class="token number">7bcffb4f6</span><span class="token operator">-</span>sd6rw    <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running       <span class="token number">0</span>          83s
httpd<span class="token operator">-</span><span class="token number">7bcffb4f6</span><span class="token operator">-</span>sfp78    <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running       <span class="token number">0</span>          25s

<span class="token comment">#访问</span>
<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># curl 10.103.215.90</span>
test page on <span class="token number">666</span>




<span class="token operator">//</span>回滚（来回滚）
<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl rollout undo deploy/httpd </span>
deployment<span class="token punctuation">.</span>apps<span class="token operator">/</span>httpd rolled back

<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl get pod</span>
NAME                     READY   STATUS        RESTARTS   AGE
httpd<span class="token operator">-</span><span class="token number">9b8f648df</span><span class="token operator">-</span>c57w6    <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running       <span class="token number">0</span>          31s
httpd<span class="token operator">-</span><span class="token number">9b8f648df</span><span class="token operator">-</span>jjbqb    <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running       <span class="token number">0</span>          32s
httpd<span class="token operator">-</span><span class="token number">9b8f648df</span><span class="token operator">-</span>knvs7    <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running       <span class="token number">0</span>          33s

<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># curl 10.103.215.90</span>
test page on jjyy

<span class="token operator">//</span>回滚到上一个版本
<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># kubectl rollout undo deploy/httpd </span>
deployment<span class="token punctuation">.</span>apps<span class="token operator">/</span>httpd rolled back
<span class="token punctuation">[</span>root@master <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># curl 10.103.215.90</span>
test page on <span class="token number">666</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3b21a68417c5aba5cf458ca926a48daa/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">glibc 知：构建2.34版本</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e3953dfd308c0852491158ba73c69ced/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">实现弹簧柔性状态的2种方式 | Solidworks教程</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>