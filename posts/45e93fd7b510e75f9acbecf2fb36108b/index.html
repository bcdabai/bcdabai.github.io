<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【DLT学习笔记2】-- 什么是DLT？(Diagnostic Log and Trace) - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【DLT学习笔记2】-- 什么是DLT？(Diagnostic Log and Trace)" />
<meta property="og:description" content="DLTGENIVI项目下的log软件工程
DLT包括：DLT daemon DTL viewer两个子工程。
DLT daemon运行在ECU上，DTLviewer运行在调试PC上。
github地址：dlt-viewer
一、DLT使用场景 1.1 DLT的通用场景 应用或SW-C产生日志消息日志消息发送到DLT模块DLT模块将日志消息发送到总线外部DLT客户端记录日志消息 1.2 VFB追踪(tracing of VFB) RTE调用由DLT提供的宏，该宏可以调用DLT应用接口产生追踪消息（trace message）DLT模块发送跟踪消息到DLT通讯模块（黄色模块）DLT通讯模块转发跟踪消息到网络外部客户端接收并存储跟踪消息 1.3 DLT运行配置 外部dlt客户端发送日志和跟踪等级变更到dlt模块dlt模块根据收到的变更消息改变自己的过滤器设置配置dlt模块通知应用新的日志等级 1.4 非冗余模式(non-verbose mode) 为了减少总线上的运输量，我们可以避免发送通讯总线上的变量元数据。相反，一个外部FIBEX文件保存如何解释有效负载的信息。外部Dlt客户机使用接收到的参数值合并和存储这些元数据。
dlt模块以非冗余模式来传送dlt消息dlt模块过滤和产生dlt消息dlt模块发送dlt消息到通讯总线外部dlt客户端获取外部FIBEX文件里的元信息外部dlt客户存储合并的消息 二、DLT协议介绍 DLT消息包含三个部分：标准头、扩展头、有效载荷。如下图
2.1 标准头 标准头有16个字节大小，分为6个部分。它们之间的名称和顺序如下图所示
Byte0：Header Type，这里用来配置DLT的可选项，比如带不带ECU ID、Session ID、时间戳等，DLT协议版本号、大端优先。具体如下图所示：
1为采用，0为不采用
如果使用冗余模式，则UEH位必须为1Byte1：Message Counter,从0开始最大255，可以在一定程度上识别丢失的消息。Byte2-3：Length，这个字段指示整个DLT消息的长度，包括标准头、扩展头、有效载荷Byte4-7：ECU ID，可选的ECU ID用于识别哪个ECU发送了Dlt消息。因此，强烈建议ECU ID在车辆内是唯一的。Byte8-11：Session ID，可选的Session ID用于标识ECU中的日志或跟踪消息的来源。Byte12-15：Timestamp，对产生的DLT消息添加时间信息。 2.2 扩展头 扩展头字段是紧跟在标准头后面的，如果标准头中‘UEH’位位1，则表示该DLT消息有扩展头。扩展图的结构如下图所示：
-Byte0:Message Info,该字节的字段非常重要，设计到dlt消息的类型分类，用来区分是日志消息、跟踪消息、网络消息、控制消息。字段结构如下图所示：
VERB为1时表示有效载荷必须按冗余模式传输
MSTP表示DLT的类型，一共分四种：日志消息、跟踪消息、网络消息、控制消息
MTIN表示不同类型DLT消息各自的下级分类
一图胜千言
Byte1：Number of Arguments:参数数量表示一条Dlt消息的有效负载段中连续参数的数量。在冗余模式有效，非冗余模式此字段因为0x00Byte2-5：Application ID，应用程序ID是应用程序的缩写，它生成Dlt消息。Byte6-9：Context ID，Context ID是用户定义的ID，用于(逻辑上)对应用程序生成的Dlt消息进行分组。 2.3 有效载荷 2.3.1 非冗余模式 非冗余模式下的的有效载荷就比较简单，只传输参数值(不需要任何关于它们的元信息)，以及其他属性(如参数名称或类型)，为了允许在接收到的Dlt消息中正确地分解所包含的参数值，将向有效负载添加专用的message ID。非冗余模式需要外部解析文件，用来解析Message ID通过消息ID和外部描述的组合，以下信息应该是可恢复的:
类型信息：Type Length、Data Type、String Coding 、Variable Info 、Fixed Point" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/45e93fd7b510e75f9acbecf2fb36108b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-05-08T16:10:29+08:00" />
<meta property="article:modified_time" content="2022-05-08T16:10:29+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【DLT学习笔记2】-- 什么是DLT？(Diagnostic Log and Trace)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>DLTGENIVI项目下的log软件工程</p> 
<p>DLT包括：DLT daemon DTL viewer两个子工程。</p> 
<p>DLT daemon运行在ECU上，DTLviewer运行在调试PC上。</p> 
<p>github地址：<a href="https://github.com/COVESA/dlt-viewer/blob/master/INSTALL.md">dlt-viewer</a></p> 
<h2><a id="DLT_8"></a>一、DLT使用场景</h2> 
<h3><a id="11_DLT_9"></a>1.1 DLT的通用场景</h3> 
<p><img src="https://images2.imgbox.com/79/55/knaQDNR6_o.png" alt="在这里插入图片描述"></p> 
<ul><li>应用或SW-C产生日志消息</li><li>日志消息发送到DLT模块</li><li>DLT模块将日志消息发送到总线</li><li>外部DLT客户端记录日志消息</li></ul> 
<h3><a id="12_VFBtracing_of_VFB_15"></a>1.2 VFB追踪(tracing of VFB)</h3> 
<p><img src="https://images2.imgbox.com/3e/9a/IZmif7Lr_o.png" alt="在这里插入图片描述"></p> 
<ul><li>RTE调用由DLT提供的宏，该宏可以调用DLT应用接口产生追踪消息（trace message）</li><li>DLT模块发送跟踪消息到DLT通讯模块（黄色模块）</li><li>DLT通讯模块转发跟踪消息到网络</li><li>外部客户端接收并存储跟踪消息</li></ul> 
<h3><a id="13_DLT_22"></a>1.3 DLT运行配置</h3> 
<p><img src="https://images2.imgbox.com/75/80/gu7oPHhQ_o.png" alt="在这里插入图片描述"></p> 
<ul><li>外部dlt客户端发送日志和跟踪等级变更到dlt模块</li><li>dlt模块根据收到的变更消息改变自己的过滤器设置配置</li><li>dlt模块通知应用新的日志等级</li></ul> 
<h3><a id="14_nonverbose_mode_27"></a>1.4 非冗余模式(non-verbose mode)</h3> 
<p>为了减少总线上的运输量，我们可以避免发送通讯总线上的变量元数据。相反，一个外部FIBEX文件保存如何解释有效负载的信息。外部Dlt客户机使用接收到的参数值合并和存储这些元数据。<br> <img src="https://images2.imgbox.com/7a/23/bavFldt7_o.png" alt="在这里插入图片描述"></p> 
<ul><li>dlt模块以非冗余模式来传送dlt消息</li><li>dlt模块过滤和产生dlt消息</li><li>dlt模块发送dlt消息到通讯总线</li><li>外部dlt客户端获取外部FIBEX文件里的元信息</li><li>外部dlt客户存储合并的消息</li></ul> 
<h2><a id="DLT_37"></a>二、DLT协议介绍</h2> 
<p>DLT消息包含三个部分：标准头、扩展头、有效载荷。如下图<br> <img src="https://images2.imgbox.com/54/b6/rmqtBJc2_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="21__40"></a>2.1 标准头</h3> 
<p>标准头有16个字节大小，分为6个部分。它们之间的名称和顺序如下图所示<br> <img src="https://images2.imgbox.com/57/fb/dTXBX2Ga_o.png" alt="在这里插入图片描述"></p> 
<ul><li>Byte0：Header Type，这里用来配置DLT的可选项，比如带不带ECU ID、Session ID、时间戳等，DLT协议版本号、大端优先。具体如下图所示：<br> <img src="https://images2.imgbox.com/43/ca/hKz61CPg_o.png" alt="在这里插入图片描述"><br> <strong>1为采用，0为不采用</strong><br> <strong>如果使用冗余模式，则UEH位必须为1</strong></li><li>Byte1：Message Counter,从0开始最大255，可以在一定程度上识别丢失的消息。</li><li>Byte2-3：Length，这个字段指示整个DLT消息的长度，包括标准头、扩展头、有效载荷</li><li>Byte4-7：ECU ID，可选的ECU ID用于识别哪个ECU发送了Dlt消息。因此，强烈建议ECU ID在车辆内是唯一的。</li><li>Byte8-11：Session ID，可选的Session ID用于标识ECU中的日志或跟踪消息的来源。</li><li>Byte12-15：Timestamp，对产生的DLT消息添加时间信息。</li></ul> 
<h3><a id="22__52"></a>2.2 扩展头</h3> 
<p>扩展头字段是紧跟在标准头后面的，如果标准头中‘UEH’位位1，则表示该DLT消息有扩展头。扩展图的结构如下图所示：<br> <img src="https://images2.imgbox.com/17/b0/8UUjDLXJ_o.png" alt="在这里插入图片描述"><br> -Byte0:Message Info,<strong>该字节的字段非常重要，设计到dlt消息的类型分类，用来区分是日志消息、跟踪消息、网络消息、控制消息</strong>。字段结构如下图所示：<br> <img src="https://images2.imgbox.com/46/4d/9YB7quhG_o.png" alt="在这里插入图片描述"><br> <strong>VERB</strong>为1时表示有效载荷必须按冗余模式传输<br> <strong>MSTP</strong>表示DLT的类型，一共分四种：日志消息、跟踪消息、网络消息、控制消息<br> <strong>MTIN</strong>表示不同类型DLT消息各自的下级分类<br> 一图胜千言<br> <img src="https://images2.imgbox.com/83/ea/IUjSUsAr_o.png" alt="在这里插入图片描述"></p> 
<ul><li>Byte1：Number of Arguments:参数数量表示一条Dlt消息的有效负载段中连续参数的数量。<strong>在冗余模式有效，非冗余模式此字段因为0x00</strong></li><li>Byte2-5：Application ID，应用程序ID是应用程序的缩写，它生成Dlt消息。</li><li>Byte6-9：Context ID，Context ID是用户定义的ID，用于(逻辑上)对应用程序生成的Dlt消息进行分组。</li></ul> 
<h3><a id="23__65"></a>2.3 有效载荷</h3> 
<h4><a id="231__66"></a>2.3.1 非冗余模式</h4> 
<p>非冗余模式下的的有效载荷就比较简单，只传输参数值(不需要任何关于它们的元信息)，以及其他属性(如参数名称或类型)，为了允许在接收到的Dlt消息中正确地分解所包含的参数值，将向有效负载添加专用的message ID。<strong>非冗余模式需要外部解析文件，用来解析Message ID</strong>通过消息ID和外部描述的组合，以下信息应该是可恢复的:<br> 类型信息：Type Length、Data Type、String Coding 、Variable Info 、Fixed Point<br> 考虑到MCU的处理能力，非冗余模式只传送dlt消息中的非静态数据，而每条dlt消息中的静态数据通过外部解析文件与Message ID进行关联，非冗余模式DLT消息结构如下：<br> <img src="https://images2.imgbox.com/62/c7/I1Zj9lY4_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="2311_dlt_71"></a>2.3.1.1 非冗余模式dlt消息示例</h5> 
<p>通过下面的例子，我们来看下非静态数据是如何组装，传输和解析的。</p> 
<hr> 
<p>假设下面这条日志消息将要传送给外部DLT客户端：</p> 
<ul><li>静态文本：“Temperature measurement”</li><li>8位uint:measurement_point = 1 (no unit)</li><li>32位浮点型：reading = 22.1 Kelvin<br> 在源代码中的这个特定位置上有一个唯一的消息ID，用来表示这个日志消息调用。以下信息与这个消息ID相关联:</li><li>源码位置：source file “temp_meas.c”, line number 42</li><li>静态文本：“Temperature measurement”</li><li>值位8位无符号整数。变量名=“measurement_point” ， 单位 = “”</li><li>值位32位浮点型，变量名= “reading”，单位=“Kelvin”<br> 所有的静态数据已经与message ID关联了，所以只用传输非静态数据，这条dlt消息的非静态数据如下所示：<br> <img src="https://images2.imgbox.com/3f/6a/ttdO66yr_o.png" alt="在这里插入图片描述"><br> 根据消息ID，接收方可以重新组合此Dlt消息的所有静态数据(源代码中的位置、静态文本、变量名和单元)。非静态数据将被一致地打包传输。可以通过使用与消息ID相关联的信息进行解释。此外，参数的顺序与消息ID相关联。</li></ul> 
<hr> 
<h5><a id="2312__89"></a>2.3.1.2 非冗余模式被传输数据的解析格式</h5> 
<p>外部文件像ASAM Fibex文件，保存着如何解析有效载荷的信息。应用程序或中间件的软件供应商应提供此描述文件。由于Dlt可以有多个日志或跟踪消息源(多个应用程序或诊断模块)，因此可以将提供的描述文件合并到给定ECU的一个文件中。<br> 每个用于描述非详细消息的Fibex描述文件只对应于一个ECU的日志或跟踪消息。这是因为每个ECU的消息id是唯一的。此外，ECU的软件版本号必须由描述文件提供。<br> 原则上，每个日志或跟踪消息都相当于某些网络协议中已知的PDU。在这里，日志或跟踪消息的描述应该等同于Fibex指定的CAN-Frame。来自Extended Header的信息被另外放入FRAME-TYPE xml元素中的xml元素中。非静态数据由PDU和SIGNAL xml元素描述。<br> 从用户的角度来看，日志或跟踪消息有几个参数。这些参数可以是静态文本或非静态变量。只传输非静态变量的数据。为了用所有参数重新组合整个消息，一个FRAME xml元素应该包含一些空的PDU xml元素，这些元素用静态文本表示参数。此文本应置于PDU xml元素的DESC xml元素中。</p> 
<ul><li><strong>一条日志或追踪消息必须是一个Fibex XML元素框架表示</strong></li><li><strong>消息ID必须是&lt;FRAME&gt;XML元素的ID属性</strong><br> 下面的示例显示了FIBEX XML中示例Dlt消息的描述。</li></ul> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">fx:</span>FRAME</span> <span class="token attr-name">ID</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ID_1<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">ho:</span>SHORT-NAME</span><span class="token punctuation">&gt;</span></span>Dlt Message with ID_1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">ho:</span>SHORT-NAME</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">fx:</span>BYTE-LENGTH</span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">fx:</span>BYTE-LENGTH</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">fx:</span>FRAME-TYPE</span><span class="token punctuation">&gt;</span></span>OTHER<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">fx:</span>FRAME-TYPE</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">fx:</span>PDU-INSTANCES</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">fx:</span>PDU-INSTANCE</span> <span class="token attr-name">ID</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>P_1_0<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">fx:</span>PDU-REF</span> <span class="token attr-name">ID-REF</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>PDU_1_0<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">fx:</span>SEQUENCE-NUMBER</span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">fx:</span>SEQUENCE-NUMBER</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">fx:</span>PDU-INSTANCE</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">fx:</span>PDU-INSTANCE</span> <span class="token attr-name">ID</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>P_1_1<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">fx:</span>PDU-REF</span> <span class="token attr-name">ID-REF</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>PDU_1_1<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">fx:</span>SEQUENCE-NUMBER</span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">fx:</span>SEQUENCE-NUMBER</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">fx:</span>PDU-INSTANCE</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">fx:</span>PDU-INSTANCE</span> <span class="token attr-name">ID</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>P_1_2<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">fx:</span>PDU-REF</span> <span class="token attr-name">ID-REF</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>PDU_1_2<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">fx:</span>SEQUENCE-NUMBER</span><span class="token punctuation">&gt;</span></span>2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">fx:</span>SEQUENCE-NUMBER</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">fx:</span>PDU-INSTANCE</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">fx:</span>PDU-INSTANCES</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">fx:</span>MANUFACTURER-EXTENSION</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>MESSAGE_TYPE</span><span class="token punctuation">&gt;</span></span>DLT_TYPE_LOG<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>MESSAGE_TYPE</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>MESSAGE_INFO</span><span class="token punctuation">&gt;</span></span>DLT_LOG_DEBUG<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>MESSAGE_INFO</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>APPLICATIONID</span><span class="token punctuation">&gt;</span></span>APPI<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>APPLICATIONID</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CONTEXTID</span><span class="token punctuation">&gt;</span></span>CONI<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>CONTEXTID</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>MESSAGE_SOURCE_FILE</span><span class="token punctuation">&gt;</span></span>demo.c<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>MESSAGE_SOURCE_FILE</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>MESSAGE_LINE_NUMBER</span><span class="token punctuation">&gt;</span></span>72<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>MESSAGE_LINE_NUMBER</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">fx:</span>MANUFACTURER-EXTENSION</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">fx:</span>FRAME</span><span class="token punctuation">&gt;</span></span> 
<span class="token comment">&lt;!--=============== 1. Parameter ==================--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">fx:</span>PDU</span> <span class="token attr-name">ID</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>PDU_1_0<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">ho:</span>SHORT-NAME</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">ho:</span>SHORT-NAME</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">ho:</span>DESC</span><span class="token punctuation">&gt;</span></span>Temperature measurement<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">ho:</span>DESC</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">fx:</span>BYTE-LENGTH</span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">fx:</span>BYTE-LENGTH</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">fx:</span>PDU-TYPE</span><span class="token punctuation">&gt;</span></span>OTHER<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">fx:</span>PDU-TYPE</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">fx:</span>PDU</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--=============== 2. Parameter ==================--&gt;</span> 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">fx:</span>PDU</span> <span class="token attr-name">ID</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>PDU_1_1<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">ho:</span>SHORT-NAME</span><span class="token punctuation">&gt;</span></span>measurement_point<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">ho:</span>SHORT-NAME</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">fx:</span>BYTE-LENGTH</span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">fx:</span>BYTE-LENGTH</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">fx:</span>PDU-TYPE</span><span class="token punctuation">&gt;</span></span>OTHER<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">fx:</span>PDU-TYPE</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">fx:</span>SIGNAL-INSTANCES</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">fx:</span>SIGNAL-INSTANCE</span> <span class="token attr-name">ID</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>S_1_0<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">fx:</span>SEQUENCE-NUMBER</span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">fx:</span>SEQUENCE-NUMBER</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">fx:</span>SIGNAL-REF</span> <span class="token attr-name">ID-REF</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>S_UINT8<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">fx:</span>SIGNAL-INSTANCE</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">fx:</span>SIGNAL-INSTANCES</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">fx:</span>PDU</span><span class="token punctuation">&gt;</span></span> 
<span class="token comment">&lt;!--=============== 3. Parameter ==================--&gt;</span> 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">fx:</span>PDU</span> <span class="token attr-name">ID</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>PDU_1_2<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">ho:</span>SHORT-NAME</span><span class="token punctuation">&gt;</span></span>reading<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">ho:</span>SHORT-NAME</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">fx:</span>BYTE-LENGTH</span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">fx:</span>BYTE-LENGTH</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">fx:</span>PDU-TYPE</span><span class="token punctuation">&gt;</span></span>OTHER<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">fx:</span>PDU-TYPE</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">fx:</span>SIGNAL-INSTANCES</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">fx:</span>SIGNAL-INSTANCE</span> <span class="token attr-name">ID</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>S_1_0<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">fx:</span>SEQUENCE-NUMBER</span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">fx:</span>SEQUENCE-NUMBER</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">fx:</span>SIGNAL-REF</span> <span class="token attr-name">ID-REF</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>FLOA32<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">fx:</span>SIGNAL-INSTANCE</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">fx:</span>SIGNAL-INSTANCES</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">fx:</span>PDU</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<hr> 
<h4><a id="232__108"></a>2.3.2 冗余模式</h4> 
<p>DLT的冗余模式相对于非冗余模式，显而易见，传递的数据更加全面完整，如果ECU的内存和带宽都够，建议使用冗余模式传输DLT消息。</p> 
<p>冗余模式下的DLT消息结构如下图所示：<br> <img src="https://images2.imgbox.com/95/5e/yqMEUYDk_o.png" alt="在这里插入图片描述"><br> 数据负载包含变量的值(即应用程序或中间件的调试信息)，它将在通信总线上传输。除了变量值本身之外，还需要提供变量的大小和类型等信息。该信息包含在Type Info字段中。<br> -Type Info：32位，表示元数据信息。<br> <img src="https://images2.imgbox.com/56/9a/MqdG0pG2_o.png" alt="在这里插入图片描述"><br> 从上图可以看出，Type Info主要描述“Data payload”类型信息。</p> 
<hr> 
<ul><li>Type Length（TYLE）：Type Length指定标准数据类型的长度。比如：规定BOOL型为8位，SINT和UINT为8位、16位、32位、64位、128位，FLOA型为16位、32位、64位、128位。</li><li>Variable Info(VARI): 如果设置了变量信息(VARI)，则可以添加变量的名称和单位。两者都包含一个长度信息字段和一个带有文本(名称或单元)的字段。长度字段包含关联的名称或单元字段的字符数。只在某些数据类型中添加单元信息。</li><li>Fixed Point(FIXP):如果使用定点值，则应设置定点(FIXP)位。比数据字段表示一个固定点变量的物理值。为了解释不动点变量，必须计算这个变量的逻辑值。逻辑值由不动点变量的物理值、量化值q和偏移量o来计算。<br> <strong>逻辑值Lv和物理值Pv之间的关系是Lv=Pv*q + O</strong><br> <strong>不动点必须是整型数据</strong></li><li>String Coding(SCOD): String Coding 仅对String 类型(STRG)的字符串数据进行编码。所有其他字符串，如参数名称、单元和描述都是用8位ASCII格式编码的。</li><li>Bool:如果数据是布尔型，1就代表True，0代表False。</li><li>Signed and Unsigned:整型和无符号整型数据。该位设置时，代表Data payload里的数据是整型和无符号整型数据。</li><li>FLOA：浮点型，该位置1时，代表Data payload里的数据时浮点型数据</li><li>String(STRG):字符串，该位置1时，代表Data payload里的数据是字符串</li><li>Array(ARAY): 该位置1时，代表Data payload里的数据是数组。</li><li>Struct(STRU):该位置1时，代表Data payload里的数据是数组。</li><li>Raw(RAWD):该位置1时，代表Data payload里的数据是原始数据。</li><li>Trace Info(TRAI):该位置1时，跟踪信息(如模块名/函数)应在参数中传递。在数据有效负载的起始，一个16位无符号整数应指定跟踪数据字符串的长度，以字节为单位，包括终止字符。</li></ul> 
<p><strong>介绍了那么多，来个示例解释下自然数据类型参数是如何表示的吧</strong>下面这个示例展示了如何在冗余模式VARI置1的情况下，将一个8位无符号整型数据组装起来。<br> Type Info是描述数据的32位字段。在这个例子中，它定义了变量类型(无符号整数)、它的长度(8位)和描述变量名称和单位的variable Info (VARI)的存在。Variable Info后面跟着两个16位无符号整数，描述变量的Name和Unit的长度。后面跟着两个以空结束的字符串，它们描述了Name和Unit。最后，变量值紧随其后。Data字段的长度是8位。<br> <img src="https://images2.imgbox.com/f9/fc/cOvEBzEU_o.png" alt="在这里插入图片描述"><br> Type Info字段各个位之间的组合表<br> <img src="https://images2.imgbox.com/f7/36/F3BHBEMZ_o.png" alt="在这里插入图片描述"><br> 下表显示了根据使用的变量类型的强制(标记x)和可选(标记o)设置:<br> <img src="https://images2.imgbox.com/26/56/ucNEWPux_o.png" alt="在这里插入图片描述"><br> 为了识别日志或跟踪消息的来源，需要在Dlt消息中添加一些在源代码中找到位置的信息。因此，Dlt消息中的前两个参数应为:</p> 
<ul><li>源文件的名称(字符串)</li><li>代码行(无符号整数)</li></ul> 
<p>日志或跟踪消息的第一个参数应该是一个字符串参数，其中字段“Name”(在Variable Info中)包含字符串“source_file”，数据字段包含源文件的URL。</p> 
<p>日志或跟踪消息的第二个参数应该是UINT参数(32位)，其中字段“Name”(在Variable Info中)包含字符串“line_number”，数据字段包含发送日志或跟踪消息的源文件中的行号。</p> 
<hr> 
<h3><a id="24_DLT_150"></a>2.4 DLT服务(命令）</h3> 
<p>以下章节将介绍已定义的Dlt命令，包括唯一标识(Service ID)、格式和所需参数。<br> 下面的表格表示DLT支持的服务命令：<br> <img src="https://images2.imgbox.com/6e/70/B5VuF1wq_o.png" alt="在这里插入图片描述"><br> <strong>建议定义的Dlt命令可以通过接收相应的Dlt控制消息和/或通过单独的C api触发</strong></p> 
<h2><a id="_156"></a>三、时序图</h2> 
<ul><li>DLT 数据消息传输时序图(Transmission of Dlt Data Message)<br> <img src="https://images2.imgbox.com/78/8c/m0aFmO71_o.png" alt="在这里插入图片描述"></li><li>设置日志登记过滤器(Set LogLevel Filter)<br> <img src="https://images2.imgbox.com/97/50/ydlMUDyY_o.png" alt="在这里插入图片描述"></li><li>缓存溢出(Buffer Overflow)<br> <img src="https://images2.imgbox.com/40/eb/uIwqMJe7_o.png" alt="在这里插入图片描述"></li></ul> 
<h2><a id="_163"></a>四、术语解析</h2> 
<table><thead><tr><th>术语名称</th><th>解释</th></tr></thead><tbody><tr><td>SW-C</td><td>Software Component的缩写，即软件组件，它是组成应用软件的基本单元</td></tr><tr><td>VFB</td><td>VFB(Virtual Function Bus)，也就是虚拟功能总线，而RTE是它的具体实现</td></tr><tr><td>RTE</td><td>运行时环境（RTE）是AUTOSAR ECU体系结构的核心。RTE是AUTOSAR中VFB的接口实现，特定于每个ECU生成的。RTE提供基础的通信服务，支持软件构件间和软件构件到基础软件模块的通信，并提供AUTOSAR软件组件访问基本软件模块（包括OS和通信服务）的服务。</td></tr><tr><td>Metadata</td><td>元数据是关于数据的数据(参考3)</td></tr><tr><td>Log and trace message</td><td>一条日志和追踪消息里包含所有描述软件中的日志和事件追踪的数据和选项。它们由消息头和有效载荷组成</td></tr><tr><td>Dlt User</td><td>DLT用户是指产生Dlt消息的源头。它们可以是应用，RTE或者软件模块</td></tr><tr><td>Log message</td><td>日志消息包含调试信息，如状态变化或值变化。</td></tr><tr><td>Trace Message</td><td>跟踪消息包含通过VFB传递的信息</td></tr><tr><td>FIBEX</td><td>现场总线交换格式是一种通用的XML基础描述格式。</td></tr><tr><td>ECU ID</td><td>ECU ID是一个ECU的名称，由4个8位ASCII字符(如ABS0、COMB)组成</td></tr><tr><td>Session</td><td>会话是日志或跟踪消息源的逻辑实体。如果一个SW-C /应用程序被实例化多次，则使用具有全局唯一会话ID的每个实例的一个会话。</td></tr><tr><td>Session ID</td><td>会话ID是日志或跟踪会话的标识号</td></tr><tr><td>Application ID</td><td>“应用ID”是SW-C / Application的缩写。它标识日志和跟踪消息产生的SW-C /应用程序。</td></tr><tr><td>Context ID</td><td>上下文ID是用户自定义ID，四个8位ASCII字符组成上下文ID。用于对swc /应用程序生成的日志和跟踪消息进行分组。具有以下使用规则：1. 每个应用ID可以拥有几个上下文ID 2.上下文ID由应用ID进行分组 3. 一个应用ID里的上下文ID必须是唯一的 4. 使用元组“应用程序ID”和“上下文ID”标识日志和跟踪消息的源</td></tr><tr><td>Message ID</td><td>消息ID是标识信息的ID，信息由消息本身传输。消息ID唯一地标识日志或跟踪消息。它可以用来标识消息的源(在源代码中)，也可以用来描述消息的有效负载。消息ID是在开发或配置时静态固定的。</td></tr><tr><td>Log level</td><td>日志级别定义了日志消息的严重级别的分类。</td></tr><tr><td>Trace status</td><td>跟踪状态提供了是否应该发送跟踪消息的信息</td></tr><tr><td>Log Channel</td><td>一种用于传输Dlt消息的物理通信总线</td></tr><tr><td>External client</td><td>外部客户端是使用Dlt模块控制、监视和存储ecu提供的日志/跟踪信息的工具。</td></tr><tr><td>PDU</td><td>Protocol Data Unit，PDU包含SDU和PCI，PCI包含源地址和目标地址信息，SDU是数据信息</td></tr></tbody></table> 
<h2><a id="_188"></a>五、参考</h2> 
<p>1.<a href="https://zhuanlan.zhihu.com/p/344079837" rel="nofollow">AUTOSAR虚拟功能总线-VFB</a><br> 2.<a href="https://www.autosar.org/fileadmin/user_upload/standards/foundation/1-0/AUTOSAR_PRS_DiagnosticLogAndTraceProtocol.pdf" rel="nofollow">DLT协议(AutoSAR官方)</a><br> 3.<a href="https://baike.baidu.com/item/%E5%85%83%E6%95%B0%E6%8D%AE/1946090?fromtitle=metadata&amp;fromid=8567615&amp;fr=aladdin" rel="nofollow">元数据</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d9ecb21088594d769ed9dffd5a649a43/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">python 文件读写with open模式r,r&#43; w,w&#43; a,a&#43;区别详解</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/fb187401125e8b8a70baead42f5987c5/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">数据结构 第四章 广义表</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>