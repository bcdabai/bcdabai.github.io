<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ios制作一个仪表盘 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="ios制作一个仪表盘" />
<meta property="og:description" content="我们首先看一下这个速度表盘的效果： [img]http://dl2.iteye.com/upload/attachment/0129/4726/226e1e99-53d5-36b5-a38d-c61635b92e1c.gif[/img] 为了实现上述的效果，我们首当其冲的是得了解的是贝塞尔曲线，听上去好高大上的样子，接下来我先就我了解贝塞尔曲线的知识给未接触的朋友普及一下。 Bézier curve(贝塞尔曲线)是应用于二维图形应用程序的数学曲线.主要有起始点、终止点（也称锚点）、控制点这几个概念。通过调整控制点，贝塞尔曲线的形状会发生变化。
大家先欣赏一下各种贝塞尔曲线 一阶 [img]http://dl2.iteye.com/upload/attachment/0129/4728/ada01aab-71d8-3343-b143-f12379a76ee0.gif[/img] 二阶 [img]http://dl2.iteye.com/upload/attachment/0129/4730/c9cfbded-3be3-3673-85ab-6906d1f3a313.gif[/img] 三阶 [img]http://dl2.iteye.com/upload/attachment/0129/4732/8c153e85-82c8-36d1-af2f-4a82cb668f26.gif[/img] 高阶 [img]http://dl2.iteye.com/upload/attachment/0129/4734/14075e50-e6d2-310e-8602-5b341dd2ff81.gif[/img] 我们要完成上述表盘的效果，需要用到的就是贝塞尔曲线！ 我们看一下苹果官方文档对它的介绍 The UIBezierPath class lets you define a path consisting of straight and curved line segments and render that path in your custom views. You use this class initially to specify just the geometry for your path. Paths can define simple shapes such as rectangles, ovals, and arcs or they can define complex polygons that incorporate a mixture of straight and curved line segments." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/198f7b3f40f19d610b3f2bd58e02ec23/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-04-09T11:09:24+08:00" />
<meta property="article:modified_time" content="2018-04-09T11:09:24+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ios制作一个仪表盘</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    我们首先看一下这个速度表盘的效果： 
<br>[img]http://dl2.iteye.com/upload/attachment/0129/4726/226e1e99-53d5-36b5-a38d-c61635b92e1c.gif[/img] 
<br>为了实现上述的效果，我们首当其冲的是得了解的是贝塞尔曲线，听上去好高大上的样子，接下来我先就我了解贝塞尔曲线的知识给未接触的朋友普及一下。 
<br> 
<pre><code class="language-java"><br>Bézier curve(贝塞尔曲线)是应用于二维图形应用程序的数学曲线.主要有起始点、终止点（也称锚点）、控制点这几个概念。通过调整控制点，贝塞尔曲线的形状会发生变化。<br></code></pre> 
<br>大家先欣赏一下各种贝塞尔曲线 
<br> 
<br>一阶 
<br>[img]http://dl2.iteye.com/upload/attachment/0129/4728/ada01aab-71d8-3343-b143-f12379a76ee0.gif[/img] 
<br>二阶 
<br>[img]http://dl2.iteye.com/upload/attachment/0129/4730/c9cfbded-3be3-3673-85ab-6906d1f3a313.gif[/img] 
<br>三阶 
<br>[img]http://dl2.iteye.com/upload/attachment/0129/4732/8c153e85-82c8-36d1-af2f-4a82cb668f26.gif[/img] 
<br>高阶 
<br>[img]http://dl2.iteye.com/upload/attachment/0129/4734/14075e50-e6d2-310e-8602-5b341dd2ff81.gif[/img] 
<br>我们要完成上述表盘的效果，需要用到的就是贝塞尔曲线！ 
<br>我们看一下苹果官方文档对它的介绍 
<br> 
<pre><code class="language-java"><br>The UIBezierPath class lets you define a path consisting of straight and curved line segments and render that path in your custom views. You use this class initially to specify just the geometry for your path. Paths can define simple shapes such as rectangles, ovals, and arcs or they can define complex polygons that incorporate a mixture of straight and curved line segments. After defining the shape, you can use additional methods of this class to render the path in the current drawing context.<br></code></pre> 
<br>上述文字简单翻译一下的意思是：你可以使用贝塞尔曲线来定义直线和曲线和自定义的图形。官方还有很长的篇幅来解释它，有兴趣的可以去看。 
<br>下面我主要介绍UIBezierPath和CAShapeLayer一起使用，完成上述表盘的效果，我默认你已经经过查找资料对他们很熟悉。 
<br> 
<br>首先我们分解步骤 
<br> 
<br>1.画出内侧的圆弧 
<br>[img]http://dl2.iteye.com/upload/attachment/0129/4736/840a0d8b-b142-3df1-b361-ac2f789ef368.png[/img] 
<br>苹果官方提供了3阶以下的api接口，我使用一个二阶的api,实现圆弧。 
<br> 
<pre><code class="language-java"><br>//主要解释一下各个参数的意思<br>    //center  中心点（可以理解为圆心）<br>    //radius  半径<br>    //startAngle 起始角度<br>    //endAngle  结束角度<br>    //clockwise  是否顺时针<br>    UIBezierPath *cicrle     = [UIBezierPath bezierPathWithArcCenter:centers<br>                                                              radius:95<br>                                                              startAngle:- M_PI<br>                                                              endAngle: 0<br>                                                              clockwise:YES];<br>    CAShapeLayer *shapeLayer = [CAShapeLayer layer];<br>    shapeLayer.lineWidth     = 5.f;<br>    shapeLayer.fillColor     = [UIColor clearColor].CGColor;<br>    shapeLayer.strokeColor   = RGBColor(185,243,110).CGColor;<br>    shapeLayer.path          = cicrle.CGPath;<br><br>    [self.layer addSublayer:shapeLayer];<br></code></pre> 
<br>弧线的参考系： 
<br>[img]http://dl2.iteye.com/upload/attachment/0129/4738/fd1cf1e6-dd69-3e65-adb0-4cb521cbc1da.png[/img] 
<br>2.画出外侧的刻度 
<br>[img]http://dl2.iteye.com/upload/attachment/0129/4740/f55d2d0f-d94b-377d-8a70-0a842eb7efc1.png[/img] 
<br> 
<pre><code class="language-java"><br>CGFloat perAngle = M_PI / 50;<br>//我们需要计算出每段弧线的起始角度和结束角度<br>//这里我们从- M_PI 开始，我们需要理解与明白的是我们画的弧线与内侧弧线是同一个圆心<br>  for (int i = 0; i&lt; 51; i++) {<!-- --><br><br>        CGFloat startAngel = (-M_PI + perAngle * i);<br>        CGFloat endAngel   = startAngel + perAngle/5;<br><br>        UIBezierPath *tickPath = [UIBezierPath bezierPathWithArcCenter:centers radius:150 startAngle:startAngel endAngle:endAngel clockwise:YES];<br>        CAShapeLayer *perLayer = [CAShapeLayer layer];<br><br>        if (i % 5 == 0) {<!-- --><br><br>            perLayer.strokeColor = [UIColor colorWithRed:0.62 green:0.84 blue:0.93 alpha:1.0].CGColor;<br>            perLayer.lineWidth   = 10.f;<br><br>        }else{<!-- --><br>            perLayer.strokeColor = [UIColor colorWithRed:0.22 green:0.66 blue:0.87 alpha:1.0].CGColor;<br>            perLayer.lineWidth   = 5;<br><br>        }<br><br>        perLayer.path = tickPath.CGPath;<br>        [self.layer addSublayer:perLayer];<br><br>    }<br></code></pre> 
<br>3.增加刻度值 
<br>[img]http://dl2.iteye.com/upload/attachment/0129/4742/375e8917-0a78-329a-b17b-4696d66d901b.png[/img] 
<br>需要使用创建label的方式，首先我们得计算出label的position,然后添加 
<br> 
<pre><code class="language-java"><br>CGPoint point      = [self calculateTextPositonWithArcCenter:centers Angle:textAngel];<br>            NSString *tickText = [NSString stringWithFormat:@"%d",i * 2];<br><br>            //默认label的大小14 * 14<br>            UILabel *text      = [[UILabel alloc] initWithFrame:CGRectMake(point.x - 5, point.y - 5, 14, 14)];<br>            text.text          = tickText;<br>            text.font          = font;<br>            text.textColor     = [UIColor colorWithRed:0.54 green:0.78 blue:0.91 alpha:1.0];<br>            text.textAlignment = NSTextAlignmentCenter;<br>            [self addSubview:text];<br>//默认计算半径135<br>- (CGPoint)calculateTextPositonWithArcCenter:(CGPoint)center<br>                                       Angle:(CGFloat)angel<br>{<!-- --><br>    CGFloat x = 135 * cosf(angel);<br>    CGFloat y = 135 * sinf(angel);<br><br>    return CGPointMake(center.x + x, center.y - y);<br>}<br></code></pre> 
<br>4.实现速度显示（实现方式很多，可以是Label,也可以画出来，就不赘述） 
<br>这里说一下画的方式 
<br> 
<pre><code class="language-java"><br>- (void)drawRect:(CGRect)rect<br>{<!-- --><br>     NSDictionary *attributes = [NSDictionary dictionaryWithObjectsAndKeys:[UIFont boldSystemFontOfSize:15],NSFontAttributeName,[UIColor whiteColor], NSForegroundColorAttributeName, nil];<br>    [@"km/h" drawInRect:CGRectMake(centers.x - 15, centers.y, 60, 20) withAttributes:attributes];<br>}<br></code></pre> 
<br>5.实现进度 
<br> 
<pre><code class="language-java"><br>// 进度的曲线<br>    UIBezierPath *progressPath  = [UIBezierPath bezierPathWithArcCenter:centers<br>                                                                radius:120<br>                                                                startAngle:- M_PI<br>                                                                endAngle:0<br>                                                                clockwise:YES];<br>                  progressLayer = [CAShapeLayer layer];<br>    progressLayer.lineWidth     =  50.f;<br>    progressLayer.fillColor     = [UIColor clearColor].CGColor;<br>    progressLayer.strokeColor   =  RGBAColor(185,243,110,0.2).CGColor;<br>    progressLayer.path          = progressPath.CGPath;<br>    progressLayer.strokeStart   = 0;<br>    progressLayer.strokeEnd     = 0;<br></code></pre> 
<br>我们只需要改变strokeEnd即可实现速度变化，默认0~1之间。 
<br> 
<pre><code class="language-java"><br>//提供一个外部的接口，通过重写setter方法来改变进度<br><br>- (void)setSpeed:(double)speed<br>{<!-- --><br>                     _speed = speed;<br>    progressLayer.strokeEnd = _speed? _speed/100:0;<br>    speedLabel.text = [NSString stringWithFormat:@"%.f",speed];<br>}<br></code></pre> 
<br>我们可以在外部通过定时器方法模拟速度表盘的变化，即可实现上述速度表盘。 
<br> 
<br>结尾：本文只是简单的介绍一种思路，个人感觉可以优化的空间很多，打算整理写一个上传gitHub的三方库，提供多个可供外界改变的接口，希望有兴趣的朋友一起来做，维护这个库，欢迎私信联系。
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1d094721a08815507fd869b27cc0c194/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">JAVA请求url并获取返回数据</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/5da799fbaecc629cbacee9c78034fb22/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【机器学习详解】SVM解二分类,多分类,及后验概率输出</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>