<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【干货】Shell编程心得 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【干货】Shell编程心得" />
<meta property="og:description" content="文章目录 前言符合代码规范代码有注释参数要规范变量和魔鬼数字缩进有规矩命名有标准编码要统一文件可执行权限错误处理和调试回显密码要移除太长要分行勤用引号使用新写法数值计算文件结构SUID SGID SBIT勤查资料勤练习、勤分享 前言 随着技术的发展，虽然出现了许多现代的编程语言，但Shell编程由于其独特的优势——简洁性、高效性和在Linux系统中的无处不在，仍然保持着其重要性。
以下是笔者多年积累的一些Shell编程心得，这些心得涵盖了从基础语法到高级功能的各个方面，无论是初学者还是有经验的开发者，都可以从中受益。通过这些心得，你将能够编写出更加高效、健壮且易于维护的Shell脚本，为你的自动化任务和系统管理工作带来便利。
符合代码规范 shell文件开头有以”#!”开头的注释，学名Shebang，也称为Hashbang、“蛇棒”，如：
#!/bin/sh 如果编写的a.sh没有开头的注释，执行 ./a.sh时系统会默认用$SHELL指定的解释器，因解释器的兼容性等问题，会出现一些不可预料的问题。
Centos7.6 相关内容示例
推荐写法：
#!/usr/bin/env bash 代码有注释 注释的作用是让代码可读性更强，方便维护人员快速上手；也方便编写人员逻辑梳理。
一般包含以下几部分：
Shebang文件头脚本的参数脚本的用途脚本的注意事项脚本的写作时间，作者，版权等 例如：
各个函数前的说明注释
一些较复杂的单行命令注释
参数要规范 如果脚本需要接收参数，需要进行合理判断和处理需要合适的回显，方便使用者了解参数的使用 最简单的参数个数判断示例
if [[ $## != 2 ]];then echo &#34;Parameter incorrect.&#34; exit 1 fi 变量和魔鬼数字 变量大写加下划线在文件头部定义
如：
## configurations CODE_PATH=&#34;/root/work/workspace/og-apus/og-apus&#34; OGAPUS_RELEASE_FOLDER=&#34;/root/work/workspace/og-apus/release&#34; OGSP4_BUILD_PATH=&#34;/root/work/ogsp4-release-env/base/images&#34; OGAPUS_RELEASE_PATH_ON_PDD=&#34;/pdd-release/og-apus/docker-images&#34; 避免魔鬼数字，如果必须使用数字，请用变量定义，并注意变量名称可读性，适当添加变量定义注释。
缩进有规矩 推荐使用工具自动格式化，vscode &#43; shell-format插件
两种缩进类型：
soft tab：就是使用n个空格进行缩进(n通常是2或4)hard tab：指真实的&#34;\t&#34;制表符字符 不评论优劣，推荐两个空格
命名有标准 文件名规范，以.sh结尾，方便识别变量名字要有含义，不要拼错统一命名风格，shell一般用小写字母加下划线，不建议使用驼峰命名。 编码要统一 请使用UTF-8编码格式如编码格式不正确，可使用命令 dos2unix a.sh进行格式修复 常见问题：windows下未专门配置过utf8为默认编码格式的编辑器，回车换行是 \r\n， utf8下是\n
文件可执行权限 不加可执行权限： bash a." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/392de7481b527372505b71ca914f6861/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-24T19:54:37+08:00" />
<meta property="article:modified_time" content="2023-12-24T19:54:37+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【干货】Shell编程心得</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><a href="#_1" rel="nofollow">前言</a></li><li><a href="#_7" rel="nofollow">符合代码规范</a></li><li><a href="#_29" rel="nofollow">代码有注释</a></li><li><a href="#_52" rel="nofollow">参数要规范</a></li><li><a href="#_66" rel="nofollow">变量和魔鬼数字</a></li><li><a href="#_84" rel="nofollow">缩进有规矩</a></li><li><a href="#_97" rel="nofollow">命名有标准</a></li><li><a href="#_105" rel="nofollow">编码要统一</a></li><li><a href="#_114" rel="nofollow">文件可执行权限</a></li><li><a href="#_123" rel="nofollow">错误处理和调试</a></li><li><a href="#_132" rel="nofollow">回显</a></li><li><a href="#_140" rel="nofollow">密码要移除</a></li><li><a href="#_146" rel="nofollow">太长要分行</a></li><li><a href="#_159" rel="nofollow">勤用引号</a></li><li><a href="#_173" rel="nofollow">使用新写法</a></li><li><a href="#_181" rel="nofollow">数值计算</a></li><li><a href="#_187" rel="nofollow">文件结构</a></li><li><a href="#SUID_SGID_SBIT_199" rel="nofollow">SUID SGID SBIT</a></li><li><a href="#_205" rel="nofollow">勤查资料</a></li><li><a href="#_212" rel="nofollow">勤练习、勤分享</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="_1"></a>前言</h3> 
<p>随着技术的发展，虽然出现了许多现代的编程语言，但Shell编程由于其独特的优势——简洁性、高效性和在Linux系统中的无处不在，仍然保持着其重要性。</p> 
<p>以下是笔者多年积累的一些Shell编程心得，这些心得涵盖了从基础语法到高级功能的各个方面，无论是初学者还是有经验的开发者，都可以从中受益。通过这些心得，你将能够编写出更加高效、健壮且易于维护的Shell脚本，为你的自动化任务和系统管理工作带来便利。</p> 
<h3><a id="_7"></a>符合代码规范</h3> 
<p>shell文件开头有以”#!”开头的注释，学名Shebang，也称为Hashbang、“蛇棒”，如：</p> 
<pre><code>#!/bin/sh
</code></pre> 
<p>如果编写的a.sh没有开头的注释，执行 ./a.sh时系统会默认用$SHELL指定的解释器，因解释器的兼容性等问题，会出现一些不可预料的问题。</p> 
<p><img src="https://images2.imgbox.com/4e/46/WwWuh0ec_o.png" alt="image-20231224140321085"></p> 
<p>Centos7.6 相关内容示例</p> 
<p>推荐写法：</p> 
<pre><code>#!/usr/bin/env bash
</code></pre> 
<h3><a id="_29"></a>代码有注释</h3> 
<p>注释的作用是让代码可读性更强，方便维护人员快速上手；也方便编写人员逻辑梳理。</p> 
<p>一般包含以下几部分：</p> 
<ol><li>Shebang</li><li>文件头</li><li>脚本的参数</li><li>脚本的用途</li><li>脚本的注意事项</li><li>脚本的写作时间，作者，版权等</li></ol> 
<p>例如：</p> 
<p><img src="https://images2.imgbox.com/00/80/BsGi6Emf_o.png" alt="image-20231224143718031"></p> 
<ul><li> <p>各个函数前的说明注释</p> </li><li> <p>一些较复杂的单行命令注释</p> </li></ul> 
<h3><a id="_52"></a>参数要规范</h3> 
<ul><li>如果脚本需要接收参数，需要进行合理判断和处理</li><li>需要合适的回显，方便使用者了解参数的使用</li></ul> 
<p>最简单的参数个数判断示例</p> 
<pre><code>if [[ $## != 2 ]];then
    echo "Parameter incorrect."
    exit 1
fi 
</code></pre> 
<h3><a id="_66"></a>变量和魔鬼数字</h3> 
<p>变量大写加下划线在文件头部定义</p> 
<p>如：</p> 
<pre><code>## configurations
CODE_PATH="/root/work/workspace/og-apus/og-apus"
OGAPUS_RELEASE_FOLDER="/root/work/workspace/og-apus/release"
OGSP4_BUILD_PATH="/root/work/ogsp4-release-env/base/images"
OGAPUS_RELEASE_PATH_ON_PDD="/pdd-release/og-apus/docker-images"
</code></pre> 
<p>避免魔鬼数字，如果必须使用数字，请用变量定义，并注意变量名称可读性，适当添加变量定义注释。</p> 
<h3><a id="_84"></a>缩进有规矩</h3> 
<p>推荐使用工具自动格式化，vscode + shell-format插件</p> 
<p>两种缩进类型：</p> 
<ul><li>soft tab：就是使用n个<strong>空格</strong>进行缩进(n通常是2或4)</li><li>hard tab：指真实的"\t"制表符字符</li></ul> 
<p>不评论优劣，推荐两个空格</p> 
<h3><a id="_97"></a>命名有标准</h3> 
<ul><li>文件名规范，以.sh结尾，方便识别</li><li>变量名字要有含义，不要拼错</li><li>统一命名风格，shell一般用小写字母加下划线，不建议使用驼峰命名。</li></ul> 
<h3><a id="_105"></a>编码要统一</h3> 
<ul><li>请使用UTF-8编码格式</li><li>如编码格式不正确，可使用命令 dos2unix a.sh进行格式修复</li></ul> 
<p>常见问题：windows下未专门配置过utf8为默认编码格式的编辑器，回车换行是 \r\n， utf8下是\n</p> 
<h3><a id="_114"></a>文件可执行权限</h3> 
<ul><li>不加可执行权限： bash a.sh</li><li>加可执行权限： ./a.sh</li></ul> 
<p>常见的出错是通过 ./a.sh执行，但是未对a.sh赋予可执行权限。</p> 
<h3><a id="_123"></a>错误处理和调试</h3> 
<ul><li> <p>实现适当的错误处理机制，如使用 <code>set -e</code> 以在命令失败时停止执行。</p> </li><li> <p>使用 <code>set -x</code> 来调试脚本，了解执行流程。</p> </li><li> <p>标准文档要有标准日志输出</p> </li></ul> 
<h3><a id="_132"></a>回显</h3> 
<ul><li>回显必要信息给使用者，方便判断进度、问题等</li><li>时间信息，关键事件/状态</li><li>可通过颜色、闪烁等效果突出特定回显内容，如：</li></ul> 
<p><img src="https://images2.imgbox.com/e3/a5/kCTLgV7p_o.png" alt="image-20231224143011616"></p> 
<h3><a id="_140"></a>密码要移除</h3> 
<p>！！！<strong>不要把密码放在脚本里，尤其是公用代码仓库时</strong>！！！</p> 
<h3><a id="_146"></a>太长要分行</h3> 
<p>使用反斜杠分行，如：</p> 
<pre><code>./configure \
–prefix=/usr \
–sbin-path=/usr/sbin/nginx \
–conf-path=/etc/nginx/nginx.conf \
</code></pre> 
<h3><a id="_159"></a>勤用引号</h3> 
<ul><li>推荐在使用”$”来获取变量的时候最好加上双引号</li><li>注意单双引号的区别： 
  <ul><li>双引号内部有转义符的内容会被转义</li><li>单引号原样输出，即使有转义符也不做转义，直接输出</li></ul> </li></ul> 
<p>参考：</p> 
<p>[ ]: https://www.shellcheck.net/wiki/SC2086 “SC2086”</p> 
<h3><a id="_173"></a>使用新写法</h3> 
<ul><li>尽量使用func( ){ }来定义函数，而不是func{ }</li><li>尽量使用[[ ]]来代替[ ]</li><li>尽量使用$()将命令的结果赋给变量，而不是反引号在复杂的场景下尽量使用## #printf代替echo进行回显</li></ul> 
<p><img src="https://images2.imgbox.com/34/e6/1nRLiUqf_o.png" alt="image-20231224143407192"></p> 
<h3><a id="_181"></a>数值计算</h3> 
<p>expr 和 (())，推荐用(())，原因是执行效率高很多倍</p> 
<h3><a id="_187"></a>文件结构</h3> 
<pre><code>## 头部： 
## 参数处理，变量定义
## --------
## 函数部分：函数定义
## --------
## 执行逻辑
## 调用函数的逻辑顺序
</code></pre> 
<h3><a id="SUID_SGID_SBIT_199"></a>SUID SGID SBIT</h3> 
<ul><li>脚本中禁止使用文件特殊权限操作</li></ul> 
<p>参考：<a href="https://cloud.tencent.com/developer/article/1398144" rel="nofollow">Linux文件特殊权限SUID、SGID与SBIT-腾讯云开发者社区-腾讯云</a></p> 
<h3><a id="_205"></a>勤查资料</h3> 
<ul><li>Shell编程没有难度，主要是习惯的养成和知识点的积累，用的多了，思考的多了，写起来就得心应手</li><li>知识点容易遗忘，遇到了顺手查，养成习惯</li></ul> 
<h3><a id="_212"></a>勤练习、勤分享</h3> 
<p><strong>偷懒</strong>，某种程度上是推动人类进步的一种力量</p> 
<ul><li>脚本的核心思想，把复杂问题分解成简单的小问题，把重复性人力劳动通过代码脚本实现，同时借助Linux的Crontab定时机制，可以处理很多实际的问题和需求</li><li>除工作任务外，善于发现可”偷懒“的场景，善于发现可通过脚本、工具提炼的场景，动手练习，推广试用，反馈改进，持续提升</li><li>坚信：三人行必有我师，勤分享勤讨论，能碰撞出不一样的灵感和收获</li></ul> 
<hr> 
<p>【星猿科技】：在这里我们共同探索科技新趋势，分享积累的点滴，从人工智能到高性能计算，我们追求技术的进步，同时珍视分享的力量。欢迎关注我们，在科技与影视的精彩世界中一起遨游，发现更多未知！</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/00d3d2ad759e1e6e5c9647326a7ca53e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">网址变迁权重不减：301 重定向的黄金法宝</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b9a251707c0a0f58876435325db62c63/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">python安装pyecharts模块报错解决方法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>