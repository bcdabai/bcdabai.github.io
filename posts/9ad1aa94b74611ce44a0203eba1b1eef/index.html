<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Docker容器------网络与资源控制 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Docker容器------网络与资源控制" />
<meta property="og:description" content="Docker 网络与资源控制 一、Docker 网络安装Docker时，它会自动创建三个网络，bridge（创建容器默认连接到此网络）、 none 、hostDocker 网络实现原理Docker 的网络模式使用docker run创建Docker容器时，可以用 --net 或 --network 选项指定容器的网络模式网络模式详解1．host模式2．container模式3．none模式4．Bridge模式5．自定义网络 二、Docker 资源控制1．CPU 资源控制设置CPU使用率上限进行CPU压力测试设置CPU资源占用比（设置多个容器时才有效）设置容器绑定指定的CPU 2．对内存使用的限制3．对磁盘IO配额控制（blkio）的限制 总结 一、Docker 网络 安装Docker时，它会自动创建三个网络，bridge（创建容器默认连接到此网络）、 none 、host docker network ls	#查看docker网络列表 NETWORK ID NAME DRIVER SCOPE 213acadb1f5b bridge bridge local b44cb53b01a5 host host local 580d38868d88 none null local Docker 网络实现原理 Docker使用Linux桥接，在宿主机虚拟一个Docker容器网桥(docker0)，Docker启动一个容器时会根据Docker网桥的网段分配给容器一个IP地址，称为Container-IP，同时Docker网桥是每个容器的默认网关。因为在同一宿主机内的容器都接入同一个网桥，这样容器之间就能够通过容器的 Container-IP 直接通信。
Docker网桥是宿主机虚拟出来的，并不是真实存在的网络设备，外部网络是无法寻址到的，这也意味着外部网络无法直接通过 Container-IP 访问到容器。如果容器希望外部访问能够访问到，可以通过映射容器端口到宿主主机（端口映射），即 docker run 创建容器时候通过 -p 或 -P 参数来启用，访问容器的时候就通过[宿主机IP]:[容器端口]访问容器。
docker run -d --name test1 -P nginx #随机映射端口( 从32768开始) docker run -d --name test2 -p 43000:80 nginx #指定映射端口 Docker 的网络模式 网络模式Host容器将不会虚拟出自己的网卡，配置自己的IP等，而是使用宿主机的IP和端口。Container创建的容器不会创建自己的网卡，配置自己的IP，而是和一个指定的容器共享IP、端口范围。None该模式关闭了容器的网络功能。Bridge默认为该模式，此模式会为每一个容器分配、设置IP等，并将容器连接到一个docker0虚拟网桥，通过docker0网桥以及iptables nat 表配置与宿主机通信。自定义网络 使用docker run创建Docker容器时，可以用 --net 或 --network 选项指定容器的网络模式 模式命令host模式使用 --net=host 指定。none模式使用 --net=none 指定。container模式使用 --net=container:NAME_or_ID 指定。bridge模式使用 --net=bridge 指定，默认设置，可省略。 网络模式详解 1．host模式 相当于Vmware中的桥接模式，与宿主机在同一个网络中，但没有独立IP地址。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/9ad1aa94b74611ce44a0203eba1b1eef/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-07-27T08:02:50+08:00" />
<meta property="article:modified_time" content="2021-07-27T08:02:50+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Docker容器------网络与资源控制</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <hr color="#000000" size='1"'> 
<font color="#999AAA"> </font> 
<p></p> 
<div class="toc"> 
 <h4>Docker 网络与资源控制</h4> 
 <ul><li><a href="#Docker__6" rel="nofollow">一、Docker 网络</a></li><li><ul><li><a href="#Dockerbridge_none_host_7" rel="nofollow">安装Docker时，它会自动创建三个网络，bridge（创建容器默认连接到此网络）、 none 、host</a></li><li><a href="#Docker__16" rel="nofollow">Docker 网络实现原理</a></li><li><a href="#Docker__26" rel="nofollow">Docker 的网络模式</a></li><li><a href="#docker_runDocker_net__network__36" rel="nofollow">使用docker run创建Docker容器时，可以用 --net 或 --network 选项指定容器的网络模式</a></li><li><a href="#_44" rel="nofollow">网络模式详解</a></li><li><ul><li><a href="#1host_45" rel="nofollow">1．host模式</a></li><li><a href="#2container_51" rel="nofollow">2．container模式</a></li><li><a href="#3none_103" rel="nofollow">3．none模式</a></li><li><a href="#font_colorred4Bridge_106" rel="nofollow"><font color="red">4．Bridge模式</font></a></li><li><a href="#5_122" rel="nofollow">5．自定义网络</a></li></ul> 
  </li></ul> 
  </li><li><a href="#Docker__136" rel="nofollow">二、Docker 资源控制</a></li><li><ul><li><a href="#1CPU__137" rel="nofollow">1．CPU 资源控制</a></li><li><ul><li><a href="#CPU_148" rel="nofollow">设置CPU使用率上限</a></li><li><a href="#CPU_182" rel="nofollow">进行CPU压力测试</a></li><li><a href="#CPU_227" rel="nofollow">设置CPU资源占用比（设置多个容器时才有效）</a></li><li><a href="#CPU_260" rel="nofollow">设置容器绑定指定的CPU</a></li></ul> 
   </li><li><a href="#2_279" rel="nofollow">2．对内存使用的限制</a></li><li><a href="#3IOblkio_289" rel="nofollow">3．对磁盘IO配额控制（blkio）的限制</a></li></ul> 
  </li><li><a href="#_317" rel="nofollow">总结</a></li></ul> 
</div> 
<p></p> 
<h2><a id="Docker__6"></a>一、Docker 网络</h2> 
<h3><a id="Dockerbridge_none_host_7"></a>安装Docker时，它会自动创建三个网络，bridge（创建容器默认连接到此网络）、 none 、host</h3> 
<pre><code class="prism language-handlebars"><span class="token variable">docker</span> <span class="token variable">network</span> <span class="token variable">ls</span>				<span class="token punctuation">#</span><span class="token variable">查看docker网络列表</span>
<span class="token variable">NETWORK</span> <span class="token variable">ID</span>          <span class="token variable">NAME</span>                <span class="token variable">DRIVER</span>              <span class="token variable">SCOPE</span>
<span class="token number">213</span><span class="token variable">acadb1f5b</span>        <span class="token variable">bridge</span>              <span class="token variable">bridge</span>              <span class="token variable">local</span>
<span class="token variable">b44cb53b01a5</span>        <span class="token variable">host</span>                <span class="token variable">host</span>                <span class="token variable">local</span>
<span class="token number">580</span><span class="token variable">d38868d88</span>        <span class="token variable">none</span>                <span class="token variable">null</span>                <span class="token variable">local</span>
</code></pre> 
<h3><a id="Docker__16"></a>Docker 网络实现原理</h3> 
<p>Docker使用Linux桥接，在宿主机虚拟一个Docker容器网桥(docker0)，Docker启动一个容器时会根据Docker网桥的网段分配给容器一个IP地址，称为Container-IP，同时Docker网桥是每个容器的默认网关。因为在同一宿主机内的容器都接入同一个网桥，这样容器之间就能够通过容器的 Container-IP 直接通信。<br> Docker网桥是宿主机虚拟出来的，并不是真实存在的网络设备，外部网络是无法寻址到的，这也意味着外部网络无法直接通过 Container-IP 访问到容器。如果容器希望外部访问能够访问到，可以通过映射容器端口到宿主主机（<mark>端口映射</mark>），<mark>即 docker run 创建容器时候通过 -p 或 -P 参数来启用</mark>，访问容器的时候就通过[宿主机IP]:[容器端口]访问容器。</p> 
<pre><code class="prism language-handlebars"><span class="token variable">docker</span> <span class="token variable">run</span> <span class="token variable">-d</span> <span class="token variable">--name</span> <span class="token variable">test1</span> <span class="token variable">-P</span> <span class="token variable">nginx</span>                <span class="token punctuation">#</span><span class="token variable">随机映射端口</span><span class="token punctuation">(</span> <span class="token variable">从</span><span class="token number">32768</span><span class="token variable">开始</span><span class="token punctuation">)</span>
<span class="token variable">docker</span> <span class="token variable">run</span> <span class="token variable">-d</span> <span class="token variable">--name</span> <span class="token variable">test2</span> <span class="token variable">-p</span> <span class="token number">43000</span><span class="token punctuation">:</span><span class="token number">80</span> <span class="token variable">nginx</span>       <span class="token punctuation">#</span><span class="token variable">指定映射端口</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/b9/b8/PdDgWQKm_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="Docker__26"></a>Docker 的网络模式</h3> 
<table><thead><tr><th>网络</th><th>模式</th></tr></thead><tbody><tr><td>Host</td><td>容器将不会虚拟出自己的网卡，配置自己的IP等，而是使用宿主机的IP和端口。</td></tr><tr><td>Container</td><td>创建的容器不会创建自己的网卡，配置自己的IP，而是和一个指定的容器共享IP、端口范围。</td></tr><tr><td>None</td><td>该模式关闭了容器的网络功能。</td></tr><tr><td>Bridge</td><td>默认为该模式，此模式会为每一个容器分配、设置IP等，并将容器连接到一个docker0虚拟网桥，通过docker0网桥以及iptables nat 表配置与宿主机通信。</td></tr><tr><td>自定义网络</td><td></td></tr></tbody></table> 
<p><img src="https://images2.imgbox.com/5f/bb/jLXK9W0U_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="docker_runDocker_net__network__36"></a>使用docker run创建Docker容器时，可以用 --net 或 --network 选项指定容器的网络模式</h3> 
<table><thead><tr><th>模式</th><th>命令</th></tr></thead><tbody><tr><td>host模式</td><td>使用 --net=host 指定。</td></tr><tr><td>none模式</td><td>使用 --net=none 指定。</td></tr><tr><td>container模式</td><td>使用 --net=container:NAME_or_ID 指定。</td></tr><tr><td>bridge模式</td><td>使用 --net=bridge 指定，默认设置，可省略。</td></tr></tbody></table> 
<h3><a id="_44"></a>网络模式详解</h3> 
<h4><a id="1host_45"></a>1．host模式</h4> 
<p>相当于Vmware中的桥接模式，<mark>与宿主机在同一个网络中，但没有独立IP地址</mark>。<br> Docker使用了Linux的Namespaces技术来进行资源隔离，如PID Namespace隔离进程，Mount Namespace隔离文件系统，Network Namespace隔离网络等。<br> 一个Network Namespace提供了一份独立的网络环境，包括网卡、路由、iptable规则等都与其他的Network Namespace隔离。 一个Docker容器一般会分配一个独立的Network Namespace。 但如果启动容器的时候使用host模式，那么这个容器将不会获得一个独立的Network Namespace， 而是和宿主机共用一个Network Namespace。容器将不会虚拟出自己的网卡、配置自己的IP等，而是使用宿主机的IP和端口。</p> 
<h4><a id="2container_51"></a>2．container模式</h4> 
<p>在理解了host模式后，这个模式也就好理解了。这个模式<mark>指定新创建的容器和已经存在的一个容器共享一个Network Namespace</mark>，而不是和宿主机共享。新创建的容器不会创建自己的网卡，配置自己的IP，而是和一个指定的容器共享IP、端口范围等。同样，两个容器除了网络方面，其他的如文件系统、进程列表等还是隔离的。两个容器的进程可以通过lo网卡设备通信。<br> docker run -itd --name test1 centos:7 /bin/bash #–name 选项可以给容器创建一个友好的自定义名称</p> 
<pre><code class="prism language-handlebars"><span class="token variable">docker</span> <span class="token variable">ps</span> <span class="token variable">-a</span>
<span class="token variable">docker</span> <span class="token variable">run</span> <span class="token variable">-itd</span> <span class="token variable">--name</span> <span class="token variable">sy1</span> <span class="token variable">--net</span><span class="token punctuation">=</span><span class="token variable">container</span><span class="token punctuation">:</span><span class="token variable">f9a769c6de37</span> <span class="token variable">docker</span><span class="token punctuation">.</span><span class="token variable">io</span><span class="token punctuation">/</span><span class="token variable">centos</span><span class="token punctuation">:</span><span class="token number">7</span> <span class="token block keyword">/bin/bash</span>
</code></pre> 
<pre><code class="prism language-handlebars"><span class="token variable">CONTAINER</span> <span class="token variable">ID</span>        <span class="token variable">IMAGE</span>                <span class="token variable">COMMAND</span>                  <span class="token variable">CREATED</span>             <span class="token variable">STATUS</span>                   <span class="token variable">PORTS</span>               <span class="token variable">NAMES</span>
<span class="token number">6</span><span class="token variable">bd695985cee</span>        <span class="token variable">docker</span><span class="token punctuation">.</span><span class="token variable">io</span><span class="token punctuation">/</span><span class="token variable">centos</span><span class="token punctuation">:</span><span class="token number">7</span>   <span class="token string">"/bin/bash"</span>              <span class="token number">3</span> <span class="token variable">minutes</span> <span class="token variable">ago</span>       <span class="token variable">Up</span> <span class="token number">11</span> <span class="token variable">seconds</span>                                <span class="token variable">sy1</span>
<span class="token variable">f9a769c6de37</span>        <span class="token variable">docker</span><span class="token punctuation">.</span><span class="token variable">io</span><span class="token punctuation">/</span><span class="token variable">centos</span><span class="token punctuation">:</span><span class="token number">7</span>   <span class="token string">"bash"</span>                   <span class="token number">5</span> <span class="token variable">minutes</span> <span class="token variable">ago</span>       <span class="token variable">Up</span> <span class="token number">15</span> <span class="token variable">seconds</span>                                <span class="token variable">sleepy_hamilton</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/5a/29/5kHnBVc8_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-handlebars"><span class="token variable">docker</span> <span class="token variable">inspect</span> <span class="token variable">-f</span> <span class="token string">'{<!-- -->{.State.Pid}}'</span> <span class="token variable">f9a769c6de37</span> 			<span class="token punctuation">#</span><span class="token variable">查看容器进程号</span>
<span class="token number">26192</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/e2/bd/0qCPqiGs_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-handlebars"><span class="token variable">ls</span> <span class="token variable">-l</span> <span class="token punctuation">/</span><span class="token variable">proc</span><span class="token punctuation">/</span><span class="token number">26192</span><span class="token block keyword">/ns</span>					<span class="token block keyword">#查看容器的进程、</span> <span class="token variable">网络、文件系统等命名空间编号</span>
<span class="token variable">total</span> <span class="token number">0</span>
<span class="token variable">lrwxrwxrwx</span> <span class="token number">1</span> <span class="token variable">root</span> <span class="token variable">root</span> <span class="token number">0</span> <span class="token variable">Jul</span> <span class="token number">26</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">19</span> <span class="token variable">ipc</span> <span class="token variable">-</span><span class="token punctuation">&gt;</span> <span class="token variable">ipc</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">4026532225</span><span class="token punctuation">]</span>
<span class="token variable">lrwxrwxrwx</span> <span class="token number">1</span> <span class="token variable">root</span> <span class="token variable">root</span> <span class="token number">0</span> <span class="token variable">Jul</span> <span class="token number">26</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">19</span> <span class="token variable">mnt</span> <span class="token variable">-</span><span class="token punctuation">&gt;</span> <span class="token variable">mnt</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">4026532223</span><span class="token punctuation">]</span>
<span class="token variable">lrwxrwxrwx</span> <span class="token number">1</span> <span class="token variable">root</span> <span class="token variable">root</span> <span class="token number">0</span> <span class="token variable">Jul</span> <span class="token number">26</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">19</span> <span class="token variable">net</span> <span class="token variable">-</span><span class="token punctuation">&gt;</span> <span class="token variable">net</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">4026532228</span><span class="token punctuation">]</span>
<span class="token variable">lrwxrwxrwx</span> <span class="token number">1</span> <span class="token variable">root</span> <span class="token variable">root</span> <span class="token number">0</span> <span class="token variable">Jul</span> <span class="token number">26</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">19</span> <span class="token variable">pid</span> <span class="token variable">-</span><span class="token punctuation">&gt;</span> <span class="token variable">pid</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">4026532226</span><span class="token punctuation">]</span>
<span class="token variable">lrwxrwxrwx</span> <span class="token number">1</span> <span class="token variable">root</span> <span class="token variable">root</span> <span class="token number">0</span> <span class="token variable">Jul</span> <span class="token number">26</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">19</span> <span class="token variable">user</span> <span class="token variable">-</span><span class="token punctuation">&gt;</span> <span class="token variable">user</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">4026531837</span><span class="token punctuation">]</span>
<span class="token variable">lrwxrwxrwx</span> <span class="token number">1</span> <span class="token variable">root</span> <span class="token variable">root</span> <span class="token number">0</span> <span class="token variable">Jul</span> <span class="token number">26</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">19</span> <span class="token variable">uts</span> <span class="token variable">-</span><span class="token punctuation">&gt;</span> <span class="token variable">uts</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">4026532224</span><span class="token punctuation">]</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/a1/ca/QFPspcZo_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-handlebars"><span class="token variable">docker</span> <span class="token variable">inspect</span> <span class="token variable">-f</span> <span class="token string">'{<!-- -->{.State.Pid}}'</span> <span class="token number">6</span><span class="token variable">bd695985cee</span>
<span class="token number">26310</span>

<span class="token variable">ls</span> <span class="token variable">-l</span> <span class="token punctuation">/</span><span class="token variable">proc</span><span class="token punctuation">/</span><span class="token number">26310</span><span class="token block keyword">/ns</span>			<span class="token block keyword">#查看可以发现两个容器的</span> <span class="token variable">net</span> <span class="token variable">namespace</span> <span class="token variable">编号相同</span>
<span class="token variable">total</span> <span class="token number">0</span>
<span class="token variable">lrwxrwxrwx</span> <span class="token number">1</span> <span class="token variable">root</span> <span class="token variable">root</span> <span class="token number">0</span> <span class="token variable">Jul</span> <span class="token number">26</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">19</span> <span class="token variable">ipc</span> <span class="token variable">-</span><span class="token punctuation">&gt;</span> <span class="token variable">ipc</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">4026532286</span><span class="token punctuation">]</span>
<span class="token variable">lrwxrwxrwx</span> <span class="token number">1</span> <span class="token variable">root</span> <span class="token variable">root</span> <span class="token number">0</span> <span class="token variable">Jul</span> <span class="token number">26</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">19</span> <span class="token variable">mnt</span> <span class="token variable">-</span><span class="token punctuation">&gt;</span> <span class="token variable">mnt</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">4026532284</span><span class="token punctuation">]</span>
<span class="token variable">lrwxrwxrwx</span> <span class="token number">1</span> <span class="token variable">root</span> <span class="token variable">root</span> <span class="token number">0</span> <span class="token variable">Jul</span> <span class="token number">26</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">19</span> <span class="token variable">net</span> <span class="token variable">-</span><span class="token punctuation">&gt;</span> <span class="token variable">net</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">4026532228</span><span class="token punctuation">]</span>
<span class="token variable">lrwxrwxrwx</span> <span class="token number">1</span> <span class="token variable">root</span> <span class="token variable">root</span> <span class="token number">0</span> <span class="token variable">Jul</span> <span class="token number">26</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">19</span> <span class="token variable">pid</span> <span class="token variable">-</span><span class="token punctuation">&gt;</span> <span class="token variable">pid</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">4026532287</span><span class="token punctuation">]</span>
<span class="token variable">lrwxrwxrwx</span> <span class="token number">1</span> <span class="token variable">root</span> <span class="token variable">root</span> <span class="token number">0</span> <span class="token variable">Jul</span> <span class="token number">26</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">19</span> <span class="token variable">user</span> <span class="token variable">-</span><span class="token punctuation">&gt;</span> <span class="token variable">user</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">4026531837</span><span class="token punctuation">]</span>
<span class="token variable">lrwxrwxrwx</span> <span class="token number">1</span> <span class="token variable">root</span> <span class="token variable">root</span> <span class="token number">0</span> <span class="token variable">Jul</span> <span class="token number">26</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">19</span> <span class="token variable">uts</span> <span class="token variable">-</span><span class="token punctuation">&gt;</span> <span class="token variable">uts</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">4026532285</span><span class="token punctuation">]</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/ab/9c/P2u1REKF_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="3none_103"></a>3．none模式</h4> 
<p>使用none模式，Docker容器拥有自己的Network Namespace，但是，并不为Docker容器进行任何网络配置。 也就是说，这个Docker容器没有网卡、IP、路由等信息。这种网络模式下容器只有lo回环网络，没有其他网卡。这种类型的网络没有办法联网，封闭的网络能很好的保证容器的安全性。</p> 
<h4><a id="font_colorred4Bridge_106"></a><font color="red">4．Bridge模式</font></h4> 
<p>bridge模式是docker的默认网络模式，不写–net参数，就是bridge模式。</p> 
<p>相当于Vmware中的 nat 模式，容器使用独立network Namespace，并连接到docker0虚拟网卡。通过docker0网桥以及iptables nat表配置与宿主机通信，此模式会为每一个容器分配Network Namespace、设置IP等，并将一个主机上的 Docker 容器连接到一个虚拟网桥上。</p> 
<p>（1）当Docker进程启动时，会在主机上创建一个名为docker0的虚拟网桥，此主机上启动的Docker容器会连接到这个虚拟网桥上。虚拟网桥的工作方式和物理交换机类似，这样主机上的所有容器就通过交换机连在了一个二层网络中。</p> 
<p>（2）从docker0子网中分配一个IP给容器使用，并设置docker0的IP地址为容器的默认网关。在主机上创建一对虚拟网卡veth pair设备。veth设备总是成对出现的，它们组成了一个数据的通道，数据从一个设备进入，就会从另一个设备出来。因此，veth设备常用来连接两个网络设备。</p> 
<p>（3）Docker将veth pair 设备的一端放在新创建的容器中，并命名为eth0（容器的网卡），另一端放在主机中， 以veth*这样类似的名字命名，并将这个网络设备加入到docker0网桥中。可以通过 brctl show 命令查看。</p> 
<p><font color="red">（4）使用 docker run -p 时，docker实际是在iptables做了DNAT规则，实现端口转发功能。可以使用iptables -t nat -vnL 查看。<br> <img src="https://images2.imgbox.com/05/c4/MNnru4gV_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/28/a5/4IH09tB5_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/c6/f8/4wRcKZy6_o.png" alt="在这里插入图片描述"></font></p> 
<h4><a id="5_122"></a>5．自定义网络</h4> 
<pre><code class="prism language-handlebars"><span class="token block keyword">#直接使用bridge，无法支持指定IP运行docker</span>
<span class="token variable">docker</span> <span class="token variable">run</span> <span class="token variable">-itd</span> <span class="token variable">--name</span> <span class="token variable">test1</span> <span class="token variable">--network</span> <span class="token variable">bridge</span> <span class="token variable">--ip</span> <span class="token number">172.17</span><span class="token number">.0</span><span class="token number">.10</span> <span class="token variable">centos</span><span class="token punctuation">:</span><span class="token number">7</span> <span class="token block keyword">/bin/bash</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/48/7f/tI5mbOid_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-handlebars"><span class="token block keyword">#可以先自定义网络，再使用指定IP运行docker</span>
<span class="token variable">docker</span> <span class="token variable">network</span> <span class="token variable">create</span> <span class="token variable">--subnet</span><span class="token punctuation">=</span><span class="token number">172.20</span><span class="token number">.0</span><span class="token number">.0</span><span class="token punctuation">/</span><span class="token number">24</span> <span class="token variable">mynetwork1</span>
<span class="token variable">docker</span> <span class="token variable">run</span> <span class="token variable">-itd</span> <span class="token variable">--name</span> <span class="token variable">tes</span> <span class="token variable">--net</span> <span class="token variable">mynetwork1</span> <span class="token variable">--ip</span> <span class="token number">172.20</span><span class="token number">.0</span><span class="token number">.10</span> <span class="token variable">centos</span><span class="token punctuation">:</span><span class="token number">7</span> <span class="token block keyword">/bin/bash</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/e6/53/ODGgJm0A_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="Docker__136"></a>二、Docker 资源控制</h2> 
<h3><a id="1CPU__137"></a>1．CPU 资源控制</h3> 
<p>cgroups，是一个非常强大的linux内核工具，他不仅可以限制被 namespace 隔离起来的资源， 还可以为资源设置权重、计算使用量、操控进程启停等等。 所以 <strong>cgroups</strong>（ Control groups） 实现了对资源的配额和度量。</p> 
<table><thead><tr><th align="left"><font color="red">cgroups 有四大功能</font></th><th align="left">-</th></tr></thead><tbody><tr><td align="left"><strong>资源限制</strong></td><td align="left">可以对任务使用的资源总额进行限制</td></tr><tr><td align="left"><strong>优先级分配</strong></td><td align="left">通过分配的cpu时间片数量以及磁盘IO带宽大小，实际上相当于控制了任务运行优先级</td></tr><tr><td align="left"><strong>资源统计</strong></td><td align="left">可以统计系统的资源使用量，如cpu时长，内存用量等</td></tr><tr><td align="left"><strong>任务控制</strong></td><td align="left">cgroup可以对任务执行挂起、恢复等操作</td></tr></tbody></table> 
<h4><a id="CPU_148"></a>设置CPU使用率上限</h4> 
<p>Linux 通过 CFS（Completely Fair Scheduler，完全公平调度器）来调度各个进程对 CPU 的使用。CFS <mark>默认的调度周期是 100ms</mark>。<br> 我们可以设置每个容器进程的调度周期，以及在这个周期内各个容器最多能使用多少 CPU 时间。<br> <mark>使用 --cpu-period 即可设置调度周期，使用 --cpu-quota 即可设置在每个周期内容器能使用的 CPU 时间</mark>。两者可以配合使用。<br> CFS 周期的有效范围是 <code>1ms~1s</code>，对应的 --cpu-period 的数值范围是 1000~100000。<br> 而容器的 CPU 配额<mark>必须不小于 1ms</mark>，即 --cpu-quota 的值必须 &gt;= 1000。</p> 
<pre><code class="prism language-handlebars"><span class="token variable">docker</span> <span class="token variable">run</span> <span class="token variable">-itd</span> <span class="token variable">--name</span> <span class="token variable">bj1</span> <span class="token variable">centos</span><span class="token punctuation">:</span><span class="token number">7</span> <span class="token block keyword">/bin/bash</span>

<span class="token variable">docker</span> <span class="token variable">ps</span> <span class="token variable">-a</span>
<span class="token variable">CONTAINER</span> <span class="token variable">ID</span>   <span class="token variable">IMAGE</span>          <span class="token variable">COMMAND</span>                  <span class="token variable">CREATED</span>              <span class="token variable">STATUS</span>                    <span class="token variable">PORTS</span>     <span class="token variable">NAMES</span>
<span class="token number">34</span><span class="token variable">deccb3cdea</span>   <span class="token variable">centos</span><span class="token punctuation">:</span><span class="token number">7</span>       <span class="token string">"/bin/bash"</span>              <span class="token variable">About</span> <span class="token variable">a</span> <span class="token variable">minute</span> <span class="token variable">ago</span>   <span class="token variable">Up</span> <span class="token variable">About</span> <span class="token variable">a</span> <span class="token variable">minute</span>                   <span class="token variable">bj1</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/de/c6/2fWQsIiD_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-handlebars"><span class="token variable">cd</span> <span class="token punctuation">/</span><span class="token variable">sys</span><span class="token punctuation">/</span><span class="token variable">fs</span><span class="token punctuation">/</span><span class="token variable">cgroup</span><span class="token punctuation">/</span><span class="token variable">cpu</span><span class="token punctuation">/</span><span class="token variable">docker</span><span class="token punctuation">/</span><span class="token number">34</span><span class="token variable">deccb3cdea1a01164f1b24342fafcb4c61243e79a20ce7bd627e4c6c2fc0f9</span><span class="token punctuation">/</span>

<span class="token variable">cat</span> <span class="token variable">cpu</span><span class="token punctuation">.</span><span class="token variable">cfs_quota_us</span> 
<span class="token variable">-</span><span class="token number">1</span>

<span class="token variable">cat</span> <span class="token variable">cpu</span><span class="token punctuation">.</span><span class="token variable">cfs_period_us</span> 
<span class="token number">100000</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/81/a8/ZjvGwsfN_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-handlebars"><span class="token block keyword">#cpu.cfs_period_us：cpu分配的周期(微秒，所以文件名中用</span> <span class="token variable">us</span> <span class="token variable">表示），默认为</span><span class="token number">100000</span><span class="token variable">。</span>
<span class="token punctuation">#</span><span class="token variable">cpu</span><span class="token punctuation">.</span><span class="token variable">cfs_quota_us：表示该control</span> <span class="token variable">group限制占用的时间（微秒），默认为-</span><span class="token number">1</span><span class="token variable">，表示不限制。</span> <span class="token variable">如果设为</span><span class="token number">50000</span><span class="token variable">，表示占用</span><span class="token number">50000</span><span class="token punctuation">/</span><span class="token number">100000</span><span class="token punctuation">=</span><span class="token number">50</span><span class="token punctuation">%</span><span class="token variable">的CPU。</span>
</code></pre> 
<h4><a id="CPU_182"></a>进行CPU压力测试</h4> 
<pre><code class="prism language-handlebars"><span class="token variable">docker</span> <span class="token variable">exec</span> <span class="token variable">-it</span> <span class="token number">34</span><span class="token variable">deccb3cdea</span> <span class="token punctuation">/</span><span class="token variable">bin</span><span class="token punctuation">/</span><span class="token variable">bash</span>
<span class="token variable">vi</span> <span class="token punctuation">/</span><span class="token variable">cpu</span><span class="token punctuation">.</span><span class="token variable">sh</span>
<span class="token punctuation">#</span><span class="token punctuation">!</span><span class="token punctuation">/</span><span class="token variable">bin</span><span class="token punctuation">/</span><span class="token variable">bash</span>
<span class="token variable">i</span><span class="token punctuation">=</span><span class="token number">0</span>
<span class="token variable">while</span> <span class="token boolean">true</span>
<span class="token variable">do</span>
<span class="token variable">let</span> <span class="token variable">i</span><span class="token punctuation">+</span><span class="token punctuation">+</span>
<span class="token variable">done</span>

<span class="token variable">chmod</span> <span class="token punctuation">+</span><span class="token variable">x</span> <span class="token punctuation">/</span><span class="token variable">cpu</span><span class="token punctuation">.</span><span class="token variable">sh</span>
<span class="token punctuation">.</span><span class="token punctuation">/</span><span class="token variable">cpu</span><span class="token punctuation">.</span><span class="token variable">sh</span>
<span class="token variable">exit</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/8a/5c/cx2POyBD_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-handlebars"><span class="token variable">top</span>					<span class="token punctuation">#</span><span class="token variable">可以看到这个脚本占了很多的cpu资源</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/20/e3/zrrtOgL9_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/26/7f/UwsxCjhp_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-handlebars"><span class="token block keyword">#设置</span><span class="token number">50</span><span class="token punctuation">%</span><span class="token variable">的比例分配CPU使用时间上限</span>
<span class="token variable">docker</span> <span class="token variable">run</span> <span class="token variable">-itd</span> <span class="token variable">--name</span> <span class="token variable">test2</span> <span class="token variable">--cpu-quota</span> <span class="token number">50000</span> <span class="token variable">centos</span><span class="token punctuation">:</span><span class="token number">7</span> <span class="token block keyword">/bin/bash</span>	<span class="token block keyword">#可以重新创建一个容器并设置限额</span>
<span class="token variable">或者</span>
<span class="token variable">cd</span> <span class="token punctuation">/</span><span class="token variable">sys</span><span class="token punctuation">/</span><span class="token variable">fs</span><span class="token punctuation">/</span><span class="token variable">cgroup</span><span class="token punctuation">/</span><span class="token variable">cpu</span><span class="token punctuation">/</span><span class="token variable">docker</span><span class="token punctuation">/</span><span class="token number">3</span><span class="token variable">ed82355f81111c4568aaa6e7bc60ba6984201c119125360924bf7dfd6eaa42b</span><span class="token punctuation">/</span>
<span class="token variable">echo</span> <span class="token number">50000</span> <span class="token punctuation">&gt;</span> <span class="token variable">cpu</span><span class="token punctuation">.</span><span class="token variable">cfs_quota_us</span>
<span class="token variable">docker</span> <span class="token variable">exec</span> <span class="token variable">-it</span> <span class="token number">3</span><span class="token variable">ed82355f811</span> <span class="token punctuation">/</span><span class="token variable">bin</span><span class="token punctuation">/</span><span class="token variable">bash</span>
<span class="token punctuation">.</span><span class="token punctuation">/</span><span class="token variable">cpu</span><span class="token punctuation">.</span><span class="token variable">sh</span>
<span class="token variable">exit</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/93/ae/2nhyHJ8A_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-handlebars"><span class="token variable">top</span>					<span class="token punctuation">#</span><span class="token variable">可以看到cpu占用率接近</span><span class="token number">50</span><span class="token punctuation">%</span><span class="token variable">，cgroups对cpu的控制起了效果</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/61/c8/n5tgII4v_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="CPU_227"></a>设置CPU资源占用比（设置多个容器时才有效）</h4> 
<p>Docker <mark>通过–cpu-shares 指定 CPU 份额</mark>，默认值为1024，值为1024的倍数。<br> #创建两个容器为 c1 和 c2，若只有这两个容器，设置容器的权重，使得c1和c2的CPU资源占比为1/3和2/3。</p> 
<pre><code class="prism language-handlebars"><span class="token variable">docker</span> <span class="token variable">run</span> <span class="token variable">-itd</span> <span class="token variable">--name</span> <span class="token variable">c1</span> <span class="token variable">--cpu-shares</span> <span class="token number">512</span> <span class="token variable">centos</span><span class="token punctuation">:</span><span class="token number">7</span>	
<span class="token variable">docker</span> <span class="token variable">run</span> <span class="token variable">-itd</span> <span class="token variable">--name</span> <span class="token variable">c2</span> <span class="token variable">--cpu-shares</span> <span class="token number">1024</span> <span class="token variable">centos</span><span class="token punctuation">:</span><span class="token number">7</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/71/35/BT5h606F_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-handlebars"><span class="token variable">docker</span> <span class="token variable">ps</span> <span class="token variable">-a</span>
<span class="token variable">CONTAINER</span> <span class="token variable">ID</span>   <span class="token variable">IMAGE</span>          <span class="token variable">COMMAND</span>                  <span class="token variable">CREATED</span>          <span class="token variable">STATUS</span>                    <span class="token variable">PORTS</span>     <span class="token variable">NAMES</span>
<span class="token number">6</span><span class="token variable">bcba5e89844</span>   <span class="token variable">centos</span><span class="token punctuation">:</span><span class="token number">7</span>       <span class="token string">"/bin/bash"</span>              <span class="token number">7</span> <span class="token variable">seconds</span> <span class="token variable">ago</span>    <span class="token variable">Up</span> <span class="token number">6</span> <span class="token variable">seconds</span>                        <span class="token variable">c2</span>
<span class="token number">4e6454</span><span class="token variable">c1f47c</span>   <span class="token variable">centos</span><span class="token punctuation">:</span><span class="token number">7</span>       <span class="token string">"/bin/bash"</span>              <span class="token number">9</span> <span class="token variable">seconds</span> <span class="token variable">ago</span>    <span class="token variable">Up</span> <span class="token number">8</span> <span class="token variable">seconds</span>                        <span class="token variable">c1</span>

<span class="token variable">分别进入容器，进行压力测试</span>
<span class="token variable">docker</span> <span class="token variable">exec</span> <span class="token variable">-it</span> <span class="token number">6</span><span class="token variable">bcba5e89844</span> <span class="token variable">bash</span>
<span class="token variable">docker</span> <span class="token variable">exec</span> <span class="token variable">-it</span> <span class="token number">4e6454</span><span class="token variable">c1f47c</span> <span class="token variable">bash</span>

<span class="token variable">yum</span> <span class="token variable">install</span> <span class="token variable">-y</span> <span class="token variable">epel-release</span>
<span class="token variable">yum</span> <span class="token variable">install</span> <span class="token variable">stress</span> <span class="token variable">-y</span>
<span class="token variable">stress</span> <span class="token variable">-c</span> <span class="token number">4</span>				<span class="token block keyword">#产生四个进程，每个进程都反复不停的计算随机数的平方根</span>
<span class="token variable">exit</span>
</code></pre> 
<pre><code class="prism language-handlebars"><span class="token block keyword">#查看容器运行状态（动态更新）</span>
<span class="token variable">docker</span> <span class="token variable">stats</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/67/b2/Kn4Be55d_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/03/a2/RjiF3wRb_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="CPU_260"></a>设置容器绑定指定的CPU</h4> 
<pre><code class="prism language-handlebars"><span class="token block keyword">#先分配虚拟机</span><span class="token number">4</span><span class="token variable">个CPU核数</span>
<span class="token variable">docker</span> <span class="token variable">run</span> <span class="token variable">-itd</span> <span class="token variable">--name</span> <span class="token variable">v1</span> <span class="token variable">--cpuset-cpus</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span> <span class="token variable">centos</span><span class="token punctuation">:</span><span class="token number">7</span> <span class="token variable">bash</span>

<span class="token punctuation">#</span><span class="token variable">进入容器，进行压力测试</span>
<span class="token variable">docker</span> <span class="token variable">exec</span> <span class="token variable">-it</span> <span class="token number">6288</span><span class="token variable">bc21a6c9</span> <span class="token variable">bash</span>
<span class="token variable">yum</span> <span class="token variable">install</span> <span class="token variable">-y</span> <span class="token variable">epel-release</span>
<span class="token variable">yum</span> <span class="token variable">install</span> <span class="token variable">stress</span> <span class="token variable">-y</span>
<span class="token variable">stress</span> <span class="token variable">-c</span> <span class="token number">4</span>
<span class="token variable">exit</span>

<span class="token punctuation">#</span><span class="token variable">退出容器，执行</span> <span class="token variable">top</span> <span class="token variable">命令再按</span> <span class="token number">1</span> <span class="token variable">查看CPU使用情况。</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/c3/1e/UPkd2lB5_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/87/1d/ND6ZOtTz_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="2_279"></a>2．对内存使用的限制</h3> 
<pre><code class="prism language-handlebars"><span class="token variable">docker</span> <span class="token variable">run</span> <span class="token variable">-itd</span> <span class="token variable">--name</span> <span class="token variable">test3</span> <span class="token variable">-m</span> <span class="token number">512</span><span class="token variable">m</span> <span class="token variable">centos</span><span class="token punctuation">:</span><span class="token number">7</span> <span class="token block keyword">/bin/bash</span>

<span class="token variable">docker</span> <span class="token variable">stats</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/1c/4a/r790XIQ4_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="3IOblkio_289"></a>3．对磁盘IO配额控制（blkio）的限制</h3> 
<pre><code class="prism language-handlebars"><span class="token variable">--device-read-bps：限制某个设备上的读速度bps（数据量），单位可以是kb、mb</span><span class="token punctuation">(</span><span class="token variable">M</span><span class="token punctuation">)</span><span class="token variable">或者gb。</span>
<span class="token variable">例：docker</span> <span class="token variable">run</span> <span class="token variable">-itd</span> <span class="token variable">--name</span> <span class="token variable">test4</span> <span class="token variable">--device-read-bps</span> <span class="token punctuation">/</span><span class="token variable">dev</span><span class="token punctuation">/</span><span class="token variable">sda</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token variable">M</span>  <span class="token variable">centos</span><span class="token punctuation">:</span><span class="token number">7</span> <span class="token block keyword">/bin/bash</span>

<span class="token variable">--device-write-bps</span> <span class="token variable">：</span> <span class="token variable">限制某个设备上的写速度bps（数据量），单位可以是kb、mb</span><span class="token punctuation">(</span><span class="token variable">M</span><span class="token punctuation">)</span><span class="token variable">或者gb。</span>
<span class="token variable">例：docker</span> <span class="token variable">run</span> <span class="token variable">-itd</span> <span class="token variable">--name</span> <span class="token variable">test5</span> <span class="token variable">--device-write-bps</span> <span class="token punctuation">/</span><span class="token variable">dev</span><span class="token punctuation">/</span><span class="token variable">sda</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token variable">mb</span> <span class="token variable">centos</span><span class="token punctuation">:</span><span class="token number">7</span> <span class="token block keyword">/bin/bash</span>

<span class="token variable">--device-read-iops</span> <span class="token variable">：限制读某个设备的iops（次数）</span>
 
<span class="token variable">--device-write-iops</span> <span class="token variable">：限制写入某个设备的iops（次数）</span>
</code></pre> 
<pre><code class="prism language-handlebars"><span class="token block keyword">#创建容器，并限制写速度</span>
<span class="token variable">docker</span> <span class="token variable">run</span> <span class="token variable">-it</span> <span class="token variable">--name</span> <span class="token variable">v2</span> <span class="token variable">--device-write-bps</span> <span class="token punctuation">/</span><span class="token variable">dev</span><span class="token punctuation">/</span><span class="token variable">sda</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token variable">mb</span> <span class="token variable">centos</span><span class="token punctuation">:</span><span class="token number">7</span> <span class="token variable">bash</span>
</code></pre> 
<pre><code class="prism language-handlebars"><span class="token block keyword">#通过dd来验证写速度</span>
<span class="token variable">dd</span> <span class="token variable">if</span><span class="token punctuation">=</span><span class="token punctuation">/</span><span class="token variable">dev</span><span class="token punctuation">/</span><span class="token variable">zero</span> <span class="token variable">of</span><span class="token punctuation">=</span><span class="token variable">test</span><span class="token punctuation">.</span><span class="token variable">out</span> <span class="token variable">bs</span><span class="token punctuation">=</span><span class="token number">2</span><span class="token variable">M</span> <span class="token variable">count</span><span class="token punctuation">=</span><span class="token number">10</span> <span class="token variable">oflag</span><span class="token punctuation">=</span><span class="token variable">direct</span>	   <span class="token punctuation">#</span><span class="token variable">添加oflag参数以规避掉文件系统cache</span>
<span class="token number">10</span><span class="token punctuation">+</span><span class="token number">0</span> <span class="token variable">records</span> <span class="token variable">in</span>
<span class="token number">10</span><span class="token punctuation">+</span><span class="token number">0</span> <span class="token variable">records</span> <span class="token variable">out</span>
<span class="token number">20971520</span> <span class="token variable">bytes</span> <span class="token punctuation">(</span><span class="token number">21</span> <span class="token variable">MB</span><span class="token punctuation">)</span> <span class="token variable">copied</span><span class="token punctuation">,</span> <span class="token number">20.0046</span> <span class="token variable">s</span><span class="token punctuation">,</span> <span class="token number">1.0</span> <span class="token variable">MB</span><span class="token punctuation">/</span><span class="token variable">s</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/8d/be/mBJQG132_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_317"></a>总结</h2> 
<pre><code class="prism language-handlebars"><span class="token variable">批量删除容器</span>
<span class="token variable">docker</span> <span class="token variable">ps</span> <span class="token variable">-a</span> <span class="token punctuation">|</span> <span class="token variable">awk</span> <span class="token string">'NR&gt;=2 {print $1}'</span> <span class="token punctuation">|</span> <span class="token variable">xargs</span> <span class="token variable">docker</span> <span class="token variable">stop</span>
<span class="token variable">docker</span> <span class="token variable">ps</span> <span class="token variable">-a</span> <span class="token punctuation">|</span> <span class="token variable">awk</span> <span class="token string">'NR&gt;=2 {print $1}'</span> <span class="token punctuation">|</span> <span class="token variable">xargs</span> <span class="token variable">docker</span> <span class="token variable">rm</span>
</code></pre> 
<table><thead><tr><th>docker</th><th align="left">四种网络模式</th><th>说明</th></tr></thead><tbody><tr><td>host模式</td><td align="left">使用 --net=host 指定。</td><td>与宿主机共用ip和端口</td></tr><tr><td>none模式</td><td align="left">使用 --net=none 指定。</td><td>与已有容器共用ip和端口</td></tr><tr><td>container模式</td><td align="left">使用 --net=container:NAME_or_ID 指定。</td><td>相当于linux仅主机模式</td></tr><tr><td>bridge模式</td><td align="left">使用 --net=bridge 指定，默认设置，可省略。</td><td>拥有自己网络 172.17.0.0/24</td></tr><tr><td>自定义网络</td><td align="left"></td><td></td></tr></tbody></table> 
<pre><code class="prism language-handlebars"><span class="token variable">docker</span> <span class="token variable">run</span> <span class="token variable">-itd</span> <span class="token variable">--name</span> <span class="token variable">name1</span> <span class="token variable">-P</span> <span class="token variable">nginx</span>      <span class="token variable">随机映射端口</span>   <span class="token variable">（</span> <span class="token variable">P随机映射端口</span> <span class="token variable">p指定端口映射</span> <span class="token variable">）</span>

<span class="token variable">设置</span><span class="token number">50</span><span class="token punctuation">%</span><span class="token variable">的比例分配CPU使用时间上限（--cpu-quota）</span>
<span class="token variable">docker</span> <span class="token variable">run</span> <span class="token variable">-itd</span> <span class="token variable">--name</span> <span class="token variable">name2</span> <span class="token variable">--cpu-quota</span> <span class="token number">50000</span> <span class="token variable">centos</span><span class="token punctuation">:</span><span class="token number">7</span> <span class="token block keyword">/bin/bash</span>	<span class="token block keyword">#可以重新创建一个容器并设置限额</span>

<span class="token variable">设置容器绑定指定的CPU（--cpuset-cpus）</span>
<span class="token variable">docker</span> <span class="token variable">run</span> <span class="token variable">-itd</span> <span class="token variable">--name</span> <span class="token variable">v1</span> <span class="token variable">--cpuset-cpus</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span> <span class="token variable">centos</span><span class="token punctuation">:</span><span class="token number">7</span> <span class="token variable">bash</span>

<span class="token variable">设置CPU资源占用比（设置多个容器时才有效）（--cpu-shares）</span>
<span class="token variable">Docker</span> <span class="token variable">通过--cpu-shares</span> <span class="token variable">指定</span> <span class="token variable">CPU</span> <span class="token variable">份额，默认值为</span><span class="token number">1024</span><span class="token variable">，值为</span><span class="token number">1024</span><span class="token variable">的倍数。</span>
<span class="token variable">docker</span> <span class="token variable">run</span> <span class="token variable">-itd</span> <span class="token variable">--name</span> <span class="token variable">c1</span> <span class="token variable">--cpu-shares</span> <span class="token number">512</span> <span class="token variable">centos</span><span class="token punctuation">:</span><span class="token number">7</span>	
<span class="token variable">docker</span> <span class="token variable">run</span> <span class="token variable">-itd</span> <span class="token variable">--name</span> <span class="token variable">c2</span> <span class="token variable">--cpu-shares</span> <span class="token number">1024</span> <span class="token variable">centos</span><span class="token punctuation">:</span><span class="token number">7</span>

<span class="token variable">对内存使用的限制（-m）</span>
<span class="token variable">docker</span> <span class="token variable">run</span> <span class="token variable">-itd</span> <span class="token variable">--name</span> <span class="token variable">name3</span> <span class="token variable">-m</span> <span class="token number">512</span><span class="token variable">m</span> <span class="token variable">centos</span><span class="token punctuation">:</span><span class="token number">7</span> <span class="token block keyword">/bin/bash</span>

<span class="token variable">限制读速度</span>
<span class="token variable">--device-read-bps</span>

<span class="token punctuation">#</span><span class="token variable">创建容器，并限制写速度</span>
<span class="token variable">docker</span> <span class="token variable">run</span> <span class="token variable">-it</span> <span class="token variable">--name</span> <span class="token variable">v2</span> <span class="token variable">--device-write-bps</span> <span class="token punctuation">/</span><span class="token variable">dev</span><span class="token punctuation">/</span><span class="token variable">sda</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token variable">mb</span> <span class="token variable">centos</span><span class="token punctuation">:</span><span class="token number">7</span> <span class="token variable">bash</span>
<span class="token variable">oflag参数以规避掉文件系统cache</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6ef7dd6f2235391ccd6551eee1fc1c1e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">计算机最小基本单位是什么,计算机中存储容量的最小单位和最基本单位是什么？...</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/43a7b7303355e37b90cd3f7dc43b1390/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">在局域网内怎样使两台计算机共享,实现局域网内两台windows计算机之间数据共享...</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>