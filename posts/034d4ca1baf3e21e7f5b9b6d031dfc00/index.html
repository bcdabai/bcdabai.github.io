<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Redmi AC2100上使用Hiboy Padavan固件进行子网IPv6分配，Padavan子网无法获取IPv6地址 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Redmi AC2100上使用Hiboy Padavan固件进行子网IPv6分配，Padavan子网无法获取IPv6地址" />
<meta property="og:description" content="1、基础设置 默认情况下Padavan连接到光猫以后，会自动获取并为默认eth3分配WAN口的IP地址，支持IPv6的光猫会获取IPv6地址给WAN口，但是不会继续对LAN中子网设备进行IPv6地址的分配了。
通过ifconfig命令可以得到：小米路由器迷你的WAN接口是eth2.2，红米AC2100的WAN接口是eth3。
我们要对路由器本身进行一些设置。
首先我们要确保关闭所有硬件加速功能。
如果配置硬件加速，则以下很多设置将无法生效，无法获取IP地址等等，导致数据无法正常转发。
我们可以通过无状态服务获取IPv6地址。某些网络下有状态获取也可以。
2、加入路由过滤 我们需要用以下几条命令让IPv6透过路由器向子网传递：
#首先启用IPv6模块 modprobe ip6table_mangle #通过ebtables设置一条路由规则，抛弃IPv6包，老版本的小米路由器mini的WAN口是eth2.2，AC2100是eth3 ebtables -t broute -A BROUTING -p ! ipv6 -j DROP -i eth3 #添加网桥接口，直接连接br0到eth3上，可以让IPv6包透过桥接br0直接对子网进行分发 brctl addif br0 eth3 #设置桥接选项 sysctl -w net.ipv6.conf.br0.accept_ra=2 第一条命令：加载ip6table_mangle内核模块。
第二条命令：抛弃内网对外网所有非IPV6流量的访问，即IPV4流量依然通过NAT。
第三条命令：让WAN口（eth3）成为内网（br0）的一个端口，这样做使得局域网内的主机与外网处于一个广播域，可以收到校园网网关的路由配置信息，每一台主机便可以得到一个全局的IPv6地址。
效果
进入自定义设置 - 脚本，在路由器启动后执行中末位添加这段命令。重启路由器后等待。
重启之后我们可以看到在IPv6这一栏地址均消失了。此时我们将IPv6数据包通过网桥透传到子网的目的完成了。
参考来源：
1、https://www.freesion.com/article/1642151019/
2、https://segmentfault.com/a/1190000015325071?utm_source=tag-newest
3、https://koolshare.cn/thread-150937-1-1.html
4、https://blog.csdn.net/weixin_44983653/article/details/103138223
5、https://www.linuxcool.com/ebtables
6、https://www.mydigit.cn/forum.php?mod=viewthread&amp;tid=112587" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/034d4ca1baf3e21e7f5b9b6d031dfc00/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-08-11T15:15:51+08:00" />
<meta property="article:modified_time" content="2021-08-11T15:15:51+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Redmi AC2100上使用Hiboy Padavan固件进行子网IPv6分配，Padavan子网无法获取IPv6地址</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="1_0"></a>1、基础设置</h3> 
<p>默认情况下Padavan连接到光猫以后，会自动获取并为默认eth3分配WAN口的IP地址，支持IPv6的光猫会获取IPv6地址给WAN口，但是不会继续对LAN中子网设备进行IPv6地址的分配了。</p> 
<blockquote> 
 <p>通过ifconfig命令可以得到：小米路由器迷你的WAN接口是eth2.2，红米AC2100的WAN接口是eth3。</p> 
</blockquote> 
<p>我们要对路由器本身进行一些设置。<br> 首先我们要确保关闭所有硬件加速功能。</p> 
<p><img src="https://images2.imgbox.com/51/cd/z7tPsBT5_o.png" alt="关闭硬件加速">如果配置硬件加速，则以下很多设置将无法生效，无法获取IP地址等等，导致数据无法正常转发。</p> 
<p><img src="https://images2.imgbox.com/a0/4c/0Ps44fB3_o.png" alt="设置为无状态获取IPv6地址"><br> 我们可以通过无状态服务获取IPv6地址。某些网络下有状态获取也可以。</p> 
<h3><a id="2_15"></a>2、加入路由过滤</h3> 
<p>我们需要用以下几条命令让IPv6透过路由器向子网传递：</p> 
<pre><code class="prism language-bash"><span class="token comment">#首先启用IPv6模块</span>
modprobe ip6table_mangle

<span class="token comment">#通过ebtables设置一条路由规则，抛弃IPv6包，老版本的小米路由器mini的WAN口是eth2.2，AC2100是eth3</span>
ebtables -t broute -A BROUTING -p <span class="token operator">!</span> ipv6 -j DROP -i eth3

<span class="token comment">#添加网桥接口，直接连接br0到eth3上，可以让IPv6包透过桥接br0直接对子网进行分发</span>
brctl addif br0 eth3

<span class="token comment">#设置桥接选项</span>
sysctl -w net.ipv6.conf.br0.accept_ra<span class="token operator">=</span><span class="token number">2</span>
</code></pre> 
<p>第一条命令：加载ip6table_mangle内核模块。<br> 第二条命令：抛弃内网对外网所有非IPV6流量的访问，即IPV4流量依然通过NAT。<br> 第三条命令：让WAN口（eth3）成为内网（br0）的一个端口，这样做使得局域网内的主机与外网处于一个广播域，可以收到校园网网关的路由配置信息，每一台主机便可以得到一个全局的IPv6地址。<br> 效果</p> 
<p>进入自定义设置 - 脚本，在路由器启动后执行中末位添加这段命令。重启路由器后等待。<br> 重启之后我们可以看到在IPv6这一栏地址均消失了。此时我们将IPv6数据包通过网桥透传到子网的目的完成了。</p> 
<p><img src="https://images2.imgbox.com/87/61/aToDJv2q_o.png" alt="IPv6子网分配成功"><br> 参考来源：</p> 
<blockquote> 
 <p>1、https://www.freesion.com/article/1642151019/<br> 2、https://segmentfault.com/a/1190000015325071?utm_source=tag-newest<br> 3、https://koolshare.cn/thread-150937-1-1.html<br> 4、https://blog.csdn.net/weixin_44983653/article/details/103138223<br> 5、https://www.linuxcool.com/ebtables<br> 6、https://www.mydigit.cn/forum.php?mod=viewthread&amp;tid=112587</p> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/521abebdd954bcc8ee1380348535c746/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">zeku一面</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1644d0afa97375d1265cae7e5f16ec45/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">apache 修改服务器配置,Apache服务器配置全攻略</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>