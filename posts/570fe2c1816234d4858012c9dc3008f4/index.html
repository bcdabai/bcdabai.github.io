<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>sql常用的 高级编程 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="sql常用的 高级编程" />
<meta property="og:description" content="T-SQL 高级编程 /*-变量应用-*/ --局部变量以标记@为前缀 --全局变量以标记@@为前缀 --局部变量声明 declare @变量名 数据类型 --局部变量赋值:使用set语句或select语句 --set 赋值语句一般赋给变量指定的数据常量 set @变量名 = 值 --select 赋值语句一般用于从表中查询数据,然后再赋给变量 --当用select赋值时,不进行筛选会将最后一条记录赋给变量 select @变量名 = 列名值 from 表名 where 条件 全局变量表变量含义@@error最后一个T-SQL错误的错误号@@identity最后一次插入的标识值@@language当前使用的语言的名称@@max_connections可以创建的同时连接的最大数目@@rowcount受上一个SQL语句影响的行数@@servername本地服务器的名称@@servicename该计算机上的SQL服务器的名称@@timeticks当前计算上每刻度的微秒数@@transcount当前连接打开的事物数@@versionSQL Sever的版本信息 /*-输出语句-*/ print convert(varchar(大小),变量或字符串) --只适合打印字符和字符串 select 变量 as 自定义列名 --适合所有类型 /*-逻辑控制语句-*/ --if-else条件语句 if(条件) begin --语句块 end else begin --语句块 end --while循环语句 while(条件) begin --语句块 end --case多分支语句 case when 条件1 then 结果1 when 条件2 then 结果2 else 结果3 end 列名 = case when 列值 then 表达式 else 表达式 end/*-高级查询-*/ --简单子查询 select 列名 from 表名 where 条件列名 = (select 条件列名 from 表名 where 条件) --in和not in子查询 select 列名 from 表名 where 条件列名 in (select 条件列名 from 表名 where 条件) select 列名 from 表名 where 条件列名 not in (select 条件列名 from 表名 where 条件) --exists和not exists子查询 if exists(select * from 表名 where 条件) begin --语句块 end if not exists(select * from 表名 where 条件) begin --语句块 end/*-事务-*/ --管理事务开始事务:begin transaction 提交事务:commit transaction 回滚事务:rollback transaction --分类 显示事务:用begin transaction 明确指定事务的开始 隐式事务:通过设置set implicit_transaction on 语句,将隐式事务模式设置为开." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/570fe2c1816234d4858012c9dc3008f4/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2010-04-29T16:52:16+08:00" />
<meta property="article:modified_time" content="2010-04-29T16:52:16+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">sql常用的 高级编程</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    T-SQL 高级编程 
<br>/*-变量应用-*/ --局部变量以标记@为前缀 --全局变量以标记@@为前缀 --局部变量声明 declare @变量名 数据类型 --局部变量赋值:使用set语句或select语句 --set 赋值语句一般赋给变量指定的数据常量 set @变量名 = 值 --select 赋值语句一般用于从表中查询数据,然后再赋给变量 --当用select赋值时,不进行筛选会将最后一条记录赋给变量 select @变量名 = 列名值 from 表名 where 条件 
<br> 
<br>全局变量表变量含义@@error最后一个T-SQL错误的错误号@@identity最后一次插入的标识值@@language当前使用的语言的名称@@max_connections可以创建的同时连接的最大数目@@rowcount受上一个SQL语句影响的行数@@servername本地服务器的名称@@servicename该计算机上的SQL服务器的名称@@timeticks当前计算上每刻度的微秒数@@transcount当前连接打开的事物数@@versionSQL Sever的版本信息 
<br> 
<br>/*-输出语句-*/ print convert(varchar(大小),变量或字符串) --只适合打印字符和字符串 select 变量 as 自定义列名 --适合所有类型 /*-逻辑控制语句-*/ --if-else条件语句 if(条件) begin --语句块 end else begin --语句块 end --while循环语句 while(条件) begin --语句块 end --case多分支语句 case when 条件1 then 结果1 when 条件2 then 结果2 else 结果3 end 列名 = case when 列值 then 表达式 else 表达式 end/*-高级查询-*/ --简单子查询 select 列名 from 表名 where 条件列名 = (select 条件列名 from 表名 where 条件) --in和not in子查询 select 列名 from 表名 where 条件列名 in (select 条件列名 from 表名 where 条件) select 列名 from 表名 where 条件列名 not in (select 条件列名 from 表名 where 条件) --exists和not exists子查询 if exists(select * from 表名 where 条件) begin --语句块 end if not exists(select * from 表名 where 条件) begin --语句块 end/*-事务-*/ --管理事务开始事务:begin transaction 提交事务:commit transaction 回滚事务:rollback transaction --分类 显示事务:用begin transaction 明确指定事务的开始 隐式事务:通过设置set implicit_transaction on 语句,将隐式事务模式设置为开. 当隐式事务模式操作时,SQL Server将在提交或回滚事务后自动启动新事务.无法描述事务 的开始,只需要提交或回滚每个事务. 自动提交事务:这是SQL Server 的默认模式,它将每条单独的T-SQL 语句视为一个事务. 如果成功执行,则自动提交.如果错误,则自动回滚. --开始事务 begin transaction --定义变量,用于累计错误 declare @errorSum int --初始化变量 set @errorSum=0 --语句 --累计错误 set @errorSum = @errorSum + @@error if @errorSum &lt;&gt;0 begin print --错误提示 --回滚事务 rollback transaction end else begin print --成功提示 
<br>--提交事务 commit transaction end 
<br> 
<br>/*-索引-*/ 
<br>--索引类型唯一索引:unique 聚集索引:clustered 非聚集索引:nonclusered 
<br>use 数据库名 
<br>go 
<br>--查找索引 
<br>if exists (select * from sysindexes where name = '索引名') 
<br>--删除索引 
<br>drop index 表名.索引名 
<br>--创建索引 
<br>create nonclustered index 索引名 
<br>on 表名(索引列名) 
<br>where fillfactor = --大小为0-100之间的值 
<br>go 
<br> 
<br>--查询索引 
<br>select * from 表名 (index = 索引名) where 由索引列名组成的条件 
<br> 
<br> 
<br>/*-创建视图-*/ 
<br>use 数据库名 
<br>go 
<br>--查询视图 
<br>if exists (select * from sysobjects where name = '视图名') 
<br>--删除视图 
<br>drop view 视图名 
<br>--创建视图 
<br>create view 视图名 
<br>as 
<br>--查询语句 
<br>go 
<br> 
<br>--使用视图 
<br>select * from 视图名 
<br> 
<br> 
<br>常用的系统存储过程系统存储过程说明sp_databases列出服务器上所有的数据库sp_helpdb报告有关指定数据库或所有数据库的信息sp_renamedb 旧名,新名更改数据库的名称sp_tables返回当前环境下可查询的对象的列表sp_columns返回某个表列的信息sp_help查看某个表的所有信息sp_helpconstraint 表名查看某个表的约束sp_helpindex 表名查看某个表的索引sp_stored_procedures列出当前环境中所有存储过程sp_password添加或修改登录账户的密码sp_helptext显示默认值、未加密的存储过程、用户自定义的存储过程、出发器或视图的实际文本xp_cmdshell 'Dos命令'完成DOS命名下的一些操作 
<br> 
<br>--自定义存储过程 
<br>--不带参的存储过程 
<br>use 数据库名 
<br>go 
<br>--查询存储过程 
<br>if exists (select * from sysobjects where name = '存储过程') 
<br>--删除存储过程 
<br>drop procedure 存储过程名 
<br>go 
<br>--创建存储过程 
<br>create procedure 存储过程名 
<br>as 
<br>declare @变量名 数据类型 
<br>--SQL语句(一般用于查询语句) 
<br>go 
<br> 
<br>--调用存储过程 
<br>exec 存储过程名 
<br> 
<br> 
<br>--创建带输入参数的存储过程 
<br>use 数据库名 
<br>go 
<br>--查询存储过程 
<br>if exists (select * from sysobjects where name = '存储过程') 
<br>--删除存储过程 
<br>drop procedure 存储过程名 
<br>go 
<br>--创建存储过程 
<br>create procedure 存储过程名 
<br>@变量名1 数据类型 --输入参数(当多个参数时用,隔开) 
<br>as 
<br>declare @变量名2 数据类型 
<br>--SQL语句(一般用于插入、修改、删除语句) 
<br>go 
<br> 
<br>--调用存储过程 
<br>exec 存储过程名 给变量名1赋值 
<br> 
<br> 
<br>--创建带输出参数的存储过程 
<br>use 数据库名 
<br>go 
<br>--查询存储过程 
<br>if exists (select * from sysobjects where name = '存储过程') 
<br>--删除存储过程 
<br>drop procedure 存储过程名 
<br>go 
<br>--创建存储过程 
<br>create procedure 存储过程名 
<br>@变量名1 数据类型 output,--output关键字,否则视为输入参数 
<br>@变量名2 数据类型 --输入参数(当多个参数时用,隔开) 
<br>as 
<br>declare @变量名3 数据类型 
<br>--SQL语句(一般用于查询语句) 
<br>go 
<br> 
<br>--调用存储过程 
<br>declare @变量名4 数据类型 --定义变量，用于存放存储过程变量名1的返回的结果 
<br>exec 存储过程名 @变量名4 output,@变量名2 数据类型 
<br> 
<br> 
<br>/*-处理错误信息-*/ 
<br>use 数据库名 
<br>go 
<br>--查询存储过程 
<br>if exists (select * from sysobjects where name = '存储过程') 
<br>--删除存储过程 
<br>drop procedure 存储过程名 
<br>go 
<br>--创建存储过程 
<br>create procedure 存储过程名 
<br>@变量名1 数据类型, 
<br>@变量名2 output 
<br>as 
<br>declare @变量名3 数据类型 
<br>--错误处理 
<br>msg_id:在sysmessages系统表中指定的用户定义错误信息 
<br>msg_str:用户定义的特定信息,最长为255个字符 
<br>serverity:与特定信息相关联,表示用户定义的严重级别.用户可以使用0~18级,19~25级 
<br> 是sysadmin固定角色的成员预留的,并且需要指定with log选项,20~25级错 
<br> 误被认为是致命的错误 
<br>state:表示错误的状态,是1~127的值 
<br> 
<br>raiserror('msg_id | msg_str',severity,state); 
<br>--SQL语句(一般用于查询语句) 
<br>go 
<br> 
<br>--调用存储过程 
<br>declare @变量名4 数据类型 --定义变量，用于存放存储过程d的返回的结果 
<br>exec 存储过程名 @变量名4 output,@变量名2 数据类型
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0bf99063dc22b6a867fa02f2d5ec8189/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">CMYK色值表(收藏版)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/093ac1e1bcb34a68dd802af75099f7c4/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">eclipse中改变默认的workspace的方法及说明</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>