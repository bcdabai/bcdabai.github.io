<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>在vue中实现在线代码编辑器之CodeMirror - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="在vue中实现在线代码编辑器之CodeMirror" />
<meta property="og:description" content="# 前言 由于项目需求，需要完成一个支持代码提示、代码校验、代码格式化的页面代码编辑器
1 技术选型 精力有限，只了解了几个主流的编辑器codemirror、ace、Monaco Editor、vue-web-terminal等等。本文只介绍codemirror的使用。
2 使用效果 先上效果图：
再看下有内容的效果：
虽然比较简单，但是最基本的缩进、高亮显示、缩放展开等基础功能还是有的。其实还包含了许多文件类型的语法校验。
后续使用中发现，给这个编辑器的内容赋值时，开头总是有个小红点。而经过反复检查传递的文件内容，并没有小红点，这个小红点也不会加在内容中传递出去，于是我发现codemirror的一些比较常用的配置项。
3 代码实现 先看实际我使用的配置项：
data() { return { value: &#39;&#39;, /** @type {import(&#39;@types/codemirror/index&#39;).EditorConfiguration} */ codemirrorOptions: { // specialChars: &#39;/[\u0000-\u0019\u00ad\u200b-\u200f\u2028\u2029\ufeff]/&#39;, //默认值 // specialCharPlaceholder: &#39;&#39;, //默认值 // eslint-disable-next-line no-control-regex // specialChars: /[\u0000-\u001f\u007f-\u009f\u00ad\u061c\u200b-\u200f\u2028\u2029\ufeff\ufff9-\ufffc]/g, // specialCharPlaceholder: function (ch) { // let token = document.createElement(&#34;span&#34;); // let content = &#34;\u002e&#34;; // token.className = &#34;cm-invalidchar&#34;; // if (typeof content == &#34;string&#34;) { // token." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/4ab45a913b21d8e8eaf6e2a8a275fd15/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-10-24T18:00:21+08:00" />
<meta property="article:modified_time" content="2023-10-24T18:00:21+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">在vue中实现在线代码编辑器之CodeMirror</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2 id="%23%20%E5%89%8D%E8%A8%80"># 前言</h2> 
<p>由于项目需求，需要完成一个支持代码提示、代码校验、代码格式化的页面代码编辑器</p> 
<h2 id="1%20%E6%8A%80%E6%9C%AF%E9%80%89%E5%9E%8B">1 技术选型</h2> 
<p>精力有限，只了解了几个主流的编辑器<a href="https://so.csdn.net/so/search?q=codemirror&amp;spm=1001.2101.3001.7020" title="codemirror">codemirror</a>、ace、Monaco Editor、vue-web-terminal等等。本文只介绍codemirror的使用。</p> 
<h2 id="2%20%E4%BD%BF%E7%94%A8%E6%95%88%E6%9E%9C">2 使用效果</h2> 
<p>先上效果图：</p> 
<pre></pre> 
<p>再看下有内容的效果：</p> 
<p><img alt="" height="925" src="https://images2.imgbox.com/b3/60/xndE5pwW_o.png" width="1106"></p> 
<p> 虽然比较简单，但是最基本的缩进、高亮显示、缩放展开等基础功能还是有的。其实还包含了许多文件类型的语法校验。</p> 
<p>后续使用中发现，给这个编辑器的内容赋值时，开头总是有个小红点。而经过反复检查传递的文件内容，并没有小红点，这个小红点也不会加在内容中传递出去，于是我发现codemirror的一些比较常用的配置项。</p> 
<h2>3 代码实现</h2> 
<p>先看实际我使用的配置项：</p> 
<pre><code class="language-javascript">data() {
    return {
      value: '',
      /** @type {import('@types/codemirror/index').EditorConfiguration} */
      codemirrorOptions: {
        // specialChars: '/[\u0000-\u0019\u00ad\u200b-\u200f\u2028\u2029\ufeff]/',  //默认值
        // specialCharPlaceholder: '', //默认值
        // eslint-disable-next-line no-control-regex
        // specialChars: /[\u0000-\u001f\u007f-\u009f\u00ad\u061c\u200b-\u200f\u2028\u2029\ufeff\ufff9-\ufffc]/g,
        // specialCharPlaceholder: function (ch) {
        //   let token = document.createElement("span");
        //   let content = "\u002e";
        //   token.className = "cm-invalidchar";
        //   if (typeof content == "string") {
        //     token.appendChild(document.createTextNode(content));
        //   }
        //   token.title = "\\u" + ch.charCodeAt(0).toString(16);
        //   token.setAttribute("aria-label", token.title);
        //   return token
        // },
        // 语言及语法模式
        mode: 'text/x-yaml',
        smartIndent: true,
        // 主题
        theme: 'neat',
        // 显示函数
        line: true,
        // 显示行号
        lineNumbers: true,
        // 软换行
        lineWrapping: true,
        // tab宽度
        tabSize: 6,
        fontSize: 20,
        fontFamily: 'monospace',
        // // 允许拖入的文件类型
        // cursorScrollMargin: 5,
        // extraKeys: {},
        // 高亮行功能
        styleActiveLine: true,
        // 调整scrollbar样式功能
        // scrollbarStyle: 'overlay',
        // 自动括号匹配功能
        matchBrackets: true,
        autofocus: true,
        autoRefresh: true,
        // #region 代码折叠
        foldGutter: true,
        // foldOptions: { scanUp: true },
        gutters: [
          'CodeMirror-linenumbers',
          'CodeMirror-foldgutter',
          'CodeMirror-lint-markers',
        ],
        height: 'auto',
        // #endregion
        showHint: true,
        lint: true,
        hintOptions: {
          // 避免由于提示列表只有一个提示信息时，自动填充
          completeSingle: false,
        },
      },
    };
  },</code></pre> 
<p>然后我再给大家罗列一些我可能没用到的 ，但是你可能会用到的配置项：</p> 
<h2>4 options 配置项说明</h2> 
<p><strong>注：<code>vue-codemirror</code>中<code>options</code>配置项和<code>codemirror</code>一样！</strong></p> 
<ul><li> <p><code>value: string|CodeMirror.Doc</code> 编辑器的起始值。可以是字符串，也可以是文档对象。</p> </li><li> <p><code>mode: string|object</code> 使用的模式。如果没有给出，默认为加载第一个模式。它可以是一个字符串，可以简单地命名模式，也可以是与模式关联的<code>MIME</code>类型。或者，它可以是包含模式配置选项的对象，具有<code>name</code>命名模式的属性（例如<code>{name: “javascript”, json: true}</code>）。每种模式的演示页面都包含有关模式支持的配置参数的信息。可以通过检查<code>CodeMirror.modes</code> 和<code>CodeMirror.mimeModes</code>对象来询问<code>CodeMirror</code>已定义了哪些模式和<code>MIME</code>类型。第一个将模式名称映射到它们的构造函数，第二个将<code>MIME</code>类型映射到模式规范。</p> </li><li> <p><code>lineSeparator: string|null</code> 显式设置编辑器的行分隔符。默认情况下（值<code>null</code>），文档将在<code>CRLF</code>以及单独的<code>CR</code>和<code>LF</code>上拆分，并且单个<code>LF</code>将在所有输出中用作行分隔符（例如<code>getValue</code>）。给定特定字符串时，只会在该字符串上拆分行，默认情况下，输出将使用相同的分隔符。</p> </li><li> <p><code>theme: string</code> 编辑器设计样式的主题。必须确保<code>.cm-s-[name]</code> 已加载定义相应样式的<code>CSS</code>文件（请参阅<code>theme</code>分发中的目录）。默认值为"<code>default</code>"，包含的颜色<code>codemirror.css</code>。它可以使用多个主题化，例如"<code>foo bar</code>"将同时分配<code>cm-s-foo</code>和<code>cm-s-bar</code>类编辑器。</p> </li><li> <p><code>indentUnit: integer</code> 一个块（编辑语言中的含义）应缩进多少个空格。默认值为<code>2</code>。</p> </li><li> <p><code>smartIndent: boolean</code> 是否使用模式提供的上下文相关缩进（或者只是缩进与之前的行相同）。默认为<code>true</code>。</p> </li><li> <p><code>tabSize: integer</code> 制表符的宽度。默认为<code>4</code>。</p> </li><li> <p><code>indentWithTabs: boolean</code> 在缩进时，是否<code>tabSize</code> 应该用<code>N</code>个制表符替换前<code>N *</code>个空格。默认值为<code>false</code>。</p> </li><li> <p><code>electricChars: boolean</code> 配置编辑器在键入可能更改其正确缩进的字符时，是否应重新缩进当前行（仅在模式支持缩进时才有效）。默认为<code>true</code>。</p> </li><li> <p><code>specialChars: RegExp</code> 用于确定哪些字符应由特殊占位符替换的正则表达式。非常适用于非打印特殊字符。默认是<code>/[\u0000-\u001f\u007f-\u009f\u00ad\u061c\u200b-\u200f\u2028\u2029\ufeff]/</code>。</p> </li><li> <p><code>specialCharPlaceholder: function(char) → Element</code> 给定由<code>specialChars</code> 选项标识的特殊字符的函数，生成用于表示字符的<code>DOM</code>节点。默认情况下，会显示一个红点（<code>•</code>），并带有标题工具提示以指示字符代码。</p> </li><li> <p><code>direction: “ltr” | "rtl"</code> 翻转整体布局并选择基本段落方向为从左到右或从右到左。默认为“<code>ltr</code>”。<code>CodeMirror</code>将<code>Unicode</code>双向算法应用于每一行，但不自动检测基本方向 - 它设置为所有行的编辑器方向。当基本方向与用户意图不匹配时，生成的顺序有时会出错（例如，前导和尾随标点跳转到行的错误一侧）。因此，允许用户切换此选项对多语言输入很有帮助。</p> </li><li> <p><code>rtlMoveVisually: boolean</code> 确定通过从右到左（阿拉伯语，希伯来语）文本的水平光标移动是否是可视的（按向左箭头向左移动光标）或逻辑（按向左箭头移动到字符串中的下一个较低索引，这在视觉上是正确的从右到左的文字）。默认设置<code>false</code> 在<code>Windows</code>上，<code>true</code>在其他平台上。</p> </li><li> <p><code>keyMap: string</code> 配置要使用的键映射。默认值是"<code>default</code>"，这是唯一定义的键映射<code>codemirror.js</code>。<code>key map</code>目录中可以找到额外的键映射。有关详细信息，请参阅关键映射部分。</p> </li><li> <p><code>extraKeys: object</code> 可用于为编辑器指定额外的键绑定，以及由其定义的绑定<code>keyMap</code>。应为<code>null</code>或有效的键映射值。</p> </li><li> <p><code>configureMouse: fn(cm: CodeMirror, repeat: “single” | “double” | “triple”, event: Event) → Object</code> 允许您配置鼠标选择和拖动的行为。按下鼠标左键时调用该函数。返回的对象可能具有以下属性：</p> </li><li> <p><code>unit: “char” | “word” | “line” | “rectangle” | fn(CodeMirror, Pos) → {from: Pos, to: Pos}</code> 选择的单位。对于自定义单元，可以是内置单元之一，也可以是一个位置并返回其范围的函数。默认设置是返回"<code>word</code>"双击，"<code>line</code>"三次点击，“<code>rectangle</code>"<code>alt-clicks</code>（或<code>Chrome</code>操作系统，元移位点击）等"<code>single</code>” 。</p> </li><li> <p><code>extend: bool</code> 是否扩展现有选择范围或开始新选择范围。默认情况下，单击班次时会启用此功能。</p> </li><li> <p><code>addNew: bool</code> 启用后，这会为现有选择添加新范围，而不是替换它。默认行为是在<code>Mac OS</code>上为命令单击启用此功能，并在其他平台上按住<code>Control</code>键单击。</p> </li><li> <p><code>moveOnDrag: bool</code> 当鼠标甚至拖动编辑器内部的内容时，它控制是复制（<code>false</code>）还是移动（<code>true</code>）。默认情况下，通过在<code>Mac OS</code>上单击鼠标右键并在其他位置按住<code>Ctrl</code>键单击来启用此功能。</p> </li><li> <p><code>lineWrapping: boolean</code> <code>CodeMirror</code>是否应滚动或换行以排长行。默认为<code>false</code>（滚动）。</p> </li><li> <p><code>lineNumbers: boolean</code> 是否在编辑器左侧显示行号。</p> </li><li> <p><code>firstLineNumber: integer</code> 在哪个数字开始计数行。默认值为1。</p> </li><li> <p><code>lineNumberFormatter: function(line: integer) → string</code> 用于格式化行号的函数。该函数传递给行号，并应返回将在装订线中显示的字符串。</p> </li><li> <p><code>gutters: array &lt; string&gt;</code> 可用于添加额外的排水沟（超出或代替行号排水沟）。应该是一个<code>CSS</code>类名称数组，每个类名称定义一个<code>width</code>（和可选的背景），并将用于绘制排水沟的背景。可以包括<code>CodeMirror-linenumbers</code>类，以便明确设置行号装订线的位置（它将默认为所有其他装订线的右侧）。这些类名是传递给的键<code>setGutterMarker</code>。</p> </li><li> <p><code>fixedGutter: boolean</code> 确定装订线是否水平滚动内容（<code>false</code>）或在水平滚动期间是否保持固定（<code>true</code>，默认值）。</p> </li><li> <p><code>scrollbarStyle: string</code> 选择滚动条实现。默认为"<code>native</code>"，显示本机滚动条。核心库还提供了"<code>null</code>"完全隐藏滚动条的样式。插件可以实现其他滚动条模型。</p> </li><li> <p><code>coverGutterNextToScrollbar: boolean</code> 当<code>fixedGutter</code> 打开时，并且存在水平滚动条，默认情况下，此滚动条左侧将显示装订线。如果此选项设置为<code>true</code>，则它将由具有类的元素覆盖<code>CodeMirror-gutter-filler</code>。</p> </li><li> <p><code>inputStyle: string</code> 选择<code>CodeMirror</code>处理输入和焦点的方式。核心库定义"<code>textarea</code>" 和"<code>contenteditable</code>"输入模式。在移动浏览器上，默认为"<code>contenteditable</code>"。在桌面浏览器上，默认为"<code>textarea</code>"。在"<code>contenteditable</code>"模型中支持<code>IME</code>和屏幕阅读器更好。目的是使其成为未来现代桌面浏览器的默认设置。</p> </li><li> <p><code>readOnly: boolean|string</code> 这会禁止用户编辑编辑器内容。如果"<code>nocursor</code>"给出特殊值（而不是简单<code>true</code>），则不允许对编辑器进行聚焦。</p> </li><li> <p><code>showCursorWhenSelecting: boolean</code> 选择是否处于活动状态时是否应绘制光标。默认为<code>false</code>。</p> </li><li> <p><code>lineWiseCopyCut: boolean</code> 启用时（默认情况下），在没有选择时执行复制或剪切将复制或剪切其上有游标的整行。</p> </li><li> <p><code>pasteLinesPerSelection: boolean</code> 当从外部源（而不是编辑器本身）粘贴某些内容时，如果行数与选择的数量相匹配，则<code>CodeMirror</code>将默认为每个选择插入一行。可以将其设置<code>false</code>为禁用该行为。</p> </li><li> <p><code>selectionsMayTouch: boolean</code> 确定多个选择是在触摸时（默认值）还是仅在它们重叠时（<code>true</code>）连接。</p> </li><li> <p><code>undoDepth: integer</code> 编辑器存储的最大撤消级别数。请注意，这包括选择更改事件。默认为<code>200</code>。</p> </li><li> <p><code>historyEventDelay: integer</code> 键入或删除时将导致新历史事件开始的不活动时间（以毫秒为单位）。默认为<code>1250</code>。</p> </li><li> <p><code>tabindex: integer</code> 要分配给编辑器的选项卡索引。如果没有给出，则不会分配选项卡索引。</p> </li><li> <p><code>autofocus: boolean</code> 可用于使<code>CodeMirror</code>将焦点集中在初始化上。默认为关闭。当<code>fromTextArea</code>使用<code>when</code>时，并且没有给出该选项的显式值，当源<code>textarea</code>被聚焦时，它将被设置为<code>true</code>，或者它具有<code>autofocus</code>属性而没有聚焦其他元素。</p> </li><li> <p><code>phrases: object</code> 某些插件通过该phrase 方法运行用户可见的字符串（例如界面中的标签）以允许翻译。此选项确定该方法的返回值。如果它为null或者没有输入字符串命名的属性的对象，则返回该字符串。否则，返回与该字符串对应的属性的值。</p> </li><li> <p><code>dragDrop: boolean</code> 控制是否启用拖放。默认开启。</p> </li><li> <p><code>allowDropFileTypes: array&lt; string&gt;</code> 设置（默认为null）时，只能将类型在数组中的文件放入编辑器中。字符串应该是<code>MIME</code>类型，并将根据浏览器报告type 的File对象进行检查。</p> </li><li> <p><code>cursorBlinkRate: number</code> 用于光标闪烁的半周期（以毫秒为单位）。默认闪烁率为<code>530</code>毫秒。通过将此值设置为零，可以禁用闪烁。负值完全隐藏光标。</p> </li><li> <p><code>cursorScrollMargin: number</code> 当接近可滚动文档中可见视图的顶部或底部时，总是在光标上方和下方留出多少额外空间。默认值为0。</p> </li><li> <p><code>cursorHeight: number</code> 确定光标的高度。默认值为1，表示它跨越线的整个高度。对于某些字体（以及某些品味）较小的高度（例如0.85），导致光标无法一直到达线的底部，看起来更好</p> </li><li> <p><code>resetSelectionOnContextMenu: boolean</code> 控制当在当前选择之外单击打开上下文菜单时，是否将光标移动到单击点。默认为true。</p> </li><li> <p><code>workTime, workDelay: number</code> 突出显示由伪背景线程完成，该线程将工作workTime毫秒，然后使用超时睡眠<code>workDelay</code>毫秒。默认值为200和300，您可以更改这些选项以突出显示或多或少的激进。</p> </li><li> <p><code>pollInterval: number</code> 指示<code>CodeMirror</code>应该如何快速轮询其输入<code>textarea</code>以进行更改（聚焦时）。大多数输入都是由事件捕获的，但某些内容（如某些浏览器上的IME输入）不会生成允许<code>CodeMirror</code>正确检测它的事件。因此，它民意调查。默认值为100毫秒。</p> </li><li> <p><code>flattenSpans: boolean</code> 默认情况下，如果相邻标记具有相同的类，则它们会将相邻标记合并为单个跨度。这将导致更简单的DOM树，从而表现更好。使用某些样式（例如圆角），这将改变文档的外观。您可以将此选项设置为false以禁用此行为。</p> </li><li> <p><code>addModeClass: boolean</code> 启用时（默认情况下为<code>off</code>），将为每个标记添加一个额外的<code>CSS</code>类，指示生成它的（内部）模式，前缀为"<code>cm-m-</code>"。例如，来自XML模式的标记将获得<code>cm-m-xml</code>该类。</p> </li><li> <p><code>maxHighlightLength: number</code> 当突出显示长行时，为了保持响应，编辑器将放弃并简单地将行的其余部分设置为纯文本，当它到达某个位置时。默认值为10 000.您可以将其设置<code>Infinity</code>为关闭此行为。</p> </li><li> <p><code>viewportMargin: integer</code> 指定在当前滚动到视图中的文档部分上方和下方呈现的行数。这会影响滚动时所需的更新量以及此类更新所做的工作量。您通常应该将其保留为默认值10.可以设置为<code>Infinity</code>确保始终呈现整个文档，因此浏览器的文本搜索会对其进行处理。这将对大文档的性能产生不良影响。</p> </li></ul> 
<h2>5 踩坑记录</h2> 
<p>由于发现了小红点其实是配置项中默认转义而出现的，所以我在该vue中加上了以下样式，这样就可以去掉碍眼的小红点了：</p> 
<pre><code class="language-css">//屏蔽开头的小红点
.cm-invalidchar {
  display: none;
}</code></pre> 
<p>这样直接就把 转义出现的小红点这个区域直接屏蔽掉了。其实这个对于我的文件内容是没有任何影响的，不用担心文件内容会出现问题。</p> 
<h2>6 总结</h2> 
<p>以上就是我使用codemirror的一些经验，我是通过页面集成了vue-codemirror，来实现了一个在页面上的代码编辑器，从而可以方便的编辑和查看某些配置文件。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/748469388456414c1cc1f5c518a523f2/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">xcode15一直显示正在连接iOS17真机问题解决</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/304803bb2d49f36685d1a3bcb598e890/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">这才是程序员未来的工作模式！</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>