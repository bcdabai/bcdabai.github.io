<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>服务器的防火墙禁止了对指定通讯端口的访问,iptables防火墙只允许指定ip连接指定端口、访问指定网站... - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="服务器的防火墙禁止了对指定通讯端口的访问,iptables防火墙只允许指定ip连接指定端口、访问指定网站..." />
<meta property="og:description" content="iptables防火墙只允许指定ip连接指定端口、访问指定网站
发布时间：2015-05-08 13:04:04 作者：佚名 我要评论 这篇文章主要介绍了iptables防火墙只允许指定ip连接指定端口、访问指定网站,需要的朋友可以参考下
需要开80端口，指定IP和局域网
下面三行的意思：
先关闭所有的80端口
开启ip段192.168.1.0/24端的80口
开启ip段211.123.16.123/24端ip段的80口
# iptables -I INPUT -p tcp --dport 80 -j DROP
# iptables -I INPUT -s 192.168.1.0/24 -p tcp --dport 80 -j ACCEPT
# iptables -I INPUT -s 211.123.16.123/24 -p tcp --dport 80 -j ACCEPT
以上是临时设置。
1.先备份iptables
# cp /etc/sysconfig/iptables /var/tmp
2.然后保存iptables
# service iptables save
3.重启防火墙
#service iptables restart
以下是端口，先全部封再开某些的IP
iptables -I INPUT -p tcp --dport 9889 -j DROP" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/f4ba0169a0da763147687011df120eba/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-07-31T23:32:13+08:00" />
<meta property="article:modified_time" content="2021-07-31T23:32:13+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">服务器的防火墙禁止了对指定通讯端口的访问,iptables防火墙只允许指定ip连接指定端口、访问指定网站...</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div style="font-size:16px;"> 
 <p>iptables防火墙只允许指定ip连接指定端口、访问指定网站</p> 
 <p align="center">发布时间：2015-05-08 13:04:04   作者：佚名   <img src="https://images2.imgbox.com/5c/84/P6UofhnG_o.png" alt="text-message.png"> 我要评论 </p> 
 <p>这篇文章主要介绍了iptables防火墙只允许指定ip连接指定端口、访问指定网站,需要的朋友可以参考下</p> 
 <p align="center"></p> 
 <p>需要开80端口，指定IP和局域网</p> 
 <p>下面三行的意思：</p> 
 <p>先关闭所有的80端口</p> 
 <p>开启ip段192.168.1.0/24端的80口</p> 
 <p>开启ip段211.123.16.123/24端ip段的80口</p> 
 <p># iptables -I INPUT -p tcp --dport 80 -j DROP</p> 
 <p># iptables -I INPUT -s 192.168.1.0/24 -p tcp --dport 80 -j ACCEPT</p> 
 <p># iptables -I INPUT -s 211.123.16.123/24 -p tcp --dport 80 -j ACCEPT</p> 
 <p>以上是临时设置。</p> 
 <p>1.先备份iptables</p> 
 <p># cp /etc/sysconfig/iptables /var/tmp</p> 
 <p>2.然后保存iptables</p> 
 <p># service iptables save</p> 
 <p>3.重启防火墙</p> 
 <p>#service iptables restart</p> 
 <p>以下是端口，先全部封再开某些的IP</p> 
 <p>iptables -I INPUT -p tcp --dport 9889 -j DROP</p> 
 <p>iptables -I INPUT -s 192.168.1.0/24 -p tcp --dport 9889 -j ACCEPT</p> 
 <p>如果用了NAT转发记得配合以下才能生效</p> 
 <p>iptables -I FORWARD -p tcp --dport 80 -j DROP</p> 
 <p>iptables -I FORWARD -s 192.168.1.0/24 -p tcp --dport 80 -j ACCEPT</p> 
 <p>常用的IPTABLES规则如下：</p> 
 <p>只能收发邮件，别的都关闭</p> 
 <p>iptables -I Filter -m mac --mac-source 00:0F:EA:25:51:37 -j DROP</p> 
 <p>iptables -I Filter -m mac --mac-source 00:0F:EA:25:51:37 -p udp --dport 53 -j ACCEPT</p> 
 <p>iptables -I Filter -m mac --mac-source 00:0F:EA:25:51:37 -p tcp --dport 25 -j ACCEPT</p> 
 <p>iptables -I Filter -m mac --mac-source 00:0F:EA:25:51:37 -p tcp --dport 110 -j ACCEPT</p> 
 <p>IPSEC NAT 策略</p> 
 <p>iptables -I PFWanPriv -d 192.168.100.2 -j ACCEPT</p> 
 <p>iptables -t nat -A PREROUTING -p tcp --dport 80 -d $INTERNET_ADDR -j DNAT --to-destination 192.168.100.2:80</p> 
 <p>iptables -t nat -A PREROUTING -p tcp --dport 1723 -d $INTERNET_ADDR -j DNAT --to-destination 192.168.100.2:1723</p> 
 <p>iptables -t nat -A PREROUTING -p udp --dport 1723 -d $INTERNET_ADDR -j DNAT --to-destination 192.168.100.2:1723</p> 
 <p>iptables -t nat -A PREROUTING -p udp --dport 500 -d $INTERNET_ADDR -j DNAT --to-destination 192.168.100.2:500</p> 
 <p>iptables -t nat -A PREROUTING -p udp --dport 4500 -d $INTERNET_ADDR -j DNAT --to-destination 192.168.100.2:4500</p> 
 <p>FTP服务器的NAT</p> 
 <p>iptables -I PFWanPriv -p tcp --dport 21 -d 192.168.100.200 -j ACCEPT</p> 
 <p>iptables -t nat -A PREROUTING -p tcp --dport 21 -d $INTERNET_ADDR -j DNAT --to-destination 192.168.100.200:21</p> 
 <p>只允许访问指定网址</p> 
 <p>iptables -A Filter -p udp --dport 53 -j ACCEPT</p> 
 <p>iptables -A Filter -p tcp --dport 53 -j ACCEPT</p> 
 <p>iptables -A Filter -d www.3322.org -j ACCEPT</p> 
 <p>iptables -A Filter -d img.cn99.com -j ACCEPT</p> 
 <p>iptables -A Filter -j DROP</p> 
 <p>开放一个IP的一些端口，其它都封闭</p> 
 <p>iptables -A Filter -p tcp --dport 80 -s 192.168.100.200 -d www.pconline.com.cn -j ACCEPT</p> 
 <p>iptables -A Filter -p tcp --dport 25 -s 192.168.100.200 -j ACCEPT</p> 
 <p>iptables -A Filter -p tcp --dport 109 -s 192.168.100.200 -j ACCEPT</p> 
 <p>iptables -A Filter -p tcp --dport 110 -s 192.168.100.200 -j ACCEPT</p> 
 <p>iptables -A Filter -p tcp --dport 53 -j ACCEPT</p> 
 <p>iptables -A Filter -p udp --dport 53 -j ACCEPT</p> 
 <p>iptables -A Filter -j DROP</p> 
 <p>多个端口</p> 
 <p>iptables -A Filter -p tcp -m multiport --destination-port 22,53,80,110 -s 192.168.20.3 -j REJECT</p> 
 <p>连续端口</p> 
 <p>iptables -A Filter -p tcp -m multiport --source-port 22,53,80,110 -s 192.168.20.3 -j REJECT iptables -A Filter -p tcp --source-port 2:80 -s 192.168.20.3 -j REJECT</p> 
 <p>指定时间上网</p> 
 <p>iptables -A Filter -s 10.10.10.253 -m time --timestart 6:00 --timestop 11:00 --days Mon,Tue,Wed,Thu,Fri,Sat,Sun -j DROP</p> 
 <p>iptables -A Filter -m time --timestart 12:00 --timestop 13:00 --days Mon,Tue,Wed,Thu,Fri,Sat,Sun -j ACCEPT</p> 
 <p>iptables -A Filter -m time --timestart 17:30 --timestop 8:30 --days Mon,Tue,Wed,Thu,Fri,Sat,Sun -j ACCEPT</p> 
 <p>禁止多个端口服务</p> 
 <p>iptables -A Filter -m multiport -p tcp --dport 21,23,80 -j ACCEPT</p> 
 <p>将WAN 口NAT到PC</p> 
 <p>iptables -t nat -A PREROUTING -i $INTERNET_IF -d $INTERNET_ADDR -j DNAT --to-destination 192.168.0.1</p> 
 <p>将WAN口8000端口NAT到192。168。100。200的80端口</p> 
 <p>iptables -t nat -A PREROUTING -p tcp --dport 8000 -d $INTERNET_ADDR -j DNAT --to-destination 192.168.100.200:80</p> 
 <p>MAIL服务器要转的端口</p> 
 <p>iptables -t nat -A PREROUTING -p tcp --dport 110 -d $INTERNET_ADDR -j DNAT --to-destination 192.168.100.200:110</p> 
 <p>iptables -t nat -A PREROUTING -p tcp --dport 25 -d $INTERNET_ADDR -j DNAT --to-destination 192.168.100.200:25</p> 
 <p>只允许PING 202。96。134。133,别的服务都禁止</p> 
 <p>iptables -A Filter -p icmp -s 192.168.100.200 -d 202.96.134.133 -j ACCEPT</p> 
 <p>iptables -A Filter -j DROP</p> 
 <p>禁用BT配置</p> 
 <p>iptables –A Filter –p tcp –dport 6000:20000 –j DROP</p> 
 <p>禁用QQ防火墙配置</p> 
 <p>iptables -A Filter -p udp --dport ! 53 -j DROP</p> 
 <p>iptables -A Filter -d 218.17.209.0/24 -j DROP</p> 
 <p>iptables -A Filter -d 218.18.95.0/24 -j DROP</p> 
 <p>iptables -A Filter -d 219.133.40.177 -j DROP</p> 
 <p>基于MAC，只能收发邮件，其它都拒绝</p> 
 <p>iptables -I Filter -m mac --mac-source 00:0A:EB:97:79:A1 -j DROP</p> 
 <p>iptables -I Filter -m mac --mac-source 00:0A:EB:97:79:A1 -p tcp --dport 25 -j ACCEPT</p> 
 <p>iptables -I Filter -m mac --mac-source 00:0A:EB:97:79:A1 -p tcp --dport 110 -j ACCEPT</p> 
 <p>禁用MSN配置</p> 
 <p>iptables -A Filter -p udp --dport 9 -j DROP</p> 
 <p>iptables -A Filter -p tcp --dport 1863 -j DROP</p> 
 <p>iptables -A Filter -p tcp --dport 80 -d 207.68.178.238 -j DROP</p> 
 <p>iptables -A Filter -p tcp --dport 80 -d 207.46.110.0/24 -j DROP</p> 
 <p>只允许PING 202。96。134。133 其它公网IP都不许PING</p> 
 <p>iptables -A Filter -p icmp -s 192.168.100.200 -d 202.96.134.133 -j ACCEPT</p> 
 <p>iptables -A Filter -p icmp -j DROP</p> 
 <p>禁止某个MAC地址访问internet:</p> 
 <p>iptables -I Filter -m mac --mac-source 00:20:18:8F:72:F8 -j DROP</p> 
 <p>禁止某个IP地址的PING:</p> 
 <p>iptables –A Filter –p icmp –s 192.168.0.1 –j DROP</p> 
 <p>禁止某个IP地址服务：</p> 
 <p>iptables –A Filter -p tcp -s 192.168.0.1 --dport 80 -j DROP</p> 
 <p>iptables –A Filter -p udp -s 192.168.0.1 --dport 53 -j DROP</p> 
 <p>只允许某些服务，其他都拒绝(2条规则)</p> 
 <p>iptables -A Filter -p tcp -s 192.168.0.1 --dport 1000 -j ACCEPT</p> 
 <p>iptables -A Filter -j DROP</p> 
 <p>禁止某个IP地址的某个端口服务</p> 
 <p>iptables -A Filter -p tcp -s 10.10.10.253 --dport 80 -j ACCEPT</p> 
 <p>iptables -A Filter -p tcp -s 10.10.10.253 --dport 80 -j DROP</p> 
 <p>禁止某个MAC地址的某个端口服务</p> 
 <p>iptables -I Filter -p tcp -m mac --mac-source 00:20:18:8F:72:F8 --dport 80 -j DROP</p> 
 <p>禁止某个MAC地址访问internet:</p> 
 <p>iptables -I Filter -m mac --mac-source 00:11:22:33:44:55 -j DROP</p> 
 <p>禁止某个IP地址的PING:</p> 
 <p>iptables –A Filter –p icmp –s 192.168.0.1 –j DROP</p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5ae0fff7dca405773df43f5c8c42edc9/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">ChinaJoy直击：联想拯救者R9000X燃爆现场</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/23259d878c462ade74d814111db5de98/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">计算机的磁盘碎片是什么,什么是磁盘的碎片化</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>